"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-2d14a1"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-58a7e7ab.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-58a7e7ab.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (/* binding */ AppendOverwriteCloudPublishTypes),
/* harmony export */   N: () => (/* binding */ NONE_VALUE),
/* harmony export */   a: () => (/* binding */ appendFileTypes),
/* harmony export */   b: () => (/* binding */ AppendOverwritePublishTypes),
/* harmony export */   c: () => (/* binding */ appendExtensionsForEnterprise),
/* harmony export */   d: () => (/* binding */ appendExtensions),
/* harmony export */   u: () => (/* binding */ uidFields)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
const uidFields = ["esriFieldTypeOID", "esriFieldTypeGlobalID"];
const NONE_VALUE = "<None>";
const AppendOverwritePublishTypes = {
  "file geodatabase": "filegeodatabase",
  shapefile: "shapefile",
  geojson: "geojson",
  csv: "CSV",
  "microsoft excel": "excel",
  geopackage: "geoPackage"
};
const appendFileTypes = {
  Shapefile: "shapefile",
  "File Geodatabase": "fileGeodatabase",
  CSV: "csv",
  "Microsoft Excel": "excel",
  GeoJson: "geojson",
  GeoPackage: "geoPackage"
};
const AppendOverwriteCloudPublishTypes = {
  csv: "CSV",
  excel: "Microsoft Excel",
  shapefile: "Shapefile",
  fgdb: "File Geodatabase",
  geojson: "GeoJson",
  googlesheets: "Microsoft Excel"
};
const appendExtensions = ["zip", "csv", "xls", "xlsx", "geojson", "gpkg", "json"];
const appendExtensionsForEnterprise = ["zip", "csv", "xls", "xlsx"];




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-select.entry.js":
/*!**************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-select.entry.js ***!
  \**************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_append_select: () => (/* binding */ ArcgisNewItemPagesAppendSelect)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./append-58a7e7ab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-58a7e7ab.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _index_eb224d3c_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./index-eb224d3c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-eb224d3c.js");
/* harmony import */ var _publish_item_82ffa7f8_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./publish-item-82ffa7f8.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/publish-item-82ffa7f8.js");
/* harmony import */ var _overwrite_3049b7af_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./overwrite-3049b7af.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/overwrite-3049b7af.js");
/* harmony import */ var _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./feature-layer-38cdae87.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-38cdae87.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _tile_layer_90a6b901_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./tile-layer-90a6b901.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-90a6b901.js");
/* harmony import */ var _functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./functional-9f648bee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-9f648bee.js");
/* harmony import */ var _geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./geocode-7eb7c0df.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-7eb7c0df.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./privileges-35590eb4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-35590eb4.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./server-item-f12153e6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js");
/* harmony import */ var _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./item-properties-e6412a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/* harmony import */ var _feature_layer_d33ea114_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./feature-layer-d33ea114.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-d33ea114.js");
/* harmony import */ var _guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./guid-4f4176ba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js");
/* harmony import */ var _thumbnail_0b7adfcd_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./thumbnail-0b7adfcd.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-0b7adfcd.js");
/* harmony import */ var _query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./query-4f7b7e4d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-4f7b7e4d.js");
/* harmony import */ var _user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./user-e3dedc4a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js");
/* harmony import */ var _api_f7934cd7_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./api-f7934cd7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-f7934cd7.js");
/* harmony import */ var _item_d9d70416_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./item-d9d70416.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-d9d70416.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _feature_layer_69305a85_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./feature-layer-69305a85.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-69305a85.js");
/* harmony import */ var _ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./ags-68d4ae20.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-68d4ae20.js");
/* harmony import */ var _url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./url-f3b82cc7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-f3b82cc7.js");
/* harmony import */ var _storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./storage-d7f5822e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js");
/* harmony import */ var _file_f36193e9_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./file-f36193e9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-f36193e9.js");
/* harmony import */ var _store_3210b604_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./store-3210b604.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-3210b604.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




































const arcgisNewItemPagesAppendSelectCss = ".tile-select{display:grid;font-size:1.125rem;margin-right:0.75rem;margin-left:0.75rem;margin-top:1rem;padding-bottom:6rem}@media (min-width: 480px){.tile-select{grid-template-columns:repeat(2, 1fr)}}.tile-card:hover{box-shadow:0 4px 16px 0 rgba(0, 0, 0, 0.08), 0 2px 8px 0 rgba(0, 0, 0, 0.04)}.header{font-size:1rem;font-weight:500;margin-left:0.75rem}.insert-only-info{color:var(--calcite-ui-text-1);font-weight:500;font-size:0.75rem;margin-left:0.75rem}";

const ArcgisNewItemPagesAppendSelect = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.newItemToggleNavigationEnabled = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
    this.workflowComplete = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
    this.insertOnly = false;
    this.isCloudItem = false;
    this.isUrlItem = false;
    this.options = {
      add: {
        icon: "add-features",
        updateType: "add",
        hidden: false,
        disabled: false
      },
      update: {
        icon: "update-features",
        updateType: "update",
        hidden: false,
        disabled: false
      },
      upsert: {
        icon: "add-and-update-features",
        updateType: "upsert",
        hidden: false,
        disabled: false
      },
      overwrite: {
        icon: "overwrite-features",
        updateType: "overwrite",
        hidden: false,
        disabled: false
      }
    };
    this.selected = "add";
    this.error = undefined;
    this.loading = false;
    this.loaderType = "indeterminate";
    this.loaderMessage = undefined;
  }
  handleNext() {
    let nextPage;
    const { item, selected, layer, layerId, appendLayerEntry } = this;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.addAppendSelectOption = selected;
    if (!appendLayerEntry && selected !== "overwrite" && item.layers.length > 1) {
      //feature layer is multi-layered
      nextPage = "appendSelectLayer";
    }
    else {
      if (item.cloudProviderInfo && selected === "overwrite") {
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.newItemMode = "file";
        if (item.cloudProviderInfo.cloudProvider) {
          const { id, mimeType, cloudProvider } = item.cloudProviderInfo;
          this.assignCloudItemStore(item.cloudProviderInfo);
          this.handleOverwriteURL(item, id, mimeType, cloudProvider);
          return;
        }
        else {
          this.handleOverwriteURL(item);
          return;
        }
      }
      else if (appendLayerEntry) {
        let sourceDataLayer = layer !== null && layer !== void 0 ? layer : item.layers[layerId];
        if (!sourceDataLayer) {
          //STGL items return a layerId that is greater than length of possible layer indexes
          sourceDataLayer = item.layers[0];
        }
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.sourceDataLayer = sourceDataLayer;
      }
      else {
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.sourceDataLayer = item.layers[0];
      }
      nextPage = "appendUpload";
    }
    this.newItemUpdatePage.emit(nextPage);
  }
  createOptions() {
    var _a, _b;
    const item = this.item;
    const noSourceData = !item.sourceData && !item.cloudProviderInfo;
    const isGeoPackageAndEnterprise = ((_a = item.sourceData) === null || _a === void 0 ? void 0 : _a.type) === "GeoPackage" && _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_4__.c.portal.isPortal;
    const capabilities = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_4__.c.portal.isPortal && !item.isSDS
      ? item.serviceInfo.capabilities // portal hosted feature layer w/o 'providerSDS' typeKeyword
      : item.adminServiceInfo.capabilities; // every other hosted feature layer impl,
    if (capabilities.indexOf("ChangeTracking") !== -1 || item.serviceInfo.syncEnabled) {
      this.insertOnly = true;
      this.options.overwrite.disabled = true;
      this.options.update.disabled = true;
      this.options.upsert.disabled = true;
    } //insert only when change tracking OR sync enabled
    if (this.appendLayerEntry ||
      isGeoPackageAndEnterprise ||
      ((_b = item.sourceData) === null || _b === void 0 ? void 0 : _b.type) === "Service Definition" ||
      noSourceData) {
      this.options.overwrite.disabled = true;
    }
  }
  createOverwriteNextText() {
    switch (true) {
      case this.isCloudItem:
        return "signInAndOverwrite";
      case this.isUrlItem:
        return "overwriteAndComplete";
      default:
        return "next";
    }
  }
  async componentWillLoad() {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
    this.selected = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.addAppendSelectOption || "add";
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.appendSelect;
    this.item = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.existingItem;
    this.appendLayerEntry = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.layerId !== undefined || !!_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.sublayer;
    this.layerId = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.layerId;
    this.layer = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.sublayer;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.id = null; //Set existingItem to be null so that on close, it does not delete the HFL item
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.dateFieldsTimeReference = (_g = (_c = (_b = (_a = this.item) === null || _a === void 0 ? void 0 : _a.publishParameters) === null || _b === void 0 ? void 0 : _b.dateFieldsTimeReference) !== null && _c !== void 0 ? _c : (_f = (_e = (_d = this.item) === null || _d === void 0 ? void 0 : _d.publishParameters) === null || _e === void 0 ? void 0 : _e.layers) === null || _f === void 0 ? void 0 : _f[0].dateFieldsTimeReference) !== null && _g !== void 0 ? _g : this.item.layers[0].dateFieldsTimeReference;
    this.isUrlItem = !!((_j = (_h = this.item) === null || _h === void 0 ? void 0 : _h.cloudProviderInfo) === null || _j === void 0 ? void 0 : _j.url);
    this.isCloudItem = !!((_l = (_k = this.item) === null || _k === void 0 ? void 0 : _k.cloudProviderInfo) === null || _l === void 0 ? void 0 : _l.cloudProvider);
    this.createOptions();
  }
  assignCloudItemStore(cloudProviderInfo) {
    const { cloudProvider, id, mimeType, cloudDriveFileName, cloudFileType, zipItemType } = cloudProviderInfo;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.cloudProvider = (0,_index_eb224d3c_js__WEBPACK_IMPORTED_MODULE_6__.d)(cloudProvider);
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.cloudProviderResource = {
      cloudProvider,
      id,
      mimeType,
      cloudDriveFileName,
      cloudFileType,
      zipItemType
    };
  }
  async setUpCloud(cloudProvider) {
    const provider = (0,_index_eb224d3c_js__WEBPACK_IMPORTED_MODULE_6__.e)(cloudProvider);
    const { result, error } = await (0,_overwrite_3049b7af_js__WEBPACK_IMPORTED_MODULE_8__.g)(provider);
    if (error) {
      this.handleError();
      return null;
    }
    return result;
  }
  async handleOverwriteURL(item, id, mimeType, cloudProvider) {
    var _a, _b, _c, _d, _e, _f, _g;
    //for CSV, GeoJSON url-made items
    let dataUrl, type, typeKeywords;
    this.loading = true;
    this.loaderMessage = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.append.appendLoadingMessages.overwriting;
    const cloudProviderInfo = item.cloudProviderInfo;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.fileName = item.title;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.title = item.title;
    if (cloudProviderInfo.cloudProvider) {
      type = _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_2__.A[mimeType];
      typeKeywords = [_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.type];
      const token = await this.setUpCloud(cloudProvider);
      await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_5__.t)(200);
      switch (cloudProvider) {
        case "googleConnect":
          dataUrl = (0,_index_eb224d3c_js__WEBPACK_IMPORTED_MODULE_6__.f)(id, mimeType, token);
          break;
        case "dropBoxConnect":
          dataUrl = (0,_index_eb224d3c_js__WEBPACK_IMPORTED_MODULE_6__.i)(id, token);
          break;
        case "oneDriveConnect":
          dataUrl = (0,_index_eb224d3c_js__WEBPACK_IMPORTED_MODULE_6__.h)(id, token);
          break;
      }
    }
    else {
      if (cloudProviderInfo.mimeType === "geojson") {
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.geoJSONResource = {
          fileName: cloudProviderInfo.fileName,
          url: cloudProviderInfo.url,
          mimeType: cloudProviderInfo.mimeType
        };
      }
      else {
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.csvResource = {
          fileName: cloudProviderInfo.fileName,
          url: cloudProviderInfo.url,
          mimeType: cloudProviderInfo.mimeType
        };
      }
      const resource = (_a = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.csvResource) !== null && _a !== void 0 ? _a : _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.geoJSONResource;
      type = _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_2__.A[resource.mimeType];
      dataUrl = resource.url;
      typeKeywords = [type];
    }
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.dataUrl = dataUrl;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.type = type;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.typeKeywords = typeKeywords;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.overwrite = true;
    try {
      this.newItemToggleNavigationEnabled.emit(false);
      await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_9__.x)();
      const overwritePublishParameters = await (0,_overwrite_3049b7af_js__WEBPACK_IMPORTED_MODULE_8__.a)(item, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_4__.c.portal, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_4__.c.user, _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.id);
      const publishResponse = await (0,_publish_item_82ffa7f8_js__WEBPACK_IMPORTED_MODULE_7__.p)({
        itemId: (_c = (_b = item === null || item === void 0 ? void 0 : item.sourceData) === null || _b === void 0 ? void 0 : _b.id) !== null && _c !== void 0 ? _c : item.id,
        user: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_4__.c.user,
        title: (item === null || item === void 0 ? void 0 : item.title) || "",
        itemOwnerUrl: item.itemOwner.userContentUrl // ! Use fetchUser if itemOwner is not available
      }, overwritePublishParameters);
      await (0,_overwrite_3049b7af_js__WEBPACK_IMPORTED_MODULE_8__.u)(overwritePublishParameters.publishParameters, item, (_e = (_d = publishResponse.result) === null || _d === void 0 ? void 0 : _d.services) === null || _e === void 0 ? void 0 : _e[0].serviceItemId);
      await this.checkStatus({ itemId: item.id, jobId: (_g = (_f = publishResponse.result) === null || _f === void 0 ? void 0 : _f.services) === null || _g === void 0 ? void 0 : _g[0].jobId }, publishResponse === null || publishResponse === void 0 ? void 0 : publishResponse.result);
    }
    catch (error) {
      this.handleError();
    }
  }
  async checkStatus(jobInfo, publishResponse) {
    var _a;
    this.loaderMessage = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.append.appendLoadingMessages.overwriting;
    this.newItemToggleNavigationEnabled.emit(true);
    const response = await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_9__.w)(jobInfo.itemId, { jobId: jobInfo.jobId }); //checking update of source data's job.
    const overwriteStatus = response === null || response === void 0 ? void 0 : response.status;
    const emitPayload = Object.assign({ id: (_a = publishResponse === null || publishResponse === void 0 ? void 0 : publishResponse.services) === null || _a === void 0 ? void 0 : _a[0].serviceItemId, item: Object.assign({}, _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a), overwriteStatus, appendType: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.addAppendSelectOption }, publishResponse);
    if ((response === null || response === void 0 ? void 0 : response.status.toLowerCase()) === "completed") {
      emitPayload.overwriteStatus = response === null || response === void 0 ? void 0 : response.status;
      this.workflowComplete.emit(emitPayload);
      return null;
    }
    else if ((response === null || response === void 0 ? void 0 : response.status.toLowerCase()) === "failed") {
      this.handleError();
    }
    return response;
  }
  handleError() {
    _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.nextText = "next";
    this.newItemToggleNavigationEnabled.emit(true);
    this.loading = false;
    this.error = {
      title: _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.error,
      description: _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.appendUpload.errors.errorWhileUpload
    };
  }
  render() {
    const { i18n, options, insertOnly, error, loaderType, loading, loaderMessage } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: { "overflow-hidden": loading } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: loaderType, active: loading, text: loaderMessage }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "header" }, insertOnly ? i18n.insertOnlyEnabled : i18n.chooseUpdate), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "tile-select" }, Object.keys(options).map((key) => {
      const { icon, hidden, disabled } = options[key];
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { key: key, checked: this.selected === key, heading: i18n.options[key].title, icon: icon, name: "append-select-update", width: "full", type: "radio", value: key, class: "tile-card", hidden: hidden, disabled: disabled, inputEnabled: true, onCalciteTileSelectChange: (e) => {
          this.selected = e.target.value;
          _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.nextText =
            this.selected === "overwrite" ? this.createOverwriteNextText() : "next";
        } }));
    })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: error === null || error === void 0 ? void 0 : error.title, description: error === null || error === void 0 ? void 0 : error.description, active: !!error, onAlertDismiss: () => (this.error = null) })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesAppendSelect.style = arcgisNewItemPagesAppendSelectCss;




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTJkMTRhMS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFcU07Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDakNyTTtBQUNBO0FBQ0E7QUFDQTtBQUM2RztBQUNsRDtBQUNrQjtBQUN4QjtBQUNHO0FBQ0E7QUFDd0c7QUFDL0Y7QUFDdUQ7QUFDdEM7QUFDckQ7QUFDSztBQUNBO0FBQ0g7QUFDRztBQUNBO0FBQ0o7QUFDSztBQUNBO0FBQ0k7QUFDTDtBQUNHO0FBQ1Q7QUFDSztBQUNKO0FBQ0Q7QUFDRDtBQUNDO0FBQ0Q7QUFDVTtBQUNWO0FBQ0E7QUFDSTtBQUNIO0FBQ0M7O0FBRTdCLHdEQUF3RCxhQUFhLG1CQUFtQixxQkFBcUIsb0JBQW9CLGdCQUFnQixvQkFBb0IsMEJBQTBCLGFBQWEsc0NBQXNDLGlCQUFpQiw2RUFBNkUsUUFBUSxlQUFlLGdCQUFnQixvQkFBb0Isa0JBQWtCLCtCQUErQixnQkFBZ0Isa0JBQWtCLG9CQUFvQjs7QUFFbGY7QUFDQTtBQUNBLElBQUkscURBQWdCO0FBQ3BCLDZCQUE2QixxREFBVztBQUN4QywwQ0FBMEMscURBQVc7QUFDckQsNEJBQTRCLHFEQUFXO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7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Q0E7QUFDQTtBQUNBLElBQUksOENBQVk7QUFDaEI7QUFDQTtBQUNBO0FBQ0EsYUFBYSw4Q0FBWTtBQUN6QixtQkFBbUIsOENBQVk7QUFDL0I7QUFDQTtBQUNBO0FBQ0EsWUFBWSx1RUFBdUU7QUFDbkYsWUFBWSxxREFBQyxDQUFDLGlEQUFJLElBQUksU0FBUyw4QkFBOEIsRUFBRSxxREFBQyw2QkFBNkIsd0RBQXdELEdBQUcscURBQUMsVUFBVSxpQkFBaUIsNERBQTRELHFEQUFDLFVBQVUsc0JBQXNCO0FBQ2pSLGNBQWMseUJBQXlCO0FBQ3ZDLGNBQWMscURBQUMsMEJBQTBCO0FBQ3pDO0FBQ0EsVUFBVSw4Q0FBWTtBQUN0QjtBQUNBLFdBQVc7QUFDWCxLQUFLLElBQUkscURBQUMsNEJBQTRCLDhNQUE4TTtBQUNwUDtBQUNBLGFBQWEsT0FBTyxxREFBVTtBQUM5QjtBQUNBOztBQUVpRiIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FwcGVuZC01OGE3ZTdhYi5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtbmV3LWl0ZW0tcGFnZXMtYXBwZW5kLXNlbGVjdC5lbnRyeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmNvbnN0IHVpZEZpZWxkcyA9IFtcImVzcmlGaWVsZFR5cGVPSURcIiwgXCJlc3JpRmllbGRUeXBlR2xvYmFsSURcIl07XG5jb25zdCBOT05FX1ZBTFVFID0gXCI8Tm9uZT5cIjtcbmNvbnN0IEFwcGVuZE92ZXJ3cml0ZVB1Ymxpc2hUeXBlcyA9IHtcbiAgXCJmaWxlIGdlb2RhdGFiYXNlXCI6IFwiZmlsZWdlb2RhdGFiYXNlXCIsXG4gIHNoYXBlZmlsZTogXCJzaGFwZWZpbGVcIixcbiAgZ2VvanNvbjogXCJnZW9qc29uXCIsXG4gIGNzdjogXCJDU1ZcIixcbiAgXCJtaWNyb3NvZnQgZXhjZWxcIjogXCJleGNlbFwiLFxuICBnZW9wYWNrYWdlOiBcImdlb1BhY2thZ2VcIlxufTtcbmNvbnN0IGFwcGVuZEZpbGVUeXBlcyA9IHtcbiAgU2hhcGVmaWxlOiBcInNoYXBlZmlsZVwiLFxuICBcIkZpbGUgR2VvZGF0YWJhc2VcIjogXCJmaWxlR2VvZGF0YWJhc2VcIixcbiAgQ1NWOiBcImNzdlwiLFxuICBcIk1pY3Jvc29mdCBFeGNlbFwiOiBcImV4Y2VsXCIsXG4gIEdlb0pzb246IFwiZ2VvanNvblwiLFxuICBHZW9QYWNrYWdlOiBcImdlb1BhY2thZ2VcIlxufTtcbmNvbnN0IEFwcGVuZE92ZXJ3cml0ZUNsb3VkUHVibGlzaFR5cGVzID0ge1xuICBjc3Y6IFwiQ1NWXCIsXG4gIGV4Y2VsOiBcIk1pY3Jvc29mdCBFeGNlbFwiLFxuICBzaGFwZWZpbGU6IFwiU2hhcGVmaWxlXCIsXG4gIGZnZGI6IFwiRmlsZSBHZW9kYXRhYmFzZVwiLFxuICBnZW9qc29uOiBcIkdlb0pzb25cIixcbiAgZ29vZ2xlc2hlZXRzOiBcIk1pY3Jvc29mdCBFeGNlbFwiXG59O1xuY29uc3QgYXBwZW5kRXh0ZW5zaW9ucyA9IFtcInppcFwiLCBcImNzdlwiLCBcInhsc1wiLCBcInhsc3hcIiwgXCJnZW9qc29uXCIsIFwiZ3BrZ1wiLCBcImpzb25cIl07XG5jb25zdCBhcHBlbmRFeHRlbnNpb25zRm9yRW50ZXJwcmlzZSA9IFtcInppcFwiLCBcImNzdlwiLCBcInhsc1wiLCBcInhsc3hcIl07XG5cbmV4cG9ydCB7IEFwcGVuZE92ZXJ3cml0ZUNsb3VkUHVibGlzaFR5cGVzIGFzIEEsIE5PTkVfVkFMVUUgYXMgTiwgYXBwZW5kRmlsZVR5cGVzIGFzIGEsIEFwcGVuZE92ZXJ3cml0ZVB1Ymxpc2hUeXBlcyBhcyBiLCBhcHBlbmRFeHRlbnNpb25zRm9yRW50ZXJwcmlzZSBhcyBjLCBhcHBlbmRFeHRlbnNpb25zIGFzIGQsIHVpZEZpZWxkcyBhcyB1IH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcbmltcG9ydCB7IGEgYXMgYWRkSXRlbVN0YXRlIH0gZnJvbSAnLi9hZGQtaXRlbS05N2Q1NzdhOS5qcyc7XG5pbXBvcnQgeyBBIGFzIEFwcGVuZE92ZXJ3cml0ZUNsb3VkUHVibGlzaFR5cGVzIH0gZnJvbSAnLi9hcHBlbmQtNThhN2U3YWIuanMnO1xuaW1wb3J0IHsgdSBhcyB1aVN0b3JlU3RhdGUgfSBmcm9tICcuL3VpLWVjZjg2YmJhLmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy1lYjVmN2RjMi5qcyc7XG5pbXBvcnQgeyB0IGFzIHRpbWVvdXQgfSBmcm9tICcuL2Z1bmN0aW9uYWwtYzgyZjVhYjkuanMnO1xuaW1wb3J0IHsgZCBhcyBnZXRDbG91ZE9wdGlvbiwgZSBhcyBnZXRQcm92aWRlck9wdGlvbiwgZiBhcyBnZXREb3dubG9hZFVybCwgaCBhcyBnZXRPbmVEcml2ZURvd25sb2FkVXJsLCBpIGFzIGdldERyb3BCb3hEb3dubG9hZFVybCB9IGZyb20gJy4vaW5kZXgtZWIyMjRkM2MuanMnO1xuaW1wb3J0IHsgcCBhcyBwdWJsaXNoU2VydmljZSB9IGZyb20gJy4vcHVibGlzaC1pdGVtLTgyZmZhN2Y4LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0VG9rZW5Gcm9tUHJvdmlkZXIsIGEgYXMgZ2V0UHVibGlzaFBhcmFtZXRlcnMsIHUgYXMgdXBkYXRlVHlwZUtleXdvcmRzIH0gZnJvbSAnLi9vdmVyd3JpdGUtMzA0OWI3YWYuanMnO1xuaW1wb3J0IHsgeCBhcyB1cGxvYWRGaWxlLCB3IGFzIGdldEl0ZW1TdGF0dXMgfSBmcm9tICcuL2ZlYXR1cmUtbGF5ZXItMzhjZGFlODcuanMnO1xuaW1wb3J0ICcuL2luZGV4LTgxZDU0OGI3LmpzJztcbmltcG9ydCAnLi90aWxlLWxheWVyLTkwYTZiOTAxLmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTlmNjQ4YmVlLmpzJztcbmltcG9ydCAnLi9nZW9jb2RlLTdlYjdjMGRmLmpzJztcbmltcG9ydCAnLi9wcml2aWxlZ2VzLWNjZDVmMzdkLmpzJztcbmltcG9ydCAnLi9wcml2aWxlZ2VzLTM1NTkwZWI0LmpzJztcbmltcG9ydCAnLi9wb3J0YWwtNzljYWFlZmYuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWFhZjMwYmQ2LmpzJztcbmltcG9ydCAnLi9zZXJ2ZXItaXRlbS1mMTIxNTNlNi5qcyc7XG5pbXBvcnQgJy4vaXRlbS1wcm9wZXJ0aWVzLWU2NDEyYTlhLmpzJztcbmltcG9ydCAnLi9pdGVtLXR5cGVzLWI0ZmU4NmFkLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLWQzM2VhMTE0LmpzJztcbmltcG9ydCAnLi9ndWlkLTRmNDE3NmJhLmpzJztcbmltcG9ydCAnLi90aHVtYm5haWwtMGI3YWRmY2QuanMnO1xuaW1wb3J0ICcuL3F1ZXJ5LTRmN2I3ZTRkLmpzJztcbmltcG9ydCAnLi91c2VyLWUzZGVkYzRhLmpzJztcbmltcG9ydCAnLi9hcGktZjc5MzRjZDcuanMnO1xuaW1wb3J0ICcuL2l0ZW0tZDlkNzA0MTYuanMnO1xuaW1wb3J0ICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgJy4vZmVhdHVyZS1sYXllci02OTMwNWE4NS5qcyc7XG5pbXBvcnQgJy4vYWdzLTY4ZDRhZTIwLmpzJztcbmltcG9ydCAnLi91cmwtZjNiODJjYzcuanMnO1xuaW1wb3J0ICcuL3N0b3JhZ2UtZDdmNTgyMmUuanMnO1xuaW1wb3J0ICcuL2ZpbGUtZjM2MTkzZTkuanMnO1xuaW1wb3J0ICcuL3N0b3JlLTMyMTBiNjA0LmpzJztcblxuY29uc3QgYXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kU2VsZWN0Q3NzID0gXCIudGlsZS1zZWxlY3R7ZGlzcGxheTpncmlkO2ZvbnQtc2l6ZToxLjEyNXJlbTttYXJnaW4tcmlnaHQ6MC43NXJlbTttYXJnaW4tbGVmdDowLjc1cmVtO21hcmdpbi10b3A6MXJlbTtwYWRkaW5nLWJvdHRvbTo2cmVtfUBtZWRpYSAobWluLXdpZHRoOiA0ODBweCl7LnRpbGUtc2VsZWN0e2dyaWQtdGVtcGxhdGUtY29sdW1uczpyZXBlYXQoMiwgMWZyKX19LnRpbGUtY2FyZDpob3Zlcntib3gtc2hhZG93OjAgNHB4IDE2cHggMCByZ2JhKDAsIDAsIDAsIDAuMDgpLCAwIDJweCA4cHggMCByZ2JhKDAsIDAsIDAsIDAuMDQpfS5oZWFkZXJ7Zm9udC1zaXplOjFyZW07Zm9udC13ZWlnaHQ6NTAwO21hcmdpbi1sZWZ0OjAuNzVyZW19Lmluc2VydC1vbmx5LWluZm97Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpO2ZvbnQtd2VpZ2h0OjUwMDtmb250LXNpemU6MC43NXJlbTttYXJnaW4tbGVmdDowLjc1cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNBcHBlbmRTZWxlY3QgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1VcGRhdGVQYWdlXCIsIDcpO1xuICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWRcIiwgNyk7XG4gICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJ3b3JrZmxvd0NvbXBsZXRlXCIsIDcpO1xuICAgIHRoaXMuaW5zZXJ0T25seSA9IGZhbHNlO1xuICAgIHRoaXMuaXNDbG91ZEl0ZW0gPSBmYWxzZTtcbiAgICB0aGlzLmlzVXJsSXRlbSA9IGZhbHNlO1xuICAgIHRoaXMub3B0aW9ucyA9IHtcbiAgICAgIGFkZDoge1xuICAgICAgICBpY29uOiBcImFkZC1mZWF0dXJlc1wiLFxuICAgICAgICB1cGRhdGVUeXBlOiBcImFkZFwiLFxuICAgICAgICBoaWRkZW46IGZhbHNlLFxuICAgICAgICBkaXNhYmxlZDogZmFsc2VcbiAgICAgIH0sXG4gICAgICB1cGRhdGU6IHtcbiAgICAgICAgaWNvbjogXCJ1cGRhdGUtZmVhdHVyZXNcIixcbiAgICAgICAgdXBkYXRlVHlwZTogXCJ1cGRhdGVcIixcbiAgICAgICAgaGlkZGVuOiBmYWxzZSxcbiAgICAgICAgZGlzYWJsZWQ6IGZhbHNlXG4gICAgICB9LFxuICAgICAgdXBzZXJ0OiB7XG4gICAgICAgIGljb246IFwiYWRkLWFuZC11cGRhdGUtZmVhdHVyZXNcIixcbiAgICAgICAgdXBkYXRlVHlwZTogXCJ1cHNlcnRcIixcbiAgICAgICAgaGlkZGVuOiBmYWxzZSxcbiAgICAgICAgZGlzYWJsZWQ6IGZhbHNlXG4gICAgICB9LFxuICAgICAgb3ZlcndyaXRlOiB7XG4gICAgICAgIGljb246IFwib3ZlcndyaXRlLWZlYXR1cmVzXCIsXG4gICAgICAgIHVwZGF0ZVR5cGU6IFwib3ZlcndyaXRlXCIsXG4gICAgICAgIGhpZGRlbjogZmFsc2UsXG4gICAgICAgIGRpc2FibGVkOiBmYWxzZVxuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5zZWxlY3RlZCA9IFwiYWRkXCI7XG4gICAgdGhpcy5lcnJvciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmxvYWRlclR5cGUgPSBcImluZGV0ZXJtaW5hdGVcIjtcbiAgICB0aGlzLmxvYWRlck1lc3NhZ2UgPSB1bmRlZmluZWQ7XG4gIH1cbiAgaGFuZGxlTmV4dCgpIHtcbiAgICBsZXQgbmV4dFBhZ2U7XG4gICAgY29uc3QgeyBpdGVtLCBzZWxlY3RlZCwgbGF5ZXIsIGxheWVySWQsIGFwcGVuZExheWVyRW50cnkgfSA9IHRoaXM7XG4gICAgYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9IHNlbGVjdGVkO1xuICAgIGlmICghYXBwZW5kTGF5ZXJFbnRyeSAmJiBzZWxlY3RlZCAhPT0gXCJvdmVyd3JpdGVcIiAmJiBpdGVtLmxheWVycy5sZW5ndGggPiAxKSB7XG4gICAgICAvL2ZlYXR1cmUgbGF5ZXIgaXMgbXVsdGktbGF5ZXJlZFxuICAgICAgbmV4dFBhZ2UgPSBcImFwcGVuZFNlbGVjdExheWVyXCI7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgaWYgKGl0ZW0uY2xvdWRQcm92aWRlckluZm8gJiYgc2VsZWN0ZWQgPT09IFwib3ZlcndyaXRlXCIpIHtcbiAgICAgICAgYWRkSXRlbVN0YXRlLm5ld0l0ZW1Nb2RlID0gXCJmaWxlXCI7XG4gICAgICAgIGlmIChpdGVtLmNsb3VkUHJvdmlkZXJJbmZvLmNsb3VkUHJvdmlkZXIpIHtcbiAgICAgICAgICBjb25zdCB7IGlkLCBtaW1lVHlwZSwgY2xvdWRQcm92aWRlciB9ID0gaXRlbS5jbG91ZFByb3ZpZGVySW5mbztcbiAgICAgICAgICB0aGlzLmFzc2lnbkNsb3VkSXRlbVN0b3JlKGl0ZW0uY2xvdWRQcm92aWRlckluZm8pO1xuICAgICAgICAgIHRoaXMuaGFuZGxlT3ZlcndyaXRlVVJMKGl0ZW0sIGlkLCBtaW1lVHlwZSwgY2xvdWRQcm92aWRlcik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHRoaXMuaGFuZGxlT3ZlcndyaXRlVVJMKGl0ZW0pO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSBpZiAoYXBwZW5kTGF5ZXJFbnRyeSkge1xuICAgICAgICBsZXQgc291cmNlRGF0YUxheWVyID0gbGF5ZXIgIT09IG51bGwgJiYgbGF5ZXIgIT09IHZvaWQgMCA/IGxheWVyIDogaXRlbS5sYXllcnNbbGF5ZXJJZF07XG4gICAgICAgIGlmICghc291cmNlRGF0YUxheWVyKSB7XG4gICAgICAgICAgLy9TVEdMIGl0ZW1zIHJldHVybiBhIGxheWVySWQgdGhhdCBpcyBncmVhdGVyIHRoYW4gbGVuZ3RoIG9mIHBvc3NpYmxlIGxheWVyIGluZGV4ZXNcbiAgICAgICAgICBzb3VyY2VEYXRhTGF5ZXIgPSBpdGVtLmxheWVyc1swXTtcbiAgICAgICAgfVxuICAgICAgICBhZGRJdGVtU3RhdGUuc291cmNlRGF0YUxheWVyID0gc291cmNlRGF0YUxheWVyO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5zb3VyY2VEYXRhTGF5ZXIgPSBpdGVtLmxheWVyc1swXTtcbiAgICAgIH1cbiAgICAgIG5leHRQYWdlID0gXCJhcHBlbmRVcGxvYWRcIjtcbiAgICB9XG4gICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KG5leHRQYWdlKTtcbiAgfVxuICBjcmVhdGVPcHRpb25zKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgY29uc3QgaXRlbSA9IHRoaXMuaXRlbTtcbiAgICBjb25zdCBub1NvdXJjZURhdGEgPSAhaXRlbS5zb3VyY2VEYXRhICYmICFpdGVtLmNsb3VkUHJvdmlkZXJJbmZvO1xuICAgIGNvbnN0IGlzR2VvUGFja2FnZUFuZEVudGVycHJpc2UgPSAoKF9hID0gaXRlbS5zb3VyY2VEYXRhKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgPT09IFwiR2VvUGFja2FnZVwiICYmIGNvbmZpZ1N0YXRlLnBvcnRhbC5pc1BvcnRhbDtcbiAgICBjb25zdCBjYXBhYmlsaXRpZXMgPSBjb25maWdTdGF0ZS5wb3J0YWwuaXNQb3J0YWwgJiYgIWl0ZW0uaXNTRFNcbiAgICAgID8gaXRlbS5zZXJ2aWNlSW5mby5jYXBhYmlsaXRpZXMgLy8gcG9ydGFsIGhvc3RlZCBmZWF0dXJlIGxheWVyIHcvbyAncHJvdmlkZXJTRFMnIHR5cGVLZXl3b3JkXG4gICAgICA6IGl0ZW0uYWRtaW5TZXJ2aWNlSW5mby5jYXBhYmlsaXRpZXM7IC8vIGV2ZXJ5IG90aGVyIGhvc3RlZCBmZWF0dXJlIGxheWVyIGltcGwsXG4gICAgaWYgKGNhcGFiaWxpdGllcy5pbmRleE9mKFwiQ2hhbmdlVHJhY2tpbmdcIikgIT09IC0xIHx8IGl0ZW0uc2VydmljZUluZm8uc3luY0VuYWJsZWQpIHtcbiAgICAgIHRoaXMuaW5zZXJ0T25seSA9IHRydWU7XG4gICAgICB0aGlzLm9wdGlvbnMub3ZlcndyaXRlLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIHRoaXMub3B0aW9ucy51cGRhdGUuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgdGhpcy5vcHRpb25zLnVwc2VydC5kaXNhYmxlZCA9IHRydWU7XG4gICAgfSAvL2luc2VydCBvbmx5IHdoZW4gY2hhbmdlIHRyYWNraW5nIE9SIHN5bmMgZW5hYmxlZFxuICAgIGlmICh0aGlzLmFwcGVuZExheWVyRW50cnkgfHxcbiAgICAgIGlzR2VvUGFja2FnZUFuZEVudGVycHJpc2UgfHxcbiAgICAgICgoX2IgPSBpdGVtLnNvdXJjZURhdGEpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50eXBlKSA9PT0gXCJTZXJ2aWNlIERlZmluaXRpb25cIiB8fFxuICAgICAgbm9Tb3VyY2VEYXRhKSB7XG4gICAgICB0aGlzLm9wdGlvbnMub3ZlcndyaXRlLmRpc2FibGVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgY3JlYXRlT3ZlcndyaXRlTmV4dFRleHQoKSB7XG4gICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICBjYXNlIHRoaXMuaXNDbG91ZEl0ZW06XG4gICAgICAgIHJldHVybiBcInNpZ25JbkFuZE92ZXJ3cml0ZVwiO1xuICAgICAgY2FzZSB0aGlzLmlzVXJsSXRlbTpcbiAgICAgICAgcmV0dXJuIFwib3ZlcndyaXRlQW5kQ29tcGxldGVcIjtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBcIm5leHRcIjtcbiAgICB9XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2YsIF9nLCBfaCwgX2osIF9rLCBfbDtcbiAgICB0aGlzLnNlbGVjdGVkID0gYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiB8fCBcImFkZFwiO1xuICAgIHRoaXMuaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZFNlbGVjdDtcbiAgICB0aGlzLml0ZW0gPSBhZGRJdGVtU3RhdGUuZXhpc3RpbmdJdGVtO1xuICAgIHRoaXMuYXBwZW5kTGF5ZXJFbnRyeSA9IGFkZEl0ZW1TdGF0ZS5sYXllcklkICE9PSB1bmRlZmluZWQgfHwgISFhZGRJdGVtU3RhdGUuc3VibGF5ZXI7XG4gICAgdGhpcy5sYXllcklkID0gYWRkSXRlbVN0YXRlLmxheWVySWQ7XG4gICAgdGhpcy5sYXllciA9IGFkZEl0ZW1TdGF0ZS5zdWJsYXllcjtcbiAgICBhZGRJdGVtU3RhdGUuaWQgPSBudWxsOyAvL1NldCBleGlzdGluZ0l0ZW0gdG8gYmUgbnVsbCBzbyB0aGF0IG9uIGNsb3NlLCBpdCBkb2VzIG5vdCBkZWxldGUgdGhlIEhGTCBpdGVtXG4gICAgYWRkSXRlbVN0YXRlLmRhdGVGaWVsZHNUaW1lUmVmZXJlbmNlID0gKF9nID0gKF9jID0gKF9iID0gKF9hID0gdGhpcy5pdGVtKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucHVibGlzaFBhcmFtZXRlcnMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5kYXRlRmllbGRzVGltZVJlZmVyZW5jZSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogKF9mID0gKF9lID0gKF9kID0gdGhpcy5pdGVtKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QucHVibGlzaFBhcmFtZXRlcnMpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5sYXllcnMpID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZlswXS5kYXRlRmllbGRzVGltZVJlZmVyZW5jZSkgIT09IG51bGwgJiYgX2cgIT09IHZvaWQgMCA/IF9nIDogdGhpcy5pdGVtLmxheWVyc1swXS5kYXRlRmllbGRzVGltZVJlZmVyZW5jZTtcbiAgICB0aGlzLmlzVXJsSXRlbSA9ICEhKChfaiA9IChfaCA9IHRoaXMuaXRlbSkgPT09IG51bGwgfHwgX2ggPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9oLmNsb3VkUHJvdmlkZXJJbmZvKSA9PT0gbnVsbCB8fCBfaiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2oudXJsKTtcbiAgICB0aGlzLmlzQ2xvdWRJdGVtID0gISEoKF9sID0gKF9rID0gdGhpcy5pdGVtKSA9PT0gbnVsbCB8fCBfayA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2suY2xvdWRQcm92aWRlckluZm8pID09PSBudWxsIHx8IF9sID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfbC5jbG91ZFByb3ZpZGVyKTtcbiAgICB0aGlzLmNyZWF0ZU9wdGlvbnMoKTtcbiAgfVxuICBhc3NpZ25DbG91ZEl0ZW1TdG9yZShjbG91ZFByb3ZpZGVySW5mbykge1xuICAgIGNvbnN0IHsgY2xvdWRQcm92aWRlciwgaWQsIG1pbWVUeXBlLCBjbG91ZERyaXZlRmlsZU5hbWUsIGNsb3VkRmlsZVR5cGUsIHppcEl0ZW1UeXBlIH0gPSBjbG91ZFByb3ZpZGVySW5mbztcbiAgICBhZGRJdGVtU3RhdGUuY2xvdWRQcm92aWRlciA9IGdldENsb3VkT3B0aW9uKGNsb3VkUHJvdmlkZXIpO1xuICAgIGFkZEl0ZW1TdGF0ZS5jbG91ZFByb3ZpZGVyUmVzb3VyY2UgPSB7XG4gICAgICBjbG91ZFByb3ZpZGVyLFxuICAgICAgaWQsXG4gICAgICBtaW1lVHlwZSxcbiAgICAgIGNsb3VkRHJpdmVGaWxlTmFtZSxcbiAgICAgIGNsb3VkRmlsZVR5cGUsXG4gICAgICB6aXBJdGVtVHlwZVxuICAgIH07XG4gIH1cbiAgYXN5bmMgc2V0VXBDbG91ZChjbG91ZFByb3ZpZGVyKSB7XG4gICAgY29uc3QgcHJvdmlkZXIgPSBnZXRQcm92aWRlck9wdGlvbihjbG91ZFByb3ZpZGVyKTtcbiAgICBjb25zdCB7IHJlc3VsdCwgZXJyb3IgfSA9IGF3YWl0IGdldFRva2VuRnJvbVByb3ZpZGVyKHByb3ZpZGVyKTtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHRoaXMuaGFuZGxlRXJyb3IoKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG4gIGFzeW5jIGhhbmRsZU92ZXJ3cml0ZVVSTChpdGVtLCBpZCwgbWltZVR5cGUsIGNsb3VkUHJvdmlkZXIpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZiwgX2c7XG4gICAgLy9mb3IgQ1NWLCBHZW9KU09OIHVybC1tYWRlIGl0ZW1zXG4gICAgbGV0IGRhdGFVcmwsIHR5cGUsIHR5cGVLZXl3b3JkcztcbiAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZC5hcHBlbmRMb2FkaW5nTWVzc2FnZXMub3ZlcndyaXRpbmc7XG4gICAgY29uc3QgY2xvdWRQcm92aWRlckluZm8gPSBpdGVtLmNsb3VkUHJvdmlkZXJJbmZvO1xuICAgIGFkZEl0ZW1TdGF0ZS5maWxlTmFtZSA9IGl0ZW0udGl0bGU7XG4gICAgYWRkSXRlbVN0YXRlLnRpdGxlID0gaXRlbS50aXRsZTtcbiAgICBpZiAoY2xvdWRQcm92aWRlckluZm8uY2xvdWRQcm92aWRlcikge1xuICAgICAgdHlwZSA9IEFwcGVuZE92ZXJ3cml0ZUNsb3VkUHVibGlzaFR5cGVzW21pbWVUeXBlXTtcbiAgICAgIHR5cGVLZXl3b3JkcyA9IFthZGRJdGVtU3RhdGUudHlwZV07XG4gICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IHRoaXMuc2V0VXBDbG91ZChjbG91ZFByb3ZpZGVyKTtcbiAgICAgIGF3YWl0IHRpbWVvdXQoMjAwKTtcbiAgICAgIHN3aXRjaCAoY2xvdWRQcm92aWRlcikge1xuICAgICAgICBjYXNlIFwiZ29vZ2xlQ29ubmVjdFwiOlxuICAgICAgICAgIGRhdGFVcmwgPSBnZXREb3dubG9hZFVybChpZCwgbWltZVR5cGUsIHRva2VuKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImRyb3BCb3hDb25uZWN0XCI6XG4gICAgICAgICAgZGF0YVVybCA9IGdldERyb3BCb3hEb3dubG9hZFVybChpZCwgdG9rZW4pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwib25lRHJpdmVDb25uZWN0XCI6XG4gICAgICAgICAgZGF0YVVybCA9IGdldE9uZURyaXZlRG93bmxvYWRVcmwoaWQsIHRva2VuKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBpZiAoY2xvdWRQcm92aWRlckluZm8ubWltZVR5cGUgPT09IFwiZ2VvanNvblwiKSB7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5nZW9KU09OUmVzb3VyY2UgPSB7XG4gICAgICAgICAgZmlsZU5hbWU6IGNsb3VkUHJvdmlkZXJJbmZvLmZpbGVOYW1lLFxuICAgICAgICAgIHVybDogY2xvdWRQcm92aWRlckluZm8udXJsLFxuICAgICAgICAgIG1pbWVUeXBlOiBjbG91ZFByb3ZpZGVySW5mby5taW1lVHlwZVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5jc3ZSZXNvdXJjZSA9IHtcbiAgICAgICAgICBmaWxlTmFtZTogY2xvdWRQcm92aWRlckluZm8uZmlsZU5hbWUsXG4gICAgICAgICAgdXJsOiBjbG91ZFByb3ZpZGVySW5mby51cmwsXG4gICAgICAgICAgbWltZVR5cGU6IGNsb3VkUHJvdmlkZXJJbmZvLm1pbWVUeXBlXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBjb25zdCByZXNvdXJjZSA9IChfYSA9IGFkZEl0ZW1TdGF0ZS5jc3ZSZXNvdXJjZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogYWRkSXRlbVN0YXRlLmdlb0pTT05SZXNvdXJjZTtcbiAgICAgIHR5cGUgPSBBcHBlbmRPdmVyd3JpdGVDbG91ZFB1Ymxpc2hUeXBlc1tyZXNvdXJjZS5taW1lVHlwZV07XG4gICAgICBkYXRhVXJsID0gcmVzb3VyY2UudXJsO1xuICAgICAgdHlwZUtleXdvcmRzID0gW3R5cGVdO1xuICAgIH1cbiAgICBhZGRJdGVtU3RhdGUuZGF0YVVybCA9IGRhdGFVcmw7XG4gICAgYWRkSXRlbVN0YXRlLnR5cGUgPSB0eXBlO1xuICAgIGFkZEl0ZW1TdGF0ZS50eXBlS2V5d29yZHMgPSB0eXBlS2V5d29yZHM7XG4gICAgYWRkSXRlbVN0YXRlLm92ZXJ3cml0ZSA9IHRydWU7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkLmVtaXQoZmFsc2UpO1xuICAgICAgYXdhaXQgdXBsb2FkRmlsZSgpO1xuICAgICAgY29uc3Qgb3ZlcndyaXRlUHVibGlzaFBhcmFtZXRlcnMgPSBhd2FpdCBnZXRQdWJsaXNoUGFyYW1ldGVycyhpdGVtLCBjb25maWdTdGF0ZS5wb3J0YWwsIGNvbmZpZ1N0YXRlLnVzZXIsIGFkZEl0ZW1TdGF0ZS5pZCk7XG4gICAgICBjb25zdCBwdWJsaXNoUmVzcG9uc2UgPSBhd2FpdCBwdWJsaXNoU2VydmljZSh7XG4gICAgICAgIGl0ZW1JZDogKF9jID0gKF9iID0gaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLnNvdXJjZURhdGEpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5pZCkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogaXRlbS5pZCxcbiAgICAgICAgdXNlcjogY29uZmlnU3RhdGUudXNlcixcbiAgICAgICAgdGl0bGU6IChpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0udGl0bGUpIHx8IFwiXCIsXG4gICAgICAgIGl0ZW1Pd25lclVybDogaXRlbS5pdGVtT3duZXIudXNlckNvbnRlbnRVcmwgLy8gISBVc2UgZmV0Y2hVc2VyIGlmIGl0ZW1Pd25lciBpcyBub3QgYXZhaWxhYmxlXG4gICAgICB9LCBvdmVyd3JpdGVQdWJsaXNoUGFyYW1ldGVycyk7XG4gICAgICBhd2FpdCB1cGRhdGVUeXBlS2V5d29yZHMob3ZlcndyaXRlUHVibGlzaFBhcmFtZXRlcnMucHVibGlzaFBhcmFtZXRlcnMsIGl0ZW0sIChfZSA9IChfZCA9IHB1Ymxpc2hSZXNwb25zZS5yZXN1bHQpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5zZXJ2aWNlcykgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lWzBdLnNlcnZpY2VJdGVtSWQpO1xuICAgICAgYXdhaXQgdGhpcy5jaGVja1N0YXR1cyh7IGl0ZW1JZDogaXRlbS5pZCwgam9iSWQ6IChfZyA9IChfZiA9IHB1Ymxpc2hSZXNwb25zZS5yZXN1bHQpID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZi5zZXJ2aWNlcykgPT09IG51bGwgfHwgX2cgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9nWzBdLmpvYklkIH0sIHB1Ymxpc2hSZXNwb25zZSA9PT0gbnVsbCB8fCBwdWJsaXNoUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hSZXNwb25zZS5yZXN1bHQpO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMuaGFuZGxlRXJyb3IoKTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgY2hlY2tTdGF0dXMoam9iSW5mbywgcHVibGlzaFJlc3BvbnNlKSB7XG4gICAgdmFyIF9hO1xuICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZC5hcHBlbmRMb2FkaW5nTWVzc2FnZXMub3ZlcndyaXRpbmc7XG4gICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdCh0cnVlKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGdldEl0ZW1TdGF0dXMoam9iSW5mby5pdGVtSWQsIHsgam9iSWQ6IGpvYkluZm8uam9iSWQgfSk7IC8vY2hlY2tpbmcgdXBkYXRlIG9mIHNvdXJjZSBkYXRhJ3Mgam9iLlxuICAgIGNvbnN0IG92ZXJ3cml0ZVN0YXR1cyA9IHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5zdGF0dXM7XG4gICAgY29uc3QgZW1pdFBheWxvYWQgPSBPYmplY3QuYXNzaWduKHsgaWQ6IChfYSA9IHB1Ymxpc2hSZXNwb25zZSA9PT0gbnVsbCB8fCBwdWJsaXNoUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hSZXNwb25zZS5zZXJ2aWNlcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdLnNlcnZpY2VJdGVtSWQsIGl0ZW06IE9iamVjdC5hc3NpZ24oe30sIGFkZEl0ZW1TdGF0ZSksIG92ZXJ3cml0ZVN0YXR1cywgYXBwZW5kVHlwZTogYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiB9LCBwdWJsaXNoUmVzcG9uc2UpO1xuICAgIGlmICgocmVzcG9uc2UgPT09IG51bGwgfHwgcmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3BvbnNlLnN0YXR1cy50b0xvd2VyQ2FzZSgpKSA9PT0gXCJjb21wbGV0ZWRcIikge1xuICAgICAgZW1pdFBheWxvYWQub3ZlcndyaXRlU3RhdHVzID0gcmVzcG9uc2UgPT09IG51bGwgfHwgcmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3BvbnNlLnN0YXR1cztcbiAgICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZS5lbWl0KGVtaXRQYXlsb2FkKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBlbHNlIGlmICgocmVzcG9uc2UgPT09IG51bGwgfHwgcmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3BvbnNlLnN0YXR1cy50b0xvd2VyQ2FzZSgpKSA9PT0gXCJmYWlsZWRcIikge1xuICAgICAgdGhpcy5oYW5kbGVFcnJvcigpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cbiAgaGFuZGxlRXJyb3IoKSB7XG4gICAgdWlTdG9yZVN0YXRlLm5leHRUZXh0ID0gXCJuZXh0XCI7XG4gICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdCh0cnVlKTtcbiAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmVycm9yID0ge1xuICAgICAgdGl0bGU6IHVpU3RvcmVTdGF0ZS5pMThuLmVycm9yLFxuICAgICAgZGVzY3JpcHRpb246IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZFVwbG9hZC5lcnJvcnMuZXJyb3JXaGlsZVVwbG9hZFxuICAgIH07XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgaTE4biwgb3B0aW9ucywgaW5zZXJ0T25seSwgZXJyb3IsIGxvYWRlclR5cGUsIGxvYWRpbmcsIGxvYWRlck1lc3NhZ2UgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IHsgXCJvdmVyZmxvdy1oaWRkZW5cIjogbG9hZGluZyB9IH0sIGgoXCJhcmNnaXMtbmV3LWl0ZW0tbG9hZGVyXCIsIHsgdHlwZTogbG9hZGVyVHlwZSwgYWN0aXZlOiBsb2FkaW5nLCB0ZXh0OiBsb2FkZXJNZXNzYWdlIH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaGVhZGVyXCIgfSwgaW5zZXJ0T25seSA/IGkxOG4uaW5zZXJ0T25seUVuYWJsZWQgOiBpMThuLmNob29zZVVwZGF0ZSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJ0aWxlLXNlbGVjdFwiIH0sIE9iamVjdC5rZXlzKG9wdGlvbnMpLm1hcCgoa2V5KSA9PiB7XG4gICAgICBjb25zdCB7IGljb24sIGhpZGRlbiwgZGlzYWJsZWQgfSA9IG9wdGlvbnNba2V5XTtcbiAgICAgIHJldHVybiAoaChcImNhbGNpdGUtdGlsZS1zZWxlY3RcIiwgeyBrZXk6IGtleSwgY2hlY2tlZDogdGhpcy5zZWxlY3RlZCA9PT0ga2V5LCBoZWFkaW5nOiBpMThuLm9wdGlvbnNba2V5XS50aXRsZSwgaWNvbjogaWNvbiwgbmFtZTogXCJhcHBlbmQtc2VsZWN0LXVwZGF0ZVwiLCB3aWR0aDogXCJmdWxsXCIsIHR5cGU6IFwicmFkaW9cIiwgdmFsdWU6IGtleSwgY2xhc3M6IFwidGlsZS1jYXJkXCIsIGhpZGRlbjogaGlkZGVuLCBkaXNhYmxlZDogZGlzYWJsZWQsIGlucHV0RW5hYmxlZDogdHJ1ZSwgb25DYWxjaXRlVGlsZVNlbGVjdENoYW5nZTogKGUpID0+IHtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gZS50YXJnZXQudmFsdWU7XG4gICAgICAgICAgdWlTdG9yZVN0YXRlLm5leHRUZXh0ID1cbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPT09IFwib3ZlcndyaXRlXCIgPyB0aGlzLmNyZWF0ZU92ZXJ3cml0ZU5leHRUZXh0KCkgOiBcIm5leHRcIjtcbiAgICAgICAgfSB9KSk7XG4gICAgfSkpLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWFsZXJ0XCIsIHsgaGVhZGluZzogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLnRpdGxlLCBkZXNjcmlwdGlvbjogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmRlc2NyaXB0aW9uLCBhY3RpdmU6ICEhZXJyb3IsIG9uQWxlcnREaXNtaXNzOiAoKSA9PiAodGhpcy5lcnJvciA9IG51bGwpIH0pKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZFNlbGVjdC5zdHlsZSA9IGFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZFNlbGVjdENzcztcblxuZXhwb3J0IHsgQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kU2VsZWN0IGFzIGFyY2dpc19uZXdfaXRlbV9wYWdlc19hcHBlbmRfc2VsZWN0IH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=