"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-abad1b"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-floor-configuration_11.entry.js":
/*!********************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-floor-configuration_11.entry.js ***!
  \********************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_floor_configuration: () => (/* binding */ ArcgisFloorConfiguration),
/* harmony export */   arcgis_floor_configuration_add_layers: () => (/* binding */ ArcgisFloorAddLayers),
/* harmony export */   arcgis_floor_configuration_add_layers_flow: () => (/* binding */ ArcgisFloorAddLayersFlow),
/* harmony export */   arcgis_floor_configuration_additional_layers: () => (/* binding */ ArcgisFloorAdditionalLayers),
/* harmony export */   arcgis_floor_configuration_field_list: () => (/* binding */ ArcgisFieldList),
/* harmony export */   arcgis_floor_configuration_field_picker: () => (/* binding */ ArcgisFloorFieldPicker),
/* harmony export */   arcgis_floor_configuration_field_select: () => (/* binding */ ArcgisFloorConfigurationFieldSelect),
/* harmony export */   arcgis_floor_configuration_layer_list: () => (/* binding */ ArcgisLayerList),
/* harmony export */   arcgis_floor_configuration_layer_picker: () => (/* binding */ ArcgisLayerPicker),
/* harmony export */   arcgis_floor_configuration_replace_field: () => (/* binding */ ArcgisFloorReplaceField),
/* harmony export */   arcgis_floor_configuration_select_fields: () => (/* binding */ ArcgisFloorSelectFields)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */






const CSS = {
  container: "container",
  section: "section",
  title: "title",
  missing: "missing"
};

const floorInfoSchema = {
  facilityLayer: {
    facilityIdField: "FACILITY_ID",
    siteIdField: "SITE_ID",
    nameField: "NAME"
  },
  levelLayer: {
    levelIdField: "LEVEL_ID",
    facilityIdField: "FACILITY_ID",
    longNameField: "NAME",
    shortNameField: "NAME_SHORT",
    levelNumberField: "LEVEL_NUMBER",
    verticalOrderField: "VERTICAL_ORDER"
  },
  siteLayer: {
    siteIdField: "SITE_ID",
    nameField: "NAME"
  }
};
let tempFloorInfo;
const getMapFloorInfo = (view) => {
  var _a;
  const map = view === null || view === void 0 ? void 0 : view.map;
  tempFloorInfo = tempFloorInfo || (map === null || map === void 0 ? void 0 : map.floorInfo) || Object.assign({}, floorInfoSchema);
  // SiteLayer is optional, but might be specified without a
  // layerId if so we should remove it so the schema can still validate
  tempFloorInfo.siteLayer = ((_a = tempFloorInfo === null || tempFloorInfo === void 0 ? void 0 : tempFloorInfo.siteLayer) === null || _a === void 0 ? void 0 : _a.layerId) ? tempFloorInfo.siteLayer : null;
  return tempFloorInfo;
};
const setMapFloorInfo = (view) => {
  const map = view === null || view === void 0 ? void 0 : view.map;
  const mapFloorInfo = getMapFloorInfo(view);
  if (map && validateFloorInfo(mapFloorInfo)) {
    map.set("floorInfo", mapFloorInfo);
  }
  else {
    removeMapFloorInfo(view);
  }
};
const updateMapFloorInfo = (floorInfoProps, view) => {
  const mapFloorInfo = getMapFloorInfo(view);
  const { name } = floorInfoProps;
  const layer = floorInfoProps.layer;
  const isSublayer = !!(layer === null || layer === void 0 ? void 0 : layer.layer);
  if (layer) {
    mapFloorInfo[name] = Object.assign({}, floorInfoSchema[name]);
    mapFloorInfo[name].layerId = isSublayer ? layer.layer.id : layer.id;
    mapFloorInfo[name].sublayerId = isSublayer ? layer.id : undefined;
  }
  else {
    mapFloorInfo[name] = undefined;
  }
  setMapFloorInfo(view);
};
const removeMapFloorInfo = (view) => {
  const map = view === null || view === void 0 ? void 0 : view.map;
  if (map) {
    map.floorInfo = null;
  }
};
const validateFloorInfo = (mapFloorInfo) => {
  var _a, _b;
  return ((_a = mapFloorInfo === null || mapFloorInfo === void 0 ? void 0 : mapFloorInfo.facilityLayer) === null || _a === void 0 ? void 0 : _a.layerId) &&
    ((_b = mapFloorInfo === null || mapFloorInfo === void 0 ? void 0 : mapFloorInfo.levelLayer) === null || _b === void 0 ? void 0 : _b.layerId) &&
    (!(mapFloorInfo === null || mapFloorInfo === void 0 ? void 0 : mapFloorInfo.siteLayer) || (mapFloorInfo === null || mapFloorInfo === void 0 ? void 0 : mapFloorInfo.siteLayer.layerId))
    ? true
    : false;
};
const getRequiredFields = (name) => {
  const schema = floorInfoSchema[name];
  return Object.values(schema);
};
const getNonFloorLayers = (view) => {
  const { map } = view;
  const { allLayers } = map;
  let nonFloorLayers = [];
  allLayers.forEach((layer) => {
    const { type, floorInfo } = layer;
    if (type === "map-image") {
      const { allSublayers } = layer;
      nonFloorLayers = nonFloorLayers.concat(allSublayers.filter((subLayer) => subLayer.fieldsIndex && !(subLayer === null || subLayer === void 0 ? void 0 : subLayer.floorInfo)).toArray());
    }
    else if (!floorInfo && type === "feature") {
      nonFloorLayers.push(layer);
    }
  });
  return nonFloorLayers;
};
const getCompatibleLayers = async (view) => {
  const { map } = view;
  const { allLayers } = map;
  const promises = allLayers
    .map(async (layer) => await loadAll(layer))
    .filter((layer) => (layer === null || layer === void 0 ? void 0 : layer.loadStatus) !== "failed");
  // Make sure all layers and sublayers are loaded
  // before checking them for compatibility
  const validLayers = await Promise.all(promises);
  let compatibleLayers = [];
  validLayers.forEach((layer) => {
    const { type, geometryType } = layer;
    if (type === "map-image") {
      const { allSublayers } = layer;
      compatibleLayers = compatibleLayers.concat(allSublayers
        .filter((subLayer) => { var _a; return subLayer.fieldsIndex && ((_a = subLayer.sourceJSON) === null || _a === void 0 ? void 0 : _a.geometryType) === "esriGeometryPolygon"; })
        .toArray());
    }
    else if (type === "feature" && geometryType === "polygon") {
      compatibleLayers.push(layer);
    }
  });
  return compatibleLayers;
};
const loadAll = (layer) => {
  try {
    layer.loadAll ? layer.loadAll() : layer.load();
  }
  catch (_a) { }
  return layer;
};
const getFloorLayer = (name, view) => {
  var _a, _b;
  const map = view.map;
  const layers = map.allLayers;
  const floorInfo = getMapFloorInfo(view);
  const layerId = (_a = floorInfo === null || floorInfo === void 0 ? void 0 : floorInfo[name]) === null || _a === void 0 ? void 0 : _a.layerId;
  const sublayerId = (_b = floorInfo === null || floorInfo === void 0 ? void 0 : floorInfo[name]) === null || _b === void 0 ? void 0 : _b.sublayerId;
  let floorLayer = layerId ? layers === null || layers === void 0 ? void 0 : layers.find((layer) => layer.id === layerId) : null;
  if ((floorLayer === null || floorLayer === void 0 ? void 0 : floorLayer.type) === "map-image") {
    floorLayer = floorLayer.allSublayers.find((sublayer) => sublayer.id === sublayerId);
  }
  return floorLayer;
};
const setFloorInfo = (element) => {
  let { layer, field } = element;
  if ((element === null || element === void 0 ? void 0 : element.localName) === "arcgis-field-list") {
    field = element.selection.values().next().value;
  }
  const floorInfo = layer.floorInfo || {};
  floorInfo.floorField = field.name;
  layer.set("floorInfo", floorInfo);
};

const ArcgisFloorConfiguration = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.floorInfoChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "floorInfoChange", 7);
    this.view = undefined;
    this.layer = undefined;
    this.open = true;
    this.disabled = false;
  }
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  async componentWillLoad() {
    const [strings] = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement);
    this.strings = strings;
    const { view } = this;
    this.props = {
      view,
      strings
    };
    this.disabled = this.disabled || (await this.getDisabled());
  }
  async componentDidLoad() {
    const [intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/intl"]);
    this.intl = intl;
    this.intl.setLocale(document.documentElement.lang);
  }
  //--------------------------------------------------------------------------
  //
  //  Event Listeners
  //
  //--------------------------------------------------------------------------
  addMapFloorInfo() {
    setMapFloorInfo(this.view);
    this.floorInfoChange.emit();
  }
  removeFloorInfo() {
    removeMapFloorInfo(this.view);
    this.floorInfoChange.emit();
  }
  updateFloorInfo(props) {
    updateMapFloorInfo(props, this.view);
    this.floorInfoChange.emit();
  }
  disableContainer(e) {
    const { detail } = e;
    const container = this.hostElement.closest("calcite-flow-item");
    if (container) {
      container.disabled = detail;
    }
  }
  // --------------------------------------------------------------------------
  //
  //  Private methods
  //
  // --------------------------------------------------------------------------
  closeAllLayerPickers() {
    const pickers = document.querySelectorAll("arcgis-floor-configuration-layer-picker");
    pickers.forEach((picker) => (picker.open = false));
  }
  async getDisabled() {
    const mapView = this.view;
    const compatibleLayers = await getCompatibleLayers(mapView);
    const sections = ["facilityLayer", "levelLayer"];
    // For each floorInfoSection we need to check that each polygon layer in the map
    // has the required fields in order to enable this component
    const supportedSections = sections.filter((sectionName) => {
      var _a;
      return (_a = compatibleLayers.filter((layer) => this.hasRequiredFields(layer, getRequiredFields(sectionName)))) === null || _a === void 0 ? void 0 : _a.length;
    });
    return !(supportedSections === null || supportedSections === void 0 ? void 0 : supportedSections.length);
  }
  hasRequiredFields(layer, requiredFields) {
    if (layer) {
      const { fieldsIndex } = layer;
      return ((fieldsIndex && requiredFields.every((fieldName) => !!fieldsIndex.get(fieldName))) || false);
    }
    else {
      return false;
    }
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    const { strings, open, disabled } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: CSS.container, heading: strings.heading, collapsible: true, disabled: disabled, open: open && !disabled }, this.renderFloorConfiguration())));
  }
  renderFloorConfiguration() {
    const { strings, view } = this;
    const map = view.map;
    const open = (map === null || map === void 0 ? void 0 : map.floorInfo) ? true : false;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block-section", { text: strings.enable, open: open, "toggle-display": "switch", onCalciteBlockSectionToggle: (e) => e.currentTarget.open ? this.addMapFloorInfo() : this.removeFloorInfo() }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", null, strings.summary), this.renderLayerPicker("siteLayer"), this.renderLayerPicker("facilityLayer"), this.renderLayerPicker("levelLayer"), this.renderAdditionalLayers()));
  }
  renderLayerPicker(name) {
    const { strings, view } = this;
    const floorLayer = getFloorLayer(name, view);
    const requiredFields = getRequiredFields(name);
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-floor-configuration-layer-picker", { view: this.view, label: strings[name], strings: strings, selectedLayer: floorLayer, requiredFields: requiredFields, onListChange: (e) => this.updateFloorInfo({ layer: (e === null || e === void 0 ? void 0 : e.detail) ? e === null || e === void 0 ? void 0 : e.detail[0] : null, name: name }) }));
  }
  renderAdditionalLayers() {
    const { strings } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block-section", { text: strings.additionalLayers, open: true }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-floor-configuration-additional-layers", { view: this.view, strings: this.strings, onDisable: (e) => this.disableContainer(e) })));
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisFloorAddLayers = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.listChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "listChange", 7);
    this.view = undefined;
    this.layers = undefined;
    this.selection = new Map();
    this.strings = undefined;
  }
  //--------------------------------------------------------------------------
  //
  //  Events
  //
  //--------------------------------------------------------------------------
  selectionChange() {
    this.listChange.emit(this.selection);
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, this.renderPanel());
  }
  renderPanel() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-floor-configuration-layer-list", { layers: getNonFloorLayers(this.view), "filter-enabled": true, multiple: true, strings: this.strings, onListChange: (e) => (this.selection = e.detail) })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "selection": ["selectionChange"]
  }; }
};

const arcgisFloorConfigurationAddLayersFlowCss = ".content{width:20vw;max-width:420px;min-width:240px;max-height:40vh}";

const ArcgisFloorAddLayersFlow = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.done = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "done", 7);
    this.dismiss = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "dismiss", 7);
    this.view = undefined;
    this.strings = undefined;
    this.layers = undefined;
    this.selectedLayers = undefined;
    this.mode = "create";
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, this.renderFlow());
  }
  renderFlow() {
    return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { ref: (el) => this.createPanels(el) });
  }
  // --------------------------------------------------------------------------
  //
  //  Event Handlers
  //
  //--------------------------------------------------------------------------
  onCreate(e) {
    e.stopPropagation();
    this.done.emit();
  }
  onEdit(e) {
    e.stopPropagation();
    this.done.emit();
  }
  onDismiss(e) {
    e.stopPropagation();
    this.dismiss.emit();
  }
  // --------------------------------------------------------------------------
  //
  //  Protected methods
  //
  // --------------------------------------------------------------------------
  createPanels(el) {
    const { mode } = this;
    if (mode === "create") {
      return this.createAddLayersPanel(el);
    }
    else if (mode === "edit") {
      return this.createReplaceFieldsPanel(el);
    }
  }
  createAddLayersPanel(flow) {
    const addLayersPanel = document.createElement("arcgis-floor-configuration-add-layers");
    addLayersPanel.strings = this.strings;
    addLayersPanel.view = this.view;
    addLayersPanel.classList.add("content");
    addLayersPanel.addEventListener("listChange", (e) => { var _a; return (nextButton.disabled = !((_a = e.detail) === null || _a === void 0 ? void 0 : _a.length)); });
    const panel = this.createPanel({
      heading: this.strings.addLayers
    });
    panel.appendChild(addLayersPanel);
    const dismissButton = this.createButton({
      label: this.strings.cancel,
      appearance: "outline-fill",
      eventListener: this.onDismiss.bind(this)
    });
    panel.appendChild(dismissButton);
    const nextButton = this.createButton({
      label: this.strings.next,
      appearance: "solid",
      disabled: true,
      eventListener: () => {
        //const selectedLayers = (this.selectedLayers = addLayersPanel.selection);
        this.createSelectFloorFieldsPanel(addLayersPanel.selection, flow);
      }
    });
    panel.appendChild(nextButton);
    flow.appendChild(panel);
  }
  createSelectFloorFieldsPanel(layers, flow) {
    const selectFloorFieldsPanel = document.createElement("arcgis-floor-configuration-select-fields");
    selectFloorFieldsPanel.classList.add("content");
    selectFloorFieldsPanel.strings = this.strings;
    selectFloorFieldsPanel.layers = layers;
    selectFloorFieldsPanel.view = this.view;
    const panel = this.createPanel({
      heading: this.strings.selectFloorField
    });
    panel.appendChild(selectFloorFieldsPanel);
    const cancelButton = this.createButton({
      label: this.strings.cancel,
      appearance: "outline-fill",
      eventListener: this.onDismiss.bind(this)
    });
    panel.appendChild(cancelButton);
    const doneButton = this.createButton({
      label: this.strings.add,
      appearance: "solid",
      eventListener: async (e) => {
        await selectFloorFieldsPanel.commit();
        this.onCreate(e);
      }
    });
    panel.appendChild(doneButton);
    flow.appendChild(panel);
  }
  createReplaceFieldsPanel(flow) {
    const layer = this.layers[0];
    const replaceFloorFieldsPanel = document.createElement("arcgis-floor-configuration-replace-field");
    replaceFloorFieldsPanel.classList.add("content");
    replaceFloorFieldsPanel.strings = this.strings;
    replaceFloorFieldsPanel.view = this.view;
    replaceFloorFieldsPanel.layer = layer;
    const panel = this.createPanel({
      heading: layer.title,
      summary: this.strings.replaceFloorField
    });
    panel.appendChild(replaceFloorFieldsPanel);
    const replaceButton = this.createButton({
      label: this.strings.replace,
      width: "full",
      eventListener: async (e) => {
        await replaceFloorFieldsPanel.commit();
        this.onEdit(e);
      }
    });
    panel.appendChild(replaceButton);
    flow.appendChild(panel);
  }
  createPanel(panelProps) {
    const panel = document.createElement("calcite-flow-item");
    panel.heading = panelProps.heading;
    panel.description = panelProps.summary;
    panel.closable = true;
    panel.closed = false;
    panel.addEventListener("calcitePanelClose", this.onDismiss.bind(this));
    return panel;
  }
  createButton(buttonProps) {
    const { appearance = "solid", label, eventListener, width = "half", disabled = false } = buttonProps;
    const button = document.createElement("calcite-button");
    button.slot = "footer";
    button.appearance = appearance;
    button.disabled = disabled;
    button.width = width;
    const text = document.createTextNode(label);
    button.appendChild(text);
    button.addEventListener("click", eventListener);
    return button;
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisFloorAddLayersFlow.style = arcgisFloorConfigurationAddLayersFlowCss;

const arcgisFloorConfigurationAdditionalLayersCss = ":host{height:100%}calcite-notice{margin-bottom:1em}";

const ArcgisFloorAdditionalLayers = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.dismiss = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "dismiss", 7);
    this.disable = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "disable", 7);
    this.floorInfoChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "floorInfoChange", 7);
    this.reRender = undefined;
    this.view = undefined;
    this.strings = undefined;
    this.placement = "bottom-start";
  }
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  disconnectedCallback() {
    var _a;
    const { popoverNode } = this;
    if (popoverNode) {
      popoverNode.open = false;
      (_a = popoverNode.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(popoverNode);
    }
  }
  //--------------------------------------------------------------------------
  //
  //  Public Methods
  //
  //--------------------------------------------------------------------------
  async setFocus() {
    var _a;
    return (_a = this.layerPanel) === null || _a === void 0 ? void 0 : _a.setFocus();
  }
  open() {
    // To avoid flicker when the popover aligns to the
    // referenceElement we add a small delay before opening
    setTimeout(() => (this.popoverNode.open = true), 25);
  }
  close(changes) {
    this.disableContainer(false);
    const { popoverNode } = this;
    popoverNode.open = false;
    popoverNode.remove();
    this.popoverNode = null;
    this.reRender = !this.reRender;
    if (changes) {
      this.floorInfoChange.emit();
    }
  }
  //--------------------------------------------------------------------------
  //
  //  Event Listeners
  //
  //--------------------------------------------------------------------------
  create() {
    const popoverNode = this.createPopover();
    const createFlow = this.createAddLayersFlow("create");
    popoverNode.appendChild(createFlow);
    this.open();
  }
  edit(e) {
    const layer = this.getSelectedLayer(e);
    const popoverNode = this.createPopover();
    const editFlow = this.createAddLayersFlow("edit");
    editFlow.layers = [layer];
    popoverNode.appendChild(editFlow);
    this.open();
  }
  removeLayer(layer) {
    layer.floorInfo = null;
    this.reRender = !this.reRender;
    this.floorInfoChange.emit();
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, this.renderNotice(), this.renderPanel()));
  }
  renderNotice() {
    const { strings } = this;
    const layers = this.getLayers();
    return (layers === null || layers === void 0 ? void 0 : layers.length) ? null : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { scale: "s", width: "auto", open: true }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, strings.additionalLayersTip)));
  }
  renderPanel() {
    const { strings } = this;
    const nonFloorLayers = getNonFloorLayers(this.view);
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { ref: (el) => (this.layerPanel = el) }, this.renderLayers(), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-fab", { slot: "fab", icon: "plus", appearance: "outline-fill", kind: "neutral", "text-enabled": true, label: strings.addLayers, text: strings.addLayers, disabled: nonFloorLayers.length === 0, scale: "s", ref: (el) => (this.triggerButton = el), onClick: () => this.create() })));
  }
  renderLayers() {
    const layers = this.getLayers();
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-value-list", { dir: "ltr", class: "calcite-mode-light", onClick: (e) => this.edit(e) }, layers.map((layer) => this.renderLayer(layer))));
  }
  renderLayer(floorLayer) {
    const { title, floorInfo, id } = floorLayer;
    const { floorField } = floorInfo;
    const fieldName = `{${floorField}}`;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-value-list-item", { label: title, description: fieldName, value: id }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "actions-end", text: this.strings.remove, icon: "x", onClick: (e) => {
        e.stopPropagation();
        this.removeLayer(floorLayer);
      } })));
  }
  // --------------------------------------------------------------------------
  //
  //  Protected methods
  //
  // --------------------------------------------------------------------------
  disableContainer(disable) {
    const block = this.el.closest("calcite-block");
    if (block) {
      block.disabled = disable;
    }
    this.disable.emit(disable);
  }
  createAddLayersFlow(mode) {
    this.disableContainer(true);
    const addLayersFlow = (this.addLayersFlow = document.createElement("arcgis-floor-configuration-add-layers-flow"));
    addLayersFlow.strings = this.strings;
    addLayersFlow.view = this.view;
    addLayersFlow.mode = mode;
    addLayersFlow.addEventListener("done", this.close.bind(this, true));
    addLayersFlow.addEventListener("dismiss", this.close.bind(this, false));
    return addLayersFlow;
  }
  createPopover() {
    const referenceElement = this.el;
    const popoverNode = (this.popoverNode =
      document.createElement("calcite-popover"));
    popoverNode.classList.add("js-app-primary-flyout");
    popoverNode.referenceElement = referenceElement;
    popoverNode.offsetDistance = -550;
    popoverNode.offsetSkidding = 0;
    popoverNode.label = this.strings.addLayers;
    popoverNode.placement = "bottom-start";
    popoverNode.pointerDisabled = true;
    document.body.appendChild(popoverNode);
    return popoverNode;
  }
  getSelectedLayer(e) {
    var _a, _b, _c, _d, _e;
    if (((_a = e.target) === null || _a === void 0 ? void 0 : _a.localName) === "calcite-value-list-item" ||
      ((_c = (_b = e.target) === null || _b === void 0 ? void 0 : _b.parentElement) === null || _c === void 0 ? void 0 : _c.localName) === "calcite-value-list-item") {
      const id = (_d = e.target.value) !== null && _d !== void 0 ? _d : (_e = e.target.parentElement) === null || _e === void 0 ? void 0 : _e.value;
      return this.findLayer(id);
    }
  }
  getLayers() {
    const mapView = this.view;
    const { map } = mapView;
    const { allLayers } = map;
    let layers = [];
    allLayers.forEach((layer) => {
      const { type, floorInfo } = layer;
      if (type === "map-image") {
        const { allSublayers } = layer;
        layers = layers.concat(allSublayers.filter((subLayer) => subLayer.fieldsIndex && (subLayer === null || subLayer === void 0 ? void 0 : subLayer.floorInfo)).toArray());
      }
      else if (floorInfo) {
        layers.push(layer);
      }
    });
    return layers;
  }
  findLayer(layerId) {
    const layers = this.getLayers();
    return layers === null || layers === void 0 ? void 0 : layers.find((layer) => layer.id === layerId);
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisFloorAdditionalLayers.style = arcgisFloorConfigurationAdditionalLayersCss;

const ArcgisFieldList = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.listChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "listChange", 7);
    this.layer = undefined;
    this.selection = new Map();
    this.filterEnabled = true;
    this.multiple = false;
    this.strings = undefined;
    this.fieldType = "string";
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pick-list", { "filter-enabled": this.filterEnabled, "filter-placeholder": this.strings.filter, multiple: this.multiple, onClick: (e) => this.onListChange(e) }, this.renderFields())));
  }
  renderFields() {
    let fields = this.getFields();
    return (fields || []).map((field) => this.renderField(field));
  }
  renderField(field) {
    const fieldName = `{${field.name}}`;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pick-list-item", { label: field.alias, description: fieldName, selected: this.selection.has(field.name), value: field.name }));
  }
  // --------------------------------------------------------------------------
  //
  //  Private methods
  //
  // --------------------------------------------------------------------------
  onListChange(e) {
    const { selection } = this;
    this.updateSelection(e);
    this.listChange.emit(Array.from(selection.values()));
  }
  updateSelection(e) {
    var _a, _b, _c, _d, _e;
    if (((_a = e.target) === null || _a === void 0 ? void 0 : _a.localName) === "calcite-pick-list-item" ||
      ((_c = (_b = e.target) === null || _b === void 0 ? void 0 : _b.parentElement) === null || _c === void 0 ? void 0 : _c.localName) === "calcite-pick-list-item") {
      const { selection } = this;
      const selectedFieldName = (_d = e.target.value) !== null && _d !== void 0 ? _d : (_e = e.target.parentElement) === null || _e === void 0 ? void 0 : _e.value;
      const isRemoved = selection.has(selectedFieldName);
      const selectedField = this.findField(selectedFieldName);
      if (!this.multiple) {
        selection.clear();
      }
      if (!isRemoved) {
        this.selection.set(selectedFieldName, selectedField);
      }
      else {
        this.selection.delete(selectedField.name);
      }
    }
  }
  getFields() {
    const { layer, fieldType } = this;
    const { fields } = layer;
    return (fields === null || fields === void 0 ? void 0 : fields.length)
      ? fields.filter((field) => !fieldType || (field === null || field === void 0 ? void 0 : field.type) === fieldType)
      : [];
  }
  findField(name) {
    const { layer } = this;
    return layer.fieldsIndex.get(name);
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisFloorFieldPicker = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.iconEnd = "pencil";
    this.label = undefined;
    this.layer = undefined;
    this.placement = "auto";
    this.open = undefined;
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    var _a;
    const buttonText = ((_a = this.layer) === null || _a === void 0 ? void 0 : _a.title) || this.strings.none;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.label, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", kind: "neutral", scale: "m", "icon-end": this.iconEnd, ref: (el) => (this.triggerButton = el), onClick: () => (this.open = !this.open) }, buttonText)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { label: this.label, pointerDisabled: true, referenceElement: this.triggerButton, open: this.open, closable: true, placement: this.placement }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "content" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", null)))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisFloorConfigurationFieldSelect = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.layer = undefined;
    this.strings = undefined;
    this.field = undefined;
    this.fieldType = "string";
  }
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  async componentWillLoad() {
    this.onSelectChange();
  }
  // --------------------------------------------------------------------------
  //
  //  Private Functions
  //
  //--------------------------------------------------------------------------
  findField(fieldName) {
    return this.layer.fieldsIndex.get(fieldName);
  }
  // --------------------------------------------------------------------------
  //
  //  Event Handlers
  //
  //--------------------------------------------------------------------------
  onSelectChange() {
    const { select } = this;
    const selectedOption = select === null || select === void 0 ? void 0 : select.selectedOption;
    this.field = selectedOption
      ? this.findField(selectedOption.value)
      : this.field || this.getFields()[0];
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    const { title } = this.layer;
    const fields = this.getFields();
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, title, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "select", ref: (e) => (this.select = e), onCalciteSelectChange: () => this.onSelectChange() }, fields.map((field) => this.renderField(field))))));
  }
  renderField(field) {
    return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { label: field.alias, value: field.name });
  }
  // --------------------------------------------------------------------------
  //
  //  Private methods
  //
  // --------------------------------------------------------------------------
  getFields() {
    const { layer, fieldType } = this;
    const { fields } = layer;
    return (fields === null || fields === void 0 ? void 0 : fields.length)
      ? fields.filter((field) => !fieldType || (field === null || field === void 0 ? void 0 : field.type) === fieldType)
      : [];
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisLayerList = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.listChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "listChange", 7);
    this.layers = undefined;
    this.selection = new Map();
    this.filterEnabled = true;
    this.multiple = false;
    this.strings = undefined;
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pick-list", { "filter-enabled": this.filterEnabled, "filter-placeholder": this.strings.filter, multiple: this.multiple, onClick: (e) => this.onListChange(e) }, this.renderLayers())));
  }
  renderLayers() {
    const { layers, selection } = this;
    return (layers || []).map((layer) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pick-list-item", { label: layer.title, description: this.getLayerType(layer), selected: selection.has(layer.id), value: layer.id })));
  }
  // --------------------------------------------------------------------------
  //
  //  Private methods
  //
  // --------------------------------------------------------------------------
  onListChange(e) {
    const { selection } = this;
    this.updateSelection(e);
    this.listChange.emit(Array.from(selection.values()));
  }
  updateSelection(e) {
    var _a, _b, _c, _d, _e;
    if (((_a = e.target) === null || _a === void 0 ? void 0 : _a.localName) === "calcite-pick-list-item" ||
      ((_c = (_b = e.target) === null || _b === void 0 ? void 0 : _b.parentElement) === null || _c === void 0 ? void 0 : _c.localName) === "calcite-pick-list-item") {
      const { selection } = this;
      const selectedLayerId = (_d = e.target.value) !== null && _d !== void 0 ? _d : (_e = e.target.parentElement) === null || _e === void 0 ? void 0 : _e.value;
      const isRemoved = selection.has(selectedLayerId);
      const selectedLayer = this.findLayer(selectedLayerId);
      if (!this.multiple) {
        selection.clear();
      }
      if (!isRemoved) {
        this.selection.set(selectedLayer.id, selectedLayer);
      }
      else {
        this.selection.delete(selectedLayer.id);
      }
    }
  }
  findLayer(layerId) {
    const { layers } = this;
    return layers === null || layers === void 0 ? void 0 : layers.find((layer) => layer.id === layerId);
  }
  getLayerType(layer) {
    const { layerTypes } = this.strings;
    const { geometryType = "unknown", sourceJSON } = layer;
    return geometryType !== "unknown"
      ? layerTypes[geometryType]
      : layerTypes[this.jsonTypeToLayerType(sourceJSON === null || sourceJSON === void 0 ? void 0 : sourceJSON.geometryType)];
  }
  jsonTypeToLayerType(type) {
    if (type === "esriGeometryPolygon") {
      return "polygon";
    }
    else if (type === "esriGeometryPoint") {
      return "point";
    }
    else if (type === "esriGeometryPolyline") {
      return "line";
    }
    else {
      return "unknown";
    }
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const arcgisFloorConfigurationLayerPickerCss = "calcite-label span{width:100%;display:flex;justify-content:space-between}calcite-label span calcite-action{margin-left:0.3em}.arcgis--rtl calcite-label span calcite-action{margin-left:auto;margin-right:0.3em}";

const ArcgisLayerPicker = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.listChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "listChange", 7);
    this.selectedLayer = undefined;
    this.view = undefined;
    this.iconEnd = "pencil";
    this.label = undefined;
    this.placement = "bottom-start";
    this.open = false;
    this.strings = undefined;
    this.requiredFields = undefined;
    this.geometryType = "polygon";
  }
  //--------------------------------------------------------------------------
  //
  //  Events
  //
  //--------------------------------------------------------------------------
  calcitePopoverCloseHandler() {
    this.open = false;
  }
  //--------------------------------------------------------------------------
  //
  //  Public
  //
  //--------------------------------------------------------------------------
  async setFocus() {
    if (this.panel) {
      return this.panel.setFocus();
    }
    else {
      return Promise.resolve();
    }
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    const { selectedLayer } = this;
    const buttonText = (selectedLayer === null || selectedLayer === void 0 ? void 0 : selectedLayer.title) || this.strings.none;
    const layers = this.getLayers();
    const disabled = this.open || !(layers === null || layers === void 0 ? void 0 : layers.length);
    const selection = new Map();
    if (selectedLayer) {
      selection.set(selectedLayer.id, selectedLayer);
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.label, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", alignment: "icon-end-space-between", kind: "neutral", scale: "m", "icon-end": "pencil", width: "full", disabled: disabled, ref: (el) => (this.triggerButton = el), onClick: () => {
        this.open = !this.open;
        setTimeout(() => this.setFocus(), 25);
      } }, buttonText), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { icon: "x", scale: "s", text: this.strings.clear, disabled: !this.selectedLayer, onClick: () => {
        this.selectedLayer = null;
        this.listChange.emit();
      } }))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { label: this.label, pointerDisabled: true, referenceElement: this.triggerButton, open: this.open, placement: this.placement, ref: (el) => (this.popoverNode = el) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { heading: this.label, closed: false, "width-scale": "m", "height-scale": "m", ref: (el) => (this.panel = el) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-floor-configuration-layer-list", { strings: this.strings, layers: layers, selection: selection, onListChange: (e) => (this.selectedLayer = e === null || e === void 0 ? void 0 : e.detail[0]) }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { width: "full", slot: "footer", onClick: () => (this.open = false) }, this.strings.done)))));
  }
  // --------------------------------------------------------------------------
  //
  //  Private methods
  //
  // --------------------------------------------------------------------------
  getLayers() {
    const compatibleLayers = this.getCompatibleLayers();
    return (compatibleLayers === null || compatibleLayers === void 0 ? void 0 : compatibleLayers.length)
      ? compatibleLayers.filter((layer) => this.checkRequiredFields(layer))
      : [];
  }
  getCompatibleLayers() {
    const { geometryType } = this;
    const { map } = this.view;
    const { allLayers } = map;
    let compatibleLayers = [];
    allLayers.forEach((layer) => {
      const { type } = layer;
      if (type === "map-image") {
        const { allSublayers } = layer;
        compatibleLayers = compatibleLayers.concat(allSublayers.filter((subLayer) => subLayer.fieldsIndex).toArray());
      }
      else if ((type === "feature" && !geometryType) || (layer === null || layer === void 0 ? void 0 : layer.geometryType) === geometryType) {
        compatibleLayers.push(layer);
      }
    });
    return compatibleLayers;
  }
  checkRequiredFields(layer) {
    const { requiredFields } = this;
    const { fieldsIndex } = layer;
    return requiredFields && fieldsIndex
      ? requiredFields.every((fieldName) => fieldsIndex.get(fieldName))
      : true;
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLayerPicker.style = arcgisFloorConfigurationLayerPickerCss;

const arcgisFloorConfigurationReplaceFieldCss = "section{padding:0.5rem 0.75rem;background-color:white}";

const ArcgisFloorReplaceField = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.view = undefined;
    this.layer = undefined;
    this.strings = undefined;
  }
  //--------------------------------------------------------------------------
  //
  //  Public
  //
  //--------------------------------------------------------------------------
  async commit() {
    return new Promise(async (resolve) => {
      const lists = Array.from(this.el.shadowRoot.querySelectorAll("arcgis-field-list"));
      lists.map((list) => setFloorInfo(list));
      resolve();
    });
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, this.renderPanel());
  }
  renderPanel() {
    const layer = this.layer;
    const field = this.findField(layer.floorInfo.floorField);
    const fieldSelection = new Map();
    fieldSelection.set(field.name, field);
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-floor-configuration-field-list", { strings: this.strings, layer: layer, selection: fieldSelection })));
  }
  // --------------------------------------------------------------------------
  //
  //  Protected methods
  //
  // --------------------------------------------------------------------------
  findField(name) {
    const layer = this.layer;
    return layer.fieldsIndex.get(name);
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisFloorReplaceField.style = arcgisFloorConfigurationReplaceFieldCss;

const arcgisFloorConfigurationSelectFieldsCss = "section{padding:0.5rem 0.75rem;background-color:white}";

const ArcgisFloorSelectFields = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.view = undefined;
    this.layers = undefined;
    this.strings = undefined;
  }
  //--------------------------------------------------------------------------
  //
  //  Public Methods
  //
  //--------------------------------------------------------------------------
  async commit() {
    return new Promise(async (resolve) => {
      const selects = Array.from(this.el.shadowRoot.querySelectorAll("arcgis-floor-configuration-field-select"));
      selects.forEach((select) => setFloorInfo(select));
      resolve();
    });
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, this.renderPanel());
  }
  renderPanel() {
    const { layers } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", null, this.strings.selectMessage), layers.map((layer) => this.renderSelect(layer))));
  }
  renderSelect(layer) {
    return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-floor-configuration-field-select", { strings: this.strings, layer: layer });
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisFloorSelectFields.style = arcgisFloorConfigurationSelectFieldsCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



const languageMap = new Map([
  ["ar", "ar"],
  ["bg", "bg"],
  ["bs", "bs"],
  ["ca", "ca"],
  ["cs", "cs"],
  ["da", "da"],
  ["de", "de"],
  ["el", "el"],
  ["en", "en"],
  ["es", "es"],
  ["et", "et"],
  ["fi", "fi"],
  ["fr", "fr"],
  ["he", "he"],
  ["hr", "hr"],
  ["hu", "hu"],
  ["id", "id"],
  ["it", "it"],
  ["ja", "ja"],
  ["ko", "ko"],
  ["lt", "lt"],
  ["lv", "lv"],
  ["nb", "nb"],
  ["nl", "nl"],
  ["pl", "pl"],
  ["pt-br", "pt-BR"],
  ["pt-pt", "pt-PT"],
  ["ro", "ro"],
  ["ru", "ru"],
  ["sk", "sk"],
  ["sl", "sl"],
  ["sr", "sr"],
  ["sv", "sv"],
  ["th", "th"],
  ["tr", "tr"],
  ["uk", "uk"],
  ["vi", "vi"],
  ["zh-cn", "zh-CN"],
  ["zh-hk", "zh-HK"],
  ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
  return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
  const closestWithProp = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
  return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
  rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
  const { api, type, places } = options || {};
  if (api === 4) {
    const [intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
    const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
      places,
      style: type,
      digitSeparator: true
    });
    return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
  }
  const [dojoNumber] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
  return dojoNumber.format(number, {
    type,
    places,
    pattern: options === null || options === void 0 ? void 0 : options.pattern
  });
}
const cache = {};
function formatDate(date) {
  const lang = document.documentElement.lang;
  const dayShortMonthYear = {
    year: "numeric",
    month: "short",
    day: "numeric"
  };
  if (!cache[lang]) {
    cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
  }
  return cache[lang].format(date);
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
  var _a, _b, _c;
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    // "ru-RU" maps to "ru" use case
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
    }
    else {
      return "en";
    }
  }
}
function getComponentClosestLanguageIntl(element) {
  var _a, _b, _c;
  // it's OK if we don't have the 4 letter language file for it
  // 4 letter language code needed for formatting numbers
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      // we support the 2 letter coded language
      // e.g. it-CH vs it
      return lang;
    }
    else {
      return "en";
    }
  }
}
function fetchLocaleStringsForComponent(componentName, locale) {
  return new Promise((resolve, reject) => {
    fetch((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
      if (result.ok)
        resolve(result.json());
      else
        reject();
    }, () => reject());
  });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
  const id = `${componentName}${locale}`;
  if (!stringCache[id]) {
    stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
  }
  return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
  const componentName = tagName || element.tagName.toLowerCase();
  const componentLanguage = getComponentClosestLanguage(element);
  const componentLanguageIntl = getComponentClosestLanguageIntl(element);
  let strings;
  try {
    strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
  }
  catch (e) {
    console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
    strings = await fetchLocaleStringsFromCache(componentName, "en");
  }
  return [strings, componentLanguage, componentLanguageIntl];
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWFiYWQxYi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDNkc7QUFDdkM7QUFDVDtBQUNsQztBQUNTOztBQUVwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnSEFBZ0g7QUFDaEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsT0FBTztBQUNqQjtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUM7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxNQUFNO0FBQ2hCLFVBQVUsWUFBWTtBQUN0QjtBQUNBO0FBQ0EsWUFBWSxrQkFBa0I7QUFDOUI7QUFDQSxjQUFjLGVBQWU7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxVQUFVLE1BQU07QUFDaEIsVUFBVSxZQUFZO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHFCQUFxQjtBQUNqQztBQUNBLGNBQWMsZUFBZTtBQUM3QjtBQUNBLGdDQUFnQyxRQUFR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QVUscURBQVksOEJBQThCLGNBQWMsUUFBUSxPQUFPO0FBQ2pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsY0FBYyxFQUFFLE9BQU87QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLGVBQWUsR0FBRyxrQkFBa0I7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7O0FBRTRFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLWZsb29yLWNvbmZpZ3VyYXRpb25fMTEuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xvY2FsZS0xM2UwMGE3NS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyB9IGZyb20gJy4vbG9jYWxlLTEzZTAwYTc1LmpzJztcbmltcG9ydCB7IGwgYXMgbG9hZE1vZHVsZXMgfSBmcm9tICcuL2xvYWRNb2R1bGVzLWFhZjMwYmQ2LmpzJztcbmltcG9ydCAnLi9kb20tMTNmNWIwMGMuanMnO1xuaW1wb3J0ICcuL2xhbmd1YWdlVXRpbC0yMjI1OGM5MC5qcyc7XG5cbmNvbnN0IENTUyA9IHtcbiAgY29udGFpbmVyOiBcImNvbnRhaW5lclwiLFxuICBzZWN0aW9uOiBcInNlY3Rpb25cIixcbiAgdGl0bGU6IFwidGl0bGVcIixcbiAgbWlzc2luZzogXCJtaXNzaW5nXCJcbn07XG5cbmNvbnN0IGZsb29ySW5mb1NjaGVtYSA9IHtcbiAgZmFjaWxpdHlMYXllcjoge1xuICAgIGZhY2lsaXR5SWRGaWVsZDogXCJGQUNJTElUWV9JRFwiLFxuICAgIHNpdGVJZEZpZWxkOiBcIlNJVEVfSURcIixcbiAgICBuYW1lRmllbGQ6IFwiTkFNRVwiXG4gIH0sXG4gIGxldmVsTGF5ZXI6IHtcbiAgICBsZXZlbElkRmllbGQ6IFwiTEVWRUxfSURcIixcbiAgICBmYWNpbGl0eUlkRmllbGQ6IFwiRkFDSUxJVFlfSURcIixcbiAgICBsb25nTmFtZUZpZWxkOiBcIk5BTUVcIixcbiAgICBzaG9ydE5hbWVGaWVsZDogXCJOQU1FX1NIT1JUXCIsXG4gICAgbGV2ZWxOdW1iZXJGaWVsZDogXCJMRVZFTF9OVU1CRVJcIixcbiAgICB2ZXJ0aWNhbE9yZGVyRmllbGQ6IFwiVkVSVElDQUxfT1JERVJcIlxuICB9LFxuICBzaXRlTGF5ZXI6IHtcbiAgICBzaXRlSWRGaWVsZDogXCJTSVRFX0lEXCIsXG4gICAgbmFtZUZpZWxkOiBcIk5BTUVcIlxuICB9XG59O1xubGV0IHRlbXBGbG9vckluZm87XG5jb25zdCBnZXRNYXBGbG9vckluZm8gPSAodmlldykgPT4ge1xuICB2YXIgX2E7XG4gIGNvbnN0IG1hcCA9IHZpZXcgPT09IG51bGwgfHwgdmlldyA9PT0gdm9pZCAwID8gdm9pZCAwIDogdmlldy5tYXA7XG4gIHRlbXBGbG9vckluZm8gPSB0ZW1wRmxvb3JJbmZvIHx8IChtYXAgPT09IG51bGwgfHwgbWFwID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXAuZmxvb3JJbmZvKSB8fCBPYmplY3QuYXNzaWduKHt9LCBmbG9vckluZm9TY2hlbWEpO1xuICAvLyBTaXRlTGF5ZXIgaXMgb3B0aW9uYWwsIGJ1dCBtaWdodCBiZSBzcGVjaWZpZWQgd2l0aG91dCBhXG4gIC8vIGxheWVySWQgaWYgc28gd2Ugc2hvdWxkIHJlbW92ZSBpdCBzbyB0aGUgc2NoZW1hIGNhbiBzdGlsbCB2YWxpZGF0ZVxuICB0ZW1wRmxvb3JJbmZvLnNpdGVMYXllciA9ICgoX2EgPSB0ZW1wRmxvb3JJbmZvID09PSBudWxsIHx8IHRlbXBGbG9vckluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbXBGbG9vckluZm8uc2l0ZUxheWVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGF5ZXJJZCkgPyB0ZW1wRmxvb3JJbmZvLnNpdGVMYXllciA6IG51bGw7XG4gIHJldHVybiB0ZW1wRmxvb3JJbmZvO1xufTtcbmNvbnN0IHNldE1hcEZsb29ySW5mbyA9ICh2aWV3KSA9PiB7XG4gIGNvbnN0IG1hcCA9IHZpZXcgPT09IG51bGwgfHwgdmlldyA9PT0gdm9pZCAwID8gdm9pZCAwIDogdmlldy5tYXA7XG4gIGNvbnN0IG1hcEZsb29ySW5mbyA9IGdldE1hcEZsb29ySW5mbyh2aWV3KTtcbiAgaWYgKG1hcCAmJiB2YWxpZGF0ZUZsb29ySW5mbyhtYXBGbG9vckluZm8pKSB7XG4gICAgbWFwLnNldChcImZsb29ySW5mb1wiLCBtYXBGbG9vckluZm8pO1xuICB9XG4gIGVsc2Uge1xuICAgIHJlbW92ZU1hcEZsb29ySW5mbyh2aWV3KTtcbiAgfVxufTtcbmNvbnN0IHVwZGF0ZU1hcEZsb29ySW5mbyA9IChmbG9vckluZm9Qcm9wcywgdmlldykgPT4ge1xuICBjb25zdCBtYXBGbG9vckluZm8gPSBnZXRNYXBGbG9vckluZm8odmlldyk7XG4gIGNvbnN0IHsgbmFtZSB9ID0gZmxvb3JJbmZvUHJvcHM7XG4gIGNvbnN0IGxheWVyID0gZmxvb3JJbmZvUHJvcHMubGF5ZXI7XG4gIGNvbnN0IGlzU3VibGF5ZXIgPSAhIShsYXllciA9PT0gbnVsbCB8fCBsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXIubGF5ZXIpO1xuICBpZiAobGF5ZXIpIHtcbiAgICBtYXBGbG9vckluZm9bbmFtZV0gPSBPYmplY3QuYXNzaWduKHt9LCBmbG9vckluZm9TY2hlbWFbbmFtZV0pO1xuICAgIG1hcEZsb29ySW5mb1tuYW1lXS5sYXllcklkID0gaXNTdWJsYXllciA/IGxheWVyLmxheWVyLmlkIDogbGF5ZXIuaWQ7XG4gICAgbWFwRmxvb3JJbmZvW25hbWVdLnN1YmxheWVySWQgPSBpc1N1YmxheWVyID8gbGF5ZXIuaWQgOiB1bmRlZmluZWQ7XG4gIH1cbiAgZWxzZSB7XG4gICAgbWFwRmxvb3JJbmZvW25hbWVdID0gdW5kZWZpbmVkO1xuICB9XG4gIHNldE1hcEZsb29ySW5mbyh2aWV3KTtcbn07XG5jb25zdCByZW1vdmVNYXBGbG9vckluZm8gPSAodmlldykgPT4ge1xuICBjb25zdCBtYXAgPSB2aWV3ID09PSBudWxsIHx8IHZpZXcgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHZpZXcubWFwO1xuICBpZiAobWFwKSB7XG4gICAgbWFwLmZsb29ySW5mbyA9IG51bGw7XG4gIH1cbn07XG5jb25zdCB2YWxpZGF0ZUZsb29ySW5mbyA9IChtYXBGbG9vckluZm8pID0+IHtcbiAgdmFyIF9hLCBfYjtcbiAgcmV0dXJuICgoX2EgPSBtYXBGbG9vckluZm8gPT09IG51bGwgfHwgbWFwRmxvb3JJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXBGbG9vckluZm8uZmFjaWxpdHlMYXllcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxheWVySWQpICYmXG4gICAgKChfYiA9IG1hcEZsb29ySW5mbyA9PT0gbnVsbCB8fCBtYXBGbG9vckluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hcEZsb29ySW5mby5sZXZlbExheWVyKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGF5ZXJJZCkgJiZcbiAgICAoIShtYXBGbG9vckluZm8gPT09IG51bGwgfHwgbWFwRmxvb3JJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXBGbG9vckluZm8uc2l0ZUxheWVyKSB8fCAobWFwRmxvb3JJbmZvID09PSBudWxsIHx8IG1hcEZsb29ySW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWFwRmxvb3JJbmZvLnNpdGVMYXllci5sYXllcklkKSlcbiAgICA/IHRydWVcbiAgICA6IGZhbHNlO1xufTtcbmNvbnN0IGdldFJlcXVpcmVkRmllbGRzID0gKG5hbWUpID0+IHtcbiAgY29uc3Qgc2NoZW1hID0gZmxvb3JJbmZvU2NoZW1hW25hbWVdO1xuICByZXR1cm4gT2JqZWN0LnZhbHVlcyhzY2hlbWEpO1xufTtcbmNvbnN0IGdldE5vbkZsb29yTGF5ZXJzID0gKHZpZXcpID0+IHtcbiAgY29uc3QgeyBtYXAgfSA9IHZpZXc7XG4gIGNvbnN0IHsgYWxsTGF5ZXJzIH0gPSBtYXA7XG4gIGxldCBub25GbG9vckxheWVycyA9IFtdO1xuICBhbGxMYXllcnMuZm9yRWFjaCgobGF5ZXIpID0+IHtcbiAgICBjb25zdCB7IHR5cGUsIGZsb29ySW5mbyB9ID0gbGF5ZXI7XG4gICAgaWYgKHR5cGUgPT09IFwibWFwLWltYWdlXCIpIHtcbiAgICAgIGNvbnN0IHsgYWxsU3VibGF5ZXJzIH0gPSBsYXllcjtcbiAgICAgIG5vbkZsb29yTGF5ZXJzID0gbm9uRmxvb3JMYXllcnMuY29uY2F0KGFsbFN1YmxheWVycy5maWx0ZXIoKHN1YkxheWVyKSA9PiBzdWJMYXllci5maWVsZHNJbmRleCAmJiAhKHN1YkxheWVyID09PSBudWxsIHx8IHN1YkxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzdWJMYXllci5mbG9vckluZm8pKS50b0FycmF5KCkpO1xuICAgIH1cbiAgICBlbHNlIGlmICghZmxvb3JJbmZvICYmIHR5cGUgPT09IFwiZmVhdHVyZVwiKSB7XG4gICAgICBub25GbG9vckxheWVycy5wdXNoKGxheWVyKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gbm9uRmxvb3JMYXllcnM7XG59O1xuY29uc3QgZ2V0Q29tcGF0aWJsZUxheWVycyA9IGFzeW5jICh2aWV3KSA9PiB7XG4gIGNvbnN0IHsgbWFwIH0gPSB2aWV3O1xuICBjb25zdCB7IGFsbExheWVycyB9ID0gbWFwO1xuICBjb25zdCBwcm9taXNlcyA9IGFsbExheWVyc1xuICAgIC5tYXAoYXN5bmMgKGxheWVyKSA9PiBhd2FpdCBsb2FkQWxsKGxheWVyKSlcbiAgICAuZmlsdGVyKChsYXllcikgPT4gKGxheWVyID09PSBudWxsIHx8IGxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllci5sb2FkU3RhdHVzKSAhPT0gXCJmYWlsZWRcIik7XG4gIC8vIE1ha2Ugc3VyZSBhbGwgbGF5ZXJzIGFuZCBzdWJsYXllcnMgYXJlIGxvYWRlZFxuICAvLyBiZWZvcmUgY2hlY2tpbmcgdGhlbSBmb3IgY29tcGF0aWJpbGl0eVxuICBjb25zdCB2YWxpZExheWVycyA9IGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTtcbiAgbGV0IGNvbXBhdGlibGVMYXllcnMgPSBbXTtcbiAgdmFsaWRMYXllcnMuZm9yRWFjaCgobGF5ZXIpID0+IHtcbiAgICBjb25zdCB7IHR5cGUsIGdlb21ldHJ5VHlwZSB9ID0gbGF5ZXI7XG4gICAgaWYgKHR5cGUgPT09IFwibWFwLWltYWdlXCIpIHtcbiAgICAgIGNvbnN0IHsgYWxsU3VibGF5ZXJzIH0gPSBsYXllcjtcbiAgICAgIGNvbXBhdGlibGVMYXllcnMgPSBjb21wYXRpYmxlTGF5ZXJzLmNvbmNhdChhbGxTdWJsYXllcnNcbiAgICAgICAgLmZpbHRlcigoc3ViTGF5ZXIpID0+IHsgdmFyIF9hOyByZXR1cm4gc3ViTGF5ZXIuZmllbGRzSW5kZXggJiYgKChfYSA9IHN1YkxheWVyLnNvdXJjZUpTT04pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZW9tZXRyeVR5cGUpID09PSBcImVzcmlHZW9tZXRyeVBvbHlnb25cIjsgfSlcbiAgICAgICAgLnRvQXJyYXkoKSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGUgPT09IFwiZmVhdHVyZVwiICYmIGdlb21ldHJ5VHlwZSA9PT0gXCJwb2x5Z29uXCIpIHtcbiAgICAgIGNvbXBhdGlibGVMYXllcnMucHVzaChsYXllcik7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGNvbXBhdGlibGVMYXllcnM7XG59O1xuY29uc3QgbG9hZEFsbCA9IChsYXllcikgPT4ge1xuICB0cnkge1xuICAgIGxheWVyLmxvYWRBbGwgPyBsYXllci5sb2FkQWxsKCkgOiBsYXllci5sb2FkKCk7XG4gIH1cbiAgY2F0Y2ggKF9hKSB7IH1cbiAgcmV0dXJuIGxheWVyO1xufTtcbmNvbnN0IGdldEZsb29yTGF5ZXIgPSAobmFtZSwgdmlldykgPT4ge1xuICB2YXIgX2EsIF9iO1xuICBjb25zdCBtYXAgPSB2aWV3Lm1hcDtcbiAgY29uc3QgbGF5ZXJzID0gbWFwLmFsbExheWVycztcbiAgY29uc3QgZmxvb3JJbmZvID0gZ2V0TWFwRmxvb3JJbmZvKHZpZXcpO1xuICBjb25zdCBsYXllcklkID0gKF9hID0gZmxvb3JJbmZvID09PSBudWxsIHx8IGZsb29ySW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmxvb3JJbmZvW25hbWVdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGF5ZXJJZDtcbiAgY29uc3Qgc3VibGF5ZXJJZCA9IChfYiA9IGZsb29ySW5mbyA9PT0gbnVsbCB8fCBmbG9vckluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZsb29ySW5mb1tuYW1lXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnN1YmxheWVySWQ7XG4gIGxldCBmbG9vckxheWVyID0gbGF5ZXJJZCA/IGxheWVycyA9PT0gbnVsbCB8fCBsYXllcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxheWVycy5maW5kKChsYXllcikgPT4gbGF5ZXIuaWQgPT09IGxheWVySWQpIDogbnVsbDtcbiAgaWYgKChmbG9vckxheWVyID09PSBudWxsIHx8IGZsb29yTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZsb29yTGF5ZXIudHlwZSkgPT09IFwibWFwLWltYWdlXCIpIHtcbiAgICBmbG9vckxheWVyID0gZmxvb3JMYXllci5hbGxTdWJsYXllcnMuZmluZCgoc3VibGF5ZXIpID0+IHN1YmxheWVyLmlkID09PSBzdWJsYXllcklkKTtcbiAgfVxuICByZXR1cm4gZmxvb3JMYXllcjtcbn07XG5jb25zdCBzZXRGbG9vckluZm8gPSAoZWxlbWVudCkgPT4ge1xuICBsZXQgeyBsYXllciwgZmllbGQgfSA9IGVsZW1lbnQ7XG4gIGlmICgoZWxlbWVudCA9PT0gbnVsbCB8fCBlbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlbGVtZW50LmxvY2FsTmFtZSkgPT09IFwiYXJjZ2lzLWZpZWxkLWxpc3RcIikge1xuICAgIGZpZWxkID0gZWxlbWVudC5zZWxlY3Rpb24udmFsdWVzKCkubmV4dCgpLnZhbHVlO1xuICB9XG4gIGNvbnN0IGZsb29ySW5mbyA9IGxheWVyLmZsb29ySW5mbyB8fCB7fTtcbiAgZmxvb3JJbmZvLmZsb29yRmllbGQgPSBmaWVsZC5uYW1lO1xuICBsYXllci5zZXQoXCJmbG9vckluZm9cIiwgZmxvb3JJbmZvKTtcbn07XG5cbmNvbnN0IEFyY2dpc0Zsb29yQ29uZmlndXJhdGlvbiA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5mbG9vckluZm9DaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImZsb29ySW5mb0NoYW5nZVwiLCA3KTtcbiAgICB0aGlzLnZpZXcgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sYXllciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm9wZW4gPSB0cnVlO1xuICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBMaWZlY3ljbGVcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICBjb25zdCBbc3RyaW5nc10gPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgIHRoaXMuc3RyaW5ncyA9IHN0cmluZ3M7XG4gICAgY29uc3QgeyB2aWV3IH0gPSB0aGlzO1xuICAgIHRoaXMucHJvcHMgPSB7XG4gICAgICB2aWV3LFxuICAgICAgc3RyaW5nc1xuICAgIH07XG4gICAgdGhpcy5kaXNhYmxlZCA9IHRoaXMuZGlzYWJsZWQgfHwgKGF3YWl0IHRoaXMuZ2V0RGlzYWJsZWQoKSk7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICBjb25zdCBbaW50bF0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL2ludGxcIl0pO1xuICAgIHRoaXMuaW50bCA9IGludGw7XG4gICAgdGhpcy5pbnRsLnNldExvY2FsZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZyk7XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgRXZlbnQgTGlzdGVuZXJzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgYWRkTWFwRmxvb3JJbmZvKCkge1xuICAgIHNldE1hcEZsb29ySW5mbyh0aGlzLnZpZXcpO1xuICAgIHRoaXMuZmxvb3JJbmZvQ2hhbmdlLmVtaXQoKTtcbiAgfVxuICByZW1vdmVGbG9vckluZm8oKSB7XG4gICAgcmVtb3ZlTWFwRmxvb3JJbmZvKHRoaXMudmlldyk7XG4gICAgdGhpcy5mbG9vckluZm9DaGFuZ2UuZW1pdCgpO1xuICB9XG4gIHVwZGF0ZUZsb29ySW5mbyhwcm9wcykge1xuICAgIHVwZGF0ZU1hcEZsb29ySW5mbyhwcm9wcywgdGhpcy52aWV3KTtcbiAgICB0aGlzLmZsb29ySW5mb0NoYW5nZS5lbWl0KCk7XG4gIH1cbiAgZGlzYWJsZUNvbnRhaW5lcihlKSB7XG4gICAgY29uc3QgeyBkZXRhaWwgfSA9IGU7XG4gICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5ob3N0RWxlbWVudC5jbG9zZXN0KFwiY2FsY2l0ZS1mbG93LWl0ZW1cIik7XG4gICAgaWYgKGNvbnRhaW5lcikge1xuICAgICAgY29udGFpbmVyLmRpc2FibGVkID0gZGV0YWlsO1xuICAgIH1cbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gIC8vXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGNsb3NlQWxsTGF5ZXJQaWNrZXJzKCkge1xuICAgIGNvbnN0IHBpY2tlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiYXJjZ2lzLWZsb29yLWNvbmZpZ3VyYXRpb24tbGF5ZXItcGlja2VyXCIpO1xuICAgIHBpY2tlcnMuZm9yRWFjaCgocGlja2VyKSA9PiAocGlja2VyLm9wZW4gPSBmYWxzZSkpO1xuICB9XG4gIGFzeW5jIGdldERpc2FibGVkKCkge1xuICAgIGNvbnN0IG1hcFZpZXcgPSB0aGlzLnZpZXc7XG4gICAgY29uc3QgY29tcGF0aWJsZUxheWVycyA9IGF3YWl0IGdldENvbXBhdGlibGVMYXllcnMobWFwVmlldyk7XG4gICAgY29uc3Qgc2VjdGlvbnMgPSBbXCJmYWNpbGl0eUxheWVyXCIsIFwibGV2ZWxMYXllclwiXTtcbiAgICAvLyBGb3IgZWFjaCBmbG9vckluZm9TZWN0aW9uIHdlIG5lZWQgdG8gY2hlY2sgdGhhdCBlYWNoIHBvbHlnb24gbGF5ZXIgaW4gdGhlIG1hcFxuICAgIC8vIGhhcyB0aGUgcmVxdWlyZWQgZmllbGRzIGluIG9yZGVyIHRvIGVuYWJsZSB0aGlzIGNvbXBvbmVudFxuICAgIGNvbnN0IHN1cHBvcnRlZFNlY3Rpb25zID0gc2VjdGlvbnMuZmlsdGVyKChzZWN0aW9uTmFtZSkgPT4ge1xuICAgICAgdmFyIF9hO1xuICAgICAgcmV0dXJuIChfYSA9IGNvbXBhdGlibGVMYXllcnMuZmlsdGVyKChsYXllcikgPT4gdGhpcy5oYXNSZXF1aXJlZEZpZWxkcyhsYXllciwgZ2V0UmVxdWlyZWRGaWVsZHMoc2VjdGlvbk5hbWUpKSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGg7XG4gICAgfSk7XG4gICAgcmV0dXJuICEoc3VwcG9ydGVkU2VjdGlvbnMgPT09IG51bGwgfHwgc3VwcG9ydGVkU2VjdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHN1cHBvcnRlZFNlY3Rpb25zLmxlbmd0aCk7XG4gIH1cbiAgaGFzUmVxdWlyZWRGaWVsZHMobGF5ZXIsIHJlcXVpcmVkRmllbGRzKSB7XG4gICAgaWYgKGxheWVyKSB7XG4gICAgICBjb25zdCB7IGZpZWxkc0luZGV4IH0gPSBsYXllcjtcbiAgICAgIHJldHVybiAoKGZpZWxkc0luZGV4ICYmIHJlcXVpcmVkRmllbGRzLmV2ZXJ5KChmaWVsZE5hbWUpID0+ICEhZmllbGRzSW5kZXguZ2V0KGZpZWxkTmFtZSkpKSB8fCBmYWxzZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzLCBvcGVuLCBkaXNhYmxlZCB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImNhbGNpdGUtYmxvY2tcIiwgeyBjbGFzczogQ1NTLmNvbnRhaW5lciwgaGVhZGluZzogc3RyaW5ncy5oZWFkaW5nLCBjb2xsYXBzaWJsZTogdHJ1ZSwgZGlzYWJsZWQ6IGRpc2FibGVkLCBvcGVuOiBvcGVuICYmICFkaXNhYmxlZCB9LCB0aGlzLnJlbmRlckZsb29yQ29uZmlndXJhdGlvbigpKSkpO1xuICB9XG4gIHJlbmRlckZsb29yQ29uZmlndXJhdGlvbigpIHtcbiAgICBjb25zdCB7IHN0cmluZ3MsIHZpZXcgfSA9IHRoaXM7XG4gICAgY29uc3QgbWFwID0gdmlldy5tYXA7XG4gICAgY29uc3Qgb3BlbiA9IChtYXAgPT09IG51bGwgfHwgbWFwID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXAuZmxvb3JJbmZvKSA/IHRydWUgOiBmYWxzZTtcbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJsb2NrLXNlY3Rpb25cIiwgeyB0ZXh0OiBzdHJpbmdzLmVuYWJsZSwgb3Blbjogb3BlbiwgXCJ0b2dnbGUtZGlzcGxheVwiOiBcInN3aXRjaFwiLCBvbkNhbGNpdGVCbG9ja1NlY3Rpb25Ub2dnbGU6IChlKSA9PiBlLmN1cnJlbnRUYXJnZXQub3BlbiA/IHRoaXMuYWRkTWFwRmxvb3JJbmZvKCkgOiB0aGlzLnJlbW92ZUZsb29ySW5mbygpIH0sIGgoXCJwXCIsIG51bGwsIHN0cmluZ3Muc3VtbWFyeSksIHRoaXMucmVuZGVyTGF5ZXJQaWNrZXIoXCJzaXRlTGF5ZXJcIiksIHRoaXMucmVuZGVyTGF5ZXJQaWNrZXIoXCJmYWNpbGl0eUxheWVyXCIpLCB0aGlzLnJlbmRlckxheWVyUGlja2VyKFwibGV2ZWxMYXllclwiKSwgdGhpcy5yZW5kZXJBZGRpdGlvbmFsTGF5ZXJzKCkpKTtcbiAgfVxuICByZW5kZXJMYXllclBpY2tlcihuYW1lKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzLCB2aWV3IH0gPSB0aGlzO1xuICAgIGNvbnN0IGZsb29yTGF5ZXIgPSBnZXRGbG9vckxheWVyKG5hbWUsIHZpZXcpO1xuICAgIGNvbnN0IHJlcXVpcmVkRmllbGRzID0gZ2V0UmVxdWlyZWRGaWVsZHMobmFtZSk7XG4gICAgcmV0dXJuIChoKFwiYXJjZ2lzLWZsb29yLWNvbmZpZ3VyYXRpb24tbGF5ZXItcGlja2VyXCIsIHsgdmlldzogdGhpcy52aWV3LCBsYWJlbDogc3RyaW5nc1tuYW1lXSwgc3RyaW5nczogc3RyaW5ncywgc2VsZWN0ZWRMYXllcjogZmxvb3JMYXllciwgcmVxdWlyZWRGaWVsZHM6IHJlcXVpcmVkRmllbGRzLCBvbkxpc3RDaGFuZ2U6IChlKSA9PiB0aGlzLnVwZGF0ZUZsb29ySW5mbyh7IGxheWVyOiAoZSA9PT0gbnVsbCB8fCBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlLmRldGFpbCkgPyBlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUuZGV0YWlsWzBdIDogbnVsbCwgbmFtZTogbmFtZSB9KSB9KSk7XG4gIH1cbiAgcmVuZGVyQWRkaXRpb25hbExheWVycygpIHtcbiAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1ibG9jay1zZWN0aW9uXCIsIHsgdGV4dDogc3RyaW5ncy5hZGRpdGlvbmFsTGF5ZXJzLCBvcGVuOiB0cnVlIH0sIGgoXCJhcmNnaXMtZmxvb3ItY29uZmlndXJhdGlvbi1hZGRpdGlvbmFsLWxheWVyc1wiLCB7IHZpZXc6IHRoaXMudmlldywgc3RyaW5nczogdGhpcy5zdHJpbmdzLCBvbkRpc2FibGU6IChlKSA9PiB0aGlzLmRpc2FibGVDb250YWluZXIoZSkgfSkpKTtcbiAgfVxuICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNGbG9vckFkZExheWVycyA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5saXN0Q2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJsaXN0Q2hhbmdlXCIsIDcpO1xuICAgIHRoaXMudmlldyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxheWVycyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNlbGVjdGlvbiA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLnN0cmluZ3MgPSB1bmRlZmluZWQ7XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgRXZlbnRzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgc2VsZWN0aW9uQ2hhbmdlKCkge1xuICAgIHRoaXMubGlzdENoYW5nZS5lbWl0KHRoaXMuc2VsZWN0aW9uKTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIGgoSG9zdCwgbnVsbCwgdGhpcy5yZW5kZXJQYW5lbCgpKTtcbiAgfVxuICByZW5kZXJQYW5lbCgpIHtcbiAgICByZXR1cm4gKGgoXCJzZWN0aW9uXCIsIG51bGwsIGgoXCJhcmNnaXMtZmxvb3ItY29uZmlndXJhdGlvbi1sYXllci1saXN0XCIsIHsgbGF5ZXJzOiBnZXROb25GbG9vckxheWVycyh0aGlzLnZpZXcpLCBcImZpbHRlci1lbmFibGVkXCI6IHRydWUsIG11bHRpcGxlOiB0cnVlLCBzdHJpbmdzOiB0aGlzLnN0cmluZ3MsIG9uTGlzdENoYW5nZTogKGUpID0+ICh0aGlzLnNlbGVjdGlvbiA9IGUuZGV0YWlsKSB9KSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICBcInNlbGVjdGlvblwiOiBbXCJzZWxlY3Rpb25DaGFuZ2VcIl1cbiAgfTsgfVxufTtcblxuY29uc3QgYXJjZ2lzRmxvb3JDb25maWd1cmF0aW9uQWRkTGF5ZXJzRmxvd0NzcyA9IFwiLmNvbnRlbnR7d2lkdGg6MjB2dzttYXgtd2lkdGg6NDIwcHg7bWluLXdpZHRoOjI0MHB4O21heC1oZWlnaHQ6NDB2aH1cIjtcblxuY29uc3QgQXJjZ2lzRmxvb3JBZGRMYXllcnNGbG93ID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmRvbmUgPSBjcmVhdGVFdmVudCh0aGlzLCBcImRvbmVcIiwgNyk7XG4gICAgdGhpcy5kaXNtaXNzID0gY3JlYXRlRXZlbnQodGhpcywgXCJkaXNtaXNzXCIsIDcpO1xuICAgIHRoaXMudmlldyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnN0cmluZ3MgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sYXllcnMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zZWxlY3RlZExheWVycyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm1vZGUgPSBcImNyZWF0ZVwiO1xuICB9XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBSZW5kZXIgTWV0aG9kc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gaChIb3N0LCBudWxsLCB0aGlzLnJlbmRlckZsb3coKSk7XG4gIH1cbiAgcmVuZGVyRmxvdygpIHtcbiAgICByZXR1cm4gaChcImNhbGNpdGUtZmxvd1wiLCB7IHJlZjogKGVsKSA9PiB0aGlzLmNyZWF0ZVBhbmVscyhlbCkgfSk7XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIEV2ZW50IEhhbmRsZXJzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgb25DcmVhdGUoZSkge1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5kb25lLmVtaXQoKTtcbiAgfVxuICBvbkVkaXQoZSkge1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5kb25lLmVtaXQoKTtcbiAgfVxuICBvbkRpc21pc3MoZSkge1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5kaXNtaXNzLmVtaXQoKTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUHJvdGVjdGVkIG1ldGhvZHNcbiAgLy9cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgY3JlYXRlUGFuZWxzKGVsKSB7XG4gICAgY29uc3QgeyBtb2RlIH0gPSB0aGlzO1xuICAgIGlmIChtb2RlID09PSBcImNyZWF0ZVwiKSB7XG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVBZGRMYXllcnNQYW5lbChlbCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKG1vZGUgPT09IFwiZWRpdFwiKSB7XG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVSZXBsYWNlRmllbGRzUGFuZWwoZWwpO1xuICAgIH1cbiAgfVxuICBjcmVhdGVBZGRMYXllcnNQYW5lbChmbG93KSB7XG4gICAgY29uc3QgYWRkTGF5ZXJzUGFuZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLWZsb29yLWNvbmZpZ3VyYXRpb24tYWRkLWxheWVyc1wiKTtcbiAgICBhZGRMYXllcnNQYW5lbC5zdHJpbmdzID0gdGhpcy5zdHJpbmdzO1xuICAgIGFkZExheWVyc1BhbmVsLnZpZXcgPSB0aGlzLnZpZXc7XG4gICAgYWRkTGF5ZXJzUGFuZWwuY2xhc3NMaXN0LmFkZChcImNvbnRlbnRcIik7XG4gICAgYWRkTGF5ZXJzUGFuZWwuYWRkRXZlbnRMaXN0ZW5lcihcImxpc3RDaGFuZ2VcIiwgKGUpID0+IHsgdmFyIF9hOyByZXR1cm4gKG5leHRCdXR0b24uZGlzYWJsZWQgPSAhKChfYSA9IGUuZGV0YWlsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSk7IH0pO1xuICAgIGNvbnN0IHBhbmVsID0gdGhpcy5jcmVhdGVQYW5lbCh7XG4gICAgICBoZWFkaW5nOiB0aGlzLnN0cmluZ3MuYWRkTGF5ZXJzXG4gICAgfSk7XG4gICAgcGFuZWwuYXBwZW5kQ2hpbGQoYWRkTGF5ZXJzUGFuZWwpO1xuICAgIGNvbnN0IGRpc21pc3NCdXR0b24gPSB0aGlzLmNyZWF0ZUJ1dHRvbih7XG4gICAgICBsYWJlbDogdGhpcy5zdHJpbmdzLmNhbmNlbCxcbiAgICAgIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsXG4gICAgICBldmVudExpc3RlbmVyOiB0aGlzLm9uRGlzbWlzcy5iaW5kKHRoaXMpXG4gICAgfSk7XG4gICAgcGFuZWwuYXBwZW5kQ2hpbGQoZGlzbWlzc0J1dHRvbik7XG4gICAgY29uc3QgbmV4dEJ1dHRvbiA9IHRoaXMuY3JlYXRlQnV0dG9uKHtcbiAgICAgIGxhYmVsOiB0aGlzLnN0cmluZ3MubmV4dCxcbiAgICAgIGFwcGVhcmFuY2U6IFwic29saWRcIixcbiAgICAgIGRpc2FibGVkOiB0cnVlLFxuICAgICAgZXZlbnRMaXN0ZW5lcjogKCkgPT4ge1xuICAgICAgICAvL2NvbnN0IHNlbGVjdGVkTGF5ZXJzID0gKHRoaXMuc2VsZWN0ZWRMYXllcnMgPSBhZGRMYXllcnNQYW5lbC5zZWxlY3Rpb24pO1xuICAgICAgICB0aGlzLmNyZWF0ZVNlbGVjdEZsb29yRmllbGRzUGFuZWwoYWRkTGF5ZXJzUGFuZWwuc2VsZWN0aW9uLCBmbG93KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBwYW5lbC5hcHBlbmRDaGlsZChuZXh0QnV0dG9uKTtcbiAgICBmbG93LmFwcGVuZENoaWxkKHBhbmVsKTtcbiAgfVxuICBjcmVhdGVTZWxlY3RGbG9vckZpZWxkc1BhbmVsKGxheWVycywgZmxvdykge1xuICAgIGNvbnN0IHNlbGVjdEZsb29yRmllbGRzUGFuZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLWZsb29yLWNvbmZpZ3VyYXRpb24tc2VsZWN0LWZpZWxkc1wiKTtcbiAgICBzZWxlY3RGbG9vckZpZWxkc1BhbmVsLmNsYXNzTGlzdC5hZGQoXCJjb250ZW50XCIpO1xuICAgIHNlbGVjdEZsb29yRmllbGRzUGFuZWwuc3RyaW5ncyA9IHRoaXMuc3RyaW5ncztcbiAgICBzZWxlY3RGbG9vckZpZWxkc1BhbmVsLmxheWVycyA9IGxheWVycztcbiAgICBzZWxlY3RGbG9vckZpZWxkc1BhbmVsLnZpZXcgPSB0aGlzLnZpZXc7XG4gICAgY29uc3QgcGFuZWwgPSB0aGlzLmNyZWF0ZVBhbmVsKHtcbiAgICAgIGhlYWRpbmc6IHRoaXMuc3RyaW5ncy5zZWxlY3RGbG9vckZpZWxkXG4gICAgfSk7XG4gICAgcGFuZWwuYXBwZW5kQ2hpbGQoc2VsZWN0Rmxvb3JGaWVsZHNQYW5lbCk7XG4gICAgY29uc3QgY2FuY2VsQnV0dG9uID0gdGhpcy5jcmVhdGVCdXR0b24oe1xuICAgICAgbGFiZWw6IHRoaXMuc3RyaW5ncy5jYW5jZWwsXG4gICAgICBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLFxuICAgICAgZXZlbnRMaXN0ZW5lcjogdGhpcy5vbkRpc21pc3MuYmluZCh0aGlzKVxuICAgIH0pO1xuICAgIHBhbmVsLmFwcGVuZENoaWxkKGNhbmNlbEJ1dHRvbik7XG4gICAgY29uc3QgZG9uZUJ1dHRvbiA9IHRoaXMuY3JlYXRlQnV0dG9uKHtcbiAgICAgIGxhYmVsOiB0aGlzLnN0cmluZ3MuYWRkLFxuICAgICAgYXBwZWFyYW5jZTogXCJzb2xpZFwiLFxuICAgICAgZXZlbnRMaXN0ZW5lcjogYXN5bmMgKGUpID0+IHtcbiAgICAgICAgYXdhaXQgc2VsZWN0Rmxvb3JGaWVsZHNQYW5lbC5jb21taXQoKTtcbiAgICAgICAgdGhpcy5vbkNyZWF0ZShlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBwYW5lbC5hcHBlbmRDaGlsZChkb25lQnV0dG9uKTtcbiAgICBmbG93LmFwcGVuZENoaWxkKHBhbmVsKTtcbiAgfVxuICBjcmVhdGVSZXBsYWNlRmllbGRzUGFuZWwoZmxvdykge1xuICAgIGNvbnN0IGxheWVyID0gdGhpcy5sYXllcnNbMF07XG4gICAgY29uc3QgcmVwbGFjZUZsb29yRmllbGRzUGFuZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLWZsb29yLWNvbmZpZ3VyYXRpb24tcmVwbGFjZS1maWVsZFwiKTtcbiAgICByZXBsYWNlRmxvb3JGaWVsZHNQYW5lbC5jbGFzc0xpc3QuYWRkKFwiY29udGVudFwiKTtcbiAgICByZXBsYWNlRmxvb3JGaWVsZHNQYW5lbC5zdHJpbmdzID0gdGhpcy5zdHJpbmdzO1xuICAgIHJlcGxhY2VGbG9vckZpZWxkc1BhbmVsLnZpZXcgPSB0aGlzLnZpZXc7XG4gICAgcmVwbGFjZUZsb29yRmllbGRzUGFuZWwubGF5ZXIgPSBsYXllcjtcbiAgICBjb25zdCBwYW5lbCA9IHRoaXMuY3JlYXRlUGFuZWwoe1xuICAgICAgaGVhZGluZzogbGF5ZXIudGl0bGUsXG4gICAgICBzdW1tYXJ5OiB0aGlzLnN0cmluZ3MucmVwbGFjZUZsb29yRmllbGRcbiAgICB9KTtcbiAgICBwYW5lbC5hcHBlbmRDaGlsZChyZXBsYWNlRmxvb3JGaWVsZHNQYW5lbCk7XG4gICAgY29uc3QgcmVwbGFjZUJ1dHRvbiA9IHRoaXMuY3JlYXRlQnV0dG9uKHtcbiAgICAgIGxhYmVsOiB0aGlzLnN0cmluZ3MucmVwbGFjZSxcbiAgICAgIHdpZHRoOiBcImZ1bGxcIixcbiAgICAgIGV2ZW50TGlzdGVuZXI6IGFzeW5jIChlKSA9PiB7XG4gICAgICAgIGF3YWl0IHJlcGxhY2VGbG9vckZpZWxkc1BhbmVsLmNvbW1pdCgpO1xuICAgICAgICB0aGlzLm9uRWRpdChlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBwYW5lbC5hcHBlbmRDaGlsZChyZXBsYWNlQnV0dG9uKTtcbiAgICBmbG93LmFwcGVuZENoaWxkKHBhbmVsKTtcbiAgfVxuICBjcmVhdGVQYW5lbChwYW5lbFByb3BzKSB7XG4gICAgY29uc3QgcGFuZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FsY2l0ZS1mbG93LWl0ZW1cIik7XG4gICAgcGFuZWwuaGVhZGluZyA9IHBhbmVsUHJvcHMuaGVhZGluZztcbiAgICBwYW5lbC5kZXNjcmlwdGlvbiA9IHBhbmVsUHJvcHMuc3VtbWFyeTtcbiAgICBwYW5lbC5jbG9zYWJsZSA9IHRydWU7XG4gICAgcGFuZWwuY2xvc2VkID0gZmFsc2U7XG4gICAgcGFuZWwuYWRkRXZlbnRMaXN0ZW5lcihcImNhbGNpdGVQYW5lbENsb3NlXCIsIHRoaXMub25EaXNtaXNzLmJpbmQodGhpcykpO1xuICAgIHJldHVybiBwYW5lbDtcbiAgfVxuICBjcmVhdGVCdXR0b24oYnV0dG9uUHJvcHMpIHtcbiAgICBjb25zdCB7IGFwcGVhcmFuY2UgPSBcInNvbGlkXCIsIGxhYmVsLCBldmVudExpc3RlbmVyLCB3aWR0aCA9IFwiaGFsZlwiLCBkaXNhYmxlZCA9IGZhbHNlIH0gPSBidXR0b25Qcm9wcztcbiAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FsY2l0ZS1idXR0b25cIik7XG4gICAgYnV0dG9uLnNsb3QgPSBcImZvb3RlclwiO1xuICAgIGJ1dHRvbi5hcHBlYXJhbmNlID0gYXBwZWFyYW5jZTtcbiAgICBidXR0b24uZGlzYWJsZWQgPSBkaXNhYmxlZDtcbiAgICBidXR0b24ud2lkdGggPSB3aWR0aDtcbiAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobGFiZWwpO1xuICAgIGJ1dHRvbi5hcHBlbmRDaGlsZCh0ZXh0KTtcbiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGV2ZW50TGlzdGVuZXIpO1xuICAgIHJldHVybiBidXR0b247XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0Zsb29yQWRkTGF5ZXJzRmxvdy5zdHlsZSA9IGFyY2dpc0Zsb29yQ29uZmlndXJhdGlvbkFkZExheWVyc0Zsb3dDc3M7XG5cbmNvbnN0IGFyY2dpc0Zsb29yQ29uZmlndXJhdGlvbkFkZGl0aW9uYWxMYXllcnNDc3MgPSBcIjpob3N0e2hlaWdodDoxMDAlfWNhbGNpdGUtbm90aWNle21hcmdpbi1ib3R0b206MWVtfVwiO1xuXG5jb25zdCBBcmNnaXNGbG9vckFkZGl0aW9uYWxMYXllcnMgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuZGlzbWlzcyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiZGlzbWlzc1wiLCA3KTtcbiAgICB0aGlzLmRpc2FibGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcImRpc2FibGVcIiwgNyk7XG4gICAgdGhpcy5mbG9vckluZm9DaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImZsb29ySW5mb0NoYW5nZVwiLCA3KTtcbiAgICB0aGlzLnJlUmVuZGVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudmlldyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnN0cmluZ3MgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wbGFjZW1lbnQgPSBcImJvdHRvbS1zdGFydFwiO1xuICB9XG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIExpZmVjeWNsZVxuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB7IHBvcG92ZXJOb2RlIH0gPSB0aGlzO1xuICAgIGlmIChwb3BvdmVyTm9kZSkge1xuICAgICAgcG9wb3Zlck5vZGUub3BlbiA9IGZhbHNlO1xuICAgICAgKF9hID0gcG9wb3Zlck5vZGUucGFyZW50RWxlbWVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlbW92ZUNoaWxkKHBvcG92ZXJOb2RlKTtcbiAgICB9XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUHVibGljIE1ldGhvZHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIChfYSA9IHRoaXMubGF5ZXJQYW5lbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gIH1cbiAgb3BlbigpIHtcbiAgICAvLyBUbyBhdm9pZCBmbGlja2VyIHdoZW4gdGhlIHBvcG92ZXIgYWxpZ25zIHRvIHRoZVxuICAgIC8vIHJlZmVyZW5jZUVsZW1lbnQgd2UgYWRkIGEgc21hbGwgZGVsYXkgYmVmb3JlIG9wZW5pbmdcbiAgICBzZXRUaW1lb3V0KCgpID0+ICh0aGlzLnBvcG92ZXJOb2RlLm9wZW4gPSB0cnVlKSwgMjUpO1xuICB9XG4gIGNsb3NlKGNoYW5nZXMpIHtcbiAgICB0aGlzLmRpc2FibGVDb250YWluZXIoZmFsc2UpO1xuICAgIGNvbnN0IHsgcG9wb3Zlck5vZGUgfSA9IHRoaXM7XG4gICAgcG9wb3Zlck5vZGUub3BlbiA9IGZhbHNlO1xuICAgIHBvcG92ZXJOb2RlLnJlbW92ZSgpO1xuICAgIHRoaXMucG9wb3Zlck5vZGUgPSBudWxsO1xuICAgIHRoaXMucmVSZW5kZXIgPSAhdGhpcy5yZVJlbmRlcjtcbiAgICBpZiAoY2hhbmdlcykge1xuICAgICAgdGhpcy5mbG9vckluZm9DaGFuZ2UuZW1pdCgpO1xuICAgIH1cbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBFdmVudCBMaXN0ZW5lcnNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBjcmVhdGUoKSB7XG4gICAgY29uc3QgcG9wb3Zlck5vZGUgPSB0aGlzLmNyZWF0ZVBvcG92ZXIoKTtcbiAgICBjb25zdCBjcmVhdGVGbG93ID0gdGhpcy5jcmVhdGVBZGRMYXllcnNGbG93KFwiY3JlYXRlXCIpO1xuICAgIHBvcG92ZXJOb2RlLmFwcGVuZENoaWxkKGNyZWF0ZUZsb3cpO1xuICAgIHRoaXMub3BlbigpO1xuICB9XG4gIGVkaXQoZSkge1xuICAgIGNvbnN0IGxheWVyID0gdGhpcy5nZXRTZWxlY3RlZExheWVyKGUpO1xuICAgIGNvbnN0IHBvcG92ZXJOb2RlID0gdGhpcy5jcmVhdGVQb3BvdmVyKCk7XG4gICAgY29uc3QgZWRpdEZsb3cgPSB0aGlzLmNyZWF0ZUFkZExheWVyc0Zsb3coXCJlZGl0XCIpO1xuICAgIGVkaXRGbG93LmxheWVycyA9IFtsYXllcl07XG4gICAgcG9wb3Zlck5vZGUuYXBwZW5kQ2hpbGQoZWRpdEZsb3cpO1xuICAgIHRoaXMub3BlbigpO1xuICB9XG4gIHJlbW92ZUxheWVyKGxheWVyKSB7XG4gICAgbGF5ZXIuZmxvb3JJbmZvID0gbnVsbDtcbiAgICB0aGlzLnJlUmVuZGVyID0gIXRoaXMucmVSZW5kZXI7XG4gICAgdGhpcy5mbG9vckluZm9DaGFuZ2UuZW1pdCgpO1xuICB9XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBSZW5kZXIgTWV0aG9kc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgdGhpcy5yZW5kZXJOb3RpY2UoKSwgdGhpcy5yZW5kZXJQYW5lbCgpKSk7XG4gIH1cbiAgcmVuZGVyTm90aWNlKCkge1xuICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gdGhpcztcbiAgICBjb25zdCBsYXllcnMgPSB0aGlzLmdldExheWVycygpO1xuICAgIHJldHVybiAobGF5ZXJzID09PSBudWxsIHx8IGxheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXJzLmxlbmd0aCkgPyBudWxsIDogKGgoXCJjYWxjaXRlLW5vdGljZVwiLCB7IHNjYWxlOiBcInNcIiwgd2lkdGg6IFwiYXV0b1wiLCBvcGVuOiB0cnVlIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcIm1lc3NhZ2VcIiB9LCBzdHJpbmdzLmFkZGl0aW9uYWxMYXllcnNUaXApKSk7XG4gIH1cbiAgcmVuZGVyUGFuZWwoKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzIH0gPSB0aGlzO1xuICAgIGNvbnN0IG5vbkZsb29yTGF5ZXJzID0gZ2V0Tm9uRmxvb3JMYXllcnModGhpcy52aWV3KTtcbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLXBhbmVsXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLmxheWVyUGFuZWwgPSBlbCkgfSwgdGhpcy5yZW5kZXJMYXllcnMoKSwgaChcImNhbGNpdGUtZmFiXCIsIHsgc2xvdDogXCJmYWJcIiwgaWNvbjogXCJwbHVzXCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBcInRleHQtZW5hYmxlZFwiOiB0cnVlLCBsYWJlbDogc3RyaW5ncy5hZGRMYXllcnMsIHRleHQ6IHN0cmluZ3MuYWRkTGF5ZXJzLCBkaXNhYmxlZDogbm9uRmxvb3JMYXllcnMubGVuZ3RoID09PSAwLCBzY2FsZTogXCJzXCIsIHJlZjogKGVsKSA9PiAodGhpcy50cmlnZ2VyQnV0dG9uID0gZWwpLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmNyZWF0ZSgpIH0pKSk7XG4gIH1cbiAgcmVuZGVyTGF5ZXJzKCkge1xuICAgIGNvbnN0IGxheWVycyA9IHRoaXMuZ2V0TGF5ZXJzKCk7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS12YWx1ZS1saXN0XCIsIHsgZGlyOiBcImx0clwiLCBjbGFzczogXCJjYWxjaXRlLW1vZGUtbGlnaHRcIiwgb25DbGljazogKGUpID0+IHRoaXMuZWRpdChlKSB9LCBsYXllcnMubWFwKChsYXllcikgPT4gdGhpcy5yZW5kZXJMYXllcihsYXllcikpKSk7XG4gIH1cbiAgcmVuZGVyTGF5ZXIoZmxvb3JMYXllcikge1xuICAgIGNvbnN0IHsgdGl0bGUsIGZsb29ySW5mbywgaWQgfSA9IGZsb29yTGF5ZXI7XG4gICAgY29uc3QgeyBmbG9vckZpZWxkIH0gPSBmbG9vckluZm87XG4gICAgY29uc3QgZmllbGROYW1lID0gYHske2Zsb29yRmllbGR9fWA7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS12YWx1ZS1saXN0LWl0ZW1cIiwgeyBsYWJlbDogdGl0bGUsIGRlc2NyaXB0aW9uOiBmaWVsZE5hbWUsIHZhbHVlOiBpZCB9LCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBzbG90OiBcImFjdGlvbnMtZW5kXCIsIHRleHQ6IHRoaXMuc3RyaW5ncy5yZW1vdmUsIGljb246IFwieFwiLCBvbkNsaWNrOiAoZSkgPT4ge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLnJlbW92ZUxheWVyKGZsb29yTGF5ZXIpO1xuICAgICAgfSB9KSkpO1xuICB9XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBQcm90ZWN0ZWQgbWV0aG9kc1xuICAvL1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBkaXNhYmxlQ29udGFpbmVyKGRpc2FibGUpIHtcbiAgICBjb25zdCBibG9jayA9IHRoaXMuZWwuY2xvc2VzdChcImNhbGNpdGUtYmxvY2tcIik7XG4gICAgaWYgKGJsb2NrKSB7XG4gICAgICBibG9jay5kaXNhYmxlZCA9IGRpc2FibGU7XG4gICAgfVxuICAgIHRoaXMuZGlzYWJsZS5lbWl0KGRpc2FibGUpO1xuICB9XG4gIGNyZWF0ZUFkZExheWVyc0Zsb3cobW9kZSkge1xuICAgIHRoaXMuZGlzYWJsZUNvbnRhaW5lcih0cnVlKTtcbiAgICBjb25zdCBhZGRMYXllcnNGbG93ID0gKHRoaXMuYWRkTGF5ZXJzRmxvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtZmxvb3ItY29uZmlndXJhdGlvbi1hZGQtbGF5ZXJzLWZsb3dcIikpO1xuICAgIGFkZExheWVyc0Zsb3cuc3RyaW5ncyA9IHRoaXMuc3RyaW5ncztcbiAgICBhZGRMYXllcnNGbG93LnZpZXcgPSB0aGlzLnZpZXc7XG4gICAgYWRkTGF5ZXJzRmxvdy5tb2RlID0gbW9kZTtcbiAgICBhZGRMYXllcnNGbG93LmFkZEV2ZW50TGlzdGVuZXIoXCJkb25lXCIsIHRoaXMuY2xvc2UuYmluZCh0aGlzLCB0cnVlKSk7XG4gICAgYWRkTGF5ZXJzRmxvdy5hZGRFdmVudExpc3RlbmVyKFwiZGlzbWlzc1wiLCB0aGlzLmNsb3NlLmJpbmQodGhpcywgZmFsc2UpKTtcbiAgICByZXR1cm4gYWRkTGF5ZXJzRmxvdztcbiAgfVxuICBjcmVhdGVQb3BvdmVyKCkge1xuICAgIGNvbnN0IHJlZmVyZW5jZUVsZW1lbnQgPSB0aGlzLmVsO1xuICAgIGNvbnN0IHBvcG92ZXJOb2RlID0gKHRoaXMucG9wb3Zlck5vZGUgPVxuICAgICAgZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbGNpdGUtcG9wb3ZlclwiKSk7XG4gICAgcG9wb3Zlck5vZGUuY2xhc3NMaXN0LmFkZChcImpzLWFwcC1wcmltYXJ5LWZseW91dFwiKTtcbiAgICBwb3BvdmVyTm9kZS5yZWZlcmVuY2VFbGVtZW50ID0gcmVmZXJlbmNlRWxlbWVudDtcbiAgICBwb3BvdmVyTm9kZS5vZmZzZXREaXN0YW5jZSA9IC01NTA7XG4gICAgcG9wb3Zlck5vZGUub2Zmc2V0U2tpZGRpbmcgPSAwO1xuICAgIHBvcG92ZXJOb2RlLmxhYmVsID0gdGhpcy5zdHJpbmdzLmFkZExheWVycztcbiAgICBwb3BvdmVyTm9kZS5wbGFjZW1lbnQgPSBcImJvdHRvbS1zdGFydFwiO1xuICAgIHBvcG92ZXJOb2RlLnBvaW50ZXJEaXNhYmxlZCA9IHRydWU7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChwb3BvdmVyTm9kZSk7XG4gICAgcmV0dXJuIHBvcG92ZXJOb2RlO1xuICB9XG4gIGdldFNlbGVjdGVkTGF5ZXIoZSkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XG4gICAgaWYgKCgoX2EgPSBlLnRhcmdldCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxvY2FsTmFtZSkgPT09IFwiY2FsY2l0ZS12YWx1ZS1saXN0LWl0ZW1cIiB8fFxuICAgICAgKChfYyA9IChfYiA9IGUudGFyZ2V0KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IucGFyZW50RWxlbWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmxvY2FsTmFtZSkgPT09IFwiY2FsY2l0ZS12YWx1ZS1saXN0LWl0ZW1cIikge1xuICAgICAgY29uc3QgaWQgPSAoX2QgPSBlLnRhcmdldC52YWx1ZSkgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogKF9lID0gZS50YXJnZXQucGFyZW50RWxlbWVudCkgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLnZhbHVlO1xuICAgICAgcmV0dXJuIHRoaXMuZmluZExheWVyKGlkKTtcbiAgICB9XG4gIH1cbiAgZ2V0TGF5ZXJzKCkge1xuICAgIGNvbnN0IG1hcFZpZXcgPSB0aGlzLnZpZXc7XG4gICAgY29uc3QgeyBtYXAgfSA9IG1hcFZpZXc7XG4gICAgY29uc3QgeyBhbGxMYXllcnMgfSA9IG1hcDtcbiAgICBsZXQgbGF5ZXJzID0gW107XG4gICAgYWxsTGF5ZXJzLmZvckVhY2goKGxheWVyKSA9PiB7XG4gICAgICBjb25zdCB7IHR5cGUsIGZsb29ySW5mbyB9ID0gbGF5ZXI7XG4gICAgICBpZiAodHlwZSA9PT0gXCJtYXAtaW1hZ2VcIikge1xuICAgICAgICBjb25zdCB7IGFsbFN1YmxheWVycyB9ID0gbGF5ZXI7XG4gICAgICAgIGxheWVycyA9IGxheWVycy5jb25jYXQoYWxsU3VibGF5ZXJzLmZpbHRlcigoc3ViTGF5ZXIpID0+IHN1YkxheWVyLmZpZWxkc0luZGV4ICYmIChzdWJMYXllciA9PT0gbnVsbCB8fCBzdWJMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3ViTGF5ZXIuZmxvb3JJbmZvKSkudG9BcnJheSgpKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGZsb29ySW5mbykge1xuICAgICAgICBsYXllcnMucHVzaChsYXllcik7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGxheWVycztcbiAgfVxuICBmaW5kTGF5ZXIobGF5ZXJJZCkge1xuICAgIGNvbnN0IGxheWVycyA9IHRoaXMuZ2V0TGF5ZXJzKCk7XG4gICAgcmV0dXJuIGxheWVycyA9PT0gbnVsbCB8fCBsYXllcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxheWVycy5maW5kKChsYXllcikgPT4gbGF5ZXIuaWQgPT09IGxheWVySWQpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNGbG9vckFkZGl0aW9uYWxMYXllcnMuc3R5bGUgPSBhcmNnaXNGbG9vckNvbmZpZ3VyYXRpb25BZGRpdGlvbmFsTGF5ZXJzQ3NzO1xuXG5jb25zdCBBcmNnaXNGaWVsZExpc3QgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMubGlzdENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibGlzdENoYW5nZVwiLCA3KTtcbiAgICB0aGlzLmxheWVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2VsZWN0aW9uID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuZmlsdGVyRW5hYmxlZCA9IHRydWU7XG4gICAgdGhpcy5tdWx0aXBsZSA9IGZhbHNlO1xuICAgIHRoaXMuc3RyaW5ncyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmZpZWxkVHlwZSA9IFwic3RyaW5nXCI7XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIFJlbmRlciBNZXRob2RzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiY2FsY2l0ZS1waWNrLWxpc3RcIiwgeyBcImZpbHRlci1lbmFibGVkXCI6IHRoaXMuZmlsdGVyRW5hYmxlZCwgXCJmaWx0ZXItcGxhY2Vob2xkZXJcIjogdGhpcy5zdHJpbmdzLmZpbHRlciwgbXVsdGlwbGU6IHRoaXMubXVsdGlwbGUsIG9uQ2xpY2s6IChlKSA9PiB0aGlzLm9uTGlzdENoYW5nZShlKSB9LCB0aGlzLnJlbmRlckZpZWxkcygpKSkpO1xuICB9XG4gIHJlbmRlckZpZWxkcygpIHtcbiAgICBsZXQgZmllbGRzID0gdGhpcy5nZXRGaWVsZHMoKTtcbiAgICByZXR1cm4gKGZpZWxkcyB8fCBbXSkubWFwKChmaWVsZCkgPT4gdGhpcy5yZW5kZXJGaWVsZChmaWVsZCkpO1xuICB9XG4gIHJlbmRlckZpZWxkKGZpZWxkKSB7XG4gICAgY29uc3QgZmllbGROYW1lID0gYHske2ZpZWxkLm5hbWV9fWA7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1waWNrLWxpc3QtaXRlbVwiLCB7IGxhYmVsOiBmaWVsZC5hbGlhcywgZGVzY3JpcHRpb246IGZpZWxkTmFtZSwgc2VsZWN0ZWQ6IHRoaXMuc2VsZWN0aW9uLmhhcyhmaWVsZC5uYW1lKSwgdmFsdWU6IGZpZWxkLm5hbWUgfSkpO1xuICB9XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgLy9cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgb25MaXN0Q2hhbmdlKGUpIHtcbiAgICBjb25zdCB7IHNlbGVjdGlvbiB9ID0gdGhpcztcbiAgICB0aGlzLnVwZGF0ZVNlbGVjdGlvbihlKTtcbiAgICB0aGlzLmxpc3RDaGFuZ2UuZW1pdChBcnJheS5mcm9tKHNlbGVjdGlvbi52YWx1ZXMoKSkpO1xuICB9XG4gIHVwZGF0ZVNlbGVjdGlvbihlKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZTtcbiAgICBpZiAoKChfYSA9IGUudGFyZ2V0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubG9jYWxOYW1lKSA9PT0gXCJjYWxjaXRlLXBpY2stbGlzdC1pdGVtXCIgfHxcbiAgICAgICgoX2MgPSAoX2IgPSBlLnRhcmdldCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnBhcmVudEVsZW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5sb2NhbE5hbWUpID09PSBcImNhbGNpdGUtcGljay1saXN0LWl0ZW1cIikge1xuICAgICAgY29uc3QgeyBzZWxlY3Rpb24gfSA9IHRoaXM7XG4gICAgICBjb25zdCBzZWxlY3RlZEZpZWxkTmFtZSA9IChfZCA9IGUudGFyZ2V0LnZhbHVlKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiAoX2UgPSBlLnRhcmdldC5wYXJlbnRFbGVtZW50KSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UudmFsdWU7XG4gICAgICBjb25zdCBpc1JlbW92ZWQgPSBzZWxlY3Rpb24uaGFzKHNlbGVjdGVkRmllbGROYW1lKTtcbiAgICAgIGNvbnN0IHNlbGVjdGVkRmllbGQgPSB0aGlzLmZpbmRGaWVsZChzZWxlY3RlZEZpZWxkTmFtZSk7XG4gICAgICBpZiAoIXRoaXMubXVsdGlwbGUpIHtcbiAgICAgICAgc2VsZWN0aW9uLmNsZWFyKCk7XG4gICAgICB9XG4gICAgICBpZiAoIWlzUmVtb3ZlZCkge1xuICAgICAgICB0aGlzLnNlbGVjdGlvbi5zZXQoc2VsZWN0ZWRGaWVsZE5hbWUsIHNlbGVjdGVkRmllbGQpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uLmRlbGV0ZShzZWxlY3RlZEZpZWxkLm5hbWUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBnZXRGaWVsZHMoKSB7XG4gICAgY29uc3QgeyBsYXllciwgZmllbGRUeXBlIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgZmllbGRzIH0gPSBsYXllcjtcbiAgICByZXR1cm4gKGZpZWxkcyA9PT0gbnVsbCB8fCBmaWVsZHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkcy5sZW5ndGgpXG4gICAgICA/IGZpZWxkcy5maWx0ZXIoKGZpZWxkKSA9PiAhZmllbGRUeXBlIHx8IChmaWVsZCA9PT0gbnVsbCB8fCBmaWVsZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmllbGQudHlwZSkgPT09IGZpZWxkVHlwZSlcbiAgICAgIDogW107XG4gIH1cbiAgZmluZEZpZWxkKG5hbWUpIHtcbiAgICBjb25zdCB7IGxheWVyIH0gPSB0aGlzO1xuICAgIHJldHVybiBsYXllci5maWVsZHNJbmRleC5nZXQobmFtZSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcblxuY29uc3QgQXJjZ2lzRmxvb3JGaWVsZFBpY2tlciA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5pY29uRW5kID0gXCJwZW5jaWxcIjtcbiAgICB0aGlzLmxhYmVsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubGF5ZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wbGFjZW1lbnQgPSBcImF1dG9cIjtcbiAgICB0aGlzLm9wZW4gPSB1bmRlZmluZWQ7XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIFJlbmRlciBNZXRob2RzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcmVuZGVyKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBidXR0b25UZXh0ID0gKChfYSA9IHRoaXMubGF5ZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50aXRsZSkgfHwgdGhpcy5zdHJpbmdzLm5vbmU7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMubGFiZWwsIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBzY2FsZTogXCJtXCIsIFwiaWNvbi1lbmRcIjogdGhpcy5pY29uRW5kLCByZWY6IChlbCkgPT4gKHRoaXMudHJpZ2dlckJ1dHRvbiA9IGVsKSwgb25DbGljazogKCkgPT4gKHRoaXMub3BlbiA9ICF0aGlzLm9wZW4pIH0sIGJ1dHRvblRleHQpKSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IGxhYmVsOiB0aGlzLmxhYmVsLCBwb2ludGVyRGlzYWJsZWQ6IHRydWUsIHJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMudHJpZ2dlckJ1dHRvbiwgb3BlbjogdGhpcy5vcGVuLCBjbG9zYWJsZTogdHJ1ZSwgcGxhY2VtZW50OiB0aGlzLnBsYWNlbWVudCB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29udGVudFwiIH0sIGgoXCJzbG90XCIsIG51bGwpKSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNGbG9vckNvbmZpZ3VyYXRpb25GaWVsZFNlbGVjdCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5sYXllciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnN0cmluZ3MgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5maWVsZCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmZpZWxkVHlwZSA9IFwic3RyaW5nXCI7XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgTGlmZWN5Y2xlXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5vblNlbGVjdENoYW5nZSgpO1xuICB9XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBQcml2YXRlIEZ1bmN0aW9uc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGZpbmRGaWVsZChmaWVsZE5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy5sYXllci5maWVsZHNJbmRleC5nZXQoZmllbGROYW1lKTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgRXZlbnQgSGFuZGxlcnNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBvblNlbGVjdENoYW5nZSgpIHtcbiAgICBjb25zdCB7IHNlbGVjdCB9ID0gdGhpcztcbiAgICBjb25zdCBzZWxlY3RlZE9wdGlvbiA9IHNlbGVjdCA9PT0gbnVsbCB8fCBzZWxlY3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdC5zZWxlY3RlZE9wdGlvbjtcbiAgICB0aGlzLmZpZWxkID0gc2VsZWN0ZWRPcHRpb25cbiAgICAgID8gdGhpcy5maW5kRmllbGQoc2VsZWN0ZWRPcHRpb24udmFsdWUpXG4gICAgICA6IHRoaXMuZmllbGQgfHwgdGhpcy5nZXRGaWVsZHMoKVswXTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyB0aXRsZSB9ID0gdGhpcy5sYXllcjtcbiAgICBjb25zdCBmaWVsZHMgPSB0aGlzLmdldEZpZWxkcygpO1xuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCB0aXRsZSwgaChcImNhbGNpdGUtc2VsZWN0XCIsIHsgbGFiZWw6IFwic2VsZWN0XCIsIHJlZjogKGUpID0+ICh0aGlzLnNlbGVjdCA9IGUpLCBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6ICgpID0+IHRoaXMub25TZWxlY3RDaGFuZ2UoKSB9LCBmaWVsZHMubWFwKChmaWVsZCkgPT4gdGhpcy5yZW5kZXJGaWVsZChmaWVsZCkpKSkpKTtcbiAgfVxuICByZW5kZXJGaWVsZChmaWVsZCkge1xuICAgIHJldHVybiBoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyBsYWJlbDogZmllbGQuYWxpYXMsIHZhbHVlOiBmaWVsZC5uYW1lIH0pO1xuICB9XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgLy9cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgZ2V0RmllbGRzKCkge1xuICAgIGNvbnN0IHsgbGF5ZXIsIGZpZWxkVHlwZSB9ID0gdGhpcztcbiAgICBjb25zdCB7IGZpZWxkcyB9ID0gbGF5ZXI7XG4gICAgcmV0dXJuIChmaWVsZHMgPT09IG51bGwgfHwgZmllbGRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZHMubGVuZ3RoKVxuICAgICAgPyBmaWVsZHMuZmlsdGVyKChmaWVsZCkgPT4gIWZpZWxkVHlwZSB8fCAoZmllbGQgPT09IG51bGwgfHwgZmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkLnR5cGUpID09PSBmaWVsZFR5cGUpXG4gICAgICA6IFtdO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IEFyY2dpc0xheWVyTGlzdCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5saXN0Q2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJsaXN0Q2hhbmdlXCIsIDcpO1xuICAgIHRoaXMubGF5ZXJzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2VsZWN0aW9uID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuZmlsdGVyRW5hYmxlZCA9IHRydWU7XG4gICAgdGhpcy5tdWx0aXBsZSA9IGZhbHNlO1xuICAgIHRoaXMuc3RyaW5ncyA9IHVuZGVmaW5lZDtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJjYWxjaXRlLXBpY2stbGlzdFwiLCB7IFwiZmlsdGVyLWVuYWJsZWRcIjogdGhpcy5maWx0ZXJFbmFibGVkLCBcImZpbHRlci1wbGFjZWhvbGRlclwiOiB0aGlzLnN0cmluZ3MuZmlsdGVyLCBtdWx0aXBsZTogdGhpcy5tdWx0aXBsZSwgb25DbGljazogKGUpID0+IHRoaXMub25MaXN0Q2hhbmdlKGUpIH0sIHRoaXMucmVuZGVyTGF5ZXJzKCkpKSk7XG4gIH1cbiAgcmVuZGVyTGF5ZXJzKCkge1xuICAgIGNvbnN0IHsgbGF5ZXJzLCBzZWxlY3Rpb24gfSA9IHRoaXM7XG4gICAgcmV0dXJuIChsYXllcnMgfHwgW10pLm1hcCgobGF5ZXIpID0+IChoKFwiY2FsY2l0ZS1waWNrLWxpc3QtaXRlbVwiLCB7IGxhYmVsOiBsYXllci50aXRsZSwgZGVzY3JpcHRpb246IHRoaXMuZ2V0TGF5ZXJUeXBlKGxheWVyKSwgc2VsZWN0ZWQ6IHNlbGVjdGlvbi5oYXMobGF5ZXIuaWQpLCB2YWx1ZTogbGF5ZXIuaWQgfSkpKTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gIC8vXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIG9uTGlzdENoYW5nZShlKSB7XG4gICAgY29uc3QgeyBzZWxlY3Rpb24gfSA9IHRoaXM7XG4gICAgdGhpcy51cGRhdGVTZWxlY3Rpb24oZSk7XG4gICAgdGhpcy5saXN0Q2hhbmdlLmVtaXQoQXJyYXkuZnJvbShzZWxlY3Rpb24udmFsdWVzKCkpKTtcbiAgfVxuICB1cGRhdGVTZWxlY3Rpb24oZSkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XG4gICAgaWYgKCgoX2EgPSBlLnRhcmdldCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxvY2FsTmFtZSkgPT09IFwiY2FsY2l0ZS1waWNrLWxpc3QtaXRlbVwiIHx8XG4gICAgICAoKF9jID0gKF9iID0gZS50YXJnZXQpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5wYXJlbnRFbGVtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MubG9jYWxOYW1lKSA9PT0gXCJjYWxjaXRlLXBpY2stbGlzdC1pdGVtXCIpIHtcbiAgICAgIGNvbnN0IHsgc2VsZWN0aW9uIH0gPSB0aGlzO1xuICAgICAgY29uc3Qgc2VsZWN0ZWRMYXllcklkID0gKF9kID0gZS50YXJnZXQudmFsdWUpICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IChfZSA9IGUudGFyZ2V0LnBhcmVudEVsZW1lbnQpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS52YWx1ZTtcbiAgICAgIGNvbnN0IGlzUmVtb3ZlZCA9IHNlbGVjdGlvbi5oYXMoc2VsZWN0ZWRMYXllcklkKTtcbiAgICAgIGNvbnN0IHNlbGVjdGVkTGF5ZXIgPSB0aGlzLmZpbmRMYXllcihzZWxlY3RlZExheWVySWQpO1xuICAgICAgaWYgKCF0aGlzLm11bHRpcGxlKSB7XG4gICAgICAgIHNlbGVjdGlvbi5jbGVhcigpO1xuICAgICAgfVxuICAgICAgaWYgKCFpc1JlbW92ZWQpIHtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb24uc2V0KHNlbGVjdGVkTGF5ZXIuaWQsIHNlbGVjdGVkTGF5ZXIpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uLmRlbGV0ZShzZWxlY3RlZExheWVyLmlkKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgZmluZExheWVyKGxheWVySWQpIHtcbiAgICBjb25zdCB7IGxheWVycyB9ID0gdGhpcztcbiAgICByZXR1cm4gbGF5ZXJzID09PSBudWxsIHx8IGxheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXJzLmZpbmQoKGxheWVyKSA9PiBsYXllci5pZCA9PT0gbGF5ZXJJZCk7XG4gIH1cbiAgZ2V0TGF5ZXJUeXBlKGxheWVyKSB7XG4gICAgY29uc3QgeyBsYXllclR5cGVzIH0gPSB0aGlzLnN0cmluZ3M7XG4gICAgY29uc3QgeyBnZW9tZXRyeVR5cGUgPSBcInVua25vd25cIiwgc291cmNlSlNPTiB9ID0gbGF5ZXI7XG4gICAgcmV0dXJuIGdlb21ldHJ5VHlwZSAhPT0gXCJ1bmtub3duXCJcbiAgICAgID8gbGF5ZXJUeXBlc1tnZW9tZXRyeVR5cGVdXG4gICAgICA6IGxheWVyVHlwZXNbdGhpcy5qc29uVHlwZVRvTGF5ZXJUeXBlKHNvdXJjZUpTT04gPT09IG51bGwgfHwgc291cmNlSlNPTiA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlSlNPTi5nZW9tZXRyeVR5cGUpXTtcbiAgfVxuICBqc29uVHlwZVRvTGF5ZXJUeXBlKHR5cGUpIHtcbiAgICBpZiAodHlwZSA9PT0gXCJlc3JpR2VvbWV0cnlQb2x5Z29uXCIpIHtcbiAgICAgIHJldHVybiBcInBvbHlnb25cIjtcbiAgICB9XG4gICAgZWxzZSBpZiAodHlwZSA9PT0gXCJlc3JpR2VvbWV0cnlQb2ludFwiKSB7XG4gICAgICByZXR1cm4gXCJwb2ludFwiO1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlID09PSBcImVzcmlHZW9tZXRyeVBvbHlsaW5lXCIpIHtcbiAgICAgIHJldHVybiBcImxpbmVcIjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXR1cm4gXCJ1bmtub3duXCI7XG4gICAgfVxuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IGFyY2dpc0Zsb29yQ29uZmlndXJhdGlvbkxheWVyUGlja2VyQ3NzID0gXCJjYWxjaXRlLWxhYmVsIHNwYW57d2lkdGg6MTAwJTtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW59Y2FsY2l0ZS1sYWJlbCBzcGFuIGNhbGNpdGUtYWN0aW9ue21hcmdpbi1sZWZ0OjAuM2VtfS5hcmNnaXMtLXJ0bCBjYWxjaXRlLWxhYmVsIHNwYW4gY2FsY2l0ZS1hY3Rpb257bWFyZ2luLWxlZnQ6YXV0bzttYXJnaW4tcmlnaHQ6MC4zZW19XCI7XG5cbmNvbnN0IEFyY2dpc0xheWVyUGlja2VyID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmxpc3RDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImxpc3RDaGFuZ2VcIiwgNyk7XG4gICAgdGhpcy5zZWxlY3RlZExheWVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudmlldyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmljb25FbmQgPSBcInBlbmNpbFwiO1xuICAgIHRoaXMubGFiZWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wbGFjZW1lbnQgPSBcImJvdHRvbS1zdGFydFwiO1xuICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgIHRoaXMuc3RyaW5ncyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnJlcXVpcmVkRmllbGRzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZ2VvbWV0cnlUeXBlID0gXCJwb2x5Z29uXCI7XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgRXZlbnRzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgY2FsY2l0ZVBvcG92ZXJDbG9zZUhhbmRsZXIoKSB7XG4gICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUHVibGljXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgYXN5bmMgc2V0Rm9jdXMoKSB7XG4gICAgaWYgKHRoaXMucGFuZWwpIHtcbiAgICAgIHJldHVybiB0aGlzLnBhbmVsLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBzZWxlY3RlZExheWVyIH0gPSB0aGlzO1xuICAgIGNvbnN0IGJ1dHRvblRleHQgPSAoc2VsZWN0ZWRMYXllciA9PT0gbnVsbCB8fCBzZWxlY3RlZExheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZExheWVyLnRpdGxlKSB8fCB0aGlzLnN0cmluZ3Mubm9uZTtcbiAgICBjb25zdCBsYXllcnMgPSB0aGlzLmdldExheWVycygpO1xuICAgIGNvbnN0IGRpc2FibGVkID0gdGhpcy5vcGVuIHx8ICEobGF5ZXJzID09PSBudWxsIHx8IGxheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXJzLmxlbmd0aCk7XG4gICAgY29uc3Qgc2VsZWN0aW9uID0gbmV3IE1hcCgpO1xuICAgIGlmIChzZWxlY3RlZExheWVyKSB7XG4gICAgICBzZWxlY3Rpb24uc2V0KHNlbGVjdGVkTGF5ZXIuaWQsIHNlbGVjdGVkTGF5ZXIpO1xuICAgIH1cbiAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgdGhpcy5sYWJlbCwgaChcInNwYW5cIiwgbnVsbCwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgYWxpZ25tZW50OiBcImljb24tZW5kLXNwYWNlLWJldHdlZW5cIiwga2luZDogXCJuZXV0cmFsXCIsIHNjYWxlOiBcIm1cIiwgXCJpY29uLWVuZFwiOiBcInBlbmNpbFwiLCB3aWR0aDogXCJmdWxsXCIsIGRpc2FibGVkOiBkaXNhYmxlZCwgcmVmOiAoZWwpID0+ICh0aGlzLnRyaWdnZXJCdXR0b24gPSBlbCksIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgdGhpcy5vcGVuID0gIXRoaXMub3BlbjtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnNldEZvY3VzKCksIDI1KTtcbiAgICAgIH0gfSwgYnV0dG9uVGV4dCksIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IGljb246IFwieFwiLCBzY2FsZTogXCJzXCIsIHRleHQ6IHRoaXMuc3RyaW5ncy5jbGVhciwgZGlzYWJsZWQ6ICF0aGlzLnNlbGVjdGVkTGF5ZXIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZExheWVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5saXN0Q2hhbmdlLmVtaXQoKTtcbiAgICAgIH0gfSkpKSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IGxhYmVsOiB0aGlzLmxhYmVsLCBwb2ludGVyRGlzYWJsZWQ6IHRydWUsIHJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMudHJpZ2dlckJ1dHRvbiwgb3BlbjogdGhpcy5vcGVuLCBwbGFjZW1lbnQ6IHRoaXMucGxhY2VtZW50LCByZWY6IChlbCkgPT4gKHRoaXMucG9wb3Zlck5vZGUgPSBlbCkgfSwgaChcImNhbGNpdGUtcGFuZWxcIiwgeyBoZWFkaW5nOiB0aGlzLmxhYmVsLCBjbG9zZWQ6IGZhbHNlLCBcIndpZHRoLXNjYWxlXCI6IFwibVwiLCBcImhlaWdodC1zY2FsZVwiOiBcIm1cIiwgcmVmOiAoZWwpID0+ICh0aGlzLnBhbmVsID0gZWwpIH0sIGgoXCJhcmNnaXMtZmxvb3ItY29uZmlndXJhdGlvbi1sYXllci1saXN0XCIsIHsgc3RyaW5nczogdGhpcy5zdHJpbmdzLCBsYXllcnM6IGxheWVycywgc2VsZWN0aW9uOiBzZWxlY3Rpb24sIG9uTGlzdENoYW5nZTogKGUpID0+ICh0aGlzLnNlbGVjdGVkTGF5ZXIgPSBlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUuZGV0YWlsWzBdKSB9KSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgd2lkdGg6IFwiZnVsbFwiLCBzbG90OiBcImZvb3RlclwiLCBvbkNsaWNrOiAoKSA9PiAodGhpcy5vcGVuID0gZmFsc2UpIH0sIHRoaXMuc3RyaW5ncy5kb25lKSkpKSk7XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAvL1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBnZXRMYXllcnMoKSB7XG4gICAgY29uc3QgY29tcGF0aWJsZUxheWVycyA9IHRoaXMuZ2V0Q29tcGF0aWJsZUxheWVycygpO1xuICAgIHJldHVybiAoY29tcGF0aWJsZUxheWVycyA9PT0gbnVsbCB8fCBjb21wYXRpYmxlTGF5ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb21wYXRpYmxlTGF5ZXJzLmxlbmd0aClcbiAgICAgID8gY29tcGF0aWJsZUxheWVycy5maWx0ZXIoKGxheWVyKSA9PiB0aGlzLmNoZWNrUmVxdWlyZWRGaWVsZHMobGF5ZXIpKVxuICAgICAgOiBbXTtcbiAgfVxuICBnZXRDb21wYXRpYmxlTGF5ZXJzKCkge1xuICAgIGNvbnN0IHsgZ2VvbWV0cnlUeXBlIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgbWFwIH0gPSB0aGlzLnZpZXc7XG4gICAgY29uc3QgeyBhbGxMYXllcnMgfSA9IG1hcDtcbiAgICBsZXQgY29tcGF0aWJsZUxheWVycyA9IFtdO1xuICAgIGFsbExheWVycy5mb3JFYWNoKChsYXllcikgPT4ge1xuICAgICAgY29uc3QgeyB0eXBlIH0gPSBsYXllcjtcbiAgICAgIGlmICh0eXBlID09PSBcIm1hcC1pbWFnZVwiKSB7XG4gICAgICAgIGNvbnN0IHsgYWxsU3VibGF5ZXJzIH0gPSBsYXllcjtcbiAgICAgICAgY29tcGF0aWJsZUxheWVycyA9IGNvbXBhdGlibGVMYXllcnMuY29uY2F0KGFsbFN1YmxheWVycy5maWx0ZXIoKHN1YkxheWVyKSA9PiBzdWJMYXllci5maWVsZHNJbmRleCkudG9BcnJheSgpKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKCh0eXBlID09PSBcImZlYXR1cmVcIiAmJiAhZ2VvbWV0cnlUeXBlKSB8fCAobGF5ZXIgPT09IG51bGwgfHwgbGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxheWVyLmdlb21ldHJ5VHlwZSkgPT09IGdlb21ldHJ5VHlwZSkge1xuICAgICAgICBjb21wYXRpYmxlTGF5ZXJzLnB1c2gobGF5ZXIpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBjb21wYXRpYmxlTGF5ZXJzO1xuICB9XG4gIGNoZWNrUmVxdWlyZWRGaWVsZHMobGF5ZXIpIHtcbiAgICBjb25zdCB7IHJlcXVpcmVkRmllbGRzIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgZmllbGRzSW5kZXggfSA9IGxheWVyO1xuICAgIHJldHVybiByZXF1aXJlZEZpZWxkcyAmJiBmaWVsZHNJbmRleFxuICAgICAgPyByZXF1aXJlZEZpZWxkcy5ldmVyeSgoZmllbGROYW1lKSA9PiBmaWVsZHNJbmRleC5nZXQoZmllbGROYW1lKSlcbiAgICAgIDogdHJ1ZTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzTGF5ZXJQaWNrZXIuc3R5bGUgPSBhcmNnaXNGbG9vckNvbmZpZ3VyYXRpb25MYXllclBpY2tlckNzcztcblxuY29uc3QgYXJjZ2lzRmxvb3JDb25maWd1cmF0aW9uUmVwbGFjZUZpZWxkQ3NzID0gXCJzZWN0aW9ue3BhZGRpbmc6MC41cmVtIDAuNzVyZW07YmFja2dyb3VuZC1jb2xvcjp3aGl0ZX1cIjtcblxuY29uc3QgQXJjZ2lzRmxvb3JSZXBsYWNlRmllbGQgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMudmlldyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxheWVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc3RyaW5ncyA9IHVuZGVmaW5lZDtcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBQdWJsaWNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBhc3luYyBjb21taXQoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlKSA9PiB7XG4gICAgICBjb25zdCBsaXN0cyA9IEFycmF5LmZyb20odGhpcy5lbC5zaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3JBbGwoXCJhcmNnaXMtZmllbGQtbGlzdFwiKSk7XG4gICAgICBsaXN0cy5tYXAoKGxpc3QpID0+IHNldEZsb29ySW5mbyhsaXN0KSk7XG4gICAgICByZXNvbHZlKCk7XG4gICAgfSk7XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIFJlbmRlciBNZXRob2RzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiBoKEhvc3QsIG51bGwsIHRoaXMucmVuZGVyUGFuZWwoKSk7XG4gIH1cbiAgcmVuZGVyUGFuZWwoKSB7XG4gICAgY29uc3QgbGF5ZXIgPSB0aGlzLmxheWVyO1xuICAgIGNvbnN0IGZpZWxkID0gdGhpcy5maW5kRmllbGQobGF5ZXIuZmxvb3JJbmZvLmZsb29yRmllbGQpO1xuICAgIGNvbnN0IGZpZWxkU2VsZWN0aW9uID0gbmV3IE1hcCgpO1xuICAgIGZpZWxkU2VsZWN0aW9uLnNldChmaWVsZC5uYW1lLCBmaWVsZCk7XG4gICAgcmV0dXJuIChoKFwic2VjdGlvblwiLCBudWxsLCBoKFwiYXJjZ2lzLWZsb29yLWNvbmZpZ3VyYXRpb24tZmllbGQtbGlzdFwiLCB7IHN0cmluZ3M6IHRoaXMuc3RyaW5ncywgbGF5ZXI6IGxheWVyLCBzZWxlY3Rpb246IGZpZWxkU2VsZWN0aW9uIH0pKSk7XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIFByb3RlY3RlZCBtZXRob2RzXG4gIC8vXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGZpbmRGaWVsZChuYW1lKSB7XG4gICAgY29uc3QgbGF5ZXIgPSB0aGlzLmxheWVyO1xuICAgIHJldHVybiBsYXllci5maWVsZHNJbmRleC5nZXQobmFtZSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0Zsb29yUmVwbGFjZUZpZWxkLnN0eWxlID0gYXJjZ2lzRmxvb3JDb25maWd1cmF0aW9uUmVwbGFjZUZpZWxkQ3NzO1xuXG5jb25zdCBhcmNnaXNGbG9vckNvbmZpZ3VyYXRpb25TZWxlY3RGaWVsZHNDc3MgPSBcInNlY3Rpb257cGFkZGluZzowLjVyZW0gMC43NXJlbTtiYWNrZ3JvdW5kLWNvbG9yOndoaXRlfVwiO1xuXG5jb25zdCBBcmNnaXNGbG9vclNlbGVjdEZpZWxkcyA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy52aWV3ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubGF5ZXJzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc3RyaW5ncyA9IHVuZGVmaW5lZDtcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBQdWJsaWMgTWV0aG9kc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGFzeW5jIGNvbW1pdCgpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgKHJlc29sdmUpID0+IHtcbiAgICAgIGNvbnN0IHNlbGVjdHMgPSBBcnJheS5mcm9tKHRoaXMuZWwuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yQWxsKFwiYXJjZ2lzLWZsb29yLWNvbmZpZ3VyYXRpb24tZmllbGQtc2VsZWN0XCIpKTtcbiAgICAgIHNlbGVjdHMuZm9yRWFjaCgoc2VsZWN0KSA9PiBzZXRGbG9vckluZm8oc2VsZWN0KSk7XG4gICAgICByZXNvbHZlKCk7XG4gICAgfSk7XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIFJlbmRlciBNZXRob2RzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiBoKEhvc3QsIG51bGwsIHRoaXMucmVuZGVyUGFuZWwoKSk7XG4gIH1cbiAgcmVuZGVyUGFuZWwoKSB7XG4gICAgY29uc3QgeyBsYXllcnMgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKFwic2VjdGlvblwiLCBudWxsLCBoKFwicFwiLCBudWxsLCB0aGlzLnN0cmluZ3Muc2VsZWN0TWVzc2FnZSksIGxheWVycy5tYXAoKGxheWVyKSA9PiB0aGlzLnJlbmRlclNlbGVjdChsYXllcikpKSk7XG4gIH1cbiAgcmVuZGVyU2VsZWN0KGxheWVyKSB7XG4gICAgcmV0dXJuIGgoXCJhcmNnaXMtZmxvb3ItY29uZmlndXJhdGlvbi1maWVsZC1zZWxlY3RcIiwgeyBzdHJpbmdzOiB0aGlzLnN0cmluZ3MsIGxheWVyOiBsYXllciB9KTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzRmxvb3JTZWxlY3RGaWVsZHMuc3R5bGUgPSBhcmNnaXNGbG9vckNvbmZpZ3VyYXRpb25TZWxlY3RGaWVsZHNDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc0Zsb29yQ29uZmlndXJhdGlvbiBhcyBhcmNnaXNfZmxvb3JfY29uZmlndXJhdGlvbiwgQXJjZ2lzRmxvb3JBZGRMYXllcnMgYXMgYXJjZ2lzX2Zsb29yX2NvbmZpZ3VyYXRpb25fYWRkX2xheWVycywgQXJjZ2lzRmxvb3JBZGRMYXllcnNGbG93IGFzIGFyY2dpc19mbG9vcl9jb25maWd1cmF0aW9uX2FkZF9sYXllcnNfZmxvdywgQXJjZ2lzRmxvb3JBZGRpdGlvbmFsTGF5ZXJzIGFzIGFyY2dpc19mbG9vcl9jb25maWd1cmF0aW9uX2FkZGl0aW9uYWxfbGF5ZXJzLCBBcmNnaXNGaWVsZExpc3QgYXMgYXJjZ2lzX2Zsb29yX2NvbmZpZ3VyYXRpb25fZmllbGRfbGlzdCwgQXJjZ2lzRmxvb3JGaWVsZFBpY2tlciBhcyBhcmNnaXNfZmxvb3JfY29uZmlndXJhdGlvbl9maWVsZF9waWNrZXIsIEFyY2dpc0Zsb29yQ29uZmlndXJhdGlvbkZpZWxkU2VsZWN0IGFzIGFyY2dpc19mbG9vcl9jb25maWd1cmF0aW9uX2ZpZWxkX3NlbGVjdCwgQXJjZ2lzTGF5ZXJMaXN0IGFzIGFyY2dpc19mbG9vcl9jb25maWd1cmF0aW9uX2xheWVyX2xpc3QsIEFyY2dpc0xheWVyUGlja2VyIGFzIGFyY2dpc19mbG9vcl9jb25maWd1cmF0aW9uX2xheWVyX3BpY2tlciwgQXJjZ2lzRmxvb3JSZXBsYWNlRmllbGQgYXMgYXJjZ2lzX2Zsb29yX2NvbmZpZ3VyYXRpb25fcmVwbGFjZV9maWVsZCwgQXJjZ2lzRmxvb3JTZWxlY3RGaWVsZHMgYXMgYXJjZ2lzX2Zsb29yX2NvbmZpZ3VyYXRpb25fc2VsZWN0X2ZpZWxkcyB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1hYWYzMGJkNi5qcyc7XG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTEzZjViMDBjLmpzJztcblxuY29uc3QgbGFuZ3VhZ2VNYXAgPSBuZXcgTWFwKFtcbiAgW1wiYXJcIiwgXCJhclwiXSxcbiAgW1wiYmdcIiwgXCJiZ1wiXSxcbiAgW1wiYnNcIiwgXCJic1wiXSxcbiAgW1wiY2FcIiwgXCJjYVwiXSxcbiAgW1wiY3NcIiwgXCJjc1wiXSxcbiAgW1wiZGFcIiwgXCJkYVwiXSxcbiAgW1wiZGVcIiwgXCJkZVwiXSxcbiAgW1wiZWxcIiwgXCJlbFwiXSxcbiAgW1wiZW5cIiwgXCJlblwiXSxcbiAgW1wiZXNcIiwgXCJlc1wiXSxcbiAgW1wiZXRcIiwgXCJldFwiXSxcbiAgW1wiZmlcIiwgXCJmaVwiXSxcbiAgW1wiZnJcIiwgXCJmclwiXSxcbiAgW1wiaGVcIiwgXCJoZVwiXSxcbiAgW1wiaHJcIiwgXCJoclwiXSxcbiAgW1wiaHVcIiwgXCJodVwiXSxcbiAgW1wiaWRcIiwgXCJpZFwiXSxcbiAgW1wiaXRcIiwgXCJpdFwiXSxcbiAgW1wiamFcIiwgXCJqYVwiXSxcbiAgW1wia29cIiwgXCJrb1wiXSxcbiAgW1wibHRcIiwgXCJsdFwiXSxcbiAgW1wibHZcIiwgXCJsdlwiXSxcbiAgW1wibmJcIiwgXCJuYlwiXSxcbiAgW1wibmxcIiwgXCJubFwiXSxcbiAgW1wicGxcIiwgXCJwbFwiXSxcbiAgW1wicHQtYnJcIiwgXCJwdC1CUlwiXSxcbiAgW1wicHQtcHRcIiwgXCJwdC1QVFwiXSxcbiAgW1wicm9cIiwgXCJyb1wiXSxcbiAgW1wicnVcIiwgXCJydVwiXSxcbiAgW1wic2tcIiwgXCJza1wiXSxcbiAgW1wic2xcIiwgXCJzbFwiXSxcbiAgW1wic3JcIiwgXCJzclwiXSxcbiAgW1wic3ZcIiwgXCJzdlwiXSxcbiAgW1widGhcIiwgXCJ0aFwiXSxcbiAgW1widHJcIiwgXCJ0clwiXSxcbiAgW1widWtcIiwgXCJ1a1wiXSxcbiAgW1widmlcIiwgXCJ2aVwiXSxcbiAgW1wiemgtY25cIiwgXCJ6aC1DTlwiXSxcbiAgW1wiemgtaGtcIiwgXCJ6aC1IS1wiXSxcbiAgW1wiemgtdHdcIiwgXCJ6aC1UV1wiXVxuXSk7XG4vLyBydGxcbmZ1bmN0aW9uIGdldEVsZW1lbnREaXIoZWwpIHtcbiAgcmV0dXJuIGdldEVsZW1lbnRQcm9wKGVsLCBcImRpclwiLCBcImx0clwiKTtcbn1cbmZ1bmN0aW9uIGdldEVsZW1lbnRQcm9wKGVsLCBwcm9wLCB2YWx1ZSkge1xuICBjb25zdCBjbG9zZXN0V2l0aFByb3AgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWwsIGBbJHtwcm9wfV1gKTtcbiAgcmV0dXJuIGNsb3Nlc3RXaXRoUHJvcCA/IGNsb3Nlc3RXaXRoUHJvcC5nZXRBdHRyaWJ1dGUocHJvcCkgOiB2YWx1ZTtcbn1cbi8vIGNzc1xuY29uc3QgQ1NTX1VUSUxJVFkgPSB7XG4gIHJ0bDogXCJhcmNnaXMtLXJ0bFwiXG59O1xuYXN5bmMgZnVuY3Rpb24gZm9ybWF0TnVtYmVyKG51bWJlciwgb3B0aW9ucykge1xuICBjb25zdCB7IGFwaSwgdHlwZSwgcGxhY2VzIH0gPSBvcHRpb25zIHx8IHt9O1xuICBpZiAoYXBpID09PSA0KSB7XG4gICAgY29uc3QgW2ludGxdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9pbnRsXCJdKTtcbiAgICBjb25zdCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyA9IGludGwuY29udmVydE51bWJlckZvcm1hdFRvSW50bE9wdGlvbnMoe1xuICAgICAgcGxhY2VzLFxuICAgICAgc3R5bGU6IHR5cGUsXG4gICAgICBkaWdpdFNlcGFyYXRvcjogdHJ1ZVxuICAgIH0pO1xuICAgIHJldHVybiBpbnRsLmZvcm1hdE51bWJlcihudW1iZXIsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMpLCB7IHN0eWxlOiB0eXBlIH0pKTtcbiAgfVxuICBjb25zdCBbZG9qb051bWJlcl0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJkb2pvL251bWJlclwiXSk7XG4gIHJldHVybiBkb2pvTnVtYmVyLmZvcm1hdChudW1iZXIsIHtcbiAgICB0eXBlLFxuICAgIHBsYWNlcyxcbiAgICBwYXR0ZXJuOiBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMucGF0dGVyblxuICB9KTtcbn1cbmNvbnN0IGNhY2hlID0ge307XG5mdW5jdGlvbiBmb3JtYXREYXRlKGRhdGUpIHtcbiAgY29uc3QgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nO1xuICBjb25zdCBkYXlTaG9ydE1vbnRoWWVhciA9IHtcbiAgICB5ZWFyOiBcIm51bWVyaWNcIixcbiAgICBtb250aDogXCJzaG9ydFwiLFxuICAgIGRheTogXCJudW1lcmljXCJcbiAgfTtcbiAgaWYgKCFjYWNoZVtsYW5nXSkge1xuICAgIGNhY2hlW2xhbmddID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmxhbmcsIGRheVNob3J0TW9udGhZZWFyKTtcbiAgfVxuICByZXR1cm4gY2FjaGVbbGFuZ10uZm9ybWF0KGRhdGUpO1xufVxuXG5leHBvcnQgeyBDU1NfVVRJTElUWSBhcyBDLCBmb3JtYXREYXRlIGFzIGEsIGZvcm1hdE51bWJlciBhcyBmLCBnZXRFbGVtZW50RGlyIGFzIGcsIGxhbmd1YWdlTWFwIGFzIGwgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgeyBsIGFzIGxhbmd1YWdlTWFwIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtMjIyNThjOTAuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRBc3NldFBhdGggfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcblxuLy8gaHR0cHM6Ly9tZWRpdW0uY29tL3N0ZW5jaWwtdHJpY2tzL2ltcGxlbWVudGluZy1pbnRlcm5hdGlvbmFsaXNhdGlvbi1pMThuLXdpdGgtc3RlbmNpbC01ZTY1NTk1NTQxMTdcbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KSB7XG4gIHZhciBfYSwgX2IsIF9jO1xuICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICB9XG4gIGVsc2Uge1xuICAgIC8vIFwicnUtUlVcIiBtYXBzIHRvIFwicnVcIiB1c2UgY2FzZVxuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZy5zbGljZSgwLCAyKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCkge1xuICB2YXIgX2EsIF9iLCBfYztcbiAgLy8gaXQncyBPSyBpZiB3ZSBkb24ndCBoYXZlIHRoZSA0IGxldHRlciBsYW5ndWFnZSBmaWxlIGZvciBpdFxuICAvLyA0IGxldHRlciBsYW5ndWFnZSBjb2RlIG5lZWRlZCBmb3IgZm9ybWF0dGluZyBudW1iZXJzXG4gIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgLy8gd2Ugc3VwcG9ydCB0aGUgMiBsZXR0ZXIgY29kZWQgbGFuZ3VhZ2VcbiAgICAgIC8vIGUuZy4gaXQtQ0ggdnMgaXRcbiAgICAgIHJldHVybiBsYW5nO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBcImVuXCI7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgZmV0Y2goZ2V0QXNzZXRQYXRoKGAuLi9hcmNnaXMtYXBwLWFzc2V0cy9pMThuLyR7Y29tcG9uZW50TmFtZX0uaTE4bi4ke2xvY2FsZX0uanNvbmApKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgIGlmIChyZXN1bHQub2spXG4gICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XG4gICAgICBlbHNlXG4gICAgICAgIHJlamVjdCgpO1xuICAgIH0sICgpID0+IHJlamVjdCgpKTtcbiAgfSk7XG59XG5jb25zdCBzdHJpbmdDYWNoZSA9IHt9O1xuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICBjb25zdCBpZCA9IGAke2NvbXBvbmVudE5hbWV9JHtsb2NhbGV9YDtcbiAgaWYgKCFzdHJpbmdDYWNoZVtpZF0pIHtcbiAgICBzdHJpbmdDYWNoZVtpZF0gPSBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKTtcbiAgfVxuICByZXR1cm4gc3RyaW5nQ2FjaGVbaWRdO1xufVxuLyoqXG4gKiBHZXQgc3RyaW5ncyBhbmQgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGlzIG1ldGhvZCByZXR1cm5zIDIgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGUgZmlyc3Qgb25lIHJldHVybnMgYSBjb2RlIHRoYXQncyBhbHNvIHN1cHBvcnRlZCBhcyBhIGxhbmd1YWdlIGZpbGUuXG4gKiBUaGUgc2Vjb25kIG9uZSByZXR1cm5zIGEgY29kZSB3aGVyZSB0aGVyZSBpcyBzdXBwb3J0IGZvciB0aGUgZmlyc3QgMiBsZXR0ZXJzIG9mIHRoZSBjb2RlIGFzIHBhcnQgb2YgYSBsYW5ndWFnZSBmaWxlLFxuICogYnV0IHdpbGwgcmV0dXJuIHRoZSBvcmlnaW5hbCA0IGxldHRlciBjb2RlIGZyb20gdGhlIHBhZ2UuXG4gKiBFLmcuIEZvciBcIml0LWNoXCIgaXQgd2lsbCByZXR1cm4gXCJpdFwiIGFzIHRoZSBmaXJzdCBsYW5ndWFnZSBjb2RlIGFuZCBcIml0LWNoXCIgYXMgdGhlIHNlY29uZC5cbiAqIFRoZSBzZWNvbmQgb25lIGlzIHJlcXVpcmVkIGZvciBlc3JpLmludGwuc2V0TG9jYWxlKCkgdG8gZ2V0IHRoZSBjb3JyZWN0IGZvcm1hdHRpbmcuXG4gKlxuICogSWYgYSB0YWdOYW1lIGlzIHByb3ZpZGVkIGl0IHdpbGwgb3ZlcndpdGUgdGhlIGVsZW1lbnQncyB0YWdOYW1lXG4gKlxuICogIEByZXR1cm4gWyBzdHJpbmdzLCBmaXJzdCBsYW5ndWFnZSBjb2RlLCBzZWNvbmQgbGFuZ3VhZ2UgY29kZV1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyhlbGVtZW50LCB0YWdOYW1lKSB7XG4gIGNvbnN0IGNvbXBvbmVudE5hbWUgPSB0YWdOYW1lIHx8IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCBjb21wb25lbnRMYW5ndWFnZSA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KTtcbiAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2VJbnRsID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KTtcbiAgbGV0IHN0cmluZ3M7XG4gIHRyeSB7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBjb21wb25lbnRMYW5ndWFnZSk7XG4gIH1cbiAgY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLndhcm4oYG5vIGxvY2FsZSBmb3IgJHtjb21wb25lbnROYW1lfSAoJHtjb21wb25lbnRMYW5ndWFnZX0pIGxvYWRpbmcgZGVmYXVsdCBsb2NhbGUgZW4uYCk7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBcImVuXCIpO1xuICB9XG4gIHJldHVybiBbc3RyaW5ncywgY29tcG9uZW50TGFuZ3VhZ2UsIGNvbXBvbmVudExhbmd1YWdlSW50bF07XG59XG5cbmV4cG9ydCB7IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZSBhcyBhLCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIGFzIGcgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==