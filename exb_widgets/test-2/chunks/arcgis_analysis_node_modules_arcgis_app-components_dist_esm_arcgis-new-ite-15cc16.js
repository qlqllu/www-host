"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-new-ite-15cc16"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-locator-select.entry.js":
/*!***************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-locator-select.entry.js ***!
  \***************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_locator_select: () => (/* binding */ ArcgisNewItemPagesLocatorSelect)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./item-properties-e6412a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js");
/* harmony import */ var _privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./privileges-35590eb4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-35590eb4.js");
/* harmony import */ var _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./feature-layer-38cdae87.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-38cdae87.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./url-f3b82cc7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-f3b82cc7.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _feature_layer_d33ea114_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./feature-layer-d33ea114.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-d33ea114.js");
/* harmony import */ var _guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./guid-4f4176ba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js");
/* harmony import */ var _thumbnail_0b7adfcd_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./thumbnail-0b7adfcd.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-0b7adfcd.js");
/* harmony import */ var _query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./query-4f7b7e4d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-4f7b7e4d.js");
/* harmony import */ var _user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./user-e3dedc4a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js");
/* harmony import */ var _api_f7934cd7_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./api-f7934cd7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-f7934cd7.js");
/* harmony import */ var _server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./server-item-f12153e6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js");
/* harmony import */ var _functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./functional-9f648bee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-9f648bee.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/* harmony import */ var _item_d9d70416_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./item-d9d70416.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-d9d70416.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _feature_layer_69305a85_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./feature-layer-69305a85.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-69305a85.js");
/* harmony import */ var _ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./ags-68d4ae20.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-68d4ae20.js");
/* harmony import */ var _file_f36193e9_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./file-f36193e9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-f36193e9.js");
/* harmony import */ var _store_3210b604_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./store-3210b604.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-3210b604.js");
/* harmony import */ var _storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./storage-d7f5822e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */






























const locatorTypes = ["locator-view", "locator"];

const arcgisNewItemPagesLocatorSelectCss = ".tile-select:not(:last-child){margin-bottom:1.5rem}.custom-parameter-container{margin-top:1.5rem}";

const ArcgisNewItemPagesLocatorSelect = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.handleAuthSwitchChange = (event) => {
      this.storeAuth = event.detail;
    };
    this.handleNewUrl = async (args) => {
      const { type, url } = args;
      this.type = type;
      this.locatorUrl = url;
      this.isSecured = null;
      this.error = null;
      if (!!url) {
        this.allowStoredAuth = false;
        this.storeAuth = false;
        // Fetch data to check if we need auth or not
        this.loading = true;
        await this.getServiceInfo(false);
        this.loading = false;
      }
    };
    this.selectedLocatorType = "locator-view";
    this.locatorUrl = "";
    this.type = undefined;
    this.loading = false;
    this.error = null;
    this.canPublishLocatorView = true;
    this.allowStoredAuth = false;
    this.storeAuth = false;
    this.isSecured = null;
    this.serviceInfo = null;
    this.itemType = undefined;
  }
  async componentWillLoad() {
    var _a;
    const globalI18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_6__.u.i18n;
    this.i18n = globalI18n.locatorSelect;
    this.urlTypeI18n = globalI18n.urlType;
    this.urlI18n = globalI18n.url;
    this.allowStoredAuth = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.allowStoredAuth;
    this.storeAuth = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.storeAuth;
    this.isSecured = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.isSecured;
    this.itemType = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.type;
    const { user, portal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
    this.canPublishLocatorView = (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_3__.i)(user, portal);
    this.selectedLocatorType = (_a = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.locatorType) !== null && _a !== void 0 ? _a : "locator-view";
    if (!this.canPublishLocatorView) {
      this.selectedLocatorType = "locator";
    }
    if (this.selectedLocatorType === "locator") {
      this.locatorUrl = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.url;
    }
  }
  async handleNext() {
    const { selectedLocatorType, urlI18n, locatorUrl, allowStoredAuth } = this;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.locatorType = selectedLocatorType;
    if (selectedLocatorType === "locator-view") {
      const url = await (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_3__.q)();
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.newItemMode = "create";
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.type = "Geocoding Service";
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.typeKeywords = ["Geocoding filter"];
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.thumbnailURL = "https://static.arcgis.com/images/desktopapp.png";
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.createAsServiceProxy = true;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.url = url;
    }
    else {
      if (!locatorUrl) {
        this.inputRef.focusMainInput();
        this.error = urlI18n.invalidUrl;
        return;
      }
      const { portal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
      const { error, result } = (0,_url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_8__.g)((0,_url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_8__.f)(locatorUrl, portal.allSSL), portal.isPortal);
      // TODO: double check service info OR don't clear error if service info is invalid;
      // currently invalid geocoders will still allow next
      if (error) {
        this.error = urlI18n[error.code];
        return;
      }
      if (result !== "Geocoding Service") {
        this.error = urlI18n.invalidUrl;
        return;
      }
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.url = locatorUrl;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.type = "Geocoding Service";
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.newItemMode = "url";
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.allowStoredAuth = allowStoredAuth;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.storeAuth = this.storeAuth;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.isSecured = this.isSecured;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.serviceInfo = this.serviceInfo;
      if (this.storeAuth) {
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.checkAuth = true;
      }
      if (this.allowStoredAuth && !this.storeAuth) {
        // Fetch again to trigger the sign in modal
        this.loading = true;
        const success = await this.getServiceInfo(true);
        this.loading = false;
        if (!success) {
          return;
        }
      }
    }
    if (this.allowStoredAuth && this.storeAuth) {
      this.newItemUpdatePage.emit("auth");
    }
    else {
      this.newItemUpdatePage.emit("itemProperties");
    }
  }
  async getServiceInfo(checkAuth = false) {
    // TODO: think of a way to generalize this with `pages-url-type`
    const { urlTypeI18n, locatorUrl, type } = this;
    const { error, result } = await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_4__.o)({
      url: locatorUrl,
      customParameters: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.customParameters,
      type,
      checkAuth,
      // TODO: refactor this once we refactor the switch handle
      storeAuth: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.storeAuth
    });
    if (error || !result) {
      if ((error === null || error === void 0 ? void 0 : error.message) === "does not point to a GIS server") {
        this.error = urlTypeI18n.serviceNotGIS;
      }
      else if ((error === null || error === void 0 ? void 0 : error.code) === "serviceNotExist") {
        this.error = urlTypeI18n.serviceNotExist;
      }
      else if ((error === null || error === void 0 ? void 0 : error.code) === "unsupportedWFSVersion") {
        this.error = urlTypeI18n.unsupportedWFSVersion;
      }
      else {
        this.error = urlTypeI18n[error === null || error === void 0 ? void 0 : error.code] || urlTypeI18n.serviceNotExist;
      }
      return false;
    }
    const { tags, title, isSecured, allowStoredAuth, serviceInfo } = result;
    this.allowStoredAuth = allowStoredAuth;
    this.isSecured = isSecured;
    this.serviceInfo = serviceInfo;
    if (tags) {
      _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_2__.i.tags = tags;
    }
    _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_2__.i.title = (title === null || title === void 0 ? void 0 : title.replace(_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_7__.s, "")) || "";
    return true;
  }
  render() {
    const { error, i18n, urlTypeI18n, loading, selectedLocatorType, locatorUrl, canPublishLocatorView, isSecured, allowStoredAuth, itemType } = this;
    const { config: { helpBase, helpMap } } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
    // TODO: add auth stuff
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, canPublishLocatorView && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: i18n.heading }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", { layout: "vertical", class: "tile-select" }, locatorTypes.map((type) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { checked: selectedLocatorType === type, heading: i18n.options[type].title, description: i18n.options[type].description, name: "tile-layer-type", "input-enabled": true, width: "full", type: "radio", value: type, onCalciteTileSelectChange: () => (this.selectedLocatorType = type) })))))), selectedLocatorType === "locator" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: i18n.url.heading, content: i18n.url.description }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-url", { url: locatorUrl, inputTitle: " ", placeholder: "https://myserver.com/arcgis/rest/services/folder/service/GeocodeServer",
      // TODO: debounce this
      onNewItemUrlChange: (event) => this.handleNewUrl(event.detail), ref: (ele) => (this.inputRef = ele) }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "custom-parameter-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-custom-parameters", { itemType: itemType })), allowStoredAuth && !!isSecured && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-switch-card", { onSwitchChange: this.handleAuthSwitchChange, header: urlTypeI18n.storeAuth, headerLink: {
        text: urlTypeI18n.learnMore,
        href: `${helpBase}${helpMap["120000597"]}`
      }, defaultChecked: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_5__.a.storeAuth })))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { active: loading, text: urlTypeI18n.getServiceInfo }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { active: !!error, description: error, onAlertDismiss: () => (this.error = null) })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesLocatorSelect.style = arcgisNewItemPagesLocatorSelectCss;




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLW5ldy1pdGUtMTVjYzE2LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ2lIO0FBQ3pEO0FBQ2lCO0FBQ3NCO0FBQzFCO0FBQ1Y7QUFDTjtBQUNtQjtBQUNKO0FBQ3ZDO0FBQ0M7QUFDSztBQUNEO0FBQ0c7QUFDVDtBQUNLO0FBQ0o7QUFDRDtBQUNEO0FBQ1E7QUFDRDtBQUNBO0FBQ047QUFDRDtBQUNVO0FBQ1Y7QUFDQztBQUNDO0FBQ0U7O0FBRS9COztBQUVBLDBFQUEwRSxxQkFBcUIsNEJBQTRCLGtCQUFrQjs7QUFFN0k7QUFDQTtBQUNBLElBQUkscURBQWdCO0FBQ3BCLDZCQUE2QixxREFBVztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsWUFBWTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsOENBQVk7QUFDbkM7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLG9EQUFZO0FBQ3ZDLHFCQUFxQixvREFBWTtBQUNqQyxxQkFBcUIsb0RBQVk7QUFDakMsb0JBQW9CLG9EQUFZO0FBQ2hDLFlBQVksZUFBZSxFQUFFLGtEQUFXO0FBQ3hDLGlDQUFpQywwREFBb0I7QUFDckQscUNBQXFDLG9EQUFZO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLG9EQUFZO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBLFlBQVksNERBQTREO0FBQ3hFLElBQUksb0RBQVk7QUFDaEI7QUFDQSx3QkFBd0IsMERBQW1CO0FBQzNDLE1BQU0sb0RBQVk7QUFDbEIsTUFBTSxvREFBWTtBQUNsQixNQUFNLG9EQUFZO0FBQ2xCLE1BQU0sb0RBQVk7QUFDbEIsTUFBTSxvREFBWTtBQUNsQixNQUFNLG9EQUFZO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxTQUFTLEVBQUUsa0RBQVc7QUFDcEMsY0FBYyxnQkFBZ0IsRUFBRSxtREFBVSxDQUFDLG1EQUFTO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSxvREFBWTtBQUNsQixNQUFNLG9EQUFZO0FBQ2xCLE1BQU0sb0RBQVk7QUFDbEIsTUFBTSxvREFBWTtBQUNsQixNQUFNLG9EQUFZO0FBQ2xCLE1BQU0sb0RBQVk7QUFDbEIsTUFBTSxvREFBWTtBQUNsQjtBQUNBLFFBQVEsb0RBQVk7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksZ0NBQWdDO0FBQzVDLFlBQVksZ0JBQWdCLFFBQVEsNkRBQWlCO0FBQ3JEO0FBQ0Esd0JBQXdCLG9EQUFZO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixvREFBWTtBQUM3QixLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx1REFBdUQ7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLDJEQUFtQjtBQUN6QjtBQUNBLElBQUksMkRBQW1CLHNFQUFzRSxzREFBdUI7QUFDcEg7QUFDQTtBQUNBO0FBQ0EsWUFBWSxrSUFBa0k7QUFDOUksWUFBWSxVQUFVLHNCQUFzQixFQUFFLGtEQUFXO0FBQ3pEO0FBQ0EsWUFBWSxxREFBQyx3Q0FBd0MscURBQUMsQ0FBQyxpREFBUSxRQUFRLHFEQUFDLGtDQUFrQyxzQkFBc0IsR0FBRyxxREFBQyxnQ0FBZ0MsMENBQTBDLDhCQUE4QixxREFBQywwQkFBMEIsc1JBQXNSLDhDQUE4QyxxREFBQyxDQUFDLGlEQUFRLFFBQVEscURBQUMsa0NBQWtDLHlEQUF5RCxHQUFHLHFEQUFDLDBCQUEwQjtBQUN2dEI7QUFDQSwyR0FBMkcsR0FBRyxxREFBQyxVQUFVLHFDQUFxQyxFQUFFLHFEQUFDLHdDQUF3QyxvQkFBb0IsdUNBQXVDLHFEQUFDLGtDQUFrQztBQUN2UztBQUNBLGlCQUFpQixTQUFTLEVBQUUscUJBQXFCO0FBQ2pELE9BQU8sa0JBQWtCLG9EQUFZLFlBQVksTUFBTSxxREFBQyw2QkFBNkIsbURBQW1ELEdBQUcscURBQUMsNEJBQTRCLGdGQUFnRjtBQUN4UDtBQUNBLGFBQWEsT0FBTyxxREFBVTtBQUM5QjtBQUNBOztBQUVtRiIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1uZXctaXRlbS1wYWdlcy1sb2NhdG9yLXNlbGVjdC5lbnRyeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgRiBhcyBGcmFnbWVudCwgZCBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC05MmViYjM5Ni5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbmZpZ1N0YXRlIH0gZnJvbSAnLi9jb25maWctZWI1ZjdkYzIuanMnO1xuaW1wb3J0IHsgaSBhcyBpdGVtUHJvcGVydGllc1N0YXRlIH0gZnJvbSAnLi9pdGVtLXByb3BlcnRpZXMtZTY0MTJhOWEuanMnO1xuaW1wb3J0IHsgaSBhcyBjYW5DcmVhdGVMb2NhdG9yVmlldywgcSBhcyBnZXRXb3JsZEdlb2NvZGVyVXJsIH0gZnJvbSAnLi9wcml2aWxlZ2VzLTM1NTkwZWI0LmpzJztcbmltcG9ydCB7IG8gYXMgZ2V0VXJsU2VydmljZUluZm8gfSBmcm9tICcuL2ZlYXR1cmUtbGF5ZXItMzhjZGFlODcuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRJdGVtU3RhdGUgfSBmcm9tICcuL2FkZC1pdGVtLTk3ZDU3N2E5LmpzJztcbmltcG9ydCB7IHUgYXMgdWlTdG9yZVN0YXRlIH0gZnJvbSAnLi91aS1lY2Y4NmJiYS5qcyc7XG5pbXBvcnQgeyBzIGFzIHNwZWNpYWxDaGFyYWN0ZXJzUmVnRXhwIH0gZnJvbSAnLi9wcml2aWxlZ2VzLWNjZDVmMzdkLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0VXJsVHlwZSwgZiBhcyBmb3JtYXRVcmwgfSBmcm9tICcuL3VybC1mM2I4MmNjNy5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtODFkNTQ4YjcuanMnO1xuaW1wb3J0ICcuL3BvcnRhbC03OWNhYWVmZi5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYWFmMzBiZDYuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtYzgyZjVhYjkuanMnO1xuaW1wb3J0ICcuL2ZlYXR1cmUtbGF5ZXItZDMzZWExMTQuanMnO1xuaW1wb3J0ICcuL2d1aWQtNGY0MTc2YmEuanMnO1xuaW1wb3J0ICcuL3RodW1ibmFpbC0wYjdhZGZjZC5qcyc7XG5pbXBvcnQgJy4vcXVlcnktNGY3YjdlNGQuanMnO1xuaW1wb3J0ICcuL3VzZXItZTNkZWRjNGEuanMnO1xuaW1wb3J0ICcuL2FwaS1mNzkzNGNkNy5qcyc7XG5pbXBvcnQgJy4vc2VydmVyLWl0ZW0tZjEyMTUzZTYuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtOWY2NDhiZWUuanMnO1xuaW1wb3J0ICcuL2l0ZW0tdHlwZXMtYjRmZTg2YWQuanMnO1xuaW1wb3J0ICcuL2l0ZW0tZDlkNzA0MTYuanMnO1xuaW1wb3J0ICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgJy4vZmVhdHVyZS1sYXllci02OTMwNWE4NS5qcyc7XG5pbXBvcnQgJy4vYWdzLTY4ZDRhZTIwLmpzJztcbmltcG9ydCAnLi9maWxlLWYzNjE5M2U5LmpzJztcbmltcG9ydCAnLi9zdG9yZS0zMjEwYjYwNC5qcyc7XG5pbXBvcnQgJy4vc3RvcmFnZS1kN2Y1ODIyZS5qcyc7XG5cbmNvbnN0IGxvY2F0b3JUeXBlcyA9IFtcImxvY2F0b3Itdmlld1wiLCBcImxvY2F0b3JcIl07XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1QYWdlc0xvY2F0b3JTZWxlY3RDc3MgPSBcIi50aWxlLXNlbGVjdDpub3QoOmxhc3QtY2hpbGQpe21hcmdpbi1ib3R0b206MS41cmVtfS5jdXN0b20tcGFyYW1ldGVyLWNvbnRhaW5lcnttYXJnaW4tdG9wOjEuNXJlbX1cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbVBhZ2VzTG9jYXRvclNlbGVjdCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVVwZGF0ZVBhZ2VcIiwgNyk7XG4gICAgdGhpcy5oYW5kbGVBdXRoU3dpdGNoQ2hhbmdlID0gKGV2ZW50KSA9PiB7XG4gICAgICB0aGlzLnN0b3JlQXV0aCA9IGV2ZW50LmRldGFpbDtcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlTmV3VXJsID0gYXN5bmMgKGFyZ3MpID0+IHtcbiAgICAgIGNvbnN0IHsgdHlwZSwgdXJsIH0gPSBhcmdzO1xuICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgIHRoaXMubG9jYXRvclVybCA9IHVybDtcbiAgICAgIHRoaXMuaXNTZWN1cmVkID0gbnVsbDtcbiAgICAgIHRoaXMuZXJyb3IgPSBudWxsO1xuICAgICAgaWYgKCEhdXJsKSB7XG4gICAgICAgIHRoaXMuYWxsb3dTdG9yZWRBdXRoID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RvcmVBdXRoID0gZmFsc2U7XG4gICAgICAgIC8vIEZldGNoIGRhdGEgdG8gY2hlY2sgaWYgd2UgbmVlZCBhdXRoIG9yIG5vdFxuICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBhd2FpdCB0aGlzLmdldFNlcnZpY2VJbmZvKGZhbHNlKTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLnNlbGVjdGVkTG9jYXRvclR5cGUgPSBcImxvY2F0b3Itdmlld1wiO1xuICAgIHRoaXMubG9jYXRvclVybCA9IFwiXCI7XG4gICAgdGhpcy50eXBlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgIHRoaXMuZXJyb3IgPSBudWxsO1xuICAgIHRoaXMuY2FuUHVibGlzaExvY2F0b3JWaWV3ID0gdHJ1ZTtcbiAgICB0aGlzLmFsbG93U3RvcmVkQXV0aCA9IGZhbHNlO1xuICAgIHRoaXMuc3RvcmVBdXRoID0gZmFsc2U7XG4gICAgdGhpcy5pc1NlY3VyZWQgPSBudWxsO1xuICAgIHRoaXMuc2VydmljZUluZm8gPSBudWxsO1xuICAgIHRoaXMuaXRlbVR5cGUgPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IGdsb2JhbEkxOG4gPSB1aVN0b3JlU3RhdGUuaTE4bjtcbiAgICB0aGlzLmkxOG4gPSBnbG9iYWxJMThuLmxvY2F0b3JTZWxlY3Q7XG4gICAgdGhpcy51cmxUeXBlSTE4biA9IGdsb2JhbEkxOG4udXJsVHlwZTtcbiAgICB0aGlzLnVybEkxOG4gPSBnbG9iYWxJMThuLnVybDtcbiAgICB0aGlzLmFsbG93U3RvcmVkQXV0aCA9IGFkZEl0ZW1TdGF0ZS5hbGxvd1N0b3JlZEF1dGg7XG4gICAgdGhpcy5zdG9yZUF1dGggPSBhZGRJdGVtU3RhdGUuc3RvcmVBdXRoO1xuICAgIHRoaXMuaXNTZWN1cmVkID0gYWRkSXRlbVN0YXRlLmlzU2VjdXJlZDtcbiAgICB0aGlzLml0ZW1UeXBlID0gYWRkSXRlbVN0YXRlLnR5cGU7XG4gICAgY29uc3QgeyB1c2VyLCBwb3J0YWwgfSA9IGNvbmZpZ1N0YXRlO1xuICAgIHRoaXMuY2FuUHVibGlzaExvY2F0b3JWaWV3ID0gY2FuQ3JlYXRlTG9jYXRvclZpZXcodXNlciwgcG9ydGFsKTtcbiAgICB0aGlzLnNlbGVjdGVkTG9jYXRvclR5cGUgPSAoX2EgPSBhZGRJdGVtU3RhdGUubG9jYXRvclR5cGUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwibG9jYXRvci12aWV3XCI7XG4gICAgaWYgKCF0aGlzLmNhblB1Ymxpc2hMb2NhdG9yVmlldykge1xuICAgICAgdGhpcy5zZWxlY3RlZExvY2F0b3JUeXBlID0gXCJsb2NhdG9yXCI7XG4gICAgfVxuICAgIGlmICh0aGlzLnNlbGVjdGVkTG9jYXRvclR5cGUgPT09IFwibG9jYXRvclwiKSB7XG4gICAgICB0aGlzLmxvY2F0b3JVcmwgPSBhZGRJdGVtU3RhdGUudXJsO1xuICAgIH1cbiAgfVxuICBhc3luYyBoYW5kbGVOZXh0KCkge1xuICAgIGNvbnN0IHsgc2VsZWN0ZWRMb2NhdG9yVHlwZSwgdXJsSTE4biwgbG9jYXRvclVybCwgYWxsb3dTdG9yZWRBdXRoIH0gPSB0aGlzO1xuICAgIGFkZEl0ZW1TdGF0ZS5sb2NhdG9yVHlwZSA9IHNlbGVjdGVkTG9jYXRvclR5cGU7XG4gICAgaWYgKHNlbGVjdGVkTG9jYXRvclR5cGUgPT09IFwibG9jYXRvci12aWV3XCIpIHtcbiAgICAgIGNvbnN0IHVybCA9IGF3YWl0IGdldFdvcmxkR2VvY29kZXJVcmwoKTtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwiY3JlYXRlXCI7XG4gICAgICBhZGRJdGVtU3RhdGUudHlwZSA9IFwiR2VvY29kaW5nIFNlcnZpY2VcIjtcbiAgICAgIGFkZEl0ZW1TdGF0ZS50eXBlS2V5d29yZHMgPSBbXCJHZW9jb2RpbmcgZmlsdGVyXCJdO1xuICAgICAgYWRkSXRlbVN0YXRlLnRodW1ibmFpbFVSTCA9IFwiaHR0cHM6Ly9zdGF0aWMuYXJjZ2lzLmNvbS9pbWFnZXMvZGVza3RvcGFwcC5wbmdcIjtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5jcmVhdGVBc1NlcnZpY2VQcm94eSA9IHRydWU7XG4gICAgICBhZGRJdGVtU3RhdGUudXJsID0gdXJsO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGlmICghbG9jYXRvclVybCkge1xuICAgICAgICB0aGlzLmlucHV0UmVmLmZvY3VzTWFpbklucHV0KCk7XG4gICAgICAgIHRoaXMuZXJyb3IgPSB1cmxJMThuLmludmFsaWRVcmw7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgcG9ydGFsIH0gPSBjb25maWdTdGF0ZTtcbiAgICAgIGNvbnN0IHsgZXJyb3IsIHJlc3VsdCB9ID0gZ2V0VXJsVHlwZShmb3JtYXRVcmwobG9jYXRvclVybCwgcG9ydGFsLmFsbFNTTCksIHBvcnRhbC5pc1BvcnRhbCk7XG4gICAgICAvLyBUT0RPOiBkb3VibGUgY2hlY2sgc2VydmljZSBpbmZvIE9SIGRvbid0IGNsZWFyIGVycm9yIGlmIHNlcnZpY2UgaW5mbyBpcyBpbnZhbGlkO1xuICAgICAgLy8gY3VycmVudGx5IGludmFsaWQgZ2VvY29kZXJzIHdpbGwgc3RpbGwgYWxsb3cgbmV4dFxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHRoaXMuZXJyb3IgPSB1cmxJMThuW2Vycm9yLmNvZGVdO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAocmVzdWx0ICE9PSBcIkdlb2NvZGluZyBTZXJ2aWNlXCIpIHtcbiAgICAgICAgdGhpcy5lcnJvciA9IHVybEkxOG4uaW52YWxpZFVybDtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgYWRkSXRlbVN0YXRlLnVybCA9IGxvY2F0b3JVcmw7XG4gICAgICBhZGRJdGVtU3RhdGUudHlwZSA9IFwiR2VvY29kaW5nIFNlcnZpY2VcIjtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwidXJsXCI7XG4gICAgICBhZGRJdGVtU3RhdGUuYWxsb3dTdG9yZWRBdXRoID0gYWxsb3dTdG9yZWRBdXRoO1xuICAgICAgYWRkSXRlbVN0YXRlLnN0b3JlQXV0aCA9IHRoaXMuc3RvcmVBdXRoO1xuICAgICAgYWRkSXRlbVN0YXRlLmlzU2VjdXJlZCA9IHRoaXMuaXNTZWN1cmVkO1xuICAgICAgYWRkSXRlbVN0YXRlLnNlcnZpY2VJbmZvID0gdGhpcy5zZXJ2aWNlSW5mbztcbiAgICAgIGlmICh0aGlzLnN0b3JlQXV0aCkge1xuICAgICAgICBhZGRJdGVtU3RhdGUuY2hlY2tBdXRoID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmFsbG93U3RvcmVkQXV0aCAmJiAhdGhpcy5zdG9yZUF1dGgpIHtcbiAgICAgICAgLy8gRmV0Y2ggYWdhaW4gdG8gdHJpZ2dlciB0aGUgc2lnbiBpbiBtb2RhbFxuICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgdGhpcy5nZXRTZXJ2aWNlSW5mbyh0cnVlKTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGhpcy5hbGxvd1N0b3JlZEF1dGggJiYgdGhpcy5zdG9yZUF1dGgpIHtcbiAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcImF1dGhcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiaXRlbVByb3BlcnRpZXNcIik7XG4gICAgfVxuICB9XG4gIGFzeW5jIGdldFNlcnZpY2VJbmZvKGNoZWNrQXV0aCA9IGZhbHNlKSB7XG4gICAgLy8gVE9ETzogdGhpbmsgb2YgYSB3YXkgdG8gZ2VuZXJhbGl6ZSB0aGlzIHdpdGggYHBhZ2VzLXVybC10eXBlYFxuICAgIGNvbnN0IHsgdXJsVHlwZUkxOG4sIGxvY2F0b3JVcmwsIHR5cGUgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBlcnJvciwgcmVzdWx0IH0gPSBhd2FpdCBnZXRVcmxTZXJ2aWNlSW5mbyh7XG4gICAgICB1cmw6IGxvY2F0b3JVcmwsXG4gICAgICBjdXN0b21QYXJhbWV0ZXJzOiBhZGRJdGVtU3RhdGUuY3VzdG9tUGFyYW1ldGVycyxcbiAgICAgIHR5cGUsXG4gICAgICBjaGVja0F1dGgsXG4gICAgICAvLyBUT0RPOiByZWZhY3RvciB0aGlzIG9uY2Ugd2UgcmVmYWN0b3IgdGhlIHN3aXRjaCBoYW5kbGVcbiAgICAgIHN0b3JlQXV0aDogYWRkSXRlbVN0YXRlLnN0b3JlQXV0aFxuICAgIH0pO1xuICAgIGlmIChlcnJvciB8fCAhcmVzdWx0KSB7XG4gICAgICBpZiAoKGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5tZXNzYWdlKSA9PT0gXCJkb2VzIG5vdCBwb2ludCB0byBhIEdJUyBzZXJ2ZXJcIikge1xuICAgICAgICB0aGlzLmVycm9yID0gdXJsVHlwZUkxOG4uc2VydmljZU5vdEdJUztcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKChlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IuY29kZSkgPT09IFwic2VydmljZU5vdEV4aXN0XCIpIHtcbiAgICAgICAgdGhpcy5lcnJvciA9IHVybFR5cGVJMThuLnNlcnZpY2VOb3RFeGlzdDtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKChlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IuY29kZSkgPT09IFwidW5zdXBwb3J0ZWRXRlNWZXJzaW9uXCIpIHtcbiAgICAgICAgdGhpcy5lcnJvciA9IHVybFR5cGVJMThuLnVuc3VwcG9ydGVkV0ZTVmVyc2lvbjtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmVycm9yID0gdXJsVHlwZUkxOG5bZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmNvZGVdIHx8IHVybFR5cGVJMThuLnNlcnZpY2VOb3RFeGlzdDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgeyB0YWdzLCB0aXRsZSwgaXNTZWN1cmVkLCBhbGxvd1N0b3JlZEF1dGgsIHNlcnZpY2VJbmZvIH0gPSByZXN1bHQ7XG4gICAgdGhpcy5hbGxvd1N0b3JlZEF1dGggPSBhbGxvd1N0b3JlZEF1dGg7XG4gICAgdGhpcy5pc1NlY3VyZWQgPSBpc1NlY3VyZWQ7XG4gICAgdGhpcy5zZXJ2aWNlSW5mbyA9IHNlcnZpY2VJbmZvO1xuICAgIGlmICh0YWdzKSB7XG4gICAgICBpdGVtUHJvcGVydGllc1N0YXRlLnRhZ3MgPSB0YWdzO1xuICAgIH1cbiAgICBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlID0gKHRpdGxlID09PSBudWxsIHx8IHRpdGxlID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0aXRsZS5yZXBsYWNlKHNwZWNpYWxDaGFyYWN0ZXJzUmVnRXhwLCBcIlwiKSkgfHwgXCJcIjtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBlcnJvciwgaTE4biwgdXJsVHlwZUkxOG4sIGxvYWRpbmcsIHNlbGVjdGVkTG9jYXRvclR5cGUsIGxvY2F0b3JVcmwsIGNhblB1Ymxpc2hMb2NhdG9yVmlldywgaXNTZWN1cmVkLCBhbGxvd1N0b3JlZEF1dGgsIGl0ZW1UeXBlIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgY29uZmlnOiB7IGhlbHBCYXNlLCBoZWxwTWFwIH0gfSA9IGNvbmZpZ1N0YXRlO1xuICAgIC8vIFRPRE86IGFkZCBhdXRoIHN0dWZmXG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIG51bGwsIGNhblB1Ymxpc2hMb2NhdG9yVmlldyAmJiAoaChGcmFnbWVudCwgbnVsbCwgaChcImFyY2dpcy1uZXctaXRlbS1kZXNjcmlwdGlvblwiLCB7IGhlYWRlcjogaTE4bi5oZWFkaW5nIH0pLCBoKFwiY2FsY2l0ZS10aWxlLXNlbGVjdC1ncm91cFwiLCB7IGxheW91dDogXCJ2ZXJ0aWNhbFwiLCBjbGFzczogXCJ0aWxlLXNlbGVjdFwiIH0sIGxvY2F0b3JUeXBlcy5tYXAoKHR5cGUpID0+IChoKFwiY2FsY2l0ZS10aWxlLXNlbGVjdFwiLCB7IGNoZWNrZWQ6IHNlbGVjdGVkTG9jYXRvclR5cGUgPT09IHR5cGUsIGhlYWRpbmc6IGkxOG4ub3B0aW9uc1t0eXBlXS50aXRsZSwgZGVzY3JpcHRpb246IGkxOG4ub3B0aW9uc1t0eXBlXS5kZXNjcmlwdGlvbiwgbmFtZTogXCJ0aWxlLWxheWVyLXR5cGVcIiwgXCJpbnB1dC1lbmFibGVkXCI6IHRydWUsIHdpZHRoOiBcImZ1bGxcIiwgdHlwZTogXCJyYWRpb1wiLCB2YWx1ZTogdHlwZSwgb25DYWxjaXRlVGlsZVNlbGVjdENoYW5nZTogKCkgPT4gKHRoaXMuc2VsZWN0ZWRMb2NhdG9yVHlwZSA9IHR5cGUpIH0pKSkpKSksIHNlbGVjdGVkTG9jYXRvclR5cGUgPT09IFwibG9jYXRvclwiICYmIChoKEZyYWdtZW50LCBudWxsLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWRlc2NyaXB0aW9uXCIsIHsgaGVhZGVyOiBpMThuLnVybC5oZWFkaW5nLCBjb250ZW50OiBpMThuLnVybC5kZXNjcmlwdGlvbiB9KSwgaChcImFyY2dpcy1uZXctaXRlbS11cmxcIiwgeyB1cmw6IGxvY2F0b3JVcmwsIGlucHV0VGl0bGU6IFwiIFwiLCBwbGFjZWhvbGRlcjogXCJodHRwczovL215c2VydmVyLmNvbS9hcmNnaXMvcmVzdC9zZXJ2aWNlcy9mb2xkZXIvc2VydmljZS9HZW9jb2RlU2VydmVyXCIsXG4gICAgICAvLyBUT0RPOiBkZWJvdW5jZSB0aGlzXG4gICAgICBvbk5ld0l0ZW1VcmxDaGFuZ2U6IChldmVudCkgPT4gdGhpcy5oYW5kbGVOZXdVcmwoZXZlbnQuZGV0YWlsKSwgcmVmOiAoZWxlKSA9PiAodGhpcy5pbnB1dFJlZiA9IGVsZSkgfSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjdXN0b20tcGFyYW1ldGVyLWNvbnRhaW5lclwiIH0sIGgoXCJhcmNnaXMtbmV3LWl0ZW0tY3VzdG9tLXBhcmFtZXRlcnNcIiwgeyBpdGVtVHlwZTogaXRlbVR5cGUgfSkpLCBhbGxvd1N0b3JlZEF1dGggJiYgISFpc1NlY3VyZWQgJiYgKGgoXCJhcmNnaXMtbmV3LWl0ZW0tc3dpdGNoLWNhcmRcIiwgeyBvblN3aXRjaENoYW5nZTogdGhpcy5oYW5kbGVBdXRoU3dpdGNoQ2hhbmdlLCBoZWFkZXI6IHVybFR5cGVJMThuLnN0b3JlQXV0aCwgaGVhZGVyTGluazoge1xuICAgICAgICB0ZXh0OiB1cmxUeXBlSTE4bi5sZWFybk1vcmUsXG4gICAgICAgIGhyZWY6IGAke2hlbHBCYXNlfSR7aGVscE1hcFtcIjEyMDAwMDU5N1wiXX1gXG4gICAgICB9LCBkZWZhdWx0Q2hlY2tlZDogYWRkSXRlbVN0YXRlLnN0b3JlQXV0aCB9KSkpKSwgaChcImFyY2dpcy1uZXctaXRlbS1sb2FkZXJcIiwgeyBhY3RpdmU6IGxvYWRpbmcsIHRleHQ6IHVybFR5cGVJMThuLmdldFNlcnZpY2VJbmZvIH0pLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWFsZXJ0XCIsIHsgYWN0aXZlOiAhIWVycm9yLCBkZXNjcmlwdGlvbjogZXJyb3IsIG9uQWxlcnREaXNtaXNzOiAoKSA9PiAodGhpcy5lcnJvciA9IG51bGwpIH0pKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc0xvY2F0b3JTZWxlY3Quc3R5bGUgPSBhcmNnaXNOZXdJdGVtUGFnZXNMb2NhdG9yU2VsZWN0Q3NzO1xuXG5leHBvcnQgeyBBcmNnaXNOZXdJdGVtUGFnZXNMb2NhdG9yU2VsZWN0IGFzIGFyY2dpc19uZXdfaXRlbV9wYWdlc19sb2NhdG9yX3NlbGVjdCB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9