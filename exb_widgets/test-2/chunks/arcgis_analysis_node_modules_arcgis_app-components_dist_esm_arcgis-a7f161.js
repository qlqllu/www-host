"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-a7f161"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js":
/*!**************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addItemState),
/* harmony export */   b: () => (/* binding */ addItemUrlState),
/* harmony export */   c: () => (/* binding */ addItemRequestState),
/* harmony export */   d: () => (/* binding */ addItemStore)
/* harmony export */ });
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const addItemStore = (0,_index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__.c)({
  typeKeywords: [],
  customParameters: [],
  analyzedLocationTypes: [],
  allowStoredAuth: true,
  isSecured: null,
  checkAuth: false
});
// Entire add item state object
const addItemState = addItemStore.state;
// Subsets of add item state
const addItemRequestState = addItemStore.state;
const addItemUrlState = addItemStore.state;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-csv-location-fields.entry.js":
/*!********************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-csv-location-fields.entry.js ***!
  \********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_csv_location_fields: () => (/* binding */ ArcgisNewItemPagesCsvLocationFields)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _analyze_a3711367_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./analyze-a3711367.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/analyze-a3711367.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./geocode-7eb7c0df.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-7eb7c0df.js");
/* harmony import */ var _item_types_054054c6_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./item-types-054054c6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-054054c6.js");
/* harmony import */ var _privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./privileges-35590eb4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-35590eb4.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _basic_ee9c674c_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./basic-ee9c674c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/basic-ee9c674c.js");
/* harmony import */ var _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./commonEnums-f98a323c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-f98a323c.js");
/* harmony import */ var _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./append-58a7e7ab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-58a7e7ab.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




















const arcgisNewItemPagesCsvLocationFieldsCss = ".wrapper{padding-bottom:2rem}.table{margin-bottom:1.5rem}.row{display:flex;align-items:center;padding-left:0;padding-right:0;padding-top:0.5rem;padding-bottom:0.5rem;box-shadow:0px -1px 0px #eaeaea}.row--header{box-shadow:none}.cell{box-sizing:border-box;width:50%;padding:0.5rem;font-weight:500;font-size:0.875rem;color:var(--calcite-ui-text-1)}.cell--header{font-weight:400}.advanced{background-color:var(--calcite-ui-foreground-2);margin-top:1rem;margin-bottom:2rem}.advanced__toggle{font-size:0.875rem;padding:1.25rem;margin:0;width:100%;color:var(--calcite-ui-text-2);font-weight:500;border-radius:0;box-sizing:border-box;border-style:none;cursor:pointer;display:flex;align-items:center;background-color:transparent;transition:all 150ms ease-in-out;outline-offset:0px;outline-color:transparent;font-family:inherit}.advanced__toggle:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:-2px}.advanced__icon{transform:rotate(90deg);transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);-webkit-margin-end:1rem;margin-inline-end:1rem}.arcgis--rtl{transform:rotate(-90deg)}.advanced__icon--open{transform:rotate(180deg)}.advanced__content{padding-left:1.25rem;padding-right:1.25rem;padding-top:0.5rem;padding-bottom:0.5rem}.two-up{display:flex;justify-content:space-between;margin-bottom:0.75rem}.column{width:calc(50% - 6px)}.header{font-size:1rem;color:var(--calcite-ui-text-1);font-weight:500;padding:0;margin:0;margin-bottom:0.5rem}.description{font-size:1rem;color:var(--calcite-ui-text-3);padding:0;margin:0;margin-bottom:1.5rem}.enrich-layer-container{background-color:var(--calcite-ui-foreground-1);border:1px solid var(--calcite-ui-border-input);padding:15px 15px 0px 15px}.enrich-switch{display:flex;justify-content:space-between}.enrich-title{display:flex;color:var(--calcite-ui-text-1)}.enrich-radio-text{color:var(--calcite-ui-text-3)}.radio{margin-bottom:0.75rem}.asterisk{color:var(--calcite-ui-danger)}.notice{margin-top:0.5rem}.loader-overlay{overflow:hidden}.enrich-description{margin-bottom:0.75rem;margin-top:0}";

const ArcgisNewItemPagesCsvLocationFields = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.workflowComplete = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
    this.newItemToggleNavigationEnabled = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
    this.newItemDisableCloseButtons = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemDisableCloseButtons", 7);
    this.userHasAssignedCredits = false;
    this.orgIsRestricted = false;
    this.showTotalCredits = false;
    this.isAppendWorkflow = false;
    // Telemetry: Log changes user made to fields
    this.logCSVLocationFieldsChanges = () => {
      const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.telemetry;
      const payload = {
        eventType: "other",
        pageName: "my content",
        category: "new item csv location settings",
        label: this.currentLocationType
      };
      // Handle properties unique to address location type
      if (this.currentLocationType === "address place names") {
        if (this.displayEnrichLayerSettings) {
          payload.action =
            this.selectedCandidateFieldsType === "GeometryOnly"
              ? "enrich with some fields"
              : "enrich with all fields";
        }
        else {
          payload.action = "enrich with no fields";
        }
        payload.facetValue =
          this.selectedLocationFieldSelectionType === "Multiple" ? "multi" : "single line address";
        payload.details =
          this.initialLocator === _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeServiceUrl
            ? "default locator"
            : "locator changed";
        payload.attribute =
          this.initialRegion === _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.sourceCountry ? "default region" : "region changed";
      }
      telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
    };
    this.selectedLocationType = "none";
    this.advancedExpanded = false;
    this.selectedCandidateFieldsType = "GeometryOnly";
    this.displayEnrichLayerSettings = false;
    this.selectedLocationFieldSelectionType = "Single";
    this.error = undefined;
    this.i18n = undefined;
  }
  async handleNext() {
    var _a;
    if ((this.orgIsRestricted || this.userHasAssignedCredits) && this.hasInsufficientCredits()) {
      this.error = this.i18n.errors.insufficientCredits;
      (_a = this.estimate) === null || _a === void 0 ? void 0 : _a.scrollIntoView();
      return;
    }
    const error = this.validateFields();
    if (error) {
      this.error = error;
    }
    else {
      this.error = null;
      if (this.isAppendWorkflow &&
        (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.addAppendSelectOption === "add" ||
          _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.addAppendSelectOption === "upsert")) {
        if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType === "none" &&
          _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.sourceDataLayer.geometryType === "esriGeometryPoint") {
          this.error = this.i18n.errors.noLocationTypeForAppend;
          return;
        }
      }
      const analyzeResults = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.analyzeResults;
      const publishParameters = (0,_geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_6__.e)(this.selectedLocationFieldSelectionType, this.isAppendWorkflow);
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.analyzeResults = Object.assign(Object.assign({}, analyzeResults), { publishParameters });
      if (this.isAppendWorkflow) {
        const { name } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.dataLayer;
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.dataLayer = publishParameters; //update dataLayer for append
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.dataLayer.name = name;
      }
      this.logCSVLocationFieldsChanges();
      let nextPage = "itemProperties";
      if (this.isAddToMapTerminalPage()) {
        this.workflowComplete.emit({
          type: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.type,
          url: encodeURI(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.url),
          customParameters: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.customParameters,
          results: {
            analyzeResults: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.analyzeResults,
            fields: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.selectedFields
          }
        });
      }
      else {
        if (this.isAppendWorkflow) {
          if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.addAppendSelectOption === "add" &&
            (!_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.backupLayerFields.some((field) => field.type === "esriFieldTypeDate") ||
              this.isEnterprise)) {
            nextPage = "appendMatchFields";
          }
          else {
            nextPage = "appendKeyPairSelect";
          }
        }
        this.newItemUpdatePage.emit(nextPage);
      }
    }
  }
  hasInsufficientCredits() {
    return (this.selectedLocationType === "address" &&
      (0,_geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_6__.i)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeServiceUrl) &&
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeCost &&
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeCost.transactionCreditCost > _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeCost.availableCredits);
  }
  showUnrestrictedOrgCreditsNotice() {
    return !(this.orgIsRestricted || this.userHasAssignedCredits) && this.hasInsufficientCredits();
  }
  isAddToMapTerminalPage() {
    return (_ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "map" &&
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.newItemMode === "url" &&
      !_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.enablePublishing);
  }
  async analyze() {
    var _a;
    const { file, url, existingItem, id: itemid, cloudProviderResource, type } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a;
    const { portal, user, config, lang } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
    return (0,_analyze_a3711367_js__WEBPACK_IMPORTED_MODULE_3__.a)({
      analyzeArgs: (!!existingItem || !!cloudProviderResource || (0,_item_types_054054c6_js__WEBPACK_IMPORTED_MODULE_7__.a)((_a = file === null || file === void 0 ? void 0 : file.size) !== null && _a !== void 0 ? _a : 0)) && !!itemid
        ? { type: "item", itemid }
        : file
          ? { type: "file", file }
          : { type: "url", sourceUrl: url },
      itemArgs: { itemType: type },
      configArgs: { portal, user, config, lang }
    });
  }
  async componentWillLoad() {
    var _a, _b, _c, _d, _e, _f;
    const { analyzeResults, type, selectedSheet, standardizedFieldNames, enablePublishing, cloudProviderResource, geocodeServiceUrl } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a;
    const { portal, user, config, lang } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const info = (0,_geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_6__.a)();
    this.isAppendWorkflow = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "append";
    this.subscriptionInfo = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.subscriptionInfo;
    this.isEnterprise = portal.isPortal;
    const appendInEnterprise = this.isAppendWorkflow && config.self.isPortal;
    const userAssignedCredits = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.api === 4 ? (_a = user.sourceJSON) === null || _a === void 0 ? void 0 : _a.assignedCredits : user.assignedCredits;
    this.userHasAssignedCredits = userAssignedCredits > 0;
    this.orgIsRestricted = ((_b = this.subscriptionInfo) === null || _b === void 0 ? void 0 : _b.state) === "restricted";
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.csvLocationFields;
    if (this.isAddToMapTerminalPage()) {
      _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.nextText = "addToMap";
    }
    let types = appendInEnterprise
      ? ["coordinates", "none"]
      : ["coordinates", "address", "none", "mgrs", "usng"];
    const showAddress = (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_8__.m)(user) &&
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeServers &&
      (_ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow !== "map" || enablePublishing);
    const isDev = (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_9__.c)(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.subscriptionInfo);
    this.showTotalCredits = (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_8__.o)(user, portal);
    const { selectedLocationFieldSelectionType } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a;
    this.selectedLocationFieldSelectionType = selectedLocationFieldSelectionType !== null && selectedLocationFieldSelectionType !== void 0 ? selectedLocationFieldSelectionType : "Single";
    const isAddDirectToMap = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "map" && !enablePublishing;
    this.locationTypes = types
      .map((key) => ({
      optionTitle: this.i18n.locationTypes[key].title,
      description: isDev && key === "address"
        ? this.i18n.locationTypes.address.descriptionDeveloper
        : this.i18n.locationTypes[key].description.replace("${type}", (cloudProviderResource === null || cloudProviderResource === void 0 ? void 0 : cloudProviderResource.cloudFileType) === "googlesheets" ? "Google Sheet" : type),
      value: key,
      badge: key === "address" && !_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.isPortal && !isDev
        ? { label: this.i18n.consumesCredits, icon: "credits" }
        : null,
      icon: key === "none" ? "table" : "layer-points"
    }))
      .filter(({ value }) => 
    // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2605
    (value !== "address" || showAddress) &&
      // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2766
      (value === "coordinates" || !isAddDirectToMap));
    // on first load, if coordinates are detected, use those instead of addresses
    const publishParameters = analyzeResults === null || analyzeResults === void 0 ? void 0 : analyzeResults.publishParameters;
    if (publishParameters) {
      const isExcel = type === "Microsoft Excel";
      const params = isExcel
        ? (_d = (_c = publishParameters === null || publishParameters === void 0 ? void 0 : publishParameters.layers) === null || _c === void 0 ? void 0 : _c[selectedSheet]) !== null && _d !== void 0 ? _d : (_e = publishParameters === null || publishParameters === void 0 ? void 0 : publishParameters.layers) === null || _e === void 0 ? void 0 : _e[0]
        : analyzeResults === null || analyzeResults === void 0 ? void 0 : analyzeResults.publishParameters;
      if (params.latitudeFieldName || params.longitudeFieldName) {
        this.selectedLocationType = "coordinates";
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "coordinates";
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.coordinateFieldType = "LatitudeAndLongitude";
      }
      if (publishParameters.locationType === "coordinates" &&
        publishParameters.coordinateFieldType) {
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "coordinates";
        switch (publishParameters.coordinateFieldType) {
          case "MGRS":
            this.selectedLocationType = "mgrs";
            _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.coordinateFieldType = "MGRS";
            break;
          case "USNG":
            this.selectedLocationType = "usng";
            _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.coordinateFieldType = "USNG";
            break;
          default:
            this.selectedLocationType = "coordinates";
            _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.coordinateFieldType = "LatitudeAndLongitude";
            break;
        }
      }
      else if (params.locationType === "address" && showAddress) {
        this.selectedLocationType = "address";
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "address";
      }
      if (this.isAppendWorkflow) {
        (_f = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType) !== null && _f !== void 0 ? _f : (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "none");
      }
    }
    if (this.locationTypes.length === 1) {
      const locationType = this.locationTypes[0].value;
      this.selectedLocationType = locationType;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType =
        locationType === "mgrs" || locationType === "usng" ? "coordinates" : locationType;
    }
    // if user can't geocode, and we're on address, swap to coordinates
    if (!showAddress && this.selectedLocationType === "address") {
      this.selectedLocationType = "coordinates";
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "coordinates";
    }
    // update analyze to use address if we have no address fields on first load
    if (this.selectedLocationType === "address" && !info.addressFields) {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "address";
    }
    // if on first load the field names have not been set
    if (!standardizedFieldNames) {
      await (0,_analyze_a3711367_js__WEBPACK_IMPORTED_MODULE_3__.s)({
        geocodeServiceUrl,
        // ! We set the location type above so we can't just use the destructed value
        // TODO: refactor that into a local variable
        locationType: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType,
        lang
      });
    }
    if (appendInEnterprise) {
      this.selectedLocationType = "coordinates";
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "coordinates";
    }
    // Telemetry: Capture initial values to compare against
    this.initialLocator = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeServiceUrl;
    this.initialRegion = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.sourceCountry;
    this.setLocationTypeTelemetry(this.selectedLocationType);
  }
  validateFields() {
    const { standardizedFieldNames, selectedFields, backupLayerFields } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a;
    const fields = !this.isAppendWorkflow ? Object.values(selectedFields) : backupLayerFields;
    const noFieldSelected = !fields.find(({ locationType }) => {
      const matchesLocationType = (locationType === null || locationType === void 0 ? void 0 : locationType.toLowerCase()) === this.selectedLocationType.toLowerCase();
      const matchesStandardizedField = !!(standardizedFieldNames === null || standardizedFieldNames === void 0 ? void 0 : standardizedFieldNames[locationType]);
      return matchesLocationType || matchesStandardizedField;
    });
    switch (this.selectedLocationType) {
      case "usng":
      case "mgrs":
        // check if at least one field has location type usng
        if (noFieldSelected) {
          return this.i18n.errors.noFieldSelected;
        }
        break;
      case "address":
        if (this.selectedLocationFieldSelectionType === "Single" && noFieldSelected) {
          return this.i18n.errors.noFieldSelected;
        }
        else if (this.selectedLocationFieldSelectionType === "Multiple") {
          const hasLocationField = fields.find((field) => field.locationType && field.locationType !== "unknown");
          if (!hasLocationField) {
            return this.i18n.errors.noFieldSelected;
          }
        }
        break;
      case "coordinates":
        // check if latitude _and_ longitude are selected;
        const matching = fields.filter(({ locationType }) => locationType === "latitude" || locationType === "longitude");
        if (matching.length < 2) {
          return this.i18n.errors.coordinate;
        }
        break;
    }
    return;
  }
  async updateLocationType(type, reanalyze) {
    this.selectedLocationType = type;
    if (type === "none") {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "none";
      this.currentLocationType = "none";
      return;
    }
    switch (type) {
      case "mgrs":
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.coordinateFieldType = "MGRS";
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "coordinates";
        break;
      case "coordinates":
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.coordinateFieldType = "LatitudeAndLongitude";
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "coordinates";
        break;
      case "usng":
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.coordinateFieldType = "USNG";
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "coordinates";
        break;
      case "address":
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "address";
        break;
    }
    if (reanalyze) {
      await this.analyze();
    }
    this.setLocationTypeTelemetry(type);
  }
  // Telemetry: Map location type to teletry label
  setLocationTypeTelemetry(type) {
    switch (type) {
      case "mgrs":
        this.currentLocationType = "mgrs coordinates";
        break;
      case "coordinates":
        this.currentLocationType = "lat lon";
        break;
      case "usng":
        this.currentLocationType = "usng coordinates";
        break;
      case "address":
        this.currentLocationType = "address place names";
        break;
      case "none":
        this.currentLocationType = "none";
        break;
    }
  }
  async updateGeocodeServer(url) {
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeServiceUrl = url;
    // TODO: update addItemState.isAgoWorldGeocodeServer here (https://devtopia.esri.com/WebGIS/arcgis-app-components/pull/1657)
    await this.analyze();
  }
  async updateRegion(region) {
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.sourceCountry = region;
    await this.analyze();
  }
  handleEnrichLayerSwitchChange(event) {
    const checked = event.target.checked;
    this.displayEnrichLayerSettings = checked;
    this.updateCandidateFields(checked ? "Minimal" : "GeometryOnly");
  }
  updateCandidateFields(value) {
    this.selectedCandidateFieldsType = value;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.candidateFieldsType = value;
  }
  renderLocationFields() {
    const { standardizedFieldNames } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a;
    const locationRows = {
      address: standardizedFieldNames,
      coordinates: { latitude: this.i18n.latitude, longitude: this.i18n.longitude },
      mgrs: { mgrs: "MGRS" },
      usng: { usng: "USNG" }
    };
    const rows = locationRows[this.selectedLocationType];
    if (this.selectedLocationFieldSelectionType === "Single" &&
      this.selectedLocationType === "address" &&
      rows) {
      const key = Object.keys(rows)[0];
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "row", role: "row" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "cell", role: "cell" }, rows[key]), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "cell", role: "cell" }, this.renderFieldSelect(key, rows[key]))));
    }
    else {
      return (rows &&
        Object.keys(rows).map((key) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "row", role: "row" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "cell", role: "cell" }, rows[key]), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "cell", role: "cell" }, this.renderFieldSelect(key, rows[key]))))));
    }
  }
  updateFieldLocationType(fieldName, addressKey) {
    const fields = !this.isAppendWorkflow
      ? Object.values(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.selectedFields)
      : _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.backupLayerFields;
    fields.forEach((field) => {
      if (field.name === fieldName) {
        field.locationType = addressKey;
      }
      else if (field.locationType === addressKey) {
        field.locationType = "unknown";
      }
    });
  }
  handleLocationFieldSelectionChange(newType) {
    this.selectedLocationFieldSelectionType = newType;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.selectedLocationFieldSelectionType = newType;
  }
  renderFieldSelect(addressKey, label) {
    const selectedFields = !this.isAppendWorkflow
      ? _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.selectedFields
      : _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.backupLayerFields;
    const fields = Object.keys(selectedFields).map((key) => selectedFields[key]);
    const useDefault = !fields.some((field) => {
      return field.locationType === addressKey;
    });
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: label, role: "cell", onCalciteSelectChange: (e) => this.updateFieldLocationType(e.currentTarget.selectedOption.value, addressKey) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "unknown", selected: useDefault }, this.i18n.unknown), fields.map((field) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: field.name, selected: field.locationType === addressKey }, field.alias || field.name)))));
  }
  render() {
    var _a, _b, _c, _d, _e;
    const { geocodeServiceUrl, geocodeServers, geocodeCost, sourceCountry, countryCodes } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a;
    const { config } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const recordCount = (_b = (_a = (0,_geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_6__.a)()) === null || _a === void 0 ? void 0 : _a.estimatedRecordCount) !== null && _b !== void 0 ? _b : 0;
    const { helpMap, helpBase } = config;
    const dir = (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.el);
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "wrapper" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-select", { class: "label--top", selectedOption: this.selectedLocationType, options: this.locationTypes, label: this.i18n.locationSettings, labelDescription: this.i18n.locationSettingsDescription, onArcgisOptionChange: (e) => this.updateLocationType(e.detail, true) }), this.selectedLocationType !== "none" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.selectedLocationType === "address" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "advanced" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { class: "advanced__toggle", "aria-expanded": this.advancedExpanded.toString(), "aria-controls": "advanced__content", onClick: () => (this.advancedExpanded = !this.advancedExpanded) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "chevron-up", scale: "s", class: {
        advanced__icon: true,
        [_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.C.rtl]: dir === "rtl",
        "advanced__icon--open": this.advancedExpanded
      } }), this.i18n.advancedSettings), this.advancedExpanded && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "advanced__content", id: "advanced__content" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "two-up" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "column" }, this.i18n.locator, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "", onCalciteSelectChange: (e) => this.updateGeocodeServer(e.currentTarget.selectedOption.value) }, geocodeServers === null || geocodeServers === void 0 ? void 0 : geocodeServers.map((server) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: server.url, selected: server.url === geocodeServiceUrl }, server.name))))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "column" }, this.i18n.region, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "", onCalciteSelectChange: (e) => this.updateRegion(e.currentTarget.selectedOption.value) }, countryCodes === null || countryCodes === void 0 ? void 0 : countryCodes.map((country) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: country.value, selected: country.value.toLowerCase() === sourceCountry.toLowerCase() }, this.i18n.countryCodes[country.value.toUpperCase()] || country.label)))))), !_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.isPortal && !this.isAppendWorkflow && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "enrich-layer-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline-space-between" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "enrich-title" }, this.i18n.enrich, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-information", { label: (_c = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n) === null || _c === void 0 ? void 0 : _c.moreInfo, placement: "top-start", paddedContent: true }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "enrich-description" }, this.i18n.enrichLayerDescription), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", {
      /*@ts-ignore*/
      target: "_blank", href: `${helpBase}${helpMap["120002541"]}`
    }, this.i18n.enrichLayerLink))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { checked: this.displayEnrichLayerSettings, onCalciteSwitchChange: this.handleEnrichLayerSwitchChange.bind(this) })), this.displayEnrichLayerSettings ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button-group", { layout: "vertical", name: "enrich-group", onCalciteRadioButtonGroupChange: (event) => this.updateCandidateFields(event.target.selectedItem.value) }, ["Minimal", "AllFields"].map((type) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline", key: type }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button", { checked: this.selectedCandidateFieldsType === type, value: type }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "enrich-radio-text" }, this.i18n.candidateFieldsTypes[type].description)))))) : null)))))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { class: "header" }, this.i18n.locationFields, " ", (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "asterisk" }, "*")), this.selectedLocationType === "address" ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button-group", { name: "location-field-selection-group", layout: "vertical", onCalciteRadioButtonGroupChange: (event) => this.handleLocationFieldSelectionChange(event.target.selectedItem.value) }, ["Single", "Multiple"].map((type) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline", key: type }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button", { checked: this.selectedLocationFieldSelectionType === type, value: type }), this.i18n[type === "Single" ? "locationFieldSingle" : "locationFieldMultiple"]))))) : null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { role: "table", class: "table" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "row row--header", role: "row" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "cell cell--header", role: "columnheader", "aria-sort": "none" }, this.i18n.locationType), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "cell cell--header", role: "columnheader", "aria-sort": "none" }, this.i18n.field)), this.renderLocationFields()))), this.selectedLocationType === "address" &&
      geocodeCost &&
      !_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.isPortal &&
      (0,_geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_6__.i)(geocodeServiceUrl) && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_9__.c)(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.subscriptionInfo) ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { scale: "m", width: "full", open: true, icon: "information" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, this.i18n.recordCount.replace("${num}", `${recordCount}`))))) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-credit-estimate", { transactionCreditCost: geocodeCost.transactionCreditCost, availableCredits: geocodeCost.availableCredits, showTotal: this.showTotalCredits, class: "credit-estimate", api: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.api, ref: (el) => (this.estimate = el) })), this.showUnrestrictedOrgCreditsNotice() && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { class: "notice", kind: "brand", icon: "information", open: true }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, this.i18n.unrestrictedOrgCredits.title), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, this.i18n.unrestrictedOrgCredits.description))))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: (_d = this.error) === null || _d === void 0 ? void 0 : _d.title, description: (_e = this.error) === null || _e === void 0 ? void 0 : _e.description, active: !!this.error, onAlertDismiss: () => (this.error = null) })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesCsvLocationFields.style = arcgisNewItemPagesCsvLocationFieldsCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-054054c6.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-054054c6.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isLargeCSV),
/* harmony export */   f: () => (/* binding */ findPossibleItemTypesByExtension),
/* harmony export */   i: () => (/* binding */ isLargeGeoJSON),
/* harmony export */   m: () => (/* binding */ mapItemTypesToFileExtensions)
/* harmony export */ });
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



function findPossibleItemTypesByExtension(extension, validationTypes) {
  // Search item types extensions for the one imported
  let itemTypes;
  if (validationTypes) {
    itemTypes = validationTypes.map((value) => {
      return value.type;
    });
  }
  else {
    itemTypes = Object.keys(_item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__.a);
  }
  let possibleItemTypes = [];
  itemTypes.forEach((type) => {
    var _a;
    if (((_a = _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__.a[type].fileExt) === null || _a === void 0 ? void 0 : _a.indexOf(extension)) >= 0) {
      possibleItemTypes.push(_item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__.a[type]);
    }
  });
  return possibleItemTypes;
}
function mapItemTypesToFileExtensions(types) {
  if (!types) {
    return null;
  }
  return (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_0__.b)(types.flatMap((type) => { var _a; return (_a = _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__.a[type]) === null || _a === void 0 ? void 0 : _a.fileExt; }).filter((valid) => !!valid));
}
const isLargeGeoJSON = (sizeInBytes) => {
  const sizeInMB = sizeInBytes / 1024 / 1024;
  // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2553#issuecomment-3645404
  return sizeInMB > 50; // 50MB
};
const isLargeCSV = (sizeInBytes) => {
  const sizeInMB = sizeInBytes / 1024 / 1024;
  // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2875#issuecomment-3748913
  return sizeInMB > 20; // 20MB
};




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



const languageMap = new Map([
  ["ar", "ar"],
  ["bg", "bg"],
  ["bs", "bs"],
  ["ca", "ca"],
  ["cs", "cs"],
  ["da", "da"],
  ["de", "de"],
  ["el", "el"],
  ["en", "en"],
  ["es", "es"],
  ["et", "et"],
  ["fi", "fi"],
  ["fr", "fr"],
  ["he", "he"],
  ["hr", "hr"],
  ["hu", "hu"],
  ["id", "id"],
  ["it", "it"],
  ["ja", "ja"],
  ["ko", "ko"],
  ["lt", "lt"],
  ["lv", "lv"],
  ["nb", "nb"],
  ["nl", "nl"],
  ["pl", "pl"],
  ["pt-br", "pt-BR"],
  ["pt-pt", "pt-PT"],
  ["ro", "ro"],
  ["ru", "ru"],
  ["sk", "sk"],
  ["sl", "sl"],
  ["sr", "sr"],
  ["sv", "sv"],
  ["th", "th"],
  ["tr", "tr"],
  ["uk", "uk"],
  ["vi", "vi"],
  ["zh-cn", "zh-CN"],
  ["zh-hk", "zh-HK"],
  ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
  return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
  const closestWithProp = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
  return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
  rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
  const { api, type, places } = options || {};
  if (api === 4) {
    const [intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
    const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
      places,
      style: type,
      digitSeparator: true
    });
    return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
  }
  const [dojoNumber] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
  return dojoNumber.format(number, {
    type,
    places,
    pattern: options === null || options === void 0 ? void 0 : options.pattern
  });
}
const cache = {};
function formatDate(date) {
  const lang = document.documentElement.lang;
  const dayShortMonthYear = {
    year: "numeric",
    month: "short",
    day: "numeric"
  };
  if (!cache[lang]) {
    cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
  }
  return cache[lang].format(date);
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWE3ZjE2MS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ3VEOztBQUV2RCxxQkFBcUIscURBQVc7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRWdHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDcEJoRztBQUNBO0FBQ0E7QUFDQTtBQUNpSDtBQUN6RDtBQUMwQjtBQUNHO0FBQzFCO0FBQ047QUFDMEU7QUFDcEU7QUFDMEI7QUFDekI7QUFDL0I7QUFDTTtBQUNSO0FBQ0U7QUFDTTtBQUNMO0FBQ0E7QUFDSTtBQUNBOztBQUVsQyx5REFBeUQsb0JBQW9CLE9BQU8scUJBQXFCLEtBQUssYUFBYSxtQkFBbUIsZUFBZSxnQkFBZ0IsbUJBQW1CLHNCQUFzQixnQ0FBZ0MsYUFBYSxnQkFBZ0IsTUFBTSxzQkFBc0IsVUFBVSxlQUFlLGdCQUFnQixtQkFBbUIsK0JBQStCLGNBQWMsZ0JBQWdCLFVBQVUsZ0RBQWdELGdCQUFnQixtQkFBbUIsa0JBQWtCLG1CQUFtQixnQkFBZ0IsU0FBUyxXQUFXLCtCQUErQixnQkFBZ0IsZ0JBQWdCLHNCQUFzQixrQkFBa0IsZUFBZSxhQUFhLG1CQUFtQiw2QkFBNkIsaUNBQWlDLG1CQUFtQiwwQkFBMEIsb0JBQW9CLHdCQUF3QiwwQ0FBMEMsb0JBQW9CLGdCQUFnQix3QkFBd0IsMEJBQTBCLHdEQUF3RCx3QkFBd0IsdUJBQXVCLGFBQWEseUJBQXlCLHNCQUFzQix5QkFBeUIsbUJBQW1CLHFCQUFxQixzQkFBc0IsbUJBQW1CLHNCQUFzQixRQUFRLGFBQWEsOEJBQThCLHNCQUFzQixRQUFRLHNCQUFzQixRQUFRLGVBQWUsK0JBQStCLGdCQUFnQixV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QzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxzREFBa0I7QUFDakMsNkJBQTZCLHNEQUFrQjtBQUMvQztBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLDBEQUFNLDJCQUEyQixRQUFRLGFBQWEsc0RBQWtCLDBEQUEwRDtBQUMzSTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4Qjs7QUFFMEg7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQzVDMUg7QUFDQTtBQUNBO0FBQ0E7QUFDNkQ7QUFDYzs7QUFFM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixtREFBaUMsU0FBUyxLQUFLO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxvQkFBb0I7QUFDOUI7QUFDQSx5QkFBeUIsMkRBQVc7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsbUVBQW1FLDhCQUE4QixhQUFhO0FBQzlHO0FBQ0EsNkJBQTZCLDJEQUFXO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXNHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYWRkLWl0ZW0tOTdkNTc3YTkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWNzdi1sb2NhdGlvbi1maWVsZHMuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vaXRlbS10eXBlcy0wNTQwNTRjNi5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sYW5ndWFnZVV0aWwtMjIyNThjOTAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC04MWQ1NDhiNy5qcyc7XG5cbmNvbnN0IGFkZEl0ZW1TdG9yZSA9IGNyZWF0ZVN0b3JlKHtcbiAgdHlwZUtleXdvcmRzOiBbXSxcbiAgY3VzdG9tUGFyYW1ldGVyczogW10sXG4gIGFuYWx5emVkTG9jYXRpb25UeXBlczogW10sXG4gIGFsbG93U3RvcmVkQXV0aDogdHJ1ZSxcbiAgaXNTZWN1cmVkOiBudWxsLFxuICBjaGVja0F1dGg6IGZhbHNlXG59KTtcbi8vIEVudGlyZSBhZGQgaXRlbSBzdGF0ZSBvYmplY3RcbmNvbnN0IGFkZEl0ZW1TdGF0ZSA9IGFkZEl0ZW1TdG9yZS5zdGF0ZTtcbi8vIFN1YnNldHMgb2YgYWRkIGl0ZW0gc3RhdGVcbmNvbnN0IGFkZEl0ZW1SZXF1ZXN0U3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5jb25zdCBhZGRJdGVtVXJsU3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5cbmV4cG9ydCB7IGFkZEl0ZW1TdGF0ZSBhcyBhLCBhZGRJdGVtVXJsU3RhdGUgYXMgYiwgYWRkSXRlbVJlcXVlc3RTdGF0ZSBhcyBjLCBhZGRJdGVtU3RvcmUgYXMgZCB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIEYgYXMgRnJhZ21lbnQsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtOTJlYmIzOTYuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLWViNWY3ZGMyLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0RWxlbWVudERpciwgQyBhcyBDU1NfVVRJTElUWSB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzJztcbmltcG9ydCB7IGEgYXMgYW5hbHl6ZSwgcyBhcyBzZXRTdGFuZGFyZGl6ZWRGaWVsZE5hbWVzIH0gZnJvbSAnLi9hbmFseXplLWEzNzExMzY3LmpzJztcbmltcG9ydCB7IGEgYXMgYWRkSXRlbVN0YXRlIH0gZnJvbSAnLi9hZGQtaXRlbS05N2Q1NzdhOS5qcyc7XG5pbXBvcnQgeyB1IGFzIHVpU3RvcmVTdGF0ZSB9IGZyb20gJy4vdWktZWNmODZiYmEuanMnO1xuaW1wb3J0IHsgZSBhcyBnZXRMb2NhdGlvblB1Ymxpc2hQYXJhbWV0ZXJzLCBpIGFzIGlzRXNyaVdvcmxkR2VvY29kZXIsIGEgYXMgZ2V0QW5hbHl6ZWRMYXllckluZm8gfSBmcm9tICcuL2dlb2NvZGUtN2ViN2MwZGYuanMnO1xuaW1wb3J0IHsgYSBhcyBpc0xhcmdlQ1NWIH0gZnJvbSAnLi9pdGVtLXR5cGVzLTA1NDA1NGM2LmpzJztcbmltcG9ydCB7IG0gYXMgY2FuR2VvY29kZSwgbyBhcyBjYW5TaG93VG90YWxDcmVkaXRzIH0gZnJvbSAnLi9wcml2aWxlZ2VzLTM1NTkwZWI0LmpzJztcbmltcG9ydCB7IGMgYXMgaXNEZXZlbG9wZXIgfSBmcm9tICcuL3ByaXZpbGVnZXMtY2NkNWYzN2QuanMnO1xuaW1wb3J0ICcuL2luZGV4LTgxZDU0OGI3LmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1hYWYzMGJkNi5qcyc7XG5pbXBvcnQgJy4vZG9tLTEzZjViMDBjLmpzJztcbmltcG9ydCAnLi9iYXNpYy1lZTljNjc0Yy5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRW51bXMtZjk4YTMyM2MuanMnO1xuaW1wb3J0ICcuL2FwcGVuZC01OGE3ZTdhYi5qcyc7XG5pbXBvcnQgJy4vcG9ydGFsLTc5Y2FhZWZmLmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLWM4MmY1YWI5LmpzJztcbmltcG9ydCAnLi9pdGVtLXR5cGVzLWI0ZmU4NmFkLmpzJztcblxuY29uc3QgYXJjZ2lzTmV3SXRlbVBhZ2VzQ3N2TG9jYXRpb25GaWVsZHNDc3MgPSBcIi53cmFwcGVye3BhZGRpbmctYm90dG9tOjJyZW19LnRhYmxle21hcmdpbi1ib3R0b206MS41cmVtfS5yb3d7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtwYWRkaW5nLWxlZnQ6MDtwYWRkaW5nLXJpZ2h0OjA7cGFkZGluZy10b3A6MC41cmVtO3BhZGRpbmctYm90dG9tOjAuNXJlbTtib3gtc2hhZG93OjBweCAtMXB4IDBweCAjZWFlYWVhfS5yb3ctLWhlYWRlcntib3gtc2hhZG93Om5vbmV9LmNlbGx7Ym94LXNpemluZzpib3JkZXItYm94O3dpZHRoOjUwJTtwYWRkaW5nOjAuNXJlbTtmb250LXdlaWdodDo1MDA7Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0xKX0uY2VsbC0taGVhZGVye2ZvbnQtd2VpZ2h0OjQwMH0uYWR2YW5jZWR7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMik7bWFyZ2luLXRvcDoxcmVtO21hcmdpbi1ib3R0b206MnJlbX0uYWR2YW5jZWRfX3RvZ2dsZXtmb250LXNpemU6MC44NzVyZW07cGFkZGluZzoxLjI1cmVtO21hcmdpbjowO3dpZHRoOjEwMCU7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTIpO2ZvbnQtd2VpZ2h0OjUwMDtib3JkZXItcmFkaXVzOjA7Ym94LXNpemluZzpib3JkZXItYm94O2JvcmRlci1zdHlsZTpub25lO2N1cnNvcjpwb2ludGVyO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDt0cmFuc2l0aW9uOmFsbCAxNTBtcyBlYXNlLWluLW91dDtvdXRsaW5lLW9mZnNldDowcHg7b3V0bGluZS1jb2xvcjp0cmFuc3BhcmVudDtmb250LWZhbWlseTppbmhlcml0fS5hZHZhbmNlZF9fdG9nZ2xlOmZvY3Vze291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktYnJhbmQpO291dGxpbmUtb2Zmc2V0Oi0ycHh9LmFkdmFuY2VkX19pY29ue3RyYW5zZm9ybTpyb3RhdGUoOTBkZWcpO3RyYW5zaXRpb24tZHVyYXRpb246MTUwbXM7dHJhbnNpdGlvbi10aW1pbmctZnVuY3Rpb246Y3ViaWMtYmV6aWVyKDAuNCwgMCwgMC4yLCAxKTstd2Via2l0LW1hcmdpbi1lbmQ6MXJlbTttYXJnaW4taW5saW5lLWVuZDoxcmVtfS5hcmNnaXMtLXJ0bHt0cmFuc2Zvcm06cm90YXRlKC05MGRlZyl9LmFkdmFuY2VkX19pY29uLS1vcGVue3RyYW5zZm9ybTpyb3RhdGUoMTgwZGVnKX0uYWR2YW5jZWRfX2NvbnRlbnR7cGFkZGluZy1sZWZ0OjEuMjVyZW07cGFkZGluZy1yaWdodDoxLjI1cmVtO3BhZGRpbmctdG9wOjAuNXJlbTtwYWRkaW5nLWJvdHRvbTowLjVyZW19LnR3by11cHtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47bWFyZ2luLWJvdHRvbTowLjc1cmVtfS5jb2x1bW57d2lkdGg6Y2FsYyg1MCUgLSA2cHgpfS5oZWFkZXJ7Zm9udC1zaXplOjFyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpO2ZvbnQtd2VpZ2h0OjUwMDtwYWRkaW5nOjA7bWFyZ2luOjA7bWFyZ2luLWJvdHRvbTowLjVyZW19LmRlc2NyaXB0aW9ue2ZvbnQtc2l6ZToxcmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0zKTtwYWRkaW5nOjA7bWFyZ2luOjA7bWFyZ2luLWJvdHRvbToxLjVyZW19LmVucmljaC1sYXllci1jb250YWluZXJ7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMSk7Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLXVpLWJvcmRlci1pbnB1dCk7cGFkZGluZzoxNXB4IDE1cHggMHB4IDE1cHh9LmVucmljaC1zd2l0Y2h7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVufS5lbnJpY2gtdGl0bGV7ZGlzcGxheTpmbGV4O2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0xKX0uZW5yaWNoLXJhZGlvLXRleHR7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTMpfS5yYWRpb3ttYXJnaW4tYm90dG9tOjAuNzVyZW19LmFzdGVyaXNre2NvbG9yOnZhcigtLWNhbGNpdGUtdWktZGFuZ2VyKX0ubm90aWNle21hcmdpbi10b3A6MC41cmVtfS5sb2FkZXItb3ZlcmxheXtvdmVyZmxvdzpoaWRkZW59LmVucmljaC1kZXNjcmlwdGlvbnttYXJnaW4tYm90dG9tOjAuNzVyZW07bWFyZ2luLXRvcDowfVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNDc3ZMb2NhdGlvbkZpZWxkcyA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVVwZGF0ZVBhZ2VcIiwgNyk7XG4gICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJ3b3JrZmxvd0NvbXBsZXRlXCIsIDcpO1xuICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWRcIiwgNyk7XG4gICAgdGhpcy5uZXdJdGVtRGlzYWJsZUNsb3NlQnV0dG9ucyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbURpc2FibGVDbG9zZUJ1dHRvbnNcIiwgNyk7XG4gICAgdGhpcy51c2VySGFzQXNzaWduZWRDcmVkaXRzID0gZmFsc2U7XG4gICAgdGhpcy5vcmdJc1Jlc3RyaWN0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLnNob3dUb3RhbENyZWRpdHMgPSBmYWxzZTtcbiAgICB0aGlzLmlzQXBwZW5kV29ya2Zsb3cgPSBmYWxzZTtcbiAgICAvLyBUZWxlbWV0cnk6IExvZyBjaGFuZ2VzIHVzZXIgbWFkZSB0byBmaWVsZHNcbiAgICB0aGlzLmxvZ0NTVkxvY2F0aW9uRmllbGRzQ2hhbmdlcyA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHRlbGVtZXRyeSA9IGNvbmZpZ1N0YXRlLnRlbGVtZXRyeTtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgIGV2ZW50VHlwZTogXCJvdGhlclwiLFxuICAgICAgICBwYWdlTmFtZTogXCJteSBjb250ZW50XCIsXG4gICAgICAgIGNhdGVnb3J5OiBcIm5ldyBpdGVtIGNzdiBsb2NhdGlvbiBzZXR0aW5nc1wiLFxuICAgICAgICBsYWJlbDogdGhpcy5jdXJyZW50TG9jYXRpb25UeXBlXG4gICAgICB9O1xuICAgICAgLy8gSGFuZGxlIHByb3BlcnRpZXMgdW5pcXVlIHRvIGFkZHJlc3MgbG9jYXRpb24gdHlwZVxuICAgICAgaWYgKHRoaXMuY3VycmVudExvY2F0aW9uVHlwZSA9PT0gXCJhZGRyZXNzIHBsYWNlIG5hbWVzXCIpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlzcGxheUVucmljaExheWVyU2V0dGluZ3MpIHtcbiAgICAgICAgICBwYXlsb2FkLmFjdGlvbiA9XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkQ2FuZGlkYXRlRmllbGRzVHlwZSA9PT0gXCJHZW9tZXRyeU9ubHlcIlxuICAgICAgICAgICAgICA/IFwiZW5yaWNoIHdpdGggc29tZSBmaWVsZHNcIlxuICAgICAgICAgICAgICA6IFwiZW5yaWNoIHdpdGggYWxsIGZpZWxkc1wiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHBheWxvYWQuYWN0aW9uID0gXCJlbnJpY2ggd2l0aCBubyBmaWVsZHNcIjtcbiAgICAgICAgfVxuICAgICAgICBwYXlsb2FkLmZhY2V0VmFsdWUgPVxuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRMb2NhdGlvbkZpZWxkU2VsZWN0aW9uVHlwZSA9PT0gXCJNdWx0aXBsZVwiID8gXCJtdWx0aVwiIDogXCJzaW5nbGUgbGluZSBhZGRyZXNzXCI7XG4gICAgICAgIHBheWxvYWQuZGV0YWlscyA9XG4gICAgICAgICAgdGhpcy5pbml0aWFsTG9jYXRvciA9PT0gYWRkSXRlbVN0YXRlLmdlb2NvZGVTZXJ2aWNlVXJsXG4gICAgICAgICAgICA/IFwiZGVmYXVsdCBsb2NhdG9yXCJcbiAgICAgICAgICAgIDogXCJsb2NhdG9yIGNoYW5nZWRcIjtcbiAgICAgICAgcGF5bG9hZC5hdHRyaWJ1dGUgPVxuICAgICAgICAgIHRoaXMuaW5pdGlhbFJlZ2lvbiA9PT0gYWRkSXRlbVN0YXRlLnNvdXJjZUNvdW50cnkgPyBcImRlZmF1bHQgcmVnaW9uXCIgOiBcInJlZ2lvbiBjaGFuZ2VkXCI7XG4gICAgICB9XG4gICAgICB0ZWxlbWV0cnkgPT09IG51bGwgfHwgdGVsZW1ldHJ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlbWV0cnkubG9nRXZlbnQocGF5bG9hZCk7XG4gICAgfTtcbiAgICB0aGlzLnNlbGVjdGVkTG9jYXRpb25UeXBlID0gXCJub25lXCI7XG4gICAgdGhpcy5hZHZhbmNlZEV4cGFuZGVkID0gZmFsc2U7XG4gICAgdGhpcy5zZWxlY3RlZENhbmRpZGF0ZUZpZWxkc1R5cGUgPSBcIkdlb21ldHJ5T25seVwiO1xuICAgIHRoaXMuZGlzcGxheUVucmljaExheWVyU2V0dGluZ3MgPSBmYWxzZTtcbiAgICB0aGlzLnNlbGVjdGVkTG9jYXRpb25GaWVsZFNlbGVjdGlvblR5cGUgPSBcIlNpbmdsZVwiO1xuICAgIHRoaXMuZXJyb3IgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICB9XG4gIGFzeW5jIGhhbmRsZU5leHQoKSB7XG4gICAgdmFyIF9hO1xuICAgIGlmICgodGhpcy5vcmdJc1Jlc3RyaWN0ZWQgfHwgdGhpcy51c2VySGFzQXNzaWduZWRDcmVkaXRzKSAmJiB0aGlzLmhhc0luc3VmZmljaWVudENyZWRpdHMoKSkge1xuICAgICAgdGhpcy5lcnJvciA9IHRoaXMuaTE4bi5lcnJvcnMuaW5zdWZmaWNpZW50Q3JlZGl0cztcbiAgICAgIChfYSA9IHRoaXMuZXN0aW1hdGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zY3JvbGxJbnRvVmlldygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBlcnJvciA9IHRoaXMudmFsaWRhdGVGaWVsZHMoKTtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHRoaXMuZXJyb3IgPSBlcnJvcjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmVycm9yID0gbnVsbDtcbiAgICAgIGlmICh0aGlzLmlzQXBwZW5kV29ya2Zsb3cgJiZcbiAgICAgICAgKGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwiYWRkXCIgfHxcbiAgICAgICAgICBhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcInVwc2VydFwiKSkge1xuICAgICAgICBpZiAoYWRkSXRlbVN0YXRlLmxvY2F0aW9uVHlwZSA9PT0gXCJub25lXCIgJiZcbiAgICAgICAgICBhZGRJdGVtU3RhdGUuc291cmNlRGF0YUxheWVyLmdlb21ldHJ5VHlwZSA9PT0gXCJlc3JpR2VvbWV0cnlQb2ludFwiKSB7XG4gICAgICAgICAgdGhpcy5lcnJvciA9IHRoaXMuaTE4bi5lcnJvcnMubm9Mb2NhdGlvblR5cGVGb3JBcHBlbmQ7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb25zdCBhbmFseXplUmVzdWx0cyA9IGFkZEl0ZW1TdGF0ZS5hbmFseXplUmVzdWx0cztcbiAgICAgIGNvbnN0IHB1Ymxpc2hQYXJhbWV0ZXJzID0gZ2V0TG9jYXRpb25QdWJsaXNoUGFyYW1ldGVycyh0aGlzLnNlbGVjdGVkTG9jYXRpb25GaWVsZFNlbGVjdGlvblR5cGUsIHRoaXMuaXNBcHBlbmRXb3JrZmxvdyk7XG4gICAgICBhZGRJdGVtU3RhdGUuYW5hbHl6ZVJlc3VsdHMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGFuYWx5emVSZXN1bHRzKSwgeyBwdWJsaXNoUGFyYW1ldGVycyB9KTtcbiAgICAgIGlmICh0aGlzLmlzQXBwZW5kV29ya2Zsb3cpIHtcbiAgICAgICAgY29uc3QgeyBuYW1lIH0gPSBhZGRJdGVtU3RhdGUuZGF0YUxheWVyO1xuICAgICAgICBhZGRJdGVtU3RhdGUuZGF0YUxheWVyID0gcHVibGlzaFBhcmFtZXRlcnM7IC8vdXBkYXRlIGRhdGFMYXllciBmb3IgYXBwZW5kXG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5kYXRhTGF5ZXIubmFtZSA9IG5hbWU7XG4gICAgICB9XG4gICAgICB0aGlzLmxvZ0NTVkxvY2F0aW9uRmllbGRzQ2hhbmdlcygpO1xuICAgICAgbGV0IG5leHRQYWdlID0gXCJpdGVtUHJvcGVydGllc1wiO1xuICAgICAgaWYgKHRoaXMuaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpKSB7XG4gICAgICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZS5lbWl0KHtcbiAgICAgICAgICB0eXBlOiBhZGRJdGVtU3RhdGUudHlwZSxcbiAgICAgICAgICB1cmw6IGVuY29kZVVSSShhZGRJdGVtU3RhdGUudXJsKSxcbiAgICAgICAgICBjdXN0b21QYXJhbWV0ZXJzOiBhZGRJdGVtU3RhdGUuY3VzdG9tUGFyYW1ldGVycyxcbiAgICAgICAgICByZXN1bHRzOiB7XG4gICAgICAgICAgICBhbmFseXplUmVzdWx0czogYWRkSXRlbVN0YXRlLmFuYWx5emVSZXN1bHRzLFxuICAgICAgICAgICAgZmllbGRzOiBhZGRJdGVtU3RhdGUuc2VsZWN0ZWRGaWVsZHNcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGlmICh0aGlzLmlzQXBwZW5kV29ya2Zsb3cpIHtcbiAgICAgICAgICBpZiAoYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJhZGRcIiAmJlxuICAgICAgICAgICAgKCFhZGRJdGVtU3RhdGUuYmFja3VwTGF5ZXJGaWVsZHMuc29tZSgoZmllbGQpID0+IGZpZWxkLnR5cGUgPT09IFwiZXNyaUZpZWxkVHlwZURhdGVcIikgfHxcbiAgICAgICAgICAgICAgdGhpcy5pc0VudGVycHJpc2UpKSB7XG4gICAgICAgICAgICBuZXh0UGFnZSA9IFwiYXBwZW5kTWF0Y2hGaWVsZHNcIjtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBuZXh0UGFnZSA9IFwiYXBwZW5kS2V5UGFpclNlbGVjdFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQobmV4dFBhZ2UpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBoYXNJbnN1ZmZpY2llbnRDcmVkaXRzKCkge1xuICAgIHJldHVybiAodGhpcy5zZWxlY3RlZExvY2F0aW9uVHlwZSA9PT0gXCJhZGRyZXNzXCIgJiZcbiAgICAgIGlzRXNyaVdvcmxkR2VvY29kZXIoYWRkSXRlbVN0YXRlLmdlb2NvZGVTZXJ2aWNlVXJsKSAmJlxuICAgICAgYWRkSXRlbVN0YXRlLmdlb2NvZGVDb3N0ICYmXG4gICAgICBhZGRJdGVtU3RhdGUuZ2VvY29kZUNvc3QudHJhbnNhY3Rpb25DcmVkaXRDb3N0ID4gYWRkSXRlbVN0YXRlLmdlb2NvZGVDb3N0LmF2YWlsYWJsZUNyZWRpdHMpO1xuICB9XG4gIHNob3dVbnJlc3RyaWN0ZWRPcmdDcmVkaXRzTm90aWNlKCkge1xuICAgIHJldHVybiAhKHRoaXMub3JnSXNSZXN0cmljdGVkIHx8IHRoaXMudXNlckhhc0Fzc2lnbmVkQ3JlZGl0cykgJiYgdGhpcy5oYXNJbnN1ZmZpY2llbnRDcmVkaXRzKCk7XG4gIH1cbiAgaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpIHtcbiAgICByZXR1cm4gKHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIiAmJlxuICAgICAgYWRkSXRlbVN0YXRlLm5ld0l0ZW1Nb2RlID09PSBcInVybFwiICYmXG4gICAgICAhYWRkSXRlbVN0YXRlLmVuYWJsZVB1Ymxpc2hpbmcpO1xuICB9XG4gIGFzeW5jIGFuYWx5emUoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgZmlsZSwgdXJsLCBleGlzdGluZ0l0ZW0sIGlkOiBpdGVtaWQsIGNsb3VkUHJvdmlkZXJSZXNvdXJjZSwgdHlwZSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIGNvbnN0IHsgcG9ydGFsLCB1c2VyLCBjb25maWcsIGxhbmcgfSA9IGNvbmZpZ1N0YXRlO1xuICAgIHJldHVybiBhbmFseXplKHtcbiAgICAgIGFuYWx5emVBcmdzOiAoISFleGlzdGluZ0l0ZW0gfHwgISFjbG91ZFByb3ZpZGVyUmVzb3VyY2UgfHwgaXNMYXJnZUNTVigoX2EgPSBmaWxlID09PSBudWxsIHx8IGZpbGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpbGUuc2l6ZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMCkpICYmICEhaXRlbWlkXG4gICAgICAgID8geyB0eXBlOiBcIml0ZW1cIiwgaXRlbWlkIH1cbiAgICAgICAgOiBmaWxlXG4gICAgICAgICAgPyB7IHR5cGU6IFwiZmlsZVwiLCBmaWxlIH1cbiAgICAgICAgICA6IHsgdHlwZTogXCJ1cmxcIiwgc291cmNlVXJsOiB1cmwgfSxcbiAgICAgIGl0ZW1BcmdzOiB7IGl0ZW1UeXBlOiB0eXBlIH0sXG4gICAgICBjb25maWdBcmdzOiB7IHBvcnRhbCwgdXNlciwgY29uZmlnLCBsYW5nIH1cbiAgICB9KTtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZjtcbiAgICBjb25zdCB7IGFuYWx5emVSZXN1bHRzLCB0eXBlLCBzZWxlY3RlZFNoZWV0LCBzdGFuZGFyZGl6ZWRGaWVsZE5hbWVzLCBlbmFibGVQdWJsaXNoaW5nLCBjbG91ZFByb3ZpZGVyUmVzb3VyY2UsIGdlb2NvZGVTZXJ2aWNlVXJsIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgY29uc3QgeyBwb3J0YWwsIHVzZXIsIGNvbmZpZywgbGFuZyB9ID0gY29uZmlnU3RhdGU7XG4gICAgY29uc3QgaW5mbyA9IGdldEFuYWx5emVkTGF5ZXJJbmZvKCk7XG4gICAgdGhpcy5pc0FwcGVuZFdvcmtmbG93ID0gdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcImFwcGVuZFwiO1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uSW5mbyA9IGNvbmZpZ1N0YXRlLnN1YnNjcmlwdGlvbkluZm87XG4gICAgdGhpcy5pc0VudGVycHJpc2UgPSBwb3J0YWwuaXNQb3J0YWw7XG4gICAgY29uc3QgYXBwZW5kSW5FbnRlcnByaXNlID0gdGhpcy5pc0FwcGVuZFdvcmtmbG93ICYmIGNvbmZpZy5zZWxmLmlzUG9ydGFsO1xuICAgIGNvbnN0IHVzZXJBc3NpZ25lZENyZWRpdHMgPSBjb25maWdTdGF0ZS5hcGkgPT09IDQgPyAoX2EgPSB1c2VyLnNvdXJjZUpTT04pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hc3NpZ25lZENyZWRpdHMgOiB1c2VyLmFzc2lnbmVkQ3JlZGl0cztcbiAgICB0aGlzLnVzZXJIYXNBc3NpZ25lZENyZWRpdHMgPSB1c2VyQXNzaWduZWRDcmVkaXRzID4gMDtcbiAgICB0aGlzLm9yZ0lzUmVzdHJpY3RlZCA9ICgoX2IgPSB0aGlzLnN1YnNjcmlwdGlvbkluZm8pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zdGF0ZSkgPT09IFwicmVzdHJpY3RlZFwiO1xuICAgIHRoaXMuaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuLmNzdkxvY2F0aW9uRmllbGRzO1xuICAgIGlmICh0aGlzLmlzQWRkVG9NYXBUZXJtaW5hbFBhZ2UoKSkge1xuICAgICAgdWlTdG9yZVN0YXRlLm5leHRUZXh0ID0gXCJhZGRUb01hcFwiO1xuICAgIH1cbiAgICBsZXQgdHlwZXMgPSBhcHBlbmRJbkVudGVycHJpc2VcbiAgICAgID8gW1wiY29vcmRpbmF0ZXNcIiwgXCJub25lXCJdXG4gICAgICA6IFtcImNvb3JkaW5hdGVzXCIsIFwiYWRkcmVzc1wiLCBcIm5vbmVcIiwgXCJtZ3JzXCIsIFwidXNuZ1wiXTtcbiAgICBjb25zdCBzaG93QWRkcmVzcyA9IGNhbkdlb2NvZGUodXNlcikgJiZcbiAgICAgIGFkZEl0ZW1TdGF0ZS5nZW9jb2RlU2VydmVycyAmJlxuICAgICAgKHVpU3RvcmVTdGF0ZS53b3JrZmxvdyAhPT0gXCJtYXBcIiB8fCBlbmFibGVQdWJsaXNoaW5nKTtcbiAgICBjb25zdCBpc0RldiA9IGlzRGV2ZWxvcGVyKGNvbmZpZ1N0YXRlLnN1YnNjcmlwdGlvbkluZm8pO1xuICAgIHRoaXMuc2hvd1RvdGFsQ3JlZGl0cyA9IGNhblNob3dUb3RhbENyZWRpdHModXNlciwgcG9ydGFsKTtcbiAgICBjb25zdCB7IHNlbGVjdGVkTG9jYXRpb25GaWVsZFNlbGVjdGlvblR5cGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICB0aGlzLnNlbGVjdGVkTG9jYXRpb25GaWVsZFNlbGVjdGlvblR5cGUgPSBzZWxlY3RlZExvY2F0aW9uRmllbGRTZWxlY3Rpb25UeXBlICE9PSBudWxsICYmIHNlbGVjdGVkTG9jYXRpb25GaWVsZFNlbGVjdGlvblR5cGUgIT09IHZvaWQgMCA/IHNlbGVjdGVkTG9jYXRpb25GaWVsZFNlbGVjdGlvblR5cGUgOiBcIlNpbmdsZVwiO1xuICAgIGNvbnN0IGlzQWRkRGlyZWN0VG9NYXAgPSB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCIgJiYgIWVuYWJsZVB1Ymxpc2hpbmc7XG4gICAgdGhpcy5sb2NhdGlvblR5cGVzID0gdHlwZXNcbiAgICAgIC5tYXAoKGtleSkgPT4gKHtcbiAgICAgIG9wdGlvblRpdGxlOiB0aGlzLmkxOG4ubG9jYXRpb25UeXBlc1trZXldLnRpdGxlLFxuICAgICAgZGVzY3JpcHRpb246IGlzRGV2ICYmIGtleSA9PT0gXCJhZGRyZXNzXCJcbiAgICAgICAgPyB0aGlzLmkxOG4ubG9jYXRpb25UeXBlcy5hZGRyZXNzLmRlc2NyaXB0aW9uRGV2ZWxvcGVyXG4gICAgICAgIDogdGhpcy5pMThuLmxvY2F0aW9uVHlwZXNba2V5XS5kZXNjcmlwdGlvbi5yZXBsYWNlKFwiJHt0eXBlfVwiLCAoY2xvdWRQcm92aWRlclJlc291cmNlID09PSBudWxsIHx8IGNsb3VkUHJvdmlkZXJSZXNvdXJjZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvdWRQcm92aWRlclJlc291cmNlLmNsb3VkRmlsZVR5cGUpID09PSBcImdvb2dsZXNoZWV0c1wiID8gXCJHb29nbGUgU2hlZXRcIiA6IHR5cGUpLFxuICAgICAgdmFsdWU6IGtleSxcbiAgICAgIGJhZGdlOiBrZXkgPT09IFwiYWRkcmVzc1wiICYmICFjb25maWdTdGF0ZS5wb3J0YWwuaXNQb3J0YWwgJiYgIWlzRGV2XG4gICAgICAgID8geyBsYWJlbDogdGhpcy5pMThuLmNvbnN1bWVzQ3JlZGl0cywgaWNvbjogXCJjcmVkaXRzXCIgfVxuICAgICAgICA6IG51bGwsXG4gICAgICBpY29uOiBrZXkgPT09IFwibm9uZVwiID8gXCJ0YWJsZVwiIDogXCJsYXllci1wb2ludHNcIlxuICAgIH0pKVxuICAgICAgLmZpbHRlcigoeyB2YWx1ZSB9KSA9PiBcbiAgICAvLyBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtYXBwLWNvbXBvbmVudHMvaXNzdWVzLzI2MDVcbiAgICAodmFsdWUgIT09IFwiYWRkcmVzc1wiIHx8IHNob3dBZGRyZXNzKSAmJlxuICAgICAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWFwcC1jb21wb25lbnRzL2lzc3Vlcy8yNzY2XG4gICAgICAodmFsdWUgPT09IFwiY29vcmRpbmF0ZXNcIiB8fCAhaXNBZGREaXJlY3RUb01hcCkpO1xuICAgIC8vIG9uIGZpcnN0IGxvYWQsIGlmIGNvb3JkaW5hdGVzIGFyZSBkZXRlY3RlZCwgdXNlIHRob3NlIGluc3RlYWQgb2YgYWRkcmVzc2VzXG4gICAgY29uc3QgcHVibGlzaFBhcmFtZXRlcnMgPSBhbmFseXplUmVzdWx0cyA9PT0gbnVsbCB8fCBhbmFseXplUmVzdWx0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYW5hbHl6ZVJlc3VsdHMucHVibGlzaFBhcmFtZXRlcnM7XG4gICAgaWYgKHB1Ymxpc2hQYXJhbWV0ZXJzKSB7XG4gICAgICBjb25zdCBpc0V4Y2VsID0gdHlwZSA9PT0gXCJNaWNyb3NvZnQgRXhjZWxcIjtcbiAgICAgIGNvbnN0IHBhcmFtcyA9IGlzRXhjZWxcbiAgICAgICAgPyAoX2QgPSAoX2MgPSBwdWJsaXNoUGFyYW1ldGVycyA9PT0gbnVsbCB8fCBwdWJsaXNoUGFyYW1ldGVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHVibGlzaFBhcmFtZXRlcnMubGF5ZXJzKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Nbc2VsZWN0ZWRTaGVldF0pICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IChfZSA9IHB1Ymxpc2hQYXJhbWV0ZXJzID09PSBudWxsIHx8IHB1Ymxpc2hQYXJhbWV0ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwdWJsaXNoUGFyYW1ldGVycy5sYXllcnMpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZVswXVxuICAgICAgICA6IGFuYWx5emVSZXN1bHRzID09PSBudWxsIHx8IGFuYWx5emVSZXN1bHRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhbmFseXplUmVzdWx0cy5wdWJsaXNoUGFyYW1ldGVycztcbiAgICAgIGlmIChwYXJhbXMubGF0aXR1ZGVGaWVsZE5hbWUgfHwgcGFyYW1zLmxvbmdpdHVkZUZpZWxkTmFtZSkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkTG9jYXRpb25UeXBlID0gXCJjb29yZGluYXRlc1wiO1xuICAgICAgICBhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlID0gXCJjb29yZGluYXRlc1wiO1xuICAgICAgICBhZGRJdGVtU3RhdGUuY29vcmRpbmF0ZUZpZWxkVHlwZSA9IFwiTGF0aXR1ZGVBbmRMb25naXR1ZGVcIjtcbiAgICAgIH1cbiAgICAgIGlmIChwdWJsaXNoUGFyYW1ldGVycy5sb2NhdGlvblR5cGUgPT09IFwiY29vcmRpbmF0ZXNcIiAmJlxuICAgICAgICBwdWJsaXNoUGFyYW1ldGVycy5jb29yZGluYXRlRmllbGRUeXBlKSB7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5sb2NhdGlvblR5cGUgPSBcImNvb3JkaW5hdGVzXCI7XG4gICAgICAgIHN3aXRjaCAocHVibGlzaFBhcmFtZXRlcnMuY29vcmRpbmF0ZUZpZWxkVHlwZSkge1xuICAgICAgICAgIGNhc2UgXCJNR1JTXCI6XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkTG9jYXRpb25UeXBlID0gXCJtZ3JzXCI7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuY29vcmRpbmF0ZUZpZWxkVHlwZSA9IFwiTUdSU1wiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcIlVTTkdcIjpcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUgPSBcInVzbmdcIjtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5jb29yZGluYXRlRmllbGRUeXBlID0gXCJVU05HXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZExvY2F0aW9uVHlwZSA9IFwiY29vcmRpbmF0ZXNcIjtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5jb29yZGluYXRlRmllbGRUeXBlID0gXCJMYXRpdHVkZUFuZExvbmdpdHVkZVwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHBhcmFtcy5sb2NhdGlvblR5cGUgPT09IFwiYWRkcmVzc1wiICYmIHNob3dBZGRyZXNzKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUgPSBcImFkZHJlc3NcIjtcbiAgICAgICAgYWRkSXRlbVN0YXRlLmxvY2F0aW9uVHlwZSA9IFwiYWRkcmVzc1wiO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuaXNBcHBlbmRXb3JrZmxvdykge1xuICAgICAgICAoX2YgPSBhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlKSAhPT0gbnVsbCAmJiBfZiAhPT0gdm9pZCAwID8gX2YgOiAoYWRkSXRlbVN0YXRlLmxvY2F0aW9uVHlwZSA9IFwibm9uZVwiKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMubG9jYXRpb25UeXBlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgIGNvbnN0IGxvY2F0aW9uVHlwZSA9IHRoaXMubG9jYXRpb25UeXBlc1swXS52YWx1ZTtcbiAgICAgIHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUgPSBsb2NhdGlvblR5cGU7XG4gICAgICBhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlID1cbiAgICAgICAgbG9jYXRpb25UeXBlID09PSBcIm1ncnNcIiB8fCBsb2NhdGlvblR5cGUgPT09IFwidXNuZ1wiID8gXCJjb29yZGluYXRlc1wiIDogbG9jYXRpb25UeXBlO1xuICAgIH1cbiAgICAvLyBpZiB1c2VyIGNhbid0IGdlb2NvZGUsIGFuZCB3ZSdyZSBvbiBhZGRyZXNzLCBzd2FwIHRvIGNvb3JkaW5hdGVzXG4gICAgaWYgKCFzaG93QWRkcmVzcyAmJiB0aGlzLnNlbGVjdGVkTG9jYXRpb25UeXBlID09PSBcImFkZHJlc3NcIikge1xuICAgICAgdGhpcy5zZWxlY3RlZExvY2F0aW9uVHlwZSA9IFwiY29vcmRpbmF0ZXNcIjtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5sb2NhdGlvblR5cGUgPSBcImNvb3JkaW5hdGVzXCI7XG4gICAgfVxuICAgIC8vIHVwZGF0ZSBhbmFseXplIHRvIHVzZSBhZGRyZXNzIGlmIHdlIGhhdmUgbm8gYWRkcmVzcyBmaWVsZHMgb24gZmlyc3QgbG9hZFxuICAgIGlmICh0aGlzLnNlbGVjdGVkTG9jYXRpb25UeXBlID09PSBcImFkZHJlc3NcIiAmJiAhaW5mby5hZGRyZXNzRmllbGRzKSB7XG4gICAgICBhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlID0gXCJhZGRyZXNzXCI7XG4gICAgfVxuICAgIC8vIGlmIG9uIGZpcnN0IGxvYWQgdGhlIGZpZWxkIG5hbWVzIGhhdmUgbm90IGJlZW4gc2V0XG4gICAgaWYgKCFzdGFuZGFyZGl6ZWRGaWVsZE5hbWVzKSB7XG4gICAgICBhd2FpdCBzZXRTdGFuZGFyZGl6ZWRGaWVsZE5hbWVzKHtcbiAgICAgICAgZ2VvY29kZVNlcnZpY2VVcmwsXG4gICAgICAgIC8vICEgV2Ugc2V0IHRoZSBsb2NhdGlvbiB0eXBlIGFib3ZlIHNvIHdlIGNhbid0IGp1c3QgdXNlIHRoZSBkZXN0cnVjdGVkIHZhbHVlXG4gICAgICAgIC8vIFRPRE86IHJlZmFjdG9yIHRoYXQgaW50byBhIGxvY2FsIHZhcmlhYmxlXG4gICAgICAgIGxvY2F0aW9uVHlwZTogYWRkSXRlbVN0YXRlLmxvY2F0aW9uVHlwZSxcbiAgICAgICAgbGFuZ1xuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChhcHBlbmRJbkVudGVycHJpc2UpIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUgPSBcImNvb3JkaW5hdGVzXCI7XG4gICAgICBhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlID0gXCJjb29yZGluYXRlc1wiO1xuICAgIH1cbiAgICAvLyBUZWxlbWV0cnk6IENhcHR1cmUgaW5pdGlhbCB2YWx1ZXMgdG8gY29tcGFyZSBhZ2FpbnN0XG4gICAgdGhpcy5pbml0aWFsTG9jYXRvciA9IGFkZEl0ZW1TdGF0ZS5nZW9jb2RlU2VydmljZVVybDtcbiAgICB0aGlzLmluaXRpYWxSZWdpb24gPSBhZGRJdGVtU3RhdGUuc291cmNlQ291bnRyeTtcbiAgICB0aGlzLnNldExvY2F0aW9uVHlwZVRlbGVtZXRyeSh0aGlzLnNlbGVjdGVkTG9jYXRpb25UeXBlKTtcbiAgfVxuICB2YWxpZGF0ZUZpZWxkcygpIHtcbiAgICBjb25zdCB7IHN0YW5kYXJkaXplZEZpZWxkTmFtZXMsIHNlbGVjdGVkRmllbGRzLCBiYWNrdXBMYXllckZpZWxkcyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIGNvbnN0IGZpZWxkcyA9ICF0aGlzLmlzQXBwZW5kV29ya2Zsb3cgPyBPYmplY3QudmFsdWVzKHNlbGVjdGVkRmllbGRzKSA6IGJhY2t1cExheWVyRmllbGRzO1xuICAgIGNvbnN0IG5vRmllbGRTZWxlY3RlZCA9ICFmaWVsZHMuZmluZCgoeyBsb2NhdGlvblR5cGUgfSkgPT4ge1xuICAgICAgY29uc3QgbWF0Y2hlc0xvY2F0aW9uVHlwZSA9IChsb2NhdGlvblR5cGUgPT09IG51bGwgfHwgbG9jYXRpb25UeXBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsb2NhdGlvblR5cGUudG9Mb3dlckNhc2UoKSkgPT09IHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUudG9Mb3dlckNhc2UoKTtcbiAgICAgIGNvbnN0IG1hdGNoZXNTdGFuZGFyZGl6ZWRGaWVsZCA9ICEhKHN0YW5kYXJkaXplZEZpZWxkTmFtZXMgPT09IG51bGwgfHwgc3RhbmRhcmRpemVkRmllbGROYW1lcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3RhbmRhcmRpemVkRmllbGROYW1lc1tsb2NhdGlvblR5cGVdKTtcbiAgICAgIHJldHVybiBtYXRjaGVzTG9jYXRpb25UeXBlIHx8IG1hdGNoZXNTdGFuZGFyZGl6ZWRGaWVsZDtcbiAgICB9KTtcbiAgICBzd2l0Y2ggKHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUpIHtcbiAgICAgIGNhc2UgXCJ1c25nXCI6XG4gICAgICBjYXNlIFwibWdyc1wiOlxuICAgICAgICAvLyBjaGVjayBpZiBhdCBsZWFzdCBvbmUgZmllbGQgaGFzIGxvY2F0aW9uIHR5cGUgdXNuZ1xuICAgICAgICBpZiAobm9GaWVsZFNlbGVjdGVkKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuaTE4bi5lcnJvcnMubm9GaWVsZFNlbGVjdGVkO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImFkZHJlc3NcIjpcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRMb2NhdGlvbkZpZWxkU2VsZWN0aW9uVHlwZSA9PT0gXCJTaW5nbGVcIiAmJiBub0ZpZWxkU2VsZWN0ZWQpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5pMThuLmVycm9ycy5ub0ZpZWxkU2VsZWN0ZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5zZWxlY3RlZExvY2F0aW9uRmllbGRTZWxlY3Rpb25UeXBlID09PSBcIk11bHRpcGxlXCIpIHtcbiAgICAgICAgICBjb25zdCBoYXNMb2NhdGlvbkZpZWxkID0gZmllbGRzLmZpbmQoKGZpZWxkKSA9PiBmaWVsZC5sb2NhdGlvblR5cGUgJiYgZmllbGQubG9jYXRpb25UeXBlICE9PSBcInVua25vd25cIik7XG4gICAgICAgICAgaWYgKCFoYXNMb2NhdGlvbkZpZWxkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pMThuLmVycm9ycy5ub0ZpZWxkU2VsZWN0ZWQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImNvb3JkaW5hdGVzXCI6XG4gICAgICAgIC8vIGNoZWNrIGlmIGxhdGl0dWRlIF9hbmRfIGxvbmdpdHVkZSBhcmUgc2VsZWN0ZWQ7XG4gICAgICAgIGNvbnN0IG1hdGNoaW5nID0gZmllbGRzLmZpbHRlcigoeyBsb2NhdGlvblR5cGUgfSkgPT4gbG9jYXRpb25UeXBlID09PSBcImxhdGl0dWRlXCIgfHwgbG9jYXRpb25UeXBlID09PSBcImxvbmdpdHVkZVwiKTtcbiAgICAgICAgaWYgKG1hdGNoaW5nLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5pMThuLmVycm9ycy5jb29yZGluYXRlO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cbiAgYXN5bmMgdXBkYXRlTG9jYXRpb25UeXBlKHR5cGUsIHJlYW5hbHl6ZSkge1xuICAgIHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUgPSB0eXBlO1xuICAgIGlmICh0eXBlID09PSBcIm5vbmVcIikge1xuICAgICAgYWRkSXRlbVN0YXRlLmxvY2F0aW9uVHlwZSA9IFwibm9uZVwiO1xuICAgICAgdGhpcy5jdXJyZW50TG9jYXRpb25UeXBlID0gXCJub25lXCI7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSBcIm1ncnNcIjpcbiAgICAgICAgYWRkSXRlbVN0YXRlLmNvb3JkaW5hdGVGaWVsZFR5cGUgPSBcIk1HUlNcIjtcbiAgICAgICAgYWRkSXRlbVN0YXRlLmxvY2F0aW9uVHlwZSA9IFwiY29vcmRpbmF0ZXNcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiY29vcmRpbmF0ZXNcIjpcbiAgICAgICAgYWRkSXRlbVN0YXRlLmNvb3JkaW5hdGVGaWVsZFR5cGUgPSBcIkxhdGl0dWRlQW5kTG9uZ2l0dWRlXCI7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5sb2NhdGlvblR5cGUgPSBcImNvb3JkaW5hdGVzXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInVzbmdcIjpcbiAgICAgICAgYWRkSXRlbVN0YXRlLmNvb3JkaW5hdGVGaWVsZFR5cGUgPSBcIlVTTkdcIjtcbiAgICAgICAgYWRkSXRlbVN0YXRlLmxvY2F0aW9uVHlwZSA9IFwiY29vcmRpbmF0ZXNcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiYWRkcmVzc1wiOlxuICAgICAgICBhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlID0gXCJhZGRyZXNzXCI7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBpZiAocmVhbmFseXplKSB7XG4gICAgICBhd2FpdCB0aGlzLmFuYWx5emUoKTtcbiAgICB9XG4gICAgdGhpcy5zZXRMb2NhdGlvblR5cGVUZWxlbWV0cnkodHlwZSk7XG4gIH1cbiAgLy8gVGVsZW1ldHJ5OiBNYXAgbG9jYXRpb24gdHlwZSB0byB0ZWxldHJ5IGxhYmVsXG4gIHNldExvY2F0aW9uVHlwZVRlbGVtZXRyeSh0eXBlKSB7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIFwibWdyc1wiOlxuICAgICAgICB0aGlzLmN1cnJlbnRMb2NhdGlvblR5cGUgPSBcIm1ncnMgY29vcmRpbmF0ZXNcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiY29vcmRpbmF0ZXNcIjpcbiAgICAgICAgdGhpcy5jdXJyZW50TG9jYXRpb25UeXBlID0gXCJsYXQgbG9uXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInVzbmdcIjpcbiAgICAgICAgdGhpcy5jdXJyZW50TG9jYXRpb25UeXBlID0gXCJ1c25nIGNvb3JkaW5hdGVzXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImFkZHJlc3NcIjpcbiAgICAgICAgdGhpcy5jdXJyZW50TG9jYXRpb25UeXBlID0gXCJhZGRyZXNzIHBsYWNlIG5hbWVzXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIm5vbmVcIjpcbiAgICAgICAgdGhpcy5jdXJyZW50TG9jYXRpb25UeXBlID0gXCJub25lXCI7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICBhc3luYyB1cGRhdGVHZW9jb2RlU2VydmVyKHVybCkge1xuICAgIGFkZEl0ZW1TdGF0ZS5nZW9jb2RlU2VydmljZVVybCA9IHVybDtcbiAgICAvLyBUT0RPOiB1cGRhdGUgYWRkSXRlbVN0YXRlLmlzQWdvV29ybGRHZW9jb2RlU2VydmVyIGhlcmUgKGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1hcHAtY29tcG9uZW50cy9wdWxsLzE2NTcpXG4gICAgYXdhaXQgdGhpcy5hbmFseXplKCk7XG4gIH1cbiAgYXN5bmMgdXBkYXRlUmVnaW9uKHJlZ2lvbikge1xuICAgIGFkZEl0ZW1TdGF0ZS5zb3VyY2VDb3VudHJ5ID0gcmVnaW9uO1xuICAgIGF3YWl0IHRoaXMuYW5hbHl6ZSgpO1xuICB9XG4gIGhhbmRsZUVucmljaExheWVyU3dpdGNoQ2hhbmdlKGV2ZW50KSB7XG4gICAgY29uc3QgY2hlY2tlZCA9IGV2ZW50LnRhcmdldC5jaGVja2VkO1xuICAgIHRoaXMuZGlzcGxheUVucmljaExheWVyU2V0dGluZ3MgPSBjaGVja2VkO1xuICAgIHRoaXMudXBkYXRlQ2FuZGlkYXRlRmllbGRzKGNoZWNrZWQgPyBcIk1pbmltYWxcIiA6IFwiR2VvbWV0cnlPbmx5XCIpO1xuICB9XG4gIHVwZGF0ZUNhbmRpZGF0ZUZpZWxkcyh2YWx1ZSkge1xuICAgIHRoaXMuc2VsZWN0ZWRDYW5kaWRhdGVGaWVsZHNUeXBlID0gdmFsdWU7XG4gICAgYWRkSXRlbVN0YXRlLmNhbmRpZGF0ZUZpZWxkc1R5cGUgPSB2YWx1ZTtcbiAgfVxuICByZW5kZXJMb2NhdGlvbkZpZWxkcygpIHtcbiAgICBjb25zdCB7IHN0YW5kYXJkaXplZEZpZWxkTmFtZXMgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBjb25zdCBsb2NhdGlvblJvd3MgPSB7XG4gICAgICBhZGRyZXNzOiBzdGFuZGFyZGl6ZWRGaWVsZE5hbWVzLFxuICAgICAgY29vcmRpbmF0ZXM6IHsgbGF0aXR1ZGU6IHRoaXMuaTE4bi5sYXRpdHVkZSwgbG9uZ2l0dWRlOiB0aGlzLmkxOG4ubG9uZ2l0dWRlIH0sXG4gICAgICBtZ3JzOiB7IG1ncnM6IFwiTUdSU1wiIH0sXG4gICAgICB1c25nOiB7IHVzbmc6IFwiVVNOR1wiIH1cbiAgICB9O1xuICAgIGNvbnN0IHJvd3MgPSBsb2NhdGlvblJvd3NbdGhpcy5zZWxlY3RlZExvY2F0aW9uVHlwZV07XG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRMb2NhdGlvbkZpZWxkU2VsZWN0aW9uVHlwZSA9PT0gXCJTaW5nbGVcIiAmJlxuICAgICAgdGhpcy5zZWxlY3RlZExvY2F0aW9uVHlwZSA9PT0gXCJhZGRyZXNzXCIgJiZcbiAgICAgIHJvd3MpIHtcbiAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHJvd3MpWzBdO1xuICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwicm93XCIsIHJvbGU6IFwicm93XCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNlbGxcIiwgcm9sZTogXCJjZWxsXCIgfSwgcm93c1trZXldKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNlbGxcIiwgcm9sZTogXCJjZWxsXCIgfSwgdGhpcy5yZW5kZXJGaWVsZFNlbGVjdChrZXksIHJvd3Nba2V5XSkpKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIChyb3dzICYmXG4gICAgICAgIE9iamVjdC5rZXlzKHJvd3MpLm1hcCgoa2V5KSA9PiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInJvd1wiLCByb2xlOiBcInJvd1wiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjZWxsXCIsIHJvbGU6IFwiY2VsbFwiIH0sIHJvd3Nba2V5XSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjZWxsXCIsIHJvbGU6IFwiY2VsbFwiIH0sIHRoaXMucmVuZGVyRmllbGRTZWxlY3Qoa2V5LCByb3dzW2tleV0pKSkpKSk7XG4gICAgfVxuICB9XG4gIHVwZGF0ZUZpZWxkTG9jYXRpb25UeXBlKGZpZWxkTmFtZSwgYWRkcmVzc0tleSkge1xuICAgIGNvbnN0IGZpZWxkcyA9ICF0aGlzLmlzQXBwZW5kV29ya2Zsb3dcbiAgICAgID8gT2JqZWN0LnZhbHVlcyhhZGRJdGVtU3RhdGUuc2VsZWN0ZWRGaWVsZHMpXG4gICAgICA6IGFkZEl0ZW1TdGF0ZS5iYWNrdXBMYXllckZpZWxkcztcbiAgICBmaWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgIGlmIChmaWVsZC5uYW1lID09PSBmaWVsZE5hbWUpIHtcbiAgICAgICAgZmllbGQubG9jYXRpb25UeXBlID0gYWRkcmVzc0tleTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGZpZWxkLmxvY2F0aW9uVHlwZSA9PT0gYWRkcmVzc0tleSkge1xuICAgICAgICBmaWVsZC5sb2NhdGlvblR5cGUgPSBcInVua25vd25cIjtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBoYW5kbGVMb2NhdGlvbkZpZWxkU2VsZWN0aW9uQ2hhbmdlKG5ld1R5cGUpIHtcbiAgICB0aGlzLnNlbGVjdGVkTG9jYXRpb25GaWVsZFNlbGVjdGlvblR5cGUgPSBuZXdUeXBlO1xuICAgIGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZExvY2F0aW9uRmllbGRTZWxlY3Rpb25UeXBlID0gbmV3VHlwZTtcbiAgfVxuICByZW5kZXJGaWVsZFNlbGVjdChhZGRyZXNzS2V5LCBsYWJlbCkge1xuICAgIGNvbnN0IHNlbGVjdGVkRmllbGRzID0gIXRoaXMuaXNBcHBlbmRXb3JrZmxvd1xuICAgICAgPyBhZGRJdGVtU3RhdGUuc2VsZWN0ZWRGaWVsZHNcbiAgICAgIDogYWRkSXRlbVN0YXRlLmJhY2t1cExheWVyRmllbGRzO1xuICAgIGNvbnN0IGZpZWxkcyA9IE9iamVjdC5rZXlzKHNlbGVjdGVkRmllbGRzKS5tYXAoKGtleSkgPT4gc2VsZWN0ZWRGaWVsZHNba2V5XSk7XG4gICAgY29uc3QgdXNlRGVmYXVsdCA9ICFmaWVsZHMuc29tZSgoZmllbGQpID0+IHtcbiAgICAgIHJldHVybiBmaWVsZC5sb2NhdGlvblR5cGUgPT09IGFkZHJlc3NLZXk7XG4gICAgfSk7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBsYWJlbDogbGFiZWwsIHJvbGU6IFwiY2VsbFwiLCBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6IChlKSA9PiB0aGlzLnVwZGF0ZUZpZWxkTG9jYXRpb25UeXBlKGUuY3VycmVudFRhcmdldC5zZWxlY3RlZE9wdGlvbi52YWx1ZSwgYWRkcmVzc0tleSkgfSwgaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IFwidW5rbm93blwiLCBzZWxlY3RlZDogdXNlRGVmYXVsdCB9LCB0aGlzLmkxOG4udW5rbm93biksIGZpZWxkcy5tYXAoKGZpZWxkKSA9PiAoaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IGZpZWxkLm5hbWUsIHNlbGVjdGVkOiBmaWVsZC5sb2NhdGlvblR5cGUgPT09IGFkZHJlc3NLZXkgfSwgZmllbGQuYWxpYXMgfHwgZmllbGQubmFtZSkpKSkpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgIGNvbnN0IHsgZ2VvY29kZVNlcnZpY2VVcmwsIGdlb2NvZGVTZXJ2ZXJzLCBnZW9jb2RlQ29zdCwgc291cmNlQ291bnRyeSwgY291bnRyeUNvZGVzIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgY29uc3QgeyBjb25maWcgfSA9IGNvbmZpZ1N0YXRlO1xuICAgIGNvbnN0IHJlY29yZENvdW50ID0gKF9iID0gKF9hID0gZ2V0QW5hbHl6ZWRMYXllckluZm8oKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmVzdGltYXRlZFJlY29yZENvdW50KSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAwO1xuICAgIGNvbnN0IHsgaGVscE1hcCwgaGVscEJhc2UgfSA9IGNvbmZpZztcbiAgICBjb25zdCBkaXIgPSBnZXRFbGVtZW50RGlyKHRoaXMuZWwpO1xuICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcIndyYXBwZXJcIiB9LCBoKFwiYXJjZ2lzLXNlbGVjdFwiLCB7IGNsYXNzOiBcImxhYmVsLS10b3BcIiwgc2VsZWN0ZWRPcHRpb246IHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUsIG9wdGlvbnM6IHRoaXMubG9jYXRpb25UeXBlcywgbGFiZWw6IHRoaXMuaTE4bi5sb2NhdGlvblNldHRpbmdzLCBsYWJlbERlc2NyaXB0aW9uOiB0aGlzLmkxOG4ubG9jYXRpb25TZXR0aW5nc0Rlc2NyaXB0aW9uLCBvbkFyY2dpc09wdGlvbkNoYW5nZTogKGUpID0+IHRoaXMudXBkYXRlTG9jYXRpb25UeXBlKGUuZGV0YWlsLCB0cnVlKSB9KSwgdGhpcy5zZWxlY3RlZExvY2F0aW9uVHlwZSAhPT0gXCJub25lXCIgJiYgKGgoXCJkaXZcIiwgbnVsbCwgdGhpcy5zZWxlY3RlZExvY2F0aW9uVHlwZSA9PT0gXCJhZGRyZXNzXCIgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJhZHZhbmNlZFwiIH0sIGgoXCJidXR0b25cIiwgeyBjbGFzczogXCJhZHZhbmNlZF9fdG9nZ2xlXCIsIFwiYXJpYS1leHBhbmRlZFwiOiB0aGlzLmFkdmFuY2VkRXhwYW5kZWQudG9TdHJpbmcoKSwgXCJhcmlhLWNvbnRyb2xzXCI6IFwiYWR2YW5jZWRfX2NvbnRlbnRcIiwgb25DbGljazogKCkgPT4gKHRoaXMuYWR2YW5jZWRFeHBhbmRlZCA9ICF0aGlzLmFkdmFuY2VkRXhwYW5kZWQpIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBpY29uOiBcImNoZXZyb24tdXBcIiwgc2NhbGU6IFwic1wiLCBjbGFzczoge1xuICAgICAgICBhZHZhbmNlZF9faWNvbjogdHJ1ZSxcbiAgICAgICAgW0NTU19VVElMSVRZLnJ0bF06IGRpciA9PT0gXCJydGxcIixcbiAgICAgICAgXCJhZHZhbmNlZF9faWNvbi0tb3BlblwiOiB0aGlzLmFkdmFuY2VkRXhwYW5kZWRcbiAgICAgIH0gfSksIHRoaXMuaTE4bi5hZHZhbmNlZFNldHRpbmdzKSwgdGhpcy5hZHZhbmNlZEV4cGFuZGVkICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiYWR2YW5jZWRfX2NvbnRlbnRcIiwgaWQ6IFwiYWR2YW5jZWRfX2NvbnRlbnRcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwidHdvLXVwXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJjb2x1bW5cIiB9LCB0aGlzLmkxOG4ubG9jYXRvciwgaChcImNhbGNpdGUtc2VsZWN0XCIsIHsgbGFiZWw6IFwiXCIsIG9uQ2FsY2l0ZVNlbGVjdENoYW5nZTogKGUpID0+IHRoaXMudXBkYXRlR2VvY29kZVNlcnZlcihlLmN1cnJlbnRUYXJnZXQuc2VsZWN0ZWRPcHRpb24udmFsdWUpIH0sIGdlb2NvZGVTZXJ2ZXJzID09PSBudWxsIHx8IGdlb2NvZGVTZXJ2ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBnZW9jb2RlU2VydmVycy5tYXAoKHNlcnZlcikgPT4gKGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBzZXJ2ZXIudXJsLCBzZWxlY3RlZDogc2VydmVyLnVybCA9PT0gZ2VvY29kZVNlcnZpY2VVcmwgfSwgc2VydmVyLm5hbWUpKSkpKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJjb2x1bW5cIiB9LCB0aGlzLmkxOG4ucmVnaW9uLCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBsYWJlbDogXCJcIiwgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiAoZSkgPT4gdGhpcy51cGRhdGVSZWdpb24oZS5jdXJyZW50VGFyZ2V0LnNlbGVjdGVkT3B0aW9uLnZhbHVlKSB9LCBjb3VudHJ5Q29kZXMgPT09IG51bGwgfHwgY291bnRyeUNvZGVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb3VudHJ5Q29kZXMubWFwKChjb3VudHJ5KSA9PiAoaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IGNvdW50cnkudmFsdWUsIHNlbGVjdGVkOiBjb3VudHJ5LnZhbHVlLnRvTG93ZXJDYXNlKCkgPT09IHNvdXJjZUNvdW50cnkudG9Mb3dlckNhc2UoKSB9LCB0aGlzLmkxOG4uY291bnRyeUNvZGVzW2NvdW50cnkudmFsdWUudG9VcHBlckNhc2UoKV0gfHwgY291bnRyeS5sYWJlbCkpKSkpKSwgIWNvbmZpZ1N0YXRlLnBvcnRhbC5pc1BvcnRhbCAmJiAhdGhpcy5pc0FwcGVuZFdvcmtmbG93ICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZW5yaWNoLWxheWVyLWNvbnRhaW5lclwiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgbGF5b3V0OiBcImlubGluZS1zcGFjZS1iZXR3ZWVuXCIgfSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJlbnJpY2gtdGl0bGVcIiB9LCB0aGlzLmkxOG4uZW5yaWNoLCBoKFwiYXJjZ2lzLWluZm9ybWF0aW9uXCIsIHsgbGFiZWw6IChfYyA9IHVpU3RvcmVTdGF0ZS5pMThuKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MubW9yZUluZm8sIHBsYWNlbWVudDogXCJ0b3Atc3RhcnRcIiwgcGFkZGVkQ29udGVudDogdHJ1ZSB9LCBoKFwicFwiLCB7IGNsYXNzOiBcImVucmljaC1kZXNjcmlwdGlvblwiIH0sIHRoaXMuaTE4bi5lbnJpY2hMYXllckRlc2NyaXB0aW9uKSwgaChcImNhbGNpdGUtbGlua1wiLCB7XG4gICAgICAvKkB0cy1pZ25vcmUqL1xuICAgICAgdGFyZ2V0OiBcIl9ibGFua1wiLCBocmVmOiBgJHtoZWxwQmFzZX0ke2hlbHBNYXBbXCIxMjAwMDI1NDFcIl19YFxuICAgIH0sIHRoaXMuaTE4bi5lbnJpY2hMYXllckxpbmspKSksIGgoXCJjYWxjaXRlLXN3aXRjaFwiLCB7IGNoZWNrZWQ6IHRoaXMuZGlzcGxheUVucmljaExheWVyU2V0dGluZ3MsIG9uQ2FsY2l0ZVN3aXRjaENoYW5nZTogdGhpcy5oYW5kbGVFbnJpY2hMYXllclN3aXRjaENoYW5nZS5iaW5kKHRoaXMpIH0pKSwgdGhpcy5kaXNwbGF5RW5yaWNoTGF5ZXJTZXR0aW5ncyA/IChoKFwiY2FsY2l0ZS1yYWRpby1idXR0b24tZ3JvdXBcIiwgeyBsYXlvdXQ6IFwidmVydGljYWxcIiwgbmFtZTogXCJlbnJpY2gtZ3JvdXBcIiwgb25DYWxjaXRlUmFkaW9CdXR0b25Hcm91cENoYW5nZTogKGV2ZW50KSA9PiB0aGlzLnVwZGF0ZUNhbmRpZGF0ZUZpZWxkcyhldmVudC50YXJnZXQuc2VsZWN0ZWRJdGVtLnZhbHVlKSB9LCBbXCJNaW5pbWFsXCIsIFwiQWxsRmllbGRzXCJdLm1hcCgodHlwZSkgPT4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgbGF5b3V0OiBcImlubGluZVwiLCBrZXk6IHR5cGUgfSwgaChcImNhbGNpdGUtcmFkaW8tYnV0dG9uXCIsIHsgY2hlY2tlZDogdGhpcy5zZWxlY3RlZENhbmRpZGF0ZUZpZWxkc1R5cGUgPT09IHR5cGUsIHZhbHVlOiB0eXBlIH0pLCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImVucmljaC1yYWRpby10ZXh0XCIgfSwgdGhpcy5pMThuLmNhbmRpZGF0ZUZpZWxkc1R5cGVzW3R5cGVdLmRlc2NyaXB0aW9uKSkpKSkpIDogbnVsbCkpKSkpKSwgaChcImgzXCIsIHsgY2xhc3M6IFwiaGVhZGVyXCIgfSwgdGhpcy5pMThuLmxvY2F0aW9uRmllbGRzLCBcIiBcIiwgaChcInNwYW5cIiwgeyBjbGFzczogXCJhc3Rlcmlza1wiIH0sIFwiKlwiKSksIHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUgPT09IFwiYWRkcmVzc1wiID8gKGgoXCJjYWxjaXRlLXJhZGlvLWJ1dHRvbi1ncm91cFwiLCB7IG5hbWU6IFwibG9jYXRpb24tZmllbGQtc2VsZWN0aW9uLWdyb3VwXCIsIGxheW91dDogXCJ2ZXJ0aWNhbFwiLCBvbkNhbGNpdGVSYWRpb0J1dHRvbkdyb3VwQ2hhbmdlOiAoZXZlbnQpID0+IHRoaXMuaGFuZGxlTG9jYXRpb25GaWVsZFNlbGVjdGlvbkNoYW5nZShldmVudC50YXJnZXQuc2VsZWN0ZWRJdGVtLnZhbHVlKSB9LCBbXCJTaW5nbGVcIiwgXCJNdWx0aXBsZVwiXS5tYXAoKHR5cGUpID0+IChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGxheW91dDogXCJpbmxpbmVcIiwga2V5OiB0eXBlIH0sIGgoXCJjYWxjaXRlLXJhZGlvLWJ1dHRvblwiLCB7IGNoZWNrZWQ6IHRoaXMuc2VsZWN0ZWRMb2NhdGlvbkZpZWxkU2VsZWN0aW9uVHlwZSA9PT0gdHlwZSwgdmFsdWU6IHR5cGUgfSksIHRoaXMuaTE4blt0eXBlID09PSBcIlNpbmdsZVwiID8gXCJsb2NhdGlvbkZpZWxkU2luZ2xlXCIgOiBcImxvY2F0aW9uRmllbGRNdWx0aXBsZVwiXSkpKSkpIDogbnVsbCwgaChcImRpdlwiLCB7IHJvbGU6IFwidGFibGVcIiwgY2xhc3M6IFwidGFibGVcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwicm93IHJvdy0taGVhZGVyXCIsIHJvbGU6IFwicm93XCIgfSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJjZWxsIGNlbGwtLWhlYWRlclwiLCByb2xlOiBcImNvbHVtbmhlYWRlclwiLCBcImFyaWEtc29ydFwiOiBcIm5vbmVcIiB9LCB0aGlzLmkxOG4ubG9jYXRpb25UeXBlKSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJjZWxsIGNlbGwtLWhlYWRlclwiLCByb2xlOiBcImNvbHVtbmhlYWRlclwiLCBcImFyaWEtc29ydFwiOiBcIm5vbmVcIiB9LCB0aGlzLmkxOG4uZmllbGQpKSwgdGhpcy5yZW5kZXJMb2NhdGlvbkZpZWxkcygpKSkpLCB0aGlzLnNlbGVjdGVkTG9jYXRpb25UeXBlID09PSBcImFkZHJlc3NcIiAmJlxuICAgICAgZ2VvY29kZUNvc3QgJiZcbiAgICAgICFjb25maWdTdGF0ZS5wb3J0YWwuaXNQb3J0YWwgJiZcbiAgICAgIGlzRXNyaVdvcmxkR2VvY29kZXIoZ2VvY29kZVNlcnZpY2VVcmwpICYmIChoKEZyYWdtZW50LCBudWxsLCBpc0RldmVsb3Blcihjb25maWdTdGF0ZS5zdWJzY3JpcHRpb25JbmZvKSA/IChoKFwiZGl2XCIsIG51bGwsIGgoXCJjYWxjaXRlLW5vdGljZVwiLCB7IHNjYWxlOiBcIm1cIiwgd2lkdGg6IFwiZnVsbFwiLCBvcGVuOiB0cnVlLCBpY29uOiBcImluZm9ybWF0aW9uXCIgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwibWVzc2FnZVwiIH0sIHRoaXMuaTE4bi5yZWNvcmRDb3VudC5yZXBsYWNlKFwiJHtudW19XCIsIGAke3JlY29yZENvdW50fWApKSkpKSA6IChoKFwiYXJjZ2lzLWNyZWRpdC1lc3RpbWF0ZVwiLCB7IHRyYW5zYWN0aW9uQ3JlZGl0Q29zdDogZ2VvY29kZUNvc3QudHJhbnNhY3Rpb25DcmVkaXRDb3N0LCBhdmFpbGFibGVDcmVkaXRzOiBnZW9jb2RlQ29zdC5hdmFpbGFibGVDcmVkaXRzLCBzaG93VG90YWw6IHRoaXMuc2hvd1RvdGFsQ3JlZGl0cywgY2xhc3M6IFwiY3JlZGl0LWVzdGltYXRlXCIsIGFwaTogY29uZmlnU3RhdGUuYXBpLCByZWY6IChlbCkgPT4gKHRoaXMuZXN0aW1hdGUgPSBlbCkgfSkpLCB0aGlzLnNob3dVbnJlc3RyaWN0ZWRPcmdDcmVkaXRzTm90aWNlKCkgJiYgKGgoXCJjYWxjaXRlLW5vdGljZVwiLCB7IGNsYXNzOiBcIm5vdGljZVwiLCBraW5kOiBcImJyYW5kXCIsIGljb246IFwiaW5mb3JtYXRpb25cIiwgb3BlbjogdHJ1ZSB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJ0aXRsZVwiIH0sIHRoaXMuaTE4bi51bnJlc3RyaWN0ZWRPcmdDcmVkaXRzLnRpdGxlKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwibWVzc2FnZVwiIH0sIHRoaXMuaTE4bi51bnJlc3RyaWN0ZWRPcmdDcmVkaXRzLmRlc2NyaXB0aW9uKSkpKSksIGgoXCJhcmNnaXMtbmV3LWl0ZW0tYWxlcnRcIiwgeyBoZWFkaW5nOiAoX2QgPSB0aGlzLmVycm9yKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QudGl0bGUsIGRlc2NyaXB0aW9uOiAoX2UgPSB0aGlzLmVycm9yKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UuZGVzY3JpcHRpb24sIGFjdGl2ZTogISF0aGlzLmVycm9yLCBvbkFsZXJ0RGlzbWlzczogKCkgPT4gKHRoaXMuZXJyb3IgPSBudWxsKSB9KSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNOZXdJdGVtUGFnZXNDc3ZMb2NhdGlvbkZpZWxkcy5zdHlsZSA9IGFyY2dpc05ld0l0ZW1QYWdlc0NzdkxvY2F0aW9uRmllbGRzQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNOZXdJdGVtUGFnZXNDc3ZMb2NhdGlvbkZpZWxkcyBhcyBhcmNnaXNfbmV3X2l0ZW1fcGFnZXNfY3N2X2xvY2F0aW9uX2ZpZWxkcyB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBiIGFzIHVuaXF1ZSB9IGZyb20gJy4vZnVuY3Rpb25hbC1jODJmNWFiOS5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZENyZWF0ZUl0ZW1UeXBlcyB9IGZyb20gJy4vaXRlbS10eXBlcy1iNGZlODZhZC5qcyc7XG5cbmZ1bmN0aW9uIGZpbmRQb3NzaWJsZUl0ZW1UeXBlc0J5RXh0ZW5zaW9uKGV4dGVuc2lvbiwgdmFsaWRhdGlvblR5cGVzKSB7XG4gIC8vIFNlYXJjaCBpdGVtIHR5cGVzIGV4dGVuc2lvbnMgZm9yIHRoZSBvbmUgaW1wb3J0ZWRcbiAgbGV0IGl0ZW1UeXBlcztcbiAgaWYgKHZhbGlkYXRpb25UeXBlcykge1xuICAgIGl0ZW1UeXBlcyA9IHZhbGlkYXRpb25UeXBlcy5tYXAoKHZhbHVlKSA9PiB7XG4gICAgICByZXR1cm4gdmFsdWUudHlwZTtcbiAgICB9KTtcbiAgfVxuICBlbHNlIHtcbiAgICBpdGVtVHlwZXMgPSBPYmplY3Qua2V5cyhhZGRDcmVhdGVJdGVtVHlwZXMpO1xuICB9XG4gIGxldCBwb3NzaWJsZUl0ZW1UeXBlcyA9IFtdO1xuICBpdGVtVHlwZXMuZm9yRWFjaCgodHlwZSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBpZiAoKChfYSA9IGFkZENyZWF0ZUl0ZW1UeXBlc1t0eXBlXS5maWxlRXh0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5kZXhPZihleHRlbnNpb24pKSA+PSAwKSB7XG4gICAgICBwb3NzaWJsZUl0ZW1UeXBlcy5wdXNoKGFkZENyZWF0ZUl0ZW1UeXBlc1t0eXBlXSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHBvc3NpYmxlSXRlbVR5cGVzO1xufVxuZnVuY3Rpb24gbWFwSXRlbVR5cGVzVG9GaWxlRXh0ZW5zaW9ucyh0eXBlcykge1xuICBpZiAoIXR5cGVzKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgcmV0dXJuIHVuaXF1ZSh0eXBlcy5mbGF0TWFwKCh0eXBlKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IGFkZENyZWF0ZUl0ZW1UeXBlc1t0eXBlXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbGVFeHQ7IH0pLmZpbHRlcigodmFsaWQpID0+ICEhdmFsaWQpKTtcbn1cbmNvbnN0IGlzTGFyZ2VHZW9KU09OID0gKHNpemVJbkJ5dGVzKSA9PiB7XG4gIGNvbnN0IHNpemVJbk1CID0gc2l6ZUluQnl0ZXMgLyAxMDI0IC8gMTAyNDtcbiAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWFwcC1jb21wb25lbnRzL2lzc3Vlcy8yNTUzI2lzc3VlY29tbWVudC0zNjQ1NDA0XG4gIHJldHVybiBzaXplSW5NQiA+IDUwOyAvLyA1ME1CXG59O1xuY29uc3QgaXNMYXJnZUNTViA9IChzaXplSW5CeXRlcykgPT4ge1xuICBjb25zdCBzaXplSW5NQiA9IHNpemVJbkJ5dGVzIC8gMTAyNCAvIDEwMjQ7XG4gIC8vIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1hcHAtY29tcG9uZW50cy9pc3N1ZXMvMjg3NSNpc3N1ZWNvbW1lbnQtMzc0ODkxM1xuICByZXR1cm4gc2l6ZUluTUIgPiAyMDsgLy8gMjBNQlxufTtcblxuZXhwb3J0IHsgaXNMYXJnZUNTViBhcyBhLCBmaW5kUG9zc2libGVJdGVtVHlwZXNCeUV4dGVuc2lvbiBhcyBmLCBpc0xhcmdlR2VvSlNPTiBhcyBpLCBtYXBJdGVtVHlwZXNUb0ZpbGVFeHRlbnNpb25zIGFzIG0gfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgbCBhcyBsb2FkTW9kdWxlcyB9IGZyb20gJy4vbG9hZE1vZHVsZXMtYWFmMzBiZDYuanMnO1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5cbmNvbnN0IGxhbmd1YWdlTWFwID0gbmV3IE1hcChbXG4gIFtcImFyXCIsIFwiYXJcIl0sXG4gIFtcImJnXCIsIFwiYmdcIl0sXG4gIFtcImJzXCIsIFwiYnNcIl0sXG4gIFtcImNhXCIsIFwiY2FcIl0sXG4gIFtcImNzXCIsIFwiY3NcIl0sXG4gIFtcImRhXCIsIFwiZGFcIl0sXG4gIFtcImRlXCIsIFwiZGVcIl0sXG4gIFtcImVsXCIsIFwiZWxcIl0sXG4gIFtcImVuXCIsIFwiZW5cIl0sXG4gIFtcImVzXCIsIFwiZXNcIl0sXG4gIFtcImV0XCIsIFwiZXRcIl0sXG4gIFtcImZpXCIsIFwiZmlcIl0sXG4gIFtcImZyXCIsIFwiZnJcIl0sXG4gIFtcImhlXCIsIFwiaGVcIl0sXG4gIFtcImhyXCIsIFwiaHJcIl0sXG4gIFtcImh1XCIsIFwiaHVcIl0sXG4gIFtcImlkXCIsIFwiaWRcIl0sXG4gIFtcIml0XCIsIFwiaXRcIl0sXG4gIFtcImphXCIsIFwiamFcIl0sXG4gIFtcImtvXCIsIFwia29cIl0sXG4gIFtcImx0XCIsIFwibHRcIl0sXG4gIFtcImx2XCIsIFwibHZcIl0sXG4gIFtcIm5iXCIsIFwibmJcIl0sXG4gIFtcIm5sXCIsIFwibmxcIl0sXG4gIFtcInBsXCIsIFwicGxcIl0sXG4gIFtcInB0LWJyXCIsIFwicHQtQlJcIl0sXG4gIFtcInB0LXB0XCIsIFwicHQtUFRcIl0sXG4gIFtcInJvXCIsIFwicm9cIl0sXG4gIFtcInJ1XCIsIFwicnVcIl0sXG4gIFtcInNrXCIsIFwic2tcIl0sXG4gIFtcInNsXCIsIFwic2xcIl0sXG4gIFtcInNyXCIsIFwic3JcIl0sXG4gIFtcInN2XCIsIFwic3ZcIl0sXG4gIFtcInRoXCIsIFwidGhcIl0sXG4gIFtcInRyXCIsIFwidHJcIl0sXG4gIFtcInVrXCIsIFwidWtcIl0sXG4gIFtcInZpXCIsIFwidmlcIl0sXG4gIFtcInpoLWNuXCIsIFwiemgtQ05cIl0sXG4gIFtcInpoLWhrXCIsIFwiemgtSEtcIl0sXG4gIFtcInpoLXR3XCIsIFwiemgtVFdcIl1cbl0pO1xuLy8gcnRsXG5mdW5jdGlvbiBnZXRFbGVtZW50RGlyKGVsKSB7XG4gIHJldHVybiBnZXRFbGVtZW50UHJvcChlbCwgXCJkaXJcIiwgXCJsdHJcIik7XG59XG5mdW5jdGlvbiBnZXRFbGVtZW50UHJvcChlbCwgcHJvcCwgdmFsdWUpIHtcbiAgY29uc3QgY2xvc2VzdFdpdGhQcm9wID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsLCBgWyR7cHJvcH1dYCk7XG4gIHJldHVybiBjbG9zZXN0V2l0aFByb3AgPyBjbG9zZXN0V2l0aFByb3AuZ2V0QXR0cmlidXRlKHByb3ApIDogdmFsdWU7XG59XG4vLyBjc3NcbmNvbnN0IENTU19VVElMSVRZID0ge1xuICBydGw6IFwiYXJjZ2lzLS1ydGxcIlxufTtcbmFzeW5jIGZ1bmN0aW9uIGZvcm1hdE51bWJlcihudW1iZXIsIG9wdGlvbnMpIHtcbiAgY29uc3QgeyBhcGksIHR5cGUsIHBsYWNlcyB9ID0gb3B0aW9ucyB8fCB7fTtcbiAgaWYgKGFwaSA9PT0gNCkge1xuICAgIGNvbnN0IFtpbnRsXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvaW50bFwiXSk7XG4gICAgY29uc3QgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMgPSBpbnRsLmNvbnZlcnROdW1iZXJGb3JtYXRUb0ludGxPcHRpb25zKHtcbiAgICAgIHBsYWNlcyxcbiAgICAgIHN0eWxlOiB0eXBlLFxuICAgICAgZGlnaXRTZXBhcmF0b3I6IHRydWVcbiAgICB9KTtcbiAgICByZXR1cm4gaW50bC5mb3JtYXROdW1iZXIobnVtYmVyLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG51bWJlckZvcm1hdEludGxPcHRpb25zKSwgeyBzdHlsZTogdHlwZSB9KSk7XG4gIH1cbiAgY29uc3QgW2Rvam9OdW1iZXJdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZG9qby9udW1iZXJcIl0pO1xuICByZXR1cm4gZG9qb051bWJlci5mb3JtYXQobnVtYmVyLCB7XG4gICAgdHlwZSxcbiAgICBwbGFjZXMsXG4gICAgcGF0dGVybjogb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLnBhdHRlcm5cbiAgfSk7XG59XG5jb25zdCBjYWNoZSA9IHt9O1xuZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlKSB7XG4gIGNvbnN0IGxhbmcgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZztcbiAgY29uc3QgZGF5U2hvcnRNb250aFllYXIgPSB7XG4gICAgeWVhcjogXCJudW1lcmljXCIsXG4gICAgbW9udGg6IFwic2hvcnRcIixcbiAgICBkYXk6IFwibnVtZXJpY1wiXG4gIH07XG4gIGlmICghY2FjaGVbbGFuZ10pIHtcbiAgICBjYWNoZVtsYW5nXSA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nLCBkYXlTaG9ydE1vbnRoWWVhcik7XG4gIH1cbiAgcmV0dXJuIGNhY2hlW2xhbmddLmZvcm1hdChkYXRlKTtcbn1cblxuZXhwb3J0IHsgQ1NTX1VUSUxJVFkgYXMgQywgZm9ybWF0RGF0ZSBhcyBhLCBmb3JtYXROdW1iZXIgYXMgZiwgZ2V0RWxlbWVudERpciBhcyBnLCBsYW5ndWFnZU1hcCBhcyBsIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=