"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-96d103"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-categories-picker_6.entry.js":
/*!*****************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-categories-picker_6.entry.js ***!
  \*****************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_categories_picker: () => (/* binding */ ArcgisCategoriesPicker),
/* harmony export */   arcgis_folder_picker: () => (/* binding */ ArcgisFolderPicker),
/* harmony export */   arcgis_item_properties: () => (/* binding */ ArcgisItemProperties),
/* harmony export */   arcgis_summary_input: () => (/* binding */ ArcgisSummaryInput),
/* harmony export */   arcgis_tags_picker: () => (/* binding */ ArcgisTagsPicker),
/* harmony export */   arcgis_title_input: () => (/* binding */ ArcgisTitleInput)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./item-properties-e6412a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js");
/* harmony import */ var _categories_eeb03e5a_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./categories-eeb03e5a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-eeb03e5a.js");
/* harmony import */ var _user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./user-e3dedc4a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./server-item-f12153e6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js");
/* harmony import */ var _functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./functional-9f648bee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-9f648bee.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _file_f36193e9_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./file-f36193e9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-f36193e9.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/* harmony import */ var _guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./guid-4f4176ba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */





















const arcgisCategoriesPickerCss = ":host{--arcgis-label-font-weight:400}.label{margin-top:0;margin-bottom:0;font-weight:var(--arcgis-label-font-weight)}";

const ArcgisCategoriesPicker = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisCategoriesPickerChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisCategoriesPickerChange", 7);
    this.api = undefined;
    this.portal = undefined;
    this.scale = undefined;
    this.label = undefined;
    this.categories = undefined;
    this.schema = [];
  }
  async componentWillLoad() {
    var _a, _b, _c, _d;
    const locale = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.el);
    this.i18n = locale[0];
    // Fall back to config if no props passed in
    (_a = this.portal) !== null && _a !== void 0 ? _a : (this.portal = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    (_b = this.scale) !== null && _b !== void 0 ? _b : (this.scale = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.scale);
    (_c = this.api) !== null && _c !== void 0 ? _c : (this.api = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.api);
    (_d = this.categories) !== null && _d !== void 0 ? _d : (this.categories = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.categories);
    _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.a.on("reset", () => {
      this.categories = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.categories;
    });
  }
  async componentDidLoad() {
    var _a, _b, _c;
    const { portal, schema } = this;
    if (portal && !(schema === null || schema === void 0 ? void 0 : schema.length)) {
      if (portal.categories) {
        this.schema = (_a = portal.categories[0]) === null || _a === void 0 ? void 0 : _a.categories;
      }
      else {
        const response = await (0,_categories_eeb03e5a_js__WEBPACK_IMPORTED_MODULE_4__.f)(portal);
        this.schema = (_c = (_b = response.categorySchema) === null || _b === void 0 ? void 0 : _b[0]) === null || _c === void 0 ? void 0 : _c.categories;
      }
    }
  }
  updateCategories() {
    this.arcgisCategoriesPickerChange.emit(this.categories);
  }
  categoriesPickerChangeHandler(event) {
    var _a;
    event.stopPropagation();
    const values = ((_a = this.combobox) === null || _a === void 0 ? void 0 : _a.value) || [];
    this.categories = Array.isArray(values) ? values : [values];
  }
  renderNestedCategories(schema, previousValue) {
    return schema.map((category) => {
      // Keep breadcrumbs of categories' ancestry
      const value = previousValue
        ? `${previousValue}/${category.title}`
        : `/Categories/${category.title}`;
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { value: value, textLabel: category.title, selected: this.categories.indexOf(value) >= 0 }, category.categories && this.renderNestedCategories(category.categories, value)));
    });
  }
  render() {
    var _a;
    const { i18n, scale, schema } = this;
    return (this.schema && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: scale }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "label" }, (_a = this.label) !== null && _a !== void 0 ? _a : i18n.categories), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox", { label: i18n.categories, maxItems: 5, selectionMode: "ancestors", placeholder: i18n.assignCategories, scale: scale, ref: (el) => (this.combobox = el) }, this.renderNestedCategories(schema)))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "categories": ["updateCategories"]
  }; }
};
ArcgisCategoriesPicker.style = arcgisCategoriesPickerCss;

const arcgisFolderPickerCss = ":host{--arcgis-label-font-weight:400}.label{margin-top:0;margin-bottom:0;font-weight:var(--arcgis-label-font-weight)}.label--bold{--arcgis-label-font-weight:500}.create-folder{--calcite-ui-text-1:var(--calcite-ui-text-link);--calcite-ui-text-3:var(--calcite-ui-text-link)}.combobox-wrapper{position:relative}.progress{position:absolute;top:0;z-index:1}";

const MAX_TITLE_LENGTH$1 = 250;
const ArcgisFolderPicker = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisFolderPickerChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisFolderPickerChange", 7);
    this.arcgisFolderPickerLoad = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisFolderPickerLoad", 7);
    this.api = undefined;
    this.portal = undefined;
    this.user = undefined;
    this.scale = undefined;
    this.label = undefined;
    this.folder = undefined;
    this.folders = [];
    this.newFolderActive = false;
    this.emptyFilterList = false;
    this.filterText = undefined;
    this.newFolderInput = undefined;
    this.createFolderText = undefined;
    this.showError = false;
    this.errorString = undefined;
    this.newFolderInputElement = undefined;
    this.comboboxElement = undefined;
    this.loading = false;
  }
  async componentWillLoad() {
    var _a, _b, _c, _d, _e, _f, _g, _h;
    const locale = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.el);
    this.i18n = locale[0];
    // Fall back to config if no props passed
    (_a = this.portal) !== null && _a !== void 0 ? _a : (this.portal = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    (_b = this.user) !== null && _b !== void 0 ? _b : (this.user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
    (_c = this.scale) !== null && _c !== void 0 ? _c : (this.scale = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.scale);
    (_d = this.api) !== null && _d !== void 0 ? _d : (this.api = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.api);
    (_e = this.folder) !== null && _e !== void 0 ? _e : (this.folder = (_g = (_f = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.folder) !== null && _f !== void 0 ? _f : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.initialFolder) !== null && _g !== void 0 ? _g : (_h = this.folders) === null || _h === void 0 ? void 0 : _h[0]);
    this.createFolderText = this.i18n.createNewFolder;
    // arcgis-workflow TODO: re-initializing local state on store reset is not compatible with tests
    _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.a.on("reset", () => {
      var _a, _b, _c;
      this.folder = (_b = (_a = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.folder) !== null && _a !== void 0 ? _a : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.initialFolder) !== null && _b !== void 0 ? _b : (_c = this.folders) === null || _c === void 0 ? void 0 : _c[0];
    });
  }
  async componentDidLoad() {
    // Only load folders if empty
    if (!this.folders.length) {
      await this.loadFolders(this.user);
    }
  }
  async handleUserChange(newUser, previousUser) {
    if (!!previousUser && newUser.username !== previousUser.username) {
      await this.loadFolders(newUser);
      this.folder = this.getHomeFolder();
    }
  }
  handleFolderChange() {
    this.arcgisFolderPickerChange.emit(this.folder);
  }
  async loadFolders(user) {
    var _a;
    this.loading = true;
    this.folders = await (0,_user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_5__.g)(user);
    this.arcgisFolderPickerLoad.emit([...this.folders]);
    if (!((_a = this.folder) === null || _a === void 0 ? void 0 : _a.id)) {
      this.folder = this.getHomeFolder();
    }
    this.loading = false;
  }
  getHomeFolder() {
    return this.folders.find((folder) => folder.title === folder.id);
  }
  setNewFolderActive() {
    var _a;
    (_a = this.newFolderInputElement) === null || _a === void 0 ? void 0 : _a.setFocus();
    if (!this.newFolderInputElement) {
      this.showError = false;
      this.newFolderInput = "";
    }
  }
  checkForEmptySuggestions(event) {
    var _a;
    event.stopPropagation();
    const text = this.comboboxElement.shadowRoot.querySelector("input").value;
    const { i18n } = this;
    this.emptyFilterList = ((_a = this.comboboxElement.filteredItems) === null || _a === void 0 ? void 0 : _a.length) <= 1;
    this.createFolderText = this.emptyFilterList
      ? i18n.noFoldersFoundCreate.replace("${folder}", text)
      : i18n.createNewFolder;
    this.filterText = text;
  }
  handleComboboxChange(event) {
    var _a, _b, _c;
    event.stopPropagation();
    const value = (_a = this.comboboxElement) === null || _a === void 0 ? void 0 : _a.value;
    if (value === "create-folder") {
      this.showError = false;
      this.emptyFilterList ? this.createNewFolder(this.filterText) : (this.newFolderActive = true);
      return;
    }
    this.folder =
      (_c = (_b = this.folders.find((folder) => folder.id === value)) !== null && _b !== void 0 ? _b : this.folder) !== null && _c !== void 0 ? _c : this.getHomeFolder();
  }
  closeNewFolderInput(event) {
    event.stopPropagation();
    this.newFolderActive = false;
  }
  // TODO: convert to Result, add folder errors to error structure
  async saveActiveFolder() {
    if (!this.newFolderActive) {
      return true;
    }
    try {
      await this.createNewFolder(this.newFolderInput);
    }
    catch (e) {
      return this.errorString;
    }
    return !this.showError;
  }
  async createNewFolder(folderName) {
    var _a;
    const title = folderName.trim();
    const { i18n, user } = this;
    try {
      const { folder } = await (0,_user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_5__.c)(title, user);
      this.folder = folder;
      this.folders = [this.folder, ...this.folders];
      // TODO: Remove/move configState.folders? Leftover from initial telemetry pass, may not be properly utilized anymore
      _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.folders = this.folders;
      this.newFolderActive = false;
      this.showError = false;
      // for some reason, sometimes the combobox doesn't pick up the change, so make sure the new folder is selected
      await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_6__.t)(100);
      const selectedItem = (_a = this.el.shadowRoot) === null || _a === void 0 ? void 0 : _a.querySelector(`calcite-combobox-item[data-id="${this.folder.id}"]`);
      if (selectedItem) {
        selectedItem.selected = true;
      }
    }
    catch (error) {
      // Identify which error occurred
      // TODO: Report via AppComponentErrorCode
      if (!title || (title === null || title === void 0 ? void 0 : title.length) <= 0) {
        this.errorString = i18n.error.noName;
      }
      else if (this.folders.map((folder) => folder.title).includes(title)) {
        this.errorString = i18n.error.folderAlreadyExists.replace("${folder}", title);
      }
      else if (title.indexOf(">") >= 0 || title.indexOf("<") >= 0) {
        this.errorString = i18n.error.invalidCharacters;
      }
      else {
        console.error(error);
        this.errorString = error.message;
      }
      this.showError = true;
      throw error;
    }
  }
  render() {
    var _a;
    const { i18n, scale } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: scale, class: "input-height" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "label" }, (_a = this.label) !== null && _a !== void 0 ? _a : i18n.folder), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.newFolderActive ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-inline-editable", { controls: true, "editing-enabled": true, afterConfirm: async () => {
        var _a;
        try {
          await this.createNewFolder(this.newFolderInput);
          this.newFolderActive = false;
        }
        catch (error) {
          (_a = this.newFolderInputElement) === null || _a === void 0 ? void 0 : _a.setFocus();
          throw error;
        }
      }, scale: scale }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { placeholder: i18n.enterFolder, value: this.newFolderInput, maxLength: MAX_TITLE_LENGTH$1, scale: scale, onCalciteInputInput: (event) => (this.newFolderInput = event.target.value), onKeyDown: (e) => {
        e.stopPropagation();
        this.showError = false;
        switch (e.key) {
          case "Enter":
            this.createNewFolder(this.newFolderInput);
            break;
          case "Escape":
            this.newFolderActive = false;
            this.showError = false;
            break;
        }
      }, ref: (element) => (this.newFolderInputElement = element), status: this.showError ? "invalid" : "idle" }))) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "combobox-wrapper" }, this.loading && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-progress", { type: "indeterminate", class: "progress" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox", { label: i18n.folder, selectionMode: "single", maxItems: 5, placeholder: this.loading ? i18n.loading : i18n.searchFolders, scale: scale, ref: (element) => (this.comboboxElement = element), disabled: this.loading, clearDisabled: true, onCalciteComboboxChange: (event) => this.handleComboboxChange(event), onCalciteComboboxBeforeClose: () => {
        // Calcite Combobox workaround: folder picker should always have an option selected - reset folder to previous if selected folder is empty
        if (!this.comboboxElement.selectedItems.length) {
          this.comboboxElement.value = this.folder.id;
        }
      } }, !this.loading && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.F, null, this.user && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { class: "create-folder", value: "create-folder", textLabel: this.createFolderText, selected: false, icon: "folder-plus", filterDisabled: true })), this.folders.map(({ id, username, title }) => {
      // Fall back to user's home folder if current folder isn't found - invalid, deleted, etc.
      const selectedFolder = this.folders
        .map((folder) => folder.id)
        .includes(this.folder.id)
        ? this.folder
        : this.getHomeFolder();
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { "data-id": id, value: id, textLabel: title, selected: (selectedFolder === null || selectedFolder === void 0 ? void 0 : selectedFolder.id) !== "all"
          ? id === (selectedFolder === null || selectedFolder === void 0 ? void 0 : selectedFolder.id)
          : id === username, icon: id === username ? "home" : "folder" }));
    }))))))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { status: "invalid", hidden: !this.showError, icon: this.showError, scale: scale }, this.errorString)));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "user": ["handleUserChange"],
    "folder": ["handleFolderChange"],
    "newFolderInputElement": ["setNewFolderActive"]
  }; }
};
ArcgisFolderPicker.style = arcgisFolderPickerCss;

var itemPropertiesEvent;
(function (itemPropertiesEvent) {
  itemPropertiesEvent["arcgisTitleInputChange"] = "title";
  itemPropertiesEvent["arcgisFolderPickerChange"] = "folder";
  itemPropertiesEvent["arcgisSummaryInputChange"] = "snippet";
  itemPropertiesEvent["arcgisTagsPickerChange"] = "tags";
  itemPropertiesEvent["arcgisCategoriesPickerChange"] = "categories";
})(itemPropertiesEvent || (itemPropertiesEvent = {}));
const ArcgisItemProperties = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemPropertiesChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemPropertiesChange", 7);
    this.portal = undefined;
    this.user = undefined;
    this.api = undefined;
    this.config = undefined;
    this.itemId = undefined;
    this.type = undefined;
    this.scale = undefined;
  }
  /**
   * Manually reset state
   */
  async resetItemPropertiesStore() {
    _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.a.reset();
  }
  // If any prop changes, update the store and emit the current itemPropertiesState
  handleItemPropertiesChange(event) {
    const { detail, type } = event;
    _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i[itemPropertiesEvent[type]] = detail;
    this.arcgisItemPropertiesChange.emit(Object.assign({}, _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i));
  }
  async componentWillLoad() {
    var _a, _b;
    // Prioritize props over existing store values
    if (this.portal) {
      _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal = this.portal;
    }
    if (this.user) {
      _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user = this.user;
    }
    if (this.api) {
      _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.api = this.api;
    }
    if (this.config) {
      _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.config = this.config;
    }
    if (this.itemId) {
      ({ result: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.item } = await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_7__.a)(this.itemId, this.portal));
    }
    if (this.type) {
      _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.type = (_a = this.type) !== null && _a !== void 0 ? _a : (_b = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.item) === null || _b === void 0 ? void 0 : _b.type;
    }
    if (this.scale) {
      _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.scale = this.scale;
    }
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", null)));
  }
  disconnectedCallback() {
    _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.a.reset();
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const arcgisSummaryInputCss = ":host{--arcgis-label-font-weight:400;--arcgis-label-margin-bottom:1rem}.container-s{margin-bottom:0.5rem}.container-m{margin-bottom:0.75rem}.container-l{margin-bottom:1rem}.label{--calcite-label-margin-bottom:0}.label-text{margin-top:0;margin-bottom:0;font-weight:var(--arcgis-label-font-weight)}.label--bold{--arcgis-label-font-weight:500}calcite-input{--calcite-ui-border-1:var(--calcite-ui-border-input)}.count{font-size:0.75rem;color:var(--calcite-ui-text-1);opacity:0.75}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}";

// Taken from https://developers.arcgis.com/rest/users-groups-and-items/update-item.htm
const MAX_CHARACTER = 2048;
const ArcgisSummaryInput = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisSummaryInputChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSummaryInputChange", 7);
    this.updateLiveRegion = (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_6__.d)((summary) => {
      this.liveRegionText = this.getCharactersText(summary);
    }, 1500);
    this.scale = undefined;
    this.label = undefined;
    this.summary = undefined;
    this.liveRegionText = undefined;
    this.valid = true;
  }
  async getErrorMessage() {
    if (!this.valid) {
      return {
        code: "summaryInvalid",
        translatedMessage: this.i18n.invalid
      };
    }
    return null;
  }
  async componentWillLoad() {
    var _a, _b;
    const locale = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.el);
    this.i18n = locale[0];
    // Do not override configState scale for individual components
    (_a = this.scale) !== null && _a !== void 0 ? _a : (this.scale = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.scale);
    (_b = this.summary) !== null && _b !== void 0 ? _b : (this.summary = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.snippet);
    this.liveRegionText = this.getCharactersText(this.summary);
    // arcgis-workflow TODO: re-initializing local state on store reset is not compatible with tests
    _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.a.on("reset", () => {
      this.summary = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.snippet;
    });
  }
  componentDidRender() {
    var _a, _b, _c;
    // TODO: remove this once calcite-input support resize="vertical" https://github.com/Esri/calcite-design-system/tree/main/packages/calcite-components/src/components/input
    const textArea = (_c = (_b = (_a = this.el.shadowRoot) === null || _a === void 0 ? void 0 : _a.querySelector("calcite-input")) === null || _b === void 0 ? void 0 : _b.shadowRoot) === null || _c === void 0 ? void 0 : _c.querySelector("textarea");
    textArea && (textArea.style.resize = "vertical");
  }
  getCharactersText(summary) {
    return this.i18n.charactersLeft.replace("${num}", `${MAX_CHARACTER - summary.length}`);
  }
  validate() {
    this.valid = !/>|</.test(this.summary);
  }
  render() {
    const { i18n, summary, label, scale, liveRegionText, valid } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: `container-${scale}` }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: scale, class: "label" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "label-text" }, label !== null && label !== void 0 ? label : i18n.summary), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "textarea", id: "summary-input", placeholder: i18n.addSummary, value: summary, maxLength: MAX_CHARACTER, scale: scale, status: valid ? "idle" : "invalid", onCalciteInputInput: (event) => {
        event.stopPropagation();
        const node = event.target;
        this.summary = node.value;
        this.arcgisSummaryInputChange.emit(this.summary);
        this.updateLiveRegion(node.value);
        this.validate();
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { hidden: valid, icon: true, scale: scale, status: valid ? "idle" : "invalid" }, i18n.invalid), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "screen-readers-only", "aria-live": "polite" }, liveRegionText)), valid && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "count", "aria-hidden": "true" }, this.getCharactersText(summary)))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSummaryInput.style = arcgisSummaryInputCss;

/**
 * Given a publishable type, find what type the resulting published item will be
 */
function findPublishType(type) {
  switch (type) {
    case "CSV":
    case "Microsoft Excel":
    case "GeoJson":
    case "Shapefile":
    case "File Geodatabase":
    case "Image Collection":
    case "GeoPackage":
    case "Service Definition":
      return "Feature Service";
    case "Tile Package":
      return "Map Service";
    case "Vector Tile Package":
      return "Vector Tile Service";
    case "Scene Package":
      return "Scene Service";
    case "3DTiles Package":
      return "3DTiles Service";
  }
  return type;
}
/**
 * Check if a title is valid and unique
 */
const MAX_PUBLISH_SERVICE_NAME = 90;
const MAX_DATA_STORE_TITLE = 90;
const MAX_TITLE_LENGTH = 250;
async function validateTitle({ portal, user, title, itemType, folder, extension, enablePublishing = false, update = false }) {
  if (!user || !portal) {
    return { code: "missingUserOrPortal" };
  }
  if (!title || title.length <= 0) {
    return { code: "titleRequired" };
  }
  // for data store items, only alphanumeric and underscores should be allowed
  const dataStoreNameInvalidCharacterRegExp = /[\s.@~`!#$%\^&*+=\-\[\]\\';,\/{}|\\":<>\?]/g;
  if (itemType === "Data Store" &&
    (dataStoreNameInvalidCharacterRegExp.test(title) || title.length > MAX_DATA_STORE_TITLE)) {
    return { code: "dataStoreTitleInvalid" };
  }
  // for non publishable items, the only characters that arent allowed are < and >
  const itemNameCharacterRegExp = /<|>/gi;
  if (!enablePublishing && (itemNameCharacterRegExp.test(title) || title.length > MAX_TITLE_LENGTH)) {
    return { code: "titleInvalid" };
  }
  // for publishable items, only alphanumeric and underscores should be allowed
  const serviceNameInvalidCharacterRegExp = /[.@~`!#$%\^&*+=\-\[\]\\';,\/{}|\\":<>\?]/g;
  if (enablePublishing && (serviceNameInvalidCharacterRegExp.test(title) || title.length > MAX_PUBLISH_SERVICE_NAME)) {
    return { code: "serviceNameInvalid" };
  }
  const publishedItemType = enablePublishing ? findPublishType(itemType) : itemType;
  const { itemURLList } = (await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_7__.s)(title, publishedItemType, folder, extension, user, portal)) || {};
  if (itemURLList && !update) {
    return {
      code: "itemExists",
      itemUrl: itemURLList[0]
    };
  }
  // if we're publishing, ensure that the service name is available
  if (enablePublishing) {
    const response = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_9__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_9__.g)(portal)}portals/${portal.id}/isServiceNameAvailable`, {
      name: title.replace(/\s/g, "_"),
      type: publishedItemType
    });
    if (!(response === null || response === void 0 ? void 0 : response.available)) {
      return {
        code: "titleInUseService",
        layerName: title
      };
    }
  }
  return null;
}
async function fetchTags(user) {
  user !== null && user !== void 0 ? user : (user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
  const tagsUrl = user.url + "/tags";
  try {
    const tagsResponse = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_9__.r)(tagsUrl);
    return tagsResponse.tags;
  }
  catch (error) {
    console.error(error);
  }
}

const arcgisTagsPickerCss = ":host{--arcgis-label-font-weight:400}.label{margin-top:0;margin-bottom:0;font-weight:var(--arcgis-label-font-weight)}.label--bold{--arcgis-label-font-weight:500}.screen-reader-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}";

const ArcgisTagsPicker = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisTagsPickerChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisTagsPickerChange", 7);
    /** Custom type guard to check if tags need to be re-requested */
    this.isTag = (arg) => arg.tag !== undefined && arg.count !== undefined;
    /** store all the tags that have been rendered through this component in contrast to the ones added directly by calcite-combobox */
    this.controlledTags = [];
    this.mapItemValue = (items) => {
      return items.map((item) => item.value);
    };
    this.handleKeydown = (e) => {
      var _a;
      // If user typed a comma, treat as enter.
      // TODO: remove after calcite enables comma support (https://github.com/Esri/calcite-components/issues/4672)
      if (e.key === ",") {
        const target = e.target;
        const input = (_a = target === null || target === void 0 ? void 0 : target.shadowRoot) === null || _a === void 0 ? void 0 : _a.querySelector("input");
        if (input === null || input === void 0 ? void 0 : input.value) {
          e.preventDefault();
          const existing = target.querySelector(`calcite-combobox-item[value="${input.value}"]`);
          if (existing) {
            existing.selected = true;
          }
          else {
            const item = document.createElement("calcite-combobox-item");
            item.value = input.value;
            item.textLabel = input.value;
            item.selected = true;
            target === null || target === void 0 ? void 0 : target.appendChild(item);
          }
          input.value = "";
        }
      }
    };
    this.api = undefined;
    this.user = undefined;
    this.scale = undefined;
    this.activeTags = undefined;
    this.knownTags = [];
    this.label = undefined;
    this.placeholder = undefined;
    this.hideLabel = undefined;
  }
  async componentWillLoad() {
    var _a, _b, _c, _d, _e, _f;
    const locale = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.el);
    this.i18n = locale[0];
    // Fall back to config if no props passed in
    (_a = this.user) !== null && _a !== void 0 ? _a : (this.user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
    (_b = this.scale) !== null && _b !== void 0 ? _b : (this.scale = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.scale);
    (_c = this.api) !== null && _c !== void 0 ? _c : (this.api = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.api);
    (_d = this.activeTags) !== null && _d !== void 0 ? _d : (this.activeTags = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.tags);
    this.activeTags = (0,_functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_8__.f)(this.activeTags);
    // Build initial tags list from existing tags and ones pre-set by the consuming app
    this.knownTags = (0,_functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_8__.f)([...((_e = this.knownTags) !== null && _e !== void 0 ? _e : []), ...((_f = this.activeTags) !== null && _f !== void 0 ? _f : [])]);
    _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.a.on("reset", () => {
      this.activeTags = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.tags;
    });
  }
  async componentDidLoad() {
    var _a, _b, _c;
    const { user } = this;
    if (user) {
      const userTags = (_a = user.contentTags) !== null && _a !== void 0 ? _a : user.tags;
      if (!(userTags === null || userTags === void 0 ? void 0 : userTags.length) || ((userTags === null || userTags === void 0 ? void 0 : userTags.length) > 0 && !this.isTag(userTags[0]))) {
        this.knownTags = [...this.knownTags, ...(await fetchTags(user)).map((tag) => tag.tag)];
      }
      else {
        this.knownTags = [...this.knownTags, ...userTags.map((tag) => tag.tag)];
      }
      this.knownTags = (0,_functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_8__.f)([...((_b = this.activeTags) !== null && _b !== void 0 ? _b : []), ...((_c = this.knownTags) !== null && _c !== void 0 ? _c : [])]);
    }
  }
  itemPropertiesTagsChangeHandler(event) {
    var _a;
    event.stopPropagation();
    const values = ((_a = this.combobox) === null || _a === void 0 ? void 0 : _a.value) || [];
    const tags = Array.isArray(values) ? values : [values];
    this.arcgisTagsPickerChange.emit((0,_functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_8__.f)(tags));
    const knownItems = Array.from(this.combobox.children);
    const activeItems = this.combobox.selectedItems;
    knownItems.forEach((item) => {
      const hasBeenAdded = this.controlledTags.includes(item.value);
      // remove any combobox-item that is not yet part of the controlled list of tags
      if (!hasBeenAdded) {
        item.remove();
      }
    });
    this.knownTags = this.mapItemValue(knownItems);
    this.activeTags = this.mapItemValue(activeItems);
  }
  renderFormattedTags() {
    const { i18n, scale, handleKeydown, placeholder } = this;
    this.knownTags.forEach((tag) => {
      if (this.controlledTags.includes(tag)) {
        return;
      }
      this.controlledTags.push(tag);
    });
    const tagElements = this.knownTags.map((tag) => {
      var _a;
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { key: tag, value: tag, textLabel: tag.length > 36 ? `${tag.slice(0, 36)}...` : tag, selected: ((_a = this.activeTags) === null || _a === void 0 ? void 0 : _a.indexOf(tag)) >= 0 }));
    });
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox", { label: i18n.tags, maxItems: 5, "allow-custom-values": true, placeholder: placeholder !== null && placeholder !== void 0 ? placeholder : i18n.addTags, scale: scale, onKeyDown: handleKeydown, ref: (el) => (this.combobox = el) }, tagElements));
  }
  async setFocus() {
    var _a;
    (_a = this.combobox) === null || _a === void 0 ? void 0 : _a.setFocus();
  }
  render() {
    const { i18n, scale, hideLabel, label } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: scale }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: { label: true, "screen-reader-only": hideLabel } }, label !== null && label !== void 0 ? label : i18n.tags), this.renderFormattedTags()));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisTagsPicker.style = arcgisTagsPickerCss;

const arcgisTitleInputCss = ":host{--arcgis-label-font-weight:400}.label{margin-top:0;margin-bottom:0;font-weight:var(--arcgis-label-font-weight)}.label--bold{--arcgis-label-font-weight:500}calcite-input{--calcite-ui-border-1:var(--calcite-ui-border-input)}";

const ArcgisTitleInput = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisTitleInputChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisTitleInputChange", 7);
    this.debouncedInput = (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_6__.d)(() => {
      return this.handleTitleValidation();
    }, 400);
    this.api = undefined;
    this.portal = undefined;
    this.user = undefined;
    this.scale = undefined;
    this.label = undefined;
    this.itemTitle = undefined;
    this.currentFolder = undefined;
    this.type = undefined;
    this.update = false;
    this.enablePublishing = undefined;
    this.titleError = undefined;
  }
  async focusMainInput() {
    var _a, _b;
    // arcgis-workflow TODO: mainInputRef is an empty object when publish item properties' test calls validate
    (_b = (_a = this.mainInputRef).setFocus) === null || _b === void 0 ? void 0 : _b.call(_a);
  }
  async validateTitle() {
    // Check which situations should be flushed instead of invoked - might need to introduce something to catch "modified since last validate"
    return this.debouncedInput.invoke();
    // TODO: Refer to the below snippet if there's a timing issue found always invoking
    // We want to invoke to trigger the empty title error so it always get triggered
    // return !this.itemTitle ? this.debouncedInput.invoke() : this.debouncedInput.flush();
  }
  async handleTitleValidation() {
    const { type, itemTitle, enablePublishing, portal, user, update } = this;
    const { extension } = (0,_file_f36193e9_js__WEBPACK_IMPORTED_MODULE_10__.a)(itemTitle);
    if (!type) {
      console.error("No item type found. Skipping title validation");
      return;
    }
    this.titleError = await validateTitle({
      portal,
      user,
      title: itemTitle,
      itemType: type,
      folder: this.currentFolder,
      extension,
      enablePublishing,
      update
    });
    return this.getErrorMessage();
  }
  getErrorMessage() {
    const { itemTitle, titleError, i18n } = this;
    if (!itemTitle) {
      this.titleError = {
        code: "titleRequired",
        translatedMessage: this.i18n.validation.titleRequired
      };
    }
    if (!!titleError) {
      titleError.translatedMessage = i18n.validation[this.titleError.code].replace("${name}", itemTitle);
    }
    return titleError;
  }
  async componentWillLoad() {
    var _a, _b, _c, _d, _e, _f, _g;
    const locale = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.el);
    this.i18n = locale[0];
    // Fall back to config if no props passed
    (_a = this.portal) !== null && _a !== void 0 ? _a : (this.portal = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    (_b = this.user) !== null && _b !== void 0 ? _b : (this.user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
    (_c = this.scale) !== null && _c !== void 0 ? _c : (this.scale = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.scale);
    (_d = this.api) !== null && _d !== void 0 ? _d : (this.api = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.api);
    (_e = this.type) !== null && _e !== void 0 ? _e : (this.type = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.type);
    (_f = this.itemTitle) !== null && _f !== void 0 ? _f : (this.itemTitle = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.title);
    (_g = this.currentFolder) !== null && _g !== void 0 ? _g : (this.currentFolder = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.folder);
    this.itemTitle && this.handleTitleValidation();
    _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.title = this.itemTitle;
    // arcgis-workflow TODO: re-initializing local state on store reset is not compatible with tests
    _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.a.on("reset", () => {
      this.itemTitle = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.title;
    });
  }
  render() {
    var _a;
    const { i18n, itemTitle, scale } = this;
    const { translatedMessage, code } = this.titleError || {};
    const valid = !translatedMessage;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: scale }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "label" }, (_a = this.label) !== null && _a !== void 0 ? _a : i18n.title), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { id: "item-properties-title", placeholder: i18n.addTitle, value: itemTitle, scale: scale, onInput: this.debouncedInput, max: MAX_TITLE_LENGTH, ref: (ele) => (this.mainInputRef = ele), status: valid ? "idle" : "invalid", onCalciteInputInput: (event) => {
        event.stopPropagation();
        this.itemTitle = event.target.value;
        this.arcgisTitleInputChange.emit(this.itemTitle);
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { icon: true, hidden: valid, status: valid ? "idle" : "invalid" }, translatedMessage || i18n[code] || i18n.title)));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "currentFolder": ["handleTitleValidation"]
  }; }
};
ArcgisTitleInput.style = arcgisTitleInputCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-eeb03e5a.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-eeb03e5a.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ fetchLivingAtlasCategories),
/* harmony export */   b: () => (/* binding */ fetchGroupCategories),
/* harmony export */   f: () => (/* binding */ fetchCategories)
/* harmony export */ });
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




async function fetchCategories(portal, user) {
  portal !== null && portal !== void 0 ? portal : (portal = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
  user !== null && user !== void 0 ? user : (user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
  if (!(portal === null || portal === void 0 ? void 0 : portal.id) || (user && (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_2__.n)(user))) {
    return null;
  }
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}portals/${portal.id}/categorySchema`), "categorySchema", portal.id);
}
async function fetchGroupCategories(groupId, portal) {
  portal !== null && portal !== void 0 ? portal : (portal = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
  if (!groupId || !portal) {
    return null;
  }
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}community/groups/${groupId}/categorySchema`), "categorySchema", groupId);
}
async function fetchLivingAtlasSchema(portal) {
  var _a;
  const base = (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal);
  const self = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}portals/self`);
  const groupSearch = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}community/groups?q=${self.contentCategorySetsGroupQuery}`);
  const categoryGroup = (_a = groupSearch === null || groupSearch === void 0 ? void 0 : groupSearch.results) === null || _a === void 0 ? void 0 : _a[0];
  const schemaItemSearch = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/groups/${categoryGroup.id}/search`, {
    q: "typekeywords: LivingAtlas"
  });
  const schemaItem = schemaItemSearch.results[0];
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/items/${schemaItem.id}/data`);
}
async function fetchLivingAtlasCategories(portal) {
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => fetchLivingAtlasSchema(portal), "categorySchema", "living-atlas");
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-f36193e9.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-f36193e9.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ sanitizeFileName),
/* harmony export */   f: () => (/* binding */ formatFileSize),
/* harmony export */   g: () => (/* binding */ getItemInfoByType),
/* harmony export */   s: () => (/* binding */ sanitizeFileInput),
/* harmony export */   v: () => (/* binding */ validateOverwriteFileName)
/* harmony export */ });
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/* harmony import */ var _guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./guid-4f4176ba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



function sanitizeFileName(name, addGUID) {
  //TODO: add new param to spec file.
  const expression = /(?:\.([^.]+))?$/;
  const invalidTitleCharacters = /\.|-/g;
  let fileName = name.replace(/^.*(\\|\/|:)/, "");
  let extension = (fileName && expression.exec(fileName)[1] ? expression.exec(fileName)[1].toLowerCase() : "");
  let title = "";
  if (fileName.indexOf(".rft.") > -1) {
    const [name, suffix] = fileName.split(".rft.");
    extension = `rft.${suffix}`;
    title = name;
  }
  if (fileName && !title) {
    title = fileName.lastIndexOf(".") === -1 ? fileName : fileName.substring(0, fileName.lastIndexOf("."));
  }
  // Replace any invalid characters with an underscore
  title = title.replace(invalidTitleCharacters, "_");
  // Allow file upload of existing item's file name // currently used in append
  if (addGUID) {
    title = makeUniqueFileName(title);
    fileName = `${title}.${extension}`;
  }
  return { title, fileName, extension };
}
// Helper method that takes in a file & returns the cleaned up file name as is and in title form, and the detected file extension
function sanitizeFileInput(file, addGUID) {
  return sanitizeFileName(file.name, !!addGUID);
}
function makeUniqueFileName(name) {
  return `${name}_${(0,_guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_1__.g)()}`;
}
function validateOverwriteFileName(uploadedFileName, sourceFileName) {
  let fileName = uploadedFileName;
  const position = uploadedFileName.lastIndexOf("\\");
  if (position > -1) {
    fileName = fileName.substring(position + 1, fileName.length);
  }
  return fileName.replace(/\ /g, "_") === sourceFileName.replace(/\ /g, "_");
}
function getItemInfoByType(type) {
  if (_item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_0__.a[type]) {
    return _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_0__.a[type];
  }
  else {
    return _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_0__.a[Object.keys(_item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_0__.a).find((fileType) => _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_0__.a[fileType].type === type)];
  }
}
function formatFileSize(size) {
  if (!size) {
    return "0 B";
  }
  const i = Math.floor(Math.log(size) / Math.log(1024));
  const adjustedSize = Math.round(size / Math.pow(1024, i));
  const unit = ["B", "KB", "MB", "GB", "TB"][i];
  return `${adjustedSize} ${unit}`;
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ guid)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
function generateId(counts) {
  return counts
    .map((count) => {
    let out = "";
    for (let i = 0; i < count; i++) {
      out += (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
    }
    return out;
  })
    .join("-");
}
const guid = () => generateId([2, 1, 1, 1, 3]);




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



const languageMap = new Map([
  ["ar", "ar"],
  ["bg", "bg"],
  ["bs", "bs"],
  ["ca", "ca"],
  ["cs", "cs"],
  ["da", "da"],
  ["de", "de"],
  ["el", "el"],
  ["en", "en"],
  ["es", "es"],
  ["et", "et"],
  ["fi", "fi"],
  ["fr", "fr"],
  ["he", "he"],
  ["hr", "hr"],
  ["hu", "hu"],
  ["id", "id"],
  ["it", "it"],
  ["ja", "ja"],
  ["ko", "ko"],
  ["lt", "lt"],
  ["lv", "lv"],
  ["nb", "nb"],
  ["nl", "nl"],
  ["pl", "pl"],
  ["pt-br", "pt-BR"],
  ["pt-pt", "pt-PT"],
  ["ro", "ro"],
  ["ru", "ru"],
  ["sk", "sk"],
  ["sl", "sl"],
  ["sr", "sr"],
  ["sv", "sv"],
  ["th", "th"],
  ["tr", "tr"],
  ["uk", "uk"],
  ["vi", "vi"],
  ["zh-cn", "zh-CN"],
  ["zh-hk", "zh-HK"],
  ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
  return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
  const closestWithProp = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
  return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
  rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
  const { api, type, places } = options || {};
  if (api === 4) {
    const [intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
    const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
      places,
      style: type,
      digitSeparator: true
    });
    return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
  }
  const [dojoNumber] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
  return dojoNumber.format(number, {
    type,
    places,
    pattern: options === null || options === void 0 ? void 0 : options.pattern
  });
}
const cache = {};
function formatDate(date) {
  const lang = document.documentElement.lang;
  const dayShortMonthYear = {
    year: "numeric",
    month: "short",
    day: "numeric"
  };
  if (!cache[lang]) {
    cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
  }
  return cache[lang].format(date);
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
  var _a, _b, _c;
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    // "ru-RU" maps to "ru" use case
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
    }
    else {
      return "en";
    }
  }
}
function getComponentClosestLanguageIntl(element) {
  var _a, _b, _c;
  // it's OK if we don't have the 4 letter language file for it
  // 4 letter language code needed for formatting numbers
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      // we support the 2 letter coded language
      // e.g. it-CH vs it
      return lang;
    }
    else {
      return "en";
    }
  }
}
function fetchLocaleStringsForComponent(componentName, locale) {
  return new Promise((resolve, reject) => {
    fetch((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
      if (result.ok)
        resolve(result.json());
      else
        reject();
    }, () => reject());
  });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
  const id = `${componentName}${locale}`;
  if (!stringCache[id]) {
    stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
  }
  return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
  const componentName = tagName || element.tagName.toLowerCase();
  const componentLanguage = getComponentClosestLanguage(element);
  const componentLanguageIntl = getComponentClosestLanguageIntl(element);
  let strings;
  try {
    strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
  }
  catch (e) {
    console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
    strings = await fetchLocaleStringsFromCache(componentName, "en");
  }
  return [strings, componentLanguage, componentLanguageIntl];
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getSignedInUsersGroups),
/* harmony export */   b: () => (/* binding */ getSignedInUsersFavoritesGroup),
/* harmony export */   c: () => (/* binding */ createFolder),
/* harmony export */   d: () => (/* binding */ getFolderFromId),
/* harmony export */   e: () => (/* binding */ getHomeFolderForUser),
/* harmony export */   f: () => (/* binding */ fetchUser),
/* harmony export */   g: () => (/* binding */ getFolders)
/* harmony export */ });
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



async function fetchUser(username, portal) {
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/community/users/${username}`);
}
async function fetchSelf() {
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)()}/community/self`);
}
async function getSignedInUsersGroups() {
  var _a;
  const user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
  if (!user) {
    return [];
  }
  const self = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => fetchSelf(), "communitySelf", user.username);
  return (_a = self === null || self === void 0 ? void 0 : self.groups) !== null && _a !== void 0 ? _a : [];
}
async function getSignedInUsersFavoritesGroup() {
  const user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
  if (!user) {
    return null;
  }
  const self = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => fetchSelf(), "communitySelf", user.username);
  return self.favGroupId;
}
async function getUserContent(portalUser) {
  var _a, _b;
  const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
  const portal = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal;
  (_b = user.userContentUrl) !== null && _b !== void 0 ? _b : (user.userContentUrl = (portal === null || portal === void 0 ? void 0 : portal.restUrl) + "/content/users/" + portalUser.username);
  const response = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(user.userContentUrl, { num: 1 });
  return Promise.resolve(response);
}
async function getFolders(portalUser) {
  var _a;
  const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
  const { folders } = await getUserContent(user);
  const { username } = user;
  // add the home folder as if it's in the list
  return [{ username, id: username, title: username, created: "now" }, ...folders];
}
async function getFolderFromId(folderId, portalUser) {
  var _a;
  const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
  const folders = await getFolders(user);
  return folders.find((folder) => folder.id === folderId);
}
function getHomeFolderForUser(username) {
  return { username, id: username, title: username, created: "now" };
}
async function createFolder(folderName, portalUser) {
  var _a;
  const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
  const url = `${user.userContentUrl}/createFolder`;
  const folderResponse = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { title: folderName }, {}, "post");
  return folderResponse;
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTk2ZDEwMy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzRIO0FBQ3BFO0FBQ2M7QUFDNkI7QUFDbkM7QUFDUTtBQUNEO0FBQ1c7QUFDdkI7QUFDYztBQUNkO0FBQzlCO0FBQ0Y7QUFDUztBQUNEO0FBQ0Q7QUFDRjtBQUNOO0FBQ1E7QUFDTjs7QUFFNUIseUNBQXlDLCtCQUErQixPQUFPLGFBQWEsZ0JBQWdCLDRDQUE0Qzs7QUFFeEo7QUFDQTtBQUNBLElBQUkscURBQWdCO0FBQ3BCLHdDQUF3QyxxREFBVztBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsc0RBQXlCO0FBQ2xEO0FBQ0E7QUFDQSx1RUFBdUUsa0RBQVc7QUFDbEYscUVBQXFFLGtEQUFXO0FBQ2hGLGlFQUFpRSxrREFBVztBQUM1RSwrRUFBK0UsMkRBQW1CO0FBQ2xHLElBQUksMkRBQW1CO0FBQ3ZCLHdCQUF3QiwyREFBbUI7QUFDM0MsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFlBQVksaUJBQWlCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsMERBQWU7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsY0FBYyxHQUFHLGVBQWU7QUFDN0MseUJBQXlCLGVBQWU7QUFDeEMsY0FBYyxxREFBQyw0QkFBNEIsd0ZBQXdGO0FBQ25JLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxZQUFZLHNCQUFzQjtBQUNsQyw0QkFBNEIscURBQUMsb0JBQW9CLGNBQWMsRUFBRSxx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QUNBO0FBQ0E7QUFDQTtBQUNBLGlGQUFpRixrREFBVyx3Q0FBd0Msa0RBQVc7QUFDL0ksVUFBVSxVQUFVO0FBQ3BCLFVBQVUsV0FBVztBQUNyQjtBQUNBLFlBQVkseURBQXlEO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBLGlGQUFpRixrREFBVyx3Q0FBd0Msa0RBQVc7QUFDL0k7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsaUZBQWlGLGtEQUFXLHdDQUF3QyxrREFBVztBQUMvSSxpQkFBaUIsb0JBQW9CO0FBQ3JDLCtCQUErQixzREFBTyxRQUFRLG1CQUFtQixJQUFJO0FBQ3JFO0FBQ0E7O0FBRWlMIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLWNhdGVnb3JpZXMtcGlja2VyXzYuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vY2F0ZWdvcmllcy1lZWIwM2U1YS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9maWxlLWYzNjE5M2U5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2d1aWQtNGY0MTc2YmEuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xvY2FsZS0xM2UwMGE3NS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS91c2VyLWUzZGVkYzRhLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBkIGFzIGdldEVsZW1lbnQsIEYgYXMgRnJhZ21lbnQsIEggYXMgSG9zdCB9IGZyb20gJy4vaW5kZXgtOTJlYmIzOTYuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLWViNWY3ZGMyLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyB9IGZyb20gJy4vbG9jYWxlLTEzZTAwYTc1LmpzJztcbmltcG9ydCB7IGkgYXMgaXRlbVByb3BlcnRpZXNTdGF0ZSwgYSBhcyBpdGVtUHJvcGVydGllc1N0b3JlIH0gZnJvbSAnLi9pdGVtLXByb3BlcnRpZXMtZTY0MTJhOWEuanMnO1xuaW1wb3J0IHsgZiBhcyBmZXRjaENhdGVnb3JpZXMgfSBmcm9tICcuL2NhdGVnb3JpZXMtZWViMDNlNWEuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRGb2xkZXJzLCBjIGFzIGNyZWF0ZUZvbGRlciB9IGZyb20gJy4vdXNlci1lM2RlZGM0YS5qcyc7XG5pbXBvcnQgeyB0IGFzIHRpbWVvdXQsIGQgYXMgZGVib3VuY2UgfSBmcm9tICcuL2Z1bmN0aW9uYWwtYzgyZjVhYjkuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRJdGVtLCBzIGFzIHNlYXJjaEV4aXN0aW5nSXRlbSB9IGZyb20gJy4vc2VydmVyLWl0ZW0tZjEyMTUzZTYuanMnO1xuaW1wb3J0IHsgZiBhcyBmb3JtYXRUYWdzIH0gZnJvbSAnLi9mdW5jdGlvbmFsLTlmNjQ4YmVlLmpzJztcbmltcG9ydCB7IHIgYXMgcmVxdWVzdCwgZyBhcyBnZXRSZXN0QmFzZVVybCB9IGZyb20gJy4vcG9ydGFsLTc5Y2FhZWZmLmpzJztcbmltcG9ydCB7IGEgYXMgc2FuaXRpemVGaWxlTmFtZSB9IGZyb20gJy4vZmlsZS1mMzYxOTNlOS5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtODFkNTQ4YjcuanMnO1xuaW1wb3J0ICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgJy4vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1hYWYzMGJkNi5qcyc7XG5pbXBvcnQgJy4vcHJpdmlsZWdlcy1jY2Q1ZjM3ZC5qcyc7XG5pbXBvcnQgJy4vYWRkLWl0ZW0tOTdkNTc3YTkuanMnO1xuaW1wb3J0ICcuL3VpLWVjZjg2YmJhLmpzJztcbmltcG9ydCAnLi9pdGVtLXR5cGVzLWI0ZmU4NmFkLmpzJztcbmltcG9ydCAnLi9ndWlkLTRmNDE3NmJhLmpzJztcblxuY29uc3QgYXJjZ2lzQ2F0ZWdvcmllc1BpY2tlckNzcyA9IFwiOmhvc3R7LS1hcmNnaXMtbGFiZWwtZm9udC13ZWlnaHQ6NDAwfS5sYWJlbHttYXJnaW4tdG9wOjA7bWFyZ2luLWJvdHRvbTowO2ZvbnQtd2VpZ2h0OnZhcigtLWFyY2dpcy1sYWJlbC1mb250LXdlaWdodCl9XCI7XG5cbmNvbnN0IEFyY2dpc0NhdGVnb3JpZXNQaWNrZXIgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzQ2F0ZWdvcmllc1BpY2tlckNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzQ2F0ZWdvcmllc1BpY2tlckNoYW5nZVwiLCA3KTtcbiAgICB0aGlzLmFwaSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNjYWxlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubGFiZWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jYXRlZ29yaWVzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2NoZW1hID0gW107XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgIGNvbnN0IGxvY2FsZSA9IGF3YWl0IGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3ModGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gbG9jYWxlWzBdO1xuICAgIC8vIEZhbGwgYmFjayB0byBjb25maWcgaWYgbm8gcHJvcHMgcGFzc2VkIGluXG4gICAgKF9hID0gdGhpcy5wb3J0YWwpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6ICh0aGlzLnBvcnRhbCA9IGNvbmZpZ1N0YXRlLnBvcnRhbCk7XG4gICAgKF9iID0gdGhpcy5zY2FsZSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogKHRoaXMuc2NhbGUgPSBjb25maWdTdGF0ZS5zY2FsZSk7XG4gICAgKF9jID0gdGhpcy5hcGkpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6ICh0aGlzLmFwaSA9IGNvbmZpZ1N0YXRlLmFwaSk7XG4gICAgKF9kID0gdGhpcy5jYXRlZ29yaWVzKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiAodGhpcy5jYXRlZ29yaWVzID0gaXRlbVByb3BlcnRpZXNTdGF0ZS5jYXRlZ29yaWVzKTtcbiAgICBpdGVtUHJvcGVydGllc1N0b3JlLm9uKFwicmVzZXRcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5jYXRlZ29yaWVzID0gaXRlbVByb3BlcnRpZXNTdGF0ZS5jYXRlZ29yaWVzO1xuICAgIH0pO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgY29uc3QgeyBwb3J0YWwsIHNjaGVtYSB9ID0gdGhpcztcbiAgICBpZiAocG9ydGFsICYmICEoc2NoZW1hID09PSBudWxsIHx8IHNjaGVtYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2NoZW1hLmxlbmd0aCkpIHtcbiAgICAgIGlmIChwb3J0YWwuY2F0ZWdvcmllcykge1xuICAgICAgICB0aGlzLnNjaGVtYSA9IChfYSA9IHBvcnRhbC5jYXRlZ29yaWVzWzBdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2F0ZWdvcmllcztcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoQ2F0ZWdvcmllcyhwb3J0YWwpO1xuICAgICAgICB0aGlzLnNjaGVtYSA9IChfYyA9IChfYiA9IHJlc3BvbnNlLmNhdGVnb3J5U2NoZW1hKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2JbMF0pID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5jYXRlZ29yaWVzO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICB1cGRhdGVDYXRlZ29yaWVzKCkge1xuICAgIHRoaXMuYXJjZ2lzQ2F0ZWdvcmllc1BpY2tlckNoYW5nZS5lbWl0KHRoaXMuY2F0ZWdvcmllcyk7XG4gIH1cbiAgY2F0ZWdvcmllc1BpY2tlckNoYW5nZUhhbmRsZXIoZXZlbnQpIHtcbiAgICB2YXIgX2E7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgY29uc3QgdmFsdWVzID0gKChfYSA9IHRoaXMuY29tYm9ib3gpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS52YWx1ZSkgfHwgW107XG4gICAgdGhpcy5jYXRlZ29yaWVzID0gQXJyYXkuaXNBcnJheSh2YWx1ZXMpID8gdmFsdWVzIDogW3ZhbHVlc107XG4gIH1cbiAgcmVuZGVyTmVzdGVkQ2F0ZWdvcmllcyhzY2hlbWEsIHByZXZpb3VzVmFsdWUpIHtcbiAgICByZXR1cm4gc2NoZW1hLm1hcCgoY2F0ZWdvcnkpID0+IHtcbiAgICAgIC8vIEtlZXAgYnJlYWRjcnVtYnMgb2YgY2F0ZWdvcmllcycgYW5jZXN0cnlcbiAgICAgIGNvbnN0IHZhbHVlID0gcHJldmlvdXNWYWx1ZVxuICAgICAgICA/IGAke3ByZXZpb3VzVmFsdWV9LyR7Y2F0ZWdvcnkudGl0bGV9YFxuICAgICAgICA6IGAvQ2F0ZWdvcmllcy8ke2NhdGVnb3J5LnRpdGxlfWA7XG4gICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWNvbWJvYm94LWl0ZW1cIiwgeyB2YWx1ZTogdmFsdWUsIHRleHRMYWJlbDogY2F0ZWdvcnkudGl0bGUsIHNlbGVjdGVkOiB0aGlzLmNhdGVnb3JpZXMuaW5kZXhPZih2YWx1ZSkgPj0gMCB9LCBjYXRlZ29yeS5jYXRlZ29yaWVzICYmIHRoaXMucmVuZGVyTmVzdGVkQ2F0ZWdvcmllcyhjYXRlZ29yeS5jYXRlZ29yaWVzLCB2YWx1ZSkpKTtcbiAgICB9KTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgaTE4biwgc2NhbGUsIHNjaGVtYSB9ID0gdGhpcztcbiAgICByZXR1cm4gKHRoaXMuc2NoZW1hICYmIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IHNjYWxlOiBzY2FsZSB9LCBoKFwicFwiLCB7IGNsYXNzOiBcImxhYmVsXCIgfSwgKF9hID0gdGhpcy5sYWJlbCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogaTE4bi5jYXRlZ29yaWVzKSwgaChcImNhbGNpdGUtY29tYm9ib3hcIiwgeyBsYWJlbDogaTE4bi5jYXRlZ29yaWVzLCBtYXhJdGVtczogNSwgc2VsZWN0aW9uTW9kZTogXCJhbmNlc3RvcnNcIiwgcGxhY2Vob2xkZXI6IGkxOG4uYXNzaWduQ2F0ZWdvcmllcywgc2NhbGU6IHNjYWxlLCByZWY6IChlbCkgPT4gKHRoaXMuY29tYm9ib3ggPSBlbCkgfSwgdGhpcy5yZW5kZXJOZXN0ZWRDYXRlZ29yaWVzKHNjaGVtYSkpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICBcImNhdGVnb3JpZXNcIjogW1widXBkYXRlQ2F0ZWdvcmllc1wiXVxuICB9OyB9XG59O1xuQXJjZ2lzQ2F0ZWdvcmllc1BpY2tlci5zdHlsZSA9IGFyY2dpc0NhdGVnb3JpZXNQaWNrZXJDc3M7XG5cbmNvbnN0IGFyY2dpc0ZvbGRlclBpY2tlckNzcyA9IFwiOmhvc3R7LS1hcmNnaXMtbGFiZWwtZm9udC13ZWlnaHQ6NDAwfS5sYWJlbHttYXJnaW4tdG9wOjA7bWFyZ2luLWJvdHRvbTowO2ZvbnQtd2VpZ2h0OnZhcigtLWFyY2dpcy1sYWJlbC1mb250LXdlaWdodCl9LmxhYmVsLS1ib2xkey0tYXJjZ2lzLWxhYmVsLWZvbnQtd2VpZ2h0OjUwMH0uY3JlYXRlLWZvbGRlcnstLWNhbGNpdGUtdWktdGV4dC0xOnZhcigtLWNhbGNpdGUtdWktdGV4dC1saW5rKTstLWNhbGNpdGUtdWktdGV4dC0zOnZhcigtLWNhbGNpdGUtdWktdGV4dC1saW5rKX0uY29tYm9ib3gtd3JhcHBlcntwb3NpdGlvbjpyZWxhdGl2ZX0ucHJvZ3Jlc3N7cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7ei1pbmRleDoxfVwiO1xuXG5jb25zdCBNQVhfVElUTEVfTEVOR1RIJDEgPSAyNTA7XG5jb25zdCBBcmNnaXNGb2xkZXJQaWNrZXIgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzRm9sZGVyUGlja2VyQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNGb2xkZXJQaWNrZXJDaGFuZ2VcIiwgNyk7XG4gICAgdGhpcy5hcmNnaXNGb2xkZXJQaWNrZXJMb2FkID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNGb2xkZXJQaWNrZXJMb2FkXCIsIDcpO1xuICAgIHRoaXMuYXBpID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudXNlciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNjYWxlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubGFiZWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5mb2xkZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5mb2xkZXJzID0gW107XG4gICAgdGhpcy5uZXdGb2xkZXJBY3RpdmUgPSBmYWxzZTtcbiAgICB0aGlzLmVtcHR5RmlsdGVyTGlzdCA9IGZhbHNlO1xuICAgIHRoaXMuZmlsdGVyVGV4dCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm5ld0ZvbGRlcklucHV0ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuY3JlYXRlRm9sZGVyVGV4dCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNob3dFcnJvciA9IGZhbHNlO1xuICAgIHRoaXMuZXJyb3JTdHJpbmcgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5uZXdGb2xkZXJJbnB1dEVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jb21ib2JveEVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2YsIF9nLCBfaDtcbiAgICBjb25zdCBsb2NhbGUgPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuZWwpO1xuICAgIHRoaXMuaTE4biA9IGxvY2FsZVswXTtcbiAgICAvLyBGYWxsIGJhY2sgdG8gY29uZmlnIGlmIG5vIHByb3BzIHBhc3NlZFxuICAgIChfYSA9IHRoaXMucG9ydGFsKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAodGhpcy5wb3J0YWwgPSBjb25maWdTdGF0ZS5wb3J0YWwpO1xuICAgIChfYiA9IHRoaXMudXNlcikgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogKHRoaXMudXNlciA9IGNvbmZpZ1N0YXRlLnVzZXIpO1xuICAgIChfYyA9IHRoaXMuc2NhbGUpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6ICh0aGlzLnNjYWxlID0gY29uZmlnU3RhdGUuc2NhbGUpO1xuICAgIChfZCA9IHRoaXMuYXBpKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiAodGhpcy5hcGkgPSBjb25maWdTdGF0ZS5hcGkpO1xuICAgIChfZSA9IHRoaXMuZm9sZGVyKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiAodGhpcy5mb2xkZXIgPSAoX2cgPSAoX2YgPSBpdGVtUHJvcGVydGllc1N0YXRlLmZvbGRlcikgIT09IG51bGwgJiYgX2YgIT09IHZvaWQgMCA/IF9mIDogY29uZmlnU3RhdGUuaW5pdGlhbEZvbGRlcikgIT09IG51bGwgJiYgX2cgIT09IHZvaWQgMCA/IF9nIDogKF9oID0gdGhpcy5mb2xkZXJzKSA9PT0gbnVsbCB8fCBfaCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2hbMF0pO1xuICAgIHRoaXMuY3JlYXRlRm9sZGVyVGV4dCA9IHRoaXMuaTE4bi5jcmVhdGVOZXdGb2xkZXI7XG4gICAgLy8gYXJjZ2lzLXdvcmtmbG93IFRPRE86IHJlLWluaXRpYWxpemluZyBsb2NhbCBzdGF0ZSBvbiBzdG9yZSByZXNldCBpcyBub3QgY29tcGF0aWJsZSB3aXRoIHRlc3RzXG4gICAgaXRlbVByb3BlcnRpZXNTdG9yZS5vbihcInJlc2V0XCIsICgpID0+IHtcbiAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgdGhpcy5mb2xkZXIgPSAoX2IgPSAoX2EgPSBpdGVtUHJvcGVydGllc1N0YXRlLmZvbGRlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUuaW5pdGlhbEZvbGRlcikgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogKF9jID0gdGhpcy5mb2xkZXJzKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2NbMF07XG4gICAgfSk7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAvLyBPbmx5IGxvYWQgZm9sZGVycyBpZiBlbXB0eVxuICAgIGlmICghdGhpcy5mb2xkZXJzLmxlbmd0aCkge1xuICAgICAgYXdhaXQgdGhpcy5sb2FkRm9sZGVycyh0aGlzLnVzZXIpO1xuICAgIH1cbiAgfVxuICBhc3luYyBoYW5kbGVVc2VyQ2hhbmdlKG5ld1VzZXIsIHByZXZpb3VzVXNlcikge1xuICAgIGlmICghIXByZXZpb3VzVXNlciAmJiBuZXdVc2VyLnVzZXJuYW1lICE9PSBwcmV2aW91c1VzZXIudXNlcm5hbWUpIHtcbiAgICAgIGF3YWl0IHRoaXMubG9hZEZvbGRlcnMobmV3VXNlcik7XG4gICAgICB0aGlzLmZvbGRlciA9IHRoaXMuZ2V0SG9tZUZvbGRlcigpO1xuICAgIH1cbiAgfVxuICBoYW5kbGVGb2xkZXJDaGFuZ2UoKSB7XG4gICAgdGhpcy5hcmNnaXNGb2xkZXJQaWNrZXJDaGFuZ2UuZW1pdCh0aGlzLmZvbGRlcik7XG4gIH1cbiAgYXN5bmMgbG9hZEZvbGRlcnModXNlcikge1xuICAgIHZhciBfYTtcbiAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgIHRoaXMuZm9sZGVycyA9IGF3YWl0IGdldEZvbGRlcnModXNlcik7XG4gICAgdGhpcy5hcmNnaXNGb2xkZXJQaWNrZXJMb2FkLmVtaXQoWy4uLnRoaXMuZm9sZGVyc10pO1xuICAgIGlmICghKChfYSA9IHRoaXMuZm9sZGVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaWQpKSB7XG4gICAgICB0aGlzLmZvbGRlciA9IHRoaXMuZ2V0SG9tZUZvbGRlcigpO1xuICAgIH1cbiAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgfVxuICBnZXRIb21lRm9sZGVyKCkge1xuICAgIHJldHVybiB0aGlzLmZvbGRlcnMuZmluZCgoZm9sZGVyKSA9PiBmb2xkZXIudGl0bGUgPT09IGZvbGRlci5pZCk7XG4gIH1cbiAgc2V0TmV3Rm9sZGVyQWN0aXZlKCkge1xuICAgIHZhciBfYTtcbiAgICAoX2EgPSB0aGlzLm5ld0ZvbGRlcklucHV0RWxlbWVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgaWYgKCF0aGlzLm5ld0ZvbGRlcklucHV0RWxlbWVudCkge1xuICAgICAgdGhpcy5zaG93RXJyb3IgPSBmYWxzZTtcbiAgICAgIHRoaXMubmV3Rm9sZGVySW5wdXQgPSBcIlwiO1xuICAgIH1cbiAgfVxuICBjaGVja0ZvckVtcHR5U3VnZ2VzdGlvbnMoZXZlbnQpIHtcbiAgICB2YXIgX2E7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgY29uc3QgdGV4dCA9IHRoaXMuY29tYm9ib3hFbGVtZW50LnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihcImlucHV0XCIpLnZhbHVlO1xuICAgIGNvbnN0IHsgaTE4biB9ID0gdGhpcztcbiAgICB0aGlzLmVtcHR5RmlsdGVyTGlzdCA9ICgoX2EgPSB0aGlzLmNvbWJvYm94RWxlbWVudC5maWx0ZXJlZEl0ZW1zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSA8PSAxO1xuICAgIHRoaXMuY3JlYXRlRm9sZGVyVGV4dCA9IHRoaXMuZW1wdHlGaWx0ZXJMaXN0XG4gICAgICA/IGkxOG4ubm9Gb2xkZXJzRm91bmRDcmVhdGUucmVwbGFjZShcIiR7Zm9sZGVyfVwiLCB0ZXh0KVxuICAgICAgOiBpMThuLmNyZWF0ZU5ld0ZvbGRlcjtcbiAgICB0aGlzLmZpbHRlclRleHQgPSB0ZXh0O1xuICB9XG4gIGhhbmRsZUNvbWJvYm94Q2hhbmdlKGV2ZW50KSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgY29uc3QgdmFsdWUgPSAoX2EgPSB0aGlzLmNvbWJvYm94RWxlbWVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnZhbHVlO1xuICAgIGlmICh2YWx1ZSA9PT0gXCJjcmVhdGUtZm9sZGVyXCIpIHtcbiAgICAgIHRoaXMuc2hvd0Vycm9yID0gZmFsc2U7XG4gICAgICB0aGlzLmVtcHR5RmlsdGVyTGlzdCA/IHRoaXMuY3JlYXRlTmV3Rm9sZGVyKHRoaXMuZmlsdGVyVGV4dCkgOiAodGhpcy5uZXdGb2xkZXJBY3RpdmUgPSB0cnVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5mb2xkZXIgPVxuICAgICAgKF9jID0gKF9iID0gdGhpcy5mb2xkZXJzLmZpbmQoKGZvbGRlcikgPT4gZm9sZGVyLmlkID09PSB2YWx1ZSkpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IHRoaXMuZm9sZGVyKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiB0aGlzLmdldEhvbWVGb2xkZXIoKTtcbiAgfVxuICBjbG9zZU5ld0ZvbGRlcklucHV0KGV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5uZXdGb2xkZXJBY3RpdmUgPSBmYWxzZTtcbiAgfVxuICAvLyBUT0RPOiBjb252ZXJ0IHRvIFJlc3VsdCwgYWRkIGZvbGRlciBlcnJvcnMgdG8gZXJyb3Igc3RydWN0dXJlXG4gIGFzeW5jIHNhdmVBY3RpdmVGb2xkZXIoKSB7XG4gICAgaWYgKCF0aGlzLm5ld0ZvbGRlckFjdGl2ZSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmNyZWF0ZU5ld0ZvbGRlcih0aGlzLm5ld0ZvbGRlcklucHV0KTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiB0aGlzLmVycm9yU3RyaW5nO1xuICAgIH1cbiAgICByZXR1cm4gIXRoaXMuc2hvd0Vycm9yO1xuICB9XG4gIGFzeW5jIGNyZWF0ZU5ld0ZvbGRlcihmb2xkZXJOYW1lKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHRpdGxlID0gZm9sZGVyTmFtZS50cmltKCk7XG4gICAgY29uc3QgeyBpMThuLCB1c2VyIH0gPSB0aGlzO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGZvbGRlciB9ID0gYXdhaXQgY3JlYXRlRm9sZGVyKHRpdGxlLCB1c2VyKTtcbiAgICAgIHRoaXMuZm9sZGVyID0gZm9sZGVyO1xuICAgICAgdGhpcy5mb2xkZXJzID0gW3RoaXMuZm9sZGVyLCAuLi50aGlzLmZvbGRlcnNdO1xuICAgICAgLy8gVE9ETzogUmVtb3ZlL21vdmUgY29uZmlnU3RhdGUuZm9sZGVycz8gTGVmdG92ZXIgZnJvbSBpbml0aWFsIHRlbGVtZXRyeSBwYXNzLCBtYXkgbm90IGJlIHByb3Blcmx5IHV0aWxpemVkIGFueW1vcmVcbiAgICAgIGNvbmZpZ1N0YXRlLmZvbGRlcnMgPSB0aGlzLmZvbGRlcnM7XG4gICAgICB0aGlzLm5ld0ZvbGRlckFjdGl2ZSA9IGZhbHNlO1xuICAgICAgdGhpcy5zaG93RXJyb3IgPSBmYWxzZTtcbiAgICAgIC8vIGZvciBzb21lIHJlYXNvbiwgc29tZXRpbWVzIHRoZSBjb21ib2JveCBkb2Vzbid0IHBpY2sgdXAgdGhlIGNoYW5nZSwgc28gbWFrZSBzdXJlIHRoZSBuZXcgZm9sZGVyIGlzIHNlbGVjdGVkXG4gICAgICBhd2FpdCB0aW1lb3V0KDEwMCk7XG4gICAgICBjb25zdCBzZWxlY3RlZEl0ZW0gPSAoX2EgPSB0aGlzLmVsLnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5xdWVyeVNlbGVjdG9yKGBjYWxjaXRlLWNvbWJvYm94LWl0ZW1bZGF0YS1pZD1cIiR7dGhpcy5mb2xkZXIuaWR9XCJdYCk7XG4gICAgICBpZiAoc2VsZWN0ZWRJdGVtKSB7XG4gICAgICAgIHNlbGVjdGVkSXRlbS5zZWxlY3RlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gSWRlbnRpZnkgd2hpY2ggZXJyb3Igb2NjdXJyZWRcbiAgICAgIC8vIFRPRE86IFJlcG9ydCB2aWEgQXBwQ29tcG9uZW50RXJyb3JDb2RlXG4gICAgICBpZiAoIXRpdGxlIHx8ICh0aXRsZSA9PT0gbnVsbCB8fCB0aXRsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGl0bGUubGVuZ3RoKSA8PSAwKSB7XG4gICAgICAgIHRoaXMuZXJyb3JTdHJpbmcgPSBpMThuLmVycm9yLm5vTmFtZTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHRoaXMuZm9sZGVycy5tYXAoKGZvbGRlcikgPT4gZm9sZGVyLnRpdGxlKS5pbmNsdWRlcyh0aXRsZSkpIHtcbiAgICAgICAgdGhpcy5lcnJvclN0cmluZyA9IGkxOG4uZXJyb3IuZm9sZGVyQWxyZWFkeUV4aXN0cy5yZXBsYWNlKFwiJHtmb2xkZXJ9XCIsIHRpdGxlKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHRpdGxlLmluZGV4T2YoXCI+XCIpID49IDAgfHwgdGl0bGUuaW5kZXhPZihcIjxcIikgPj0gMCkge1xuICAgICAgICB0aGlzLmVycm9yU3RyaW5nID0gaTE4bi5lcnJvci5pbnZhbGlkQ2hhcmFjdGVycztcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgdGhpcy5lcnJvclN0cmluZyA9IGVycm9yLm1lc3NhZ2U7XG4gICAgICB9XG4gICAgICB0aGlzLnNob3dFcnJvciA9IHRydWU7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB7IGkxOG4sIHNjYWxlIH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyBzY2FsZTogc2NhbGUsIGNsYXNzOiBcImlucHV0LWhlaWdodFwiIH0sIGgoXCJwXCIsIHsgY2xhc3M6IFwibGFiZWxcIiB9LCAoX2EgPSB0aGlzLmxhYmVsKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBpMThuLmZvbGRlciksIGgoXCJkaXZcIiwgbnVsbCwgdGhpcy5uZXdGb2xkZXJBY3RpdmUgPyAoaChcImNhbGNpdGUtaW5saW5lLWVkaXRhYmxlXCIsIHsgY29udHJvbHM6IHRydWUsIFwiZWRpdGluZy1lbmFibGVkXCI6IHRydWUsIGFmdGVyQ29uZmlybTogYXN5bmMgKCkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5jcmVhdGVOZXdGb2xkZXIodGhpcy5uZXdGb2xkZXJJbnB1dCk7XG4gICAgICAgICAgdGhpcy5uZXdGb2xkZXJBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAoX2EgPSB0aGlzLm5ld0ZvbGRlcklucHV0RWxlbWVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIH0sIHNjYWxlOiBzY2FsZSB9LCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHBsYWNlaG9sZGVyOiBpMThuLmVudGVyRm9sZGVyLCB2YWx1ZTogdGhpcy5uZXdGb2xkZXJJbnB1dCwgbWF4TGVuZ3RoOiBNQVhfVElUTEVfTEVOR1RIJDEsIHNjYWxlOiBzY2FsZSwgb25DYWxjaXRlSW5wdXRJbnB1dDogKGV2ZW50KSA9PiAodGhpcy5uZXdGb2xkZXJJbnB1dCA9IGV2ZW50LnRhcmdldC52YWx1ZSksIG9uS2V5RG93bjogKGUpID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5zaG93RXJyb3IgPSBmYWxzZTtcbiAgICAgICAgc3dpdGNoIChlLmtleSkge1xuICAgICAgICAgIGNhc2UgXCJFbnRlclwiOlxuICAgICAgICAgICAgdGhpcy5jcmVhdGVOZXdGb2xkZXIodGhpcy5uZXdGb2xkZXJJbnB1dCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiRXNjYXBlXCI6XG4gICAgICAgICAgICB0aGlzLm5ld0ZvbGRlckFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zaG93RXJyb3IgPSBmYWxzZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9LCByZWY6IChlbGVtZW50KSA9PiAodGhpcy5uZXdGb2xkZXJJbnB1dEVsZW1lbnQgPSBlbGVtZW50KSwgc3RhdHVzOiB0aGlzLnNob3dFcnJvciA/IFwiaW52YWxpZFwiIDogXCJpZGxlXCIgfSkpKSA6IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29tYm9ib3gtd3JhcHBlclwiIH0sIHRoaXMubG9hZGluZyAmJiBoKFwiY2FsY2l0ZS1wcm9ncmVzc1wiLCB7IHR5cGU6IFwiaW5kZXRlcm1pbmF0ZVwiLCBjbGFzczogXCJwcm9ncmVzc1wiIH0pLCBoKFwiY2FsY2l0ZS1jb21ib2JveFwiLCB7IGxhYmVsOiBpMThuLmZvbGRlciwgc2VsZWN0aW9uTW9kZTogXCJzaW5nbGVcIiwgbWF4SXRlbXM6IDUsIHBsYWNlaG9sZGVyOiB0aGlzLmxvYWRpbmcgPyBpMThuLmxvYWRpbmcgOiBpMThuLnNlYXJjaEZvbGRlcnMsIHNjYWxlOiBzY2FsZSwgcmVmOiAoZWxlbWVudCkgPT4gKHRoaXMuY29tYm9ib3hFbGVtZW50ID0gZWxlbWVudCksIGRpc2FibGVkOiB0aGlzLmxvYWRpbmcsIGNsZWFyRGlzYWJsZWQ6IHRydWUsIG9uQ2FsY2l0ZUNvbWJvYm94Q2hhbmdlOiAoZXZlbnQpID0+IHRoaXMuaGFuZGxlQ29tYm9ib3hDaGFuZ2UoZXZlbnQpLCBvbkNhbGNpdGVDb21ib2JveEJlZm9yZUNsb3NlOiAoKSA9PiB7XG4gICAgICAgIC8vIENhbGNpdGUgQ29tYm9ib3ggd29ya2Fyb3VuZDogZm9sZGVyIHBpY2tlciBzaG91bGQgYWx3YXlzIGhhdmUgYW4gb3B0aW9uIHNlbGVjdGVkIC0gcmVzZXQgZm9sZGVyIHRvIHByZXZpb3VzIGlmIHNlbGVjdGVkIGZvbGRlciBpcyBlbXB0eVxuICAgICAgICBpZiAoIXRoaXMuY29tYm9ib3hFbGVtZW50LnNlbGVjdGVkSXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgdGhpcy5jb21ib2JveEVsZW1lbnQudmFsdWUgPSB0aGlzLmZvbGRlci5pZDtcbiAgICAgICAgfVxuICAgICAgfSB9LCAhdGhpcy5sb2FkaW5nICYmIChoKEZyYWdtZW50LCBudWxsLCB0aGlzLnVzZXIgJiYgKGgoXCJjYWxjaXRlLWNvbWJvYm94LWl0ZW1cIiwgeyBjbGFzczogXCJjcmVhdGUtZm9sZGVyXCIsIHZhbHVlOiBcImNyZWF0ZS1mb2xkZXJcIiwgdGV4dExhYmVsOiB0aGlzLmNyZWF0ZUZvbGRlclRleHQsIHNlbGVjdGVkOiBmYWxzZSwgaWNvbjogXCJmb2xkZXItcGx1c1wiLCBmaWx0ZXJEaXNhYmxlZDogdHJ1ZSB9KSksIHRoaXMuZm9sZGVycy5tYXAoKHsgaWQsIHVzZXJuYW1lLCB0aXRsZSB9KSA9PiB7XG4gICAgICAvLyBGYWxsIGJhY2sgdG8gdXNlcidzIGhvbWUgZm9sZGVyIGlmIGN1cnJlbnQgZm9sZGVyIGlzbid0IGZvdW5kIC0gaW52YWxpZCwgZGVsZXRlZCwgZXRjLlxuICAgICAgY29uc3Qgc2VsZWN0ZWRGb2xkZXIgPSB0aGlzLmZvbGRlcnNcbiAgICAgICAgLm1hcCgoZm9sZGVyKSA9PiBmb2xkZXIuaWQpXG4gICAgICAgIC5pbmNsdWRlcyh0aGlzLmZvbGRlci5pZClcbiAgICAgICAgPyB0aGlzLmZvbGRlclxuICAgICAgICA6IHRoaXMuZ2V0SG9tZUZvbGRlcigpO1xuICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1jb21ib2JveC1pdGVtXCIsIHsgXCJkYXRhLWlkXCI6IGlkLCB2YWx1ZTogaWQsIHRleHRMYWJlbDogdGl0bGUsIHNlbGVjdGVkOiAoc2VsZWN0ZWRGb2xkZXIgPT09IG51bGwgfHwgc2VsZWN0ZWRGb2xkZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdGVkRm9sZGVyLmlkKSAhPT0gXCJhbGxcIlxuICAgICAgICAgID8gaWQgPT09IChzZWxlY3RlZEZvbGRlciA9PT0gbnVsbCB8fCBzZWxlY3RlZEZvbGRlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0ZWRGb2xkZXIuaWQpXG4gICAgICAgICAgOiBpZCA9PT0gdXNlcm5hbWUsIGljb246IGlkID09PSB1c2VybmFtZSA/IFwiaG9tZVwiIDogXCJmb2xkZXJcIiB9KSk7XG4gICAgfSkpKSkpKSksIGgoXCJjYWxjaXRlLWlucHV0LW1lc3NhZ2VcIiwgeyBzdGF0dXM6IFwiaW52YWxpZFwiLCBoaWRkZW46ICF0aGlzLnNob3dFcnJvciwgaWNvbjogdGhpcy5zaG93RXJyb3IsIHNjYWxlOiBzY2FsZSB9LCB0aGlzLmVycm9yU3RyaW5nKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICBcInVzZXJcIjogW1wiaGFuZGxlVXNlckNoYW5nZVwiXSxcbiAgICBcImZvbGRlclwiOiBbXCJoYW5kbGVGb2xkZXJDaGFuZ2VcIl0sXG4gICAgXCJuZXdGb2xkZXJJbnB1dEVsZW1lbnRcIjogW1wic2V0TmV3Rm9sZGVyQWN0aXZlXCJdXG4gIH07IH1cbn07XG5BcmNnaXNGb2xkZXJQaWNrZXIuc3R5bGUgPSBhcmNnaXNGb2xkZXJQaWNrZXJDc3M7XG5cbnZhciBpdGVtUHJvcGVydGllc0V2ZW50O1xuKGZ1bmN0aW9uIChpdGVtUHJvcGVydGllc0V2ZW50KSB7XG4gIGl0ZW1Qcm9wZXJ0aWVzRXZlbnRbXCJhcmNnaXNUaXRsZUlucHV0Q2hhbmdlXCJdID0gXCJ0aXRsZVwiO1xuICBpdGVtUHJvcGVydGllc0V2ZW50W1wiYXJjZ2lzRm9sZGVyUGlja2VyQ2hhbmdlXCJdID0gXCJmb2xkZXJcIjtcbiAgaXRlbVByb3BlcnRpZXNFdmVudFtcImFyY2dpc1N1bW1hcnlJbnB1dENoYW5nZVwiXSA9IFwic25pcHBldFwiO1xuICBpdGVtUHJvcGVydGllc0V2ZW50W1wiYXJjZ2lzVGFnc1BpY2tlckNoYW5nZVwiXSA9IFwidGFnc1wiO1xuICBpdGVtUHJvcGVydGllc0V2ZW50W1wiYXJjZ2lzQ2F0ZWdvcmllc1BpY2tlckNoYW5nZVwiXSA9IFwiY2F0ZWdvcmllc1wiO1xufSkoaXRlbVByb3BlcnRpZXNFdmVudCB8fCAoaXRlbVByb3BlcnRpZXNFdmVudCA9IHt9KSk7XG5jb25zdCBBcmNnaXNJdGVtUHJvcGVydGllcyA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNJdGVtUHJvcGVydGllc0NoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbVByb3BlcnRpZXNDaGFuZ2VcIiwgNyk7XG4gICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy51c2VyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuYXBpID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuY29uZmlnID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaXRlbUlkID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudHlwZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNjYWxlID0gdW5kZWZpbmVkO1xuICB9XG4gIC8qKlxuICAgKiBNYW51YWxseSByZXNldCBzdGF0ZVxuICAgKi9cbiAgYXN5bmMgcmVzZXRJdGVtUHJvcGVydGllc1N0b3JlKCkge1xuICAgIGl0ZW1Qcm9wZXJ0aWVzU3RvcmUucmVzZXQoKTtcbiAgfVxuICAvLyBJZiBhbnkgcHJvcCBjaGFuZ2VzLCB1cGRhdGUgdGhlIHN0b3JlIGFuZCBlbWl0IHRoZSBjdXJyZW50IGl0ZW1Qcm9wZXJ0aWVzU3RhdGVcbiAgaGFuZGxlSXRlbVByb3BlcnRpZXNDaGFuZ2UoZXZlbnQpIHtcbiAgICBjb25zdCB7IGRldGFpbCwgdHlwZSB9ID0gZXZlbnQ7XG4gICAgaXRlbVByb3BlcnRpZXNTdGF0ZVtpdGVtUHJvcGVydGllc0V2ZW50W3R5cGVdXSA9IGRldGFpbDtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Qcm9wZXJ0aWVzQ2hhbmdlLmVtaXQoT2JqZWN0LmFzc2lnbih7fSwgaXRlbVByb3BlcnRpZXNTdGF0ZSkpO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgLy8gUHJpb3JpdGl6ZSBwcm9wcyBvdmVyIGV4aXN0aW5nIHN0b3JlIHZhbHVlc1xuICAgIGlmICh0aGlzLnBvcnRhbCkge1xuICAgICAgY29uZmlnU3RhdGUucG9ydGFsID0gdGhpcy5wb3J0YWw7XG4gICAgfVxuICAgIGlmICh0aGlzLnVzZXIpIHtcbiAgICAgIGNvbmZpZ1N0YXRlLnVzZXIgPSB0aGlzLnVzZXI7XG4gICAgfVxuICAgIGlmICh0aGlzLmFwaSkge1xuICAgICAgY29uZmlnU3RhdGUuYXBpID0gdGhpcy5hcGk7XG4gICAgfVxuICAgIGlmICh0aGlzLmNvbmZpZykge1xuICAgICAgY29uZmlnU3RhdGUuY29uZmlnID0gdGhpcy5jb25maWc7XG4gICAgfVxuICAgIGlmICh0aGlzLml0ZW1JZCkge1xuICAgICAgKHsgcmVzdWx0OiBpdGVtUHJvcGVydGllc1N0YXRlLml0ZW0gfSA9IGF3YWl0IGdldEl0ZW0odGhpcy5pdGVtSWQsIHRoaXMucG9ydGFsKSk7XG4gICAgfVxuICAgIGlmICh0aGlzLnR5cGUpIHtcbiAgICAgIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudHlwZSA9IChfYSA9IHRoaXMudHlwZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9iID0gaXRlbVByb3BlcnRpZXNTdGF0ZS5pdGVtKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudHlwZTtcbiAgICB9XG4gICAgaWYgKHRoaXMuc2NhbGUpIHtcbiAgICAgIGNvbmZpZ1N0YXRlLnNjYWxlID0gdGhpcy5zY2FsZTtcbiAgICB9XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwic2xvdFwiLCBudWxsKSkpO1xuICB9XG4gIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgIGl0ZW1Qcm9wZXJ0aWVzU3RvcmUucmVzZXQoKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBhcmNnaXNTdW1tYXJ5SW5wdXRDc3MgPSBcIjpob3N0ey0tYXJjZ2lzLWxhYmVsLWZvbnQtd2VpZ2h0OjQwMDstLWFyY2dpcy1sYWJlbC1tYXJnaW4tYm90dG9tOjFyZW19LmNvbnRhaW5lci1ze21hcmdpbi1ib3R0b206MC41cmVtfS5jb250YWluZXItbXttYXJnaW4tYm90dG9tOjAuNzVyZW19LmNvbnRhaW5lci1se21hcmdpbi1ib3R0b206MXJlbX0ubGFiZWx7LS1jYWxjaXRlLWxhYmVsLW1hcmdpbi1ib3R0b206MH0ubGFiZWwtdGV4dHttYXJnaW4tdG9wOjA7bWFyZ2luLWJvdHRvbTowO2ZvbnQtd2VpZ2h0OnZhcigtLWFyY2dpcy1sYWJlbC1mb250LXdlaWdodCl9LmxhYmVsLS1ib2xkey0tYXJjZ2lzLWxhYmVsLWZvbnQtd2VpZ2h0OjUwMH1jYWxjaXRlLWlucHV0ey0tY2FsY2l0ZS11aS1ib3JkZXItMTp2YXIoLS1jYWxjaXRlLXVpLWJvcmRlci1pbnB1dCl9LmNvdW50e2ZvbnQtc2l6ZTowLjc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0xKTtvcGFjaXR5OjAuNzV9LnNjcmVlbi1yZWFkZXJzLW9ubHl7cG9zaXRpb246YWJzb2x1dGU7d2lkdGg6MXB4O2hlaWdodDoxcHg7cGFkZGluZzowO21hcmdpbjotMXB4O292ZXJmbG93OmhpZGRlbjtjbGlwOnJlY3QoMCwgMCwgMCwgMCk7d2hpdGUtc3BhY2U6bm93cmFwO2JvcmRlci13aWR0aDowfVwiO1xuXG4vLyBUYWtlbiBmcm9tIGh0dHBzOi8vZGV2ZWxvcGVycy5hcmNnaXMuY29tL3Jlc3QvdXNlcnMtZ3JvdXBzLWFuZC1pdGVtcy91cGRhdGUtaXRlbS5odG1cbmNvbnN0IE1BWF9DSEFSQUNURVIgPSAyMDQ4O1xuY29uc3QgQXJjZ2lzU3VtbWFyeUlucHV0ID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc1N1bW1hcnlJbnB1dENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU3VtbWFyeUlucHV0Q2hhbmdlXCIsIDcpO1xuICAgIHRoaXMudXBkYXRlTGl2ZVJlZ2lvbiA9IGRlYm91bmNlKChzdW1tYXJ5KSA9PiB7XG4gICAgICB0aGlzLmxpdmVSZWdpb25UZXh0ID0gdGhpcy5nZXRDaGFyYWN0ZXJzVGV4dChzdW1tYXJ5KTtcbiAgICB9LCAxNTAwKTtcbiAgICB0aGlzLnNjYWxlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubGFiZWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zdW1tYXJ5ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubGl2ZVJlZ2lvblRleHQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy52YWxpZCA9IHRydWU7XG4gIH1cbiAgYXN5bmMgZ2V0RXJyb3JNZXNzYWdlKCkge1xuICAgIGlmICghdGhpcy52YWxpZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29kZTogXCJzdW1tYXJ5SW52YWxpZFwiLFxuICAgICAgICB0cmFuc2xhdGVkTWVzc2FnZTogdGhpcy5pMThuLmludmFsaWRcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgY29uc3QgbG9jYWxlID0gYXdhaXQgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyh0aGlzLmVsKTtcbiAgICB0aGlzLmkxOG4gPSBsb2NhbGVbMF07XG4gICAgLy8gRG8gbm90IG92ZXJyaWRlIGNvbmZpZ1N0YXRlIHNjYWxlIGZvciBpbmRpdmlkdWFsIGNvbXBvbmVudHNcbiAgICAoX2EgPSB0aGlzLnNjYWxlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAodGhpcy5zY2FsZSA9IGNvbmZpZ1N0YXRlLnNjYWxlKTtcbiAgICAoX2IgPSB0aGlzLnN1bW1hcnkpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6ICh0aGlzLnN1bW1hcnkgPSBpdGVtUHJvcGVydGllc1N0YXRlLnNuaXBwZXQpO1xuICAgIHRoaXMubGl2ZVJlZ2lvblRleHQgPSB0aGlzLmdldENoYXJhY3RlcnNUZXh0KHRoaXMuc3VtbWFyeSk7XG4gICAgLy8gYXJjZ2lzLXdvcmtmbG93IFRPRE86IHJlLWluaXRpYWxpemluZyBsb2NhbCBzdGF0ZSBvbiBzdG9yZSByZXNldCBpcyBub3QgY29tcGF0aWJsZSB3aXRoIHRlc3RzXG4gICAgaXRlbVByb3BlcnRpZXNTdG9yZS5vbihcInJlc2V0XCIsICgpID0+IHtcbiAgICAgIHRoaXMuc3VtbWFyeSA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuc25pcHBldDtcbiAgICB9KTtcbiAgfVxuICBjb21wb25lbnREaWRSZW5kZXIoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBjYWxjaXRlLWlucHV0IHN1cHBvcnQgcmVzaXplPVwidmVydGljYWxcIiBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWRlc2lnbi1zeXN0ZW0vdHJlZS9tYWluL3BhY2thZ2VzL2NhbGNpdGUtY29tcG9uZW50cy9zcmMvY29tcG9uZW50cy9pbnB1dFxuICAgIGNvbnN0IHRleHRBcmVhID0gKF9jID0gKF9iID0gKF9hID0gdGhpcy5lbC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucXVlcnlTZWxlY3RvcihcImNhbGNpdGUtaW5wdXRcIikpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MucXVlcnlTZWxlY3RvcihcInRleHRhcmVhXCIpO1xuICAgIHRleHRBcmVhICYmICh0ZXh0QXJlYS5zdHlsZS5yZXNpemUgPSBcInZlcnRpY2FsXCIpO1xuICB9XG4gIGdldENoYXJhY3RlcnNUZXh0KHN1bW1hcnkpIHtcbiAgICByZXR1cm4gdGhpcy5pMThuLmNoYXJhY3RlcnNMZWZ0LnJlcGxhY2UoXCIke251bX1cIiwgYCR7TUFYX0NIQVJBQ1RFUiAtIHN1bW1hcnkubGVuZ3RofWApO1xuICB9XG4gIHZhbGlkYXRlKCkge1xuICAgIHRoaXMudmFsaWQgPSAhLz58PC8udGVzdCh0aGlzLnN1bW1hcnkpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGkxOG4sIHN1bW1hcnksIGxhYmVsLCBzY2FsZSwgbGl2ZVJlZ2lvblRleHQsIHZhbGlkIH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBgY29udGFpbmVyLSR7c2NhbGV9YCB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IHNjYWxlOiBzY2FsZSwgY2xhc3M6IFwibGFiZWxcIiB9LCBoKFwicFwiLCB7IGNsYXNzOiBcImxhYmVsLXRleHRcIiB9LCBsYWJlbCAhPT0gbnVsbCAmJiBsYWJlbCAhPT0gdm9pZCAwID8gbGFiZWwgOiBpMThuLnN1bW1hcnkpLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHR5cGU6IFwidGV4dGFyZWFcIiwgaWQ6IFwic3VtbWFyeS1pbnB1dFwiLCBwbGFjZWhvbGRlcjogaTE4bi5hZGRTdW1tYXJ5LCB2YWx1ZTogc3VtbWFyeSwgbWF4TGVuZ3RoOiBNQVhfQ0hBUkFDVEVSLCBzY2FsZTogc2NhbGUsIHN0YXR1czogdmFsaWQgPyBcImlkbGVcIiA6IFwiaW52YWxpZFwiLCBvbkNhbGNpdGVJbnB1dElucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIHRoaXMuc3VtbWFyeSA9IG5vZGUudmFsdWU7XG4gICAgICAgIHRoaXMuYXJjZ2lzU3VtbWFyeUlucHV0Q2hhbmdlLmVtaXQodGhpcy5zdW1tYXJ5KTtcbiAgICAgICAgdGhpcy51cGRhdGVMaXZlUmVnaW9uKG5vZGUudmFsdWUpO1xuICAgICAgICB0aGlzLnZhbGlkYXRlKCk7XG4gICAgICB9IH0pLCBoKFwiY2FsY2l0ZS1pbnB1dC1tZXNzYWdlXCIsIHsgaGlkZGVuOiB2YWxpZCwgaWNvbjogdHJ1ZSwgc2NhbGU6IHNjYWxlLCBzdGF0dXM6IHZhbGlkID8gXCJpZGxlXCIgOiBcImludmFsaWRcIiB9LCBpMThuLmludmFsaWQpLCBoKFwic3BhblwiLCB7IGNsYXNzOiBcInNjcmVlbi1yZWFkZXJzLW9ubHlcIiwgXCJhcmlhLWxpdmVcIjogXCJwb2xpdGVcIiB9LCBsaXZlUmVnaW9uVGV4dCkpLCB2YWxpZCAmJiAoaChcInNwYW5cIiwgeyBjbGFzczogXCJjb3VudFwiLCBcImFyaWEtaGlkZGVuXCI6IFwidHJ1ZVwiIH0sIHRoaXMuZ2V0Q2hhcmFjdGVyc1RleHQoc3VtbWFyeSkpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTdW1tYXJ5SW5wdXQuc3R5bGUgPSBhcmNnaXNTdW1tYXJ5SW5wdXRDc3M7XG5cbi8qKlxuICogR2l2ZW4gYSBwdWJsaXNoYWJsZSB0eXBlLCBmaW5kIHdoYXQgdHlwZSB0aGUgcmVzdWx0aW5nIHB1Ymxpc2hlZCBpdGVtIHdpbGwgYmVcbiAqL1xuZnVuY3Rpb24gZmluZFB1Ymxpc2hUeXBlKHR5cGUpIHtcbiAgc3dpdGNoICh0eXBlKSB7XG4gICAgY2FzZSBcIkNTVlwiOlxuICAgIGNhc2UgXCJNaWNyb3NvZnQgRXhjZWxcIjpcbiAgICBjYXNlIFwiR2VvSnNvblwiOlxuICAgIGNhc2UgXCJTaGFwZWZpbGVcIjpcbiAgICBjYXNlIFwiRmlsZSBHZW9kYXRhYmFzZVwiOlxuICAgIGNhc2UgXCJJbWFnZSBDb2xsZWN0aW9uXCI6XG4gICAgY2FzZSBcIkdlb1BhY2thZ2VcIjpcbiAgICBjYXNlIFwiU2VydmljZSBEZWZpbml0aW9uXCI6XG4gICAgICByZXR1cm4gXCJGZWF0dXJlIFNlcnZpY2VcIjtcbiAgICBjYXNlIFwiVGlsZSBQYWNrYWdlXCI6XG4gICAgICByZXR1cm4gXCJNYXAgU2VydmljZVwiO1xuICAgIGNhc2UgXCJWZWN0b3IgVGlsZSBQYWNrYWdlXCI6XG4gICAgICByZXR1cm4gXCJWZWN0b3IgVGlsZSBTZXJ2aWNlXCI7XG4gICAgY2FzZSBcIlNjZW5lIFBhY2thZ2VcIjpcbiAgICAgIHJldHVybiBcIlNjZW5lIFNlcnZpY2VcIjtcbiAgICBjYXNlIFwiM0RUaWxlcyBQYWNrYWdlXCI6XG4gICAgICByZXR1cm4gXCIzRFRpbGVzIFNlcnZpY2VcIjtcbiAgfVxuICByZXR1cm4gdHlwZTtcbn1cbi8qKlxuICogQ2hlY2sgaWYgYSB0aXRsZSBpcyB2YWxpZCBhbmQgdW5pcXVlXG4gKi9cbmNvbnN0IE1BWF9QVUJMSVNIX1NFUlZJQ0VfTkFNRSA9IDkwO1xuY29uc3QgTUFYX0RBVEFfU1RPUkVfVElUTEUgPSA5MDtcbmNvbnN0IE1BWF9USVRMRV9MRU5HVEggPSAyNTA7XG5hc3luYyBmdW5jdGlvbiB2YWxpZGF0ZVRpdGxlKHsgcG9ydGFsLCB1c2VyLCB0aXRsZSwgaXRlbVR5cGUsIGZvbGRlciwgZXh0ZW5zaW9uLCBlbmFibGVQdWJsaXNoaW5nID0gZmFsc2UsIHVwZGF0ZSA9IGZhbHNlIH0pIHtcbiAgaWYgKCF1c2VyIHx8ICFwb3J0YWwpIHtcbiAgICByZXR1cm4geyBjb2RlOiBcIm1pc3NpbmdVc2VyT3JQb3J0YWxcIiB9O1xuICB9XG4gIGlmICghdGl0bGUgfHwgdGl0bGUubGVuZ3RoIDw9IDApIHtcbiAgICByZXR1cm4geyBjb2RlOiBcInRpdGxlUmVxdWlyZWRcIiB9O1xuICB9XG4gIC8vIGZvciBkYXRhIHN0b3JlIGl0ZW1zLCBvbmx5IGFscGhhbnVtZXJpYyBhbmQgdW5kZXJzY29yZXMgc2hvdWxkIGJlIGFsbG93ZWRcbiAgY29uc3QgZGF0YVN0b3JlTmFtZUludmFsaWRDaGFyYWN0ZXJSZWdFeHAgPSAvW1xccy5AfmAhIyQlXFxeJiorPVxcLVxcW1xcXVxcXFwnOyxcXC97fXxcXFxcXCI6PD5cXD9dL2c7XG4gIGlmIChpdGVtVHlwZSA9PT0gXCJEYXRhIFN0b3JlXCIgJiZcbiAgICAoZGF0YVN0b3JlTmFtZUludmFsaWRDaGFyYWN0ZXJSZWdFeHAudGVzdCh0aXRsZSkgfHwgdGl0bGUubGVuZ3RoID4gTUFYX0RBVEFfU1RPUkVfVElUTEUpKSB7XG4gICAgcmV0dXJuIHsgY29kZTogXCJkYXRhU3RvcmVUaXRsZUludmFsaWRcIiB9O1xuICB9XG4gIC8vIGZvciBub24gcHVibGlzaGFibGUgaXRlbXMsIHRoZSBvbmx5IGNoYXJhY3RlcnMgdGhhdCBhcmVudCBhbGxvd2VkIGFyZSA8IGFuZCA+XG4gIGNvbnN0IGl0ZW1OYW1lQ2hhcmFjdGVyUmVnRXhwID0gLzx8Pi9naTtcbiAgaWYgKCFlbmFibGVQdWJsaXNoaW5nICYmIChpdGVtTmFtZUNoYXJhY3RlclJlZ0V4cC50ZXN0KHRpdGxlKSB8fCB0aXRsZS5sZW5ndGggPiBNQVhfVElUTEVfTEVOR1RIKSkge1xuICAgIHJldHVybiB7IGNvZGU6IFwidGl0bGVJbnZhbGlkXCIgfTtcbiAgfVxuICAvLyBmb3IgcHVibGlzaGFibGUgaXRlbXMsIG9ubHkgYWxwaGFudW1lcmljIGFuZCB1bmRlcnNjb3JlcyBzaG91bGQgYmUgYWxsb3dlZFxuICBjb25zdCBzZXJ2aWNlTmFtZUludmFsaWRDaGFyYWN0ZXJSZWdFeHAgPSAvWy5AfmAhIyQlXFxeJiorPVxcLVxcW1xcXVxcXFwnOyxcXC97fXxcXFxcXCI6PD5cXD9dL2c7XG4gIGlmIChlbmFibGVQdWJsaXNoaW5nICYmIChzZXJ2aWNlTmFtZUludmFsaWRDaGFyYWN0ZXJSZWdFeHAudGVzdCh0aXRsZSkgfHwgdGl0bGUubGVuZ3RoID4gTUFYX1BVQkxJU0hfU0VSVklDRV9OQU1FKSkge1xuICAgIHJldHVybiB7IGNvZGU6IFwic2VydmljZU5hbWVJbnZhbGlkXCIgfTtcbiAgfVxuICBjb25zdCBwdWJsaXNoZWRJdGVtVHlwZSA9IGVuYWJsZVB1Ymxpc2hpbmcgPyBmaW5kUHVibGlzaFR5cGUoaXRlbVR5cGUpIDogaXRlbVR5cGU7XG4gIGNvbnN0IHsgaXRlbVVSTExpc3QgfSA9IChhd2FpdCBzZWFyY2hFeGlzdGluZ0l0ZW0odGl0bGUsIHB1Ymxpc2hlZEl0ZW1UeXBlLCBmb2xkZXIsIGV4dGVuc2lvbiwgdXNlciwgcG9ydGFsKSkgfHwge307XG4gIGlmIChpdGVtVVJMTGlzdCAmJiAhdXBkYXRlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvZGU6IFwiaXRlbUV4aXN0c1wiLFxuICAgICAgaXRlbVVybDogaXRlbVVSTExpc3RbMF1cbiAgICB9O1xuICB9XG4gIC8vIGlmIHdlJ3JlIHB1Ymxpc2hpbmcsIGVuc3VyZSB0aGF0IHRoZSBzZXJ2aWNlIG5hbWUgaXMgYXZhaWxhYmxlXG4gIGlmIChlbmFibGVQdWJsaXNoaW5nKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9cG9ydGFscy8ke3BvcnRhbC5pZH0vaXNTZXJ2aWNlTmFtZUF2YWlsYWJsZWAsIHtcbiAgICAgIG5hbWU6IHRpdGxlLnJlcGxhY2UoL1xccy9nLCBcIl9cIiksXG4gICAgICB0eXBlOiBwdWJsaXNoZWRJdGVtVHlwZVxuICAgIH0pO1xuICAgIGlmICghKHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5hdmFpbGFibGUpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjb2RlOiBcInRpdGxlSW5Vc2VTZXJ2aWNlXCIsXG4gICAgICAgIGxheWVyTmFtZTogdGl0bGVcbiAgICAgIH07XG4gICAgfVxuICB9XG4gIHJldHVybiBudWxsO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hUYWdzKHVzZXIpIHtcbiAgdXNlciAhPT0gbnVsbCAmJiB1c2VyICE9PSB2b2lkIDAgPyB1c2VyIDogKHVzZXIgPSBjb25maWdTdGF0ZS51c2VyKTtcbiAgY29uc3QgdGFnc1VybCA9IHVzZXIudXJsICsgXCIvdGFnc1wiO1xuICB0cnkge1xuICAgIGNvbnN0IHRhZ3NSZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodGFnc1VybCk7XG4gICAgcmV0dXJuIHRhZ3NSZXNwb25zZS50YWdzO1xuICB9XG4gIGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICB9XG59XG5cbmNvbnN0IGFyY2dpc1RhZ3NQaWNrZXJDc3MgPSBcIjpob3N0ey0tYXJjZ2lzLWxhYmVsLWZvbnQtd2VpZ2h0OjQwMH0ubGFiZWx7bWFyZ2luLXRvcDowO21hcmdpbi1ib3R0b206MDtmb250LXdlaWdodDp2YXIoLS1hcmNnaXMtbGFiZWwtZm9udC13ZWlnaHQpfS5sYWJlbC0tYm9sZHstLWFyY2dpcy1sYWJlbC1mb250LXdlaWdodDo1MDB9LnNjcmVlbi1yZWFkZXItb25seXtwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDoxcHg7aGVpZ2h0OjFweDtwYWRkaW5nOjA7bWFyZ2luOi0xcHg7b3ZlcmZsb3c6aGlkZGVuO2NsaXA6cmVjdCgwLCAwLCAwLCAwKTt3aGl0ZS1zcGFjZTpub3dyYXA7Ym9yZGVyLXdpZHRoOjB9XCI7XG5cbmNvbnN0IEFyY2dpc1RhZ3NQaWNrZXIgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzVGFnc1BpY2tlckNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzVGFnc1BpY2tlckNoYW5nZVwiLCA3KTtcbiAgICAvKiogQ3VzdG9tIHR5cGUgZ3VhcmQgdG8gY2hlY2sgaWYgdGFncyBuZWVkIHRvIGJlIHJlLXJlcXVlc3RlZCAqL1xuICAgIHRoaXMuaXNUYWcgPSAoYXJnKSA9PiBhcmcudGFnICE9PSB1bmRlZmluZWQgJiYgYXJnLmNvdW50ICE9PSB1bmRlZmluZWQ7XG4gICAgLyoqIHN0b3JlIGFsbCB0aGUgdGFncyB0aGF0IGhhdmUgYmVlbiByZW5kZXJlZCB0aHJvdWdoIHRoaXMgY29tcG9uZW50IGluIGNvbnRyYXN0IHRvIHRoZSBvbmVzIGFkZGVkIGRpcmVjdGx5IGJ5IGNhbGNpdGUtY29tYm9ib3ggKi9cbiAgICB0aGlzLmNvbnRyb2xsZWRUYWdzID0gW107XG4gICAgdGhpcy5tYXBJdGVtVmFsdWUgPSAoaXRlbXMpID0+IHtcbiAgICAgIHJldHVybiBpdGVtcy5tYXAoKGl0ZW0pID0+IGl0ZW0udmFsdWUpO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVLZXlkb3duID0gKGUpID0+IHtcbiAgICAgIHZhciBfYTtcbiAgICAgIC8vIElmIHVzZXIgdHlwZWQgYSBjb21tYSwgdHJlYXQgYXMgZW50ZXIuXG4gICAgICAvLyBUT0RPOiByZW1vdmUgYWZ0ZXIgY2FsY2l0ZSBlbmFibGVzIGNvbW1hIHN1cHBvcnQgKGh0dHBzOi8vZ2l0aHViLmNvbS9Fc3JpL2NhbGNpdGUtY29tcG9uZW50cy9pc3N1ZXMvNDY3MilcbiAgICAgIGlmIChlLmtleSA9PT0gXCIsXCIpIHtcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgICAgIGNvbnN0IGlucHV0ID0gKF9hID0gdGFyZ2V0ID09PSBudWxsIHx8IHRhcmdldCA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGFyZ2V0LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5xdWVyeVNlbGVjdG9yKFwiaW5wdXRcIik7XG4gICAgICAgIGlmIChpbnB1dCA9PT0gbnVsbCB8fCBpbnB1dCA9PT0gdm9pZCAwID8gdm9pZCAwIDogaW5wdXQudmFsdWUpIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgY29uc3QgZXhpc3RpbmcgPSB0YXJnZXQucXVlcnlTZWxlY3RvcihgY2FsY2l0ZS1jb21ib2JveC1pdGVtW3ZhbHVlPVwiJHtpbnB1dC52YWx1ZX1cIl1gKTtcbiAgICAgICAgICBpZiAoZXhpc3RpbmcpIHtcbiAgICAgICAgICAgIGV4aXN0aW5nLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbGNpdGUtY29tYm9ib3gtaXRlbVwiKTtcbiAgICAgICAgICAgIGl0ZW0udmFsdWUgPSBpbnB1dC52YWx1ZTtcbiAgICAgICAgICAgIGl0ZW0udGV4dExhYmVsID0gaW5wdXQudmFsdWU7XG4gICAgICAgICAgICBpdGVtLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRhcmdldCA9PT0gbnVsbCB8fCB0YXJnZXQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRhcmdldC5hcHBlbmRDaGlsZChpdGVtKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaW5wdXQudmFsdWUgPSBcIlwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLmFwaSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zY2FsZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmFjdGl2ZVRhZ3MgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5rbm93blRhZ3MgPSBbXTtcbiAgICB0aGlzLmxhYmVsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucGxhY2Vob2xkZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5oaWRlTGFiZWwgPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2Y7XG4gICAgY29uc3QgbG9jYWxlID0gYXdhaXQgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyh0aGlzLmVsKTtcbiAgICB0aGlzLmkxOG4gPSBsb2NhbGVbMF07XG4gICAgLy8gRmFsbCBiYWNrIHRvIGNvbmZpZyBpZiBubyBwcm9wcyBwYXNzZWQgaW5cbiAgICAoX2EgPSB0aGlzLnVzZXIpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6ICh0aGlzLnVzZXIgPSBjb25maWdTdGF0ZS51c2VyKTtcbiAgICAoX2IgPSB0aGlzLnNjYWxlKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAodGhpcy5zY2FsZSA9IGNvbmZpZ1N0YXRlLnNjYWxlKTtcbiAgICAoX2MgPSB0aGlzLmFwaSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogKHRoaXMuYXBpID0gY29uZmlnU3RhdGUuYXBpKTtcbiAgICAoX2QgPSB0aGlzLmFjdGl2ZVRhZ3MpICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6ICh0aGlzLmFjdGl2ZVRhZ3MgPSBpdGVtUHJvcGVydGllc1N0YXRlLnRhZ3MpO1xuICAgIHRoaXMuYWN0aXZlVGFncyA9IGZvcm1hdFRhZ3ModGhpcy5hY3RpdmVUYWdzKTtcbiAgICAvLyBCdWlsZCBpbml0aWFsIHRhZ3MgbGlzdCBmcm9tIGV4aXN0aW5nIHRhZ3MgYW5kIG9uZXMgcHJlLXNldCBieSB0aGUgY29uc3VtaW5nIGFwcFxuICAgIHRoaXMua25vd25UYWdzID0gZm9ybWF0VGFncyhbLi4uKChfZSA9IHRoaXMua25vd25UYWdzKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiBbXSksIC4uLigoX2YgPSB0aGlzLmFjdGl2ZVRhZ3MpICE9PSBudWxsICYmIF9mICE9PSB2b2lkIDAgPyBfZiA6IFtdKV0pO1xuICAgIGl0ZW1Qcm9wZXJ0aWVzU3RvcmUub24oXCJyZXNldFwiLCAoKSA9PiB7XG4gICAgICB0aGlzLmFjdGl2ZVRhZ3MgPSBpdGVtUHJvcGVydGllc1N0YXRlLnRhZ3M7XG4gICAgfSk7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBjb25zdCB7IHVzZXIgfSA9IHRoaXM7XG4gICAgaWYgKHVzZXIpIHtcbiAgICAgIGNvbnN0IHVzZXJUYWdzID0gKF9hID0gdXNlci5jb250ZW50VGFncykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogdXNlci50YWdzO1xuICAgICAgaWYgKCEodXNlclRhZ3MgPT09IG51bGwgfHwgdXNlclRhZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXJUYWdzLmxlbmd0aCkgfHwgKCh1c2VyVGFncyA9PT0gbnVsbCB8fCB1c2VyVGFncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlclRhZ3MubGVuZ3RoKSA+IDAgJiYgIXRoaXMuaXNUYWcodXNlclRhZ3NbMF0pKSkge1xuICAgICAgICB0aGlzLmtub3duVGFncyA9IFsuLi50aGlzLmtub3duVGFncywgLi4uKGF3YWl0IGZldGNoVGFncyh1c2VyKSkubWFwKCh0YWcpID0+IHRhZy50YWcpXTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmtub3duVGFncyA9IFsuLi50aGlzLmtub3duVGFncywgLi4udXNlclRhZ3MubWFwKCh0YWcpID0+IHRhZy50YWcpXTtcbiAgICAgIH1cbiAgICAgIHRoaXMua25vd25UYWdzID0gZm9ybWF0VGFncyhbLi4uKChfYiA9IHRoaXMuYWN0aXZlVGFncykgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogW10pLCAuLi4oKF9jID0gdGhpcy5rbm93blRhZ3MpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IFtdKV0pO1xuICAgIH1cbiAgfVxuICBpdGVtUHJvcGVydGllc1RhZ3NDaGFuZ2VIYW5kbGVyKGV2ZW50KSB7XG4gICAgdmFyIF9hO1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGNvbnN0IHZhbHVlcyA9ICgoX2EgPSB0aGlzLmNvbWJvYm94KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudmFsdWUpIHx8IFtdO1xuICAgIGNvbnN0IHRhZ3MgPSBBcnJheS5pc0FycmF5KHZhbHVlcykgPyB2YWx1ZXMgOiBbdmFsdWVzXTtcbiAgICB0aGlzLmFyY2dpc1RhZ3NQaWNrZXJDaGFuZ2UuZW1pdChmb3JtYXRUYWdzKHRhZ3MpKTtcbiAgICBjb25zdCBrbm93bkl0ZW1zID0gQXJyYXkuZnJvbSh0aGlzLmNvbWJvYm94LmNoaWxkcmVuKTtcbiAgICBjb25zdCBhY3RpdmVJdGVtcyA9IHRoaXMuY29tYm9ib3guc2VsZWN0ZWRJdGVtcztcbiAgICBrbm93bkl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIGNvbnN0IGhhc0JlZW5BZGRlZCA9IHRoaXMuY29udHJvbGxlZFRhZ3MuaW5jbHVkZXMoaXRlbS52YWx1ZSk7XG4gICAgICAvLyByZW1vdmUgYW55IGNvbWJvYm94LWl0ZW0gdGhhdCBpcyBub3QgeWV0IHBhcnQgb2YgdGhlIGNvbnRyb2xsZWQgbGlzdCBvZiB0YWdzXG4gICAgICBpZiAoIWhhc0JlZW5BZGRlZCkge1xuICAgICAgICBpdGVtLnJlbW92ZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMua25vd25UYWdzID0gdGhpcy5tYXBJdGVtVmFsdWUoa25vd25JdGVtcyk7XG4gICAgdGhpcy5hY3RpdmVUYWdzID0gdGhpcy5tYXBJdGVtVmFsdWUoYWN0aXZlSXRlbXMpO1xuICB9XG4gIHJlbmRlckZvcm1hdHRlZFRhZ3MoKSB7XG4gICAgY29uc3QgeyBpMThuLCBzY2FsZSwgaGFuZGxlS2V5ZG93biwgcGxhY2Vob2xkZXIgfSA9IHRoaXM7XG4gICAgdGhpcy5rbm93blRhZ3MuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICBpZiAodGhpcy5jb250cm9sbGVkVGFncy5pbmNsdWRlcyh0YWcpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuY29udHJvbGxlZFRhZ3MucHVzaCh0YWcpO1xuICAgIH0pO1xuICAgIGNvbnN0IHRhZ0VsZW1lbnRzID0gdGhpcy5rbm93blRhZ3MubWFwKCh0YWcpID0+IHtcbiAgICAgIHZhciBfYTtcbiAgICAgIHJldHVybiAoaChcImNhbGNpdGUtY29tYm9ib3gtaXRlbVwiLCB7IGtleTogdGFnLCB2YWx1ZTogdGFnLCB0ZXh0TGFiZWw6IHRhZy5sZW5ndGggPiAzNiA/IGAke3RhZy5zbGljZSgwLCAzNil9Li4uYCA6IHRhZywgc2VsZWN0ZWQ6ICgoX2EgPSB0aGlzLmFjdGl2ZVRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmRleE9mKHRhZykpID49IDAgfSkpO1xuICAgIH0pO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtY29tYm9ib3hcIiwgeyBsYWJlbDogaTE4bi50YWdzLCBtYXhJdGVtczogNSwgXCJhbGxvdy1jdXN0b20tdmFsdWVzXCI6IHRydWUsIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlciAhPT0gbnVsbCAmJiBwbGFjZWhvbGRlciAhPT0gdm9pZCAwID8gcGxhY2Vob2xkZXIgOiBpMThuLmFkZFRhZ3MsIHNjYWxlOiBzY2FsZSwgb25LZXlEb3duOiBoYW5kbGVLZXlkb3duLCByZWY6IChlbCkgPT4gKHRoaXMuY29tYm9ib3ggPSBlbCkgfSwgdGFnRWxlbWVudHMpKTtcbiAgfVxuICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICB2YXIgX2E7XG4gICAgKF9hID0gdGhpcy5jb21ib2JveCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgaTE4biwgc2NhbGUsIGhpZGVMYWJlbCwgbGFiZWwgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IHNjYWxlOiBzY2FsZSB9LCBoKFwicFwiLCB7IGNsYXNzOiB7IGxhYmVsOiB0cnVlLCBcInNjcmVlbi1yZWFkZXItb25seVwiOiBoaWRlTGFiZWwgfSB9LCBsYWJlbCAhPT0gbnVsbCAmJiBsYWJlbCAhPT0gdm9pZCAwID8gbGFiZWwgOiBpMThuLnRhZ3MpLCB0aGlzLnJlbmRlckZvcm1hdHRlZFRhZ3MoKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNUYWdzUGlja2VyLnN0eWxlID0gYXJjZ2lzVGFnc1BpY2tlckNzcztcblxuY29uc3QgYXJjZ2lzVGl0bGVJbnB1dENzcyA9IFwiOmhvc3R7LS1hcmNnaXMtbGFiZWwtZm9udC13ZWlnaHQ6NDAwfS5sYWJlbHttYXJnaW4tdG9wOjA7bWFyZ2luLWJvdHRvbTowO2ZvbnQtd2VpZ2h0OnZhcigtLWFyY2dpcy1sYWJlbC1mb250LXdlaWdodCl9LmxhYmVsLS1ib2xkey0tYXJjZ2lzLWxhYmVsLWZvbnQtd2VpZ2h0OjUwMH1jYWxjaXRlLWlucHV0ey0tY2FsY2l0ZS11aS1ib3JkZXItMTp2YXIoLS1jYWxjaXRlLXVpLWJvcmRlci1pbnB1dCl9XCI7XG5cbmNvbnN0IEFyY2dpc1RpdGxlSW5wdXQgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzVGl0bGVJbnB1dENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzVGl0bGVJbnB1dENoYW5nZVwiLCA3KTtcbiAgICB0aGlzLmRlYm91bmNlZElucHV0ID0gZGVib3VuY2UoKCkgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlVGl0bGVWYWxpZGF0aW9uKCk7XG4gICAgfSwgNDAwKTtcbiAgICB0aGlzLmFwaSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zY2FsZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxhYmVsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaXRlbVRpdGxlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuY3VycmVudEZvbGRlciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnR5cGUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy51cGRhdGUgPSBmYWxzZTtcbiAgICB0aGlzLmVuYWJsZVB1Ymxpc2hpbmcgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy50aXRsZUVycm9yID0gdW5kZWZpbmVkO1xuICB9XG4gIGFzeW5jIGZvY3VzTWFpbklucHV0KCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgLy8gYXJjZ2lzLXdvcmtmbG93IFRPRE86IG1haW5JbnB1dFJlZiBpcyBhbiBlbXB0eSBvYmplY3Qgd2hlbiBwdWJsaXNoIGl0ZW0gcHJvcGVydGllcycgdGVzdCBjYWxscyB2YWxpZGF0ZVxuICAgIChfYiA9IChfYSA9IHRoaXMubWFpbklucHV0UmVmKS5zZXRGb2N1cykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmNhbGwoX2EpO1xuICB9XG4gIGFzeW5jIHZhbGlkYXRlVGl0bGUoKSB7XG4gICAgLy8gQ2hlY2sgd2hpY2ggc2l0dWF0aW9ucyBzaG91bGQgYmUgZmx1c2hlZCBpbnN0ZWFkIG9mIGludm9rZWQgLSBtaWdodCBuZWVkIHRvIGludHJvZHVjZSBzb21ldGhpbmcgdG8gY2F0Y2ggXCJtb2RpZmllZCBzaW5jZSBsYXN0IHZhbGlkYXRlXCJcbiAgICByZXR1cm4gdGhpcy5kZWJvdW5jZWRJbnB1dC5pbnZva2UoKTtcbiAgICAvLyBUT0RPOiBSZWZlciB0byB0aGUgYmVsb3cgc25pcHBldCBpZiB0aGVyZSdzIGEgdGltaW5nIGlzc3VlIGZvdW5kIGFsd2F5cyBpbnZva2luZ1xuICAgIC8vIFdlIHdhbnQgdG8gaW52b2tlIHRvIHRyaWdnZXIgdGhlIGVtcHR5IHRpdGxlIGVycm9yIHNvIGl0IGFsd2F5cyBnZXQgdHJpZ2dlcmVkXG4gICAgLy8gcmV0dXJuICF0aGlzLml0ZW1UaXRsZSA/IHRoaXMuZGVib3VuY2VkSW5wdXQuaW52b2tlKCkgOiB0aGlzLmRlYm91bmNlZElucHV0LmZsdXNoKCk7XG4gIH1cbiAgYXN5bmMgaGFuZGxlVGl0bGVWYWxpZGF0aW9uKCkge1xuICAgIGNvbnN0IHsgdHlwZSwgaXRlbVRpdGxlLCBlbmFibGVQdWJsaXNoaW5nLCBwb3J0YWwsIHVzZXIsIHVwZGF0ZSB9ID0gdGhpcztcbiAgICBjb25zdCB7IGV4dGVuc2lvbiB9ID0gc2FuaXRpemVGaWxlTmFtZShpdGVtVGl0bGUpO1xuICAgIGlmICghdHlwZSkge1xuICAgICAgY29uc29sZS5lcnJvcihcIk5vIGl0ZW0gdHlwZSBmb3VuZC4gU2tpcHBpbmcgdGl0bGUgdmFsaWRhdGlvblwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy50aXRsZUVycm9yID0gYXdhaXQgdmFsaWRhdGVUaXRsZSh7XG4gICAgICBwb3J0YWwsXG4gICAgICB1c2VyLFxuICAgICAgdGl0bGU6IGl0ZW1UaXRsZSxcbiAgICAgIGl0ZW1UeXBlOiB0eXBlLFxuICAgICAgZm9sZGVyOiB0aGlzLmN1cnJlbnRGb2xkZXIsXG4gICAgICBleHRlbnNpb24sXG4gICAgICBlbmFibGVQdWJsaXNoaW5nLFxuICAgICAgdXBkYXRlXG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXMuZ2V0RXJyb3JNZXNzYWdlKCk7XG4gIH1cbiAgZ2V0RXJyb3JNZXNzYWdlKCkge1xuICAgIGNvbnN0IHsgaXRlbVRpdGxlLCB0aXRsZUVycm9yLCBpMThuIH0gPSB0aGlzO1xuICAgIGlmICghaXRlbVRpdGxlKSB7XG4gICAgICB0aGlzLnRpdGxlRXJyb3IgPSB7XG4gICAgICAgIGNvZGU6IFwidGl0bGVSZXF1aXJlZFwiLFxuICAgICAgICB0cmFuc2xhdGVkTWVzc2FnZTogdGhpcy5pMThuLnZhbGlkYXRpb24udGl0bGVSZXF1aXJlZFxuICAgICAgfTtcbiAgICB9XG4gICAgaWYgKCEhdGl0bGVFcnJvcikge1xuICAgICAgdGl0bGVFcnJvci50cmFuc2xhdGVkTWVzc2FnZSA9IGkxOG4udmFsaWRhdGlvblt0aGlzLnRpdGxlRXJyb3IuY29kZV0ucmVwbGFjZShcIiR7bmFtZX1cIiwgaXRlbVRpdGxlKTtcbiAgICB9XG4gICAgcmV0dXJuIHRpdGxlRXJyb3I7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2YsIF9nO1xuICAgIGNvbnN0IGxvY2FsZSA9IGF3YWl0IGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3ModGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gbG9jYWxlWzBdO1xuICAgIC8vIEZhbGwgYmFjayB0byBjb25maWcgaWYgbm8gcHJvcHMgcGFzc2VkXG4gICAgKF9hID0gdGhpcy5wb3J0YWwpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6ICh0aGlzLnBvcnRhbCA9IGNvbmZpZ1N0YXRlLnBvcnRhbCk7XG4gICAgKF9iID0gdGhpcy51c2VyKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAodGhpcy51c2VyID0gY29uZmlnU3RhdGUudXNlcik7XG4gICAgKF9jID0gdGhpcy5zY2FsZSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogKHRoaXMuc2NhbGUgPSBjb25maWdTdGF0ZS5zY2FsZSk7XG4gICAgKF9kID0gdGhpcy5hcGkpICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6ICh0aGlzLmFwaSA9IGNvbmZpZ1N0YXRlLmFwaSk7XG4gICAgKF9lID0gdGhpcy50eXBlKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiAodGhpcy50eXBlID0gaXRlbVByb3BlcnRpZXNTdGF0ZS50eXBlKTtcbiAgICAoX2YgPSB0aGlzLml0ZW1UaXRsZSkgIT09IG51bGwgJiYgX2YgIT09IHZvaWQgMCA/IF9mIDogKHRoaXMuaXRlbVRpdGxlID0gaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSk7XG4gICAgKF9nID0gdGhpcy5jdXJyZW50Rm9sZGVyKSAhPT0gbnVsbCAmJiBfZyAhPT0gdm9pZCAwID8gX2cgOiAodGhpcy5jdXJyZW50Rm9sZGVyID0gaXRlbVByb3BlcnRpZXNTdGF0ZS5mb2xkZXIpO1xuICAgIHRoaXMuaXRlbVRpdGxlICYmIHRoaXMuaGFuZGxlVGl0bGVWYWxpZGF0aW9uKCk7XG4gICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSA9IHRoaXMuaXRlbVRpdGxlO1xuICAgIC8vIGFyY2dpcy13b3JrZmxvdyBUT0RPOiByZS1pbml0aWFsaXppbmcgbG9jYWwgc3RhdGUgb24gc3RvcmUgcmVzZXQgaXMgbm90IGNvbXBhdGlibGUgd2l0aCB0ZXN0c1xuICAgIGl0ZW1Qcm9wZXJ0aWVzU3RvcmUub24oXCJyZXNldFwiLCAoKSA9PiB7XG4gICAgICB0aGlzLml0ZW1UaXRsZSA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGU7XG4gICAgfSk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB7IGkxOG4sIGl0ZW1UaXRsZSwgc2NhbGUgfSA9IHRoaXM7XG4gICAgY29uc3QgeyB0cmFuc2xhdGVkTWVzc2FnZSwgY29kZSB9ID0gdGhpcy50aXRsZUVycm9yIHx8IHt9O1xuICAgIGNvbnN0IHZhbGlkID0gIXRyYW5zbGF0ZWRNZXNzYWdlO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyBzY2FsZTogc2NhbGUgfSwgaChcInBcIiwgeyBjbGFzczogXCJsYWJlbFwiIH0sIChfYSA9IHRoaXMubGFiZWwpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGkxOG4udGl0bGUpLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IGlkOiBcIml0ZW0tcHJvcGVydGllcy10aXRsZVwiLCBwbGFjZWhvbGRlcjogaTE4bi5hZGRUaXRsZSwgdmFsdWU6IGl0ZW1UaXRsZSwgc2NhbGU6IHNjYWxlLCBvbklucHV0OiB0aGlzLmRlYm91bmNlZElucHV0LCBtYXg6IE1BWF9USVRMRV9MRU5HVEgsIHJlZjogKGVsZSkgPT4gKHRoaXMubWFpbklucHV0UmVmID0gZWxlKSwgc3RhdHVzOiB2YWxpZCA/IFwiaWRsZVwiIDogXCJpbnZhbGlkXCIsIG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IChldmVudCkgPT4ge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5pdGVtVGl0bGUgPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgICAgIHRoaXMuYXJjZ2lzVGl0bGVJbnB1dENoYW5nZS5lbWl0KHRoaXMuaXRlbVRpdGxlKTtcbiAgICAgIH0gfSksIGgoXCJjYWxjaXRlLWlucHV0LW1lc3NhZ2VcIiwgeyBpY29uOiB0cnVlLCBoaWRkZW46IHZhbGlkLCBzdGF0dXM6IHZhbGlkID8gXCJpZGxlXCIgOiBcImludmFsaWRcIiB9LCB0cmFuc2xhdGVkTWVzc2FnZSB8fCBpMThuW2NvZGVdIHx8IGkxOG4udGl0bGUpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgIFwiY3VycmVudEZvbGRlclwiOiBbXCJoYW5kbGVUaXRsZVZhbGlkYXRpb25cIl1cbiAgfTsgfVxufTtcbkFyY2dpc1RpdGxlSW5wdXQuc3R5bGUgPSBhcmNnaXNUaXRsZUlucHV0Q3NzO1xuXG5leHBvcnQgeyBBcmNnaXNDYXRlZ29yaWVzUGlja2VyIGFzIGFyY2dpc19jYXRlZ29yaWVzX3BpY2tlciwgQXJjZ2lzRm9sZGVyUGlja2VyIGFzIGFyY2dpc19mb2xkZXJfcGlja2VyLCBBcmNnaXNJdGVtUHJvcGVydGllcyBhcyBhcmNnaXNfaXRlbV9wcm9wZXJ0aWVzLCBBcmNnaXNTdW1tYXJ5SW5wdXQgYXMgYXJjZ2lzX3N1bW1hcnlfaW5wdXQsIEFyY2dpc1RhZ3NQaWNrZXIgYXMgYXJjZ2lzX3RhZ3NfcGlja2VyLCBBcmNnaXNUaXRsZUlucHV0IGFzIGFyY2dpc190aXRsZV9pbnB1dCB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBmIGFzIGZyb21DYWNoZSwgciBhcyByZXF1ZXN0LCBnIGFzIGdldFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9wb3J0YWwtNzljYWFlZmYuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLWViNWY3ZGMyLmpzJztcbmltcG9ydCB7IG4gYXMgaXNQdWJsaWNVc2VyIH0gZnJvbSAnLi9wcml2aWxlZ2VzLWNjZDVmMzdkLmpzJztcblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hDYXRlZ29yaWVzKHBvcnRhbCwgdXNlcikge1xuICBwb3J0YWwgIT09IG51bGwgJiYgcG9ydGFsICE9PSB2b2lkIDAgPyBwb3J0YWwgOiAocG9ydGFsID0gY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgdXNlciAhPT0gbnVsbCAmJiB1c2VyICE9PSB2b2lkIDAgPyB1c2VyIDogKHVzZXIgPSBjb25maWdTdGF0ZS51c2VyKTtcbiAgaWYgKCEocG9ydGFsID09PSBudWxsIHx8IHBvcnRhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9ydGFsLmlkKSB8fCAodXNlciAmJiBpc1B1YmxpY1VzZXIodXNlcikpKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgcmV0dXJuIGZyb21DYWNoZSgoKSA9PiByZXF1ZXN0KGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9cG9ydGFscy8ke3BvcnRhbC5pZH0vY2F0ZWdvcnlTY2hlbWFgKSwgXCJjYXRlZ29yeVNjaGVtYVwiLCBwb3J0YWwuaWQpO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hHcm91cENhdGVnb3JpZXMoZ3JvdXBJZCwgcG9ydGFsKSB7XG4gIHBvcnRhbCAhPT0gbnVsbCAmJiBwb3J0YWwgIT09IHZvaWQgMCA/IHBvcnRhbCA6IChwb3J0YWwgPSBjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgaWYgKCFncm91cElkIHx8ICFwb3J0YWwpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICByZXR1cm4gZnJvbUNhY2hlKCgpID0+IHJlcXVlc3QoYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX1jb21tdW5pdHkvZ3JvdXBzLyR7Z3JvdXBJZH0vY2F0ZWdvcnlTY2hlbWFgKSwgXCJjYXRlZ29yeVNjaGVtYVwiLCBncm91cElkKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoTGl2aW5nQXRsYXNTY2hlbWEocG9ydGFsKSB7XG4gIHZhciBfYTtcbiAgY29uc3QgYmFzZSA9IGdldFJlc3RCYXNlVXJsKHBvcnRhbCk7XG4gIGNvbnN0IHNlbGYgPSBhd2FpdCByZXF1ZXN0KGAke2Jhc2V9cG9ydGFscy9zZWxmYCk7XG4gIGNvbnN0IGdyb3VwU2VhcmNoID0gYXdhaXQgcmVxdWVzdChgJHtiYXNlfWNvbW11bml0eS9ncm91cHM/cT0ke3NlbGYuY29udGVudENhdGVnb3J5U2V0c0dyb3VwUXVlcnl9YCk7XG4gIGNvbnN0IGNhdGVnb3J5R3JvdXAgPSAoX2EgPSBncm91cFNlYXJjaCA9PT0gbnVsbCB8fCBncm91cFNlYXJjaCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3JvdXBTZWFyY2gucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdO1xuICBjb25zdCBzY2hlbWFJdGVtU2VhcmNoID0gYXdhaXQgcmVxdWVzdChgJHtiYXNlfWNvbnRlbnQvZ3JvdXBzLyR7Y2F0ZWdvcnlHcm91cC5pZH0vc2VhcmNoYCwge1xuICAgIHE6IFwidHlwZWtleXdvcmRzOiBMaXZpbmdBdGxhc1wiXG4gIH0pO1xuICBjb25zdCBzY2hlbWFJdGVtID0gc2NoZW1hSXRlbVNlYXJjaC5yZXN1bHRzWzBdO1xuICByZXR1cm4gcmVxdWVzdChgJHtiYXNlfWNvbnRlbnQvaXRlbXMvJHtzY2hlbWFJdGVtLmlkfS9kYXRhYCk7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaExpdmluZ0F0bGFzQ2F0ZWdvcmllcyhwb3J0YWwpIHtcbiAgcmV0dXJuIGZyb21DYWNoZSgoKSA9PiBmZXRjaExpdmluZ0F0bGFzU2NoZW1hKHBvcnRhbCksIFwiY2F0ZWdvcnlTY2hlbWFcIiwgXCJsaXZpbmctYXRsYXNcIik7XG59XG5cbmV4cG9ydCB7IGZldGNoTGl2aW5nQXRsYXNDYXRlZ29yaWVzIGFzIGEsIGZldGNoR3JvdXBDYXRlZ29yaWVzIGFzIGIsIGZldGNoQ2F0ZWdvcmllcyBhcyBmIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGEgYXMgYWRkQ3JlYXRlSXRlbVR5cGVzIH0gZnJvbSAnLi9pdGVtLXR5cGVzLWI0ZmU4NmFkLmpzJztcbmltcG9ydCB7IGcgYXMgZ3VpZCB9IGZyb20gJy4vZ3VpZC00ZjQxNzZiYS5qcyc7XG5cbmZ1bmN0aW9uIHNhbml0aXplRmlsZU5hbWUobmFtZSwgYWRkR1VJRCkge1xuICAvL1RPRE86IGFkZCBuZXcgcGFyYW0gdG8gc3BlYyBmaWxlLlxuICBjb25zdCBleHByZXNzaW9uID0gLyg/OlxcLihbXi5dKykpPyQvO1xuICBjb25zdCBpbnZhbGlkVGl0bGVDaGFyYWN0ZXJzID0gL1xcLnwtL2c7XG4gIGxldCBmaWxlTmFtZSA9IG5hbWUucmVwbGFjZSgvXi4qKFxcXFx8XFwvfDopLywgXCJcIik7XG4gIGxldCBleHRlbnNpb24gPSAoZmlsZU5hbWUgJiYgZXhwcmVzc2lvbi5leGVjKGZpbGVOYW1lKVsxXSA/IGV4cHJlc3Npb24uZXhlYyhmaWxlTmFtZSlbMV0udG9Mb3dlckNhc2UoKSA6IFwiXCIpO1xuICBsZXQgdGl0bGUgPSBcIlwiO1xuICBpZiAoZmlsZU5hbWUuaW5kZXhPZihcIi5yZnQuXCIpID4gLTEpIHtcbiAgICBjb25zdCBbbmFtZSwgc3VmZml4XSA9IGZpbGVOYW1lLnNwbGl0KFwiLnJmdC5cIik7XG4gICAgZXh0ZW5zaW9uID0gYHJmdC4ke3N1ZmZpeH1gO1xuICAgIHRpdGxlID0gbmFtZTtcbiAgfVxuICBpZiAoZmlsZU5hbWUgJiYgIXRpdGxlKSB7XG4gICAgdGl0bGUgPSBmaWxlTmFtZS5sYXN0SW5kZXhPZihcIi5cIikgPT09IC0xID8gZmlsZU5hbWUgOiBmaWxlTmFtZS5zdWJzdHJpbmcoMCwgZmlsZU5hbWUubGFzdEluZGV4T2YoXCIuXCIpKTtcbiAgfVxuICAvLyBSZXBsYWNlIGFueSBpbnZhbGlkIGNoYXJhY3RlcnMgd2l0aCBhbiB1bmRlcnNjb3JlXG4gIHRpdGxlID0gdGl0bGUucmVwbGFjZShpbnZhbGlkVGl0bGVDaGFyYWN0ZXJzLCBcIl9cIik7XG4gIC8vIEFsbG93IGZpbGUgdXBsb2FkIG9mIGV4aXN0aW5nIGl0ZW0ncyBmaWxlIG5hbWUgLy8gY3VycmVudGx5IHVzZWQgaW4gYXBwZW5kXG4gIGlmIChhZGRHVUlEKSB7XG4gICAgdGl0bGUgPSBtYWtlVW5pcXVlRmlsZU5hbWUodGl0bGUpO1xuICAgIGZpbGVOYW1lID0gYCR7dGl0bGV9LiR7ZXh0ZW5zaW9ufWA7XG4gIH1cbiAgcmV0dXJuIHsgdGl0bGUsIGZpbGVOYW1lLCBleHRlbnNpb24gfTtcbn1cbi8vIEhlbHBlciBtZXRob2QgdGhhdCB0YWtlcyBpbiBhIGZpbGUgJiByZXR1cm5zIHRoZSBjbGVhbmVkIHVwIGZpbGUgbmFtZSBhcyBpcyBhbmQgaW4gdGl0bGUgZm9ybSwgYW5kIHRoZSBkZXRlY3RlZCBmaWxlIGV4dGVuc2lvblxuZnVuY3Rpb24gc2FuaXRpemVGaWxlSW5wdXQoZmlsZSwgYWRkR1VJRCkge1xuICByZXR1cm4gc2FuaXRpemVGaWxlTmFtZShmaWxlLm5hbWUsICEhYWRkR1VJRCk7XG59XG5mdW5jdGlvbiBtYWtlVW5pcXVlRmlsZU5hbWUobmFtZSkge1xuICByZXR1cm4gYCR7bmFtZX1fJHtndWlkKCl9YDtcbn1cbmZ1bmN0aW9uIHZhbGlkYXRlT3ZlcndyaXRlRmlsZU5hbWUodXBsb2FkZWRGaWxlTmFtZSwgc291cmNlRmlsZU5hbWUpIHtcbiAgbGV0IGZpbGVOYW1lID0gdXBsb2FkZWRGaWxlTmFtZTtcbiAgY29uc3QgcG9zaXRpb24gPSB1cGxvYWRlZEZpbGVOYW1lLmxhc3RJbmRleE9mKFwiXFxcXFwiKTtcbiAgaWYgKHBvc2l0aW9uID4gLTEpIHtcbiAgICBmaWxlTmFtZSA9IGZpbGVOYW1lLnN1YnN0cmluZyhwb3NpdGlvbiArIDEsIGZpbGVOYW1lLmxlbmd0aCk7XG4gIH1cbiAgcmV0dXJuIGZpbGVOYW1lLnJlcGxhY2UoL1xcIC9nLCBcIl9cIikgPT09IHNvdXJjZUZpbGVOYW1lLnJlcGxhY2UoL1xcIC9nLCBcIl9cIik7XG59XG5mdW5jdGlvbiBnZXRJdGVtSW5mb0J5VHlwZSh0eXBlKSB7XG4gIGlmIChhZGRDcmVhdGVJdGVtVHlwZXNbdHlwZV0pIHtcbiAgICByZXR1cm4gYWRkQ3JlYXRlSXRlbVR5cGVzW3R5cGVdO1xuICB9XG4gIGVsc2Uge1xuICAgIHJldHVybiBhZGRDcmVhdGVJdGVtVHlwZXNbT2JqZWN0LmtleXMoYWRkQ3JlYXRlSXRlbVR5cGVzKS5maW5kKChmaWxlVHlwZSkgPT4gYWRkQ3JlYXRlSXRlbVR5cGVzW2ZpbGVUeXBlXS50eXBlID09PSB0eXBlKV07XG4gIH1cbn1cbmZ1bmN0aW9uIGZvcm1hdEZpbGVTaXplKHNpemUpIHtcbiAgaWYgKCFzaXplKSB7XG4gICAgcmV0dXJuIFwiMCBCXCI7XG4gIH1cbiAgY29uc3QgaSA9IE1hdGguZmxvb3IoTWF0aC5sb2coc2l6ZSkgLyBNYXRoLmxvZygxMDI0KSk7XG4gIGNvbnN0IGFkanVzdGVkU2l6ZSA9IE1hdGgucm91bmQoc2l6ZSAvIE1hdGgucG93KDEwMjQsIGkpKTtcbiAgY29uc3QgdW5pdCA9IFtcIkJcIiwgXCJLQlwiLCBcIk1CXCIsIFwiR0JcIiwgXCJUQlwiXVtpXTtcbiAgcmV0dXJuIGAke2FkanVzdGVkU2l6ZX0gJHt1bml0fWA7XG59XG5cbmV4cG9ydCB7IHNhbml0aXplRmlsZU5hbWUgYXMgYSwgZm9ybWF0RmlsZVNpemUgYXMgZiwgZ2V0SXRlbUluZm9CeVR5cGUgYXMgZywgc2FuaXRpemVGaWxlSW5wdXQgYXMgcywgdmFsaWRhdGVPdmVyd3JpdGVGaWxlTmFtZSBhcyB2IH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlSWQoY291bnRzKSB7XG4gIHJldHVybiBjb3VudHNcbiAgICAubWFwKChjb3VudCkgPT4ge1xuICAgIGxldCBvdXQgPSBcIlwiO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgb3V0ICs9ICgoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApIHwgMCkudG9TdHJpbmcoMTYpLnN1YnN0cmluZygxKTtcbiAgICB9XG4gICAgcmV0dXJuIG91dDtcbiAgfSlcbiAgICAuam9pbihcIi1cIik7XG59XG5jb25zdCBndWlkID0gKCkgPT4gZ2VuZXJhdGVJZChbMiwgMSwgMSwgMSwgM10pO1xuXG5leHBvcnQgeyBndWlkIGFzIGcgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgbCBhcyBsb2FkTW9kdWxlcyB9IGZyb20gJy4vbG9hZE1vZHVsZXMtYWFmMzBiZDYuanMnO1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5cbmNvbnN0IGxhbmd1YWdlTWFwID0gbmV3IE1hcChbXG4gIFtcImFyXCIsIFwiYXJcIl0sXG4gIFtcImJnXCIsIFwiYmdcIl0sXG4gIFtcImJzXCIsIFwiYnNcIl0sXG4gIFtcImNhXCIsIFwiY2FcIl0sXG4gIFtcImNzXCIsIFwiY3NcIl0sXG4gIFtcImRhXCIsIFwiZGFcIl0sXG4gIFtcImRlXCIsIFwiZGVcIl0sXG4gIFtcImVsXCIsIFwiZWxcIl0sXG4gIFtcImVuXCIsIFwiZW5cIl0sXG4gIFtcImVzXCIsIFwiZXNcIl0sXG4gIFtcImV0XCIsIFwiZXRcIl0sXG4gIFtcImZpXCIsIFwiZmlcIl0sXG4gIFtcImZyXCIsIFwiZnJcIl0sXG4gIFtcImhlXCIsIFwiaGVcIl0sXG4gIFtcImhyXCIsIFwiaHJcIl0sXG4gIFtcImh1XCIsIFwiaHVcIl0sXG4gIFtcImlkXCIsIFwiaWRcIl0sXG4gIFtcIml0XCIsIFwiaXRcIl0sXG4gIFtcImphXCIsIFwiamFcIl0sXG4gIFtcImtvXCIsIFwia29cIl0sXG4gIFtcImx0XCIsIFwibHRcIl0sXG4gIFtcImx2XCIsIFwibHZcIl0sXG4gIFtcIm5iXCIsIFwibmJcIl0sXG4gIFtcIm5sXCIsIFwibmxcIl0sXG4gIFtcInBsXCIsIFwicGxcIl0sXG4gIFtcInB0LWJyXCIsIFwicHQtQlJcIl0sXG4gIFtcInB0LXB0XCIsIFwicHQtUFRcIl0sXG4gIFtcInJvXCIsIFwicm9cIl0sXG4gIFtcInJ1XCIsIFwicnVcIl0sXG4gIFtcInNrXCIsIFwic2tcIl0sXG4gIFtcInNsXCIsIFwic2xcIl0sXG4gIFtcInNyXCIsIFwic3JcIl0sXG4gIFtcInN2XCIsIFwic3ZcIl0sXG4gIFtcInRoXCIsIFwidGhcIl0sXG4gIFtcInRyXCIsIFwidHJcIl0sXG4gIFtcInVrXCIsIFwidWtcIl0sXG4gIFtcInZpXCIsIFwidmlcIl0sXG4gIFtcInpoLWNuXCIsIFwiemgtQ05cIl0sXG4gIFtcInpoLWhrXCIsIFwiemgtSEtcIl0sXG4gIFtcInpoLXR3XCIsIFwiemgtVFdcIl1cbl0pO1xuLy8gcnRsXG5mdW5jdGlvbiBnZXRFbGVtZW50RGlyKGVsKSB7XG4gIHJldHVybiBnZXRFbGVtZW50UHJvcChlbCwgXCJkaXJcIiwgXCJsdHJcIik7XG59XG5mdW5jdGlvbiBnZXRFbGVtZW50UHJvcChlbCwgcHJvcCwgdmFsdWUpIHtcbiAgY29uc3QgY2xvc2VzdFdpdGhQcm9wID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsLCBgWyR7cHJvcH1dYCk7XG4gIHJldHVybiBjbG9zZXN0V2l0aFByb3AgPyBjbG9zZXN0V2l0aFByb3AuZ2V0QXR0cmlidXRlKHByb3ApIDogdmFsdWU7XG59XG4vLyBjc3NcbmNvbnN0IENTU19VVElMSVRZID0ge1xuICBydGw6IFwiYXJjZ2lzLS1ydGxcIlxufTtcbmFzeW5jIGZ1bmN0aW9uIGZvcm1hdE51bWJlcihudW1iZXIsIG9wdGlvbnMpIHtcbiAgY29uc3QgeyBhcGksIHR5cGUsIHBsYWNlcyB9ID0gb3B0aW9ucyB8fCB7fTtcbiAgaWYgKGFwaSA9PT0gNCkge1xuICAgIGNvbnN0IFtpbnRsXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvaW50bFwiXSk7XG4gICAgY29uc3QgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMgPSBpbnRsLmNvbnZlcnROdW1iZXJGb3JtYXRUb0ludGxPcHRpb25zKHtcbiAgICAgIHBsYWNlcyxcbiAgICAgIHN0eWxlOiB0eXBlLFxuICAgICAgZGlnaXRTZXBhcmF0b3I6IHRydWVcbiAgICB9KTtcbiAgICByZXR1cm4gaW50bC5mb3JtYXROdW1iZXIobnVtYmVyLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG51bWJlckZvcm1hdEludGxPcHRpb25zKSwgeyBzdHlsZTogdHlwZSB9KSk7XG4gIH1cbiAgY29uc3QgW2Rvam9OdW1iZXJdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZG9qby9udW1iZXJcIl0pO1xuICByZXR1cm4gZG9qb051bWJlci5mb3JtYXQobnVtYmVyLCB7XG4gICAgdHlwZSxcbiAgICBwbGFjZXMsXG4gICAgcGF0dGVybjogb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLnBhdHRlcm5cbiAgfSk7XG59XG5jb25zdCBjYWNoZSA9IHt9O1xuZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlKSB7XG4gIGNvbnN0IGxhbmcgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZztcbiAgY29uc3QgZGF5U2hvcnRNb250aFllYXIgPSB7XG4gICAgeWVhcjogXCJudW1lcmljXCIsXG4gICAgbW9udGg6IFwic2hvcnRcIixcbiAgICBkYXk6IFwibnVtZXJpY1wiXG4gIH07XG4gIGlmICghY2FjaGVbbGFuZ10pIHtcbiAgICBjYWNoZVtsYW5nXSA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nLCBkYXlTaG9ydE1vbnRoWWVhcik7XG4gIH1cbiAgcmV0dXJuIGNhY2hlW2xhbmddLmZvcm1hdChkYXRlKTtcbn1cblxuZXhwb3J0IHsgQ1NTX1VUSUxJVFkgYXMgQywgZm9ybWF0RGF0ZSBhcyBhLCBmb3JtYXROdW1iZXIgYXMgZiwgZ2V0RWxlbWVudERpciBhcyBnLCBsYW5ndWFnZU1hcCBhcyBsIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tMTNmNWIwMGMuanMnO1xuaW1wb3J0IHsgbCBhcyBsYW5ndWFnZU1hcCB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0QXNzZXRQYXRoIH0gZnJvbSAnLi9pbmRleC05MmViYjM5Ni5qcyc7XG5cbi8vIGh0dHBzOi8vbWVkaXVtLmNvbS9zdGVuY2lsLXRyaWNrcy9pbXBsZW1lbnRpbmctaW50ZXJuYXRpb25hbGlzYXRpb24taTE4bi13aXRoLXN0ZW5jaWwtNWU2NTU5NTU0MTE3XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCkge1xuICB2YXIgX2EsIF9iLCBfYztcbiAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gIC8vIGxhbmd1YWdlIHNldCBieSB0aGUgY2FsbGluZyBhcHBsaWNhdGlvbiBvciBicm93c2VyLiBkZWZhdWx0cyB0byBlbmdsaXNoLlxuICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgfVxuICBlbHNlIHtcbiAgICAvLyBcInJ1LVJVXCIgbWFwcyB0byBcInJ1XCIgdXNlIGNhc2VcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcuc2xpY2UoMCwgMikpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBcImVuXCI7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpIHtcbiAgdmFyIF9hLCBfYiwgX2M7XG4gIC8vIGl0J3MgT0sgaWYgd2UgZG9uJ3QgaGF2ZSB0aGUgNCBsZXR0ZXIgbGFuZ3VhZ2UgZmlsZSBmb3IgaXRcbiAgLy8gNCBsZXR0ZXIgbGFuZ3VhZ2UgY29kZSBuZWVkZWQgZm9yIGZvcm1hdHRpbmcgbnVtYmVyc1xuICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICB9XG4gIGVsc2Uge1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgIC8vIHdlIHN1cHBvcnQgdGhlIDIgbGV0dGVyIGNvZGVkIGxhbmd1YWdlXG4gICAgICAvLyBlLmcuIGl0LUNIIHZzIGl0XG4gICAgICByZXR1cm4gbGFuZztcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXR1cm4gXCJlblwiO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGZldGNoKGdldEFzc2V0UGF0aChgLi4vYXJjZ2lzLWFwcC1hc3NldHMvaTE4bi8ke2NvbXBvbmVudE5hbWV9LmkxOG4uJHtsb2NhbGV9Lmpzb25gKSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICBpZiAocmVzdWx0Lm9rKVxuICAgICAgICByZXNvbHZlKHJlc3VsdC5qc29uKCkpO1xuICAgICAgZWxzZVxuICAgICAgICByZWplY3QoKTtcbiAgICB9LCAoKSA9PiByZWplY3QoKSk7XG4gIH0pO1xufVxuY29uc3Qgc3RyaW5nQ2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBsb2NhbGUpIHtcbiAgY29uc3QgaWQgPSBgJHtjb21wb25lbnROYW1lfSR7bG9jYWxlfWA7XG4gIGlmICghc3RyaW5nQ2FjaGVbaWRdKSB7XG4gICAgc3RyaW5nQ2FjaGVbaWRdID0gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSk7XG4gIH1cbiAgcmV0dXJuIHN0cmluZ0NhY2hlW2lkXTtcbn1cbi8qKlxuICogR2V0IHN0cmluZ3MgYW5kIGxhbmd1YWdlIGNvZGVzLlxuICogVGhpcyBtZXRob2QgcmV0dXJucyAyIGxhbmd1YWdlIGNvZGVzLlxuICogVGhlIGZpcnN0IG9uZSByZXR1cm5zIGEgY29kZSB0aGF0J3MgYWxzbyBzdXBwb3J0ZWQgYXMgYSBsYW5ndWFnZSBmaWxlLlxuICogVGhlIHNlY29uZCBvbmUgcmV0dXJucyBhIGNvZGUgd2hlcmUgdGhlcmUgaXMgc3VwcG9ydCBmb3IgdGhlIGZpcnN0IDIgbGV0dGVycyBvZiB0aGUgY29kZSBhcyBwYXJ0IG9mIGEgbGFuZ3VhZ2UgZmlsZSxcbiAqIGJ1dCB3aWxsIHJldHVybiB0aGUgb3JpZ2luYWwgNCBsZXR0ZXIgY29kZSBmcm9tIHRoZSBwYWdlLlxuICogRS5nLiBGb3IgXCJpdC1jaFwiIGl0IHdpbGwgcmV0dXJuIFwiaXRcIiBhcyB0aGUgZmlyc3QgbGFuZ3VhZ2UgY29kZSBhbmQgXCJpdC1jaFwiIGFzIHRoZSBzZWNvbmQuXG4gKiBUaGUgc2Vjb25kIG9uZSBpcyByZXF1aXJlZCBmb3IgZXNyaS5pbnRsLnNldExvY2FsZSgpIHRvIGdldCB0aGUgY29ycmVjdCBmb3JtYXR0aW5nLlxuICpcbiAqIElmIGEgdGFnTmFtZSBpcyBwcm92aWRlZCBpdCB3aWxsIG92ZXJ3aXRlIHRoZSBlbGVtZW50J3MgdGFnTmFtZVxuICpcbiAqICBAcmV0dXJuIFsgc3RyaW5ncywgZmlyc3QgbGFuZ3VhZ2UgY29kZSwgc2Vjb25kIGxhbmd1YWdlIGNvZGVdXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MoZWxlbWVudCwgdGFnTmFtZSkge1xuICBjb25zdCBjb21wb25lbnROYW1lID0gdGFnTmFtZSB8fCBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2UgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCk7XG4gIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlSW50bCA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCk7XG4gIGxldCBzdHJpbmdzO1xuICB0cnkge1xuICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgY29tcG9uZW50TGFuZ3VhZ2UpO1xuICB9XG4gIGNhdGNoIChlKSB7XG4gICAgY29uc29sZS53YXJuKGBubyBsb2NhbGUgZm9yICR7Y29tcG9uZW50TmFtZX0gKCR7Y29tcG9uZW50TGFuZ3VhZ2V9KSBsb2FkaW5nIGRlZmF1bHQgbG9jYWxlIGVuLmApO1xuICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgXCJlblwiKTtcbiAgfVxuICByZXR1cm4gW3N0cmluZ3MsIGNvbXBvbmVudExhbmd1YWdlLCBjb21wb25lbnRMYW5ndWFnZUludGxdO1xufVxuXG5leHBvcnQgeyBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UgYXMgYSwgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyBhcyBnIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGYgYXMgZnJvbUNhY2hlLCByIGFzIHJlcXVlc3QsIGcgYXMgZ2V0UmVzdEJhc2VVcmwgfSBmcm9tICcuL3BvcnRhbC03OWNhYWVmZi5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbmZpZ1N0YXRlIH0gZnJvbSAnLi9jb25maWctZWI1ZjdkYzIuanMnO1xuXG5hc3luYyBmdW5jdGlvbiBmZXRjaFVzZXIodXNlcm5hbWUsIHBvcnRhbCkge1xuICByZXR1cm4gcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfS9jb21tdW5pdHkvdXNlcnMvJHt1c2VybmFtZX1gKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoU2VsZigpIHtcbiAgcmV0dXJuIHJlcXVlc3QoYCR7Z2V0UmVzdEJhc2VVcmwoKX0vY29tbXVuaXR5L3NlbGZgKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldFNpZ25lZEluVXNlcnNHcm91cHMoKSB7XG4gIHZhciBfYTtcbiAgY29uc3QgdXNlciA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS51c2VyO1xuICBpZiAoIXVzZXIpIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgY29uc3Qgc2VsZiA9IGF3YWl0IGZyb21DYWNoZSgoKSA9PiBmZXRjaFNlbGYoKSwgXCJjb21tdW5pdHlTZWxmXCIsIHVzZXIudXNlcm5hbWUpO1xuICByZXR1cm4gKF9hID0gc2VsZiA9PT0gbnVsbCB8fCBzZWxmID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxmLmdyb3VwcykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogW107XG59XG5hc3luYyBmdW5jdGlvbiBnZXRTaWduZWRJblVzZXJzRmF2b3JpdGVzR3JvdXAoKSB7XG4gIGNvbnN0IHVzZXIgPSBjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUudXNlcjtcbiAgaWYgKCF1c2VyKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgY29uc3Qgc2VsZiA9IGF3YWl0IGZyb21DYWNoZSgoKSA9PiBmZXRjaFNlbGYoKSwgXCJjb21tdW5pdHlTZWxmXCIsIHVzZXIudXNlcm5hbWUpO1xuICByZXR1cm4gc2VsZi5mYXZHcm91cElkO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0VXNlckNvbnRlbnQocG9ydGFsVXNlcikge1xuICB2YXIgX2EsIF9iO1xuICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gIGNvbnN0IHBvcnRhbCA9IGNvbmZpZ1N0YXRlLnBvcnRhbDtcbiAgKF9iID0gdXNlci51c2VyQ29udGVudFVybCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogKHVzZXIudXNlckNvbnRlbnRVcmwgPSAocG9ydGFsID09PSBudWxsIHx8IHBvcnRhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9ydGFsLnJlc3RVcmwpICsgXCIvY29udGVudC91c2Vycy9cIiArIHBvcnRhbFVzZXIudXNlcm5hbWUpO1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXNlci51c2VyQ29udGVudFVybCwgeyBudW06IDEgfSk7XG4gIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzcG9uc2UpO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0Rm9sZGVycyhwb3J0YWxVc2VyKSB7XG4gIHZhciBfYTtcbiAgY29uc3QgdXNlciA9IChfYSA9IHBvcnRhbFVzZXIgIT09IG51bGwgJiYgcG9ydGFsVXNlciAhPT0gdm9pZCAwID8gcG9ydGFsVXNlciA6IGNvbmZpZ1N0YXRlLnVzZXIpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGNvbmZpZ1N0YXRlLnBvcnRhbC51c2VyO1xuICBjb25zdCB7IGZvbGRlcnMgfSA9IGF3YWl0IGdldFVzZXJDb250ZW50KHVzZXIpO1xuICBjb25zdCB7IHVzZXJuYW1lIH0gPSB1c2VyO1xuICAvLyBhZGQgdGhlIGhvbWUgZm9sZGVyIGFzIGlmIGl0J3MgaW4gdGhlIGxpc3RcbiAgcmV0dXJuIFt7IHVzZXJuYW1lLCBpZDogdXNlcm5hbWUsIHRpdGxlOiB1c2VybmFtZSwgY3JlYXRlZDogXCJub3dcIiB9LCAuLi5mb2xkZXJzXTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldEZvbGRlckZyb21JZChmb2xkZXJJZCwgcG9ydGFsVXNlcikge1xuICB2YXIgX2E7XG4gIGNvbnN0IHVzZXIgPSAoX2EgPSBwb3J0YWxVc2VyICE9PSBudWxsICYmIHBvcnRhbFVzZXIgIT09IHZvaWQgMCA/IHBvcnRhbFVzZXIgOiBjb25maWdTdGF0ZS51c2VyKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBjb25maWdTdGF0ZS5wb3J0YWwudXNlcjtcbiAgY29uc3QgZm9sZGVycyA9IGF3YWl0IGdldEZvbGRlcnModXNlcik7XG4gIHJldHVybiBmb2xkZXJzLmZpbmQoKGZvbGRlcikgPT4gZm9sZGVyLmlkID09PSBmb2xkZXJJZCk7XG59XG5mdW5jdGlvbiBnZXRIb21lRm9sZGVyRm9yVXNlcih1c2VybmFtZSkge1xuICByZXR1cm4geyB1c2VybmFtZSwgaWQ6IHVzZXJuYW1lLCB0aXRsZTogdXNlcm5hbWUsIGNyZWF0ZWQ6IFwibm93XCIgfTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUZvbGRlcihmb2xkZXJOYW1lLCBwb3J0YWxVc2VyKSB7XG4gIHZhciBfYTtcbiAgY29uc3QgdXNlciA9IChfYSA9IHBvcnRhbFVzZXIgIT09IG51bGwgJiYgcG9ydGFsVXNlciAhPT0gdm9pZCAwID8gcG9ydGFsVXNlciA6IGNvbmZpZ1N0YXRlLnVzZXIpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGNvbmZpZ1N0YXRlLnBvcnRhbC51c2VyO1xuICBjb25zdCB1cmwgPSBgJHt1c2VyLnVzZXJDb250ZW50VXJsfS9jcmVhdGVGb2xkZXJgO1xuICBjb25zdCBmb2xkZXJSZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsLCB7IHRpdGxlOiBmb2xkZXJOYW1lIH0sIHt9LCBcInBvc3RcIik7XG4gIHJldHVybiBmb2xkZXJSZXNwb25zZTtcbn1cblxuZXhwb3J0IHsgZ2V0U2lnbmVkSW5Vc2Vyc0dyb3VwcyBhcyBhLCBnZXRTaWduZWRJblVzZXJzRmF2b3JpdGVzR3JvdXAgYXMgYiwgY3JlYXRlRm9sZGVyIGFzIGMsIGdldEZvbGRlckZyb21JZCBhcyBkLCBnZXRIb21lRm9sZGVyRm9yVXNlciBhcyBlLCBmZXRjaFVzZXIgYXMgZiwgZ2V0Rm9sZGVycyBhcyBnIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=