"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-node_modules_esri_calcite-components-react_node_modules_esri_calcite-components_dist_-65d81a"],{

/***/ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/calcite-headless.js":
/*!*******************************************************************************************************************************!*\
  !*** ./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/calcite-headless.js ***!
  \*******************************************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CoreSizing15),
/* harmony export */   a: () => (/* binding */ CoreBreakpointWidthDefaultMd),
/* harmony export */   b: () => (/* binding */ CoreBreakpointWidthDefaultSm),
/* harmony export */   c: () => (/* binding */ CoreBreakpointWidthDefaultXs),
/* harmony export */   d: () => (/* binding */ CoreBreakpointWidthDefaultXxs),
/* harmony export */   e: () => (/* binding */ CoreBreakpointWidthDefaultLg)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.11.0
 */
/**
 * Do not edit directly
 * Generated on Tue, 21 Nov 2023 22:52:13 GMT
 */
const CoreSizing15 = "48px";
const CoreBreakpointWidthDefaultXxs = "320px";
const CoreBreakpointWidthDefaultXs = "476px";
const CoreBreakpointWidthDefaultSm = "768px";
const CoreBreakpointWidthDefaultMd = "1152px";
const CoreBreakpointWidthDefaultLg = "1440px";




/***/ }),

/***/ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/combobox.js":
/*!***********************************************************************************************************************!*\
  !*** ./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/combobox.js ***!
  \***********************************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ Combobox),
/* harmony export */   d: () => (/* binding */ defineCustomElement)
/* harmony export */ });
/* harmony import */ var _stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @stencil/core/internal/client/index.js */ "./node_modules/@esri/calcite-components-react/node_modules/@stencil/core/internal/client/index.js");
/* harmony import */ var _filter2_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./filter2.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/filter2.js");
/* harmony import */ var _dom_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/dom.js");
/* harmony import */ var _floating_ui_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./floating-ui.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/floating-ui.js");
/* harmony import */ var _form_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./form.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/form.js");
/* harmony import */ var _guid_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./guid.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/guid.js");
/* harmony import */ var _interactive_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./interactive.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/interactive.js");
/* harmony import */ var _label2_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./label2.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/label2.js");
/* harmony import */ var _loadable_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./loadable.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/loadable.js");
/* harmony import */ var _locale_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./locale.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/locale.js");
/* harmony import */ var _observers_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./observers.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/observers.js");
/* harmony import */ var _openCloseComponent_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./openCloseComponent.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/openCloseComponent.js");
/* harmony import */ var _t9n_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./t9n.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/t9n.js");
/* harmony import */ var _utils2_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./utils2.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/utils2.js");
/* harmony import */ var _component_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./component.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/component.js");
/* harmony import */ var _calcite_headless_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./calcite-headless.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/calcite-headless.js");
/* harmony import */ var _chip_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./chip.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/chip.js");
/* harmony import */ var _icon_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./icon.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/icon.js");
/* harmony import */ var _debounce_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./debounce.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/debounce.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.11.0
 */




















const CSS = {
  button: "x-button",
};
function XButton({ disabled, key, label, onClick, ref, scale, }) {
  return ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("button", { "aria-label": label, class: CSS.button, disabled: disabled, key: key, onClick: onClick, tabIndex: -1, type: "button", 
    // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
    ref: ref },
    (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("calcite-icon", { icon: "x", scale: (0,_component_js__WEBPACK_IMPORTED_MODULE_13__.g)(scale) })));
}

const comboboxCss = ":host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{position:relative;display:block}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host([scale=s]) .x-button{inline-size:1rem;block-size:1rem}:host([scale=m]) .x-button{inline-size:1.5rem;block-size:1.5rem}:host([scale=l]) .x-button{inline-size:2rem;block-size:2rem}.x-button{margin:0px;display:flex;cursor:pointer;appearance:none;align-content:center;align-items:center;justify-content:center;align-self:center;border-width:2px;background-color:transparent;color:var(--calcite-ui-text-3);outline-color:transparent;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;border-radius:50%;border-color:transparent;background-color:var(--calcite-ui-foreground-2)}.x-button:active,.x-button:hover{color:var(--calcite-ui-text-1);background-color:var(--calcite-ui-foreground-3)}.x-button:active{border-style:solid;border-color:var(--calcite-ui-brand)}.x-button calcite-icon{color:inherit}:host([scale=s]){font-size:var(--calcite-font-size--2);--calcite-combobox-item-spacing-unit-l:0.5rem;--calcite-combobox-item-spacing-unit-s:0.25rem;--calcite-combobox-input-height:1rem;--calcite-internal-combobox-input-margin-block:calc(0.25rem - 1px)}:host([scale=s]) .x-button{margin-inline:0.5rem}:host([scale=m]){font-size:var(--calcite-font-size--1);--calcite-combobox-item-spacing-unit-l:0.75rem;--calcite-combobox-item-spacing-unit-s:0.5rem;--calcite-combobox-input-height:1rem;--calcite-internal-combobox-input-margin-block:calc(0.5rem - 1px)}:host([scale=m]) .x-button{margin-inline-end:0.75rem}:host([scale=l]){font-size:var(--calcite-font-size-0);--calcite-combobox-item-spacing-unit-l:1rem;--calcite-combobox-item-spacing-unit-s:0.75rem;--calcite-combobox-input-height:1.5rem;--calcite-internal-combobox-input-margin-block:calc(0.625rem - 1px)}:host([scale=l]) .x-button{margin-inline-end:1rem}.wrapper{display:flex;border-width:1px;border-style:solid;border-color:var(--calcite-ui-border-input);background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-1);outline-color:transparent;padding-block:calc(var(--calcite-combobox-item-spacing-unit-s) / 4);padding-inline:var(--calcite-combobox-item-spacing-unit-l)}:host(:focus-within) .wrapper,.wrapper--active{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(\n            -2px *\n            calc(\n              1 -\n              2 * clamp(\n                0,\n                var(--calcite-ui-focus-offset-invert),\n                1\n              )\n            )\n          )}.wrapper--single{padding-block:0;padding-inline:var(--calcite-combobox-item-spacing-unit-l);cursor:pointer;flex-wrap:nowrap}.grid-input{position:relative;display:flex;flex-grow:1;flex-wrap:wrap;align-items:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:0px;gap:var(--calcite-combobox-item-spacing-unit-s)}.grid-input.selection-display-fit,.grid-input.selection-display-single{flex-wrap:nowrap;overflow:hidden}.input{flex-grow:1;appearance:none;text-overflow:ellipsis;border-style:none;background-color:transparent;padding:0px;font-family:inherit;color:var(--calcite-ui-text-1);font-size:inherit;block-size:var(--calcite-combobox-input-height);line-height:var(--calcite-combobox-input-height);inline-size:100%;margin-block-end:var(--calcite-combobox-item-spacing-unit-s);min-inline-size:4.8125rem}.input:focus{outline:2px solid transparent;outline-offset:2px}.input:placeholder-shown{text-overflow:ellipsis}.input--transparent{opacity:0}.input--single{padding:0px;margin-block:var(--calcite-internal-combobox-input-margin-block)}.wrapper--active .input-single{cursor:text}.input--hidden{pointer-events:none;inline-size:0px;min-inline-size:0px;opacity:0}.input--icon{padding-block:0;padding-inline:var(--calcite-combobox-item-spacing-unit-s)}:host([scale=m]) .input--icon,:host([scale=l]) .input--icon{padding-inline:0.25rem}.input-wrap{display:flex;flex-grow:1;align-items:center}.input-wrap--single{flex:1 1 0%;overflow:hidden}.label{pointer-events:none;display:flex;max-inline-size:100%;flex:1 1 auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:0px;font-weight:var(--calcite-font-weight-normal);block-size:var(--calcite-combobox-input-height);line-height:var(--calcite-combobox-input-height)}.label--icon{padding-inline:var(--calcite-combobox-item-spacing-unit-l)}.icon-end,.icon-start{display:flex;cursor:pointer;align-items:center}.icon-end{flex:none}.floating-ui-container{--calcite-floating-ui-z-index:var(--calcite-app-z-index-dropdown);display:block;position:absolute;z-index:var(--calcite-floating-ui-z-index);visibility:hidden}.floating-ui-container .calcite-floating-ui-anim{position:relative;transition:var(--calcite-floating-ui-transition);transition-property:transform, visibility, opacity;opacity:0;box-shadow:0 0 16px 0 rgba(0, 0, 0, 0.16);z-index:var(--calcite-app-z-index);border-radius:0.25rem}.floating-ui-container[data-placement^=bottom] .calcite-floating-ui-anim{transform:translateY(-5px)}.floating-ui-container[data-placement^=top] .calcite-floating-ui-anim{transform:translateY(5px)}.floating-ui-container[data-placement^=left] .calcite-floating-ui-anim{transform:translateX(5px)}.floating-ui-container[data-placement^=right] .calcite-floating-ui-anim{transform:translateX(-5px)}.floating-ui-container[data-placement] .calcite-floating-ui-anim--active{opacity:1;transform:translate(0)}.floating-ui-container--active{visibility:visible}@media (forced-colors: active){.wrapper,.floating-ui-container--active{border:1px solid canvasText}}.screen-readers-only{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.list-container{max-block-size:45vh;overflow-y:auto;background-color:var(--calcite-ui-foreground-1);inline-size:var(--calcite-dropdown-width)}.list{margin:0px;display:block;padding:0px}.list--hide{block-size:0px;overflow:hidden}calcite-chip{--calcite-animation-timing:0}.chip{margin-block:calc(var(--calcite-combobox-item-spacing-unit-s) / 4);max-inline-size:100%}.chip--active{background-color:var(--calcite-ui-foreground-3)}.chip--invisible{visibility:hidden;position:absolute}.item{display:block}::slotted(input[slot=hidden-form-input]){margin:0 !important;opacity:0 !important;outline:none !important;padding:0 !important;position:absolute !important;inset:0 !important;transform:none !important;-webkit-appearance:none !important;z-index:-1 !important}:host([hidden]){display:none}[hidden]{display:none}::slotted(calcite-combobox-item-group:not(:first-child)){padding-block-start:var(--calcite-combobox-item-spacing-unit-l)}";

const isGroup = (el) => el.tagName === _utils2_js__WEBPACK_IMPORTED_MODULE_12__.f;
const itemUidPrefix = "combobox-item-";
const chipUidPrefix = "combobox-chip-";
const labelUidPrefix = "combobox-label-";
const listboxUidPrefix = "combobox-listbox-";
const inputUidPrefix = "combobox-input-";
const Combobox = /*@__PURE__*/ (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.proxyCustomElement)(class extends _stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.HTMLElement {
  constructor() {
    super();
    this.__registerHost();
    this.__attachShadow();
    this.calciteComboboxChange = (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.createEvent)(this, "calciteComboboxChange", 6);
    this.calciteComboboxFilterChange = (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.createEvent)(this, "calciteComboboxFilterChange", 6);
    this.calciteComboboxChipClose = (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.createEvent)(this, "calciteComboboxChipClose", 6);
    this.calciteComboboxBeforeClose = (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.createEvent)(this, "calciteComboboxBeforeClose", 6);
    this.calciteComboboxClose = (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.createEvent)(this, "calciteComboboxClose", 6);
    this.calciteComboboxBeforeOpen = (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.createEvent)(this, "calciteComboboxBeforeOpen", 6);
    this.calciteComboboxOpen = (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.createEvent)(this, "calciteComboboxOpen", 6);
    this.placement = _floating_ui_js__WEBPACK_IMPORTED_MODULE_2__.d;
    this.internalValueChangeFlag = false;
    this.textInput = null;
    this.mutationObserver = (0,_observers_js__WEBPACK_IMPORTED_MODULE_9__.c)("mutation", () => this.updateItems());
    this.resizeObserver = (0,_observers_js__WEBPACK_IMPORTED_MODULE_9__.c)("resize", () => {
      this.setMaxScrollerHeight();
      this.refreshSelectionDisplay();
    });
    this.guid = (0,_guid_js__WEBPACK_IMPORTED_MODULE_4__.g)();
    this.inputHeight = 0;
    this.ignoreSelectedEventsFlag = false;
    this.openTransitionProp = "opacity";
    this.setFilteredPlacements = () => {
      const { el, flipPlacements } = this;
      this.filteredFlipPlacements = flipPlacements
        ? (0,_floating_ui_js__WEBPACK_IMPORTED_MODULE_2__.f)(flipPlacements, el)
        : null;
    };
    this.getValue = () => {
      const items = this.selectedItems.map((item) => item?.value?.toString());
      return items?.length ? (items.length > 1 ? items : items[0]) : "";
    };
    this.onLabelClick = () => {
      this.setFocus();
    };
    this.keyDownHandler = (event) => {
      const { key } = event;
      switch (key) {
        case "Tab":
          this.activeChipIndex = -1;
          this.activeItemIndex = -1;
          if (this.allowCustomValues && this.text) {
            this.addCustomChip(this.text, true);
            event.preventDefault();
          }
          else if (this.open) {
            this.open = false;
            event.preventDefault();
          }
          else if (!this.allowCustomValues && this.text) {
            this.clearInputValue();
            this.filterItems("");
            this.updateActiveItemIndex(-1);
          }
          break;
        case "ArrowLeft":
          this.previousChip();
          event.preventDefault();
          break;
        case "ArrowRight":
          this.nextChip();
          event.preventDefault();
          break;
        case "ArrowUp":
          event.preventDefault();
          if (this.open) {
            this.shiftActiveItemIndex(-1);
          }
          if (!this.comboboxInViewport()) {
            this.el.scrollIntoView();
          }
          break;
        case "ArrowDown":
          event.preventDefault();
          if (this.open) {
            this.shiftActiveItemIndex(1);
          }
          else {
            this.open = true;
            this.ensureRecentSelectedItemIsActive();
          }
          if (!this.comboboxInViewport()) {
            this.el.scrollIntoView();
          }
          break;
        case " ":
          if (!this.textInput.value) {
            if (!this.open) {
              this.open = true;
              this.shiftActiveItemIndex(1);
            }
            event.preventDefault();
          }
          break;
        case "Home":
          if (!this.open) {
            return;
          }
          event.preventDefault();
          this.updateActiveItemIndex(0);
          this.scrollToActiveItem();
          if (!this.comboboxInViewport()) {
            this.el.scrollIntoView();
          }
          break;
        case "End":
          if (!this.open) {
            return;
          }
          event.preventDefault();
          this.updateActiveItemIndex(this.filteredItems.length - 1);
          this.scrollToActiveItem();
          if (!this.comboboxInViewport()) {
            this.el.scrollIntoView();
          }
          break;
        case "Escape":
          if (!this.clearDisabled && !this.open) {
            this.clearValue();
          }
          this.open = false;
          event.preventDefault();
          break;
        case "Enter":
          if (this.activeItemIndex > -1) {
            this.toggleSelection(this.filteredItems[this.activeItemIndex]);
            event.preventDefault();
          }
          else if (this.activeChipIndex > -1) {
            this.removeActiveChip();
            event.preventDefault();
          }
          else if (this.allowCustomValues && this.text) {
            this.addCustomChip(this.text, true);
            event.preventDefault();
          }
          else if (!event.defaultPrevented) {
            if ((0,_form_js__WEBPACK_IMPORTED_MODULE_3__.s)(this)) {
              event.preventDefault();
            }
          }
          break;
        case "Delete":
        case "Backspace":
          if (this.activeChipIndex > -1) {
            event.preventDefault();
            this.removeActiveChip();
          }
          else if (!this.text && this.isMulti()) {
            event.preventDefault();
            this.removeLastChip();
          }
          break;
      }
    };
    this.toggleCloseEnd = () => {
      this.open = false;
      this.el.removeEventListener("calciteComboboxClose", this.toggleCloseEnd);
    };
    this.toggleOpenEnd = () => {
      this.open = false;
      this.el.removeEventListener("calciteComboboxOpen", this.toggleOpenEnd);
    };
    this.setMaxScrollerHeight = async () => {
      const { listContainerEl, open, referenceEl } = this;
      if (!listContainerEl || !open) {
        return;
      }
      await this.reposition(true);
      const maxScrollerHeight = this.getMaxScrollerHeight();
      listContainerEl.style.maxHeight = maxScrollerHeight > 0 ? `${maxScrollerHeight}px` : "";
      listContainerEl.style.minWidth = `${referenceEl.clientWidth}px`;
      await this.reposition(true);
    };
    this.calciteChipCloseHandler = (comboboxItem) => {
      this.open = false;
      const selection = this.items.find((item) => item === comboboxItem);
      if (selection) {
        this.toggleSelection(selection, false);
      }
      this.calciteComboboxChipClose.emit();
    };
    this.clickHandler = (event) => {
      const composedPath = event.composedPath();
      if (composedPath.some((node) => node.tagName === "CALCITE-CHIP")) {
        this.open = false;
        event.preventDefault();
        return;
      }
      if (composedPath.some((node) => node.classList?.contains(CSS.button))) {
        this.clearValue();
        event.preventDefault();
        return;
      }
      this.open = !this.open;
      this.ensureRecentSelectedItemIsActive();
    };
    this.refreshSelectionDisplay = async () => {
      await (0,_loadable_js__WEBPACK_IMPORTED_MODULE_7__.b)(this);
      if ((0,_utils2_js__WEBPACK_IMPORTED_MODULE_12__.i)(this.selectionMode)) {
        return;
      }
      if (!this.textInput) {
        return;
      }
      const { allSelectedIndicatorChipEl, chipContainerEl, selectionDisplay, placeholder, selectedIndicatorChipEl, textInput, } = this;
      const chipContainerElGap = parseInt(getComputedStyle(chipContainerEl).gap.replace("px", ""));
      const chipContainerElWidth = (0,_dom_js__WEBPACK_IMPORTED_MODULE_1__.u)(chipContainerEl);
      const { fontSize, fontFamily } = getComputedStyle(textInput);
      const inputTextWidth = (0,_dom_js__WEBPACK_IMPORTED_MODULE_1__.v)(placeholder, `${fontSize} ${fontFamily}`);
      const inputWidth = (inputTextWidth || parseInt(_calcite_headless_js__WEBPACK_IMPORTED_MODULE_14__.C)) + chipContainerElGap;
      const allSelectedIndicatorChipElWidth = (0,_dom_js__WEBPACK_IMPORTED_MODULE_1__.u)(allSelectedIndicatorChipEl);
      const selectedIndicatorChipElWidth = (0,_dom_js__WEBPACK_IMPORTED_MODULE_1__.u)(selectedIndicatorChipEl);
      const largestSelectedIndicatorChipWidth = Math.max(allSelectedIndicatorChipElWidth, selectedIndicatorChipElWidth);
      this.setCompactSelectionDisplay({
        chipContainerElGap,
        chipContainerElWidth,
        inputWidth,
        largestSelectedIndicatorChipWidth,
      });
      if (selectionDisplay === "fit") {
        const chipEls = Array.from(this.el.shadowRoot.querySelectorAll("calcite-chip")).filter((chipEl) => chipEl.closable);
        const availableHorizontalChipElSpace = Math.round(chipContainerElWidth -
          ((this.selectedHiddenChipsCount > 0 ? selectedIndicatorChipElWidth : 0) +
            chipContainerElGap +
            inputWidth +
            chipContainerElGap));
        this.refreshChipDisplay({ availableHorizontalChipElSpace, chipContainerElGap, chipEls });
        this.setVisibleAndHiddenChips(chipEls);
      }
    };
    this.setFloatingEl = (el) => {
      this.floatingEl = el;
      (0,_floating_ui_js__WEBPACK_IMPORTED_MODULE_2__.c)(this, this.referenceEl, this.floatingEl);
    };
    this.setContainerEl = (el) => {
      this.resizeObserver.observe(el);
      this.listContainerEl = el;
      this.transitionEl = el;
    };
    this.setChipContainerEl = (el) => {
      this.resizeObserver.observe(el);
      this.chipContainerEl = el;
    };
    this.setReferenceEl = (el) => {
      this.referenceEl = el;
      (0,_floating_ui_js__WEBPACK_IMPORTED_MODULE_2__.c)(this, this.referenceEl, this.floatingEl);
    };
    this.setAllSelectedIndicatorChipEl = (el) => {
      this.allSelectedIndicatorChipEl = el;
    };
    this.setSelectedIndicatorChipEl = (el) => {
      this.selectedIndicatorChipEl = el;
    };
    this.inputHandler = (event) => {
      const value = event.target.value;
      this.text = value;
      this.filterItems(value);
      if (value) {
        this.activeChipIndex = -1;
      }
    };
    this.filterItems = (() => {
      const find = (item, filteredData) => item &&
        filteredData.some(({ label, value }) => isGroup(item) ? label === item.label : value === item.value && label === item.textLabel);
      return (0,_debounce_js__WEBPACK_IMPORTED_MODULE_17__.d)((text) => {
        const filteredData = (0,_filter2_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.data, text);
        const itemsAndGroups = this.getItemsAndGroups();
        itemsAndGroups.forEach((item) => {
          const hidden = !find(item, filteredData);
          item.hidden = hidden;
          const [parent, grandparent] = item.ancestors;
          if (find(parent, filteredData) || find(grandparent, filteredData)) {
            item.hidden = false;
          }
          if (!hidden) {
            item.ancestors.forEach((ancestor) => (ancestor.hidden = false));
          }
        });
        this.filteredItems = this.getFilteredItems();
        this.calciteComboboxFilterChange.emit();
      }, 100);
    })();
    this.internalComboboxChangeEvent = () => {
      this.calciteComboboxChange.emit();
    };
    this.emitComboboxChange = (0,_debounce_js__WEBPACK_IMPORTED_MODULE_17__.d)(this.internalComboboxChangeEvent, 0);
    this.getSelectedItems = () => {
      if (!this.isMulti()) {
        const match = this.items.find(({ selected }) => selected);
        return match ? [match] : [];
      }
      return (this.items
        .filter((item) => item.selected && (this.selectionMode !== "ancestors" || !(0,_utils2_js__WEBPACK_IMPORTED_MODULE_12__.h)(item)))
        /** Preserve order of entered tags */
        .sort((a, b) => {
        const aIdx = this.selectedItems.indexOf(a);
        const bIdx = this.selectedItems.indexOf(b);
        if (aIdx > -1 && bIdx > -1) {
          return aIdx - bIdx;
        }
        return bIdx - aIdx;
      }));
    };
    this.updateItems = () => {
      this.items = this.getItems();
      this.groupItems = this.getGroupItems();
      this.data = this.getData();
      this.selectedItems = this.getSelectedItems();
      this.filteredItems = this.getFilteredItems();
      this.needsIcon = this.getNeedsIcon();
      this.items.forEach((item) => {
        item.selectionMode = this.selectionMode;
        item.scale = this.scale;
      });
      if (!this.allowCustomValues) {
        this.setMaxScrollerHeight();
      }
      this.groupItems.forEach((groupItem, index, items) => {
        if (index === 0) {
          groupItem.afterEmptyGroup = false;
        }
        const nextGroupItem = items[index + 1];
        if (nextGroupItem) {
          nextGroupItem.afterEmptyGroup = groupItem.children.length === 0;
        }
      });
    };
    this.scrollToActiveItem = () => {
      const activeItem = this.filteredItems[this.activeItemIndex];
      if (!activeItem) {
        return;
      }
      const height = this.calculateSingleItemHeight(activeItem);
      const { offsetHeight, scrollTop } = this.listContainerEl;
      if (offsetHeight + scrollTop < activeItem.offsetTop + height) {
        this.listContainerEl.scrollTop = activeItem.offsetTop - offsetHeight + height;
      }
      else if (activeItem.offsetTop < scrollTop) {
        this.listContainerEl.scrollTop = activeItem.offsetTop;
      }
    };
    this.comboboxFocusHandler = () => {
      if (this.disabled) {
        return;
      }
      this.textInput?.focus();
    };
    this.clearDisabled = false;
    this.selectionDisplay = "all";
    this.open = false;
    this.disabled = false;
    this.form = undefined;
    this.label = undefined;
    this.placeholder = undefined;
    this.placeholderIcon = undefined;
    this.placeholderIconFlipRtl = false;
    this.maxItems = 0;
    this.name = undefined;
    this.allowCustomValues = undefined;
    this.overlayPositioning = "absolute";
    this.required = false;
    this.selectionMode = "multiple";
    this.scale = "m";
    this.value = null;
    this.flipPlacements = undefined;
    this.messages = undefined;
    this.messageOverrides = undefined;
    this.selectedItems = [];
    this.filteredItems = [];
    this.items = [];
    this.groupItems = [];
    this.needsIcon = undefined;
    this.activeItemIndex = -1;
    this.activeChipIndex = -1;
    this.activeDescendant = "";
    this.compactSelectionDisplay = false;
    this.selectedHiddenChipsCount = 0;
    this.selectedVisibleChipsCount = 0;
    this.text = "";
    this.effectiveLocale = undefined;
    this.defaultMessages = undefined;
  }
  openHandler() {
    (0,_openCloseComponent_js__WEBPACK_IMPORTED_MODULE_10__.o)(this);
    if (this.disabled) {
      this.open = false;
      return;
    }
    this.setMaxScrollerHeight();
  }
  handleDisabledChange(value) {
    if (!value) {
      this.open = false;
    }
  }
  maxItemsHandler() {
    this.setMaxScrollerHeight();
  }
  overlayPositioningHandler() {
    this.reposition(true);
  }
  handlePropsChange() {
    this.updateItems();
  }
  valueHandler(value) {
    if (!this.internalValueChangeFlag) {
      const items = this.getItems();
      if (Array.isArray(value)) {
        items.forEach((item) => (item.selected = value.includes(item.value)));
      }
      else if (value) {
        items.forEach((item) => (item.selected = value === item.value));
      }
      else {
        items.forEach((item) => (item.selected = false));
      }
      this.updateItems();
    }
  }
  onMessagesChange() {
    /*  wired up by t9n util */
  }
  flipPlacementsHandler() {
    this.setFilteredPlacements();
    this.reposition(true);
  }
  selectedItemsHandler() {
    this.internalValueChangeFlag = true;
    this.value = this.getValue();
    this.internalValueChangeFlag = false;
  }
  //--------------------------------------------------------------------------
  //
  //  Event Listeners
  //
  //--------------------------------------------------------------------------
  documentClickHandler(event) {
    if (this.disabled || !(0,_dom_js__WEBPACK_IMPORTED_MODULE_1__.j)(event)) {
      return;
    }
    const composedPath = event.composedPath();
    if (composedPath.includes(this.el) || composedPath.includes(this.referenceEl)) {
      return;
    }
    if (!this.allowCustomValues && this.textInput.value) {
      this.clearInputValue();
      this.filterItems("");
      this.updateActiveItemIndex(-1);
    }
    if (this.allowCustomValues && this.text.trim().length) {
      this.addCustomChip(this.text);
    }
    this.open = false;
  }
  calciteComboboxItemChangeHandler(event) {
    if (this.ignoreSelectedEventsFlag) {
      return;
    }
    const target = event.target;
    const newIndex = this.filteredItems.indexOf(target);
    this.updateActiveItemIndex(newIndex);
    this.toggleSelection(target, target.selected);
  }
  //--------------------------------------------------------------------------
  //
  //  Public Methods
  //
  //--------------------------------------------------------------------------
  /**
   * Updates the position of the component.
   *
   * @param delayed Reposition the component after a delay
   * @returns Promise
   */
  async reposition(delayed = false) {
    const { floatingEl, referenceEl, placement, overlayPositioning, filteredFlipPlacements } = this;
    return (0,_floating_ui_js__WEBPACK_IMPORTED_MODULE_2__.r)(this, {
      floatingEl,
      referenceEl,
      overlayPositioning,
      placement,
      flipPlacements: filteredFlipPlacements,
      type: "menu",
    }, delayed);
  }
  /** Sets focus on the component. */
  async setFocus() {
    await (0,_loadable_js__WEBPACK_IMPORTED_MODULE_7__.c)(this);
    this.textInput?.focus();
    this.activeChipIndex = -1;
    this.activeItemIndex = -1;
  }
  // --------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  // --------------------------------------------------------------------------
  connectedCallback() {
    (0,_interactive_js__WEBPACK_IMPORTED_MODULE_5__.c)(this);
    (0,_locale_js__WEBPACK_IMPORTED_MODULE_8__.c)(this);
    (0,_t9n_js__WEBPACK_IMPORTED_MODULE_11__.c)(this);
    (0,_label2_js__WEBPACK_IMPORTED_MODULE_6__.c)(this);
    (0,_form_js__WEBPACK_IMPORTED_MODULE_3__.c)(this);
    this.internalValueChangeFlag = true;
    this.value = this.getValue();
    this.internalValueChangeFlag = false;
    this.mutationObserver?.observe(this.el, { childList: true, subtree: true });
    this.updateItems();
    this.setFilteredPlacements();
    this.reposition(true);
    if (this.open) {
      this.openHandler();
      (0,_openCloseComponent_js__WEBPACK_IMPORTED_MODULE_10__.o)(this);
    }
  }
  async componentWillLoad() {
    (0,_loadable_js__WEBPACK_IMPORTED_MODULE_7__.a)(this);
    this.updateItems();
    await (0,_t9n_js__WEBPACK_IMPORTED_MODULE_11__.s)(this);
  }
  componentDidLoad() {
    (0,_form_js__WEBPACK_IMPORTED_MODULE_3__.a)(this, this.getValue());
    this.reposition(true);
    (0,_loadable_js__WEBPACK_IMPORTED_MODULE_7__.s)(this);
  }
  componentDidRender() {
    if (this.el.offsetHeight !== this.inputHeight) {
      this.reposition(true);
      this.inputHeight = this.el.offsetHeight;
    }
    (0,_interactive_js__WEBPACK_IMPORTED_MODULE_5__.u)(this);
  }
  componentDidUpdate() {
    this.refreshSelectionDisplay();
  }
  disconnectedCallback() {
    this.mutationObserver?.disconnect();
    this.resizeObserver?.disconnect();
    (0,_interactive_js__WEBPACK_IMPORTED_MODULE_5__.d)(this);
    (0,_label2_js__WEBPACK_IMPORTED_MODULE_6__.d)(this);
    (0,_form_js__WEBPACK_IMPORTED_MODULE_3__.d)(this);
    (0,_floating_ui_js__WEBPACK_IMPORTED_MODULE_2__.a)(this, this.referenceEl, this.floatingEl);
    (0,_locale_js__WEBPACK_IMPORTED_MODULE_8__.d)(this);
    (0,_t9n_js__WEBPACK_IMPORTED_MODULE_11__.d)(this);
  }
  /** when search text is cleared, reset active to  */
  textHandler() {
    this.updateActiveItemIndex(-1);
  }
  effectiveLocaleChange() {
    (0,_t9n_js__WEBPACK_IMPORTED_MODULE_11__.u)(this, this.effectiveLocale);
  }
  // --------------------------------------------------------------------------
  //
  //  Private Methods
  //
  // --------------------------------------------------------------------------
  clearValue() {
    this.ignoreSelectedEventsFlag = true;
    this.items.forEach((el) => (el.selected = false));
    this.ignoreSelectedEventsFlag = false;
    this.selectedItems = [];
    this.emitComboboxChange();
    this.open = false;
    this.updateActiveItemIndex(-1);
    this.resetText();
    this.filterItems("");
    this.setFocus();
  }
  clearInputValue() {
    this.textInput.value = "";
    this.text = "";
  }
  comboboxInViewport() {
    const bounding = this.el.getBoundingClientRect();
    return (bounding.top >= 0 &&
      bounding.left >= 0 &&
      bounding.right <= (window.innerWidth || document.documentElement.clientWidth) &&
      bounding.bottom <= (window.innerHeight || document.documentElement.clientHeight));
  }
  onBeforeOpen() {
    this.scrollToActiveItem();
    this.calciteComboboxBeforeOpen.emit();
  }
  onOpen() {
    this.calciteComboboxOpen.emit();
  }
  onBeforeClose() {
    this.calciteComboboxBeforeClose.emit();
  }
  onClose() {
    this.calciteComboboxClose.emit();
  }
  ensureRecentSelectedItemIsActive() {
    const { selectedItems } = this;
    const targetIndex = selectedItems.length === 0 ? 0 : this.items.indexOf(selectedItems[selectedItems.length - 1]);
    this.updateActiveItemIndex(targetIndex);
  }
  hideChip(chipEl) {
    chipEl.classList.add(_utils2_js__WEBPACK_IMPORTED_MODULE_12__.C.chipInvisible);
  }
  showChip(chipEl) {
    chipEl.classList.remove(_utils2_js__WEBPACK_IMPORTED_MODULE_12__.C.chipInvisible);
  }
  refreshChipDisplay({ chipEls, availableHorizontalChipElSpace, chipContainerElGap, }) {
    chipEls.forEach((chipEl) => {
      if (!chipEl.selected) {
        this.hideChip(chipEl);
      }
      else {
        const chipElWidth = (0,_dom_js__WEBPACK_IMPORTED_MODULE_1__.u)(chipEl);
        if (chipElWidth && chipElWidth < availableHorizontalChipElSpace) {
          availableHorizontalChipElSpace -= chipElWidth + chipContainerElGap;
          this.showChip(chipEl);
          return;
        }
      }
      this.hideChip(chipEl);
    });
  }
  setCompactSelectionDisplay({ chipContainerElGap, chipContainerElWidth, inputWidth, largestSelectedIndicatorChipWidth, }) {
    const newCompactBreakpoint = Math.round(largestSelectedIndicatorChipWidth + chipContainerElGap + inputWidth);
    if (!this.maxCompactBreakpoint || this.maxCompactBreakpoint < newCompactBreakpoint) {
      this.maxCompactBreakpoint = newCompactBreakpoint;
    }
    this.compactSelectionDisplay = chipContainerElWidth < this.maxCompactBreakpoint;
  }
  setVisibleAndHiddenChips(chipEls) {
    let newSelectedVisibleChipsCount = 0;
    chipEls.forEach((chipEl) => {
      if (chipEl.selected && !chipEl.classList.contains(_utils2_js__WEBPACK_IMPORTED_MODULE_12__.C.chipInvisible)) {
        newSelectedVisibleChipsCount++;
      }
    });
    if (newSelectedVisibleChipsCount !== this.selectedVisibleChipsCount) {
      this.selectedVisibleChipsCount = newSelectedVisibleChipsCount;
    }
    const newSelectedHiddenChipsCount = this.getSelectedItems().length - newSelectedVisibleChipsCount;
    if (newSelectedHiddenChipsCount !== this.selectedHiddenChipsCount) {
      this.selectedHiddenChipsCount = newSelectedHiddenChipsCount;
    }
  }
  getMaxScrollerHeight() {
    const items = this.getItemsAndGroups().filter((item) => !item.hidden);
    const { maxItems } = this;
    let itemsToProcess = 0;
    let maxScrollerHeight = 0;
    if (items.length > maxItems) {
      items.forEach((item) => {
        if (itemsToProcess < maxItems && maxItems > 0) {
          const height = this.calculateSingleItemHeight(item);
          if (height > 0) {
            maxScrollerHeight += height;
            itemsToProcess++;
          }
        }
      });
    }
    return maxScrollerHeight;
  }
  calculateSingleItemHeight(item) {
    if (!item) {
      return;
    }
    let height = item.offsetHeight;
    // if item has children items, don't count their height twice
    const children = Array.from(item.querySelectorAll(_utils2_js__WEBPACK_IMPORTED_MODULE_12__.b));
    children
      .map((child) => child?.offsetHeight)
      .forEach((offsetHeight) => {
      height -= offsetHeight;
    });
    return height;
  }
  getItemsAndGroups() {
    return [...this.groupItems, ...this.items];
  }
  toggleSelection(item, value = !item.selected) {
    if (!item ||
      (this.selectionMode === "single-persist" && item.selected && item.value === this.value)) {
      return;
    }
    if (this.isMulti()) {
      item.selected = value;
      this.updateAncestors(item);
      this.selectedItems = this.getSelectedItems();
      this.emitComboboxChange();
      this.resetText();
      this.filterItems("");
    }
    else {
      this.ignoreSelectedEventsFlag = true;
      this.items.forEach((el) => (el.selected = el === item ? value : false));
      this.ignoreSelectedEventsFlag = false;
      this.selectedItems = this.getSelectedItems();
      this.emitComboboxChange();
      if (this.textInput) {
        this.textInput.value = item.textLabel;
      }
      this.open = false;
      this.updateActiveItemIndex(-1);
      this.resetText();
      this.filterItems("");
    }
  }
  updateAncestors(item) {
    if (this.selectionMode !== "ancestors") {
      return;
    }
    const ancestors = (0,_utils2_js__WEBPACK_IMPORTED_MODULE_12__.c)(item);
    const children = (0,_utils2_js__WEBPACK_IMPORTED_MODULE_12__.d)(item);
    if (item.selected) {
      ancestors.forEach((el) => {
        el.selected = true;
      });
    }
    else {
      children.forEach((el) => (el.selected = false));
      [...ancestors].forEach((el) => {
        if (!(0,_utils2_js__WEBPACK_IMPORTED_MODULE_12__.h)(el)) {
          el.selected = false;
        }
      });
    }
  }
  getFilteredItems() {
    return this.items.filter((item) => !item.hidden);
  }
  getData() {
    return this.items.map((item) => ({
      filterDisabled: item.filterDisabled,
      value: item.value,
      label: item.textLabel,
    }));
  }
  getNeedsIcon() {
    return (0,_utils2_js__WEBPACK_IMPORTED_MODULE_12__.i)(this.selectionMode) && this.items.some((item) => item.icon);
  }
  resetText() {
    if (this.textInput) {
      this.textInput.value = "";
    }
    this.text = "";
  }
  getItems() {
    const items = Array.from(this.el.querySelectorAll(_utils2_js__WEBPACK_IMPORTED_MODULE_12__.e));
    return items.filter((item) => !item.disabled);
  }
  getGroupItems() {
    return Array.from(this.el.querySelectorAll(_utils2_js__WEBPACK_IMPORTED_MODULE_12__.f));
  }
  addCustomChip(value, focus) {
    const existingItem = this.items.find((el) => el.textLabel === value);
    if (existingItem) {
      this.toggleSelection(existingItem, true);
    }
    else {
      if (!this.isMulti()) {
        this.toggleSelection(this.selectedItems[this.selectedItems.length - 1], false);
      }
      const item = document.createElement(_utils2_js__WEBPACK_IMPORTED_MODULE_12__.e);
      item.value = value;
      item.textLabel = value;
      item.selected = true;
      this.el.appendChild(item);
      this.resetText();
      if (focus) {
        this.setFocus();
      }
      this.updateItems();
      this.filterItems("");
      this.emitComboboxChange();
    }
  }
  removeActiveChip() {
    this.toggleSelection(this.selectedItems[this.activeChipIndex], false);
    this.setFocus();
  }
  removeLastChip() {
    this.toggleSelection(this.selectedItems[this.selectedItems.length - 1], false);
    this.setFocus();
  }
  previousChip() {
    if (this.text) {
      return;
    }
    const length = this.selectedItems.length - 1;
    const active = this.activeChipIndex;
    this.activeChipIndex = active === -1 ? length : Math.max(active - 1, 0);
    this.updateActiveItemIndex(-1);
    this.focusChip();
  }
  nextChip() {
    if (this.text || this.activeChipIndex === -1) {
      return;
    }
    const last = this.selectedItems.length - 1;
    const newIndex = this.activeChipIndex + 1;
    if (newIndex > last) {
      this.activeChipIndex = -1;
      this.setFocus();
    }
    else {
      this.activeChipIndex = newIndex;
      this.focusChip();
    }
    this.updateActiveItemIndex(-1);
  }
  focusChip() {
    const guid = this.selectedItems[this.activeChipIndex]?.guid;
    const chip = guid
      ? this.referenceEl.querySelector(`#${chipUidPrefix}${guid}`)
      : null;
    chip?.setFocus();
  }
  shiftActiveItemIndex(delta) {
    const { length } = this.filteredItems;
    const newIndex = (this.activeItemIndex + length + delta) % length;
    this.updateActiveItemIndex(newIndex);
    this.scrollToActiveItem();
  }
  updateActiveItemIndex(index) {
    this.activeItemIndex = index;
    let activeDescendant = null;
    this.filteredItems.forEach((el, i) => {
      if (i === index) {
        el.active = true;
        activeDescendant = `${itemUidPrefix}${el.guid}`;
      }
      else {
        el.active = false;
      }
    });
    this.activeDescendant = activeDescendant;
    if (this.activeItemIndex > -1) {
      this.activeChipIndex = -1;
    }
  }
  isAllSelected() {
    return this.getItems().length === this.getSelectedItems().length;
  }
  isMulti() {
    return !(0,_utils2_js__WEBPACK_IMPORTED_MODULE_12__.i)(this.selectionMode);
  }
  //--------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  renderChips() {
    const { activeChipIndex, scale, selectionMode, messages } = this;
    return this.selectedItems.map((item, i) => {
      const chipClasses = {
        chip: true,
        "chip--active": activeChipIndex === i,
      };
      const ancestors = [...(0,_utils2_js__WEBPACK_IMPORTED_MODULE_12__.c)(item)].reverse();
      const pathLabel = [...ancestors, item].map((el) => el.textLabel);
      const label = selectionMode !== "ancestors" ? item.textLabel : pathLabel.join(" / ");
      return ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("calcite-chip", { class: chipClasses, closable: true, icon: item.icon, iconFlipRtl: item.iconFlipRtl, id: item.guid ? `${chipUidPrefix}${item.guid}` : null, key: item.textLabel, messageOverrides: { dismissLabel: messages.removeTag }, onCalciteChipClose: () => this.calciteChipCloseHandler(item), scale: scale, selected: item.selected, title: label, value: item.value }, label));
    });
  }
  renderAllSelectedIndicatorChip() {
    const { compactSelectionDisplay, scale, selectedVisibleChipsCount, setAllSelectedIndicatorChipEl, } = this;
    const label = this.messages.allSelected;
    return ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("calcite-chip", { class: {
        chip: true,
        [_utils2_js__WEBPACK_IMPORTED_MODULE_12__.C.chipInvisible]: !(this.isAllSelected() &&
          !selectedVisibleChipsCount &&
          !compactSelectionDisplay),
      }, scale: scale, title: label, value: "",
      // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
      ref: setAllSelectedIndicatorChipEl }, label));
  }
  renderAllSelectedIndicatorChipCompact() {
    const { compactSelectionDisplay, scale, selectedVisibleChipsCount } = this;
    const label = this.messages.all || "All";
    return ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("calcite-chip", { class: {
        chip: true,
        [_utils2_js__WEBPACK_IMPORTED_MODULE_12__.C.chipInvisible]: !(this.isAllSelected() &&
          !selectedVisibleChipsCount &&
          compactSelectionDisplay),
      }, scale: scale, title: label, value: "" }, label));
  }
  renderSelectedIndicatorChip() {
    const { compactSelectionDisplay, selectionDisplay, getSelectedItems, scale, selectedHiddenChipsCount, selectedVisibleChipsCount, setSelectedIndicatorChipEl, } = this;
    let chipInvisible;
    let label;
    if (compactSelectionDisplay) {
      chipInvisible = true;
    }
    else {
      if (selectionDisplay === "single") {
        const selectedItemsCount = getSelectedItems().length;
        if (this.isAllSelected()) {
          chipInvisible = true;
        }
        else if (selectedItemsCount > 0) {
          chipInvisible = false;
        }
        else {
          chipInvisible = true;
        }
        label = `${selectedItemsCount} ${this.messages.selected}`;
      }
      else if (selectionDisplay === "fit") {
        chipInvisible = !!((this.isAllSelected() && selectedVisibleChipsCount === 0) ||
          selectedHiddenChipsCount === 0);
        label =
          selectedVisibleChipsCount > 0
            ? `+${selectedHiddenChipsCount}`
            : `${selectedHiddenChipsCount} ${this.messages.selected}`;
      }
    }
    return ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("calcite-chip", { class: {
        chip: true,
        [_utils2_js__WEBPACK_IMPORTED_MODULE_12__.C.chipInvisible]: chipInvisible,
      }, scale: scale, title: label, value: "",
      // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
      ref: setSelectedIndicatorChipEl }, label));
  }
  renderSelectedIndicatorChipCompact() {
    const { compactSelectionDisplay, selectionDisplay, getSelectedItems, scale, selectedHiddenChipsCount, } = this;
    let chipInvisible;
    let label;
    if (compactSelectionDisplay) {
      const selectedItemsCount = getSelectedItems().length;
      if (this.isAllSelected()) {
        chipInvisible = true;
      }
      else if (selectionDisplay === "fit") {
        chipInvisible = !(selectedHiddenChipsCount > 0);
        label = `${selectedHiddenChipsCount || 0}`;
      }
      else if (selectionDisplay === "single") {
        chipInvisible = !(selectedItemsCount > 0);
        label = `${selectedItemsCount}`;
      }
    }
    else {
      chipInvisible = true;
    }
    return ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("calcite-chip", { class: {
        chip: true,
        [_utils2_js__WEBPACK_IMPORTED_MODULE_12__.C.chipInvisible]: chipInvisible,
      }, scale: scale, title: label, value: "" }, label));
  }
  renderInput() {
    const { guid, disabled, placeholder, selectionMode, selectedItems, open } = this;
    const single = (0,_utils2_js__WEBPACK_IMPORTED_MODULE_12__.i)(selectionMode);
    const selectedItem = selectedItems[0];
    const showLabel = !open && single && !!selectedItem;
    return ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("span", { class: {
        "input-wrap": true,
        "input-wrap--single": single,
      } }, showLabel && ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("span", { class: {
        label: true,
        "label--icon": !!selectedItem?.icon,
      }, key: "label" }, selectedItem.textLabel)), (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("input", { "aria-activedescendant": this.activeDescendant, "aria-autocomplete": "list", "aria-controls": `${listboxUidPrefix}${guid}`, "aria-label": (0,_label2_js__WEBPACK_IMPORTED_MODULE_6__.g)(this), class: {
        input: true,
        "input--single": true,
        "input--transparent": this.activeChipIndex > -1,
        "input--hidden": showLabel,
        "input--icon": !!this.placeholderIcon,
      }, disabled: disabled, id: `${inputUidPrefix}${guid}`, key: "input", onFocus: this.comboboxFocusHandler, onInput: this.inputHandler, placeholder: placeholder, type: "text",
      // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
      ref: (el) => (this.textInput = el) })));
  }
  renderListBoxOptions() {
    return this.filteredItems.map((item) => ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("li", { "aria-selected": (0,_dom_js__WEBPACK_IMPORTED_MODULE_1__.t)(item.selected), id: item.guid ? `${itemUidPrefix}${item.guid}` : null, role: "option", tabindex: "-1" }, item.textLabel)));
  }
  renderFloatingUIContainer() {
    const { setFloatingEl, setContainerEl, open } = this;
    const classes = {
      [_utils2_js__WEBPACK_IMPORTED_MODULE_12__.C.listContainer]: true,
      [_floating_ui_js__WEBPACK_IMPORTED_MODULE_2__.F.animation]: true,
      [_floating_ui_js__WEBPACK_IMPORTED_MODULE_2__.F.animationActive]: open,
    };
    return ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("div", { "aria-hidden": "true", class: {
        "floating-ui-container": true,
        "floating-ui-container--active": open,
      },
      // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
      ref: setFloatingEl }, (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("div", { class: classes,
      // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
      ref: setContainerEl }, (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("ul", { class: { list: true, "list--hide": !open } }, (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("slot", null)))));
  }
  renderIconStart() {
    const { selectedItems, placeholderIcon, selectionMode, placeholderIconFlipRtl } = this;
    const selectedItem = selectedItems[0];
    const selectedIcon = selectedItem?.icon;
    const singleSelectionMode = (0,_utils2_js__WEBPACK_IMPORTED_MODULE_12__.i)(selectionMode);
    const iconAtStart = !this.open && selectedItem
      ? !!selectedIcon && singleSelectionMode
      : !!this.placeholderIcon && (!selectedItem || singleSelectionMode);
    return (iconAtStart && ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("span", { class: "icon-start" }, (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("calcite-icon", { class: "selected-icon", flipRtl: this.open && selectedItem ? selectedItem.iconFlipRtl : placeholderIconFlipRtl, icon: !this.open && selectedItem ? selectedIcon : placeholderIcon, scale: (0,_component_js__WEBPACK_IMPORTED_MODULE_13__.g)(this.scale) }))));
  }
  renderIconEnd() {
    const { open } = this;
    return ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("span", { class: "icon-end" }, (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("calcite-icon", { icon: open ? "chevron-up" : "chevron-down", scale: (0,_component_js__WEBPACK_IMPORTED_MODULE_13__.g)(this.scale) })));
  }
  render() {
    const { selectionDisplay, guid, label, open } = this;
    const singleSelectionMode = (0,_utils2_js__WEBPACK_IMPORTED_MODULE_12__.i)(this.selectionMode);
    const allSelectionDisplay = selectionDisplay === "all";
    const singleSelectionDisplay = selectionDisplay === "single";
    const fitSelectionDisplay = !singleSelectionMode && selectionDisplay === "fit";
    const isClearable = !this.clearDisabled && this.value?.length > 0;
    return ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)(_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.Host, { onClick: this.comboboxFocusHandler }, (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("div", { "aria-autocomplete": "list", "aria-controls": `${listboxUidPrefix}${guid}`, "aria-expanded": (0,_dom_js__WEBPACK_IMPORTED_MODULE_1__.t)(open), "aria-haspopup": "listbox", "aria-label": (0,_label2_js__WEBPACK_IMPORTED_MODULE_6__.g)(this), "aria-live": "polite", "aria-owns": `${listboxUidPrefix}${guid}`, class: {
        wrapper: true,
        "wrapper--single": singleSelectionMode || !this.selectedItems.length,
        "wrapper--active": open,
      }, onClick: this.clickHandler, onKeyDown: this.keyDownHandler, role: "combobox",
      // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
      ref: this.setReferenceEl }, (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("div", { class: {
        "grid-input": true,
        [_utils2_js__WEBPACK_IMPORTED_MODULE_12__.C.selectionDisplayFit]: fitSelectionDisplay,
        [_utils2_js__WEBPACK_IMPORTED_MODULE_12__.C.selectionDisplaySingle]: singleSelectionDisplay,
      }, ref: this.setChipContainerEl }, this.renderIconStart(), !singleSelectionMode && !singleSelectionDisplay && this.renderChips(), !singleSelectionMode &&
      !allSelectionDisplay && [
      this.renderSelectedIndicatorChip(),
      this.renderSelectedIndicatorChipCompact(),
      this.renderAllSelectedIndicatorChip(),
      this.renderAllSelectedIndicatorChipCompact(),
    ], (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("label", { class: "screen-readers-only", htmlFor: `${inputUidPrefix}${guid}`, id: `${labelUidPrefix}${guid}` }, label), this.renderInput()), isClearable ? ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)(XButton, { disabled: this.disabled, key: "close-button", label: this.messages.clear, scale: this.scale })) : null, this.renderIconEnd()), (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)("ul", { "aria-labelledby": `${labelUidPrefix}${guid}`, "aria-multiselectable": "true", class: "screen-readers-only", id: `${listboxUidPrefix}${guid}`, role: "listbox", tabIndex: -1 }, this.renderListBoxOptions()), this.renderFloatingUIContainer(), (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_18__.h)(_form_js__WEBPACK_IMPORTED_MODULE_3__.H, { component: this })));
  }
  static get assetsDirs() { return ["assets"]; }
  get el() { return this; }
  static get watchers() { return {
    "open": ["openHandler"],
    "disabled": ["handleDisabledChange"],
    "maxItems": ["maxItemsHandler"],
    "overlayPositioning": ["overlayPositioningHandler"],
    "selectionMode": ["handlePropsChange"],
    "scale": ["handlePropsChange"],
    "value": ["valueHandler"],
    "messageOverrides": ["onMessagesChange"],
    "flipPlacements": ["flipPlacementsHandler"],
    "selectedItems": ["selectedItemsHandler"],
    "text": ["textHandler"],
    "effectiveLocale": ["effectiveLocaleChange"]
  }; }
  static get style() { return comboboxCss; }
}, [1, "calcite-combobox", {
    "clearDisabled": [516, "clear-disabled"],
    "selectionDisplay": [513, "selection-display"],
    "open": [1540],
    "disabled": [516],
    "form": [513],
    "label": [1],
    "placeholder": [1],
    "placeholderIcon": [513, "placeholder-icon"],
    "placeholderIconFlipRtl": [516, "placeholder-icon-flip-rtl"],
    "maxItems": [514, "max-items"],
    "name": [513],
    "allowCustomValues": [516, "allow-custom-values"],
    "overlayPositioning": [513, "overlay-positioning"],
    "required": [516],
    "selectionMode": [513, "selection-mode"],
    "scale": [513],
    "value": [1025],
    "flipPlacements": [16],
    "messages": [1040],
    "messageOverrides": [1040],
    "selectedItems": [1040],
    "filteredItems": [1040],
    "items": [32],
    "groupItems": [32],
    "needsIcon": [32],
    "activeItemIndex": [32],
    "activeChipIndex": [32],
    "activeDescendant": [32],
    "compactSelectionDisplay": [32],
    "selectedHiddenChipsCount": [32],
    "selectedVisibleChipsCount": [32],
    "text": [32],
    "effectiveLocale": [32],
    "defaultMessages": [32],
    "reposition": [64],
    "setFocus": [64]
  }, [[5, "pointerdown", "documentClickHandler"], [0, "calciteComboboxItemChange", "calciteComboboxItemChangeHandler"]]]);
function defineCustomElement() {
  if (typeof customElements === "undefined") {
    return;
  }
  const components = ["calcite-combobox", "calcite-chip", "calcite-icon"];
  components.forEach(tagName => { switch (tagName) {
    case "calcite-combobox":
      if (!customElements.get(tagName)) {
        customElements.define(tagName, Combobox);
      }
      break;
    case "calcite-chip":
      if (!customElements.get(tagName)) {
        (0,_chip_js__WEBPACK_IMPORTED_MODULE_15__.d)();
      }
      break;
    case "calcite-icon":
      if (!customElements.get(tagName)) {
        (0,_icon_js__WEBPACK_IMPORTED_MODULE_16__.d)();
      }
      break;
  } });
}
defineCustomElement();




/***/ }),

/***/ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/utils2.js":
/*!*********************************************************************************************************************!*\
  !*** ./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/utils2.js ***!
  \*********************************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS),
/* harmony export */   a: () => (/* binding */ getDepth),
/* harmony export */   b: () => (/* binding */ ComboboxChildSelector),
/* harmony export */   c: () => (/* binding */ getItemAncestors),
/* harmony export */   d: () => (/* binding */ getItemChildren),
/* harmony export */   e: () => (/* binding */ ComboboxItem),
/* harmony export */   f: () => (/* binding */ ComboboxItemGroup),
/* harmony export */   g: () => (/* binding */ getAncestors),
/* harmony export */   h: () => (/* binding */ hasActiveChildren),
/* harmony export */   i: () => (/* binding */ isSingleLike)
/* harmony export */ });
/* harmony import */ var _dom_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/dom.js");
/* harmony import */ var _stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @stencil/core/internal/client/index.js */ "./node_modules/@esri/calcite-components-react/node_modules/@stencil/core/internal/client/index.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.11.0
 */



const ComboboxItem = "CALCITE-COMBOBOX-ITEM";
const ComboboxItemGroup = "CALCITE-COMBOBOX-ITEM-GROUP";
const ComboboxChildSelector = `${ComboboxItem}, ${ComboboxItemGroup}`;
const CSS = {
  chipInvisible: "chip--invisible",
  selectionDisplayFit: "selection-display-fit",
  selectionDisplaySingle: "selection-display-single",
  listContainer: "list-container",
};

function getAncestors(element) {
  const parent = element.parentElement?.closest(ComboboxChildSelector);
  const grandparent = parent?.parentElement?.closest(ComboboxChildSelector);
  return [parent, grandparent].filter((el) => el);
}
function getItemAncestors(item) {
  return (item.ancestors?.filter((el) => el.nodeName === "CALCITE-COMBOBOX-ITEM") || []);
}
function getItemChildren(item) {
  return (0,_dom_js__WEBPACK_IMPORTED_MODULE_0__.o)(item.querySelectorAll("calcite-combobox-item"));
}
function hasActiveChildren(node) {
  const items = (0,_dom_js__WEBPACK_IMPORTED_MODULE_0__.o)(node.querySelectorAll("calcite-combobox-item"));
  return items.filter((item) => item.selected).length > 0;
}
function getDepth(element) {
  if (!_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_1__.Build.isBrowser) {
    return 0;
  }
  const result = document.evaluate("ancestor::calcite-combobox-item | ancestor::calcite-combobox-item-group", element, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
  return result.snapshotLength;
}
function isSingleLike(selectionMode) {
  return selectionMode.includes("single");
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvdmVuZG9ycy1ub2RlX21vZHVsZXNfZXNyaV9jYWxjaXRlLWNvbXBvbmVudHMtcmVhY3Rfbm9kZV9tb2R1bGVzX2VzcmlfY2FsY2l0ZS1jb21wb25lbnRzX2Rpc3RfLTY1ZDgxYS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRTZNOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ2hCN007QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUMrRztBQUNwRTtBQUN5RTtBQUM4RDtBQUNuQztBQUN6RztBQUM2RTtBQUMxQjtBQUMyQztBQUN0RDtBQUN6QjtBQUNxQjtBQUN3QztBQUNzRjtBQUNySjtBQUNPO0FBQ0g7QUFDQTtBQUNUOztBQUU5QztBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsNENBQTRDO0FBQy9ELFVBQVUsMEVBQUMsYUFBYTtBQUN4QjtBQUNBLGNBQWM7QUFDZCxJQUFJLDBFQUFDLG1CQUFtQixrQkFBa0IsaURBQVksU0FBUztBQUMvRDs7QUFFQSx1Q0FBdUMsZUFBZSx5QkFBeUIsaUJBQWlCLDJDQUEyQyxtREFBbUQsb0JBQW9CLE1BQU0sa0JBQWtCLGNBQWMseUdBQXlHLFVBQVUsMkJBQTJCLGlCQUFpQixnQkFBZ0IsMkJBQTJCLG1CQUFtQixrQkFBa0IsMkJBQTJCLGlCQUFpQixnQkFBZ0IsVUFBVSxXQUFXLGFBQWEsZUFBZSxnQkFBZ0IscUJBQXFCLG1CQUFtQix1QkFBdUIsa0JBQWtCLGlCQUFpQiw2QkFBNkIsK0JBQStCLDBCQUEwQiw2RkFBNkYsa0JBQWtCLHlCQUF5QixnREFBZ0QsaUNBQWlDLCtCQUErQixnREFBZ0QsaUJBQWlCLG1CQUFtQixxQ0FBcUMsdUJBQXVCLGNBQWMsaUJBQWlCLHNDQUFzQyw4Q0FBOEMsK0NBQStDLHFDQUFxQyxtRUFBbUUsMkJB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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLDBEQUEwQjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLDBDQUFzQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksaUZBQWlGO0FBQzdGLFdBQVcsa0RBQVU7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFVBQVUsK0NBQWtCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxrREFBa0I7QUFDdEIsSUFBSSw2Q0FBZ0I7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RUFBa0UsMEVBQUMsQ0FBQyx1Q0FBbUIsSUFBSSxpQkFBaUI7QUFDcmxCO0FBQ0EsNEJBQTRCO0FBQzVCLGFBQWE7QUFDYiwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkIsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSw0Q0FBcUI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLDRDQUFxQjtBQUM3QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRW1EOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ2hvQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDZ0Q7QUFDZTs7QUFFL0Q7QUFDQTtBQUNBLGlDQUFpQyxhQUFhLElBQUksa0JBQWtCO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLDBDQUFlO0FBQ3hCO0FBQ0E7QUFDQSxnQkFBZ0IsMENBQWU7QUFDL0I7QUFDQTtBQUNBO0FBQ0EsT0FBTyx5RUFBSztBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXFOIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL25vZGVfbW9kdWxlcy9AZXNyaS9jYWxjaXRlLWNvbXBvbmVudHMtcmVhY3Qvbm9kZV9tb2R1bGVzL0Blc3JpL2NhbGNpdGUtY29tcG9uZW50cy9kaXN0L2NvbXBvbmVudHMvY2FsY2l0ZS1oZWFkbGVzcy5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vbm9kZV9tb2R1bGVzL0Blc3JpL2NhbGNpdGUtY29tcG9uZW50cy1yZWFjdC9ub2RlX21vZHVsZXMvQGVzcmkvY2FsY2l0ZS1jb21wb25lbnRzL2Rpc3QvY29tcG9uZW50cy9jb21ib2JveC5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vbm9kZV9tb2R1bGVzL0Blc3JpL2NhbGNpdGUtY29tcG9uZW50cy1yZWFjdC9ub2RlX21vZHVsZXMvQGVzcmkvY2FsY2l0ZS1jb21wb25lbnRzL2Rpc3QvY29tcG9uZW50cy91dGlsczIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9Fc3JpL2NhbGNpdGUtZGVzaWduLXN5c3RlbS9ibG9iL21haW4vTElDRU5TRS5tZCBmb3IgZGV0YWlscy5cbiAqIHYxLjExLjBcbiAqL1xuLyoqXG4gKiBEbyBub3QgZWRpdCBkaXJlY3RseVxuICogR2VuZXJhdGVkIG9uIFR1ZSwgMjEgTm92IDIwMjMgMjI6NTI6MTMgR01UXG4gKi9cbmNvbnN0IENvcmVTaXppbmcxNSA9IFwiNDhweFwiO1xuY29uc3QgQ29yZUJyZWFrcG9pbnRXaWR0aERlZmF1bHRYeHMgPSBcIjMyMHB4XCI7XG5jb25zdCBDb3JlQnJlYWtwb2ludFdpZHRoRGVmYXVsdFhzID0gXCI0NzZweFwiO1xuY29uc3QgQ29yZUJyZWFrcG9pbnRXaWR0aERlZmF1bHRTbSA9IFwiNzY4cHhcIjtcbmNvbnN0IENvcmVCcmVha3BvaW50V2lkdGhEZWZhdWx0TWQgPSBcIjExNTJweFwiO1xuY29uc3QgQ29yZUJyZWFrcG9pbnRXaWR0aERlZmF1bHRMZyA9IFwiMTQ0MHB4XCI7XG5cbmV4cG9ydCB7IENvcmVTaXppbmcxNSBhcyBDLCBDb3JlQnJlYWtwb2ludFdpZHRoRGVmYXVsdE1kIGFzIGEsIENvcmVCcmVha3BvaW50V2lkdGhEZWZhdWx0U20gYXMgYiwgQ29yZUJyZWFrcG9pbnRXaWR0aERlZmF1bHRYcyBhcyBjLCBDb3JlQnJlYWtwb2ludFdpZHRoRGVmYXVsdFh4cyBhcyBkLCBDb3JlQnJlYWtwb2ludFdpZHRoRGVmYXVsdExnIGFzIGUgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWRlc2lnbi1zeXN0ZW0vYmxvYi9tYWluL0xJQ0VOU0UubWQgZm9yIGRldGFpbHMuXG4gKiB2MS4xMS4wXG4gKi9cbmltcG9ydCB7IGgsIHByb3h5Q3VzdG9tRWxlbWVudCwgSFRNTEVsZW1lbnQsIGNyZWF0ZUV2ZW50LCBIb3N0IH0gZnJvbSAnQHN0ZW5jaWwvY29yZS9pbnRlcm5hbC9jbGllbnQvaW5kZXguanMnO1xuaW1wb3J0IHsgZiBhcyBmaWx0ZXIgfSBmcm9tICcuL2ZpbHRlcjIuanMnO1xuaW1wb3J0IHsgdSBhcyBnZXRFbGVtZW50V2lkdGgsIHYgYXMgZ2V0VGV4dFdpZHRoLCBqIGFzIGlzUHJpbWFyeVBvaW50ZXJCdXR0b24sIHQgYXMgdG9BcmlhQm9vbGVhbiB9IGZyb20gJy4vZG9tLmpzJztcbmltcG9ydCB7IGQgYXMgZGVmYXVsdE1lbnVQbGFjZW1lbnQsIGYgYXMgZmlsdGVyQ29tcHV0ZWRQbGFjZW1lbnRzLCBjIGFzIGNvbm5lY3RGbG9hdGluZ1VJLCByIGFzIHJlcG9zaXRpb24sIGEgYXMgZGlzY29ubmVjdEZsb2F0aW5nVUksIEYgYXMgRmxvYXRpbmdDU1MgfSBmcm9tICcuL2Zsb2F0aW5nLXVpLmpzJztcbmltcG9ydCB7IHMgYXMgc3VibWl0Rm9ybSwgYyBhcyBjb25uZWN0Rm9ybSwgYSBhcyBhZnRlckNvbm5lY3REZWZhdWx0VmFsdWVTZXQsIGQgYXMgZGlzY29ubmVjdEZvcm0sIEggYXMgSGlkZGVuRm9ybUlucHV0U2xvdCB9IGZyb20gJy4vZm9ybS5qcyc7XG5pbXBvcnQgeyBnIGFzIGd1aWQgfSBmcm9tICcuL2d1aWQuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25uZWN0SW50ZXJhY3RpdmUsIHUgYXMgdXBkYXRlSG9zdEludGVyYWN0aW9uLCBkIGFzIGRpc2Nvbm5lY3RJbnRlcmFjdGl2ZSB9IGZyb20gJy4vaW50ZXJhY3RpdmUuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25uZWN0TGFiZWwsIGQgYXMgZGlzY29ubmVjdExhYmVsLCBnIGFzIGdldExhYmVsVGV4dCB9IGZyb20gJy4vbGFiZWwyLmpzJztcbmltcG9ydCB7IGIgYXMgY29tcG9uZW50TG9hZGVkLCBjIGFzIGNvbXBvbmVudEZvY3VzYWJsZSwgYSBhcyBzZXRVcExvYWRhYmxlQ29tcG9uZW50LCBzIGFzIHNldENvbXBvbmVudExvYWRlZCB9IGZyb20gJy4vbG9hZGFibGUuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25uZWN0TG9jYWxpemVkLCBkIGFzIGRpc2Nvbm5lY3RMb2NhbGl6ZWQgfSBmcm9tICcuL2xvY2FsZS5qcyc7XG5pbXBvcnQgeyBjIGFzIGNyZWF0ZU9ic2VydmVyIH0gZnJvbSAnLi9vYnNlcnZlcnMuanMnO1xuaW1wb3J0IHsgbyBhcyBvblRvZ2dsZU9wZW5DbG9zZUNvbXBvbmVudCB9IGZyb20gJy4vb3BlbkNsb3NlQ29tcG9uZW50LmpzJztcbmltcG9ydCB7IGMgYXMgY29ubmVjdE1lc3NhZ2VzLCBzIGFzIHNldFVwTWVzc2FnZXMsIGQgYXMgZGlzY29ubmVjdE1lc3NhZ2VzLCB1IGFzIHVwZGF0ZU1lc3NhZ2VzIH0gZnJvbSAnLi90OW4uanMnO1xuaW1wb3J0IHsgaSBhcyBpc1NpbmdsZUxpa2UsIGggYXMgaGFzQWN0aXZlQ2hpbGRyZW4sIEMgYXMgQ1NTJDEsIGIgYXMgQ29tYm9ib3hDaGlsZFNlbGVjdG9yLCBjIGFzIGdldEl0ZW1BbmNlc3RvcnMsIGQgYXMgZ2V0SXRlbUNoaWxkcmVuLCBlIGFzIENvbWJvYm94SXRlbSwgZiBhcyBDb21ib2JveEl0ZW1Hcm91cCB9IGZyb20gJy4vdXRpbHMyLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0SWNvblNjYWxlIH0gZnJvbSAnLi9jb21wb25lbnQuanMnO1xuaW1wb3J0IHsgQyBhcyBDb3JlU2l6aW5nMTUgfSBmcm9tICcuL2NhbGNpdGUtaGVhZGxlc3MuanMnO1xuaW1wb3J0IHsgZCBhcyBkZWZpbmVDdXN0b21FbGVtZW50JDIgfSBmcm9tICcuL2NoaXAuanMnO1xuaW1wb3J0IHsgZCBhcyBkZWZpbmVDdXN0b21FbGVtZW50JDEgfSBmcm9tICcuL2ljb24uanMnO1xuaW1wb3J0IHsgZCBhcyBkZWJvdW5jZSB9IGZyb20gJy4vZGVib3VuY2UuanMnO1xuXG5jb25zdCBDU1MgPSB7XG4gIGJ1dHRvbjogXCJ4LWJ1dHRvblwiLFxufTtcbmZ1bmN0aW9uIFhCdXR0b24oeyBkaXNhYmxlZCwga2V5LCBsYWJlbCwgb25DbGljaywgcmVmLCBzY2FsZSwgfSkge1xuICByZXR1cm4gKGgoXCJidXR0b25cIiwgeyBcImFyaWEtbGFiZWxcIjogbGFiZWwsIGNsYXNzOiBDU1MuYnV0dG9uLCBkaXNhYmxlZDogZGlzYWJsZWQsIGtleToga2V5LCBvbkNsaWNrOiBvbkNsaWNrLCB0YWJJbmRleDogLTEsIHR5cGU6IFwiYnV0dG9uXCIsIFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9qc3gtc29ydC1wcm9wcyAtLSByZWYgc2hvdWxkIGJlIGxhc3Qgc28gbm9kZSBhdHRycy9wcm9wcyBhcmUgaW4gc3luYyAoc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9Fc3JpL2NhbGNpdGUtZGVzaWduLXN5c3RlbS9wdWxsLzY1MzApXG4gICAgcmVmOiByZWYgfSxcbiAgICBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgaWNvbjogXCJ4XCIsIHNjYWxlOiBnZXRJY29uU2NhbGUoc2NhbGUpIH0pKSk7XG59XG5cbmNvbnN0IGNvbWJvYm94Q3NzID0gXCI6aG9zdChbZGlzYWJsZWRdKXtjdXJzb3I6ZGVmYXVsdDstd2Via2l0LXVzZXItc2VsZWN0Om5vbmU7dXNlci1zZWxlY3Q6bm9uZTtvcGFjaXR5OnZhcigtLWNhbGNpdGUtdWktb3BhY2l0eS1kaXNhYmxlZCl9Omhvc3QoW2Rpc2FibGVkXSkgKiw6aG9zdChbZGlzYWJsZWRdKSA6OnNsb3R0ZWQoKil7cG9pbnRlci1ldmVudHM6bm9uZX06aG9zdHtwb3NpdGlvbjpyZWxhdGl2ZTtkaXNwbGF5OmJsb2NrfTpob3N0KFtkaXNhYmxlZF0pIDo6c2xvdHRlZChbY2FsY2l0ZS1oeWRyYXRlZF1bZGlzYWJsZWRdKSw6aG9zdChbZGlzYWJsZWRdKSBbY2FsY2l0ZS1oeWRyYXRlZF1bZGlzYWJsZWRde29wYWNpdHk6MX06aG9zdChbc2NhbGU9c10pIC54LWJ1dHRvbntpbmxpbmUtc2l6ZToxcmVtO2Jsb2NrLXNpemU6MXJlbX06aG9zdChbc2NhbGU9bV0pIC54LWJ1dHRvbntpbmxpbmUtc2l6ZToxLjVyZW07YmxvY2stc2l6ZToxLjVyZW19Omhvc3QoW3NjYWxlPWxdKSAueC1idXR0b257aW5saW5lLXNpemU6MnJlbTtibG9jay1zaXplOjJyZW19LngtYnV0dG9ue21hcmdpbjowcHg7ZGlzcGxheTpmbGV4O2N1cnNvcjpwb2ludGVyO2FwcGVhcmFuY2U6bm9uZTthbGlnbi1jb250ZW50OmNlbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcjthbGlnbi1zZWxmOmNlbnRlcjtib3JkZXItd2lkdGg6MnB4O2JhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnQ7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTMpO291dGxpbmUtY29sb3I6dHJhbnNwYXJlbnQ7dHJhbnNpdGlvbjphbGwgdmFyKC0tY2FsY2l0ZS1hbmltYXRpb24tdGltaW5nKSBlYXNlLWluLW91dCAwcywgb3V0bGluZSAwcywgb3V0bGluZS1vZmZzZXQgMHM7Ym9yZGVyLXJhZGl1czo1MCU7Ym9yZGVyLWNvbG9yOnRyYW5zcGFyZW50O2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTIpfS54LWJ1dHRvbjphY3RpdmUsLngtYnV0dG9uOmhvdmVye2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0xKTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0zKX0ueC1idXR0b246YWN0aXZle2JvcmRlci1zdHlsZTpzb2xpZDtib3JkZXItY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1icmFuZCl9LngtYnV0dG9uIGNhbGNpdGUtaWNvbntjb2xvcjppbmhlcml0fTpob3N0KFtzY2FsZT1zXSl7Zm9udC1zaXplOnZhcigtLWNhbGNpdGUtZm9udC1zaXplLS0yKTstLWNhbGNpdGUtY29tYm9ib3gtaXRlbS1zcGFjaW5nLXVuaXQtbDowLjVyZW07LS1jYWxjaXRlLWNvbWJvYm94LWl0ZW0tc3BhY2luZy11bml0LXM6MC4yNXJlbTstLWNhbGNpdGUtY29tYm9ib3gtaW5wdXQtaGVpZ2h0OjFyZW07LS1jYWxjaXRlLWludGVybmFsLWNvbWJvYm94LWlucHV0LW1hcmdpbi1ibG9jazpjYWxjKDAuMjVyZW0gLSAxcHgpfTpob3N0KFtzY2FsZT1zXSkgLngtYnV0dG9ue21hcmdpbi1pbmxpbmU6MC41cmVtfTpob3N0KFtzY2FsZT1tXSl7Zm9udC1zaXplOnZhcigtLWNhbGNpdGUtZm9udC1zaXplLS0xKTstLWNhbGNpdGUtY29tYm9ib3gtaXRlbS1zcGFjaW5nLXVuaXQtbDowLjc1cmVtOy0tY2FsY2l0ZS1jb21ib2JveC1pdGVtLXNwYWNpbmctdW5pdC1zOjAuNXJlbTstLWNhbGNpdGUtY29tYm9ib3gtaW5wdXQtaGVpZ2h0OjFyZW07LS1jYWxjaXRlLWludGVybmFsLWNvbWJvYm94LWlucHV0LW1hcmdpbi1ibG9jazpjYWxjKDAuNXJlbSAtIDFweCl9Omhvc3QoW3NjYWxlPW1dKSAueC1idXR0b257bWFyZ2luLWlubGluZS1lbmQ6MC43NXJlbX06aG9zdChbc2NhbGU9bF0pe2ZvbnQtc2l6ZTp2YXIoLS1jYWxjaXRlLWZvbnQtc2l6ZS0wKTstLWNhbGNpdGUtY29tYm9ib3gtaXRlbS1zcGFjaW5nLXVuaXQtbDoxcmVtOy0tY2FsY2l0ZS1jb21ib2JveC1pdGVtLXNwYWNpbmctdW5pdC1zOjAuNzVyZW07LS1jYWxjaXRlLWNvbWJvYm94LWlucHV0LWhlaWdodDoxLjVyZW07LS1jYWxjaXRlLWludGVybmFsLWNvbWJvYm94LWlucHV0LW1hcmdpbi1ibG9jazpjYWxjKDAuNjI1cmVtIC0gMXB4KX06aG9zdChbc2NhbGU9bF0pIC54LWJ1dHRvbnttYXJnaW4taW5saW5lLWVuZDoxcmVtfS53cmFwcGVye2Rpc3BsYXk6ZmxleDtib3JkZXItd2lkdGg6MXB4O2JvcmRlci1zdHlsZTpzb2xpZDtib3JkZXItY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1ib3JkZXItaW5wdXQpO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEpO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0xKTtvdXRsaW5lLWNvbG9yOnRyYW5zcGFyZW50O3BhZGRpbmctYmxvY2s6Y2FsYyh2YXIoLS1jYWxjaXRlLWNvbWJvYm94LWl0ZW0tc3BhY2luZy11bml0LXMpIC8gNCk7cGFkZGluZy1pbmxpbmU6dmFyKC0tY2FsY2l0ZS1jb21ib2JveC1pdGVtLXNwYWNpbmctdW5pdC1sKX06aG9zdCg6Zm9jdXMtd2l0aGluKSAud3JhcHBlciwud3JhcHBlci0tYWN0aXZle291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktZm9jdXMtY29sb3IsIHZhcigtLWNhbGNpdGUtdWktYnJhbmQpKTtvdXRsaW5lLW9mZnNldDpjYWxjKFxcbiAgICAgICAgICAgIC0ycHggKlxcbiAgICAgICAgICAgIGNhbGMoXFxuICAgICAgICAgICAgICAxIC1cXG4gICAgICAgICAgICAgIDIgKiBjbGFtcChcXG4gICAgICAgICAgICAgICAgMCxcXG4gICAgICAgICAgICAgICAgdmFyKC0tY2FsY2l0ZS11aS1mb2N1cy1vZmZzZXQtaW52ZXJ0KSxcXG4gICAgICAgICAgICAgICAgMVxcbiAgICAgICAgICAgICAgKVxcbiAgICAgICAgICAgIClcXG4gICAgICAgICAgKX0ud3JhcHBlci0tc2luZ2xle3BhZGRpbmctYmxvY2s6MDtwYWRkaW5nLWlubGluZTp2YXIoLS1jYWxjaXRlLWNvbWJvYm94LWl0ZW0tc3BhY2luZy11bml0LWwpO2N1cnNvcjpwb2ludGVyO2ZsZXgtd3JhcDpub3dyYXB9LmdyaWQtaW5wdXR7cG9zaXRpb246cmVsYXRpdmU7ZGlzcGxheTpmbGV4O2ZsZXgtZ3JvdzoxO2ZsZXgtd3JhcDp3cmFwO2FsaWduLWl0ZW1zOmNlbnRlcjtvdmVyZmxvdzpoaWRkZW47dGV4dC1vdmVyZmxvdzplbGxpcHNpczt3aGl0ZS1zcGFjZTpub3dyYXA7cGFkZGluZzowcHg7Z2FwOnZhcigtLWNhbGNpdGUtY29tYm9ib3gtaXRlbS1zcGFjaW5nLXVuaXQtcyl9LmdyaWQtaW5wdXQuc2VsZWN0aW9uLWRpc3BsYXktZml0LC5ncmlkLWlucHV0LnNlbGVjdGlvbi1kaXNwbGF5LXNpbmdsZXtmbGV4LXdyYXA6bm93cmFwO292ZXJmbG93OmhpZGRlbn0uaW5wdXR7ZmxleC1ncm93OjE7YXBwZWFyYW5jZTpub25lO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXM7Ym9yZGVyLXN0eWxlOm5vbmU7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDtwYWRkaW5nOjBweDtmb250LWZhbWlseTppbmhlcml0O2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0xKTtmb250LXNpemU6aW5oZXJpdDtibG9jay1zaXplOnZhcigtLWNhbGNpdGUtY29tYm9ib3gtaW5wdXQtaGVpZ2h0KTtsaW5lLWhlaWdodDp2YXIoLS1jYWxjaXRlLWNvbWJvYm94LWlucHV0LWhlaWdodCk7aW5saW5lLXNpemU6MTAwJTttYXJnaW4tYmxvY2stZW5kOnZhcigtLWNhbGNpdGUtY29tYm9ib3gtaXRlbS1zcGFjaW5nLXVuaXQtcyk7bWluLWlubGluZS1zaXplOjQuODEyNXJlbX0uaW5wdXQ6Zm9jdXN7b3V0bGluZToycHggc29saWQgdHJhbnNwYXJlbnQ7b3V0bGluZS1vZmZzZXQ6MnB4fS5pbnB1dDpwbGFjZWhvbGRlci1zaG93bnt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzfS5pbnB1dC0tdHJhbnNwYXJlbnR7b3BhY2l0eTowfS5pbnB1dC0tc2luZ2xle3BhZGRpbmc6MHB4O21hcmdpbi1ibG9jazp2YXIoLS1jYWxjaXRlLWludGVybmFsLWNvbWJvYm94LWlucHV0LW1hcmdpbi1ibG9jayl9LndyYXBwZXItLWFjdGl2ZSAuaW5wdXQtc2luZ2xle2N1cnNvcjp0ZXh0fS5pbnB1dC0taGlkZGVue3BvaW50ZXItZXZlbnRzOm5vbmU7aW5saW5lLXNpemU6MHB4O21pbi1pbmxpbmUtc2l6ZTowcHg7b3BhY2l0eTowfS5pbnB1dC0taWNvbntwYWRkaW5nLWJsb2NrOjA7cGFkZGluZy1pbmxpbmU6dmFyKC0tY2FsY2l0ZS1jb21ib2JveC1pdGVtLXNwYWNpbmctdW5pdC1zKX06aG9zdChbc2NhbGU9bV0pIC5pbnB1dC0taWNvbiw6aG9zdChbc2NhbGU9bF0pIC5pbnB1dC0taWNvbntwYWRkaW5nLWlubGluZTowLjI1cmVtfS5pbnB1dC13cmFwe2Rpc3BsYXk6ZmxleDtmbGV4LWdyb3c6MTthbGlnbi1pdGVtczpjZW50ZXJ9LmlucHV0LXdyYXAtLXNpbmdsZXtmbGV4OjEgMSAwJTtvdmVyZmxvdzpoaWRkZW59LmxhYmVse3BvaW50ZXItZXZlbnRzOm5vbmU7ZGlzcGxheTpmbGV4O21heC1pbmxpbmUtc2l6ZToxMDAlO2ZsZXg6MSAxIGF1dG87b3ZlcmZsb3c6aGlkZGVuO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXM7d2hpdGUtc3BhY2U6bm93cmFwO3BhZGRpbmc6MHB4O2ZvbnQtd2VpZ2h0OnZhcigtLWNhbGNpdGUtZm9udC13ZWlnaHQtbm9ybWFsKTtibG9jay1zaXplOnZhcigtLWNhbGNpdGUtY29tYm9ib3gtaW5wdXQtaGVpZ2h0KTtsaW5lLWhlaWdodDp2YXIoLS1jYWxjaXRlLWNvbWJvYm94LWlucHV0LWhlaWdodCl9LmxhYmVsLS1pY29ue3BhZGRpbmctaW5saW5lOnZhcigtLWNhbGNpdGUtY29tYm9ib3gtaXRlbS1zcGFjaW5nLXVuaXQtbCl9Lmljb24tZW5kLC5pY29uLXN0YXJ0e2Rpc3BsYXk6ZmxleDtjdXJzb3I6cG9pbnRlcjthbGlnbi1pdGVtczpjZW50ZXJ9Lmljb24tZW5ke2ZsZXg6bm9uZX0uZmxvYXRpbmctdWktY29udGFpbmVyey0tY2FsY2l0ZS1mbG9hdGluZy11aS16LWluZGV4OnZhcigtLWNhbGNpdGUtYXBwLXotaW5kZXgtZHJvcGRvd24pO2Rpc3BsYXk6YmxvY2s7cG9zaXRpb246YWJzb2x1dGU7ei1pbmRleDp2YXIoLS1jYWxjaXRlLWZsb2F0aW5nLXVpLXotaW5kZXgpO3Zpc2liaWxpdHk6aGlkZGVufS5mbG9hdGluZy11aS1jb250YWluZXIgLmNhbGNpdGUtZmxvYXRpbmctdWktYW5pbXtwb3NpdGlvbjpyZWxhdGl2ZTt0cmFuc2l0aW9uOnZhcigtLWNhbGNpdGUtZmxvYXRpbmctdWktdHJhbnNpdGlvbik7dHJhbnNpdGlvbi1wcm9wZXJ0eTp0cmFuc2Zvcm0sIHZpc2liaWxpdHksIG9wYWNpdHk7b3BhY2l0eTowO2JveC1zaGFkb3c6MCAwIDE2cHggMCByZ2JhKDAsIDAsIDAsIDAuMTYpO3otaW5kZXg6dmFyKC0tY2FsY2l0ZS1hcHAtei1pbmRleCk7Ym9yZGVyLXJhZGl1czowLjI1cmVtfS5mbG9hdGluZy11aS1jb250YWluZXJbZGF0YS1wbGFjZW1lbnRePWJvdHRvbV0gLmNhbGNpdGUtZmxvYXRpbmctdWktYW5pbXt0cmFuc2Zvcm06dHJhbnNsYXRlWSgtNXB4KX0uZmxvYXRpbmctdWktY29udGFpbmVyW2RhdGEtcGxhY2VtZW50Xj10b3BdIC5jYWxjaXRlLWZsb2F0aW5nLXVpLWFuaW17dHJhbnNmb3JtOnRyYW5zbGF0ZVkoNXB4KX0uZmxvYXRpbmctdWktY29udGFpbmVyW2RhdGEtcGxhY2VtZW50Xj1sZWZ0XSAuY2FsY2l0ZS1mbG9hdGluZy11aS1hbmlte3RyYW5zZm9ybTp0cmFuc2xhdGVYKDVweCl9LmZsb2F0aW5nLXVpLWNvbnRhaW5lcltkYXRhLXBsYWNlbWVudF49cmlnaHRdIC5jYWxjaXRlLWZsb2F0aW5nLXVpLWFuaW17dHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTVweCl9LmZsb2F0aW5nLXVpLWNvbnRhaW5lcltkYXRhLXBsYWNlbWVudF0gLmNhbGNpdGUtZmxvYXRpbmctdWktYW5pbS0tYWN0aXZle29wYWNpdHk6MTt0cmFuc2Zvcm06dHJhbnNsYXRlKDApfS5mbG9hdGluZy11aS1jb250YWluZXItLWFjdGl2ZXt2aXNpYmlsaXR5OnZpc2libGV9QG1lZGlhIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpey53cmFwcGVyLC5mbG9hdGluZy11aS1jb250YWluZXItLWFjdGl2ZXtib3JkZXI6MXB4IHNvbGlkIGNhbnZhc1RleHR9fS5zY3JlZW4tcmVhZGVycy1vbmx5e3Bvc2l0aW9uOmFic29sdXRlO2lubGluZS1zaXplOjFweDtibG9jay1zaXplOjFweDtwYWRkaW5nOjA7bWFyZ2luOi0xcHg7b3ZlcmZsb3c6aGlkZGVuO2NsaXA6cmVjdCgwLCAwLCAwLCAwKTt3aGl0ZS1zcGFjZTpub3dyYXA7Ym9yZGVyLXdpZHRoOjB9Lmxpc3QtY29udGFpbmVye21heC1ibG9jay1zaXplOjQ1dmg7b3ZlcmZsb3cteTphdXRvO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEpO2lubGluZS1zaXplOnZhcigtLWNhbGNpdGUtZHJvcGRvd24td2lkdGgpfS5saXN0e21hcmdpbjowcHg7ZGlzcGxheTpibG9jaztwYWRkaW5nOjBweH0ubGlzdC0taGlkZXtibG9jay1zaXplOjBweDtvdmVyZmxvdzpoaWRkZW59Y2FsY2l0ZS1jaGlwey0tY2FsY2l0ZS1hbmltYXRpb24tdGltaW5nOjB9LmNoaXB7bWFyZ2luLWJsb2NrOmNhbGModmFyKC0tY2FsY2l0ZS1jb21ib2JveC1pdGVtLXNwYWNpbmctdW5pdC1zKSAvIDQpO21heC1pbmxpbmUtc2l6ZToxMDAlfS5jaGlwLS1hY3RpdmV7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMyl9LmNoaXAtLWludmlzaWJsZXt2aXNpYmlsaXR5OmhpZGRlbjtwb3NpdGlvbjphYnNvbHV0ZX0uaXRlbXtkaXNwbGF5OmJsb2NrfTo6c2xvdHRlZChpbnB1dFtzbG90PWhpZGRlbi1mb3JtLWlucHV0XSl7bWFyZ2luOjAgIWltcG9ydGFudDtvcGFjaXR5OjAgIWltcG9ydGFudDtvdXRsaW5lOm5vbmUgIWltcG9ydGFudDtwYWRkaW5nOjAgIWltcG9ydGFudDtwb3NpdGlvbjphYnNvbHV0ZSAhaW1wb3J0YW50O2luc2V0OjAgIWltcG9ydGFudDt0cmFuc2Zvcm06bm9uZSAhaW1wb3J0YW50Oy13ZWJraXQtYXBwZWFyYW5jZTpub25lICFpbXBvcnRhbnQ7ei1pbmRleDotMSAhaW1wb3J0YW50fTpob3N0KFtoaWRkZW5dKXtkaXNwbGF5Om5vbmV9W2hpZGRlbl17ZGlzcGxheTpub25lfTo6c2xvdHRlZChjYWxjaXRlLWNvbWJvYm94LWl0ZW0tZ3JvdXA6bm90KDpmaXJzdC1jaGlsZCkpe3BhZGRpbmctYmxvY2stc3RhcnQ6dmFyKC0tY2FsY2l0ZS1jb21ib2JveC1pdGVtLXNwYWNpbmctdW5pdC1sKX1cIjtcblxuY29uc3QgaXNHcm91cCA9IChlbCkgPT4gZWwudGFnTmFtZSA9PT0gQ29tYm9ib3hJdGVtR3JvdXA7XG5jb25zdCBpdGVtVWlkUHJlZml4ID0gXCJjb21ib2JveC1pdGVtLVwiO1xuY29uc3QgY2hpcFVpZFByZWZpeCA9IFwiY29tYm9ib3gtY2hpcC1cIjtcbmNvbnN0IGxhYmVsVWlkUHJlZml4ID0gXCJjb21ib2JveC1sYWJlbC1cIjtcbmNvbnN0IGxpc3Rib3hVaWRQcmVmaXggPSBcImNvbWJvYm94LWxpc3Rib3gtXCI7XG5jb25zdCBpbnB1dFVpZFByZWZpeCA9IFwiY29tYm9ib3gtaW5wdXQtXCI7XG5jb25zdCBDb21ib2JveCA9IC8qQF9fUFVSRV9fKi8gcHJveHlDdXN0b21FbGVtZW50KGNsYXNzIGV4dGVuZHMgSFRNTEVsZW1lbnQge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX19yZWdpc3Rlckhvc3QoKTtcbiAgICB0aGlzLl9fYXR0YWNoU2hhZG93KCk7XG4gICAgdGhpcy5jYWxjaXRlQ29tYm9ib3hDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImNhbGNpdGVDb21ib2JveENoYW5nZVwiLCA2KTtcbiAgICB0aGlzLmNhbGNpdGVDb21ib2JveEZpbHRlckNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiY2FsY2l0ZUNvbWJvYm94RmlsdGVyQ2hhbmdlXCIsIDYpO1xuICAgIHRoaXMuY2FsY2l0ZUNvbWJvYm94Q2hpcENsb3NlID0gY3JlYXRlRXZlbnQodGhpcywgXCJjYWxjaXRlQ29tYm9ib3hDaGlwQ2xvc2VcIiwgNik7XG4gICAgdGhpcy5jYWxjaXRlQ29tYm9ib3hCZWZvcmVDbG9zZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiY2FsY2l0ZUNvbWJvYm94QmVmb3JlQ2xvc2VcIiwgNik7XG4gICAgdGhpcy5jYWxjaXRlQ29tYm9ib3hDbG9zZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiY2FsY2l0ZUNvbWJvYm94Q2xvc2VcIiwgNik7XG4gICAgdGhpcy5jYWxjaXRlQ29tYm9ib3hCZWZvcmVPcGVuID0gY3JlYXRlRXZlbnQodGhpcywgXCJjYWxjaXRlQ29tYm9ib3hCZWZvcmVPcGVuXCIsIDYpO1xuICAgIHRoaXMuY2FsY2l0ZUNvbWJvYm94T3BlbiA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiY2FsY2l0ZUNvbWJvYm94T3BlblwiLCA2KTtcbiAgICB0aGlzLnBsYWNlbWVudCA9IGRlZmF1bHRNZW51UGxhY2VtZW50O1xuICAgIHRoaXMuaW50ZXJuYWxWYWx1ZUNoYW5nZUZsYWcgPSBmYWxzZTtcbiAgICB0aGlzLnRleHRJbnB1dCA9IG51bGw7XG4gICAgdGhpcy5tdXRhdGlvbk9ic2VydmVyID0gY3JlYXRlT2JzZXJ2ZXIoXCJtdXRhdGlvblwiLCAoKSA9PiB0aGlzLnVwZGF0ZUl0ZW1zKCkpO1xuICAgIHRoaXMucmVzaXplT2JzZXJ2ZXIgPSBjcmVhdGVPYnNlcnZlcihcInJlc2l6ZVwiLCAoKSA9PiB7XG4gICAgICB0aGlzLnNldE1heFNjcm9sbGVySGVpZ2h0KCk7XG4gICAgICB0aGlzLnJlZnJlc2hTZWxlY3Rpb25EaXNwbGF5KCk7XG4gICAgfSk7XG4gICAgdGhpcy5ndWlkID0gZ3VpZCgpO1xuICAgIHRoaXMuaW5wdXRIZWlnaHQgPSAwO1xuICAgIHRoaXMuaWdub3JlU2VsZWN0ZWRFdmVudHNGbGFnID0gZmFsc2U7XG4gICAgdGhpcy5vcGVuVHJhbnNpdGlvblByb3AgPSBcIm9wYWNpdHlcIjtcbiAgICB0aGlzLnNldEZpbHRlcmVkUGxhY2VtZW50cyA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHsgZWwsIGZsaXBQbGFjZW1lbnRzIH0gPSB0aGlzO1xuICAgICAgdGhpcy5maWx0ZXJlZEZsaXBQbGFjZW1lbnRzID0gZmxpcFBsYWNlbWVudHNcbiAgICAgICAgPyBmaWx0ZXJDb21wdXRlZFBsYWNlbWVudHMoZmxpcFBsYWNlbWVudHMsIGVsKVxuICAgICAgICA6IG51bGw7XG4gICAgfTtcbiAgICB0aGlzLmdldFZhbHVlID0gKCkgPT4ge1xuICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLnNlbGVjdGVkSXRlbXMubWFwKChpdGVtKSA9PiBpdGVtPy52YWx1ZT8udG9TdHJpbmcoKSk7XG4gICAgICByZXR1cm4gaXRlbXM/Lmxlbmd0aCA/IChpdGVtcy5sZW5ndGggPiAxID8gaXRlbXMgOiBpdGVtc1swXSkgOiBcIlwiO1xuICAgIH07XG4gICAgdGhpcy5vbkxhYmVsQ2xpY2sgPSAoKSA9PiB7XG4gICAgICB0aGlzLnNldEZvY3VzKCk7XG4gICAgfTtcbiAgICB0aGlzLmtleURvd25IYW5kbGVyID0gKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCB7IGtleSB9ID0gZXZlbnQ7XG4gICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICBjYXNlIFwiVGFiXCI6XG4gICAgICAgICAgdGhpcy5hY3RpdmVDaGlwSW5kZXggPSAtMTtcbiAgICAgICAgICB0aGlzLmFjdGl2ZUl0ZW1JbmRleCA9IC0xO1xuICAgICAgICAgIGlmICh0aGlzLmFsbG93Q3VzdG9tVmFsdWVzICYmIHRoaXMudGV4dCkge1xuICAgICAgICAgICAgdGhpcy5hZGRDdXN0b21DaGlwKHRoaXMudGV4dCwgdHJ1ZSk7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmICh0aGlzLm9wZW4pIHtcbiAgICAgICAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZiAoIXRoaXMuYWxsb3dDdXN0b21WYWx1ZXMgJiYgdGhpcy50ZXh0KSB7XG4gICAgICAgICAgICB0aGlzLmNsZWFySW5wdXRWYWx1ZSgpO1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJJdGVtcyhcIlwiKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQWN0aXZlSXRlbUluZGV4KC0xKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJBcnJvd0xlZnRcIjpcbiAgICAgICAgICB0aGlzLnByZXZpb3VzQ2hpcCgpO1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJBcnJvd1JpZ2h0XCI6XG4gICAgICAgICAgdGhpcy5uZXh0Q2hpcCgpO1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJBcnJvd1VwXCI6XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBpZiAodGhpcy5vcGVuKSB7XG4gICAgICAgICAgICB0aGlzLnNoaWZ0QWN0aXZlSXRlbUluZGV4KC0xKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCF0aGlzLmNvbWJvYm94SW5WaWV3cG9ydCgpKSB7XG4gICAgICAgICAgICB0aGlzLmVsLnNjcm9sbEludG9WaWV3KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiQXJyb3dEb3duXCI6XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBpZiAodGhpcy5vcGVuKSB7XG4gICAgICAgICAgICB0aGlzLnNoaWZ0QWN0aXZlSXRlbUluZGV4KDEpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMub3BlbiA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmVuc3VyZVJlY2VudFNlbGVjdGVkSXRlbUlzQWN0aXZlKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghdGhpcy5jb21ib2JveEluVmlld3BvcnQoKSkge1xuICAgICAgICAgICAgdGhpcy5lbC5zY3JvbGxJbnRvVmlldygpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIiBcIjpcbiAgICAgICAgICBpZiAoIXRoaXMudGV4dElucHV0LnZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMub3Blbikge1xuICAgICAgICAgICAgICB0aGlzLm9wZW4gPSB0cnVlO1xuICAgICAgICAgICAgICB0aGlzLnNoaWZ0QWN0aXZlSXRlbUluZGV4KDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJIb21lXCI6XG4gICAgICAgICAgaWYgKCF0aGlzLm9wZW4pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB0aGlzLnVwZGF0ZUFjdGl2ZUl0ZW1JbmRleCgwKTtcbiAgICAgICAgICB0aGlzLnNjcm9sbFRvQWN0aXZlSXRlbSgpO1xuICAgICAgICAgIGlmICghdGhpcy5jb21ib2JveEluVmlld3BvcnQoKSkge1xuICAgICAgICAgICAgdGhpcy5lbC5zY3JvbGxJbnRvVmlldygpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIkVuZFwiOlxuICAgICAgICAgIGlmICghdGhpcy5vcGVuKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgdGhpcy51cGRhdGVBY3RpdmVJdGVtSW5kZXgodGhpcy5maWx0ZXJlZEl0ZW1zLmxlbmd0aCAtIDEpO1xuICAgICAgICAgIHRoaXMuc2Nyb2xsVG9BY3RpdmVJdGVtKCk7XG4gICAgICAgICAgaWYgKCF0aGlzLmNvbWJvYm94SW5WaWV3cG9ydCgpKSB7XG4gICAgICAgICAgICB0aGlzLmVsLnNjcm9sbEludG9WaWV3KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiRXNjYXBlXCI6XG4gICAgICAgICAgaWYgKCF0aGlzLmNsZWFyRGlzYWJsZWQgJiYgIXRoaXMub3Blbikge1xuICAgICAgICAgICAgdGhpcy5jbGVhclZhbHVlKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJFbnRlclwiOlxuICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUl0ZW1JbmRleCA+IC0xKSB7XG4gICAgICAgICAgICB0aGlzLnRvZ2dsZVNlbGVjdGlvbih0aGlzLmZpbHRlcmVkSXRlbXNbdGhpcy5hY3RpdmVJdGVtSW5kZXhdKTtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYgKHRoaXMuYWN0aXZlQ2hpcEluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQWN0aXZlQ2hpcCgpO1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZiAodGhpcy5hbGxvd0N1c3RvbVZhbHVlcyAmJiB0aGlzLnRleHQpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkQ3VzdG9tQ2hpcCh0aGlzLnRleHQsIHRydWUpO1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZiAoIWV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQpIHtcbiAgICAgICAgICAgIGlmIChzdWJtaXRGb3JtKHRoaXMpKSB7XG4gICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiRGVsZXRlXCI6XG4gICAgICAgIGNhc2UgXCJCYWNrc3BhY2VcIjpcbiAgICAgICAgICBpZiAodGhpcy5hY3RpdmVDaGlwSW5kZXggPiAtMSkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQWN0aXZlQ2hpcCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmICghdGhpcy50ZXh0ICYmIHRoaXMuaXNNdWx0aSgpKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVMYXN0Q2hpcCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMudG9nZ2xlQ2xvc2VFbmQgPSAoKSA9PiB7XG4gICAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgICAgIHRoaXMuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNhbGNpdGVDb21ib2JveENsb3NlXCIsIHRoaXMudG9nZ2xlQ2xvc2VFbmQpO1xuICAgIH07XG4gICAgdGhpcy50b2dnbGVPcGVuRW5kID0gKCkgPT4ge1xuICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgICB0aGlzLmVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjYWxjaXRlQ29tYm9ib3hPcGVuXCIsIHRoaXMudG9nZ2xlT3BlbkVuZCk7XG4gICAgfTtcbiAgICB0aGlzLnNldE1heFNjcm9sbGVySGVpZ2h0ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBsaXN0Q29udGFpbmVyRWwsIG9wZW4sIHJlZmVyZW5jZUVsIH0gPSB0aGlzO1xuICAgICAgaWYgKCFsaXN0Q29udGFpbmVyRWwgfHwgIW9wZW4pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy5yZXBvc2l0aW9uKHRydWUpO1xuICAgICAgY29uc3QgbWF4U2Nyb2xsZXJIZWlnaHQgPSB0aGlzLmdldE1heFNjcm9sbGVySGVpZ2h0KCk7XG4gICAgICBsaXN0Q29udGFpbmVyRWwuc3R5bGUubWF4SGVpZ2h0ID0gbWF4U2Nyb2xsZXJIZWlnaHQgPiAwID8gYCR7bWF4U2Nyb2xsZXJIZWlnaHR9cHhgIDogXCJcIjtcbiAgICAgIGxpc3RDb250YWluZXJFbC5zdHlsZS5taW5XaWR0aCA9IGAke3JlZmVyZW5jZUVsLmNsaWVudFdpZHRofXB4YDtcbiAgICAgIGF3YWl0IHRoaXMucmVwb3NpdGlvbih0cnVlKTtcbiAgICB9O1xuICAgIHRoaXMuY2FsY2l0ZUNoaXBDbG9zZUhhbmRsZXIgPSAoY29tYm9ib3hJdGVtKSA9PiB7XG4gICAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHRoaXMuaXRlbXMuZmluZCgoaXRlbSkgPT4gaXRlbSA9PT0gY29tYm9ib3hJdGVtKTtcbiAgICAgIGlmIChzZWxlY3Rpb24pIHtcbiAgICAgICAgdGhpcy50b2dnbGVTZWxlY3Rpb24oc2VsZWN0aW9uLCBmYWxzZSk7XG4gICAgICB9XG4gICAgICB0aGlzLmNhbGNpdGVDb21ib2JveENoaXBDbG9zZS5lbWl0KCk7XG4gICAgfTtcbiAgICB0aGlzLmNsaWNrSGFuZGxlciA9IChldmVudCkgPT4ge1xuICAgICAgY29uc3QgY29tcG9zZWRQYXRoID0gZXZlbnQuY29tcG9zZWRQYXRoKCk7XG4gICAgICBpZiAoY29tcG9zZWRQYXRoLnNvbWUoKG5vZGUpID0+IG5vZGUudGFnTmFtZSA9PT0gXCJDQUxDSVRFLUNISVBcIikpIHtcbiAgICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChjb21wb3NlZFBhdGguc29tZSgobm9kZSkgPT4gbm9kZS5jbGFzc0xpc3Q/LmNvbnRhaW5zKENTUy5idXR0b24pKSkge1xuICAgICAgICB0aGlzLmNsZWFyVmFsdWUoKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5vcGVuID0gIXRoaXMub3BlbjtcbiAgICAgIHRoaXMuZW5zdXJlUmVjZW50U2VsZWN0ZWRJdGVtSXNBY3RpdmUoKTtcbiAgICB9O1xuICAgIHRoaXMucmVmcmVzaFNlbGVjdGlvbkRpc3BsYXkgPSBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBjb21wb25lbnRMb2FkZWQodGhpcyk7XG4gICAgICBpZiAoaXNTaW5nbGVMaWtlKHRoaXMuc2VsZWN0aW9uTW9kZSkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLnRleHRJbnB1dCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCB7IGFsbFNlbGVjdGVkSW5kaWNhdG9yQ2hpcEVsLCBjaGlwQ29udGFpbmVyRWwsIHNlbGVjdGlvbkRpc3BsYXksIHBsYWNlaG9sZGVyLCBzZWxlY3RlZEluZGljYXRvckNoaXBFbCwgdGV4dElucHV0LCB9ID0gdGhpcztcbiAgICAgIGNvbnN0IGNoaXBDb250YWluZXJFbEdhcCA9IHBhcnNlSW50KGdldENvbXB1dGVkU3R5bGUoY2hpcENvbnRhaW5lckVsKS5nYXAucmVwbGFjZShcInB4XCIsIFwiXCIpKTtcbiAgICAgIGNvbnN0IGNoaXBDb250YWluZXJFbFdpZHRoID0gZ2V0RWxlbWVudFdpZHRoKGNoaXBDb250YWluZXJFbCk7XG4gICAgICBjb25zdCB7IGZvbnRTaXplLCBmb250RmFtaWx5IH0gPSBnZXRDb21wdXRlZFN0eWxlKHRleHRJbnB1dCk7XG4gICAgICBjb25zdCBpbnB1dFRleHRXaWR0aCA9IGdldFRleHRXaWR0aChwbGFjZWhvbGRlciwgYCR7Zm9udFNpemV9ICR7Zm9udEZhbWlseX1gKTtcbiAgICAgIGNvbnN0IGlucHV0V2lkdGggPSAoaW5wdXRUZXh0V2lkdGggfHwgcGFyc2VJbnQoQ29yZVNpemluZzE1KSkgKyBjaGlwQ29udGFpbmVyRWxHYXA7XG4gICAgICBjb25zdCBhbGxTZWxlY3RlZEluZGljYXRvckNoaXBFbFdpZHRoID0gZ2V0RWxlbWVudFdpZHRoKGFsbFNlbGVjdGVkSW5kaWNhdG9yQ2hpcEVsKTtcbiAgICAgIGNvbnN0IHNlbGVjdGVkSW5kaWNhdG9yQ2hpcEVsV2lkdGggPSBnZXRFbGVtZW50V2lkdGgoc2VsZWN0ZWRJbmRpY2F0b3JDaGlwRWwpO1xuICAgICAgY29uc3QgbGFyZ2VzdFNlbGVjdGVkSW5kaWNhdG9yQ2hpcFdpZHRoID0gTWF0aC5tYXgoYWxsU2VsZWN0ZWRJbmRpY2F0b3JDaGlwRWxXaWR0aCwgc2VsZWN0ZWRJbmRpY2F0b3JDaGlwRWxXaWR0aCk7XG4gICAgICB0aGlzLnNldENvbXBhY3RTZWxlY3Rpb25EaXNwbGF5KHtcbiAgICAgICAgY2hpcENvbnRhaW5lckVsR2FwLFxuICAgICAgICBjaGlwQ29udGFpbmVyRWxXaWR0aCxcbiAgICAgICAgaW5wdXRXaWR0aCxcbiAgICAgICAgbGFyZ2VzdFNlbGVjdGVkSW5kaWNhdG9yQ2hpcFdpZHRoLFxuICAgICAgfSk7XG4gICAgICBpZiAoc2VsZWN0aW9uRGlzcGxheSA9PT0gXCJmaXRcIikge1xuICAgICAgICBjb25zdCBjaGlwRWxzID0gQXJyYXkuZnJvbSh0aGlzLmVsLnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvckFsbChcImNhbGNpdGUtY2hpcFwiKSkuZmlsdGVyKChjaGlwRWwpID0+IGNoaXBFbC5jbG9zYWJsZSk7XG4gICAgICAgIGNvbnN0IGF2YWlsYWJsZUhvcml6b250YWxDaGlwRWxTcGFjZSA9IE1hdGgucm91bmQoY2hpcENvbnRhaW5lckVsV2lkdGggLVxuICAgICAgICAgICgodGhpcy5zZWxlY3RlZEhpZGRlbkNoaXBzQ291bnQgPiAwID8gc2VsZWN0ZWRJbmRpY2F0b3JDaGlwRWxXaWR0aCA6IDApICtcbiAgICAgICAgICAgIGNoaXBDb250YWluZXJFbEdhcCArXG4gICAgICAgICAgICBpbnB1dFdpZHRoICtcbiAgICAgICAgICAgIGNoaXBDb250YWluZXJFbEdhcCkpO1xuICAgICAgICB0aGlzLnJlZnJlc2hDaGlwRGlzcGxheSh7IGF2YWlsYWJsZUhvcml6b250YWxDaGlwRWxTcGFjZSwgY2hpcENvbnRhaW5lckVsR2FwLCBjaGlwRWxzIH0pO1xuICAgICAgICB0aGlzLnNldFZpc2libGVBbmRIaWRkZW5DaGlwcyhjaGlwRWxzKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuc2V0RmxvYXRpbmdFbCA9IChlbCkgPT4ge1xuICAgICAgdGhpcy5mbG9hdGluZ0VsID0gZWw7XG4gICAgICBjb25uZWN0RmxvYXRpbmdVSSh0aGlzLCB0aGlzLnJlZmVyZW5jZUVsLCB0aGlzLmZsb2F0aW5nRWwpO1xuICAgIH07XG4gICAgdGhpcy5zZXRDb250YWluZXJFbCA9IChlbCkgPT4ge1xuICAgICAgdGhpcy5yZXNpemVPYnNlcnZlci5vYnNlcnZlKGVsKTtcbiAgICAgIHRoaXMubGlzdENvbnRhaW5lckVsID0gZWw7XG4gICAgICB0aGlzLnRyYW5zaXRpb25FbCA9IGVsO1xuICAgIH07XG4gICAgdGhpcy5zZXRDaGlwQ29udGFpbmVyRWwgPSAoZWwpID0+IHtcbiAgICAgIHRoaXMucmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZShlbCk7XG4gICAgICB0aGlzLmNoaXBDb250YWluZXJFbCA9IGVsO1xuICAgIH07XG4gICAgdGhpcy5zZXRSZWZlcmVuY2VFbCA9IChlbCkgPT4ge1xuICAgICAgdGhpcy5yZWZlcmVuY2VFbCA9IGVsO1xuICAgICAgY29ubmVjdEZsb2F0aW5nVUkodGhpcywgdGhpcy5yZWZlcmVuY2VFbCwgdGhpcy5mbG9hdGluZ0VsKTtcbiAgICB9O1xuICAgIHRoaXMuc2V0QWxsU2VsZWN0ZWRJbmRpY2F0b3JDaGlwRWwgPSAoZWwpID0+IHtcbiAgICAgIHRoaXMuYWxsU2VsZWN0ZWRJbmRpY2F0b3JDaGlwRWwgPSBlbDtcbiAgICB9O1xuICAgIHRoaXMuc2V0U2VsZWN0ZWRJbmRpY2F0b3JDaGlwRWwgPSAoZWwpID0+IHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRJbmRpY2F0b3JDaGlwRWwgPSBlbDtcbiAgICB9O1xuICAgIHRoaXMuaW5wdXRIYW5kbGVyID0gKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICAgIHRoaXMudGV4dCA9IHZhbHVlO1xuICAgICAgdGhpcy5maWx0ZXJJdGVtcyh2YWx1ZSk7XG4gICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgdGhpcy5hY3RpdmVDaGlwSW5kZXggPSAtMTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuZmlsdGVySXRlbXMgPSAoKCkgPT4ge1xuICAgICAgY29uc3QgZmluZCA9IChpdGVtLCBmaWx0ZXJlZERhdGEpID0+IGl0ZW0gJiZcbiAgICAgICAgZmlsdGVyZWREYXRhLnNvbWUoKHsgbGFiZWwsIHZhbHVlIH0pID0+IGlzR3JvdXAoaXRlbSkgPyBsYWJlbCA9PT0gaXRlbS5sYWJlbCA6IHZhbHVlID09PSBpdGVtLnZhbHVlICYmIGxhYmVsID09PSBpdGVtLnRleHRMYWJlbCk7XG4gICAgICByZXR1cm4gZGVib3VuY2UoKHRleHQpID0+IHtcbiAgICAgICAgY29uc3QgZmlsdGVyZWREYXRhID0gZmlsdGVyKHRoaXMuZGF0YSwgdGV4dCk7XG4gICAgICAgIGNvbnN0IGl0ZW1zQW5kR3JvdXBzID0gdGhpcy5nZXRJdGVtc0FuZEdyb3VwcygpO1xuICAgICAgICBpdGVtc0FuZEdyb3Vwcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgY29uc3QgaGlkZGVuID0gIWZpbmQoaXRlbSwgZmlsdGVyZWREYXRhKTtcbiAgICAgICAgICBpdGVtLmhpZGRlbiA9IGhpZGRlbjtcbiAgICAgICAgICBjb25zdCBbcGFyZW50LCBncmFuZHBhcmVudF0gPSBpdGVtLmFuY2VzdG9ycztcbiAgICAgICAgICBpZiAoZmluZChwYXJlbnQsIGZpbHRlcmVkRGF0YSkgfHwgZmluZChncmFuZHBhcmVudCwgZmlsdGVyZWREYXRhKSkge1xuICAgICAgICAgICAgaXRlbS5oaWRkZW4gPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFoaWRkZW4pIHtcbiAgICAgICAgICAgIGl0ZW0uYW5jZXN0b3JzLmZvckVhY2goKGFuY2VzdG9yKSA9PiAoYW5jZXN0b3IuaGlkZGVuID0gZmFsc2UpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmZpbHRlcmVkSXRlbXMgPSB0aGlzLmdldEZpbHRlcmVkSXRlbXMoKTtcbiAgICAgICAgdGhpcy5jYWxjaXRlQ29tYm9ib3hGaWx0ZXJDaGFuZ2UuZW1pdCgpO1xuICAgICAgfSwgMTAwKTtcbiAgICB9KSgpO1xuICAgIHRoaXMuaW50ZXJuYWxDb21ib2JveENoYW5nZUV2ZW50ID0gKCkgPT4ge1xuICAgICAgdGhpcy5jYWxjaXRlQ29tYm9ib3hDaGFuZ2UuZW1pdCgpO1xuICAgIH07XG4gICAgdGhpcy5lbWl0Q29tYm9ib3hDaGFuZ2UgPSBkZWJvdW5jZSh0aGlzLmludGVybmFsQ29tYm9ib3hDaGFuZ2VFdmVudCwgMCk7XG4gICAgdGhpcy5nZXRTZWxlY3RlZEl0ZW1zID0gKCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLmlzTXVsdGkoKSkge1xuICAgICAgICBjb25zdCBtYXRjaCA9IHRoaXMuaXRlbXMuZmluZCgoeyBzZWxlY3RlZCB9KSA9PiBzZWxlY3RlZCk7XG4gICAgICAgIHJldHVybiBtYXRjaCA/IFttYXRjaF0gOiBbXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAodGhpcy5pdGVtc1xuICAgICAgICAuZmlsdGVyKChpdGVtKSA9PiBpdGVtLnNlbGVjdGVkICYmICh0aGlzLnNlbGVjdGlvbk1vZGUgIT09IFwiYW5jZXN0b3JzXCIgfHwgIWhhc0FjdGl2ZUNoaWxkcmVuKGl0ZW0pKSlcbiAgICAgICAgLyoqIFByZXNlcnZlIG9yZGVyIG9mIGVudGVyZWQgdGFncyAqL1xuICAgICAgICAuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICBjb25zdCBhSWR4ID0gdGhpcy5zZWxlY3RlZEl0ZW1zLmluZGV4T2YoYSk7XG4gICAgICAgIGNvbnN0IGJJZHggPSB0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihiKTtcbiAgICAgICAgaWYgKGFJZHggPiAtMSAmJiBiSWR4ID4gLTEpIHtcbiAgICAgICAgICByZXR1cm4gYUlkeCAtIGJJZHg7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJJZHggLSBhSWR4O1xuICAgICAgfSkpO1xuICAgIH07XG4gICAgdGhpcy51cGRhdGVJdGVtcyA9ICgpID0+IHtcbiAgICAgIHRoaXMuaXRlbXMgPSB0aGlzLmdldEl0ZW1zKCk7XG4gICAgICB0aGlzLmdyb3VwSXRlbXMgPSB0aGlzLmdldEdyb3VwSXRlbXMoKTtcbiAgICAgIHRoaXMuZGF0YSA9IHRoaXMuZ2V0RGF0YSgpO1xuICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gdGhpcy5nZXRTZWxlY3RlZEl0ZW1zKCk7XG4gICAgICB0aGlzLmZpbHRlcmVkSXRlbXMgPSB0aGlzLmdldEZpbHRlcmVkSXRlbXMoKTtcbiAgICAgIHRoaXMubmVlZHNJY29uID0gdGhpcy5nZXROZWVkc0ljb24oKTtcbiAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBpdGVtLnNlbGVjdGlvbk1vZGUgPSB0aGlzLnNlbGVjdGlvbk1vZGU7XG4gICAgICAgIGl0ZW0uc2NhbGUgPSB0aGlzLnNjYWxlO1xuICAgICAgfSk7XG4gICAgICBpZiAoIXRoaXMuYWxsb3dDdXN0b21WYWx1ZXMpIHtcbiAgICAgICAgdGhpcy5zZXRNYXhTY3JvbGxlckhlaWdodCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5ncm91cEl0ZW1zLmZvckVhY2goKGdyb3VwSXRlbSwgaW5kZXgsIGl0ZW1zKSA9PiB7XG4gICAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICAgIGdyb3VwSXRlbS5hZnRlckVtcHR5R3JvdXAgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXh0R3JvdXBJdGVtID0gaXRlbXNbaW5kZXggKyAxXTtcbiAgICAgICAgaWYgKG5leHRHcm91cEl0ZW0pIHtcbiAgICAgICAgICBuZXh0R3JvdXBJdGVtLmFmdGVyRW1wdHlHcm91cCA9IGdyb3VwSXRlbS5jaGlsZHJlbi5sZW5ndGggPT09IDA7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdGhpcy5zY3JvbGxUb0FjdGl2ZUl0ZW0gPSAoKSA9PiB7XG4gICAgICBjb25zdCBhY3RpdmVJdGVtID0gdGhpcy5maWx0ZXJlZEl0ZW1zW3RoaXMuYWN0aXZlSXRlbUluZGV4XTtcbiAgICAgIGlmICghYWN0aXZlSXRlbSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBoZWlnaHQgPSB0aGlzLmNhbGN1bGF0ZVNpbmdsZUl0ZW1IZWlnaHQoYWN0aXZlSXRlbSk7XG4gICAgICBjb25zdCB7IG9mZnNldEhlaWdodCwgc2Nyb2xsVG9wIH0gPSB0aGlzLmxpc3RDb250YWluZXJFbDtcbiAgICAgIGlmIChvZmZzZXRIZWlnaHQgKyBzY3JvbGxUb3AgPCBhY3RpdmVJdGVtLm9mZnNldFRvcCArIGhlaWdodCkge1xuICAgICAgICB0aGlzLmxpc3RDb250YWluZXJFbC5zY3JvbGxUb3AgPSBhY3RpdmVJdGVtLm9mZnNldFRvcCAtIG9mZnNldEhlaWdodCArIGhlaWdodDtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGFjdGl2ZUl0ZW0ub2Zmc2V0VG9wIDwgc2Nyb2xsVG9wKSB7XG4gICAgICAgIHRoaXMubGlzdENvbnRhaW5lckVsLnNjcm9sbFRvcCA9IGFjdGl2ZUl0ZW0ub2Zmc2V0VG9wO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5jb21ib2JveEZvY3VzSGFuZGxlciA9ICgpID0+IHtcbiAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMudGV4dElucHV0Py5mb2N1cygpO1xuICAgIH07XG4gICAgdGhpcy5jbGVhckRpc2FibGVkID0gZmFsc2U7XG4gICAgdGhpcy5zZWxlY3Rpb25EaXNwbGF5ID0gXCJhbGxcIjtcbiAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7XG4gICAgdGhpcy5mb3JtID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubGFiZWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wbGFjZWhvbGRlciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnBsYWNlaG9sZGVySWNvbiA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnBsYWNlaG9sZGVySWNvbkZsaXBSdGwgPSBmYWxzZTtcbiAgICB0aGlzLm1heEl0ZW1zID0gMDtcbiAgICB0aGlzLm5hbWUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5hbGxvd0N1c3RvbVZhbHVlcyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm92ZXJsYXlQb3NpdGlvbmluZyA9IFwiYWJzb2x1dGVcIjtcbiAgICB0aGlzLnJlcXVpcmVkID0gZmFsc2U7XG4gICAgdGhpcy5zZWxlY3Rpb25Nb2RlID0gXCJtdWx0aXBsZVwiO1xuICAgIHRoaXMuc2NhbGUgPSBcIm1cIjtcbiAgICB0aGlzLnZhbHVlID0gbnVsbDtcbiAgICB0aGlzLmZsaXBQbGFjZW1lbnRzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubWVzc2FnZXMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5tZXNzYWdlT3ZlcnJpZGVzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2VsZWN0ZWRJdGVtcyA9IFtdO1xuICAgIHRoaXMuZmlsdGVyZWRJdGVtcyA9IFtdO1xuICAgIHRoaXMuaXRlbXMgPSBbXTtcbiAgICB0aGlzLmdyb3VwSXRlbXMgPSBbXTtcbiAgICB0aGlzLm5lZWRzSWNvbiA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmFjdGl2ZUl0ZW1JbmRleCA9IC0xO1xuICAgIHRoaXMuYWN0aXZlQ2hpcEluZGV4ID0gLTE7XG4gICAgdGhpcy5hY3RpdmVEZXNjZW5kYW50ID0gXCJcIjtcbiAgICB0aGlzLmNvbXBhY3RTZWxlY3Rpb25EaXNwbGF5ID0gZmFsc2U7XG4gICAgdGhpcy5zZWxlY3RlZEhpZGRlbkNoaXBzQ291bnQgPSAwO1xuICAgIHRoaXMuc2VsZWN0ZWRWaXNpYmxlQ2hpcHNDb3VudCA9IDA7XG4gICAgdGhpcy50ZXh0ID0gXCJcIjtcbiAgICB0aGlzLmVmZmVjdGl2ZUxvY2FsZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmRlZmF1bHRNZXNzYWdlcyA9IHVuZGVmaW5lZDtcbiAgfVxuICBvcGVuSGFuZGxlcigpIHtcbiAgICBvblRvZ2dsZU9wZW5DbG9zZUNvbXBvbmVudCh0aGlzKTtcbiAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xuICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuc2V0TWF4U2Nyb2xsZXJIZWlnaHQoKTtcbiAgfVxuICBoYW5kbGVEaXNhYmxlZENoYW5nZSh2YWx1ZSkge1xuICAgIGlmICghdmFsdWUpIHtcbiAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgIH1cbiAgfVxuICBtYXhJdGVtc0hhbmRsZXIoKSB7XG4gICAgdGhpcy5zZXRNYXhTY3JvbGxlckhlaWdodCgpO1xuICB9XG4gIG92ZXJsYXlQb3NpdGlvbmluZ0hhbmRsZXIoKSB7XG4gICAgdGhpcy5yZXBvc2l0aW9uKHRydWUpO1xuICB9XG4gIGhhbmRsZVByb3BzQ2hhbmdlKCkge1xuICAgIHRoaXMudXBkYXRlSXRlbXMoKTtcbiAgfVxuICB2YWx1ZUhhbmRsZXIodmFsdWUpIHtcbiAgICBpZiAoIXRoaXMuaW50ZXJuYWxWYWx1ZUNoYW5nZUZsYWcpIHtcbiAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5nZXRJdGVtcygpO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IChpdGVtLnNlbGVjdGVkID0gdmFsdWUuaW5jbHVkZXMoaXRlbS52YWx1ZSkpKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHZhbHVlKSB7XG4gICAgICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IChpdGVtLnNlbGVjdGVkID0gdmFsdWUgPT09IGl0ZW0udmFsdWUpKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiAoaXRlbS5zZWxlY3RlZCA9IGZhbHNlKSk7XG4gICAgICB9XG4gICAgICB0aGlzLnVwZGF0ZUl0ZW1zKCk7XG4gICAgfVxuICB9XG4gIG9uTWVzc2FnZXNDaGFuZ2UoKSB7XG4gICAgLyogIHdpcmVkIHVwIGJ5IHQ5biB1dGlsICovXG4gIH1cbiAgZmxpcFBsYWNlbWVudHNIYW5kbGVyKCkge1xuICAgIHRoaXMuc2V0RmlsdGVyZWRQbGFjZW1lbnRzKCk7XG4gICAgdGhpcy5yZXBvc2l0aW9uKHRydWUpO1xuICB9XG4gIHNlbGVjdGVkSXRlbXNIYW5kbGVyKCkge1xuICAgIHRoaXMuaW50ZXJuYWxWYWx1ZUNoYW5nZUZsYWcgPSB0cnVlO1xuICAgIHRoaXMudmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7XG4gICAgdGhpcy5pbnRlcm5hbFZhbHVlQ2hhbmdlRmxhZyA9IGZhbHNlO1xuICB9XG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIEV2ZW50IExpc3RlbmVyc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGRvY3VtZW50Q2xpY2tIYW5kbGVyKGV2ZW50KSB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZWQgfHwgIWlzUHJpbWFyeVBvaW50ZXJCdXR0b24oZXZlbnQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGNvbXBvc2VkUGF0aCA9IGV2ZW50LmNvbXBvc2VkUGF0aCgpO1xuICAgIGlmIChjb21wb3NlZFBhdGguaW5jbHVkZXModGhpcy5lbCkgfHwgY29tcG9zZWRQYXRoLmluY2x1ZGVzKHRoaXMucmVmZXJlbmNlRWwpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghdGhpcy5hbGxvd0N1c3RvbVZhbHVlcyAmJiB0aGlzLnRleHRJbnB1dC52YWx1ZSkge1xuICAgICAgdGhpcy5jbGVhcklucHV0VmFsdWUoKTtcbiAgICAgIHRoaXMuZmlsdGVySXRlbXMoXCJcIik7XG4gICAgICB0aGlzLnVwZGF0ZUFjdGl2ZUl0ZW1JbmRleCgtMSk7XG4gICAgfVxuICAgIGlmICh0aGlzLmFsbG93Q3VzdG9tVmFsdWVzICYmIHRoaXMudGV4dC50cmltKCkubGVuZ3RoKSB7XG4gICAgICB0aGlzLmFkZEN1c3RvbUNoaXAodGhpcy50ZXh0KTtcbiAgICB9XG4gICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gIH1cbiAgY2FsY2l0ZUNvbWJvYm94SXRlbUNoYW5nZUhhbmRsZXIoZXZlbnQpIHtcbiAgICBpZiAodGhpcy5pZ25vcmVTZWxlY3RlZEV2ZW50c0ZsYWcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgIGNvbnN0IG5ld0luZGV4ID0gdGhpcy5maWx0ZXJlZEl0ZW1zLmluZGV4T2YodGFyZ2V0KTtcbiAgICB0aGlzLnVwZGF0ZUFjdGl2ZUl0ZW1JbmRleChuZXdJbmRleCk7XG4gICAgdGhpcy50b2dnbGVTZWxlY3Rpb24odGFyZ2V0LCB0YXJnZXQuc2VsZWN0ZWQpO1xuICB9XG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIFB1YmxpYyBNZXRob2RzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFVwZGF0ZXMgdGhlIHBvc2l0aW9uIG9mIHRoZSBjb21wb25lbnQuXG4gICAqXG4gICAqIEBwYXJhbSBkZWxheWVkIFJlcG9zaXRpb24gdGhlIGNvbXBvbmVudCBhZnRlciBhIGRlbGF5XG4gICAqIEByZXR1cm5zIFByb21pc2VcbiAgICovXG4gIGFzeW5jIHJlcG9zaXRpb24oZGVsYXllZCA9IGZhbHNlKSB7XG4gICAgY29uc3QgeyBmbG9hdGluZ0VsLCByZWZlcmVuY2VFbCwgcGxhY2VtZW50LCBvdmVybGF5UG9zaXRpb25pbmcsIGZpbHRlcmVkRmxpcFBsYWNlbWVudHMgfSA9IHRoaXM7XG4gICAgcmV0dXJuIHJlcG9zaXRpb24odGhpcywge1xuICAgICAgZmxvYXRpbmdFbCxcbiAgICAgIHJlZmVyZW5jZUVsLFxuICAgICAgb3ZlcmxheVBvc2l0aW9uaW5nLFxuICAgICAgcGxhY2VtZW50LFxuICAgICAgZmxpcFBsYWNlbWVudHM6IGZpbHRlcmVkRmxpcFBsYWNlbWVudHMsXG4gICAgICB0eXBlOiBcIm1lbnVcIixcbiAgICB9LCBkZWxheWVkKTtcbiAgfVxuICAvKiogU2V0cyBmb2N1cyBvbiB0aGUgY29tcG9uZW50LiAqL1xuICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICBhd2FpdCBjb21wb25lbnRGb2N1c2FibGUodGhpcyk7XG4gICAgdGhpcy50ZXh0SW5wdXQ/LmZvY3VzKCk7XG4gICAgdGhpcy5hY3RpdmVDaGlwSW5kZXggPSAtMTtcbiAgICB0aGlzLmFjdGl2ZUl0ZW1JbmRleCA9IC0xO1xuICB9XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBMaWZlY3ljbGVcbiAgLy9cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgY29ubmVjdEludGVyYWN0aXZlKHRoaXMpO1xuICAgIGNvbm5lY3RMb2NhbGl6ZWQodGhpcyk7XG4gICAgY29ubmVjdE1lc3NhZ2VzKHRoaXMpO1xuICAgIGNvbm5lY3RMYWJlbCh0aGlzKTtcbiAgICBjb25uZWN0Rm9ybSh0aGlzKTtcbiAgICB0aGlzLmludGVybmFsVmFsdWVDaGFuZ2VGbGFnID0gdHJ1ZTtcbiAgICB0aGlzLnZhbHVlID0gdGhpcy5nZXRWYWx1ZSgpO1xuICAgIHRoaXMuaW50ZXJuYWxWYWx1ZUNoYW5nZUZsYWcgPSBmYWxzZTtcbiAgICB0aGlzLm11dGF0aW9uT2JzZXJ2ZXI/Lm9ic2VydmUodGhpcy5lbCwgeyBjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWUgfSk7XG4gICAgdGhpcy51cGRhdGVJdGVtcygpO1xuICAgIHRoaXMuc2V0RmlsdGVyZWRQbGFjZW1lbnRzKCk7XG4gICAgdGhpcy5yZXBvc2l0aW9uKHRydWUpO1xuICAgIGlmICh0aGlzLm9wZW4pIHtcbiAgICAgIHRoaXMub3BlbkhhbmRsZXIoKTtcbiAgICAgIG9uVG9nZ2xlT3BlbkNsb3NlQ29tcG9uZW50KHRoaXMpO1xuICAgIH1cbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICBzZXRVcExvYWRhYmxlQ29tcG9uZW50KHRoaXMpO1xuICAgIHRoaXMudXBkYXRlSXRlbXMoKTtcbiAgICBhd2FpdCBzZXRVcE1lc3NhZ2VzKHRoaXMpO1xuICB9XG4gIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgYWZ0ZXJDb25uZWN0RGVmYXVsdFZhbHVlU2V0KHRoaXMsIHRoaXMuZ2V0VmFsdWUoKSk7XG4gICAgdGhpcy5yZXBvc2l0aW9uKHRydWUpO1xuICAgIHNldENvbXBvbmVudExvYWRlZCh0aGlzKTtcbiAgfVxuICBjb21wb25lbnREaWRSZW5kZXIoKSB7XG4gICAgaWYgKHRoaXMuZWwub2Zmc2V0SGVpZ2h0ICE9PSB0aGlzLmlucHV0SGVpZ2h0KSB7XG4gICAgICB0aGlzLnJlcG9zaXRpb24odHJ1ZSk7XG4gICAgICB0aGlzLmlucHV0SGVpZ2h0ID0gdGhpcy5lbC5vZmZzZXRIZWlnaHQ7XG4gICAgfVxuICAgIHVwZGF0ZUhvc3RJbnRlcmFjdGlvbih0aGlzKTtcbiAgfVxuICBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgdGhpcy5yZWZyZXNoU2VsZWN0aW9uRGlzcGxheSgpO1xuICB9XG4gIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgIHRoaXMubXV0YXRpb25PYnNlcnZlcj8uZGlzY29ubmVjdCgpO1xuICAgIHRoaXMucmVzaXplT2JzZXJ2ZXI/LmRpc2Nvbm5lY3QoKTtcbiAgICBkaXNjb25uZWN0SW50ZXJhY3RpdmUodGhpcyk7XG4gICAgZGlzY29ubmVjdExhYmVsKHRoaXMpO1xuICAgIGRpc2Nvbm5lY3RGb3JtKHRoaXMpO1xuICAgIGRpc2Nvbm5lY3RGbG9hdGluZ1VJKHRoaXMsIHRoaXMucmVmZXJlbmNlRWwsIHRoaXMuZmxvYXRpbmdFbCk7XG4gICAgZGlzY29ubmVjdExvY2FsaXplZCh0aGlzKTtcbiAgICBkaXNjb25uZWN0TWVzc2FnZXModGhpcyk7XG4gIH1cbiAgLyoqIHdoZW4gc2VhcmNoIHRleHQgaXMgY2xlYXJlZCwgcmVzZXQgYWN0aXZlIHRvICAqL1xuICB0ZXh0SGFuZGxlcigpIHtcbiAgICB0aGlzLnVwZGF0ZUFjdGl2ZUl0ZW1JbmRleCgtMSk7XG4gIH1cbiAgZWZmZWN0aXZlTG9jYWxlQ2hhbmdlKCkge1xuICAgIHVwZGF0ZU1lc3NhZ2VzKHRoaXMsIHRoaXMuZWZmZWN0aXZlTG9jYWxlKTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUHJpdmF0ZSBNZXRob2RzXG4gIC8vXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGNsZWFyVmFsdWUoKSB7XG4gICAgdGhpcy5pZ25vcmVTZWxlY3RlZEV2ZW50c0ZsYWcgPSB0cnVlO1xuICAgIHRoaXMuaXRlbXMuZm9yRWFjaCgoZWwpID0+IChlbC5zZWxlY3RlZCA9IGZhbHNlKSk7XG4gICAgdGhpcy5pZ25vcmVTZWxlY3RlZEV2ZW50c0ZsYWcgPSBmYWxzZTtcbiAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSBbXTtcbiAgICB0aGlzLmVtaXRDb21ib2JveENoYW5nZSgpO1xuICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgIHRoaXMudXBkYXRlQWN0aXZlSXRlbUluZGV4KC0xKTtcbiAgICB0aGlzLnJlc2V0VGV4dCgpO1xuICAgIHRoaXMuZmlsdGVySXRlbXMoXCJcIik7XG4gICAgdGhpcy5zZXRGb2N1cygpO1xuICB9XG4gIGNsZWFySW5wdXRWYWx1ZSgpIHtcbiAgICB0aGlzLnRleHRJbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgdGhpcy50ZXh0ID0gXCJcIjtcbiAgfVxuICBjb21ib2JveEluVmlld3BvcnQoKSB7XG4gICAgY29uc3QgYm91bmRpbmcgPSB0aGlzLmVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJldHVybiAoYm91bmRpbmcudG9wID49IDAgJiZcbiAgICAgIGJvdW5kaW5nLmxlZnQgPj0gMCAmJlxuICAgICAgYm91bmRpbmcucmlnaHQgPD0gKHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCkgJiZcbiAgICAgIGJvdW5kaW5nLmJvdHRvbSA8PSAod2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpKTtcbiAgfVxuICBvbkJlZm9yZU9wZW4oKSB7XG4gICAgdGhpcy5zY3JvbGxUb0FjdGl2ZUl0ZW0oKTtcbiAgICB0aGlzLmNhbGNpdGVDb21ib2JveEJlZm9yZU9wZW4uZW1pdCgpO1xuICB9XG4gIG9uT3BlbigpIHtcbiAgICB0aGlzLmNhbGNpdGVDb21ib2JveE9wZW4uZW1pdCgpO1xuICB9XG4gIG9uQmVmb3JlQ2xvc2UoKSB7XG4gICAgdGhpcy5jYWxjaXRlQ29tYm9ib3hCZWZvcmVDbG9zZS5lbWl0KCk7XG4gIH1cbiAgb25DbG9zZSgpIHtcbiAgICB0aGlzLmNhbGNpdGVDb21ib2JveENsb3NlLmVtaXQoKTtcbiAgfVxuICBlbnN1cmVSZWNlbnRTZWxlY3RlZEl0ZW1Jc0FjdGl2ZSgpIHtcbiAgICBjb25zdCB7IHNlbGVjdGVkSXRlbXMgfSA9IHRoaXM7XG4gICAgY29uc3QgdGFyZ2V0SW5kZXggPSBzZWxlY3RlZEl0ZW1zLmxlbmd0aCA9PT0gMCA/IDAgOiB0aGlzLml0ZW1zLmluZGV4T2Yoc2VsZWN0ZWRJdGVtc1tzZWxlY3RlZEl0ZW1zLmxlbmd0aCAtIDFdKTtcbiAgICB0aGlzLnVwZGF0ZUFjdGl2ZUl0ZW1JbmRleCh0YXJnZXRJbmRleCk7XG4gIH1cbiAgaGlkZUNoaXAoY2hpcEVsKSB7XG4gICAgY2hpcEVsLmNsYXNzTGlzdC5hZGQoQ1NTJDEuY2hpcEludmlzaWJsZSk7XG4gIH1cbiAgc2hvd0NoaXAoY2hpcEVsKSB7XG4gICAgY2hpcEVsLmNsYXNzTGlzdC5yZW1vdmUoQ1NTJDEuY2hpcEludmlzaWJsZSk7XG4gIH1cbiAgcmVmcmVzaENoaXBEaXNwbGF5KHsgY2hpcEVscywgYXZhaWxhYmxlSG9yaXpvbnRhbENoaXBFbFNwYWNlLCBjaGlwQ29udGFpbmVyRWxHYXAsIH0pIHtcbiAgICBjaGlwRWxzLmZvckVhY2goKGNoaXBFbCkgPT4ge1xuICAgICAgaWYgKCFjaGlwRWwuc2VsZWN0ZWQpIHtcbiAgICAgICAgdGhpcy5oaWRlQ2hpcChjaGlwRWwpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IGNoaXBFbFdpZHRoID0gZ2V0RWxlbWVudFdpZHRoKGNoaXBFbCk7XG4gICAgICAgIGlmIChjaGlwRWxXaWR0aCAmJiBjaGlwRWxXaWR0aCA8IGF2YWlsYWJsZUhvcml6b250YWxDaGlwRWxTcGFjZSkge1xuICAgICAgICAgIGF2YWlsYWJsZUhvcml6b250YWxDaGlwRWxTcGFjZSAtPSBjaGlwRWxXaWR0aCArIGNoaXBDb250YWluZXJFbEdhcDtcbiAgICAgICAgICB0aGlzLnNob3dDaGlwKGNoaXBFbCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLmhpZGVDaGlwKGNoaXBFbCk7XG4gICAgfSk7XG4gIH1cbiAgc2V0Q29tcGFjdFNlbGVjdGlvbkRpc3BsYXkoeyBjaGlwQ29udGFpbmVyRWxHYXAsIGNoaXBDb250YWluZXJFbFdpZHRoLCBpbnB1dFdpZHRoLCBsYXJnZXN0U2VsZWN0ZWRJbmRpY2F0b3JDaGlwV2lkdGgsIH0pIHtcbiAgICBjb25zdCBuZXdDb21wYWN0QnJlYWtwb2ludCA9IE1hdGgucm91bmQobGFyZ2VzdFNlbGVjdGVkSW5kaWNhdG9yQ2hpcFdpZHRoICsgY2hpcENvbnRhaW5lckVsR2FwICsgaW5wdXRXaWR0aCk7XG4gICAgaWYgKCF0aGlzLm1heENvbXBhY3RCcmVha3BvaW50IHx8IHRoaXMubWF4Q29tcGFjdEJyZWFrcG9pbnQgPCBuZXdDb21wYWN0QnJlYWtwb2ludCkge1xuICAgICAgdGhpcy5tYXhDb21wYWN0QnJlYWtwb2ludCA9IG5ld0NvbXBhY3RCcmVha3BvaW50O1xuICAgIH1cbiAgICB0aGlzLmNvbXBhY3RTZWxlY3Rpb25EaXNwbGF5ID0gY2hpcENvbnRhaW5lckVsV2lkdGggPCB0aGlzLm1heENvbXBhY3RCcmVha3BvaW50O1xuICB9XG4gIHNldFZpc2libGVBbmRIaWRkZW5DaGlwcyhjaGlwRWxzKSB7XG4gICAgbGV0IG5ld1NlbGVjdGVkVmlzaWJsZUNoaXBzQ291bnQgPSAwO1xuICAgIGNoaXBFbHMuZm9yRWFjaCgoY2hpcEVsKSA9PiB7XG4gICAgICBpZiAoY2hpcEVsLnNlbGVjdGVkICYmICFjaGlwRWwuY2xhc3NMaXN0LmNvbnRhaW5zKENTUyQxLmNoaXBJbnZpc2libGUpKSB7XG4gICAgICAgIG5ld1NlbGVjdGVkVmlzaWJsZUNoaXBzQ291bnQrKztcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAobmV3U2VsZWN0ZWRWaXNpYmxlQ2hpcHNDb3VudCAhPT0gdGhpcy5zZWxlY3RlZFZpc2libGVDaGlwc0NvdW50KSB7XG4gICAgICB0aGlzLnNlbGVjdGVkVmlzaWJsZUNoaXBzQ291bnQgPSBuZXdTZWxlY3RlZFZpc2libGVDaGlwc0NvdW50O1xuICAgIH1cbiAgICBjb25zdCBuZXdTZWxlY3RlZEhpZGRlbkNoaXBzQ291bnQgPSB0aGlzLmdldFNlbGVjdGVkSXRlbXMoKS5sZW5ndGggLSBuZXdTZWxlY3RlZFZpc2libGVDaGlwc0NvdW50O1xuICAgIGlmIChuZXdTZWxlY3RlZEhpZGRlbkNoaXBzQ291bnQgIT09IHRoaXMuc2VsZWN0ZWRIaWRkZW5DaGlwc0NvdW50KSB7XG4gICAgICB0aGlzLnNlbGVjdGVkSGlkZGVuQ2hpcHNDb3VudCA9IG5ld1NlbGVjdGVkSGlkZGVuQ2hpcHNDb3VudDtcbiAgICB9XG4gIH1cbiAgZ2V0TWF4U2Nyb2xsZXJIZWlnaHQoKSB7XG4gICAgY29uc3QgaXRlbXMgPSB0aGlzLmdldEl0ZW1zQW5kR3JvdXBzKCkuZmlsdGVyKChpdGVtKSA9PiAhaXRlbS5oaWRkZW4pO1xuICAgIGNvbnN0IHsgbWF4SXRlbXMgfSA9IHRoaXM7XG4gICAgbGV0IGl0ZW1zVG9Qcm9jZXNzID0gMDtcbiAgICBsZXQgbWF4U2Nyb2xsZXJIZWlnaHQgPSAwO1xuICAgIGlmIChpdGVtcy5sZW5ndGggPiBtYXhJdGVtcykge1xuICAgICAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBpZiAoaXRlbXNUb1Byb2Nlc3MgPCBtYXhJdGVtcyAmJiBtYXhJdGVtcyA+IDApIHtcbiAgICAgICAgICBjb25zdCBoZWlnaHQgPSB0aGlzLmNhbGN1bGF0ZVNpbmdsZUl0ZW1IZWlnaHQoaXRlbSk7XG4gICAgICAgICAgaWYgKGhlaWdodCA+IDApIHtcbiAgICAgICAgICAgIG1heFNjcm9sbGVySGVpZ2h0ICs9IGhlaWdodDtcbiAgICAgICAgICAgIGl0ZW1zVG9Qcm9jZXNzKys7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIG1heFNjcm9sbGVySGVpZ2h0O1xuICB9XG4gIGNhbGN1bGF0ZVNpbmdsZUl0ZW1IZWlnaHQoaXRlbSkge1xuICAgIGlmICghaXRlbSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgaGVpZ2h0ID0gaXRlbS5vZmZzZXRIZWlnaHQ7XG4gICAgLy8gaWYgaXRlbSBoYXMgY2hpbGRyZW4gaXRlbXMsIGRvbid0IGNvdW50IHRoZWlyIGhlaWdodCB0d2ljZVxuICAgIGNvbnN0IGNoaWxkcmVuID0gQXJyYXkuZnJvbShpdGVtLnF1ZXJ5U2VsZWN0b3JBbGwoQ29tYm9ib3hDaGlsZFNlbGVjdG9yKSk7XG4gICAgY2hpbGRyZW5cbiAgICAgIC5tYXAoKGNoaWxkKSA9PiBjaGlsZD8ub2Zmc2V0SGVpZ2h0KVxuICAgICAgLmZvckVhY2goKG9mZnNldEhlaWdodCkgPT4ge1xuICAgICAgaGVpZ2h0IC09IG9mZnNldEhlaWdodDtcbiAgICB9KTtcbiAgICByZXR1cm4gaGVpZ2h0O1xuICB9XG4gIGdldEl0ZW1zQW5kR3JvdXBzKCkge1xuICAgIHJldHVybiBbLi4udGhpcy5ncm91cEl0ZW1zLCAuLi50aGlzLml0ZW1zXTtcbiAgfVxuICB0b2dnbGVTZWxlY3Rpb24oaXRlbSwgdmFsdWUgPSAhaXRlbS5zZWxlY3RlZCkge1xuICAgIGlmICghaXRlbSB8fFxuICAgICAgKHRoaXMuc2VsZWN0aW9uTW9kZSA9PT0gXCJzaW5nbGUtcGVyc2lzdFwiICYmIGl0ZW0uc2VsZWN0ZWQgJiYgaXRlbS52YWx1ZSA9PT0gdGhpcy52YWx1ZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHRoaXMuaXNNdWx0aSgpKSB7XG4gICAgICBpdGVtLnNlbGVjdGVkID0gdmFsdWU7XG4gICAgICB0aGlzLnVwZGF0ZUFuY2VzdG9ycyhpdGVtKTtcbiAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcyA9IHRoaXMuZ2V0U2VsZWN0ZWRJdGVtcygpO1xuICAgICAgdGhpcy5lbWl0Q29tYm9ib3hDaGFuZ2UoKTtcbiAgICAgIHRoaXMucmVzZXRUZXh0KCk7XG4gICAgICB0aGlzLmZpbHRlckl0ZW1zKFwiXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuaWdub3JlU2VsZWN0ZWRFdmVudHNGbGFnID0gdHJ1ZTtcbiAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaCgoZWwpID0+IChlbC5zZWxlY3RlZCA9IGVsID09PSBpdGVtID8gdmFsdWUgOiBmYWxzZSkpO1xuICAgICAgdGhpcy5pZ25vcmVTZWxlY3RlZEV2ZW50c0ZsYWcgPSBmYWxzZTtcbiAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcyA9IHRoaXMuZ2V0U2VsZWN0ZWRJdGVtcygpO1xuICAgICAgdGhpcy5lbWl0Q29tYm9ib3hDaGFuZ2UoKTtcbiAgICAgIGlmICh0aGlzLnRleHRJbnB1dCkge1xuICAgICAgICB0aGlzLnRleHRJbnB1dC52YWx1ZSA9IGl0ZW0udGV4dExhYmVsO1xuICAgICAgfVxuICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgICB0aGlzLnVwZGF0ZUFjdGl2ZUl0ZW1JbmRleCgtMSk7XG4gICAgICB0aGlzLnJlc2V0VGV4dCgpO1xuICAgICAgdGhpcy5maWx0ZXJJdGVtcyhcIlwiKTtcbiAgICB9XG4gIH1cbiAgdXBkYXRlQW5jZXN0b3JzKGl0ZW0pIHtcbiAgICBpZiAodGhpcy5zZWxlY3Rpb25Nb2RlICE9PSBcImFuY2VzdG9yc1wiKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGFuY2VzdG9ycyA9IGdldEl0ZW1BbmNlc3RvcnMoaXRlbSk7XG4gICAgY29uc3QgY2hpbGRyZW4gPSBnZXRJdGVtQ2hpbGRyZW4oaXRlbSk7XG4gICAgaWYgKGl0ZW0uc2VsZWN0ZWQpIHtcbiAgICAgIGFuY2VzdG9ycy5mb3JFYWNoKChlbCkgPT4ge1xuICAgICAgICBlbC5zZWxlY3RlZCA9IHRydWU7XG4gICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBjaGlsZHJlbi5mb3JFYWNoKChlbCkgPT4gKGVsLnNlbGVjdGVkID0gZmFsc2UpKTtcbiAgICAgIFsuLi5hbmNlc3RvcnNdLmZvckVhY2goKGVsKSA9PiB7XG4gICAgICAgIGlmICghaGFzQWN0aXZlQ2hpbGRyZW4oZWwpKSB7XG4gICAgICAgICAgZWwuc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIGdldEZpbHRlcmVkSXRlbXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuaXRlbXMuZmlsdGVyKChpdGVtKSA9PiAhaXRlbS5oaWRkZW4pO1xuICB9XG4gIGdldERhdGEoKSB7XG4gICAgcmV0dXJuIHRoaXMuaXRlbXMubWFwKChpdGVtKSA9PiAoe1xuICAgICAgZmlsdGVyRGlzYWJsZWQ6IGl0ZW0uZmlsdGVyRGlzYWJsZWQsXG4gICAgICB2YWx1ZTogaXRlbS52YWx1ZSxcbiAgICAgIGxhYmVsOiBpdGVtLnRleHRMYWJlbCxcbiAgICB9KSk7XG4gIH1cbiAgZ2V0TmVlZHNJY29uKCkge1xuICAgIHJldHVybiBpc1NpbmdsZUxpa2UodGhpcy5zZWxlY3Rpb25Nb2RlKSAmJiB0aGlzLml0ZW1zLnNvbWUoKGl0ZW0pID0+IGl0ZW0uaWNvbik7XG4gIH1cbiAgcmVzZXRUZXh0KCkge1xuICAgIGlmICh0aGlzLnRleHRJbnB1dCkge1xuICAgICAgdGhpcy50ZXh0SW5wdXQudmFsdWUgPSBcIlwiO1xuICAgIH1cbiAgICB0aGlzLnRleHQgPSBcIlwiO1xuICB9XG4gIGdldEl0ZW1zKCkge1xuICAgIGNvbnN0IGl0ZW1zID0gQXJyYXkuZnJvbSh0aGlzLmVsLnF1ZXJ5U2VsZWN0b3JBbGwoQ29tYm9ib3hJdGVtKSk7XG4gICAgcmV0dXJuIGl0ZW1zLmZpbHRlcigoaXRlbSkgPT4gIWl0ZW0uZGlzYWJsZWQpO1xuICB9XG4gIGdldEdyb3VwSXRlbXMoKSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5lbC5xdWVyeVNlbGVjdG9yQWxsKENvbWJvYm94SXRlbUdyb3VwKSk7XG4gIH1cbiAgYWRkQ3VzdG9tQ2hpcCh2YWx1ZSwgZm9jdXMpIHtcbiAgICBjb25zdCBleGlzdGluZ0l0ZW0gPSB0aGlzLml0ZW1zLmZpbmQoKGVsKSA9PiBlbC50ZXh0TGFiZWwgPT09IHZhbHVlKTtcbiAgICBpZiAoZXhpc3RpbmdJdGVtKSB7XG4gICAgICB0aGlzLnRvZ2dsZVNlbGVjdGlvbihleGlzdGluZ0l0ZW0sIHRydWUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGlmICghdGhpcy5pc011bHRpKCkpIHtcbiAgICAgICAgdGhpcy50b2dnbGVTZWxlY3Rpb24odGhpcy5zZWxlY3RlZEl0ZW1zW3RoaXMuc2VsZWN0ZWRJdGVtcy5sZW5ndGggLSAxXSwgZmFsc2UpO1xuICAgICAgfVxuICAgICAgY29uc3QgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoQ29tYm9ib3hJdGVtKTtcbiAgICAgIGl0ZW0udmFsdWUgPSB2YWx1ZTtcbiAgICAgIGl0ZW0udGV4dExhYmVsID0gdmFsdWU7XG4gICAgICBpdGVtLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgIHRoaXMuZWwuYXBwZW5kQ2hpbGQoaXRlbSk7XG4gICAgICB0aGlzLnJlc2V0VGV4dCgpO1xuICAgICAgaWYgKGZvY3VzKSB7XG4gICAgICAgIHRoaXMuc2V0Rm9jdXMoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMudXBkYXRlSXRlbXMoKTtcbiAgICAgIHRoaXMuZmlsdGVySXRlbXMoXCJcIik7XG4gICAgICB0aGlzLmVtaXRDb21ib2JveENoYW5nZSgpO1xuICAgIH1cbiAgfVxuICByZW1vdmVBY3RpdmVDaGlwKCkge1xuICAgIHRoaXMudG9nZ2xlU2VsZWN0aW9uKHRoaXMuc2VsZWN0ZWRJdGVtc1t0aGlzLmFjdGl2ZUNoaXBJbmRleF0sIGZhbHNlKTtcbiAgICB0aGlzLnNldEZvY3VzKCk7XG4gIH1cbiAgcmVtb3ZlTGFzdENoaXAoKSB7XG4gICAgdGhpcy50b2dnbGVTZWxlY3Rpb24odGhpcy5zZWxlY3RlZEl0ZW1zW3RoaXMuc2VsZWN0ZWRJdGVtcy5sZW5ndGggLSAxXSwgZmFsc2UpO1xuICAgIHRoaXMuc2V0Rm9jdXMoKTtcbiAgfVxuICBwcmV2aW91c0NoaXAoKSB7XG4gICAgaWYgKHRoaXMudGV4dCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBsZW5ndGggPSB0aGlzLnNlbGVjdGVkSXRlbXMubGVuZ3RoIC0gMTtcbiAgICBjb25zdCBhY3RpdmUgPSB0aGlzLmFjdGl2ZUNoaXBJbmRleDtcbiAgICB0aGlzLmFjdGl2ZUNoaXBJbmRleCA9IGFjdGl2ZSA9PT0gLTEgPyBsZW5ndGggOiBNYXRoLm1heChhY3RpdmUgLSAxLCAwKTtcbiAgICB0aGlzLnVwZGF0ZUFjdGl2ZUl0ZW1JbmRleCgtMSk7XG4gICAgdGhpcy5mb2N1c0NoaXAoKTtcbiAgfVxuICBuZXh0Q2hpcCgpIHtcbiAgICBpZiAodGhpcy50ZXh0IHx8IHRoaXMuYWN0aXZlQ2hpcEluZGV4ID09PSAtMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBsYXN0ID0gdGhpcy5zZWxlY3RlZEl0ZW1zLmxlbmd0aCAtIDE7XG4gICAgY29uc3QgbmV3SW5kZXggPSB0aGlzLmFjdGl2ZUNoaXBJbmRleCArIDE7XG4gICAgaWYgKG5ld0luZGV4ID4gbGFzdCkge1xuICAgICAgdGhpcy5hY3RpdmVDaGlwSW5kZXggPSAtMTtcbiAgICAgIHRoaXMuc2V0Rm9jdXMoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmFjdGl2ZUNoaXBJbmRleCA9IG5ld0luZGV4O1xuICAgICAgdGhpcy5mb2N1c0NoaXAoKTtcbiAgICB9XG4gICAgdGhpcy51cGRhdGVBY3RpdmVJdGVtSW5kZXgoLTEpO1xuICB9XG4gIGZvY3VzQ2hpcCgpIHtcbiAgICBjb25zdCBndWlkID0gdGhpcy5zZWxlY3RlZEl0ZW1zW3RoaXMuYWN0aXZlQ2hpcEluZGV4XT8uZ3VpZDtcbiAgICBjb25zdCBjaGlwID0gZ3VpZFxuICAgICAgPyB0aGlzLnJlZmVyZW5jZUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2NoaXBVaWRQcmVmaXh9JHtndWlkfWApXG4gICAgICA6IG51bGw7XG4gICAgY2hpcD8uc2V0Rm9jdXMoKTtcbiAgfVxuICBzaGlmdEFjdGl2ZUl0ZW1JbmRleChkZWx0YSkge1xuICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSB0aGlzLmZpbHRlcmVkSXRlbXM7XG4gICAgY29uc3QgbmV3SW5kZXggPSAodGhpcy5hY3RpdmVJdGVtSW5kZXggKyBsZW5ndGggKyBkZWx0YSkgJSBsZW5ndGg7XG4gICAgdGhpcy51cGRhdGVBY3RpdmVJdGVtSW5kZXgobmV3SW5kZXgpO1xuICAgIHRoaXMuc2Nyb2xsVG9BY3RpdmVJdGVtKCk7XG4gIH1cbiAgdXBkYXRlQWN0aXZlSXRlbUluZGV4KGluZGV4KSB7XG4gICAgdGhpcy5hY3RpdmVJdGVtSW5kZXggPSBpbmRleDtcbiAgICBsZXQgYWN0aXZlRGVzY2VuZGFudCA9IG51bGw7XG4gICAgdGhpcy5maWx0ZXJlZEl0ZW1zLmZvckVhY2goKGVsLCBpKSA9PiB7XG4gICAgICBpZiAoaSA9PT0gaW5kZXgpIHtcbiAgICAgICAgZWwuYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgYWN0aXZlRGVzY2VuZGFudCA9IGAke2l0ZW1VaWRQcmVmaXh9JHtlbC5ndWlkfWA7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgZWwuYWN0aXZlID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5hY3RpdmVEZXNjZW5kYW50ID0gYWN0aXZlRGVzY2VuZGFudDtcbiAgICBpZiAodGhpcy5hY3RpdmVJdGVtSW5kZXggPiAtMSkge1xuICAgICAgdGhpcy5hY3RpdmVDaGlwSW5kZXggPSAtMTtcbiAgICB9XG4gIH1cbiAgaXNBbGxTZWxlY3RlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRJdGVtcygpLmxlbmd0aCA9PT0gdGhpcy5nZXRTZWxlY3RlZEl0ZW1zKCkubGVuZ3RoO1xuICB9XG4gIGlzTXVsdGkoKSB7XG4gICAgcmV0dXJuICFpc1NpbmdsZUxpa2UodGhpcy5zZWxlY3Rpb25Nb2RlKTtcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBSZW5kZXIgTWV0aG9kc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIHJlbmRlckNoaXBzKCkge1xuICAgIGNvbnN0IHsgYWN0aXZlQ2hpcEluZGV4LCBzY2FsZSwgc2VsZWN0aW9uTW9kZSwgbWVzc2FnZXMgfSA9IHRoaXM7XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRJdGVtcy5tYXAoKGl0ZW0sIGkpID0+IHtcbiAgICAgIGNvbnN0IGNoaXBDbGFzc2VzID0ge1xuICAgICAgICBjaGlwOiB0cnVlLFxuICAgICAgICBcImNoaXAtLWFjdGl2ZVwiOiBhY3RpdmVDaGlwSW5kZXggPT09IGksXG4gICAgICB9O1xuICAgICAgY29uc3QgYW5jZXN0b3JzID0gWy4uLmdldEl0ZW1BbmNlc3RvcnMoaXRlbSldLnJldmVyc2UoKTtcbiAgICAgIGNvbnN0IHBhdGhMYWJlbCA9IFsuLi5hbmNlc3RvcnMsIGl0ZW1dLm1hcCgoZWwpID0+IGVsLnRleHRMYWJlbCk7XG4gICAgICBjb25zdCBsYWJlbCA9IHNlbGVjdGlvbk1vZGUgIT09IFwiYW5jZXN0b3JzXCIgPyBpdGVtLnRleHRMYWJlbCA6IHBhdGhMYWJlbC5qb2luKFwiIC8gXCIpO1xuICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1jaGlwXCIsIHsgY2xhc3M6IGNoaXBDbGFzc2VzLCBjbG9zYWJsZTogdHJ1ZSwgaWNvbjogaXRlbS5pY29uLCBpY29uRmxpcFJ0bDogaXRlbS5pY29uRmxpcFJ0bCwgaWQ6IGl0ZW0uZ3VpZCA/IGAke2NoaXBVaWRQcmVmaXh9JHtpdGVtLmd1aWR9YCA6IG51bGwsIGtleTogaXRlbS50ZXh0TGFiZWwsIG1lc3NhZ2VPdmVycmlkZXM6IHsgZGlzbWlzc0xhYmVsOiBtZXNzYWdlcy5yZW1vdmVUYWcgfSwgb25DYWxjaXRlQ2hpcENsb3NlOiAoKSA9PiB0aGlzLmNhbGNpdGVDaGlwQ2xvc2VIYW5kbGVyKGl0ZW0pLCBzY2FsZTogc2NhbGUsIHNlbGVjdGVkOiBpdGVtLnNlbGVjdGVkLCB0aXRsZTogbGFiZWwsIHZhbHVlOiBpdGVtLnZhbHVlIH0sIGxhYmVsKSk7XG4gICAgfSk7XG4gIH1cbiAgcmVuZGVyQWxsU2VsZWN0ZWRJbmRpY2F0b3JDaGlwKCkge1xuICAgIGNvbnN0IHsgY29tcGFjdFNlbGVjdGlvbkRpc3BsYXksIHNjYWxlLCBzZWxlY3RlZFZpc2libGVDaGlwc0NvdW50LCBzZXRBbGxTZWxlY3RlZEluZGljYXRvckNoaXBFbCwgfSA9IHRoaXM7XG4gICAgY29uc3QgbGFiZWwgPSB0aGlzLm1lc3NhZ2VzLmFsbFNlbGVjdGVkO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtY2hpcFwiLCB7IGNsYXNzOiB7XG4gICAgICAgIGNoaXA6IHRydWUsXG4gICAgICAgIFtDU1MkMS5jaGlwSW52aXNpYmxlXTogISh0aGlzLmlzQWxsU2VsZWN0ZWQoKSAmJlxuICAgICAgICAgICFzZWxlY3RlZFZpc2libGVDaGlwc0NvdW50ICYmXG4gICAgICAgICAgIWNvbXBhY3RTZWxlY3Rpb25EaXNwbGF5KSxcbiAgICAgIH0sIHNjYWxlOiBzY2FsZSwgdGl0bGU6IGxhYmVsLCB2YWx1ZTogXCJcIixcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9qc3gtc29ydC1wcm9wcyAtLSByZWYgc2hvdWxkIGJlIGxhc3Qgc28gbm9kZSBhdHRycy9wcm9wcyBhcmUgaW4gc3luYyAoc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9Fc3JpL2NhbGNpdGUtZGVzaWduLXN5c3RlbS9wdWxsLzY1MzApXG4gICAgICByZWY6IHNldEFsbFNlbGVjdGVkSW5kaWNhdG9yQ2hpcEVsIH0sIGxhYmVsKSk7XG4gIH1cbiAgcmVuZGVyQWxsU2VsZWN0ZWRJbmRpY2F0b3JDaGlwQ29tcGFjdCgpIHtcbiAgICBjb25zdCB7IGNvbXBhY3RTZWxlY3Rpb25EaXNwbGF5LCBzY2FsZSwgc2VsZWN0ZWRWaXNpYmxlQ2hpcHNDb3VudCB9ID0gdGhpcztcbiAgICBjb25zdCBsYWJlbCA9IHRoaXMubWVzc2FnZXMuYWxsIHx8IFwiQWxsXCI7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1jaGlwXCIsIHsgY2xhc3M6IHtcbiAgICAgICAgY2hpcDogdHJ1ZSxcbiAgICAgICAgW0NTUyQxLmNoaXBJbnZpc2libGVdOiAhKHRoaXMuaXNBbGxTZWxlY3RlZCgpICYmXG4gICAgICAgICAgIXNlbGVjdGVkVmlzaWJsZUNoaXBzQ291bnQgJiZcbiAgICAgICAgICBjb21wYWN0U2VsZWN0aW9uRGlzcGxheSksXG4gICAgICB9LCBzY2FsZTogc2NhbGUsIHRpdGxlOiBsYWJlbCwgdmFsdWU6IFwiXCIgfSwgbGFiZWwpKTtcbiAgfVxuICByZW5kZXJTZWxlY3RlZEluZGljYXRvckNoaXAoKSB7XG4gICAgY29uc3QgeyBjb21wYWN0U2VsZWN0aW9uRGlzcGxheSwgc2VsZWN0aW9uRGlzcGxheSwgZ2V0U2VsZWN0ZWRJdGVtcywgc2NhbGUsIHNlbGVjdGVkSGlkZGVuQ2hpcHNDb3VudCwgc2VsZWN0ZWRWaXNpYmxlQ2hpcHNDb3VudCwgc2V0U2VsZWN0ZWRJbmRpY2F0b3JDaGlwRWwsIH0gPSB0aGlzO1xuICAgIGxldCBjaGlwSW52aXNpYmxlO1xuICAgIGxldCBsYWJlbDtcbiAgICBpZiAoY29tcGFjdFNlbGVjdGlvbkRpc3BsYXkpIHtcbiAgICAgIGNoaXBJbnZpc2libGUgPSB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGlmIChzZWxlY3Rpb25EaXNwbGF5ID09PSBcInNpbmdsZVwiKSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkSXRlbXNDb3VudCA9IGdldFNlbGVjdGVkSXRlbXMoKS5sZW5ndGg7XG4gICAgICAgIGlmICh0aGlzLmlzQWxsU2VsZWN0ZWQoKSkge1xuICAgICAgICAgIGNoaXBJbnZpc2libGUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHNlbGVjdGVkSXRlbXNDb3VudCA+IDApIHtcbiAgICAgICAgICBjaGlwSW52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgY2hpcEludmlzaWJsZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgbGFiZWwgPSBgJHtzZWxlY3RlZEl0ZW1zQ291bnR9ICR7dGhpcy5tZXNzYWdlcy5zZWxlY3RlZH1gO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoc2VsZWN0aW9uRGlzcGxheSA9PT0gXCJmaXRcIikge1xuICAgICAgICBjaGlwSW52aXNpYmxlID0gISEoKHRoaXMuaXNBbGxTZWxlY3RlZCgpICYmIHNlbGVjdGVkVmlzaWJsZUNoaXBzQ291bnQgPT09IDApIHx8XG4gICAgICAgICAgc2VsZWN0ZWRIaWRkZW5DaGlwc0NvdW50ID09PSAwKTtcbiAgICAgICAgbGFiZWwgPVxuICAgICAgICAgIHNlbGVjdGVkVmlzaWJsZUNoaXBzQ291bnQgPiAwXG4gICAgICAgICAgICA/IGArJHtzZWxlY3RlZEhpZGRlbkNoaXBzQ291bnR9YFxuICAgICAgICAgICAgOiBgJHtzZWxlY3RlZEhpZGRlbkNoaXBzQ291bnR9ICR7dGhpcy5tZXNzYWdlcy5zZWxlY3RlZH1gO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWNoaXBcIiwgeyBjbGFzczoge1xuICAgICAgICBjaGlwOiB0cnVlLFxuICAgICAgICBbQ1NTJDEuY2hpcEludmlzaWJsZV06IGNoaXBJbnZpc2libGUsXG4gICAgICB9LCBzY2FsZTogc2NhbGUsIHRpdGxlOiBsYWJlbCwgdmFsdWU6IFwiXCIsXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvanN4LXNvcnQtcHJvcHMgLS0gcmVmIHNob3VsZCBiZSBsYXN0IHNvIG5vZGUgYXR0cnMvcHJvcHMgYXJlIGluIHN5bmMgKHNlZSBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWRlc2lnbi1zeXN0ZW0vcHVsbC82NTMwKVxuICAgICAgcmVmOiBzZXRTZWxlY3RlZEluZGljYXRvckNoaXBFbCB9LCBsYWJlbCkpO1xuICB9XG4gIHJlbmRlclNlbGVjdGVkSW5kaWNhdG9yQ2hpcENvbXBhY3QoKSB7XG4gICAgY29uc3QgeyBjb21wYWN0U2VsZWN0aW9uRGlzcGxheSwgc2VsZWN0aW9uRGlzcGxheSwgZ2V0U2VsZWN0ZWRJdGVtcywgc2NhbGUsIHNlbGVjdGVkSGlkZGVuQ2hpcHNDb3VudCwgfSA9IHRoaXM7XG4gICAgbGV0IGNoaXBJbnZpc2libGU7XG4gICAgbGV0IGxhYmVsO1xuICAgIGlmIChjb21wYWN0U2VsZWN0aW9uRGlzcGxheSkge1xuICAgICAgY29uc3Qgc2VsZWN0ZWRJdGVtc0NvdW50ID0gZ2V0U2VsZWN0ZWRJdGVtcygpLmxlbmd0aDtcbiAgICAgIGlmICh0aGlzLmlzQWxsU2VsZWN0ZWQoKSkge1xuICAgICAgICBjaGlwSW52aXNpYmxlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHNlbGVjdGlvbkRpc3BsYXkgPT09IFwiZml0XCIpIHtcbiAgICAgICAgY2hpcEludmlzaWJsZSA9ICEoc2VsZWN0ZWRIaWRkZW5DaGlwc0NvdW50ID4gMCk7XG4gICAgICAgIGxhYmVsID0gYCR7c2VsZWN0ZWRIaWRkZW5DaGlwc0NvdW50IHx8IDB9YDtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHNlbGVjdGlvbkRpc3BsYXkgPT09IFwic2luZ2xlXCIpIHtcbiAgICAgICAgY2hpcEludmlzaWJsZSA9ICEoc2VsZWN0ZWRJdGVtc0NvdW50ID4gMCk7XG4gICAgICAgIGxhYmVsID0gYCR7c2VsZWN0ZWRJdGVtc0NvdW50fWA7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgY2hpcEludmlzaWJsZSA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiAoaChcImNhbGNpdGUtY2hpcFwiLCB7IGNsYXNzOiB7XG4gICAgICAgIGNoaXA6IHRydWUsXG4gICAgICAgIFtDU1MkMS5jaGlwSW52aXNpYmxlXTogY2hpcEludmlzaWJsZSxcbiAgICAgIH0sIHNjYWxlOiBzY2FsZSwgdGl0bGU6IGxhYmVsLCB2YWx1ZTogXCJcIiB9LCBsYWJlbCkpO1xuICB9XG4gIHJlbmRlcklucHV0KCkge1xuICAgIGNvbnN0IHsgZ3VpZCwgZGlzYWJsZWQsIHBsYWNlaG9sZGVyLCBzZWxlY3Rpb25Nb2RlLCBzZWxlY3RlZEl0ZW1zLCBvcGVuIH0gPSB0aGlzO1xuICAgIGNvbnN0IHNpbmdsZSA9IGlzU2luZ2xlTGlrZShzZWxlY3Rpb25Nb2RlKTtcbiAgICBjb25zdCBzZWxlY3RlZEl0ZW0gPSBzZWxlY3RlZEl0ZW1zWzBdO1xuICAgIGNvbnN0IHNob3dMYWJlbCA9ICFvcGVuICYmIHNpbmdsZSAmJiAhIXNlbGVjdGVkSXRlbTtcbiAgICByZXR1cm4gKGgoXCJzcGFuXCIsIHsgY2xhc3M6IHtcbiAgICAgICAgXCJpbnB1dC13cmFwXCI6IHRydWUsXG4gICAgICAgIFwiaW5wdXQtd3JhcC0tc2luZ2xlXCI6IHNpbmdsZSxcbiAgICAgIH0gfSwgc2hvd0xhYmVsICYmIChoKFwic3BhblwiLCB7IGNsYXNzOiB7XG4gICAgICAgIGxhYmVsOiB0cnVlLFxuICAgICAgICBcImxhYmVsLS1pY29uXCI6ICEhc2VsZWN0ZWRJdGVtPy5pY29uLFxuICAgICAgfSwga2V5OiBcImxhYmVsXCIgfSwgc2VsZWN0ZWRJdGVtLnRleHRMYWJlbCkpLCBoKFwiaW5wdXRcIiwgeyBcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiOiB0aGlzLmFjdGl2ZURlc2NlbmRhbnQsIFwiYXJpYS1hdXRvY29tcGxldGVcIjogXCJsaXN0XCIsIFwiYXJpYS1jb250cm9sc1wiOiBgJHtsaXN0Ym94VWlkUHJlZml4fSR7Z3VpZH1gLCBcImFyaWEtbGFiZWxcIjogZ2V0TGFiZWxUZXh0KHRoaXMpLCBjbGFzczoge1xuICAgICAgICBpbnB1dDogdHJ1ZSxcbiAgICAgICAgXCJpbnB1dC0tc2luZ2xlXCI6IHRydWUsXG4gICAgICAgIFwiaW5wdXQtLXRyYW5zcGFyZW50XCI6IHRoaXMuYWN0aXZlQ2hpcEluZGV4ID4gLTEsXG4gICAgICAgIFwiaW5wdXQtLWhpZGRlblwiOiBzaG93TGFiZWwsXG4gICAgICAgIFwiaW5wdXQtLWljb25cIjogISF0aGlzLnBsYWNlaG9sZGVySWNvbixcbiAgICAgIH0sIGRpc2FibGVkOiBkaXNhYmxlZCwgaWQ6IGAke2lucHV0VWlkUHJlZml4fSR7Z3VpZH1gLCBrZXk6IFwiaW5wdXRcIiwgb25Gb2N1czogdGhpcy5jb21ib2JveEZvY3VzSGFuZGxlciwgb25JbnB1dDogdGhpcy5pbnB1dEhhbmRsZXIsIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlciwgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvanN4LXNvcnQtcHJvcHMgLS0gcmVmIHNob3VsZCBiZSBsYXN0IHNvIG5vZGUgYXR0cnMvcHJvcHMgYXJlIGluIHN5bmMgKHNlZSBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWRlc2lnbi1zeXN0ZW0vcHVsbC82NTMwKVxuICAgICAgcmVmOiAoZWwpID0+ICh0aGlzLnRleHRJbnB1dCA9IGVsKSB9KSkpO1xuICB9XG4gIHJlbmRlckxpc3RCb3hPcHRpb25zKCkge1xuICAgIHJldHVybiB0aGlzLmZpbHRlcmVkSXRlbXMubWFwKChpdGVtKSA9PiAoaChcImxpXCIsIHsgXCJhcmlhLXNlbGVjdGVkXCI6IHRvQXJpYUJvb2xlYW4oaXRlbS5zZWxlY3RlZCksIGlkOiBpdGVtLmd1aWQgPyBgJHtpdGVtVWlkUHJlZml4fSR7aXRlbS5ndWlkfWAgOiBudWxsLCByb2xlOiBcIm9wdGlvblwiLCB0YWJpbmRleDogXCItMVwiIH0sIGl0ZW0udGV4dExhYmVsKSkpO1xuICB9XG4gIHJlbmRlckZsb2F0aW5nVUlDb250YWluZXIoKSB7XG4gICAgY29uc3QgeyBzZXRGbG9hdGluZ0VsLCBzZXRDb250YWluZXJFbCwgb3BlbiB9ID0gdGhpcztcbiAgICBjb25zdCBjbGFzc2VzID0ge1xuICAgICAgW0NTUyQxLmxpc3RDb250YWluZXJdOiB0cnVlLFxuICAgICAgW0Zsb2F0aW5nQ1NTLmFuaW1hdGlvbl06IHRydWUsXG4gICAgICBbRmxvYXRpbmdDU1MuYW5pbWF0aW9uQWN0aXZlXTogb3BlbixcbiAgICB9O1xuICAgIHJldHVybiAoaChcImRpdlwiLCB7IFwiYXJpYS1oaWRkZW5cIjogXCJ0cnVlXCIsIGNsYXNzOiB7XG4gICAgICAgIFwiZmxvYXRpbmctdWktY29udGFpbmVyXCI6IHRydWUsXG4gICAgICAgIFwiZmxvYXRpbmctdWktY29udGFpbmVyLS1hY3RpdmVcIjogb3BlbixcbiAgICAgIH0sXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvanN4LXNvcnQtcHJvcHMgLS0gcmVmIHNob3VsZCBiZSBsYXN0IHNvIG5vZGUgYXR0cnMvcHJvcHMgYXJlIGluIHN5bmMgKHNlZSBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWRlc2lnbi1zeXN0ZW0vcHVsbC82NTMwKVxuICAgICAgcmVmOiBzZXRGbG9hdGluZ0VsIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogY2xhc3NlcyxcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9qc3gtc29ydC1wcm9wcyAtLSByZWYgc2hvdWxkIGJlIGxhc3Qgc28gbm9kZSBhdHRycy9wcm9wcyBhcmUgaW4gc3luYyAoc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9Fc3JpL2NhbGNpdGUtZGVzaWduLXN5c3RlbS9wdWxsLzY1MzApXG4gICAgICByZWY6IHNldENvbnRhaW5lckVsIH0sIGgoXCJ1bFwiLCB7IGNsYXNzOiB7IGxpc3Q6IHRydWUsIFwibGlzdC0taGlkZVwiOiAhb3BlbiB9IH0sIGgoXCJzbG90XCIsIG51bGwpKSkpKTtcbiAgfVxuICByZW5kZXJJY29uU3RhcnQoKSB7XG4gICAgY29uc3QgeyBzZWxlY3RlZEl0ZW1zLCBwbGFjZWhvbGRlckljb24sIHNlbGVjdGlvbk1vZGUsIHBsYWNlaG9sZGVySWNvbkZsaXBSdGwgfSA9IHRoaXM7XG4gICAgY29uc3Qgc2VsZWN0ZWRJdGVtID0gc2VsZWN0ZWRJdGVtc1swXTtcbiAgICBjb25zdCBzZWxlY3RlZEljb24gPSBzZWxlY3RlZEl0ZW0/Lmljb247XG4gICAgY29uc3Qgc2luZ2xlU2VsZWN0aW9uTW9kZSA9IGlzU2luZ2xlTGlrZShzZWxlY3Rpb25Nb2RlKTtcbiAgICBjb25zdCBpY29uQXRTdGFydCA9ICF0aGlzLm9wZW4gJiYgc2VsZWN0ZWRJdGVtXG4gICAgICA/ICEhc2VsZWN0ZWRJY29uICYmIHNpbmdsZVNlbGVjdGlvbk1vZGVcbiAgICAgIDogISF0aGlzLnBsYWNlaG9sZGVySWNvbiAmJiAoIXNlbGVjdGVkSXRlbSB8fCBzaW5nbGVTZWxlY3Rpb25Nb2RlKTtcbiAgICByZXR1cm4gKGljb25BdFN0YXJ0ICYmIChoKFwic3BhblwiLCB7IGNsYXNzOiBcImljb24tc3RhcnRcIiB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgY2xhc3M6IFwic2VsZWN0ZWQtaWNvblwiLCBmbGlwUnRsOiB0aGlzLm9wZW4gJiYgc2VsZWN0ZWRJdGVtID8gc2VsZWN0ZWRJdGVtLmljb25GbGlwUnRsIDogcGxhY2Vob2xkZXJJY29uRmxpcFJ0bCwgaWNvbjogIXRoaXMub3BlbiAmJiBzZWxlY3RlZEl0ZW0gPyBzZWxlY3RlZEljb24gOiBwbGFjZWhvbGRlckljb24sIHNjYWxlOiBnZXRJY29uU2NhbGUodGhpcy5zY2FsZSkgfSkpKSk7XG4gIH1cbiAgcmVuZGVySWNvbkVuZCgpIHtcbiAgICBjb25zdCB7IG9wZW4gfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKFwic3BhblwiLCB7IGNsYXNzOiBcImljb24tZW5kXCIgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IGljb246IG9wZW4gPyBcImNoZXZyb24tdXBcIiA6IFwiY2hldnJvbi1kb3duXCIsIHNjYWxlOiBnZXRJY29uU2NhbGUodGhpcy5zY2FsZSkgfSkpKTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBzZWxlY3Rpb25EaXNwbGF5LCBndWlkLCBsYWJlbCwgb3BlbiB9ID0gdGhpcztcbiAgICBjb25zdCBzaW5nbGVTZWxlY3Rpb25Nb2RlID0gaXNTaW5nbGVMaWtlKHRoaXMuc2VsZWN0aW9uTW9kZSk7XG4gICAgY29uc3QgYWxsU2VsZWN0aW9uRGlzcGxheSA9IHNlbGVjdGlvbkRpc3BsYXkgPT09IFwiYWxsXCI7XG4gICAgY29uc3Qgc2luZ2xlU2VsZWN0aW9uRGlzcGxheSA9IHNlbGVjdGlvbkRpc3BsYXkgPT09IFwic2luZ2xlXCI7XG4gICAgY29uc3QgZml0U2VsZWN0aW9uRGlzcGxheSA9ICFzaW5nbGVTZWxlY3Rpb25Nb2RlICYmIHNlbGVjdGlvbkRpc3BsYXkgPT09IFwiZml0XCI7XG4gICAgY29uc3QgaXNDbGVhcmFibGUgPSAhdGhpcy5jbGVhckRpc2FibGVkICYmIHRoaXMudmFsdWU/Lmxlbmd0aCA+IDA7XG4gICAgcmV0dXJuIChoKEhvc3QsIHsgb25DbGljazogdGhpcy5jb21ib2JveEZvY3VzSGFuZGxlciB9LCBoKFwiZGl2XCIsIHsgXCJhcmlhLWF1dG9jb21wbGV0ZVwiOiBcImxpc3RcIiwgXCJhcmlhLWNvbnRyb2xzXCI6IGAke2xpc3Rib3hVaWRQcmVmaXh9JHtndWlkfWAsIFwiYXJpYS1leHBhbmRlZFwiOiB0b0FyaWFCb29sZWFuKG9wZW4pLCBcImFyaWEtaGFzcG9wdXBcIjogXCJsaXN0Ym94XCIsIFwiYXJpYS1sYWJlbFwiOiBnZXRMYWJlbFRleHQodGhpcyksIFwiYXJpYS1saXZlXCI6IFwicG9saXRlXCIsIFwiYXJpYS1vd25zXCI6IGAke2xpc3Rib3hVaWRQcmVmaXh9JHtndWlkfWAsIGNsYXNzOiB7XG4gICAgICAgIHdyYXBwZXI6IHRydWUsXG4gICAgICAgIFwid3JhcHBlci0tc2luZ2xlXCI6IHNpbmdsZVNlbGVjdGlvbk1vZGUgfHwgIXRoaXMuc2VsZWN0ZWRJdGVtcy5sZW5ndGgsXG4gICAgICAgIFwid3JhcHBlci0tYWN0aXZlXCI6IG9wZW4sXG4gICAgICB9LCBvbkNsaWNrOiB0aGlzLmNsaWNrSGFuZGxlciwgb25LZXlEb3duOiB0aGlzLmtleURvd25IYW5kbGVyLCByb2xlOiBcImNvbWJvYm94XCIsXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvanN4LXNvcnQtcHJvcHMgLS0gcmVmIHNob3VsZCBiZSBsYXN0IHNvIG5vZGUgYXR0cnMvcHJvcHMgYXJlIGluIHN5bmMgKHNlZSBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWRlc2lnbi1zeXN0ZW0vcHVsbC82NTMwKVxuICAgICAgcmVmOiB0aGlzLnNldFJlZmVyZW5jZUVsIH0sIGgoXCJkaXZcIiwgeyBjbGFzczoge1xuICAgICAgICBcImdyaWQtaW5wdXRcIjogdHJ1ZSxcbiAgICAgICAgW0NTUyQxLnNlbGVjdGlvbkRpc3BsYXlGaXRdOiBmaXRTZWxlY3Rpb25EaXNwbGF5LFxuICAgICAgICBbQ1NTJDEuc2VsZWN0aW9uRGlzcGxheVNpbmdsZV06IHNpbmdsZVNlbGVjdGlvbkRpc3BsYXksXG4gICAgICB9LCByZWY6IHRoaXMuc2V0Q2hpcENvbnRhaW5lckVsIH0sIHRoaXMucmVuZGVySWNvblN0YXJ0KCksICFzaW5nbGVTZWxlY3Rpb25Nb2RlICYmICFzaW5nbGVTZWxlY3Rpb25EaXNwbGF5ICYmIHRoaXMucmVuZGVyQ2hpcHMoKSwgIXNpbmdsZVNlbGVjdGlvbk1vZGUgJiZcbiAgICAgICFhbGxTZWxlY3Rpb25EaXNwbGF5ICYmIFtcbiAgICAgIHRoaXMucmVuZGVyU2VsZWN0ZWRJbmRpY2F0b3JDaGlwKCksXG4gICAgICB0aGlzLnJlbmRlclNlbGVjdGVkSW5kaWNhdG9yQ2hpcENvbXBhY3QoKSxcbiAgICAgIHRoaXMucmVuZGVyQWxsU2VsZWN0ZWRJbmRpY2F0b3JDaGlwKCksXG4gICAgICB0aGlzLnJlbmRlckFsbFNlbGVjdGVkSW5kaWNhdG9yQ2hpcENvbXBhY3QoKSxcbiAgICBdLCBoKFwibGFiZWxcIiwgeyBjbGFzczogXCJzY3JlZW4tcmVhZGVycy1vbmx5XCIsIGh0bWxGb3I6IGAke2lucHV0VWlkUHJlZml4fSR7Z3VpZH1gLCBpZDogYCR7bGFiZWxVaWRQcmVmaXh9JHtndWlkfWAgfSwgbGFiZWwpLCB0aGlzLnJlbmRlcklucHV0KCkpLCBpc0NsZWFyYWJsZSA/IChoKFhCdXR0b24sIHsgZGlzYWJsZWQ6IHRoaXMuZGlzYWJsZWQsIGtleTogXCJjbG9zZS1idXR0b25cIiwgbGFiZWw6IHRoaXMubWVzc2FnZXMuY2xlYXIsIHNjYWxlOiB0aGlzLnNjYWxlIH0pKSA6IG51bGwsIHRoaXMucmVuZGVySWNvbkVuZCgpKSwgaChcInVsXCIsIHsgXCJhcmlhLWxhYmVsbGVkYnlcIjogYCR7bGFiZWxVaWRQcmVmaXh9JHtndWlkfWAsIFwiYXJpYS1tdWx0aXNlbGVjdGFibGVcIjogXCJ0cnVlXCIsIGNsYXNzOiBcInNjcmVlbi1yZWFkZXJzLW9ubHlcIiwgaWQ6IGAke2xpc3Rib3hVaWRQcmVmaXh9JHtndWlkfWAsIHJvbGU6IFwibGlzdGJveFwiLCB0YWJJbmRleDogLTEgfSwgdGhpcy5yZW5kZXJMaXN0Qm94T3B0aW9ucygpKSwgdGhpcy5yZW5kZXJGbG9hdGluZ1VJQ29udGFpbmVyKCksIGgoSGlkZGVuRm9ybUlucHV0U2xvdCwgeyBjb21wb25lbnQ6IHRoaXMgfSkpKTtcbiAgfVxuICBzdGF0aWMgZ2V0IGFzc2V0c0RpcnMoKSB7IHJldHVybiBbXCJhc3NldHNcIl07IH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gdGhpczsgfVxuICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgIFwib3BlblwiOiBbXCJvcGVuSGFuZGxlclwiXSxcbiAgICBcImRpc2FibGVkXCI6IFtcImhhbmRsZURpc2FibGVkQ2hhbmdlXCJdLFxuICAgIFwibWF4SXRlbXNcIjogW1wibWF4SXRlbXNIYW5kbGVyXCJdLFxuICAgIFwib3ZlcmxheVBvc2l0aW9uaW5nXCI6IFtcIm92ZXJsYXlQb3NpdGlvbmluZ0hhbmRsZXJcIl0sXG4gICAgXCJzZWxlY3Rpb25Nb2RlXCI6IFtcImhhbmRsZVByb3BzQ2hhbmdlXCJdLFxuICAgIFwic2NhbGVcIjogW1wiaGFuZGxlUHJvcHNDaGFuZ2VcIl0sXG4gICAgXCJ2YWx1ZVwiOiBbXCJ2YWx1ZUhhbmRsZXJcIl0sXG4gICAgXCJtZXNzYWdlT3ZlcnJpZGVzXCI6IFtcIm9uTWVzc2FnZXNDaGFuZ2VcIl0sXG4gICAgXCJmbGlwUGxhY2VtZW50c1wiOiBbXCJmbGlwUGxhY2VtZW50c0hhbmRsZXJcIl0sXG4gICAgXCJzZWxlY3RlZEl0ZW1zXCI6IFtcInNlbGVjdGVkSXRlbXNIYW5kbGVyXCJdLFxuICAgIFwidGV4dFwiOiBbXCJ0ZXh0SGFuZGxlclwiXSxcbiAgICBcImVmZmVjdGl2ZUxvY2FsZVwiOiBbXCJlZmZlY3RpdmVMb2NhbGVDaGFuZ2VcIl1cbiAgfTsgfVxuICBzdGF0aWMgZ2V0IHN0eWxlKCkgeyByZXR1cm4gY29tYm9ib3hDc3M7IH1cbn0sIFsxLCBcImNhbGNpdGUtY29tYm9ib3hcIiwge1xuICAgIFwiY2xlYXJEaXNhYmxlZFwiOiBbNTE2LCBcImNsZWFyLWRpc2FibGVkXCJdLFxuICAgIFwic2VsZWN0aW9uRGlzcGxheVwiOiBbNTEzLCBcInNlbGVjdGlvbi1kaXNwbGF5XCJdLFxuICAgIFwib3BlblwiOiBbMTU0MF0sXG4gICAgXCJkaXNhYmxlZFwiOiBbNTE2XSxcbiAgICBcImZvcm1cIjogWzUxM10sXG4gICAgXCJsYWJlbFwiOiBbMV0sXG4gICAgXCJwbGFjZWhvbGRlclwiOiBbMV0sXG4gICAgXCJwbGFjZWhvbGRlckljb25cIjogWzUxMywgXCJwbGFjZWhvbGRlci1pY29uXCJdLFxuICAgIFwicGxhY2Vob2xkZXJJY29uRmxpcFJ0bFwiOiBbNTE2LCBcInBsYWNlaG9sZGVyLWljb24tZmxpcC1ydGxcIl0sXG4gICAgXCJtYXhJdGVtc1wiOiBbNTE0LCBcIm1heC1pdGVtc1wiXSxcbiAgICBcIm5hbWVcIjogWzUxM10sXG4gICAgXCJhbGxvd0N1c3RvbVZhbHVlc1wiOiBbNTE2LCBcImFsbG93LWN1c3RvbS12YWx1ZXNcIl0sXG4gICAgXCJvdmVybGF5UG9zaXRpb25pbmdcIjogWzUxMywgXCJvdmVybGF5LXBvc2l0aW9uaW5nXCJdLFxuICAgIFwicmVxdWlyZWRcIjogWzUxNl0sXG4gICAgXCJzZWxlY3Rpb25Nb2RlXCI6IFs1MTMsIFwic2VsZWN0aW9uLW1vZGVcIl0sXG4gICAgXCJzY2FsZVwiOiBbNTEzXSxcbiAgICBcInZhbHVlXCI6IFsxMDI1XSxcbiAgICBcImZsaXBQbGFjZW1lbnRzXCI6IFsxNl0sXG4gICAgXCJtZXNzYWdlc1wiOiBbMTA0MF0sXG4gICAgXCJtZXNzYWdlT3ZlcnJpZGVzXCI6IFsxMDQwXSxcbiAgICBcInNlbGVjdGVkSXRlbXNcIjogWzEwNDBdLFxuICAgIFwiZmlsdGVyZWRJdGVtc1wiOiBbMTA0MF0sXG4gICAgXCJpdGVtc1wiOiBbMzJdLFxuICAgIFwiZ3JvdXBJdGVtc1wiOiBbMzJdLFxuICAgIFwibmVlZHNJY29uXCI6IFszMl0sXG4gICAgXCJhY3RpdmVJdGVtSW5kZXhcIjogWzMyXSxcbiAgICBcImFjdGl2ZUNoaXBJbmRleFwiOiBbMzJdLFxuICAgIFwiYWN0aXZlRGVzY2VuZGFudFwiOiBbMzJdLFxuICAgIFwiY29tcGFjdFNlbGVjdGlvbkRpc3BsYXlcIjogWzMyXSxcbiAgICBcInNlbGVjdGVkSGlkZGVuQ2hpcHNDb3VudFwiOiBbMzJdLFxuICAgIFwic2VsZWN0ZWRWaXNpYmxlQ2hpcHNDb3VudFwiOiBbMzJdLFxuICAgIFwidGV4dFwiOiBbMzJdLFxuICAgIFwiZWZmZWN0aXZlTG9jYWxlXCI6IFszMl0sXG4gICAgXCJkZWZhdWx0TWVzc2FnZXNcIjogWzMyXSxcbiAgICBcInJlcG9zaXRpb25cIjogWzY0XSxcbiAgICBcInNldEZvY3VzXCI6IFs2NF1cbiAgfSwgW1s1LCBcInBvaW50ZXJkb3duXCIsIFwiZG9jdW1lbnRDbGlja0hhbmRsZXJcIl0sIFswLCBcImNhbGNpdGVDb21ib2JveEl0ZW1DaGFuZ2VcIiwgXCJjYWxjaXRlQ29tYm9ib3hJdGVtQ2hhbmdlSGFuZGxlclwiXV1dKTtcbmZ1bmN0aW9uIGRlZmluZUN1c3RvbUVsZW1lbnQoKSB7XG4gIGlmICh0eXBlb2YgY3VzdG9tRWxlbWVudHMgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgY29tcG9uZW50cyA9IFtcImNhbGNpdGUtY29tYm9ib3hcIiwgXCJjYWxjaXRlLWNoaXBcIiwgXCJjYWxjaXRlLWljb25cIl07XG4gIGNvbXBvbmVudHMuZm9yRWFjaCh0YWdOYW1lID0+IHsgc3dpdGNoICh0YWdOYW1lKSB7XG4gICAgY2FzZSBcImNhbGNpdGUtY29tYm9ib3hcIjpcbiAgICAgIGlmICghY3VzdG9tRWxlbWVudHMuZ2V0KHRhZ05hbWUpKSB7XG4gICAgICAgIGN1c3RvbUVsZW1lbnRzLmRlZmluZSh0YWdOYW1lLCBDb21ib2JveCk7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBjYXNlIFwiY2FsY2l0ZS1jaGlwXCI6XG4gICAgICBpZiAoIWN1c3RvbUVsZW1lbnRzLmdldCh0YWdOYW1lKSkge1xuICAgICAgICBkZWZpbmVDdXN0b21FbGVtZW50JDIoKTtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgXCJjYWxjaXRlLWljb25cIjpcbiAgICAgIGlmICghY3VzdG9tRWxlbWVudHMuZ2V0KHRhZ05hbWUpKSB7XG4gICAgICAgIGRlZmluZUN1c3RvbUVsZW1lbnQkMSgpO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gIH0gfSk7XG59XG5kZWZpbmVDdXN0b21FbGVtZW50KCk7XG5cbmV4cG9ydCB7IENvbWJvYm94IGFzIEMsIGRlZmluZUN1c3RvbUVsZW1lbnQgYXMgZCB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9Fc3JpL2NhbGNpdGUtZGVzaWduLXN5c3RlbS9ibG9iL21haW4vTElDRU5TRS5tZCBmb3IgZGV0YWlscy5cbiAqIHYxLjExLjBcbiAqL1xuaW1wb3J0IHsgbyBhcyBub2RlTGlzdFRvQXJyYXkgfSBmcm9tICcuL2RvbS5qcyc7XG5pbXBvcnQgeyBCdWlsZCB9IGZyb20gJ0BzdGVuY2lsL2NvcmUvaW50ZXJuYWwvY2xpZW50L2luZGV4LmpzJztcblxuY29uc3QgQ29tYm9ib3hJdGVtID0gXCJDQUxDSVRFLUNPTUJPQk9YLUlURU1cIjtcbmNvbnN0IENvbWJvYm94SXRlbUdyb3VwID0gXCJDQUxDSVRFLUNPTUJPQk9YLUlURU0tR1JPVVBcIjtcbmNvbnN0IENvbWJvYm94Q2hpbGRTZWxlY3RvciA9IGAke0NvbWJvYm94SXRlbX0sICR7Q29tYm9ib3hJdGVtR3JvdXB9YDtcbmNvbnN0IENTUyA9IHtcbiAgY2hpcEludmlzaWJsZTogXCJjaGlwLS1pbnZpc2libGVcIixcbiAgc2VsZWN0aW9uRGlzcGxheUZpdDogXCJzZWxlY3Rpb24tZGlzcGxheS1maXRcIixcbiAgc2VsZWN0aW9uRGlzcGxheVNpbmdsZTogXCJzZWxlY3Rpb24tZGlzcGxheS1zaW5nbGVcIixcbiAgbGlzdENvbnRhaW5lcjogXCJsaXN0LWNvbnRhaW5lclwiLFxufTtcblxuZnVuY3Rpb24gZ2V0QW5jZXN0b3JzKGVsZW1lbnQpIHtcbiAgY29uc3QgcGFyZW50ID0gZWxlbWVudC5wYXJlbnRFbGVtZW50Py5jbG9zZXN0KENvbWJvYm94Q2hpbGRTZWxlY3Rvcik7XG4gIGNvbnN0IGdyYW5kcGFyZW50ID0gcGFyZW50Py5wYXJlbnRFbGVtZW50Py5jbG9zZXN0KENvbWJvYm94Q2hpbGRTZWxlY3Rvcik7XG4gIHJldHVybiBbcGFyZW50LCBncmFuZHBhcmVudF0uZmlsdGVyKChlbCkgPT4gZWwpO1xufVxuZnVuY3Rpb24gZ2V0SXRlbUFuY2VzdG9ycyhpdGVtKSB7XG4gIHJldHVybiAoaXRlbS5hbmNlc3RvcnM/LmZpbHRlcigoZWwpID0+IGVsLm5vZGVOYW1lID09PSBcIkNBTENJVEUtQ09NQk9CT1gtSVRFTVwiKSB8fCBbXSk7XG59XG5mdW5jdGlvbiBnZXRJdGVtQ2hpbGRyZW4oaXRlbSkge1xuICByZXR1cm4gbm9kZUxpc3RUb0FycmF5KGl0ZW0ucXVlcnlTZWxlY3RvckFsbChcImNhbGNpdGUtY29tYm9ib3gtaXRlbVwiKSk7XG59XG5mdW5jdGlvbiBoYXNBY3RpdmVDaGlsZHJlbihub2RlKSB7XG4gIGNvbnN0IGl0ZW1zID0gbm9kZUxpc3RUb0FycmF5KG5vZGUucXVlcnlTZWxlY3RvckFsbChcImNhbGNpdGUtY29tYm9ib3gtaXRlbVwiKSk7XG4gIHJldHVybiBpdGVtcy5maWx0ZXIoKGl0ZW0pID0+IGl0ZW0uc2VsZWN0ZWQpLmxlbmd0aCA+IDA7XG59XG5mdW5jdGlvbiBnZXREZXB0aChlbGVtZW50KSB7XG4gIGlmICghQnVpbGQuaXNCcm93c2VyKSB7XG4gICAgcmV0dXJuIDA7XG4gIH1cbiAgY29uc3QgcmVzdWx0ID0gZG9jdW1lbnQuZXZhbHVhdGUoXCJhbmNlc3Rvcjo6Y2FsY2l0ZS1jb21ib2JveC1pdGVtIHwgYW5jZXN0b3I6OmNhbGNpdGUtY29tYm9ib3gtaXRlbS1ncm91cFwiLCBlbGVtZW50LCBudWxsLCBYUGF0aFJlc3VsdC5VTk9SREVSRURfTk9ERV9TTkFQU0hPVF9UWVBFLCBudWxsKTtcbiAgcmV0dXJuIHJlc3VsdC5zbmFwc2hvdExlbmd0aDtcbn1cbmZ1bmN0aW9uIGlzU2luZ2xlTGlrZShzZWxlY3Rpb25Nb2RlKSB7XG4gIHJldHVybiBzZWxlY3Rpb25Nb2RlLmluY2x1ZGVzKFwic2luZ2xlXCIpO1xufVxuXG5leHBvcnQgeyBDU1MgYXMgQywgZ2V0RGVwdGggYXMgYSwgQ29tYm9ib3hDaGlsZFNlbGVjdG9yIGFzIGIsIGdldEl0ZW1BbmNlc3RvcnMgYXMgYywgZ2V0SXRlbUNoaWxkcmVuIGFzIGQsIENvbWJvYm94SXRlbSBhcyBlLCBDb21ib2JveEl0ZW1Hcm91cCBhcyBmLCBnZXRBbmNlc3RvcnMgYXMgZywgaGFzQWN0aXZlQ2hpbGRyZW4gYXMgaCwgaXNTaW5nbGVMaWtlIGFzIGkgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==