"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_ba-infographic_node_modules_arcgis_business-analyst-components_dis-cb9ce4"],{

/***/ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-selector_2.entry.js":
/*!********************************************************************************************************************************************************************!*\
  !*** ./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-selector_2.entry.js ***!
  \********************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_infographic_selector: () => (/* binding */ ArcgisInfographicSelector),
/* harmony export */   arcgis_infographic_tree: () => (/* reexport safe */ _arcgis_infographic_tree_57eabf2c_js__WEBPACK_IMPORTED_MODULE_0__.A)
/* harmony export */ });
/* harmony import */ var _index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./index-4e647411.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/index-4e647411.js");
/* harmony import */ var _base_util_b7db69f0_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./base-util-b7db69f0.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/base-util-b7db69f0.js");
/* harmony import */ var _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ElementIds-a2c40592.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/ElementIds-a2c40592.js");
/* harmony import */ var _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./GEClient-f71049f8.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/GEClient-f71049f8.js");
/* harmony import */ var _arcgis_infographic_tree_57eabf2c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./arcgis-infographic-tree-57eabf2c.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-tree-57eabf2c.js");







const arcgisInfographicSelectorCss = ":host{display:block}.infographicSelectorOuter{position:relative;width:100%;height:30px;justify-content:left;align-items:center}.selector-label-placeholder{color:gray}.infoSel-magnify{position:absolute;top:2px;left:100px;height:32px;width:32px;background-color:blue}.arcSel-combo{width:100%;height:32px;font-size:11pt;color:darkslategray}.arcSel-reports{width:calc(100% - 16px);height:100%;overflow:auto}.selector-dropdown-label{position:absolute;top:7px;left:6px;width:calc(100% - 35px);height:25px;font-size:10.5pt;font-weight:300;text-align:left;text-overflow:ellipsis;border-radius:0px;overflow:hidden;white-space:nowrap;cursor:pointer}.selector-dropdown{position:relative;height:32px;width:100%;cursor:pointer}.selector-dropdown-arrow{position:absolute;top:9px;right:7px;width:12px;height:12px;transition:all 0.15s 0.15s;transform:rotate(0)}.selector-drop-open{transform:rotate(180deg)}calcite-popover ::-webkit-scrollbar{background-color:var(--calcite-ui-background-1);width:8px;height:8px}calcite-popover ::-webkit-scrollbar-thumb{background-color:var(--calcite-ui-foreground-3)}calcite-popover ::-webkit-scrollbar-track{background-color:transparent}calcite-popover ::-webkit-scrollbar-corner{background-color:var(--calcite-ui-background-1);width:8px;height:8px}";

const ArcgisInfographicSelector = class {
  constructor(hostRef) {
    (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.r)(this, hostRef);
    this.infographicSelectorPopupOpened = (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.c)(this, "infographicSelectorPopupOpened", 6);
    this.infographicSelectorPopupClosed = (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.c)(this, "infographicSelectorPopupClosed", 6);
    this._localeSettings = {};
    this._popoverIsOpen = false;
    this._idPrefix = 'arcgis-infographic-selector-';
    this._elementIds = {}; // button
    this._idButtonPrefix = 'selector-dropdown-button-';
    this._idDropdownArrowPrefix = 'selector-dropdown-arrow-';
    this._idDropdownLabelPrefix = 'selector-dropdown-label-';
    this._idReportListPrefix = 'selector-report-list-';
    this._idPopoverPrefix = 'selector-popover-';
    this._idPopoverContentPrefix = 'selector-popover-content-';
    this._report = { id: null, name: '' };
    this.baseConfig = new _base_util_b7db69f0_js__WEBPACK_IMPORTED_MODULE_2__.B('selector', this, this.onUpdateUI);
    _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.announceVersion();
    this.langCode = this.langCode || 'en-us';
    _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.B._initialize(this.langCode);
    this.setLocaleStrings();
    this.sourceCountry = this.sourceCountry || 'US';
    this.baseConfig.updateLocaleSettings({ language: this.langCode, country: this.sourceCountry });
  }
  onEnvChanged() {
    _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_4__.E.setEnvironment(this.env);
    if (this.baseConfig) {
      // updates config and sub-component configs
      this.baseConfig.updateConfig({ env: this.env }, null);
    }
  }
  onTokenChanged() {
    // console.log('%c selector: token changed', 'color:orange;font-size:8pt', this.token)
    const t = this.token;
    const u = this.baseConfig?.config?.username;
    if (t && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.hasText(t) && u && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.hasText(u)) {
      _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_4__.T.setToken(u, t);
    }
    if (this.baseConfig) {
      this.baseConfig.updateConfig({ token: this.token }, null);
    }
  }
  onUsernameChanged() {
    // console.log('%c selector: username changed', 'color:orange;font-size:8pt', this.username)
    const u = this.username;
    const t = this.baseConfig?.config?.token;
    if (t && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.hasText(t) && u && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.hasText(u)) {
      _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_4__.T.setToken(u, t);
    }
    if (this.baseConfig) {
      this.baseConfig.updateConfig({ username: this.username }, null);
    }
  }
  onLangCodeChanged() {
    if (this.baseConfig) {
      this.baseConfig.updateConfig({ langCode: this.langCode }, null);
    }
  }
  onGeoenrichmentUrlChanged() {
    if (this.baseConfig) {
      this.baseConfig.updateConfig({ geoenrichmentUrl: this.geoenrichmentUrl }, null);
    }
  }
  onSelectedReportIdChanged() {
    if (this.baseConfig) {
      this.baseConfig.updateConfig({ sourceCountry: this.sourceCountry }, null);
    }
  }
  onSourceCountryChanged() {
    if (this.baseConfig) {
      this.baseConfig.updateConfig({ sourceCountry: this.sourceCountry }, null);
    }
  }
  onThemeChanged() {
    this.stTheme = this.theme;
    if (this.baseConfig) {
      this.baseConfig.setTheme(this.theme);
    }
  }
  onConfigChange(newConfig, oldConfig) {
    // console.log('arcgis-infographic-selector Config changed:', newConfig);
    // let changed: string[] = [];
    if (this.baseConfig) {
      if (newConfig && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.hasText(newConfig)) {
        const newCfg = JSON.parse(newConfig);
        const oldCfg = (oldConfig && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.hasText(oldConfig)) ? JSON.parse(oldConfig) : null;
        // changed = this._base.updateConfig(newCfg, oldCfg);
        this.baseConfig.updateConfig(newCfg, oldCfg);
      }
    }
    // if (newConfig !== oldConfig) {
    //   const newCfg = JSON.parse(newConfig);
    //   const oldCfg = JSON.parse(oldConfig);
    //   console.log('New config object:', newCfg);
    //   console.log('Old config object:', oldCfg);
    //   if (changed.includes('workflowEnableSearch')
    //     || changed.includes('workflowEnableUserConfigBuffers')
    //     || changed.includes('workflowEnableInfographicChoice')) {
    //     console.log("Config changed - reinit stepper");
    //     this.initSteps();
    //   }
    // }
  }
  async getConfig() {
    const myCfg = this.baseConfig;
    return myCfg;
  }
  // infographic tree report id changed
  reportSelectedEventHandler(e) {
    const report = e.detail?.report;
    if (report?.id && report?.name) {
      this.selectedReportId = report.id;
      this.onSelectedReportIdChanged();
      this._hidePlaceholderAndShowLabel(report.name);
      this.hidePopover();
    }
  }
  // Default infographic selected
  defaultReportSelectedEventHandler(e) {
    const reportId = e.detail?.reportId;
    const reportName = e.detail?.name;
    if (reportId && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.hasText(reportId)) {
      this.selectedReportId = reportId;
      this.onSelectedReportIdChanged();
      if (reportName) {
        const elem = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.queryElementById.call(this, this._elementIds.label);
        if (elem) {
          elem.innerText = reportName;
          this.hidePopover();
        }
      }
    }
  }
  onUpdateUI() { }
  _loadInstances() {
    // this.searchPlaceholder
    if (!this._instanceId)
      this._instanceId = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.E.generateId(this._idPrefix).id;
    if (!this._elementIds.label)
      this._elementIds.label = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.E.generateId(this._idDropdownLabelPrefix).id;
    if (!this._elementIds.button)
      this._elementIds.button = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.E.generateId(this._idButtonPrefix).id;
    if (!this._elementIds.popover)
      this._elementIds.popover = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.E.generateId(this._idPopoverPrefix).id;
    if (!this._elementIds.content)
      this._elementIds.content = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.E.generateId(this._idPopoverContentPrefix).id;
    if (!this._elementIds.arrow)
      this._elementIds.arrow = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.E.generateId(this._idDropdownArrowPrefix).id;
    if (!this._elementIds.reports)
      this._elementIds.reports = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.E.generateId(this._idReportListPrefix).id;
  }
  setLocaleStrings() {
    // console.log("setLocaleStrings() for infographic-selector")
    // example:
    // this.labels = {
    //   dropdownLocation: BaReportsLanguage.i18n('address-location-or-place'),
    //   dropdownBoundary: BaReportsLanguage.i18n('boundary-name'),
    //   dropdownAll: BaReportsLanguage.i18n('dropdown-all'),
    //   watermarkAll: BaReportsLanguage.i18n('all-placeholder'),
    //   watermarkLocation: BaReportsLanguage.i18n('enter-address-loc-or-place'),
    //   watermarkBoundary: BaReportsLanguage.i18n('enter-boundary-name')
    // }
    // this.showSearch = BaReportsLanguage.i18n('show-search')
    // this.searchPlaceholder = BaReportsLanguage.i18n('search-placeholder')
    // this.searchLabel = BaReportsLanguage.i18n('search-label')
    // this.searchAll = BaReportsLanguage.i18n('dropdown-all')
    // this.searchAllPlaceholder = BaReportsLanguage.i18n('all-placeholder')
    // this.searchPlaceholderShort = BaReportsLanguage.i18n('search-placeholder-short')
    // this.searchEnterBoundary = BaReportsLanguage.i18n('search-enter-boundary')
    // this.searchBoundary = BaReportsLanguage.i18n('search-boundary')
  }
  // Stencil lifecycle - called once after component is first connected to the DOM
  async componentWillLoad() {
    // Load props that may have values but no Watches have triggered yet
    if (this.env) {
      this.onEnvChanged();
    }
    if (this.token) {
      this.onTokenChanged();
    }
    if (this.username) {
      this.onUsernameChanged();
    }
    if (this.langCode) {
      this.onLangCodeChanged();
    }
    if (this.geoenrichmentUrl) {
      this.onGeoenrichmentUrlChanged();
    }
    if (this.sourceCountry) {
      this.onSourceCountryChanged();
    }
    if (this.config) {
      this.onConfigChange(this.config, '');
    }
    if (this.selectedReportId) {
      this.onSelectedReportIdChanged();
    }
    if (this.theme) {
      this.baseConfig.setTheme(this.theme);
    }
    else {
      this.baseConfig.setTheme('light');
    }
    this._loadInstances();
    // if (!this.baseConfig.hasSubComponents()) {
    //   // add the step's sub components for config updates
    //   this.baseConfig.addSubComponents([{name:'tree', @@@@ the subcomponent's baseConfig @@@}]);
    // }
  }
  // Stencil lifecycle - called just after component updates, but not called during first render()
  componentDidUpdate() {
    const self = this;
    if (self.baseConfig) {
      self.baseConfig.onComponentHasRendered();
    }
  }
  onClickDropdown(e) {
    e.stopPropagation();
    // console.log("CLICK: ", e.currentTarget)
    this.onUpdatePopoverSize();
    this._popoverIsOpen = !this._popoverIsOpen;
    if (this._popoverIsOpen) {
      this.infographicSelectorPopupOpened.emit();
    }
    else {
      this.infographicSelectorPopupClosed.emit();
    }
    const arrow = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.queryElementById.call(this.el, this._elementIds.arrow);
    if (arrow) {
      if (this._popoverIsOpen) {
        arrow.classList.add('selector-drop-open');
      }
      else {
        arrow.classList.remove('selector-drop-open');
      }
    }
    return false;
  }
  // Stencil lifecycle - called once after component is fully loaded and 1st render occurred
  componentDidLoad() {
    const self = this;
    // console.log('%c arcgis-infographic-selector didUpdate', 'font-size:8pt;color:orange;')
    self._loadInstances();
    function _clicked(e) {
      self.onClickDropdown.call(self, e);
    }
    // Component configuration notify sub-components is duplicated in all components
    // if (!self._base.hasSubComponents()) {
    //   // add the workflow sub components for config updates
    //   self._base.addSubComponents([self._elementIds.list]);
    //   //
    // }
    const dropButton = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.queryElementById.call(self.el, this._elementIds.button);
    if (dropButton) {
      dropButton.removeEventListener('click', _clicked);
      dropButton.addEventListener('click', _clicked);
    }
    const dropLabel = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.queryElementById.call(self.el, this._elementIds.label);
    if (dropLabel) {
      dropLabel.removeEventListener('click', _clicked);
      dropLabel.addEventListener('click', _clicked);
    }
    const dropArrow = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.queryElementById.call(self.el, this._elementIds.arrow);
    if (dropArrow) {
      dropArrow.removeEventListener('click', _clicked);
      dropArrow.addEventListener('click', _clicked);
    }
    function _onResize() {
      self.hidePopover();
      self.onUpdatePopoverSize();
    }
    window.removeEventListener('resize', _onResize);
    window.addEventListener('resize', _onResize);
    if (self.baseConfig) {
      self.baseConfig.onComponentHasRendered();
    }
  }
  hidePopover() {
    const popover = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.queryElementById.call(this.el, this._elementIds.popover);
    if (popover) {
      popover.setAttribute('open', 'false');
    }
    this._popoverIsOpen = false;
    this.infographicSelectorPopupClosed.emit();
    const arrow = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.queryElementById.call(this.el, this._elementIds.arrow);
    if (arrow) {
      arrow.classList.remove('selector-drop-open');
    }
  }
  onUpdatePopoverSize() {
    if (!this.el) {
      return;
    }
    let fullContentHt = 100;
    const minContentHt = 100;
    const maxPopoverWt = 450;
    const vpad = 36;
    const hpad = 16;
    const clientHt = document.documentElement.clientHeight;
    const clientWt = document.documentElement.clientWidth;
    const brr = this.el.getBoundingClientRect();
    const htAbove = brr.top;
    const htBelow = clientHt - (brr.top + brr.height) + window.scrollY;
    let fullContentWt = clientWt / 2;
    const wtRight = clientWt - brr.left + window.scrollX;
    if ((htBelow < minContentHt && htBelow < htAbove) ||
      (htAbove > htBelow && htAbove >= minContentHt)) {
      // popover max height = ht above if that space is larger than below
      fullContentHt = htAbove - vpad;
    }
    else {
      fullContentHt = htBelow - vpad;
    }
    if ((wtRight < brr.width && brr.left > wtRight) ||
      (brr.left > wtRight && brr.left >= brr.width)) {
      fullContentWt = brr.left - hpad;
    }
    else {
      fullContentWt = clientWt - brr.left - hpad;
    }
    fullContentWt = Math.min(maxPopoverWt, fullContentWt);
    // fullContentWt = Math.max(minPopoverWt, Math.min(wtRight - hpad, maxPopoverWt))
    const contentElem = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.queryElementById.call(this.el, this._elementIds.content);
    if (contentElem) {
      if (contentElem) {
        contentElem.style.height = fullContentHt + 'px';
      }
    }
    const popoverElem = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.queryElementById.call(this.el, this._elementIds.popover);
    if (popoverElem) {
      popoverElem.style.width = Math.min(450, fullContentWt) + 'px';
    }
    // notify tree that our size may have changed
    const tree = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.queryElementById.call(this.el, this._elementIds.reports);
    if (tree) {
      tree.updateLayout();
    }
  }
  _showPlaceholder() {
    const txt = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.B.i18n('select-infographic');
    const elem = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.queryElementById.call(this, this._elementIds.label);
    if (elem) {
      elem.classList.add('selector-label-placeholder');
      elem.innerText = txt;
    }
  }
  _hidePlaceholderAndShowLabel(replacementText) {
    const elem = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.queryElementById.call(this, this._elementIds.label);
    if (elem) {
      elem.classList.remove('selector-label-placeholder');
      if (replacementText) {
        elem.innerText = replacementText;
      }
    }
  }
  render() {
    // const cfg = this.baseConfig.config
    // let reportList: string = '{}'
    if (!this.baseConfig.config?.username || !_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.hasText(this.baseConfig.config.username)) {
      console.log('ERROR: arcgis-infographic-selector missing [username]');
    }
    if (!this.baseConfig.config?.token || !_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.A.hasText(this.baseConfig.config.token)) {
      console.log('ERROR: arcgis-infographic-selector missing [token]');
    }
    const pText = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_3__.B.i18n('select-infographic');
    const popStyle = {
      // 'padding-right': '20px',
      'position': 'absolute',
      'top': '0px',
      'left': '0px',
      'transform': 'translate(-312px, 7px)',
      'border': 'none',
      'box-shadow': 'none',
      'width': '450px'
    };
    const popoverStyle = {
      'padding': '6px',
      'width': '300px',
      'height': '200px'
    };
    const popupCloseHandler = () => {
      this.infographicSelectorPopupClosed.emit();
    };
    return ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._instanceId, class: "infographicSelectorOuter" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._elementIds.button, class: "selector-dropdown" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._elementIds.label, class: "selector-dropdown-label" }, pText), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("svg", { id: this._elementIds.arrow, class: "selector-dropdown-arrow", width: "24", height: "24", viewBox: "0 0 16 16", fill: "none", xmlns: "http://www.w3.org/2000/svg" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("path", { fill: "currentColor", "fill-rule": "evenodd", stroke: "currentColor", d: "M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z", "clip-rule": "evenodd" }))), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-popover", { id: this._elementIds.popover, style: popStyle, label: "Choose infographics", "pointer-disabled": "true", "overlay-positioning": "absolute", placement: "bottom-start", "offset-skidding": "4", "auto-close": "true", "reference-element": this._elementIds.button, onCalcitePopoverClose: popupCloseHandler }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._elementIds.content, style: popoverStyle }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("arcgis-infographic-tree", { id: this._elementIds.reports, portalOnlineGEProxy: this.portalOnlineGEProxy, class: "arcSel-reports", config: this.baseConfig.getConfigString() })))));
  }
  get el() { return (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.g)(this); }
  static get watchers() { return {
    "env": ["onEnvChanged"],
    "token": ["onTokenChanged"],
    "username": ["onUsernameChanged"],
    "langCode": ["onLangCodeChanged"],
    "geoenrichmentUrl": ["onGeoenrichmentUrlChanged"],
    "selectedReportId": ["onSelectedReportIdChanged"],
    "sourceCountry": ["onSourceCountryChanged"],
    "theme": ["onThemeChanged"],
    "config": ["onConfigChange"]
  }; }
};
ArcgisInfographicSelector.style = arcgisInfographicSelectorCss;



//# sourceMappingURL=arcgis-infographic-selector_2.entry.js.map

/***/ }),

/***/ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-tree-57eabf2c.js":
/*!*****************************************************************************************************************************************************************!*\
  !*** ./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-tree-57eabf2c.js ***!
  \*****************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (/* binding */ ArcgisInfographicTree)
/* harmony export */ });
/* harmony import */ var _index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./index-4e647411.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/index-4e647411.js");
/* harmony import */ var _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ElementIds-a2c40592.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/ElementIds-a2c40592.js");
/* harmony import */ var _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./GEClient-f71049f8.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/GEClient-f71049f8.js");
/* harmony import */ var _arcgisReports_0c351f0a_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./arcgisReports-0c351f0a.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgisReports-0c351f0a.js");
/* harmony import */ var _base_util_b7db69f0_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./base-util-b7db69f0.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/base-util-b7db69f0.js");






var _a;
class PreviewPopup {
  static nextCallback(f) {
    if (f) {
      this._callbackNext = f;
    }
  }
  static previousCallback(f) {
    if (f) {
      this._callbackPrev = f;
    }
  }
  static hidePopup() {
    // remove popup elements
    this._cancelTimer();
    this._removePopup();
    this._reportId = '';
  }
  static _onTimerTick() {
    this._timer = undefined;
    this.hidePopup();
  }
  static _onGoToNext() {
    if (this._callbackNext) {
      this._callbackNext(this._reportId);
    }
  }
  static _onGoToPrev() {
    if (this._callbackPrev) {
      this._callbackPrev(this._reportId);
    }
  }
  static _startTimer() {
    const self = this;
    self._cancelTimer();
    self._timer = setTimeout(() => { self._onTimerTick.call(self); }, this.timeoutSeconds * 1000);
  }
  static _cancelTimer() {
    if (this._timer) {
      clearTimeout(this._timer);
      this._timer = undefined;
    }
  }
  static _resetTimer() {
    this._cancelTimer();
    this._startTimer();
  }
  static _removePopup() {
    if (this._popupElement)
      this._popupElement.remove();
    this._popupElement = undefined;
  }
  static _generatePopup(y, ratio, src) {
    const self = this;
    // create the full size mask div that is transparent
    const maskDiv = document.createElement('div');
    maskDiv.style.position = 'absolute';
    maskDiv.style.left = '0';
    maskDiv.style.top = '0';
    maskDiv.style.width = (this._container.offsetWidth - this._rightPad) + 'px';
    maskDiv.style.height = this._container.offsetHeight + 'px';
    maskDiv.style.backgroundColor = 'transparent';
    maskDiv.style.zIndex = '900';
    this._popupElement = maskDiv;
    this._container.appendChild(this._popupElement);
    maskDiv.addEventListener('mouseover', () => { self.hidePopup(); });
    // create the image div with calculated size and placement
    this._placeImageDiv(y, ratio, src);
  }
  static _placeImageDiv(y, ratio, url) {
    // console.log( y, url)
    try {
      //Image padding constants
      const pad = 20;
      const popElem = document.createElement('img');
      let o = {
        click: { y: y },
        popup: { top: 0, right: 0, wt: 1, ht: 1 },
        adjustedContHt: 0,
        adjustedContWt: 0,
        ratio: ratio
      };
      o.adjustedContHt = this._popupElement.offsetHeight - (pad * 2);
      o.adjustedContWt = this._popupElement.offsetWidth - pad;
      // place popup centered and to the left of the click point x,y and fit as needed
      // If W >= H
      if (o.ratio >= 1) {
        // width >= height
        o.popup.wt = o.adjustedContWt;
        o.popup.ht = o.popup.wt / o.ratio;
        if (o.popup.ht > o.adjustedContHt) {
          // reduce target height to fit
          o.popup.ht = o.adjustedContHt;
          o.popup.wt = o.adjustedContHt * o.ratio;
        }
      }
      else {
        // height > width
        o.popup.ht = o.adjustedContHt;
        o.popup.wt = o.popup.ht * o.ratio;
        if (o.popup.wt > o.adjustedContWt) {
          // reduce target width to fit
          o.popup.wt = o.adjustedContWt;
          o.popup.ht = o.adjustedContWt / o.ratio;
        }
      }
      // Place in container
      const desiredTop = Math.max(o.click.y - (o.popup.ht / 2), pad);
      const maxTop = o.adjustedContHt - o.popup.ht + pad;
      o.popup.top = Math.min(desiredTop, maxTop);
      o.popup.right = 0;
      // Set the popup placement
      popElem.style.position = 'absolute';
      popElem.style.right = o.popup.right + 'px';
      popElem.style.top = o.popup.top + 'px';
      popElem.style.width = o.popup.wt + 'px';
      popElem.style.height = o.popup.ht + 'px';
      popElem.src = url;
      // Add the image source url
      this._popupElement.appendChild(popElem);
      popElem.addEventListener('mouseover', (e) => {
        e.stopPropagation();
        e.preventDefault();
        return false;
      });
    }
    catch (ex) {
      console.log('%c PreviewPopup error', 'color:red;font-size:10pt', ex);
    }
    return document.createElement('img');
  }
}
_a = PreviewPopup;
/** showPopup
*
*  applies the src attribute to the image element in the popup
*
* @param imageSrcUrl  = valid url for image
*/
PreviewPopup.show = (reportId, containerElement, clickY, ratioW2H, imageSrcUrl) => {
  if (containerElement && clickY && imageSrcUrl && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.U.hasText(imageSrcUrl)) {
    if (reportId == _a._reportId) {
      _a._resetTimer();
    }
    else {
      _a.hidePopup();
      if (!_a.timeoutSeconds) {
        _a.timeoutSeconds = 6;
      }
      _a._container = containerElement;
      _a._reportId = reportId;
      _a._generatePopup(clickY, ratioW2H, imageSrcUrl);
      _a._startTimer();
    }
  }
};
PreviewPopup._rightPad = 60;

const arcgisInfographicTreeCss = ":host{display:block}::slotted([slot=\"children\"]){width:100%}.reportList{font-weight:200}.reportItems{font-weight:200;margin-inline-end:0.25rem}.report-item-buttons{position:relative;width:23px;height:28px}.report-item-preview{position:absolute;top:5px;width:22px;height:22px}.report-item-dots{position:absolute;top:7px;left:34px;width:22px;height:22px}.reportTree{padding-bottom:2px}.infographic-tree-busy{position:absolute;top:0;left:0;width:100%;height:100%;background:url(./assets/largeBusy.gif);background-repeat:no-repeat;background-position:center;z-index:999;display:none}calcite-tree-item [selected]{font-weight:bold}.report-item-content{width:100%;height:32px;display:flex}.report-refresh-button{position:absolute;top:8px;right:10px;width:18px;height:18px}.info-tree-search-div{position:absolute;top:3px;left:3px;width:calc(100% - 165px);height:33px;display:flex}.info-tree-search{flex:1 1 0%;width:calc(100% - 29px);height:24px;float:left}.info-tree-icon{position:relative;top:4px;left:2px;width:24px;height:26px;float:right;transform:scale(0.6);background-repeat:no-repeat}.info-tree-sort{position:absolute;top:3px;left:calc(100% - 148px);width:144px;height:32px;z-index:6}.info-tree-list{position:absolute;top:36px;left:3px;height:calc(100% - 40px);width:calc(100% - 6px)}.report-item-text{position:relative;top:7px;flex:1 1 0%;text-align:left;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;font-weight:200}.report-item-popover{width:auto;height:auto;min-width:300px;min-height:200px;background-color:transparent}.report-item-popover-content{min-height:32px;line-height:200px;text-align:right}.report-item-default-popover{min-width:160px;padding:3px;height:42px}.tree-container{position:absolute;width:calc(100% - 12px);height:calc(100% - 18px);overflow-x:hidden;overflow-y:scroll}.thumbnail-preview{position:absolute;top:0;right:0;max-width:300px;max-height:200px;background-color:transparent;border:none;z-index:6;opacity:1;object-fit:cover}.report-item-popover-not-found{position:absolute;top:4px;right:41px;min-width:160px;height:32px !important;line-height:24px !important}";

const ArcgisInfographicTree = class {
  constructor(hostRef) {
    (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.r)(this, hostRef);
    this.reportSelected = (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.c)(this, "reportSelected", 7);
    this._idPrefix = 'arcgis-infographic-tree-';
    this._idPrefixBusy = 'arcgis-infographic-tree-busy-';
    this._busyIdPrefix = 'ig-tree-busy-';
    this._containerPrefix = 'ait-container-';
    this._elementIds = {}; // list, search, sort
    this._idListPrefix = 'ig-tree-list-';
    this._idSearchPrefix = 'ig-tree-search-';
    this._idSortPrefix = 'ig-tree-sort-';
    this._idPrefixReports = 'selector-popover-reports-';
    this._imgOffset = 1;
    this._dbg = false;
    this.stSourceCountry = 'US';
    this.stMultipleChoice = false;
    this.stSortType = 'newest';
    // Internal use only --------------------------------
    this._isInitialized = false;
    this.openPopoverId = null;
    _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.L.debug = false;
    _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.L.darkTheme = true;
    this.baseConfig = new _base_util_b7db69f0_js__WEBPACK_IMPORTED_MODULE_2__.B('tree', this, this.onUpdateUI);
    _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.announceVersion();
    this._instanceId = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.E.generateId(this._idPrefix).id;
    this._busyId = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.E.generateId(this._busyIdPrefix).id;
    this._infographics = {
      MyInfographics: {
        dataId: 2,
        tag: 'report-my-infographics',
        data: undefined,
      },
      EsriInfographics: {
        dataId: 3,
        tag: 'report-esri-infographics',
        data: undefined,
      },
      SharedInfographics: {
        dataId: 4,
        tag: 'report-shared-infographics',
        data: undefined,
      },
      GalleryInfographics: {
        dataId: 5,
        tag: 'report-gallery-infographics',
        data: undefined,
      }
    };
    this.langCode = 'en-us';
    this.sourceCountry = 'US';
    this.stMultipleChoice = false;
    _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.B._initialize(this.langCode);
  }
  //
  // Update Props/States and base config when the component config changes
  onConfigChange(newConfig, oldConfig) {
    if (!newConfig || typeof newConfig != 'string') {
      return;
    }
    if (this.baseConfig && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(newConfig)) {
      const newCfg = JSON.parse(newConfig);
      const oldCfg = (oldConfig && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(oldConfig)) ? JSON.parse(oldConfig) : null;
      this.baseConfig.updateConfig(newCfg, oldCfg);
      // Filter out reports not checked
      //
      // Handle reportList where items are unchecked and we dont want to show them
      if (this.baseConfig.config?.reportList) {
        // config reportList filtered to contain only checked reports
        let filtered = {};
        const raw = typeof (this.baseConfig.config.reportList) === 'string' ? JSON.parse(this.baseConfig.config.reportList) : this.baseConfig.config.reportList;
        const keys = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.getKeys(raw);
        if (keys && keys.length > 0) {
          for (let k = 0; k < keys.length; k++) {
            let reports = [];
            const key = keys[k];
            const category = raw[key];
            if (category.length > 0) {
              category.forEach((r) => {
                if (r.isChecked) {
                  reports.push(r);
                }
              });
            }
            if (reports.length > 0) {
              filtered[key] = reports;
            }
          }
        }
        // update our tree list
        this._configFilteredReports = filtered;
      }
      else {
        this._configFilteredReports = undefined;
      }
    }
  }
  // ---------------------------------------------------------------------------------------------------
  // watches
  onEnvChanged() {
    this.stEnv = this.env;
    _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_3__.E.setEnvironment(this.env);
    if (this.baseConfig) {
      // updates config and sub-component configs
      this.baseConfig.updateConfig({ env: this.env }, null);
    }
  }
  onLangCodeChanged() {
    this.stLangCode = this.langCode;
    _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.B._initialize(this.stLangCode);
    if (this.baseConfig) {
      // updates config and sub-component configs
      this.baseConfig.updateConfig({ langCode: this.langCode }, null);
    }
  }
  onSourceCountryChanged() {
    this.stSourceCountry = this.sourceCountry;
    if (this.baseConfig) {
      // updates config and sub-component configs
      this.baseConfig.updateConfig({ sourceCountry: this.sourceCountry }, null);
    }
    // Clear cached reports when country changes
    this._configFilteredReports = undefined;
    this._cachedReports = undefined;
    this.stReportList = undefined;
  }
  onTokenChanged() {
    this.stToken = this.token;
    if (this.baseConfig) {
      // updates config and sub-component configs
      this.baseConfig.updateConfig({ token: this.token }, null);
    }
    if (this.username && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(this.username) && this.token && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(this.token)) {
      (0,_arcgisReports_0c351f0a_js__WEBPACK_IMPORTED_MODULE_4__.s)(this.username, this.token); // set the ba-reports token
    }
  }
  onUsernameChanged() {
    this.stUsername = this.username;
    if (this.baseConfig) {
      // updates config and sub-component configs
      this.baseConfig.updateConfig({ username: this.username }, null);
    }
    if (this.username && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(this.username) && this.token && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(this.token)) {
      (0,_arcgisReports_0c351f0a_js__WEBPACK_IMPORTED_MODULE_4__.s)(this.username, this.token); // set the ba-reports token
    }
  }
  onSelectedReportChanged() {
    this.stSelectedReportId = this.selectedReportId;
  }
  onReportListChanged() {
    this.stReportList = Object.keys(this.reportList).length ? JSON.parse(this.reportList) : {};
  }
  onThemeChanged() {
    this.stTheme = this.theme;
    if (this.baseConfig) {
      this.baseConfig.setTheme(this.theme);
    }
  }
  onPortalUrlChanged() {
    // Set if PortalUrl was optionally passed in
    if (this.portalUrl) {
      _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_3__.E.setPortalUrl(this.portalUrl);
    }
  }
  onGeoenrichmentUrlChanged() {
    this.stGeoenrichmentUrl = this.geoenrichmentUrl;
    if (this.baseConfig) {
      // updates config and sub-component configs
      this.baseConfig.updateConfig({ geoenrichmentUrl: this.geoenrichmentUrl }, null);
    }
    // Set if GeoenrichmentUrl was optionally passed in
    if (this.geoenrichmentUrl) {
      _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_3__.E.setGeoenrichmentUrl(this.geoenrichmentUrl);
    }
  }
  async updateLayout() {
    this.adjustTreeItemsWidth();
  }
  async getConfig() {
    const myCfg = this.baseConfig;
    return myCfg;
  }
  async initialize(username, token, env, country, language, reportList) {
    const self = this;
    self.token = token;
    self.username = username;
    self.sourceCountry = country;
    self.langCode = language;
    self.env = env;
    self.stReportList = Object.keys(reportList).length ? JSON.parse(reportList) : {};
    _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_3__.E.setEnvironment(self.env);
    // Set if GeoenrichmentUrl was optionally passed in
    if (self.geoenrichmentUrl) {
      _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_3__.E.setGeoenrichmentUrl(self.geoenrichmentUrl);
    }
    // Set if PortalUrl was optionally passed in
    if (self.portalUrl) {
      _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_3__.E.setPortalUrl(self.portalUrl);
    }
    (0,_arcgisReports_0c351f0a_js__WEBPACK_IMPORTED_MODULE_4__.s)(username, token); // set the ba-reports token
    try {
      let userReports, publicReports, sharedReports, galleryReports;
      const infos = await (0,_arcgisReports_0c351f0a_js__WEBPACK_IMPORTED_MODULE_4__.g)(country, false);
      if (Object.keys(self.stReportList).length) {
        userReports = self.stReportList.user;
        publicReports = self.stReportList.public;
        sharedReports = self.stReportList.shared;
      }
      else {
        userReports = infos.user.map(report => { return { ...report, isChecked: true }; });
        publicReports = infos.public.map(report => { return { ...report, isChecked: true }; });
        sharedReports = infos.shared.map(report => { return { ...report, isChecked: true }; });
        galleryReports = infos.gallery.map(report => { return { ...report, isChecked: false }; });
        self.stReportList = { user: userReports, public: publicReports, shared: sharedReports, gallery: galleryReports };
      }
      if (infos) {
        self._infographics.MyInfographics.data = userReports;
        self._infographics.EsriInfographics.data = publicReports;
        self._infographics.SharedInfographics.data = sharedReports;
        self._infographics.GalleryInfographics.data = galleryReports;
      }
      else {
        self._infographics.MyInfographics.data = undefined;
        self._infographics.EsriInfographics.data = undefined;
        self._infographics.SharedInfographics.data = undefined;
        self._infographics.GalleryInfographics.data = undefined;
      }
      this._isInitialized = true;
      const content = ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-tree", { scale: "m", selectionMode: "single" }, self.renderList('MyInfographics'), self.renderList('EsriInfographics'), self.renderList('SharedInfographics'), self.renderList('GalleryInfographics')));
      self._content = content;
      self.showBusy.call(self, false);
    }
    catch (ex) {
      _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.L.show('%e', 'arcgis-infographic-tree request for esri reports failed', ex);
    }
  }
  setLocaleStrings() {
    // console.log("setLocaleStrings() for infographic-tree")
  }
  showBusy(flag) {
    const b = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.queryElementById.call(this, this._busyId);
    if (b) {
      if (flag) {
        b.style.display = 'block';
      }
      else {
        b.style.display = 'none';
      }
    }
  }
  async setColorTheme(name) {
    if (name && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(name) && this.el) {
      this.stColorTheme = name.trim().toLowerCase();
      const n = name.trim().toLowerCase();
      if (n === 'light') {
        this.el.style.setProperty('--calcite-ui-brand', '#007ac2');
        this.el.style.setProperty('--calcite-ui-brand-hover', '#00619b');
        this.el.style.setProperty('--calcite-ui-brand-press', '#004874');
        this.el.style.setProperty('--calcite-ui-background', '#f8f8f8');
        this.el.style.setProperty('--calcite-ui-foreground-1', '#ffffff');
        this.el.style.setProperty('--calcite-ui-foreground-2', '#f3f3f3');
        this.el.style.setProperty('--calcite-ui-foreground-3', '#eaeaea');
        this.el.style.setProperty('--calcite-ui-text-1', '#151515');
        this.el.style.setProperty('--calcite-ui-text-2', '#4a4a4a');
        this.el.style.setProperty('--calcite-ui-text-3', '#6a6a6a');
        this.el.style.setProperty('--calcite-ui-text-inverse', '#ffffff');
        this.el.style.setProperty('--calcite-ui-text-link', '#00619b');
        this.el.style.setProperty('--calcite-ui-border-1', '#cacaca');
        this.el.style.setProperty('--calcite-ui-border-2', '#d4d4d4');
        this.el.style.setProperty('--calcite-ui-border-3', '#dfdfdf');
        this.el.style.setProperty('--calcite-ui-border-input', '#949494');
        this.el.style.setProperty('--calcite-ui-info', '#00619b');
        this.el.style.setProperty('--calcite-ui-success', '#35ac46');
        this.el.style.setProperty('--calcite-tree-padding-y', '0');
      }
      else if (n === 'dark') {
        this.el.style.setProperty('--calcite-ui-brand', '#009af2');
        this.el.style.setProperty('--calcite-ui-brand-hover', '#007ac2');
        this.el.style.setProperty('--calcite-ui-brand-press', '#00619b');
        this.el.style.setProperty('--calcite-ui-background', '#353535');
        this.el.style.setProperty('--calcite-ui-foreground-1', '#2b2b2b');
        this.el.style.setProperty('--calcite-ui-foreground-2', '#202020');
        this.el.style.setProperty('--calcite-ui-foreground-3', '#151515');
        this.el.style.setProperty('--calcite-ui-text-1', '#ffffff');
        this.el.style.setProperty('--calcite-ui-text-2', '#bfbfbf');
        this.el.style.setProperty('--calcite-ui-text-3', '#9f9f9f');
        this.el.style.setProperty('--calcite-ui-text-inverse', '#151515');
        this.el.style.setProperty('--calcite-ui-text-link', '#00a0ff');
        this.el.style.setProperty('--calcite-ui-border-1', '#555555');
        this.el.style.setProperty('--calcite-ui-border-2', '#4a4a4a');
        this.el.style.setProperty('--calcite-ui-border-3', '#404040');
        this.el.style.setProperty('--calcite-ui-border-input', '#757575');
        this.el.style.setProperty('--calcite-ui-info', '#00a0ff');
        this.el.style.setProperty('--calcite-ui-success', '#36da43');
      }
    }
  }
  _loadInstances() {
    if (!this._instanceId)
      this._instanceId = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.E.generateId(this._idPrefix).id;
    if (!this._busyId)
      this._busyId = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.E.generateId(this._idPrefixBusy).id;
    if (!this._elementIds.list)
      this._elementIds.list = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.E.generateId(this._idListPrefix).id;
    if (!this._elementIds.search)
      this._elementIds.search = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.E.generateId(this._idSearchPrefix).id;
    if (!this._elementIds.sort)
      this._elementIds.sort = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.E.generateId(this._idSortPrefix).id;
  }
  // BaseUtil config-changed render callback
  onUpdateUI() {
  }
  onClickTreeItem(e, data) {
    PreviewPopup.hidePopup();
    this.reportSelected.emit({ report: data });
    e.stopPropagation();
    e.preventDefault();
    return false;
  }
  applySort(list) {
    if (list && list.length > 0) {
      const sortedList = [...list];
      let sortType = this.stSortType || 'newest';
      const elem = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.queryElementById.call(this, _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.fixId(this._elementIds.sort));
      if (typeof elem != 'undefined') {
        sortType = elem.value;
      }
      if (sortType) {
        switch (sortType) {
          case ('oldest'): {
            sortedList.sort((a, b) => {
              let da = a.date;
              let db = b.date;
              return da - db;
            });
            break;
          }
          case ('ascending'): {
            sortedList.sort((a, b) => {
              let s1 = a.title;
              let s2 = b.title;
              if (s1 < s2) {
                return -1;
              }
              if (s1 > s2) {
                return 1;
              }
              return 0;
            });
            break;
          }
          case ('descending'): {
            sortedList.sort((a, b) => {
              let s1 = a.title;
              let s2 = b.title;
              if (s1 > s2) {
                return -1;
              }
              if (s1 < s2) {
                return 1;
              }
              return 0;
            });
            break;
          }
          default: {
            // newest
            sortedList.sort((a, b) => {
              let da = a.date;
              let db = b.date;
              return db - da;
            });
            break;
          }
        }
      }
      return sortedList;
    }
    return list;
  }
  // Returns search-filtered list that is also sorted
  getFilteredReportList(name) {
    const tree = this;
    const searchFilteredList = [];
    const listNames = { 'MyInfographics': 'user', 'EsriInfographics': 'public', 'SharedInfographics': 'shared', 'GalleryInfographics': 'gallery' };
    const objName = listNames[name];
    const list = this._configFilteredReports || this.stReportList || this._cachedReports;
    const defaultList = list[objName];
    const searchInput = tree.el.querySelector('#' + tree._elementIds.search);
    if (searchInput) {
      const query = searchInput.value.trim().toLowerCase();
      if (query && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(query)) {
        if (list && list[objName] && list[objName].length > 0) {
          list[objName].forEach((item) => {
            const n = item.title;
            if (n && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(n) && n.toLowerCase().includes(query)) {
              searchFilteredList.push(item);
            }
          });
        }
      }
      else {
        return this.applySort(defaultList);
      }
    }
    else {
      return this.applySort(defaultList);
    }
    return this.applySort(searchFilteredList);
  }
  onUpdateThumbnailPopoverSize() {
    if (!this.el) {
      return;
    }
    let fullContentHt = 100;
    const minContentHt = 100;
    const minPopoverWt = 200;
    const maxPopoverWt = 735;
    const vpad = 36;
    const hpad = 16;
    const clientHt = document.documentElement.clientHeight;
    const clientWt = document.documentElement.clientWidth;
    const htAbove = this.el.offsetTop;
    const htBelow = clientHt - (this.el.offsetTop + this.el.offsetHeight) + window.scrollY;
    let fullContentWt = clientWt / 2;
    const rightSpace = clientWt - this.el.offsetLeft + window.scrollX;
    if (htBelow < minContentHt && htBelow < htAbove) {
      // popover max height = ht above if that space is larger than below
      fullContentHt = htAbove - vpad;
    }
    else {
      fullContentHt = htBelow - vpad;
    }
    fullContentWt = Math.max(minPopoverWt, Math.min(rightSpace - hpad, maxPopoverWt));
    const contentElem = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.queryElementById.call(this.el, this._elementIds.content);
    if (contentElem) {
      if (contentElem) {
        contentElem.style.height = fullContentHt + 'px';
      }
    }
    const popoverElem = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.queryElementById.call(this.el, this._elementIds.popover);
    if (popoverElem) {
      popoverElem.style.width = fullContentWt + 'px';
      // popoverElem.style.left = this.el.offsetLeft + 'px'
    }
    // notify tree that our size may have changed
    const tree = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.queryElementById.call(this.el, this._elementIds.reports);
    if (tree) {
      tree.updateLayout();
    }
  }
  handleMouseOver(ev, reportId) {
    const y = ev.clientY;
    const id = reportId;
    this._debounce2(() => {
      PreviewPopup.hidePopup();
      const imgData = ArcgisInfographicTree._getThumbnailUrl(id);
      if (imgData && imgData.isOk) {
        const popover = this.el.closest('calcite-popover');
        if (popover) {
          const rr = popover.getBoundingClientRect();
          const clickY = y - rr.top;
          PreviewPopup.show(id, popover, clickY, imgData.ratio, imgData.url);
        }
      }
    }, 200);
    return true;
  }
  handleMouseOut() {
    this._debounce2(() => {
      PreviewPopup.hidePopup();
    }, 300);
  }
  static _setThumbnailIndex(id, ratioW2H, url, isValid) {
    ArcgisInfographicTree.ThumbnailIndex[id] = { url: url, ratio: ratioW2H, isOk: isValid };
  }
  static _getThumbnailUrl(id) {
    return ArcgisInfographicTree.ThumbnailIndex[id];
  }
  renderList(name) {
    if (this._dbg) {
      console.log('%c TREE renderList', 'color:orange;font-size:11pt', name);
    }
    const self = this;
    const tags = {
      'MyInfographics': 'report-my-infographics',
      'EsriInfographics': 'report-esri-infographics',
      'SharedInfographics': 'report-shared-infographics',
      'GalleryInfographics': 'report-gallery-infographics',
      'NoPreviewAvailable': 'preview-not-available'
    };
    function _getImgId() {
      return self._instanceId + '-' + 'img' + self._imgOffset++;
    }
    // this function operates asynchronously to check image urls.  The results from requesting
    // an image are added to the Thumbnail Index for future reference
    function _cacheThumbnailUrlAndData(imgId, id, popoverId, prevId, name) {
      if (_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(imgId) && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(id) && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(popoverId)) {
        if (self._dbg) {
          console.log('%c TREE _getThumbnail', 'font-size:11pt;color:orange;');
        }
        // const imgElementId = imgId
        const thumbnailId = id;
        const popId = popoverId;
        const treePrevId = prevId;
        // Adds tooltips to preview items that do not have a valid thumbnail
        function _addNoPreviewTooltip(itemId) {
          const pop = self.el.querySelector(_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.fixId(popId));
          if (pop) {
            pop.remove();
          }
          const prevElem = self.el.querySelector(_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.fixId(itemId));
          if (prevElem) {
            // add no-preview tooltip
            const tip = document.createElement('calcite-tooltip');
            tip.setAttribute('reference-element', itemId);
            tip.style.minWidth = '160px';
            tip.style.left = '-40px';
            const sp = document.createElement('span');
            sp.innerText = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n(tags.NoPreviewAvailable);
            tip.appendChild(sp);
            prevElem.appendChild(tip);
          }
        }
        function _useAGOForThumbnail(name) {
          if (name !== "EsriInfographics")
            return false;
          if (self.portalOnlineGEProxy && !_GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_3__.E.isAGOPortal(_GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_3__.E.getPortalBase()))
            return true;
          return false;
        }
        // use pre-cached info if possible
        let fetchItem = true;
        const imgData = ArcgisInfographicTree._getThumbnailUrl(id);
        if (imgData) {
          if (imgData.isOk || imgData.isOk == false) {
            // already have cached results
            fetchItem = false;
          }
        }
        // check server if the thumbnail can be used
        if (fetchItem) {
          // determine if the image url is valid or not by creating an image in memory
          // const p = new Promise((resolve, reject) => {
          let url = '';
          // If we have a GE Online proxy setup and are connected to a portal (not AGO), we need to use www.arcgis.com for the Esri Infographics thumbnails
          if (_useAGOForThumbnail(name)) {
            url = 'https://www.arcgis.com/sharing/rest/content/items/' + thumbnailId + '/resources/thumbnail.png';
          }
          else {
            url = _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_3__.E.getPortalBase() + '/sharing/rest/content/items/' + thumbnailId + '/resources/thumbnail.png?token=' + self.token;
          }
          function urlIsValid(pid, u, rid, wt, ht) {
            // const w: number = imgInstance.width
            // const h: number = imgInstance.height
            // save our results into the thumbnail index to avoid this step later
            ArcgisInfographicTree._setThumbnailIndex(rid, (wt / ht), u, true);
            // remove the no-preview tooltip
            const prevElem = self.el.querySelector(_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.fixId(pid));
            if (prevElem) {
              const oldTip = prevElem.querySelector('calcite-tooltip');
              if (oldTip) {
                oldTip.remove();
              }
            }
          }
          function urlHadError(pid, u, rid) {
            ArcgisInfographicTree._setThumbnailIndex(rid, 1, u, false);
            _addNoPreviewTooltip(pid);
          }
          try {
            const img = new Image();
            img.onload = function () {
              const imgInst = this;
              const w = imgInst.width;
              const h = imgInst.height;
              urlIsValid(treePrevId, url, thumbnailId, w, h);
            };
            img.onerror = () => { urlHadError(treePrevId, url, thumbnailId); };
            img.src = url;
          }
          catch (ex) {
            urlHadError(treePrevId, url, thumbnailId);
          }
          // })
        }
      }
    }
    let expanded = (name === 'EsriInfographics');
    const outerStyle = {
      'position': 'relative',
      'width': '100%',
      'height': '100%'
    };
    // const noPreviewStyle = {
    //   'position': 'absolute',
    //   'top': '0',
    //   'left': '0',
    //   'width': '100%',
    //   'height': '100%',
    //   'zIndex': '5'
    // }
    // const iconName = 'file-text'
    // function getThumbnailStyle(id: string) {
    //   return {
    //     'position': 'absolute',
    //     'top': '0',
    //     'left': '0',
    //     'width': '100%',
    //     'height': '100%',
    //     'zIndex': '6',
    //     'backgroundImage': 'url(' + _getThumbnail(id) + ')',
    //     'backgroundSize': 'auto'
    //   }
    // }
    // const thumbnailDiv = {
    //   'width':'100%',
    //   'height':'100%',
    //   'backgroundImage' : 'url(https://www.arcgis.com/sharing/rest/content/items/697887220b9f47b8a22383a1acd4f203/resources/thumbnail.png)',
    //   'backgroundSize' : 'contain'
    // }
    // const reports = self._infographics[name].data
    const reports = self.getFilteredReportList(name);
    if (reports && reports.length > 0) {
      // let arr: any[] = reports.map((v) => { return {id: v.id, name: v.title}})
      if (reports.length <= 16) {
        expanded = true;
      }
      let displayName = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n(tags[name]);
      if (displayName === '??') {
        _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.L.show('%e', 'Missing Report Category name', tags[name]);
        displayName = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n(tags[name]); // without the option
      }
      const filteredReportList = this.getFilteredReportList(name);
      if (this._dbg) {
        console.log('%c TREE renderList[' + name + '] filtered=', 'font-size:12pt;color:orange;', filteredReportList);
      }
      if (!filteredReportList) {
        return;
      }
      if (_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.isDef(filteredReportList)) {
        let showReportCat = false;
        filteredReportList.forEach((element) => {
          if (element.isChecked) {
            showReportCat = true;
          }
        });
        // create a tree node for this level with all records
        if (showReportCat) {
          return ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { style: outerStyle }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-tree-item", { class: "reportList", slot: "children", expanded: expanded }, displayName, reports.length > 0 && ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-tree", { slot: "children", class: "reportTree" }, reports.map(report => {
            if (filteredReportList.some(obj => { return obj.id === report.id && obj.isChecked === true; })) {
              const itemId = 'tree-item-' + report.id;
              const prevId = itemId + '-prev';
              const thumbnailPopId = itemId + '-pop';
              const imgId = _getImgId();
              _cacheThumbnailUrlAndData(imgId, report.id, thumbnailPopId, prevId, name);
              // const onError = (e) => {
              //   console.log('IMG ERROR', e)
              // }
              return ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { class: "report-tree-dropdown" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-tree-item", { id: itemId, selected: report.id === self.stSelectedReportId ? true : false, class: "reportItems", data: report.id, onClick: (e) => self.onClickTreeItem(e, { thumbnail: thumbnailPopId, id: report.id, name: report.title }) }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { class: "report-item-content" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { class: "report-item-text" }, report.title), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { class: "report-item-buttons" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", null, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: prevId, class: "report-item-preview", onMouseOver: (e) => this.handleMouseOver(e, report.id), onMouseOut: () => this.handleMouseOut() }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("svg", { "aria-hidden": "true", class: "svg", fill: "currentColor", viewBox: "0 0 24 24", xmlns: "http://www.w3.org/2000/svg" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("path", { d: "M17 16h-5.525a5.95 5.95 0 0 0-.172-1H17zm2-7h-9v1h9zm0 3h-9v.544q.193.22.364.456H19zm3 8H11.818l-.913-.913c.014-.028.023-.059.037-.087H21V7h-4V3H8v8.053a5.945 5.945 0 0 0-1-.356V2h11.4L22 5.6zM21 5.69L18.31 3H18v3h3zM8.926 19.23l3.085 3.084a.476.476 0 0 1 0 .674l-.017.017a.476.476 0 0 1-.673 0L8.237 19.92A4.383 4.383 0 1 1 9.9 16.5a4.358 4.358 0 0 1-.974 2.73zM5.5 19.9a3.4 3.4 0 1 0-3.4-3.4 3.404 3.404 0 0 0 3.4 3.4z" })))))))));
            }
          }))))));
        }
        else {
          return '';
        }
      }
      else {
        return '';
      }
    }
    else {
      return '';
    }
  }
  async refreshInfographicList() {
    const self = this;
    let userReports, publicReports, sharedReports, galleryReports;
    if (this._dbg) {
      console.log('%c TREE refreshInfographicList', 'font-size:12pt;color:orange;', self.stReportList);
    }
    const list = this._configFilteredReports || this.stReportList || this._cachedReports;
    // If no reports configuration is specified, default to ONLY Esri Reports (public)
    if (this.baseConfig.config?.reportList) {
      const raw = typeof (this.baseConfig.config.reportList) === 'string' ? JSON.parse(this.baseConfig.config.reportList) : this.baseConfig.config.reportList;
      const keys = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.getKeys(raw);
      if (keys?.length == 0) {
        delete list?.user;
        delete list?.shared;
        delete list?.gallery;
      }
    }
    let infos;
    if (list && Object.keys(list).length) {
      userReports = list.user;
      publicReports = list.public;
      sharedReports = list.shared;
      galleryReports = list.gallery;
    }
    else {
      // fetch reports from server
      self._isInitialized = false;
      infos = await (0,_arcgisReports_0c351f0a_js__WEBPACK_IMPORTED_MODULE_4__.g)(self.sourceCountry, false);
      userReports = infos.user.map(report => { return { ...report, isChecked: true }; });
      publicReports = infos.public.map(report => { return { ...report, isChecked: true }; });
      sharedReports = infos.shared.map(report => { return { ...report, isChecked: true }; });
      galleryReports = infos.gallery.map(report => { return { ...report, isChecked: true }; });
      this._configFilteredReports = undefined;
      // do not update stReportList here or we have endless render loop
      self._cachedReports = { user: userReports, public: publicReports, shared: sharedReports, gallery: galleryReports };
      self._isInitialized = true;
    }
    if (list || infos) {
      self._infographics.MyInfographics.data = userReports;
      self._infographics.EsriInfographics.data = publicReports;
      self._infographics.SharedInfographics.data = sharedReports;
      self._infographics.GalleryInfographics.data = galleryReports;
    }
    else {
      self._infographics.MyInfographics.data = undefined;
      self._infographics.EsriInfographics.data = undefined;
      self._infographics.SharedInfographics.data = undefined;
      self._infographics.GalleryInfographics.data = undefined;
    }
    const content = ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-tree", { scale: "m", selectionMode: "single" }, self.renderList('MyInfographics'), self.renderList('EsriInfographics'), self.renderList('SharedInfographics'), self.renderList('GalleryInfographics')));
    self._content = content;
    self.adjustTreeItemsWidth();
  }
  async getLocalFilteredInfographicsList() {
  }
  // Stencil lifecycle - called once after component is first connected to the DOM
  async componentWillLoad() {
    const self = this;
    if (self.env) {
      self.onEnvChanged();
    }
    if (self.token) {
      self.onTokenChanged();
    }
    if (self.username) {
      self.onUsernameChanged();
    }
    if (self.selectedReportId) {
      self.onSelectedReportChanged();
    }
    if (self.reportList) {
      self.onReportListChanged();
    }
    if (self.langCode) {
      self.onLangCodeChanged();
    }
    if (self.geoenrichmentUrl) {
      self.onGeoenrichmentUrlChanged();
    }
    if (self.sourceCountry) {
      self.onSourceCountryChanged();
    }
    if (self.portalUrl) {
      self.onPortalUrlChanged();
    }
    if (self.config) {
      self.onConfigChange(self.config, '');
    }
    if (this.theme) {
      this.baseConfig.setTheme(this.theme);
    }
    else {
      this.baseConfig.setTheme('light');
    }
    self._loadInstances();
    try {
      await self.refreshInfographicList();
      self._isInitialized = true;
      // TODO: at some point we should add ba-accordion as a subcomponent
      // when it starts using baseConfig
    }
    catch (ex) {
      _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.L.show('%e', 'arcgis-infographic-tree request for esri reports failed', ex);
    }
  }
  // Stencil lifecycle - called just after component updates, but not called during first render()
  componentDidUpdate() {
    const self = this;
    self.showBusy.call(this, false);
    if (self.baseConfig) {
      self.baseConfig.onComponentHasRendered();
    }
    if (self._cachedReports) {
      self.stReportList = self._cachedReports;
      // cached reports only updates in refreshInfographicList() and resets here after render
      self._cachedReports = undefined;
    }
  }
  // Stencil lifecycle - called once after component is fully loaded and 1st render occurred
  componentDidLoad() {
    const self = this;
    self._loadInstances();
    self.showBusy.call(self, false);
    const searchInput = this.el.querySelector('#' + this._elementIds.search);
    function _onResize() {
      self.adjustTreeItemsWidth();
    }
    window.removeEventListener('resize', _onResize);
    window.addEventListener('resize', _onResize);
    self.adjustTreeItemsWidth();
    const onClickItemMakeDefault = (e) => {
      const item = e.currentTarget.closest('calcite-tree-item');
      if (item) {
        const itemId = item.id;
        const reportId = itemId.substring(10);
        if (_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(reportId)) {
          self.selectedReportId = reportId;
          self.onSelectedReportChanged();
          let n = '';
          const textElem = item.querySelector('div.report-item-text');
          if (textElem) {
            n = textElem.innerText;
          }
          self.onClickTreeItem(e, { id: reportId, name: n });
        }
      }
    };
    // item 'make default' click handler
    const items = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.queryElementAll.call(self, 'div.default-popover-content');
    if (!items || items.length > 0) {
      for (let ii = 0; ii < items.length; ii++) {
        items[ii].removeEventListener('click', onClickItemMakeDefault);
        items[ii].addEventListener('click', onClickItemMakeDefault);
      }
    }
    // called when the tree search text changes
    const onSearchQueryChanged = () => {
      self._debounce2(() => {
        //self.refreshInfographicList.call(self)
        self.stTimestamp = new Date().getTime();
      }, 500);
    };
    const sortElem = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.queryElementById.call(self, _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.fixId(self._elementIds.sort));
    if (sortElem) {
      sortElem.addEventListener('calciteSelectChange', () => {
        self.stSortType = sortElem.value;
        //self.refreshInfographicList()
      });
    }
    if (searchInput) {
      searchInput.removeEventListener('input', onSearchQueryChanged);
      searchInput.addEventListener('input', onSearchQueryChanged);
      searchInput.addEventListener('calciteInputChange', onSearchQueryChanged);
    }
    self.adjustTreeItemsWidth();
  }
  /**
   * Filters out multiple rapid events of the same type.  The callback
   * function will be called if no new events have happened during the
   * 'wait' time.
   * @param callback - your function to call when the events have settled
   * @param wait     - milliseconds delay (ex: 250)
   */
  _debounce2(callback, wait) {
    const self = this;
    const delayedCall = function () {
      self._debounceTimer = null;
      callback.apply(self);
    };
    // everytime _debounce2 is called we kill the previous timer
    if (self._debounceTimer)
      clearTimeout(self._debounceTimer);
    self._debounceTimer = setTimeout(delayedCall, wait);
  }
  adjustTreeItemsWidth() {
    if (this.el) {
      const items = this.el.querySelectorAll('div.report-item-content');
      if (!items || items.length <= 0) {
        return;
      }
      const p = items[0].closest('.reportList');
      if (p) {
        const wt = p.offsetWidth;
        items.forEach((item) => {
          item.style.width = (wt - 60) + 'px';
        });
      }
    }
    // adjust infographic preview size
    const pop = this.el.parentElement?.parentElement;
    const sWt = pop?.style?.width;
    if (sWt && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(sWt)) {
      const wt = parseInt(sWt);
      if (!Number.isNaN(wt)) {
        const adjustedWidth = wt * 0.9;
        if (adjustedWidth > 300) {
          // apply new width
          const pops = this.el.querySelectorAll('img.thumbnail-preview');
          if (pops) {
            pops.forEach((t) => {
              t.style.maxWidth = adjustedWidth + 'px';
              t.style.maxHeight = (adjustedWidth * 0.66) + 'px';
            });
          }
        }
      }
    }
  }
  render() {
    const outerDivStyle = {
      'position': 'absolute',
      'width': 'calc(100% - 12px)',
      'height': 'calc(100% - 8px)',
      'overflow-x': 'hidden',
      'overflow-y': 'scroll'
    };
    const placeText = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n('search-infos-by-name');
    const sortNewest = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n('date-sort-newest');
    const sortOldest = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n('date-sort-oldest');
    const nameAsc = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n('name-sort-asc');
    const nameDesc = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n('name-sort-desc');
    this.refreshInfographicList();
    // Render just the outer div and busy spinner until the component
    // initialize() function is called - and the infographic data is
    // received.  The content is added in the initialize() function.
    return ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._instanceId, style: outerDivStyle, class: "arcgis-tree-outer" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._busyId, class: "infographic-tree-busy" }), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { class: "info-tree-search-div" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-input", { clearable: "true", id: this._elementIds.search, placeholder: placeText, class: "info-tree-search" }), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._elementIds.icon, class: "info-tree-icon" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-icon", { scale: 'l', icon: 'search' }))), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-select", { id: this._elementIds.sort, class: "info-tree-sort" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-option", { value: "newest" }, sortNewest), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-option", { value: "oldest" }, sortOldest), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-option", { value: "ascending" }, nameAsc), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-option", { value: "descending" }, nameDesc)), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._elementIds.list, class: "info-tree-list" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", null, this._content))));
  }
  get el() { return (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.g)(this); }
  static get watchers() { return {
    "config": ["onConfigChange"],
    "env": ["onEnvChanged"],
    "langCode": ["onLangCodeChanged"],
    "sourceCountry": ["onSourceCountryChanged"],
    "token": ["onTokenChanged"],
    "username": ["onUsernameChanged"],
    "selectedReportId": ["onSelectedReportChanged"],
    "reportList": ["onReportListChanged"],
    "theme": ["onThemeChanged"],
    "portalUrl": ["onPortalUrlChanged"],
    "geoenrichmentUrl": ["onGeoenrichmentUrlChanged"]
  }; }
};
ArcgisInfographicTree.ThumbnailIndex = {};
ArcgisInfographicTree.style = arcgisInfographicTreeCss;



//# sourceMappingURL=arcgis-infographic-tree-57eabf2c.js.map

/***/ }),

/***/ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgisReports-0c351f0a.js":
/*!*******************************************************************************************************************************************************!*\
  !*** ./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgisReports-0c351f0a.js ***!
  \*******************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getInfographicTemplatesList),
/* harmony export */   s: () => (/* binding */ setToken)
/* harmony export */ });
/* harmony import */ var _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./GEClient-f71049f8.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/GEClient-f71049f8.js");
/* harmony import */ var _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ElementIds-a2c40592.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/ElementIds-a2c40592.js");



function setToken(username, token) {
    try {
        if (username != null && username.length > 0) {
            if (token != null && token.length > 0) {
                _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.T.setToken(username, token);
                return _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('ok');
            }
            else {
                return _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('invalid-token');
            }
        }
        else {
            return _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('invalid-username');
        }
    }
    catch (ex) {
        return ex;
    }
}
async function getInfographicTemplatesList(countryCode, full = false) {
    return await _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.G.getInfographicTemplatesList(countryCode, full);
}



//# sourceMappingURL=arcgisReports-0c351f0a.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYmEtaW5mb2dyYXBoaWNfbm9kZV9tb2R1bGVzX2FyY2dpc19idXNpbmVzcy1hbmFseXN0LWNvbXBvbmVudHNfZGlzLWNiOWNlNC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQWtHO0FBQzFDO0FBQzBDO0FBQ25CO0FBQ007QUFDaEQ7O0FBRXJDLDRDQUE0QyxjQUFjLDBCQUEwQixrQkFBa0IsV0FBVyxZQUFZLHFCQUFxQixtQkFBbUIsNEJBQTRCLFdBQVcsaUJBQWlCLGtCQUFrQixRQUFRLFdBQVcsWUFBWSxXQUFXLHNCQUFzQixjQUFjLFdBQVcsWUFBWSxlQUFlLG9CQUFvQixnQkFBZ0Isd0JBQXdCLFlBQVksY0FBYyx5QkFBeUIsa0JBQWtCLFFBQVEsU0FBUyx3QkFBd0IsWUFBWSxpQkFBaUIsZ0JBQWdCLGdCQUFnQix1QkFBdUIsa0JBQWtCLGdCQUFnQixtQkFBbUIsZUFBZSxtQkFBbUIsa0JBQWtCLFlBQVksV0FBVyxlQUFlLHlCQUF5QixrQkFBa0IsUUFBUSxVQUFVLFdBQVcsWUFBWSwyQkFBMkIsb0JBQW9CLG9CQUFvQix5QkFBeUIsb0NBQW9DLGdEQUFnRCxVQUFVLFdBQVcsMENBQTBDLGdEQUFnRCwwQ0FBMEMsNkJBQTZCLDJDQUEyQyxnREFBZ0QsVUFBVSxXQUFXOztBQUUxeEM7QUFDQTtBQUNBLElBQUkscURBQWdCO0FBQ3BCLDBDQUEwQyxxREFBVztBQUNyRCwwQ0FBMEMscURBQVc7QUFDckQ7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQiwwQkFBMEIscURBQVE7QUFDbEMsSUFBSSxzREFBUTtBQUNaO0FBQ0EsSUFBSSxzREFBaUI7QUFDckI7QUFDQTtBQUNBLDJDQUEyQyxzREFBc0Q7QUFDakc7QUFDQTtBQUNBLElBQUksb0RBQVk7QUFDaEI7QUFDQTtBQUNBLHFDQUFxQyxlQUFlO0FBQ3BEO0FBQ0E7QUFDQTtBQUNB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WSxxREFBQyxVQUFVLHdFQUF3RSxFQUFFLHFEQUFDLFVBQVUsa0RBQWtELEdBQUcscURBQUMsVUFBVSwrQkFBK0IsRUFBRSxxREFBQyxvQkFBb0IsbUdBQW1HLEdBQUcscURBQUMsVUFBVSxvREFBb0QsRUFBRSxxREFBQyxtQkFBbUIsNEJBQTRCLEtBQUsscURBQUMscUJBQXFCLG9EQUFvRCxFQUFFLHFEQUFDLHFCQUFxQixpQkFBaUIsZUFBZSxxREFBQyxxQkFBcUIsaUJBQWlCLGVBQWUscURBQUMscUJBQXFCLG9CQUFvQixZQUFZLHFEQUFDLHFCQUFxQixxQkFBcUIsY0FBYyxxREFBQyxVQUFVLG9EQUFvRCxFQUFFLHFEQUFDO0FBQ3Z5QjtBQUNBLGFBQWEsT0FBTyxxREFBVTtBQUM5QiwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVzQzs7QUFFdEM7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDcGxDMkU7QUFDVDs7QUFFbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isb0RBQWE7QUFDN0IsdUJBQXVCLHNEQUFpQjtBQUN4QztBQUNBO0FBQ0EsdUJBQXVCLHNEQUFpQjtBQUN4QztBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsc0RBQWlCO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLG9EQUFRO0FBQ3pCOztBQUUyRDs7QUFFM0QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2JhLWluZm9ncmFwaGljL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2J1c2luZXNzLWFuYWx5c3QtY29tcG9uZW50cy9kaXN0L3N0ZW5jaWwtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtaW5mb2dyYXBoaWMtc2VsZWN0b3JfMi5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2JhLWluZm9ncmFwaGljL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2J1c2luZXNzLWFuYWx5c3QtY29tcG9uZW50cy9kaXN0L3N0ZW5jaWwtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtaW5mb2dyYXBoaWMtdHJlZS01N2VhYmYyYy5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2JhLWluZm9ncmFwaGljL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2J1c2luZXNzLWFuYWx5c3QtY29tcG9uZW50cy9kaXN0L3N0ZW5jaWwtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXNSZXBvcnRzLTBjMzUxZjBhLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgZyBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC00ZTY0NzQxMS5qcyc7XG5pbXBvcnQgeyBCIGFzIEJhc2VVdGlsIH0gZnJvbSAnLi9iYXNlLXV0aWwtYjdkYjY5ZjAuanMnO1xuaW1wb3J0IHsgQSBhcyBBQ0xVdGlscywgQiBhcyBCYVJlcG9ydHNMYW5ndWFnZSwgRSBhcyBFbGVtZW50SWRzIH0gZnJvbSAnLi9FbGVtZW50SWRzLWEyYzQwNTkyLmpzJztcbmltcG9ydCB7IEUgYXMgRW52aXJvbm1lbnRzLCBUIGFzIFRva2VuUHJvdmlkZXIgfSBmcm9tICcuL0dFQ2xpZW50LWY3MTA0OWY4LmpzJztcbmV4cG9ydCB7IEEgYXMgYXJjZ2lzX2luZm9ncmFwaGljX3RyZWUgfSBmcm9tICcuL2FyY2dpcy1pbmZvZ3JhcGhpYy10cmVlLTU3ZWFiZjJjLmpzJztcbmltcG9ydCAnLi9hcmNnaXNSZXBvcnRzLTBjMzUxZjBhLmpzJztcblxuY29uc3QgYXJjZ2lzSW5mb2dyYXBoaWNTZWxlY3RvckNzcyA9IFwiOmhvc3R7ZGlzcGxheTpibG9ja30uaW5mb2dyYXBoaWNTZWxlY3Rvck91dGVye3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjEwMCU7aGVpZ2h0OjMwcHg7anVzdGlmeS1jb250ZW50OmxlZnQ7YWxpZ24taXRlbXM6Y2VudGVyfS5zZWxlY3Rvci1sYWJlbC1wbGFjZWhvbGRlcntjb2xvcjpncmF5fS5pbmZvU2VsLW1hZ25pZnl7cG9zaXRpb246YWJzb2x1dGU7dG9wOjJweDtsZWZ0OjEwMHB4O2hlaWdodDozMnB4O3dpZHRoOjMycHg7YmFja2dyb3VuZC1jb2xvcjpibHVlfS5hcmNTZWwtY29tYm97d2lkdGg6MTAwJTtoZWlnaHQ6MzJweDtmb250LXNpemU6MTFwdDtjb2xvcjpkYXJrc2xhdGVncmF5fS5hcmNTZWwtcmVwb3J0c3t3aWR0aDpjYWxjKDEwMCUgLSAxNnB4KTtoZWlnaHQ6MTAwJTtvdmVyZmxvdzphdXRvfS5zZWxlY3Rvci1kcm9wZG93bi1sYWJlbHtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6N3B4O2xlZnQ6NnB4O3dpZHRoOmNhbGMoMTAwJSAtIDM1cHgpO2hlaWdodDoyNXB4O2ZvbnQtc2l6ZToxMC41cHQ7Zm9udC13ZWlnaHQ6MzAwO3RleHQtYWxpZ246bGVmdDt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzO2JvcmRlci1yYWRpdXM6MHB4O292ZXJmbG93OmhpZGRlbjt3aGl0ZS1zcGFjZTpub3dyYXA7Y3Vyc29yOnBvaW50ZXJ9LnNlbGVjdG9yLWRyb3Bkb3due3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDozMnB4O3dpZHRoOjEwMCU7Y3Vyc29yOnBvaW50ZXJ9LnNlbGVjdG9yLWRyb3Bkb3duLWFycm93e3Bvc2l0aW9uOmFic29sdXRlO3RvcDo5cHg7cmlnaHQ6N3B4O3dpZHRoOjEycHg7aGVpZ2h0OjEycHg7dHJhbnNpdGlvbjphbGwgMC4xNXMgMC4xNXM7dHJhbnNmb3JtOnJvdGF0ZSgwKX0uc2VsZWN0b3ItZHJvcC1vcGVue3RyYW5zZm9ybTpyb3RhdGUoMTgwZGVnKX1jYWxjaXRlLXBvcG92ZXIgOjotd2Via2l0LXNjcm9sbGJhcntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktYmFja2dyb3VuZC0xKTt3aWR0aDo4cHg7aGVpZ2h0OjhweH1jYWxjaXRlLXBvcG92ZXIgOjotd2Via2l0LXNjcm9sbGJhci10aHVtYntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0zKX1jYWxjaXRlLXBvcG92ZXIgOjotd2Via2l0LXNjcm9sbGJhci10cmFja3tiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50fWNhbGNpdGUtcG9wb3ZlciA6Oi13ZWJraXQtc2Nyb2xsYmFyLWNvcm5lcntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktYmFja2dyb3VuZC0xKTt3aWR0aDo4cHg7aGVpZ2h0OjhweH1cIjtcblxuY29uc3QgQXJjZ2lzSW5mb2dyYXBoaWNTZWxlY3RvciA9IGNsYXNzIHtcclxuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XHJcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xyXG4gICAgdGhpcy5pbmZvZ3JhcGhpY1NlbGVjdG9yUG9wdXBPcGVuZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImluZm9ncmFwaGljU2VsZWN0b3JQb3B1cE9wZW5lZFwiLCA2KTtcclxuICAgIHRoaXMuaW5mb2dyYXBoaWNTZWxlY3RvclBvcHVwQ2xvc2VkID0gY3JlYXRlRXZlbnQodGhpcywgXCJpbmZvZ3JhcGhpY1NlbGVjdG9yUG9wdXBDbG9zZWRcIiwgNik7XHJcbiAgICB0aGlzLl9sb2NhbGVTZXR0aW5ncyA9IHt9O1xyXG4gICAgdGhpcy5fcG9wb3ZlcklzT3BlbiA9IGZhbHNlO1xyXG4gICAgdGhpcy5faWRQcmVmaXggPSAnYXJjZ2lzLWluZm9ncmFwaGljLXNlbGVjdG9yLSc7XHJcbiAgICB0aGlzLl9lbGVtZW50SWRzID0ge307IC8vIGJ1dHRvblxyXG4gICAgdGhpcy5faWRCdXR0b25QcmVmaXggPSAnc2VsZWN0b3ItZHJvcGRvd24tYnV0dG9uLSc7XHJcbiAgICB0aGlzLl9pZERyb3Bkb3duQXJyb3dQcmVmaXggPSAnc2VsZWN0b3ItZHJvcGRvd24tYXJyb3ctJztcclxuICAgIHRoaXMuX2lkRHJvcGRvd25MYWJlbFByZWZpeCA9ICdzZWxlY3Rvci1kcm9wZG93bi1sYWJlbC0nO1xyXG4gICAgdGhpcy5faWRSZXBvcnRMaXN0UHJlZml4ID0gJ3NlbGVjdG9yLXJlcG9ydC1saXN0LSc7XHJcbiAgICB0aGlzLl9pZFBvcG92ZXJQcmVmaXggPSAnc2VsZWN0b3ItcG9wb3Zlci0nO1xyXG4gICAgdGhpcy5faWRQb3BvdmVyQ29udGVudFByZWZpeCA9ICdzZWxlY3Rvci1wb3BvdmVyLWNvbnRlbnQtJztcclxuICAgIHRoaXMuX3JlcG9ydCA9IHsgaWQ6IG51bGwsIG5hbWU6ICcnIH07XHJcbiAgICB0aGlzLmJhc2VDb25maWcgPSBuZXcgQmFzZVV0aWwoJ3NlbGVjdG9yJywgdGhpcywgdGhpcy5vblVwZGF0ZVVJKTtcclxuICAgIEFDTFV0aWxzLmFubm91bmNlVmVyc2lvbigpO1xyXG4gICAgdGhpcy5sYW5nQ29kZSA9IHRoaXMubGFuZ0NvZGUgfHwgJ2VuLXVzJztcclxuICAgIEJhUmVwb3J0c0xhbmd1YWdlLl9pbml0aWFsaXplKHRoaXMubGFuZ0NvZGUpO1xyXG4gICAgdGhpcy5zZXRMb2NhbGVTdHJpbmdzKCk7XHJcbiAgICB0aGlzLnNvdXJjZUNvdW50cnkgPSB0aGlzLnNvdXJjZUNvdW50cnkgfHwgJ1VTJztcclxuICAgIHRoaXMuYmFzZUNvbmZpZy51cGRhdGVMb2NhbGVTZXR0aW5ncyh7IGxhbmd1YWdlOiB0aGlzLmxhbmdDb2RlLCBjb3VudHJ5OiB0aGlzLnNvdXJjZUNvdW50cnkgfSk7XHJcbiAgfVxyXG4gIG9uRW52Q2hhbmdlZCgpIHtcclxuICAgIEVudmlyb25tZW50cy5zZXRFbnZpcm9ubWVudCh0aGlzLmVudik7XHJcbiAgICBpZiAodGhpcy5iYXNlQ29uZmlnKSB7XHJcbiAgICAgIC8vIHVwZGF0ZXMgY29uZmlnIGFuZCBzdWItY29tcG9uZW50IGNvbmZpZ3NcclxuICAgICAgdGhpcy5iYXNlQ29uZmlnLnVwZGF0ZUNvbmZpZyh7IGVudjogdGhpcy5lbnYgfSwgbnVsbCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIG9uVG9rZW5DaGFuZ2VkKCkge1xyXG4gICAgLy8gY29uc29sZS5sb2coJyVjIHNlbGVjdG9yOiB0b2tlbiBjaGFuZ2VkJywgJ2NvbG9yOm9yYW5nZTtmb250LXNpemU6OHB0JywgdGhpcy50b2tlbilcclxuICAgIGNvbnN0IHQgPSB0aGlzLnRva2VuO1xyXG4gICAgY29uc3QgdSA9IHRoaXMuYmFzZUNvbmZpZz8uY29uZmlnPy51c2VybmFtZTtcclxuICAgIGlmICh0ICYmIEFDTFV0aWxzLmhhc1RleHQodCkgJiYgdSAmJiBBQ0xVdGlscy5oYXNUZXh0KHUpKSB7XHJcbiAgICAgIFRva2VuUHJvdmlkZXIuc2V0VG9rZW4odSwgdCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5iYXNlQ29uZmlnKSB7XHJcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy51cGRhdGVDb25maWcoeyB0b2tlbjogdGhpcy50b2tlbiB9LCBudWxsKTtcclxuICAgIH1cclxuICB9XHJcbiAgb25Vc2VybmFtZUNoYW5nZWQoKSB7XHJcbiAgICAvLyBjb25zb2xlLmxvZygnJWMgc2VsZWN0b3I6IHVzZXJuYW1lIGNoYW5nZWQnLCAnY29sb3I6b3JhbmdlO2ZvbnQtc2l6ZTo4cHQnLCB0aGlzLnVzZXJuYW1lKVxyXG4gICAgY29uc3QgdSA9IHRoaXMudXNlcm5hbWU7XHJcbiAgICBjb25zdCB0ID0gdGhpcy5iYXNlQ29uZmlnPy5jb25maWc/LnRva2VuO1xyXG4gICAgaWYgKHQgJiYgQUNMVXRpbHMuaGFzVGV4dCh0KSAmJiB1ICYmIEFDTFV0aWxzLmhhc1RleHQodSkpIHtcclxuICAgICAgVG9rZW5Qcm92aWRlci5zZXRUb2tlbih1LCB0KTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmJhc2VDb25maWcpIHtcclxuICAgICAgdGhpcy5iYXNlQ29uZmlnLnVwZGF0ZUNvbmZpZyh7IHVzZXJuYW1lOiB0aGlzLnVzZXJuYW1lIH0sIG51bGwpO1xyXG4gICAgfVxyXG4gIH1cclxuICBvbkxhbmdDb2RlQ2hhbmdlZCgpIHtcclxuICAgIGlmICh0aGlzLmJhc2VDb25maWcpIHtcclxuICAgICAgdGhpcy5iYXNlQ29uZmlnLnVwZGF0ZUNvbmZpZyh7IGxhbmdDb2RlOiB0aGlzLmxhbmdDb2RlIH0sIG51bGwpO1xyXG4gICAgfVxyXG4gIH1cclxuICBvbkdlb2VucmljaG1lbnRVcmxDaGFuZ2VkKCkge1xyXG4gICAgaWYgKHRoaXMuYmFzZUNvbmZpZykge1xyXG4gICAgICB0aGlzLmJhc2VDb25maWcudXBkYXRlQ29uZmlnKHsgZ2VvZW5yaWNobWVudFVybDogdGhpcy5nZW9lbnJpY2htZW50VXJsIH0sIG51bGwpO1xyXG4gICAgfVxyXG4gIH1cclxuICBvblNlbGVjdGVkUmVwb3J0SWRDaGFuZ2VkKCkge1xyXG4gICAgaWYgKHRoaXMuYmFzZUNvbmZpZykge1xyXG4gICAgICB0aGlzLmJhc2VDb25maWcudXBkYXRlQ29uZmlnKHsgc291cmNlQ291bnRyeTogdGhpcy5zb3VyY2VDb3VudHJ5IH0sIG51bGwpO1xyXG4gICAgfVxyXG4gIH1cclxuICBvblNvdXJjZUNvdW50cnlDaGFuZ2VkKCkge1xyXG4gICAgaWYgKHRoaXMuYmFzZUNvbmZpZykge1xyXG4gICAgICB0aGlzLmJhc2VDb25maWcudXBkYXRlQ29uZmlnKHsgc291cmNlQ291bnRyeTogdGhpcy5zb3VyY2VDb3VudHJ5IH0sIG51bGwpO1xyXG4gICAgfVxyXG4gIH1cclxuICBvblRoZW1lQ2hhbmdlZCgpIHtcclxuICAgIHRoaXMuc3RUaGVtZSA9IHRoaXMudGhlbWU7XHJcbiAgICBpZiAodGhpcy5iYXNlQ29uZmlnKSB7XHJcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy5zZXRUaGVtZSh0aGlzLnRoZW1lKTtcclxuICAgIH1cclxuICB9XHJcbiAgb25Db25maWdDaGFuZ2UobmV3Q29uZmlnLCBvbGRDb25maWcpIHtcclxuICAgIC8vIGNvbnNvbGUubG9nKCdhcmNnaXMtaW5mb2dyYXBoaWMtc2VsZWN0b3IgQ29uZmlnIGNoYW5nZWQ6JywgbmV3Q29uZmlnKTtcclxuICAgIC8vIGxldCBjaGFuZ2VkOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgaWYgKHRoaXMuYmFzZUNvbmZpZykge1xyXG4gICAgICBpZiAobmV3Q29uZmlnICYmIEFDTFV0aWxzLmhhc1RleHQobmV3Q29uZmlnKSkge1xyXG4gICAgICAgIGNvbnN0IG5ld0NmZyA9IEpTT04ucGFyc2UobmV3Q29uZmlnKTtcclxuICAgICAgICBjb25zdCBvbGRDZmcgPSAob2xkQ29uZmlnICYmIEFDTFV0aWxzLmhhc1RleHQob2xkQ29uZmlnKSkgPyBKU09OLnBhcnNlKG9sZENvbmZpZykgOiBudWxsO1xyXG4gICAgICAgIC8vIGNoYW5nZWQgPSB0aGlzLl9iYXNlLnVwZGF0ZUNvbmZpZyhuZXdDZmcsIG9sZENmZyk7XHJcbiAgICAgICAgdGhpcy5iYXNlQ29uZmlnLnVwZGF0ZUNvbmZpZyhuZXdDZmcsIG9sZENmZyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIGlmIChuZXdDb25maWcgIT09IG9sZENvbmZpZykge1xyXG4gICAgLy8gICBjb25zdCBuZXdDZmcgPSBKU09OLnBhcnNlKG5ld0NvbmZpZyk7XHJcbiAgICAvLyAgIGNvbnN0IG9sZENmZyA9IEpTT04ucGFyc2Uob2xkQ29uZmlnKTtcclxuICAgIC8vICAgY29uc29sZS5sb2coJ05ldyBjb25maWcgb2JqZWN0OicsIG5ld0NmZyk7XHJcbiAgICAvLyAgIGNvbnNvbGUubG9nKCdPbGQgY29uZmlnIG9iamVjdDonLCBvbGRDZmcpO1xyXG4gICAgLy8gICBpZiAoY2hhbmdlZC5pbmNsdWRlcygnd29ya2Zsb3dFbmFibGVTZWFyY2gnKVxyXG4gICAgLy8gICAgIHx8IGNoYW5nZWQuaW5jbHVkZXMoJ3dvcmtmbG93RW5hYmxlVXNlckNvbmZpZ0J1ZmZlcnMnKVxyXG4gICAgLy8gICAgIHx8IGNoYW5nZWQuaW5jbHVkZXMoJ3dvcmtmbG93RW5hYmxlSW5mb2dyYXBoaWNDaG9pY2UnKSkge1xyXG4gICAgLy8gICAgIGNvbnNvbGUubG9nKFwiQ29uZmlnIGNoYW5nZWQgLSByZWluaXQgc3RlcHBlclwiKTtcclxuICAgIC8vICAgICB0aGlzLmluaXRTdGVwcygpO1xyXG4gICAgLy8gICB9XHJcbiAgICAvLyB9XHJcbiAgfVxyXG4gIGFzeW5jIGdldENvbmZpZygpIHtcclxuICAgIGNvbnN0IG15Q2ZnID0gdGhpcy5iYXNlQ29uZmlnO1xyXG4gICAgcmV0dXJuIG15Q2ZnO1xyXG4gIH1cclxuICAvLyBpbmZvZ3JhcGhpYyB0cmVlIHJlcG9ydCBpZCBjaGFuZ2VkXHJcbiAgcmVwb3J0U2VsZWN0ZWRFdmVudEhhbmRsZXIoZSkge1xyXG4gICAgY29uc3QgcmVwb3J0ID0gZS5kZXRhaWw/LnJlcG9ydDtcclxuICAgIGlmIChyZXBvcnQ/LmlkICYmIHJlcG9ydD8ubmFtZSkge1xyXG4gICAgICB0aGlzLnNlbGVjdGVkUmVwb3J0SWQgPSByZXBvcnQuaWQ7XHJcbiAgICAgIHRoaXMub25TZWxlY3RlZFJlcG9ydElkQ2hhbmdlZCgpO1xyXG4gICAgICB0aGlzLl9oaWRlUGxhY2Vob2xkZXJBbmRTaG93TGFiZWwocmVwb3J0Lm5hbWUpO1xyXG4gICAgICB0aGlzLmhpZGVQb3BvdmVyKCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8vIERlZmF1bHQgaW5mb2dyYXBoaWMgc2VsZWN0ZWRcclxuICBkZWZhdWx0UmVwb3J0U2VsZWN0ZWRFdmVudEhhbmRsZXIoZSkge1xyXG4gICAgY29uc3QgcmVwb3J0SWQgPSBlLmRldGFpbD8ucmVwb3J0SWQ7XHJcbiAgICBjb25zdCByZXBvcnROYW1lID0gZS5kZXRhaWw/Lm5hbWU7XHJcbiAgICBpZiAocmVwb3J0SWQgJiYgQUNMVXRpbHMuaGFzVGV4dChyZXBvcnRJZCkpIHtcclxuICAgICAgdGhpcy5zZWxlY3RlZFJlcG9ydElkID0gcmVwb3J0SWQ7XHJcbiAgICAgIHRoaXMub25TZWxlY3RlZFJlcG9ydElkQ2hhbmdlZCgpO1xyXG4gICAgICBpZiAocmVwb3J0TmFtZSkge1xyXG4gICAgICAgIGNvbnN0IGVsZW0gPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwodGhpcywgdGhpcy5fZWxlbWVudElkcy5sYWJlbCk7XHJcbiAgICAgICAgaWYgKGVsZW0pIHtcclxuICAgICAgICAgIGVsZW0uaW5uZXJUZXh0ID0gcmVwb3J0TmFtZTtcclxuICAgICAgICAgIHRoaXMuaGlkZVBvcG92ZXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgb25VcGRhdGVVSSgpIHsgfVxyXG4gIF9sb2FkSW5zdGFuY2VzKCkge1xyXG4gICAgLy8gdGhpcy5zZWFyY2hQbGFjZWhvbGRlclxyXG4gICAgaWYgKCF0aGlzLl9pbnN0YW5jZUlkKVxyXG4gICAgICB0aGlzLl9pbnN0YW5jZUlkID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2lkUHJlZml4KS5pZDtcclxuICAgIGlmICghdGhpcy5fZWxlbWVudElkcy5sYWJlbClcclxuICAgICAgdGhpcy5fZWxlbWVudElkcy5sYWJlbCA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCh0aGlzLl9pZERyb3Bkb3duTGFiZWxQcmVmaXgpLmlkO1xyXG4gICAgaWYgKCF0aGlzLl9lbGVtZW50SWRzLmJ1dHRvbilcclxuICAgICAgdGhpcy5fZWxlbWVudElkcy5idXR0b24gPSBFbGVtZW50SWRzLmdlbmVyYXRlSWQodGhpcy5faWRCdXR0b25QcmVmaXgpLmlkO1xyXG4gICAgaWYgKCF0aGlzLl9lbGVtZW50SWRzLnBvcG92ZXIpXHJcbiAgICAgIHRoaXMuX2VsZW1lbnRJZHMucG9wb3ZlciA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCh0aGlzLl9pZFBvcG92ZXJQcmVmaXgpLmlkO1xyXG4gICAgaWYgKCF0aGlzLl9lbGVtZW50SWRzLmNvbnRlbnQpXHJcbiAgICAgIHRoaXMuX2VsZW1lbnRJZHMuY29udGVudCA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCh0aGlzLl9pZFBvcG92ZXJDb250ZW50UHJlZml4KS5pZDtcclxuICAgIGlmICghdGhpcy5fZWxlbWVudElkcy5hcnJvdylcclxuICAgICAgdGhpcy5fZWxlbWVudElkcy5hcnJvdyA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCh0aGlzLl9pZERyb3Bkb3duQXJyb3dQcmVmaXgpLmlkO1xyXG4gICAgaWYgKCF0aGlzLl9lbGVtZW50SWRzLnJlcG9ydHMpXHJcbiAgICAgIHRoaXMuX2VsZW1lbnRJZHMucmVwb3J0cyA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCh0aGlzLl9pZFJlcG9ydExpc3RQcmVmaXgpLmlkO1xyXG4gIH1cclxuICBzZXRMb2NhbGVTdHJpbmdzKCkge1xyXG4gICAgLy8gY29uc29sZS5sb2coXCJzZXRMb2NhbGVTdHJpbmdzKCkgZm9yIGluZm9ncmFwaGljLXNlbGVjdG9yXCIpXHJcbiAgICAvLyBleGFtcGxlOlxyXG4gICAgLy8gdGhpcy5sYWJlbHMgPSB7XHJcbiAgICAvLyAgIGRyb3Bkb3duTG9jYXRpb246IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2FkZHJlc3MtbG9jYXRpb24tb3ItcGxhY2UnKSxcclxuICAgIC8vICAgZHJvcGRvd25Cb3VuZGFyeTogQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignYm91bmRhcnktbmFtZScpLFxyXG4gICAgLy8gICBkcm9wZG93bkFsbDogQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignZHJvcGRvd24tYWxsJyksXHJcbiAgICAvLyAgIHdhdGVybWFya0FsbDogQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignYWxsLXBsYWNlaG9sZGVyJyksXHJcbiAgICAvLyAgIHdhdGVybWFya0xvY2F0aW9uOiBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdlbnRlci1hZGRyZXNzLWxvYy1vci1wbGFjZScpLFxyXG4gICAgLy8gICB3YXRlcm1hcmtCb3VuZGFyeTogQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignZW50ZXItYm91bmRhcnktbmFtZScpXHJcbiAgICAvLyB9XHJcbiAgICAvLyB0aGlzLnNob3dTZWFyY2ggPSBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdzaG93LXNlYXJjaCcpXHJcbiAgICAvLyB0aGlzLnNlYXJjaFBsYWNlaG9sZGVyID0gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignc2VhcmNoLXBsYWNlaG9sZGVyJylcclxuICAgIC8vIHRoaXMuc2VhcmNoTGFiZWwgPSBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdzZWFyY2gtbGFiZWwnKVxyXG4gICAgLy8gdGhpcy5zZWFyY2hBbGwgPSBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdkcm9wZG93bi1hbGwnKVxyXG4gICAgLy8gdGhpcy5zZWFyY2hBbGxQbGFjZWhvbGRlciA9IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2FsbC1wbGFjZWhvbGRlcicpXHJcbiAgICAvLyB0aGlzLnNlYXJjaFBsYWNlaG9sZGVyU2hvcnQgPSBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdzZWFyY2gtcGxhY2Vob2xkZXItc2hvcnQnKVxyXG4gICAgLy8gdGhpcy5zZWFyY2hFbnRlckJvdW5kYXJ5ID0gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignc2VhcmNoLWVudGVyLWJvdW5kYXJ5JylcclxuICAgIC8vIHRoaXMuc2VhcmNoQm91bmRhcnkgPSBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdzZWFyY2gtYm91bmRhcnknKVxyXG4gIH1cclxuICAvLyBTdGVuY2lsIGxpZmVjeWNsZSAtIGNhbGxlZCBvbmNlIGFmdGVyIGNvbXBvbmVudCBpcyBmaXJzdCBjb25uZWN0ZWQgdG8gdGhlIERPTVxyXG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xyXG4gICAgLy8gTG9hZCBwcm9wcyB0aGF0IG1heSBoYXZlIHZhbHVlcyBidXQgbm8gV2F0Y2hlcyBoYXZlIHRyaWdnZXJlZCB5ZXRcclxuICAgIGlmICh0aGlzLmVudikge1xyXG4gICAgICB0aGlzLm9uRW52Q2hhbmdlZCgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMudG9rZW4pIHtcclxuICAgICAgdGhpcy5vblRva2VuQ2hhbmdlZCgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMudXNlcm5hbWUpIHtcclxuICAgICAgdGhpcy5vblVzZXJuYW1lQ2hhbmdlZCgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMubGFuZ0NvZGUpIHtcclxuICAgICAgdGhpcy5vbkxhbmdDb2RlQ2hhbmdlZCgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZ2VvZW5yaWNobWVudFVybCkge1xyXG4gICAgICB0aGlzLm9uR2VvZW5yaWNobWVudFVybENoYW5nZWQoKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnNvdXJjZUNvdW50cnkpIHtcclxuICAgICAgdGhpcy5vblNvdXJjZUNvdW50cnlDaGFuZ2VkKCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5jb25maWcpIHtcclxuICAgICAgdGhpcy5vbkNvbmZpZ0NoYW5nZSh0aGlzLmNvbmZpZywgJycpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRSZXBvcnRJZCkge1xyXG4gICAgICB0aGlzLm9uU2VsZWN0ZWRSZXBvcnRJZENoYW5nZWQoKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnRoZW1lKSB7XHJcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy5zZXRUaGVtZSh0aGlzLnRoZW1lKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLmJhc2VDb25maWcuc2V0VGhlbWUoJ2xpZ2h0Jyk7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9sb2FkSW5zdGFuY2VzKCk7XHJcbiAgICAvLyBpZiAoIXRoaXMuYmFzZUNvbmZpZy5oYXNTdWJDb21wb25lbnRzKCkpIHtcclxuICAgIC8vICAgLy8gYWRkIHRoZSBzdGVwJ3Mgc3ViIGNvbXBvbmVudHMgZm9yIGNvbmZpZyB1cGRhdGVzXHJcbiAgICAvLyAgIHRoaXMuYmFzZUNvbmZpZy5hZGRTdWJDb21wb25lbnRzKFt7bmFtZTondHJlZScsIEBAQEAgdGhlIHN1YmNvbXBvbmVudCdzIGJhc2VDb25maWcgQEBAfV0pO1xyXG4gICAgLy8gfVxyXG4gIH1cclxuICAvLyBTdGVuY2lsIGxpZmVjeWNsZSAtIGNhbGxlZCBqdXN0IGFmdGVyIGNvbXBvbmVudCB1cGRhdGVzLCBidXQgbm90IGNhbGxlZCBkdXJpbmcgZmlyc3QgcmVuZGVyKClcclxuICBjb21wb25lbnREaWRVcGRhdGUoKSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGlmIChzZWxmLmJhc2VDb25maWcpIHtcclxuICAgICAgc2VsZi5iYXNlQ29uZmlnLm9uQ29tcG9uZW50SGFzUmVuZGVyZWQoKTtcclxuICAgIH1cclxuICB9XHJcbiAgb25DbGlja0Ryb3Bkb3duKGUpIHtcclxuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAvLyBjb25zb2xlLmxvZyhcIkNMSUNLOiBcIiwgZS5jdXJyZW50VGFyZ2V0KVxyXG4gICAgdGhpcy5vblVwZGF0ZVBvcG92ZXJTaXplKCk7XHJcbiAgICB0aGlzLl9wb3BvdmVySXNPcGVuID0gIXRoaXMuX3BvcG92ZXJJc09wZW47XHJcbiAgICBpZiAodGhpcy5fcG9wb3ZlcklzT3Blbikge1xyXG4gICAgICB0aGlzLmluZm9ncmFwaGljU2VsZWN0b3JQb3B1cE9wZW5lZC5lbWl0KCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgdGhpcy5pbmZvZ3JhcGhpY1NlbGVjdG9yUG9wdXBDbG9zZWQuZW1pdCgpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYXJyb3cgPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwodGhpcy5lbCwgdGhpcy5fZWxlbWVudElkcy5hcnJvdyk7XHJcbiAgICBpZiAoYXJyb3cpIHtcclxuICAgICAgaWYgKHRoaXMuX3BvcG92ZXJJc09wZW4pIHtcclxuICAgICAgICBhcnJvdy5jbGFzc0xpc3QuYWRkKCdzZWxlY3Rvci1kcm9wLW9wZW4nKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBhcnJvdy5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3Rvci1kcm9wLW9wZW4nKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuICAvLyBTdGVuY2lsIGxpZmVjeWNsZSAtIGNhbGxlZCBvbmNlIGFmdGVyIGNvbXBvbmVudCBpcyBmdWxseSBsb2FkZWQgYW5kIDFzdCByZW5kZXIgb2NjdXJyZWRcclxuICBjb21wb25lbnREaWRMb2FkKCkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAvLyBjb25zb2xlLmxvZygnJWMgYXJjZ2lzLWluZm9ncmFwaGljLXNlbGVjdG9yIGRpZFVwZGF0ZScsICdmb250LXNpemU6OHB0O2NvbG9yOm9yYW5nZTsnKVxyXG4gICAgc2VsZi5fbG9hZEluc3RhbmNlcygpO1xyXG4gICAgZnVuY3Rpb24gX2NsaWNrZWQoZSkge1xyXG4gICAgICBzZWxmLm9uQ2xpY2tEcm9wZG93bi5jYWxsKHNlbGYsIGUpO1xyXG4gICAgfVxyXG4gICAgLy8gQ29tcG9uZW50IGNvbmZpZ3VyYXRpb24gbm90aWZ5IHN1Yi1jb21wb25lbnRzIGlzIGR1cGxpY2F0ZWQgaW4gYWxsIGNvbXBvbmVudHNcclxuICAgIC8vIGlmICghc2VsZi5fYmFzZS5oYXNTdWJDb21wb25lbnRzKCkpIHtcclxuICAgIC8vICAgLy8gYWRkIHRoZSB3b3JrZmxvdyBzdWIgY29tcG9uZW50cyBmb3IgY29uZmlnIHVwZGF0ZXNcclxuICAgIC8vICAgc2VsZi5fYmFzZS5hZGRTdWJDb21wb25lbnRzKFtzZWxmLl9lbGVtZW50SWRzLmxpc3RdKTtcclxuICAgIC8vICAgLy9cclxuICAgIC8vIH1cclxuICAgIGNvbnN0IGRyb3BCdXR0b24gPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwoc2VsZi5lbCwgdGhpcy5fZWxlbWVudElkcy5idXR0b24pO1xyXG4gICAgaWYgKGRyb3BCdXR0b24pIHtcclxuICAgICAgZHJvcEJ1dHRvbi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIF9jbGlja2VkKTtcclxuICAgICAgZHJvcEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF9jbGlja2VkKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGRyb3BMYWJlbCA9IEFDTFV0aWxzLnF1ZXJ5RWxlbWVudEJ5SWQuY2FsbChzZWxmLmVsLCB0aGlzLl9lbGVtZW50SWRzLmxhYmVsKTtcclxuICAgIGlmIChkcm9wTGFiZWwpIHtcclxuICAgICAgZHJvcExhYmVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX2NsaWNrZWQpO1xyXG4gICAgICBkcm9wTGFiZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfY2xpY2tlZCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBkcm9wQXJyb3cgPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwoc2VsZi5lbCwgdGhpcy5fZWxlbWVudElkcy5hcnJvdyk7XHJcbiAgICBpZiAoZHJvcEFycm93KSB7XHJcbiAgICAgIGRyb3BBcnJvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIF9jbGlja2VkKTtcclxuICAgICAgZHJvcEFycm93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX2NsaWNrZWQpO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gX29uUmVzaXplKCkge1xyXG4gICAgICBzZWxmLmhpZGVQb3BvdmVyKCk7XHJcbiAgICAgIHNlbGYub25VcGRhdGVQb3BvdmVyU2l6ZSgpO1xyXG4gICAgfVxyXG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIF9vblJlc2l6ZSk7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgX29uUmVzaXplKTtcclxuICAgIGlmIChzZWxmLmJhc2VDb25maWcpIHtcclxuICAgICAgc2VsZi5iYXNlQ29uZmlnLm9uQ29tcG9uZW50SGFzUmVuZGVyZWQoKTtcclxuICAgIH1cclxuICB9XHJcbiAgaGlkZVBvcG92ZXIoKSB7XHJcbiAgICBjb25zdCBwb3BvdmVyID0gQUNMVXRpbHMucXVlcnlFbGVtZW50QnlJZC5jYWxsKHRoaXMuZWwsIHRoaXMuX2VsZW1lbnRJZHMucG9wb3Zlcik7XHJcbiAgICBpZiAocG9wb3Zlcikge1xyXG4gICAgICBwb3BvdmVyLnNldEF0dHJpYnV0ZSgnb3BlbicsICdmYWxzZScpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5fcG9wb3ZlcklzT3BlbiA9IGZhbHNlO1xyXG4gICAgdGhpcy5pbmZvZ3JhcGhpY1NlbGVjdG9yUG9wdXBDbG9zZWQuZW1pdCgpO1xyXG4gICAgY29uc3QgYXJyb3cgPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwodGhpcy5lbCwgdGhpcy5fZWxlbWVudElkcy5hcnJvdyk7XHJcbiAgICBpZiAoYXJyb3cpIHtcclxuICAgICAgYXJyb3cuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0b3ItZHJvcC1vcGVuJyk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIG9uVXBkYXRlUG9wb3ZlclNpemUoKSB7XHJcbiAgICBpZiAoIXRoaXMuZWwpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IGZ1bGxDb250ZW50SHQgPSAxMDA7XHJcbiAgICBjb25zdCBtaW5Db250ZW50SHQgPSAxMDA7XHJcbiAgICBjb25zdCBtYXhQb3BvdmVyV3QgPSA0NTA7XHJcbiAgICBjb25zdCB2cGFkID0gMzY7XHJcbiAgICBjb25zdCBocGFkID0gMTY7XHJcbiAgICBjb25zdCBjbGllbnRIdCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7XHJcbiAgICBjb25zdCBjbGllbnRXdCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDtcclxuICAgIGNvbnN0IGJyciA9IHRoaXMuZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICBjb25zdCBodEFib3ZlID0gYnJyLnRvcDtcclxuICAgIGNvbnN0IGh0QmVsb3cgPSBjbGllbnRIdCAtIChicnIudG9wICsgYnJyLmhlaWdodCkgKyB3aW5kb3cuc2Nyb2xsWTtcclxuICAgIGxldCBmdWxsQ29udGVudFd0ID0gY2xpZW50V3QgLyAyO1xyXG4gICAgY29uc3Qgd3RSaWdodCA9IGNsaWVudFd0IC0gYnJyLmxlZnQgKyB3aW5kb3cuc2Nyb2xsWDtcclxuICAgIGlmICgoaHRCZWxvdyA8IG1pbkNvbnRlbnRIdCAmJiBodEJlbG93IDwgaHRBYm92ZSkgfHxcclxuICAgICAgKGh0QWJvdmUgPiBodEJlbG93ICYmIGh0QWJvdmUgPj0gbWluQ29udGVudEh0KSkge1xyXG4gICAgICAvLyBwb3BvdmVyIG1heCBoZWlnaHQgPSBodCBhYm92ZSBpZiB0aGF0IHNwYWNlIGlzIGxhcmdlciB0aGFuIGJlbG93XHJcbiAgICAgIGZ1bGxDb250ZW50SHQgPSBodEFib3ZlIC0gdnBhZDtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBmdWxsQ29udGVudEh0ID0gaHRCZWxvdyAtIHZwYWQ7XHJcbiAgICB9XHJcbiAgICBpZiAoKHd0UmlnaHQgPCBicnIud2lkdGggJiYgYnJyLmxlZnQgPiB3dFJpZ2h0KSB8fFxyXG4gICAgICAoYnJyLmxlZnQgPiB3dFJpZ2h0ICYmIGJyci5sZWZ0ID49IGJyci53aWR0aCkpIHtcclxuICAgICAgZnVsbENvbnRlbnRXdCA9IGJyci5sZWZ0IC0gaHBhZDtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBmdWxsQ29udGVudFd0ID0gY2xpZW50V3QgLSBicnIubGVmdCAtIGhwYWQ7XHJcbiAgICB9XHJcbiAgICBmdWxsQ29udGVudFd0ID0gTWF0aC5taW4obWF4UG9wb3Zlcld0LCBmdWxsQ29udGVudFd0KTtcclxuICAgIC8vIGZ1bGxDb250ZW50V3QgPSBNYXRoLm1heChtaW5Qb3BvdmVyV3QsIE1hdGgubWluKHd0UmlnaHQgLSBocGFkLCBtYXhQb3BvdmVyV3QpKVxyXG4gICAgY29uc3QgY29udGVudEVsZW0gPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwodGhpcy5lbCwgdGhpcy5fZWxlbWVudElkcy5jb250ZW50KTtcclxuICAgIGlmIChjb250ZW50RWxlbSkge1xyXG4gICAgICBpZiAoY29udGVudEVsZW0pIHtcclxuICAgICAgICBjb250ZW50RWxlbS5zdHlsZS5oZWlnaHQgPSBmdWxsQ29udGVudEh0ICsgJ3B4JztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgcG9wb3ZlckVsZW0gPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwodGhpcy5lbCwgdGhpcy5fZWxlbWVudElkcy5wb3BvdmVyKTtcclxuICAgIGlmIChwb3BvdmVyRWxlbSkge1xyXG4gICAgICBwb3BvdmVyRWxlbS5zdHlsZS53aWR0aCA9IE1hdGgubWluKDQ1MCwgZnVsbENvbnRlbnRXdCkgKyAncHgnO1xyXG4gICAgfVxyXG4gICAgLy8gbm90aWZ5IHRyZWUgdGhhdCBvdXIgc2l6ZSBtYXkgaGF2ZSBjaGFuZ2VkXHJcbiAgICBjb25zdCB0cmVlID0gQUNMVXRpbHMucXVlcnlFbGVtZW50QnlJZC5jYWxsKHRoaXMuZWwsIHRoaXMuX2VsZW1lbnRJZHMucmVwb3J0cyk7XHJcbiAgICBpZiAodHJlZSkge1xyXG4gICAgICB0cmVlLnVwZGF0ZUxheW91dCgpO1xyXG4gICAgfVxyXG4gIH1cclxuICBfc2hvd1BsYWNlaG9sZGVyKCkge1xyXG4gICAgY29uc3QgdHh0ID0gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignc2VsZWN0LWluZm9ncmFwaGljJyk7XHJcbiAgICBjb25zdCBlbGVtID0gQUNMVXRpbHMucXVlcnlFbGVtZW50QnlJZC5jYWxsKHRoaXMsIHRoaXMuX2VsZW1lbnRJZHMubGFiZWwpO1xyXG4gICAgaWYgKGVsZW0pIHtcclxuICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCdzZWxlY3Rvci1sYWJlbC1wbGFjZWhvbGRlcicpO1xyXG4gICAgICBlbGVtLmlubmVyVGV4dCA9IHR4dDtcclxuICAgIH1cclxuICB9XHJcbiAgX2hpZGVQbGFjZWhvbGRlckFuZFNob3dMYWJlbChyZXBsYWNlbWVudFRleHQpIHtcclxuICAgIGNvbnN0IGVsZW0gPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwodGhpcywgdGhpcy5fZWxlbWVudElkcy5sYWJlbCk7XHJcbiAgICBpZiAoZWxlbSkge1xyXG4gICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdG9yLWxhYmVsLXBsYWNlaG9sZGVyJyk7XHJcbiAgICAgIGlmIChyZXBsYWNlbWVudFRleHQpIHtcclxuICAgICAgICBlbGVtLmlubmVyVGV4dCA9IHJlcGxhY2VtZW50VGV4dDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICByZW5kZXIoKSB7XHJcbiAgICAvLyBjb25zdCBjZmcgPSB0aGlzLmJhc2VDb25maWcuY29uZmlnXHJcbiAgICAvLyBsZXQgcmVwb3J0TGlzdDogc3RyaW5nID0gJ3t9J1xyXG4gICAgaWYgKCF0aGlzLmJhc2VDb25maWcuY29uZmlnPy51c2VybmFtZSB8fCAhQUNMVXRpbHMuaGFzVGV4dCh0aGlzLmJhc2VDb25maWcuY29uZmlnLnVzZXJuYW1lKSkge1xyXG4gICAgICBjb25zb2xlLmxvZygnRVJST1I6IGFyY2dpcy1pbmZvZ3JhcGhpYy1zZWxlY3RvciBtaXNzaW5nIFt1c2VybmFtZV0nKTtcclxuICAgIH1cclxuICAgIGlmICghdGhpcy5iYXNlQ29uZmlnLmNvbmZpZz8udG9rZW4gfHwgIUFDTFV0aWxzLmhhc1RleHQodGhpcy5iYXNlQ29uZmlnLmNvbmZpZy50b2tlbikpIHtcclxuICAgICAgY29uc29sZS5sb2coJ0VSUk9SOiBhcmNnaXMtaW5mb2dyYXBoaWMtc2VsZWN0b3IgbWlzc2luZyBbdG9rZW5dJyk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBwVGV4dCA9IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ3NlbGVjdC1pbmZvZ3JhcGhpYycpO1xyXG4gICAgY29uc3QgcG9wU3R5bGUgPSB7XHJcbiAgICAgIC8vICdwYWRkaW5nLXJpZ2h0JzogJzIwcHgnLFxyXG4gICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLFxyXG4gICAgICAndG9wJzogJzBweCcsXHJcbiAgICAgICdsZWZ0JzogJzBweCcsXHJcbiAgICAgICd0cmFuc2Zvcm0nOiAndHJhbnNsYXRlKC0zMTJweCwgN3B4KScsXHJcbiAgICAgICdib3JkZXInOiAnbm9uZScsXHJcbiAgICAgICdib3gtc2hhZG93JzogJ25vbmUnLFxyXG4gICAgICAnd2lkdGgnOiAnNDUwcHgnXHJcbiAgICB9O1xyXG4gICAgY29uc3QgcG9wb3ZlclN0eWxlID0ge1xyXG4gICAgICAncGFkZGluZyc6ICc2cHgnLFxyXG4gICAgICAnd2lkdGgnOiAnMzAwcHgnLFxyXG4gICAgICAnaGVpZ2h0JzogJzIwMHB4J1xyXG4gICAgfTtcclxuICAgIGNvbnN0IHBvcHVwQ2xvc2VIYW5kbGVyID0gKCkgPT4ge1xyXG4gICAgICB0aGlzLmluZm9ncmFwaGljU2VsZWN0b3JQb3B1cENsb3NlZC5lbWl0KCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgaWQ6IHRoaXMuX2luc3RhbmNlSWQsIGNsYXNzOiBcImluZm9ncmFwaGljU2VsZWN0b3JPdXRlclwiIH0sIGgoXCJkaXZcIiwgeyBpZDogdGhpcy5fZWxlbWVudElkcy5idXR0b24sIGNsYXNzOiBcInNlbGVjdG9yLWRyb3Bkb3duXCIgfSwgaChcImRpdlwiLCB7IGlkOiB0aGlzLl9lbGVtZW50SWRzLmxhYmVsLCBjbGFzczogXCJzZWxlY3Rvci1kcm9wZG93bi1sYWJlbFwiIH0sIHBUZXh0KSwgaChcInN2Z1wiLCB7IGlkOiB0aGlzLl9lbGVtZW50SWRzLmFycm93LCBjbGFzczogXCJzZWxlY3Rvci1kcm9wZG93bi1hcnJvd1wiLCB3aWR0aDogXCIyNFwiLCBoZWlnaHQ6IFwiMjRcIiwgdmlld0JveDogXCIwIDAgMTYgMTZcIiwgZmlsbDogXCJub25lXCIsIHhtbG5zOiBcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgfSwgaChcInBhdGhcIiwgeyBmaWxsOiBcImN1cnJlbnRDb2xvclwiLCBcImZpbGwtcnVsZVwiOiBcImV2ZW5vZGRcIiwgc3Ryb2tlOiBcImN1cnJlbnRDb2xvclwiLCBkOiBcIk0yLjE0NiA0LjY1M2EuNDg1LjQ4NSAwIDAgMSAuNzA4IDBMOCAxMC4yNGw1LjE0Ni01LjU4N2EuNDg1LjQ4NSAwIDAgMSAuNzA4IDAgLjUzOC41MzggMCAwIDEgMCAuNzM4bC01LjUgNS45NTZhLjQ4NS40ODUgMCAwIDEtLjcwOCAwbC01LjUtNS45NTZhLjUzOC41MzggMCAwIDEgMC0uNzM4WlwiLCBcImNsaXAtcnVsZVwiOiBcImV2ZW5vZGRcIiB9KSkpLCBoKFwiY2FsY2l0ZS1wb3BvdmVyXCIsIHsgaWQ6IHRoaXMuX2VsZW1lbnRJZHMucG9wb3Zlciwgc3R5bGU6IHBvcFN0eWxlLCBsYWJlbDogXCJDaG9vc2UgaW5mb2dyYXBoaWNzXCIsIFwicG9pbnRlci1kaXNhYmxlZFwiOiBcInRydWVcIiwgXCJvdmVybGF5LXBvc2l0aW9uaW5nXCI6IFwiYWJzb2x1dGVcIiwgcGxhY2VtZW50OiBcImJvdHRvbS1zdGFydFwiLCBcIm9mZnNldC1za2lkZGluZ1wiOiBcIjRcIiwgXCJhdXRvLWNsb3NlXCI6IFwidHJ1ZVwiLCBcInJlZmVyZW5jZS1lbGVtZW50XCI6IHRoaXMuX2VsZW1lbnRJZHMuYnV0dG9uLCBvbkNhbGNpdGVQb3BvdmVyQ2xvc2U6IHBvcHVwQ2xvc2VIYW5kbGVyIH0sIGgoXCJkaXZcIiwgeyBpZDogdGhpcy5fZWxlbWVudElkcy5jb250ZW50LCBzdHlsZTogcG9wb3ZlclN0eWxlIH0sIGgoXCJhcmNnaXMtaW5mb2dyYXBoaWMtdHJlZVwiLCB7IGlkOiB0aGlzLl9lbGVtZW50SWRzLnJlcG9ydHMsIHBvcnRhbE9ubGluZUdFUHJveHk6IHRoaXMucG9ydGFsT25saW5lR0VQcm94eSwgY2xhc3M6IFwiYXJjU2VsLXJlcG9ydHNcIiwgY29uZmlnOiB0aGlzLmJhc2VDb25maWcuZ2V0Q29uZmlnU3RyaW5nKCkgfSkpKSkpO1xyXG4gIH1cclxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XHJcbiAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcclxuICAgIFwiZW52XCI6IFtcIm9uRW52Q2hhbmdlZFwiXSxcclxuICAgIFwidG9rZW5cIjogW1wib25Ub2tlbkNoYW5nZWRcIl0sXHJcbiAgICBcInVzZXJuYW1lXCI6IFtcIm9uVXNlcm5hbWVDaGFuZ2VkXCJdLFxyXG4gICAgXCJsYW5nQ29kZVwiOiBbXCJvbkxhbmdDb2RlQ2hhbmdlZFwiXSxcclxuICAgIFwiZ2VvZW5yaWNobWVudFVybFwiOiBbXCJvbkdlb2VucmljaG1lbnRVcmxDaGFuZ2VkXCJdLFxyXG4gICAgXCJzZWxlY3RlZFJlcG9ydElkXCI6IFtcIm9uU2VsZWN0ZWRSZXBvcnRJZENoYW5nZWRcIl0sXHJcbiAgICBcInNvdXJjZUNvdW50cnlcIjogW1wib25Tb3VyY2VDb3VudHJ5Q2hhbmdlZFwiXSxcclxuICAgIFwidGhlbWVcIjogW1wib25UaGVtZUNoYW5nZWRcIl0sXHJcbiAgICBcImNvbmZpZ1wiOiBbXCJvbkNvbmZpZ0NoYW5nZVwiXVxyXG4gIH07IH1cclxufTtcclxuQXJjZ2lzSW5mb2dyYXBoaWNTZWxlY3Rvci5zdHlsZSA9IGFyY2dpc0luZm9ncmFwaGljU2VsZWN0b3JDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc0luZm9ncmFwaGljU2VsZWN0b3IgYXMgYXJjZ2lzX2luZm9ncmFwaGljX3NlbGVjdG9yIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1pbmZvZ3JhcGhpYy1zZWxlY3Rvcl8yLmVudHJ5LmpzLm1hcCIsImltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgZyBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC00ZTY0NzQxMS5qcyc7XG5pbXBvcnQgeyBVIGFzIFV0aWxzLCBMIGFzIExvZ3osIEEgYXMgQUNMVXRpbHMsIEUgYXMgRWxlbWVudElkcywgQiBhcyBCYVJlcG9ydHNMYW5ndWFnZSB9IGZyb20gJy4vRWxlbWVudElkcy1hMmM0MDU5Mi5qcyc7XG5pbXBvcnQgeyBFIGFzIEVudmlyb25tZW50cyB9IGZyb20gJy4vR0VDbGllbnQtZjcxMDQ5ZjguanMnO1xuaW1wb3J0IHsgcyBhcyBzZXRUb2tlbiwgZyBhcyBnZXRJbmZvZ3JhcGhpY1RlbXBsYXRlc0xpc3QgfSBmcm9tICcuL2FyY2dpc1JlcG9ydHMtMGMzNTFmMGEuanMnO1xuaW1wb3J0IHsgQiBhcyBCYXNlVXRpbCB9IGZyb20gJy4vYmFzZS11dGlsLWI3ZGI2OWYwLmpzJztcblxudmFyIF9hO1xyXG5jbGFzcyBQcmV2aWV3UG9wdXAge1xyXG4gIHN0YXRpYyBuZXh0Q2FsbGJhY2soZikge1xyXG4gICAgaWYgKGYpIHtcclxuICAgICAgdGhpcy5fY2FsbGJhY2tOZXh0ID0gZjtcclxuICAgIH1cclxuICB9XHJcbiAgc3RhdGljIHByZXZpb3VzQ2FsbGJhY2soZikge1xyXG4gICAgaWYgKGYpIHtcclxuICAgICAgdGhpcy5fY2FsbGJhY2tQcmV2ID0gZjtcclxuICAgIH1cclxuICB9XHJcbiAgc3RhdGljIGhpZGVQb3B1cCgpIHtcclxuICAgIC8vIHJlbW92ZSBwb3B1cCBlbGVtZW50c1xyXG4gICAgdGhpcy5fY2FuY2VsVGltZXIoKTtcclxuICAgIHRoaXMuX3JlbW92ZVBvcHVwKCk7XHJcbiAgICB0aGlzLl9yZXBvcnRJZCA9ICcnO1xyXG4gIH1cclxuICBzdGF0aWMgX29uVGltZXJUaWNrKCkge1xyXG4gICAgdGhpcy5fdGltZXIgPSB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLmhpZGVQb3B1cCgpO1xyXG4gIH1cclxuICBzdGF0aWMgX29uR29Ub05leHQoKSB7XHJcbiAgICBpZiAodGhpcy5fY2FsbGJhY2tOZXh0KSB7XHJcbiAgICAgIHRoaXMuX2NhbGxiYWNrTmV4dCh0aGlzLl9yZXBvcnRJZCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHN0YXRpYyBfb25Hb1RvUHJldigpIHtcclxuICAgIGlmICh0aGlzLl9jYWxsYmFja1ByZXYpIHtcclxuICAgICAgdGhpcy5fY2FsbGJhY2tQcmV2KHRoaXMuX3JlcG9ydElkKTtcclxuICAgIH1cclxuICB9XHJcbiAgc3RhdGljIF9zdGFydFRpbWVyKCkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBzZWxmLl9jYW5jZWxUaW1lcigpO1xyXG4gICAgc2VsZi5fdGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsgc2VsZi5fb25UaW1lclRpY2suY2FsbChzZWxmKTsgfSwgdGhpcy50aW1lb3V0U2Vjb25kcyAqIDEwMDApO1xyXG4gIH1cclxuICBzdGF0aWMgX2NhbmNlbFRpbWVyKCkge1xyXG4gICAgaWYgKHRoaXMuX3RpbWVyKSB7XHJcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLl90aW1lcik7XHJcbiAgICAgIHRoaXMuX3RpbWVyID0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG4gIH1cclxuICBzdGF0aWMgX3Jlc2V0VGltZXIoKSB7XHJcbiAgICB0aGlzLl9jYW5jZWxUaW1lcigpO1xyXG4gICAgdGhpcy5fc3RhcnRUaW1lcigpO1xyXG4gIH1cclxuICBzdGF0aWMgX3JlbW92ZVBvcHVwKCkge1xyXG4gICAgaWYgKHRoaXMuX3BvcHVwRWxlbWVudClcclxuICAgICAgdGhpcy5fcG9wdXBFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50ID0gdW5kZWZpbmVkO1xyXG4gIH1cclxuICBzdGF0aWMgX2dlbmVyYXRlUG9wdXAoeSwgcmF0aW8sIHNyYykge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAvLyBjcmVhdGUgdGhlIGZ1bGwgc2l6ZSBtYXNrIGRpdiB0aGF0IGlzIHRyYW5zcGFyZW50XHJcbiAgICBjb25zdCBtYXNrRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBtYXNrRGl2LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcclxuICAgIG1hc2tEaXYuc3R5bGUubGVmdCA9ICcwJztcclxuICAgIG1hc2tEaXYuc3R5bGUudG9wID0gJzAnO1xyXG4gICAgbWFza0Rpdi5zdHlsZS53aWR0aCA9ICh0aGlzLl9jb250YWluZXIub2Zmc2V0V2lkdGggLSB0aGlzLl9yaWdodFBhZCkgKyAncHgnO1xyXG4gICAgbWFza0Rpdi5zdHlsZS5oZWlnaHQgPSB0aGlzLl9jb250YWluZXIub2Zmc2V0SGVpZ2h0ICsgJ3B4JztcclxuICAgIG1hc2tEaXYuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3RyYW5zcGFyZW50JztcclxuICAgIG1hc2tEaXYuc3R5bGUuekluZGV4ID0gJzkwMCc7XHJcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSBtYXNrRGl2O1xyXG4gICAgdGhpcy5fY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuX3BvcHVwRWxlbWVudCk7XHJcbiAgICBtYXNrRGl2LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsICgpID0+IHsgc2VsZi5oaWRlUG9wdXAoKTsgfSk7XHJcbiAgICAvLyBjcmVhdGUgdGhlIGltYWdlIGRpdiB3aXRoIGNhbGN1bGF0ZWQgc2l6ZSBhbmQgcGxhY2VtZW50XHJcbiAgICB0aGlzLl9wbGFjZUltYWdlRGl2KHksIHJhdGlvLCBzcmMpO1xyXG4gIH1cclxuICBzdGF0aWMgX3BsYWNlSW1hZ2VEaXYoeSwgcmF0aW8sIHVybCkge1xyXG4gICAgLy8gY29uc29sZS5sb2coIHksIHVybClcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vSW1hZ2UgcGFkZGluZyBjb25zdGFudHNcclxuICAgICAgY29uc3QgcGFkID0gMjA7XHJcbiAgICAgIGNvbnN0IHBvcEVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgICAgbGV0IG8gPSB7XHJcbiAgICAgICAgY2xpY2s6IHsgeTogeSB9LFxyXG4gICAgICAgIHBvcHVwOiB7IHRvcDogMCwgcmlnaHQ6IDAsIHd0OiAxLCBodDogMSB9LFxyXG4gICAgICAgIGFkanVzdGVkQ29udEh0OiAwLFxyXG4gICAgICAgIGFkanVzdGVkQ29udFd0OiAwLFxyXG4gICAgICAgIHJhdGlvOiByYXRpb1xyXG4gICAgICB9O1xyXG4gICAgICBvLmFkanVzdGVkQ29udEh0ID0gdGhpcy5fcG9wdXBFbGVtZW50Lm9mZnNldEhlaWdodCAtIChwYWQgKiAyKTtcclxuICAgICAgby5hZGp1c3RlZENvbnRXdCA9IHRoaXMuX3BvcHVwRWxlbWVudC5vZmZzZXRXaWR0aCAtIHBhZDtcclxuICAgICAgLy8gcGxhY2UgcG9wdXAgY2VudGVyZWQgYW5kIHRvIHRoZSBsZWZ0IG9mIHRoZSBjbGljayBwb2ludCB4LHkgYW5kIGZpdCBhcyBuZWVkZWRcclxuICAgICAgLy8gSWYgVyA+PSBIXHJcbiAgICAgIGlmIChvLnJhdGlvID49IDEpIHtcclxuICAgICAgICAvLyB3aWR0aCA+PSBoZWlnaHRcclxuICAgICAgICBvLnBvcHVwLnd0ID0gby5hZGp1c3RlZENvbnRXdDtcclxuICAgICAgICBvLnBvcHVwLmh0ID0gby5wb3B1cC53dCAvIG8ucmF0aW87XHJcbiAgICAgICAgaWYgKG8ucG9wdXAuaHQgPiBvLmFkanVzdGVkQ29udEh0KSB7XHJcbiAgICAgICAgICAvLyByZWR1Y2UgdGFyZ2V0IGhlaWdodCB0byBmaXRcclxuICAgICAgICAgIG8ucG9wdXAuaHQgPSBvLmFkanVzdGVkQ29udEh0O1xyXG4gICAgICAgICAgby5wb3B1cC53dCA9IG8uYWRqdXN0ZWRDb250SHQgKiBvLnJhdGlvO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICAvLyBoZWlnaHQgPiB3aWR0aFxyXG4gICAgICAgIG8ucG9wdXAuaHQgPSBvLmFkanVzdGVkQ29udEh0O1xyXG4gICAgICAgIG8ucG9wdXAud3QgPSBvLnBvcHVwLmh0ICogby5yYXRpbztcclxuICAgICAgICBpZiAoby5wb3B1cC53dCA+IG8uYWRqdXN0ZWRDb250V3QpIHtcclxuICAgICAgICAgIC8vIHJlZHVjZSB0YXJnZXQgd2lkdGggdG8gZml0XHJcbiAgICAgICAgICBvLnBvcHVwLnd0ID0gby5hZGp1c3RlZENvbnRXdDtcclxuICAgICAgICAgIG8ucG9wdXAuaHQgPSBvLmFkanVzdGVkQ29udFd0IC8gby5yYXRpbztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgLy8gUGxhY2UgaW4gY29udGFpbmVyXHJcbiAgICAgIGNvbnN0IGRlc2lyZWRUb3AgPSBNYXRoLm1heChvLmNsaWNrLnkgLSAoby5wb3B1cC5odCAvIDIpLCBwYWQpO1xyXG4gICAgICBjb25zdCBtYXhUb3AgPSBvLmFkanVzdGVkQ29udEh0IC0gby5wb3B1cC5odCArIHBhZDtcclxuICAgICAgby5wb3B1cC50b3AgPSBNYXRoLm1pbihkZXNpcmVkVG9wLCBtYXhUb3ApO1xyXG4gICAgICBvLnBvcHVwLnJpZ2h0ID0gMDtcclxuICAgICAgLy8gU2V0IHRoZSBwb3B1cCBwbGFjZW1lbnRcclxuICAgICAgcG9wRWxlbS5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XHJcbiAgICAgIHBvcEVsZW0uc3R5bGUucmlnaHQgPSBvLnBvcHVwLnJpZ2h0ICsgJ3B4JztcclxuICAgICAgcG9wRWxlbS5zdHlsZS50b3AgPSBvLnBvcHVwLnRvcCArICdweCc7XHJcbiAgICAgIHBvcEVsZW0uc3R5bGUud2lkdGggPSBvLnBvcHVwLnd0ICsgJ3B4JztcclxuICAgICAgcG9wRWxlbS5zdHlsZS5oZWlnaHQgPSBvLnBvcHVwLmh0ICsgJ3B4JztcclxuICAgICAgcG9wRWxlbS5zcmMgPSB1cmw7XHJcbiAgICAgIC8vIEFkZCB0aGUgaW1hZ2Ugc291cmNlIHVybFxyXG4gICAgICB0aGlzLl9wb3B1cEVsZW1lbnQuYXBwZW5kQ2hpbGQocG9wRWxlbSk7XHJcbiAgICAgIHBvcEVsZW0uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgKGUpID0+IHtcclxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGV4KSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCclYyBQcmV2aWV3UG9wdXAgZXJyb3InLCAnY29sb3I6cmVkO2ZvbnQtc2l6ZToxMHB0JywgZXgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gIH1cclxufVxyXG5fYSA9IFByZXZpZXdQb3B1cDtcclxuLyoqIHNob3dQb3B1cFxyXG4qXHJcbiogIGFwcGxpZXMgdGhlIHNyYyBhdHRyaWJ1dGUgdG8gdGhlIGltYWdlIGVsZW1lbnQgaW4gdGhlIHBvcHVwXHJcbipcclxuKiBAcGFyYW0gaW1hZ2VTcmNVcmwgID0gdmFsaWQgdXJsIGZvciBpbWFnZVxyXG4qL1xyXG5QcmV2aWV3UG9wdXAuc2hvdyA9IChyZXBvcnRJZCwgY29udGFpbmVyRWxlbWVudCwgY2xpY2tZLCByYXRpb1cySCwgaW1hZ2VTcmNVcmwpID0+IHtcclxuICBpZiAoY29udGFpbmVyRWxlbWVudCAmJiBjbGlja1kgJiYgaW1hZ2VTcmNVcmwgJiYgVXRpbHMuaGFzVGV4dChpbWFnZVNyY1VybCkpIHtcclxuICAgIGlmIChyZXBvcnRJZCA9PSBfYS5fcmVwb3J0SWQpIHtcclxuICAgICAgX2EuX3Jlc2V0VGltZXIoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBfYS5oaWRlUG9wdXAoKTtcclxuICAgICAgaWYgKCFfYS50aW1lb3V0U2Vjb25kcykge1xyXG4gICAgICAgIF9hLnRpbWVvdXRTZWNvbmRzID0gNjtcclxuICAgICAgfVxyXG4gICAgICBfYS5fY29udGFpbmVyID0gY29udGFpbmVyRWxlbWVudDtcclxuICAgICAgX2EuX3JlcG9ydElkID0gcmVwb3J0SWQ7XHJcbiAgICAgIF9hLl9nZW5lcmF0ZVBvcHVwKGNsaWNrWSwgcmF0aW9XMkgsIGltYWdlU3JjVXJsKTtcclxuICAgICAgX2EuX3N0YXJ0VGltZXIoKTtcclxuICAgIH1cclxuICB9XHJcbn07XHJcblByZXZpZXdQb3B1cC5fcmlnaHRQYWQgPSA2MDtcblxuY29uc3QgYXJjZ2lzSW5mb2dyYXBoaWNUcmVlQ3NzID0gXCI6aG9zdHtkaXNwbGF5OmJsb2NrfTo6c2xvdHRlZChbc2xvdD1cXFwiY2hpbGRyZW5cXFwiXSl7d2lkdGg6MTAwJX0ucmVwb3J0TGlzdHtmb250LXdlaWdodDoyMDB9LnJlcG9ydEl0ZW1ze2ZvbnQtd2VpZ2h0OjIwMDttYXJnaW4taW5saW5lLWVuZDowLjI1cmVtfS5yZXBvcnQtaXRlbS1idXR0b25ze3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjIzcHg7aGVpZ2h0OjI4cHh9LnJlcG9ydC1pdGVtLXByZXZpZXd7cG9zaXRpb246YWJzb2x1dGU7dG9wOjVweDt3aWR0aDoyMnB4O2hlaWdodDoyMnB4fS5yZXBvcnQtaXRlbS1kb3Rze3Bvc2l0aW9uOmFic29sdXRlO3RvcDo3cHg7bGVmdDozNHB4O3dpZHRoOjIycHg7aGVpZ2h0OjIycHh9LnJlcG9ydFRyZWV7cGFkZGluZy1ib3R0b206MnB4fS5pbmZvZ3JhcGhpYy10cmVlLWJ1c3l7cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7bGVmdDowO3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7YmFja2dyb3VuZDp1cmwoLi9hc3NldHMvbGFyZ2VCdXN5LmdpZik7YmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O2JhY2tncm91bmQtcG9zaXRpb246Y2VudGVyO3otaW5kZXg6OTk5O2Rpc3BsYXk6bm9uZX1jYWxjaXRlLXRyZWUtaXRlbSBbc2VsZWN0ZWRde2ZvbnQtd2VpZ2h0OmJvbGR9LnJlcG9ydC1pdGVtLWNvbnRlbnR7d2lkdGg6MTAwJTtoZWlnaHQ6MzJweDtkaXNwbGF5OmZsZXh9LnJlcG9ydC1yZWZyZXNoLWJ1dHRvbntwb3NpdGlvbjphYnNvbHV0ZTt0b3A6OHB4O3JpZ2h0OjEwcHg7d2lkdGg6MThweDtoZWlnaHQ6MThweH0uaW5mby10cmVlLXNlYXJjaC1kaXZ7cG9zaXRpb246YWJzb2x1dGU7dG9wOjNweDtsZWZ0OjNweDt3aWR0aDpjYWxjKDEwMCUgLSAxNjVweCk7aGVpZ2h0OjMzcHg7ZGlzcGxheTpmbGV4fS5pbmZvLXRyZWUtc2VhcmNoe2ZsZXg6MSAxIDAlO3dpZHRoOmNhbGMoMTAwJSAtIDI5cHgpO2hlaWdodDoyNHB4O2Zsb2F0OmxlZnR9LmluZm8tdHJlZS1pY29ue3Bvc2l0aW9uOnJlbGF0aXZlO3RvcDo0cHg7bGVmdDoycHg7d2lkdGg6MjRweDtoZWlnaHQ6MjZweDtmbG9hdDpyaWdodDt0cmFuc2Zvcm06c2NhbGUoMC42KTtiYWNrZ3JvdW5kLXJlcGVhdDpuby1yZXBlYXR9LmluZm8tdHJlZS1zb3J0e3Bvc2l0aW9uOmFic29sdXRlO3RvcDozcHg7bGVmdDpjYWxjKDEwMCUgLSAxNDhweCk7d2lkdGg6MTQ0cHg7aGVpZ2h0OjMycHg7ei1pbmRleDo2fS5pbmZvLXRyZWUtbGlzdHtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MzZweDtsZWZ0OjNweDtoZWlnaHQ6Y2FsYygxMDAlIC0gNDBweCk7d2lkdGg6Y2FsYygxMDAlIC0gNnB4KX0ucmVwb3J0LWl0ZW0tdGV4dHtwb3NpdGlvbjpyZWxhdGl2ZTt0b3A6N3B4O2ZsZXg6MSAxIDAlO3RleHQtYWxpZ246bGVmdDt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzO292ZXJmbG93OmhpZGRlbjt3aGl0ZS1zcGFjZTpub3dyYXA7Zm9udC13ZWlnaHQ6MjAwfS5yZXBvcnQtaXRlbS1wb3BvdmVye3dpZHRoOmF1dG87aGVpZ2h0OmF1dG87bWluLXdpZHRoOjMwMHB4O21pbi1oZWlnaHQ6MjAwcHg7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudH0ucmVwb3J0LWl0ZW0tcG9wb3Zlci1jb250ZW50e21pbi1oZWlnaHQ6MzJweDtsaW5lLWhlaWdodDoyMDBweDt0ZXh0LWFsaWduOnJpZ2h0fS5yZXBvcnQtaXRlbS1kZWZhdWx0LXBvcG92ZXJ7bWluLXdpZHRoOjE2MHB4O3BhZGRpbmc6M3B4O2hlaWdodDo0MnB4fS50cmVlLWNvbnRhaW5lcntwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDpjYWxjKDEwMCUgLSAxMnB4KTtoZWlnaHQ6Y2FsYygxMDAlIC0gMThweCk7b3ZlcmZsb3cteDpoaWRkZW47b3ZlcmZsb3cteTpzY3JvbGx9LnRodW1ibmFpbC1wcmV2aWV3e3Bvc2l0aW9uOmFic29sdXRlO3RvcDowO3JpZ2h0OjA7bWF4LXdpZHRoOjMwMHB4O21heC1oZWlnaHQ6MjAwcHg7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDtib3JkZXI6bm9uZTt6LWluZGV4OjY7b3BhY2l0eToxO29iamVjdC1maXQ6Y292ZXJ9LnJlcG9ydC1pdGVtLXBvcG92ZXItbm90LWZvdW5ke3Bvc2l0aW9uOmFic29sdXRlO3RvcDo0cHg7cmlnaHQ6NDFweDttaW4td2lkdGg6MTYwcHg7aGVpZ2h0OjMycHggIWltcG9ydGFudDtsaW5lLWhlaWdodDoyNHB4ICFpbXBvcnRhbnR9XCI7XG5cbmNvbnN0IEFyY2dpc0luZm9ncmFwaGljVHJlZSA9IGNsYXNzIHtcclxuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XHJcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xyXG4gICAgdGhpcy5yZXBvcnRTZWxlY3RlZCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwicmVwb3J0U2VsZWN0ZWRcIiwgNyk7XHJcbiAgICB0aGlzLl9pZFByZWZpeCA9ICdhcmNnaXMtaW5mb2dyYXBoaWMtdHJlZS0nO1xyXG4gICAgdGhpcy5faWRQcmVmaXhCdXN5ID0gJ2FyY2dpcy1pbmZvZ3JhcGhpYy10cmVlLWJ1c3ktJztcclxuICAgIHRoaXMuX2J1c3lJZFByZWZpeCA9ICdpZy10cmVlLWJ1c3ktJztcclxuICAgIHRoaXMuX2NvbnRhaW5lclByZWZpeCA9ICdhaXQtY29udGFpbmVyLSc7XHJcbiAgICB0aGlzLl9lbGVtZW50SWRzID0ge307IC8vIGxpc3QsIHNlYXJjaCwgc29ydFxyXG4gICAgdGhpcy5faWRMaXN0UHJlZml4ID0gJ2lnLXRyZWUtbGlzdC0nO1xyXG4gICAgdGhpcy5faWRTZWFyY2hQcmVmaXggPSAnaWctdHJlZS1zZWFyY2gtJztcclxuICAgIHRoaXMuX2lkU29ydFByZWZpeCA9ICdpZy10cmVlLXNvcnQtJztcclxuICAgIHRoaXMuX2lkUHJlZml4UmVwb3J0cyA9ICdzZWxlY3Rvci1wb3BvdmVyLXJlcG9ydHMtJztcclxuICAgIHRoaXMuX2ltZ09mZnNldCA9IDE7XHJcbiAgICB0aGlzLl9kYmcgPSBmYWxzZTtcclxuICAgIHRoaXMuc3RTb3VyY2VDb3VudHJ5ID0gJ1VTJztcclxuICAgIHRoaXMuc3RNdWx0aXBsZUNob2ljZSA9IGZhbHNlO1xyXG4gICAgdGhpcy5zdFNvcnRUeXBlID0gJ25ld2VzdCc7XHJcbiAgICAvLyBJbnRlcm5hbCB1c2Ugb25seSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gICAgdGhpcy5faXNJbml0aWFsaXplZCA9IGZhbHNlO1xyXG4gICAgdGhpcy5vcGVuUG9wb3ZlcklkID0gbnVsbDtcclxuICAgIExvZ3ouZGVidWcgPSBmYWxzZTtcclxuICAgIExvZ3ouZGFya1RoZW1lID0gdHJ1ZTtcclxuICAgIHRoaXMuYmFzZUNvbmZpZyA9IG5ldyBCYXNlVXRpbCgndHJlZScsIHRoaXMsIHRoaXMub25VcGRhdGVVSSk7XHJcbiAgICBBQ0xVdGlscy5hbm5vdW5jZVZlcnNpb24oKTtcclxuICAgIHRoaXMuX2luc3RhbmNlSWQgPSBFbGVtZW50SWRzLmdlbmVyYXRlSWQodGhpcy5faWRQcmVmaXgpLmlkO1xyXG4gICAgdGhpcy5fYnVzeUlkID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2J1c3lJZFByZWZpeCkuaWQ7XHJcbiAgICB0aGlzLl9pbmZvZ3JhcGhpY3MgPSB7XHJcbiAgICAgIE15SW5mb2dyYXBoaWNzOiB7XHJcbiAgICAgICAgZGF0YUlkOiAyLFxyXG4gICAgICAgIHRhZzogJ3JlcG9ydC1teS1pbmZvZ3JhcGhpY3MnLFxyXG4gICAgICAgIGRhdGE6IHVuZGVmaW5lZCxcclxuICAgICAgfSxcclxuICAgICAgRXNyaUluZm9ncmFwaGljczoge1xyXG4gICAgICAgIGRhdGFJZDogMyxcclxuICAgICAgICB0YWc6ICdyZXBvcnQtZXNyaS1pbmZvZ3JhcGhpY3MnLFxyXG4gICAgICAgIGRhdGE6IHVuZGVmaW5lZCxcclxuICAgICAgfSxcclxuICAgICAgU2hhcmVkSW5mb2dyYXBoaWNzOiB7XHJcbiAgICAgICAgZGF0YUlkOiA0LFxyXG4gICAgICAgIHRhZzogJ3JlcG9ydC1zaGFyZWQtaW5mb2dyYXBoaWNzJyxcclxuICAgICAgICBkYXRhOiB1bmRlZmluZWQsXHJcbiAgICAgIH0sXHJcbiAgICAgIEdhbGxlcnlJbmZvZ3JhcGhpY3M6IHtcclxuICAgICAgICBkYXRhSWQ6IDUsXHJcbiAgICAgICAgdGFnOiAncmVwb3J0LWdhbGxlcnktaW5mb2dyYXBoaWNzJyxcclxuICAgICAgICBkYXRhOiB1bmRlZmluZWQsXHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICB0aGlzLmxhbmdDb2RlID0gJ2VuLXVzJztcclxuICAgIHRoaXMuc291cmNlQ291bnRyeSA9ICdVUyc7XHJcbiAgICB0aGlzLnN0TXVsdGlwbGVDaG9pY2UgPSBmYWxzZTtcclxuICAgIEJhUmVwb3J0c0xhbmd1YWdlLl9pbml0aWFsaXplKHRoaXMubGFuZ0NvZGUpO1xyXG4gIH1cclxuICAvL1xyXG4gIC8vIFVwZGF0ZSBQcm9wcy9TdGF0ZXMgYW5kIGJhc2UgY29uZmlnIHdoZW4gdGhlIGNvbXBvbmVudCBjb25maWcgY2hhbmdlc1xyXG4gIG9uQ29uZmlnQ2hhbmdlKG5ld0NvbmZpZywgb2xkQ29uZmlnKSB7XHJcbiAgICBpZiAoIW5ld0NvbmZpZyB8fCB0eXBlb2YgbmV3Q29uZmlnICE9ICdzdHJpbmcnKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmJhc2VDb25maWcgJiYgQUNMVXRpbHMuaGFzVGV4dChuZXdDb25maWcpKSB7XHJcbiAgICAgIGNvbnN0IG5ld0NmZyA9IEpTT04ucGFyc2UobmV3Q29uZmlnKTtcclxuICAgICAgY29uc3Qgb2xkQ2ZnID0gKG9sZENvbmZpZyAmJiBBQ0xVdGlscy5oYXNUZXh0KG9sZENvbmZpZykpID8gSlNPTi5wYXJzZShvbGRDb25maWcpIDogbnVsbDtcclxuICAgICAgdGhpcy5iYXNlQ29uZmlnLnVwZGF0ZUNvbmZpZyhuZXdDZmcsIG9sZENmZyk7XHJcbiAgICAgIC8vIEZpbHRlciBvdXQgcmVwb3J0cyBub3QgY2hlY2tlZFxyXG4gICAgICAvL1xyXG4gICAgICAvLyBIYW5kbGUgcmVwb3J0TGlzdCB3aGVyZSBpdGVtcyBhcmUgdW5jaGVja2VkIGFuZCB3ZSBkb250IHdhbnQgdG8gc2hvdyB0aGVtXHJcbiAgICAgIGlmICh0aGlzLmJhc2VDb25maWcuY29uZmlnPy5yZXBvcnRMaXN0KSB7XHJcbiAgICAgICAgLy8gY29uZmlnIHJlcG9ydExpc3QgZmlsdGVyZWQgdG8gY29udGFpbiBvbmx5IGNoZWNrZWQgcmVwb3J0c1xyXG4gICAgICAgIGxldCBmaWx0ZXJlZCA9IHt9O1xyXG4gICAgICAgIGNvbnN0IHJhdyA9IHR5cGVvZiAodGhpcy5iYXNlQ29uZmlnLmNvbmZpZy5yZXBvcnRMaXN0KSA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKHRoaXMuYmFzZUNvbmZpZy5jb25maWcucmVwb3J0TGlzdCkgOiB0aGlzLmJhc2VDb25maWcuY29uZmlnLnJlcG9ydExpc3Q7XHJcbiAgICAgICAgY29uc3Qga2V5cyA9IEFDTFV0aWxzLmdldEtleXMocmF3KTtcclxuICAgICAgICBpZiAoa2V5cyAmJiBrZXlzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwga2V5cy5sZW5ndGg7IGsrKykge1xyXG4gICAgICAgICAgICBsZXQgcmVwb3J0cyA9IFtdO1xyXG4gICAgICAgICAgICBjb25zdCBrZXkgPSBrZXlzW2tdO1xyXG4gICAgICAgICAgICBjb25zdCBjYXRlZ29yeSA9IHJhd1trZXldO1xyXG4gICAgICAgICAgICBpZiAoY2F0ZWdvcnkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgIGNhdGVnb3J5LmZvckVhY2goKHIpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyLmlzQ2hlY2tlZCkge1xyXG4gICAgICAgICAgICAgICAgICByZXBvcnRzLnB1c2gocik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHJlcG9ydHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgIGZpbHRlcmVkW2tleV0gPSByZXBvcnRzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHVwZGF0ZSBvdXIgdHJlZSBsaXN0XHJcbiAgICAgICAgdGhpcy5fY29uZmlnRmlsdGVyZWRSZXBvcnRzID0gZmlsdGVyZWQ7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdGhpcy5fY29uZmlnRmlsdGVyZWRSZXBvcnRzID0gdW5kZWZpbmVkO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIC8vIHdhdGNoZXNcclxuICBvbkVudkNoYW5nZWQoKSB7XHJcbiAgICB0aGlzLnN0RW52ID0gdGhpcy5lbnY7XHJcbiAgICBFbnZpcm9ubWVudHMuc2V0RW52aXJvbm1lbnQodGhpcy5lbnYpO1xyXG4gICAgaWYgKHRoaXMuYmFzZUNvbmZpZykge1xyXG4gICAgICAvLyB1cGRhdGVzIGNvbmZpZyBhbmQgc3ViLWNvbXBvbmVudCBjb25maWdzXHJcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy51cGRhdGVDb25maWcoeyBlbnY6IHRoaXMuZW52IH0sIG51bGwpO1xyXG4gICAgfVxyXG4gIH1cclxuICBvbkxhbmdDb2RlQ2hhbmdlZCgpIHtcclxuICAgIHRoaXMuc3RMYW5nQ29kZSA9IHRoaXMubGFuZ0NvZGU7XHJcbiAgICBCYVJlcG9ydHNMYW5ndWFnZS5faW5pdGlhbGl6ZSh0aGlzLnN0TGFuZ0NvZGUpO1xyXG4gICAgaWYgKHRoaXMuYmFzZUNvbmZpZykge1xyXG4gICAgICAvLyB1cGRhdGVzIGNvbmZpZyBhbmQgc3ViLWNvbXBvbmVudCBjb25maWdzXHJcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy51cGRhdGVDb25maWcoeyBsYW5nQ29kZTogdGhpcy5sYW5nQ29kZSB9LCBudWxsKTtcclxuICAgIH1cclxuICB9XHJcbiAgb25Tb3VyY2VDb3VudHJ5Q2hhbmdlZCgpIHtcclxuICAgIHRoaXMuc3RTb3VyY2VDb3VudHJ5ID0gdGhpcy5zb3VyY2VDb3VudHJ5O1xyXG4gICAgaWYgKHRoaXMuYmFzZUNvbmZpZykge1xyXG4gICAgICAvLyB1cGRhdGVzIGNvbmZpZyBhbmQgc3ViLWNvbXBvbmVudCBjb25maWdzXHJcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy51cGRhdGVDb25maWcoeyBzb3VyY2VDb3VudHJ5OiB0aGlzLnNvdXJjZUNvdW50cnkgfSwgbnVsbCk7XHJcbiAgICB9XHJcbiAgICAvLyBDbGVhciBjYWNoZWQgcmVwb3J0cyB3aGVuIGNvdW50cnkgY2hhbmdlc1xyXG4gICAgdGhpcy5fY29uZmlnRmlsdGVyZWRSZXBvcnRzID0gdW5kZWZpbmVkO1xyXG4gICAgdGhpcy5fY2FjaGVkUmVwb3J0cyA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMuc3RSZXBvcnRMaXN0ID0gdW5kZWZpbmVkO1xyXG4gIH1cclxuICBvblRva2VuQ2hhbmdlZCgpIHtcclxuICAgIHRoaXMuc3RUb2tlbiA9IHRoaXMudG9rZW47XHJcbiAgICBpZiAodGhpcy5iYXNlQ29uZmlnKSB7XHJcbiAgICAgIC8vIHVwZGF0ZXMgY29uZmlnIGFuZCBzdWItY29tcG9uZW50IGNvbmZpZ3NcclxuICAgICAgdGhpcy5iYXNlQ29uZmlnLnVwZGF0ZUNvbmZpZyh7IHRva2VuOiB0aGlzLnRva2VuIH0sIG51bGwpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMudXNlcm5hbWUgJiYgQUNMVXRpbHMuaGFzVGV4dCh0aGlzLnVzZXJuYW1lKSAmJiB0aGlzLnRva2VuICYmIEFDTFV0aWxzLmhhc1RleHQodGhpcy50b2tlbikpIHtcclxuICAgICAgc2V0VG9rZW4odGhpcy51c2VybmFtZSwgdGhpcy50b2tlbik7IC8vIHNldCB0aGUgYmEtcmVwb3J0cyB0b2tlblxyXG4gICAgfVxyXG4gIH1cclxuICBvblVzZXJuYW1lQ2hhbmdlZCgpIHtcclxuICAgIHRoaXMuc3RVc2VybmFtZSA9IHRoaXMudXNlcm5hbWU7XHJcbiAgICBpZiAodGhpcy5iYXNlQ29uZmlnKSB7XHJcbiAgICAgIC8vIHVwZGF0ZXMgY29uZmlnIGFuZCBzdWItY29tcG9uZW50IGNvbmZpZ3NcclxuICAgICAgdGhpcy5iYXNlQ29uZmlnLnVwZGF0ZUNvbmZpZyh7IHVzZXJuYW1lOiB0aGlzLnVzZXJuYW1lIH0sIG51bGwpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMudXNlcm5hbWUgJiYgQUNMVXRpbHMuaGFzVGV4dCh0aGlzLnVzZXJuYW1lKSAmJiB0aGlzLnRva2VuICYmIEFDTFV0aWxzLmhhc1RleHQodGhpcy50b2tlbikpIHtcclxuICAgICAgc2V0VG9rZW4odGhpcy51c2VybmFtZSwgdGhpcy50b2tlbik7IC8vIHNldCB0aGUgYmEtcmVwb3J0cyB0b2tlblxyXG4gICAgfVxyXG4gIH1cclxuICBvblNlbGVjdGVkUmVwb3J0Q2hhbmdlZCgpIHtcclxuICAgIHRoaXMuc3RTZWxlY3RlZFJlcG9ydElkID0gdGhpcy5zZWxlY3RlZFJlcG9ydElkO1xyXG4gIH1cclxuICBvblJlcG9ydExpc3RDaGFuZ2VkKCkge1xyXG4gICAgdGhpcy5zdFJlcG9ydExpc3QgPSBPYmplY3Qua2V5cyh0aGlzLnJlcG9ydExpc3QpLmxlbmd0aCA/IEpTT04ucGFyc2UodGhpcy5yZXBvcnRMaXN0KSA6IHt9O1xyXG4gIH1cclxuICBvblRoZW1lQ2hhbmdlZCgpIHtcclxuICAgIHRoaXMuc3RUaGVtZSA9IHRoaXMudGhlbWU7XHJcbiAgICBpZiAodGhpcy5iYXNlQ29uZmlnKSB7XHJcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy5zZXRUaGVtZSh0aGlzLnRoZW1lKTtcclxuICAgIH1cclxuICB9XHJcbiAgb25Qb3J0YWxVcmxDaGFuZ2VkKCkge1xyXG4gICAgLy8gU2V0IGlmIFBvcnRhbFVybCB3YXMgb3B0aW9uYWxseSBwYXNzZWQgaW5cclxuICAgIGlmICh0aGlzLnBvcnRhbFVybCkge1xyXG4gICAgICBFbnZpcm9ubWVudHMuc2V0UG9ydGFsVXJsKHRoaXMucG9ydGFsVXJsKTtcclxuICAgIH1cclxuICB9XHJcbiAgb25HZW9lbnJpY2htZW50VXJsQ2hhbmdlZCgpIHtcclxuICAgIHRoaXMuc3RHZW9lbnJpY2htZW50VXJsID0gdGhpcy5nZW9lbnJpY2htZW50VXJsO1xyXG4gICAgaWYgKHRoaXMuYmFzZUNvbmZpZykge1xyXG4gICAgICAvLyB1cGRhdGVzIGNvbmZpZyBhbmQgc3ViLWNvbXBvbmVudCBjb25maWdzXHJcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy51cGRhdGVDb25maWcoeyBnZW9lbnJpY2htZW50VXJsOiB0aGlzLmdlb2VucmljaG1lbnRVcmwgfSwgbnVsbCk7XHJcbiAgICB9XHJcbiAgICAvLyBTZXQgaWYgR2VvZW5yaWNobWVudFVybCB3YXMgb3B0aW9uYWxseSBwYXNzZWQgaW5cclxuICAgIGlmICh0aGlzLmdlb2VucmljaG1lbnRVcmwpIHtcclxuICAgICAgRW52aXJvbm1lbnRzLnNldEdlb2VucmljaG1lbnRVcmwodGhpcy5nZW9lbnJpY2htZW50VXJsKTtcclxuICAgIH1cclxuICB9XHJcbiAgYXN5bmMgdXBkYXRlTGF5b3V0KCkge1xyXG4gICAgdGhpcy5hZGp1c3RUcmVlSXRlbXNXaWR0aCgpO1xyXG4gIH1cclxuICBhc3luYyBnZXRDb25maWcoKSB7XHJcbiAgICBjb25zdCBteUNmZyA9IHRoaXMuYmFzZUNvbmZpZztcclxuICAgIHJldHVybiBteUNmZztcclxuICB9XHJcbiAgYXN5bmMgaW5pdGlhbGl6ZSh1c2VybmFtZSwgdG9rZW4sIGVudiwgY291bnRyeSwgbGFuZ3VhZ2UsIHJlcG9ydExpc3QpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgc2VsZi50b2tlbiA9IHRva2VuO1xyXG4gICAgc2VsZi51c2VybmFtZSA9IHVzZXJuYW1lO1xyXG4gICAgc2VsZi5zb3VyY2VDb3VudHJ5ID0gY291bnRyeTtcclxuICAgIHNlbGYubGFuZ0NvZGUgPSBsYW5ndWFnZTtcclxuICAgIHNlbGYuZW52ID0gZW52O1xyXG4gICAgc2VsZi5zdFJlcG9ydExpc3QgPSBPYmplY3Qua2V5cyhyZXBvcnRMaXN0KS5sZW5ndGggPyBKU09OLnBhcnNlKHJlcG9ydExpc3QpIDoge307XHJcbiAgICBFbnZpcm9ubWVudHMuc2V0RW52aXJvbm1lbnQoc2VsZi5lbnYpO1xyXG4gICAgLy8gU2V0IGlmIEdlb2VucmljaG1lbnRVcmwgd2FzIG9wdGlvbmFsbHkgcGFzc2VkIGluXHJcbiAgICBpZiAoc2VsZi5nZW9lbnJpY2htZW50VXJsKSB7XHJcbiAgICAgIEVudmlyb25tZW50cy5zZXRHZW9lbnJpY2htZW50VXJsKHNlbGYuZ2VvZW5yaWNobWVudFVybCk7XHJcbiAgICB9XHJcbiAgICAvLyBTZXQgaWYgUG9ydGFsVXJsIHdhcyBvcHRpb25hbGx5IHBhc3NlZCBpblxyXG4gICAgaWYgKHNlbGYucG9ydGFsVXJsKSB7XHJcbiAgICAgIEVudmlyb25tZW50cy5zZXRQb3J0YWxVcmwoc2VsZi5wb3J0YWxVcmwpO1xyXG4gICAgfVxyXG4gICAgc2V0VG9rZW4odXNlcm5hbWUsIHRva2VuKTsgLy8gc2V0IHRoZSBiYS1yZXBvcnRzIHRva2VuXHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgdXNlclJlcG9ydHMsIHB1YmxpY1JlcG9ydHMsIHNoYXJlZFJlcG9ydHMsIGdhbGxlcnlSZXBvcnRzO1xyXG4gICAgICBjb25zdCBpbmZvcyA9IGF3YWl0IGdldEluZm9ncmFwaGljVGVtcGxhdGVzTGlzdChjb3VudHJ5LCBmYWxzZSk7XHJcbiAgICAgIGlmIChPYmplY3Qua2V5cyhzZWxmLnN0UmVwb3J0TGlzdCkubGVuZ3RoKSB7XHJcbiAgICAgICAgdXNlclJlcG9ydHMgPSBzZWxmLnN0UmVwb3J0TGlzdC51c2VyO1xyXG4gICAgICAgIHB1YmxpY1JlcG9ydHMgPSBzZWxmLnN0UmVwb3J0TGlzdC5wdWJsaWM7XHJcbiAgICAgICAgc2hhcmVkUmVwb3J0cyA9IHNlbGYuc3RSZXBvcnRMaXN0LnNoYXJlZDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB1c2VyUmVwb3J0cyA9IGluZm9zLnVzZXIubWFwKHJlcG9ydCA9PiB7IHJldHVybiB7IC4uLnJlcG9ydCwgaXNDaGVja2VkOiB0cnVlIH07IH0pO1xyXG4gICAgICAgIHB1YmxpY1JlcG9ydHMgPSBpbmZvcy5wdWJsaWMubWFwKHJlcG9ydCA9PiB7IHJldHVybiB7IC4uLnJlcG9ydCwgaXNDaGVja2VkOiB0cnVlIH07IH0pO1xyXG4gICAgICAgIHNoYXJlZFJlcG9ydHMgPSBpbmZvcy5zaGFyZWQubWFwKHJlcG9ydCA9PiB7IHJldHVybiB7IC4uLnJlcG9ydCwgaXNDaGVja2VkOiB0cnVlIH07IH0pO1xyXG4gICAgICAgIGdhbGxlcnlSZXBvcnRzID0gaW5mb3MuZ2FsbGVyeS5tYXAocmVwb3J0ID0+IHsgcmV0dXJuIHsgLi4ucmVwb3J0LCBpc0NoZWNrZWQ6IGZhbHNlIH07IH0pO1xyXG4gICAgICAgIHNlbGYuc3RSZXBvcnRMaXN0ID0geyB1c2VyOiB1c2VyUmVwb3J0cywgcHVibGljOiBwdWJsaWNSZXBvcnRzLCBzaGFyZWQ6IHNoYXJlZFJlcG9ydHMsIGdhbGxlcnk6IGdhbGxlcnlSZXBvcnRzIH07XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGluZm9zKSB7XHJcbiAgICAgICAgc2VsZi5faW5mb2dyYXBoaWNzLk15SW5mb2dyYXBoaWNzLmRhdGEgPSB1c2VyUmVwb3J0cztcclxuICAgICAgICBzZWxmLl9pbmZvZ3JhcGhpY3MuRXNyaUluZm9ncmFwaGljcy5kYXRhID0gcHVibGljUmVwb3J0cztcclxuICAgICAgICBzZWxmLl9pbmZvZ3JhcGhpY3MuU2hhcmVkSW5mb2dyYXBoaWNzLmRhdGEgPSBzaGFyZWRSZXBvcnRzO1xyXG4gICAgICAgIHNlbGYuX2luZm9ncmFwaGljcy5HYWxsZXJ5SW5mb2dyYXBoaWNzLmRhdGEgPSBnYWxsZXJ5UmVwb3J0cztcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBzZWxmLl9pbmZvZ3JhcGhpY3MuTXlJbmZvZ3JhcGhpY3MuZGF0YSA9IHVuZGVmaW5lZDtcclxuICAgICAgICBzZWxmLl9pbmZvZ3JhcGhpY3MuRXNyaUluZm9ncmFwaGljcy5kYXRhID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHNlbGYuX2luZm9ncmFwaGljcy5TaGFyZWRJbmZvZ3JhcGhpY3MuZGF0YSA9IHVuZGVmaW5lZDtcclxuICAgICAgICBzZWxmLl9pbmZvZ3JhcGhpY3MuR2FsbGVyeUluZm9ncmFwaGljcy5kYXRhID0gdW5kZWZpbmVkO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuX2lzSW5pdGlhbGl6ZWQgPSB0cnVlO1xyXG4gICAgICBjb25zdCBjb250ZW50ID0gKGgoXCJjYWxjaXRlLXRyZWVcIiwgeyBzY2FsZTogXCJtXCIsIHNlbGVjdGlvbk1vZGU6IFwic2luZ2xlXCIgfSwgc2VsZi5yZW5kZXJMaXN0KCdNeUluZm9ncmFwaGljcycpLCBzZWxmLnJlbmRlckxpc3QoJ0VzcmlJbmZvZ3JhcGhpY3MnKSwgc2VsZi5yZW5kZXJMaXN0KCdTaGFyZWRJbmZvZ3JhcGhpY3MnKSwgc2VsZi5yZW5kZXJMaXN0KCdHYWxsZXJ5SW5mb2dyYXBoaWNzJykpKTtcclxuICAgICAgc2VsZi5fY29udGVudCA9IGNvbnRlbnQ7XHJcbiAgICAgIHNlbGYuc2hvd0J1c3kuY2FsbChzZWxmLCBmYWxzZSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZXgpIHtcclxuICAgICAgTG9nei5zaG93KCclZScsICdhcmNnaXMtaW5mb2dyYXBoaWMtdHJlZSByZXF1ZXN0IGZvciBlc3JpIHJlcG9ydHMgZmFpbGVkJywgZXgpO1xyXG4gICAgfVxyXG4gIH1cclxuICBzZXRMb2NhbGVTdHJpbmdzKCkge1xyXG4gICAgLy8gY29uc29sZS5sb2coXCJzZXRMb2NhbGVTdHJpbmdzKCkgZm9yIGluZm9ncmFwaGljLXRyZWVcIilcclxuICB9XHJcbiAgc2hvd0J1c3koZmxhZykge1xyXG4gICAgY29uc3QgYiA9IEFDTFV0aWxzLnF1ZXJ5RWxlbWVudEJ5SWQuY2FsbCh0aGlzLCB0aGlzLl9idXN5SWQpO1xyXG4gICAgaWYgKGIpIHtcclxuICAgICAgaWYgKGZsYWcpIHtcclxuICAgICAgICBiLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGIuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICBhc3luYyBzZXRDb2xvclRoZW1lKG5hbWUpIHtcclxuICAgIGlmIChuYW1lICYmIEFDTFV0aWxzLmhhc1RleHQobmFtZSkgJiYgdGhpcy5lbCkge1xyXG4gICAgICB0aGlzLnN0Q29sb3JUaGVtZSA9IG5hbWUudHJpbSgpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIGNvbnN0IG4gPSBuYW1lLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICBpZiAobiA9PT0gJ2xpZ2h0Jykge1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1icmFuZCcsICcjMDA3YWMyJyk7XHJcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJyYW5kLWhvdmVyJywgJyMwMDYxOWInKTtcclxuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYnJhbmQtcHJlc3MnLCAnIzAwNDg3NCcpO1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1iYWNrZ3JvdW5kJywgJyNmOGY4ZjgnKTtcclxuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0xJywgJyNmZmZmZmYnKTtcclxuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0yJywgJyNmM2YzZjMnKTtcclxuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0zJywgJyNlYWVhZWEnKTtcclxuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktdGV4dC0xJywgJyMxNTE1MTUnKTtcclxuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktdGV4dC0yJywgJyM0YTRhNGEnKTtcclxuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktdGV4dC0zJywgJyM2YTZhNmEnKTtcclxuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktdGV4dC1pbnZlcnNlJywgJyNmZmZmZmYnKTtcclxuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktdGV4dC1saW5rJywgJyMwMDYxOWInKTtcclxuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYm9yZGVyLTEnLCAnI2NhY2FjYScpO1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1ib3JkZXItMicsICcjZDRkNGQ0Jyk7XHJcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJvcmRlci0zJywgJyNkZmRmZGYnKTtcclxuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYm9yZGVyLWlucHV0JywgJyM5NDk0OTQnKTtcclxuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktaW5mbycsICcjMDA2MTliJyk7XHJcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLXN1Y2Nlc3MnLCAnIzM1YWM0NicpO1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS10cmVlLXBhZGRpbmcteScsICcwJyk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAobiA9PT0gJ2RhcmsnKSB7XHJcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJyYW5kJywgJyMwMDlhZjInKTtcclxuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYnJhbmQtaG92ZXInLCAnIzAwN2FjMicpO1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1icmFuZC1wcmVzcycsICcjMDA2MTliJyk7XHJcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJhY2tncm91bmQnLCAnIzM1MzUzNScpO1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEnLCAnIzJiMmIyYicpO1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTInLCAnIzIwMjAyMCcpO1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTMnLCAnIzE1MTUxNScpO1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS10ZXh0LTEnLCAnI2ZmZmZmZicpO1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS10ZXh0LTInLCAnI2JmYmZiZicpO1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS10ZXh0LTMnLCAnIzlmOWY5ZicpO1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS10ZXh0LWludmVyc2UnLCAnIzE1MTUxNScpO1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS10ZXh0LWxpbmsnLCAnIzAwYTBmZicpO1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1ib3JkZXItMScsICcjNTU1NTU1Jyk7XHJcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJvcmRlci0yJywgJyM0YTRhNGEnKTtcclxuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYm9yZGVyLTMnLCAnIzQwNDA0MCcpO1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1ib3JkZXItaW5wdXQnLCAnIzc1NzU3NScpO1xyXG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1pbmZvJywgJyMwMGEwZmYnKTtcclxuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktc3VjY2VzcycsICcjMzZkYTQzJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgX2xvYWRJbnN0YW5jZXMoKSB7XHJcbiAgICBpZiAoIXRoaXMuX2luc3RhbmNlSWQpXHJcbiAgICAgIHRoaXMuX2luc3RhbmNlSWQgPSBFbGVtZW50SWRzLmdlbmVyYXRlSWQodGhpcy5faWRQcmVmaXgpLmlkO1xyXG4gICAgaWYgKCF0aGlzLl9idXN5SWQpXHJcbiAgICAgIHRoaXMuX2J1c3lJZCA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCh0aGlzLl9pZFByZWZpeEJ1c3kpLmlkO1xyXG4gICAgaWYgKCF0aGlzLl9lbGVtZW50SWRzLmxpc3QpXHJcbiAgICAgIHRoaXMuX2VsZW1lbnRJZHMubGlzdCA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCh0aGlzLl9pZExpc3RQcmVmaXgpLmlkO1xyXG4gICAgaWYgKCF0aGlzLl9lbGVtZW50SWRzLnNlYXJjaClcclxuICAgICAgdGhpcy5fZWxlbWVudElkcy5zZWFyY2ggPSBFbGVtZW50SWRzLmdlbmVyYXRlSWQodGhpcy5faWRTZWFyY2hQcmVmaXgpLmlkO1xyXG4gICAgaWYgKCF0aGlzLl9lbGVtZW50SWRzLnNvcnQpXHJcbiAgICAgIHRoaXMuX2VsZW1lbnRJZHMuc29ydCA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCh0aGlzLl9pZFNvcnRQcmVmaXgpLmlkO1xyXG4gIH1cclxuICAvLyBCYXNlVXRpbCBjb25maWctY2hhbmdlZCByZW5kZXIgY2FsbGJhY2tcclxuICBvblVwZGF0ZVVJKCkge1xyXG4gIH1cclxuICBvbkNsaWNrVHJlZUl0ZW0oZSwgZGF0YSkge1xyXG4gICAgUHJldmlld1BvcHVwLmhpZGVQb3B1cCgpO1xyXG4gICAgdGhpcy5yZXBvcnRTZWxlY3RlZC5lbWl0KHsgcmVwb3J0OiBkYXRhIH0pO1xyXG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbiAgYXBwbHlTb3J0KGxpc3QpIHtcclxuICAgIGlmIChsaXN0ICYmIGxpc3QubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zdCBzb3J0ZWRMaXN0ID0gWy4uLmxpc3RdO1xyXG4gICAgICBsZXQgc29ydFR5cGUgPSB0aGlzLnN0U29ydFR5cGUgfHwgJ25ld2VzdCc7XHJcbiAgICAgIGNvbnN0IGVsZW0gPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwodGhpcywgQUNMVXRpbHMuZml4SWQodGhpcy5fZWxlbWVudElkcy5zb3J0KSk7XHJcbiAgICAgIGlmICh0eXBlb2YgZWxlbSAhPSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgIHNvcnRUeXBlID0gZWxlbS52YWx1ZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoc29ydFR5cGUpIHtcclxuICAgICAgICBzd2l0Y2ggKHNvcnRUeXBlKSB7XHJcbiAgICAgICAgICBjYXNlICgnb2xkZXN0Jyk6IHtcclxuICAgICAgICAgICAgc29ydGVkTGlzdC5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgICAgICAgICAgbGV0IGRhID0gYS5kYXRlO1xyXG4gICAgICAgICAgICAgIGxldCBkYiA9IGIuZGF0ZTtcclxuICAgICAgICAgICAgICByZXR1cm4gZGEgLSBkYjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY2FzZSAoJ2FzY2VuZGluZycpOiB7XHJcbiAgICAgICAgICAgIHNvcnRlZExpc3Quc29ydCgoYSwgYikgPT4ge1xyXG4gICAgICAgICAgICAgIGxldCBzMSA9IGEudGl0bGU7XHJcbiAgICAgICAgICAgICAgbGV0IHMyID0gYi50aXRsZTtcclxuICAgICAgICAgICAgICBpZiAoczEgPCBzMikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAoczEgPiBzMikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjYXNlICgnZGVzY2VuZGluZycpOiB7XHJcbiAgICAgICAgICAgIHNvcnRlZExpc3Quc29ydCgoYSwgYikgPT4ge1xyXG4gICAgICAgICAgICAgIGxldCBzMSA9IGEudGl0bGU7XHJcbiAgICAgICAgICAgICAgbGV0IHMyID0gYi50aXRsZTtcclxuICAgICAgICAgICAgICBpZiAoczEgPiBzMikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAoczEgPCBzMikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgICAgIC8vIG5ld2VzdFxyXG4gICAgICAgICAgICBzb3J0ZWRMaXN0LnNvcnQoKGEsIGIpID0+IHtcclxuICAgICAgICAgICAgICBsZXQgZGEgPSBhLmRhdGU7XHJcbiAgICAgICAgICAgICAgbGV0IGRiID0gYi5kYXRlO1xyXG4gICAgICAgICAgICAgIHJldHVybiBkYiAtIGRhO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBzb3J0ZWRMaXN0O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGxpc3Q7XHJcbiAgfVxyXG4gIC8vIFJldHVybnMgc2VhcmNoLWZpbHRlcmVkIGxpc3QgdGhhdCBpcyBhbHNvIHNvcnRlZFxyXG4gIGdldEZpbHRlcmVkUmVwb3J0TGlzdChuYW1lKSB7XHJcbiAgICBjb25zdCB0cmVlID0gdGhpcztcclxuICAgIGNvbnN0IHNlYXJjaEZpbHRlcmVkTGlzdCA9IFtdO1xyXG4gICAgY29uc3QgbGlzdE5hbWVzID0geyAnTXlJbmZvZ3JhcGhpY3MnOiAndXNlcicsICdFc3JpSW5mb2dyYXBoaWNzJzogJ3B1YmxpYycsICdTaGFyZWRJbmZvZ3JhcGhpY3MnOiAnc2hhcmVkJywgJ0dhbGxlcnlJbmZvZ3JhcGhpY3MnOiAnZ2FsbGVyeScgfTtcclxuICAgIGNvbnN0IG9iak5hbWUgPSBsaXN0TmFtZXNbbmFtZV07XHJcbiAgICBjb25zdCBsaXN0ID0gdGhpcy5fY29uZmlnRmlsdGVyZWRSZXBvcnRzIHx8IHRoaXMuc3RSZXBvcnRMaXN0IHx8IHRoaXMuX2NhY2hlZFJlcG9ydHM7XHJcbiAgICBjb25zdCBkZWZhdWx0TGlzdCA9IGxpc3Rbb2JqTmFtZV07XHJcbiAgICBjb25zdCBzZWFyY2hJbnB1dCA9IHRyZWUuZWwucXVlcnlTZWxlY3RvcignIycgKyB0cmVlLl9lbGVtZW50SWRzLnNlYXJjaCk7XHJcbiAgICBpZiAoc2VhcmNoSW5wdXQpIHtcclxuICAgICAgY29uc3QgcXVlcnkgPSBzZWFyY2hJbnB1dC52YWx1ZS50cmltKCkudG9Mb3dlckNhc2UoKTtcclxuICAgICAgaWYgKHF1ZXJ5ICYmIEFDTFV0aWxzLmhhc1RleHQocXVlcnkpKSB7XHJcbiAgICAgICAgaWYgKGxpc3QgJiYgbGlzdFtvYmpOYW1lXSAmJiBsaXN0W29iak5hbWVdLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGxpc3Rbb2JqTmFtZV0uZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBuID0gaXRlbS50aXRsZTtcclxuICAgICAgICAgICAgaWYgKG4gJiYgQUNMVXRpbHMuaGFzVGV4dChuKSAmJiBuLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocXVlcnkpKSB7XHJcbiAgICAgICAgICAgICAgc2VhcmNoRmlsdGVyZWRMaXN0LnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hcHBseVNvcnQoZGVmYXVsdExpc3QpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMuYXBwbHlTb3J0KGRlZmF1bHRMaXN0KTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmFwcGx5U29ydChzZWFyY2hGaWx0ZXJlZExpc3QpO1xyXG4gIH1cclxuICBvblVwZGF0ZVRodW1ibmFpbFBvcG92ZXJTaXplKCkge1xyXG4gICAgaWYgKCF0aGlzLmVsKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBmdWxsQ29udGVudEh0ID0gMTAwO1xyXG4gICAgY29uc3QgbWluQ29udGVudEh0ID0gMTAwO1xyXG4gICAgY29uc3QgbWluUG9wb3Zlcld0ID0gMjAwO1xyXG4gICAgY29uc3QgbWF4UG9wb3Zlcld0ID0gNzM1O1xyXG4gICAgY29uc3QgdnBhZCA9IDM2O1xyXG4gICAgY29uc3QgaHBhZCA9IDE2O1xyXG4gICAgY29uc3QgY2xpZW50SHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0O1xyXG4gICAgY29uc3QgY2xpZW50V3QgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGg7XHJcbiAgICBjb25zdCBodEFib3ZlID0gdGhpcy5lbC5vZmZzZXRUb3A7XHJcbiAgICBjb25zdCBodEJlbG93ID0gY2xpZW50SHQgLSAodGhpcy5lbC5vZmZzZXRUb3AgKyB0aGlzLmVsLm9mZnNldEhlaWdodCkgKyB3aW5kb3cuc2Nyb2xsWTtcclxuICAgIGxldCBmdWxsQ29udGVudFd0ID0gY2xpZW50V3QgLyAyO1xyXG4gICAgY29uc3QgcmlnaHRTcGFjZSA9IGNsaWVudFd0IC0gdGhpcy5lbC5vZmZzZXRMZWZ0ICsgd2luZG93LnNjcm9sbFg7XHJcbiAgICBpZiAoaHRCZWxvdyA8IG1pbkNvbnRlbnRIdCAmJiBodEJlbG93IDwgaHRBYm92ZSkge1xyXG4gICAgICAvLyBwb3BvdmVyIG1heCBoZWlnaHQgPSBodCBhYm92ZSBpZiB0aGF0IHNwYWNlIGlzIGxhcmdlciB0aGFuIGJlbG93XHJcbiAgICAgIGZ1bGxDb250ZW50SHQgPSBodEFib3ZlIC0gdnBhZDtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBmdWxsQ29udGVudEh0ID0gaHRCZWxvdyAtIHZwYWQ7XHJcbiAgICB9XHJcbiAgICBmdWxsQ29udGVudFd0ID0gTWF0aC5tYXgobWluUG9wb3Zlcld0LCBNYXRoLm1pbihyaWdodFNwYWNlIC0gaHBhZCwgbWF4UG9wb3Zlcld0KSk7XHJcbiAgICBjb25zdCBjb250ZW50RWxlbSA9IEFDTFV0aWxzLnF1ZXJ5RWxlbWVudEJ5SWQuY2FsbCh0aGlzLmVsLCB0aGlzLl9lbGVtZW50SWRzLmNvbnRlbnQpO1xyXG4gICAgaWYgKGNvbnRlbnRFbGVtKSB7XHJcbiAgICAgIGlmIChjb250ZW50RWxlbSkge1xyXG4gICAgICAgIGNvbnRlbnRFbGVtLnN0eWxlLmhlaWdodCA9IGZ1bGxDb250ZW50SHQgKyAncHgnO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBwb3BvdmVyRWxlbSA9IEFDTFV0aWxzLnF1ZXJ5RWxlbWVudEJ5SWQuY2FsbCh0aGlzLmVsLCB0aGlzLl9lbGVtZW50SWRzLnBvcG92ZXIpO1xyXG4gICAgaWYgKHBvcG92ZXJFbGVtKSB7XHJcbiAgICAgIHBvcG92ZXJFbGVtLnN0eWxlLndpZHRoID0gZnVsbENvbnRlbnRXdCArICdweCc7XHJcbiAgICAgIC8vIHBvcG92ZXJFbGVtLnN0eWxlLmxlZnQgPSB0aGlzLmVsLm9mZnNldExlZnQgKyAncHgnXHJcbiAgICB9XHJcbiAgICAvLyBub3RpZnkgdHJlZSB0aGF0IG91ciBzaXplIG1heSBoYXZlIGNoYW5nZWRcclxuICAgIGNvbnN0IHRyZWUgPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwodGhpcy5lbCwgdGhpcy5fZWxlbWVudElkcy5yZXBvcnRzKTtcclxuICAgIGlmICh0cmVlKSB7XHJcbiAgICAgIHRyZWUudXBkYXRlTGF5b3V0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGhhbmRsZU1vdXNlT3ZlcihldiwgcmVwb3J0SWQpIHtcclxuICAgIGNvbnN0IHkgPSBldi5jbGllbnRZO1xyXG4gICAgY29uc3QgaWQgPSByZXBvcnRJZDtcclxuICAgIHRoaXMuX2RlYm91bmNlMigoKSA9PiB7XHJcbiAgICAgIFByZXZpZXdQb3B1cC5oaWRlUG9wdXAoKTtcclxuICAgICAgY29uc3QgaW1nRGF0YSA9IEFyY2dpc0luZm9ncmFwaGljVHJlZS5fZ2V0VGh1bWJuYWlsVXJsKGlkKTtcclxuICAgICAgaWYgKGltZ0RhdGEgJiYgaW1nRGF0YS5pc09rKSB7XHJcbiAgICAgICAgY29uc3QgcG9wb3ZlciA9IHRoaXMuZWwuY2xvc2VzdCgnY2FsY2l0ZS1wb3BvdmVyJyk7XHJcbiAgICAgICAgaWYgKHBvcG92ZXIpIHtcclxuICAgICAgICAgIGNvbnN0IHJyID0gcG9wb3Zlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgIGNvbnN0IGNsaWNrWSA9IHkgLSByci50b3A7XHJcbiAgICAgICAgICBQcmV2aWV3UG9wdXAuc2hvdyhpZCwgcG9wb3ZlciwgY2xpY2tZLCBpbWdEYXRhLnJhdGlvLCBpbWdEYXRhLnVybCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9LCAyMDApO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG4gIGhhbmRsZU1vdXNlT3V0KCkge1xyXG4gICAgdGhpcy5fZGVib3VuY2UyKCgpID0+IHtcclxuICAgICAgUHJldmlld1BvcHVwLmhpZGVQb3B1cCgpO1xyXG4gICAgfSwgMzAwKTtcclxuICB9XHJcbiAgc3RhdGljIF9zZXRUaHVtYm5haWxJbmRleChpZCwgcmF0aW9XMkgsIHVybCwgaXNWYWxpZCkge1xyXG4gICAgQXJjZ2lzSW5mb2dyYXBoaWNUcmVlLlRodW1ibmFpbEluZGV4W2lkXSA9IHsgdXJsOiB1cmwsIHJhdGlvOiByYXRpb1cySCwgaXNPazogaXNWYWxpZCB9O1xyXG4gIH1cclxuICBzdGF0aWMgX2dldFRodW1ibmFpbFVybChpZCkge1xyXG4gICAgcmV0dXJuIEFyY2dpc0luZm9ncmFwaGljVHJlZS5UaHVtYm5haWxJbmRleFtpZF07XHJcbiAgfVxyXG4gIHJlbmRlckxpc3QobmFtZSkge1xyXG4gICAgaWYgKHRoaXMuX2RiZykge1xyXG4gICAgICBjb25zb2xlLmxvZygnJWMgVFJFRSByZW5kZXJMaXN0JywgJ2NvbG9yOm9yYW5nZTtmb250LXNpemU6MTFwdCcsIG5hbWUpO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBjb25zdCB0YWdzID0ge1xyXG4gICAgICAnTXlJbmZvZ3JhcGhpY3MnOiAncmVwb3J0LW15LWluZm9ncmFwaGljcycsXHJcbiAgICAgICdFc3JpSW5mb2dyYXBoaWNzJzogJ3JlcG9ydC1lc3JpLWluZm9ncmFwaGljcycsXHJcbiAgICAgICdTaGFyZWRJbmZvZ3JhcGhpY3MnOiAncmVwb3J0LXNoYXJlZC1pbmZvZ3JhcGhpY3MnLFxyXG4gICAgICAnR2FsbGVyeUluZm9ncmFwaGljcyc6ICdyZXBvcnQtZ2FsbGVyeS1pbmZvZ3JhcGhpY3MnLFxyXG4gICAgICAnTm9QcmV2aWV3QXZhaWxhYmxlJzogJ3ByZXZpZXctbm90LWF2YWlsYWJsZSdcclxuICAgIH07XHJcbiAgICBmdW5jdGlvbiBfZ2V0SW1nSWQoKSB7XHJcbiAgICAgIHJldHVybiBzZWxmLl9pbnN0YW5jZUlkICsgJy0nICsgJ2ltZycgKyBzZWxmLl9pbWdPZmZzZXQrKztcclxuICAgIH1cclxuICAgIC8vIHRoaXMgZnVuY3Rpb24gb3BlcmF0ZXMgYXN5bmNocm9ub3VzbHkgdG8gY2hlY2sgaW1hZ2UgdXJscy4gIFRoZSByZXN1bHRzIGZyb20gcmVxdWVzdGluZ1xyXG4gICAgLy8gYW4gaW1hZ2UgYXJlIGFkZGVkIHRvIHRoZSBUaHVtYm5haWwgSW5kZXggZm9yIGZ1dHVyZSByZWZlcmVuY2VcclxuICAgIGZ1bmN0aW9uIF9jYWNoZVRodW1ibmFpbFVybEFuZERhdGEoaW1nSWQsIGlkLCBwb3BvdmVySWQsIHByZXZJZCwgbmFtZSkge1xyXG4gICAgICBpZiAoQUNMVXRpbHMuaGFzVGV4dChpbWdJZCkgJiYgQUNMVXRpbHMuaGFzVGV4dChpZCkgJiYgQUNMVXRpbHMuaGFzVGV4dChwb3BvdmVySWQpKSB7XHJcbiAgICAgICAgaWYgKHNlbGYuX2RiZykge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJyVjIFRSRUUgX2dldFRodW1ibmFpbCcsICdmb250LXNpemU6MTFwdDtjb2xvcjpvcmFuZ2U7Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGNvbnN0IGltZ0VsZW1lbnRJZCA9IGltZ0lkXHJcbiAgICAgICAgY29uc3QgdGh1bWJuYWlsSWQgPSBpZDtcclxuICAgICAgICBjb25zdCBwb3BJZCA9IHBvcG92ZXJJZDtcclxuICAgICAgICBjb25zdCB0cmVlUHJldklkID0gcHJldklkO1xyXG4gICAgICAgIC8vIEFkZHMgdG9vbHRpcHMgdG8gcHJldmlldyBpdGVtcyB0aGF0IGRvIG5vdCBoYXZlIGEgdmFsaWQgdGh1bWJuYWlsXHJcbiAgICAgICAgZnVuY3Rpb24gX2FkZE5vUHJldmlld1Rvb2x0aXAoaXRlbUlkKSB7XHJcbiAgICAgICAgICBjb25zdCBwb3AgPSBzZWxmLmVsLnF1ZXJ5U2VsZWN0b3IoQUNMVXRpbHMuZml4SWQocG9wSWQpKTtcclxuICAgICAgICAgIGlmIChwb3ApIHtcclxuICAgICAgICAgICAgcG9wLnJlbW92ZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY29uc3QgcHJldkVsZW0gPSBzZWxmLmVsLnF1ZXJ5U2VsZWN0b3IoQUNMVXRpbHMuZml4SWQoaXRlbUlkKSk7XHJcbiAgICAgICAgICBpZiAocHJldkVsZW0pIHtcclxuICAgICAgICAgICAgLy8gYWRkIG5vLXByZXZpZXcgdG9vbHRpcFxyXG4gICAgICAgICAgICBjb25zdCB0aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYWxjaXRlLXRvb2x0aXAnKTtcclxuICAgICAgICAgICAgdGlwLnNldEF0dHJpYnV0ZSgncmVmZXJlbmNlLWVsZW1lbnQnLCBpdGVtSWQpO1xyXG4gICAgICAgICAgICB0aXAuc3R5bGUubWluV2lkdGggPSAnMTYwcHgnO1xyXG4gICAgICAgICAgICB0aXAuc3R5bGUubGVmdCA9ICctNDBweCc7XHJcbiAgICAgICAgICAgIGNvbnN0IHNwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgICAgICAgICBzcC5pbm5lclRleHQgPSBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKHRhZ3MuTm9QcmV2aWV3QXZhaWxhYmxlKTtcclxuICAgICAgICAgICAgdGlwLmFwcGVuZENoaWxkKHNwKTtcclxuICAgICAgICAgICAgcHJldkVsZW0uYXBwZW5kQ2hpbGQodGlwKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gX3VzZUFHT0ZvclRodW1ibmFpbChuYW1lKSB7XHJcbiAgICAgICAgICBpZiAobmFtZSAhPT0gXCJFc3JpSW5mb2dyYXBoaWNzXCIpXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgIGlmIChzZWxmLnBvcnRhbE9ubGluZUdFUHJveHkgJiYgIUVudmlyb25tZW50cy5pc0FHT1BvcnRhbChFbnZpcm9ubWVudHMuZ2V0UG9ydGFsQmFzZSgpKSlcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHVzZSBwcmUtY2FjaGVkIGluZm8gaWYgcG9zc2libGVcclxuICAgICAgICBsZXQgZmV0Y2hJdGVtID0gdHJ1ZTtcclxuICAgICAgICBjb25zdCBpbWdEYXRhID0gQXJjZ2lzSW5mb2dyYXBoaWNUcmVlLl9nZXRUaHVtYm5haWxVcmwoaWQpO1xyXG4gICAgICAgIGlmIChpbWdEYXRhKSB7XHJcbiAgICAgICAgICBpZiAoaW1nRGF0YS5pc09rIHx8IGltZ0RhdGEuaXNPayA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAvLyBhbHJlYWR5IGhhdmUgY2FjaGVkIHJlc3VsdHNcclxuICAgICAgICAgICAgZmV0Y2hJdGVtID0gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGNoZWNrIHNlcnZlciBpZiB0aGUgdGh1bWJuYWlsIGNhbiBiZSB1c2VkXHJcbiAgICAgICAgaWYgKGZldGNoSXRlbSkge1xyXG4gICAgICAgICAgLy8gZGV0ZXJtaW5lIGlmIHRoZSBpbWFnZSB1cmwgaXMgdmFsaWQgb3Igbm90IGJ5IGNyZWF0aW5nIGFuIGltYWdlIGluIG1lbW9yeVxyXG4gICAgICAgICAgLy8gY29uc3QgcCA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgIGxldCB1cmwgPSAnJztcclxuICAgICAgICAgIC8vIElmIHdlIGhhdmUgYSBHRSBPbmxpbmUgcHJveHkgc2V0dXAgYW5kIGFyZSBjb25uZWN0ZWQgdG8gYSBwb3J0YWwgKG5vdCBBR08pLCB3ZSBuZWVkIHRvIHVzZSB3d3cuYXJjZ2lzLmNvbSBmb3IgdGhlIEVzcmkgSW5mb2dyYXBoaWNzIHRodW1ibmFpbHNcclxuICAgICAgICAgIGlmIChfdXNlQUdPRm9yVGh1bWJuYWlsKG5hbWUpKSB7XHJcbiAgICAgICAgICAgIHVybCA9ICdodHRwczovL3d3dy5hcmNnaXMuY29tL3NoYXJpbmcvcmVzdC9jb250ZW50L2l0ZW1zLycgKyB0aHVtYm5haWxJZCArICcvcmVzb3VyY2VzL3RodW1ibmFpbC5wbmcnO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHVybCA9IEVudmlyb25tZW50cy5nZXRQb3J0YWxCYXNlKCkgKyAnL3NoYXJpbmcvcmVzdC9jb250ZW50L2l0ZW1zLycgKyB0aHVtYm5haWxJZCArICcvcmVzb3VyY2VzL3RodW1ibmFpbC5wbmc/dG9rZW49JyArIHNlbGYudG9rZW47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBmdW5jdGlvbiB1cmxJc1ZhbGlkKHBpZCwgdSwgcmlkLCB3dCwgaHQpIHtcclxuICAgICAgICAgICAgLy8gY29uc3QgdzogbnVtYmVyID0gaW1nSW5zdGFuY2Uud2lkdGhcclxuICAgICAgICAgICAgLy8gY29uc3QgaDogbnVtYmVyID0gaW1nSW5zdGFuY2UuaGVpZ2h0XHJcbiAgICAgICAgICAgIC8vIHNhdmUgb3VyIHJlc3VsdHMgaW50byB0aGUgdGh1bWJuYWlsIGluZGV4IHRvIGF2b2lkIHRoaXMgc3RlcCBsYXRlclxyXG4gICAgICAgICAgICBBcmNnaXNJbmZvZ3JhcGhpY1RyZWUuX3NldFRodW1ibmFpbEluZGV4KHJpZCwgKHd0IC8gaHQpLCB1LCB0cnVlKTtcclxuICAgICAgICAgICAgLy8gcmVtb3ZlIHRoZSBuby1wcmV2aWV3IHRvb2x0aXBcclxuICAgICAgICAgICAgY29uc3QgcHJldkVsZW0gPSBzZWxmLmVsLnF1ZXJ5U2VsZWN0b3IoQUNMVXRpbHMuZml4SWQocGlkKSk7XHJcbiAgICAgICAgICAgIGlmIChwcmV2RWxlbSkge1xyXG4gICAgICAgICAgICAgIGNvbnN0IG9sZFRpcCA9IHByZXZFbGVtLnF1ZXJ5U2VsZWN0b3IoJ2NhbGNpdGUtdG9vbHRpcCcpO1xyXG4gICAgICAgICAgICAgIGlmIChvbGRUaXApIHtcclxuICAgICAgICAgICAgICAgIG9sZFRpcC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGZ1bmN0aW9uIHVybEhhZEVycm9yKHBpZCwgdSwgcmlkKSB7XHJcbiAgICAgICAgICAgIEFyY2dpc0luZm9ncmFwaGljVHJlZS5fc2V0VGh1bWJuYWlsSW5kZXgocmlkLCAxLCB1LCBmYWxzZSk7XHJcbiAgICAgICAgICAgIF9hZGROb1ByZXZpZXdUb29sdGlwKHBpZCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuICAgICAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICBjb25zdCBpbWdJbnN0ID0gdGhpcztcclxuICAgICAgICAgICAgICBjb25zdCB3ID0gaW1nSW5zdC53aWR0aDtcclxuICAgICAgICAgICAgICBjb25zdCBoID0gaW1nSW5zdC5oZWlnaHQ7XHJcbiAgICAgICAgICAgICAgdXJsSXNWYWxpZCh0cmVlUHJldklkLCB1cmwsIHRodW1ibmFpbElkLCB3LCBoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgaW1nLm9uZXJyb3IgPSAoKSA9PiB7IHVybEhhZEVycm9yKHRyZWVQcmV2SWQsIHVybCwgdGh1bWJuYWlsSWQpOyB9O1xyXG4gICAgICAgICAgICBpbWcuc3JjID0gdXJsO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgIHVybEhhZEVycm9yKHRyZWVQcmV2SWQsIHVybCwgdGh1bWJuYWlsSWQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgLy8gfSlcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGxldCBleHBhbmRlZCA9IChuYW1lID09PSAnRXNyaUluZm9ncmFwaGljcycpO1xyXG4gICAgY29uc3Qgb3V0ZXJTdHlsZSA9IHtcclxuICAgICAgJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJyxcclxuICAgICAgJ3dpZHRoJzogJzEwMCUnLFxyXG4gICAgICAnaGVpZ2h0JzogJzEwMCUnXHJcbiAgICB9O1xyXG4gICAgLy8gY29uc3Qgbm9QcmV2aWV3U3R5bGUgPSB7XHJcbiAgICAvLyAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsXHJcbiAgICAvLyAgICd0b3AnOiAnMCcsXHJcbiAgICAvLyAgICdsZWZ0JzogJzAnLFxyXG4gICAgLy8gICAnd2lkdGgnOiAnMTAwJScsXHJcbiAgICAvLyAgICdoZWlnaHQnOiAnMTAwJScsXHJcbiAgICAvLyAgICd6SW5kZXgnOiAnNSdcclxuICAgIC8vIH1cclxuICAgIC8vIGNvbnN0IGljb25OYW1lID0gJ2ZpbGUtdGV4dCdcclxuICAgIC8vIGZ1bmN0aW9uIGdldFRodW1ibmFpbFN0eWxlKGlkOiBzdHJpbmcpIHtcclxuICAgIC8vICAgcmV0dXJuIHtcclxuICAgIC8vICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLFxyXG4gICAgLy8gICAgICd0b3AnOiAnMCcsXHJcbiAgICAvLyAgICAgJ2xlZnQnOiAnMCcsXHJcbiAgICAvLyAgICAgJ3dpZHRoJzogJzEwMCUnLFxyXG4gICAgLy8gICAgICdoZWlnaHQnOiAnMTAwJScsXHJcbiAgICAvLyAgICAgJ3pJbmRleCc6ICc2JyxcclxuICAgIC8vICAgICAnYmFja2dyb3VuZEltYWdlJzogJ3VybCgnICsgX2dldFRodW1ibmFpbChpZCkgKyAnKScsXHJcbiAgICAvLyAgICAgJ2JhY2tncm91bmRTaXplJzogJ2F1dG8nXHJcbiAgICAvLyAgIH1cclxuICAgIC8vIH1cclxuICAgIC8vIGNvbnN0IHRodW1ibmFpbERpdiA9IHtcclxuICAgIC8vICAgJ3dpZHRoJzonMTAwJScsXHJcbiAgICAvLyAgICdoZWlnaHQnOicxMDAlJyxcclxuICAgIC8vICAgJ2JhY2tncm91bmRJbWFnZScgOiAndXJsKGh0dHBzOi8vd3d3LmFyY2dpcy5jb20vc2hhcmluZy9yZXN0L2NvbnRlbnQvaXRlbXMvNjk3ODg3MjIwYjlmNDdiOGEyMjM4M2ExYWNkNGYyMDMvcmVzb3VyY2VzL3RodW1ibmFpbC5wbmcpJyxcclxuICAgIC8vICAgJ2JhY2tncm91bmRTaXplJyA6ICdjb250YWluJ1xyXG4gICAgLy8gfVxyXG4gICAgLy8gY29uc3QgcmVwb3J0cyA9IHNlbGYuX2luZm9ncmFwaGljc1tuYW1lXS5kYXRhXHJcbiAgICBjb25zdCByZXBvcnRzID0gc2VsZi5nZXRGaWx0ZXJlZFJlcG9ydExpc3QobmFtZSk7XHJcbiAgICBpZiAocmVwb3J0cyAmJiByZXBvcnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgLy8gbGV0IGFycjogYW55W10gPSByZXBvcnRzLm1hcCgodikgPT4geyByZXR1cm4ge2lkOiB2LmlkLCBuYW1lOiB2LnRpdGxlfX0pXHJcbiAgICAgIGlmIChyZXBvcnRzLmxlbmd0aCA8PSAxNikge1xyXG4gICAgICAgIGV4cGFuZGVkID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBsZXQgZGlzcGxheU5hbWUgPSBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKHRhZ3NbbmFtZV0pO1xyXG4gICAgICBpZiAoZGlzcGxheU5hbWUgPT09ICc/PycpIHtcclxuICAgICAgICBMb2d6LnNob3coJyVlJywgJ01pc3NpbmcgUmVwb3J0IENhdGVnb3J5IG5hbWUnLCB0YWdzW25hbWVdKTtcclxuICAgICAgICBkaXNwbGF5TmFtZSA9IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4odGFnc1tuYW1lXSk7IC8vIHdpdGhvdXQgdGhlIG9wdGlvblxyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGZpbHRlcmVkUmVwb3J0TGlzdCA9IHRoaXMuZ2V0RmlsdGVyZWRSZXBvcnRMaXN0KG5hbWUpO1xyXG4gICAgICBpZiAodGhpcy5fZGJnKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJyVjIFRSRUUgcmVuZGVyTGlzdFsnICsgbmFtZSArICddIGZpbHRlcmVkPScsICdmb250LXNpemU6MTJwdDtjb2xvcjpvcmFuZ2U7JywgZmlsdGVyZWRSZXBvcnRMaXN0KTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIWZpbHRlcmVkUmVwb3J0TGlzdCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBpZiAoQUNMVXRpbHMuaXNEZWYoZmlsdGVyZWRSZXBvcnRMaXN0KSkge1xyXG4gICAgICAgIGxldCBzaG93UmVwb3J0Q2F0ID0gZmFsc2U7XHJcbiAgICAgICAgZmlsdGVyZWRSZXBvcnRMaXN0LmZvckVhY2goKGVsZW1lbnQpID0+IHtcclxuICAgICAgICAgIGlmIChlbGVtZW50LmlzQ2hlY2tlZCkge1xyXG4gICAgICAgICAgICBzaG93UmVwb3J0Q2F0ID0gdHJ1ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBjcmVhdGUgYSB0cmVlIG5vZGUgZm9yIHRoaXMgbGV2ZWwgd2l0aCBhbGwgcmVjb3Jkc1xyXG4gICAgICAgIGlmIChzaG93UmVwb3J0Q2F0KSB7XHJcbiAgICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBzdHlsZTogb3V0ZXJTdHlsZSB9LCBoKFwiY2FsY2l0ZS10cmVlLWl0ZW1cIiwgeyBjbGFzczogXCJyZXBvcnRMaXN0XCIsIHNsb3Q6IFwiY2hpbGRyZW5cIiwgZXhwYW5kZWQ6IGV4cGFuZGVkIH0sIGRpc3BsYXlOYW1lLCByZXBvcnRzLmxlbmd0aCA+IDAgJiYgKGgoXCJjYWxjaXRlLXRyZWVcIiwgeyBzbG90OiBcImNoaWxkcmVuXCIsIGNsYXNzOiBcInJlcG9ydFRyZWVcIiB9LCByZXBvcnRzLm1hcChyZXBvcnQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZmlsdGVyZWRSZXBvcnRMaXN0LnNvbWUob2JqID0+IHsgcmV0dXJuIG9iai5pZCA9PT0gcmVwb3J0LmlkICYmIG9iai5pc0NoZWNrZWQgPT09IHRydWU7IH0pKSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgaXRlbUlkID0gJ3RyZWUtaXRlbS0nICsgcmVwb3J0LmlkO1xyXG4gICAgICAgICAgICAgIGNvbnN0IHByZXZJZCA9IGl0ZW1JZCArICctcHJldic7XHJcbiAgICAgICAgICAgICAgY29uc3QgdGh1bWJuYWlsUG9wSWQgPSBpdGVtSWQgKyAnLXBvcCc7XHJcbiAgICAgICAgICAgICAgY29uc3QgaW1nSWQgPSBfZ2V0SW1nSWQoKTtcclxuICAgICAgICAgICAgICBfY2FjaGVUaHVtYm5haWxVcmxBbmREYXRhKGltZ0lkLCByZXBvcnQuaWQsIHRodW1ibmFpbFBvcElkLCBwcmV2SWQsIG5hbWUpO1xyXG4gICAgICAgICAgICAgIC8vIGNvbnN0IG9uRXJyb3IgPSAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgIC8vICAgY29uc29sZS5sb2coJ0lNRyBFUlJPUicsIGUpXHJcbiAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInJlcG9ydC10cmVlLWRyb3Bkb3duXCIgfSwgaChcImNhbGNpdGUtdHJlZS1pdGVtXCIsIHsgaWQ6IGl0ZW1JZCwgc2VsZWN0ZWQ6IHJlcG9ydC5pZCA9PT0gc2VsZi5zdFNlbGVjdGVkUmVwb3J0SWQgPyB0cnVlIDogZmFsc2UsIGNsYXNzOiBcInJlcG9ydEl0ZW1zXCIsIGRhdGE6IHJlcG9ydC5pZCwgb25DbGljazogKGUpID0+IHNlbGYub25DbGlja1RyZWVJdGVtKGUsIHsgdGh1bWJuYWlsOiB0aHVtYm5haWxQb3BJZCwgaWQ6IHJlcG9ydC5pZCwgbmFtZTogcmVwb3J0LnRpdGxlIH0pIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJyZXBvcnQtaXRlbS1jb250ZW50XCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInJlcG9ydC1pdGVtLXRleHRcIiB9LCByZXBvcnQudGl0bGUpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwicmVwb3J0LWl0ZW0tYnV0dG9uc1wiIH0sIGgoXCJkaXZcIiwgbnVsbCwgaChcImRpdlwiLCB7IGlkOiBwcmV2SWQsIGNsYXNzOiBcInJlcG9ydC1pdGVtLXByZXZpZXdcIiwgb25Nb3VzZU92ZXI6IChlKSA9PiB0aGlzLmhhbmRsZU1vdXNlT3ZlcihlLCByZXBvcnQuaWQpLCBvbk1vdXNlT3V0OiAoKSA9PiB0aGlzLmhhbmRsZU1vdXNlT3V0KCkgfSwgaChcInN2Z1wiLCB7IFwiYXJpYS1oaWRkZW5cIjogXCJ0cnVlXCIsIGNsYXNzOiBcInN2Z1wiLCBmaWxsOiBcImN1cnJlbnRDb2xvclwiLCB2aWV3Qm94OiBcIjAgMCAyNCAyNFwiLCB4bWxuczogXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIH0sIGgoXCJwYXRoXCIsIHsgZDogXCJNMTcgMTZoLTUuNTI1YTUuOTUgNS45NSAwIDAgMC0uMTcyLTFIMTd6bTItN2gtOXYxaDl6bTAgM2gtOXYuNTQ0cS4xOTMuMjIuMzY0LjQ1NkgxOXptMyA4SDExLjgxOGwtLjkxMy0uOTEzYy4wMTQtLjAyOC4wMjMtLjA1OS4wMzctLjA4N0gyMVY3aC00VjNIOHY4LjA1M2E1Ljk0NSA1Ljk0NSAwIDAgMC0xLS4zNTZWMmgxMS40TDIyIDUuNnpNMjEgNS42OUwxOC4zMSAzSDE4djNoM3pNOC45MjYgMTkuMjNsMy4wODUgMy4wODRhLjQ3Ni40NzYgMCAwIDEgMCAuNjc0bC0uMDE3LjAxN2EuNDc2LjQ3NiAwIDAgMS0uNjczIDBMOC4yMzcgMTkuOTJBNC4zODMgNC4zODMgMCAxIDEgOS45IDE2LjVhNC4zNTggNC4zNTggMCAwIDEtLjk3NCAyLjczek01LjUgMTkuOWEzLjQgMy40IDAgMSAwLTMuNC0zLjQgMy40MDQgMy40MDQgMCAwIDAgMy40IDMuNHpcIiB9KSkpKSkpKSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KSkpKSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG4gIH1cclxuICBhc3luYyByZWZyZXNoSW5mb2dyYXBoaWNMaXN0KCkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBsZXQgdXNlclJlcG9ydHMsIHB1YmxpY1JlcG9ydHMsIHNoYXJlZFJlcG9ydHMsIGdhbGxlcnlSZXBvcnRzO1xyXG4gICAgaWYgKHRoaXMuX2RiZykge1xyXG4gICAgICBjb25zb2xlLmxvZygnJWMgVFJFRSByZWZyZXNoSW5mb2dyYXBoaWNMaXN0JywgJ2ZvbnQtc2l6ZToxMnB0O2NvbG9yOm9yYW5nZTsnLCBzZWxmLnN0UmVwb3J0TGlzdCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBsaXN0ID0gdGhpcy5fY29uZmlnRmlsdGVyZWRSZXBvcnRzIHx8IHRoaXMuc3RSZXBvcnRMaXN0IHx8IHRoaXMuX2NhY2hlZFJlcG9ydHM7XHJcbiAgICAvLyBJZiBubyByZXBvcnRzIGNvbmZpZ3VyYXRpb24gaXMgc3BlY2lmaWVkLCBkZWZhdWx0IHRvIE9OTFkgRXNyaSBSZXBvcnRzIChwdWJsaWMpXHJcbiAgICBpZiAodGhpcy5iYXNlQ29uZmlnLmNvbmZpZz8ucmVwb3J0TGlzdCkge1xyXG4gICAgICBjb25zdCByYXcgPSB0eXBlb2YgKHRoaXMuYmFzZUNvbmZpZy5jb25maWcucmVwb3J0TGlzdCkgPT09ICdzdHJpbmcnID8gSlNPTi5wYXJzZSh0aGlzLmJhc2VDb25maWcuY29uZmlnLnJlcG9ydExpc3QpIDogdGhpcy5iYXNlQ29uZmlnLmNvbmZpZy5yZXBvcnRMaXN0O1xyXG4gICAgICBjb25zdCBrZXlzID0gQUNMVXRpbHMuZ2V0S2V5cyhyYXcpO1xyXG4gICAgICBpZiAoa2V5cz8ubGVuZ3RoID09IDApIHtcclxuICAgICAgICBkZWxldGUgbGlzdD8udXNlcjtcclxuICAgICAgICBkZWxldGUgbGlzdD8uc2hhcmVkO1xyXG4gICAgICAgIGRlbGV0ZSBsaXN0Py5nYWxsZXJ5O1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBsZXQgaW5mb3M7XHJcbiAgICBpZiAobGlzdCAmJiBPYmplY3Qua2V5cyhsaXN0KS5sZW5ndGgpIHtcclxuICAgICAgdXNlclJlcG9ydHMgPSBsaXN0LnVzZXI7XHJcbiAgICAgIHB1YmxpY1JlcG9ydHMgPSBsaXN0LnB1YmxpYztcclxuICAgICAgc2hhcmVkUmVwb3J0cyA9IGxpc3Quc2hhcmVkO1xyXG4gICAgICBnYWxsZXJ5UmVwb3J0cyA9IGxpc3QuZ2FsbGVyeTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAvLyBmZXRjaCByZXBvcnRzIGZyb20gc2VydmVyXHJcbiAgICAgIHNlbGYuX2lzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcclxuICAgICAgaW5mb3MgPSBhd2FpdCBnZXRJbmZvZ3JhcGhpY1RlbXBsYXRlc0xpc3Qoc2VsZi5zb3VyY2VDb3VudHJ5LCBmYWxzZSk7XHJcbiAgICAgIHVzZXJSZXBvcnRzID0gaW5mb3MudXNlci5tYXAocmVwb3J0ID0+IHsgcmV0dXJuIHsgLi4ucmVwb3J0LCBpc0NoZWNrZWQ6IHRydWUgfTsgfSk7XHJcbiAgICAgIHB1YmxpY1JlcG9ydHMgPSBpbmZvcy5wdWJsaWMubWFwKHJlcG9ydCA9PiB7IHJldHVybiB7IC4uLnJlcG9ydCwgaXNDaGVja2VkOiB0cnVlIH07IH0pO1xyXG4gICAgICBzaGFyZWRSZXBvcnRzID0gaW5mb3Muc2hhcmVkLm1hcChyZXBvcnQgPT4geyByZXR1cm4geyAuLi5yZXBvcnQsIGlzQ2hlY2tlZDogdHJ1ZSB9OyB9KTtcclxuICAgICAgZ2FsbGVyeVJlcG9ydHMgPSBpbmZvcy5nYWxsZXJ5Lm1hcChyZXBvcnQgPT4geyByZXR1cm4geyAuLi5yZXBvcnQsIGlzQ2hlY2tlZDogdHJ1ZSB9OyB9KTtcclxuICAgICAgdGhpcy5fY29uZmlnRmlsdGVyZWRSZXBvcnRzID0gdW5kZWZpbmVkO1xyXG4gICAgICAvLyBkbyBub3QgdXBkYXRlIHN0UmVwb3J0TGlzdCBoZXJlIG9yIHdlIGhhdmUgZW5kbGVzcyByZW5kZXIgbG9vcFxyXG4gICAgICBzZWxmLl9jYWNoZWRSZXBvcnRzID0geyB1c2VyOiB1c2VyUmVwb3J0cywgcHVibGljOiBwdWJsaWNSZXBvcnRzLCBzaGFyZWQ6IHNoYXJlZFJlcG9ydHMsIGdhbGxlcnk6IGdhbGxlcnlSZXBvcnRzIH07XHJcbiAgICAgIHNlbGYuX2lzSW5pdGlhbGl6ZWQgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKGxpc3QgfHwgaW5mb3MpIHtcclxuICAgICAgc2VsZi5faW5mb2dyYXBoaWNzLk15SW5mb2dyYXBoaWNzLmRhdGEgPSB1c2VyUmVwb3J0cztcclxuICAgICAgc2VsZi5faW5mb2dyYXBoaWNzLkVzcmlJbmZvZ3JhcGhpY3MuZGF0YSA9IHB1YmxpY1JlcG9ydHM7XHJcbiAgICAgIHNlbGYuX2luZm9ncmFwaGljcy5TaGFyZWRJbmZvZ3JhcGhpY3MuZGF0YSA9IHNoYXJlZFJlcG9ydHM7XHJcbiAgICAgIHNlbGYuX2luZm9ncmFwaGljcy5HYWxsZXJ5SW5mb2dyYXBoaWNzLmRhdGEgPSBnYWxsZXJ5UmVwb3J0cztcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBzZWxmLl9pbmZvZ3JhcGhpY3MuTXlJbmZvZ3JhcGhpY3MuZGF0YSA9IHVuZGVmaW5lZDtcclxuICAgICAgc2VsZi5faW5mb2dyYXBoaWNzLkVzcmlJbmZvZ3JhcGhpY3MuZGF0YSA9IHVuZGVmaW5lZDtcclxuICAgICAgc2VsZi5faW5mb2dyYXBoaWNzLlNoYXJlZEluZm9ncmFwaGljcy5kYXRhID0gdW5kZWZpbmVkO1xyXG4gICAgICBzZWxmLl9pbmZvZ3JhcGhpY3MuR2FsbGVyeUluZm9ncmFwaGljcy5kYXRhID0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY29udGVudCA9IChoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2NhbGU6IFwibVwiLCBzZWxlY3Rpb25Nb2RlOiBcInNpbmdsZVwiIH0sIHNlbGYucmVuZGVyTGlzdCgnTXlJbmZvZ3JhcGhpY3MnKSwgc2VsZi5yZW5kZXJMaXN0KCdFc3JpSW5mb2dyYXBoaWNzJyksIHNlbGYucmVuZGVyTGlzdCgnU2hhcmVkSW5mb2dyYXBoaWNzJyksIHNlbGYucmVuZGVyTGlzdCgnR2FsbGVyeUluZm9ncmFwaGljcycpKSk7XHJcbiAgICBzZWxmLl9jb250ZW50ID0gY29udGVudDtcclxuICAgIHNlbGYuYWRqdXN0VHJlZUl0ZW1zV2lkdGgoKTtcclxuICB9XHJcbiAgYXN5bmMgZ2V0TG9jYWxGaWx0ZXJlZEluZm9ncmFwaGljc0xpc3QoKSB7XHJcbiAgfVxyXG4gIC8vIFN0ZW5jaWwgbGlmZWN5Y2xlIC0gY2FsbGVkIG9uY2UgYWZ0ZXIgY29tcG9uZW50IGlzIGZpcnN0IGNvbm5lY3RlZCB0byB0aGUgRE9NXHJcbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGlmIChzZWxmLmVudikge1xyXG4gICAgICBzZWxmLm9uRW52Q2hhbmdlZCgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHNlbGYudG9rZW4pIHtcclxuICAgICAgc2VsZi5vblRva2VuQ2hhbmdlZCgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHNlbGYudXNlcm5hbWUpIHtcclxuICAgICAgc2VsZi5vblVzZXJuYW1lQ2hhbmdlZCgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHNlbGYuc2VsZWN0ZWRSZXBvcnRJZCkge1xyXG4gICAgICBzZWxmLm9uU2VsZWN0ZWRSZXBvcnRDaGFuZ2VkKCk7XHJcbiAgICB9XHJcbiAgICBpZiAoc2VsZi5yZXBvcnRMaXN0KSB7XHJcbiAgICAgIHNlbGYub25SZXBvcnRMaXN0Q2hhbmdlZCgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHNlbGYubGFuZ0NvZGUpIHtcclxuICAgICAgc2VsZi5vbkxhbmdDb2RlQ2hhbmdlZCgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHNlbGYuZ2VvZW5yaWNobWVudFVybCkge1xyXG4gICAgICBzZWxmLm9uR2VvZW5yaWNobWVudFVybENoYW5nZWQoKTtcclxuICAgIH1cclxuICAgIGlmIChzZWxmLnNvdXJjZUNvdW50cnkpIHtcclxuICAgICAgc2VsZi5vblNvdXJjZUNvdW50cnlDaGFuZ2VkKCk7XHJcbiAgICB9XHJcbiAgICBpZiAoc2VsZi5wb3J0YWxVcmwpIHtcclxuICAgICAgc2VsZi5vblBvcnRhbFVybENoYW5nZWQoKTtcclxuICAgIH1cclxuICAgIGlmIChzZWxmLmNvbmZpZykge1xyXG4gICAgICBzZWxmLm9uQ29uZmlnQ2hhbmdlKHNlbGYuY29uZmlnLCAnJyk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy50aGVtZSkge1xyXG4gICAgICB0aGlzLmJhc2VDb25maWcuc2V0VGhlbWUodGhpcy50aGVtZSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgdGhpcy5iYXNlQ29uZmlnLnNldFRoZW1lKCdsaWdodCcpO1xyXG4gICAgfVxyXG4gICAgc2VsZi5fbG9hZEluc3RhbmNlcygpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgc2VsZi5yZWZyZXNoSW5mb2dyYXBoaWNMaXN0KCk7XHJcbiAgICAgIHNlbGYuX2lzSW5pdGlhbGl6ZWQgPSB0cnVlO1xyXG4gICAgICAvLyBUT0RPOiBhdCBzb21lIHBvaW50IHdlIHNob3VsZCBhZGQgYmEtYWNjb3JkaW9uIGFzIGEgc3ViY29tcG9uZW50XHJcbiAgICAgIC8vIHdoZW4gaXQgc3RhcnRzIHVzaW5nIGJhc2VDb25maWdcclxuICAgIH1cclxuICAgIGNhdGNoIChleCkge1xyXG4gICAgICBMb2d6LnNob3coJyVlJywgJ2FyY2dpcy1pbmZvZ3JhcGhpYy10cmVlIHJlcXVlc3QgZm9yIGVzcmkgcmVwb3J0cyBmYWlsZWQnLCBleCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8vIFN0ZW5jaWwgbGlmZWN5Y2xlIC0gY2FsbGVkIGp1c3QgYWZ0ZXIgY29tcG9uZW50IHVwZGF0ZXMsIGJ1dCBub3QgY2FsbGVkIGR1cmluZyBmaXJzdCByZW5kZXIoKVxyXG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgc2VsZi5zaG93QnVzeS5jYWxsKHRoaXMsIGZhbHNlKTtcclxuICAgIGlmIChzZWxmLmJhc2VDb25maWcpIHtcclxuICAgICAgc2VsZi5iYXNlQ29uZmlnLm9uQ29tcG9uZW50SGFzUmVuZGVyZWQoKTtcclxuICAgIH1cclxuICAgIGlmIChzZWxmLl9jYWNoZWRSZXBvcnRzKSB7XHJcbiAgICAgIHNlbGYuc3RSZXBvcnRMaXN0ID0gc2VsZi5fY2FjaGVkUmVwb3J0cztcclxuICAgICAgLy8gY2FjaGVkIHJlcG9ydHMgb25seSB1cGRhdGVzIGluIHJlZnJlc2hJbmZvZ3JhcGhpY0xpc3QoKSBhbmQgcmVzZXRzIGhlcmUgYWZ0ZXIgcmVuZGVyXHJcbiAgICAgIHNlbGYuX2NhY2hlZFJlcG9ydHMgPSB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8vIFN0ZW5jaWwgbGlmZWN5Y2xlIC0gY2FsbGVkIG9uY2UgYWZ0ZXIgY29tcG9uZW50IGlzIGZ1bGx5IGxvYWRlZCBhbmQgMXN0IHJlbmRlciBvY2N1cnJlZFxyXG4gIGNvbXBvbmVudERpZExvYWQoKSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIHNlbGYuX2xvYWRJbnN0YW5jZXMoKTtcclxuICAgIHNlbGYuc2hvd0J1c3kuY2FsbChzZWxmLCBmYWxzZSk7XHJcbiAgICBjb25zdCBzZWFyY2hJbnB1dCA9IHRoaXMuZWwucXVlcnlTZWxlY3RvcignIycgKyB0aGlzLl9lbGVtZW50SWRzLnNlYXJjaCk7XHJcbiAgICBmdW5jdGlvbiBfb25SZXNpemUoKSB7XHJcbiAgICAgIHNlbGYuYWRqdXN0VHJlZUl0ZW1zV2lkdGgoKTtcclxuICAgIH1cclxuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCBfb25SZXNpemUpO1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIF9vblJlc2l6ZSk7XHJcbiAgICBzZWxmLmFkanVzdFRyZWVJdGVtc1dpZHRoKCk7XHJcbiAgICBjb25zdCBvbkNsaWNrSXRlbU1ha2VEZWZhdWx0ID0gKGUpID0+IHtcclxuICAgICAgY29uc3QgaXRlbSA9IGUuY3VycmVudFRhcmdldC5jbG9zZXN0KCdjYWxjaXRlLXRyZWUtaXRlbScpO1xyXG4gICAgICBpZiAoaXRlbSkge1xyXG4gICAgICAgIGNvbnN0IGl0ZW1JZCA9IGl0ZW0uaWQ7XHJcbiAgICAgICAgY29uc3QgcmVwb3J0SWQgPSBpdGVtSWQuc3Vic3RyaW5nKDEwKTtcclxuICAgICAgICBpZiAoQUNMVXRpbHMuaGFzVGV4dChyZXBvcnRJZCkpIHtcclxuICAgICAgICAgIHNlbGYuc2VsZWN0ZWRSZXBvcnRJZCA9IHJlcG9ydElkO1xyXG4gICAgICAgICAgc2VsZi5vblNlbGVjdGVkUmVwb3J0Q2hhbmdlZCgpO1xyXG4gICAgICAgICAgbGV0IG4gPSAnJztcclxuICAgICAgICAgIGNvbnN0IHRleHRFbGVtID0gaXRlbS5xdWVyeVNlbGVjdG9yKCdkaXYucmVwb3J0LWl0ZW0tdGV4dCcpO1xyXG4gICAgICAgICAgaWYgKHRleHRFbGVtKSB7XHJcbiAgICAgICAgICAgIG4gPSB0ZXh0RWxlbS5pbm5lclRleHQ7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBzZWxmLm9uQ2xpY2tUcmVlSXRlbShlLCB7IGlkOiByZXBvcnRJZCwgbmFtZTogbiB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICAvLyBpdGVtICdtYWtlIGRlZmF1bHQnIGNsaWNrIGhhbmRsZXJcclxuICAgIGNvbnN0IGl0ZW1zID0gQUNMVXRpbHMucXVlcnlFbGVtZW50QWxsLmNhbGwoc2VsZiwgJ2Rpdi5kZWZhdWx0LXBvcG92ZXItY29udGVudCcpO1xyXG4gICAgaWYgKCFpdGVtcyB8fCBpdGVtcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAobGV0IGlpID0gMDsgaWkgPCBpdGVtcy5sZW5ndGg7IGlpKyspIHtcclxuICAgICAgICBpdGVtc1tpaV0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsaWNrSXRlbU1ha2VEZWZhdWx0KTtcclxuICAgICAgICBpdGVtc1tpaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsaWNrSXRlbU1ha2VEZWZhdWx0KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gY2FsbGVkIHdoZW4gdGhlIHRyZWUgc2VhcmNoIHRleHQgY2hhbmdlc1xyXG4gICAgY29uc3Qgb25TZWFyY2hRdWVyeUNoYW5nZWQgPSAoKSA9PiB7XHJcbiAgICAgIHNlbGYuX2RlYm91bmNlMigoKSA9PiB7XHJcbiAgICAgICAgLy9zZWxmLnJlZnJlc2hJbmZvZ3JhcGhpY0xpc3QuY2FsbChzZWxmKVxyXG4gICAgICAgIHNlbGYuc3RUaW1lc3RhbXAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgfSwgNTAwKTtcclxuICAgIH07XHJcbiAgICBjb25zdCBzb3J0RWxlbSA9IEFDTFV0aWxzLnF1ZXJ5RWxlbWVudEJ5SWQuY2FsbChzZWxmLCBBQ0xVdGlscy5maXhJZChzZWxmLl9lbGVtZW50SWRzLnNvcnQpKTtcclxuICAgIGlmIChzb3J0RWxlbSkge1xyXG4gICAgICBzb3J0RWxlbS5hZGRFdmVudExpc3RlbmVyKCdjYWxjaXRlU2VsZWN0Q2hhbmdlJywgKCkgPT4ge1xyXG4gICAgICAgIHNlbGYuc3RTb3J0VHlwZSA9IHNvcnRFbGVtLnZhbHVlO1xyXG4gICAgICAgIC8vc2VsZi5yZWZyZXNoSW5mb2dyYXBoaWNMaXN0KClcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAoc2VhcmNoSW5wdXQpIHtcclxuICAgICAgc2VhcmNoSW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvblNlYXJjaFF1ZXJ5Q2hhbmdlZCk7XHJcbiAgICAgIHNlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25TZWFyY2hRdWVyeUNoYW5nZWQpO1xyXG4gICAgICBzZWFyY2hJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjYWxjaXRlSW5wdXRDaGFuZ2UnLCBvblNlYXJjaFF1ZXJ5Q2hhbmdlZCk7XHJcbiAgICB9XHJcbiAgICBzZWxmLmFkanVzdFRyZWVJdGVtc1dpZHRoKCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIEZpbHRlcnMgb3V0IG11bHRpcGxlIHJhcGlkIGV2ZW50cyBvZiB0aGUgc2FtZSB0eXBlLiAgVGhlIGNhbGxiYWNrXHJcbiAgICogZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgaWYgbm8gbmV3IGV2ZW50cyBoYXZlIGhhcHBlbmVkIGR1cmluZyB0aGVcclxuICAgKiAnd2FpdCcgdGltZS5cclxuICAgKiBAcGFyYW0gY2FsbGJhY2sgLSB5b3VyIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGUgZXZlbnRzIGhhdmUgc2V0dGxlZFxyXG4gICAqIEBwYXJhbSB3YWl0ICAgICAtIG1pbGxpc2Vjb25kcyBkZWxheSAoZXg6IDI1MClcclxuICAgKi9cclxuICBfZGVib3VuY2UyKGNhbGxiYWNrLCB3YWl0KSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGNvbnN0IGRlbGF5ZWRDYWxsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICBzZWxmLl9kZWJvdW5jZVRpbWVyID0gbnVsbDtcclxuICAgICAgY2FsbGJhY2suYXBwbHkoc2VsZik7XHJcbiAgICB9O1xyXG4gICAgLy8gZXZlcnl0aW1lIF9kZWJvdW5jZTIgaXMgY2FsbGVkIHdlIGtpbGwgdGhlIHByZXZpb3VzIHRpbWVyXHJcbiAgICBpZiAoc2VsZi5fZGVib3VuY2VUaW1lcilcclxuICAgICAgY2xlYXJUaW1lb3V0KHNlbGYuX2RlYm91bmNlVGltZXIpO1xyXG4gICAgc2VsZi5fZGVib3VuY2VUaW1lciA9IHNldFRpbWVvdXQoZGVsYXllZENhbGwsIHdhaXQpO1xyXG4gIH1cclxuICBhZGp1c3RUcmVlSXRlbXNXaWR0aCgpIHtcclxuICAgIGlmICh0aGlzLmVsKSB7XHJcbiAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yQWxsKCdkaXYucmVwb3J0LWl0ZW0tY29udGVudCcpO1xyXG4gICAgICBpZiAoIWl0ZW1zIHx8IGl0ZW1zLmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHAgPSBpdGVtc1swXS5jbG9zZXN0KCcucmVwb3J0TGlzdCcpO1xyXG4gICAgICBpZiAocCkge1xyXG4gICAgICAgIGNvbnN0IHd0ID0gcC5vZmZzZXRXaWR0aDtcclxuICAgICAgICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICBpdGVtLnN0eWxlLndpZHRoID0gKHd0IC0gNjApICsgJ3B4JztcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gYWRqdXN0IGluZm9ncmFwaGljIHByZXZpZXcgc2l6ZVxyXG4gICAgY29uc3QgcG9wID0gdGhpcy5lbC5wYXJlbnRFbGVtZW50Py5wYXJlbnRFbGVtZW50O1xyXG4gICAgY29uc3Qgc1d0ID0gcG9wPy5zdHlsZT8ud2lkdGg7XHJcbiAgICBpZiAoc1d0ICYmIEFDTFV0aWxzLmhhc1RleHQoc1d0KSkge1xyXG4gICAgICBjb25zdCB3dCA9IHBhcnNlSW50KHNXdCk7XHJcbiAgICAgIGlmICghTnVtYmVyLmlzTmFOKHd0KSkge1xyXG4gICAgICAgIGNvbnN0IGFkanVzdGVkV2lkdGggPSB3dCAqIDAuOTtcclxuICAgICAgICBpZiAoYWRqdXN0ZWRXaWR0aCA+IDMwMCkge1xyXG4gICAgICAgICAgLy8gYXBwbHkgbmV3IHdpZHRoXHJcbiAgICAgICAgICBjb25zdCBwb3BzID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yQWxsKCdpbWcudGh1bWJuYWlsLXByZXZpZXcnKTtcclxuICAgICAgICAgIGlmIChwb3BzKSB7XHJcbiAgICAgICAgICAgIHBvcHMuZm9yRWFjaCgodCkgPT4ge1xyXG4gICAgICAgICAgICAgIHQuc3R5bGUubWF4V2lkdGggPSBhZGp1c3RlZFdpZHRoICsgJ3B4JztcclxuICAgICAgICAgICAgICB0LnN0eWxlLm1heEhlaWdodCA9IChhZGp1c3RlZFdpZHRoICogMC42NikgKyAncHgnO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgcmVuZGVyKCkge1xyXG4gICAgY29uc3Qgb3V0ZXJEaXZTdHlsZSA9IHtcclxuICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJyxcclxuICAgICAgJ3dpZHRoJzogJ2NhbGMoMTAwJSAtIDEycHgpJyxcclxuICAgICAgJ2hlaWdodCc6ICdjYWxjKDEwMCUgLSA4cHgpJyxcclxuICAgICAgJ292ZXJmbG93LXgnOiAnaGlkZGVuJyxcclxuICAgICAgJ292ZXJmbG93LXknOiAnc2Nyb2xsJ1xyXG4gICAgfTtcclxuICAgIGNvbnN0IHBsYWNlVGV4dCA9IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ3NlYXJjaC1pbmZvcy1ieS1uYW1lJyk7XHJcbiAgICBjb25zdCBzb3J0TmV3ZXN0ID0gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignZGF0ZS1zb3J0LW5ld2VzdCcpO1xyXG4gICAgY29uc3Qgc29ydE9sZGVzdCA9IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2RhdGUtc29ydC1vbGRlc3QnKTtcclxuICAgIGNvbnN0IG5hbWVBc2MgPSBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCduYW1lLXNvcnQtYXNjJyk7XHJcbiAgICBjb25zdCBuYW1lRGVzYyA9IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ25hbWUtc29ydC1kZXNjJyk7XHJcbiAgICB0aGlzLnJlZnJlc2hJbmZvZ3JhcGhpY0xpc3QoKTtcclxuICAgIC8vIFJlbmRlciBqdXN0IHRoZSBvdXRlciBkaXYgYW5kIGJ1c3kgc3Bpbm5lciB1bnRpbCB0aGUgY29tcG9uZW50XHJcbiAgICAvLyBpbml0aWFsaXplKCkgZnVuY3Rpb24gaXMgY2FsbGVkIC0gYW5kIHRoZSBpbmZvZ3JhcGhpYyBkYXRhIGlzXHJcbiAgICAvLyByZWNlaXZlZC4gIFRoZSBjb250ZW50IGlzIGFkZGVkIGluIHRoZSBpbml0aWFsaXplKCkgZnVuY3Rpb24uXHJcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBpZDogdGhpcy5faW5zdGFuY2VJZCwgc3R5bGU6IG91dGVyRGl2U3R5bGUsIGNsYXNzOiBcImFyY2dpcy10cmVlLW91dGVyXCIgfSwgaChcImRpdlwiLCB7IGlkOiB0aGlzLl9idXN5SWQsIGNsYXNzOiBcImluZm9ncmFwaGljLXRyZWUtYnVzeVwiIH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaW5mby10cmVlLXNlYXJjaC1kaXZcIiB9LCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IGNsZWFyYWJsZTogXCJ0cnVlXCIsIGlkOiB0aGlzLl9lbGVtZW50SWRzLnNlYXJjaCwgcGxhY2Vob2xkZXI6IHBsYWNlVGV4dCwgY2xhc3M6IFwiaW5mby10cmVlLXNlYXJjaFwiIH0pLCBoKFwiZGl2XCIsIHsgaWQ6IHRoaXMuX2VsZW1lbnRJZHMuaWNvbiwgY2xhc3M6IFwiaW5mby10cmVlLWljb25cIiB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6ICdsJywgaWNvbjogJ3NlYXJjaCcgfSkpKSwgaChcImNhbGNpdGUtc2VsZWN0XCIsIHsgaWQ6IHRoaXMuX2VsZW1lbnRJZHMuc29ydCwgY2xhc3M6IFwiaW5mby10cmVlLXNvcnRcIiB9LCBoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyB2YWx1ZTogXCJuZXdlc3RcIiB9LCBzb3J0TmV3ZXN0KSwgaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IFwib2xkZXN0XCIgfSwgc29ydE9sZGVzdCksIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBcImFzY2VuZGluZ1wiIH0sIG5hbWVBc2MpLCBoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyB2YWx1ZTogXCJkZXNjZW5kaW5nXCIgfSwgbmFtZURlc2MpKSwgaChcImRpdlwiLCB7IGlkOiB0aGlzLl9lbGVtZW50SWRzLmxpc3QsIGNsYXNzOiBcImluZm8tdHJlZS1saXN0XCIgfSwgaChcImRpdlwiLCBudWxsLCB0aGlzLl9jb250ZW50KSkpKTtcclxuICB9XHJcbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxyXG4gIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XHJcbiAgICBcImNvbmZpZ1wiOiBbXCJvbkNvbmZpZ0NoYW5nZVwiXSxcclxuICAgIFwiZW52XCI6IFtcIm9uRW52Q2hhbmdlZFwiXSxcclxuICAgIFwibGFuZ0NvZGVcIjogW1wib25MYW5nQ29kZUNoYW5nZWRcIl0sXHJcbiAgICBcInNvdXJjZUNvdW50cnlcIjogW1wib25Tb3VyY2VDb3VudHJ5Q2hhbmdlZFwiXSxcclxuICAgIFwidG9rZW5cIjogW1wib25Ub2tlbkNoYW5nZWRcIl0sXHJcbiAgICBcInVzZXJuYW1lXCI6IFtcIm9uVXNlcm5hbWVDaGFuZ2VkXCJdLFxyXG4gICAgXCJzZWxlY3RlZFJlcG9ydElkXCI6IFtcIm9uU2VsZWN0ZWRSZXBvcnRDaGFuZ2VkXCJdLFxyXG4gICAgXCJyZXBvcnRMaXN0XCI6IFtcIm9uUmVwb3J0TGlzdENoYW5nZWRcIl0sXHJcbiAgICBcInRoZW1lXCI6IFtcIm9uVGhlbWVDaGFuZ2VkXCJdLFxyXG4gICAgXCJwb3J0YWxVcmxcIjogW1wib25Qb3J0YWxVcmxDaGFuZ2VkXCJdLFxyXG4gICAgXCJnZW9lbnJpY2htZW50VXJsXCI6IFtcIm9uR2VvZW5yaWNobWVudFVybENoYW5nZWRcIl1cclxuICB9OyB9XHJcbn07XHJcbkFyY2dpc0luZm9ncmFwaGljVHJlZS5UaHVtYm5haWxJbmRleCA9IHt9O1xyXG5BcmNnaXNJbmZvZ3JhcGhpY1RyZWUuc3R5bGUgPSBhcmNnaXNJbmZvZ3JhcGhpY1RyZWVDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc0luZm9ncmFwaGljVHJlZSBhcyBBIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1pbmZvZ3JhcGhpYy10cmVlLTU3ZWFiZjJjLmpzLm1hcCIsImltcG9ydCB7IEcgYXMgR0VDbGllbnQsIFQgYXMgVG9rZW5Qcm92aWRlciB9IGZyb20gJy4vR0VDbGllbnQtZjcxMDQ5ZjguanMnO1xuaW1wb3J0IHsgQiBhcyBCYVJlcG9ydHNMYW5ndWFnZSB9IGZyb20gJy4vRWxlbWVudElkcy1hMmM0MDU5Mi5qcyc7XG5cbmZ1bmN0aW9uIHNldFRva2VuKHVzZXJuYW1lLCB0b2tlbikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBpZiAodXNlcm5hbWUgIT0gbnVsbCAmJiB1c2VybmFtZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGlmICh0b2tlbiAhPSBudWxsICYmIHRva2VuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIFRva2VuUHJvdmlkZXIuc2V0VG9rZW4odXNlcm5hbWUsIHRva2VuKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdvaycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2ludmFsaWQtdG9rZW4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2ludmFsaWQtdXNlcm5hbWUnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZXgpIHtcclxuICAgICAgICByZXR1cm4gZXg7XHJcbiAgICB9XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gZ2V0SW5mb2dyYXBoaWNUZW1wbGF0ZXNMaXN0KGNvdW50cnlDb2RlLCBmdWxsID0gZmFsc2UpIHtcclxuICAgIHJldHVybiBhd2FpdCBHRUNsaWVudC5nZXRJbmZvZ3JhcGhpY1RlbXBsYXRlc0xpc3QoY291bnRyeUNvZGUsIGZ1bGwpO1xyXG59XG5cbmV4cG9ydCB7IGdldEluZm9ncmFwaGljVGVtcGxhdGVzTGlzdCBhcyBnLCBzZXRUb2tlbiBhcyBzIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpc1JlcG9ydHMtMGMzNTFmMGEuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9