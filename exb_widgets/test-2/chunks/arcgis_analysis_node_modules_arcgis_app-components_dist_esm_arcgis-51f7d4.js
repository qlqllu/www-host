"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-51f7d4"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-group-browser_16.entry.js":
/*!**************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-group-browser_16.entry.js ***!
  \**************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_group_browser: () => (/* binding */ ArcgisGroupBrowser),
/* harmony export */   arcgis_group_browser_actions: () => (/* binding */ ArcgisGroupBrowserActions),
/* harmony export */   arcgis_group_browser_content: () => (/* binding */ ArcgisGroupBrowserContent),
/* harmony export */   arcgis_group_browser_filter_date: () => (/* binding */ ArcgisGroupBrowserFilterDate),
/* harmony export */   arcgis_group_browser_filter_groups_by_user: () => (/* binding */ ArcgisGroupBrowserFilterGroupsByUser),
/* harmony export */   arcgis_group_browser_filter_member_org: () => (/* binding */ ArcgisGroupBrowserFilterMemberOrg),
/* harmony export */   arcgis_group_browser_filter_membership: () => (/* binding */ ArcgisGroupBrowserFilterMembership),
/* harmony export */   arcgis_group_browser_filter_owner: () => (/* binding */ ArcgisGroupBrowserFilterOwner),
/* harmony export */   arcgis_group_browser_filter_special_groups: () => (/* binding */ ArcgisGroupBrowserFilterSpecialGroups),
/* harmony export */   arcgis_group_browser_filters: () => (/* binding */ ArcgisGroupBrowserFilters),
/* harmony export */   arcgis_group_browser_pagination: () => (/* binding */ ArcgisGroupBrowserPagination),
/* harmony export */   arcgis_group_browser_preview: () => (/* binding */ ArcgisGroupBrowserPreview),
/* harmony export */   arcgis_group_browser_preview_card: () => (/* binding */ ArcgisGroupBrowserPreviewCard),
/* harmony export */   arcgis_group_browser_search: () => (/* binding */ ArcgisGroupBrowserSearch),
/* harmony export */   arcgis_group_browser_sort: () => (/* binding */ ArcgisGroupBrowserSort),
/* harmony export */   arcgis_group_browser_top_bar: () => (/* binding */ ArcgisGroupBrowserTopBar)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./resize-55d3c55c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/resize-55d3c55c.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./query-4f7b7e4d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-4f7b7e4d.js");
/* harmony import */ var _store_6ec1e1e1_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./store-6ec1e1e1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-6ec1e1e1.js");
/* harmony import */ var _store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./store-ff04ba0a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-ff04ba0a.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _portal_8714dc6c_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./portal-8714dc6c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-8714dc6c.js");
/* harmony import */ var _user_ba12ebd6_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./user-ba12ebd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-ba12ebd6.js");
/* harmony import */ var _items_69346131_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./items-69346131.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/items-69346131.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _utils_b22dfe9c_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./utils-b22dfe9c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-b22dfe9c.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./user-e3dedc4a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js");
/* harmony import */ var _api_f7934cd7_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./api-f7934cd7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-f7934cd7.js");
/* harmony import */ var _server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./server-item-f12153e6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js");
/* harmony import */ var _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./item-properties-e6412a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./functional-9f648bee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-9f648bee.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/* harmony import */ var _item_d9d70416_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./item-d9d70416.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-d9d70416.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




























async function queryGroups(portal, query) {
  const restBase = (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_7__.g)(portal);
  const url = `${restBase}community/groups`;
  const { num, start, sortOrder, sortField, filters, baseQuery, searchTerm, searchUser } = query;
  const filterIds = Object.keys(filters || {});
  const term = searchTerm ? `(${(0,_query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_8__.c)(searchTerm)}) ` : "";
  const baseParams = Object.assign(Object.assign({}, (searchUser ? { searchUserAccess: "groupMember", searchUserName: searchUser } : {})), { q: `${baseQuery || ""} ${term}` });
  const queryParams = filterIds.reduce((params, key) => {
    const { param, value } = filters[key];
    return Object.assign(Object.assign({}, params), { [param]: `${params[param] || ""} ${value}` });
  }, baseParams);
  const params = Object.assign({ num,
    start,
    sortField,
    sortOrder }, (queryParams || {}));
  const hasActiveQuery = Object.entries(queryParams).some(([_key, value]) => typeof value !== "string" || !!(value === null || value === void 0 ? void 0 : value.trim()));
  if (!hasActiveQuery) {
    // the group search endpoint will throw an error with no search parameters, so treat as an empty result set
    return {
      nextStart: -1,
      num: 0,
      results: [],
      start: 0,
      total: 0
    };
  }
  const response = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_7__.r)(url, params);
  return Object.assign(Object.assign({}, response), { q: queryParams.q, queryParams: params });
}
async function queryGroupContent(portal, groupId, params = {}) {
  const restBase = (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_7__.g)(portal);
  const url = `${restBase}content/groups/${groupId}/search`;
  const defaultParams = {
    num: 4,
    start: 0,
    sortField: "modified",
    sortOrder: "desc"
  };
  const response = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_7__.r)(url, Object.assign(Object.assign({}, defaultParams), params));
  return response;
}
async function queryFeaturedContent(portal, groupId, featured, limit = 4) {
  const restBase = (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_7__.g)(portal);
  const url = `${restBase}content/groups/${groupId}/search`;
  const params = {
    num: limit,
    start: 0,
    q: `id:(${featured.slice(0, limit).join(" OR ")})`
  };
  const response = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_7__.r)(url, params);
  // results will be returned in a "relevance" order, we want them in the requested order
  // not all featured items will be available to all users so also filter out ones that were not returned
  if (response.total) {
    const newResults = featured
      .map((id) => {
      return response.results.find((item) => item.id === id);
    })
      .filter(Boolean);
    response.results = newResults;
  }
  return response;
}

const arcgisGroupBrowserCss = ":host{position:relative;background-color:var(--calcite-ui-background);display:flex;flex-direction:column;height:100%;overflow-y:auto;overflow-x:hidden;--group-browser-max-width:100%;--group-browser-pane-width:18.75rem;--group-browser-pane-z-index:11;--group-browser-top-bar-background:var(--calcite-ui-foreground-1)}arcgis-browser{--arcgis-browser-max-width:var(--group-browser-max-width);--arcgis-browser-pane-width:var(--group-browser-pane-width);--arcgis-browser-pane-z-index:var(--group-browser-pane-z-index);--arcgis-browser-top-bar-background:var(--group-browser-top-bar-background)}@media screen and (max-width: 640px){:host{--group-browser-pane-width:100%}}";

const ArcgisGroupBrowser = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisGroupBrowserUpdate = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserUpdate", 7);
    this.arcgisGroupBrowserLoading = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserLoading", 7);
    this.arcgisGroupBrowserSelect = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserSelect", 7);
    this.arcgisGroupBrowserPreview = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserPreview", 7);
    this.arcgisGroupBrowserSublayerPreview = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserSublayerPreview", 7);
    this.arcgisGroupBrowserInternalUIAction = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserInternalUIAction", 7);
    this.liveRegionUpdate = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "liveRegionUpdate", 7);
    this.allowFetch = false;
    this.currentResults = [];
    this.updateFiltersEmpty = () => {
      var _a;
      this.store.state.filtersEmpty = !((_a = this.el) === null || _a === void 0 ? void 0 : _a.querySelector(`[slot="filters"]`));
    };
    this.updateTopbarEmpty = () => {
      var _a;
      this.store.state.topbarEmpty = !((_a = this.el) === null || _a === void 0 ? void 0 : _a.querySelector(`[slot="top-bar"]`));
    };
    this.updateSortEmpty = () => {
      var _a;
      this.store.state.sortEmpty = !((_a = this.el) === null || _a === void 0 ? void 0 : _a.querySelector(`[slot="sort"]`));
    };
    this.filterMutationObserver = new MutationObserver(this.updateFiltersEmpty);
    this.topbarMutationObserver = new MutationObserver(this.updateTopbarEmpty);
    this.sortMutationObserver = new MutationObserver(this.updateSortEmpty);
    this.fetchGroups = (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_4__.d)(async () => {
      this.loading = true;
      this.currentResults = [];
      this.arcgisGroupBrowserLoading.emit();
      this.store.state.preview = null;
      if (!this.portal || !this.allowFetch) {
        return;
      }
      let query = this.getQuery();
      if (this.preflight) {
        query = await this.preflight(query);
      }
      const response = await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_4__.m)(this.queryGroups(query), 500);
      this.arcgisGroupBrowserUpdate.emit(Object.assign(Object.assign(Object.assign({}, response), { selectedGroups: this.selectedGroups, filters: Object.assign({}, this.store.state.filters), searchTerm: this.searchTerm }), this.sort));
      this.currentResponse = response;
      this.currentResults = response.results;
      this.loading = false;
    }, 150);
    this.handleResizeEvent = (e) => {
      this.resize(e);
    };
    this.renderSelectedItem = (selectedGroup) => {
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-selected-item", { key: selectedGroup.id, heading: selectedGroup.title, onArcgisSelectedItemRemove: () => {
          this.deselectGroup(selectedGroup);
          this.arcgisGroupBrowserSelect.emit(this.selectedGroups);
        } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-thumbnail", { slot: "content-start", group: selectedGroup, portal: this.portal, scale: "s" })));
    };
    this.api = undefined;
    this.portal = undefined;
    this.user = undefined;
    this.searchUser = undefined;
    this.config = undefined;
    this.selection = "none";
    this.view = "list";
    this.num = 20;
    this.q = "";
    this.selectedGroups = [];
    this.preflight = undefined;
    this.fetch = undefined;
    this.hidePreviewFooter = false;
    this.hidePreviewBadges = false;
    this.hasIndoorsSpaces = false;
    this.height = "full";
    this.store = (0,_index_81d548b7_js__WEBPACK_IMPORTED_MODULE_1__.c)({ filters: {} });
    this.usePanelLayout = false;
    this.searchTerm = "";
    this.sort = undefined;
    this.page = { num: this.num, start: 1, nextStart: -1 };
    this.loading = true;
    this.formFactor = undefined;
    this.pageRangeText = "";
    this.previewGroup = undefined;
    this.currentResponse = undefined;
  }
  /** Manually trigger a fetch of new results */
  async refresh() {
    this.fetchGroups();
  }
  async componentWillLoad() {
    const { el, hasIndoorsSpaces, selectedGroups, view } = this;
    const locale = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_5__.g)(el);
    this.i18n = locale[0];
    this.store.state.i18n = locale[0];
    this.store.state.lang = locale[1];
    this.store.state.view = view;
    this.store.state.hasIndoorsSpaces = hasIndoorsSpaces;
    this.store.state.selectedGroups = selectedGroups;
    this.initializeConfig();
    (0,_resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_6__.s)(this.store).observe(this.el);
    el.addEventListener("arcgisBrowserResize", this.handleResizeEvent);
    this.filterMutationObserver.observe(el, { childList: true });
    this.topbarMutationObserver.observe(el, { childList: true });
    this.sortMutationObserver.observe(el, { childList: true });
    this.updateFiltersEmpty();
    this.updateTopbarEmpty();
    this.updateSortEmpty();
    if (this.usePanelLayout || (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_3__.c)(this.el, "calcite-shell-panel")) {
      this.store.state.panel = true;
      this.store.state.filtersExpanded = false;
    }
  }
  disconnectedCallback() {
    var _a, _b;
    (_a = this.store.state.resizeObserver) === null || _a === void 0 ? void 0 : _a.unobserve(this.el);
    this.filterMutationObserver.disconnect();
    this.topbarMutationObserver.disconnect();
    this.sortMutationObserver.disconnect();
    this.filterClearHandler(false);
    (_b = this.el) === null || _b === void 0 ? void 0 : _b.removeEventListener("arcgisBrowserResize", this.handleResizeEvent);
  }
  updateUser(newUser) {
    var _a;
    (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user) !== null && _a !== void 0 ? _a : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user = newUser);
  }
  updatePortal(newPortal) {
    var _a;
    (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) !== null && _a !== void 0 ? _a : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal = newPortal);
  }
  updateAPI(newValue) {
    var _a;
    (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.api) !== null && _a !== void 0 ? _a : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.api = newValue);
  }
  updateConfig(newConfig) {
    var _a;
    (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.config) !== null && _a !== void 0 ? _a : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.config = newConfig);
  }
  updateSelection(newValue) {
    this.store.state.selection = newValue;
  }
  updateSelectedGroups(groups) {
    this.store.state.selectedGroups = groups;
  }
  updateQ() {
    this.fetchGroups();
  }
  async componentDidLoad() {
    this.initializeConfig();
    // initially, fetch is locked
    // wait for all components to emit events impacting state prior to initial fetch
    await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_4__.t)(400);
    this.allowFetch = true;
    if (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) {
      this.fetchGroups();
    }
    else {
      (0,_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.o)("portal", () => {
        this.initializeConfig();
        this.fetchGroups();
      });
    }
  }
  filterHandler(e) {
    const filters = Object.assign(Object.assign({}, this.store.state.filters), { [e.detail.id]: e.detail });
    // remove filter from set
    if (!e.detail.value) {
      delete filters[e.detail.id];
    }
    this.store.state.filters = filters;
    this.resetPagination();
    this.fetchGroups();
  }
  genericFilterHandler(e) {
    this.filterHandler(e);
  }
  filterClearHandler(doFetchGroups = true) {
    this.store.state.filters = {};
    this.resetPagination();
    doFetchGroups && this.fetchGroups();
  }
  genericFilterClearHandler() {
    this.filterClearHandler();
  }
  filterToggleHandler() {
    this.store.state.preview = null;
    this.store.state.filtersExpanded = !this.store.state.filtersExpanded;
  }
  searchHandler(e) {
    const newTerm = e.detail;
    this.searchTerm = newTerm;
    this.resetPagination();
    if (newTerm) {
      this.fetchGroups();
    }
    else {
      this.fetchGroups.invoke();
    }
  }
  sortHandler(e) {
    this.sort = e.detail;
    this.fetchGroups();
  }
  async pageHandler(e) {
    var _a;
    this.page = e.detail;
    if (this.allowFetch) {
      await this.fetchGroups();
      await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_4__.t)(400);
      // TODO: figure out why a ref doesn't work for this element
      (_a = this.el.shadowRoot.querySelector(".content__view")) === null || _a === void 0 ? void 0 : _a.scrollTo({
        top: 0,
        behavior: "smooth"
      });
    }
  }
  selectHandler(e) {
    const { selected, group } = e.detail;
    switch (this.selection) {
      case "single":
        this.selectedGroups = [group];
        break;
      case "multiple":
        if (selected) {
          this.selectGroup(group);
        }
        else {
          this.deselectGroup(group);
        }
        break;
    }
    this.arcgisGroupBrowserSelect.emit(this.selectedGroups);
  }
  async togglePreview({ detail }) {
    this.store.state.filtersExpanded = false;
    if (!detail || this.store.state.preview === detail.id) {
      this.store.state.preview = null;
      this.previewGroup = null;
      this.arcgisGroupBrowserPreview.emit();
      this.arcgisGroupBrowserSublayerPreview.emit();
    }
    else {
      this.restoreFocusElement = document.activeElement;
      this.store.state.preview = detail.id;
      this.previewGroup = Object.assign({}, detail);
      this.arcgisGroupBrowserPreview.emit(Object.assign({}, detail));
    }
    this.arcgisGroupBrowserInternalUIAction.emit({
      action: this.previewGroup ? "open panel" : "close panel",
      category: "card action"
    });
  }
  async initializeConfig() {
    var _a, _b, _c, _d;
    (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.api) !== null && _a !== void 0 ? _a : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.api = this.api);
    (_b = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user) !== null && _b !== void 0 ? _b : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user = this.user);
    (_c = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) !== null && _c !== void 0 ? _c : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal = this.portal);
    (_d = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.config) !== null && _d !== void 0 ? _d : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.config = this.config);
  }
  resetPagination() {
    this.page.start = 1;
    this.page.total = 0;
  }
  getQuery() {
    return Object.assign(Object.assign({ filters: this.store.state.filters, searchUser: this.searchUser, searchTerm: this.searchTerm, baseQuery: this.q }, this.sort), this.page);
  }
  queryGroups(query) {
    if (this.fetch) {
      return this.fetch(query);
    }
    return queryGroups(this.portal, query);
  }
  restoreFocus() {
    if (this.restoreFocusElement) {
      const el = this.restoreFocusElement;
      if (el.restoreFocus) {
        el.restoreFocus();
      }
      else if (el.setFocus) {
        el.setFocus();
      }
      else if (el.focus) {
        el.focus();
      }
    }
  }
  selectGroup(group) {
    if (!this.isSelected(group)) {
      this.selectedGroups = [...this.selectedGroups, group];
    }
  }
  deselectGroup(group) {
    this.selectedGroups = this.selectedGroups.filter(({ id }) => id !== group.id);
  }
  isSelected(group) {
    var _a;
    return (_a = this.selectedGroups) === null || _a === void 0 ? void 0 : _a.some(({ id }) => group.id === id);
  }
  resize({ detail: { width, height } }) {
    this.formFactor = width > _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_6__.b.sm ? "large" : "small";
    const oldFormFactor = this.store.state.width > _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_6__.b.sm ? "large" : "small";
    /** when going from large to small or small to large, collapse or expand filters, accordingly */
    if (oldFormFactor === "large" && this.formFactor === "small") {
      /** use panel layout if enabled on smaller group browsers */
      this.store.state.panel = this.usePanelLayout;
      this.store.state.filtersExpanded = false;
    }
    if (oldFormFactor === "small" && this.formFactor === "large") {
      /** panel layout won't work on larger group browsers */
      this.store.state.panel = false;
      this.store.state.filtersExpanded = true;
    }
    this.store.state.width = width;
    this.store.state.height = height;
  }
  renderSelected() {
    var _a, _b, _c, _d;
    const wholePageSelected = (_a = this.currentResults) === null || _a === void 0 ? void 0 : _a.every((group) => this.isSelected(group));
    const totalSelected = (_b = this.selectedGroups) === null || _b === void 0 ? void 0 : _b.length;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-selected", { slot: "selection", loading: this.loading, total: (_c = this.currentResults) === null || _c === void 0 ? void 0 : _c.length, totalSelected: totalSelected, emptyText: this.i18n.groupBrowser.noSelectedGroups, heading: this.i18n.groupBrowser.selectedGroups, checked: !this.loading && wholePageSelected, indeterminate: !wholePageSelected && !!totalSelected, onArcgisSelectedDeselectAll: () => {
        this.selectedGroups = [];
        this.arcgisGroupBrowserSelect.emit(this.selectedGroups);
      }, onArcgisSelectedSelectPage: () => {
        var _a;
        (_a = this.currentResults) === null || _a === void 0 ? void 0 : _a.forEach((group) => {
          this.selectGroup(group);
        });
        this.arcgisGroupBrowserSelect.emit(this.selectedGroups);
      } }, (_d = this.selectedGroups) === null || _d === void 0 ? void 0 : _d.map(this.renderSelectedItem)));
  }
  renderSlot(name, defaultContent) {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: name }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: name }, defaultContent)));
  }
  render() {
    const { loading, i18n, selectedGroups, selection, currentResponse, store, api, searchTerm, formFactor, height, renderSlot } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser", { preview: !!this.previewGroup, loading: loading, selected: selectedGroups, alwaysShowSelection: selection === "multiple", response: currentResponse, store: store, api: api, formFactor: formFactor, searchTerm: searchTerm, height: height }, renderSlot("top-bar"), renderSlot("sort"), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-preview", { slot: "preview", group: this.previewGroup, portal: this.portal, user: this.user, key: this.store.state.preview, onArcgisGroupBrowserPreviewClose: () => {
        this.store.state.preview = null;
        this.previewGroup = null;
        this.arcgisGroupBrowserPreview.emit();
        this.arcgisGroupBrowserSublayerPreview.emit();
        this.restoreFocus();
      }, hidePreviewFooter: this.hidePreviewFooter, showBadges: !this.hidePreviewBadges, currentResponse: this.currentResponse }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "footer-action" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "preview-footer-action" }))), this.renderSelected(), renderSlot("actions"), renderSlot("content-start"), renderSlot("content"), renderSlot("content-end"), renderSlot("pagination"), renderSlot("filters"), renderSlot("scroll-end"), renderSlot("no-results", i18n.content.noResults), renderSlot("no-content", i18n.content.noContent))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "user": ["updateUser"],
    "portal": ["updatePortal"],
    "api": ["updateAPI"],
    "config": ["updateConfig"],
    "selection": ["updateSelection"],
    "selectedGroups": ["updateSelectedGroups"],
    "q": ["updateQ"]
  }; }
};
ArcgisGroupBrowser.style = arcgisGroupBrowserCss;

const ArcgisGroupBrowserActions = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.actions = [];
  }
  async componentWillLoad() {
    this.store = (0,_store_6ec1e1e1_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-actions", { actions: this.actions, selection: this.store.state.selectedGroups })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const arcgisGroupBrowserContentCss = ":host{--arcgis-group-browser-columns:repeat(1, 1fr);--arcgis-group-browser-gap:0.5rem}.list slot,.compact slot{display:grid;grid-template-columns:var(--arcgis-group-browser-columns)}.compact slot{grid-gap:0;gap:0}.list slot{gap:var(--arcgis-group-browser-gap)}";

const ArcgisGroupBrowserContent = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
  }
  async componentWillLoad() {
    this.store = (0,_store_6ec1e1e1_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
  }
  render() {
    const view = this.store.state.view;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
        [view]: true,
        "no-space": this.store.state.width < _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_6__.b.xs && this.store.state.panel
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", null))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisGroupBrowserContent.style = arcgisGroupBrowserContentCss;

const ArcgisGroupBrowserFilterDate = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisGroupBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserFilter", 7);
    this.property = "modified";
    this.range = undefined;
    this.start = undefined;
    this.end = undefined;
    this.expanded = undefined;
  }
  componentWillLoad() {
    this.store = (0,_store_6ec1e1e1_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
  }
  getEventDetail(detail) {
    return Object.assign({ param: "q" }, detail);
  }
  render() {
    const { property, range, start, end, store, expanded } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter-date", { serverProperty: property, property: property, store: store, start: start, end: end, range: range, expanded: expanded, onArcgisBrowserFilter: (e) => {
        this.arcgisGroupBrowserFilter.emit(this.getEventDetail(e.detail));
      } }));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisGroupBrowserFilterGroupsByUser = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisGroupBrowserUsernamesFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserUsernamesFilter", 7);
    this.searchUsernames = undefined;
    this.searchUsername = undefined;
    this.owner = undefined;
    this.expanded = undefined;
    this.allUsernames = [];
    this.selectedUsername = undefined;
  }
  async componentWillLoad() {
    var _a, _b, _c;
    this.store = (0,_store_6ec1e1e1_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
    this.i18n = this.store.state.i18n.filterGroupsByUser;
    this.selectedUsername =
      (_b = (_a = this.searchUsername) !== null && _a !== void 0 ? _a : this.searchUsernames[0]) !== null && _b !== void 0 ? _b : (_c = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user) === null || _c === void 0 ? void 0 : _c.username;
  }
  async searchUsernamesChanged() {
    this.allUsernames = this.searchUsernames;
  }
  async searchUsernameChanged() {
    this.selectedUsername = this.searchUsername;
  }
  render() {
    var _a;
    const { allUsernames, selectedUsername, searchUsername, i18n } = this;
    const currentUsername = (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user) === null || _a === void 0 ? void 0 : _a.username;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.title, expanded: this.expanded, onArcgisBrowserFilterRemove: () => {
        this.selectedUsername = searchUsername;
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "single", scale: "m", onCalciteTreeSelect: (event) => {
        var _a, _b;
        const node = event.target;
        const selectedUsername = ((_b = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset.username) || "";
        this.selectedUsername = selectedUsername;
        this.arcgisGroupBrowserUsernamesFilter.emit(selectedUsername);
      } }, allUsernames.map((username) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-username": username, selected: username === selectedUsername }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, username === currentUsername ? i18n.me.replace("${username}", username) : username)))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "searchUsernames": ["searchUsernamesChanged"],
    "searchUsername": ["searchUsernameChanged"]
  }; }
};

const ArcgisGroupBrowserFilterMemberOrg = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisGroupBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserFilter", 7);
    this.memberOrg = undefined;
    this.orgId = undefined;
    this.expanded = undefined;
  }
  async componentWillLoad() {
    this.store = (0,_store_6ec1e1e1_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
    this.i18n = this.store.state.i18n.filterMemberOrg;
  }
  async componentDidLoad() {
    if (this.memberOrg) {
      this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
    }
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_10__.a)("memberOrg", this.store, () => (this.memberOrg = null));
  }
  getQueryValue() {
    const { username } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user;
    const orgid = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.id;
    if (!username || !orgid) {
      return "";
    }
    switch (this.memberOrg) {
      case "myOrg":
        return "memberorgids:NULL";
      case "anotherOrg":
        if (this.orgId) {
          return `(memberorgids:${this.orgId} OR orgid:${this.orgId})`;
        }
        else {
          return "-memberorgids:NULL";
        }
      default:
        return "";
    }
  }
  getEventDetail() {
    const { memberOrg, orgId } = this;
    const value = this.getQueryValue();
    const label = this.i18n.label.replace("${label}", this.i18n[memberOrg]);
    return { id: "memberOrg", param: "q", value, label, memberOrg, orgId };
  }
  render() {
    var _a;
    // https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/44198
    if ((_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) === null || _a === void 0 ? void 0 : _a.isPortal) {
      return null;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.currentMembersAreFrom, expanded: this.expanded, active: !!this.memberOrg, onArcgisBrowserFilterRemove: () => {
        this.memberOrg = null;
        this.orgId = null;
        this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "single", scale: "m", onCalciteTreeSelect: (event) => {
        var _a, _b;
        const node = event.target;
        const memberOrg = ((_b = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset.memberOrg) || "";
        if (this.memberOrg === memberOrg) {
          this.memberOrg = null;
        }
        else {
          this.memberOrg = memberOrg;
        }
        this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
      } }, ["myOrg", "anotherOrg"].map((memberOrg) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-member-org": memberOrg, selected: memberOrg === this.memberOrg }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, this.i18n[memberOrg])))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisGroupBrowserFilterMembership = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisGroupBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserFilter", 7);
    this.hasIndoorsSpaces = false;
    this.membership = undefined;
    this.expanded = undefined;
  }
  async componentWillLoad() {
    this.store = (0,_store_6ec1e1e1_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
    this.i18n = this.store.state.i18n.filterMembership;
    this.hasIndoorsSpaces = this.store.state.hasIndoorsSpaces;
  }
  async componentDidLoad() {
    if (this.membership) {
      this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
    }
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_10__.a)("membership", this.store, () => (this.membership = null));
  }
  getQueryValue() {
    // https://devtopia.esri.com/webgis/arcgis-portal-app/issues/37831
    if (this.hasIndoorsSpaces) {
      return "membershipaccess:org";
    }
    switch (this.membership) {
      case "org":
        return "membershipaccess:org";
      case "collaboration":
        return "membershipaccess:collaboration";
      case "anyOrg":
        return "membershipaccess:NULL";
      default:
        return "";
    }
  }
  getEventDetail() {
    const { membership } = this;
    const value = this.getQueryValue();
    const label = this.i18n.label.replace("${label}", this.i18n[membership]);
    return { id: "membership", param: "q", value, label, membership };
  }
  render() {
    var _a;
    if (
    // https://devtopia.esri.com/webgis/arcgis-portal-app/issues/37831
    this.hasIndoorsSpaces ||
      (
      // https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/44198
      (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) === null || _a === void 0 ? void 0 : _a.isPortal)) {
      // This will relies on the event emitted in `componentDidLoad` to set the proper base q value
      return null;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.groupMembershipSetting, expanded: this.expanded, active: !!this.membership, onArcgisBrowserFilterRemove: () => {
        this.membership = null;
        this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "single", scale: "m", onCalciteTreeSelect: (event) => {
        var _a, _b;
        const node = event.target;
        const membership = ((_b = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset.membership) || "";
        if (this.membership === membership) {
          this.membership = null;
        }
        else {
          this.membership = membership;
        }
        this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
      } }, ["org", "collaboration", "anyOrg"].map((membership) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-membership": membership, selected: membership === this.membership }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, this.i18n[membership])))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisGroupBrowserFilterOwner = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisGroupBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserFilter", 7);
    this.hasIndoorsSpaces = false;
    this.searchUsername = undefined;
    this.owner = undefined;
    this.expanded = undefined;
  }
  async componentWillLoad() {
    this.store = (0,_store_6ec1e1e1_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
    this.i18n = this.store.state.i18n.filterOwner;
    this.hasIndoorsSpaces = this.store.state.hasIndoorsSpaces;
  }
  async componentDidLoad() {
    var _a, _b;
    if (this.owner) {
      this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
    }
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_10__.a)("owner", this.store, () => (this.owner = null));
    (_a = this.searchUsername) !== null && _a !== void 0 ? _a : (this.searchUsername = (_b = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user) === null || _b === void 0 ? void 0 : _b.username);
  }
  getQueryValue() {
    var _a, _b, _c;
    const username = (_a = this.searchUsername) !== null && _a !== void 0 ? _a : (_b = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user) === null || _b === void 0 ? void 0 : _b.username;
    const orgId = (_c = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) === null || _c === void 0 ? void 0 : _c.id;
    // We don't want to return empty string even if orgId is empty
    //  to make sure the query value still has the correct syntax
    // This mimics behavior on prod
    // TODO: find a better way to filter that out in R3
    if (!username) {
      return "";
    }
    switch (this.owner) {
      case "owner":
        return `owner:${username}`;
      case "inOrg":
        return `-owner:${username} orgid:${orgId}`;
      case "outsideOrg":
        // this magic SQL query gets all org ids and then removes the current org
        return `(orgid: [0 TO \{]) -orgid:${orgId}`;
      default:
        return "";
    }
  }
  getEventDetail() {
    const { owner, searchUsername: username } = this;
    const value = this.getQueryValue();
    const label = this.i18n.label.replace("${label}", owner === "owner" ? username : this.i18n[owner]);
    return { id: "owner", param: "q", value, label, owner, username };
  }
  getOwnerText(owner) {
    if (owner === "owner") {
      return this.searchUsername;
    }
    if (owner === "outsideOrg") {
      return this.i18n[(0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_11__.n)(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user) ? "someoneElse" : "outsideOrg"];
    }
    return this.i18n[owner];
  }
  searchUsernameChanged() {
    this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
  }
  render() {
    const user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user;
    const username = user === null || user === void 0 ? void 0 : user.username;
    if (!username) {
      return null;
    }
    const filters = (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_11__.n)(user)
      ? ["owner", "outsideOrg"]
      : ["owner", "inOrg", "outsideOrg"];
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.owner, expanded: this.expanded, active: !!this.owner, onArcgisBrowserFilterRemove: () => {
        this.owner = null;
        this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "single", scale: "m", onCalciteTreeSelect: (event) => {
        var _a, _b;
        const node = event.target;
        const owner = ((_b = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset.owner) || "";
        if (this.owner === owner) {
          this.owner = null;
        }
        else {
          this.owner = owner;
        }
        this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
      } }, filters
      .filter((value) => !(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal || this.hasIndoorsSpaces) || value !== "outsideOrg")
      .map((owner) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-owner": owner, selected: owner === this.owner }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, this.getOwnerText(owner))))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "searchUsername": ["searchUsernameChanged"]
  }; }
};

function getOrgSettingsGroupsQuery(portal) {
  var _a, _b, _c, _d;
  let queryStrings = [];
  const orgSettingsQueries = [
    // Org Settings > Gallery
    portal.featuredItemsGroupQuery,
    // Org Settings > Map
    portal.basemapGalleryGroupQuery,
    portal.templatesGroupQuery,
    portal["2DStylesGroupQuery"],
    portal.stylesGroupQuery,
    portal.analysisLayersGroupQuery,
    // Org Settings > Groups > Configuriable Apps
    portal.galleryTemplatesGroupQuery
  ];
  // Org Settings > Home Page
  if (portal.hasModernHomePageEnabled) {
    const contentGalleries = ((_b = (_a = portal.homePageConfig) === null || _a === void 0 ? void 0 : _a.content) === null || _b === void 0 ? void 0 : _b.filter((content) => content.type === "gallery" && !!content.groupId)) || [];
    if (contentGalleries.length > 0) {
      contentGalleries.forEach(({ groupId }) => {
        const query = `id:${groupId}`;
        queryStrings = addToQueryString(query, queryStrings);
      });
    }
  }
  else {
    orgSettingsQueries.push(portal.homePageFeaturedContent);
  }
  orgSettingsQueries.forEach((query) => {
    queryStrings = addToQueryString(query, queryStrings);
  });
  // Org Settings > Featured Groups
  portal.featuredGroups.forEach((featuredGroup) => {
    if (featuredGroup.id) {
      const query = `id:${featuredGroup.id}`;
      queryStrings = addToQueryString(query, queryStrings);
    }
    else {
      // in enterprise, some groups don't use ids, so commit the full assembled query
      const queryParts = Object.entries(featuredGroup).map((entry) => `${entry[0]}:"${entry[1]}"`);
      const query = `(${queryParts.join(" ")})`;
      queryStrings = addToQueryString(query, queryStrings, true);
    }
  });
  // Org Settings > Member Defaults
  (_d = (_c = portal.userDefaults) === null || _c === void 0 ? void 0 : _c.groups) === null || _d === void 0 ? void 0 : _d.forEach((id) => {
    const query = `id:${id}`;
    queryStrings = addToQueryString(query, queryStrings);
  });
  return queryStrings.length > 0 ? `(${queryStrings.join(" OR ")})` : "";
}
function addToQueryString(query, queryStrings, allowNonId) {
  if (((query === null || query === void 0 ? void 0 : query.indexOf("id:")) !== 0 && !allowNonId) || queryStrings.includes(query)) {
    return [...queryStrings];
  }
  return [...queryStrings, query];
}

const ArcgisGroupBrowserFilterSpecialGroups = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisGroupBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserFilter", 7);
    this.hasIndoorsSpaces = false;
    this.specialGroup = undefined;
    this.expanded = undefined;
    this.options = [];
  }
  async componentWillLoad() {
    this.store = (0,_store_6ec1e1e1_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
    this.i18n = this.store.state.i18n.filterSpecialGroups;
    this.hasIndoorsSpaces = this.store.state.hasIndoorsSpaces;
    this.validateOptions();
    (0,_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.o)("portal", () => this.validateOptions());
  }
  validateOptions() {
    if (!_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) {
      return (this.options = []);
    }
    this.options = ["openData", "sharedUpdate", "distributed", "admin", "settings"].filter((option) => {
      return !((option === "openData" && _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal) ||
        // https://devtopia.esri.com/webgis/arcgis-portal-app/issues/37831
        (option === "distributed" && this.hasIndoorsSpaces) ||
        // https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/45449 orgs with no settings groups configured don't need this option
        (option === "settings" && !getOrgSettingsGroupsQuery(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal)));
    });
  }
  async componentDidLoad() {
    if (this.specialGroup) {
      this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
    }
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_10__.a)("specialGroups", this.store, () => (this.specialGroup = null));
  }
  getQueryValue() {
    switch (this.specialGroup) {
      case "openData":
        return "isopendata:true";
      case "sharedUpdate":
        return "capabilities:updateitemcontrol";
      case "distributed":
        return "capabilities:distributed";
      case "admin":
        return "isleavingdisallowed:true";
      case "settings":
        return getOrgSettingsGroupsQuery(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal);
      default:
        return "";
    }
  }
  getEventDetail() {
    const { specialGroup } = this;
    const value = this.getQueryValue();
    const label = this.i18n.label.replace("${label}", this.i18n[specialGroup]);
    return { id: "specialGroups", param: "q", value, label, specialGroups: specialGroup };
  }
  render() {
    if (!(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal)) {
      return null;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.title, expanded: this.expanded, active: !!this.specialGroup, onArcgisBrowserFilterRemove: () => {
        this.specialGroup = null;
        this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "single", scale: "m", onCalciteTreeSelect: (event) => {
        var _a, _b;
        const node = event.target;
        const specialGroups = ((_b = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset.specialGroups) || "";
        if (this.specialGroup === specialGroups) {
          this.specialGroup = null;
        }
        else {
          this.specialGroup = specialGroups;
        }
        this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
      } }, this.options.map((specialGroups) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-special-groups": specialGroups, selected: specialGroups === this.specialGroup }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, this.i18n[specialGroups], specialGroups === "settings" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-information", { style: { verticalAlign: "-.25rem", "--arcgis-information-min-width": "0" }, label: this.i18n.tooltipLabel, overlayPositioning: "fixed", paddedContent: true }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.i18n.tooltip))))))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisGroupBrowserFilters = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
  }
  async componentWillLoad() {
    this.store = (0,_store_6ec1e1e1_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filters", { store: this.store }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "top" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "top" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", null), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "bottom" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "bottom" }))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const arcgisGroupBrowserPaginationCss = ".wrapper{padding-left:0.5rem;padding-right:0.5rem;padding-top:2rem;padding-bottom:2rem;justify-content:center;display:flex}.hide{display:none}";

const ArcgisGroupBrowserPagination = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisGroupBrowserPage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserPage", 7);
    this.total = undefined;
    this.start = undefined;
    this.num = 60;
  }
  async componentWillLoad() {
    this.store = (0,_store_6ec1e1e1_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
  }
  render() {
    const { start, total, num, store } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-pagination", { start: start, total: total, num: num, store: store, onArcgisBrowserPage: (e) => this.arcgisGroupBrowserPage.emit(e.detail) }));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisGroupBrowserPagination.style = arcgisGroupBrowserPaginationCss;

async function fetchGroup(groupId, portal) {
  const restBase = (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_7__.g)(portal);
  const url = `${restBase}community/groups/${groupId}`;
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_7__.r)(url);
}
async function fetchGroupMembers(groupId, portal, params = {}) {
  const restBase = (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_7__.g)(portal);
  const url = `${restBase}community/groups/${groupId}/userlist`;
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_7__.r)(url, params);
}

const arcgisGroupBrowserPreviewCss = ":host{background-color:var(--calcite-ui-background);flex:1 1 0%;display:flex;flex-direction:column;height:100%;width:100%}.preview__header{-webkit-margin-start:0.75rem;margin-inline-start:0.75rem}.preview__title{font-size:1rem;font-weight:500;color:var(--calcite-ui-text-1);padding:0;margin:0;word-wrap:break-word;overflow-wrap:break-word;line-height:1.375}.title{font-weight:500;color:var(--calcite-ui-text-1);font-size:1.125rem;margin-top:0.75rem;margin-bottom:0.75rem;padding:0;word-wrap:break-word;word-break:break-word}.badges{margin-top:1rem}.badges[empty]{display:none}calcite-accordion-item{--calcite-accordion-item-padding:1rem 1rem;--calcite-accordion-item-background:var(--calcite-ui-foreground-1);width:100%;box-sizing:border-box;border-bottom:1px solid var(--calcite-ui-border-2)}.section{padding:1rem;background-color:var(--calcite-ui-background);margin:0rem -1rem calc(-1rem - 1px);line-height:1.35}.section--tight{padding-top:0;padding-bottom:0;padding-left:0;padding-right:0}.section--centered{width:100%;display:flex;flex-direction:column;grid-row-gap:0.75rem;row-gap:0.75rem;align-items:center}.full-card-wrapper{padding-top:0.75rem;padding-left:0.5rem;padding-right:0.5rem}.details-title{font-weight:500;font-size:0.75rem;color:var(--calcite-ui-text-3);padding-bottom:0.25rem;padding-top:0;margin-top:1rem;margin-bottom:0;--calcite-label-margin-bottom:0}.details-title:first-of-type{margin-top:0}.details-title--label{padding-bottom:0}.details-text{font-weight:400;font-size:0.875rem;color:var(--calcite-ui-text-1);padding:0;margin:0;word-wrap:break-word;overflow-wrap:break-word}.details-text a{color:var(--calcite-ui-text-link)}.details-text--empty{color:var(--calcite-ui-text-3);font-weight:400}.details-link{margin-top:0.75rem}.description{word-wrap:break-word;overflow-wrap:break-word;line-height:1.35}.description *{font-size:0.875rem !important}.icon-xl{height:3rem;width:3rem}.content-card{margin-bottom:0.25rem}.content-thumbnail{margin-top:auto;margin-bottom:auto;width:100%;-webkit-margin-end:1rem;margin-inline-end:1rem}.settings-text{font-weight:400;font-size:0.875rem;margin-top:-0.25rem;margin-bottom:-0.25rem}.footer-actions{width:100%;padding:1rem;display:flex;flex-direction:column;grid-row-gap:0.5rem;row-gap:0.5rem}.block--padded{padding-bottom:1rem;-webkit-padding-start:0.25rem;padding-inline-start:0.25rem}";

const ArcgisGroupBrowserPreview = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisGroupBrowserPreviewClose = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserPreviewClose", 7);
    this.arcgisGroupBrowserInternalUIAction = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserInternalUIAction", 7);
    this.group = undefined;
    this.portal = undefined;
    this.user = undefined;
    this.hidePreviewFooter = false;
    this.showBadges = true;
    this.currentResponse = undefined;
    this.fullGroup = undefined;
    this.userInfo = undefined;
    this.content = undefined;
    this.managers = undefined;
  }
  async componentWillLoad() {
    this.store = (0,_store_6ec1e1e1_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
    this.lang = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_5__.a)(this.el);
    this.i18n = this.store.state.i18n.preview;
    this.init();
  }
  updatePreview() {
    this.init();
  }
  async init() {
    var _a, _b, _c;
    if (!this.group) {
      return;
    }
    const { group, portal, user } = this;
    this.isGroupOwner = group.owner === (user === null || user === void 0 ? void 0 : user.username);
    this.fullGroup = null;
    this.fullGroup = await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_4__.m)(fetchGroup(group.id, this.portal), 600);
    this.userInfo = await (0,_user_ba12ebd6_js__WEBPACK_IMPORTED_MODULE_13__.f)(group.owner, portal);
    const contentQuery = this.getTypeQuery(this.fullGroup);
    this.content = await (((_b = (_a = this.fullGroup.properties) === null || _a === void 0 ? void 0 : _a.featuredItemIds) === null || _b === void 0 ? void 0 : _b.length) &&
      this.fullGroup.properties.isFeatured
      ? queryFeaturedContent(portal, group.id, this.fullGroup.properties.featuredItemIds)
      : queryGroupContent(portal, group.id, Object.assign({ sortField: this.fullGroup.sortField || "modified", sortOrder: this.fullGroup.sortOrder || "desc" }, (contentQuery ? { q: contentQuery } : {}))));
    this.managers = await this.fetchGroupAdmins(portal, group);
    (_c = this.flowItem) === null || _c === void 0 ? void 0 : _c.setFocus();
  }
  handleAccordionItemClick(element, details) {
    this.arcgisGroupBrowserInternalUIAction.emit({
      action: element.expanded ? "expand" : "collapse",
      category: "panel action",
      details
    });
  }
  closePreview() {
    this.fullGroup = null;
    this.arcgisGroupBrowserInternalUIAction.emit({
      action: "close panel",
      category: "panel action"
    });
    this.arcgisGroupBrowserPreviewClose.emit();
  }
  handleDetailsClick(details) {
    this.arcgisGroupBrowserInternalUIAction.emit({
      action: "click",
      category: "group panel action",
      details
    });
  }
  renderHeader() {
    var _a;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header-content", class: "preview__header" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { class: "preview__title" }, (_a = this.group) === null || _a === void 0 ? void 0 : _a.title)));
  }
  isAccordionItem(element) {
    return element.tagName === "CALCITE-ACCORDION-ITEM";
  }
  getViewByText(group) {
    switch (group.access) {
      case "public":
        return this.i18n.everyone;
      case "private":
        return this.i18n.onlyMembers;
      case "org":
        return this.i18n.onlyOrganization;
      case "shared":
        return this.i18n.onlyOrganizationAndPartners;
    }
  }
  getJoinByText(group) {
    if (group.autoJoin) {
      return this.i18n.byAutojoin;
    }
    if (group.isInvitationOnly) {
      return this.i18n.byInvitation;
    }
    if (group.providerGroupName) {
      return this.i18n.byEnterprise;
    }
    return this.i18n.byRequest;
  }
  async fetchGroupAdmins(portal, group) {
    var _a, _b;
    const admins = (_b = (_a = (await fetchGroupMembers(group.id, portal, { memberType: "admin" }))) === null || _a === void 0 ? void 0 : _a.users) !== null && _b !== void 0 ? _b : [];
    const owner = admins.find((admin) => admin.username === group.owner);
    return [owner, ...admins.filter((admin) => admin.username !== owner.username)];
  }
  getTypeQuery(group) {
    var _a;
    if ((_a = group.displaySettings) === null || _a === void 0 ? void 0 : _a.itemTypes) {
      const itemType = group.displaySettings.itemTypes.split(",")[0].toLowerCase();
      switch (itemType) {
        case "application":
          return _items_69346131_js__WEBPACK_IMPORTED_MODULE_14__.i.applications.q;
        case "web map":
          return _items_69346131_js__WEBPACK_IMPORTED_MODULE_14__.i.maps.q;
        case "web scene":
          return _items_69346131_js__WEBPACK_IMPORTED_MODULE_14__.i.scenes.q;
        case "locator package":
          return _items_69346131_js__WEBPACK_IMPORTED_MODULE_14__.i.tools.q;
        case "csv":
          return _items_69346131_js__WEBPACK_IMPORTED_MODULE_14__.i.files.q;
        case "layer":
          return _items_69346131_js__WEBPACK_IMPORTED_MODULE_14__.i.layers.q;
        default:
          return "";
      }
    }
  }
  render() {
    const { group, fullGroup, i18n, managers, portal, content, showBadges, user } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { closable: true, loading: !fullGroup, onCalciteFlowItemClose: () => this.closePreview(), ref: (el) => (this.flowItem = el) }, this.renderHeader(), fullGroup && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "content" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion", { "icon-position": "start", appearance: "transparent", key: group.id, class: "accordion" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.overview, expanded: Boolean(fullGroup.snippet), ref: (el) => {
        this.overviewElement = el;
      }, onClick: (e) => this.isAccordionItem(e.target) &&
        this.handleAccordionItemClick(this.overviewElement, "overview") }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, fullGroup.snippet ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text" }, fullGroup.snippet)) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text details-text--empty" }, i18n.noSummary)), showBadges && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-badges", { group: fullGroup, portal: portal, showTooltips: false, width: "full", scale: "s", appearance: "outline-fill", class: "badges" })))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.description, key: "description", ref: (el) => {
        this.descriptionElement = el;
      }, onClick: (e) => this.isAccordionItem(e.target) &&
        this.handleAccordionItemClick(this.descriptionElement, "description") }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, fullGroup.description ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "description", innerHTML: (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_3__.s)(fullGroup.description) })) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text details-text--empty" }, i18n.noDescription)))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.content.replace("${count}", content ? `${content.total}` : "0"), expanded: true, ref: (el) => {
        this.contentElement = el;
      }, onClick: (e) => this.isAccordionItem(e.target) &&
        this.handleAccordionItemClick(this.contentElement, "content") }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: { section: true, "section--tight": (content === null || content === void 0 ? void 0 : content.total) > 0 } }, (content === null || content === void 0 ? void 0 : content.total) ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "full-card-wrapper" }, content.results.map((item) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-preview-card", { class: "content-card", item: item, portal: portal, user: user, key: item.id }))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "details-link block--padded" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { href: `${(0,_portal_8714dc6c_js__WEBPACK_IMPORTED_MODULE_12__.g)(portal)}/home/group.html?id=${group.id}&view=list#content`, onClick: () => { this.handleDetailsClick("view all content"); } }, i18n.viewContent)))) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section--centered" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "l", icon: "files", class: "icon-xl details-text--empty" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text details-text--empty" }, i18n.noContent))))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.groupManagers.replace("${count}", managers ? `${managers.length}` : "0"), expanded: true, ref: (el) => {
        this.managersElement = el;
      }, onClick: (e) => this.isAccordionItem(e.target) &&
        this.handleAccordionItemClick(this.managersElement, "managers") }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section section--tight" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "full-card-wrapper" }, managers === null || managers === void 0 ? void 0 :
      managers.map((admin) => {
        return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-card", { key: admin.username, class: "content-card" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-user-avatar", { heading: admin.username === group.owner
            ? i18n.groupOwner.replace("${fullName}", (0,_user_ba12ebd6_js__WEBPACK_IMPORTED_MODULE_13__.g)(admin, this.lang))
            : admin.fullName, showName: true, user: admin, description: admin.username, portal: portal })));
      }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "details-link block--padded" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { href: `${(0,_portal_8714dc6c_js__WEBPACK_IMPORTED_MODULE_12__.g)(portal)}/home/group.html?id=${group.id}#members`, onClick: () => { this.handleDetailsClick("open members page"); } }, i18n.openMembers))))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.settings, expanded: this.isGroupOwner, ref: (el) => {
        this.settingsElement = el;
      }, onClick: (e) => this.isAccordionItem(e.target) &&
        this.handleAccordionItemClick(this.settingsElement, "settings") }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, i18n.viewableBy, ":"), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "settings-text" }, this.getViewByText(fullGroup)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, i18n.contributors, ":"), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "settings-text" }, fullGroup.isViewOnly ? i18n.onlyOwnerManager : i18n.allMembers), this.isGroupOwner && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, i18n.joinMethod, ":"), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "settings-text" }, this.getJoinByText(fullGroup)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "details-link" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { href: `${(0,_portal_8714dc6c_js__WEBPACK_IMPORTED_MODULE_12__.g)(portal)}/home/group.html?id=${group.id}#settings`, onClick: () => { this.handleDetailsClick("open settings"); } }, i18n.openSettings))))))))), !this.hidePreviewFooter && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "footer", class: "footer-actions" }, portal && group && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { onClick: () => {
        var _a;
        const { currentResponse, group } = this;
        const index = (_a = currentResponse === null || currentResponse === void 0 ? void 0 : currentResponse.results) === null || _a === void 0 ? void 0 : _a.findIndex((result) => result.id === group.id);
        const position = index + currentResponse.start;
        this.arcgisGroupBrowserInternalUIAction.emit({
          action: "view group details",
          category: "group panel action",
          position
        });
      }, href: `${(0,_portal_8714dc6c_js__WEBPACK_IMPORTED_MODULE_12__.g)(portal)}/home/group.html?id=${group.id}`, kind: "neutral", appearance: "solid", width: "full" }, i18n.viewDetails)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "footer-action" })))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "group": ["updatePreview"]
  }; }
};
ArcgisGroupBrowserPreview.style = arcgisGroupBrowserPreviewCss;

const arcgisGroupBrowserPreviewCardCss = ":host{display:block;min-width:0}.card{box-shadow:none;transition-duration:150ms;color:var(--calcite-ui-text-1);background-color:var(--calcite-ui-foreground-1);position:relative;opacity:0;height:100%;width:100%;display:flex;flex-direction:column;outline-color:transparent;box-sizing:border-box;background-color:var(--calcite-ui-foreground-1);transition-property:background-color, outline, outline-offset, opacity;border:1px solid var(--calcite-ui-border-3)}.card:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:-2px;z-index:10}.card--loaded{opacity:1}.card--selected{border-color:var(--calcite-ui-brand)}.card--hoverable{cursor:pointer}.card__top{padding:0.75rem}.card__upper{flex:1 1 0%;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;background-color:var(--calcite-ui-foreground-1)}.card--hoverable .card__upper:hover{background-color:var(--calcite-ui-background)}.card__upper--link{text-decoration:none;color:var(--calcite-ui-text-1);outline-color:transparent}.card__upper--link:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:2px;z-index:10}.card__content{display:flex;flex:1 1 0%;flex-direction:column;min-width:0}.card__details{display:flex;flex-direction:row;margin-top:0.25rem}.card__detail{font-size:0.75rem;color:var(--calcite-ui-text-2)}.card__footer{background-color:var(--calcite-ui-foreground-1);padding-left:0.75rem;padding-right:0.75rem;padding-top:0.5rem;padding-bottom:0.5rem;display:flex;align-items:center;margin-top:auto;border-top:1px solid var(--calcite-ui-border-2)}.card__footer__start{flex:1 1 0%;display:flex;flex-direction:row;align-items:center;min-width:0;overflow:hidden;-webkit-margin-end:0.75rem;margin-inline-end:0.75rem}.card__footer__start--owner{-webkit-margin-start:-0.25rem;margin-inline-start:-0.25rem}.card__profile-wrap{max-width:100%;padding:0.25rem;box-sizing:border-box}.card__summary{font-size:0.875rem;color:var(--calcite-ui-text-2);margin:0;padding:0}.card__divider{display:flex;align-items:center;flex:0 0 auto}.card__divider:not([empty]):before{content:\"\";height:1.25rem;width:1px;background-color:var(--calcite-ui-border-1);margin-inline:0.75rem}.card__divider:first-child:before{display:none}.card-flex{display:flex}.card-flex-1{flex:1 1 0%;min-width:0}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.card__title{font-size:0.875rem;margin-top:0;margin-bottom:0;padding-top:0;padding-bottom:0;word-wrap:break-word;overflow-wrap:break-word;font-weight:500;height:2rem;overflow:hidden;line-height:1.15;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}.card__title--padded{margin-bottom:0.5rem}.card__snippet{font-size:0.875rem;margin:0;margin-bottom:0.75rem;padding:0;flex:1 1 0%}.card__badges--stacked{margin-top:0.5rem}.card__thumbnail{width:4rem;padding:0;margin:0;box-sizing:content-box;-webkit-padding-start:0.5rem;padding-inline-start:0.5rem}.card__owner{min-width:0}";

const ArcgisGroupBrowserPreviewCard = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisGroupBrowserInternalUIAction = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserInternalUIAction", 7);
    this.arcgisGroupBrowserPreviewCardSelect = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserPreviewCardSelect", 7);
    var _a;
    this.handleCardClick = () => {
      // when using the cards as a link, don't do any special handling
      if (this.link) {
        return;
      }
      this.arcgisGroupBrowserPreviewCardSelect.emit(this.item);
    };
    this.item = undefined;
    this.portal = undefined;
    this.user = undefined;
    this.api = 4;
    this.baseUrl = (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.config) === null || _a === void 0 ? void 0 : _a.baseUrl;
    this.link = undefined;
    this.newTab = undefined;
    this.showThumbnail = true;
    this.showOwner = true;
    this.showItemType = true;
    this.showDateUpdated = false;
    this.showSummary = false;
    this.showBadges = false;
    this.showOwnerPopup = false;
    this.interactive = false;
    this.hover = undefined;
    this.updatedText = "";
    this.loaded = undefined;
  }
  /* Calling this setFocus causes calcite to focus here when the user popup is closed... */
  async restoreFocus() {
    if (this.link && this.linkEl) {
      this.linkEl.focus();
      return;
    }
    if (this.sectionEl) {
      this.sectionEl.focus();
      return;
    }
  }
  async componentWillLoad() {
    var _a, _b, _c;
    //this.store = getGroupBrowserStore(this.el);
    //this.i18n = this.store.state.i18n.previewCard;
    this.updatedText = (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_15__.a)(this.item.modified);
    this.portal = (_a = this.portal) !== null && _a !== void 0 ? _a : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal;
    this.user = (_b = this.user) !== null && _b !== void 0 ? _b : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user;
    this.api = (_c = this.api) !== null && _c !== void 0 ? _c : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.api;
  }
  async componentDidLoad() {
    await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_4__.t)(100);
    this.loaded = true;
  }
  render() {
    var _a, _b;
    const { item, user, portal, api, 
    //i18n,
    loaded, showDateUpdated, showItemType, showOwner, showOwnerPopup, showBadges, showSummary, showThumbnail, interactive, link, newTab } = this;
    const baseUrl = (_a = this.baseUrl) !== null && _a !== void 0 ? _a : (_b = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.config) === null || _b === void 0 ? void 0 : _b.baseUrl;
    const CardTag = this.link ? "a" : "div";
    const linkAttributes = Object.assign({ href: link }, (newTab ? { target: "_blank", rel: "noopener noreferrer" } : {}));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", Object.assign({ class: {
        "card": true,
        "card--hoverable": interactive,
        "card--loaded": loaded
      } }, (interactive ? { onMouseOver: () => (this.hover = true) } : {}), (interactive ? { onMouseOut: () => (this.hover = false) } : {}), (link ? {} : { onClick: this.handleCardClick }), { ref: (el) => (this.sectionEl = el) }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content-top" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(CardTag, Object.assign({ class: { "card__upper": true, "card__upper--link": !!link } }, (link ? linkAttributes : {}), { ref: (el) => (this.linkEl = el) }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card-flex card__top" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card-flex-1" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card-flex" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card__content" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { class: {
        "card__title": true,
        "card__title--padded": showItemType || (showSummary && !!item.snippet)
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "card__title__span" }, item.title)), showSummary && item.snippet && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "card__summary" }, item.snippet.length > 250
      ? `${item.snippet.substring(0, 250)}`
      : item.snippet)), showItemType && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-type", { scale: "s", item: item, portal: portal }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card__details" }, showDateUpdated && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: {
        "card__detail": true,
        "card__divider": true
      } }, this.updatedText)), showBadges && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-badges", { item: item, user: user, portal: portal, width: "narrow", showTooltips: true, class: {
        "card__badges": true,
        "card__divider": true
      }, scale: "s" })))), showThumbnail && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("figure", { class: "card__thumbnail" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-card-thumbnail", { item: item, user: user, portal: portal }))))))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card__footer", onClick: (e) => {
        e.stopPropagation();
      }, onKeyPress: (e) => {
        if (e.key === "Enter" || e.key == " ") {
          e.stopPropagation();
        }
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
        "card__footer__start": true,
        "card__footer__start--owner": showOwner
      } }, showOwner && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card__profile-wrap", onClick: (e) => {
        e.preventDefault();
        e.stopPropagation();
      } }, showOwnerPopup ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-user-popup", { underline: true, username: item.owner, api: api, portal: portal, baseUrl: baseUrl, showAvatar: false, class: "card__owner", scale: "s", onArcgisUserPopupInternalUIAction: (e) => {
        e.stopPropagation();
        this.arcgisGroupBrowserInternalUIAction.emit(e.detail);
      } })) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-user-avatar", { slot: "footer-start", scale: "s", showName: true, showAvatar: false, username: item.owner, portal: portal }))))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "actions-end" })))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisGroupBrowserPreviewCard.style = arcgisGroupBrowserPreviewCardCss;

const arcgisGroupBrowserSearchCss = ":host{position:relative;display:block}.search{position:absolute;z-index:10;margin-top:1rem;font-size:0.875rem;color:var(--calcite-ui-text-1);pointer-events:none;inset-inline-start:1.5rem}.x{position:absolute;z-index:10;top:0;margin-top:0.25rem;padding:0.5rem;outline:2px solid transparent;outline-offset:2px;border-style:none;cursor:pointer;color:var(--calcite-ui-text-1);inset-inline-end:0.25rem;background:transparent}.input{display:block;width:100%;box-sizing:border-box;padding-top:1rem;padding-bottom:1rem;padding-left:3rem;padding-right:3rem;height:3rem;box-shadow:none;border-style:none;position:relative;z-index:0;transition-property:background-color, border-color, color, fill, stroke, opacity, box-shadow, transform;transition-duration:150ms;color:var(--calcite-ui-text-1);font-size:0.875rem;background-color:transparent;border-bottom:2px solid transparent;font-family:inherit}.input::-webkit-search-cancel-button{display:none}.input::-ms-clear{display:none}.input:focus{box-shadow:none;outline:2px solid transparent;outline-offset:2px;border-bottom-color:var(--calcite-ui-brand)}";

const ArcgisGroupBrowserSearch = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisGroupBrowserSearch = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserSearch", 7);
    this.arcgisGroupBrowserSearchInput = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserSearchInput", 7);
    this.term = undefined;
    this.placeholder = undefined;
    this.showClear = false;
  }
  async componentWillLoad() {
    this.store = (0,_store_6ec1e1e1_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
    this.i18n = this.store.state.i18n.search;
  }
  render() {
    const { term, placeholder } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-search", { term: term, placeholder: placeholder || this.i18n.label, onArcgisBrowserSearch: (e) => this.arcgisGroupBrowserSearch.emit(e.detail), onArcgisBrowserSearchInput: (e) => this.arcgisGroupBrowserSearchInput.emit(e.detail) })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisGroupBrowserSearch.style = arcgisGroupBrowserSearchCss;

const ArcgisGroupBrowserSort = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisGroupBrowserSort = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserSort", 7);
    var _a;
    this.options = ["title", "relevance", "modified"];
    this.field = ((_a = this.options) === null || _a === void 0 ? void 0 : _a[0]) || "relevance";
    this.order = undefined;
    this.activeField = undefined;
    this.activeOrder = undefined;
  }
  async componentWillLoad() {
    this.store = (0,_store_6ec1e1e1_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
    this.activeField = this.field;
  }
  componentDidLoad() {
    this.arcgisGroupBrowserSort.emit({
      sortField: this.field,
      sortOrder: this.order || (0,_utils_b22dfe9c_js__WEBPACK_IMPORTED_MODULE_16__.a)(this.field)
    });
  }
  updateSortField(field) {
    this.activeField = field;
    this.activeOrder = (0,_utils_b22dfe9c_js__WEBPACK_IMPORTED_MODULE_16__.a)(field);
    this.arcgisGroupBrowserSort.emit({
      sortField: this.activeField,
      sortOrder: this.activeOrder
    });
  }
  updateSortOrder(order) {
    this.activeOrder = order;
    this.arcgisGroupBrowserSort.emit({
      sortField: this.activeField,
      sortOrder: this.activeOrder
    });
  }
  render() {
    const { activeField, activeOrder, field, order, options } = this;
    const selectedField = activeField || (options.includes(field) ? field : options[0]);
    const selectedOrder = activeOrder || order;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-sort", { store: this.store, field: selectedField, order: selectedOrder, options: options, onArcgisBrowserSortFieldChange: (e) => this.updateSortField(e.detail), onArcgisBrowserSortOrderChange: (e) => this.updateSortOrder(e.detail) })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisGroupBrowserTopBar = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
  }
  async componentWillLoad() {
    this.store = (0,_store_6ec1e1e1_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-top-bar", { store: this.store }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-start" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content-start" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "search" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "search" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-end" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content-end" })))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-8714dc6c.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-8714dc6c.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getPortalBaseUrl)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
function getPortalBaseUrl(portal) {
  const { customBaseUrl, portalHostname, urlKey } = portal;
  const { protocol } = window.location;
  const url = urlKey ? `${urlKey}.${customBaseUrl}` : portalHostname;
  return `${protocol}//${url}`;
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-6ec1e1e1.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-6ec1e1e1.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ groupBrowserState),
/* harmony export */   g: () => (/* binding */ getGroupBrowserStore)
/* harmony export */ });
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./store-ff04ba0a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-ff04ba0a.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



function getGroupBrowserStore(el) {
  return (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_1__.g)(el, "arcgis-group-browser");
}
const GroupBrowserStore = (0,_index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__.c)({ filters: {} });
const groupBrowserState = GroupBrowserStore.state;




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTUxZjdkNC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDNEg7QUFDckU7QUFDc0I7QUFDaUI7QUFDUjtBQUNrQjtBQUN0QjtBQUNUO0FBQ2Q7QUFDSztBQUNDO0FBQ0o7QUFDQTtBQUNTO0FBQ1g7QUFDRTtBQUNFO0FBQzVCO0FBQ1A7QUFDRDtBQUNRO0FBQ0k7QUFDUDtBQUNOO0FBQ1E7QUFDQTtBQUNOOztBQUU1QjtBQUNBLG1CQUFtQixzREFBYztBQUNqQyxpQkFBaUIsU0FBUztBQUMxQixVQUFVLCtFQUErRTtBQUN6Riw2Q0FBNkM7QUFDN0MsZ0NBQWdDLHFEQUFlLGFBQWE7QUFDNUQsbURBQW1ELGtCQUFrQiw4REFBOEQsSUFBSSxNQUFNLE1BQU0saUJBQWlCLEVBQUUsS0FBSyxHQUFHO0FBQzlLO0FBQ0EsWUFBWSxlQUFlO0FBQzNCLHlDQUF5QyxhQUFhLFlBQVkscUJBQXFCLEVBQUUsTUFBTSxHQUFHO0FBQ2xHLEdBQUc7QUFDSCxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBLGVBQWUsb0JBQW9CO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsc0RBQU87QUFDaEMsdUNBQXVDLGVBQWUsdUNBQXVDO0FBQzdGO0FBQ0EsNkRBQTZEO0FBQzdELG1CQUFtQixzREFBYztBQUNqQyxpQkFBaUIsU0FBUyxpQkFBaUIsUUFBUTtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsc0RBQU8sb0NBQW9DO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixzREFBYztBQUNqQyxpQkFBaUIsU0FBUyxpQkFB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QTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVksa0RBQWtEO0FBQzlEO0FBQ0E7QUFDQSxZQUFZLHFEQUFDLENBQUMsaURBQUksUUFBUSxxREFBQywwQkFBMEIsK05BQStOO0FBQ3BSO0FBQ0EsYUFBYSxPQUFPLHFEQUFVO0FBQzlCOztBQUVBO0FBQ0E7QUFDQSxJQUFJLHFEQUFnQjtBQUNwQjtBQUNBO0FBQ0EsaUJBQWlCLHFEQUFvQjtBQUNyQztBQUNBO0FBQ0EsWUFBWSxxREFBQyxDQUFDLGlEQUFJLFFBQVEscURBQUMsNkJBQTZCLG1CQUFtQixFQUFFLHFEQUFDLFVBQVUsdUJBQXVCLEVBQUUscURBQUMsV0FBVyx1QkFBdUIsSUFBSSxxREFBQyxVQUFVLGdCQUFnQixFQUFFLHFEQUFDLFdBQVcsZ0JBQWdCLElBQUkscURBQUMsVUFBVSxxQkFBcUIsRUFBRSxxREFBQyxXQUFXLHFCQUFxQjtBQUN4UjtBQUNBLGFBQWEsT0FBTyxxREFBVTtBQUM5Qjs7QUFFeWhDOzs7Ozs7Ozs7Ozs7Ozs7QUN6eUN6aEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsd0NBQXdDO0FBQ2xELFVBQVUsV0FBVztBQUNyQiwwQkFBMEIsT0FBTyxHQUFHLGNBQWM7QUFDbEQsWUFBWSxTQUFTLElBQUksSUFBSTtBQUM3Qjs7QUFFaUM7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ1hqQztBQUNBO0FBQ0E7QUFDQTtBQUN1RDtBQUNIOztBQUVwRDtBQUNBLFNBQVMscURBQVE7QUFDakI7QUFDQSwwQkFBMEIscURBQVcsR0FBRyxhQUFhO0FBQ3JEOztBQUU2RCIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1ncm91cC1icm93c2VyXzE2LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3BvcnRhbC04NzE0ZGM2Yy5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9zdG9yZS02ZWMxZTFlMS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBkIGFzIGdldEVsZW1lbnQsIEYgYXMgRnJhZ21lbnQgfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlU3RvcmUgfSBmcm9tICcuL2luZGV4LTgxZDU0OGI3LmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUsIG8gYXMgb25Db25maWdDaGFuZ2UgfSBmcm9tICcuL2NvbmZpZy1lYjVmN2RjMi5qcyc7XG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSwgcyBhcyBzYW5pdGl6ZUhUTUwgfSBmcm9tICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgeyBkIGFzIGRlYm91bmNlLCB0IGFzIHRpbWVvdXQsIG0gYXMgbWluRGVsYXkgfSBmcm9tICcuL2Z1bmN0aW9uYWwtYzgyZjVhYjkuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzLCBhIGFzIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZSB9IGZyb20gJy4vbG9jYWxlLTEzZTAwYTc1LmpzJztcbmltcG9ydCB7IHMgYXMgc2V0dXBSZXNpemVPYnNlcnZlciwgYiBhcyBicmVha3BvaW50cyB9IGZyb20gJy4vcmVzaXplLTU1ZDNjNTVjLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0UmVzdEJhc2VVcmwsIHIgYXMgcmVxdWVzdCB9IGZyb20gJy4vcG9ydGFsLTc5Y2FhZWZmLmpzJztcbmltcG9ydCB7IGMgYXMgY2xlYW5TZWFyY2hUZXJtIH0gZnJvbSAnLi9xdWVyeS00ZjdiN2U0ZC5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEdyb3VwQnJvd3NlclN0b3JlIH0gZnJvbSAnLi9zdG9yZS02ZWMxZTFlMS5qcyc7XG5pbXBvcnQgeyBhIGFzIG9uQnJvd3NlckZpbHRlclJlbW92ZSB9IGZyb20gJy4vc3RvcmUtZmYwNGJhMGEuanMnO1xuaW1wb3J0IHsgbiBhcyBpc1B1YmxpY1VzZXIgfSBmcm9tICcuL3ByaXZpbGVnZXMtY2NkNWYzN2QuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRQb3J0YWxCYXNlVXJsIH0gZnJvbSAnLi9wb3J0YWwtODcxNGRjNmMuanMnO1xuaW1wb3J0IHsgZiBhcyBmZXRjaFVzZXIsIGcgYXMgZ2V0RnVsbE5hbWUgfSBmcm9tICcuL3VzZXItYmExMmViZDYuanMnO1xuaW1wb3J0IHsgaSBhcyBpdGVtVHlwZU9wdGlvbnMgfSBmcm9tICcuL2l0ZW1zLTY5MzQ2MTMxLmpzJztcbmltcG9ydCB7IGEgYXMgZm9ybWF0RGF0ZSB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0RGVmYXVsdFNvcnRPcmRlciB9IGZyb20gJy4vdXRpbHMtYjIyZGZlOWMuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWFhZjMwYmQ2LmpzJztcbmltcG9ydCAnLi91c2VyLWUzZGVkYzRhLmpzJztcbmltcG9ydCAnLi9hcGktZjc5MzRjZDcuanMnO1xuaW1wb3J0ICcuL3NlcnZlci1pdGVtLWYxMjE1M2U2LmpzJztcbmltcG9ydCAnLi9pdGVtLXByb3BlcnRpZXMtZTY0MTJhOWEuanMnO1xuaW1wb3J0ICcuL2FkZC1pdGVtLTk3ZDU3N2E5LmpzJztcbmltcG9ydCAnLi91aS1lY2Y4NmJiYS5qcyc7XG5pbXBvcnQgJy4vZnVuY3Rpb25hbC05ZjY0OGJlZS5qcyc7XG5pbXBvcnQgJy4vaXRlbS10eXBlcy1iNGZlODZhZC5qcyc7XG5pbXBvcnQgJy4vaXRlbS1kOWQ3MDQxNi5qcyc7XG5cbmFzeW5jIGZ1bmN0aW9uIHF1ZXJ5R3JvdXBzKHBvcnRhbCwgcXVlcnkpIHtcbiAgY29uc3QgcmVzdEJhc2UgPSBnZXRSZXN0QmFzZVVybChwb3J0YWwpO1xuICBjb25zdCB1cmwgPSBgJHtyZXN0QmFzZX1jb21tdW5pdHkvZ3JvdXBzYDtcbiAgY29uc3QgeyBudW0sIHN0YXJ0LCBzb3J0T3JkZXIsIHNvcnRGaWVsZCwgZmlsdGVycywgYmFzZVF1ZXJ5LCBzZWFyY2hUZXJtLCBzZWFyY2hVc2VyIH0gPSBxdWVyeTtcbiAgY29uc3QgZmlsdGVySWRzID0gT2JqZWN0LmtleXMoZmlsdGVycyB8fCB7fSk7XG4gIGNvbnN0IHRlcm0gPSBzZWFyY2hUZXJtID8gYCgke2NsZWFuU2VhcmNoVGVybShzZWFyY2hUZXJtKX0pIGAgOiBcIlwiO1xuICBjb25zdCBiYXNlUGFyYW1zID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCAoc2VhcmNoVXNlciA/IHsgc2VhcmNoVXNlckFjY2VzczogXCJncm91cE1lbWJlclwiLCBzZWFyY2hVc2VyTmFtZTogc2VhcmNoVXNlciB9IDoge30pKSwgeyBxOiBgJHtiYXNlUXVlcnkgfHwgXCJcIn0gJHt0ZXJtfWAgfSk7XG4gIGNvbnN0IHF1ZXJ5UGFyYW1zID0gZmlsdGVySWRzLnJlZHVjZSgocGFyYW1zLCBrZXkpID0+IHtcbiAgICBjb25zdCB7IHBhcmFtLCB2YWx1ZSB9ID0gZmlsdGVyc1trZXldO1xuICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHBhcmFtcyksIHsgW3BhcmFtXTogYCR7cGFyYW1zW3BhcmFtXSB8fCBcIlwifSAke3ZhbHVlfWAgfSk7XG4gIH0sIGJhc2VQYXJhbXMpO1xuICBjb25zdCBwYXJhbXMgPSBPYmplY3QuYXNzaWduKHsgbnVtLFxuICAgIHN0YXJ0LFxuICAgIHNvcnRGaWVsZCxcbiAgICBzb3J0T3JkZXIgfSwgKHF1ZXJ5UGFyYW1zIHx8IHt9KSk7XG4gIGNvbnN0IGhhc0FjdGl2ZVF1ZXJ5ID0gT2JqZWN0LmVudHJpZXMocXVlcnlQYXJhbXMpLnNvbWUoKFtfa2V5LCB2YWx1ZV0pID0+IHR5cGVvZiB2YWx1ZSAhPT0gXCJzdHJpbmdcIiB8fCAhISh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdmFsdWUudHJpbSgpKSk7XG4gIGlmICghaGFzQWN0aXZlUXVlcnkpIHtcbiAgICAvLyB0aGUgZ3JvdXAgc2VhcmNoIGVuZHBvaW50IHdpbGwgdGhyb3cgYW4gZXJyb3Igd2l0aCBubyBzZWFyY2ggcGFyYW1ldGVycywgc28gdHJlYXQgYXMgYW4gZW1wdHkgcmVzdWx0IHNldFxuICAgIHJldHVybiB7XG4gICAgICBuZXh0U3RhcnQ6IC0xLFxuICAgICAgbnVtOiAwLFxuICAgICAgcmVzdWx0czogW10sXG4gICAgICBzdGFydDogMCxcbiAgICAgIHRvdGFsOiAwXG4gICAgfTtcbiAgfVxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsLCBwYXJhbXMpO1xuICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCByZXNwb25zZSksIHsgcTogcXVlcnlQYXJhbXMucSwgcXVlcnlQYXJhbXM6IHBhcmFtcyB9KTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHF1ZXJ5R3JvdXBDb250ZW50KHBvcnRhbCwgZ3JvdXBJZCwgcGFyYW1zID0ge30pIHtcbiAgY29uc3QgcmVzdEJhc2UgPSBnZXRSZXN0QmFzZVVybChwb3J0YWwpO1xuICBjb25zdCB1cmwgPSBgJHtyZXN0QmFzZX1jb250ZW50L2dyb3Vwcy8ke2dyb3VwSWR9L3NlYXJjaGA7XG4gIGNvbnN0IGRlZmF1bHRQYXJhbXMgPSB7XG4gICAgbnVtOiA0LFxuICAgIHN0YXJ0OiAwLFxuICAgIHNvcnRGaWVsZDogXCJtb2RpZmllZFwiLFxuICAgIHNvcnRPcmRlcjogXCJkZXNjXCJcbiAgfTtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KHVybCwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0UGFyYW1zKSwgcGFyYW1zKSk7XG4gIHJldHVybiByZXNwb25zZTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHF1ZXJ5RmVhdHVyZWRDb250ZW50KHBvcnRhbCwgZ3JvdXBJZCwgZmVhdHVyZWQsIGxpbWl0ID0gNCkge1xuICBjb25zdCByZXN0QmFzZSA9IGdldFJlc3RCYXNlVXJsKHBvcnRhbCk7XG4gIGNvbnN0IHVybCA9IGAke3Jlc3RCYXNlfWNvbnRlbnQvZ3JvdXBzLyR7Z3JvdXBJZH0vc2VhcmNoYDtcbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIG51bTogbGltaXQsXG4gICAgc3RhcnQ6IDAsXG4gICAgcTogYGlkOigke2ZlYXR1cmVkLnNsaWNlKDAsIGxpbWl0KS5qb2luKFwiIE9SIFwiKX0pYFxuICB9O1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsLCBwYXJhbXMpO1xuICAvLyByZXN1bHRzIHdpbGwgYmUgcmV0dXJuZWQgaW4gYSBcInJlbGV2YW5jZVwiIG9yZGVyLCB3ZSB3YW50IHRoZW0gaW4gdGhlIHJlcXVlc3RlZCBvcmRlclxuICAvLyBub3QgYWxsIGZlYXR1cmVkIGl0ZW1zIHdpbGwgYmUgYXZhaWxhYmxlIHRvIGFsbCB1c2VycyBzbyBhbHNvIGZpbHRlciBvdXQgb25lcyB0aGF0IHdlcmUgbm90IHJldHVybmVkXG4gIGlmIChyZXNwb25zZS50b3RhbCkge1xuICAgIGNvbnN0IG5ld1Jlc3VsdHMgPSBmZWF0dXJlZFxuICAgICAgLm1hcCgoaWQpID0+IHtcbiAgICAgIHJldHVybiByZXNwb25zZS5yZXN1bHRzLmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQgPT09IGlkKTtcbiAgICB9KVxuICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICByZXNwb25zZS5yZXN1bHRzID0gbmV3UmVzdWx0cztcbiAgfVxuICByZXR1cm4gcmVzcG9uc2U7XG59XG5cbmNvbnN0IGFyY2dpc0dyb3VwQnJvd3NlckNzcyA9IFwiOmhvc3R7cG9zaXRpb246cmVsYXRpdmU7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWJhY2tncm91bmQpO2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47aGVpZ2h0OjEwMCU7b3ZlcmZsb3cteTphdXRvO292ZXJmbG93LXg6aGlkZGVuOy0tZ3JvdXAtYnJvd3Nlci1tYXgtd2lkdGg6MTAwJTstLWdyb3VwLWJyb3dzZXItcGFuZS13aWR0aDoxOC43NXJlbTstLWdyb3VwLWJyb3dzZXItcGFuZS16LWluZGV4OjExOy0tZ3JvdXAtYnJvd3Nlci10b3AtYmFyLWJhY2tncm91bmQ6dmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEpfWFyY2dpcy1icm93c2Vyey0tYXJjZ2lzLWJyb3dzZXItbWF4LXdpZHRoOnZhcigtLWdyb3VwLWJyb3dzZXItbWF4LXdpZHRoKTstLWFyY2dpcy1icm93c2VyLXBhbmUtd2lkdGg6dmFyKC0tZ3JvdXAtYnJvd3Nlci1wYW5lLXdpZHRoKTstLWFyY2dpcy1icm93c2VyLXBhbmUtei1pbmRleDp2YXIoLS1ncm91cC1icm93c2VyLXBhbmUtei1pbmRleCk7LS1hcmNnaXMtYnJvd3Nlci10b3AtYmFyLWJhY2tncm91bmQ6dmFyKC0tZ3JvdXAtYnJvd3Nlci10b3AtYmFyLWJhY2tncm91bmQpfUBtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDY0MHB4KXs6aG9zdHstLWdyb3VwLWJyb3dzZXItcGFuZS13aWR0aDoxMDAlfX1cIjtcblxuY29uc3QgQXJjZ2lzR3JvdXBCcm93c2VyID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclVwZGF0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzR3JvdXBCcm93c2VyVXBkYXRlXCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyTG9hZGluZyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzR3JvdXBCcm93c2VyTG9hZGluZ1wiLCA3KTtcbiAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclNlbGVjdCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzR3JvdXBCcm93c2VyU2VsZWN0XCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyUHJldmlldyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzR3JvdXBCcm93c2VyUHJldmlld1wiLCA3KTtcbiAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclN1YmxheWVyUHJldmlldyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzR3JvdXBCcm93c2VyU3VibGF5ZXJQcmV2aWV3XCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VySW50ZXJuYWxVSUFjdGlvbiA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzR3JvdXBCcm93c2VySW50ZXJuYWxVSUFjdGlvblwiLCA3KTtcbiAgICB0aGlzLmxpdmVSZWdpb25VcGRhdGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcImxpdmVSZWdpb25VcGRhdGVcIiwgNyk7XG4gICAgdGhpcy5hbGxvd0ZldGNoID0gZmFsc2U7XG4gICAgdGhpcy5jdXJyZW50UmVzdWx0cyA9IFtdO1xuICAgIHRoaXMudXBkYXRlRmlsdGVyc0VtcHR5ID0gKCkgPT4ge1xuICAgICAgdmFyIF9hO1xuICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzRW1wdHkgPSAhKChfYSA9IHRoaXMuZWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5xdWVyeVNlbGVjdG9yKGBbc2xvdD1cImZpbHRlcnNcIl1gKSk7XG4gICAgfTtcbiAgICB0aGlzLnVwZGF0ZVRvcGJhckVtcHR5ID0gKCkgPT4ge1xuICAgICAgdmFyIF9hO1xuICAgICAgdGhpcy5zdG9yZS5zdGF0ZS50b3BiYXJFbXB0eSA9ICEoKF9hID0gdGhpcy5lbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5U2VsZWN0b3IoYFtzbG90PVwidG9wLWJhclwiXWApKTtcbiAgICB9O1xuICAgIHRoaXMudXBkYXRlU29ydEVtcHR5ID0gKCkgPT4ge1xuICAgICAgdmFyIF9hO1xuICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5zb3J0RW1wdHkgPSAhKChfYSA9IHRoaXMuZWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5xdWVyeVNlbGVjdG9yKGBbc2xvdD1cInNvcnRcIl1gKSk7XG4gICAgfTtcbiAgICB0aGlzLmZpbHRlck11dGF0aW9uT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcih0aGlzLnVwZGF0ZUZpbHRlcnNFbXB0eSk7XG4gICAgdGhpcy50b3BiYXJNdXRhdGlvbk9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIodGhpcy51cGRhdGVUb3BiYXJFbXB0eSk7XG4gICAgdGhpcy5zb3J0TXV0YXRpb25PYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKHRoaXMudXBkYXRlU29ydEVtcHR5KTtcbiAgICB0aGlzLmZldGNoR3JvdXBzID0gZGVib3VuY2UoYXN5bmMgKCkgPT4ge1xuICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgIHRoaXMuY3VycmVudFJlc3VsdHMgPSBbXTtcbiAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyTG9hZGluZy5lbWl0KCk7XG4gICAgICB0aGlzLnN0b3JlLnN0YXRlLnByZXZpZXcgPSBudWxsO1xuICAgICAgaWYgKCF0aGlzLnBvcnRhbCB8fCAhdGhpcy5hbGxvd0ZldGNoKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGxldCBxdWVyeSA9IHRoaXMuZ2V0UXVlcnkoKTtcbiAgICAgIGlmICh0aGlzLnByZWZsaWdodCkge1xuICAgICAgICBxdWVyeSA9IGF3YWl0IHRoaXMucHJlZmxpZ2h0KHF1ZXJ5KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgbWluRGVsYXkodGhpcy5xdWVyeUdyb3VwcyhxdWVyeSksIDUwMCk7XG4gICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclVwZGF0ZS5lbWl0KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCByZXNwb25zZSksIHsgc2VsZWN0ZWRHcm91cHM6IHRoaXMuc2VsZWN0ZWRHcm91cHMsIGZpbHRlcnM6IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVycyksIHNlYXJjaFRlcm06IHRoaXMuc2VhcmNoVGVybSB9KSwgdGhpcy5zb3J0KSk7XG4gICAgICB0aGlzLmN1cnJlbnRSZXNwb25zZSA9IHJlc3BvbnNlO1xuICAgICAgdGhpcy5jdXJyZW50UmVzdWx0cyA9IHJlc3BvbnNlLnJlc3VsdHM7XG4gICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICB9LCAxNTApO1xuICAgIHRoaXMuaGFuZGxlUmVzaXplRXZlbnQgPSAoZSkgPT4ge1xuICAgICAgdGhpcy5yZXNpemUoZSk7XG4gICAgfTtcbiAgICB0aGlzLnJlbmRlclNlbGVjdGVkSXRlbSA9IChzZWxlY3RlZEdyb3VwKSA9PiB7XG4gICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc2VsZWN0ZWQtaXRlbVwiLCB7IGtleTogc2VsZWN0ZWRHcm91cC5pZCwgaGVhZGluZzogc2VsZWN0ZWRHcm91cC50aXRsZSwgb25BcmNnaXNTZWxlY3RlZEl0ZW1SZW1vdmU6ICgpID0+IHtcbiAgICAgICAgICB0aGlzLmRlc2VsZWN0R3JvdXAoc2VsZWN0ZWRHcm91cCk7XG4gICAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJTZWxlY3QuZW1pdCh0aGlzLnNlbGVjdGVkR3JvdXBzKTtcbiAgICAgICAgfSB9LCBoKFwiYXJjZ2lzLWdyb3VwLXRodW1ibmFpbFwiLCB7IHNsb3Q6IFwiY29udGVudC1zdGFydFwiLCBncm91cDogc2VsZWN0ZWRHcm91cCwgcG9ydGFsOiB0aGlzLnBvcnRhbCwgc2NhbGU6IFwic1wiIH0pKSk7XG4gICAgfTtcbiAgICB0aGlzLmFwaSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zZWFyY2hVc2VyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuY29uZmlnID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2VsZWN0aW9uID0gXCJub25lXCI7XG4gICAgdGhpcy52aWV3ID0gXCJsaXN0XCI7XG4gICAgdGhpcy5udW0gPSAyMDtcbiAgICB0aGlzLnEgPSBcIlwiO1xuICAgIHRoaXMuc2VsZWN0ZWRHcm91cHMgPSBbXTtcbiAgICB0aGlzLnByZWZsaWdodCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmZldGNoID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaGlkZVByZXZpZXdGb290ZXIgPSBmYWxzZTtcbiAgICB0aGlzLmhpZGVQcmV2aWV3QmFkZ2VzID0gZmFsc2U7XG4gICAgdGhpcy5oYXNJbmRvb3JzU3BhY2VzID0gZmFsc2U7XG4gICAgdGhpcy5oZWlnaHQgPSBcImZ1bGxcIjtcbiAgICB0aGlzLnN0b3JlID0gY3JlYXRlU3RvcmUoeyBmaWx0ZXJzOiB7fSB9KTtcbiAgICB0aGlzLnVzZVBhbmVsTGF5b3V0ID0gZmFsc2U7XG4gICAgdGhpcy5zZWFyY2hUZXJtID0gXCJcIjtcbiAgICB0aGlzLnNvcnQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wYWdlID0geyBudW06IHRoaXMubnVtLCBzdGFydDogMSwgbmV4dFN0YXJ0OiAtMSB9O1xuICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgdGhpcy5mb3JtRmFjdG9yID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucGFnZVJhbmdlVGV4dCA9IFwiXCI7XG4gICAgdGhpcy5wcmV2aWV3R3JvdXAgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jdXJyZW50UmVzcG9uc2UgPSB1bmRlZmluZWQ7XG4gIH1cbiAgLyoqIE1hbnVhbGx5IHRyaWdnZXIgYSBmZXRjaCBvZiBuZXcgcmVzdWx0cyAqL1xuICBhc3luYyByZWZyZXNoKCkge1xuICAgIHRoaXMuZmV0Y2hHcm91cHMoKTtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICBjb25zdCB7IGVsLCBoYXNJbmRvb3JzU3BhY2VzLCBzZWxlY3RlZEdyb3VwcywgdmlldyB9ID0gdGhpcztcbiAgICBjb25zdCBsb2NhbGUgPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKGVsKTtcbiAgICB0aGlzLmkxOG4gPSBsb2NhbGVbMF07XG4gICAgdGhpcy5zdG9yZS5zdGF0ZS5pMThuID0gbG9jYWxlWzBdO1xuICAgIHRoaXMuc3RvcmUuc3RhdGUubGFuZyA9IGxvY2FsZVsxXTtcbiAgICB0aGlzLnN0b3JlLnN0YXRlLnZpZXcgPSB2aWV3O1xuICAgIHRoaXMuc3RvcmUuc3RhdGUuaGFzSW5kb29yc1NwYWNlcyA9IGhhc0luZG9vcnNTcGFjZXM7XG4gICAgdGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3RlZEdyb3VwcyA9IHNlbGVjdGVkR3JvdXBzO1xuICAgIHRoaXMuaW5pdGlhbGl6ZUNvbmZpZygpO1xuICAgIHNldHVwUmVzaXplT2JzZXJ2ZXIodGhpcy5zdG9yZSkub2JzZXJ2ZSh0aGlzLmVsKTtcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzQnJvd3NlclJlc2l6ZVwiLCB0aGlzLmhhbmRsZVJlc2l6ZUV2ZW50KTtcbiAgICB0aGlzLmZpbHRlck11dGF0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShlbCwgeyBjaGlsZExpc3Q6IHRydWUgfSk7XG4gICAgdGhpcy50b3BiYXJNdXRhdGlvbk9ic2VydmVyLm9ic2VydmUoZWwsIHsgY2hpbGRMaXN0OiB0cnVlIH0pO1xuICAgIHRoaXMuc29ydE11dGF0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShlbCwgeyBjaGlsZExpc3Q6IHRydWUgfSk7XG4gICAgdGhpcy51cGRhdGVGaWx0ZXJzRW1wdHkoKTtcbiAgICB0aGlzLnVwZGF0ZVRvcGJhckVtcHR5KCk7XG4gICAgdGhpcy51cGRhdGVTb3J0RW1wdHkoKTtcbiAgICBpZiAodGhpcy51c2VQYW5lbExheW91dCB8fCBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkodGhpcy5lbCwgXCJjYWxjaXRlLXNoZWxsLXBhbmVsXCIpKSB7XG4gICAgICB0aGlzLnN0b3JlLnN0YXRlLnBhbmVsID0gdHJ1ZTtcbiAgICAgIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVyc0V4cGFuZGVkID0gZmFsc2U7XG4gICAgfVxuICB9XG4gIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgKF9hID0gdGhpcy5zdG9yZS5zdGF0ZS5yZXNpemVPYnNlcnZlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnVub2JzZXJ2ZSh0aGlzLmVsKTtcbiAgICB0aGlzLmZpbHRlck11dGF0aW9uT2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgIHRoaXMudG9wYmFyTXV0YXRpb25PYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgdGhpcy5zb3J0TXV0YXRpb25PYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgdGhpcy5maWx0ZXJDbGVhckhhbmRsZXIoZmFsc2UpO1xuICAgIChfYiA9IHRoaXMuZWwpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5yZW1vdmVFdmVudExpc3RlbmVyKFwiYXJjZ2lzQnJvd3NlclJlc2l6ZVwiLCB0aGlzLmhhbmRsZVJlc2l6ZUV2ZW50KTtcbiAgfVxuICB1cGRhdGVVc2VyKG5ld1VzZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgKF9hID0gY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLnVzZXIgPSBuZXdVc2VyKTtcbiAgfVxuICB1cGRhdGVQb3J0YWwobmV3UG9ydGFsKSB7XG4gICAgdmFyIF9hO1xuICAgIChfYSA9IGNvbmZpZ1N0YXRlLnBvcnRhbCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLnBvcnRhbCA9IG5ld1BvcnRhbCk7XG4gIH1cbiAgdXBkYXRlQVBJKG5ld1ZhbHVlKSB7XG4gICAgdmFyIF9hO1xuICAgIChfYSA9IGNvbmZpZ1N0YXRlLmFwaSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLmFwaSA9IG5ld1ZhbHVlKTtcbiAgfVxuICB1cGRhdGVDb25maWcobmV3Q29uZmlnKSB7XG4gICAgdmFyIF9hO1xuICAgIChfYSA9IGNvbmZpZ1N0YXRlLmNvbmZpZykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLmNvbmZpZyA9IG5ld0NvbmZpZyk7XG4gIH1cbiAgdXBkYXRlU2VsZWN0aW9uKG5ld1ZhbHVlKSB7XG4gICAgdGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3Rpb24gPSBuZXdWYWx1ZTtcbiAgfVxuICB1cGRhdGVTZWxlY3RlZEdyb3Vwcyhncm91cHMpIHtcbiAgICB0aGlzLnN0b3JlLnN0YXRlLnNlbGVjdGVkR3JvdXBzID0gZ3JvdXBzO1xuICB9XG4gIHVwZGF0ZVEoKSB7XG4gICAgdGhpcy5mZXRjaEdyb3VwcygpO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgdGhpcy5pbml0aWFsaXplQ29uZmlnKCk7XG4gICAgLy8gaW5pdGlhbGx5LCBmZXRjaCBpcyBsb2NrZWRcbiAgICAvLyB3YWl0IGZvciBhbGwgY29tcG9uZW50cyB0byBlbWl0IGV2ZW50cyBpbXBhY3Rpbmcgc3RhdGUgcHJpb3IgdG8gaW5pdGlhbCBmZXRjaFxuICAgIGF3YWl0IHRpbWVvdXQoNDAwKTtcbiAgICB0aGlzLmFsbG93RmV0Y2ggPSB0cnVlO1xuICAgIGlmIChjb25maWdTdGF0ZS5wb3J0YWwpIHtcbiAgICAgIHRoaXMuZmV0Y2hHcm91cHMoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBvbkNvbmZpZ0NoYW5nZShcInBvcnRhbFwiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZUNvbmZpZygpO1xuICAgICAgICB0aGlzLmZldGNoR3JvdXBzKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgZmlsdGVySGFuZGxlcihlKSB7XG4gICAgY29uc3QgZmlsdGVycyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzKSwgeyBbZS5kZXRhaWwuaWRdOiBlLmRldGFpbCB9KTtcbiAgICAvLyByZW1vdmUgZmlsdGVyIGZyb20gc2V0XG4gICAgaWYgKCFlLmRldGFpbC52YWx1ZSkge1xuICAgICAgZGVsZXRlIGZpbHRlcnNbZS5kZXRhaWwuaWRdO1xuICAgIH1cbiAgICB0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnMgPSBmaWx0ZXJzO1xuICAgIHRoaXMucmVzZXRQYWdpbmF0aW9uKCk7XG4gICAgdGhpcy5mZXRjaEdyb3VwcygpO1xuICB9XG4gIGdlbmVyaWNGaWx0ZXJIYW5kbGVyKGUpIHtcbiAgICB0aGlzLmZpbHRlckhhbmRsZXIoZSk7XG4gIH1cbiAgZmlsdGVyQ2xlYXJIYW5kbGVyKGRvRmV0Y2hHcm91cHMgPSB0cnVlKSB7XG4gICAgdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzID0ge307XG4gICAgdGhpcy5yZXNldFBhZ2luYXRpb24oKTtcbiAgICBkb0ZldGNoR3JvdXBzICYmIHRoaXMuZmV0Y2hHcm91cHMoKTtcbiAgfVxuICBnZW5lcmljRmlsdGVyQ2xlYXJIYW5kbGVyKCkge1xuICAgIHRoaXMuZmlsdGVyQ2xlYXJIYW5kbGVyKCk7XG4gIH1cbiAgZmlsdGVyVG9nZ2xlSGFuZGxlcigpIHtcbiAgICB0aGlzLnN0b3JlLnN0YXRlLnByZXZpZXcgPSBudWxsO1xuICAgIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVyc0V4cGFuZGVkID0gIXRoaXMuc3RvcmUuc3RhdGUuZmlsdGVyc0V4cGFuZGVkO1xuICB9XG4gIHNlYXJjaEhhbmRsZXIoZSkge1xuICAgIGNvbnN0IG5ld1Rlcm0gPSBlLmRldGFpbDtcbiAgICB0aGlzLnNlYXJjaFRlcm0gPSBuZXdUZXJtO1xuICAgIHRoaXMucmVzZXRQYWdpbmF0aW9uKCk7XG4gICAgaWYgKG5ld1Rlcm0pIHtcbiAgICAgIHRoaXMuZmV0Y2hHcm91cHMoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmZldGNoR3JvdXBzLmludm9rZSgpO1xuICAgIH1cbiAgfVxuICBzb3J0SGFuZGxlcihlKSB7XG4gICAgdGhpcy5zb3J0ID0gZS5kZXRhaWw7XG4gICAgdGhpcy5mZXRjaEdyb3VwcygpO1xuICB9XG4gIGFzeW5jIHBhZ2VIYW5kbGVyKGUpIHtcbiAgICB2YXIgX2E7XG4gICAgdGhpcy5wYWdlID0gZS5kZXRhaWw7XG4gICAgaWYgKHRoaXMuYWxsb3dGZXRjaCkge1xuICAgICAgYXdhaXQgdGhpcy5mZXRjaEdyb3VwcygpO1xuICAgICAgYXdhaXQgdGltZW91dCg0MDApO1xuICAgICAgLy8gVE9ETzogZmlndXJlIG91dCB3aHkgYSByZWYgZG9lc24ndCB3b3JrIGZvciB0aGlzIGVsZW1lbnRcbiAgICAgIChfYSA9IHRoaXMuZWwuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKFwiLmNvbnRlbnRfX3ZpZXdcIikpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zY3JvbGxUbyh7XG4gICAgICAgIHRvcDogMCxcbiAgICAgICAgYmVoYXZpb3I6IFwic21vb3RoXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICBzZWxlY3RIYW5kbGVyKGUpIHtcbiAgICBjb25zdCB7IHNlbGVjdGVkLCBncm91cCB9ID0gZS5kZXRhaWw7XG4gICAgc3dpdGNoICh0aGlzLnNlbGVjdGlvbikge1xuICAgICAgY2FzZSBcInNpbmdsZVwiOlxuICAgICAgICB0aGlzLnNlbGVjdGVkR3JvdXBzID0gW2dyb3VwXTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwibXVsdGlwbGVcIjpcbiAgICAgICAgaWYgKHNlbGVjdGVkKSB7XG4gICAgICAgICAgdGhpcy5zZWxlY3RHcm91cChncm91cCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy5kZXNlbGVjdEdyb3VwKGdyb3VwKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJTZWxlY3QuZW1pdCh0aGlzLnNlbGVjdGVkR3JvdXBzKTtcbiAgfVxuICBhc3luYyB0b2dnbGVQcmV2aWV3KHsgZGV0YWlsIH0pIHtcbiAgICB0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnNFeHBhbmRlZCA9IGZhbHNlO1xuICAgIGlmICghZGV0YWlsIHx8IHRoaXMuc3RvcmUuc3RhdGUucHJldmlldyA9PT0gZGV0YWlsLmlkKSB7XG4gICAgICB0aGlzLnN0b3JlLnN0YXRlLnByZXZpZXcgPSBudWxsO1xuICAgICAgdGhpcy5wcmV2aWV3R3JvdXAgPSBudWxsO1xuICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3LmVtaXQoKTtcbiAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyU3VibGF5ZXJQcmV2aWV3LmVtaXQoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLnJlc3RvcmVGb2N1c0VsZW1lbnQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5wcmV2aWV3ID0gZGV0YWlsLmlkO1xuICAgICAgdGhpcy5wcmV2aWV3R3JvdXAgPSBPYmplY3QuYXNzaWduKHt9LCBkZXRhaWwpO1xuICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3LmVtaXQoT2JqZWN0LmFzc2lnbih7fSwgZGV0YWlsKSk7XG4gICAgfVxuICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VySW50ZXJuYWxVSUFjdGlvbi5lbWl0KHtcbiAgICAgIGFjdGlvbjogdGhpcy5wcmV2aWV3R3JvdXAgPyBcIm9wZW4gcGFuZWxcIiA6IFwiY2xvc2UgcGFuZWxcIixcbiAgICAgIGNhdGVnb3J5OiBcImNhcmQgYWN0aW9uXCJcbiAgICB9KTtcbiAgfVxuICBhc3luYyBpbml0aWFsaXplQ29uZmlnKCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICAoX2EgPSBjb25maWdTdGF0ZS5hcGkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChjb25maWdTdGF0ZS5hcGkgPSB0aGlzLmFwaSk7XG4gICAgKF9iID0gY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogKGNvbmZpZ1N0YXRlLnVzZXIgPSB0aGlzLnVzZXIpO1xuICAgIChfYyA9IGNvbmZpZ1N0YXRlLnBvcnRhbCkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogKGNvbmZpZ1N0YXRlLnBvcnRhbCA9IHRoaXMucG9ydGFsKTtcbiAgICAoX2QgPSBjb25maWdTdGF0ZS5jb25maWcpICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IChjb25maWdTdGF0ZS5jb25maWcgPSB0aGlzLmNvbmZpZyk7XG4gIH1cbiAgcmVzZXRQYWdpbmF0aW9uKCkge1xuICAgIHRoaXMucGFnZS5zdGFydCA9IDE7XG4gICAgdGhpcy5wYWdlLnRvdGFsID0gMDtcbiAgfVxuICBnZXRRdWVyeSgpIHtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHsgZmlsdGVyczogdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzLCBzZWFyY2hVc2VyOiB0aGlzLnNlYXJjaFVzZXIsIHNlYXJjaFRlcm06IHRoaXMuc2VhcmNoVGVybSwgYmFzZVF1ZXJ5OiB0aGlzLnEgfSwgdGhpcy5zb3J0KSwgdGhpcy5wYWdlKTtcbiAgfVxuICBxdWVyeUdyb3VwcyhxdWVyeSkge1xuICAgIGlmICh0aGlzLmZldGNoKSB7XG4gICAgICByZXR1cm4gdGhpcy5mZXRjaChxdWVyeSk7XG4gICAgfVxuICAgIHJldHVybiBxdWVyeUdyb3Vwcyh0aGlzLnBvcnRhbCwgcXVlcnkpO1xuICB9XG4gIHJlc3RvcmVGb2N1cygpIHtcbiAgICBpZiAodGhpcy5yZXN0b3JlRm9jdXNFbGVtZW50KSB7XG4gICAgICBjb25zdCBlbCA9IHRoaXMucmVzdG9yZUZvY3VzRWxlbWVudDtcbiAgICAgIGlmIChlbC5yZXN0b3JlRm9jdXMpIHtcbiAgICAgICAgZWwucmVzdG9yZUZvY3VzKCk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChlbC5zZXRGb2N1cykge1xuICAgICAgICBlbC5zZXRGb2N1cygpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoZWwuZm9jdXMpIHtcbiAgICAgICAgZWwuZm9jdXMoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgc2VsZWN0R3JvdXAoZ3JvdXApIHtcbiAgICBpZiAoIXRoaXMuaXNTZWxlY3RlZChncm91cCkpIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRHcm91cHMgPSBbLi4udGhpcy5zZWxlY3RlZEdyb3VwcywgZ3JvdXBdO1xuICAgIH1cbiAgfVxuICBkZXNlbGVjdEdyb3VwKGdyb3VwKSB7XG4gICAgdGhpcy5zZWxlY3RlZEdyb3VwcyA9IHRoaXMuc2VsZWN0ZWRHcm91cHMuZmlsdGVyKCh7IGlkIH0pID0+IGlkICE9PSBncm91cC5pZCk7XG4gIH1cbiAgaXNTZWxlY3RlZChncm91cCkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gKF9hID0gdGhpcy5zZWxlY3RlZEdyb3VwcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNvbWUoKHsgaWQgfSkgPT4gZ3JvdXAuaWQgPT09IGlkKTtcbiAgfVxuICByZXNpemUoeyBkZXRhaWw6IHsgd2lkdGgsIGhlaWdodCB9IH0pIHtcbiAgICB0aGlzLmZvcm1GYWN0b3IgPSB3aWR0aCA+IGJyZWFrcG9pbnRzLnNtID8gXCJsYXJnZVwiIDogXCJzbWFsbFwiO1xuICAgIGNvbnN0IG9sZEZvcm1GYWN0b3IgPSB0aGlzLnN0b3JlLnN0YXRlLndpZHRoID4gYnJlYWtwb2ludHMuc20gPyBcImxhcmdlXCIgOiBcInNtYWxsXCI7XG4gICAgLyoqIHdoZW4gZ29pbmcgZnJvbSBsYXJnZSB0byBzbWFsbCBvciBzbWFsbCB0byBsYXJnZSwgY29sbGFwc2Ugb3IgZXhwYW5kIGZpbHRlcnMsIGFjY29yZGluZ2x5ICovXG4gICAgaWYgKG9sZEZvcm1GYWN0b3IgPT09IFwibGFyZ2VcIiAmJiB0aGlzLmZvcm1GYWN0b3IgPT09IFwic21hbGxcIikge1xuICAgICAgLyoqIHVzZSBwYW5lbCBsYXlvdXQgaWYgZW5hYmxlZCBvbiBzbWFsbGVyIGdyb3VwIGJyb3dzZXJzICovXG4gICAgICB0aGlzLnN0b3JlLnN0YXRlLnBhbmVsID0gdGhpcy51c2VQYW5lbExheW91dDtcbiAgICAgIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVyc0V4cGFuZGVkID0gZmFsc2U7XG4gICAgfVxuICAgIGlmIChvbGRGb3JtRmFjdG9yID09PSBcInNtYWxsXCIgJiYgdGhpcy5mb3JtRmFjdG9yID09PSBcImxhcmdlXCIpIHtcbiAgICAgIC8qKiBwYW5lbCBsYXlvdXQgd29uJ3Qgd29yayBvbiBsYXJnZXIgZ3JvdXAgYnJvd3NlcnMgKi9cbiAgICAgIHRoaXMuc3RvcmUuc3RhdGUucGFuZWwgPSBmYWxzZTtcbiAgICAgIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVyc0V4cGFuZGVkID0gdHJ1ZTtcbiAgICB9XG4gICAgdGhpcy5zdG9yZS5zdGF0ZS53aWR0aCA9IHdpZHRoO1xuICAgIHRoaXMuc3RvcmUuc3RhdGUuaGVpZ2h0ID0gaGVpZ2h0O1xuICB9XG4gIHJlbmRlclNlbGVjdGVkKCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICBjb25zdCB3aG9sZVBhZ2VTZWxlY3RlZCA9IChfYSA9IHRoaXMuY3VycmVudFJlc3VsdHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5ldmVyeSgoZ3JvdXApID0+IHRoaXMuaXNTZWxlY3RlZChncm91cCkpO1xuICAgIGNvbnN0IHRvdGFsU2VsZWN0ZWQgPSAoX2IgPSB0aGlzLnNlbGVjdGVkR3JvdXBzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoO1xuICAgIHJldHVybiAoaChcImFyY2dpcy1zZWxlY3RlZFwiLCB7IHNsb3Q6IFwic2VsZWN0aW9uXCIsIGxvYWRpbmc6IHRoaXMubG9hZGluZywgdG90YWw6IChfYyA9IHRoaXMuY3VycmVudFJlc3VsdHMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5sZW5ndGgsIHRvdGFsU2VsZWN0ZWQ6IHRvdGFsU2VsZWN0ZWQsIGVtcHR5VGV4dDogdGhpcy5pMThuLmdyb3VwQnJvd3Nlci5ub1NlbGVjdGVkR3JvdXBzLCBoZWFkaW5nOiB0aGlzLmkxOG4uZ3JvdXBCcm93c2VyLnNlbGVjdGVkR3JvdXBzLCBjaGVja2VkOiAhdGhpcy5sb2FkaW5nICYmIHdob2xlUGFnZVNlbGVjdGVkLCBpbmRldGVybWluYXRlOiAhd2hvbGVQYWdlU2VsZWN0ZWQgJiYgISF0b3RhbFNlbGVjdGVkLCBvbkFyY2dpc1NlbGVjdGVkRGVzZWxlY3RBbGw6ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEdyb3VwcyA9IFtdO1xuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclNlbGVjdC5lbWl0KHRoaXMuc2VsZWN0ZWRHcm91cHMpO1xuICAgICAgfSwgb25BcmNnaXNTZWxlY3RlZFNlbGVjdFBhZ2U6ICgpID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmN1cnJlbnRSZXN1bHRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgICAgICB0aGlzLnNlbGVjdEdyb3VwKGdyb3VwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyU2VsZWN0LmVtaXQodGhpcy5zZWxlY3RlZEdyb3Vwcyk7XG4gICAgICB9IH0sIChfZCA9IHRoaXMuc2VsZWN0ZWRHcm91cHMpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5tYXAodGhpcy5yZW5kZXJTZWxlY3RlZEl0ZW0pKSk7XG4gIH1cbiAgcmVuZGVyU2xvdChuYW1lLCBkZWZhdWx0Q29udGVudCkge1xuICAgIHJldHVybiAoaChcImRpdlwiLCB7IHNsb3Q6IG5hbWUgfSwgaChcInNsb3RcIiwgeyBuYW1lOiBuYW1lIH0sIGRlZmF1bHRDb250ZW50KSkpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGxvYWRpbmcsIGkxOG4sIHNlbGVjdGVkR3JvdXBzLCBzZWxlY3Rpb24sIGN1cnJlbnRSZXNwb25zZSwgc3RvcmUsIGFwaSwgc2VhcmNoVGVybSwgZm9ybUZhY3RvciwgaGVpZ2h0LCByZW5kZXJTbG90IH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiYXJjZ2lzLWJyb3dzZXJcIiwgeyBwcmV2aWV3OiAhIXRoaXMucHJldmlld0dyb3VwLCBsb2FkaW5nOiBsb2FkaW5nLCBzZWxlY3RlZDogc2VsZWN0ZWRHcm91cHMsIGFsd2F5c1Nob3dTZWxlY3Rpb246IHNlbGVjdGlvbiA9PT0gXCJtdWx0aXBsZVwiLCByZXNwb25zZTogY3VycmVudFJlc3BvbnNlLCBzdG9yZTogc3RvcmUsIGFwaTogYXBpLCBmb3JtRmFjdG9yOiBmb3JtRmFjdG9yLCBzZWFyY2hUZXJtOiBzZWFyY2hUZXJtLCBoZWlnaHQ6IGhlaWdodCB9LCByZW5kZXJTbG90KFwidG9wLWJhclwiKSwgcmVuZGVyU2xvdChcInNvcnRcIiksIGgoXCJhcmNnaXMtZ3JvdXAtYnJvd3Nlci1wcmV2aWV3XCIsIHsgc2xvdDogXCJwcmV2aWV3XCIsIGdyb3VwOiB0aGlzLnByZXZpZXdHcm91cCwgcG9ydGFsOiB0aGlzLnBvcnRhbCwgdXNlcjogdGhpcy51c2VyLCBrZXk6IHRoaXMuc3RvcmUuc3RhdGUucHJldmlldywgb25BcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3Q2xvc2U6ICgpID0+IHtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5wcmV2aWV3ID0gbnVsbDtcbiAgICAgICAgdGhpcy5wcmV2aWV3R3JvdXAgPSBudWxsO1xuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclByZXZpZXcuZW1pdCgpO1xuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclN1YmxheWVyUHJldmlldy5lbWl0KCk7XG4gICAgICAgIHRoaXMucmVzdG9yZUZvY3VzKCk7XG4gICAgICB9LCBoaWRlUHJldmlld0Zvb3RlcjogdGhpcy5oaWRlUHJldmlld0Zvb3Rlciwgc2hvd0JhZGdlczogIXRoaXMuaGlkZVByZXZpZXdCYWRnZXMsIGN1cnJlbnRSZXNwb25zZTogdGhpcy5jdXJyZW50UmVzcG9uc2UgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiZm9vdGVyLWFjdGlvblwiIH0sIGgoXCJzbG90XCIsIHsgbmFtZTogXCJwcmV2aWV3LWZvb3Rlci1hY3Rpb25cIiB9KSkpLCB0aGlzLnJlbmRlclNlbGVjdGVkKCksIHJlbmRlclNsb3QoXCJhY3Rpb25zXCIpLCByZW5kZXJTbG90KFwiY29udGVudC1zdGFydFwiKSwgcmVuZGVyU2xvdChcImNvbnRlbnRcIiksIHJlbmRlclNsb3QoXCJjb250ZW50LWVuZFwiKSwgcmVuZGVyU2xvdChcInBhZ2luYXRpb25cIiksIHJlbmRlclNsb3QoXCJmaWx0ZXJzXCIpLCByZW5kZXJTbG90KFwic2Nyb2xsLWVuZFwiKSwgcmVuZGVyU2xvdChcIm5vLXJlc3VsdHNcIiwgaTE4bi5jb250ZW50Lm5vUmVzdWx0cyksIHJlbmRlclNsb3QoXCJuby1jb250ZW50XCIsIGkxOG4uY29udGVudC5ub0NvbnRlbnQpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICBcInVzZXJcIjogW1widXBkYXRlVXNlclwiXSxcbiAgICBcInBvcnRhbFwiOiBbXCJ1cGRhdGVQb3J0YWxcIl0sXG4gICAgXCJhcGlcIjogW1widXBkYXRlQVBJXCJdLFxuICAgIFwiY29uZmlnXCI6IFtcInVwZGF0ZUNvbmZpZ1wiXSxcbiAgICBcInNlbGVjdGlvblwiOiBbXCJ1cGRhdGVTZWxlY3Rpb25cIl0sXG4gICAgXCJzZWxlY3RlZEdyb3Vwc1wiOiBbXCJ1cGRhdGVTZWxlY3RlZEdyb3Vwc1wiXSxcbiAgICBcInFcIjogW1widXBkYXRlUVwiXVxuICB9OyB9XG59O1xuQXJjZ2lzR3JvdXBCcm93c2VyLnN0eWxlID0gYXJjZ2lzR3JvdXBCcm93c2VyQ3NzO1xuXG5jb25zdCBBcmNnaXNHcm91cEJyb3dzZXJBY3Rpb25zID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFjdGlvbnMgPSBbXTtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLnN0b3JlID0gZ2V0R3JvdXBCcm93c2VyU3RvcmUodGhpcy5lbCk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiYXJjZ2lzLWJyb3dzZXItYWN0aW9uc1wiLCB7IGFjdGlvbnM6IHRoaXMuYWN0aW9ucywgc2VsZWN0aW9uOiB0aGlzLnN0b3JlLnN0YXRlLnNlbGVjdGVkR3JvdXBzIH0pKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcblxuY29uc3QgYXJjZ2lzR3JvdXBCcm93c2VyQ29udGVudENzcyA9IFwiOmhvc3R7LS1hcmNnaXMtZ3JvdXAtYnJvd3Nlci1jb2x1bW5zOnJlcGVhdCgxLCAxZnIpOy0tYXJjZ2lzLWdyb3VwLWJyb3dzZXItZ2FwOjAuNXJlbX0ubGlzdCBzbG90LC5jb21wYWN0IHNsb3R7ZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczp2YXIoLS1hcmNnaXMtZ3JvdXAtYnJvd3Nlci1jb2x1bW5zKX0uY29tcGFjdCBzbG90e2dyaWQtZ2FwOjA7Z2FwOjB9Lmxpc3Qgc2xvdHtnYXA6dmFyKC0tYXJjZ2lzLWdyb3VwLWJyb3dzZXItZ2FwKX1cIjtcblxuY29uc3QgQXJjZ2lzR3JvdXBCcm93c2VyQ29udGVudCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdG9yZSA9IGdldEdyb3VwQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB2aWV3ID0gdGhpcy5zdG9yZS5zdGF0ZS52aWV3O1xuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiZGl2XCIsIHsgY2xhc3M6IHtcbiAgICAgICAgW3ZpZXddOiB0cnVlLFxuICAgICAgICBcIm5vLXNwYWNlXCI6IHRoaXMuc3RvcmUuc3RhdGUud2lkdGggPCBicmVha3BvaW50cy54cyAmJiB0aGlzLnN0b3JlLnN0YXRlLnBhbmVsXG4gICAgICB9IH0sIGgoXCJzbG90XCIsIG51bGwpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNHcm91cEJyb3dzZXJDb250ZW50LnN0eWxlID0gYXJjZ2lzR3JvdXBCcm93c2VyQ29udGVudENzcztcblxuY29uc3QgQXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyRGF0ZSA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0dyb3VwQnJvd3NlckZpbHRlclwiLCA3KTtcbiAgICB0aGlzLnByb3BlcnR5ID0gXCJtb2RpZmllZFwiO1xuICAgIHRoaXMucmFuZ2UgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zdGFydCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmVuZCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmV4cGFuZGVkID0gdW5kZWZpbmVkO1xuICB9XG4gIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuc3RvcmUgPSBnZXRHcm91cEJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgfVxuICBnZXRFdmVudERldGFpbChkZXRhaWwpIHtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7IHBhcmFtOiBcInFcIiB9LCBkZXRhaWwpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IHByb3BlcnR5LCByYW5nZSwgc3RhcnQsIGVuZCwgc3RvcmUsIGV4cGFuZGVkIH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChcImFyY2dpcy1icm93c2VyLWZpbHRlci1kYXRlXCIsIHsgc2VydmVyUHJvcGVydHk6IHByb3BlcnR5LCBwcm9wZXJ0eTogcHJvcGVydHksIHN0b3JlOiBzdG9yZSwgc3RhcnQ6IHN0YXJ0LCBlbmQ6IGVuZCwgcmFuZ2U6IHJhbmdlLCBleHBhbmRlZDogZXhwYW5kZWQsIG9uQXJjZ2lzQnJvd3NlckZpbHRlcjogKGUpID0+IHtcbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKGUuZGV0YWlsKSk7XG4gICAgICB9IH0pKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXJHcm91cHNCeVVzZXIgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyVXNlcm5hbWVzRmlsdGVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNHcm91cEJyb3dzZXJVc2VybmFtZXNGaWx0ZXJcIiwgNyk7XG4gICAgdGhpcy5zZWFyY2hVc2VybmFtZXMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zZWFyY2hVc2VybmFtZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm93bmVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZXhwYW5kZWQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5hbGxVc2VybmFtZXMgPSBbXTtcbiAgICB0aGlzLnNlbGVjdGVkVXNlcm5hbWUgPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgdGhpcy5zdG9yZSA9IGdldEdyb3VwQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5maWx0ZXJHcm91cHNCeVVzZXI7XG4gICAgdGhpcy5zZWxlY3RlZFVzZXJuYW1lID1cbiAgICAgIChfYiA9IChfYSA9IHRoaXMuc2VhcmNoVXNlcm5hbWUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHRoaXMuc2VhcmNoVXNlcm5hbWVzWzBdKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAoX2MgPSBjb25maWdTdGF0ZS51c2VyKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MudXNlcm5hbWU7XG4gIH1cbiAgYXN5bmMgc2VhcmNoVXNlcm5hbWVzQ2hhbmdlZCgpIHtcbiAgICB0aGlzLmFsbFVzZXJuYW1lcyA9IHRoaXMuc2VhcmNoVXNlcm5hbWVzO1xuICB9XG4gIGFzeW5jIHNlYXJjaFVzZXJuYW1lQ2hhbmdlZCgpIHtcbiAgICB0aGlzLnNlbGVjdGVkVXNlcm5hbWUgPSB0aGlzLnNlYXJjaFVzZXJuYW1lO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyBhbGxVc2VybmFtZXMsIHNlbGVjdGVkVXNlcm5hbWUsIHNlYXJjaFVzZXJuYW1lLCBpMThuIH0gPSB0aGlzO1xuICAgIGNvbnN0IGN1cnJlbnRVc2VybmFtZSA9IChfYSA9IGNvbmZpZ1N0YXRlLnVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51c2VybmFtZTtcbiAgICByZXR1cm4gKGgoXCJhcmNnaXMtYnJvd3Nlci1maWx0ZXJcIiwgeyBoZWFkaW5nOiB0aGlzLmkxOG4udGl0bGUsIGV4cGFuZGVkOiB0aGlzLmV4cGFuZGVkLCBvbkFyY2dpc0Jyb3dzZXJGaWx0ZXJSZW1vdmU6ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZFVzZXJuYW1lID0gc2VhcmNoVXNlcm5hbWU7XG4gICAgICB9IH0sIGgoXCJjYWxjaXRlLXRyZWVcIiwgeyBzZWxlY3Rpb25Nb2RlOiBcInNpbmdsZVwiLCBzY2FsZTogXCJtXCIsIG9uQ2FsY2l0ZVRyZWVTZWxlY3Q6IChldmVudCkgPT4ge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICBjb25zdCBzZWxlY3RlZFVzZXJuYW1lID0gKChfYiA9IChfYSA9IG5vZGUuc2VsZWN0ZWRJdGVtcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZGF0YXNldC51c2VybmFtZSkgfHwgXCJcIjtcbiAgICAgICAgdGhpcy5zZWxlY3RlZFVzZXJuYW1lID0gc2VsZWN0ZWRVc2VybmFtZTtcbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJVc2VybmFtZXNGaWx0ZXIuZW1pdChzZWxlY3RlZFVzZXJuYW1lKTtcbiAgICAgIH0gfSwgYWxsVXNlcm5hbWVzLm1hcCgodXNlcm5hbWUpID0+IChoKFwiY2FsY2l0ZS10cmVlLWl0ZW1cIiwgeyBcImRhdGEtdXNlcm5hbWVcIjogdXNlcm5hbWUsIHNlbGVjdGVkOiB1c2VybmFtZSA9PT0gc2VsZWN0ZWRVc2VybmFtZSB9LCBoKFwiYVwiLCBudWxsLCB1c2VybmFtZSA9PT0gY3VycmVudFVzZXJuYW1lID8gaTE4bi5tZS5yZXBsYWNlKFwiJHt1c2VybmFtZX1cIiwgdXNlcm5hbWUpIDogdXNlcm5hbWUpKSkpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICBcInNlYXJjaFVzZXJuYW1lc1wiOiBbXCJzZWFyY2hVc2VybmFtZXNDaGFuZ2VkXCJdLFxuICAgIFwic2VhcmNoVXNlcm5hbWVcIjogW1wic2VhcmNoVXNlcm5hbWVDaGFuZ2VkXCJdXG4gIH07IH1cbn07XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlckZpbHRlck1lbWJlck9yZyA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0dyb3VwQnJvd3NlckZpbHRlclwiLCA3KTtcbiAgICB0aGlzLm1lbWJlck9yZyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm9yZ0lkID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZXhwYW5kZWQgPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdG9yZSA9IGdldEdyb3VwQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5maWx0ZXJNZW1iZXJPcmc7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICBpZiAodGhpcy5tZW1iZXJPcmcpIHtcbiAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICB9XG4gICAgb25Ccm93c2VyRmlsdGVyUmVtb3ZlKFwibWVtYmVyT3JnXCIsIHRoaXMuc3RvcmUsICgpID0+ICh0aGlzLm1lbWJlck9yZyA9IG51bGwpKTtcbiAgfVxuICBnZXRRdWVyeVZhbHVlKCkge1xuICAgIGNvbnN0IHsgdXNlcm5hbWUgfSA9IGNvbmZpZ1N0YXRlLnVzZXI7XG4gICAgY29uc3Qgb3JnaWQgPSBjb25maWdTdGF0ZS5wb3J0YWwuaWQ7XG4gICAgaWYgKCF1c2VybmFtZSB8fCAhb3JnaWQpIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbiAgICBzd2l0Y2ggKHRoaXMubWVtYmVyT3JnKSB7XG4gICAgICBjYXNlIFwibXlPcmdcIjpcbiAgICAgICAgcmV0dXJuIFwibWVtYmVyb3JnaWRzOk5VTExcIjtcbiAgICAgIGNhc2UgXCJhbm90aGVyT3JnXCI6XG4gICAgICAgIGlmICh0aGlzLm9yZ0lkKSB7XG4gICAgICAgICAgcmV0dXJuIGAobWVtYmVyb3JnaWRzOiR7dGhpcy5vcmdJZH0gT1Igb3JnaWQ6JHt0aGlzLm9yZ0lkfSlgO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHJldHVybiBcIi1tZW1iZXJvcmdpZHM6TlVMTFwiO1xuICAgICAgICB9XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gIH1cbiAgZ2V0RXZlbnREZXRhaWwoKSB7XG4gICAgY29uc3QgeyBtZW1iZXJPcmcsIG9yZ0lkIH0gPSB0aGlzO1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRRdWVyeVZhbHVlKCk7XG4gICAgY29uc3QgbGFiZWwgPSB0aGlzLmkxOG4ubGFiZWwucmVwbGFjZShcIiR7bGFiZWx9XCIsIHRoaXMuaTE4blttZW1iZXJPcmddKTtcbiAgICByZXR1cm4geyBpZDogXCJtZW1iZXJPcmdcIiwgcGFyYW06IFwicVwiLCB2YWx1ZSwgbGFiZWwsIG1lbWJlck9yZywgb3JnSWQgfTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgdmFyIF9hO1xuICAgIC8vIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1wb3J0YWwtYXBwL2lzc3Vlcy80NDE5OFxuICAgIGlmICgoX2EgPSBjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUucG9ydGFsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaXNQb3J0YWwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gKGgoXCJhcmNnaXMtYnJvd3Nlci1maWx0ZXJcIiwgeyBoZWFkaW5nOiB0aGlzLmkxOG4uY3VycmVudE1lbWJlcnNBcmVGcm9tLCBleHBhbmRlZDogdGhpcy5leHBhbmRlZCwgYWN0aXZlOiAhIXRoaXMubWVtYmVyT3JnLCBvbkFyY2dpc0Jyb3dzZXJGaWx0ZXJSZW1vdmU6ICgpID0+IHtcbiAgICAgICAgdGhpcy5tZW1iZXJPcmcgPSBudWxsO1xuICAgICAgICB0aGlzLm9yZ0lkID0gbnVsbDtcbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgICAgfSB9LCBoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2VsZWN0aW9uTW9kZTogXCJzaW5nbGVcIiwgc2NhbGU6IFwibVwiLCBvbkNhbGNpdGVUcmVlU2VsZWN0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgY29uc3QgbWVtYmVyT3JnID0gKChfYiA9IChfYSA9IG5vZGUuc2VsZWN0ZWRJdGVtcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZGF0YXNldC5tZW1iZXJPcmcpIHx8IFwiXCI7XG4gICAgICAgIGlmICh0aGlzLm1lbWJlck9yZyA9PT0gbWVtYmVyT3JnKSB7XG4gICAgICAgICAgdGhpcy5tZW1iZXJPcmcgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHRoaXMubWVtYmVyT3JnID0gbWVtYmVyT3JnO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgIH0gfSwgW1wibXlPcmdcIiwgXCJhbm90aGVyT3JnXCJdLm1hcCgobWVtYmVyT3JnKSA9PiAoaChcImNhbGNpdGUtdHJlZS1pdGVtXCIsIHsgXCJkYXRhLW1lbWJlci1vcmdcIjogbWVtYmVyT3JnLCBzZWxlY3RlZDogbWVtYmVyT3JnID09PSB0aGlzLm1lbWJlck9yZyB9LCBoKFwiYVwiLCBudWxsLCB0aGlzLmkxOG5bbWVtYmVyT3JnXSkpKSkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcblxuY29uc3QgQXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyTWVtYmVyc2hpcCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0dyb3VwQnJvd3NlckZpbHRlclwiLCA3KTtcbiAgICB0aGlzLmhhc0luZG9vcnNTcGFjZXMgPSBmYWxzZTtcbiAgICB0aGlzLm1lbWJlcnNoaXAgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5leHBhbmRlZCA9IHVuZGVmaW5lZDtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLnN0b3JlID0gZ2V0R3JvdXBCcm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlck1lbWJlcnNoaXA7XG4gICAgdGhpcy5oYXNJbmRvb3JzU3BhY2VzID0gdGhpcy5zdG9yZS5zdGF0ZS5oYXNJbmRvb3JzU3BhY2VzO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgaWYgKHRoaXMubWVtYmVyc2hpcCkge1xuICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgIH1cbiAgICBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUoXCJtZW1iZXJzaGlwXCIsIHRoaXMuc3RvcmUsICgpID0+ICh0aGlzLm1lbWJlcnNoaXAgPSBudWxsKSk7XG4gIH1cbiAgZ2V0UXVlcnlWYWx1ZSgpIHtcbiAgICAvLyBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL3dlYmdpcy9hcmNnaXMtcG9ydGFsLWFwcC9pc3N1ZXMvMzc4MzFcbiAgICBpZiAodGhpcy5oYXNJbmRvb3JzU3BhY2VzKSB7XG4gICAgICByZXR1cm4gXCJtZW1iZXJzaGlwYWNjZXNzOm9yZ1wiO1xuICAgIH1cbiAgICBzd2l0Y2ggKHRoaXMubWVtYmVyc2hpcCkge1xuICAgICAgY2FzZSBcIm9yZ1wiOlxuICAgICAgICByZXR1cm4gXCJtZW1iZXJzaGlwYWNjZXNzOm9yZ1wiO1xuICAgICAgY2FzZSBcImNvbGxhYm9yYXRpb25cIjpcbiAgICAgICAgcmV0dXJuIFwibWVtYmVyc2hpcGFjY2Vzczpjb2xsYWJvcmF0aW9uXCI7XG4gICAgICBjYXNlIFwiYW55T3JnXCI6XG4gICAgICAgIHJldHVybiBcIm1lbWJlcnNoaXBhY2Nlc3M6TlVMTFwiO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuICB9XG4gIGdldEV2ZW50RGV0YWlsKCkge1xuICAgIGNvbnN0IHsgbWVtYmVyc2hpcCB9ID0gdGhpcztcbiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0UXVlcnlWYWx1ZSgpO1xuICAgIGNvbnN0IGxhYmVsID0gdGhpcy5pMThuLmxhYmVsLnJlcGxhY2UoXCIke2xhYmVsfVwiLCB0aGlzLmkxOG5bbWVtYmVyc2hpcF0pO1xuICAgIHJldHVybiB7IGlkOiBcIm1lbWJlcnNoaXBcIiwgcGFyYW06IFwicVwiLCB2YWx1ZSwgbGFiZWwsIG1lbWJlcnNoaXAgfTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgdmFyIF9hO1xuICAgIGlmIChcbiAgICAvLyBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL3dlYmdpcy9hcmNnaXMtcG9ydGFsLWFwcC9pc3N1ZXMvMzc4MzFcbiAgICB0aGlzLmhhc0luZG9vcnNTcGFjZXMgfHxcbiAgICAgIChcbiAgICAgIC8vIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1wb3J0YWwtYXBwL2lzc3Vlcy80NDE5OFxuICAgICAgKF9hID0gY29uZmlnU3RhdGUgPT09IG51bGwgfHwgY29uZmlnU3RhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbmZpZ1N0YXRlLnBvcnRhbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzUG9ydGFsKSkge1xuICAgICAgLy8gVGhpcyB3aWxsIHJlbGllcyBvbiB0aGUgZXZlbnQgZW1pdHRlZCBpbiBgY29tcG9uZW50RGlkTG9hZGAgdG8gc2V0IHRoZSBwcm9wZXIgYmFzZSBxIHZhbHVlXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIChoKFwiYXJjZ2lzLWJyb3dzZXItZmlsdGVyXCIsIHsgaGVhZGluZzogdGhpcy5pMThuLmdyb3VwTWVtYmVyc2hpcFNldHRpbmcsIGV4cGFuZGVkOiB0aGlzLmV4cGFuZGVkLCBhY3RpdmU6ICEhdGhpcy5tZW1iZXJzaGlwLCBvbkFyY2dpc0Jyb3dzZXJGaWx0ZXJSZW1vdmU6ICgpID0+IHtcbiAgICAgICAgdGhpcy5tZW1iZXJzaGlwID0gbnVsbDtcbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgICAgfSB9LCBoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2VsZWN0aW9uTW9kZTogXCJzaW5nbGVcIiwgc2NhbGU6IFwibVwiLCBvbkNhbGNpdGVUcmVlU2VsZWN0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgY29uc3QgbWVtYmVyc2hpcCA9ICgoX2IgPSAoX2EgPSBub2RlLnNlbGVjdGVkSXRlbXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmRhdGFzZXQubWVtYmVyc2hpcCkgfHwgXCJcIjtcbiAgICAgICAgaWYgKHRoaXMubWVtYmVyc2hpcCA9PT0gbWVtYmVyc2hpcCkge1xuICAgICAgICAgIHRoaXMubWVtYmVyc2hpcCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy5tZW1iZXJzaGlwID0gbWVtYmVyc2hpcDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgICB9IH0sIFtcIm9yZ1wiLCBcImNvbGxhYm9yYXRpb25cIiwgXCJhbnlPcmdcIl0ubWFwKChtZW1iZXJzaGlwKSA9PiAoaChcImNhbGNpdGUtdHJlZS1pdGVtXCIsIHsgXCJkYXRhLW1lbWJlcnNoaXBcIjogbWVtYmVyc2hpcCwgc2VsZWN0ZWQ6IG1lbWJlcnNoaXAgPT09IHRoaXMubWVtYmVyc2hpcCB9LCBoKFwiYVwiLCBudWxsLCB0aGlzLmkxOG5bbWVtYmVyc2hpcF0pKSkpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlckZpbHRlck93bmVyID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckZpbHRlciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyXCIsIDcpO1xuICAgIHRoaXMuaGFzSW5kb29yc1NwYWNlcyA9IGZhbHNlO1xuICAgIHRoaXMuc2VhcmNoVXNlcm5hbWUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5vd25lciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmV4cGFuZGVkID0gdW5kZWZpbmVkO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuc3RvcmUgPSBnZXRHcm91cEJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4uZmlsdGVyT3duZXI7XG4gICAgdGhpcy5oYXNJbmRvb3JzU3BhY2VzID0gdGhpcy5zdG9yZS5zdGF0ZS5oYXNJbmRvb3JzU3BhY2VzO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBpZiAodGhpcy5vd25lcikge1xuICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgIH1cbiAgICBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUoXCJvd25lclwiLCB0aGlzLnN0b3JlLCAoKSA9PiAodGhpcy5vd25lciA9IG51bGwpKTtcbiAgICAoX2EgPSB0aGlzLnNlYXJjaFVzZXJuYW1lKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAodGhpcy5zZWFyY2hVc2VybmFtZSA9IChfYiA9IGNvbmZpZ1N0YXRlLnVzZXIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi51c2VybmFtZSk7XG4gIH1cbiAgZ2V0UXVlcnlWYWx1ZSgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBjb25zdCB1c2VybmFtZSA9IChfYSA9IHRoaXMuc2VhcmNoVXNlcm5hbWUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYiA9IGNvbmZpZ1N0YXRlLnVzZXIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi51c2VybmFtZTtcbiAgICBjb25zdCBvcmdJZCA9IChfYyA9IGNvbmZpZ1N0YXRlLnBvcnRhbCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmlkO1xuICAgIC8vIFdlIGRvbid0IHdhbnQgdG8gcmV0dXJuIGVtcHR5IHN0cmluZyBldmVuIGlmIG9yZ0lkIGlzIGVtcHR5XG4gICAgLy8gIHRvIG1ha2Ugc3VyZSB0aGUgcXVlcnkgdmFsdWUgc3RpbGwgaGFzIHRoZSBjb3JyZWN0IHN5bnRheFxuICAgIC8vIFRoaXMgbWltaWNzIGJlaGF2aW9yIG9uIHByb2RcbiAgICAvLyBUT0RPOiBmaW5kIGEgYmV0dGVyIHdheSB0byBmaWx0ZXIgdGhhdCBvdXQgaW4gUjNcbiAgICBpZiAoIXVzZXJuYW1lKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gICAgc3dpdGNoICh0aGlzLm93bmVyKSB7XG4gICAgICBjYXNlIFwib3duZXJcIjpcbiAgICAgICAgcmV0dXJuIGBvd25lcjoke3VzZXJuYW1lfWA7XG4gICAgICBjYXNlIFwiaW5PcmdcIjpcbiAgICAgICAgcmV0dXJuIGAtb3duZXI6JHt1c2VybmFtZX0gb3JnaWQ6JHtvcmdJZH1gO1xuICAgICAgY2FzZSBcIm91dHNpZGVPcmdcIjpcbiAgICAgICAgLy8gdGhpcyBtYWdpYyBTUUwgcXVlcnkgZ2V0cyBhbGwgb3JnIGlkcyBhbmQgdGhlbiByZW1vdmVzIHRoZSBjdXJyZW50IG9yZ1xuICAgICAgICByZXR1cm4gYChvcmdpZDogWzAgVE8gXFx7XSkgLW9yZ2lkOiR7b3JnSWR9YDtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbiAgfVxuICBnZXRFdmVudERldGFpbCgpIHtcbiAgICBjb25zdCB7IG93bmVyLCBzZWFyY2hVc2VybmFtZTogdXNlcm5hbWUgfSA9IHRoaXM7XG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFF1ZXJ5VmFsdWUoKTtcbiAgICBjb25zdCBsYWJlbCA9IHRoaXMuaTE4bi5sYWJlbC5yZXBsYWNlKFwiJHtsYWJlbH1cIiwgb3duZXIgPT09IFwib3duZXJcIiA/IHVzZXJuYW1lIDogdGhpcy5pMThuW293bmVyXSk7XG4gICAgcmV0dXJuIHsgaWQ6IFwib3duZXJcIiwgcGFyYW06IFwicVwiLCB2YWx1ZSwgbGFiZWwsIG93bmVyLCB1c2VybmFtZSB9O1xuICB9XG4gIGdldE93bmVyVGV4dChvd25lcikge1xuICAgIGlmIChvd25lciA9PT0gXCJvd25lclwiKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZWFyY2hVc2VybmFtZTtcbiAgICB9XG4gICAgaWYgKG93bmVyID09PSBcIm91dHNpZGVPcmdcIikge1xuICAgICAgcmV0dXJuIHRoaXMuaTE4bltpc1B1YmxpY1VzZXIoY29uZmlnU3RhdGUudXNlcikgPyBcInNvbWVvbmVFbHNlXCIgOiBcIm91dHNpZGVPcmdcIl07XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmkxOG5bb3duZXJdO1xuICB9XG4gIHNlYXJjaFVzZXJuYW1lQ2hhbmdlZCgpIHtcbiAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHVzZXIgPSBjb25maWdTdGF0ZS51c2VyO1xuICAgIGNvbnN0IHVzZXJuYW1lID0gdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnVzZXJuYW1lO1xuICAgIGlmICghdXNlcm5hbWUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBmaWx0ZXJzID0gaXNQdWJsaWNVc2VyKHVzZXIpXG4gICAgICA/IFtcIm93bmVyXCIsIFwib3V0c2lkZU9yZ1wiXVxuICAgICAgOiBbXCJvd25lclwiLCBcImluT3JnXCIsIFwib3V0c2lkZU9yZ1wiXTtcbiAgICByZXR1cm4gKGgoXCJhcmNnaXMtYnJvd3Nlci1maWx0ZXJcIiwgeyBoZWFkaW5nOiB0aGlzLmkxOG4ub3duZXIsIGV4cGFuZGVkOiB0aGlzLmV4cGFuZGVkLCBhY3RpdmU6ICEhdGhpcy5vd25lciwgb25BcmNnaXNCcm93c2VyRmlsdGVyUmVtb3ZlOiAoKSA9PiB7XG4gICAgICAgIHRoaXMub3duZXIgPSBudWxsO1xuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgICB9IH0sIGgoXCJjYWxjaXRlLXRyZWVcIiwgeyBzZWxlY3Rpb25Nb2RlOiBcInNpbmdsZVwiLCBzY2FsZTogXCJtXCIsIG9uQ2FsY2l0ZVRyZWVTZWxlY3Q6IChldmVudCkgPT4ge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICBjb25zdCBvd25lciA9ICgoX2IgPSAoX2EgPSBub2RlLnNlbGVjdGVkSXRlbXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmRhdGFzZXQub3duZXIpIHx8IFwiXCI7XG4gICAgICAgIGlmICh0aGlzLm93bmVyID09PSBvd25lcikge1xuICAgICAgICAgIHRoaXMub3duZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHRoaXMub3duZXIgPSBvd25lcjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgICB9IH0sIGZpbHRlcnNcbiAgICAgIC5maWx0ZXIoKHZhbHVlKSA9PiAhKGNvbmZpZ1N0YXRlLnBvcnRhbC5pc1BvcnRhbCB8fCB0aGlzLmhhc0luZG9vcnNTcGFjZXMpIHx8IHZhbHVlICE9PSBcIm91dHNpZGVPcmdcIilcbiAgICAgIC5tYXAoKG93bmVyKSA9PiAoaChcImNhbGNpdGUtdHJlZS1pdGVtXCIsIHsgXCJkYXRhLW93bmVyXCI6IG93bmVyLCBzZWxlY3RlZDogb3duZXIgPT09IHRoaXMub3duZXIgfSwgaChcImFcIiwgbnVsbCwgdGhpcy5nZXRPd25lclRleHQob3duZXIpKSkpKSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgXCJzZWFyY2hVc2VybmFtZVwiOiBbXCJzZWFyY2hVc2VybmFtZUNoYW5nZWRcIl1cbiAgfTsgfVxufTtcblxuZnVuY3Rpb24gZ2V0T3JnU2V0dGluZ3NHcm91cHNRdWVyeShwb3J0YWwpIHtcbiAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICBsZXQgcXVlcnlTdHJpbmdzID0gW107XG4gIGNvbnN0IG9yZ1NldHRpbmdzUXVlcmllcyA9IFtcbiAgICAvLyBPcmcgU2V0dGluZ3MgPiBHYWxsZXJ5XG4gICAgcG9ydGFsLmZlYXR1cmVkSXRlbXNHcm91cFF1ZXJ5LFxuICAgIC8vIE9yZyBTZXR0aW5ncyA+IE1hcFxuICAgIHBvcnRhbC5iYXNlbWFwR2FsbGVyeUdyb3VwUXVlcnksXG4gICAgcG9ydGFsLnRlbXBsYXRlc0dyb3VwUXVlcnksXG4gICAgcG9ydGFsW1wiMkRTdHlsZXNHcm91cFF1ZXJ5XCJdLFxuICAgIHBvcnRhbC5zdHlsZXNHcm91cFF1ZXJ5LFxuICAgIHBvcnRhbC5hbmFseXNpc0xheWVyc0dyb3VwUXVlcnksXG4gICAgLy8gT3JnIFNldHRpbmdzID4gR3JvdXBzID4gQ29uZmlndXJpYWJsZSBBcHBzXG4gICAgcG9ydGFsLmdhbGxlcnlUZW1wbGF0ZXNHcm91cFF1ZXJ5XG4gIF07XG4gIC8vIE9yZyBTZXR0aW5ncyA+IEhvbWUgUGFnZVxuICBpZiAocG9ydGFsLmhhc01vZGVybkhvbWVQYWdlRW5hYmxlZCkge1xuICAgIGNvbnN0IGNvbnRlbnRHYWxsZXJpZXMgPSAoKF9iID0gKF9hID0gcG9ydGFsLmhvbWVQYWdlQ29uZmlnKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY29udGVudCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmZpbHRlcigoY29udGVudCkgPT4gY29udGVudC50eXBlID09PSBcImdhbGxlcnlcIiAmJiAhIWNvbnRlbnQuZ3JvdXBJZCkpIHx8IFtdO1xuICAgIGlmIChjb250ZW50R2FsbGVyaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnRlbnRHYWxsZXJpZXMuZm9yRWFjaCgoeyBncm91cElkIH0pID0+IHtcbiAgICAgICAgY29uc3QgcXVlcnkgPSBgaWQ6JHtncm91cElkfWA7XG4gICAgICAgIHF1ZXJ5U3RyaW5ncyA9IGFkZFRvUXVlcnlTdHJpbmcocXVlcnksIHF1ZXJ5U3RyaW5ncyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgZWxzZSB7XG4gICAgb3JnU2V0dGluZ3NRdWVyaWVzLnB1c2gocG9ydGFsLmhvbWVQYWdlRmVhdHVyZWRDb250ZW50KTtcbiAgfVxuICBvcmdTZXR0aW5nc1F1ZXJpZXMuZm9yRWFjaCgocXVlcnkpID0+IHtcbiAgICBxdWVyeVN0cmluZ3MgPSBhZGRUb1F1ZXJ5U3RyaW5nKHF1ZXJ5LCBxdWVyeVN0cmluZ3MpO1xuICB9KTtcbiAgLy8gT3JnIFNldHRpbmdzID4gRmVhdHVyZWQgR3JvdXBzXG4gIHBvcnRhbC5mZWF0dXJlZEdyb3Vwcy5mb3JFYWNoKChmZWF0dXJlZEdyb3VwKSA9PiB7XG4gICAgaWYgKGZlYXR1cmVkR3JvdXAuaWQpIHtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYGlkOiR7ZmVhdHVyZWRHcm91cC5pZH1gO1xuICAgICAgcXVlcnlTdHJpbmdzID0gYWRkVG9RdWVyeVN0cmluZyhxdWVyeSwgcXVlcnlTdHJpbmdzKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAvLyBpbiBlbnRlcnByaXNlLCBzb21lIGdyb3VwcyBkb24ndCB1c2UgaWRzLCBzbyBjb21taXQgdGhlIGZ1bGwgYXNzZW1ibGVkIHF1ZXJ5XG4gICAgICBjb25zdCBxdWVyeVBhcnRzID0gT2JqZWN0LmVudHJpZXMoZmVhdHVyZWRHcm91cCkubWFwKChlbnRyeSkgPT4gYCR7ZW50cnlbMF19OlwiJHtlbnRyeVsxXX1cImApO1xuICAgICAgY29uc3QgcXVlcnkgPSBgKCR7cXVlcnlQYXJ0cy5qb2luKFwiIFwiKX0pYDtcbiAgICAgIHF1ZXJ5U3RyaW5ncyA9IGFkZFRvUXVlcnlTdHJpbmcocXVlcnksIHF1ZXJ5U3RyaW5ncywgdHJ1ZSk7XG4gICAgfVxuICB9KTtcbiAgLy8gT3JnIFNldHRpbmdzID4gTWVtYmVyIERlZmF1bHRzXG4gIChfZCA9IChfYyA9IHBvcnRhbC51c2VyRGVmYXVsdHMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5ncm91cHMpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5mb3JFYWNoKChpZCkgPT4ge1xuICAgIGNvbnN0IHF1ZXJ5ID0gYGlkOiR7aWR9YDtcbiAgICBxdWVyeVN0cmluZ3MgPSBhZGRUb1F1ZXJ5U3RyaW5nKHF1ZXJ5LCBxdWVyeVN0cmluZ3MpO1xuICB9KTtcbiAgcmV0dXJuIHF1ZXJ5U3RyaW5ncy5sZW5ndGggPiAwID8gYCgke3F1ZXJ5U3RyaW5ncy5qb2luKFwiIE9SIFwiKX0pYCA6IFwiXCI7XG59XG5mdW5jdGlvbiBhZGRUb1F1ZXJ5U3RyaW5nKHF1ZXJ5LCBxdWVyeVN0cmluZ3MsIGFsbG93Tm9uSWQpIHtcbiAgaWYgKCgocXVlcnkgPT09IG51bGwgfHwgcXVlcnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHF1ZXJ5LmluZGV4T2YoXCJpZDpcIikpICE9PSAwICYmICFhbGxvd05vbklkKSB8fCBxdWVyeVN0cmluZ3MuaW5jbHVkZXMocXVlcnkpKSB7XG4gICAgcmV0dXJuIFsuLi5xdWVyeVN0cmluZ3NdO1xuICB9XG4gIHJldHVybiBbLi4ucXVlcnlTdHJpbmdzLCBxdWVyeV07XG59XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlckZpbHRlclNwZWNpYWxHcm91cHMgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXJcIiwgNyk7XG4gICAgdGhpcy5oYXNJbmRvb3JzU3BhY2VzID0gZmFsc2U7XG4gICAgdGhpcy5zcGVjaWFsR3JvdXAgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5leHBhbmRlZCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm9wdGlvbnMgPSBbXTtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLnN0b3JlID0gZ2V0R3JvdXBCcm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlclNwZWNpYWxHcm91cHM7XG4gICAgdGhpcy5oYXNJbmRvb3JzU3BhY2VzID0gdGhpcy5zdG9yZS5zdGF0ZS5oYXNJbmRvb3JzU3BhY2VzO1xuICAgIHRoaXMudmFsaWRhdGVPcHRpb25zKCk7XG4gICAgb25Db25maWdDaGFuZ2UoXCJwb3J0YWxcIiwgKCkgPT4gdGhpcy52YWxpZGF0ZU9wdGlvbnMoKSk7XG4gIH1cbiAgdmFsaWRhdGVPcHRpb25zKCkge1xuICAgIGlmICghY29uZmlnU3RhdGUucG9ydGFsKSB7XG4gICAgICByZXR1cm4gKHRoaXMub3B0aW9ucyA9IFtdKTtcbiAgICB9XG4gICAgdGhpcy5vcHRpb25zID0gW1wib3BlbkRhdGFcIiwgXCJzaGFyZWRVcGRhdGVcIiwgXCJkaXN0cmlidXRlZFwiLCBcImFkbWluXCIsIFwic2V0dGluZ3NcIl0uZmlsdGVyKChvcHRpb24pID0+IHtcbiAgICAgIHJldHVybiAhKChvcHRpb24gPT09IFwib3BlbkRhdGFcIiAmJiBjb25maWdTdGF0ZS5wb3J0YWwuaXNQb3J0YWwpIHx8XG4gICAgICAgIC8vIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vd2ViZ2lzL2FyY2dpcy1wb3J0YWwtYXBwL2lzc3Vlcy8zNzgzMVxuICAgICAgICAob3B0aW9uID09PSBcImRpc3RyaWJ1dGVkXCIgJiYgdGhpcy5oYXNJbmRvb3JzU3BhY2VzKSB8fFxuICAgICAgICAvLyBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcC9pc3N1ZXMvNDU0NDkgb3JncyB3aXRoIG5vIHNldHRpbmdzIGdyb3VwcyBjb25maWd1cmVkIGRvbid0IG5lZWQgdGhpcyBvcHRpb25cbiAgICAgICAgKG9wdGlvbiA9PT0gXCJzZXR0aW5nc1wiICYmICFnZXRPcmdTZXR0aW5nc0dyb3Vwc1F1ZXJ5KGNvbmZpZ1N0YXRlLnBvcnRhbCkpKTtcbiAgICB9KTtcbiAgfVxuICBhc3luYyBjb21wb25lbnREaWRMb2FkKCkge1xuICAgIGlmICh0aGlzLnNwZWNpYWxHcm91cCkge1xuICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgIH1cbiAgICBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUoXCJzcGVjaWFsR3JvdXBzXCIsIHRoaXMuc3RvcmUsICgpID0+ICh0aGlzLnNwZWNpYWxHcm91cCA9IG51bGwpKTtcbiAgfVxuICBnZXRRdWVyeVZhbHVlKCkge1xuICAgIHN3aXRjaCAodGhpcy5zcGVjaWFsR3JvdXApIHtcbiAgICAgIGNhc2UgXCJvcGVuRGF0YVwiOlxuICAgICAgICByZXR1cm4gXCJpc29wZW5kYXRhOnRydWVcIjtcbiAgICAgIGNhc2UgXCJzaGFyZWRVcGRhdGVcIjpcbiAgICAgICAgcmV0dXJuIFwiY2FwYWJpbGl0aWVzOnVwZGF0ZWl0ZW1jb250cm9sXCI7XG4gICAgICBjYXNlIFwiZGlzdHJpYnV0ZWRcIjpcbiAgICAgICAgcmV0dXJuIFwiY2FwYWJpbGl0aWVzOmRpc3RyaWJ1dGVkXCI7XG4gICAgICBjYXNlIFwiYWRtaW5cIjpcbiAgICAgICAgcmV0dXJuIFwiaXNsZWF2aW5nZGlzYWxsb3dlZDp0cnVlXCI7XG4gICAgICBjYXNlIFwic2V0dGluZ3NcIjpcbiAgICAgICAgcmV0dXJuIGdldE9yZ1NldHRpbmdzR3JvdXBzUXVlcnkoY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbiAgfVxuICBnZXRFdmVudERldGFpbCgpIHtcbiAgICBjb25zdCB7IHNwZWNpYWxHcm91cCB9ID0gdGhpcztcbiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0UXVlcnlWYWx1ZSgpO1xuICAgIGNvbnN0IGxhYmVsID0gdGhpcy5pMThuLmxhYmVsLnJlcGxhY2UoXCIke2xhYmVsfVwiLCB0aGlzLmkxOG5bc3BlY2lhbEdyb3VwXSk7XG4gICAgcmV0dXJuIHsgaWQ6IFwic3BlY2lhbEdyb3Vwc1wiLCBwYXJhbTogXCJxXCIsIHZhbHVlLCBsYWJlbCwgc3BlY2lhbEdyb3Vwczogc3BlY2lhbEdyb3VwIH07XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGlmICghKGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS5wb3J0YWwpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIChoKFwiYXJjZ2lzLWJyb3dzZXItZmlsdGVyXCIsIHsgaGVhZGluZzogdGhpcy5pMThuLnRpdGxlLCBleHBhbmRlZDogdGhpcy5leHBhbmRlZCwgYWN0aXZlOiAhIXRoaXMuc3BlY2lhbEdyb3VwLCBvbkFyY2dpc0Jyb3dzZXJGaWx0ZXJSZW1vdmU6ICgpID0+IHtcbiAgICAgICAgdGhpcy5zcGVjaWFsR3JvdXAgPSBudWxsO1xuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgICB9IH0sIGgoXCJjYWxjaXRlLXRyZWVcIiwgeyBzZWxlY3Rpb25Nb2RlOiBcInNpbmdsZVwiLCBzY2FsZTogXCJtXCIsIG9uQ2FsY2l0ZVRyZWVTZWxlY3Q6IChldmVudCkgPT4ge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICBjb25zdCBzcGVjaWFsR3JvdXBzID0gKChfYiA9IChfYSA9IG5vZGUuc2VsZWN0ZWRJdGVtcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZGF0YXNldC5zcGVjaWFsR3JvdXBzKSB8fCBcIlwiO1xuICAgICAgICBpZiAodGhpcy5zcGVjaWFsR3JvdXAgPT09IHNwZWNpYWxHcm91cHMpIHtcbiAgICAgICAgICB0aGlzLnNwZWNpYWxHcm91cCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy5zcGVjaWFsR3JvdXAgPSBzcGVjaWFsR3JvdXBzO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgIH0gfSwgdGhpcy5vcHRpb25zLm1hcCgoc3BlY2lhbEdyb3VwcykgPT4gKGgoXCJjYWxjaXRlLXRyZWUtaXRlbVwiLCB7IFwiZGF0YS1zcGVjaWFsLWdyb3Vwc1wiOiBzcGVjaWFsR3JvdXBzLCBzZWxlY3RlZDogc3BlY2lhbEdyb3VwcyA9PT0gdGhpcy5zcGVjaWFsR3JvdXAgfSwgaChcImFcIiwgbnVsbCwgdGhpcy5pMThuW3NwZWNpYWxHcm91cHNdLCBzcGVjaWFsR3JvdXBzID09PSBcInNldHRpbmdzXCIgJiYgKGgoXCJhcmNnaXMtaW5mb3JtYXRpb25cIiwgeyBzdHlsZTogeyB2ZXJ0aWNhbEFsaWduOiBcIi0uMjVyZW1cIiwgXCItLWFyY2dpcy1pbmZvcm1hdGlvbi1taW4td2lkdGhcIjogXCIwXCIgfSwgbGFiZWw6IHRoaXMuaTE4bi50b29sdGlwTGFiZWwsIG92ZXJsYXlQb3NpdGlvbmluZzogXCJmaXhlZFwiLCBwYWRkZWRDb250ZW50OiB0cnVlIH0sIGgoXCJkaXZcIiwgbnVsbCwgdGhpcy5pMThuLnRvb2x0aXApKSkpKSkpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlckZpbHRlcnMgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuc3RvcmUgPSBnZXRHcm91cEJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChoKFwiYXJjZ2lzLWJyb3dzZXItZmlsdGVyc1wiLCB7IHN0b3JlOiB0aGlzLnN0b3JlIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcInRvcFwiIH0sIGgoXCJzbG90XCIsIHsgbmFtZTogXCJ0b3BcIiB9KSksIGgoXCJzbG90XCIsIG51bGwpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJib3R0b21cIiB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwiYm90dG9tXCIgfSkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcblxuY29uc3QgYXJjZ2lzR3JvdXBCcm93c2VyUGFnaW5hdGlvbkNzcyA9IFwiLndyYXBwZXJ7cGFkZGluZy1sZWZ0OjAuNXJlbTtwYWRkaW5nLXJpZ2h0OjAuNXJlbTtwYWRkaW5nLXRvcDoycmVtO3BhZGRpbmctYm90dG9tOjJyZW07anVzdGlmeS1jb250ZW50OmNlbnRlcjtkaXNwbGF5OmZsZXh9LmhpZGV7ZGlzcGxheTpub25lfVwiO1xuXG5jb25zdCBBcmNnaXNHcm91cEJyb3dzZXJQYWdpbmF0aW9uID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0dyb3VwQnJvd3NlclBhZ2VcIiwgNyk7XG4gICAgdGhpcy50b3RhbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnN0YXJ0ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubnVtID0gNjA7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdG9yZSA9IGdldEdyb3VwQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IHN0YXJ0LCB0b3RhbCwgbnVtLCBzdG9yZSB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoXCJhcmNnaXMtYnJvd3Nlci1wYWdpbmF0aW9uXCIsIHsgc3RhcnQ6IHN0YXJ0LCB0b3RhbDogdG90YWwsIG51bTogbnVtLCBzdG9yZTogc3RvcmUsIG9uQXJjZ2lzQnJvd3NlclBhZ2U6IChlKSA9PiB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclBhZ2UuZW1pdChlLmRldGFpbCkgfSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNHcm91cEJyb3dzZXJQYWdpbmF0aW9uLnN0eWxlID0gYXJjZ2lzR3JvdXBCcm93c2VyUGFnaW5hdGlvbkNzcztcblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hHcm91cChncm91cElkLCBwb3J0YWwpIHtcbiAgY29uc3QgcmVzdEJhc2UgPSBnZXRSZXN0QmFzZVVybChwb3J0YWwpO1xuICBjb25zdCB1cmwgPSBgJHtyZXN0QmFzZX1jb21tdW5pdHkvZ3JvdXBzLyR7Z3JvdXBJZH1gO1xuICByZXR1cm4gcmVxdWVzdCh1cmwpO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hHcm91cE1lbWJlcnMoZ3JvdXBJZCwgcG9ydGFsLCBwYXJhbXMgPSB7fSkge1xuICBjb25zdCByZXN0QmFzZSA9IGdldFJlc3RCYXNlVXJsKHBvcnRhbCk7XG4gIGNvbnN0IHVybCA9IGAke3Jlc3RCYXNlfWNvbW11bml0eS9ncm91cHMvJHtncm91cElkfS91c2VybGlzdGA7XG4gIHJldHVybiByZXF1ZXN0KHVybCwgcGFyYW1zKTtcbn1cblxuY29uc3QgYXJjZ2lzR3JvdXBCcm93c2VyUHJldmlld0NzcyA9IFwiOmhvc3R7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWJhY2tncm91bmQpO2ZsZXg6MSAxIDAlO2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47aGVpZ2h0OjEwMCU7d2lkdGg6MTAwJX0ucHJldmlld19faGVhZGVyey13ZWJraXQtbWFyZ2luLXN0YXJ0OjAuNzVyZW07bWFyZ2luLWlubGluZS1zdGFydDowLjc1cmVtfS5wcmV2aWV3X190aXRsZXtmb250LXNpemU6MXJlbTtmb250LXdlaWdodDo1MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpO3BhZGRpbmc6MDttYXJnaW46MDt3b3JkLXdyYXA6YnJlYWstd29yZDtvdmVyZmxvdy13cmFwOmJyZWFrLXdvcmQ7bGluZS1oZWlnaHQ6MS4zNzV9LnRpdGxle2ZvbnQtd2VpZ2h0OjUwMDtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMSk7Zm9udC1zaXplOjEuMTI1cmVtO21hcmdpbi10b3A6MC43NXJlbTttYXJnaW4tYm90dG9tOjAuNzVyZW07cGFkZGluZzowO3dvcmQtd3JhcDpicmVhay13b3JkO3dvcmQtYnJlYWs6YnJlYWstd29yZH0uYmFkZ2Vze21hcmdpbi10b3A6MXJlbX0uYmFkZ2VzW2VtcHR5XXtkaXNwbGF5Om5vbmV9Y2FsY2l0ZS1hY2NvcmRpb24taXRlbXstLWNhbGNpdGUtYWNjb3JkaW9uLWl0ZW0tcGFkZGluZzoxcmVtIDFyZW07LS1jYWxjaXRlLWFjY29yZGlvbi1pdGVtLWJhY2tncm91bmQ6dmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEpO3dpZHRoOjEwMCU7Ym94LXNpemluZzpib3JkZXItYm94O2JvcmRlci1ib3R0b206MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktYm9yZGVyLTIpfS5zZWN0aW9ue3BhZGRpbmc6MXJlbTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktYmFja2dyb3VuZCk7bWFyZ2luOjByZW0gLTFyZW0gY2FsYygtMXJlbSAtIDFweCk7bGluZS1oZWlnaHQ6MS4zNX0uc2VjdGlvbi0tdGlnaHR7cGFkZGluZy10b3A6MDtwYWRkaW5nLWJvdHRvbTowO3BhZGRpbmctbGVmdDowO3BhZGRpbmctcmlnaHQ6MH0uc2VjdGlvbi0tY2VudGVyZWR7d2lkdGg6MTAwJTtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2dyaWQtcm93LWdhcDowLjc1cmVtO3Jvdy1nYXA6MC43NXJlbTthbGlnbi1pdGVtczpjZW50ZXJ9LmZ1bGwtY2FyZC13cmFwcGVye3BhZGRpbmctdG9wOjAuNzVyZW07cGFkZGluZy1sZWZ0OjAuNXJlbTtwYWRkaW5nLXJpZ2h0OjAuNXJlbX0uZGV0YWlscy10aXRsZXtmb250LXdlaWdodDo1MDA7Zm9udC1zaXplOjAuNzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTMpO3BhZGRpbmctYm90dG9tOjAuMjVyZW07cGFkZGluZy10b3A6MDttYXJnaW4tdG9wOjFyZW07bWFyZ2luLWJvdHRvbTowOy0tY2FsY2l0ZS1sYWJlbC1tYXJnaW4tYm90dG9tOjB9LmRldGFpbHMtdGl0bGU6Zmlyc3Qtb2YtdHlwZXttYXJnaW4tdG9wOjB9LmRldGFpbHMtdGl0bGUtLWxhYmVse3BhZGRpbmctYm90dG9tOjB9LmRldGFpbHMtdGV4dHtmb250LXdlaWdodDo0MDA7Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0xKTtwYWRkaW5nOjA7bWFyZ2luOjA7d29yZC13cmFwOmJyZWFrLXdvcmQ7b3ZlcmZsb3ctd3JhcDpicmVhay13b3JkfS5kZXRhaWxzLXRleHQgYXtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtbGluayl9LmRldGFpbHMtdGV4dC0tZW1wdHl7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTMpO2ZvbnQtd2VpZ2h0OjQwMH0uZGV0YWlscy1saW5re21hcmdpbi10b3A6MC43NXJlbX0uZGVzY3JpcHRpb257d29yZC13cmFwOmJyZWFrLXdvcmQ7b3ZlcmZsb3ctd3JhcDpicmVhay13b3JkO2xpbmUtaGVpZ2h0OjEuMzV9LmRlc2NyaXB0aW9uICp7Zm9udC1zaXplOjAuODc1cmVtICFpbXBvcnRhbnR9Lmljb24teGx7aGVpZ2h0OjNyZW07d2lkdGg6M3JlbX0uY29udGVudC1jYXJke21hcmdpbi1ib3R0b206MC4yNXJlbX0uY29udGVudC10aHVtYm5haWx7bWFyZ2luLXRvcDphdXRvO21hcmdpbi1ib3R0b206YXV0bzt3aWR0aDoxMDAlOy13ZWJraXQtbWFyZ2luLWVuZDoxcmVtO21hcmdpbi1pbmxpbmUtZW5kOjFyZW19LnNldHRpbmdzLXRleHR7Zm9udC13ZWlnaHQ6NDAwO2ZvbnQtc2l6ZTowLjg3NXJlbTttYXJnaW4tdG9wOi0wLjI1cmVtO21hcmdpbi1ib3R0b206LTAuMjVyZW19LmZvb3Rlci1hY3Rpb25ze3dpZHRoOjEwMCU7cGFkZGluZzoxcmVtO2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47Z3JpZC1yb3ctZ2FwOjAuNXJlbTtyb3ctZ2FwOjAuNXJlbX0uYmxvY2stLXBhZGRlZHtwYWRkaW5nLWJvdHRvbToxcmVtOy13ZWJraXQtcGFkZGluZy1zdGFydDowLjI1cmVtO3BhZGRpbmctaW5saW5lLXN0YXJ0OjAuMjVyZW19XCI7XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlclByZXZpZXcgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyUHJldmlld0Nsb3NlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3Q2xvc2VcIiwgNyk7XG4gICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNHcm91cEJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uXCIsIDcpO1xuICAgIHRoaXMuZ3JvdXAgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy51c2VyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaGlkZVByZXZpZXdGb290ZXIgPSBmYWxzZTtcbiAgICB0aGlzLnNob3dCYWRnZXMgPSB0cnVlO1xuICAgIHRoaXMuY3VycmVudFJlc3BvbnNlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZnVsbEdyb3VwID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudXNlckluZm8gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jb250ZW50ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubWFuYWdlcnMgPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdG9yZSA9IGdldEdyb3VwQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgIHRoaXMubGFuZyA9IGF3YWl0IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZSh0aGlzLmVsKTtcbiAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4ucHJldmlldztcbiAgICB0aGlzLmluaXQoKTtcbiAgfVxuICB1cGRhdGVQcmV2aWV3KCkge1xuICAgIHRoaXMuaW5pdCgpO1xuICB9XG4gIGFzeW5jIGluaXQoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgaWYgKCF0aGlzLmdyb3VwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHsgZ3JvdXAsIHBvcnRhbCwgdXNlciB9ID0gdGhpcztcbiAgICB0aGlzLmlzR3JvdXBPd25lciA9IGdyb3VwLm93bmVyID09PSAodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnVzZXJuYW1lKTtcbiAgICB0aGlzLmZ1bGxHcm91cCA9IG51bGw7XG4gICAgdGhpcy5mdWxsR3JvdXAgPSBhd2FpdCBtaW5EZWxheShmZXRjaEdyb3VwKGdyb3VwLmlkLCB0aGlzLnBvcnRhbCksIDYwMCk7XG4gICAgdGhpcy51c2VySW5mbyA9IGF3YWl0IGZldGNoVXNlcihncm91cC5vd25lciwgcG9ydGFsKTtcbiAgICBjb25zdCBjb250ZW50UXVlcnkgPSB0aGlzLmdldFR5cGVRdWVyeSh0aGlzLmZ1bGxHcm91cCk7XG4gICAgdGhpcy5jb250ZW50ID0gYXdhaXQgKCgoX2IgPSAoX2EgPSB0aGlzLmZ1bGxHcm91cC5wcm9wZXJ0aWVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmVhdHVyZWRJdGVtSWRzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoKSAmJlxuICAgICAgdGhpcy5mdWxsR3JvdXAucHJvcGVydGllcy5pc0ZlYXR1cmVkXG4gICAgICA/IHF1ZXJ5RmVhdHVyZWRDb250ZW50KHBvcnRhbCwgZ3JvdXAuaWQsIHRoaXMuZnVsbEdyb3VwLnByb3BlcnRpZXMuZmVhdHVyZWRJdGVtSWRzKVxuICAgICAgOiBxdWVyeUdyb3VwQ29udGVudChwb3J0YWwsIGdyb3VwLmlkLCBPYmplY3QuYXNzaWduKHsgc29ydEZpZWxkOiB0aGlzLmZ1bGxHcm91cC5zb3J0RmllbGQgfHwgXCJtb2RpZmllZFwiLCBzb3J0T3JkZXI6IHRoaXMuZnVsbEdyb3VwLnNvcnRPcmRlciB8fCBcImRlc2NcIiB9LCAoY29udGVudFF1ZXJ5ID8geyBxOiBjb250ZW50UXVlcnkgfSA6IHt9KSkpKTtcbiAgICB0aGlzLm1hbmFnZXJzID0gYXdhaXQgdGhpcy5mZXRjaEdyb3VwQWRtaW5zKHBvcnRhbCwgZ3JvdXApO1xuICAgIChfYyA9IHRoaXMuZmxvd0l0ZW0pID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5zZXRGb2N1cygpO1xuICB9XG4gIGhhbmRsZUFjY29yZGlvbkl0ZW1DbGljayhlbGVtZW50LCBkZXRhaWxzKSB7XG4gICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uLmVtaXQoe1xuICAgICAgYWN0aW9uOiBlbGVtZW50LmV4cGFuZGVkID8gXCJleHBhbmRcIiA6IFwiY29sbGFwc2VcIixcbiAgICAgIGNhdGVnb3J5OiBcInBhbmVsIGFjdGlvblwiLFxuICAgICAgZGV0YWlsc1xuICAgIH0pO1xuICB9XG4gIGNsb3NlUHJldmlldygpIHtcbiAgICB0aGlzLmZ1bGxHcm91cCA9IG51bGw7XG4gICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uLmVtaXQoe1xuICAgICAgYWN0aW9uOiBcImNsb3NlIHBhbmVsXCIsXG4gICAgICBjYXRlZ29yeTogXCJwYW5lbCBhY3Rpb25cIlxuICAgIH0pO1xuICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyUHJldmlld0Nsb3NlLmVtaXQoKTtcbiAgfVxuICBoYW5kbGVEZXRhaWxzQ2xpY2soZGV0YWlscykge1xuICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VySW50ZXJuYWxVSUFjdGlvbi5lbWl0KHtcbiAgICAgIGFjdGlvbjogXCJjbGlja1wiLFxuICAgICAgY2F0ZWdvcnk6IFwiZ3JvdXAgcGFuZWwgYWN0aW9uXCIsXG4gICAgICBkZXRhaWxzXG4gICAgfSk7XG4gIH1cbiAgcmVuZGVySGVhZGVyKCkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBzbG90OiBcImhlYWRlci1jb250ZW50XCIsIGNsYXNzOiBcInByZXZpZXdfX2hlYWRlclwiIH0sIGgoXCJoM1wiLCB7IGNsYXNzOiBcInByZXZpZXdfX3RpdGxlXCIgfSwgKF9hID0gdGhpcy5ncm91cCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRpdGxlKSkpO1xuICB9XG4gIGlzQWNjb3JkaW9uSXRlbShlbGVtZW50KSB7XG4gICAgcmV0dXJuIGVsZW1lbnQudGFnTmFtZSA9PT0gXCJDQUxDSVRFLUFDQ09SRElPTi1JVEVNXCI7XG4gIH1cbiAgZ2V0Vmlld0J5VGV4dChncm91cCkge1xuICAgIHN3aXRjaCAoZ3JvdXAuYWNjZXNzKSB7XG4gICAgICBjYXNlIFwicHVibGljXCI6XG4gICAgICAgIHJldHVybiB0aGlzLmkxOG4uZXZlcnlvbmU7XG4gICAgICBjYXNlIFwicHJpdmF0ZVwiOlxuICAgICAgICByZXR1cm4gdGhpcy5pMThuLm9ubHlNZW1iZXJzO1xuICAgICAgY2FzZSBcIm9yZ1wiOlxuICAgICAgICByZXR1cm4gdGhpcy5pMThuLm9ubHlPcmdhbml6YXRpb247XG4gICAgICBjYXNlIFwic2hhcmVkXCI6XG4gICAgICAgIHJldHVybiB0aGlzLmkxOG4ub25seU9yZ2FuaXphdGlvbkFuZFBhcnRuZXJzO1xuICAgIH1cbiAgfVxuICBnZXRKb2luQnlUZXh0KGdyb3VwKSB7XG4gICAgaWYgKGdyb3VwLmF1dG9Kb2luKSB7XG4gICAgICByZXR1cm4gdGhpcy5pMThuLmJ5QXV0b2pvaW47XG4gICAgfVxuICAgIGlmIChncm91cC5pc0ludml0YXRpb25Pbmx5KSB7XG4gICAgICByZXR1cm4gdGhpcy5pMThuLmJ5SW52aXRhdGlvbjtcbiAgICB9XG4gICAgaWYgKGdyb3VwLnByb3ZpZGVyR3JvdXBOYW1lKSB7XG4gICAgICByZXR1cm4gdGhpcy5pMThuLmJ5RW50ZXJwcmlzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuaTE4bi5ieVJlcXVlc3Q7XG4gIH1cbiAgYXN5bmMgZmV0Y2hHcm91cEFkbWlucyhwb3J0YWwsIGdyb3VwKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCBhZG1pbnMgPSAoX2IgPSAoX2EgPSAoYXdhaXQgZmV0Y2hHcm91cE1lbWJlcnMoZ3JvdXAuaWQsIHBvcnRhbCwgeyBtZW1iZXJUeXBlOiBcImFkbWluXCIgfSkpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudXNlcnMpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFtdO1xuICAgIGNvbnN0IG93bmVyID0gYWRtaW5zLmZpbmQoKGFkbWluKSA9PiBhZG1pbi51c2VybmFtZSA9PT0gZ3JvdXAub3duZXIpO1xuICAgIHJldHVybiBbb3duZXIsIC4uLmFkbWlucy5maWx0ZXIoKGFkbWluKSA9PiBhZG1pbi51c2VybmFtZSAhPT0gb3duZXIudXNlcm5hbWUpXTtcbiAgfVxuICBnZXRUeXBlUXVlcnkoZ3JvdXApIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKChfYSA9IGdyb3VwLmRpc3BsYXlTZXR0aW5ncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLml0ZW1UeXBlcykge1xuICAgICAgY29uc3QgaXRlbVR5cGUgPSBncm91cC5kaXNwbGF5U2V0dGluZ3MuaXRlbVR5cGVzLnNwbGl0KFwiLFwiKVswXS50b0xvd2VyQ2FzZSgpO1xuICAgICAgc3dpdGNoIChpdGVtVHlwZSkge1xuICAgICAgICBjYXNlIFwiYXBwbGljYXRpb25cIjpcbiAgICAgICAgICByZXR1cm4gaXRlbVR5cGVPcHRpb25zLmFwcGxpY2F0aW9ucy5xO1xuICAgICAgICBjYXNlIFwid2ViIG1hcFwiOlxuICAgICAgICAgIHJldHVybiBpdGVtVHlwZU9wdGlvbnMubWFwcy5xO1xuICAgICAgICBjYXNlIFwid2ViIHNjZW5lXCI6XG4gICAgICAgICAgcmV0dXJuIGl0ZW1UeXBlT3B0aW9ucy5zY2VuZXMucTtcbiAgICAgICAgY2FzZSBcImxvY2F0b3IgcGFja2FnZVwiOlxuICAgICAgICAgIHJldHVybiBpdGVtVHlwZU9wdGlvbnMudG9vbHMucTtcbiAgICAgICAgY2FzZSBcImNzdlwiOlxuICAgICAgICAgIHJldHVybiBpdGVtVHlwZU9wdGlvbnMuZmlsZXMucTtcbiAgICAgICAgY2FzZSBcImxheWVyXCI6XG4gICAgICAgICAgcmV0dXJuIGl0ZW1UeXBlT3B0aW9ucy5sYXllcnMucTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgZ3JvdXAsIGZ1bGxHcm91cCwgaTE4biwgbWFuYWdlcnMsIHBvcnRhbCwgY29udGVudCwgc2hvd0JhZGdlcywgdXNlciB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImNhbGNpdGUtZmxvd1wiLCBudWxsLCBoKFwiY2FsY2l0ZS1mbG93LWl0ZW1cIiwgeyBjbG9zYWJsZTogdHJ1ZSwgbG9hZGluZzogIWZ1bGxHcm91cCwgb25DYWxjaXRlRmxvd0l0ZW1DbG9zZTogKCkgPT4gdGhpcy5jbG9zZVByZXZpZXcoKSwgcmVmOiAoZWwpID0+ICh0aGlzLmZsb3dJdGVtID0gZWwpIH0sIHRoaXMucmVuZGVySGVhZGVyKCksIGZ1bGxHcm91cCAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbnRlbnRcIiB9LCBoKFwiY2FsY2l0ZS1hY2NvcmRpb25cIiwgeyBcImljb24tcG9zaXRpb25cIjogXCJzdGFydFwiLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIGtleTogZ3JvdXAuaWQsIGNsYXNzOiBcImFjY29yZGlvblwiIH0sIGgoXCJjYWxjaXRlLWFjY29yZGlvbi1pdGVtXCIsIHsgaGVhZGluZzogaTE4bi5vdmVydmlldywgZXhwYW5kZWQ6IEJvb2xlYW4oZnVsbEdyb3VwLnNuaXBwZXQpLCByZWY6IChlbCkgPT4ge1xuICAgICAgICB0aGlzLm92ZXJ2aWV3RWxlbWVudCA9IGVsO1xuICAgICAgfSwgb25DbGljazogKGUpID0+IHRoaXMuaXNBY2NvcmRpb25JdGVtKGUudGFyZ2V0KSAmJlxuICAgICAgICB0aGlzLmhhbmRsZUFjY29yZGlvbkl0ZW1DbGljayh0aGlzLm92ZXJ2aWV3RWxlbWVudCwgXCJvdmVydmlld1wiKSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2VjdGlvblwiIH0sIGZ1bGxHcm91cC5zbmlwcGV0ID8gKGgoXCJwXCIsIHsgY2xhc3M6IFwiZGV0YWlscy10ZXh0XCIgfSwgZnVsbEdyb3VwLnNuaXBwZXQpKSA6IChoKFwicFwiLCB7IGNsYXNzOiBcImRldGFpbHMtdGV4dCBkZXRhaWxzLXRleHQtLWVtcHR5XCIgfSwgaTE4bi5ub1N1bW1hcnkpKSwgc2hvd0JhZGdlcyAmJiAoaChcImFyY2dpcy1ncm91cC1iYWRnZXNcIiwgeyBncm91cDogZnVsbEdyb3VwLCBwb3J0YWw6IHBvcnRhbCwgc2hvd1Rvb2x0aXBzOiBmYWxzZSwgd2lkdGg6IFwiZnVsbFwiLCBzY2FsZTogXCJzXCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGNsYXNzOiBcImJhZGdlc1wiIH0pKSkpLCBoKFwiY2FsY2l0ZS1hY2NvcmRpb24taXRlbVwiLCB7IGhlYWRpbmc6IGkxOG4uZGVzY3JpcHRpb24sIGtleTogXCJkZXNjcmlwdGlvblwiLCByZWY6IChlbCkgPT4ge1xuICAgICAgICB0aGlzLmRlc2NyaXB0aW9uRWxlbWVudCA9IGVsO1xuICAgICAgfSwgb25DbGljazogKGUpID0+IHRoaXMuaXNBY2NvcmRpb25JdGVtKGUudGFyZ2V0KSAmJlxuICAgICAgICB0aGlzLmhhbmRsZUFjY29yZGlvbkl0ZW1DbGljayh0aGlzLmRlc2NyaXB0aW9uRWxlbWVudCwgXCJkZXNjcmlwdGlvblwiKSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2VjdGlvblwiIH0sIGZ1bGxHcm91cC5kZXNjcmlwdGlvbiA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZGVzY3JpcHRpb25cIiwgaW5uZXJIVE1MOiBzYW5pdGl6ZUhUTUwoZnVsbEdyb3VwLmRlc2NyaXB0aW9uKSB9KSkgOiAoaChcInBcIiwgeyBjbGFzczogXCJkZXRhaWxzLXRleHQgZGV0YWlscy10ZXh0LS1lbXB0eVwiIH0sIGkxOG4ubm9EZXNjcmlwdGlvbikpKSksIGgoXCJjYWxjaXRlLWFjY29yZGlvbi1pdGVtXCIsIHsgaGVhZGluZzogaTE4bi5jb250ZW50LnJlcGxhY2UoXCIke2NvdW50fVwiLCBjb250ZW50ID8gYCR7Y29udGVudC50b3RhbH1gIDogXCIwXCIpLCBleHBhbmRlZDogdHJ1ZSwgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgdGhpcy5jb250ZW50RWxlbWVudCA9IGVsO1xuICAgICAgfSwgb25DbGljazogKGUpID0+IHRoaXMuaXNBY2NvcmRpb25JdGVtKGUudGFyZ2V0KSAmJlxuICAgICAgICB0aGlzLmhhbmRsZUFjY29yZGlvbkl0ZW1DbGljayh0aGlzLmNvbnRlbnRFbGVtZW50LCBcImNvbnRlbnRcIikgfSwgaChcImRpdlwiLCB7IGNsYXNzOiB7IHNlY3Rpb246IHRydWUsIFwic2VjdGlvbi0tdGlnaHRcIjogKGNvbnRlbnQgPT09IG51bGwgfHwgY29udGVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29udGVudC50b3RhbCkgPiAwIH0gfSwgKGNvbnRlbnQgPT09IG51bGwgfHwgY29udGVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29udGVudC50b3RhbCkgPyAoaChcImRpdlwiLCB7IGNsYXNzOiBcImZ1bGwtY2FyZC13cmFwcGVyXCIgfSwgY29udGVudC5yZXN1bHRzLm1hcCgoaXRlbSkgPT4gKGgoXCJhcmNnaXMtZ3JvdXAtYnJvd3Nlci1wcmV2aWV3LWNhcmRcIiwgeyBjbGFzczogXCJjb250ZW50LWNhcmRcIiwgaXRlbTogaXRlbSwgcG9ydGFsOiBwb3J0YWwsIHVzZXI6IHVzZXIsIGtleTogaXRlbS5pZCB9KSkpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZGV0YWlscy1saW5rIGJsb2NrLS1wYWRkZWRcIiB9LCBoKFwiY2FsY2l0ZS1saW5rXCIsIHsgaHJlZjogYCR7Z2V0UG9ydGFsQmFzZVVybChwb3J0YWwpfS9ob21lL2dyb3VwLmh0bWw/aWQ9JHtncm91cC5pZH0mdmlldz1saXN0I2NvbnRlbnRgLCBvbkNsaWNrOiAoKSA9PiB7IHRoaXMuaGFuZGxlRGV0YWlsc0NsaWNrKFwidmlldyBhbGwgY29udGVudFwiKTsgfSB9LCBpMThuLnZpZXdDb250ZW50KSkpKSA6IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2VjdGlvbi0tY2VudGVyZWRcIiB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwibFwiLCBpY29uOiBcImZpbGVzXCIsIGNsYXNzOiBcImljb24teGwgZGV0YWlscy10ZXh0LS1lbXB0eVwiIH0pLCBoKFwicFwiLCB7IGNsYXNzOiBcImRldGFpbHMtdGV4dCBkZXRhaWxzLXRleHQtLWVtcHR5XCIgfSwgaTE4bi5ub0NvbnRlbnQpKSkpKSwgaChcImNhbGNpdGUtYWNjb3JkaW9uLWl0ZW1cIiwgeyBoZWFkaW5nOiBpMThuLmdyb3VwTWFuYWdlcnMucmVwbGFjZShcIiR7Y291bnR9XCIsIG1hbmFnZXJzID8gYCR7bWFuYWdlcnMubGVuZ3RofWAgOiBcIjBcIiksIGV4cGFuZGVkOiB0cnVlLCByZWY6IChlbCkgPT4ge1xuICAgICAgICB0aGlzLm1hbmFnZXJzRWxlbWVudCA9IGVsO1xuICAgICAgfSwgb25DbGljazogKGUpID0+IHRoaXMuaXNBY2NvcmRpb25JdGVtKGUudGFyZ2V0KSAmJlxuICAgICAgICB0aGlzLmhhbmRsZUFjY29yZGlvbkl0ZW1DbGljayh0aGlzLm1hbmFnZXJzRWxlbWVudCwgXCJtYW5hZ2Vyc1wiKSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2VjdGlvbiBzZWN0aW9uLS10aWdodFwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJmdWxsLWNhcmQtd3JhcHBlclwiIH0sIG1hbmFnZXJzID09PSBudWxsIHx8IG1hbmFnZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOlxuICAgICAgbWFuYWdlcnMubWFwKChhZG1pbikgPT4ge1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWNhcmRcIiwgeyBrZXk6IGFkbWluLnVzZXJuYW1lLCBjbGFzczogXCJjb250ZW50LWNhcmRcIiB9LCBoKFwiYXJjZ2lzLXVzZXItYXZhdGFyXCIsIHsgaGVhZGluZzogYWRtaW4udXNlcm5hbWUgPT09IGdyb3VwLm93bmVyXG4gICAgICAgICAgICA/IGkxOG4uZ3JvdXBPd25lci5yZXBsYWNlKFwiJHtmdWxsTmFtZX1cIiwgZ2V0RnVsbE5hbWUoYWRtaW4sIHRoaXMubGFuZykpXG4gICAgICAgICAgICA6IGFkbWluLmZ1bGxOYW1lLCBzaG93TmFtZTogdHJ1ZSwgdXNlcjogYWRtaW4sIGRlc2NyaXB0aW9uOiBhZG1pbi51c2VybmFtZSwgcG9ydGFsOiBwb3J0YWwgfSkpKTtcbiAgICAgIH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZGV0YWlscy1saW5rIGJsb2NrLS1wYWRkZWRcIiB9LCBoKFwiY2FsY2l0ZS1saW5rXCIsIHsgaHJlZjogYCR7Z2V0UG9ydGFsQmFzZVVybChwb3J0YWwpfS9ob21lL2dyb3VwLmh0bWw/aWQ9JHtncm91cC5pZH0jbWVtYmVyc2AsIG9uQ2xpY2s6ICgpID0+IHsgdGhpcy5oYW5kbGVEZXRhaWxzQ2xpY2soXCJvcGVuIG1lbWJlcnMgcGFnZVwiKTsgfSB9LCBpMThuLm9wZW5NZW1iZXJzKSkpKSksIGgoXCJjYWxjaXRlLWFjY29yZGlvbi1pdGVtXCIsIHsgaGVhZGluZzogaTE4bi5zZXR0aW5ncywgZXhwYW5kZWQ6IHRoaXMuaXNHcm91cE93bmVyLCByZWY6IChlbCkgPT4ge1xuICAgICAgICB0aGlzLnNldHRpbmdzRWxlbWVudCA9IGVsO1xuICAgICAgfSwgb25DbGljazogKGUpID0+IHRoaXMuaXNBY2NvcmRpb25JdGVtKGUudGFyZ2V0KSAmJlxuICAgICAgICB0aGlzLmhhbmRsZUFjY29yZGlvbkl0ZW1DbGljayh0aGlzLnNldHRpbmdzRWxlbWVudCwgXCJzZXR0aW5nc1wiKSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2VjdGlvblwiIH0sIGgoXCJoNFwiLCB7IGNsYXNzOiBcImRldGFpbHMtdGl0bGVcIiB9LCBpMThuLnZpZXdhYmxlQnksIFwiOlwiKSwgaChcInBcIiwgeyBjbGFzczogXCJzZXR0aW5ncy10ZXh0XCIgfSwgdGhpcy5nZXRWaWV3QnlUZXh0KGZ1bGxHcm91cCkpLCBoKFwiaDRcIiwgeyBjbGFzczogXCJkZXRhaWxzLXRpdGxlXCIgfSwgaTE4bi5jb250cmlidXRvcnMsIFwiOlwiKSwgaChcInBcIiwgeyBjbGFzczogXCJzZXR0aW5ncy10ZXh0XCIgfSwgZnVsbEdyb3VwLmlzVmlld09ubHkgPyBpMThuLm9ubHlPd25lck1hbmFnZXIgOiBpMThuLmFsbE1lbWJlcnMpLCB0aGlzLmlzR3JvdXBPd25lciAmJiAoaChGcmFnbWVudCwgbnVsbCwgaChcImg0XCIsIHsgY2xhc3M6IFwiZGV0YWlscy10aXRsZVwiIH0sIGkxOG4uam9pbk1ldGhvZCwgXCI6XCIpLCBoKFwicFwiLCB7IGNsYXNzOiBcInNldHRpbmdzLXRleHRcIiB9LCB0aGlzLmdldEpvaW5CeVRleHQoZnVsbEdyb3VwKSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJkZXRhaWxzLWxpbmtcIiB9LCBoKFwiY2FsY2l0ZS1saW5rXCIsIHsgaHJlZjogYCR7Z2V0UG9ydGFsQmFzZVVybChwb3J0YWwpfS9ob21lL2dyb3VwLmh0bWw/aWQ9JHtncm91cC5pZH0jc2V0dGluZ3NgLCBvbkNsaWNrOiAoKSA9PiB7IHRoaXMuaGFuZGxlRGV0YWlsc0NsaWNrKFwib3BlbiBzZXR0aW5nc1wiKTsgfSB9LCBpMThuLm9wZW5TZXR0aW5ncykpKSkpKSkpKSwgIXRoaXMuaGlkZVByZXZpZXdGb290ZXIgJiYgKGgoXCJkaXZcIiwgeyBzbG90OiBcImZvb3RlclwiLCBjbGFzczogXCJmb290ZXItYWN0aW9uc1wiIH0sIHBvcnRhbCAmJiBncm91cCAmJiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgb25DbGljazogKCkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgY3VycmVudFJlc3BvbnNlLCBncm91cCB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgaW5kZXggPSAoX2EgPSBjdXJyZW50UmVzcG9uc2UgPT09IG51bGwgfHwgY3VycmVudFJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjdXJyZW50UmVzcG9uc2UucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbmRJbmRleCgocmVzdWx0KSA9PiByZXN1bHQuaWQgPT09IGdyb3VwLmlkKTtcbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBpbmRleCArIGN1cnJlbnRSZXNwb25zZS5zdGFydDtcbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uLmVtaXQoe1xuICAgICAgICAgIGFjdGlvbjogXCJ2aWV3IGdyb3VwIGRldGFpbHNcIixcbiAgICAgICAgICBjYXRlZ29yeTogXCJncm91cCBwYW5lbCBhY3Rpb25cIixcbiAgICAgICAgICBwb3NpdGlvblxuICAgICAgICB9KTtcbiAgICAgIH0sIGhyZWY6IGAke2dldFBvcnRhbEJhc2VVcmwocG9ydGFsKX0vaG9tZS9ncm91cC5odG1sP2lkPSR7Z3JvdXAuaWR9YCwga2luZDogXCJuZXV0cmFsXCIsIGFwcGVhcmFuY2U6IFwic29saWRcIiwgd2lkdGg6IFwiZnVsbFwiIH0sIGkxOG4udmlld0RldGFpbHMpKSwgaChcInNsb3RcIiwgeyBuYW1lOiBcImZvb3Rlci1hY3Rpb25cIiB9KSkpKSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgXCJncm91cFwiOiBbXCJ1cGRhdGVQcmV2aWV3XCJdXG4gIH07IH1cbn07XG5BcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3LnN0eWxlID0gYXJjZ2lzR3JvdXBCcm93c2VyUHJldmlld0NzcztcblxuY29uc3QgYXJjZ2lzR3JvdXBCcm93c2VyUHJldmlld0NhcmRDc3MgPSBcIjpob3N0e2Rpc3BsYXk6YmxvY2s7bWluLXdpZHRoOjB9LmNhcmR7Ym94LXNoYWRvdzpub25lO3RyYW5zaXRpb24tZHVyYXRpb246MTUwbXM7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEpO3Bvc2l0aW9uOnJlbGF0aXZlO29wYWNpdHk6MDtoZWlnaHQ6MTAwJTt3aWR0aDoxMDAlO2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47b3V0bGluZS1jb2xvcjp0cmFuc3BhcmVudDtib3gtc2l6aW5nOmJvcmRlci1ib3g7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMSk7dHJhbnNpdGlvbi1wcm9wZXJ0eTpiYWNrZ3JvdW5kLWNvbG9yLCBvdXRsaW5lLCBvdXRsaW5lLW9mZnNldCwgb3BhY2l0eTtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktYm9yZGVyLTMpfS5jYXJkOmZvY3Vze291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktYnJhbmQpO291dGxpbmUtb2Zmc2V0Oi0ycHg7ei1pbmRleDoxMH0uY2FyZC0tbG9hZGVke29wYWNpdHk6MX0uY2FyZC0tc2VsZWN0ZWR7Ym9yZGVyLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktYnJhbmQpfS5jYXJkLS1ob3ZlcmFibGV7Y3Vyc29yOnBvaW50ZXJ9LmNhcmRfX3RvcHtwYWRkaW5nOjAuNzVyZW19LmNhcmRfX3VwcGVye2ZsZXg6MSAxIDAlO3RyYW5zaXRpb246YWxsIHZhcigtLWNhbGNpdGUtYW5pbWF0aW9uLXRpbWluZykgZWFzZS1pbi1vdXQgMHMsIG91dGxpbmUgMHMsIG91dGxpbmUtb2Zmc2V0IDBzO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEpfS5jYXJkLS1ob3ZlcmFibGUgLmNhcmRfX3VwcGVyOmhvdmVye2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1iYWNrZ3JvdW5kKX0uY2FyZF9fdXBwZXItLWxpbmt7dGV4dC1kZWNvcmF0aW9uOm5vbmU7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpO291dGxpbmUtY29sb3I6dHJhbnNwYXJlbnR9LmNhcmRfX3VwcGVyLS1saW5rOmZvY3Vze291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktYnJhbmQpO291dGxpbmUtb2Zmc2V0OjJweDt6LWluZGV4OjEwfS5jYXJkX19jb250ZW50e2Rpc3BsYXk6ZmxleDtmbGV4OjEgMSAwJTtmbGV4LWRpcmVjdGlvbjpjb2x1bW47bWluLXdpZHRoOjB9LmNhcmRfX2RldGFpbHN7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOnJvdzttYXJnaW4tdG9wOjAuMjVyZW19LmNhcmRfX2RldGFpbHtmb250LXNpemU6MC43NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMil9LmNhcmRfX2Zvb3RlcntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0xKTtwYWRkaW5nLWxlZnQ6MC43NXJlbTtwYWRkaW5nLXJpZ2h0OjAuNzVyZW07cGFkZGluZy10b3A6MC41cmVtO3BhZGRpbmctYm90dG9tOjAuNXJlbTtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO21hcmdpbi10b3A6YXV0bztib3JkZXItdG9wOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLXVpLWJvcmRlci0yKX0uY2FyZF9fZm9vdGVyX19zdGFydHtmbGV4OjEgMSAwJTtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246cm93O2FsaWduLWl0ZW1zOmNlbnRlcjttaW4td2lkdGg6MDtvdmVyZmxvdzpoaWRkZW47LXdlYmtpdC1tYXJnaW4tZW5kOjAuNzVyZW07bWFyZ2luLWlubGluZS1lbmQ6MC43NXJlbX0uY2FyZF9fZm9vdGVyX19zdGFydC0tb3duZXJ7LXdlYmtpdC1tYXJnaW4tc3RhcnQ6LTAuMjVyZW07bWFyZ2luLWlubGluZS1zdGFydDotMC4yNXJlbX0uY2FyZF9fcHJvZmlsZS13cmFwe21heC13aWR0aDoxMDAlO3BhZGRpbmc6MC4yNXJlbTtib3gtc2l6aW5nOmJvcmRlci1ib3h9LmNhcmRfX3N1bW1hcnl7Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0yKTttYXJnaW46MDtwYWRkaW5nOjB9LmNhcmRfX2RpdmlkZXJ7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtmbGV4OjAgMCBhdXRvfS5jYXJkX19kaXZpZGVyOm5vdChbZW1wdHldKTpiZWZvcmV7Y29udGVudDpcXFwiXFxcIjtoZWlnaHQ6MS4yNXJlbTt3aWR0aDoxcHg7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWJvcmRlci0xKTttYXJnaW4taW5saW5lOjAuNzVyZW19LmNhcmRfX2RpdmlkZXI6Zmlyc3QtY2hpbGQ6YmVmb3Jle2Rpc3BsYXk6bm9uZX0uY2FyZC1mbGV4e2Rpc3BsYXk6ZmxleH0uY2FyZC1mbGV4LTF7ZmxleDoxIDEgMCU7bWluLXdpZHRoOjB9LnNjcmVlbi1yZWFkZXJzLW9ubHl7cG9zaXRpb246YWJzb2x1dGU7d2lkdGg6MXB4O2hlaWdodDoxcHg7cGFkZGluZzowO21hcmdpbjotMXB4O292ZXJmbG93OmhpZGRlbjtjbGlwOnJlY3QoMCwgMCwgMCwgMCk7d2hpdGUtc3BhY2U6bm93cmFwO2JvcmRlci13aWR0aDowfS5jYXJkX190aXRsZXtmb250LXNpemU6MC44NzVyZW07bWFyZ2luLXRvcDowO21hcmdpbi1ib3R0b206MDtwYWRkaW5nLXRvcDowO3BhZGRpbmctYm90dG9tOjA7d29yZC13cmFwOmJyZWFrLXdvcmQ7b3ZlcmZsb3ctd3JhcDpicmVhay13b3JkO2ZvbnQtd2VpZ2h0OjUwMDtoZWlnaHQ6MnJlbTtvdmVyZmxvdzpoaWRkZW47bGluZS1oZWlnaHQ6MS4xNTtkaXNwbGF5Oi13ZWJraXQtYm94Oy13ZWJraXQtbGluZS1jbGFtcDoyOy13ZWJraXQtYm94LW9yaWVudDp2ZXJ0aWNhbH0uY2FyZF9fdGl0bGUtLXBhZGRlZHttYXJnaW4tYm90dG9tOjAuNXJlbX0uY2FyZF9fc25pcHBldHtmb250LXNpemU6MC44NzVyZW07bWFyZ2luOjA7bWFyZ2luLWJvdHRvbTowLjc1cmVtO3BhZGRpbmc6MDtmbGV4OjEgMSAwJX0uY2FyZF9fYmFkZ2VzLS1zdGFja2Vke21hcmdpbi10b3A6MC41cmVtfS5jYXJkX190aHVtYm5haWx7d2lkdGg6NHJlbTtwYWRkaW5nOjA7bWFyZ2luOjA7Ym94LXNpemluZzpjb250ZW50LWJveDstd2Via2l0LXBhZGRpbmctc3RhcnQ6MC41cmVtO3BhZGRpbmctaW5saW5lLXN0YXJ0OjAuNXJlbX0uY2FyZF9fb3duZXJ7bWluLXdpZHRoOjB9XCI7XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlclByZXZpZXdDYXJkID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckludGVybmFsVUlBY3Rpb24gPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0dyb3VwQnJvd3NlckludGVybmFsVUlBY3Rpb25cIiwgNyk7XG4gICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3Q2FyZFNlbGVjdCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzR3JvdXBCcm93c2VyUHJldmlld0NhcmRTZWxlY3RcIiwgNyk7XG4gICAgdmFyIF9hO1xuICAgIHRoaXMuaGFuZGxlQ2FyZENsaWNrID0gKCkgPT4ge1xuICAgICAgLy8gd2hlbiB1c2luZyB0aGUgY2FyZHMgYXMgYSBsaW5rLCBkb24ndCBkbyBhbnkgc3BlY2lhbCBoYW5kbGluZ1xuICAgICAgaWYgKHRoaXMubGluaykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclByZXZpZXdDYXJkU2VsZWN0LmVtaXQodGhpcy5pdGVtKTtcbiAgICB9O1xuICAgIHRoaXMuaXRlbSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5hcGkgPSA0O1xuICAgIHRoaXMuYmFzZVVybCA9IChfYSA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS5jb25maWcpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5iYXNlVXJsO1xuICAgIHRoaXMubGluayA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm5ld1RhYiA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNob3dUaHVtYm5haWwgPSB0cnVlO1xuICAgIHRoaXMuc2hvd093bmVyID0gdHJ1ZTtcbiAgICB0aGlzLnNob3dJdGVtVHlwZSA9IHRydWU7XG4gICAgdGhpcy5zaG93RGF0ZVVwZGF0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLnNob3dTdW1tYXJ5ID0gZmFsc2U7XG4gICAgdGhpcy5zaG93QmFkZ2VzID0gZmFsc2U7XG4gICAgdGhpcy5zaG93T3duZXJQb3B1cCA9IGZhbHNlO1xuICAgIHRoaXMuaW50ZXJhY3RpdmUgPSBmYWxzZTtcbiAgICB0aGlzLmhvdmVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudXBkYXRlZFRleHQgPSBcIlwiO1xuICAgIHRoaXMubG9hZGVkID0gdW5kZWZpbmVkO1xuICB9XG4gIC8qIENhbGxpbmcgdGhpcyBzZXRGb2N1cyBjYXVzZXMgY2FsY2l0ZSB0byBmb2N1cyBoZXJlIHdoZW4gdGhlIHVzZXIgcG9wdXAgaXMgY2xvc2VkLi4uICovXG4gIGFzeW5jIHJlc3RvcmVGb2N1cygpIHtcbiAgICBpZiAodGhpcy5saW5rICYmIHRoaXMubGlua0VsKSB7XG4gICAgICB0aGlzLmxpbmtFbC5mb2N1cygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy5zZWN0aW9uRWwpIHtcbiAgICAgIHRoaXMuc2VjdGlvbkVsLmZvY3VzKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIC8vdGhpcy5zdG9yZSA9IGdldEdyb3VwQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgIC8vdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLnByZXZpZXdDYXJkO1xuICAgIHRoaXMudXBkYXRlZFRleHQgPSBmb3JtYXREYXRlKHRoaXMuaXRlbS5tb2RpZmllZCk7XG4gICAgdGhpcy5wb3J0YWwgPSAoX2EgPSB0aGlzLnBvcnRhbCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsO1xuICAgIHRoaXMudXNlciA9IChfYiA9IHRoaXMudXNlcikgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogY29uZmlnU3RhdGUudXNlcjtcbiAgICB0aGlzLmFwaSA9IChfYyA9IHRoaXMuYXBpKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiBjb25maWdTdGF0ZS5hcGk7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICBhd2FpdCB0aW1lb3V0KDEwMCk7XG4gICAgdGhpcy5sb2FkZWQgPSB0cnVlO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IHsgaXRlbSwgdXNlciwgcG9ydGFsLCBhcGksIFxuICAgIC8vaTE4bixcbiAgICBsb2FkZWQsIHNob3dEYXRlVXBkYXRlZCwgc2hvd0l0ZW1UeXBlLCBzaG93T3duZXIsIHNob3dPd25lclBvcHVwLCBzaG93QmFkZ2VzLCBzaG93U3VtbWFyeSwgc2hvd1RodW1ibmFpbCwgaW50ZXJhY3RpdmUsIGxpbmssIG5ld1RhYiB9ID0gdGhpcztcbiAgICBjb25zdCBiYXNlVXJsID0gKF9hID0gdGhpcy5iYXNlVXJsKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2IgPSBjb25maWdTdGF0ZS5jb25maWcpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5iYXNlVXJsO1xuICAgIGNvbnN0IENhcmRUYWcgPSB0aGlzLmxpbmsgPyBcImFcIiA6IFwiZGl2XCI7XG4gICAgY29uc3QgbGlua0F0dHJpYnV0ZXMgPSBPYmplY3QuYXNzaWduKHsgaHJlZjogbGluayB9LCAobmV3VGFiID8geyB0YXJnZXQ6IFwiX2JsYW5rXCIsIHJlbDogXCJub29wZW5lciBub3JlZmVycmVyXCIgfSA6IHt9KSk7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJzZWN0aW9uXCIsIE9iamVjdC5hc3NpZ24oeyBjbGFzczoge1xuICAgICAgICBcImNhcmRcIjogdHJ1ZSxcbiAgICAgICAgXCJjYXJkLS1ob3ZlcmFibGVcIjogaW50ZXJhY3RpdmUsXG4gICAgICAgIFwiY2FyZC0tbG9hZGVkXCI6IGxvYWRlZFxuICAgICAgfSB9LCAoaW50ZXJhY3RpdmUgPyB7IG9uTW91c2VPdmVyOiAoKSA9PiAodGhpcy5ob3ZlciA9IHRydWUpIH0gOiB7fSksIChpbnRlcmFjdGl2ZSA/IHsgb25Nb3VzZU91dDogKCkgPT4gKHRoaXMuaG92ZXIgPSBmYWxzZSkgfSA6IHt9KSwgKGxpbmsgPyB7fSA6IHsgb25DbGljazogdGhpcy5oYW5kbGVDYXJkQ2xpY2sgfSksIHsgcmVmOiAoZWwpID0+ICh0aGlzLnNlY3Rpb25FbCA9IGVsKSB9KSwgaChcInNsb3RcIiwgeyBuYW1lOiBcImNvbnRlbnQtdG9wXCIgfSksIGgoQ2FyZFRhZywgT2JqZWN0LmFzc2lnbih7IGNsYXNzOiB7IFwiY2FyZF9fdXBwZXJcIjogdHJ1ZSwgXCJjYXJkX191cHBlci0tbGlua1wiOiAhIWxpbmsgfSB9LCAobGluayA/IGxpbmtBdHRyaWJ1dGVzIDoge30pLCB7IHJlZjogKGVsKSA9PiAodGhpcy5saW5rRWwgPSBlbCkgfSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjYXJkLWZsZXggY2FyZF9fdG9wXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNhcmQtZmxleC0xXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNhcmQtZmxleFwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjYXJkX19jb250ZW50XCIgfSwgaChcImgzXCIsIHsgY2xhc3M6IHtcbiAgICAgICAgXCJjYXJkX190aXRsZVwiOiB0cnVlLFxuICAgICAgICBcImNhcmRfX3RpdGxlLS1wYWRkZWRcIjogc2hvd0l0ZW1UeXBlIHx8IChzaG93U3VtbWFyeSAmJiAhIWl0ZW0uc25pcHBldClcbiAgICAgIH0gfSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJjYXJkX190aXRsZV9fc3BhblwiIH0sIGl0ZW0udGl0bGUpKSwgc2hvd1N1bW1hcnkgJiYgaXRlbS5zbmlwcGV0ICYmIChoKFwicFwiLCB7IGNsYXNzOiBcImNhcmRfX3N1bW1hcnlcIiB9LCBpdGVtLnNuaXBwZXQubGVuZ3RoID4gMjUwXG4gICAgICA/IGAke2l0ZW0uc25pcHBldC5zdWJzdHJpbmcoMCwgMjUwKX3igKZgXG4gICAgICA6IGl0ZW0uc25pcHBldCkpLCBzaG93SXRlbVR5cGUgJiYgaChcImFyY2dpcy1pdGVtLXR5cGVcIiwgeyBzY2FsZTogXCJzXCIsIGl0ZW06IGl0ZW0sIHBvcnRhbDogcG9ydGFsIH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY2FyZF9fZGV0YWlsc1wiIH0sIHNob3dEYXRlVXBkYXRlZCAmJiAoaChcInNwYW5cIiwgeyBjbGFzczoge1xuICAgICAgICBcImNhcmRfX2RldGFpbFwiOiB0cnVlLFxuICAgICAgICBcImNhcmRfX2RpdmlkZXJcIjogdHJ1ZVxuICAgICAgfSB9LCB0aGlzLnVwZGF0ZWRUZXh0KSksIHNob3dCYWRnZXMgJiYgKGgoXCJhcmNnaXMtaXRlbS1iYWRnZXNcIiwgeyBpdGVtOiBpdGVtLCB1c2VyOiB1c2VyLCBwb3J0YWw6IHBvcnRhbCwgd2lkdGg6IFwibmFycm93XCIsIHNob3dUb29sdGlwczogdHJ1ZSwgY2xhc3M6IHtcbiAgICAgICAgXCJjYXJkX19iYWRnZXNcIjogdHJ1ZSxcbiAgICAgICAgXCJjYXJkX19kaXZpZGVyXCI6IHRydWVcbiAgICAgIH0sIHNjYWxlOiBcInNcIiB9KSkpKSwgc2hvd1RodW1ibmFpbCAmJiAoaChcImZpZ3VyZVwiLCB7IGNsYXNzOiBcImNhcmRfX3RodW1ibmFpbFwiIH0sIGgoXCJhcmNnaXMtaXRlbS1icm93c2VyLWNhcmQtdGh1bWJuYWlsXCIsIHsgaXRlbTogaXRlbSwgdXNlcjogdXNlciwgcG9ydGFsOiBwb3J0YWwgfSkpKSkpKSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjYXJkX19mb290ZXJcIiwgb25DbGljazogKGUpID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIH0sIG9uS2V5UHJlc3M6IChlKSA9PiB7XG4gICAgICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiIHx8IGUua2V5ID09IFwiIFwiKSB7XG4gICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfVxuICAgICAgfSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IHtcbiAgICAgICAgXCJjYXJkX19mb290ZXJfX3N0YXJ0XCI6IHRydWUsXG4gICAgICAgIFwiY2FyZF9fZm9vdGVyX19zdGFydC0tb3duZXJcIjogc2hvd093bmVyXG4gICAgICB9IH0sIHNob3dPd25lciAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImNhcmRfX3Byb2ZpbGUtd3JhcFwiLCBvbkNsaWNrOiAoZSkgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB9IH0sIHNob3dPd25lclBvcHVwID8gKGgoXCJhcmNnaXMtdXNlci1wb3B1cFwiLCB7IHVuZGVybGluZTogdHJ1ZSwgdXNlcm5hbWU6IGl0ZW0ub3duZXIsIGFwaTogYXBpLCBwb3J0YWw6IHBvcnRhbCwgYmFzZVVybDogYmFzZVVybCwgc2hvd0F2YXRhcjogZmFsc2UsIGNsYXNzOiBcImNhcmRfX293bmVyXCIsIHNjYWxlOiBcInNcIiwgb25BcmNnaXNVc2VyUG9wdXBJbnRlcm5hbFVJQWN0aW9uOiAoZSkgPT4ge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckludGVybmFsVUlBY3Rpb24uZW1pdChlLmRldGFpbCk7XG4gICAgICB9IH0pKSA6IChoKFwiYXJjZ2lzLXVzZXItYXZhdGFyXCIsIHsgc2xvdDogXCJmb290ZXItc3RhcnRcIiwgc2NhbGU6IFwic1wiLCBzaG93TmFtZTogdHJ1ZSwgc2hvd0F2YXRhcjogZmFsc2UsIHVzZXJuYW1lOiBpdGVtLm93bmVyLCBwb3J0YWw6IHBvcnRhbCB9KSkpKSksIGgoXCJzbG90XCIsIHsgbmFtZTogXCJhY3Rpb25zLWVuZFwiIH0pKSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzR3JvdXBCcm93c2VyUHJldmlld0NhcmQuc3R5bGUgPSBhcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3Q2FyZENzcztcblxuY29uc3QgYXJjZ2lzR3JvdXBCcm93c2VyU2VhcmNoQ3NzID0gXCI6aG9zdHtwb3NpdGlvbjpyZWxhdGl2ZTtkaXNwbGF5OmJsb2NrfS5zZWFyY2h7cG9zaXRpb246YWJzb2x1dGU7ei1pbmRleDoxMDttYXJnaW4tdG9wOjFyZW07Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0xKTtwb2ludGVyLWV2ZW50czpub25lO2luc2V0LWlubGluZS1zdGFydDoxLjVyZW19Lnh7cG9zaXRpb246YWJzb2x1dGU7ei1pbmRleDoxMDt0b3A6MDttYXJnaW4tdG9wOjAuMjVyZW07cGFkZGluZzowLjVyZW07b3V0bGluZToycHggc29saWQgdHJhbnNwYXJlbnQ7b3V0bGluZS1vZmZzZXQ6MnB4O2JvcmRlci1zdHlsZTpub25lO2N1cnNvcjpwb2ludGVyO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0xKTtpbnNldC1pbmxpbmUtZW5kOjAuMjVyZW07YmFja2dyb3VuZDp0cmFuc3BhcmVudH0uaW5wdXR7ZGlzcGxheTpibG9jazt3aWR0aDoxMDAlO2JveC1zaXppbmc6Ym9yZGVyLWJveDtwYWRkaW5nLXRvcDoxcmVtO3BhZGRpbmctYm90dG9tOjFyZW07cGFkZGluZy1sZWZ0OjNyZW07cGFkZGluZy1yaWdodDozcmVtO2hlaWdodDozcmVtO2JveC1zaGFkb3c6bm9uZTtib3JkZXItc3R5bGU6bm9uZTtwb3NpdGlvbjpyZWxhdGl2ZTt6LWluZGV4OjA7dHJhbnNpdGlvbi1wcm9wZXJ0eTpiYWNrZ3JvdW5kLWNvbG9yLCBib3JkZXItY29sb3IsIGNvbG9yLCBmaWxsLCBzdHJva2UsIG9wYWNpdHksIGJveC1zaGFkb3csIHRyYW5zZm9ybTt0cmFuc2l0aW9uLWR1cmF0aW9uOjE1MG1zO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0xKTtmb250LXNpemU6MC44NzVyZW07YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDtib3JkZXItYm90dG9tOjJweCBzb2xpZCB0cmFuc3BhcmVudDtmb250LWZhbWlseTppbmhlcml0fS5pbnB1dDo6LXdlYmtpdC1zZWFyY2gtY2FuY2VsLWJ1dHRvbntkaXNwbGF5Om5vbmV9LmlucHV0OjotbXMtY2xlYXJ7ZGlzcGxheTpub25lfS5pbnB1dDpmb2N1c3tib3gtc2hhZG93Om5vbmU7b3V0bGluZToycHggc29saWQgdHJhbnNwYXJlbnQ7b3V0bGluZS1vZmZzZXQ6MnB4O2JvcmRlci1ib3R0b20tY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1icmFuZCl9XCI7XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlclNlYXJjaCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJTZWFyY2ggPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0dyb3VwQnJvd3NlclNlYXJjaFwiLCA3KTtcbiAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclNlYXJjaElucHV0ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNHcm91cEJyb3dzZXJTZWFyY2hJbnB1dFwiLCA3KTtcbiAgICB0aGlzLnRlcm0gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wbGFjZWhvbGRlciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNob3dDbGVhciA9IGZhbHNlO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuc3RvcmUgPSBnZXRHcm91cEJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4uc2VhcmNoO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IHRlcm0sIHBsYWNlaG9sZGVyIH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiYXJjZ2lzLWJyb3dzZXItc2VhcmNoXCIsIHsgdGVybTogdGVybSwgcGxhY2Vob2xkZXI6IHBsYWNlaG9sZGVyIHx8IHRoaXMuaTE4bi5sYWJlbCwgb25BcmNnaXNCcm93c2VyU2VhcmNoOiAoZSkgPT4gdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJTZWFyY2guZW1pdChlLmRldGFpbCksIG9uQXJjZ2lzQnJvd3NlclNlYXJjaElucHV0OiAoZSkgPT4gdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJTZWFyY2hJbnB1dC5lbWl0KGUuZGV0YWlsKSB9KSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNHcm91cEJyb3dzZXJTZWFyY2guc3R5bGUgPSBhcmNnaXNHcm91cEJyb3dzZXJTZWFyY2hDc3M7XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlclNvcnQgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyU29ydCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzR3JvdXBCcm93c2VyU29ydFwiLCA3KTtcbiAgICB2YXIgX2E7XG4gICAgdGhpcy5vcHRpb25zID0gW1widGl0bGVcIiwgXCJyZWxldmFuY2VcIiwgXCJtb2RpZmllZFwiXTtcbiAgICB0aGlzLmZpZWxkID0gKChfYSA9IHRoaXMub3B0aW9ucykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdKSB8fCBcInJlbGV2YW5jZVwiO1xuICAgIHRoaXMub3JkZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5hY3RpdmVGaWVsZCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmFjdGl2ZU9yZGVyID0gdW5kZWZpbmVkO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuc3RvcmUgPSBnZXRHcm91cEJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICB0aGlzLmFjdGl2ZUZpZWxkID0gdGhpcy5maWVsZDtcbiAgfVxuICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyU29ydC5lbWl0KHtcbiAgICAgIHNvcnRGaWVsZDogdGhpcy5maWVsZCxcbiAgICAgIHNvcnRPcmRlcjogdGhpcy5vcmRlciB8fCBnZXREZWZhdWx0U29ydE9yZGVyKHRoaXMuZmllbGQpXG4gICAgfSk7XG4gIH1cbiAgdXBkYXRlU29ydEZpZWxkKGZpZWxkKSB7XG4gICAgdGhpcy5hY3RpdmVGaWVsZCA9IGZpZWxkO1xuICAgIHRoaXMuYWN0aXZlT3JkZXIgPSBnZXREZWZhdWx0U29ydE9yZGVyKGZpZWxkKTtcbiAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclNvcnQuZW1pdCh7XG4gICAgICBzb3J0RmllbGQ6IHRoaXMuYWN0aXZlRmllbGQsXG4gICAgICBzb3J0T3JkZXI6IHRoaXMuYWN0aXZlT3JkZXJcbiAgICB9KTtcbiAgfVxuICB1cGRhdGVTb3J0T3JkZXIob3JkZXIpIHtcbiAgICB0aGlzLmFjdGl2ZU9yZGVyID0gb3JkZXI7XG4gICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJTb3J0LmVtaXQoe1xuICAgICAgc29ydEZpZWxkOiB0aGlzLmFjdGl2ZUZpZWxkLFxuICAgICAgc29ydE9yZGVyOiB0aGlzLmFjdGl2ZU9yZGVyXG4gICAgfSk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgYWN0aXZlRmllbGQsIGFjdGl2ZU9yZGVyLCBmaWVsZCwgb3JkZXIsIG9wdGlvbnMgfSA9IHRoaXM7XG4gICAgY29uc3Qgc2VsZWN0ZWRGaWVsZCA9IGFjdGl2ZUZpZWxkIHx8IChvcHRpb25zLmluY2x1ZGVzKGZpZWxkKSA/IGZpZWxkIDogb3B0aW9uc1swXSk7XG4gICAgY29uc3Qgc2VsZWN0ZWRPcmRlciA9IGFjdGl2ZU9yZGVyIHx8IG9yZGVyO1xuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiYXJjZ2lzLWJyb3dzZXItc29ydFwiLCB7IHN0b3JlOiB0aGlzLnN0b3JlLCBmaWVsZDogc2VsZWN0ZWRGaWVsZCwgb3JkZXI6IHNlbGVjdGVkT3JkZXIsIG9wdGlvbnM6IG9wdGlvbnMsIG9uQXJjZ2lzQnJvd3NlclNvcnRGaWVsZENoYW5nZTogKGUpID0+IHRoaXMudXBkYXRlU29ydEZpZWxkKGUuZGV0YWlsKSwgb25BcmNnaXNCcm93c2VyU29ydE9yZGVyQ2hhbmdlOiAoZSkgPT4gdGhpcy51cGRhdGVTb3J0T3JkZXIoZS5kZXRhaWwpIH0pKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcblxuY29uc3QgQXJjZ2lzR3JvdXBCcm93c2VyVG9wQmFyID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLnN0b3JlID0gZ2V0R3JvdXBCcm93c2VyU3RvcmUodGhpcy5lbCk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiYXJjZ2lzLWJyb3dzZXItdG9wLWJhclwiLCB7IHN0b3JlOiB0aGlzLnN0b3JlIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRlbnQtc3RhcnRcIiB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwiY29udGVudC1zdGFydFwiIH0pKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwic2VhcmNoXCIgfSwgaChcInNsb3RcIiwgeyBuYW1lOiBcInNlYXJjaFwiIH0pKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiY29udGVudC1lbmRcIiB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwiY29udGVudC1lbmRcIiB9KSkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcblxuZXhwb3J0IHsgQXJjZ2lzR3JvdXBCcm93c2VyIGFzIGFyY2dpc19ncm91cF9icm93c2VyLCBBcmNnaXNHcm91cEJyb3dzZXJBY3Rpb25zIGFzIGFyY2dpc19ncm91cF9icm93c2VyX2FjdGlvbnMsIEFyY2dpc0dyb3VwQnJvd3NlckNvbnRlbnQgYXMgYXJjZ2lzX2dyb3VwX2Jyb3dzZXJfY29udGVudCwgQXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyRGF0ZSBhcyBhcmNnaXNfZ3JvdXBfYnJvd3Nlcl9maWx0ZXJfZGF0ZSwgQXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyR3JvdXBzQnlVc2VyIGFzIGFyY2dpc19ncm91cF9icm93c2VyX2ZpbHRlcl9ncm91cHNfYnlfdXNlciwgQXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyTWVtYmVyT3JnIGFzIGFyY2dpc19ncm91cF9icm93c2VyX2ZpbHRlcl9tZW1iZXJfb3JnLCBBcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXJNZW1iZXJzaGlwIGFzIGFyY2dpc19ncm91cF9icm93c2VyX2ZpbHRlcl9tZW1iZXJzaGlwLCBBcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXJPd25lciBhcyBhcmNnaXNfZ3JvdXBfYnJvd3Nlcl9maWx0ZXJfb3duZXIsIEFyY2dpc0dyb3VwQnJvd3NlckZpbHRlclNwZWNpYWxHcm91cHMgYXMgYXJjZ2lzX2dyb3VwX2Jyb3dzZXJfZmlsdGVyX3NwZWNpYWxfZ3JvdXBzLCBBcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXJzIGFzIGFyY2dpc19ncm91cF9icm93c2VyX2ZpbHRlcnMsIEFyY2dpc0dyb3VwQnJvd3NlclBhZ2luYXRpb24gYXMgYXJjZ2lzX2dyb3VwX2Jyb3dzZXJfcGFnaW5hdGlvbiwgQXJjZ2lzR3JvdXBCcm93c2VyUHJldmlldyBhcyBhcmNnaXNfZ3JvdXBfYnJvd3Nlcl9wcmV2aWV3LCBBcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3Q2FyZCBhcyBhcmNnaXNfZ3JvdXBfYnJvd3Nlcl9wcmV2aWV3X2NhcmQsIEFyY2dpc0dyb3VwQnJvd3NlclNlYXJjaCBhcyBhcmNnaXNfZ3JvdXBfYnJvd3Nlcl9zZWFyY2gsIEFyY2dpc0dyb3VwQnJvd3NlclNvcnQgYXMgYXJjZ2lzX2dyb3VwX2Jyb3dzZXJfc29ydCwgQXJjZ2lzR3JvdXBCcm93c2VyVG9wQmFyIGFzIGFyY2dpc19ncm91cF9icm93c2VyX3RvcF9iYXIgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuZnVuY3Rpb24gZ2V0UG9ydGFsQmFzZVVybChwb3J0YWwpIHtcbiAgY29uc3QgeyBjdXN0b21CYXNlVXJsLCBwb3J0YWxIb3N0bmFtZSwgdXJsS2V5IH0gPSBwb3J0YWw7XG4gIGNvbnN0IHsgcHJvdG9jb2wgfSA9IHdpbmRvdy5sb2NhdGlvbjtcbiAgY29uc3QgdXJsID0gdXJsS2V5ID8gYCR7dXJsS2V5fS4ke2N1c3RvbUJhc2VVcmx9YCA6IHBvcnRhbEhvc3RuYW1lO1xuICByZXR1cm4gYCR7cHJvdG9jb2x9Ly8ke3VybH1gO1xufVxuXG5leHBvcnQgeyBnZXRQb3J0YWxCYXNlVXJsIGFzIGcgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVTdG9yZSB9IGZyb20gJy4vaW5kZXgtODFkNTQ4YjcuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRTdG9yZSB9IGZyb20gJy4vc3RvcmUtZmYwNGJhMGEuanMnO1xuXG5mdW5jdGlvbiBnZXRHcm91cEJyb3dzZXJTdG9yZShlbCkge1xuICByZXR1cm4gZ2V0U3RvcmUoZWwsIFwiYXJjZ2lzLWdyb3VwLWJyb3dzZXJcIik7XG59XG5jb25zdCBHcm91cEJyb3dzZXJTdG9yZSA9IGNyZWF0ZVN0b3JlKHsgZmlsdGVyczoge30gfSk7XG5jb25zdCBncm91cEJyb3dzZXJTdGF0ZSA9IEdyb3VwQnJvd3NlclN0b3JlLnN0YXRlO1xuXG5leHBvcnQgeyBncm91cEJyb3dzZXJTdGF0ZSBhcyBhLCBnZXRHcm91cEJyb3dzZXJTdG9yZSBhcyBnIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=