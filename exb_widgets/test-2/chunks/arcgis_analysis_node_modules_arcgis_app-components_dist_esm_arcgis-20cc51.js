"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-20cc51"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-data-store-select-server-list.entry.js":
/*!******************************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-data-store-select-server-list.entry.js ***!
  \******************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_data_store_select_server_list: () => (/* binding */ ArcgisNewItemPagesDataStoreSelectServerList)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _data_store_f509564d_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./data-store-f509564d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/data-store-f509564d.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _data_store_e8b5ce2f_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./data-store-e8b5ce2f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/data-store-e8b5ce2f.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _item_d9d70416_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./item-d9d70416.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-d9d70416.js");
/* harmony import */ var _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./feature-layer-38cdae87.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-38cdae87.js");
/* harmony import */ var _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./item-properties-e6412a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js");
/* harmony import */ var _feature_layer_d33ea114_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./feature-layer-d33ea114.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-d33ea114.js");
/* harmony import */ var _guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./guid-4f4176ba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js");
/* harmony import */ var _thumbnail_0b7adfcd_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./thumbnail-0b7adfcd.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-0b7adfcd.js");
/* harmony import */ var _query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./query-4f7b7e4d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-4f7b7e4d.js");
/* harmony import */ var _user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./user-e3dedc4a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js");
/* harmony import */ var _api_f7934cd7_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./api-f7934cd7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-f7934cd7.js");
/* harmony import */ var _server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./server-item-f12153e6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js");
/* harmony import */ var _functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./functional-9f648bee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-9f648bee.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _feature_layer_69305a85_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./feature-layer-69305a85.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-69305a85.js");
/* harmony import */ var _ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./ags-68d4ae20.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-68d4ae20.js");
/* harmony import */ var _url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./url-f3b82cc7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-f3b82cc7.js");
/* harmony import */ var _storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./storage-d7f5822e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js");
/* harmony import */ var _file_f36193e9_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./file-f36193e9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-f36193e9.js");
/* harmony import */ var _store_3210b604_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./store-3210b604.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-3210b604.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */































const arcgisNewItemPagesDataStoreSelectServerListCss = ".sub-heading {\n  color: var(--calcite-ui-text-3);\n  font-weight: 400;\n}\n\n.row-wrapper {\n  width: 100%;\n  padding-top: 0.75rem;\n  margin-top: 0.5rem;\n  margin-bottom: 0.5rem;\n  display: flex;\n}\n\n.row-divider {\n  box-shadow: 0 -1px 0 #eaeaea;\n}\n\n.title {\n  grid-gap: 0.5rem;\n  gap: 0.5rem;\n}\n\n.status-wrapper {\n  display: flex;\n  grid-gap: 0.5rem;\n  gap: 0.5rem;\n  line-height: 1rem;\n}\n\n.success {\n  --calcite-ui-icon-color: var(--calcite-ui-success);\n}\n\n.failure {\n  --calcite-ui-icon-color: var(--calcite-ui-danger);\n}\n\n.error {\n  --calcite-ui-icon-color: var(--calcite-ui-danger);\n}\n\n.validating {\n  --calcite-ui-icon-color: var(--calcite-ui-info);\n}\n\n.half-row {\n  width: 50%;\n  padding-left: 0.5rem;\n  padding-right: 0.5rem;\n}\n\n.server-wrapper {\n  &:hover {\n    cursor: pointer;\n  }\n}\n";

const ArcgisNewItemPagesDataStoreSelectServerList = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.loading = true;
    this.noValidServers = true;
    this.serverTypes = [];
    this.serverStatusIcons = {
      success: "check-circle-f",
      failure: "exclamation-mark-circle-f",
      error: "exclamation-mark-triangle-f",
      validating: "information"
    };
    this.selectedServers = [];
    this.serverList = [];
    this.allBoxesSelected = false;
    this.error = null;
  }
  async componentWillLoad() {
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.serverSelection;
    this.dataStoreType = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_2__.a.addDataStoreType;
    this.serverList = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_2__.a.dataStoreSelectServerList || [];
    this.serverList = this.filterServers(false, false, false, false);
  }
  async componentDidLoad() {
    //TODO: catch unhandled errors
    const validatedServers = await (0,_data_store_f509564d_js__WEBPACK_IMPORTED_MODULE_1__.c)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_2__.a, this.serverList, this.dataStoreType);
    this.serverList = [...validatedServers];
    const result = await (0,_data_store_f509564d_js__WEBPACK_IMPORTED_MODULE_1__.d)(this.serverList);
    this.serverList = [...result.servers];
    this.serverTypes = [...result.serverTypes];
    this.renderTable();
    this.appendServerTypes();
    this.loading = false;
  }
  filterServers(isBigDataFileShare, isNoSQL, isHostingServerOnlyForDatabase, isNFS) {
    return (this.serverList || []).filter((server) => {
      const serverRole = (server.serverRole || "").toUpperCase();
      const excludedServerRoles = [
        "ARCGIS_NOTEBOOK_SERVER",
        "ARCGIS_MISSION_SERVER",
        "ARCGIS_VIDEO_SERVER"
      ];
      const serverFunctions = (server.serverFunction && server.serverFunction.replace(/\s+/g, "").split(",")) || [];
      const excludedServerFunctions = [
        "NOTEBOOKSERVER",
        "WORKFLOWMANAGER",
        "MISSIONSERVER",
        "VIDEOSERVER"
      ];
      let isHostingServer = serverRole === "HOSTING_SERVER";
      // only display GeoAnalytics server for BDFS
      if (isBigDataFileShare && serverFunctions.indexOf("GeoAnalytics") === -1) {
        excludedServerRoles.push(serverRole);
        isHostingServer = false;
      }
      if (isNoSQL && serverFunctions.indexOf("KnowledgeServer") === -1) {
        excludedServerRoles.push(serverRole);
        isHostingServer = false;
      }
      if (isNFS && (0,_data_store_e8b5ce2f_js__WEBPACK_IMPORTED_MODULE_4__.i)()) {
        isHostingServer = true;
      }
      let allowedServerRole = excludedServerRoles.indexOf(serverRole) === -1;
      // only display hosting servers for Database when client type is bigquery, snowflake or redshift
      if (isHostingServerOnlyForDatabase) {
        allowedServerRole = false;
      }
      return (isHostingServer ||
        (allowedServerRole &&
          (!serverFunctions.length ||
            serverFunctions.some(function (func) {
              return excludedServerFunctions.indexOf(func.toUpperCase()) === -1;
            }))));
    });
  }
  renderTable() {
    const dataStoreType = this.dataStoreType;
    const isBigDataFileShare = dataStoreType === "bdfs";
    const isNoSQL = dataStoreType === "nosql";
    const isNFS = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_2__.a.serverFolderPath === "nfsHostAndPath" && dataStoreType === "folder";
    // filter servers and only display hosting servers for database: bigquery, snowflake or redshift
    const isHostingServerOnlyForDatabase = this.checkDatabaseClient();
    // filter servers for bdfs
    this.serverList = this.filterServers(isBigDataFileShare, isNoSQL, isHostingServerOnlyForDatabase, isNFS);
    // filter servers by users input server path - only for folder & file share
    if (!isNFS) {
      if (["folder", "fileshare"].includes(dataStoreType)) {
        this.serverList = this.filterServersByServerPath();
      }
    }
  }
  checkDatabaseClient() {
    const dataStoreType = this.dataStoreType;
    const publisherConnectionString = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_2__.a.publisherConnectionString;
    let isHostingServerOnly = false;
    if (dataStoreType === "database" && publisherConnectionString) {
      const dbConnectionStringArray = publisherConnectionString.split(";");
      dbConnectionStringArray.forEach(function (keyword) {
        // "DBCLIENT=bigquery"
        if (keyword.indexOf("DBCLIENT") > -1 &&
          ["bigquery", "snowflake", "redshift"].indexOf(keyword.split("=")[1]) > -1) {
          isHostingServerOnly = true;
        }
      });
    }
    return isHostingServerOnly;
  }
  filterServersByServerPath() {
    const dataStoreType = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_2__.a.addDataStoreType;
    const serverPath = dataStoreType === "folder"
      ? _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_2__.a.newServerFolderPath || _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_2__.a.publisherFolderPath
      : _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_2__.a.publisherFileShareFolderPath;
    const serverPathType = serverPath[0].indexOf("/") > -1 ? "Linux" : "Windows";
    const isNFS = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_2__.a.serverFolderPath === "nfsHostAndPath" && dataStoreType === "folder";
    return this.serverList.filter((federatedServer) => {
      return !!this.serverTypes.find((serverItem) => {
        return ((serverItem.name === federatedServer.adminUrl ||
          serverItem.name === `${federatedServer.adminUrl}/admin`) &&
          (isNFS ? federatedServer.isHosted : serverItem.type === serverPathType));
      });
    });
  }
  appendServerTypes() {
    const { serverList, i18n } = this;
    serverList.map((server) => {
      const serverFunction = (server.serverFunction && server.serverFunction.replace(/\s+/g, "").split(",")) || [];
      let serverType = "";
      if (server.serverRole === "HOSTING_SERVER") {
        serverType += i18n.types.hostedSetting;
      }
      if (serverFunction.indexOf("NotebookServer") > -1) {
        serverType += (serverType && ", ") + i18n.types.notebookServerSetting;
      }
      if (serverFunction.indexOf("GeoAnalytics") > -1) {
        serverType += (serverType && ", ") + i18n.types.geoAnalyticsServerSetting;
      }
      if (serverFunction.indexOf("RasterAnalytics") > -1) {
        serverType += (serverType && ", ") + i18n.types.rasterAnalysisSetting;
      }
      if (serverFunction.indexOf("ImageHosting") > -1) {
        serverType += (serverType && ", ") + i18n.types.imageHostingSetting;
      }
      if (serverFunction.indexOf("MissionServer") > -1) {
        serverType += (serverType && ", ") + i18n.types.missionServerSetting;
      }
      server.serverType = serverType;
    });
  }
  convertStatusDisplayText(server) {
    const i18n = this.i18n;
    const status = server.serverStatus;
    const displayTable = {
      success: i18n.status.success,
      failure: i18n.status.failure,
      error: i18n.status.error,
      validating: i18n.status.validating
    };
    return displayTable[status];
  }
  checkValidServers() {
    this.noValidServers = !this.serverList.some((server) => {
      return server.serverStatus === "success";
    });
  }
  checkAllBoxes() {
    this.selectedServers = [...[]];
    if (!this.allBoxesSelected) {
      this.serverList.forEach((server) => {
        this.selectedServers = [...this.selectedServers, server.id];
      });
    }
    this.allBoxesSelected = !this.allBoxesSelected;
  }
  handleNext() {
    const selectedServers = this.selectedServers || [];
    if (selectedServers.length === 0) {
      this.error = "noServerSelected";
      return;
    }
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_2__.a.dataStoreSelectedServers = selectedServers;
    this.newItemUpdatePage.emit("itemProperties");
  }
  render() {
    const { i18n, error, serverList, dataStoreType, loading, allBoxesSelected, noValidServers } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: dataStoreType === "bdfs" && ["fileshare", "cloud"].includes(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_2__.a.bdfsType)
        ? i18n.dataStoreServerSelect.bdfsHeading
        : i18n.dataStoreServerSelect.heading }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "sub-heading" }, i18n.dataStoreServerSelect.subHeading), loading ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: "server-loader", text: i18n.loader.validating })) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "row-wrapper" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "half-row" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { disabled: noValidServers, checked: allBoxesSelected, onCalciteCheckboxChange: () => {
        this.checkAllBoxes();
      } }), i18n.list.title)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "half-row" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline" }, i18n.list.status))), serverList.map((server) => {
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "row-wrapper row-divider" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "half-row" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline", class: "server-wrapper" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { disabled: server.serverStatus !== "success", value: server.id, onCalciteCheckboxChange: (e) => {
          const serverId = e.target.value;
          if (this.selectedServers.indexOf(serverId) === -1) {
            this.selectedServers = [...this.selectedServers, serverId];
          }
          else {
            this.selectedServers = this.selectedServers.filter((server) => {
              return server !== serverId;
            });
          }
        }, checked: this.selectedServers.includes(server.id) }), server.url + (server.serverType && ` (${server.serverType})`))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "half-row" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "status-wrapper", title: server.errorMsg || server.serverStatus }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { class: {
          success: server.serverStatus === "success",
          failure: server.serverStatus === "failure",
          error: server.serverStatus === "error",
          validating: server.serverStatus === "validating"
        }, scale: "s", icon: this.serverStatusIcons[server.serverStatus] }), this.convertStatusDisplayText(server)))));
    }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: i18n.dataStoreServerSelect.noServerSelected.heading, description: i18n.dataStoreServerSelect.noServerSelected.description, active: error !== null && !loading, onAlertDismiss: () => {
        this.error = null;
      } })))));
  }
  static get watchers() { return {
    "serverList": ["checkValidServers"]
  }; }
};
ArcgisNewItemPagesDataStoreSelectServerList.style = arcgisNewItemPagesDataStoreSelectServerListCss;




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTIwY2M1MS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDZ0c7QUFDRztBQUN4QztBQUNOO0FBQzBCO0FBQ2pEO0FBQ0s7QUFDTDtBQUNEO0FBQ0s7QUFDQTtBQUNOO0FBQ1M7QUFDRTtBQUNGO0FBQ1Q7QUFDSztBQUNKO0FBQ0Q7QUFDRDtBQUNRO0FBQ0Q7QUFDQTtBQUNQO0FBQ1U7QUFDVjtBQUNBO0FBQ0k7QUFDSDtBQUNDOztBQUU3QixzRUFBc0Usb0NBQW9DLHFCQUFxQixHQUFHLGtCQUFrQixnQkFBZ0IseUJBQXlCLHVCQUF1QiwwQkFBMEIsa0JBQWtCLEdBQUcsa0JBQWtCLGlDQUFpQyxHQUFHLFlBQVkscUJBQXFCLGdCQUFnQixHQUFHLHFCQUFxQixrQkFBa0IscUJBQXFCLGdCQUFnQixzQkFBc0IsR0FBRyxjQUFjLHVEQUF1RCxHQUFHLGNBQWMsc0RBQXNELEdBQUcsWUFBWSxzREFBc0QsR0FBRyxpQkFBaUIsb0RBQW9ELEdBQUcsZUFBZSxlQUFlLHlCQUF5QiwwQkFBMEIsR0FBRyxxQkFBcUIsYUFBYSxzQkFBc0IsS0FBSyxHQUFHOztBQUVsNEI7QUFDQTtBQUNBLElBQUkscURBQWdCO0FBQ3BCLDZCQUE2QixxREFBVztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsOENBQVk7QUFDNUIseUJBQXlCLG9EQUFZO0FBQ3JDLHNCQUFzQixvREFBWTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQywwREFBMkIsQ0FBQyxvREFBWTtBQUMzRTtBQUNBLHlCQUF5QiwwREFBZ0I7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsMERBQThCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixvREFBWTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxvREFBWTtBQUNsRDtBQUNBO0FBQ0Esd0VBQXdFO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixvREFBWTtBQUN0QztBQUNBLFFBQVEsb0RBQVksd0JBQXdCLG9EQUFZO0FBQ3hELFFBQVEsb0RBQVk7QUFDcEI7QUFDQSxrQkFBa0Isb0RBQVk7QUFDOUI7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLHlCQUF5QjtBQUMxRDtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVksbUJBQW1CO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxvREFBWTtBQUNoQjtBQUNBO0FBQ0E7QUFDQSxZQUFZLG9GQUFvRjtBQUNoRyxZQUFZLHFEQUFDLGNBQWMscURBQUMsa0NBQWtDLG9FQUFvRSxvREFBWTtBQUM5STtBQUNBLDhDQUE4QyxHQUFHLHFEQUFDLFFBQVEsc0JBQXNCLHFEQUFxRCxxREFBQyxxQkFBcUIsc0RBQXNELE1BQU0scURBQUMsQ0FBQyxpREFBUSxRQUFRLHFEQUFDLFVBQVUsc0JBQXNCLEVBQUUscURBQUMsVUFBVSxtQkFBbUIsRUFBRSxxREFBQyxvQkFBb0Isa0JBQWtCLEVBQUUscURBQUMsdUJBQXVCO0FBQzdXO0FBQ0EsU0FBUyxzQkFBc0IscURBQUMsVUFBVSxtQkFBbUIsRUFBRSxxREFBQyxvQkFBb0Isa0JBQWtCO0FBQ3RHLGNBQWMscURBQUMsVUFBVSxrQ0FBa0MsRUFBRSxxREFBQyxVQUFVLG1CQUFtQixFQUFFLHFEQUFDLG9CQUFvQiwyQ0FBMkMsRUFBRSxxREFBQyx1QkFBdUI7QUFDdkw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxTQUFTLHFEQUFxRCwyQ0FBMkMsa0JBQWtCLE9BQU8scURBQUMsVUFBVSxtQkFBbUIsRUFBRSxxREFBQyxVQUFVLHdFQUF3RSxFQUFFLHFEQUFDLG1CQUFtQjtBQUMzUTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVMsaUVBQWlFO0FBQzFFLEtBQUssR0FBRyxxREFBQyw0QkFBNEI7QUFDckM7QUFDQSxTQUFTO0FBQ1Q7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7O0FBRThHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtc2VsZWN0LXNlcnZlci1saXN0LmVudHJ5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBGIGFzIEZyYWdtZW50IH0gZnJvbSAnLi9pbmRleC05MmViYjM5Ni5qcyc7XG5pbXBvcnQgeyBjIGFzIHZhbGlkYXRlRGF0YXN0b3JlRm9yU2VydmVycywgZCBhcyBjaGVja1NlcnZlcnNUeXBlIH0gZnJvbSAnLi9kYXRhLXN0b3JlLWY1MDk1NjRkLmpzJztcbmltcG9ydCB7IGEgYXMgYWRkSXRlbVN0YXRlIH0gZnJvbSAnLi9hZGQtaXRlbS05N2Q1NzdhOS5qcyc7XG5pbXBvcnQgeyB1IGFzIHVpU3RvcmVTdGF0ZSB9IGZyb20gJy4vdWktZWNmODZiYmEuanMnO1xuaW1wb3J0IHsgaSBhcyBpc0FyY0dJU0VudGVycHJpc2VPbkt1YmVybmV0ZXMgfSBmcm9tICcuL2RhdGEtc3RvcmUtZThiNWNlMmYuanMnO1xuaW1wb3J0ICcuL3BvcnRhbC03OWNhYWVmZi5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYWFmMzBiZDYuanMnO1xuaW1wb3J0ICcuL2NvbmZpZy1lYjVmN2RjMi5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtODFkNTQ4YjcuanMnO1xuaW1wb3J0ICcuL3ByaXZpbGVnZXMtY2NkNWYzN2QuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtYzgyZjVhYjkuanMnO1xuaW1wb3J0ICcuL2l0ZW0tZDlkNzA0MTYuanMnO1xuaW1wb3J0ICcuL2ZlYXR1cmUtbGF5ZXItMzhjZGFlODcuanMnO1xuaW1wb3J0ICcuL2l0ZW0tcHJvcGVydGllcy1lNjQxMmE5YS5qcyc7XG5pbXBvcnQgJy4vZmVhdHVyZS1sYXllci1kMzNlYTExNC5qcyc7XG5pbXBvcnQgJy4vZ3VpZC00ZjQxNzZiYS5qcyc7XG5pbXBvcnQgJy4vdGh1bWJuYWlsLTBiN2FkZmNkLmpzJztcbmltcG9ydCAnLi9xdWVyeS00ZjdiN2U0ZC5qcyc7XG5pbXBvcnQgJy4vdXNlci1lM2RlZGM0YS5qcyc7XG5pbXBvcnQgJy4vYXBpLWY3OTM0Y2Q3LmpzJztcbmltcG9ydCAnLi9zZXJ2ZXItaXRlbS1mMTIxNTNlNi5qcyc7XG5pbXBvcnQgJy4vZnVuY3Rpb25hbC05ZjY0OGJlZS5qcyc7XG5pbXBvcnQgJy4vaXRlbS10eXBlcy1iNGZlODZhZC5qcyc7XG5pbXBvcnQgJy4vZG9tLTEzZjViMDBjLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTY5MzA1YTg1LmpzJztcbmltcG9ydCAnLi9hZ3MtNjhkNGFlMjAuanMnO1xuaW1wb3J0ICcuL3VybC1mM2I4MmNjNy5qcyc7XG5pbXBvcnQgJy4vc3RvcmFnZS1kN2Y1ODIyZS5qcyc7XG5pbXBvcnQgJy4vZmlsZS1mMzYxOTNlOS5qcyc7XG5pbXBvcnQgJy4vc3RvcmUtMzIxMGI2MDQuanMnO1xuXG5jb25zdCBhcmNnaXNOZXdJdGVtUGFnZXNEYXRhU3RvcmVTZWxlY3RTZXJ2ZXJMaXN0Q3NzID0gXCIuc3ViLWhlYWRpbmcge1xcbiAgY29sb3I6IHZhcigtLWNhbGNpdGUtdWktdGV4dC0zKTtcXG4gIGZvbnQtd2VpZ2h0OiA0MDA7XFxufVxcblxcbi5yb3ctd3JhcHBlciB7XFxuICB3aWR0aDogMTAwJTtcXG4gIHBhZGRpbmctdG9wOiAwLjc1cmVtO1xcbiAgbWFyZ2luLXRvcDogMC41cmVtO1xcbiAgbWFyZ2luLWJvdHRvbTogMC41cmVtO1xcbiAgZGlzcGxheTogZmxleDtcXG59XFxuXFxuLnJvdy1kaXZpZGVyIHtcXG4gIGJveC1zaGFkb3c6IDAgLTFweCAwICNlYWVhZWE7XFxufVxcblxcbi50aXRsZSB7XFxuICBncmlkLWdhcDogMC41cmVtO1xcbiAgZ2FwOiAwLjVyZW07XFxufVxcblxcbi5zdGF0dXMtd3JhcHBlciB7XFxuICBkaXNwbGF5OiBmbGV4O1xcbiAgZ3JpZC1nYXA6IDAuNXJlbTtcXG4gIGdhcDogMC41cmVtO1xcbiAgbGluZS1oZWlnaHQ6IDFyZW07XFxufVxcblxcbi5zdWNjZXNzIHtcXG4gIC0tY2FsY2l0ZS11aS1pY29uLWNvbG9yOiB2YXIoLS1jYWxjaXRlLXVpLXN1Y2Nlc3MpO1xcbn1cXG5cXG4uZmFpbHVyZSB7XFxuICAtLWNhbGNpdGUtdWktaWNvbi1jb2xvcjogdmFyKC0tY2FsY2l0ZS11aS1kYW5nZXIpO1xcbn1cXG5cXG4uZXJyb3Ige1xcbiAgLS1jYWxjaXRlLXVpLWljb24tY29sb3I6IHZhcigtLWNhbGNpdGUtdWktZGFuZ2VyKTtcXG59XFxuXFxuLnZhbGlkYXRpbmcge1xcbiAgLS1jYWxjaXRlLXVpLWljb24tY29sb3I6IHZhcigtLWNhbGNpdGUtdWktaW5mbyk7XFxufVxcblxcbi5oYWxmLXJvdyB7XFxuICB3aWR0aDogNTAlO1xcbiAgcGFkZGluZy1sZWZ0OiAwLjVyZW07XFxuICBwYWRkaW5nLXJpZ2h0OiAwLjVyZW07XFxufVxcblxcbi5zZXJ2ZXItd3JhcHBlciB7XFxuICAmOmhvdmVyIHtcXG4gICAgY3Vyc29yOiBwb2ludGVyO1xcbiAgfVxcbn1cXG5cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbVBhZ2VzRGF0YVN0b3JlU2VsZWN0U2VydmVyTGlzdCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVVwZGF0ZVBhZ2VcIiwgNyk7XG4gICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICB0aGlzLm5vVmFsaWRTZXJ2ZXJzID0gdHJ1ZTtcbiAgICB0aGlzLnNlcnZlclR5cGVzID0gW107XG4gICAgdGhpcy5zZXJ2ZXJTdGF0dXNJY29ucyA9IHtcbiAgICAgIHN1Y2Nlc3M6IFwiY2hlY2stY2lyY2xlLWZcIixcbiAgICAgIGZhaWx1cmU6IFwiZXhjbGFtYXRpb24tbWFyay1jaXJjbGUtZlwiLFxuICAgICAgZXJyb3I6IFwiZXhjbGFtYXRpb24tbWFyay10cmlhbmdsZS1mXCIsXG4gICAgICB2YWxpZGF0aW5nOiBcImluZm9ybWF0aW9uXCJcbiAgICB9O1xuICAgIHRoaXMuc2VsZWN0ZWRTZXJ2ZXJzID0gW107XG4gICAgdGhpcy5zZXJ2ZXJMaXN0ID0gW107XG4gICAgdGhpcy5hbGxCb3hlc1NlbGVjdGVkID0gZmFsc2U7XG4gICAgdGhpcy5lcnJvciA9IG51bGw7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5pMThuID0gdWlTdG9yZVN0YXRlLmkxOG4uc2VydmVyU2VsZWN0aW9uO1xuICAgIHRoaXMuZGF0YVN0b3JlVHlwZSA9IGFkZEl0ZW1TdGF0ZS5hZGREYXRhU3RvcmVUeXBlO1xuICAgIHRoaXMuc2VydmVyTGlzdCA9IGFkZEl0ZW1TdGF0ZS5kYXRhU3RvcmVTZWxlY3RTZXJ2ZXJMaXN0IHx8IFtdO1xuICAgIHRoaXMuc2VydmVyTGlzdCA9IHRoaXMuZmlsdGVyU2VydmVycyhmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSk7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAvL1RPRE86IGNhdGNoIHVuaGFuZGxlZCBlcnJvcnNcbiAgICBjb25zdCB2YWxpZGF0ZWRTZXJ2ZXJzID0gYXdhaXQgdmFsaWRhdGVEYXRhc3RvcmVGb3JTZXJ2ZXJzKGFkZEl0ZW1TdGF0ZSwgdGhpcy5zZXJ2ZXJMaXN0LCB0aGlzLmRhdGFTdG9yZVR5cGUpO1xuICAgIHRoaXMuc2VydmVyTGlzdCA9IFsuLi52YWxpZGF0ZWRTZXJ2ZXJzXTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjaGVja1NlcnZlcnNUeXBlKHRoaXMuc2VydmVyTGlzdCk7XG4gICAgdGhpcy5zZXJ2ZXJMaXN0ID0gWy4uLnJlc3VsdC5zZXJ2ZXJzXTtcbiAgICB0aGlzLnNlcnZlclR5cGVzID0gWy4uLnJlc3VsdC5zZXJ2ZXJUeXBlc107XG4gICAgdGhpcy5yZW5kZXJUYWJsZSgpO1xuICAgIHRoaXMuYXBwZW5kU2VydmVyVHlwZXMoKTtcbiAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgfVxuICBmaWx0ZXJTZXJ2ZXJzKGlzQmlnRGF0YUZpbGVTaGFyZSwgaXNOb1NRTCwgaXNIb3N0aW5nU2VydmVyT25seUZvckRhdGFiYXNlLCBpc05GUykge1xuICAgIHJldHVybiAodGhpcy5zZXJ2ZXJMaXN0IHx8IFtdKS5maWx0ZXIoKHNlcnZlcikgPT4ge1xuICAgICAgY29uc3Qgc2VydmVyUm9sZSA9IChzZXJ2ZXIuc2VydmVyUm9sZSB8fCBcIlwiKS50b1VwcGVyQ2FzZSgpO1xuICAgICAgY29uc3QgZXhjbHVkZWRTZXJ2ZXJSb2xlcyA9IFtcbiAgICAgICAgXCJBUkNHSVNfTk9URUJPT0tfU0VSVkVSXCIsXG4gICAgICAgIFwiQVJDR0lTX01JU1NJT05fU0VSVkVSXCIsXG4gICAgICAgIFwiQVJDR0lTX1ZJREVPX1NFUlZFUlwiXG4gICAgICBdO1xuICAgICAgY29uc3Qgc2VydmVyRnVuY3Rpb25zID0gKHNlcnZlci5zZXJ2ZXJGdW5jdGlvbiAmJiBzZXJ2ZXIuc2VydmVyRnVuY3Rpb24ucmVwbGFjZSgvXFxzKy9nLCBcIlwiKS5zcGxpdChcIixcIikpIHx8IFtdO1xuICAgICAgY29uc3QgZXhjbHVkZWRTZXJ2ZXJGdW5jdGlvbnMgPSBbXG4gICAgICAgIFwiTk9URUJPT0tTRVJWRVJcIixcbiAgICAgICAgXCJXT1JLRkxPV01BTkFHRVJcIixcbiAgICAgICAgXCJNSVNTSU9OU0VSVkVSXCIsXG4gICAgICAgIFwiVklERU9TRVJWRVJcIlxuICAgICAgXTtcbiAgICAgIGxldCBpc0hvc3RpbmdTZXJ2ZXIgPSBzZXJ2ZXJSb2xlID09PSBcIkhPU1RJTkdfU0VSVkVSXCI7XG4gICAgICAvLyBvbmx5IGRpc3BsYXkgR2VvQW5hbHl0aWNzIHNlcnZlciBmb3IgQkRGU1xuICAgICAgaWYgKGlzQmlnRGF0YUZpbGVTaGFyZSAmJiBzZXJ2ZXJGdW5jdGlvbnMuaW5kZXhPZihcIkdlb0FuYWx5dGljc1wiKSA9PT0gLTEpIHtcbiAgICAgICAgZXhjbHVkZWRTZXJ2ZXJSb2xlcy5wdXNoKHNlcnZlclJvbGUpO1xuICAgICAgICBpc0hvc3RpbmdTZXJ2ZXIgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmIChpc05vU1FMICYmIHNlcnZlckZ1bmN0aW9ucy5pbmRleE9mKFwiS25vd2xlZGdlU2VydmVyXCIpID09PSAtMSkge1xuICAgICAgICBleGNsdWRlZFNlcnZlclJvbGVzLnB1c2goc2VydmVyUm9sZSk7XG4gICAgICAgIGlzSG9zdGluZ1NlcnZlciA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKGlzTkZTICYmIGlzQXJjR0lTRW50ZXJwcmlzZU9uS3ViZXJuZXRlcygpKSB7XG4gICAgICAgIGlzSG9zdGluZ1NlcnZlciA9IHRydWU7XG4gICAgICB9XG4gICAgICBsZXQgYWxsb3dlZFNlcnZlclJvbGUgPSBleGNsdWRlZFNlcnZlclJvbGVzLmluZGV4T2Yoc2VydmVyUm9sZSkgPT09IC0xO1xuICAgICAgLy8gb25seSBkaXNwbGF5IGhvc3Rpbmcgc2VydmVycyBmb3IgRGF0YWJhc2Ugd2hlbiBjbGllbnQgdHlwZSBpcyBiaWdxdWVyeSwgc25vd2ZsYWtlIG9yIHJlZHNoaWZ0XG4gICAgICBpZiAoaXNIb3N0aW5nU2VydmVyT25seUZvckRhdGFiYXNlKSB7XG4gICAgICAgIGFsbG93ZWRTZXJ2ZXJSb2xlID0gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gKGlzSG9zdGluZ1NlcnZlciB8fFxuICAgICAgICAoYWxsb3dlZFNlcnZlclJvbGUgJiZcbiAgICAgICAgICAoIXNlcnZlckZ1bmN0aW9ucy5sZW5ndGggfHxcbiAgICAgICAgICAgIHNlcnZlckZ1bmN0aW9ucy5zb21lKGZ1bmN0aW9uIChmdW5jKSB7XG4gICAgICAgICAgICAgIHJldHVybiBleGNsdWRlZFNlcnZlckZ1bmN0aW9ucy5pbmRleE9mKGZ1bmMudG9VcHBlckNhc2UoKSkgPT09IC0xO1xuICAgICAgICAgICAgfSkpKSk7XG4gICAgfSk7XG4gIH1cbiAgcmVuZGVyVGFibGUoKSB7XG4gICAgY29uc3QgZGF0YVN0b3JlVHlwZSA9IHRoaXMuZGF0YVN0b3JlVHlwZTtcbiAgICBjb25zdCBpc0JpZ0RhdGFGaWxlU2hhcmUgPSBkYXRhU3RvcmVUeXBlID09PSBcImJkZnNcIjtcbiAgICBjb25zdCBpc05vU1FMID0gZGF0YVN0b3JlVHlwZSA9PT0gXCJub3NxbFwiO1xuICAgIGNvbnN0IGlzTkZTID0gYWRkSXRlbVN0YXRlLnNlcnZlckZvbGRlclBhdGggPT09IFwibmZzSG9zdEFuZFBhdGhcIiAmJiBkYXRhU3RvcmVUeXBlID09PSBcImZvbGRlclwiO1xuICAgIC8vIGZpbHRlciBzZXJ2ZXJzIGFuZCBvbmx5IGRpc3BsYXkgaG9zdGluZyBzZXJ2ZXJzIGZvciBkYXRhYmFzZTogYmlncXVlcnksIHNub3dmbGFrZSBvciByZWRzaGlmdFxuICAgIGNvbnN0IGlzSG9zdGluZ1NlcnZlck9ubHlGb3JEYXRhYmFzZSA9IHRoaXMuY2hlY2tEYXRhYmFzZUNsaWVudCgpO1xuICAgIC8vIGZpbHRlciBzZXJ2ZXJzIGZvciBiZGZzXG4gICAgdGhpcy5zZXJ2ZXJMaXN0ID0gdGhpcy5maWx0ZXJTZXJ2ZXJzKGlzQmlnRGF0YUZpbGVTaGFyZSwgaXNOb1NRTCwgaXNIb3N0aW5nU2VydmVyT25seUZvckRhdGFiYXNlLCBpc05GUyk7XG4gICAgLy8gZmlsdGVyIHNlcnZlcnMgYnkgdXNlcnMgaW5wdXQgc2VydmVyIHBhdGggLSBvbmx5IGZvciBmb2xkZXIgJiBmaWxlIHNoYXJlXG4gICAgaWYgKCFpc05GUykge1xuICAgICAgaWYgKFtcImZvbGRlclwiLCBcImZpbGVzaGFyZVwiXS5pbmNsdWRlcyhkYXRhU3RvcmVUeXBlKSkge1xuICAgICAgICB0aGlzLnNlcnZlckxpc3QgPSB0aGlzLmZpbHRlclNlcnZlcnNCeVNlcnZlclBhdGgoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgY2hlY2tEYXRhYmFzZUNsaWVudCgpIHtcbiAgICBjb25zdCBkYXRhU3RvcmVUeXBlID0gdGhpcy5kYXRhU3RvcmVUeXBlO1xuICAgIGNvbnN0IHB1Ymxpc2hlckNvbm5lY3Rpb25TdHJpbmcgPSBhZGRJdGVtU3RhdGUucHVibGlzaGVyQ29ubmVjdGlvblN0cmluZztcbiAgICBsZXQgaXNIb3N0aW5nU2VydmVyT25seSA9IGZhbHNlO1xuICAgIGlmIChkYXRhU3RvcmVUeXBlID09PSBcImRhdGFiYXNlXCIgJiYgcHVibGlzaGVyQ29ubmVjdGlvblN0cmluZykge1xuICAgICAgY29uc3QgZGJDb25uZWN0aW9uU3RyaW5nQXJyYXkgPSBwdWJsaXNoZXJDb25uZWN0aW9uU3RyaW5nLnNwbGl0KFwiO1wiKTtcbiAgICAgIGRiQ29ubmVjdGlvblN0cmluZ0FycmF5LmZvckVhY2goZnVuY3Rpb24gKGtleXdvcmQpIHtcbiAgICAgICAgLy8gXCJEQkNMSUVOVD1iaWdxdWVyeVwiXG4gICAgICAgIGlmIChrZXl3b3JkLmluZGV4T2YoXCJEQkNMSUVOVFwiKSA+IC0xICYmXG4gICAgICAgICAgW1wiYmlncXVlcnlcIiwgXCJzbm93Zmxha2VcIiwgXCJyZWRzaGlmdFwiXS5pbmRleE9mKGtleXdvcmQuc3BsaXQoXCI9XCIpWzFdKSA+IC0xKSB7XG4gICAgICAgICAgaXNIb3N0aW5nU2VydmVyT25seSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gaXNIb3N0aW5nU2VydmVyT25seTtcbiAgfVxuICBmaWx0ZXJTZXJ2ZXJzQnlTZXJ2ZXJQYXRoKCkge1xuICAgIGNvbnN0IGRhdGFTdG9yZVR5cGUgPSBhZGRJdGVtU3RhdGUuYWRkRGF0YVN0b3JlVHlwZTtcbiAgICBjb25zdCBzZXJ2ZXJQYXRoID0gZGF0YVN0b3JlVHlwZSA9PT0gXCJmb2xkZXJcIlxuICAgICAgPyBhZGRJdGVtU3RhdGUubmV3U2VydmVyRm9sZGVyUGF0aCB8fCBhZGRJdGVtU3RhdGUucHVibGlzaGVyRm9sZGVyUGF0aFxuICAgICAgOiBhZGRJdGVtU3RhdGUucHVibGlzaGVyRmlsZVNoYXJlRm9sZGVyUGF0aDtcbiAgICBjb25zdCBzZXJ2ZXJQYXRoVHlwZSA9IHNlcnZlclBhdGhbMF0uaW5kZXhPZihcIi9cIikgPiAtMSA/IFwiTGludXhcIiA6IFwiV2luZG93c1wiO1xuICAgIGNvbnN0IGlzTkZTID0gYWRkSXRlbVN0YXRlLnNlcnZlckZvbGRlclBhdGggPT09IFwibmZzSG9zdEFuZFBhdGhcIiAmJiBkYXRhU3RvcmVUeXBlID09PSBcImZvbGRlclwiO1xuICAgIHJldHVybiB0aGlzLnNlcnZlckxpc3QuZmlsdGVyKChmZWRlcmF0ZWRTZXJ2ZXIpID0+IHtcbiAgICAgIHJldHVybiAhIXRoaXMuc2VydmVyVHlwZXMuZmluZCgoc2VydmVySXRlbSkgPT4ge1xuICAgICAgICByZXR1cm4gKChzZXJ2ZXJJdGVtLm5hbWUgPT09IGZlZGVyYXRlZFNlcnZlci5hZG1pblVybCB8fFxuICAgICAgICAgIHNlcnZlckl0ZW0ubmFtZSA9PT0gYCR7ZmVkZXJhdGVkU2VydmVyLmFkbWluVXJsfS9hZG1pbmApICYmXG4gICAgICAgICAgKGlzTkZTID8gZmVkZXJhdGVkU2VydmVyLmlzSG9zdGVkIDogc2VydmVySXRlbS50eXBlID09PSBzZXJ2ZXJQYXRoVHlwZSkpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbiAgYXBwZW5kU2VydmVyVHlwZXMoKSB7XG4gICAgY29uc3QgeyBzZXJ2ZXJMaXN0LCBpMThuIH0gPSB0aGlzO1xuICAgIHNlcnZlckxpc3QubWFwKChzZXJ2ZXIpID0+IHtcbiAgICAgIGNvbnN0IHNlcnZlckZ1bmN0aW9uID0gKHNlcnZlci5zZXJ2ZXJGdW5jdGlvbiAmJiBzZXJ2ZXIuc2VydmVyRnVuY3Rpb24ucmVwbGFjZSgvXFxzKy9nLCBcIlwiKS5zcGxpdChcIixcIikpIHx8IFtdO1xuICAgICAgbGV0IHNlcnZlclR5cGUgPSBcIlwiO1xuICAgICAgaWYgKHNlcnZlci5zZXJ2ZXJSb2xlID09PSBcIkhPU1RJTkdfU0VSVkVSXCIpIHtcbiAgICAgICAgc2VydmVyVHlwZSArPSBpMThuLnR5cGVzLmhvc3RlZFNldHRpbmc7XG4gICAgICB9XG4gICAgICBpZiAoc2VydmVyRnVuY3Rpb24uaW5kZXhPZihcIk5vdGVib29rU2VydmVyXCIpID4gLTEpIHtcbiAgICAgICAgc2VydmVyVHlwZSArPSAoc2VydmVyVHlwZSAmJiBcIiwgXCIpICsgaTE4bi50eXBlcy5ub3RlYm9va1NlcnZlclNldHRpbmc7XG4gICAgICB9XG4gICAgICBpZiAoc2VydmVyRnVuY3Rpb24uaW5kZXhPZihcIkdlb0FuYWx5dGljc1wiKSA+IC0xKSB7XG4gICAgICAgIHNlcnZlclR5cGUgKz0gKHNlcnZlclR5cGUgJiYgXCIsIFwiKSArIGkxOG4udHlwZXMuZ2VvQW5hbHl0aWNzU2VydmVyU2V0dGluZztcbiAgICAgIH1cbiAgICAgIGlmIChzZXJ2ZXJGdW5jdGlvbi5pbmRleE9mKFwiUmFzdGVyQW5hbHl0aWNzXCIpID4gLTEpIHtcbiAgICAgICAgc2VydmVyVHlwZSArPSAoc2VydmVyVHlwZSAmJiBcIiwgXCIpICsgaTE4bi50eXBlcy5yYXN0ZXJBbmFseXNpc1NldHRpbmc7XG4gICAgICB9XG4gICAgICBpZiAoc2VydmVyRnVuY3Rpb24uaW5kZXhPZihcIkltYWdlSG9zdGluZ1wiKSA+IC0xKSB7XG4gICAgICAgIHNlcnZlclR5cGUgKz0gKHNlcnZlclR5cGUgJiYgXCIsIFwiKSArIGkxOG4udHlwZXMuaW1hZ2VIb3N0aW5nU2V0dGluZztcbiAgICAgIH1cbiAgICAgIGlmIChzZXJ2ZXJGdW5jdGlvbi5pbmRleE9mKFwiTWlzc2lvblNlcnZlclwiKSA+IC0xKSB7XG4gICAgICAgIHNlcnZlclR5cGUgKz0gKHNlcnZlclR5cGUgJiYgXCIsIFwiKSArIGkxOG4udHlwZXMubWlzc2lvblNlcnZlclNldHRpbmc7XG4gICAgICB9XG4gICAgICBzZXJ2ZXIuc2VydmVyVHlwZSA9IHNlcnZlclR5cGU7XG4gICAgfSk7XG4gIH1cbiAgY29udmVydFN0YXR1c0Rpc3BsYXlUZXh0KHNlcnZlcikge1xuICAgIGNvbnN0IGkxOG4gPSB0aGlzLmkxOG47XG4gICAgY29uc3Qgc3RhdHVzID0gc2VydmVyLnNlcnZlclN0YXR1cztcbiAgICBjb25zdCBkaXNwbGF5VGFibGUgPSB7XG4gICAgICBzdWNjZXNzOiBpMThuLnN0YXR1cy5zdWNjZXNzLFxuICAgICAgZmFpbHVyZTogaTE4bi5zdGF0dXMuZmFpbHVyZSxcbiAgICAgIGVycm9yOiBpMThuLnN0YXR1cy5lcnJvcixcbiAgICAgIHZhbGlkYXRpbmc6IGkxOG4uc3RhdHVzLnZhbGlkYXRpbmdcbiAgICB9O1xuICAgIHJldHVybiBkaXNwbGF5VGFibGVbc3RhdHVzXTtcbiAgfVxuICBjaGVja1ZhbGlkU2VydmVycygpIHtcbiAgICB0aGlzLm5vVmFsaWRTZXJ2ZXJzID0gIXRoaXMuc2VydmVyTGlzdC5zb21lKChzZXJ2ZXIpID0+IHtcbiAgICAgIHJldHVybiBzZXJ2ZXIuc2VydmVyU3RhdHVzID09PSBcInN1Y2Nlc3NcIjtcbiAgICB9KTtcbiAgfVxuICBjaGVja0FsbEJveGVzKCkge1xuICAgIHRoaXMuc2VsZWN0ZWRTZXJ2ZXJzID0gWy4uLltdXTtcbiAgICBpZiAoIXRoaXMuYWxsQm94ZXNTZWxlY3RlZCkge1xuICAgICAgdGhpcy5zZXJ2ZXJMaXN0LmZvckVhY2goKHNlcnZlcikgPT4ge1xuICAgICAgICB0aGlzLnNlbGVjdGVkU2VydmVycyA9IFsuLi50aGlzLnNlbGVjdGVkU2VydmVycywgc2VydmVyLmlkXTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLmFsbEJveGVzU2VsZWN0ZWQgPSAhdGhpcy5hbGxCb3hlc1NlbGVjdGVkO1xuICB9XG4gIGhhbmRsZU5leHQoKSB7XG4gICAgY29uc3Qgc2VsZWN0ZWRTZXJ2ZXJzID0gdGhpcy5zZWxlY3RlZFNlcnZlcnMgfHwgW107XG4gICAgaWYgKHNlbGVjdGVkU2VydmVycy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMuZXJyb3IgPSBcIm5vU2VydmVyU2VsZWN0ZWRcIjtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgYWRkSXRlbVN0YXRlLmRhdGFTdG9yZVNlbGVjdGVkU2VydmVycyA9IHNlbGVjdGVkU2VydmVycztcbiAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJpdGVtUHJvcGVydGllc1wiKTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBpMThuLCBlcnJvciwgc2VydmVyTGlzdCwgZGF0YVN0b3JlVHlwZSwgbG9hZGluZywgYWxsQm94ZXNTZWxlY3RlZCwgbm9WYWxpZFNlcnZlcnMgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIG51bGwsIGgoXCJhcmNnaXMtbmV3LWl0ZW0tZGVzY3JpcHRpb25cIiwgeyBoZWFkZXI6IGRhdGFTdG9yZVR5cGUgPT09IFwiYmRmc1wiICYmIFtcImZpbGVzaGFyZVwiLCBcImNsb3VkXCJdLmluY2x1ZGVzKGFkZEl0ZW1TdGF0ZS5iZGZzVHlwZSlcbiAgICAgICAgPyBpMThuLmRhdGFTdG9yZVNlcnZlclNlbGVjdC5iZGZzSGVhZGluZ1xuICAgICAgICA6IGkxOG4uZGF0YVN0b3JlU2VydmVyU2VsZWN0LmhlYWRpbmcgfSksIGgoXCJwXCIsIHsgY2xhc3M6IFwic3ViLWhlYWRpbmdcIiB9LCBpMThuLmRhdGFTdG9yZVNlcnZlclNlbGVjdC5zdWJIZWFkaW5nKSwgbG9hZGluZyA/IChoKFwiY2FsY2l0ZS1sb2FkZXJcIiwgeyBsYWJlbDogXCJzZXJ2ZXItbG9hZGVyXCIsIHRleHQ6IGkxOG4ubG9hZGVyLnZhbGlkYXRpbmcgfSkpIDogKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogXCJyb3ctd3JhcHBlclwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJoYWxmLXJvd1wiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgbGF5b3V0OiBcImlubGluZVwiIH0sIGgoXCJjYWxjaXRlLWNoZWNrYm94XCIsIHsgZGlzYWJsZWQ6IG5vVmFsaWRTZXJ2ZXJzLCBjaGVja2VkOiBhbGxCb3hlc1NlbGVjdGVkLCBvbkNhbGNpdGVDaGVja2JveENoYW5nZTogKCkgPT4ge1xuICAgICAgICB0aGlzLmNoZWNrQWxsQm94ZXMoKTtcbiAgICAgIH0gfSksIGkxOG4ubGlzdC50aXRsZSkpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaGFsZi1yb3dcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGxheW91dDogXCJpbmxpbmVcIiB9LCBpMThuLmxpc3Quc3RhdHVzKSkpLCBzZXJ2ZXJMaXN0Lm1hcCgoc2VydmVyKSA9PiB7XG4gICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJyb3ctd3JhcHBlciByb3ctZGl2aWRlclwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJoYWxmLXJvd1wiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgbGF5b3V0OiBcImlubGluZVwiLCBjbGFzczogXCJzZXJ2ZXItd3JhcHBlclwiIH0sIGgoXCJjYWxjaXRlLWNoZWNrYm94XCIsIHsgZGlzYWJsZWQ6IHNlcnZlci5zZXJ2ZXJTdGF0dXMgIT09IFwic3VjY2Vzc1wiLCB2YWx1ZTogc2VydmVyLmlkLCBvbkNhbGNpdGVDaGVja2JveENoYW5nZTogKGUpID0+IHtcbiAgICAgICAgICBjb25zdCBzZXJ2ZXJJZCA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkU2VydmVycy5pbmRleE9mKHNlcnZlcklkKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRTZXJ2ZXJzID0gWy4uLnRoaXMuc2VsZWN0ZWRTZXJ2ZXJzLCBzZXJ2ZXJJZF07XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFNlcnZlcnMgPSB0aGlzLnNlbGVjdGVkU2VydmVycy5maWx0ZXIoKHNlcnZlcikgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gc2VydmVyICE9PSBzZXJ2ZXJJZDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgY2hlY2tlZDogdGhpcy5zZWxlY3RlZFNlcnZlcnMuaW5jbHVkZXMoc2VydmVyLmlkKSB9KSwgc2VydmVyLnVybCArIChzZXJ2ZXIuc2VydmVyVHlwZSAmJiBgICgke3NlcnZlci5zZXJ2ZXJUeXBlfSlgKSkpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaGFsZi1yb3dcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic3RhdHVzLXdyYXBwZXJcIiwgdGl0bGU6IHNlcnZlci5lcnJvck1zZyB8fCBzZXJ2ZXIuc2VydmVyU3RhdHVzIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBjbGFzczoge1xuICAgICAgICAgIHN1Y2Nlc3M6IHNlcnZlci5zZXJ2ZXJTdGF0dXMgPT09IFwic3VjY2Vzc1wiLFxuICAgICAgICAgIGZhaWx1cmU6IHNlcnZlci5zZXJ2ZXJTdGF0dXMgPT09IFwiZmFpbHVyZVwiLFxuICAgICAgICAgIGVycm9yOiBzZXJ2ZXIuc2VydmVyU3RhdHVzID09PSBcImVycm9yXCIsXG4gICAgICAgICAgdmFsaWRhdGluZzogc2VydmVyLnNlcnZlclN0YXR1cyA9PT0gXCJ2YWxpZGF0aW5nXCJcbiAgICAgICAgfSwgc2NhbGU6IFwic1wiLCBpY29uOiB0aGlzLnNlcnZlclN0YXR1c0ljb25zW3NlcnZlci5zZXJ2ZXJTdGF0dXNdIH0pLCB0aGlzLmNvbnZlcnRTdGF0dXNEaXNwbGF5VGV4dChzZXJ2ZXIpKSkpKTtcbiAgICB9KSwgaChcImFyY2dpcy1uZXctaXRlbS1hbGVydFwiLCB7IGhlYWRpbmc6IGkxOG4uZGF0YVN0b3JlU2VydmVyU2VsZWN0Lm5vU2VydmVyU2VsZWN0ZWQuaGVhZGluZywgZGVzY3JpcHRpb246IGkxOG4uZGF0YVN0b3JlU2VydmVyU2VsZWN0Lm5vU2VydmVyU2VsZWN0ZWQuZGVzY3JpcHRpb24sIGFjdGl2ZTogZXJyb3IgIT09IG51bGwgJiYgIWxvYWRpbmcsIG9uQWxlcnREaXNtaXNzOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuZXJyb3IgPSBudWxsO1xuICAgICAgfSB9KSkpKSk7XG4gIH1cbiAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICBcInNlcnZlckxpc3RcIjogW1wiY2hlY2tWYWxpZFNlcnZlcnNcIl1cbiAgfTsgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc0RhdGFTdG9yZVNlbGVjdFNlcnZlckxpc3Quc3R5bGUgPSBhcmNnaXNOZXdJdGVtUGFnZXNEYXRhU3RvcmVTZWxlY3RTZXJ2ZXJMaXN0Q3NzO1xuXG5leHBvcnQgeyBBcmNnaXNOZXdJdGVtUGFnZXNEYXRhU3RvcmVTZWxlY3RTZXJ2ZXJMaXN0IGFzIGFyY2dpc19uZXdfaXRlbV9wYWdlc19kYXRhX3N0b3JlX3NlbGVjdF9zZXJ2ZXJfbGlzdCB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9