"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-cbe964"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-sketch_5.entry.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-sketch_5.entry.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_sketch: () => (/* binding */ ArcgisSketch),
/* harmony export */   arcgis_sketch_content: () => (/* binding */ ArcgisSketchContent),
/* harmony export */   arcgis_sketch_shortcuts: () => (/* binding */ ArcgisSketchShortcuts),
/* harmony export */   arcgis_sketch_snapping: () => (/* binding */ ArcgisSketchSnapping),
/* harmony export */   arcgis_sketch_tools: () => (/* binding */ ArcgisSketchTools)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./storage-d7f5822e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./commonEnums-f98a323c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-f98a323c.js");
/* harmony import */ var _commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./commonFunctions-5262b094.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-5262b094.js");
/* harmony import */ var _fontUtil_1aa3a32c_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./fontUtil-1aa3a32c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/fontUtil-1aa3a32c.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */












const defaultLineSymbol = async (mapView, ColorUtils) => {
  const backgroundThemeColor = await ColorUtils.getBackgroundColorTheme(mapView);
  return {
    type: "simple-line",
    color: backgroundThemeColor === "light" ? [0, 0, 0] : [255, 255, 255],
    width: 1 * 0.75
  };
};
const defaultPolygonSymbol = async (mapView, ColorUtils) => {
  const backgroundThemeColor = await ColorUtils.getBackgroundColorTheme(mapView);
  return {
    type: "simple-fill",
    color: backgroundThemeColor === "light" ? [0, 0, 0, 0.25] : [255, 255, 255, 0.25],
    style: "solid",
    outline: {
      color: backgroundThemeColor === "light" ? [0, 0, 0] : [255, 255, 255],
      width: 1 * 0.75
    }
  };
};
const defaultTextSymbol = async (mapView, ColorUtils, TextSymbol, text) => {
  const backgroundColor = await ColorUtils.getBackgroundColor(mapView);
  const backgroundThemeColor = await ColorUtils.getBackgroundColorTheme(mapView);
  return new TextSymbol({
    text,
    color: backgroundThemeColor === "light"
      ? [0, 0, 0]
      : backgroundThemeColor === "dark"
        ? [255, 255, 255]
        : backgroundColor || [0, 0, 0],
    haloColor: null,
    haloSize: 1 * 0.75,
    font: {
      size: 22 * 0.75,
      family: "Arial",
      weight: "bold"
    },
    lineWidth: 512
  });
};
const defaultCimSymbol = async (CIMSymbol, mapView, ColorUtils) => {
  const backgroundThemeColor = await ColorUtils.getBackgroundColorTheme(mapView);
  return new CIMSymbol({
    data: {
      type: "CIMSymbolReference",
      symbol: {
        type: "CIMPointSymbol",
        symbolLayers: [
          {
            type: "CIMVectorMarker",
            enable: true,
            colorLocked: true,
            anchorPoint: { x: 0, y: -1.75 },
            anchorPointUnits: "Relative",
            size: 5.7,
            frame: { xmin: 0, ymin: 0, xmax: 84.3, ymax: 84.3 },
            markerGraphics: [
              {
                type: "CIMMarkerGraphic",
                geometry: {
                  rings: [
                    [
                      [83.2, 32.5],
                      [84.3, 40.7],
                      [83.8, 48.9],
                      [81.7, 56.9],
                      [78.1, 64.3],
                      [73, 70.9],
                      [66.9, 76.4],
                      [59.7, 80.5],
                      [51.9, 83.2],
                      [43.7, 84.3],
                      [35.4, 83.8],
                      [27.4, 81.7],
                      [20, 78],
                      [13.4, 73],
                      [7.9, 66.8],
                      [3.8, 59.7],
                      [1.1, 51.9],
                      [0, 43.7],
                      [0.5, 35.4],
                      [2.6, 27.4],
                      [6.3, 20],
                      [11.3, 13.4],
                      [17.5, 7.9],
                      [24.7, 3.8],
                      [32.5, 1.1],
                      [39.8, 0.1],
                      [47.1, 0.3],
                      [54.3, 1.8],
                      [61.1, 4.5],
                      [67.4, 8.4],
                      [72.9, 13.3],
                      [77.4, 19.1],
                      [80.9, 25.5],
                      [83.2, 32.5]
                    ]
                  ]
                },
                symbol: {
                  type: "CIMPolygonSymbol",
                  symbolLayers: [
                    {
                      type: "CIMSolidFill",
                      enable: true,
                      color: backgroundThemeColor === "light" ? [242, 242, 242, 255] : [255, 255, 255, 255]
                    }
                  ]
                }
              }
            ],
            scaleSymbolsProportionally: true,
            respectFrame: true,
            rotation: 0
          },
          {
            type: "CIMVectorMarker",
            enable: true,
            anchorPoint: { x: 0, y: -0.5 },
            anchorPointUnits: "Relative",
            size: 15,
            frame: { xmin: 0, ymin: 0, xmax: 197.7, ymax: 294.7 },
            markerGraphics: [
              {
                type: "CIMMarkerGraphic",
                geometry: {
                  rings: [
                    [
                      [98.9, 0],
                      [119.4, 23.2],
                      [139.4, 49.3],
                      [156.8, 75.2],
                      [171.2, 100.8],
                      [182.4, 125.3],
                      [190.6, 148.8],
                      [195.7, 171.4],
                      [197.7, 192.9],
                      [197.7, 195.8],
                      [197.7, 200.3],
                      [197.6, 202.5],
                      [197.5, 204.8],
                      [197.3, 207.1],
                      [197, 209.4],
                      [196.7, 211.7],
                      [196.4, 214.1],
                      [196, 216.4],
                      [195.5, 218.7],
                      [195, 221.1],
                      [194.4, 223.4],
                      [193.7, 225.8],
                      [193, 228.1],
                      [192.2, 230.5],
                      [191.4, 232.8],
                      [190.5, 235.1],
                      [189.5, 237.5],
                      [188.5, 239.7],
                      [187.4, 242],
                      [186.2, 244.3],
                      [185, 246.5],
                      [183.7, 248.7],
                      [182.4, 250.9],
                      [181, 253.1],
                      [179.5, 255.2],
                      [178, 257.3],
                      [176.4, 259.4],
                      [174.7, 261.4],
                      [173.1, 263.3],
                      [171.3, 265.3],
                      [169.5, 267.2],
                      [167.7, 269],
                      [165.8, 270.8],
                      [163.9, 272.5],
                      [161.9, 274.2],
                      [159.9, 275.8],
                      [157.8, 277.4],
                      [155.7, 278.9],
                      [153.6, 280.4],
                      [151.4, 281.7],
                      [149.2, 283.1],
                      [147, 284.4],
                      [144.8, 285.6],
                      [142.5, 286.7],
                      [140.3, 287.8],
                      [138, 288.8],
                      [135.7, 289.8],
                      [133.4, 290.7],
                      [131, 291.5],
                      [128.7, 292.3],
                      [126.4, 293],
                      [124, 293.6],
                      [121.7, 294.2],
                      [119.4, 294.7],
                      [117, 295.2],
                      [114.7, 295.6],
                      [112.4, 296],
                      [110.1, 296.3],
                      [107.8, 296.5],
                      [105.5, 296.7],
                      [103.3, 296.8],
                      [101.1, 296.9],
                      [98.8, 296.9],
                      [83.1, 295.7],
                      [67.8, 292],
                      [53.3, 285.9],
                      [39.9, 277.5],
                      [28.1, 267.2],
                      [18, 255.1],
                      [10, 241.5],
                      [4.2, 226.9],
                      [0.9, 211.5],
                      [0, 195.8],
                      [0.1, 192.9],
                      [2.1, 171.4],
                      [7.2, 148.8],
                      [15.4, 125.3],
                      [26.6, 100.8],
                      [41, 75.2],
                      [58.4, 49.3],
                      [78.4, 23.2],
                      [98.9, 0]
                    ]
                  ]
                },
                symbol: {
                  type: "CIMPolygonSymbol",
                  symbolLayers: [
                    {
                      type: "CIMSolidFill",
                      enable: true,
                      color: backgroundThemeColor === "light" ? [17, 26, 40, 255] : [186, 186, 186, 255]
                    }
                  ]
                }
              }
            ],
            scaleSymbolsProportionally: true,
            respectFrame: true,
            rotation: 0
          }
        ],
        scaleX: 1,
        angleAlignment: "Display",
        angle: 0
      }
    }
  });
};
// https://devtopia.esri.com/WebGIS/arcgis-components/blob/master/src/smartMapping/_utils/symbol.ts
function getCimOutline(sym) {
  if (!isMVCompatibleCIM(sym)) {
    return;
  }
  const symbolLayers = sym.data.symbol.symbolLayers;
  const bgSymbolLayer = symbolLayers[symbolLayers.length - 1];
  const graphic = bgSymbolLayer.markerGraphics[0];
  return graphic.symbol.symbolLayers.find((sl) => sl.type === "CIMSolidStroke");
}
function isMVCompatibleCIM(sym) {
  var _a, _b, _c, _d, _e, _f;
  // -	Have one symbolLayer with a stroke and a fill (CIMVectorMarker) that is not colorLocked
  // -	Have two symbolLayers with a stroke and a fill (CIMVectorMarker)
  //    The smaller (first) symbolLayer is not colorLocked
  //    The second symbolLayer must have a greater size than the first
  const symbolLayers = sym.data.symbol.symbolLayers;
  if (symbolLayers.length === 1) {
    const symbolLayer = symbolLayers[0];
    if (symbolLayer.type !== "CIMVectorMarker" || symbolLayer.colorLocked) {
      return false;
    }
    const markerGraphicLayers = (_b = (_a = symbolLayer.markerGraphics[0]) === null || _a === void 0 ? void 0 : _a.symbol) === null || _b === void 0 ? void 0 : _b.symbolLayers;
    return symbolLayer.markerGraphics.length === 1 && hasUnlockedFillAndStroke(markerGraphicLayers);
  }
  else if (symbolLayers.length === 2) {
    const symbolLayer1 = symbolLayers[0];
    const symbolLayer2 = symbolLayers[1];
    if (symbolLayer1.type !== "CIMVectorMarker" ||
      symbolLayer2.type !== "CIMVectorMarker" ||
      symbolLayer1.colorLocked ||
      symbolLayer1.size > symbolLayer2.size) {
      return false;
    }
    const markerGraphicLayers1 = (_d = (_c = symbolLayer1.markerGraphics[0]) === null || _c === void 0 ? void 0 : _c.symbol) === null || _d === void 0 ? void 0 : _d.symbolLayers;
    const markerGraphicLayers2 = (_f = (_e = symbolLayer2.markerGraphics[0]) === null || _e === void 0 ? void 0 : _e.symbol) === null || _f === void 0 ? void 0 : _f.symbolLayers;
    return (symbolLayer1.markerGraphics.length === 1 &&
      symbolLayer2.markerGraphics.length === 1 &&
      hasUnlockedFillAndStroke(markerGraphicLayers1) &&
      hasFillAndStroke(markerGraphicLayers2));
  }
  return false;
}
function hasUnlockedFillAndStroke(symbolLayers) {
  return hasUnlockedFill(symbolLayers) && hasStroke(symbolLayers);
}
function hasFillAndStroke(symbolLayers) {
  return hasFill(symbolLayers) && hasStroke(symbolLayers);
}
function hasFill(symbolLayers) {
  return symbolLayers === null || symbolLayers === void 0 ? void 0 : symbolLayers.find((sl) => sl.type === "CIMSolidFill");
}
function hasUnlockedFill(symbolLayers) {
  return symbolLayers === null || symbolLayers === void 0 ? void 0 : symbolLayers.find((sl) => sl.type === "CIMSolidFill" && !sl.colorLocked);
}
function hasStroke(symbolLayers) {
  return symbolLayers === null || symbolLayers === void 0 ? void 0 : symbolLayers.find((sl) => sl.type === "CIMSolidStroke");
}

const saveSnappingToStorage = (snappingOptions, currentSnappingSessionStorageId) => {
  // get enabled layers and save object in session storage
  const featureSourcesIds = [
    ...new Set([...snappingOptions.featureSources.filter((source) => source.enabled).map((source) => source.layer.id)])
  ];
  const snappingObject = {
    enabled: snappingOptions.enabled,
    selfEnabled: snappingOptions.selfEnabled,
    featureEnabled: snappingOptions.featureEnabled,
    featureSourcesIds: featureSourcesIds
  };
  (0,_storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_4__.c)(currentSnappingSessionStorageId, snappingObject, true);
};
const getSnappingOptions = (snappingSessionStorageIds, layer, mapView, SnappingOptions) => {
  const snapping = getSnappingFromStorage(snappingSessionStorageIds) || {
    enabled: true,
    selfEnabled: true,
    featureEnabled: true,
    featureSourcesIds: [layer.id]
  };
  return new SnappingOptions({
    enabled: snapping.enabled,
    selfEnabled: snapping.selfEnabled,
    featureEnabled: snapping.featureEnabled,
    featureSources: getFeatureSourcesFromLayerIds(mapView, snapping.featureSourcesIds)
  });
};
const getFeatureSourcesFromLayerIds = (mapView, layerIds) => {
  const featureSources = [];
  layerIds.forEach((layerId) => {
    mapView.map.allLayers.toArray().find((layer) => {
      if (["map-notes", "feature", "geojson", "csv", "wfs", "map"].indexOf(layer === null || layer === void 0 ? void 0 : layer.type) !== -1 &&
        layer.id === layerId) {
        featureSources.push({ layer, enabled: true });
      }
    });
  });
  return featureSources;
};
const getSnappingFromStorage = (snappingSessionStorageIds) => {
  if (snappingSessionStorageIds) {
    return ((0,_storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_4__.d)(snappingSessionStorageIds.webmap, true) ||
      (0,_storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_4__.d)(snappingSessionStorageIds.current, true) ||
      null);
  }
  return null;
};

const saveSketchTooltipToStorage = (tooltipOptions, currentTooltipSessionStorageId) => {
  const tooltipObject = {
    enabled: tooltipOptions.enabled
  };
  (0,_storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_4__.c)(currentTooltipSessionStorageId, tooltipObject, true);
};
const getSketchTooltipOptions = (sketchTooltipSessionStorageIds, SketchTooltipOptions) => {
  const sketchToolip = getSketchTooltipFromStorage(sketchTooltipSessionStorageIds) || {
    enabled: false
  };
  return new SketchTooltipOptions({
    enabled: sketchToolip.enabled
  });
};
const getSketchTooltipFromStorage = (sketchTooltipSessionStorageIds) => {
  if (sketchTooltipSessionStorageIds) {
    return ((0,_storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_4__.d)(sketchTooltipSessionStorageIds.webmap, true) ||
      (0,_storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_4__.d)(sketchTooltipSessionStorageIds.current, true) ||
      null);
  }
  return null;
};

const sketchStore = (0,_index_81d548b7_js__WEBPACK_IMPORTED_MODULE_5__.c)({
  mapView: null,
  portal: null,
  layer: null,
  strings: null,
  currentLanguage: "",
  sketchMessage: "",
  svModel: null,
  snappingOptions: null,
  sketchTooltipOptions: null,
  snappingSessionStorageIds: null,
  sketchTooltipSessionStorageIds: null
});
const sketchState = sketchStore.state;

class SVModel {
  constructor(layer, mapView, SketchViewModel, snappingOptions, tooltipOptions, onGraphicCreate, onGraphicUpdate) {
    this.layer = layer;
    this.mapView = mapView;
    // point
    this.sketchViewModelPoint = new SketchViewModel({
      layer: this.layer.pointLayer,
      view: this.mapView,
      defaultCreateOptions: { hasZ: false, mode: "hybrid" },
      updateOnGraphicClick: false,
      defaultUpdateOptions: { multipleSelectionEnabled: false },
      snappingOptions,
      tooltipOptions
    });
    this.sketchViewModelPoint.on("create", (event) => {
      onGraphicCreate(event, this.sketchViewModelPoint);
    });
    this.sketchViewModelPoint.on("update", (event) => onGraphicUpdate(event));
    // line
    this.sketchViewModelLine = new SketchViewModel({
      layer: this.layer.polylineLayer,
      view: this.mapView,
      defaultCreateOptions: { hasZ: false, mode: "hybrid" },
      updateOnGraphicClick: false,
      defaultUpdateOptions: { multipleSelectionEnabled: false },
      snappingOptions,
      tooltipOptions
    });
    this.sketchViewModelLine.on("create", (event) => onGraphicCreate(event, this.sketchViewModelLine));
    this.sketchViewModelLine.on("update", (event) => onGraphicUpdate(event));
    // polygon
    this.sketchViewModelPolygon = new SketchViewModel({
      layer: this.layer.polygonLayer,
      view: this.mapView,
      defaultCreateOptions: { hasZ: false, mode: "hybrid" },
      updateOnGraphicClick: false,
      defaultUpdateOptions: { multipleSelectionEnabled: false },
      snappingOptions,
      tooltipOptions
    });
    this.sketchViewModelPolygon.on("create", (event) => onGraphicCreate(event, this.sketchViewModelPolygon));
    this.sketchViewModelPolygon.on("update", (event) => onGraphicUpdate(event));
    // text
    this.sketchViewModelText = new SketchViewModel({
      layer: this.layer.textLayer,
      view: this.mapView,
      defaultCreateOptions: { hasZ: false, mode: "hybrid" },
      updateOnGraphicClick: false,
      defaultUpdateOptions: { multipleSelectionEnabled: false },
      snappingOptions,
      tooltipOptions
    });
    this.sketchViewModelText.on("create", (event) => onGraphicCreate(event, this.sketchViewModelText));
    this.sketchViewModelText.on("update", (event) => onGraphicUpdate(event));
  }
  delete() {
    this._deletePoint();
    this._deleteLine();
    this._deletePolygon();
    this._deleteText();
  }
  cancel() {
    this._cancelPoint();
    this._cancelLine();
    this._cancelPolygon();
    this._cancelText();
  }
  duplicate() {
    this._duplicatePoint();
    this._duplicateLine();
    this._duplicatePolygon();
    this._duplicateText();
  }
  updateOnGraphic(hitTest) {
    var _a;
    if (hitTest) {
      this.hitTestHandle = this.mapView.on("click", async (event) => {
        const hitTestResults = await this.mapView.hitTest(event, {
          include: this.layer
        });
        const results = hitTestResults.results;
        if (results.length) {
          // sort by hit test order and choose the 1st result
          const order = ["point", "polyline", "polygon"];
          results.sort(function (a, b) {
            return order.indexOf(a.graphic.geometry.type) - order.indexOf(b.graphic.geometry.type);
          });
          const currGraphic = results[0].graphic;
          switch (currGraphic.layer) {
            case this.layer.pointLayer:
              this.updatePoint([currGraphic]);
              break;
            case this.layer.textLayer:
              this.updateText([currGraphic]);
              break;
            case this.layer.polylineLayer:
              this.updateLine([currGraphic]);
              break;
            case this.layer.polygonLayer:
              this.updatePolygon([currGraphic]);
              break;
            default:
              return;
          }
        }
      });
    }
    else {
      (_a = this.hitTestHandle) === null || _a === void 0 ? void 0 : _a.remove();
    }
  }
  destroy() {
    this._destroyPoint();
    this._destroyLine();
    this._destroyPolygon();
    this._destroyText();
  }
  getPointSVM() {
    return this.sketchViewModelPoint;
  }
  getPoint() {
    return this.sketchViewModelPoint.pointSymbol;
  }
  setPoint(symbol) {
    this.sketchViewModelPoint.pointSymbol = symbol;
  }
  createPoint() {
    this.sketchViewModelPoint.create("point");
  }
  updatePoint(graphics) {
    this.sketchViewModelPoint.update(graphics);
  }
  _deletePoint() {
    this.sketchViewModelPoint.delete();
  }
  _cancelPoint() {
    this.sketchViewModelPoint.cancel();
  }
  _duplicatePoint() {
    this.sketchViewModelPoint.duplicate();
  }
  // private _updatePointOnGraphicClick(updateOnGraphic: boolean) {
  //   this.sketchViewModelPoint.updateOnGraphicClick = updateOnGraphic;
  // }
  _destroyPoint() {
    this.sketchViewModelPoint.destroy();
  }
  // line
  getLineSVM() {
    return this.sketchViewModelLine;
  }
  getLine() {
    return this.sketchViewModelLine.polylineSymbol;
  }
  setLine(symbol) {
    this.sketchViewModelLine.polylineSymbol = symbol;
  }
  createLine() {
    this.sketchViewModelLine.create("polyline");
  }
  updateLine(graphics) {
    this.sketchViewModelLine.update(graphics);
  }
  _deleteLine() {
    this.sketchViewModelLine.delete();
  }
  _cancelLine() {
    this.sketchViewModelLine.cancel();
  }
  _duplicateLine() {
    this.sketchViewModelLine.duplicate();
  }
  // private _updateLineOnGraphicClick(updateOnGraphic: boolean) {
  //   this.sketchViewModelLine.updateOnGraphicClick = updateOnGraphic;
  // }
  _destroyLine() {
    this.sketchViewModelLine.destroy();
  }
  // polygon
  getPolygonSVM() {
    return this.sketchViewModelPolygon;
  }
  getPolygon() {
    return this.sketchViewModelPolygon.polygonSymbol;
  }
  setPolygon(symbol) {
    this.sketchViewModelPolygon.polygonSymbol = symbol;
  }
  createPolygon(tool) {
    this.sketchViewModelPolygon.create(tool);
  }
  updatePolygon(graphics) {
    this.sketchViewModelPolygon.update(graphics);
  }
  _deletePolygon() {
    this.sketchViewModelPolygon.delete();
  }
  _cancelPolygon() {
    this.sketchViewModelPolygon.cancel();
  }
  _duplicatePolygon() {
    this.sketchViewModelPolygon.duplicate();
  }
  // private _updatePolygonOnGraphicClick(updateOnGraphic: boolean) {
  //   this.sketchViewModelPolygon.updateOnGraphicClick = updateOnGraphic;
  // }
  _destroyPolygon() {
    this.sketchViewModelPolygon.destroy();
  }
  // text
  getTextSVM() {
    return this.sketchViewModelText;
  }
  getText() {
    return this.sketchViewModelText.pointSymbol;
  }
  setText(symbol) {
    this.sketchViewModelText.pointSymbol = symbol;
  }
  createText() {
    this.sketchViewModelText.create("point");
  }
  updateText(graphics) {
    this.sketchViewModelText.update(graphics);
  }
  _deleteText() {
    this.sketchViewModelText.delete();
  }
  _cancelText() {
    this.sketchViewModelText.cancel();
  }
  _duplicateText() {
    this.sketchViewModelText.duplicate();
  }
  // private _updateTextOnGraphicClick(updateOnGraphic: boolean) {
  //   this.sketchViewModelText.updateOnGraphicClick = updateOnGraphic;
  // }
  _destroyText() {
    this.sketchViewModelText.destroy();
  }
}

const arcgisSketchCss = ":host{display:flex;flex:1 1 auto;overflow:hidden}.sketch-delete-button{padding:var(--arcgis-app-cap-spacing-third)}.snapping{display:flex;padding:var(--arcgis-app-cap-spacing-half);background-color:var(--arcgis-app-background)}.sketch-message{padding:var(--arcgis-app-cap-spacing-half)}.sketch-keyboard-button{margin-right:0.3em}.multiple-selection{margin:1.3em}.multiple-selection calcite-button{margin-top:0.3em}.arcgis--rtl .sketch-keyboard-button{margin-right:unset;margin-left:0.3em}";

const ArcgisSketch = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.sketchUpdated = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "sketchUpdated", 7);
    this.arcgisSketchDismissedChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSketchDismissedChange", 7);
    this.internalSketchUpdated = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "internalSketchUpdated", 7);
    this.closeSketchPopovers = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeSketchPopovers", 7);
    this.closePopupPopovers = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closePopupPopovers", 7);
    this.sketchContentReRender = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "sketchContentReRender", 7);
    this.disableSketchPanel = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "disableSketchPanel", 7);
    this.closeSketchSnappingPopovers = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeSketchSnappingPopovers", 7);
    this.sketchActionOnSelectFeatures = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "sketchActionOnSelectFeatures", 7);
    this.sketchMode = "update";
    this.escKey = false;
    this.keepSelectionMessage = "";
    this.keepSelectionTool = null;
    this.onGraphicUpdate = (event) => {
      var _a, _b;
      if (event.state === "start") {
        this.mapView.closePopup();
        if (this.multipleSelectedGraphics.length <= 1 && event.graphics.length === 1) {
          this.currentSketchInfo.graphic = event.graphics[0];
          this.currentSketchInfo.symbol = this.currentSketchInfo.graphic
            .symbol;
          // if multipleSelectedGraphics is 0, coming from single select
          !this.multipleSelectedGraphics.length &&
            this.multipleSelectedGraphics.push(this.currentSketchInfo.graphic);
          this.currentSketchInfo.tool = this.getGeometryTypeFromGraphic(this.currentSketchInfo.graphic);
          this.currentSketchInfo.popup = this.currentSketchInfo.graphic.popupTemplate;
          this.currentSketchInfo.title =
            ((_b = (_a = this.currentSketchInfo.graphic) === null || _a === void 0 ? void 0 : _a.attributes) === null || _b === void 0 ? void 0 : _b.title) || this.defaultGraphicTitle();
          this.sketchContentReRender.emit();
          this.showSketchContent = true;
        }
        else {
          this.sketchMessageHandler(null);
        }
      }
      if (event.state === "complete") {
        const { keepSelectionTool } = this;
        if (!keepSelectionTool) {
          this.currentSketchInfo.graphic = null;
          this.multipleSelectedGraphics = [];
          this.closeSketchPopovers.emit();
          this.internalSketchUpdated.emit();
          this.sketchContentReRender.emit();
        }
        else {
          this.keepSelectToolSelection();
        }
      }
    };
    this.mapView = undefined;
    this.layer = undefined;
    this.portal = undefined;
    this.dismissible = false;
    this.snappingSessionStorageIds = undefined;
    this.sketchTooltipSessionStorageIds = undefined;
    this.mapNotesFeature = null;
    this.currentSketchInfo = {
      tool: null,
      symbol: null,
      graphic: null,
      popup: null,
      title: null,
      sourceIds: {}
    };
    this.multipleSelectedGraphics = [];
    this.showSketchContent = true;
  }
  // lifecycle methods
  async componentWillLoad() {
    [this.strings, this.currentLanguage] = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement);
    await this.loadAllModules();
    this.snappingOptions = getSnappingOptions(this.snappingSessionStorageIds, this.layer, this.mapView, this.SnappingOptions);
    this.sketchTooltipOptions = getSketchTooltipOptions(this.sketchTooltipSessionStorageIds, this.SketchTooltipOptions);
    this.svModel = new SVModel(this.layer, this.mapView, this.SketchViewModel, this.snappingOptions, this.sketchTooltipOptions, (event, sketchViewModel) => this.onGraphicCreate(event, sketchViewModel), this.onGraphicUpdate);
    sketchState.svModel = this.svModel;
    sketchState.mapView = this.mapView;
    sketchState.layer = this.layer;
    sketchState.portal = this.portal;
    sketchState.strings = this.strings;
    sketchState.currentLanguage = this.currentLanguage;
    sketchState.snappingOptions = this.snappingOptions;
    sketchState.sketchTooltipOptions = this.sketchTooltipOptions;
    sketchState.snappingSessionStorageIds = this.snappingSessionStorageIds;
    sketchState.sketchTooltipSessionStorageIds = this.sketchTooltipSessionStorageIds;
  }
  componentDidLoad() {
    // for multiple selection
    this.selector.view = this.mapView;
    // disable popup in the map view
    this.mapView.popupEnabled = false;
    // sketch tools
    this.sketchToolsEl = document.createElement("arcgis-sketch-tools");
    this.sketchToolsEl.refElement = this.hostElement;
    if (this.mapNotesFeature) {
      this.sketchToolsEl.mapNotesFeature = this.mapNotesFeature;
    }
    document.body.appendChild(this.sketchToolsEl);
  }
  disconnectedCallback() {
    this.watchEscapeOnMapView(false);
    this.svModel.updateOnGraphic(false);
    this.removeSketchShortcuts();
  }
  // Events
  closeSketchPopoversHandler() {
    this.closePopupPopovers.emit();
    this.sketchMessageHandler(null);
    this.showSketchContent = false;
    this.closeSketchSnappingPopovers.emit();
    this.removeSketchShortcuts();
    this.setFocus();
  }
  closeSketchSnappingPopoversHandler() {
    if (this.sketchSnappingEl) {
      document.body.removeChild(this.sketchSnappingEl);
      this.sketchSnappingEl = null;
      this.disableSketchPanel.emit(false);
    }
    this.setFocus();
  }
  disableSketchPanelHandler(event) {
    event.stopPropagation();
    this.sketchFlowItemEl.disabled = event.detail;
  }
  internalSketchUpdatedHandler(event) {
    event.stopPropagation();
    this.sketchUpdated.emit();
  }
  sketchGraphicUpdatesHandler(event) {
    var _a, _b;
    event.stopPropagation();
    const graphicUpdates = event.detail;
    if (graphicUpdates.update) {
      if (this.sketchMode === "update") {
        if (this.currentSketchInfo.graphic) {
          this.currentSketchInfo.graphic.symbol = this.currentSketchInfo.symbol;
          this.currentSketchInfo.graphic.popupTemplate = this.currentSketchInfo.popup;
          if ((_a = this.currentSketchInfo.graphic) === null || _a === void 0 ? void 0 : _a.attributes) {
            this.currentSketchInfo.graphic.attributes.title = this.currentSketchInfo.title;
          }
          else {
            this.currentSketchInfo.graphic.attributes = {
              title: this.currentSketchInfo.title
            };
          }
        }
      }
      else {
        if (this.tempCreatedGraphic) {
          this.tempCreatedGraphic.symbol = this.currentSketchInfo.symbol;
          this.tempCreatedGraphic.popupTemplate = this.currentSketchInfo.popup;
          if ((_b = this.tempCreatedGraphic) === null || _b === void 0 ? void 0 : _b.attributes) {
            this.tempCreatedGraphic.attributes.title = this.currentSketchInfo.title;
          }
          else {
            this.tempCreatedGraphic.attributes = {
              title: this.currentSketchInfo.title
            };
          }
        }
        if (this.currentSketchInfo.tool === "point") {
          this.svModel.setPoint(this.currentSketchInfo.symbol);
        }
        else if (this.currentSketchInfo.tool === "text") {
          this.svModel.setText(this.currentSketchInfo.symbol);
        }
        else if (this.currentSketchInfo.tool === "polyline") {
          this.svModel.setLine(this.currentSketchInfo.symbol);
        }
        else if (["circle", "polygon", "rectangle"].indexOf(this.currentSketchInfo.tool) > -1) {
          this.svModel.setPolygon(this.currentSketchInfo.symbol);
        }
      }
      // to refresh popup
      this.mapView.popup.features = [this.currentSketchInfo.graphic];
    }
    if (graphicUpdates.close) {
      this.clearHighlightAndPopup();
      this.closeSketchPopovers.emit();
      this.svModel.cancel();
      this.svModel.updateOnGraphic(false);
      this.setFocus();
    }
    this.internalSketchUpdated.emit();
  }
  async sketchActionOnDrawFeaturesHandler({ detail: { tool, sketchMessage } }) {
    this.clearHighlightAndPopup();
    this.watchEscapeOnMapView(true);
    // close popover to reset when moving from update to continuous mode
    if (this.sketchMode === "update") {
      this.closeSketchPopovers.emit();
    }
    this.sketchMessageHandler(sketchMessage);
    this.sketchMode = "continuous";
    this.svModel.cancel();
    this.svModel.updateOnGraphic(false);
    this.tempCreatedGraphic = null;
    this.currentSketchInfo.graphic = null;
    this.currentSketchInfo.tool = tool;
    switch (tool) {
      case "point":
        this.svModel.setPoint((await defaultCimSymbol(this.CIMSymbol, this.mapView, this.ColorUtils)));
        this.currentSketchInfo.symbol = this.svModel.getPoint();
        this.svModel.createPoint();
        break;
      case "polyline":
        this.svModel.setLine(await defaultLineSymbol(this.mapView, this.ColorUtils));
        this.currentSketchInfo.symbol = this.svModel.getLine();
        this.svModel.createLine();
        break;
      case "polygon":
      case "rectangle":
      case "circle":
        this.svModel.setPolygon(await defaultPolygonSymbol(this.mapView, this.ColorUtils));
        this.currentSketchInfo.symbol = this.svModel.getPolygon();
        this.svModel.createPolygon(tool);
        break;
      case "text":
        this.svModel.setText((await defaultTextSymbol(this.mapView, this.ColorUtils, this.TextSymbol, this.strings.text)));
        this.currentSketchInfo.symbol = this.svModel.getText();
        this.svModel.createText();
        break;
    }
    this.currentSketchInfo.popup = null;
    this.currentSketchInfo.title = this.defaultGraphicTitle();
    this.sketchContentReRender.emit();
    this.showSketchContent = true;
  }
  async sketchActionOnSelectFeaturesHandler({ detail: { sketchMessage, multipleSelectTool } }) {
    var _a;
    this.keepSelectionMessage = sketchMessage;
    this.keepSelectionTool = multipleSelectTool;
    this.clearHighlightAndPopup();
    this.watchEscapeOnMapView(false);
    this.closeSketchPopovers.emit();
    this.tempCreatedGraphic = null;
    this.currentSketchInfo.graphic = null;
    this.currentSketchInfo.symbol = null;
    this.currentSketchInfo.tool = null;
    this.multipleSelectedGraphics = [];
    //this.svModel.cancel();
    this.sketchMode = "update";
    this.sketchMessageHandler(this.keepSelectionMessage);
    this.sketchContentReRender.emit();
    if (this.keepSelectionTool) {
      this.actionOnMultipleSelections(this.keepSelectionTool);
    }
    else {
      (_a = this.selectorOperation) === null || _a === void 0 ? void 0 : _a.cancel();
      this.svModel.updateOnGraphic(true);
    }
  }
  arcgisSketchPanelLoaderHandler(event) {
    event.stopPropagation();
    this.sketchFlowItemEl.loading = event.detail;
  }
  // Public Methods
  async done() {
    var _a, _b;
    this.removeHighlight();
    if ((_a = this.snappingSessionStorageIds) === null || _a === void 0 ? void 0 : _a.current) {
      saveSnappingToStorage(this.snappingOptions, this.snappingSessionStorageIds.current);
    }
    if ((_b = this.sketchTooltipSessionStorageIds) === null || _b === void 0 ? void 0 : _b.current) {
      saveSketchTooltipToStorage(this.sketchTooltipOptions, this.sketchTooltipSessionStorageIds.current);
    }
    this.closeSketchPopovers.emit();
    this.svModel.destroy();
    document.body.removeChild(this.sketchToolsEl);
    this.removeSketchShortcuts();
    // enable popup in the map view
    this.mapView.popupEnabled = true;
  }
  async setFocus(focusId) {
    var _a;
    if (focusId === "dismiss-button") {
      (_a = this.dismissButtonEl) === null || _a === void 0 ? void 0 : _a.setFocus();
      return;
    }
  }
  // private methods
  async loadAllModules() {
    [
      this.SketchViewModel,
      this.TextSymbol,
      this.ColorUtils,
      this.CIMSymbol,
      this.SnappingOptions,
      this.SketchTooltipOptions
    ] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_3__.l)([
      "esri/widgets/Sketch/SketchViewModel",
      "esri/symbols/TextSymbol",
      "esri/views/support/colorUtils",
      "esri/symbols/CIMSymbol",
      "esri/views/interactive/snapping/SnappingOptions",
      "esri/views/interactive/sketch/SketchTooltipOptions"
    ]);
    const [Selector2D] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_3__.l)(["esri/widgets/support/Selector2D"]);
    this.selector = new Selector2D();
  }
  removeSketchShortcuts() {
    if (this.arcgisSketchShortcuts) {
      this.arcgisSketchShortcuts.removeEventListener("arcgisSketchShortcutsDismissedChange", () => this.removeSketchShortcuts());
      document.body.removeChild(this.arcgisSketchShortcuts);
      this.arcgisSketchShortcuts = null;
    }
  }
  onGraphicCreate(event, sketchViewModel) {
    if (event.state === "start") {
      this.tempCreatedGraphic = null;
      this.removeHighlight();
    }
    if (event.state === "cancel" && this.escKey) {
      this.escKey = false;
      const tool = this.currentSketchInfo.tool === "text" ? "point" : this.currentSketchInfo.tool;
      sketchViewModel.create(tool);
    }
    if (event.state === "complete") {
      this.internalSketchUpdated.emit();
      if (event.graphic) {
        event.graphic.popupTemplate = this.currentSketchInfo.popup;
        event.graphic.attributes = {
          title: this.currentSketchInfo.title
        };
        this.tempCreatedGraphic = this.currentSketchInfo.graphic = event.graphic;
        this.highlightGraphic(event.graphic);
      }
      const tool = this.currentSketchInfo.tool === "text" ? "point" : this.currentSketchInfo.tool;
      sketchViewModel.create(tool);
    }
  }
  watchEscapeOnMapView(watch) {
    var _a;
    if (watch) {
      this.watchEscapeHandle = this.mapView.on("key-down", (event) => {
        if (event.key === "Escape" &&
          (this.svModel.getPointSVM().state === "active" ||
            this.svModel.getLineSVM().state === "active" ||
            this.svModel.getPolygonSVM().state === "active" ||
            this.svModel.getTextSVM().state === "active")) {
          event.stopPropagation();
          this.escKey = true;
          this.svModel.cancel();
        }
      });
    }
    else {
      (_a = this.watchEscapeHandle) === null || _a === void 0 ? void 0 : _a.remove();
    }
  }
  defaultGraphicTitle() {
    switch (this.currentSketchInfo.tool) {
      case "point":
        return this.strings.point;
      case "polyline":
        return this.strings.line;
      case "polygon":
        return this.strings.polygon;
      case "rectangle":
        return this.strings.rectangle;
      case "circle":
        return this.strings.circle;
      case "text":
        return this.strings.text;
      default:
        return this.strings.point;
    }
  }
  // for selection mode
  getGeometryTypeFromGraphic(currGraphic) {
    var _a, _b;
    switch ((_a = currGraphic === null || currGraphic === void 0 ? void 0 : currGraphic.geometry) === null || _a === void 0 ? void 0 : _a.type) {
      case "point":
        if (((_b = currGraphic === null || currGraphic === void 0 ? void 0 : currGraphic.symbol) === null || _b === void 0 ? void 0 : _b.type) === "text") {
          return "text";
        }
        else {
          return "point";
        }
      case "polyline":
        return "polyline";
      case "polygon":
        return "polygon";
      default:
        return "polygon";
    }
  }
  clearHighlightAndPopup() {
    this.removeHighlight();
    this.mapView.closePopup();
  }
  actionOnMultipleSelections(multipleSelectTool) {
    this.selector.sources = [
      this.layer.pointLayer,
      this.layer.polylineLayer,
      this.layer.polygonLayer,
      this.layer.textLayer
    ];
    const drawObject = multipleSelectTool === "rectangle"
      ? {
        createTool: "rectangle"
      }
      : {
        createTool: "polygon",
        createOptions: {
          mode: "freehand"
        }
      };
    const operation = (this.selectorOperation = this.selector.draw({
      operationOptions: drawObject
    }));
    operation.once("complete", (event) => {
      const { selection } = event;
      //this.sketchMessageHandler(null);
      this.clearHighlightAndPopup();
      if (!event.aborted && selection.length) {
        let tempPoint = [];
        let tempLine = [];
        let tempPolygon = [];
        let tempText = [];
        selection.forEach((currGraphic) => {
          switch (this.getGeometryTypeFromGraphic(currGraphic)) {
            case "point":
              tempPoint = [...tempPoint, currGraphic];
              break;
            case "polyline":
              tempLine = [...tempLine, currGraphic];
              break;
            case "polygon":
              tempPolygon = [...tempPolygon, currGraphic];
              break;
            case "text":
              tempText = [...tempText, currGraphic];
              break;
            default:
              tempPoint = [...tempPoint, currGraphic];
              break;
          }
        });
        this.multipleSelectedGraphics = [...tempPoint, ...tempLine, ...tempPolygon, ...tempText];
        tempPoint.length && this.svModel.updatePoint(tempPoint);
        tempLine.length && this.svModel.updateLine(tempLine);
        tempPolygon.length && this.svModel.updatePolygon(tempPolygon);
        tempText.length && this.svModel.updateText(tempText);
      }
    });
    this.svModel.updateOnGraphic(false);
  }
  sketchMessageHandler(message) {
    sketchState.sketchMessage = message;
  }
  highlightGraphic(graphic) {
    var _a;
    this.removeHighlight();
    const match = (_a = this.mapView.allLayerViews) === null || _a === void 0 ? void 0 : _a.items.find(({ layer }) => layer === this.layer);
    this.tempHighlightHandle = match === null || match === void 0 ? void 0 : match.highlight(graphic);
  }
  removeHighlight() {
    var _a;
    (_a = this.tempHighlightHandle) === null || _a === void 0 ? void 0 : _a.remove();
  }
  // for workflows where we want the current select tools to stay activated
  keepSelectToolSelection() {
    this.sketchActionOnSelectFeatures.emit({
      sketchMessage: this.keepSelectionMessage,
      multipleSelectTool: this.keepSelectionTool
    });
  }
  render() {
    const dismissButton = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { text: "close", scale: "m", icon: "x", slot: "header-actions-end", ref: (el) => (this.dismissButtonEl = el), onClick: (event) => {
        event.stopPropagation();
        this.sketchMessageHandler(null);
        this.svModel.cancel();
        this.clearHighlightAndPopup();
        this.arcgisSketchDismissedChange.emit();
      } }));
    const selectionMultipleLabel = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { alignment: "center", for: "multiple-selection-buttons" }, this.multipleSelectedGraphics.length <= 1
      ? this.strings.singleFeatureSelected
      : this.strings.featuresSelected.replace("${number}", this.multipleSelectedGraphics.length.toString())));
    const deleteMultiple = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", alignment: "center", iconStart: "trash", kind: "danger", width: "full", onClick: (event) => {
        event.stopPropagation();
        // svm knows what's selected, and will delete accordingly
        this.svModel.delete();
        this.multipleSelectedGraphics = [];
        this.keepSelectToolSelection();
      } }, this.strings.delete));
    const duplicateMultiple = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", alignment: "center", iconStart: "copy", kind: "neutral", width: "full", onClick: (event) => {
        event.stopPropagation();
        this.svModel.duplicate();
        //this.keepSelectToolSelection();
      } }, this.strings.duplicate));
    const ShortcutAndSnapping = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "snapping", ref: (el) => (this.shortcutSnappingDiv = el) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", class: "sketch-keyboard-button", kind: "neutral", iconStart: "keyboard", scale: "l", label: this.strings.sketchShortcuts, onClick: () => {
        if (!this.arcgisSketchShortcuts) {
          this.arcgisSketchShortcuts = document.createElement("arcgis-sketch-shortcuts");
          this.arcgisSketchShortcuts.refElement = this.shortcutSnappingDiv;
          document.body.appendChild(this.arcgisSketchShortcuts);
          this.arcgisSketchShortcuts.addEventListener("arcgisSketchShortcutsDismissedChange", () => this.removeSketchShortcuts());
        }
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { alignment: "icon-end-space-between", appearance: "outline-fill", kind: "neutral", width: "full", iconStart: "gear", iconEnd: "chevron-down", scale: "l", label: this.strings.settings, onClick: (event) => {
        event.stopPropagation();
        if (!this.sketchSnappingEl) {
          this.sketchSnappingEl = document.createElement("arcgis-sketch-snapping");
          this.sketchSnappingEl.refElement = this.shortcutSnappingDiv;
          document.body.appendChild(this.sketchSnappingEl);
          this.disableSketchPanel.emit(true);
        }
      } }, this.strings.settings)));
    const sketchMessage = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: sketchState.sketchMessage && "sketch-message" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { width: "full", open: !!sketchState.sketchMessage }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, sketchState.sketchMessage))));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { ref: (el) => (this.flowEl = el), dir: (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement), class: (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement) === "rtl" ? _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.C.rtl : "" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { ref: (el) => (this.sketchFlowItemEl = el), heading: this.strings.sketch, disabled: !this.layer.capabilities.operations.supportsMapNotesEditing }, this.dismissible && dismissButton, ShortcutAndSnapping, sketchMessage, this.multipleSelectedGraphics.length > 0 ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "multiple-selection" }, selectionMultipleLabel, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { id: "multiple-selection-buttons", class: "buttons" }, duplicateMultiple, deleteMultiple))) : null, this.showSketchContent && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-sketch-content", { currentSketchInfo: this.currentSketchInfo, flowEl: this.flowEl, symbolStylerRefElement: this.dismissButtonEl }))))));
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSketch.style = arcgisSketchCss;

const arcgisSketchContentCss = ".sketch-content{display:flex;flex-direction:column;background-color:var(--arcgis-app-background);padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-side-spacing-half)}.sketch-title calcite-inline-editable{border:1px solid;border-color:var(--calcite-ui-border-input);padding:var(--arcgis-app-cap-spacing-third)}.rotation{display:flex;align-items:center;justify-content:space-between;position:relative}.rotation calcite-slider{width:50%}.rotation calcite-input{width:45%;font-size:var(--arcgis-app-font-size-0);font-family:var(--arcgis-app-font-family)}.sketch-popup-button{margin-bottom:0.4em}";

const ArcgisSketchContent = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.sketchGraphicUpdates = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "sketchGraphicUpdates", 7);
    this.arcgisSketchPanelLoader = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSketchPanelLoader", 7);
    this.disableSketchPanel = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "disableSketchPanel", 7);
    this.resizeObserver = new ResizeObserver(() => {
      this.reRender = !this.reRender;
    });
    this.suggestedFillColors = [];
    this.savedColors = [];
    this.suggestedColorList = [
      "#ff4040",
      "#ff8202",
      "#faa83e",
      "#ffd159",
      "#73b566",
      "#008977",
      "#33e3c8",
      "#43abeb",
      "#4b64c9",
      "#9868ed",
      "#b055e6",
      "#db5181",
      "#e03b99",
      "#2b2b2b",
      "#bdbdbd",
      "#ffffff"
    ];
    this.savedColorList = [
      "#ffffff",
      "#bdbdbd",
      "#2b2b2b",
      "#e03b99",
      "#db5181",
      "#b055e6",
      "#9868ed",
      "#4b64c9",
      "#43abeb",
      "#33e3c8",
      "#008977",
      "#73b566",
      "#ffd159",
      "#faa83e",
      "#ff8202",
      "#ff4040"
    ];
    this.storePointStyler = (el) => {
      if (!el) {
        return;
      }
      this.pointStyler = el;
      this.startPointEdit();
    };
    this.storePolylineStyler = (el) => {
      if (!el) {
        return;
      }
      this.polylineStyler = el;
      this.startPolylineEdit();
    };
    this.storePolygonStyler = (el) => {
      if (!el) {
        return;
      }
      this.polygonStyler = el;
      this.startPolygonEdit();
    };
    // open font popover
    this.openFontPopover = () => {
      var _a;
      if (!this.arcgisFontPicker) {
        this.disableSketchPanel.emit(true);
        this.arcgisFontPicker = document.createElement("arcgis-font-picker");
        this.arcgisFontPicker.fontMap = _fontUtil_1aa3a32c_js__WEBPACK_IMPORTED_MODULE_8__.f;
        this.arcgisFontPicker.font = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.font;
        this.arcgisFontPicker.popoverProps = {
          refElement: this.hostElement
        };
        this.arcgisFontPicker.addEventListener("arcgisFontPickerDismissed", this.closeFontPopver);
        this.arcgisFontPicker.addEventListener("arcgisFontPickerChange", this.changeFont);
        document.body.appendChild(this.arcgisFontPicker);
      }
    };
    this.closeFontPopver = () => {
      if (this.arcgisFontPicker) {
        this.disableSketchPanel.emit(false);
        document.body.removeChild(this.arcgisFontPicker);
        this.arcgisFontPicker = null;
      }
    };
    this.changeFont = (event) => {
      var _a;
      const font = event.detail;
      if (font) {
        const tempSymbol = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.clone();
        tempSymbol.font.family = font.family;
        tempSymbol.font.weight = font.weight;
        tempSymbol.font.style = font.style;
        this.updateSymbol(tempSymbol);
        this.reRender = !this.reRender;
      }
    };
    this.currentSketchInfo = undefined;
    this.flowEl = undefined;
    this.symbolStylerRefElement = undefined;
    this.reRender = true;
  }
  // lifecycle methods
  async componentWillLoad() {
    this.arcgisSketchPanelLoader.emit(true);
    await this.loadAllModules();
    // add sketch
    this.suggestedColorList.forEach((hex) => {
      this.suggestedFillColors.push(new this.Color(hex));
    });
    this.savedColorList.forEach((hex) => {
      this.savedColors.push(new this.Color(hex));
    });
    this.mapView = sketchState.mapView;
    this.strings = sketchState.strings;
    this.currentLanguage = sketchState.currentLanguage;
    this.portal = sketchState.portal;
  }
  componentDidLoad() {
    this.arcgisSketchPanelLoader.emit(false);
    this.flowEl && this.resizeObserver.observe(this.flowEl);
  }
  disconnectedCallback() {
    this.flowEl && this.resizeObserver.unobserve(this.flowEl);
  }
  // events
  calciteFlowItemBackHandler(event) {
    event.stopPropagation();
    this.mapView.closePopup();
    this.sketchPopupFlowItem = null;
  }
  // currentSketchInfo is updated. rerender.
  sketchContentReRenderHandler(event) {
    event.stopPropagation();
    this.reRender = !this.reRender;
    // go back if popup panel is open
    if (this.sketchPopupFlowItem) {
      this.flowEl.back();
      this.sketchPopupFlowItem = null;
    }
    const { tool } = this.currentSketchInfo;
    if (tool === "point") {
      this.startPointEdit();
    }
    else if (tool === "polyline") {
      this.startPolylineEdit();
    }
    else if (["circle", "polygon", "rectangle"].includes(tool)) {
      this.startPolygonEdit();
    }
  }
  popupUpdatedHandler({ detail: { mapNotesPopuptemplate } }) {
    this.currentSketchInfo.popup = mapNotesPopuptemplate;
    this.sketchGraphicUpdates.emit({
      update: true,
      close: false
    });
  }
  // private methods
  async loadAllModules() {
    [this.Color, this.cimSymbolUtils, this.SimpleLineSymbol] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_3__.l)([
      "esri/Color",
      "esri/symbols/support/cimSymbolUtils",
      "esri/symbols/SimpleLineSymbol"
    ]);
  }
  updateSymbol(symbol) {
    this.currentSketchInfo.symbol = symbol;
    this.sketchGraphicUpdates.emit({
      update: true,
      close: false
    });
  }
  applyCimOutline(sym, stroke) {
    const outline = getCimOutline(sym);
    if (!outline) {
      return;
    }
    const rgba = stroke.color.toRgba();
    rgba[3] *= 255;
    outline.color = rgba;
    outline.width = stroke.size;
  }
  // https://devtopia.esri.com/WebGIS/arcgis-components/blob/master/src/smartMapping/_utils/symbolStyler.ts#L4996
  getCimOutlineProps(sym) {
    var _a;
    const outline = getCimOutline(sym);
    return {
      color: new this.Color(outline === null || outline === void 0 ? void 0 : outline.color),
      size: (_a = outline === null || outline === void 0 ? void 0 : outline.width) !== null && _a !== void 0 ? _a : 1
    };
  }
  getPopoverProps(isRtl) {
    var _a;
    const flowRect = (_a = this.flowEl) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect();
    return {
      placement: isRtl ? "bottom-start" : "bottom-end",
      offsetDistance: 10,
      offsetSkidding: isRtl ? 3 : -3,
      overlayPositioning: "fixed",
      maxHeight: flowRect && `${flowRect.height - 65}px`,
      refElement: this.symbolStylerRefElement
    };
  }
  startPointEdit() {
    var _a;
    // cim and custom picture-markers are allowed
    const isCIM = this.currentSketchInfo.symbol.type === "cim";
    (_a = this.pointStyler) === null || _a === void 0 ? void 0 : _a.edit(this.currentSketchInfo.symbol.clone(), {
      sections: {
        marker: {
          open: true,
          symbolsOpen: true,
          sizeOpen: false,
          rotationOpen: false,
          // 'all' by default, can be 'simple', 'picture', 'cim', 'cim:picture', 'cim:vector'
          // or an array of a combination of specific types
          markerType: ["cim:vector", "custom"],
          keepChoice: true,
          parts: {
            size: {
              autoSizeAdjust: false // hide adjust size property
            }
          }
        },
        fill: isCIM && {
          type: "color",
          optional: true,
          suggestedColors: this.suggestedFillColors,
          savedColors: this.savedColors,
          open: false,
          suggestedColorsOpen: true
        },
        stroke: isCIM && {
          optional: true,
          open: false,
          type: "color",
          suggestedColors: this.suggestedFillColors,
          savedColors: this.savedColors
        }
      },
      marker: {
        size: isCIM
          ? this.cimSymbolUtils.getCIMSymbolSize(this.currentSketchInfo.symbol)
          : this.currentSketchInfo.symbol.type === "picture-marker"
            ? this.currentSketchInfo.symbol.width
            : 25
      },
      fill: {
        color: (isCIM &&
          this.cimSymbolUtils.getCIMSymbolColor(this.currentSketchInfo.symbol)) ||
          this.suggestedFillColors[0]
      },
      stroke: isCIM && this.getCimOutlineProps(this.currentSketchInfo.symbol),
      fillEnabled: isCIM,
      strokeEnabled: isCIM,
      portal: this.createPortalProp()
    });
  }
  startPolylineEdit() {
    var _a, _b, _c, _d, _e;
    (_a = this.polylineStyler) === null || _a === void 0 ? void 0 : _a.edit(this.currentSketchInfo.symbol.clone(), {
      sections: {
        stroke: {
          type: "color",
          open: true,
          suggestedColorsOpen: true,
          suggestedColors: this.suggestedFillColors,
          extraParts: {
            width: true,
            autoStrokeAdjust: false
          }
        }
      },
      stroke: {
        color: ((_b = this.currentSketchInfo.symbol) === null || _b === void 0 ? void 0 : _b.color) || this.savedColors[1],
        size: ((_c = this.currentSketchInfo.symbol) === null || _c === void 0 ? void 0 : _c.width) || 10,
        style: ((_d = this.currentSketchInfo.symbol) === null || _d === void 0 ? void 0 : _d.style) ||
          "solid",
        marker: (_e = this.currentSketchInfo.symbol) === null || _e === void 0 ? void 0 : _e.marker
      },
      portal: this.createPortalProp()
    });
  }
  createPortalProp() {
    return {
      portal: this.portal,
      before: async (portal, data) => {
        await portal.load();
        data.originalStylesGroupQuery2d = portal.stylesGroupQuery2d;
        portal.stylesGroupQuery2d = 'title:"Esri Sketch Styles" AND owner:esri_en';
      },
      after: async (portal, data) => {
        portal.stylesGroupQuery2d = data.originalStylesGroupQuery2d;
      }
    };
  }
  startPolygonEdit() {
    var _a, _b, _c, _d;
    (_a = this.polygonStyler) === null || _a === void 0 ? void 0 : _a.edit(this.currentSketchInfo.symbol.clone(), {
      sections: {
        fill: {
          type: "color",
          open: true,
          optional: true,
          suggestedColorsOpen: true,
          transparencyOpen: false,
          suggestedColors: this.suggestedFillColors
        },
        stroke: {
          type: "color",
          open: false,
          optional: true,
          suggestedColorsOpen: true,
          suggestedColors: this.suggestedFillColors,
          extraParts: {
            width: true,
            autoStrokeAdjust: false
          }
        }
      },
      fill: {
        color: this.currentSketchInfo.symbol.color ||
          this.suggestedFillColors[0]
      },
      stroke: {
        color: ((_b = this.currentSketchInfo.symbol.outline) === null || _b === void 0 ? void 0 : _b.color) ||
          this.suggestedFillColors[0],
        size: ((_c = this.currentSketchInfo.symbol.outline) === null || _c === void 0 ? void 0 : _c.width) || 10,
        style: "solid",
        autoAdjusted: false
      },
      fillEnabled: this.currentSketchInfo.symbol.color ? true : false,
      strokeEnabled: ((_d = this.currentSketchInfo.symbol) === null || _d === void 0 ? void 0 : _d.outline)
        ? true
        : false,
      portal: this.createPortalProp()
    });
  }
  changeRotation(angle) {
    var _a;
    const tempSymbol = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.clone();
    tempSymbol.angle = angle;
    this.updateSymbol(tempSymbol);
    this.reRender = !this.reRender;
  }
  render() {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o;
    const isRtl = (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement) === "rtl";
    const point = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-symbol-styler", { key: "point-styler", lang: this.currentLanguage, initialSourceId: this.currentSketchInfo.sourceIds.pointSourceId, ref: this.storePointStyler, popoverProps: this.getPopoverProps(isRtl), onArcgisSymbolStylerEdit: ({ detail: { symbol } }) => {
        this.updateSymbol(symbol);
      }, onArcgisSymbolStylerSourceIdChange: ({ detail: sourceId }) => (this.currentSketchInfo.sourceIds.pointSourceId = sourceId) }));
    const polyline = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-symbol-styler", { key: "polyline-styler", lang: this.currentLanguage, initialSourceId: this.currentSketchInfo.sourceIds.polylineSourceId, ref: this.storePolylineStyler, popoverProps: this.getPopoverProps(isRtl), onArcgisSymbolStylerEdit: ({ detail: { symbol } }) => {
        this.updateSymbol(symbol);
      }, onArcgisSymbolStylerSourceIdChange: ({ detail: sourceId }) => (this.currentSketchInfo.sourceIds.polylineSourceId = sourceId) }));
    const polygon = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-symbol-styler", { key: "polygon-styler", lang: this.currentLanguage, initialSourceId: this.currentSketchInfo.sourceIds.polygonSourceId, ref: this.storePolygonStyler, popoverProps: this.getPopoverProps(isRtl), onArcgisSymbolStylerEdit: ({ detail: { symbol } }) => {
        this.updateSymbol(symbol);
      }, onArcgisSymbolStylerSourceIdChange: ({ detail: sourceId }) => (this.currentSketchInfo.sourceIds.polygonSourceId = sourceId) }));
    // text
    const textContent = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.content, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "textarea", placeholder: this.strings.textContentPlaceholder, value: (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.text, onCalciteInputInput: (event) => {
        var _a;
        event.stopPropagation();
        const tempSymbol = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.clone();
        tempSymbol.text = event.target.value;
        this.updateSymbol(tempSymbol);
      } })));
    const fontFamilySelection = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.font, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { alignment: "icon-end-space-between", appearance: "outline-fill", kind: "neutral", iconEnd: "chevron-down", label: (0,_fontUtil_1aa3a32c_js__WEBPACK_IMPORTED_MODULE_8__.b)(((_b = this.currentSketchInfo.symbol) === null || _b === void 0 ? void 0 : _b.font) ||
        { family: "Arial", style: "normal", weight: "normal" }), width: "full", scale: "m", onClick: this.openFontPopover }, (0,_fontUtil_1aa3a32c_js__WEBPACK_IMPORTED_MODULE_8__.b)((_c = this.currentSketchInfo.symbol) === null || _c === void 0 ? void 0 : _c.font))));
    const textFontSize = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.size, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "number", scale: "s", min: 5, max: 125, value: `${((_e = (_d = this.currentSketchInfo.symbol) === null || _d === void 0 ? void 0 : _d.font) === null || _e === void 0 ? void 0 : _e.size) / 0.75 || 0}`, onCalciteInputInput: (event) => {
        var _a;
        event.stopPropagation();
        const node = event.target;
        const tempSymbol = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.clone();
        tempSymbol.font.size = parseInt(node.value) * 0.75 || 0;
        this.updateSymbol(tempSymbol);
      } })));
    const textColor = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.color, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-input", { color: ((_g = (_f = this.currentSketchInfo.symbol) === null || _f === void 0 ? void 0 : _f.color) === null || _g === void 0 ? void 0 : _g.toHex()) || "#ffffff", popoverProps: this.getPopoverProps(isRtl), onArcgisColorInputChange: (event) => {
        var _a;
        const tempSymbol = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.clone();
        tempSymbol.color = new this.Color(event.target.color);
        this.updateSymbol(tempSymbol);
      } })));
    const rotation = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.rotation, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "rotation" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-slider", { min: 0, max: 360, value: ((_h = this.currentSketchInfo.symbol) === null || _h === void 0 ? void 0 : _h.angle) || 0, step: 1, onCalciteSliderInput: (event) => {
        this.changeRotation(event.target.value);
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "number", scale: "s", min: 0, max: 360, suffixText: isRtl ? "" : "º", prefixText: isRtl ? "º" : "", step: 1, value: `${((_j = this.currentSketchInfo.symbol) === null || _j === void 0 ? void 0 : _j.angle) || 0}`, onCalciteInputInput: (event) => {
        this.changeRotation(parseInt(event.target.value));
      } }))));
    const haloBlock = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block-section", { ref: (el) => (this.haloBlockSection = el), text: this.strings.halo, toggleDisplay: "switch", open: ((_k = this.currentSketchInfo.symbol) === null || _k === void 0 ? void 0 : _k.haloColor) ? true : false, onCalciteBlockSectionToggle: (event) => {
        var _a;
        event.stopPropagation();
        const tempSymbol = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.clone();
        if (this.haloBlockSection.open) {
          tempSymbol.haloColor = this.tempHaloColor || new this.Color("white");
          tempSymbol.haloSize = (tempSymbol === null || tempSymbol === void 0 ? void 0 : tempSymbol.haloSize) || 1 * 0.75;
        }
        else {
          this.tempHaloColor = tempSymbol.haloColor;
          tempSymbol.haloColor = null;
        }
        this.updateSymbol(tempSymbol);
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.color, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-input", { color: ((_m = (_l = this.currentSketchInfo.symbol) === null || _l === void 0 ? void 0 : _l.haloColor) === null || _m === void 0 ? void 0 : _m.toHex()) || "#ffffff", popoverProps: this.getPopoverProps(isRtl), onArcgisColorInputChange: (event) => {
        var _a;
        const tempSymbol = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.clone();
        tempSymbol.haloColor = new this.Color(event.target.color);
        this.updateSymbol(tempSymbol);
      } })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.size, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "number", scale: "s", min: 1, max: 10, value: `${((_o = this.currentSketchInfo.symbol) === null || _o === void 0 ? void 0 : _o.haloSize) / 0.75 || 0}`, onCalciteInputInput: (event) => {
        var _a;
        event.stopPropagation();
        const node = event.target;
        const tempSymbol = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.clone();
        tempSymbol.haloSize = parseInt(node.value) * 0.75 || 0;
        this.updateSymbol(tempSymbol);
      } }))));
    const text = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, textContent, fontFamilySelection, textFontSize, textColor, rotation, haloBlock));
    const sketchTitle = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "sketch-title" }, this.strings.title, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-inline-editable", { scale: "m" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { alignment: "start", placeholder: this.strings.enterTitlePlaceholder, scale: "m", type: "text", value: this.currentSketchInfo.title, onBlur: (event) => {
        this.currentSketchInfo.title = event.target.value;
        this.sketchGraphicUpdates.emit({
          update: true,
          close: false
        });
      } }))));
    const popupBtn = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { alignment: "icon-end-space-between", appearance: "outline-fill", kind: "neutral", iconEnd: isRtl ? "chevron-left" : "chevron-right", label: this.strings.popup, width: "full", scale: "l", class: "sketch-popup-button", onClick: (event) => {
        event.stopPropagation();
        if (!this.sketchPopupFlowItem) {
          this.sketchPopupFlowItem = document.createElement("calcite-flow-item");
          this.sketchPopupFlowItem.heading = this.strings.sketch;
          this.sketchPopupFlowItem.description = this.strings.popup;
          const calciteFab = document.createElement("calcite-fab");
          calciteFab.icon = "plus";
          calciteFab.slot = "fab";
          calciteFab.scale = "s";
          calciteFab.appearance = "outline-fill";
          calciteFab.kind = "neutral";
          calciteFab.label = this.strings.addContent;
          calciteFab.text = this.strings.addContent;
          calciteFab.textEnabled = true;
          this.sketchPopupFlowItem.appendChild(calciteFab);
          const popupComponent = document.createElement("arcgis-popup");
          popupComponent.lang = this.currentLanguage;
          popupComponent.mapView = this.mapView;
          popupComponent.layerDisplayType = _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_6__.l.mapNotes;
          popupComponent.mapNotesGraphic = this.currentSketchInfo.graphic;
          popupComponent.mapNotesPopupTemplate = this.currentSketchInfo.popup;
          popupComponent.calciteFlowProps = {
            flow: this.flowEl,
            calciteFab: calciteFab,
            calciteFlowItem: this.sketchPopupFlowItem
          };
          this.sketchPopupFlowItem.appendChild(popupComponent);
          this.flowEl.appendChild(this.sketchPopupFlowItem);
          this.sketchPopupFlowItem.setFocus();
          this.sketchPopupFlowItem.beforeBack = async () => await popupComponent.done();
          this.mapView.closePopup();
          if (this.currentSketchInfo.graphic && this.currentSketchInfo.popup) {
            this.mapView.openPopup({
              features: [this.currentSketchInfo.graphic],
              location: (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_7__.o)(this.currentSketchInfo.graphic.geometry)
            });
          }
        }
      } }, this.strings.popup));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { dir: (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "sketch-content" }, sketchTitle, popupBtn, (() => {
      switch (this.currentSketchInfo.tool) {
        case "point":
          return point;
        case "text":
          return text;
        case "polyline":
          return polyline;
        case "polygon":
        case "rectangle":
        case "circle":
          return polygon;
        default:
          return null;
      }
    })()))));
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSketchContent.style = arcgisSketchContentCss;

const arcgisSketchShortcutsCss = ".sketch-shortcut{background-color:var(--arcgis-app-background);display:grid;grid-template-columns:21% auto;row-gap:var(--arcgis-app-cap-spacing-half);padding:var(--arcgis-app-cap-spacing-half)}.sketch-shortcut-chip{margin-right:var(--arcgis-app-cap-spacing-half)}.sketch-shortcut-label{align-self:center}.popover{z-index:100}.arcgis--rtl .sketch-shortcut{max-height:40vh}.arcgis--rtl .sketch-shortcut-chip{margin-left:var(--arcgis-app-cap-spacing-half);margin-right:0}";

const ArcgisSketchShortcuts = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisSketchShortcutsDismissedChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSketchShortcutsDismissedChange", 7);
    this.refElement = undefined;
    this.isOpen = false;
  }
  componentWillLoad() {
    this.strings = sketchState.strings;
  }
  componentDidLoad() {
    this.isOpen = true;
  }
  async reposition() {
    var _a;
    (_a = this.sketchShortcutsPopover) === null || _a === void 0 ? void 0 : _a.reposition();
  }
  render() {
    const isRtl = (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement) === "rtl";
    const placement = !isRtl ? "leading-start" : "trailing-start";
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { dir: (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement), class: "popover " + ((0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement) === "rtl" ? _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.C.rtl : ""), ref: (el) => (this.sketchShortcutsPopover = el), placement: placement, open: this.isOpen, pointerDisabled: true, referenceElement: this.refElement, offsetDistance: -Math.round(this.refElement.getBoundingClientRect().width), offsetSkidding: 0, label: this.strings.sketchShortcuts }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { heading: this.strings.sketchShortcuts, closable: true, style: {
        width: `${Math.max(this.refElement.getBoundingClientRect().width, 375)}px`
      }, onCalcitePanelClose: () => this.arcgisSketchShortcutsDismissedChange.emit() }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "sketch-shortcut" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-chip", { class: "sketch-shortcut-chip", value: "Ctrl", scale: "m" }, "Ctrl"), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "sketch-shortcut-label" }, this.strings.ctrlShortcut), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-chip", { class: "sketch-shortcut-chip", value: "Enter", scale: "m" }, "Enter"), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "sketch-shortcut-label" }, this.strings.cShortcut), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-chip", { class: "sketch-shortcut-chip", value: "Z", scale: "m" }, "Z"), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "sketch-shortcut-label" }, this.strings.zShortcut), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-chip", { class: "sketch-shortcut-chip", value: "R", scale: "m" }, "R"), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "sketch-shortcut-label" }, this.strings.rShortcut), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-chip", { class: "sketch-shortcut-chip", value: "Esc", scale: "m" }, "Esc"), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "sketch-shortcut-label" }, this.strings.escShortcut))))));
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSketchShortcuts.style = arcgisSketchShortcutsCss;

const arcgisSketchSnappingCss = ".content{max-height:60vh}";

const ArcgisSketchSnapping = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.closeSketchSnappingPopovers = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeSketchSnappingPopovers", 7);
    this.refElement = undefined;
  }
  async componentWillLoad() {
    this.strings = sketchState.strings;
    this.mapView = sketchState.mapView;
    this.snappingOptions = sketchState.snappingOptions;
    this.snappingSessionStorageIds = sketchState.snappingSessionStorageIds;
    this.sketchTooltipOptions = sketchState.sketchTooltipOptions;
    this.sketchTooltipSessionStorageIds = sketchState.sketchTooltipSessionStorageIds;
    await this.loadAllModules();
    this.addSnappingWidget();
    this.addTooltipsWidget();
  }
  componentDidLoad() {
    this.snappingControls.container = this.snappingControlDiv;
    this.sketchTooltipControls.container = this.sketchTooltipControlDiv;
  }
  disconnectedCallback() {
    var _a, _b;
    (_a = this.snappingControls) === null || _a === void 0 ? void 0 : _a.destroy();
    (_b = this.sketchTooltipControls) === null || _b === void 0 ? void 0 : _b.destroy();
  }
  async reposition() {
    var _a;
    (_a = this.sketchSnappingPopover) === null || _a === void 0 ? void 0 : _a.reposition();
  }
  async loadAllModules() {
    const [SnappingControls, SketchTooltipControls] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_3__.l)([
      "esri/widgets/support/SnappingControls",
      "esri/widgets/support/SketchTooltipControls"
    ]);
    this.SnappingControls = SnappingControls;
    this.SketchTooltipControls = SketchTooltipControls;
  }
  addSnappingWidget() {
    this.snappingControls = new this.SnappingControls({
      view: this.mapView,
      snappingOptions: sketchState.snappingOptions,
      visibleElements: {
        header: false
      }
    });
  }
  addTooltipsWidget() {
    this.sketchTooltipControls = new this.SketchTooltipControls({
      view: this.mapView,
      tooltipOptions: sketchState.sketchTooltipOptions,
      visibleElements: {
        tooltipsToggle: true,
        labelsToggle: false
      }
    } /* __esri.SketchTooltipControlsProperties */);
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { dir: (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement), placement: "leading-start", ref: (el) => (this.sketchSnappingPopover = el), open: true, pointerDisabled: true, referenceElement: this.refElement, offsetDistance: -Math.round(this.refElement.getBoundingClientRect().width), offsetSkidding: 0, label: this.strings.settings, style: {
        zIndex: "100"
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { closable: true, headingLevel: 2, heading: this.strings.settings, style: {
        width: `${this.refElement.getBoundingClientRect().width}px`
      }, onCalcitePanelClose: () => {
        var _a, _b;
        if ((_a = this.snappingSessionStorageIds) === null || _a === void 0 ? void 0 : _a.current) {
          saveSnappingToStorage(this.snappingOptions, this.snappingSessionStorageIds.current);
        }
        if ((_b = this.sketchTooltipSessionStorageIds) === null || _b === void 0 ? void 0 : _b.current) {
          saveSketchTooltipToStorage(this.sketchTooltipOptions, this.sketchTooltipSessionStorageIds.current);
        }
        this.closeSketchSnappingPopovers.emit();
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "content" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (el) => (this.sketchTooltipControlDiv = el) }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (el) => (this.snappingControlDiv = el) }))))));
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSketchSnapping.style = arcgisSketchSnappingCss;

const arcgisSketchToolsCss = ".popover{z-index:100}";

const ArcgisSketchTools = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.sketchActionOnDrawFeatures = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "sketchActionOnDrawFeatures", 7);
    this.sketchActionOnSelectFeatures = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "sketchActionOnSelectFeatures", 7);
    this.refElement = undefined;
    this.mapNotesFeature = null;
    this.isOpen = false;
  }
  componentWillLoad() {
    this.strings = sketchState.strings;
    this.svModel = sketchState.svModel;
    this.layer = sketchState.layer;
  }
  componentDidLoad() {
    // select mode if feature is available, else default add point mode
    if (this.mapNotesFeature) {
      this.actionOnSelectFeatures(this.strings.selectText, this.sketchSelect);
      switch (this.mapNotesFeature.layer) {
        case this.layer.pointLayer:
          this.svModel.updatePoint([this.mapNotesFeature]);
          break;
        case this.layer.textLayer:
          this.svModel.updateText([this.mapNotesFeature]);
          break;
        case this.layer.polylineLayer:
          this.svModel.updateLine([this.mapNotesFeature]);
          break;
        case this.layer.polygonLayer:
          this.svModel.updatePolygon([this.mapNotesFeature]);
          break;
        default:
          return;
      }
    }
    else {
      this.actionOnDrawFeatures("point", this.strings.addStamp, this.sketchPoint);
    }
    this.isOpen = true;
  }
  async reposition() {
    var _a;
    (_a = this.sketchToolsPopover) === null || _a === void 0 ? void 0 : _a.reposition();
  }
  actionOnDrawFeatures(tool, sketchMessage, currentActionElement) {
    this.clearActiveSelection();
    currentActionElement.active = true;
    this.sketchActionOnDrawFeatures.emit({
      tool: tool,
      sketchMessage: sketchMessage
    });
  }
  actionOnSelectFeatures(sketchMessage, currentActionElement, multipleSelectTool) {
    const { active = false } = currentActionElement;
    this.clearActiveSelection();
    currentActionElement.active = !active;
    this.svModel.cancel();
    this.sketchActionOnSelectFeatures.emit({
      sketchMessage: !active ? sketchMessage : "",
      multipleSelectTool: (!active && multipleSelectTool) || null
    });
  }
  clearActiveSelection() {
    this.sketchPoint.active = false;
    this.sketchPolyLine.active = false;
    this.sketchPolygon.active = false;
    this.sketchRectangle.active = false;
    this.sketchCircle.active = false;
    this.sketchText.active = false;
    this.sketchSelect.active = false;
    this.sketchRectangleSelect.active = false;
    this.sketchLassoSelect.active = false;
  }
  render() {
    const drawFeatures = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action-group", { layout: "vertical" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchPoint = el), text: this.strings.stamp, label: this.strings.stamp, title: this.strings.stamp, icon: "pin", scale: "m", alignment: "center", onClick: () => {
        this.actionOnDrawFeatures("point", this.strings.addStamp, this.sketchPoint);
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchPolyLine = el), text: this.strings.line, label: this.strings.line, title: this.strings.line, icon: "line", scale: "m", alignment: "center", onClick: () => {
        this.actionOnDrawFeatures("polyline", this.strings.startFinishDrawing, this.sketchPolyLine);
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchPolygon = el), text: this.strings.polygon, label: this.strings.polygon, title: this.strings.polygon, icon: "polygon", scale: "m", alignment: "center", onClick: () => {
        this.actionOnDrawFeatures("polygon", this.strings.startFinishDrawing, this.sketchPolygon);
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchRectangle = el), text: this.strings.rectangle, label: this.strings.rectangle, title: this.strings.rectangle, icon: "rectangle", scale: "m", alignment: "center", onClick: () => {
        this.actionOnDrawFeatures("rectangle", this.strings.addRectangle, this.sketchRectangle);
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchCircle = el), text: this.strings.circle, label: this.strings.circle, title: this.strings.circle, icon: "circle", scale: "m", alignment: "center", onClick: () => {
        this.actionOnDrawFeatures("circle", this.strings.addCircle, this.sketchCircle);
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchText = el), text: this.strings.text, label: this.strings.text, title: this.strings.text, icon: "text", scale: "m", alignment: "center", onClick: async () => {
        this.actionOnDrawFeatures("text", this.strings.addText, this.sketchText);
      } })));
    const selectFeatures = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action-group", { layout: "vertical" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchSelect = el), text: this.strings.select, label: this.strings.select, title: this.strings.select, icon: "cursor", scale: "m", alignment: "center", onClick: () => {
        this.actionOnSelectFeatures(this.strings.selectText, this.sketchSelect);
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchRectangleSelect = el), text: this.strings.rectangleSelect, label: this.strings.rectangleSelect, title: this.strings.rectangleSelect, icon: "cursor-marquee", scale: "m", alignment: "center", onClick: () => {
        this.actionOnSelectFeatures(this.strings.rectangleLassoSelect, this.sketchRectangleSelect, "rectangle");
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchLassoSelect = el), text: this.strings.lassoSelect, label: this.strings.lassoSelect, title: this.strings.lassoSelect, icon: "lasso", scale: "m", alignment: "center", onClick: () => {
        this.actionOnSelectFeatures(this.strings.rectangleLassoSelect, this.sketchLassoSelect, "lasso");
      } })));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { dir: (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement), ref: (el) => (this.sketchToolsPopover = el), placement: "leading-start", open: this.isOpen, referenceElement: this.refElement, offsetDistance: 15, pointerDisabled: true, focusTrapDisabled: true, triggerDisabled: true, label: this.strings.sketch, class: "popover", onCalcitePopoverBeforeClose: () => (this.sketchToolsPopover.open = true) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action-pad", { position: "start", layout: "vertical", expandDisabled: true }, drawFeatures, selectFeatures))));
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSketchTools.style = arcgisSketchToolsCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ arrayToLookupMap),
/* harmony export */   b: () => (/* binding */ unique),
/* harmony export */   c: () => (/* binding */ throttle),
/* harmony export */   d: () => (/* binding */ debounce),
/* harmony export */   e: () => (/* binding */ escapeRegExp),
/* harmony export */   f: () => (/* binding */ arraysAreEquivalent),
/* harmony export */   g: () => (/* binding */ chunk),
/* harmony export */   i: () => (/* binding */ isDefined),
/* harmony export */   m: () => (/* binding */ minDelay),
/* harmony export */   t: () => (/* binding */ timeout),
/* harmony export */   u: () => (/* binding */ uniqueBy)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
/**
 * Call a function only after it has not been called for n milliseconds
 * @param fn    - function to call
 * @param delay - delay in milliseconds
 */
const debounce = (fn, delay) => {
  let timeout;
  let status = "idle";
  function flush(...args) {
    status = "flushed";
    return debounced(...args);
  }
  function invoke(...args) {
    status = "invoked";
    return debounced(...args);
  }
  function cancel(...args) {
    status = "cancelled";
    return debounced(...args);
  }
  function getStatus() {
    return status;
  }
  const debounced = (...args) => new Promise((resolve) => {
    switch (status) {
      case "flushed":
        status = "idle";
        if (timeout) {
          clearTimeout(timeout);
          resolve(fn(...args));
        }
        else {
          resolve(null);
        }
        break;
      case "invoked":
        clearTimeout(timeout);
        status = "idle";
        resolve(fn(...args));
        break;
      case "cancelled":
        clearTimeout(timeout);
        status = "idle";
        resolve(null);
        break;
      default:
        if (timeout) {
          clearTimeout(timeout);
        }
        status = "pending";
        timeout = setTimeout(() => {
          status = "idle";
          return resolve(fn(...args));
        }, delay);
        break;
    }
  });
  debounced.flush = flush;
  debounced.invoke = invoke;
  debounced.cancel = cancel;
  debounced.getStatus = getStatus;
  return debounced;
};
/**
 * Call a function only after n milliseconds have elapsed
 * @param fn    - function to call
 * @param delay - delay in milliseconds
 */
const throttle = (fn, delay) => {
  let timeout;
  return (...args) => new Promise((resolve) => {
    if (timeout) {
      return;
    }
    timeout = setTimeout(() => {
      clearTimeout(timeout);
      timeout = undefined;
      resolve(fn(...args));
    }, delay);
  });
};
function escapeRegExp(str) {
  return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"); // $& means the whole matched string
}
function isDefined(value) {
  return value !== undefined && value !== null;
}
/**
 * Set a minimum time for a promise to resolve (useful for preventing flash of loaders)
 */
async function minDelay(promise, minDelay) {
  await Promise.all([promise, timeout(minDelay)]);
  return promise;
}
/**
 * Helper method to inline setTimeout as an await in async functions
 */
function timeout(ms) {
  return new Promise((resolve) => setTimeout(resolve, ms));
}
const arrayToLookupMap = (dataArr, getKeyAndItem) => Object.fromEntries((dataArr || []).map((item) => {
  const { key, data } = getKeyAndItem(item);
  return [key, data];
}));
/**
 * Check whether two arrays have the same number of elements
 * and whether they contain the same elements
 * regardless of order
 */
const arraysAreEquivalent = (arr1, arr2) => arr1.length === arr2.length && arr1.reduce((memo, str) => memo && arr2.indexOf(str) > -1, true);
function uniqueBy(myArr, getItemId) {
  const resultArr = [];
  const lookupMap = {};
  myArr.forEach((item) => {
    const id = getItemId(item);
    if (lookupMap[id] == null) {
      lookupMap[id] = item;
      resultArr.push(item);
    }
  });
  return resultArr;
}
function unique(myArr) {
  const primitives = { boolean: {}, number: {}, string: {} };
  const objs = [];
  return myArr.filter((item) => {
    let type = typeof item;
    if (type in primitives) {
      return primitives[type].hasOwnProperty(item) ? false : (primitives[type][item] = true);
    }
    else {
      return objs.indexOf(item) >= 0 ? false : objs.push(item);
    }
  });
}
const chunk = (arr, size) => [...Array(Math.ceil(arr.length / size))].map((_, i) => arr.slice(size * i, size + size * i));




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ createStore)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const appendToMap = (map, propName, value) => {
    const items = map.get(propName);
    if (!items) {
        map.set(propName, [value]);
    }
    else if (!items.includes(value)) {
        items.push(value);
    }
};
const debounce = (fn, ms) => {
    let timeoutId;
    return (...args) => {
        if (timeoutId) {
            clearTimeout(timeoutId);
        }
        timeoutId = setTimeout(() => {
            timeoutId = 0;
            fn(...args);
        }, ms);
    };
};

/**
 * Check if a possible element isConnected.
 * The property might not be there, so we check for it.
 *
 * We want it to return true if isConnected is not a property,
 * otherwise we would remove these elements and would not update.
 *
 * Better leak in Edge than to be useless.
 */
const isConnected = (maybeElement) => !('isConnected' in maybeElement) || maybeElement.isConnected;
const cleanupElements = debounce((map) => {
    for (let key of map.keys()) {
        map.set(key, map.get(key).filter(isConnected));
    }
}, 2000);
const stencilSubscription = () => {
    if (typeof _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.g !== 'function') {
        // If we are not in a stencil project, we do nothing.
        // This function is not really exported by @stencil/core.
        return {};
    }
    const elmsToUpdate = new Map();
    return {
        dispose: () => elmsToUpdate.clear(),
        get: (propName) => {
            const elm = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.g)();
            if (elm) {
                appendToMap(elmsToUpdate, propName, elm);
            }
        },
        set: (propName) => {
            const elements = elmsToUpdate.get(propName);
            if (elements) {
                elmsToUpdate.set(propName, elements.filter(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.f));
            }
            cleanupElements(elmsToUpdate);
        },
        reset: () => {
            elmsToUpdate.forEach((elms) => elms.forEach(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.f));
            cleanupElements(elmsToUpdate);
        },
    };
};

const unwrap = (val) => (typeof val === 'function' ? val() : val);
const createObservableMap = (defaultState, shouldUpdate = (a, b) => a !== b) => {
    const unwrappedState = unwrap(defaultState);
    let states = new Map(Object.entries(unwrappedState !== null && unwrappedState !== void 0 ? unwrappedState : {}));
    const handlers = {
        dispose: [],
        get: [],
        set: [],
        reset: [],
    };
    const reset = () => {
        var _a;
        // When resetting the state, the default state may be a function - unwrap it to invoke it.
        // otherwise, the state won't be properly reset
        states = new Map(Object.entries((_a = unwrap(defaultState)) !== null && _a !== void 0 ? _a : {}));
        handlers.reset.forEach((cb) => cb());
    };
    const dispose = () => {
        // Call first dispose as resetting the state would
        // cause less updates ;)
        handlers.dispose.forEach((cb) => cb());
        reset();
    };
    const get = (propName) => {
        handlers.get.forEach((cb) => cb(propName));
        return states.get(propName);
    };
    const set = (propName, value) => {
        const oldValue = states.get(propName);
        if (shouldUpdate(value, oldValue, propName)) {
            states.set(propName, value);
            handlers.set.forEach((cb) => cb(propName, value, oldValue));
        }
    };
    const state = (typeof Proxy === 'undefined'
        ? {}
        : new Proxy(unwrappedState, {
            get(_, propName) {
                return get(propName);
            },
            ownKeys(_) {
                return Array.from(states.keys());
            },
            getOwnPropertyDescriptor() {
                return {
                    enumerable: true,
                    configurable: true,
                };
            },
            has(_, propName) {
                return states.has(propName);
            },
            set(_, propName, value) {
                set(propName, value);
                return true;
            },
        }));
    const on = (eventName, callback) => {
        handlers[eventName].push(callback);
        return () => {
            removeFromArray(handlers[eventName], callback);
        };
    };
    const onChange = (propName, cb) => {
        const unSet = on('set', (key, newValue) => {
            if (key === propName) {
                cb(newValue);
            }
        });
        // We need to unwrap the defaultState because it might be a function.
        // Otherwise we might not be sending the right reset value.
        const unReset = on('reset', () => cb(unwrap(defaultState)[propName]));
        return () => {
            unSet();
            unReset();
        };
    };
    const use = (...subscriptions) => {
        const unsubs = subscriptions.reduce((unsubs, subscription) => {
            if (subscription.set) {
                unsubs.push(on('set', subscription.set));
            }
            if (subscription.get) {
                unsubs.push(on('get', subscription.get));
            }
            if (subscription.reset) {
                unsubs.push(on('reset', subscription.reset));
            }
            if (subscription.dispose) {
                unsubs.push(on('dispose', subscription.dispose));
            }
            return unsubs;
        }, []);
        return () => unsubs.forEach((unsub) => unsub());
    };
    const forceUpdate = (key) => {
        const oldValue = states.get(key);
        handlers.set.forEach((cb) => cb(key, oldValue, oldValue));
    };
    return {
        state,
        get,
        set,
        on,
        onChange,
        use,
        dispose,
        reset,
        forceUpdate,
    };
};
const removeFromArray = (array, item) => {
    const index = array.indexOf(item);
    if (index >= 0) {
        array[index] = array[array.length - 1];
        array.length--;
    }
};

const createStore = (defaultState, shouldUpdate) => {
    const map = createObservableMap(defaultState, shouldUpdate);
    map.use(stencilSubscription());
    return map;
};




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
  var _a, _b, _c;
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    // "ru-RU" maps to "ru" use case
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
    }
    else {
      return "en";
    }
  }
}
function getComponentClosestLanguageIntl(element) {
  var _a, _b, _c;
  // it's OK if we don't have the 4 letter language file for it
  // 4 letter language code needed for formatting numbers
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      // we support the 2 letter coded language
      // e.g. it-CH vs it
      return lang;
    }
    else {
      return "en";
    }
  }
}
function fetchLocaleStringsForComponent(componentName, locale) {
  return new Promise((resolve, reject) => {
    fetch((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
      if (result.ok)
        resolve(result.json());
      else
        reject();
    }, () => reject());
  });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
  const id = `${componentName}${locale}`;
  if (!stringCache[id]) {
    stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
  }
  return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
  const componentName = tagName || element.tagName.toLowerCase();
  const componentLanguage = getComponentClosestLanguage(element);
  const componentLanguageIntl = getComponentClosestLanguageIntl(element);
  let strings;
  try {
    strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
  }
  catch (e) {
    console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
    strings = await fetchLocaleStringsFromCache(componentName, "en");
  }
  return [strings, componentLanguage, componentLanguageIntl];
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getCookie),
/* harmony export */   b: () => (/* binding */ setCookie),
/* harmony export */   c: () => (/* binding */ setSessionStorageItem),
/* harmony export */   d: () => (/* binding */ getSessionStorageItem),
/* harmony export */   g: () => (/* binding */ getLocalStorageItem),
/* harmony export */   s: () => (/* binding */ setLocalStorageItem)
/* harmony export */ });
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


// import stringUtil from "./strings";
/**
 * Utility methods for dealing with storage of various forms (cookies, local storage, and session storage).
 */
function setCookie(name, cookie, properties, stringify) {
  writeCookie(name, stringify ? JSON.stringify(cookie) : cookie, properties);
}
function getCookie(name, parse) {
  const cookie = readCookie(name);
  return cookie && parse ? JSON.parse(cookie) : cookie;
}
function setLocalStorageItem(name, item, stringify) {
  window.localStorage.setItem(name, stringify ? JSON.stringify(item) : item);
}
function getLocalStorageItem(name, parse) {
  const item = window.localStorage.getItem(name);
  return item && parse ? JSON.parse(item) : item;
}
function setSessionStorageItem(name, item, stringify) {
  window.sessionStorage.setItem(name, stringify ? JSON.stringify(item) : item);
}
function getSessionStorageItem(name, parse) {
  const item = window.sessionStorage.getItem(name);
  return item && parse ? JSON.parse(item) : item;
}
function readCookie(name) {
  const cookie = document.cookie;
  const cookieNameRE = new RegExp(`(?:^|; )${(0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_0__.e)(name)}=([^;]*)`);
  const matchedCookies = cookie.match(cookieNameRE);
  return matchedCookies ? decodeURIComponent(matchedCookies[1]) : undefined;
}
function writeCookie(name, value, properties) {
  properties = properties || {};
  let expires = properties === null || properties === void 0 ? void 0 : properties.expires;
  if (typeof expires === "number") {
    const expirationDate = new Date();
    const daysFromTodayInMs = expires * 24 * 60 * 60 * 1000;
    expirationDate.setTime(Date.now() + daysFromTodayInMs);
    expires = properties.expires = expirationDate;
  }
  if (typeof expires !== "string" && (expires === null || expires === void 0 ? void 0 : expires.toUTCString)) {
    properties.expires = expires.toUTCString();
  }
  let cookie = `${name}=${encodeURIComponent(value)}`;
  let property;
  for (property in properties) {
    cookie += `; ${property}`;
    const propertyValue = properties[property];
    if (propertyValue !== true) {
      cookie += `=${propertyValue}`;
    }
  }
  document.cookie = cookie;
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWNiZTk2NC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDNkc7QUFDdkM7QUFDWTtBQUNyQjtBQUNrQztBQUN4QztBQUNlO0FBQ0k7QUFDZTtBQUM5RDtBQUNPOztBQUVsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsZ0JBQWdCO0FBQzNDO0FBQ0E7QUFDQSxxQkFBcUIsMENBQTBDO0FBQy9EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGVBQWU7QUFDMUM7QUFDQTtBQUNBLHFCQUFxQiw0Q0FBNEM7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSx1REFBcUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsc0JBQXNCO0FBQ3BEO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksdURBQXFCO0FBQ2pDLE1BQU0sdURBQXFCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSx1REFBcUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsWUFBWSx1REFBcUI7QUFDakMsTUFBTSx1REFBcUI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsb0JBQW9CLHFEQUFXO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4Qiw2QkFBNkI7QUFDM0Q7QUFDQSw4QkFBOEIsaUNBQWlDO0FBQy9EO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLDZCQUE2QjtBQUMzRDtBQUNBLDhCQUE4QixpQ0FBaUM7QUFDL0Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsNkJBQTZCO0FBQzNEO0FBQ0EsOEJBQThCLGlDQUFpQztBQUMvRDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4Qiw2QkFBNkI7QUFDM0Q7QUFDQSw4QkFBOEIsaUNBQWlDO0FBQy9EO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLCtCQUErQixhQUFhLGNBQWMsZ0JBQWdCLHNCQUFzQiw0Q0FBNEMsVUFBVSxhQUFhLDJDQUEyQyw4Q0FBOEMsZ0JBQWdCLDJDQUEyQyx3QkFBd0IsbUJBQW1CLG9CQUFvQixhQUFhLG1DQUFtQyxpQkFBaUIscUNBQXFDLG1CQUFtQixrQkFBa0I7O0FBRWpnQjtBQUNBO0FBQ0EsSUFBSSxxREFBZ0I7QUFDcEIseUJBQXlCLHFEQUFXO0FBQ3BDLHVDQUF1QyxxREFBVztBQUNsRCxpQ0FBaUMscURBQVc7QUFDNUMsK0JBQStCLHFEQUFXO0FBQzFDLDhCQUE4QixxREFBVztBQUN6QyxpQ0FBaUMscURBQVc7QUFDNUMsOEJBQThCLHFEQUFXO0FBQ3pDLHVDQUF1QyxxREFBVztBQUNsRCx3Q0FBd0MscURBQVc7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG9CQUFvQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELHNEQUF5QjtBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxVQUFVLHVCQUF1QjtBQUM3RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsVUFBVSxxQ0FBcUM7QUFDN0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYywyREFBVztBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQiwyREFBVztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsY0FBYyxZQUFZO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBLCtCQUErQixzQkFBc0I7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxZQUFZO0FBQ3RCO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsV0FBVyxZQUFZO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVpTTs7Ozs7Ozs7Ozs7Ozs7OztBQzdJak07QUFDQTtBQUNBO0FBQ0E7QUFDNkU7O0FBRTdFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFD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QUs7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLEtBQUssR0FBRywwQkFBMEI7QUFDcEQ7QUFDQTtBQUNBLGlCQUFpQixFQUFFLFNBQVM7QUFDNUI7QUFDQTtBQUNBLG9CQUFvQixjQUFjO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBOztBQUVzSiIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1za2V0Y2hfNS5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9mdW5jdGlvbmFsLWM4MmY1YWI5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2luZGV4LTgxZDU0OGI3LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xvY2FsZS0xM2UwMGE3NS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9zdG9yYWdlLWQ3ZjU4MjJlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtOTJlYmIzOTYuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIH0gZnJvbSAnLi9sb2NhbGUtMTNlMDBhNzUuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRFbGVtZW50RGlyLCBDIGFzIENTU19VVElMSVRZIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtMjIyNThjOTAuanMnO1xuaW1wb3J0IHsgbCBhcyBsb2FkTW9kdWxlcyB9IGZyb20gJy4vbG9hZE1vZHVsZXMtYWFmMzBiZDYuanMnO1xuaW1wb3J0IHsgYyBhcyBzZXRTZXNzaW9uU3RvcmFnZUl0ZW0sIGQgYXMgZ2V0U2Vzc2lvblN0b3JhZ2VJdGVtIH0gZnJvbSAnLi9zdG9yYWdlLWQ3ZjU4MjJlLmpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlU3RvcmUgfSBmcm9tICcuL2luZGV4LTgxZDU0OGI3LmpzJztcbmltcG9ydCB7IGwgYXMgbGF5ZXJEaXNwbGF5VHlwZUVudW0gfSBmcm9tICcuL2NvbW1vbkVudW1zLWY5OGEzMjNjLmpzJztcbmltcG9ydCB7IG8gYXMgZ2V0UG9pbnRGcm9tR2VvbWV0cnkgfSBmcm9tICcuL2NvbW1vbkZ1bmN0aW9ucy01MjYyYjA5NC5qcyc7XG5pbXBvcnQgeyBmIGFzIGZlYXR1cmVTZXJ2aWNlRm9udE1hcCwgYiBhcyBmb250VG9Gb250TmFtZSB9IGZyb20gJy4vZm9udFV0aWwtMWFhM2EzMmMuanMnO1xuaW1wb3J0ICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgJy4vZnVuY3Rpb25hbC1jODJmNWFiOS5qcyc7XG5cbmNvbnN0IGRlZmF1bHRMaW5lU3ltYm9sID0gYXN5bmMgKG1hcFZpZXcsIENvbG9yVXRpbHMpID0+IHtcbiAgY29uc3QgYmFja2dyb3VuZFRoZW1lQ29sb3IgPSBhd2FpdCBDb2xvclV0aWxzLmdldEJhY2tncm91bmRDb2xvclRoZW1lKG1hcFZpZXcpO1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFwic2ltcGxlLWxpbmVcIixcbiAgICBjb2xvcjogYmFja2dyb3VuZFRoZW1lQ29sb3IgPT09IFwibGlnaHRcIiA/IFswLCAwLCAwXSA6IFsyNTUsIDI1NSwgMjU1XSxcbiAgICB3aWR0aDogMSAqIDAuNzVcbiAgfTtcbn07XG5jb25zdCBkZWZhdWx0UG9seWdvblN5bWJvbCA9IGFzeW5jIChtYXBWaWV3LCBDb2xvclV0aWxzKSA9PiB7XG4gIGNvbnN0IGJhY2tncm91bmRUaGVtZUNvbG9yID0gYXdhaXQgQ29sb3JVdGlscy5nZXRCYWNrZ3JvdW5kQ29sb3JUaGVtZShtYXBWaWV3KTtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBcInNpbXBsZS1maWxsXCIsXG4gICAgY29sb3I6IGJhY2tncm91bmRUaGVtZUNvbG9yID09PSBcImxpZ2h0XCIgPyBbMCwgMCwgMCwgMC4yNV0gOiBbMjU1LCAyNTUsIDI1NSwgMC4yNV0sXG4gICAgc3R5bGU6IFwic29saWRcIixcbiAgICBvdXRsaW5lOiB7XG4gICAgICBjb2xvcjogYmFja2dyb3VuZFRoZW1lQ29sb3IgPT09IFwibGlnaHRcIiA/IFswLCAwLCAwXSA6IFsyNTUsIDI1NSwgMjU1XSxcbiAgICAgIHdpZHRoOiAxICogMC43NVxuICAgIH1cbiAgfTtcbn07XG5jb25zdCBkZWZhdWx0VGV4dFN5bWJvbCA9IGFzeW5jIChtYXBWaWV3LCBDb2xvclV0aWxzLCBUZXh0U3ltYm9sLCB0ZXh0KSA9PiB7XG4gIGNvbnN0IGJhY2tncm91bmRDb2xvciA9IGF3YWl0IENvbG9yVXRpbHMuZ2V0QmFja2dyb3VuZENvbG9yKG1hcFZpZXcpO1xuICBjb25zdCBiYWNrZ3JvdW5kVGhlbWVDb2xvciA9IGF3YWl0IENvbG9yVXRpbHMuZ2V0QmFja2dyb3VuZENvbG9yVGhlbWUobWFwVmlldyk7XG4gIHJldHVybiBuZXcgVGV4dFN5bWJvbCh7XG4gICAgdGV4dCxcbiAgICBjb2xvcjogYmFja2dyb3VuZFRoZW1lQ29sb3IgPT09IFwibGlnaHRcIlxuICAgICAgPyBbMCwgMCwgMF1cbiAgICAgIDogYmFja2dyb3VuZFRoZW1lQ29sb3IgPT09IFwiZGFya1wiXG4gICAgICAgID8gWzI1NSwgMjU1LCAyNTVdXG4gICAgICAgIDogYmFja2dyb3VuZENvbG9yIHx8IFswLCAwLCAwXSxcbiAgICBoYWxvQ29sb3I6IG51bGwsXG4gICAgaGFsb1NpemU6IDEgKiAwLjc1LFxuICAgIGZvbnQ6IHtcbiAgICAgIHNpemU6IDIyICogMC43NSxcbiAgICAgIGZhbWlseTogXCJBcmlhbFwiLFxuICAgICAgd2VpZ2h0OiBcImJvbGRcIlxuICAgIH0sXG4gICAgbGluZVdpZHRoOiA1MTJcbiAgfSk7XG59O1xuY29uc3QgZGVmYXVsdENpbVN5bWJvbCA9IGFzeW5jIChDSU1TeW1ib2wsIG1hcFZpZXcsIENvbG9yVXRpbHMpID0+IHtcbiAgY29uc3QgYmFja2dyb3VuZFRoZW1lQ29sb3IgPSBhd2FpdCBDb2xvclV0aWxzLmdldEJhY2tncm91bmRDb2xvclRoZW1lKG1hcFZpZXcpO1xuICByZXR1cm4gbmV3IENJTVN5bWJvbCh7XG4gICAgZGF0YToge1xuICAgICAgdHlwZTogXCJDSU1TeW1ib2xSZWZlcmVuY2VcIixcbiAgICAgIHN5bWJvbDoge1xuICAgICAgICB0eXBlOiBcIkNJTVBvaW50U3ltYm9sXCIsXG4gICAgICAgIHN5bWJvbExheWVyczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IFwiQ0lNVmVjdG9yTWFya2VyXCIsXG4gICAgICAgICAgICBlbmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb2xvckxvY2tlZDogdHJ1ZSxcbiAgICAgICAgICAgIGFuY2hvclBvaW50OiB7IHg6IDAsIHk6IC0xLjc1IH0sXG4gICAgICAgICAgICBhbmNob3JQb2ludFVuaXRzOiBcIlJlbGF0aXZlXCIsXG4gICAgICAgICAgICBzaXplOiA1LjcsXG4gICAgICAgICAgICBmcmFtZTogeyB4bWluOiAwLCB5bWluOiAwLCB4bWF4OiA4NC4zLCB5bWF4OiA4NC4zIH0sXG4gICAgICAgICAgICBtYXJrZXJHcmFwaGljczogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJDSU1NYXJrZXJHcmFwaGljXCIsXG4gICAgICAgICAgICAgICAgZ2VvbWV0cnk6IHtcbiAgICAgICAgICAgICAgICAgIHJpbmdzOiBbXG4gICAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgICBbODMuMiwgMzIuNV0sXG4gICAgICAgICAgICAgICAgICAgICAgWzg0LjMsIDQwLjddLFxuICAgICAgICAgICAgICAgICAgICAgIFs4My44LCA0OC45XSxcbiAgICAgICAgICAgICAgICAgICAgICBbODEuNywgNTYuOV0sXG4gICAgICAgICAgICAgICAgICAgICAgWzc4LjEsIDY0LjNdLFxuICAgICAgICAgICAgICAgICAgICAgIFs3MywgNzAuOV0sXG4gICAgICAgICAgICAgICAgICAgICAgWzY2LjksIDc2LjRdLFxuICAgICAgICAgICAgICAgICAgICAgIFs1OS43LCA4MC41XSxcbiAgICAgICAgICAgICAgICAgICAgICBbNTEuOSwgODMuMl0sXG4gICAgICAgICAgICAgICAgICAgICAgWzQzLjcsIDg0LjNdLFxuICAgICAgICAgICAgICAgICAgICAgIFszNS40LCA4My44XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMjcuNCwgODEuN10sXG4gICAgICAgICAgICAgICAgICAgICAgWzIwLCA3OF0sXG4gICAgICAgICAgICAgICAgICAgICAgWzEzLjQsIDczXSxcbiAgICAgICAgICAgICAgICAgICAgICBbNy45LCA2Ni44XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMy44LCA1OS43XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMS4xLCA1MS45XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMCwgNDMuN10sXG4gICAgICAgICAgICAgICAgICAgICAgWzAuNSwgMzUuNF0sXG4gICAgICAgICAgICAgICAgICAgICAgWzIuNiwgMjcuNF0sXG4gICAgICAgICAgICAgICAgICAgICAgWzYuMywgMjBdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxMS4zLCAxMy40XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTcuNSwgNy45XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMjQuNywgMy44XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMzIuNSwgMS4xXSxcbiAgICAgICAgICAgICAgICAgICAgICBbMzkuOCwgMC4xXSxcbiAgICAgICAgICAgICAgICAgICAgICBbNDcuMSwgMC4zXSxcbiAgICAgICAgICAgICAgICAgICAgICBbNTQuMywgMS44XSxcbiAgICAgICAgICAgICAgICAgICAgICBbNjEuMSwgNC41XSxcbiAgICAgICAgICAgICAgICAgICAgICBbNjcuNCwgOC40XSxcbiAgICAgICAgICAgICAgICAgICAgICBbNzIuOSwgMTMuM10sXG4gICAgICAgICAgICAgICAgICAgICAgWzc3LjQsIDE5LjFdLFxuICAgICAgICAgICAgICAgICAgICAgIFs4MC45LCAyNS41XSxcbiAgICAgICAgICAgICAgICAgICAgICBbODMuMiwgMzIuNV1cbiAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3ltYm9sOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIkNJTVBvbHlnb25TeW1ib2xcIixcbiAgICAgICAgICAgICAgICAgIHN5bWJvbExheWVyczogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJDSU1Tb2xpZEZpbGxcIixcbiAgICAgICAgICAgICAgICAgICAgICBlbmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGJhY2tncm91bmRUaGVtZUNvbG9yID09PSBcImxpZ2h0XCIgPyBbMjQyLCAyNDIsIDI0MiwgMjU1XSA6IFsyNTUsIDI1NSwgMjU1LCAyNTVdXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBzY2FsZVN5bWJvbHNQcm9wb3J0aW9uYWxseTogdHJ1ZSxcbiAgICAgICAgICAgIHJlc3BlY3RGcmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIHJvdGF0aW9uOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiBcIkNJTVZlY3Rvck1hcmtlclwiLFxuICAgICAgICAgICAgZW5hYmxlOiB0cnVlLFxuICAgICAgICAgICAgYW5jaG9yUG9pbnQ6IHsgeDogMCwgeTogLTAuNSB9LFxuICAgICAgICAgICAgYW5jaG9yUG9pbnRVbml0czogXCJSZWxhdGl2ZVwiLFxuICAgICAgICAgICAgc2l6ZTogMTUsXG4gICAgICAgICAgICBmcmFtZTogeyB4bWluOiAwLCB5bWluOiAwLCB4bWF4OiAxOTcuNywgeW1heDogMjk0LjcgfSxcbiAgICAgICAgICAgIG1hcmtlckdyYXBoaWNzOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIkNJTU1hcmtlckdyYXBoaWNcIixcbiAgICAgICAgICAgICAgICBnZW9tZXRyeToge1xuICAgICAgICAgICAgICAgICAgcmluZ3M6IFtcbiAgICAgICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICAgIFs5OC45LCAwXSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTE5LjQsIDIzLjJdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxMzkuNCwgNDkuM10sXG4gICAgICAgICAgICAgICAgICAgICAgWzE1Ni44LCA3NS4yXSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTcxLjIsIDEwMC44XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTgyLjQsIDEyNS4zXSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTkwLjYsIDE0OC44XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTk1LjcsIDE3MS40XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTk3LjcsIDE5Mi45XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTk3LjcsIDE5NS44XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTk3LjcsIDIwMC4zXSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTk3LjYsIDIwMi41XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTk3LjUsIDIwNC44XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTk3LjMsIDIwNy4xXSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTk3LCAyMDkuNF0sXG4gICAgICAgICAgICAgICAgICAgICAgWzE5Ni43LCAyMTEuN10sXG4gICAgICAgICAgICAgICAgICAgICAgWzE5Ni40LCAyMTQuMV0sXG4gICAgICAgICAgICAgICAgICAgICAgWzE5NiwgMjE2LjRdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxOTUuNSwgMjE4LjddLFxuICAgICAgICAgICAgICAgICAgICAgIFsxOTUsIDIyMS4xXSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTk0LjQsIDIyMy40XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTkzLjcsIDIyNS44XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTkzLCAyMjguMV0sXG4gICAgICAgICAgICAgICAgICAgICAgWzE5Mi4yLCAyMzAuNV0sXG4gICAgICAgICAgICAgICAgICAgICAgWzE5MS40LCAyMzIuOF0sXG4gICAgICAgICAgICAgICAgICAgICAgWzE5MC41LCAyMzUuMV0sXG4gICAgICAgICAgICAgICAgICAgICAgWzE4OS41LCAyMzcuNV0sXG4gICAgICAgICAgICAgICAgICAgICAgWzE4OC41LCAyMzkuN10sXG4gICAgICAgICAgICAgICAgICAgICAgWzE4Ny40LCAyNDJdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxODYuMiwgMjQ0LjNdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxODUsIDI0Ni41XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTgzLjcsIDI0OC43XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTgyLjQsIDI1MC45XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTgxLCAyNTMuMV0sXG4gICAgICAgICAgICAgICAgICAgICAgWzE3OS41LCAyNTUuMl0sXG4gICAgICAgICAgICAgICAgICAgICAgWzE3OCwgMjU3LjNdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxNzYuNCwgMjU5LjRdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxNzQuNywgMjYxLjRdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxNzMuMSwgMjYzLjNdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxNzEuMywgMjY1LjNdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxNjkuNSwgMjY3LjJdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxNjcuNywgMjY5XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTY1LjgsIDI3MC44XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTYzLjksIDI3Mi41XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTYxLjksIDI3NC4yXSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTU5LjksIDI3NS44XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTU3LjgsIDI3Ny40XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTU1LjcsIDI3OC45XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTUzLjYsIDI4MC40XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTUxLjQsIDI4MS43XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTQ5LjIsIDI4My4xXSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTQ3LCAyODQuNF0sXG4gICAgICAgICAgICAgICAgICAgICAgWzE0NC44LCAyODUuNl0sXG4gICAgICAgICAgICAgICAgICAgICAgWzE0Mi41LCAyODYuN10sXG4gICAgICAgICAgICAgICAgICAgICAgWzE0MC4zLCAyODcuOF0sXG4gICAgICAgICAgICAgICAgICAgICAgWzEzOCwgMjg4LjhdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxMzUuNywgMjg5LjhdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxMzMuNCwgMjkwLjddLFxuICAgICAgICAgICAgICAgICAgICAgIFsxMzEsIDI5MS41XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTI4LjcsIDI5Mi4zXSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTI2LjQsIDI5M10sXG4gICAgICAgICAgICAgICAgICAgICAgWzEyNCwgMjkzLjZdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxMjEuNywgMjk0LjJdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxMTkuNCwgMjk0LjddLFxuICAgICAgICAgICAgICAgICAgICAgIFsxMTcsIDI5NS4yXSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTE0LjcsIDI5NS42XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTEyLjQsIDI5Nl0sXG4gICAgICAgICAgICAgICAgICAgICAgWzExMC4xLCAyOTYuM10sXG4gICAgICAgICAgICAgICAgICAgICAgWzEwNy44LCAyOTYuNV0sXG4gICAgICAgICAgICAgICAgICAgICAgWzEwNS41LCAyOTYuN10sXG4gICAgICAgICAgICAgICAgICAgICAgWzEwMy4zLCAyOTYuOF0sXG4gICAgICAgICAgICAgICAgICAgICAgWzEwMS4xLCAyOTYuOV0sXG4gICAgICAgICAgICAgICAgICAgICAgWzk4LjgsIDI5Ni45XSxcbiAgICAgICAgICAgICAgICAgICAgICBbODMuMSwgMjk1LjddLFxuICAgICAgICAgICAgICAgICAgICAgIFs2Ny44LCAyOTJdLFxuICAgICAgICAgICAgICAgICAgICAgIFs1My4zLCAyODUuOV0sXG4gICAgICAgICAgICAgICAgICAgICAgWzM5LjksIDI3Ny41XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMjguMSwgMjY3LjJdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxOCwgMjU1LjFdLFxuICAgICAgICAgICAgICAgICAgICAgIFsxMCwgMjQxLjVdLFxuICAgICAgICAgICAgICAgICAgICAgIFs0LjIsIDIyNi45XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMC45LCAyMTEuNV0sXG4gICAgICAgICAgICAgICAgICAgICAgWzAsIDE5NS44XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMC4xLCAxOTIuOV0sXG4gICAgICAgICAgICAgICAgICAgICAgWzIuMSwgMTcxLjRdLFxuICAgICAgICAgICAgICAgICAgICAgIFs3LjIsIDE0OC44XSxcbiAgICAgICAgICAgICAgICAgICAgICBbMTUuNCwgMTI1LjNdLFxuICAgICAgICAgICAgICAgICAgICAgIFsyNi42LCAxMDAuOF0sXG4gICAgICAgICAgICAgICAgICAgICAgWzQxLCA3NS4yXSxcbiAgICAgICAgICAgICAgICAgICAgICBbNTguNCwgNDkuM10sXG4gICAgICAgICAgICAgICAgICAgICAgWzc4LjQsIDIzLjJdLFxuICAgICAgICAgICAgICAgICAgICAgIFs5OC45LCAwXVxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzeW1ib2w6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwiQ0lNUG9seWdvblN5bWJvbFwiLFxuICAgICAgICAgICAgICAgICAgc3ltYm9sTGF5ZXJzOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIkNJTVNvbGlkRmlsbFwiLFxuICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogYmFja2dyb3VuZFRoZW1lQ29sb3IgPT09IFwibGlnaHRcIiA/IFsxNywgMjYsIDQwLCAyNTVdIDogWzE4NiwgMTg2LCAxODYsIDI1NV1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIHNjYWxlU3ltYm9sc1Byb3BvcnRpb25hbGx5OiB0cnVlLFxuICAgICAgICAgICAgcmVzcGVjdEZyYW1lOiB0cnVlLFxuICAgICAgICAgICAgcm90YXRpb246IDBcbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIHNjYWxlWDogMSxcbiAgICAgICAgYW5nbGVBbGlnbm1lbnQ6IFwiRGlzcGxheVwiLFxuICAgICAgICBhbmdsZTogMFxuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xuLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWNvbXBvbmVudHMvYmxvYi9tYXN0ZXIvc3JjL3NtYXJ0TWFwcGluZy9fdXRpbHMvc3ltYm9sLnRzXG5mdW5jdGlvbiBnZXRDaW1PdXRsaW5lKHN5bSkge1xuICBpZiAoIWlzTVZDb21wYXRpYmxlQ0lNKHN5bSkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3Qgc3ltYm9sTGF5ZXJzID0gc3ltLmRhdGEuc3ltYm9sLnN5bWJvbExheWVycztcbiAgY29uc3QgYmdTeW1ib2xMYXllciA9IHN5bWJvbExheWVyc1tzeW1ib2xMYXllcnMubGVuZ3RoIC0gMV07XG4gIGNvbnN0IGdyYXBoaWMgPSBiZ1N5bWJvbExheWVyLm1hcmtlckdyYXBoaWNzWzBdO1xuICByZXR1cm4gZ3JhcGhpYy5zeW1ib2wuc3ltYm9sTGF5ZXJzLmZpbmQoKHNsKSA9PiBzbC50eXBlID09PSBcIkNJTVNvbGlkU3Ryb2tlXCIpO1xufVxuZnVuY3Rpb24gaXNNVkNvbXBhdGlibGVDSU0oc3ltKSB7XG4gIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mO1xuICAvLyAtXHRIYXZlIG9uZSBzeW1ib2xMYXllciB3aXRoIGEgc3Ryb2tlIGFuZCBhIGZpbGwgKENJTVZlY3Rvck1hcmtlcikgdGhhdCBpcyBub3QgY29sb3JMb2NrZWRcbiAgLy8gLVx0SGF2ZSB0d28gc3ltYm9sTGF5ZXJzIHdpdGggYSBzdHJva2UgYW5kIGEgZmlsbCAoQ0lNVmVjdG9yTWFya2VyKVxuICAvLyAgICBUaGUgc21hbGxlciAoZmlyc3QpIHN5bWJvbExheWVyIGlzIG5vdCBjb2xvckxvY2tlZFxuICAvLyAgICBUaGUgc2Vjb25kIHN5bWJvbExheWVyIG11c3QgaGF2ZSBhIGdyZWF0ZXIgc2l6ZSB0aGFuIHRoZSBmaXJzdFxuICBjb25zdCBzeW1ib2xMYXllcnMgPSBzeW0uZGF0YS5zeW1ib2wuc3ltYm9sTGF5ZXJzO1xuICBpZiAoc3ltYm9sTGF5ZXJzLmxlbmd0aCA9PT0gMSkge1xuICAgIGNvbnN0IHN5bWJvbExheWVyID0gc3ltYm9sTGF5ZXJzWzBdO1xuICAgIGlmIChzeW1ib2xMYXllci50eXBlICE9PSBcIkNJTVZlY3Rvck1hcmtlclwiIHx8IHN5bWJvbExheWVyLmNvbG9yTG9ja2VkKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IG1hcmtlckdyYXBoaWNMYXllcnMgPSAoX2IgPSAoX2EgPSBzeW1ib2xMYXllci5tYXJrZXJHcmFwaGljc1swXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN5bWJvbCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnN5bWJvbExheWVycztcbiAgICByZXR1cm4gc3ltYm9sTGF5ZXIubWFya2VyR3JhcGhpY3MubGVuZ3RoID09PSAxICYmIGhhc1VubG9ja2VkRmlsbEFuZFN0cm9rZShtYXJrZXJHcmFwaGljTGF5ZXJzKTtcbiAgfVxuICBlbHNlIGlmIChzeW1ib2xMYXllcnMubGVuZ3RoID09PSAyKSB7XG4gICAgY29uc3Qgc3ltYm9sTGF5ZXIxID0gc3ltYm9sTGF5ZXJzWzBdO1xuICAgIGNvbnN0IHN5bWJvbExheWVyMiA9IHN5bWJvbExheWVyc1sxXTtcbiAgICBpZiAoc3ltYm9sTGF5ZXIxLnR5cGUgIT09IFwiQ0lNVmVjdG9yTWFya2VyXCIgfHxcbiAgICAgIHN5bWJvbExheWVyMi50eXBlICE9PSBcIkNJTVZlY3Rvck1hcmtlclwiIHx8XG4gICAgICBzeW1ib2xMYXllcjEuY29sb3JMb2NrZWQgfHxcbiAgICAgIHN5bWJvbExheWVyMS5zaXplID4gc3ltYm9sTGF5ZXIyLnNpemUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgbWFya2VyR3JhcGhpY0xheWVyczEgPSAoX2QgPSAoX2MgPSBzeW1ib2xMYXllcjEubWFya2VyR3JhcGhpY3NbMF0pID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5zeW1ib2wpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5zeW1ib2xMYXllcnM7XG4gICAgY29uc3QgbWFya2VyR3JhcGhpY0xheWVyczIgPSAoX2YgPSAoX2UgPSBzeW1ib2xMYXllcjIubWFya2VyR3JhcGhpY3NbMF0pID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5zeW1ib2wpID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZi5zeW1ib2xMYXllcnM7XG4gICAgcmV0dXJuIChzeW1ib2xMYXllcjEubWFya2VyR3JhcGhpY3MubGVuZ3RoID09PSAxICYmXG4gICAgICBzeW1ib2xMYXllcjIubWFya2VyR3JhcGhpY3MubGVuZ3RoID09PSAxICYmXG4gICAgICBoYXNVbmxvY2tlZEZpbGxBbmRTdHJva2UobWFya2VyR3JhcGhpY0xheWVyczEpICYmXG4gICAgICBoYXNGaWxsQW5kU3Ryb2tlKG1hcmtlckdyYXBoaWNMYXllcnMyKSk7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuZnVuY3Rpb24gaGFzVW5sb2NrZWRGaWxsQW5kU3Ryb2tlKHN5bWJvbExheWVycykge1xuICByZXR1cm4gaGFzVW5sb2NrZWRGaWxsKHN5bWJvbExheWVycykgJiYgaGFzU3Ryb2tlKHN5bWJvbExheWVycyk7XG59XG5mdW5jdGlvbiBoYXNGaWxsQW5kU3Ryb2tlKHN5bWJvbExheWVycykge1xuICByZXR1cm4gaGFzRmlsbChzeW1ib2xMYXllcnMpICYmIGhhc1N0cm9rZShzeW1ib2xMYXllcnMpO1xufVxuZnVuY3Rpb24gaGFzRmlsbChzeW1ib2xMYXllcnMpIHtcbiAgcmV0dXJuIHN5bWJvbExheWVycyA9PT0gbnVsbCB8fCBzeW1ib2xMYXllcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHN5bWJvbExheWVycy5maW5kKChzbCkgPT4gc2wudHlwZSA9PT0gXCJDSU1Tb2xpZEZpbGxcIik7XG59XG5mdW5jdGlvbiBoYXNVbmxvY2tlZEZpbGwoc3ltYm9sTGF5ZXJzKSB7XG4gIHJldHVybiBzeW1ib2xMYXllcnMgPT09IG51bGwgfHwgc3ltYm9sTGF5ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzeW1ib2xMYXllcnMuZmluZCgoc2wpID0+IHNsLnR5cGUgPT09IFwiQ0lNU29saWRGaWxsXCIgJiYgIXNsLmNvbG9yTG9ja2VkKTtcbn1cbmZ1bmN0aW9uIGhhc1N0cm9rZShzeW1ib2xMYXllcnMpIHtcbiAgcmV0dXJuIHN5bWJvbExheWVycyA9PT0gbnVsbCB8fCBzeW1ib2xMYXllcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHN5bWJvbExheWVycy5maW5kKChzbCkgPT4gc2wudHlwZSA9PT0gXCJDSU1Tb2xpZFN0cm9rZVwiKTtcbn1cblxuY29uc3Qgc2F2ZVNuYXBwaW5nVG9TdG9yYWdlID0gKHNuYXBwaW5nT3B0aW9ucywgY3VycmVudFNuYXBwaW5nU2Vzc2lvblN0b3JhZ2VJZCkgPT4ge1xuICAvLyBnZXQgZW5hYmxlZCBsYXllcnMgYW5kIHNhdmUgb2JqZWN0IGluIHNlc3Npb24gc3RvcmFnZVxuICBjb25zdCBmZWF0dXJlU291cmNlc0lkcyA9IFtcbiAgICAuLi5uZXcgU2V0KFsuLi5zbmFwcGluZ09wdGlvbnMuZmVhdHVyZVNvdXJjZXMuZmlsdGVyKChzb3VyY2UpID0+IHNvdXJjZS5lbmFibGVkKS5tYXAoKHNvdXJjZSkgPT4gc291cmNlLmxheWVyLmlkKV0pXG4gIF07XG4gIGNvbnN0IHNuYXBwaW5nT2JqZWN0ID0ge1xuICAgIGVuYWJsZWQ6IHNuYXBwaW5nT3B0aW9ucy5lbmFibGVkLFxuICAgIHNlbGZFbmFibGVkOiBzbmFwcGluZ09wdGlvbnMuc2VsZkVuYWJsZWQsXG4gICAgZmVhdHVyZUVuYWJsZWQ6IHNuYXBwaW5nT3B0aW9ucy5mZWF0dXJlRW5hYmxlZCxcbiAgICBmZWF0dXJlU291cmNlc0lkczogZmVhdHVyZVNvdXJjZXNJZHNcbiAgfTtcbiAgc2V0U2Vzc2lvblN0b3JhZ2VJdGVtKGN1cnJlbnRTbmFwcGluZ1Nlc3Npb25TdG9yYWdlSWQsIHNuYXBwaW5nT2JqZWN0LCB0cnVlKTtcbn07XG5jb25zdCBnZXRTbmFwcGluZ09wdGlvbnMgPSAoc25hcHBpbmdTZXNzaW9uU3RvcmFnZUlkcywgbGF5ZXIsIG1hcFZpZXcsIFNuYXBwaW5nT3B0aW9ucykgPT4ge1xuICBjb25zdCBzbmFwcGluZyA9IGdldFNuYXBwaW5nRnJvbVN0b3JhZ2Uoc25hcHBpbmdTZXNzaW9uU3RvcmFnZUlkcykgfHwge1xuICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgc2VsZkVuYWJsZWQ6IHRydWUsXG4gICAgZmVhdHVyZUVuYWJsZWQ6IHRydWUsXG4gICAgZmVhdHVyZVNvdXJjZXNJZHM6IFtsYXllci5pZF1cbiAgfTtcbiAgcmV0dXJuIG5ldyBTbmFwcGluZ09wdGlvbnMoe1xuICAgIGVuYWJsZWQ6IHNuYXBwaW5nLmVuYWJsZWQsXG4gICAgc2VsZkVuYWJsZWQ6IHNuYXBwaW5nLnNlbGZFbmFibGVkLFxuICAgIGZlYXR1cmVFbmFibGVkOiBzbmFwcGluZy5mZWF0dXJlRW5hYmxlZCxcbiAgICBmZWF0dXJlU291cmNlczogZ2V0RmVhdHVyZVNvdXJjZXNGcm9tTGF5ZXJJZHMobWFwVmlldywgc25hcHBpbmcuZmVhdHVyZVNvdXJjZXNJZHMpXG4gIH0pO1xufTtcbmNvbnN0IGdldEZlYXR1cmVTb3VyY2VzRnJvbUxheWVySWRzID0gKG1hcFZpZXcsIGxheWVySWRzKSA9PiB7XG4gIGNvbnN0IGZlYXR1cmVTb3VyY2VzID0gW107XG4gIGxheWVySWRzLmZvckVhY2goKGxheWVySWQpID0+IHtcbiAgICBtYXBWaWV3Lm1hcC5hbGxMYXllcnMudG9BcnJheSgpLmZpbmQoKGxheWVyKSA9PiB7XG4gICAgICBpZiAoW1wibWFwLW5vdGVzXCIsIFwiZmVhdHVyZVwiLCBcImdlb2pzb25cIiwgXCJjc3ZcIiwgXCJ3ZnNcIiwgXCJtYXBcIl0uaW5kZXhPZihsYXllciA9PT0gbnVsbCB8fCBsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXIudHlwZSkgIT09IC0xICYmXG4gICAgICAgIGxheWVyLmlkID09PSBsYXllcklkKSB7XG4gICAgICAgIGZlYXR1cmVTb3VyY2VzLnB1c2goeyBsYXllciwgZW5hYmxlZDogdHJ1ZSB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG4gIHJldHVybiBmZWF0dXJlU291cmNlcztcbn07XG5jb25zdCBnZXRTbmFwcGluZ0Zyb21TdG9yYWdlID0gKHNuYXBwaW5nU2Vzc2lvblN0b3JhZ2VJZHMpID0+IHtcbiAgaWYgKHNuYXBwaW5nU2Vzc2lvblN0b3JhZ2VJZHMpIHtcbiAgICByZXR1cm4gKGdldFNlc3Npb25TdG9yYWdlSXRlbShzbmFwcGluZ1Nlc3Npb25TdG9yYWdlSWRzLndlYm1hcCwgdHJ1ZSkgfHxcbiAgICAgIGdldFNlc3Npb25TdG9yYWdlSXRlbShzbmFwcGluZ1Nlc3Npb25TdG9yYWdlSWRzLmN1cnJlbnQsIHRydWUpIHx8XG4gICAgICBudWxsKTtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn07XG5cbmNvbnN0IHNhdmVTa2V0Y2hUb29sdGlwVG9TdG9yYWdlID0gKHRvb2x0aXBPcHRpb25zLCBjdXJyZW50VG9vbHRpcFNlc3Npb25TdG9yYWdlSWQpID0+IHtcbiAgY29uc3QgdG9vbHRpcE9iamVjdCA9IHtcbiAgICBlbmFibGVkOiB0b29sdGlwT3B0aW9ucy5lbmFibGVkXG4gIH07XG4gIHNldFNlc3Npb25TdG9yYWdlSXRlbShjdXJyZW50VG9vbHRpcFNlc3Npb25TdG9yYWdlSWQsIHRvb2x0aXBPYmplY3QsIHRydWUpO1xufTtcbmNvbnN0IGdldFNrZXRjaFRvb2x0aXBPcHRpb25zID0gKHNrZXRjaFRvb2x0aXBTZXNzaW9uU3RvcmFnZUlkcywgU2tldGNoVG9vbHRpcE9wdGlvbnMpID0+IHtcbiAgY29uc3Qgc2tldGNoVG9vbGlwID0gZ2V0U2tldGNoVG9vbHRpcEZyb21TdG9yYWdlKHNrZXRjaFRvb2x0aXBTZXNzaW9uU3RvcmFnZUlkcykgfHwge1xuICAgIGVuYWJsZWQ6IGZhbHNlXG4gIH07XG4gIHJldHVybiBuZXcgU2tldGNoVG9vbHRpcE9wdGlvbnMoe1xuICAgIGVuYWJsZWQ6IHNrZXRjaFRvb2xpcC5lbmFibGVkXG4gIH0pO1xufTtcbmNvbnN0IGdldFNrZXRjaFRvb2x0aXBGcm9tU3RvcmFnZSA9IChza2V0Y2hUb29sdGlwU2Vzc2lvblN0b3JhZ2VJZHMpID0+IHtcbiAgaWYgKHNrZXRjaFRvb2x0aXBTZXNzaW9uU3RvcmFnZUlkcykge1xuICAgIHJldHVybiAoZ2V0U2Vzc2lvblN0b3JhZ2VJdGVtKHNrZXRjaFRvb2x0aXBTZXNzaW9uU3RvcmFnZUlkcy53ZWJtYXAsIHRydWUpIHx8XG4gICAgICBnZXRTZXNzaW9uU3RvcmFnZUl0ZW0oc2tldGNoVG9vbHRpcFNlc3Npb25TdG9yYWdlSWRzLmN1cnJlbnQsIHRydWUpIHx8XG4gICAgICBudWxsKTtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn07XG5cbmNvbnN0IHNrZXRjaFN0b3JlID0gY3JlYXRlU3RvcmUoe1xuICBtYXBWaWV3OiBudWxsLFxuICBwb3J0YWw6IG51bGwsXG4gIGxheWVyOiBudWxsLFxuICBzdHJpbmdzOiBudWxsLFxuICBjdXJyZW50TGFuZ3VhZ2U6IFwiXCIsXG4gIHNrZXRjaE1lc3NhZ2U6IFwiXCIsXG4gIHN2TW9kZWw6IG51bGwsXG4gIHNuYXBwaW5nT3B0aW9uczogbnVsbCxcbiAgc2tldGNoVG9vbHRpcE9wdGlvbnM6IG51bGwsXG4gIHNuYXBwaW5nU2Vzc2lvblN0b3JhZ2VJZHM6IG51bGwsXG4gIHNrZXRjaFRvb2x0aXBTZXNzaW9uU3RvcmFnZUlkczogbnVsbFxufSk7XG5jb25zdCBza2V0Y2hTdGF0ZSA9IHNrZXRjaFN0b3JlLnN0YXRlO1xuXG5jbGFzcyBTVk1vZGVsIHtcbiAgY29uc3RydWN0b3IobGF5ZXIsIG1hcFZpZXcsIFNrZXRjaFZpZXdNb2RlbCwgc25hcHBpbmdPcHRpb25zLCB0b29sdGlwT3B0aW9ucywgb25HcmFwaGljQ3JlYXRlLCBvbkdyYXBoaWNVcGRhdGUpIHtcbiAgICB0aGlzLmxheWVyID0gbGF5ZXI7XG4gICAgdGhpcy5tYXBWaWV3ID0gbWFwVmlldztcbiAgICAvLyBwb2ludFxuICAgIHRoaXMuc2tldGNoVmlld01vZGVsUG9pbnQgPSBuZXcgU2tldGNoVmlld01vZGVsKHtcbiAgICAgIGxheWVyOiB0aGlzLmxheWVyLnBvaW50TGF5ZXIsXG4gICAgICB2aWV3OiB0aGlzLm1hcFZpZXcsXG4gICAgICBkZWZhdWx0Q3JlYXRlT3B0aW9uczogeyBoYXNaOiBmYWxzZSwgbW9kZTogXCJoeWJyaWRcIiB9LFxuICAgICAgdXBkYXRlT25HcmFwaGljQ2xpY2s6IGZhbHNlLFxuICAgICAgZGVmYXVsdFVwZGF0ZU9wdGlvbnM6IHsgbXVsdGlwbGVTZWxlY3Rpb25FbmFibGVkOiBmYWxzZSB9LFxuICAgICAgc25hcHBpbmdPcHRpb25zLFxuICAgICAgdG9vbHRpcE9wdGlvbnNcbiAgICB9KTtcbiAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvaW50Lm9uKFwiY3JlYXRlXCIsIChldmVudCkgPT4ge1xuICAgICAgb25HcmFwaGljQ3JlYXRlKGV2ZW50LCB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvaW50KTtcbiAgICB9KTtcbiAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvaW50Lm9uKFwidXBkYXRlXCIsIChldmVudCkgPT4gb25HcmFwaGljVXBkYXRlKGV2ZW50KSk7XG4gICAgLy8gbGluZVxuICAgIHRoaXMuc2tldGNoVmlld01vZGVsTGluZSA9IG5ldyBTa2V0Y2hWaWV3TW9kZWwoe1xuICAgICAgbGF5ZXI6IHRoaXMubGF5ZXIucG9seWxpbmVMYXllcixcbiAgICAgIHZpZXc6IHRoaXMubWFwVmlldyxcbiAgICAgIGRlZmF1bHRDcmVhdGVPcHRpb25zOiB7IGhhc1o6IGZhbHNlLCBtb2RlOiBcImh5YnJpZFwiIH0sXG4gICAgICB1cGRhdGVPbkdyYXBoaWNDbGljazogZmFsc2UsXG4gICAgICBkZWZhdWx0VXBkYXRlT3B0aW9uczogeyBtdWx0aXBsZVNlbGVjdGlvbkVuYWJsZWQ6IGZhbHNlIH0sXG4gICAgICBzbmFwcGluZ09wdGlvbnMsXG4gICAgICB0b29sdGlwT3B0aW9uc1xuICAgIH0pO1xuICAgIHRoaXMuc2tldGNoVmlld01vZGVsTGluZS5vbihcImNyZWF0ZVwiLCAoZXZlbnQpID0+IG9uR3JhcGhpY0NyZWF0ZShldmVudCwgdGhpcy5za2V0Y2hWaWV3TW9kZWxMaW5lKSk7XG4gICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxMaW5lLm9uKFwidXBkYXRlXCIsIChldmVudCkgPT4gb25HcmFwaGljVXBkYXRlKGV2ZW50KSk7XG4gICAgLy8gcG9seWdvblxuICAgIHRoaXMuc2tldGNoVmlld01vZGVsUG9seWdvbiA9IG5ldyBTa2V0Y2hWaWV3TW9kZWwoe1xuICAgICAgbGF5ZXI6IHRoaXMubGF5ZXIucG9seWdvbkxheWVyLFxuICAgICAgdmlldzogdGhpcy5tYXBWaWV3LFxuICAgICAgZGVmYXVsdENyZWF0ZU9wdGlvbnM6IHsgaGFzWjogZmFsc2UsIG1vZGU6IFwiaHlicmlkXCIgfSxcbiAgICAgIHVwZGF0ZU9uR3JhcGhpY0NsaWNrOiBmYWxzZSxcbiAgICAgIGRlZmF1bHRVcGRhdGVPcHRpb25zOiB7IG11bHRpcGxlU2VsZWN0aW9uRW5hYmxlZDogZmFsc2UgfSxcbiAgICAgIHNuYXBwaW5nT3B0aW9ucyxcbiAgICAgIHRvb2x0aXBPcHRpb25zXG4gICAgfSk7XG4gICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2x5Z29uLm9uKFwiY3JlYXRlXCIsIChldmVudCkgPT4gb25HcmFwaGljQ3JlYXRlKGV2ZW50LCB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvbHlnb24pKTtcbiAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvbHlnb24ub24oXCJ1cGRhdGVcIiwgKGV2ZW50KSA9PiBvbkdyYXBoaWNVcGRhdGUoZXZlbnQpKTtcbiAgICAvLyB0ZXh0XG4gICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxUZXh0ID0gbmV3IFNrZXRjaFZpZXdNb2RlbCh7XG4gICAgICBsYXllcjogdGhpcy5sYXllci50ZXh0TGF5ZXIsXG4gICAgICB2aWV3OiB0aGlzLm1hcFZpZXcsXG4gICAgICBkZWZhdWx0Q3JlYXRlT3B0aW9uczogeyBoYXNaOiBmYWxzZSwgbW9kZTogXCJoeWJyaWRcIiB9LFxuICAgICAgdXBkYXRlT25HcmFwaGljQ2xpY2s6IGZhbHNlLFxuICAgICAgZGVmYXVsdFVwZGF0ZU9wdGlvbnM6IHsgbXVsdGlwbGVTZWxlY3Rpb25FbmFibGVkOiBmYWxzZSB9LFxuICAgICAgc25hcHBpbmdPcHRpb25zLFxuICAgICAgdG9vbHRpcE9wdGlvbnNcbiAgICB9KTtcbiAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFRleHQub24oXCJjcmVhdGVcIiwgKGV2ZW50KSA9PiBvbkdyYXBoaWNDcmVhdGUoZXZlbnQsIHRoaXMuc2tldGNoVmlld01vZGVsVGV4dCkpO1xuICAgIHRoaXMuc2tldGNoVmlld01vZGVsVGV4dC5vbihcInVwZGF0ZVwiLCAoZXZlbnQpID0+IG9uR3JhcGhpY1VwZGF0ZShldmVudCkpO1xuICB9XG4gIGRlbGV0ZSgpIHtcbiAgICB0aGlzLl9kZWxldGVQb2ludCgpO1xuICAgIHRoaXMuX2RlbGV0ZUxpbmUoKTtcbiAgICB0aGlzLl9kZWxldGVQb2x5Z29uKCk7XG4gICAgdGhpcy5fZGVsZXRlVGV4dCgpO1xuICB9XG4gIGNhbmNlbCgpIHtcbiAgICB0aGlzLl9jYW5jZWxQb2ludCgpO1xuICAgIHRoaXMuX2NhbmNlbExpbmUoKTtcbiAgICB0aGlzLl9jYW5jZWxQb2x5Z29uKCk7XG4gICAgdGhpcy5fY2FuY2VsVGV4dCgpO1xuICB9XG4gIGR1cGxpY2F0ZSgpIHtcbiAgICB0aGlzLl9kdXBsaWNhdGVQb2ludCgpO1xuICAgIHRoaXMuX2R1cGxpY2F0ZUxpbmUoKTtcbiAgICB0aGlzLl9kdXBsaWNhdGVQb2x5Z29uKCk7XG4gICAgdGhpcy5fZHVwbGljYXRlVGV4dCgpO1xuICB9XG4gIHVwZGF0ZU9uR3JhcGhpYyhoaXRUZXN0KSB7XG4gICAgdmFyIF9hO1xuICAgIGlmIChoaXRUZXN0KSB7XG4gICAgICB0aGlzLmhpdFRlc3RIYW5kbGUgPSB0aGlzLm1hcFZpZXcub24oXCJjbGlja1wiLCBhc3luYyAoZXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgaGl0VGVzdFJlc3VsdHMgPSBhd2FpdCB0aGlzLm1hcFZpZXcuaGl0VGVzdChldmVudCwge1xuICAgICAgICAgIGluY2x1ZGU6IHRoaXMubGF5ZXJcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSBoaXRUZXN0UmVzdWx0cy5yZXN1bHRzO1xuICAgICAgICBpZiAocmVzdWx0cy5sZW5ndGgpIHtcbiAgICAgICAgICAvLyBzb3J0IGJ5IGhpdCB0ZXN0IG9yZGVyIGFuZCBjaG9vc2UgdGhlIDFzdCByZXN1bHRcbiAgICAgICAgICBjb25zdCBvcmRlciA9IFtcInBvaW50XCIsIFwicG9seWxpbmVcIiwgXCJwb2x5Z29uXCJdO1xuICAgICAgICAgIHJlc3VsdHMuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgcmV0dXJuIG9yZGVyLmluZGV4T2YoYS5ncmFwaGljLmdlb21ldHJ5LnR5cGUpIC0gb3JkZXIuaW5kZXhPZihiLmdyYXBoaWMuZ2VvbWV0cnkudHlwZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc3QgY3VyckdyYXBoaWMgPSByZXN1bHRzWzBdLmdyYXBoaWM7XG4gICAgICAgICAgc3dpdGNoIChjdXJyR3JhcGhpYy5sYXllcikge1xuICAgICAgICAgICAgY2FzZSB0aGlzLmxheWVyLnBvaW50TGF5ZXI6XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlUG9pbnQoW2N1cnJHcmFwaGljXSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSB0aGlzLmxheWVyLnRleHRMYXllcjpcbiAgICAgICAgICAgICAgdGhpcy51cGRhdGVUZXh0KFtjdXJyR3JhcGhpY10pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgdGhpcy5sYXllci5wb2x5bGluZUxheWVyOlxuICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUxpbmUoW2N1cnJHcmFwaGljXSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSB0aGlzLmxheWVyLnBvbHlnb25MYXllcjpcbiAgICAgICAgICAgICAgdGhpcy51cGRhdGVQb2x5Z29uKFtjdXJyR3JhcGhpY10pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIChfYSA9IHRoaXMuaGl0VGVzdEhhbmRsZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlbW92ZSgpO1xuICAgIH1cbiAgfVxuICBkZXN0cm95KCkge1xuICAgIHRoaXMuX2Rlc3Ryb3lQb2ludCgpO1xuICAgIHRoaXMuX2Rlc3Ryb3lMaW5lKCk7XG4gICAgdGhpcy5fZGVzdHJveVBvbHlnb24oKTtcbiAgICB0aGlzLl9kZXN0cm95VGV4dCgpO1xuICB9XG4gIGdldFBvaW50U1ZNKCkge1xuICAgIHJldHVybiB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvaW50O1xuICB9XG4gIGdldFBvaW50KCkge1xuICAgIHJldHVybiB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvaW50LnBvaW50U3ltYm9sO1xuICB9XG4gIHNldFBvaW50KHN5bWJvbCkge1xuICAgIHRoaXMuc2tldGNoVmlld01vZGVsUG9pbnQucG9pbnRTeW1ib2wgPSBzeW1ib2w7XG4gIH1cbiAgY3JlYXRlUG9pbnQoKSB7XG4gICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2ludC5jcmVhdGUoXCJwb2ludFwiKTtcbiAgfVxuICB1cGRhdGVQb2ludChncmFwaGljcykge1xuICAgIHRoaXMuc2tldGNoVmlld01vZGVsUG9pbnQudXBkYXRlKGdyYXBoaWNzKTtcbiAgfVxuICBfZGVsZXRlUG9pbnQoKSB7XG4gICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2ludC5kZWxldGUoKTtcbiAgfVxuICBfY2FuY2VsUG9pbnQoKSB7XG4gICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2ludC5jYW5jZWwoKTtcbiAgfVxuICBfZHVwbGljYXRlUG9pbnQoKSB7XG4gICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2ludC5kdXBsaWNhdGUoKTtcbiAgfVxuICAvLyBwcml2YXRlIF91cGRhdGVQb2ludE9uR3JhcGhpY0NsaWNrKHVwZGF0ZU9uR3JhcGhpYzogYm9vbGVhbikge1xuICAvLyAgIHRoaXMuc2tldGNoVmlld01vZGVsUG9pbnQudXBkYXRlT25HcmFwaGljQ2xpY2sgPSB1cGRhdGVPbkdyYXBoaWM7XG4gIC8vIH1cbiAgX2Rlc3Ryb3lQb2ludCgpIHtcbiAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvaW50LmRlc3Ryb3koKTtcbiAgfVxuICAvLyBsaW5lXG4gIGdldExpbmVTVk0oKSB7XG4gICAgcmV0dXJuIHRoaXMuc2tldGNoVmlld01vZGVsTGluZTtcbiAgfVxuICBnZXRMaW5lKCkge1xuICAgIHJldHVybiB0aGlzLnNrZXRjaFZpZXdNb2RlbExpbmUucG9seWxpbmVTeW1ib2w7XG4gIH1cbiAgc2V0TGluZShzeW1ib2wpIHtcbiAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbExpbmUucG9seWxpbmVTeW1ib2wgPSBzeW1ib2w7XG4gIH1cbiAgY3JlYXRlTGluZSgpIHtcbiAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbExpbmUuY3JlYXRlKFwicG9seWxpbmVcIik7XG4gIH1cbiAgdXBkYXRlTGluZShncmFwaGljcykge1xuICAgIHRoaXMuc2tldGNoVmlld01vZGVsTGluZS51cGRhdGUoZ3JhcGhpY3MpO1xuICB9XG4gIF9kZWxldGVMaW5lKCkge1xuICAgIHRoaXMuc2tldGNoVmlld01vZGVsTGluZS5kZWxldGUoKTtcbiAgfVxuICBfY2FuY2VsTGluZSgpIHtcbiAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbExpbmUuY2FuY2VsKCk7XG4gIH1cbiAgX2R1cGxpY2F0ZUxpbmUoKSB7XG4gICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxMaW5lLmR1cGxpY2F0ZSgpO1xuICB9XG4gIC8vIHByaXZhdGUgX3VwZGF0ZUxpbmVPbkdyYXBoaWNDbGljayh1cGRhdGVPbkdyYXBoaWM6IGJvb2xlYW4pIHtcbiAgLy8gICB0aGlzLnNrZXRjaFZpZXdNb2RlbExpbmUudXBkYXRlT25HcmFwaGljQ2xpY2sgPSB1cGRhdGVPbkdyYXBoaWM7XG4gIC8vIH1cbiAgX2Rlc3Ryb3lMaW5lKCkge1xuICAgIHRoaXMuc2tldGNoVmlld01vZGVsTGluZS5kZXN0cm95KCk7XG4gIH1cbiAgLy8gcG9seWdvblxuICBnZXRQb2x5Z29uU1ZNKCkge1xuICAgIHJldHVybiB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvbHlnb247XG4gIH1cbiAgZ2V0UG9seWdvbigpIHtcbiAgICByZXR1cm4gdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2x5Z29uLnBvbHlnb25TeW1ib2w7XG4gIH1cbiAgc2V0UG9seWdvbihzeW1ib2wpIHtcbiAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvbHlnb24ucG9seWdvblN5bWJvbCA9IHN5bWJvbDtcbiAgfVxuICBjcmVhdGVQb2x5Z29uKHRvb2wpIHtcbiAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvbHlnb24uY3JlYXRlKHRvb2wpO1xuICB9XG4gIHVwZGF0ZVBvbHlnb24oZ3JhcGhpY3MpIHtcbiAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvbHlnb24udXBkYXRlKGdyYXBoaWNzKTtcbiAgfVxuICBfZGVsZXRlUG9seWdvbigpIHtcbiAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvbHlnb24uZGVsZXRlKCk7XG4gIH1cbiAgX2NhbmNlbFBvbHlnb24oKSB7XG4gICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2x5Z29uLmNhbmNlbCgpO1xuICB9XG4gIF9kdXBsaWNhdGVQb2x5Z29uKCkge1xuICAgIHRoaXMuc2tldGNoVmlld01vZGVsUG9seWdvbi5kdXBsaWNhdGUoKTtcbiAgfVxuICAvLyBwcml2YXRlIF91cGRhdGVQb2x5Z29uT25HcmFwaGljQ2xpY2sodXBkYXRlT25HcmFwaGljOiBib29sZWFuKSB7XG4gIC8vICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2x5Z29uLnVwZGF0ZU9uR3JhcGhpY0NsaWNrID0gdXBkYXRlT25HcmFwaGljO1xuICAvLyB9XG4gIF9kZXN0cm95UG9seWdvbigpIHtcbiAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvbHlnb24uZGVzdHJveSgpO1xuICB9XG4gIC8vIHRleHRcbiAgZ2V0VGV4dFNWTSgpIHtcbiAgICByZXR1cm4gdGhpcy5za2V0Y2hWaWV3TW9kZWxUZXh0O1xuICB9XG4gIGdldFRleHQoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2tldGNoVmlld01vZGVsVGV4dC5wb2ludFN5bWJvbDtcbiAgfVxuICBzZXRUZXh0KHN5bWJvbCkge1xuICAgIHRoaXMuc2tldGNoVmlld01vZGVsVGV4dC5wb2ludFN5bWJvbCA9IHN5bWJvbDtcbiAgfVxuICBjcmVhdGVUZXh0KCkge1xuICAgIHRoaXMuc2tldGNoVmlld01vZGVsVGV4dC5jcmVhdGUoXCJwb2ludFwiKTtcbiAgfVxuICB1cGRhdGVUZXh0KGdyYXBoaWNzKSB7XG4gICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxUZXh0LnVwZGF0ZShncmFwaGljcyk7XG4gIH1cbiAgX2RlbGV0ZVRleHQoKSB7XG4gICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxUZXh0LmRlbGV0ZSgpO1xuICB9XG4gIF9jYW5jZWxUZXh0KCkge1xuICAgIHRoaXMuc2tldGNoVmlld01vZGVsVGV4dC5jYW5jZWwoKTtcbiAgfVxuICBfZHVwbGljYXRlVGV4dCgpIHtcbiAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFRleHQuZHVwbGljYXRlKCk7XG4gIH1cbiAgLy8gcHJpdmF0ZSBfdXBkYXRlVGV4dE9uR3JhcGhpY0NsaWNrKHVwZGF0ZU9uR3JhcGhpYzogYm9vbGVhbikge1xuICAvLyAgIHRoaXMuc2tldGNoVmlld01vZGVsVGV4dC51cGRhdGVPbkdyYXBoaWNDbGljayA9IHVwZGF0ZU9uR3JhcGhpYztcbiAgLy8gfVxuICBfZGVzdHJveVRleHQoKSB7XG4gICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxUZXh0LmRlc3Ryb3koKTtcbiAgfVxufVxuXG5jb25zdCBhcmNnaXNTa2V0Y2hDc3MgPSBcIjpob3N0e2Rpc3BsYXk6ZmxleDtmbGV4OjEgMSBhdXRvO292ZXJmbG93OmhpZGRlbn0uc2tldGNoLWRlbGV0ZS1idXR0b257cGFkZGluZzp2YXIoLS1hcmNnaXMtYXBwLWNhcC1zcGFjaW5nLXRoaXJkKX0uc25hcHBpbmd7ZGlzcGxheTpmbGV4O3BhZGRpbmc6dmFyKC0tYXJjZ2lzLWFwcC1jYXAtc3BhY2luZy1oYWxmKTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWFyY2dpcy1hcHAtYmFja2dyb3VuZCl9LnNrZXRjaC1tZXNzYWdle3BhZGRpbmc6dmFyKC0tYXJjZ2lzLWFwcC1jYXAtc3BhY2luZy1oYWxmKX0uc2tldGNoLWtleWJvYXJkLWJ1dHRvbnttYXJnaW4tcmlnaHQ6MC4zZW19Lm11bHRpcGxlLXNlbGVjdGlvbnttYXJnaW46MS4zZW19Lm11bHRpcGxlLXNlbGVjdGlvbiBjYWxjaXRlLWJ1dHRvbnttYXJnaW4tdG9wOjAuM2VtfS5hcmNnaXMtLXJ0bCAuc2tldGNoLWtleWJvYXJkLWJ1dHRvbnttYXJnaW4tcmlnaHQ6dW5zZXQ7bWFyZ2luLWxlZnQ6MC4zZW19XCI7XG5cbmNvbnN0IEFyY2dpc1NrZXRjaCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5za2V0Y2hVcGRhdGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJza2V0Y2hVcGRhdGVkXCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzU2tldGNoRGlzbWlzc2VkQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTa2V0Y2hEaXNtaXNzZWRDaGFuZ2VcIiwgNyk7XG4gICAgdGhpcy5pbnRlcm5hbFNrZXRjaFVwZGF0ZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImludGVybmFsU2tldGNoVXBkYXRlZFwiLCA3KTtcbiAgICB0aGlzLmNsb3NlU2tldGNoUG9wb3ZlcnMgPSBjcmVhdGVFdmVudCh0aGlzLCBcImNsb3NlU2tldGNoUG9wb3ZlcnNcIiwgNyk7XG4gICAgdGhpcy5jbG9zZVBvcHVwUG9wb3ZlcnMgPSBjcmVhdGVFdmVudCh0aGlzLCBcImNsb3NlUG9wdXBQb3BvdmVyc1wiLCA3KTtcbiAgICB0aGlzLnNrZXRjaENvbnRlbnRSZVJlbmRlciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwic2tldGNoQ29udGVudFJlUmVuZGVyXCIsIDcpO1xuICAgIHRoaXMuZGlzYWJsZVNrZXRjaFBhbmVsID0gY3JlYXRlRXZlbnQodGhpcywgXCJkaXNhYmxlU2tldGNoUGFuZWxcIiwgNyk7XG4gICAgdGhpcy5jbG9zZVNrZXRjaFNuYXBwaW5nUG9wb3ZlcnMgPSBjcmVhdGVFdmVudCh0aGlzLCBcImNsb3NlU2tldGNoU25hcHBpbmdQb3BvdmVyc1wiLCA3KTtcbiAgICB0aGlzLnNrZXRjaEFjdGlvbk9uU2VsZWN0RmVhdHVyZXMgPSBjcmVhdGVFdmVudCh0aGlzLCBcInNrZXRjaEFjdGlvbk9uU2VsZWN0RmVhdHVyZXNcIiwgNyk7XG4gICAgdGhpcy5za2V0Y2hNb2RlID0gXCJ1cGRhdGVcIjtcbiAgICB0aGlzLmVzY0tleSA9IGZhbHNlO1xuICAgIHRoaXMua2VlcFNlbGVjdGlvbk1lc3NhZ2UgPSBcIlwiO1xuICAgIHRoaXMua2VlcFNlbGVjdGlvblRvb2wgPSBudWxsO1xuICAgIHRoaXMub25HcmFwaGljVXBkYXRlID0gKGV2ZW50KSA9PiB7XG4gICAgICB2YXIgX2EsIF9iO1xuICAgICAgaWYgKGV2ZW50LnN0YXRlID09PSBcInN0YXJ0XCIpIHtcbiAgICAgICAgdGhpcy5tYXBWaWV3LmNsb3NlUG9wdXAoKTtcbiAgICAgICAgaWYgKHRoaXMubXVsdGlwbGVTZWxlY3RlZEdyYXBoaWNzLmxlbmd0aCA8PSAxICYmIGV2ZW50LmdyYXBoaWNzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpYyA9IGV2ZW50LmdyYXBoaWNzWzBdO1xuICAgICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljXG4gICAgICAgICAgICAuc3ltYm9sO1xuICAgICAgICAgIC8vIGlmIG11bHRpcGxlU2VsZWN0ZWRHcmFwaGljcyBpcyAwLCBjb21pbmcgZnJvbSBzaW5nbGUgc2VsZWN0XG4gICAgICAgICAgIXRoaXMubXVsdGlwbGVTZWxlY3RlZEdyYXBoaWNzLmxlbmd0aCAmJlxuICAgICAgICAgICAgdGhpcy5tdWx0aXBsZVNlbGVjdGVkR3JhcGhpY3MucHVzaCh0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWMpO1xuICAgICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbCA9IHRoaXMuZ2V0R2VvbWV0cnlUeXBlRnJvbUdyYXBoaWModGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljKTtcbiAgICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnBvcHVwID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljLnBvcHVwVGVtcGxhdGU7XG4gICAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby50aXRsZSA9XG4gICAgICAgICAgICAoKF9iID0gKF9hID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuYXR0cmlidXRlcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnRpdGxlKSB8fCB0aGlzLmRlZmF1bHRHcmFwaGljVGl0bGUoKTtcbiAgICAgICAgICB0aGlzLnNrZXRjaENvbnRlbnRSZVJlbmRlci5lbWl0KCk7XG4gICAgICAgICAgdGhpcy5zaG93U2tldGNoQ29udGVudCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy5za2V0Y2hNZXNzYWdlSGFuZGxlcihudWxsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGV2ZW50LnN0YXRlID09PSBcImNvbXBsZXRlXCIpIHtcbiAgICAgICAgY29uc3QgeyBrZWVwU2VsZWN0aW9uVG9vbCB9ID0gdGhpcztcbiAgICAgICAgaWYgKCFrZWVwU2VsZWN0aW9uVG9vbCkge1xuICAgICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpYyA9IG51bGw7XG4gICAgICAgICAgdGhpcy5tdWx0aXBsZVNlbGVjdGVkR3JhcGhpY3MgPSBbXTtcbiAgICAgICAgICB0aGlzLmNsb3NlU2tldGNoUG9wb3ZlcnMuZW1pdCgpO1xuICAgICAgICAgIHRoaXMuaW50ZXJuYWxTa2V0Y2hVcGRhdGVkLmVtaXQoKTtcbiAgICAgICAgICB0aGlzLnNrZXRjaENvbnRlbnRSZVJlbmRlci5lbWl0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy5rZWVwU2VsZWN0VG9vbFNlbGVjdGlvbigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLm1hcFZpZXcgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sYXllciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmRpc21pc3NpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5zbmFwcGluZ1Nlc3Npb25TdG9yYWdlSWRzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2tldGNoVG9vbHRpcFNlc3Npb25TdG9yYWdlSWRzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubWFwTm90ZXNGZWF0dXJlID0gbnVsbDtcbiAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvID0ge1xuICAgICAgdG9vbDogbnVsbCxcbiAgICAgIHN5bWJvbDogbnVsbCxcbiAgICAgIGdyYXBoaWM6IG51bGwsXG4gICAgICBwb3B1cDogbnVsbCxcbiAgICAgIHRpdGxlOiBudWxsLFxuICAgICAgc291cmNlSWRzOiB7fVxuICAgIH07XG4gICAgdGhpcy5tdWx0aXBsZVNlbGVjdGVkR3JhcGhpY3MgPSBbXTtcbiAgICB0aGlzLnNob3dTa2V0Y2hDb250ZW50ID0gdHJ1ZTtcbiAgfVxuICAvLyBsaWZlY3ljbGUgbWV0aG9kc1xuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICBbdGhpcy5zdHJpbmdzLCB0aGlzLmN1cnJlbnRMYW5ndWFnZV0gPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgIGF3YWl0IHRoaXMubG9hZEFsbE1vZHVsZXMoKTtcbiAgICB0aGlzLnNuYXBwaW5nT3B0aW9ucyA9IGdldFNuYXBwaW5nT3B0aW9ucyh0aGlzLnNuYXBwaW5nU2Vzc2lvblN0b3JhZ2VJZHMsIHRoaXMubGF5ZXIsIHRoaXMubWFwVmlldywgdGhpcy5TbmFwcGluZ09wdGlvbnMpO1xuICAgIHRoaXMuc2tldGNoVG9vbHRpcE9wdGlvbnMgPSBnZXRTa2V0Y2hUb29sdGlwT3B0aW9ucyh0aGlzLnNrZXRjaFRvb2x0aXBTZXNzaW9uU3RvcmFnZUlkcywgdGhpcy5Ta2V0Y2hUb29sdGlwT3B0aW9ucyk7XG4gICAgdGhpcy5zdk1vZGVsID0gbmV3IFNWTW9kZWwodGhpcy5sYXllciwgdGhpcy5tYXBWaWV3LCB0aGlzLlNrZXRjaFZpZXdNb2RlbCwgdGhpcy5zbmFwcGluZ09wdGlvbnMsIHRoaXMuc2tldGNoVG9vbHRpcE9wdGlvbnMsIChldmVudCwgc2tldGNoVmlld01vZGVsKSA9PiB0aGlzLm9uR3JhcGhpY0NyZWF0ZShldmVudCwgc2tldGNoVmlld01vZGVsKSwgdGhpcy5vbkdyYXBoaWNVcGRhdGUpO1xuICAgIHNrZXRjaFN0YXRlLnN2TW9kZWwgPSB0aGlzLnN2TW9kZWw7XG4gICAgc2tldGNoU3RhdGUubWFwVmlldyA9IHRoaXMubWFwVmlldztcbiAgICBza2V0Y2hTdGF0ZS5sYXllciA9IHRoaXMubGF5ZXI7XG4gICAgc2tldGNoU3RhdGUucG9ydGFsID0gdGhpcy5wb3J0YWw7XG4gICAgc2tldGNoU3RhdGUuc3RyaW5ncyA9IHRoaXMuc3RyaW5ncztcbiAgICBza2V0Y2hTdGF0ZS5jdXJyZW50TGFuZ3VhZ2UgPSB0aGlzLmN1cnJlbnRMYW5ndWFnZTtcbiAgICBza2V0Y2hTdGF0ZS5zbmFwcGluZ09wdGlvbnMgPSB0aGlzLnNuYXBwaW5nT3B0aW9ucztcbiAgICBza2V0Y2hTdGF0ZS5za2V0Y2hUb29sdGlwT3B0aW9ucyA9IHRoaXMuc2tldGNoVG9vbHRpcE9wdGlvbnM7XG4gICAgc2tldGNoU3RhdGUuc25hcHBpbmdTZXNzaW9uU3RvcmFnZUlkcyA9IHRoaXMuc25hcHBpbmdTZXNzaW9uU3RvcmFnZUlkcztcbiAgICBza2V0Y2hTdGF0ZS5za2V0Y2hUb29sdGlwU2Vzc2lvblN0b3JhZ2VJZHMgPSB0aGlzLnNrZXRjaFRvb2x0aXBTZXNzaW9uU3RvcmFnZUlkcztcbiAgfVxuICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgIC8vIGZvciBtdWx0aXBsZSBzZWxlY3Rpb25cbiAgICB0aGlzLnNlbGVjdG9yLnZpZXcgPSB0aGlzLm1hcFZpZXc7XG4gICAgLy8gZGlzYWJsZSBwb3B1cCBpbiB0aGUgbWFwIHZpZXdcbiAgICB0aGlzLm1hcFZpZXcucG9wdXBFbmFibGVkID0gZmFsc2U7XG4gICAgLy8gc2tldGNoIHRvb2xzXG4gICAgdGhpcy5za2V0Y2hUb29sc0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1za2V0Y2gtdG9vbHNcIik7XG4gICAgdGhpcy5za2V0Y2hUb29sc0VsLnJlZkVsZW1lbnQgPSB0aGlzLmhvc3RFbGVtZW50O1xuICAgIGlmICh0aGlzLm1hcE5vdGVzRmVhdHVyZSkge1xuICAgICAgdGhpcy5za2V0Y2hUb29sc0VsLm1hcE5vdGVzRmVhdHVyZSA9IHRoaXMubWFwTm90ZXNGZWF0dXJlO1xuICAgIH1cbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuc2tldGNoVG9vbHNFbCk7XG4gIH1cbiAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgdGhpcy53YXRjaEVzY2FwZU9uTWFwVmlldyhmYWxzZSk7XG4gICAgdGhpcy5zdk1vZGVsLnVwZGF0ZU9uR3JhcGhpYyhmYWxzZSk7XG4gICAgdGhpcy5yZW1vdmVTa2V0Y2hTaG9ydGN1dHMoKTtcbiAgfVxuICAvLyBFdmVudHNcbiAgY2xvc2VTa2V0Y2hQb3BvdmVyc0hhbmRsZXIoKSB7XG4gICAgdGhpcy5jbG9zZVBvcHVwUG9wb3ZlcnMuZW1pdCgpO1xuICAgIHRoaXMuc2tldGNoTWVzc2FnZUhhbmRsZXIobnVsbCk7XG4gICAgdGhpcy5zaG93U2tldGNoQ29udGVudCA9IGZhbHNlO1xuICAgIHRoaXMuY2xvc2VTa2V0Y2hTbmFwcGluZ1BvcG92ZXJzLmVtaXQoKTtcbiAgICB0aGlzLnJlbW92ZVNrZXRjaFNob3J0Y3V0cygpO1xuICAgIHRoaXMuc2V0Rm9jdXMoKTtcbiAgfVxuICBjbG9zZVNrZXRjaFNuYXBwaW5nUG9wb3ZlcnNIYW5kbGVyKCkge1xuICAgIGlmICh0aGlzLnNrZXRjaFNuYXBwaW5nRWwpIHtcbiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5za2V0Y2hTbmFwcGluZ0VsKTtcbiAgICAgIHRoaXMuc2tldGNoU25hcHBpbmdFbCA9IG51bGw7XG4gICAgICB0aGlzLmRpc2FibGVTa2V0Y2hQYW5lbC5lbWl0KGZhbHNlKTtcbiAgICB9XG4gICAgdGhpcy5zZXRGb2N1cygpO1xuICB9XG4gIGRpc2FibGVTa2V0Y2hQYW5lbEhhbmRsZXIoZXZlbnQpIHtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLnNrZXRjaEZsb3dJdGVtRWwuZGlzYWJsZWQgPSBldmVudC5kZXRhaWw7XG4gIH1cbiAgaW50ZXJuYWxTa2V0Y2hVcGRhdGVkSGFuZGxlcihldmVudCkge1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIHRoaXMuc2tldGNoVXBkYXRlZC5lbWl0KCk7XG4gIH1cbiAgc2tldGNoR3JhcGhpY1VwZGF0ZXNIYW5kbGVyKGV2ZW50KSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBjb25zdCBncmFwaGljVXBkYXRlcyA9IGV2ZW50LmRldGFpbDtcbiAgICBpZiAoZ3JhcGhpY1VwZGF0ZXMudXBkYXRlKSB7XG4gICAgICBpZiAodGhpcy5za2V0Y2hNb2RlID09PSBcInVwZGF0ZVwiKSB7XG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWMpIHtcbiAgICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWMuc3ltYm9sID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2w7XG4gICAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljLnBvcHVwVGVtcGxhdGUgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnBvcHVwO1xuICAgICAgICAgIGlmICgoX2EgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWMuYXR0cmlidXRlcy50aXRsZSA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8udGl0bGU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljLmF0dHJpYnV0ZXMgPSB7XG4gICAgICAgICAgICAgIHRpdGxlOiB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRpdGxlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGlmICh0aGlzLnRlbXBDcmVhdGVkR3JhcGhpYykge1xuICAgICAgICAgIHRoaXMudGVtcENyZWF0ZWRHcmFwaGljLnN5bWJvbCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sO1xuICAgICAgICAgIHRoaXMudGVtcENyZWF0ZWRHcmFwaGljLnBvcHVwVGVtcGxhdGUgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnBvcHVwO1xuICAgICAgICAgIGlmICgoX2IgPSB0aGlzLnRlbXBDcmVhdGVkR3JhcGhpYykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgIHRoaXMudGVtcENyZWF0ZWRHcmFwaGljLmF0dHJpYnV0ZXMudGl0bGUgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRpdGxlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudGVtcENyZWF0ZWRHcmFwaGljLmF0dHJpYnV0ZXMgPSB7XG4gICAgICAgICAgICAgIHRpdGxlOiB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRpdGxlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jdXJyZW50U2tldGNoSW5mby50b29sID09PSBcInBvaW50XCIpIHtcbiAgICAgICAgICB0aGlzLnN2TW9kZWwuc2V0UG9pbnQodGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbCA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICB0aGlzLnN2TW9kZWwuc2V0VGV4dCh0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5jdXJyZW50U2tldGNoSW5mby50b29sID09PSBcInBvbHlsaW5lXCIpIHtcbiAgICAgICAgICB0aGlzLnN2TW9kZWwuc2V0TGluZSh0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoW1wiY2lyY2xlXCIsIFwicG9seWdvblwiLCBcInJlY3RhbmdsZVwiXS5pbmRleE9mKHRoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbCkgPiAtMSkge1xuICAgICAgICAgIHRoaXMuc3ZNb2RlbC5zZXRQb2x5Z29uKHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gdG8gcmVmcmVzaCBwb3B1cFxuICAgICAgdGhpcy5tYXBWaWV3LnBvcHVwLmZlYXR1cmVzID0gW3RoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY107XG4gICAgfVxuICAgIGlmIChncmFwaGljVXBkYXRlcy5jbG9zZSkge1xuICAgICAgdGhpcy5jbGVhckhpZ2hsaWdodEFuZFBvcHVwKCk7XG4gICAgICB0aGlzLmNsb3NlU2tldGNoUG9wb3ZlcnMuZW1pdCgpO1xuICAgICAgdGhpcy5zdk1vZGVsLmNhbmNlbCgpO1xuICAgICAgdGhpcy5zdk1vZGVsLnVwZGF0ZU9uR3JhcGhpYyhmYWxzZSk7XG4gICAgICB0aGlzLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIHRoaXMuaW50ZXJuYWxTa2V0Y2hVcGRhdGVkLmVtaXQoKTtcbiAgfVxuICBhc3luYyBza2V0Y2hBY3Rpb25PbkRyYXdGZWF0dXJlc0hhbmRsZXIoeyBkZXRhaWw6IHsgdG9vbCwgc2tldGNoTWVzc2FnZSB9IH0pIHtcbiAgICB0aGlzLmNsZWFySGlnaGxpZ2h0QW5kUG9wdXAoKTtcbiAgICB0aGlzLndhdGNoRXNjYXBlT25NYXBWaWV3KHRydWUpO1xuICAgIC8vIGNsb3NlIHBvcG92ZXIgdG8gcmVzZXQgd2hlbiBtb3ZpbmcgZnJvbSB1cGRhdGUgdG8gY29udGludW91cyBtb2RlXG4gICAgaWYgKHRoaXMuc2tldGNoTW9kZSA9PT0gXCJ1cGRhdGVcIikge1xuICAgICAgdGhpcy5jbG9zZVNrZXRjaFBvcG92ZXJzLmVtaXQoKTtcbiAgICB9XG4gICAgdGhpcy5za2V0Y2hNZXNzYWdlSGFuZGxlcihza2V0Y2hNZXNzYWdlKTtcbiAgICB0aGlzLnNrZXRjaE1vZGUgPSBcImNvbnRpbnVvdXNcIjtcbiAgICB0aGlzLnN2TW9kZWwuY2FuY2VsKCk7XG4gICAgdGhpcy5zdk1vZGVsLnVwZGF0ZU9uR3JhcGhpYyhmYWxzZSk7XG4gICAgdGhpcy50ZW1wQ3JlYXRlZEdyYXBoaWMgPSBudWxsO1xuICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpYyA9IG51bGw7XG4gICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby50b29sID0gdG9vbDtcbiAgICBzd2l0Y2ggKHRvb2wpIHtcbiAgICAgIGNhc2UgXCJwb2ludFwiOlxuICAgICAgICB0aGlzLnN2TW9kZWwuc2V0UG9pbnQoKGF3YWl0IGRlZmF1bHRDaW1TeW1ib2wodGhpcy5DSU1TeW1ib2wsIHRoaXMubWFwVmlldywgdGhpcy5Db2xvclV0aWxzKSkpO1xuICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCA9IHRoaXMuc3ZNb2RlbC5nZXRQb2ludCgpO1xuICAgICAgICB0aGlzLnN2TW9kZWwuY3JlYXRlUG9pbnQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwicG9seWxpbmVcIjpcbiAgICAgICAgdGhpcy5zdk1vZGVsLnNldExpbmUoYXdhaXQgZGVmYXVsdExpbmVTeW1ib2wodGhpcy5tYXBWaWV3LCB0aGlzLkNvbG9yVXRpbHMpKTtcbiAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wgPSB0aGlzLnN2TW9kZWwuZ2V0TGluZSgpO1xuICAgICAgICB0aGlzLnN2TW9kZWwuY3JlYXRlTGluZSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJwb2x5Z29uXCI6XG4gICAgICBjYXNlIFwicmVjdGFuZ2xlXCI6XG4gICAgICBjYXNlIFwiY2lyY2xlXCI6XG4gICAgICAgIHRoaXMuc3ZNb2RlbC5zZXRQb2x5Z29uKGF3YWl0IGRlZmF1bHRQb2x5Z29uU3ltYm9sKHRoaXMubWFwVmlldywgdGhpcy5Db2xvclV0aWxzKSk7XG4gICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sID0gdGhpcy5zdk1vZGVsLmdldFBvbHlnb24oKTtcbiAgICAgICAgdGhpcy5zdk1vZGVsLmNyZWF0ZVBvbHlnb24odG9vbCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInRleHRcIjpcbiAgICAgICAgdGhpcy5zdk1vZGVsLnNldFRleHQoKGF3YWl0IGRlZmF1bHRUZXh0U3ltYm9sKHRoaXMubWFwVmlldywgdGhpcy5Db2xvclV0aWxzLCB0aGlzLlRleHRTeW1ib2wsIHRoaXMuc3RyaW5ncy50ZXh0KSkpO1xuICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCA9IHRoaXMuc3ZNb2RlbC5nZXRUZXh0KCk7XG4gICAgICAgIHRoaXMuc3ZNb2RlbC5jcmVhdGVUZXh0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnBvcHVwID0gbnVsbDtcbiAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRpdGxlID0gdGhpcy5kZWZhdWx0R3JhcGhpY1RpdGxlKCk7XG4gICAgdGhpcy5za2V0Y2hDb250ZW50UmVSZW5kZXIuZW1pdCgpO1xuICAgIHRoaXMuc2hvd1NrZXRjaENvbnRlbnQgPSB0cnVlO1xuICB9XG4gIGFzeW5jIHNrZXRjaEFjdGlvbk9uU2VsZWN0RmVhdHVyZXNIYW5kbGVyKHsgZGV0YWlsOiB7IHNrZXRjaE1lc3NhZ2UsIG11bHRpcGxlU2VsZWN0VG9vbCB9IH0pIHtcbiAgICB2YXIgX2E7XG4gICAgdGhpcy5rZWVwU2VsZWN0aW9uTWVzc2FnZSA9IHNrZXRjaE1lc3NhZ2U7XG4gICAgdGhpcy5rZWVwU2VsZWN0aW9uVG9vbCA9IG11bHRpcGxlU2VsZWN0VG9vbDtcbiAgICB0aGlzLmNsZWFySGlnaGxpZ2h0QW5kUG9wdXAoKTtcbiAgICB0aGlzLndhdGNoRXNjYXBlT25NYXBWaWV3KGZhbHNlKTtcbiAgICB0aGlzLmNsb3NlU2tldGNoUG9wb3ZlcnMuZW1pdCgpO1xuICAgIHRoaXMudGVtcENyZWF0ZWRHcmFwaGljID0gbnVsbDtcbiAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWMgPSBudWxsO1xuICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sID0gbnVsbDtcbiAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRvb2wgPSBudWxsO1xuICAgIHRoaXMubXVsdGlwbGVTZWxlY3RlZEdyYXBoaWNzID0gW107XG4gICAgLy90aGlzLnN2TW9kZWwuY2FuY2VsKCk7XG4gICAgdGhpcy5za2V0Y2hNb2RlID0gXCJ1cGRhdGVcIjtcbiAgICB0aGlzLnNrZXRjaE1lc3NhZ2VIYW5kbGVyKHRoaXMua2VlcFNlbGVjdGlvbk1lc3NhZ2UpO1xuICAgIHRoaXMuc2tldGNoQ29udGVudFJlUmVuZGVyLmVtaXQoKTtcbiAgICBpZiAodGhpcy5rZWVwU2VsZWN0aW9uVG9vbCkge1xuICAgICAgdGhpcy5hY3Rpb25Pbk11bHRpcGxlU2VsZWN0aW9ucyh0aGlzLmtlZXBTZWxlY3Rpb25Ub29sKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAoX2EgPSB0aGlzLnNlbGVjdG9yT3BlcmF0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2FuY2VsKCk7XG4gICAgICB0aGlzLnN2TW9kZWwudXBkYXRlT25HcmFwaGljKHRydWUpO1xuICAgIH1cbiAgfVxuICBhcmNnaXNTa2V0Y2hQYW5lbExvYWRlckhhbmRsZXIoZXZlbnQpIHtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLnNrZXRjaEZsb3dJdGVtRWwubG9hZGluZyA9IGV2ZW50LmRldGFpbDtcbiAgfVxuICAvLyBQdWJsaWMgTWV0aG9kc1xuICBhc3luYyBkb25lKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgdGhpcy5yZW1vdmVIaWdobGlnaHQoKTtcbiAgICBpZiAoKF9hID0gdGhpcy5zbmFwcGluZ1Nlc3Npb25TdG9yYWdlSWRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY3VycmVudCkge1xuICAgICAgc2F2ZVNuYXBwaW5nVG9TdG9yYWdlKHRoaXMuc25hcHBpbmdPcHRpb25zLCB0aGlzLnNuYXBwaW5nU2Vzc2lvblN0b3JhZ2VJZHMuY3VycmVudCk7XG4gICAgfVxuICAgIGlmICgoX2IgPSB0aGlzLnNrZXRjaFRvb2x0aXBTZXNzaW9uU3RvcmFnZUlkcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmN1cnJlbnQpIHtcbiAgICAgIHNhdmVTa2V0Y2hUb29sdGlwVG9TdG9yYWdlKHRoaXMuc2tldGNoVG9vbHRpcE9wdGlvbnMsIHRoaXMuc2tldGNoVG9vbHRpcFNlc3Npb25TdG9yYWdlSWRzLmN1cnJlbnQpO1xuICAgIH1cbiAgICB0aGlzLmNsb3NlU2tldGNoUG9wb3ZlcnMuZW1pdCgpO1xuICAgIHRoaXMuc3ZNb2RlbC5kZXN0cm95KCk7XG4gICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLnNrZXRjaFRvb2xzRWwpO1xuICAgIHRoaXMucmVtb3ZlU2tldGNoU2hvcnRjdXRzKCk7XG4gICAgLy8gZW5hYmxlIHBvcHVwIGluIHRoZSBtYXAgdmlld1xuICAgIHRoaXMubWFwVmlldy5wb3B1cEVuYWJsZWQgPSB0cnVlO1xuICB9XG4gIGFzeW5jIHNldEZvY3VzKGZvY3VzSWQpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKGZvY3VzSWQgPT09IFwiZGlzbWlzcy1idXR0b25cIikge1xuICAgICAgKF9hID0gdGhpcy5kaXNtaXNzQnV0dG9uRWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICAvLyBwcml2YXRlIG1ldGhvZHNcbiAgYXN5bmMgbG9hZEFsbE1vZHVsZXMoKSB7XG4gICAgW1xuICAgICAgdGhpcy5Ta2V0Y2hWaWV3TW9kZWwsXG4gICAgICB0aGlzLlRleHRTeW1ib2wsXG4gICAgICB0aGlzLkNvbG9yVXRpbHMsXG4gICAgICB0aGlzLkNJTVN5bWJvbCxcbiAgICAgIHRoaXMuU25hcHBpbmdPcHRpb25zLFxuICAgICAgdGhpcy5Ta2V0Y2hUb29sdGlwT3B0aW9uc1xuICAgIF0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXG4gICAgICBcImVzcmkvd2lkZ2V0cy9Ta2V0Y2gvU2tldGNoVmlld01vZGVsXCIsXG4gICAgICBcImVzcmkvc3ltYm9scy9UZXh0U3ltYm9sXCIsXG4gICAgICBcImVzcmkvdmlld3Mvc3VwcG9ydC9jb2xvclV0aWxzXCIsXG4gICAgICBcImVzcmkvc3ltYm9scy9DSU1TeW1ib2xcIixcbiAgICAgIFwiZXNyaS92aWV3cy9pbnRlcmFjdGl2ZS9zbmFwcGluZy9TbmFwcGluZ09wdGlvbnNcIixcbiAgICAgIFwiZXNyaS92aWV3cy9pbnRlcmFjdGl2ZS9za2V0Y2gvU2tldGNoVG9vbHRpcE9wdGlvbnNcIlxuICAgIF0pO1xuICAgIGNvbnN0IFtTZWxlY3RvcjJEXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvd2lkZ2V0cy9zdXBwb3J0L1NlbGVjdG9yMkRcIl0pO1xuICAgIHRoaXMuc2VsZWN0b3IgPSBuZXcgU2VsZWN0b3IyRCgpO1xuICB9XG4gIHJlbW92ZVNrZXRjaFNob3J0Y3V0cygpIHtcbiAgICBpZiAodGhpcy5hcmNnaXNTa2V0Y2hTaG9ydGN1dHMpIHtcbiAgICAgIHRoaXMuYXJjZ2lzU2tldGNoU2hvcnRjdXRzLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTa2V0Y2hTaG9ydGN1dHNEaXNtaXNzZWRDaGFuZ2VcIiwgKCkgPT4gdGhpcy5yZW1vdmVTa2V0Y2hTaG9ydGN1dHMoKSk7XG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuYXJjZ2lzU2tldGNoU2hvcnRjdXRzKTtcbiAgICAgIHRoaXMuYXJjZ2lzU2tldGNoU2hvcnRjdXRzID0gbnVsbDtcbiAgICB9XG4gIH1cbiAgb25HcmFwaGljQ3JlYXRlKGV2ZW50LCBza2V0Y2hWaWV3TW9kZWwpIHtcbiAgICBpZiAoZXZlbnQuc3RhdGUgPT09IFwic3RhcnRcIikge1xuICAgICAgdGhpcy50ZW1wQ3JlYXRlZEdyYXBoaWMgPSBudWxsO1xuICAgICAgdGhpcy5yZW1vdmVIaWdobGlnaHQoKTtcbiAgICB9XG4gICAgaWYgKGV2ZW50LnN0YXRlID09PSBcImNhbmNlbFwiICYmIHRoaXMuZXNjS2V5KSB7XG4gICAgICB0aGlzLmVzY0tleSA9IGZhbHNlO1xuICAgICAgY29uc3QgdG9vbCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbCA9PT0gXCJ0ZXh0XCIgPyBcInBvaW50XCIgOiB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRvb2w7XG4gICAgICBza2V0Y2hWaWV3TW9kZWwuY3JlYXRlKHRvb2wpO1xuICAgIH1cbiAgICBpZiAoZXZlbnQuc3RhdGUgPT09IFwiY29tcGxldGVcIikge1xuICAgICAgdGhpcy5pbnRlcm5hbFNrZXRjaFVwZGF0ZWQuZW1pdCgpO1xuICAgICAgaWYgKGV2ZW50LmdyYXBoaWMpIHtcbiAgICAgICAgZXZlbnQuZ3JhcGhpYy5wb3B1cFRlbXBsYXRlID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5wb3B1cDtcbiAgICAgICAgZXZlbnQuZ3JhcGhpYy5hdHRyaWJ1dGVzID0ge1xuICAgICAgICAgIHRpdGxlOiB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRpdGxlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudGVtcENyZWF0ZWRHcmFwaGljID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljID0gZXZlbnQuZ3JhcGhpYztcbiAgICAgICAgdGhpcy5oaWdobGlnaHRHcmFwaGljKGV2ZW50LmdyYXBoaWMpO1xuICAgICAgfVxuICAgICAgY29uc3QgdG9vbCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbCA9PT0gXCJ0ZXh0XCIgPyBcInBvaW50XCIgOiB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRvb2w7XG4gICAgICBza2V0Y2hWaWV3TW9kZWwuY3JlYXRlKHRvb2wpO1xuICAgIH1cbiAgfVxuICB3YXRjaEVzY2FwZU9uTWFwVmlldyh3YXRjaCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAod2F0Y2gpIHtcbiAgICAgIHRoaXMud2F0Y2hFc2NhcGVIYW5kbGUgPSB0aGlzLm1hcFZpZXcub24oXCJrZXktZG93blwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIiAmJlxuICAgICAgICAgICh0aGlzLnN2TW9kZWwuZ2V0UG9pbnRTVk0oKS5zdGF0ZSA9PT0gXCJhY3RpdmVcIiB8fFxuICAgICAgICAgICAgdGhpcy5zdk1vZGVsLmdldExpbmVTVk0oKS5zdGF0ZSA9PT0gXCJhY3RpdmVcIiB8fFxuICAgICAgICAgICAgdGhpcy5zdk1vZGVsLmdldFBvbHlnb25TVk0oKS5zdGF0ZSA9PT0gXCJhY3RpdmVcIiB8fFxuICAgICAgICAgICAgdGhpcy5zdk1vZGVsLmdldFRleHRTVk0oKS5zdGF0ZSA9PT0gXCJhY3RpdmVcIikpIHtcbiAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICB0aGlzLmVzY0tleSA9IHRydWU7XG4gICAgICAgICAgdGhpcy5zdk1vZGVsLmNhbmNlbCgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAoX2EgPSB0aGlzLndhdGNoRXNjYXBlSGFuZGxlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVtb3ZlKCk7XG4gICAgfVxuICB9XG4gIGRlZmF1bHRHcmFwaGljVGl0bGUoKSB7XG4gICAgc3dpdGNoICh0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRvb2wpIHtcbiAgICAgIGNhc2UgXCJwb2ludFwiOlxuICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdzLnBvaW50O1xuICAgICAgY2FzZSBcInBvbHlsaW5lXCI6XG4gICAgICAgIHJldHVybiB0aGlzLnN0cmluZ3MubGluZTtcbiAgICAgIGNhc2UgXCJwb2x5Z29uXCI6XG4gICAgICAgIHJldHVybiB0aGlzLnN0cmluZ3MucG9seWdvbjtcbiAgICAgIGNhc2UgXCJyZWN0YW5nbGVcIjpcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RyaW5ncy5yZWN0YW5nbGU7XG4gICAgICBjYXNlIFwiY2lyY2xlXCI6XG4gICAgICAgIHJldHVybiB0aGlzLnN0cmluZ3MuY2lyY2xlO1xuICAgICAgY2FzZSBcInRleHRcIjpcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RyaW5ncy50ZXh0O1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RyaW5ncy5wb2ludDtcbiAgICB9XG4gIH1cbiAgLy8gZm9yIHNlbGVjdGlvbiBtb2RlXG4gIGdldEdlb21ldHJ5VHlwZUZyb21HcmFwaGljKGN1cnJHcmFwaGljKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBzd2l0Y2ggKChfYSA9IGN1cnJHcmFwaGljID09PSBudWxsIHx8IGN1cnJHcmFwaGljID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjdXJyR3JhcGhpYy5nZW9tZXRyeSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnR5cGUpIHtcbiAgICAgIGNhc2UgXCJwb2ludFwiOlxuICAgICAgICBpZiAoKChfYiA9IGN1cnJHcmFwaGljID09PSBudWxsIHx8IGN1cnJHcmFwaGljID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjdXJyR3JhcGhpYy5zeW1ib2wpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50eXBlKSA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICByZXR1cm4gXCJ0ZXh0XCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIFwicG9pbnRcIjtcbiAgICAgICAgfVxuICAgICAgY2FzZSBcInBvbHlsaW5lXCI6XG4gICAgICAgIHJldHVybiBcInBvbHlsaW5lXCI7XG4gICAgICBjYXNlIFwicG9seWdvblwiOlxuICAgICAgICByZXR1cm4gXCJwb2x5Z29uXCI7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gXCJwb2x5Z29uXCI7XG4gICAgfVxuICB9XG4gIGNsZWFySGlnaGxpZ2h0QW5kUG9wdXAoKSB7XG4gICAgdGhpcy5yZW1vdmVIaWdobGlnaHQoKTtcbiAgICB0aGlzLm1hcFZpZXcuY2xvc2VQb3B1cCgpO1xuICB9XG4gIGFjdGlvbk9uTXVsdGlwbGVTZWxlY3Rpb25zKG11bHRpcGxlU2VsZWN0VG9vbCkge1xuICAgIHRoaXMuc2VsZWN0b3Iuc291cmNlcyA9IFtcbiAgICAgIHRoaXMubGF5ZXIucG9pbnRMYXllcixcbiAgICAgIHRoaXMubGF5ZXIucG9seWxpbmVMYXllcixcbiAgICAgIHRoaXMubGF5ZXIucG9seWdvbkxheWVyLFxuICAgICAgdGhpcy5sYXllci50ZXh0TGF5ZXJcbiAgICBdO1xuICAgIGNvbnN0IGRyYXdPYmplY3QgPSBtdWx0aXBsZVNlbGVjdFRvb2wgPT09IFwicmVjdGFuZ2xlXCJcbiAgICAgID8ge1xuICAgICAgICBjcmVhdGVUb29sOiBcInJlY3RhbmdsZVwiXG4gICAgICB9XG4gICAgICA6IHtcbiAgICAgICAgY3JlYXRlVG9vbDogXCJwb2x5Z29uXCIsXG4gICAgICAgIGNyZWF0ZU9wdGlvbnM6IHtcbiAgICAgICAgICBtb2RlOiBcImZyZWVoYW5kXCJcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICBjb25zdCBvcGVyYXRpb24gPSAodGhpcy5zZWxlY3Rvck9wZXJhdGlvbiA9IHRoaXMuc2VsZWN0b3IuZHJhdyh7XG4gICAgICBvcGVyYXRpb25PcHRpb25zOiBkcmF3T2JqZWN0XG4gICAgfSkpO1xuICAgIG9wZXJhdGlvbi5vbmNlKFwiY29tcGxldGVcIiwgKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCB7IHNlbGVjdGlvbiB9ID0gZXZlbnQ7XG4gICAgICAvL3RoaXMuc2tldGNoTWVzc2FnZUhhbmRsZXIobnVsbCk7XG4gICAgICB0aGlzLmNsZWFySGlnaGxpZ2h0QW5kUG9wdXAoKTtcbiAgICAgIGlmICghZXZlbnQuYWJvcnRlZCAmJiBzZWxlY3Rpb24ubGVuZ3RoKSB7XG4gICAgICAgIGxldCB0ZW1wUG9pbnQgPSBbXTtcbiAgICAgICAgbGV0IHRlbXBMaW5lID0gW107XG4gICAgICAgIGxldCB0ZW1wUG9seWdvbiA9IFtdO1xuICAgICAgICBsZXQgdGVtcFRleHQgPSBbXTtcbiAgICAgICAgc2VsZWN0aW9uLmZvckVhY2goKGN1cnJHcmFwaGljKSA9PiB7XG4gICAgICAgICAgc3dpdGNoICh0aGlzLmdldEdlb21ldHJ5VHlwZUZyb21HcmFwaGljKGN1cnJHcmFwaGljKSkge1xuICAgICAgICAgICAgY2FzZSBcInBvaW50XCI6XG4gICAgICAgICAgICAgIHRlbXBQb2ludCA9IFsuLi50ZW1wUG9pbnQsIGN1cnJHcmFwaGljXTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwicG9seWxpbmVcIjpcbiAgICAgICAgICAgICAgdGVtcExpbmUgPSBbLi4udGVtcExpbmUsIGN1cnJHcmFwaGljXTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwicG9seWdvblwiOlxuICAgICAgICAgICAgICB0ZW1wUG9seWdvbiA9IFsuLi50ZW1wUG9seWdvbiwgY3VyckdyYXBoaWNdO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ0ZXh0XCI6XG4gICAgICAgICAgICAgIHRlbXBUZXh0ID0gWy4uLnRlbXBUZXh0LCBjdXJyR3JhcGhpY107XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgdGVtcFBvaW50ID0gWy4uLnRlbXBQb2ludCwgY3VyckdyYXBoaWNdO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLm11bHRpcGxlU2VsZWN0ZWRHcmFwaGljcyA9IFsuLi50ZW1wUG9pbnQsIC4uLnRlbXBMaW5lLCAuLi50ZW1wUG9seWdvbiwgLi4udGVtcFRleHRdO1xuICAgICAgICB0ZW1wUG9pbnQubGVuZ3RoICYmIHRoaXMuc3ZNb2RlbC51cGRhdGVQb2ludCh0ZW1wUG9pbnQpO1xuICAgICAgICB0ZW1wTGluZS5sZW5ndGggJiYgdGhpcy5zdk1vZGVsLnVwZGF0ZUxpbmUodGVtcExpbmUpO1xuICAgICAgICB0ZW1wUG9seWdvbi5sZW5ndGggJiYgdGhpcy5zdk1vZGVsLnVwZGF0ZVBvbHlnb24odGVtcFBvbHlnb24pO1xuICAgICAgICB0ZW1wVGV4dC5sZW5ndGggJiYgdGhpcy5zdk1vZGVsLnVwZGF0ZVRleHQodGVtcFRleHQpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuc3ZNb2RlbC51cGRhdGVPbkdyYXBoaWMoZmFsc2UpO1xuICB9XG4gIHNrZXRjaE1lc3NhZ2VIYW5kbGVyKG1lc3NhZ2UpIHtcbiAgICBza2V0Y2hTdGF0ZS5za2V0Y2hNZXNzYWdlID0gbWVzc2FnZTtcbiAgfVxuICBoaWdobGlnaHRHcmFwaGljKGdyYXBoaWMpIHtcbiAgICB2YXIgX2E7XG4gICAgdGhpcy5yZW1vdmVIaWdobGlnaHQoKTtcbiAgICBjb25zdCBtYXRjaCA9IChfYSA9IHRoaXMubWFwVmlldy5hbGxMYXllclZpZXdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaXRlbXMuZmluZCgoeyBsYXllciB9KSA9PiBsYXllciA9PT0gdGhpcy5sYXllcik7XG4gICAgdGhpcy50ZW1wSGlnaGxpZ2h0SGFuZGxlID0gbWF0Y2ggPT09IG51bGwgfHwgbWF0Y2ggPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hdGNoLmhpZ2hsaWdodChncmFwaGljKTtcbiAgfVxuICByZW1vdmVIaWdobGlnaHQoKSB7XG4gICAgdmFyIF9hO1xuICAgIChfYSA9IHRoaXMudGVtcEhpZ2hsaWdodEhhbmRsZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlbW92ZSgpO1xuICB9XG4gIC8vIGZvciB3b3JrZmxvd3Mgd2hlcmUgd2Ugd2FudCB0aGUgY3VycmVudCBzZWxlY3QgdG9vbHMgdG8gc3RheSBhY3RpdmF0ZWRcbiAga2VlcFNlbGVjdFRvb2xTZWxlY3Rpb24oKSB7XG4gICAgdGhpcy5za2V0Y2hBY3Rpb25PblNlbGVjdEZlYXR1cmVzLmVtaXQoe1xuICAgICAgc2tldGNoTWVzc2FnZTogdGhpcy5rZWVwU2VsZWN0aW9uTWVzc2FnZSxcbiAgICAgIG11bHRpcGxlU2VsZWN0VG9vbDogdGhpcy5rZWVwU2VsZWN0aW9uVG9vbFxuICAgIH0pO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCBkaXNtaXNzQnV0dG9uID0gKGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHRleHQ6IFwiY2xvc2VcIiwgc2NhbGU6IFwibVwiLCBpY29uOiBcInhcIiwgc2xvdDogXCJoZWFkZXItYWN0aW9ucy1lbmRcIiwgcmVmOiAoZWwpID0+ICh0aGlzLmRpc21pc3NCdXR0b25FbCA9IGVsKSwgb25DbGljazogKGV2ZW50KSA9PiB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLnNrZXRjaE1lc3NhZ2VIYW5kbGVyKG51bGwpO1xuICAgICAgICB0aGlzLnN2TW9kZWwuY2FuY2VsKCk7XG4gICAgICAgIHRoaXMuY2xlYXJIaWdobGlnaHRBbmRQb3B1cCgpO1xuICAgICAgICB0aGlzLmFyY2dpc1NrZXRjaERpc21pc3NlZENoYW5nZS5lbWl0KCk7XG4gICAgICB9IH0pKTtcbiAgICBjb25zdCBzZWxlY3Rpb25NdWx0aXBsZUxhYmVsID0gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgYWxpZ25tZW50OiBcImNlbnRlclwiLCBmb3I6IFwibXVsdGlwbGUtc2VsZWN0aW9uLWJ1dHRvbnNcIiB9LCB0aGlzLm11bHRpcGxlU2VsZWN0ZWRHcmFwaGljcy5sZW5ndGggPD0gMVxuICAgICAgPyB0aGlzLnN0cmluZ3Muc2luZ2xlRmVhdHVyZVNlbGVjdGVkXG4gICAgICA6IHRoaXMuc3RyaW5ncy5mZWF0dXJlc1NlbGVjdGVkLnJlcGxhY2UoXCIke251bWJlcn1cIiwgdGhpcy5tdWx0aXBsZVNlbGVjdGVkR3JhcGhpY3MubGVuZ3RoLnRvU3RyaW5nKCkpKSk7XG4gICAgY29uc3QgZGVsZXRlTXVsdGlwbGUgPSAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgYWxpZ25tZW50OiBcImNlbnRlclwiLCBpY29uU3RhcnQ6IFwidHJhc2hcIiwga2luZDogXCJkYW5nZXJcIiwgd2lkdGg6IFwiZnVsbFwiLCBvbkNsaWNrOiAoZXZlbnQpID0+IHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIC8vIHN2bSBrbm93cyB3aGF0J3Mgc2VsZWN0ZWQsIGFuZCB3aWxsIGRlbGV0ZSBhY2NvcmRpbmdseVxuICAgICAgICB0aGlzLnN2TW9kZWwuZGVsZXRlKCk7XG4gICAgICAgIHRoaXMubXVsdGlwbGVTZWxlY3RlZEdyYXBoaWNzID0gW107XG4gICAgICAgIHRoaXMua2VlcFNlbGVjdFRvb2xTZWxlY3Rpb24oKTtcbiAgICAgIH0gfSwgdGhpcy5zdHJpbmdzLmRlbGV0ZSkpO1xuICAgIGNvbnN0IGR1cGxpY2F0ZU11bHRpcGxlID0gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGFsaWdubWVudDogXCJjZW50ZXJcIiwgaWNvblN0YXJ0OiBcImNvcHlcIiwga2luZDogXCJuZXV0cmFsXCIsIHdpZHRoOiBcImZ1bGxcIiwgb25DbGljazogKGV2ZW50KSA9PiB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLnN2TW9kZWwuZHVwbGljYXRlKCk7XG4gICAgICAgIC8vdGhpcy5rZWVwU2VsZWN0VG9vbFNlbGVjdGlvbigpO1xuICAgICAgfSB9LCB0aGlzLnN0cmluZ3MuZHVwbGljYXRlKSk7XG4gICAgY29uc3QgU2hvcnRjdXRBbmRTbmFwcGluZyA9IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwic25hcHBpbmdcIiwgcmVmOiAoZWwpID0+ICh0aGlzLnNob3J0Y3V0U25hcHBpbmdEaXYgPSBlbCkgfSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgY2xhc3M6IFwic2tldGNoLWtleWJvYXJkLWJ1dHRvblwiLCBraW5kOiBcIm5ldXRyYWxcIiwgaWNvblN0YXJ0OiBcImtleWJvYXJkXCIsIHNjYWxlOiBcImxcIiwgbGFiZWw6IHRoaXMuc3RyaW5ncy5za2V0Y2hTaG9ydGN1dHMsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLmFyY2dpc1NrZXRjaFNob3J0Y3V0cykge1xuICAgICAgICAgIHRoaXMuYXJjZ2lzU2tldGNoU2hvcnRjdXRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1za2V0Y2gtc2hvcnRjdXRzXCIpO1xuICAgICAgICAgIHRoaXMuYXJjZ2lzU2tldGNoU2hvcnRjdXRzLnJlZkVsZW1lbnQgPSB0aGlzLnNob3J0Y3V0U25hcHBpbmdEaXY7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmFyY2dpc1NrZXRjaFNob3J0Y3V0cyk7XG4gICAgICAgICAgdGhpcy5hcmNnaXNTa2V0Y2hTaG9ydGN1dHMuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NrZXRjaFNob3J0Y3V0c0Rpc21pc3NlZENoYW5nZVwiLCAoKSA9PiB0aGlzLnJlbW92ZVNrZXRjaFNob3J0Y3V0cygpKTtcbiAgICAgICAgfVxuICAgICAgfSB9KSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYWxpZ25tZW50OiBcImljb24tZW5kLXNwYWNlLWJldHdlZW5cIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwga2luZDogXCJuZXV0cmFsXCIsIHdpZHRoOiBcImZ1bGxcIiwgaWNvblN0YXJ0OiBcImdlYXJcIiwgaWNvbkVuZDogXCJjaGV2cm9uLWRvd25cIiwgc2NhbGU6IFwibFwiLCBsYWJlbDogdGhpcy5zdHJpbmdzLnNldHRpbmdzLCBvbkNsaWNrOiAoZXZlbnQpID0+IHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGlmICghdGhpcy5za2V0Y2hTbmFwcGluZ0VsKSB7XG4gICAgICAgICAgdGhpcy5za2V0Y2hTbmFwcGluZ0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1za2V0Y2gtc25hcHBpbmdcIik7XG4gICAgICAgICAgdGhpcy5za2V0Y2hTbmFwcGluZ0VsLnJlZkVsZW1lbnQgPSB0aGlzLnNob3J0Y3V0U25hcHBpbmdEaXY7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLnNrZXRjaFNuYXBwaW5nRWwpO1xuICAgICAgICAgIHRoaXMuZGlzYWJsZVNrZXRjaFBhbmVsLmVtaXQodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0gfSwgdGhpcy5zdHJpbmdzLnNldHRpbmdzKSkpO1xuICAgIGNvbnN0IHNrZXRjaE1lc3NhZ2UgPSAoaChcImRpdlwiLCB7IGNsYXNzOiBza2V0Y2hTdGF0ZS5za2V0Y2hNZXNzYWdlICYmIFwic2tldGNoLW1lc3NhZ2VcIiB9LCBoKFwiY2FsY2l0ZS1ub3RpY2VcIiwgeyB3aWR0aDogXCJmdWxsXCIsIG9wZW46ICEhc2tldGNoU3RhdGUuc2tldGNoTWVzc2FnZSB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJtZXNzYWdlXCIgfSwgc2tldGNoU3RhdGUuc2tldGNoTWVzc2FnZSkpKSk7XG4gICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwiY2FsY2l0ZS1tYXRjaC1oZWlnaHRcIiB9LCBoKFwiY2FsY2l0ZS1mbG93XCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLmZsb3dFbCA9IGVsKSwgZGlyOiBnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpLCBjbGFzczogZ2V0RWxlbWVudERpcih0aGlzLmhvc3RFbGVtZW50KSA9PT0gXCJydGxcIiA/IENTU19VVElMSVRZLnJ0bCA6IFwiXCIgfSwgaChcImNhbGNpdGUtZmxvdy1pdGVtXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLnNrZXRjaEZsb3dJdGVtRWwgPSBlbCksIGhlYWRpbmc6IHRoaXMuc3RyaW5ncy5za2V0Y2gsIGRpc2FibGVkOiAhdGhpcy5sYXllci5jYXBhYmlsaXRpZXMub3BlcmF0aW9ucy5zdXBwb3J0c01hcE5vdGVzRWRpdGluZyB9LCB0aGlzLmRpc21pc3NpYmxlICYmIGRpc21pc3NCdXR0b24sIFNob3J0Y3V0QW5kU25hcHBpbmcsIHNrZXRjaE1lc3NhZ2UsIHRoaXMubXVsdGlwbGVTZWxlY3RlZEdyYXBoaWNzLmxlbmd0aCA+IDAgPyAoaChcImRpdlwiLCB7IGNsYXNzOiBcIm11bHRpcGxlLXNlbGVjdGlvblwiIH0sIHNlbGVjdGlvbk11bHRpcGxlTGFiZWwsIGgoXCJkaXZcIiwgeyBpZDogXCJtdWx0aXBsZS1zZWxlY3Rpb24tYnV0dG9uc1wiLCBjbGFzczogXCJidXR0b25zXCIgfSwgZHVwbGljYXRlTXVsdGlwbGUsIGRlbGV0ZU11bHRpcGxlKSkpIDogbnVsbCwgdGhpcy5zaG93U2tldGNoQ29udGVudCAmJiAoaChcImFyY2dpcy1za2V0Y2gtY29udGVudFwiLCB7IGN1cnJlbnRTa2V0Y2hJbmZvOiB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLCBmbG93RWw6IHRoaXMuZmxvd0VsLCBzeW1ib2xTdHlsZXJSZWZFbGVtZW50OiB0aGlzLmRpc21pc3NCdXR0b25FbCB9KSkpKSkpO1xuICB9XG4gIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTa2V0Y2guc3R5bGUgPSBhcmNnaXNTa2V0Y2hDc3M7XG5cbmNvbnN0IGFyY2dpc1NrZXRjaENvbnRlbnRDc3MgPSBcIi5za2V0Y2gtY29udGVudHtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2JhY2tncm91bmQtY29sb3I6dmFyKC0tYXJjZ2lzLWFwcC1iYWNrZ3JvdW5kKTtwYWRkaW5nOnZhcigtLWFyY2dpcy1hcHAtY2FwLXNwYWNpbmcpIHZhcigtLWFyY2dpcy1hcHAtc2lkZS1zcGFjaW5nLWhhbGYpfS5za2V0Y2gtdGl0bGUgY2FsY2l0ZS1pbmxpbmUtZWRpdGFibGV7Ym9yZGVyOjFweCBzb2xpZDtib3JkZXItY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1ib3JkZXItaW5wdXQpO3BhZGRpbmc6dmFyKC0tYXJjZ2lzLWFwcC1jYXAtc3BhY2luZy10aGlyZCl9LnJvdGF0aW9ue2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47cG9zaXRpb246cmVsYXRpdmV9LnJvdGF0aW9uIGNhbGNpdGUtc2xpZGVye3dpZHRoOjUwJX0ucm90YXRpb24gY2FsY2l0ZS1pbnB1dHt3aWR0aDo0NSU7Zm9udC1zaXplOnZhcigtLWFyY2dpcy1hcHAtZm9udC1zaXplLTApO2ZvbnQtZmFtaWx5OnZhcigtLWFyY2dpcy1hcHAtZm9udC1mYW1pbHkpfS5za2V0Y2gtcG9wdXAtYnV0dG9ue21hcmdpbi1ib3R0b206MC40ZW19XCI7XG5cbmNvbnN0IEFyY2dpc1NrZXRjaENvbnRlbnQgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuc2tldGNoR3JhcGhpY1VwZGF0ZXMgPSBjcmVhdGVFdmVudCh0aGlzLCBcInNrZXRjaEdyYXBoaWNVcGRhdGVzXCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzU2tldGNoUGFuZWxMb2FkZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NrZXRjaFBhbmVsTG9hZGVyXCIsIDcpO1xuICAgIHRoaXMuZGlzYWJsZVNrZXRjaFBhbmVsID0gY3JlYXRlRXZlbnQodGhpcywgXCJkaXNhYmxlU2tldGNoUGFuZWxcIiwgNyk7XG4gICAgdGhpcy5yZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoKSA9PiB7XG4gICAgICB0aGlzLnJlUmVuZGVyID0gIXRoaXMucmVSZW5kZXI7XG4gICAgfSk7XG4gICAgdGhpcy5zdWdnZXN0ZWRGaWxsQ29sb3JzID0gW107XG4gICAgdGhpcy5zYXZlZENvbG9ycyA9IFtdO1xuICAgIHRoaXMuc3VnZ2VzdGVkQ29sb3JMaXN0ID0gW1xuICAgICAgXCIjZmY0MDQwXCIsXG4gICAgICBcIiNmZjgyMDJcIixcbiAgICAgIFwiI2ZhYTgzZVwiLFxuICAgICAgXCIjZmZkMTU5XCIsXG4gICAgICBcIiM3M2I1NjZcIixcbiAgICAgIFwiIzAwODk3N1wiLFxuICAgICAgXCIjMzNlM2M4XCIsXG4gICAgICBcIiM0M2FiZWJcIixcbiAgICAgIFwiIzRiNjRjOVwiLFxuICAgICAgXCIjOTg2OGVkXCIsXG4gICAgICBcIiNiMDU1ZTZcIixcbiAgICAgIFwiI2RiNTE4MVwiLFxuICAgICAgXCIjZTAzYjk5XCIsXG4gICAgICBcIiMyYjJiMmJcIixcbiAgICAgIFwiI2JkYmRiZFwiLFxuICAgICAgXCIjZmZmZmZmXCJcbiAgICBdO1xuICAgIHRoaXMuc2F2ZWRDb2xvckxpc3QgPSBbXG4gICAgICBcIiNmZmZmZmZcIixcbiAgICAgIFwiI2JkYmRiZFwiLFxuICAgICAgXCIjMmIyYjJiXCIsXG4gICAgICBcIiNlMDNiOTlcIixcbiAgICAgIFwiI2RiNTE4MVwiLFxuICAgICAgXCIjYjA1NWU2XCIsXG4gICAgICBcIiM5ODY4ZWRcIixcbiAgICAgIFwiIzRiNjRjOVwiLFxuICAgICAgXCIjNDNhYmViXCIsXG4gICAgICBcIiMzM2UzYzhcIixcbiAgICAgIFwiIzAwODk3N1wiLFxuICAgICAgXCIjNzNiNTY2XCIsXG4gICAgICBcIiNmZmQxNTlcIixcbiAgICAgIFwiI2ZhYTgzZVwiLFxuICAgICAgXCIjZmY4MjAyXCIsXG4gICAgICBcIiNmZjQwNDBcIlxuICAgIF07XG4gICAgdGhpcy5zdG9yZVBvaW50U3R5bGVyID0gKGVsKSA9PiB7XG4gICAgICBpZiAoIWVsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMucG9pbnRTdHlsZXIgPSBlbDtcbiAgICAgIHRoaXMuc3RhcnRQb2ludEVkaXQoKTtcbiAgICB9O1xuICAgIHRoaXMuc3RvcmVQb2x5bGluZVN0eWxlciA9IChlbCkgPT4ge1xuICAgICAgaWYgKCFlbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLnBvbHlsaW5lU3R5bGVyID0gZWw7XG4gICAgICB0aGlzLnN0YXJ0UG9seWxpbmVFZGl0KCk7XG4gICAgfTtcbiAgICB0aGlzLnN0b3JlUG9seWdvblN0eWxlciA9IChlbCkgPT4ge1xuICAgICAgaWYgKCFlbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLnBvbHlnb25TdHlsZXIgPSBlbDtcbiAgICAgIHRoaXMuc3RhcnRQb2x5Z29uRWRpdCgpO1xuICAgIH07XG4gICAgLy8gb3BlbiBmb250IHBvcG92ZXJcbiAgICB0aGlzLm9wZW5Gb250UG9wb3ZlciA9ICgpID0+IHtcbiAgICAgIHZhciBfYTtcbiAgICAgIGlmICghdGhpcy5hcmNnaXNGb250UGlja2VyKSB7XG4gICAgICAgIHRoaXMuZGlzYWJsZVNrZXRjaFBhbmVsLmVtaXQodHJ1ZSk7XG4gICAgICAgIHRoaXMuYXJjZ2lzRm9udFBpY2tlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtZm9udC1waWNrZXJcIik7XG4gICAgICAgIHRoaXMuYXJjZ2lzRm9udFBpY2tlci5mb250TWFwID0gZmVhdHVyZVNlcnZpY2VGb250TWFwO1xuICAgICAgICB0aGlzLmFyY2dpc0ZvbnRQaWNrZXIuZm9udCA9IChfYSA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9udDtcbiAgICAgICAgdGhpcy5hcmNnaXNGb250UGlja2VyLnBvcG92ZXJQcm9wcyA9IHtcbiAgICAgICAgICByZWZFbGVtZW50OiB0aGlzLmhvc3RFbGVtZW50XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYXJjZ2lzRm9udFBpY2tlci5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzRm9udFBpY2tlckRpc21pc3NlZFwiLCB0aGlzLmNsb3NlRm9udFBvcHZlcik7XG4gICAgICAgIHRoaXMuYXJjZ2lzRm9udFBpY2tlci5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzRm9udFBpY2tlckNoYW5nZVwiLCB0aGlzLmNoYW5nZUZvbnQpO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuYXJjZ2lzRm9udFBpY2tlcik7XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLmNsb3NlRm9udFBvcHZlciA9ICgpID0+IHtcbiAgICAgIGlmICh0aGlzLmFyY2dpc0ZvbnRQaWNrZXIpIHtcbiAgICAgICAgdGhpcy5kaXNhYmxlU2tldGNoUGFuZWwuZW1pdChmYWxzZSk7XG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5hcmNnaXNGb250UGlja2VyKTtcbiAgICAgICAgdGhpcy5hcmNnaXNGb250UGlja2VyID0gbnVsbDtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuY2hhbmdlRm9udCA9IChldmVudCkgPT4ge1xuICAgICAgdmFyIF9hO1xuICAgICAgY29uc3QgZm9udCA9IGV2ZW50LmRldGFpbDtcbiAgICAgIGlmIChmb250KSB7XG4gICAgICAgIGNvbnN0IHRlbXBTeW1ib2wgPSAoX2EgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNsb25lKCk7XG4gICAgICAgIHRlbXBTeW1ib2wuZm9udC5mYW1pbHkgPSBmb250LmZhbWlseTtcbiAgICAgICAgdGVtcFN5bWJvbC5mb250LndlaWdodCA9IGZvbnQud2VpZ2h0O1xuICAgICAgICB0ZW1wU3ltYm9sLmZvbnQuc3R5bGUgPSBmb250LnN0eWxlO1xuICAgICAgICB0aGlzLnVwZGF0ZVN5bWJvbCh0ZW1wU3ltYm9sKTtcbiAgICAgICAgdGhpcy5yZVJlbmRlciA9ICF0aGlzLnJlUmVuZGVyO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5jdXJyZW50U2tldGNoSW5mbyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmZsb3dFbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnN5bWJvbFN0eWxlclJlZkVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5yZVJlbmRlciA9IHRydWU7XG4gIH1cbiAgLy8gbGlmZWN5Y2xlIG1ldGhvZHNcbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5hcmNnaXNTa2V0Y2hQYW5lbExvYWRlci5lbWl0KHRydWUpO1xuICAgIGF3YWl0IHRoaXMubG9hZEFsbE1vZHVsZXMoKTtcbiAgICAvLyBhZGQgc2tldGNoXG4gICAgdGhpcy5zdWdnZXN0ZWRDb2xvckxpc3QuZm9yRWFjaCgoaGV4KSA9PiB7XG4gICAgICB0aGlzLnN1Z2dlc3RlZEZpbGxDb2xvcnMucHVzaChuZXcgdGhpcy5Db2xvcihoZXgpKTtcbiAgICB9KTtcbiAgICB0aGlzLnNhdmVkQ29sb3JMaXN0LmZvckVhY2goKGhleCkgPT4ge1xuICAgICAgdGhpcy5zYXZlZENvbG9ycy5wdXNoKG5ldyB0aGlzLkNvbG9yKGhleCkpO1xuICAgIH0pO1xuICAgIHRoaXMubWFwVmlldyA9IHNrZXRjaFN0YXRlLm1hcFZpZXc7XG4gICAgdGhpcy5zdHJpbmdzID0gc2tldGNoU3RhdGUuc3RyaW5ncztcbiAgICB0aGlzLmN1cnJlbnRMYW5ndWFnZSA9IHNrZXRjaFN0YXRlLmN1cnJlbnRMYW5ndWFnZTtcbiAgICB0aGlzLnBvcnRhbCA9IHNrZXRjaFN0YXRlLnBvcnRhbDtcbiAgfVxuICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgIHRoaXMuYXJjZ2lzU2tldGNoUGFuZWxMb2FkZXIuZW1pdChmYWxzZSk7XG4gICAgdGhpcy5mbG93RWwgJiYgdGhpcy5yZXNpemVPYnNlcnZlci5vYnNlcnZlKHRoaXMuZmxvd0VsKTtcbiAgfVxuICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICB0aGlzLmZsb3dFbCAmJiB0aGlzLnJlc2l6ZU9ic2VydmVyLnVub2JzZXJ2ZSh0aGlzLmZsb3dFbCk7XG4gIH1cbiAgLy8gZXZlbnRzXG4gIGNhbGNpdGVGbG93SXRlbUJhY2tIYW5kbGVyKGV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5tYXBWaWV3LmNsb3NlUG9wdXAoKTtcbiAgICB0aGlzLnNrZXRjaFBvcHVwRmxvd0l0ZW0gPSBudWxsO1xuICB9XG4gIC8vIGN1cnJlbnRTa2V0Y2hJbmZvIGlzIHVwZGF0ZWQuIHJlcmVuZGVyLlxuICBza2V0Y2hDb250ZW50UmVSZW5kZXJIYW5kbGVyKGV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5yZVJlbmRlciA9ICF0aGlzLnJlUmVuZGVyO1xuICAgIC8vIGdvIGJhY2sgaWYgcG9wdXAgcGFuZWwgaXMgb3BlblxuICAgIGlmICh0aGlzLnNrZXRjaFBvcHVwRmxvd0l0ZW0pIHtcbiAgICAgIHRoaXMuZmxvd0VsLmJhY2soKTtcbiAgICAgIHRoaXMuc2tldGNoUG9wdXBGbG93SXRlbSA9IG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHsgdG9vbCB9ID0gdGhpcy5jdXJyZW50U2tldGNoSW5mbztcbiAgICBpZiAodG9vbCA9PT0gXCJwb2ludFwiKSB7XG4gICAgICB0aGlzLnN0YXJ0UG9pbnRFZGl0KCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHRvb2wgPT09IFwicG9seWxpbmVcIikge1xuICAgICAgdGhpcy5zdGFydFBvbHlsaW5lRWRpdCgpO1xuICAgIH1cbiAgICBlbHNlIGlmIChbXCJjaXJjbGVcIiwgXCJwb2x5Z29uXCIsIFwicmVjdGFuZ2xlXCJdLmluY2x1ZGVzKHRvb2wpKSB7XG4gICAgICB0aGlzLnN0YXJ0UG9seWdvbkVkaXQoKTtcbiAgICB9XG4gIH1cbiAgcG9wdXBVcGRhdGVkSGFuZGxlcih7IGRldGFpbDogeyBtYXBOb3Rlc1BvcHVwdGVtcGxhdGUgfSB9KSB7XG4gICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby5wb3B1cCA9IG1hcE5vdGVzUG9wdXB0ZW1wbGF0ZTtcbiAgICB0aGlzLnNrZXRjaEdyYXBoaWNVcGRhdGVzLmVtaXQoe1xuICAgICAgdXBkYXRlOiB0cnVlLFxuICAgICAgY2xvc2U6IGZhbHNlXG4gICAgfSk7XG4gIH1cbiAgLy8gcHJpdmF0ZSBtZXRob2RzXG4gIGFzeW5jIGxvYWRBbGxNb2R1bGVzKCkge1xuICAgIFt0aGlzLkNvbG9yLCB0aGlzLmNpbVN5bWJvbFV0aWxzLCB0aGlzLlNpbXBsZUxpbmVTeW1ib2xdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1xuICAgICAgXCJlc3JpL0NvbG9yXCIsXG4gICAgICBcImVzcmkvc3ltYm9scy9zdXBwb3J0L2NpbVN5bWJvbFV0aWxzXCIsXG4gICAgICBcImVzcmkvc3ltYm9scy9TaW1wbGVMaW5lU3ltYm9sXCJcbiAgICBdKTtcbiAgfVxuICB1cGRhdGVTeW1ib2woc3ltYm9sKSB7XG4gICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wgPSBzeW1ib2w7XG4gICAgdGhpcy5za2V0Y2hHcmFwaGljVXBkYXRlcy5lbWl0KHtcbiAgICAgIHVwZGF0ZTogdHJ1ZSxcbiAgICAgIGNsb3NlOiBmYWxzZVxuICAgIH0pO1xuICB9XG4gIGFwcGx5Q2ltT3V0bGluZShzeW0sIHN0cm9rZSkge1xuICAgIGNvbnN0IG91dGxpbmUgPSBnZXRDaW1PdXRsaW5lKHN5bSk7XG4gICAgaWYgKCFvdXRsaW5lKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHJnYmEgPSBzdHJva2UuY29sb3IudG9SZ2JhKCk7XG4gICAgcmdiYVszXSAqPSAyNTU7XG4gICAgb3V0bGluZS5jb2xvciA9IHJnYmE7XG4gICAgb3V0bGluZS53aWR0aCA9IHN0cm9rZS5zaXplO1xuICB9XG4gIC8vIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1jb21wb25lbnRzL2Jsb2IvbWFzdGVyL3NyYy9zbWFydE1hcHBpbmcvX3V0aWxzL3N5bWJvbFN0eWxlci50cyNMNDk5NlxuICBnZXRDaW1PdXRsaW5lUHJvcHMoc3ltKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IG91dGxpbmUgPSBnZXRDaW1PdXRsaW5lKHN5bSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvbG9yOiBuZXcgdGhpcy5Db2xvcihvdXRsaW5lID09PSBudWxsIHx8IG91dGxpbmUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG91dGxpbmUuY29sb3IpLFxuICAgICAgc2l6ZTogKF9hID0gb3V0bGluZSA9PT0gbnVsbCB8fCBvdXRsaW5lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvdXRsaW5lLndpZHRoKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAxXG4gICAgfTtcbiAgfVxuICBnZXRQb3BvdmVyUHJvcHMoaXNSdGwpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgZmxvd1JlY3QgPSAoX2EgPSB0aGlzLmZsb3dFbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJldHVybiB7XG4gICAgICBwbGFjZW1lbnQ6IGlzUnRsID8gXCJib3R0b20tc3RhcnRcIiA6IFwiYm90dG9tLWVuZFwiLFxuICAgICAgb2Zmc2V0RGlzdGFuY2U6IDEwLFxuICAgICAgb2Zmc2V0U2tpZGRpbmc6IGlzUnRsID8gMyA6IC0zLFxuICAgICAgb3ZlcmxheVBvc2l0aW9uaW5nOiBcImZpeGVkXCIsXG4gICAgICBtYXhIZWlnaHQ6IGZsb3dSZWN0ICYmIGAke2Zsb3dSZWN0LmhlaWdodCAtIDY1fXB4YCxcbiAgICAgIHJlZkVsZW1lbnQ6IHRoaXMuc3ltYm9sU3R5bGVyUmVmRWxlbWVudFxuICAgIH07XG4gIH1cbiAgc3RhcnRQb2ludEVkaXQoKSB7XG4gICAgdmFyIF9hO1xuICAgIC8vIGNpbSBhbmQgY3VzdG9tIHBpY3R1cmUtbWFya2VycyBhcmUgYWxsb3dlZFxuICAgIGNvbnN0IGlzQ0lNID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wudHlwZSA9PT0gXCJjaW1cIjtcbiAgICAoX2EgPSB0aGlzLnBvaW50U3R5bGVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZWRpdCh0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbC5jbG9uZSgpLCB7XG4gICAgICBzZWN0aW9uczoge1xuICAgICAgICBtYXJrZXI6IHtcbiAgICAgICAgICBvcGVuOiB0cnVlLFxuICAgICAgICAgIHN5bWJvbHNPcGVuOiB0cnVlLFxuICAgICAgICAgIHNpemVPcGVuOiBmYWxzZSxcbiAgICAgICAgICByb3RhdGlvbk9wZW46IGZhbHNlLFxuICAgICAgICAgIC8vICdhbGwnIGJ5IGRlZmF1bHQsIGNhbiBiZSAnc2ltcGxlJywgJ3BpY3R1cmUnLCAnY2ltJywgJ2NpbTpwaWN0dXJlJywgJ2NpbTp2ZWN0b3InXG4gICAgICAgICAgLy8gb3IgYW4gYXJyYXkgb2YgYSBjb21iaW5hdGlvbiBvZiBzcGVjaWZpYyB0eXBlc1xuICAgICAgICAgIG1hcmtlclR5cGU6IFtcImNpbTp2ZWN0b3JcIiwgXCJjdXN0b21cIl0sXG4gICAgICAgICAga2VlcENob2ljZTogdHJ1ZSxcbiAgICAgICAgICBwYXJ0czoge1xuICAgICAgICAgICAgc2l6ZToge1xuICAgICAgICAgICAgICBhdXRvU2l6ZUFkanVzdDogZmFsc2UgLy8gaGlkZSBhZGp1c3Qgc2l6ZSBwcm9wZXJ0eVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZmlsbDogaXNDSU0gJiYge1xuICAgICAgICAgIHR5cGU6IFwiY29sb3JcIixcbiAgICAgICAgICBvcHRpb25hbDogdHJ1ZSxcbiAgICAgICAgICBzdWdnZXN0ZWRDb2xvcnM6IHRoaXMuc3VnZ2VzdGVkRmlsbENvbG9ycyxcbiAgICAgICAgICBzYXZlZENvbG9yczogdGhpcy5zYXZlZENvbG9ycyxcbiAgICAgICAgICBvcGVuOiBmYWxzZSxcbiAgICAgICAgICBzdWdnZXN0ZWRDb2xvcnNPcGVuOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIHN0cm9rZTogaXNDSU0gJiYge1xuICAgICAgICAgIG9wdGlvbmFsOiB0cnVlLFxuICAgICAgICAgIG9wZW46IGZhbHNlLFxuICAgICAgICAgIHR5cGU6IFwiY29sb3JcIixcbiAgICAgICAgICBzdWdnZXN0ZWRDb2xvcnM6IHRoaXMuc3VnZ2VzdGVkRmlsbENvbG9ycyxcbiAgICAgICAgICBzYXZlZENvbG9yczogdGhpcy5zYXZlZENvbG9yc1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgbWFya2VyOiB7XG4gICAgICAgIHNpemU6IGlzQ0lNXG4gICAgICAgICAgPyB0aGlzLmNpbVN5bWJvbFV0aWxzLmdldENJTVN5bWJvbFNpemUodGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpXG4gICAgICAgICAgOiB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbC50eXBlID09PSBcInBpY3R1cmUtbWFya2VyXCJcbiAgICAgICAgICAgID8gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wud2lkdGhcbiAgICAgICAgICAgIDogMjVcbiAgICAgIH0sXG4gICAgICBmaWxsOiB7XG4gICAgICAgIGNvbG9yOiAoaXNDSU0gJiZcbiAgICAgICAgICB0aGlzLmNpbVN5bWJvbFV0aWxzLmdldENJTVN5bWJvbENvbG9yKHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSkgfHxcbiAgICAgICAgICB0aGlzLnN1Z2dlc3RlZEZpbGxDb2xvcnNbMF1cbiAgICAgIH0sXG4gICAgICBzdHJva2U6IGlzQ0lNICYmIHRoaXMuZ2V0Q2ltT3V0bGluZVByb3BzKHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSxcbiAgICAgIGZpbGxFbmFibGVkOiBpc0NJTSxcbiAgICAgIHN0cm9rZUVuYWJsZWQ6IGlzQ0lNLFxuICAgICAgcG9ydGFsOiB0aGlzLmNyZWF0ZVBvcnRhbFByb3AoKVxuICAgIH0pO1xuICB9XG4gIHN0YXJ0UG9seWxpbmVFZGl0KCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XG4gICAgKF9hID0gdGhpcy5wb2x5bGluZVN0eWxlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmVkaXQodGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wuY2xvbmUoKSwge1xuICAgICAgc2VjdGlvbnM6IHtcbiAgICAgICAgc3Ryb2tlOiB7XG4gICAgICAgICAgdHlwZTogXCJjb2xvclwiLFxuICAgICAgICAgIG9wZW46IHRydWUsXG4gICAgICAgICAgc3VnZ2VzdGVkQ29sb3JzT3BlbjogdHJ1ZSxcbiAgICAgICAgICBzdWdnZXN0ZWRDb2xvcnM6IHRoaXMuc3VnZ2VzdGVkRmlsbENvbG9ycyxcbiAgICAgICAgICBleHRyYVBhcnRzOiB7XG4gICAgICAgICAgICB3aWR0aDogdHJ1ZSxcbiAgICAgICAgICAgIGF1dG9TdHJva2VBZGp1c3Q6IGZhbHNlXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgc3Ryb2tlOiB7XG4gICAgICAgIGNvbG9yOiAoKF9iID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jb2xvcikgfHwgdGhpcy5zYXZlZENvbG9yc1sxXSxcbiAgICAgICAgc2l6ZTogKChfYyA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Mud2lkdGgpIHx8IDEwLFxuICAgICAgICBzdHlsZTogKChfZCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Quc3R5bGUpIHx8XG4gICAgICAgICAgXCJzb2xpZFwiLFxuICAgICAgICBtYXJrZXI6IChfZSA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UubWFya2VyXG4gICAgICB9LFxuICAgICAgcG9ydGFsOiB0aGlzLmNyZWF0ZVBvcnRhbFByb3AoKVxuICAgIH0pO1xuICB9XG4gIGNyZWF0ZVBvcnRhbFByb3AoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBvcnRhbDogdGhpcy5wb3J0YWwsXG4gICAgICBiZWZvcmU6IGFzeW5jIChwb3J0YWwsIGRhdGEpID0+IHtcbiAgICAgICAgYXdhaXQgcG9ydGFsLmxvYWQoKTtcbiAgICAgICAgZGF0YS5vcmlnaW5hbFN0eWxlc0dyb3VwUXVlcnkyZCA9IHBvcnRhbC5zdHlsZXNHcm91cFF1ZXJ5MmQ7XG4gICAgICAgIHBvcnRhbC5zdHlsZXNHcm91cFF1ZXJ5MmQgPSAndGl0bGU6XCJFc3JpIFNrZXRjaCBTdHlsZXNcIiBBTkQgb3duZXI6ZXNyaV9lbic7XG4gICAgICB9LFxuICAgICAgYWZ0ZXI6IGFzeW5jIChwb3J0YWwsIGRhdGEpID0+IHtcbiAgICAgICAgcG9ydGFsLnN0eWxlc0dyb3VwUXVlcnkyZCA9IGRhdGEub3JpZ2luYWxTdHlsZXNHcm91cFF1ZXJ5MmQ7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuICBzdGFydFBvbHlnb25FZGl0KCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICAoX2EgPSB0aGlzLnBvbHlnb25TdHlsZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5lZGl0KHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sLmNsb25lKCksIHtcbiAgICAgIHNlY3Rpb25zOiB7XG4gICAgICAgIGZpbGw6IHtcbiAgICAgICAgICB0eXBlOiBcImNvbG9yXCIsXG4gICAgICAgICAgb3BlbjogdHJ1ZSxcbiAgICAgICAgICBvcHRpb25hbDogdHJ1ZSxcbiAgICAgICAgICBzdWdnZXN0ZWRDb2xvcnNPcGVuOiB0cnVlLFxuICAgICAgICAgIHRyYW5zcGFyZW5jeU9wZW46IGZhbHNlLFxuICAgICAgICAgIHN1Z2dlc3RlZENvbG9yczogdGhpcy5zdWdnZXN0ZWRGaWxsQ29sb3JzXG4gICAgICAgIH0sXG4gICAgICAgIHN0cm9rZToge1xuICAgICAgICAgIHR5cGU6IFwiY29sb3JcIixcbiAgICAgICAgICBvcGVuOiBmYWxzZSxcbiAgICAgICAgICBvcHRpb25hbDogdHJ1ZSxcbiAgICAgICAgICBzdWdnZXN0ZWRDb2xvcnNPcGVuOiB0cnVlLFxuICAgICAgICAgIHN1Z2dlc3RlZENvbG9yczogdGhpcy5zdWdnZXN0ZWRGaWxsQ29sb3JzLFxuICAgICAgICAgIGV4dHJhUGFydHM6IHtcbiAgICAgICAgICAgIHdpZHRoOiB0cnVlLFxuICAgICAgICAgICAgYXV0b1N0cm9rZUFkanVzdDogZmFsc2VcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBmaWxsOiB7XG4gICAgICAgIGNvbG9yOiB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbC5jb2xvciB8fFxuICAgICAgICAgIHRoaXMuc3VnZ2VzdGVkRmlsbENvbG9yc1swXVxuICAgICAgfSxcbiAgICAgIHN0cm9rZToge1xuICAgICAgICBjb2xvcjogKChfYiA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sLm91dGxpbmUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jb2xvcikgfHxcbiAgICAgICAgICB0aGlzLnN1Z2dlc3RlZEZpbGxDb2xvcnNbMF0sXG4gICAgICAgIHNpemU6ICgoX2MgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbC5vdXRsaW5lKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Mud2lkdGgpIHx8IDEwLFxuICAgICAgICBzdHlsZTogXCJzb2xpZFwiLFxuICAgICAgICBhdXRvQWRqdXN0ZWQ6IGZhbHNlXG4gICAgICB9LFxuICAgICAgZmlsbEVuYWJsZWQ6IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sLmNvbG9yID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgc3Ryb2tlRW5hYmxlZDogKChfZCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Qub3V0bGluZSlcbiAgICAgICAgPyB0cnVlXG4gICAgICAgIDogZmFsc2UsXG4gICAgICBwb3J0YWw6IHRoaXMuY3JlYXRlUG9ydGFsUHJvcCgpXG4gICAgfSk7XG4gIH1cbiAgY2hhbmdlUm90YXRpb24oYW5nbGUpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgdGVtcFN5bWJvbCA9IChfYSA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2xvbmUoKTtcbiAgICB0ZW1wU3ltYm9sLmFuZ2xlID0gYW5nbGU7XG4gICAgdGhpcy51cGRhdGVTeW1ib2wodGVtcFN5bWJvbCk7XG4gICAgdGhpcy5yZVJlbmRlciA9ICF0aGlzLnJlUmVuZGVyO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZiwgX2csIF9oLCBfaiwgX2ssIF9sLCBfbSwgX287XG4gICAgY29uc3QgaXNSdGwgPSBnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpID09PSBcInJ0bFwiO1xuICAgIGNvbnN0IHBvaW50ID0gKGgoXCJhcmNnaXMtc3ltYm9sLXN0eWxlclwiLCB7IGtleTogXCJwb2ludC1zdHlsZXJcIiwgbGFuZzogdGhpcy5jdXJyZW50TGFuZ3VhZ2UsIGluaXRpYWxTb3VyY2VJZDogdGhpcy5jdXJyZW50U2tldGNoSW5mby5zb3VyY2VJZHMucG9pbnRTb3VyY2VJZCwgcmVmOiB0aGlzLnN0b3JlUG9pbnRTdHlsZXIsIHBvcG92ZXJQcm9wczogdGhpcy5nZXRQb3BvdmVyUHJvcHMoaXNSdGwpLCBvbkFyY2dpc1N5bWJvbFN0eWxlckVkaXQ6ICh7IGRldGFpbDogeyBzeW1ib2wgfSB9KSA9PiB7XG4gICAgICAgIHRoaXMudXBkYXRlU3ltYm9sKHN5bWJvbCk7XG4gICAgICB9LCBvbkFyY2dpc1N5bWJvbFN0eWxlclNvdXJjZUlkQ2hhbmdlOiAoeyBkZXRhaWw6IHNvdXJjZUlkIH0pID0+ICh0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnNvdXJjZUlkcy5wb2ludFNvdXJjZUlkID0gc291cmNlSWQpIH0pKTtcbiAgICBjb25zdCBwb2x5bGluZSA9IChoKFwiYXJjZ2lzLXN5bWJvbC1zdHlsZXJcIiwgeyBrZXk6IFwicG9seWxpbmUtc3R5bGVyXCIsIGxhbmc6IHRoaXMuY3VycmVudExhbmd1YWdlLCBpbml0aWFsU291cmNlSWQ6IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc291cmNlSWRzLnBvbHlsaW5lU291cmNlSWQsIHJlZjogdGhpcy5zdG9yZVBvbHlsaW5lU3R5bGVyLCBwb3BvdmVyUHJvcHM6IHRoaXMuZ2V0UG9wb3ZlclByb3BzKGlzUnRsKSwgb25BcmNnaXNTeW1ib2xTdHlsZXJFZGl0OiAoeyBkZXRhaWw6IHsgc3ltYm9sIH0gfSkgPT4ge1xuICAgICAgICB0aGlzLnVwZGF0ZVN5bWJvbChzeW1ib2wpO1xuICAgICAgfSwgb25BcmNnaXNTeW1ib2xTdHlsZXJTb3VyY2VJZENoYW5nZTogKHsgZGV0YWlsOiBzb3VyY2VJZCB9KSA9PiAodGhpcy5jdXJyZW50U2tldGNoSW5mby5zb3VyY2VJZHMucG9seWxpbmVTb3VyY2VJZCA9IHNvdXJjZUlkKSB9KSk7XG4gICAgY29uc3QgcG9seWdvbiA9IChoKFwiYXJjZ2lzLXN5bWJvbC1zdHlsZXJcIiwgeyBrZXk6IFwicG9seWdvbi1zdHlsZXJcIiwgbGFuZzogdGhpcy5jdXJyZW50TGFuZ3VhZ2UsIGluaXRpYWxTb3VyY2VJZDogdGhpcy5jdXJyZW50U2tldGNoSW5mby5zb3VyY2VJZHMucG9seWdvblNvdXJjZUlkLCByZWY6IHRoaXMuc3RvcmVQb2x5Z29uU3R5bGVyLCBwb3BvdmVyUHJvcHM6IHRoaXMuZ2V0UG9wb3ZlclByb3BzKGlzUnRsKSwgb25BcmNnaXNTeW1ib2xTdHlsZXJFZGl0OiAoeyBkZXRhaWw6IHsgc3ltYm9sIH0gfSkgPT4ge1xuICAgICAgICB0aGlzLnVwZGF0ZVN5bWJvbChzeW1ib2wpO1xuICAgICAgfSwgb25BcmNnaXNTeW1ib2xTdHlsZXJTb3VyY2VJZENoYW5nZTogKHsgZGV0YWlsOiBzb3VyY2VJZCB9KSA9PiAodGhpcy5jdXJyZW50U2tldGNoSW5mby5zb3VyY2VJZHMucG9seWdvblNvdXJjZUlkID0gc291cmNlSWQpIH0pKTtcbiAgICAvLyB0ZXh0XG4gICAgY29uc3QgdGV4dENvbnRlbnQgPSAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgdGhpcy5zdHJpbmdzLmNvbnRlbnQsIGgoXCJjYWxjaXRlLWlucHV0XCIsIHsgdHlwZTogXCJ0ZXh0YXJlYVwiLCBwbGFjZWhvbGRlcjogdGhpcy5zdHJpbmdzLnRleHRDb250ZW50UGxhY2Vob2xkZXIsIHZhbHVlOiAoX2EgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRleHQsIG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IChldmVudCkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBjb25zdCB0ZW1wU3ltYm9sID0gKF9hID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jbG9uZSgpO1xuICAgICAgICB0ZW1wU3ltYm9sLnRleHQgPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgICAgIHRoaXMudXBkYXRlU3ltYm9sKHRlbXBTeW1ib2wpO1xuICAgICAgfSB9KSkpO1xuICAgIGNvbnN0IGZvbnRGYW1pbHlTZWxlY3Rpb24gPSAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgdGhpcy5zdHJpbmdzLmZvbnQsIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGFsaWdubWVudDogXCJpY29uLWVuZC1zcGFjZS1iZXR3ZWVuXCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBpY29uRW5kOiBcImNoZXZyb24tZG93blwiLCBsYWJlbDogZm9udFRvRm9udE5hbWUoKChfYiA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZm9udCkgfHxcbiAgICAgICAgeyBmYW1pbHk6IFwiQXJpYWxcIiwgc3R5bGU6IFwibm9ybWFsXCIsIHdlaWdodDogXCJub3JtYWxcIiB9KSwgd2lkdGg6IFwiZnVsbFwiLCBzY2FsZTogXCJtXCIsIG9uQ2xpY2s6IHRoaXMub3BlbkZvbnRQb3BvdmVyIH0sIGZvbnRUb0ZvbnROYW1lKChfYyA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZm9udCkpKSk7XG4gICAgY29uc3QgdGV4dEZvbnRTaXplID0gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5zaXplLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHR5cGU6IFwibnVtYmVyXCIsIHNjYWxlOiBcInNcIiwgbWluOiA1LCBtYXg6IDEyNSwgdmFsdWU6IGAkeygoX2UgPSAoX2QgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmZvbnQpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5zaXplKSAvIDAuNzUgfHwgMH1gLCBvbkNhbGNpdGVJbnB1dElucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgY29uc3QgdGVtcFN5bWJvbCA9IChfYSA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2xvbmUoKTtcbiAgICAgICAgdGVtcFN5bWJvbC5mb250LnNpemUgPSBwYXJzZUludChub2RlLnZhbHVlKSAqIDAuNzUgfHwgMDtcbiAgICAgICAgdGhpcy51cGRhdGVTeW1ib2wodGVtcFN5bWJvbCk7XG4gICAgICB9IH0pKSk7XG4gICAgY29uc3QgdGV4dENvbG9yID0gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5jb2xvciwgaChcImFyY2dpcy1jb2xvci1pbnB1dFwiLCB7IGNvbG9yOiAoKF9nID0gKF9mID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZi5jb2xvcikgPT09IG51bGwgfHwgX2cgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9nLnRvSGV4KCkpIHx8IFwiI2ZmZmZmZlwiLCBwb3BvdmVyUHJvcHM6IHRoaXMuZ2V0UG9wb3ZlclByb3BzKGlzUnRsKSwgb25BcmNnaXNDb2xvcklucHV0Q2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB0ZW1wU3ltYm9sID0gKF9hID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jbG9uZSgpO1xuICAgICAgICB0ZW1wU3ltYm9sLmNvbG9yID0gbmV3IHRoaXMuQ29sb3IoZXZlbnQudGFyZ2V0LmNvbG9yKTtcbiAgICAgICAgdGhpcy51cGRhdGVTeW1ib2wodGVtcFN5bWJvbCk7XG4gICAgICB9IH0pKSk7XG4gICAgY29uc3Qgcm90YXRpb24gPSAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgdGhpcy5zdHJpbmdzLnJvdGF0aW9uLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwicm90YXRpb25cIiB9LCBoKFwiY2FsY2l0ZS1zbGlkZXJcIiwgeyBtaW46IDAsIG1heDogMzYwLCB2YWx1ZTogKChfaCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfaCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2guYW5nbGUpIHx8IDAsIHN0ZXA6IDEsIG9uQ2FsY2l0ZVNsaWRlcklucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgdGhpcy5jaGFuZ2VSb3RhdGlvbihldmVudC50YXJnZXQudmFsdWUpO1xuICAgICAgfSB9KSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyB0eXBlOiBcIm51bWJlclwiLCBzY2FsZTogXCJzXCIsIG1pbjogMCwgbWF4OiAzNjAsIHN1ZmZpeFRleHQ6IGlzUnRsID8gXCJcIiA6IFwiwrpcIiwgcHJlZml4VGV4dDogaXNSdGwgPyBcIsK6XCIgOiBcIlwiLCBzdGVwOiAxLCB2YWx1ZTogYCR7KChfaiA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfaiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2ouYW5nbGUpIHx8IDB9YCwgb25DYWxjaXRlSW5wdXRJbnB1dDogKGV2ZW50KSA9PiB7XG4gICAgICAgIHRoaXMuY2hhbmdlUm90YXRpb24ocGFyc2VJbnQoZXZlbnQudGFyZ2V0LnZhbHVlKSk7XG4gICAgICB9IH0pKSkpO1xuICAgIGNvbnN0IGhhbG9CbG9jayA9IChoKFwiY2FsY2l0ZS1ibG9jay1zZWN0aW9uXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLmhhbG9CbG9ja1NlY3Rpb24gPSBlbCksIHRleHQ6IHRoaXMuc3RyaW5ncy5oYWxvLCB0b2dnbGVEaXNwbGF5OiBcInN3aXRjaFwiLCBvcGVuOiAoKF9rID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9rID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfay5oYWxvQ29sb3IpID8gdHJ1ZSA6IGZhbHNlLCBvbkNhbGNpdGVCbG9ja1NlY3Rpb25Ub2dnbGU6IChldmVudCkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBjb25zdCB0ZW1wU3ltYm9sID0gKF9hID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jbG9uZSgpO1xuICAgICAgICBpZiAodGhpcy5oYWxvQmxvY2tTZWN0aW9uLm9wZW4pIHtcbiAgICAgICAgICB0ZW1wU3ltYm9sLmhhbG9Db2xvciA9IHRoaXMudGVtcEhhbG9Db2xvciB8fCBuZXcgdGhpcy5Db2xvcihcIndoaXRlXCIpO1xuICAgICAgICAgIHRlbXBTeW1ib2wuaGFsb1NpemUgPSAodGVtcFN5bWJvbCA9PT0gbnVsbCB8fCB0ZW1wU3ltYm9sID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZW1wU3ltYm9sLmhhbG9TaXplKSB8fCAxICogMC43NTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB0aGlzLnRlbXBIYWxvQ29sb3IgPSB0ZW1wU3ltYm9sLmhhbG9Db2xvcjtcbiAgICAgICAgICB0ZW1wU3ltYm9sLmhhbG9Db2xvciA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGVTeW1ib2wodGVtcFN5bWJvbCk7XG4gICAgICB9IH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5jb2xvciwgaChcImFyY2dpcy1jb2xvci1pbnB1dFwiLCB7IGNvbG9yOiAoKF9tID0gKF9sID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9sID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfbC5oYWxvQ29sb3IpID09PSBudWxsIHx8IF9tID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfbS50b0hleCgpKSB8fCBcIiNmZmZmZmZcIiwgcG9wb3ZlclByb3BzOiB0aGlzLmdldFBvcG92ZXJQcm9wcyhpc1J0bCksIG9uQXJjZ2lzQ29sb3JJbnB1dENoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgdGVtcFN5bWJvbCA9IChfYSA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2xvbmUoKTtcbiAgICAgICAgdGVtcFN5bWJvbC5oYWxvQ29sb3IgPSBuZXcgdGhpcy5Db2xvcihldmVudC50YXJnZXQuY29sb3IpO1xuICAgICAgICB0aGlzLnVwZGF0ZVN5bWJvbCh0ZW1wU3ltYm9sKTtcbiAgICAgIH0gfSkpLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCB0aGlzLnN0cmluZ3Muc2l6ZSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyB0eXBlOiBcIm51bWJlclwiLCBzY2FsZTogXCJzXCIsIG1pbjogMSwgbWF4OiAxMCwgdmFsdWU6IGAkeygoX28gPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCkgPT09IG51bGwgfHwgX28gPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9vLmhhbG9TaXplKSAvIDAuNzUgfHwgMH1gLCBvbkNhbGNpdGVJbnB1dElucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgY29uc3QgdGVtcFN5bWJvbCA9IChfYSA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2xvbmUoKTtcbiAgICAgICAgdGVtcFN5bWJvbC5oYWxvU2l6ZSA9IHBhcnNlSW50KG5vZGUudmFsdWUpICogMC43NSB8fCAwO1xuICAgICAgICB0aGlzLnVwZGF0ZVN5bWJvbCh0ZW1wU3ltYm9sKTtcbiAgICAgIH0gfSkpKSk7XG4gICAgY29uc3QgdGV4dCA9IChoKFwiZGl2XCIsIG51bGwsIHRleHRDb250ZW50LCBmb250RmFtaWx5U2VsZWN0aW9uLCB0ZXh0Rm9udFNpemUsIHRleHRDb2xvciwgcm90YXRpb24sIGhhbG9CbG9jaykpO1xuICAgIGNvbnN0IHNrZXRjaFRpdGxlID0gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgY2xhc3M6IFwic2tldGNoLXRpdGxlXCIgfSwgdGhpcy5zdHJpbmdzLnRpdGxlLCBoKFwiY2FsY2l0ZS1pbmxpbmUtZWRpdGFibGVcIiwgeyBzY2FsZTogXCJtXCIgfSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyBhbGlnbm1lbnQ6IFwic3RhcnRcIiwgcGxhY2Vob2xkZXI6IHRoaXMuc3RyaW5ncy5lbnRlclRpdGxlUGxhY2Vob2xkZXIsIHNjYWxlOiBcIm1cIiwgdHlwZTogXCJ0ZXh0XCIsIHZhbHVlOiB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRpdGxlLCBvbkJsdXI6IChldmVudCkgPT4ge1xuICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRpdGxlID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgICAgICB0aGlzLnNrZXRjaEdyYXBoaWNVcGRhdGVzLmVtaXQoe1xuICAgICAgICAgIHVwZGF0ZTogdHJ1ZSxcbiAgICAgICAgICBjbG9zZTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICB9IH0pKSkpO1xuICAgIGNvbnN0IHBvcHVwQnRuID0gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGFsaWdubWVudDogXCJpY29uLWVuZC1zcGFjZS1iZXR3ZWVuXCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBpY29uRW5kOiBpc1J0bCA/IFwiY2hldnJvbi1sZWZ0XCIgOiBcImNoZXZyb24tcmlnaHRcIiwgbGFiZWw6IHRoaXMuc3RyaW5ncy5wb3B1cCwgd2lkdGg6IFwiZnVsbFwiLCBzY2FsZTogXCJsXCIsIGNsYXNzOiBcInNrZXRjaC1wb3B1cC1idXR0b25cIiwgb25DbGljazogKGV2ZW50KSA9PiB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBpZiAoIXRoaXMuc2tldGNoUG9wdXBGbG93SXRlbSkge1xuICAgICAgICAgIHRoaXMuc2tldGNoUG9wdXBGbG93SXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYWxjaXRlLWZsb3ctaXRlbVwiKTtcbiAgICAgICAgICB0aGlzLnNrZXRjaFBvcHVwRmxvd0l0ZW0uaGVhZGluZyA9IHRoaXMuc3RyaW5ncy5za2V0Y2g7XG4gICAgICAgICAgdGhpcy5za2V0Y2hQb3B1cEZsb3dJdGVtLmRlc2NyaXB0aW9uID0gdGhpcy5zdHJpbmdzLnBvcHVwO1xuICAgICAgICAgIGNvbnN0IGNhbGNpdGVGYWIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FsY2l0ZS1mYWJcIik7XG4gICAgICAgICAgY2FsY2l0ZUZhYi5pY29uID0gXCJwbHVzXCI7XG4gICAgICAgICAgY2FsY2l0ZUZhYi5zbG90ID0gXCJmYWJcIjtcbiAgICAgICAgICBjYWxjaXRlRmFiLnNjYWxlID0gXCJzXCI7XG4gICAgICAgICAgY2FsY2l0ZUZhYi5hcHBlYXJhbmNlID0gXCJvdXRsaW5lLWZpbGxcIjtcbiAgICAgICAgICBjYWxjaXRlRmFiLmtpbmQgPSBcIm5ldXRyYWxcIjtcbiAgICAgICAgICBjYWxjaXRlRmFiLmxhYmVsID0gdGhpcy5zdHJpbmdzLmFkZENvbnRlbnQ7XG4gICAgICAgICAgY2FsY2l0ZUZhYi50ZXh0ID0gdGhpcy5zdHJpbmdzLmFkZENvbnRlbnQ7XG4gICAgICAgICAgY2FsY2l0ZUZhYi50ZXh0RW5hYmxlZCA9IHRydWU7XG4gICAgICAgICAgdGhpcy5za2V0Y2hQb3B1cEZsb3dJdGVtLmFwcGVuZENoaWxkKGNhbGNpdGVGYWIpO1xuICAgICAgICAgIGNvbnN0IHBvcHVwQ29tcG9uZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1wb3B1cFwiKTtcbiAgICAgICAgICBwb3B1cENvbXBvbmVudC5sYW5nID0gdGhpcy5jdXJyZW50TGFuZ3VhZ2U7XG4gICAgICAgICAgcG9wdXBDb21wb25lbnQubWFwVmlldyA9IHRoaXMubWFwVmlldztcbiAgICAgICAgICBwb3B1cENvbXBvbmVudC5sYXllckRpc3BsYXlUeXBlID0gbGF5ZXJEaXNwbGF5VHlwZUVudW0ubWFwTm90ZXM7XG4gICAgICAgICAgcG9wdXBDb21wb25lbnQubWFwTm90ZXNHcmFwaGljID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljO1xuICAgICAgICAgIHBvcHVwQ29tcG9uZW50Lm1hcE5vdGVzUG9wdXBUZW1wbGF0ZSA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8ucG9wdXA7XG4gICAgICAgICAgcG9wdXBDb21wb25lbnQuY2FsY2l0ZUZsb3dQcm9wcyA9IHtcbiAgICAgICAgICAgIGZsb3c6IHRoaXMuZmxvd0VsLFxuICAgICAgICAgICAgY2FsY2l0ZUZhYjogY2FsY2l0ZUZhYixcbiAgICAgICAgICAgIGNhbGNpdGVGbG93SXRlbTogdGhpcy5za2V0Y2hQb3B1cEZsb3dJdGVtXG4gICAgICAgICAgfTtcbiAgICAgICAgICB0aGlzLnNrZXRjaFBvcHVwRmxvd0l0ZW0uYXBwZW5kQ2hpbGQocG9wdXBDb21wb25lbnQpO1xuICAgICAgICAgIHRoaXMuZmxvd0VsLmFwcGVuZENoaWxkKHRoaXMuc2tldGNoUG9wdXBGbG93SXRlbSk7XG4gICAgICAgICAgdGhpcy5za2V0Y2hQb3B1cEZsb3dJdGVtLnNldEZvY3VzKCk7XG4gICAgICAgICAgdGhpcy5za2V0Y2hQb3B1cEZsb3dJdGVtLmJlZm9yZUJhY2sgPSBhc3luYyAoKSA9PiBhd2FpdCBwb3B1cENvbXBvbmVudC5kb25lKCk7XG4gICAgICAgICAgdGhpcy5tYXBWaWV3LmNsb3NlUG9wdXAoKTtcbiAgICAgICAgICBpZiAodGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljICYmIHRoaXMuY3VycmVudFNrZXRjaEluZm8ucG9wdXApIHtcbiAgICAgICAgICAgIHRoaXMubWFwVmlldy5vcGVuUG9wdXAoe1xuICAgICAgICAgICAgICBmZWF0dXJlczogW3RoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY10sXG4gICAgICAgICAgICAgIGxvY2F0aW9uOiBnZXRQb2ludEZyb21HZW9tZXRyeSh0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWMuZ2VvbWV0cnkpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gfSwgdGhpcy5zdHJpbmdzLnBvcHVwKSk7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJkaXZcIiwgeyBkaXI6IGdldEVsZW1lbnREaXIodGhpcy5ob3N0RWxlbWVudCkgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNrZXRjaC1jb250ZW50XCIgfSwgc2tldGNoVGl0bGUsIHBvcHVwQnRuLCAoKCkgPT4ge1xuICAgICAgc3dpdGNoICh0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRvb2wpIHtcbiAgICAgICAgY2FzZSBcInBvaW50XCI6XG4gICAgICAgICAgcmV0dXJuIHBvaW50O1xuICAgICAgICBjYXNlIFwidGV4dFwiOlxuICAgICAgICAgIHJldHVybiB0ZXh0O1xuICAgICAgICBjYXNlIFwicG9seWxpbmVcIjpcbiAgICAgICAgICByZXR1cm4gcG9seWxpbmU7XG4gICAgICAgIGNhc2UgXCJwb2x5Z29uXCI6XG4gICAgICAgIGNhc2UgXCJyZWN0YW5nbGVcIjpcbiAgICAgICAgY2FzZSBcImNpcmNsZVwiOlxuICAgICAgICAgIHJldHVybiBwb2x5Z29uO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH0pKCkpKSkpO1xuICB9XG4gIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTa2V0Y2hDb250ZW50LnN0eWxlID0gYXJjZ2lzU2tldGNoQ29udGVudENzcztcblxuY29uc3QgYXJjZ2lzU2tldGNoU2hvcnRjdXRzQ3NzID0gXCIuc2tldGNoLXNob3J0Y3V0e2JhY2tncm91bmQtY29sb3I6dmFyKC0tYXJjZ2lzLWFwcC1iYWNrZ3JvdW5kKTtkaXNwbGF5OmdyaWQ7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjIxJSBhdXRvO3Jvdy1nYXA6dmFyKC0tYXJjZ2lzLWFwcC1jYXAtc3BhY2luZy1oYWxmKTtwYWRkaW5nOnZhcigtLWFyY2dpcy1hcHAtY2FwLXNwYWNpbmctaGFsZil9LnNrZXRjaC1zaG9ydGN1dC1jaGlwe21hcmdpbi1yaWdodDp2YXIoLS1hcmNnaXMtYXBwLWNhcC1zcGFjaW5nLWhhbGYpfS5za2V0Y2gtc2hvcnRjdXQtbGFiZWx7YWxpZ24tc2VsZjpjZW50ZXJ9LnBvcG92ZXJ7ei1pbmRleDoxMDB9LmFyY2dpcy0tcnRsIC5za2V0Y2gtc2hvcnRjdXR7bWF4LWhlaWdodDo0MHZofS5hcmNnaXMtLXJ0bCAuc2tldGNoLXNob3J0Y3V0LWNoaXB7bWFyZ2luLWxlZnQ6dmFyKC0tYXJjZ2lzLWFwcC1jYXAtc3BhY2luZy1oYWxmKTttYXJnaW4tcmlnaHQ6MH1cIjtcblxuY29uc3QgQXJjZ2lzU2tldGNoU2hvcnRjdXRzID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc1NrZXRjaFNob3J0Y3V0c0Rpc21pc3NlZENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU2tldGNoU2hvcnRjdXRzRGlzbWlzc2VkQ2hhbmdlXCIsIDcpO1xuICAgIHRoaXMucmVmRWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xuICB9XG4gIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuc3RyaW5ncyA9IHNrZXRjaFN0YXRlLnN0cmluZ3M7XG4gIH1cbiAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICB0aGlzLmlzT3BlbiA9IHRydWU7XG4gIH1cbiAgYXN5bmMgcmVwb3NpdGlvbigpIHtcbiAgICB2YXIgX2E7XG4gICAgKF9hID0gdGhpcy5za2V0Y2hTaG9ydGN1dHNQb3BvdmVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVwb3NpdGlvbigpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCBpc1J0bCA9IGdldEVsZW1lbnREaXIodGhpcy5ob3N0RWxlbWVudCkgPT09IFwicnRsXCI7XG4gICAgY29uc3QgcGxhY2VtZW50ID0gIWlzUnRsID8gXCJsZWFkaW5nLXN0YXJ0XCIgOiBcInRyYWlsaW5nLXN0YXJ0XCI7XG4gICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwianMtYXBwLWZseW91dFwiIH0sIGgoXCJjYWxjaXRlLXBvcG92ZXJcIiwgeyBkaXI6IGdldEVsZW1lbnREaXIodGhpcy5ob3N0RWxlbWVudCksIGNsYXNzOiBcInBvcG92ZXIgXCIgKyAoZ2V0RWxlbWVudERpcih0aGlzLmhvc3RFbGVtZW50KSA9PT0gXCJydGxcIiA/IENTU19VVElMSVRZLnJ0bCA6IFwiXCIpLCByZWY6IChlbCkgPT4gKHRoaXMuc2tldGNoU2hvcnRjdXRzUG9wb3ZlciA9IGVsKSwgcGxhY2VtZW50OiBwbGFjZW1lbnQsIG9wZW46IHRoaXMuaXNPcGVuLCBwb2ludGVyRGlzYWJsZWQ6IHRydWUsIHJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMucmVmRWxlbWVudCwgb2Zmc2V0RGlzdGFuY2U6IC1NYXRoLnJvdW5kKHRoaXMucmVmRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCksIG9mZnNldFNraWRkaW5nOiAwLCBsYWJlbDogdGhpcy5zdHJpbmdzLnNrZXRjaFNob3J0Y3V0cyB9LCBoKFwiY2FsY2l0ZS1wYW5lbFwiLCB7IGhlYWRpbmc6IHRoaXMuc3RyaW5ncy5za2V0Y2hTaG9ydGN1dHMsIGNsb3NhYmxlOiB0cnVlLCBzdHlsZToge1xuICAgICAgICB3aWR0aDogYCR7TWF0aC5tYXgodGhpcy5yZWZFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoLCAzNzUpfXB4YFxuICAgICAgfSwgb25DYWxjaXRlUGFuZWxDbG9zZTogKCkgPT4gdGhpcy5hcmNnaXNTa2V0Y2hTaG9ydGN1dHNEaXNtaXNzZWRDaGFuZ2UuZW1pdCgpIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJza2V0Y2gtc2hvcnRjdXRcIiB9LCBoKFwiY2FsY2l0ZS1jaGlwXCIsIHsgY2xhc3M6IFwic2tldGNoLXNob3J0Y3V0LWNoaXBcIiwgdmFsdWU6IFwiQ3RybFwiLCBzY2FsZTogXCJtXCIgfSwgXCJDdHJsXCIpLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcInNrZXRjaC1zaG9ydGN1dC1sYWJlbFwiIH0sIHRoaXMuc3RyaW5ncy5jdHJsU2hvcnRjdXQpLCBoKFwiY2FsY2l0ZS1jaGlwXCIsIHsgY2xhc3M6IFwic2tldGNoLXNob3J0Y3V0LWNoaXBcIiwgdmFsdWU6IFwiRW50ZXJcIiwgc2NhbGU6IFwibVwiIH0sIFwiRW50ZXJcIiksIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgY2xhc3M6IFwic2tldGNoLXNob3J0Y3V0LWxhYmVsXCIgfSwgdGhpcy5zdHJpbmdzLmNTaG9ydGN1dCksIGgoXCJjYWxjaXRlLWNoaXBcIiwgeyBjbGFzczogXCJza2V0Y2gtc2hvcnRjdXQtY2hpcFwiLCB2YWx1ZTogXCJaXCIsIHNjYWxlOiBcIm1cIiB9LCBcIlpcIiksIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgY2xhc3M6IFwic2tldGNoLXNob3J0Y3V0LWxhYmVsXCIgfSwgdGhpcy5zdHJpbmdzLnpTaG9ydGN1dCksIGgoXCJjYWxjaXRlLWNoaXBcIiwgeyBjbGFzczogXCJza2V0Y2gtc2hvcnRjdXQtY2hpcFwiLCB2YWx1ZTogXCJSXCIsIHNjYWxlOiBcIm1cIiB9LCBcIlJcIiksIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgY2xhc3M6IFwic2tldGNoLXNob3J0Y3V0LWxhYmVsXCIgfSwgdGhpcy5zdHJpbmdzLnJTaG9ydGN1dCksIGgoXCJjYWxjaXRlLWNoaXBcIiwgeyBjbGFzczogXCJza2V0Y2gtc2hvcnRjdXQtY2hpcFwiLCB2YWx1ZTogXCJFc2NcIiwgc2NhbGU6IFwibVwiIH0sIFwiRXNjXCIpLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcInNrZXRjaC1zaG9ydGN1dC1sYWJlbFwiIH0sIHRoaXMuc3RyaW5ncy5lc2NTaG9ydGN1dCkpKSkpKTtcbiAgfVxuICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU2tldGNoU2hvcnRjdXRzLnN0eWxlID0gYXJjZ2lzU2tldGNoU2hvcnRjdXRzQ3NzO1xuXG5jb25zdCBhcmNnaXNTa2V0Y2hTbmFwcGluZ0NzcyA9IFwiLmNvbnRlbnR7bWF4LWhlaWdodDo2MHZofVwiO1xuXG5jb25zdCBBcmNnaXNTa2V0Y2hTbmFwcGluZyA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5jbG9zZVNrZXRjaFNuYXBwaW5nUG9wb3ZlcnMgPSBjcmVhdGVFdmVudCh0aGlzLCBcImNsb3NlU2tldGNoU25hcHBpbmdQb3BvdmVyc1wiLCA3KTtcbiAgICB0aGlzLnJlZkVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdHJpbmdzID0gc2tldGNoU3RhdGUuc3RyaW5ncztcbiAgICB0aGlzLm1hcFZpZXcgPSBza2V0Y2hTdGF0ZS5tYXBWaWV3O1xuICAgIHRoaXMuc25hcHBpbmdPcHRpb25zID0gc2tldGNoU3RhdGUuc25hcHBpbmdPcHRpb25zO1xuICAgIHRoaXMuc25hcHBpbmdTZXNzaW9uU3RvcmFnZUlkcyA9IHNrZXRjaFN0YXRlLnNuYXBwaW5nU2Vzc2lvblN0b3JhZ2VJZHM7XG4gICAgdGhpcy5za2V0Y2hUb29sdGlwT3B0aW9ucyA9IHNrZXRjaFN0YXRlLnNrZXRjaFRvb2x0aXBPcHRpb25zO1xuICAgIHRoaXMuc2tldGNoVG9vbHRpcFNlc3Npb25TdG9yYWdlSWRzID0gc2tldGNoU3RhdGUuc2tldGNoVG9vbHRpcFNlc3Npb25TdG9yYWdlSWRzO1xuICAgIGF3YWl0IHRoaXMubG9hZEFsbE1vZHVsZXMoKTtcbiAgICB0aGlzLmFkZFNuYXBwaW5nV2lkZ2V0KCk7XG4gICAgdGhpcy5hZGRUb29sdGlwc1dpZGdldCgpO1xuICB9XG4gIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgdGhpcy5zbmFwcGluZ0NvbnRyb2xzLmNvbnRhaW5lciA9IHRoaXMuc25hcHBpbmdDb250cm9sRGl2O1xuICAgIHRoaXMuc2tldGNoVG9vbHRpcENvbnRyb2xzLmNvbnRhaW5lciA9IHRoaXMuc2tldGNoVG9vbHRpcENvbnRyb2xEaXY7XG4gIH1cbiAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICAoX2EgPSB0aGlzLnNuYXBwaW5nQ29udHJvbHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kZXN0cm95KCk7XG4gICAgKF9iID0gdGhpcy5za2V0Y2hUb29sdGlwQ29udHJvbHMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5kZXN0cm95KCk7XG4gIH1cbiAgYXN5bmMgcmVwb3NpdGlvbigpIHtcbiAgICB2YXIgX2E7XG4gICAgKF9hID0gdGhpcy5za2V0Y2hTbmFwcGluZ1BvcG92ZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZXBvc2l0aW9uKCk7XG4gIH1cbiAgYXN5bmMgbG9hZEFsbE1vZHVsZXMoKSB7XG4gICAgY29uc3QgW1NuYXBwaW5nQ29udHJvbHMsIFNrZXRjaFRvb2x0aXBDb250cm9sc10gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXG4gICAgICBcImVzcmkvd2lkZ2V0cy9zdXBwb3J0L1NuYXBwaW5nQ29udHJvbHNcIixcbiAgICAgIFwiZXNyaS93aWRnZXRzL3N1cHBvcnQvU2tldGNoVG9vbHRpcENvbnRyb2xzXCJcbiAgICBdKTtcbiAgICB0aGlzLlNuYXBwaW5nQ29udHJvbHMgPSBTbmFwcGluZ0NvbnRyb2xzO1xuICAgIHRoaXMuU2tldGNoVG9vbHRpcENvbnRyb2xzID0gU2tldGNoVG9vbHRpcENvbnRyb2xzO1xuICB9XG4gIGFkZFNuYXBwaW5nV2lkZ2V0KCkge1xuICAgIHRoaXMuc25hcHBpbmdDb250cm9scyA9IG5ldyB0aGlzLlNuYXBwaW5nQ29udHJvbHMoe1xuICAgICAgdmlldzogdGhpcy5tYXBWaWV3LFxuICAgICAgc25hcHBpbmdPcHRpb25zOiBza2V0Y2hTdGF0ZS5zbmFwcGluZ09wdGlvbnMsXG4gICAgICB2aXNpYmxlRWxlbWVudHM6IHtcbiAgICAgICAgaGVhZGVyOiBmYWxzZVxuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGFkZFRvb2x0aXBzV2lkZ2V0KCkge1xuICAgIHRoaXMuc2tldGNoVG9vbHRpcENvbnRyb2xzID0gbmV3IHRoaXMuU2tldGNoVG9vbHRpcENvbnRyb2xzKHtcbiAgICAgIHZpZXc6IHRoaXMubWFwVmlldyxcbiAgICAgIHRvb2x0aXBPcHRpb25zOiBza2V0Y2hTdGF0ZS5za2V0Y2hUb29sdGlwT3B0aW9ucyxcbiAgICAgIHZpc2libGVFbGVtZW50czoge1xuICAgICAgICB0b29sdGlwc1RvZ2dsZTogdHJ1ZSxcbiAgICAgICAgbGFiZWxzVG9nZ2xlOiBmYWxzZVxuICAgICAgfVxuICAgIH0gLyogX19lc3JpLlNrZXRjaFRvb2x0aXBDb250cm9sc1Byb3BlcnRpZXMgKi8pO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJqcy1hcHAtZmx5b3V0XCIgfSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IGRpcjogZ2V0RWxlbWVudERpcih0aGlzLmhvc3RFbGVtZW50KSwgcGxhY2VtZW50OiBcImxlYWRpbmctc3RhcnRcIiwgcmVmOiAoZWwpID0+ICh0aGlzLnNrZXRjaFNuYXBwaW5nUG9wb3ZlciA9IGVsKSwgb3BlbjogdHJ1ZSwgcG9pbnRlckRpc2FibGVkOiB0cnVlLCByZWZlcmVuY2VFbGVtZW50OiB0aGlzLnJlZkVsZW1lbnQsIG9mZnNldERpc3RhbmNlOiAtTWF0aC5yb3VuZCh0aGlzLnJlZkVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGgpLCBvZmZzZXRTa2lkZGluZzogMCwgbGFiZWw6IHRoaXMuc3RyaW5ncy5zZXR0aW5ncywgc3R5bGU6IHtcbiAgICAgICAgekluZGV4OiBcIjEwMFwiXG4gICAgICB9IH0sIGgoXCJjYWxjaXRlLXBhbmVsXCIsIHsgY2xvc2FibGU6IHRydWUsIGhlYWRpbmdMZXZlbDogMiwgaGVhZGluZzogdGhpcy5zdHJpbmdzLnNldHRpbmdzLCBzdHlsZToge1xuICAgICAgICB3aWR0aDogYCR7dGhpcy5yZWZFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRofXB4YFxuICAgICAgfSwgb25DYWxjaXRlUGFuZWxDbG9zZTogKCkgPT4ge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBpZiAoKF9hID0gdGhpcy5zbmFwcGluZ1Nlc3Npb25TdG9yYWdlSWRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY3VycmVudCkge1xuICAgICAgICAgIHNhdmVTbmFwcGluZ1RvU3RvcmFnZSh0aGlzLnNuYXBwaW5nT3B0aW9ucywgdGhpcy5zbmFwcGluZ1Nlc3Npb25TdG9yYWdlSWRzLmN1cnJlbnQpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgoX2IgPSB0aGlzLnNrZXRjaFRvb2x0aXBTZXNzaW9uU3RvcmFnZUlkcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmN1cnJlbnQpIHtcbiAgICAgICAgICBzYXZlU2tldGNoVG9vbHRpcFRvU3RvcmFnZSh0aGlzLnNrZXRjaFRvb2x0aXBPcHRpb25zLCB0aGlzLnNrZXRjaFRvb2x0aXBTZXNzaW9uU3RvcmFnZUlkcy5jdXJyZW50KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNsb3NlU2tldGNoU25hcHBpbmdQb3BvdmVycy5lbWl0KCk7XG4gICAgICB9IH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjb250ZW50XCIgfSwgaChcImRpdlwiLCB7IHJlZjogKGVsKSA9PiAodGhpcy5za2V0Y2hUb29sdGlwQ29udHJvbERpdiA9IGVsKSB9KSwgaChcImRpdlwiLCB7IHJlZjogKGVsKSA9PiAodGhpcy5zbmFwcGluZ0NvbnRyb2xEaXYgPSBlbCkgfSkpKSkpKTtcbiAgfVxuICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU2tldGNoU25hcHBpbmcuc3R5bGUgPSBhcmNnaXNTa2V0Y2hTbmFwcGluZ0NzcztcblxuY29uc3QgYXJjZ2lzU2tldGNoVG9vbHNDc3MgPSBcIi5wb3BvdmVye3otaW5kZXg6MTAwfVwiO1xuXG5jb25zdCBBcmNnaXNTa2V0Y2hUb29scyA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5za2V0Y2hBY3Rpb25PbkRyYXdGZWF0dXJlcyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwic2tldGNoQWN0aW9uT25EcmF3RmVhdHVyZXNcIiwgNyk7XG4gICAgdGhpcy5za2V0Y2hBY3Rpb25PblNlbGVjdEZlYXR1cmVzID0gY3JlYXRlRXZlbnQodGhpcywgXCJza2V0Y2hBY3Rpb25PblNlbGVjdEZlYXR1cmVzXCIsIDcpO1xuICAgIHRoaXMucmVmRWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm1hcE5vdGVzRmVhdHVyZSA9IG51bGw7XG4gICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcbiAgfVxuICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLnN0cmluZ3MgPSBza2V0Y2hTdGF0ZS5zdHJpbmdzO1xuICAgIHRoaXMuc3ZNb2RlbCA9IHNrZXRjaFN0YXRlLnN2TW9kZWw7XG4gICAgdGhpcy5sYXllciA9IHNrZXRjaFN0YXRlLmxheWVyO1xuICB9XG4gIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgLy8gc2VsZWN0IG1vZGUgaWYgZmVhdHVyZSBpcyBhdmFpbGFibGUsIGVsc2UgZGVmYXVsdCBhZGQgcG9pbnQgbW9kZVxuICAgIGlmICh0aGlzLm1hcE5vdGVzRmVhdHVyZSkge1xuICAgICAgdGhpcy5hY3Rpb25PblNlbGVjdEZlYXR1cmVzKHRoaXMuc3RyaW5ncy5zZWxlY3RUZXh0LCB0aGlzLnNrZXRjaFNlbGVjdCk7XG4gICAgICBzd2l0Y2ggKHRoaXMubWFwTm90ZXNGZWF0dXJlLmxheWVyKSB7XG4gICAgICAgIGNhc2UgdGhpcy5sYXllci5wb2ludExheWVyOlxuICAgICAgICAgIHRoaXMuc3ZNb2RlbC51cGRhdGVQb2ludChbdGhpcy5tYXBOb3Rlc0ZlYXR1cmVdKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSB0aGlzLmxheWVyLnRleHRMYXllcjpcbiAgICAgICAgICB0aGlzLnN2TW9kZWwudXBkYXRlVGV4dChbdGhpcy5tYXBOb3Rlc0ZlYXR1cmVdKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSB0aGlzLmxheWVyLnBvbHlsaW5lTGF5ZXI6XG4gICAgICAgICAgdGhpcy5zdk1vZGVsLnVwZGF0ZUxpbmUoW3RoaXMubWFwTm90ZXNGZWF0dXJlXSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgdGhpcy5sYXllci5wb2x5Z29uTGF5ZXI6XG4gICAgICAgICAgdGhpcy5zdk1vZGVsLnVwZGF0ZVBvbHlnb24oW3RoaXMubWFwTm90ZXNGZWF0dXJlXSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuYWN0aW9uT25EcmF3RmVhdHVyZXMoXCJwb2ludFwiLCB0aGlzLnN0cmluZ3MuYWRkU3RhbXAsIHRoaXMuc2tldGNoUG9pbnQpO1xuICAgIH1cbiAgICB0aGlzLmlzT3BlbiA9IHRydWU7XG4gIH1cbiAgYXN5bmMgcmVwb3NpdGlvbigpIHtcbiAgICB2YXIgX2E7XG4gICAgKF9hID0gdGhpcy5za2V0Y2hUb29sc1BvcG92ZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZXBvc2l0aW9uKCk7XG4gIH1cbiAgYWN0aW9uT25EcmF3RmVhdHVyZXModG9vbCwgc2tldGNoTWVzc2FnZSwgY3VycmVudEFjdGlvbkVsZW1lbnQpIHtcbiAgICB0aGlzLmNsZWFyQWN0aXZlU2VsZWN0aW9uKCk7XG4gICAgY3VycmVudEFjdGlvbkVsZW1lbnQuYWN0aXZlID0gdHJ1ZTtcbiAgICB0aGlzLnNrZXRjaEFjdGlvbk9uRHJhd0ZlYXR1cmVzLmVtaXQoe1xuICAgICAgdG9vbDogdG9vbCxcbiAgICAgIHNrZXRjaE1lc3NhZ2U6IHNrZXRjaE1lc3NhZ2VcbiAgICB9KTtcbiAgfVxuICBhY3Rpb25PblNlbGVjdEZlYXR1cmVzKHNrZXRjaE1lc3NhZ2UsIGN1cnJlbnRBY3Rpb25FbGVtZW50LCBtdWx0aXBsZVNlbGVjdFRvb2wpIHtcbiAgICBjb25zdCB7IGFjdGl2ZSA9IGZhbHNlIH0gPSBjdXJyZW50QWN0aW9uRWxlbWVudDtcbiAgICB0aGlzLmNsZWFyQWN0aXZlU2VsZWN0aW9uKCk7XG4gICAgY3VycmVudEFjdGlvbkVsZW1lbnQuYWN0aXZlID0gIWFjdGl2ZTtcbiAgICB0aGlzLnN2TW9kZWwuY2FuY2VsKCk7XG4gICAgdGhpcy5za2V0Y2hBY3Rpb25PblNlbGVjdEZlYXR1cmVzLmVtaXQoe1xuICAgICAgc2tldGNoTWVzc2FnZTogIWFjdGl2ZSA/IHNrZXRjaE1lc3NhZ2UgOiBcIlwiLFxuICAgICAgbXVsdGlwbGVTZWxlY3RUb29sOiAoIWFjdGl2ZSAmJiBtdWx0aXBsZVNlbGVjdFRvb2wpIHx8IG51bGxcbiAgICB9KTtcbiAgfVxuICBjbGVhckFjdGl2ZVNlbGVjdGlvbigpIHtcbiAgICB0aGlzLnNrZXRjaFBvaW50LmFjdGl2ZSA9IGZhbHNlO1xuICAgIHRoaXMuc2tldGNoUG9seUxpbmUuYWN0aXZlID0gZmFsc2U7XG4gICAgdGhpcy5za2V0Y2hQb2x5Z29uLmFjdGl2ZSA9IGZhbHNlO1xuICAgIHRoaXMuc2tldGNoUmVjdGFuZ2xlLmFjdGl2ZSA9IGZhbHNlO1xuICAgIHRoaXMuc2tldGNoQ2lyY2xlLmFjdGl2ZSA9IGZhbHNlO1xuICAgIHRoaXMuc2tldGNoVGV4dC5hY3RpdmUgPSBmYWxzZTtcbiAgICB0aGlzLnNrZXRjaFNlbGVjdC5hY3RpdmUgPSBmYWxzZTtcbiAgICB0aGlzLnNrZXRjaFJlY3RhbmdsZVNlbGVjdC5hY3RpdmUgPSBmYWxzZTtcbiAgICB0aGlzLnNrZXRjaExhc3NvU2VsZWN0LmFjdGl2ZSA9IGZhbHNlO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCBkcmF3RmVhdHVyZXMgPSAoaChcImNhbGNpdGUtYWN0aW9uLWdyb3VwXCIsIHsgbGF5b3V0OiBcInZlcnRpY2FsXCIgfSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLnNrZXRjaFBvaW50ID0gZWwpLCB0ZXh0OiB0aGlzLnN0cmluZ3Muc3RhbXAsIGxhYmVsOiB0aGlzLnN0cmluZ3Muc3RhbXAsIHRpdGxlOiB0aGlzLnN0cmluZ3Muc3RhbXAsIGljb246IFwicGluXCIsIHNjYWxlOiBcIm1cIiwgYWxpZ25tZW50OiBcImNlbnRlclwiLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuYWN0aW9uT25EcmF3RmVhdHVyZXMoXCJwb2ludFwiLCB0aGlzLnN0cmluZ3MuYWRkU3RhbXAsIHRoaXMuc2tldGNoUG9pbnQpO1xuICAgICAgfSB9KSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLnNrZXRjaFBvbHlMaW5lID0gZWwpLCB0ZXh0OiB0aGlzLnN0cmluZ3MubGluZSwgbGFiZWw6IHRoaXMuc3RyaW5ncy5saW5lLCB0aXRsZTogdGhpcy5zdHJpbmdzLmxpbmUsIGljb246IFwibGluZVwiLCBzY2FsZTogXCJtXCIsIGFsaWdubWVudDogXCJjZW50ZXJcIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICB0aGlzLmFjdGlvbk9uRHJhd0ZlYXR1cmVzKFwicG9seWxpbmVcIiwgdGhpcy5zdHJpbmdzLnN0YXJ0RmluaXNoRHJhd2luZywgdGhpcy5za2V0Y2hQb2x5TGluZSk7XG4gICAgICB9IH0pLCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuc2tldGNoUG9seWdvbiA9IGVsKSwgdGV4dDogdGhpcy5zdHJpbmdzLnBvbHlnb24sIGxhYmVsOiB0aGlzLnN0cmluZ3MucG9seWdvbiwgdGl0bGU6IHRoaXMuc3RyaW5ncy5wb2x5Z29uLCBpY29uOiBcInBvbHlnb25cIiwgc2NhbGU6IFwibVwiLCBhbGlnbm1lbnQ6IFwiY2VudGVyXCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgdGhpcy5hY3Rpb25PbkRyYXdGZWF0dXJlcyhcInBvbHlnb25cIiwgdGhpcy5zdHJpbmdzLnN0YXJ0RmluaXNoRHJhd2luZywgdGhpcy5za2V0Y2hQb2x5Z29uKTtcbiAgICAgIH0gfSksIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHJlZjogKGVsKSA9PiAodGhpcy5za2V0Y2hSZWN0YW5nbGUgPSBlbCksIHRleHQ6IHRoaXMuc3RyaW5ncy5yZWN0YW5nbGUsIGxhYmVsOiB0aGlzLnN0cmluZ3MucmVjdGFuZ2xlLCB0aXRsZTogdGhpcy5zdHJpbmdzLnJlY3RhbmdsZSwgaWNvbjogXCJyZWN0YW5nbGVcIiwgc2NhbGU6IFwibVwiLCBhbGlnbm1lbnQ6IFwiY2VudGVyXCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgdGhpcy5hY3Rpb25PbkRyYXdGZWF0dXJlcyhcInJlY3RhbmdsZVwiLCB0aGlzLnN0cmluZ3MuYWRkUmVjdGFuZ2xlLCB0aGlzLnNrZXRjaFJlY3RhbmdsZSk7XG4gICAgICB9IH0pLCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuc2tldGNoQ2lyY2xlID0gZWwpLCB0ZXh0OiB0aGlzLnN0cmluZ3MuY2lyY2xlLCBsYWJlbDogdGhpcy5zdHJpbmdzLmNpcmNsZSwgdGl0bGU6IHRoaXMuc3RyaW5ncy5jaXJjbGUsIGljb246IFwiY2lyY2xlXCIsIHNjYWxlOiBcIm1cIiwgYWxpZ25tZW50OiBcImNlbnRlclwiLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuYWN0aW9uT25EcmF3RmVhdHVyZXMoXCJjaXJjbGVcIiwgdGhpcy5zdHJpbmdzLmFkZENpcmNsZSwgdGhpcy5za2V0Y2hDaXJjbGUpO1xuICAgICAgfSB9KSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLnNrZXRjaFRleHQgPSBlbCksIHRleHQ6IHRoaXMuc3RyaW5ncy50ZXh0LCBsYWJlbDogdGhpcy5zdHJpbmdzLnRleHQsIHRpdGxlOiB0aGlzLnN0cmluZ3MudGV4dCwgaWNvbjogXCJ0ZXh0XCIsIHNjYWxlOiBcIm1cIiwgYWxpZ25tZW50OiBcImNlbnRlclwiLCBvbkNsaWNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgIHRoaXMuYWN0aW9uT25EcmF3RmVhdHVyZXMoXCJ0ZXh0XCIsIHRoaXMuc3RyaW5ncy5hZGRUZXh0LCB0aGlzLnNrZXRjaFRleHQpO1xuICAgICAgfSB9KSkpO1xuICAgIGNvbnN0IHNlbGVjdEZlYXR1cmVzID0gKGgoXCJjYWxjaXRlLWFjdGlvbi1ncm91cFwiLCB7IGxheW91dDogXCJ2ZXJ0aWNhbFwiIH0sIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHJlZjogKGVsKSA9PiAodGhpcy5za2V0Y2hTZWxlY3QgPSBlbCksIHRleHQ6IHRoaXMuc3RyaW5ncy5zZWxlY3QsIGxhYmVsOiB0aGlzLnN0cmluZ3Muc2VsZWN0LCB0aXRsZTogdGhpcy5zdHJpbmdzLnNlbGVjdCwgaWNvbjogXCJjdXJzb3JcIiwgc2NhbGU6IFwibVwiLCBhbGlnbm1lbnQ6IFwiY2VudGVyXCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgdGhpcy5hY3Rpb25PblNlbGVjdEZlYXR1cmVzKHRoaXMuc3RyaW5ncy5zZWxlY3RUZXh0LCB0aGlzLnNrZXRjaFNlbGVjdCk7XG4gICAgICB9IH0pLCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuc2tldGNoUmVjdGFuZ2xlU2VsZWN0ID0gZWwpLCB0ZXh0OiB0aGlzLnN0cmluZ3MucmVjdGFuZ2xlU2VsZWN0LCBsYWJlbDogdGhpcy5zdHJpbmdzLnJlY3RhbmdsZVNlbGVjdCwgdGl0bGU6IHRoaXMuc3RyaW5ncy5yZWN0YW5nbGVTZWxlY3QsIGljb246IFwiY3Vyc29yLW1hcnF1ZWVcIiwgc2NhbGU6IFwibVwiLCBhbGlnbm1lbnQ6IFwiY2VudGVyXCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgdGhpcy5hY3Rpb25PblNlbGVjdEZlYXR1cmVzKHRoaXMuc3RyaW5ncy5yZWN0YW5nbGVMYXNzb1NlbGVjdCwgdGhpcy5za2V0Y2hSZWN0YW5nbGVTZWxlY3QsIFwicmVjdGFuZ2xlXCIpO1xuICAgICAgfSB9KSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLnNrZXRjaExhc3NvU2VsZWN0ID0gZWwpLCB0ZXh0OiB0aGlzLnN0cmluZ3MubGFzc29TZWxlY3QsIGxhYmVsOiB0aGlzLnN0cmluZ3MubGFzc29TZWxlY3QsIHRpdGxlOiB0aGlzLnN0cmluZ3MubGFzc29TZWxlY3QsIGljb246IFwibGFzc29cIiwgc2NhbGU6IFwibVwiLCBhbGlnbm1lbnQ6IFwiY2VudGVyXCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgdGhpcy5hY3Rpb25PblNlbGVjdEZlYXR1cmVzKHRoaXMuc3RyaW5ncy5yZWN0YW5nbGVMYXNzb1NlbGVjdCwgdGhpcy5za2V0Y2hMYXNzb1NlbGVjdCwgXCJsYXNzb1wiKTtcbiAgICAgIH0gfSkpKTtcbiAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJqcy1hcHAtZmx5b3V0XCIgfSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IGRpcjogZ2V0RWxlbWVudERpcih0aGlzLmhvc3RFbGVtZW50KSwgcmVmOiAoZWwpID0+ICh0aGlzLnNrZXRjaFRvb2xzUG9wb3ZlciA9IGVsKSwgcGxhY2VtZW50OiBcImxlYWRpbmctc3RhcnRcIiwgb3BlbjogdGhpcy5pc09wZW4sIHJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMucmVmRWxlbWVudCwgb2Zmc2V0RGlzdGFuY2U6IDE1LCBwb2ludGVyRGlzYWJsZWQ6IHRydWUsIGZvY3VzVHJhcERpc2FibGVkOiB0cnVlLCB0cmlnZ2VyRGlzYWJsZWQ6IHRydWUsIGxhYmVsOiB0aGlzLnN0cmluZ3Muc2tldGNoLCBjbGFzczogXCJwb3BvdmVyXCIsIG9uQ2FsY2l0ZVBvcG92ZXJCZWZvcmVDbG9zZTogKCkgPT4gKHRoaXMuc2tldGNoVG9vbHNQb3BvdmVyLm9wZW4gPSB0cnVlKSB9LCBoKFwiY2FsY2l0ZS1hY3Rpb24tcGFkXCIsIHsgcG9zaXRpb246IFwic3RhcnRcIiwgbGF5b3V0OiBcInZlcnRpY2FsXCIsIGV4cGFuZERpc2FibGVkOiB0cnVlIH0sIGRyYXdGZWF0dXJlcywgc2VsZWN0RmVhdHVyZXMpKSkpO1xuICB9XG4gIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTa2V0Y2hUb29scy5zdHlsZSA9IGFyY2dpc1NrZXRjaFRvb2xzQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNTa2V0Y2ggYXMgYXJjZ2lzX3NrZXRjaCwgQXJjZ2lzU2tldGNoQ29udGVudCBhcyBhcmNnaXNfc2tldGNoX2NvbnRlbnQsIEFyY2dpc1NrZXRjaFNob3J0Y3V0cyBhcyBhcmNnaXNfc2tldGNoX3Nob3J0Y3V0cywgQXJjZ2lzU2tldGNoU25hcHBpbmcgYXMgYXJjZ2lzX3NrZXRjaF9zbmFwcGluZywgQXJjZ2lzU2tldGNoVG9vbHMgYXMgYXJjZ2lzX3NrZXRjaF90b29scyB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG4vKipcbiAqIENhbGwgYSBmdW5jdGlvbiBvbmx5IGFmdGVyIGl0IGhhcyBub3QgYmVlbiBjYWxsZWQgZm9yIG4gbWlsbGlzZWNvbmRzXG4gKiBAcGFyYW0gZm4gICAgLSBmdW5jdGlvbiB0byBjYWxsXG4gKiBAcGFyYW0gZGVsYXkgLSBkZWxheSBpbiBtaWxsaXNlY29uZHNcbiAqL1xuY29uc3QgZGVib3VuY2UgPSAoZm4sIGRlbGF5KSA9PiB7XG4gIGxldCB0aW1lb3V0O1xuICBsZXQgc3RhdHVzID0gXCJpZGxlXCI7XG4gIGZ1bmN0aW9uIGZsdXNoKC4uLmFyZ3MpIHtcbiAgICBzdGF0dXMgPSBcImZsdXNoZWRcIjtcbiAgICByZXR1cm4gZGVib3VuY2VkKC4uLmFyZ3MpO1xuICB9XG4gIGZ1bmN0aW9uIGludm9rZSguLi5hcmdzKSB7XG4gICAgc3RhdHVzID0gXCJpbnZva2VkXCI7XG4gICAgcmV0dXJuIGRlYm91bmNlZCguLi5hcmdzKTtcbiAgfVxuICBmdW5jdGlvbiBjYW5jZWwoLi4uYXJncykge1xuICAgIHN0YXR1cyA9IFwiY2FuY2VsbGVkXCI7XG4gICAgcmV0dXJuIGRlYm91bmNlZCguLi5hcmdzKTtcbiAgfVxuICBmdW5jdGlvbiBnZXRTdGF0dXMoKSB7XG4gICAgcmV0dXJuIHN0YXR1cztcbiAgfVxuICBjb25zdCBkZWJvdW5jZWQgPSAoLi4uYXJncykgPT4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICBzd2l0Y2ggKHN0YXR1cykge1xuICAgICAgY2FzZSBcImZsdXNoZWRcIjpcbiAgICAgICAgc3RhdHVzID0gXCJpZGxlXCI7XG4gICAgICAgIGlmICh0aW1lb3V0KSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICAgIHJlc29sdmUoZm4oLi4uYXJncykpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiaW52b2tlZFwiOlxuICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgIHN0YXR1cyA9IFwiaWRsZVwiO1xuICAgICAgICByZXNvbHZlKGZuKC4uLmFyZ3MpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiY2FuY2VsbGVkXCI6XG4gICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgc3RhdHVzID0gXCJpZGxlXCI7XG4gICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgIH1cbiAgICAgICAgc3RhdHVzID0gXCJwZW5kaW5nXCI7XG4gICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICBzdGF0dXMgPSBcImlkbGVcIjtcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZShmbiguLi5hcmdzKSk7XG4gICAgICAgIH0sIGRlbGF5KTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9KTtcbiAgZGVib3VuY2VkLmZsdXNoID0gZmx1c2g7XG4gIGRlYm91bmNlZC5pbnZva2UgPSBpbnZva2U7XG4gIGRlYm91bmNlZC5jYW5jZWwgPSBjYW5jZWw7XG4gIGRlYm91bmNlZC5nZXRTdGF0dXMgPSBnZXRTdGF0dXM7XG4gIHJldHVybiBkZWJvdW5jZWQ7XG59O1xuLyoqXG4gKiBDYWxsIGEgZnVuY3Rpb24gb25seSBhZnRlciBuIG1pbGxpc2Vjb25kcyBoYXZlIGVsYXBzZWRcbiAqIEBwYXJhbSBmbiAgICAtIGZ1bmN0aW9uIHRvIGNhbGxcbiAqIEBwYXJhbSBkZWxheSAtIGRlbGF5IGluIG1pbGxpc2Vjb25kc1xuICovXG5jb25zdCB0aHJvdHRsZSA9IChmbiwgZGVsYXkpID0+IHtcbiAgbGV0IHRpbWVvdXQ7XG4gIHJldHVybiAoLi4uYXJncykgPT4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICBpZiAodGltZW91dCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICB0aW1lb3V0ID0gdW5kZWZpbmVkO1xuICAgICAgcmVzb2x2ZShmbiguLi5hcmdzKSk7XG4gICAgfSwgZGVsYXkpO1xuICB9KTtcbn07XG5mdW5jdGlvbiBlc2NhcGVSZWdFeHAoc3RyKSB7XG4gIHJldHVybiBzdHIucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csIFwiXFxcXCQmXCIpOyAvLyAkJiBtZWFucyB0aGUgd2hvbGUgbWF0Y2hlZCBzdHJpbmdcbn1cbmZ1bmN0aW9uIGlzRGVmaW5lZCh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbDtcbn1cbi8qKlxuICogU2V0IGEgbWluaW11bSB0aW1lIGZvciBhIHByb21pc2UgdG8gcmVzb2x2ZSAodXNlZnVsIGZvciBwcmV2ZW50aW5nIGZsYXNoIG9mIGxvYWRlcnMpXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIG1pbkRlbGF5KHByb21pc2UsIG1pbkRlbGF5KSB7XG4gIGF3YWl0IFByb21pc2UuYWxsKFtwcm9taXNlLCB0aW1lb3V0KG1pbkRlbGF5KV0pO1xuICByZXR1cm4gcHJvbWlzZTtcbn1cbi8qKlxuICogSGVscGVyIG1ldGhvZCB0byBpbmxpbmUgc2V0VGltZW91dCBhcyBhbiBhd2FpdCBpbiBhc3luYyBmdW5jdGlvbnNcbiAqL1xuZnVuY3Rpb24gdGltZW91dChtcykge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbn1cbmNvbnN0IGFycmF5VG9Mb29rdXBNYXAgPSAoZGF0YUFyciwgZ2V0S2V5QW5kSXRlbSkgPT4gT2JqZWN0LmZyb21FbnRyaWVzKChkYXRhQXJyIHx8IFtdKS5tYXAoKGl0ZW0pID0+IHtcbiAgY29uc3QgeyBrZXksIGRhdGEgfSA9IGdldEtleUFuZEl0ZW0oaXRlbSk7XG4gIHJldHVybiBba2V5LCBkYXRhXTtcbn0pKTtcbi8qKlxuICogQ2hlY2sgd2hldGhlciB0d28gYXJyYXlzIGhhdmUgdGhlIHNhbWUgbnVtYmVyIG9mIGVsZW1lbnRzXG4gKiBhbmQgd2hldGhlciB0aGV5IGNvbnRhaW4gdGhlIHNhbWUgZWxlbWVudHNcbiAqIHJlZ2FyZGxlc3Mgb2Ygb3JkZXJcbiAqL1xuY29uc3QgYXJyYXlzQXJlRXF1aXZhbGVudCA9IChhcnIxLCBhcnIyKSA9PiBhcnIxLmxlbmd0aCA9PT0gYXJyMi5sZW5ndGggJiYgYXJyMS5yZWR1Y2UoKG1lbW8sIHN0cikgPT4gbWVtbyAmJiBhcnIyLmluZGV4T2Yoc3RyKSA+IC0xLCB0cnVlKTtcbmZ1bmN0aW9uIHVuaXF1ZUJ5KG15QXJyLCBnZXRJdGVtSWQpIHtcbiAgY29uc3QgcmVzdWx0QXJyID0gW107XG4gIGNvbnN0IGxvb2t1cE1hcCA9IHt9O1xuICBteUFyci5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgY29uc3QgaWQgPSBnZXRJdGVtSWQoaXRlbSk7XG4gICAgaWYgKGxvb2t1cE1hcFtpZF0gPT0gbnVsbCkge1xuICAgICAgbG9va3VwTWFwW2lkXSA9IGl0ZW07XG4gICAgICByZXN1bHRBcnIucHVzaChpdGVtKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gcmVzdWx0QXJyO1xufVxuZnVuY3Rpb24gdW5pcXVlKG15QXJyKSB7XG4gIGNvbnN0IHByaW1pdGl2ZXMgPSB7IGJvb2xlYW46IHt9LCBudW1iZXI6IHt9LCBzdHJpbmc6IHt9IH07XG4gIGNvbnN0IG9ianMgPSBbXTtcbiAgcmV0dXJuIG15QXJyLmZpbHRlcigoaXRlbSkgPT4ge1xuICAgIGxldCB0eXBlID0gdHlwZW9mIGl0ZW07XG4gICAgaWYgKHR5cGUgaW4gcHJpbWl0aXZlcykge1xuICAgICAgcmV0dXJuIHByaW1pdGl2ZXNbdHlwZV0uaGFzT3duUHJvcGVydHkoaXRlbSkgPyBmYWxzZSA6IChwcmltaXRpdmVzW3R5cGVdW2l0ZW1dID0gdHJ1ZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIG9ianMuaW5kZXhPZihpdGVtKSA+PSAwID8gZmFsc2UgOiBvYmpzLnB1c2goaXRlbSk7XG4gICAgfVxuICB9KTtcbn1cbmNvbnN0IGNodW5rID0gKGFyciwgc2l6ZSkgPT4gWy4uLkFycmF5KE1hdGguY2VpbChhcnIubGVuZ3RoIC8gc2l6ZSkpXS5tYXAoKF8sIGkpID0+IGFyci5zbGljZShzaXplICogaSwgc2l6ZSArIHNpemUgKiBpKSk7XG5cbmV4cG9ydCB7IGFycmF5VG9Mb29rdXBNYXAgYXMgYSwgdW5pcXVlIGFzIGIsIHRocm90dGxlIGFzIGMsIGRlYm91bmNlIGFzIGQsIGVzY2FwZVJlZ0V4cCBhcyBlLCBhcnJheXNBcmVFcXVpdmFsZW50IGFzIGYsIGNodW5rIGFzIGcsIGlzRGVmaW5lZCBhcyBpLCBtaW5EZWxheSBhcyBtLCB0aW1lb3V0IGFzIHQsIHVuaXF1ZUJ5IGFzIHUgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgZyBhcyBnZXRSZW5kZXJpbmdSZWYsIGYgYXMgZm9yY2VVcGRhdGUgfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcblxuY29uc3QgYXBwZW5kVG9NYXAgPSAobWFwLCBwcm9wTmFtZSwgdmFsdWUpID0+IHtcbiAgICBjb25zdCBpdGVtcyA9IG1hcC5nZXQocHJvcE5hbWUpO1xuICAgIGlmICghaXRlbXMpIHtcbiAgICAgICAgbWFwLnNldChwcm9wTmFtZSwgW3ZhbHVlXSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKCFpdGVtcy5pbmNsdWRlcyh2YWx1ZSkpIHtcbiAgICAgICAgaXRlbXMucHVzaCh2YWx1ZSk7XG4gICAgfVxufTtcbmNvbnN0IGRlYm91bmNlID0gKGZuLCBtcykgPT4ge1xuICAgIGxldCB0aW1lb3V0SWQ7XG4gICAgcmV0dXJuICguLi5hcmdzKSA9PiB7XG4gICAgICAgIGlmICh0aW1lb3V0SWQpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xuICAgICAgICB9XG4gICAgICAgIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGltZW91dElkID0gMDtcbiAgICAgICAgICAgIGZuKC4uLmFyZ3MpO1xuICAgICAgICB9LCBtcyk7XG4gICAgfTtcbn07XG5cbi8qKlxuICogQ2hlY2sgaWYgYSBwb3NzaWJsZSBlbGVtZW50IGlzQ29ubmVjdGVkLlxuICogVGhlIHByb3BlcnR5IG1pZ2h0IG5vdCBiZSB0aGVyZSwgc28gd2UgY2hlY2sgZm9yIGl0LlxuICpcbiAqIFdlIHdhbnQgaXQgdG8gcmV0dXJuIHRydWUgaWYgaXNDb25uZWN0ZWQgaXMgbm90IGEgcHJvcGVydHksXG4gKiBvdGhlcndpc2Ugd2Ugd291bGQgcmVtb3ZlIHRoZXNlIGVsZW1lbnRzIGFuZCB3b3VsZCBub3QgdXBkYXRlLlxuICpcbiAqIEJldHRlciBsZWFrIGluIEVkZ2UgdGhhbiB0byBiZSB1c2VsZXNzLlxuICovXG5jb25zdCBpc0Nvbm5lY3RlZCA9IChtYXliZUVsZW1lbnQpID0+ICEoJ2lzQ29ubmVjdGVkJyBpbiBtYXliZUVsZW1lbnQpIHx8IG1heWJlRWxlbWVudC5pc0Nvbm5lY3RlZDtcbmNvbnN0IGNsZWFudXBFbGVtZW50cyA9IGRlYm91bmNlKChtYXApID0+IHtcbiAgICBmb3IgKGxldCBrZXkgb2YgbWFwLmtleXMoKSkge1xuICAgICAgICBtYXAuc2V0KGtleSwgbWFwLmdldChrZXkpLmZpbHRlcihpc0Nvbm5lY3RlZCkpO1xuICAgIH1cbn0sIDIwMDApO1xuY29uc3Qgc3RlbmNpbFN1YnNjcmlwdGlvbiA9ICgpID0+IHtcbiAgICBpZiAodHlwZW9mIGdldFJlbmRlcmluZ1JlZiAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAvLyBJZiB3ZSBhcmUgbm90IGluIGEgc3RlbmNpbCBwcm9qZWN0LCB3ZSBkbyBub3RoaW5nLlxuICAgICAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIG5vdCByZWFsbHkgZXhwb3J0ZWQgYnkgQHN0ZW5jaWwvY29yZS5cbiAgICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbiAgICBjb25zdCBlbG1zVG9VcGRhdGUgPSBuZXcgTWFwKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZGlzcG9zZTogKCkgPT4gZWxtc1RvVXBkYXRlLmNsZWFyKCksXG4gICAgICAgIGdldDogKHByb3BOYW1lKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlbG0gPSBnZXRSZW5kZXJpbmdSZWYoKTtcbiAgICAgICAgICAgIGlmIChlbG0pIHtcbiAgICAgICAgICAgICAgICBhcHBlbmRUb01hcChlbG1zVG9VcGRhdGUsIHByb3BOYW1lLCBlbG0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBzZXQ6IChwcm9wTmFtZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudHMgPSBlbG1zVG9VcGRhdGUuZ2V0KHByb3BOYW1lKTtcbiAgICAgICAgICAgIGlmIChlbGVtZW50cykge1xuICAgICAgICAgICAgICAgIGVsbXNUb1VwZGF0ZS5zZXQocHJvcE5hbWUsIGVsZW1lbnRzLmZpbHRlcihmb3JjZVVwZGF0ZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xlYW51cEVsZW1lbnRzKGVsbXNUb1VwZGF0ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIHJlc2V0OiAoKSA9PiB7XG4gICAgICAgICAgICBlbG1zVG9VcGRhdGUuZm9yRWFjaCgoZWxtcykgPT4gZWxtcy5mb3JFYWNoKGZvcmNlVXBkYXRlKSk7XG4gICAgICAgICAgICBjbGVhbnVwRWxlbWVudHMoZWxtc1RvVXBkYXRlKTtcbiAgICAgICAgfSxcbiAgICB9O1xufTtcblxuY29uc3QgdW53cmFwID0gKHZhbCkgPT4gKHR5cGVvZiB2YWwgPT09ICdmdW5jdGlvbicgPyB2YWwoKSA6IHZhbCk7XG5jb25zdCBjcmVhdGVPYnNlcnZhYmxlTWFwID0gKGRlZmF1bHRTdGF0ZSwgc2hvdWxkVXBkYXRlID0gKGEsIGIpID0+IGEgIT09IGIpID0+IHtcbiAgICBjb25zdCB1bndyYXBwZWRTdGF0ZSA9IHVud3JhcChkZWZhdWx0U3RhdGUpO1xuICAgIGxldCBzdGF0ZXMgPSBuZXcgTWFwKE9iamVjdC5lbnRyaWVzKHVud3JhcHBlZFN0YXRlICE9PSBudWxsICYmIHVud3JhcHBlZFN0YXRlICE9PSB2b2lkIDAgPyB1bndyYXBwZWRTdGF0ZSA6IHt9KSk7XG4gICAgY29uc3QgaGFuZGxlcnMgPSB7XG4gICAgICAgIGRpc3Bvc2U6IFtdLFxuICAgICAgICBnZXQ6IFtdLFxuICAgICAgICBzZXQ6IFtdLFxuICAgICAgICByZXNldDogW10sXG4gICAgfTtcbiAgICBjb25zdCByZXNldCA9ICgpID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAvLyBXaGVuIHJlc2V0dGluZyB0aGUgc3RhdGUsIHRoZSBkZWZhdWx0IHN0YXRlIG1heSBiZSBhIGZ1bmN0aW9uIC0gdW53cmFwIGl0IHRvIGludm9rZSBpdC5cbiAgICAgICAgLy8gb3RoZXJ3aXNlLCB0aGUgc3RhdGUgd29uJ3QgYmUgcHJvcGVybHkgcmVzZXRcbiAgICAgICAgc3RhdGVzID0gbmV3IE1hcChPYmplY3QuZW50cmllcygoX2EgPSB1bndyYXAoZGVmYXVsdFN0YXRlKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDoge30pKTtcbiAgICAgICAgaGFuZGxlcnMucmVzZXQuZm9yRWFjaCgoY2IpID0+IGNiKCkpO1xuICAgIH07XG4gICAgY29uc3QgZGlzcG9zZSA9ICgpID0+IHtcbiAgICAgICAgLy8gQ2FsbCBmaXJzdCBkaXNwb3NlIGFzIHJlc2V0dGluZyB0aGUgc3RhdGUgd291bGRcbiAgICAgICAgLy8gY2F1c2UgbGVzcyB1cGRhdGVzIDspXG4gICAgICAgIGhhbmRsZXJzLmRpc3Bvc2UuZm9yRWFjaCgoY2IpID0+IGNiKCkpO1xuICAgICAgICByZXNldCgpO1xuICAgIH07XG4gICAgY29uc3QgZ2V0ID0gKHByb3BOYW1lKSA9PiB7XG4gICAgICAgIGhhbmRsZXJzLmdldC5mb3JFYWNoKChjYikgPT4gY2IocHJvcE5hbWUpKTtcbiAgICAgICAgcmV0dXJuIHN0YXRlcy5nZXQocHJvcE5hbWUpO1xuICAgIH07XG4gICAgY29uc3Qgc2V0ID0gKHByb3BOYW1lLCB2YWx1ZSkgPT4ge1xuICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IHN0YXRlcy5nZXQocHJvcE5hbWUpO1xuICAgICAgICBpZiAoc2hvdWxkVXBkYXRlKHZhbHVlLCBvbGRWYWx1ZSwgcHJvcE5hbWUpKSB7XG4gICAgICAgICAgICBzdGF0ZXMuc2V0KHByb3BOYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgICBoYW5kbGVycy5zZXQuZm9yRWFjaCgoY2IpID0+IGNiKHByb3BOYW1lLCB2YWx1ZSwgb2xkVmFsdWUpKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3Qgc3RhdGUgPSAodHlwZW9mIFByb3h5ID09PSAndW5kZWZpbmVkJ1xuICAgICAgICA/IHt9XG4gICAgICAgIDogbmV3IFByb3h5KHVud3JhcHBlZFN0YXRlLCB7XG4gICAgICAgICAgICBnZXQoXywgcHJvcE5hbWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0KHByb3BOYW1lKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvd25LZXlzKF8pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShzdGF0ZXMua2V5cygpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGFzKF8sIHByb3BOYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlcy5oYXMocHJvcE5hbWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldChfLCBwcm9wTmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBzZXQocHJvcE5hbWUsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pKTtcbiAgICBjb25zdCBvbiA9IChldmVudE5hbWUsIGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIGhhbmRsZXJzW2V2ZW50TmFtZV0ucHVzaChjYWxsYmFjayk7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICByZW1vdmVGcm9tQXJyYXkoaGFuZGxlcnNbZXZlbnROYW1lXSwgY2FsbGJhY2spO1xuICAgICAgICB9O1xuICAgIH07XG4gICAgY29uc3Qgb25DaGFuZ2UgPSAocHJvcE5hbWUsIGNiKSA9PiB7XG4gICAgICAgIGNvbnN0IHVuU2V0ID0gb24oJ3NldCcsIChrZXksIG5ld1ZhbHVlKSA9PiB7XG4gICAgICAgICAgICBpZiAoa2V5ID09PSBwcm9wTmFtZSkge1xuICAgICAgICAgICAgICAgIGNiKG5ld1ZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gdW53cmFwIHRoZSBkZWZhdWx0U3RhdGUgYmVjYXVzZSBpdCBtaWdodCBiZSBhIGZ1bmN0aW9uLlxuICAgICAgICAvLyBPdGhlcndpc2Ugd2UgbWlnaHQgbm90IGJlIHNlbmRpbmcgdGhlIHJpZ2h0IHJlc2V0IHZhbHVlLlxuICAgICAgICBjb25zdCB1blJlc2V0ID0gb24oJ3Jlc2V0JywgKCkgPT4gY2IodW53cmFwKGRlZmF1bHRTdGF0ZSlbcHJvcE5hbWVdKSk7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICB1blNldCgpO1xuICAgICAgICAgICAgdW5SZXNldCgpO1xuICAgICAgICB9O1xuICAgIH07XG4gICAgY29uc3QgdXNlID0gKC4uLnN1YnNjcmlwdGlvbnMpID0+IHtcbiAgICAgICAgY29uc3QgdW5zdWJzID0gc3Vic2NyaXB0aW9ucy5yZWR1Y2UoKHVuc3Vicywgc3Vic2NyaXB0aW9uKSA9PiB7XG4gICAgICAgICAgICBpZiAoc3Vic2NyaXB0aW9uLnNldCkge1xuICAgICAgICAgICAgICAgIHVuc3Vicy5wdXNoKG9uKCdzZXQnLCBzdWJzY3JpcHRpb24uc2V0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3Vic2NyaXB0aW9uLmdldCkge1xuICAgICAgICAgICAgICAgIHVuc3Vicy5wdXNoKG9uKCdnZXQnLCBzdWJzY3JpcHRpb24uZ2V0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3Vic2NyaXB0aW9uLnJlc2V0KSB7XG4gICAgICAgICAgICAgICAgdW5zdWJzLnB1c2gob24oJ3Jlc2V0Jywgc3Vic2NyaXB0aW9uLnJlc2V0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3Vic2NyaXB0aW9uLmRpc3Bvc2UpIHtcbiAgICAgICAgICAgICAgICB1bnN1YnMucHVzaChvbignZGlzcG9zZScsIHN1YnNjcmlwdGlvbi5kaXNwb3NlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdW5zdWJzO1xuICAgICAgICB9LCBbXSk7XG4gICAgICAgIHJldHVybiAoKSA9PiB1bnN1YnMuZm9yRWFjaCgodW5zdWIpID0+IHVuc3ViKCkpO1xuICAgIH07XG4gICAgY29uc3QgZm9yY2VVcGRhdGUgPSAoa2V5KSA9PiB7XG4gICAgICAgIGNvbnN0IG9sZFZhbHVlID0gc3RhdGVzLmdldChrZXkpO1xuICAgICAgICBoYW5kbGVycy5zZXQuZm9yRWFjaCgoY2IpID0+IGNiKGtleSwgb2xkVmFsdWUsIG9sZFZhbHVlKSk7XG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgICBzdGF0ZSxcbiAgICAgICAgZ2V0LFxuICAgICAgICBzZXQsXG4gICAgICAgIG9uLFxuICAgICAgICBvbkNoYW5nZSxcbiAgICAgICAgdXNlLFxuICAgICAgICBkaXNwb3NlLFxuICAgICAgICByZXNldCxcbiAgICAgICAgZm9yY2VVcGRhdGUsXG4gICAgfTtcbn07XG5jb25zdCByZW1vdmVGcm9tQXJyYXkgPSAoYXJyYXksIGl0ZW0pID0+IHtcbiAgICBjb25zdCBpbmRleCA9IGFycmF5LmluZGV4T2YoaXRlbSk7XG4gICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgICAgYXJyYXlbaW5kZXhdID0gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV07XG4gICAgICAgIGFycmF5Lmxlbmd0aC0tO1xuICAgIH1cbn07XG5cbmNvbnN0IGNyZWF0ZVN0b3JlID0gKGRlZmF1bHRTdGF0ZSwgc2hvdWxkVXBkYXRlKSA9PiB7XG4gICAgY29uc3QgbWFwID0gY3JlYXRlT2JzZXJ2YWJsZU1hcChkZWZhdWx0U3RhdGUsIHNob3VsZFVwZGF0ZSk7XG4gICAgbWFwLnVzZShzdGVuY2lsU3Vic2NyaXB0aW9uKCkpO1xuICAgIHJldHVybiBtYXA7XG59O1xuXG5leHBvcnQgeyBjcmVhdGVTdG9yZSBhcyBjIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tMTNmNWIwMGMuanMnO1xuaW1wb3J0IHsgbCBhcyBsYW5ndWFnZU1hcCB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0QXNzZXRQYXRoIH0gZnJvbSAnLi9pbmRleC05MmViYjM5Ni5qcyc7XG5cbi8vIGh0dHBzOi8vbWVkaXVtLmNvbS9zdGVuY2lsLXRyaWNrcy9pbXBsZW1lbnRpbmctaW50ZXJuYXRpb25hbGlzYXRpb24taTE4bi13aXRoLXN0ZW5jaWwtNWU2NTU5NTU0MTE3XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCkge1xuICB2YXIgX2EsIF9iLCBfYztcbiAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gIC8vIGxhbmd1YWdlIHNldCBieSB0aGUgY2FsbGluZyBhcHBsaWNhdGlvbiBvciBicm93c2VyLiBkZWZhdWx0cyB0byBlbmdsaXNoLlxuICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgfVxuICBlbHNlIHtcbiAgICAvLyBcInJ1LVJVXCIgbWFwcyB0byBcInJ1XCIgdXNlIGNhc2VcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcuc2xpY2UoMCwgMikpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBcImVuXCI7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpIHtcbiAgdmFyIF9hLCBfYiwgX2M7XG4gIC8vIGl0J3MgT0sgaWYgd2UgZG9uJ3QgaGF2ZSB0aGUgNCBsZXR0ZXIgbGFuZ3VhZ2UgZmlsZSBmb3IgaXRcbiAgLy8gNCBsZXR0ZXIgbGFuZ3VhZ2UgY29kZSBuZWVkZWQgZm9yIGZvcm1hdHRpbmcgbnVtYmVyc1xuICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICB9XG4gIGVsc2Uge1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgIC8vIHdlIHN1cHBvcnQgdGhlIDIgbGV0dGVyIGNvZGVkIGxhbmd1YWdlXG4gICAgICAvLyBlLmcuIGl0LUNIIHZzIGl0XG4gICAgICByZXR1cm4gbGFuZztcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXR1cm4gXCJlblwiO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGZldGNoKGdldEFzc2V0UGF0aChgLi4vYXJjZ2lzLWFwcC1hc3NldHMvaTE4bi8ke2NvbXBvbmVudE5hbWV9LmkxOG4uJHtsb2NhbGV9Lmpzb25gKSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICBpZiAocmVzdWx0Lm9rKVxuICAgICAgICByZXNvbHZlKHJlc3VsdC5qc29uKCkpO1xuICAgICAgZWxzZVxuICAgICAgICByZWplY3QoKTtcbiAgICB9LCAoKSA9PiByZWplY3QoKSk7XG4gIH0pO1xufVxuY29uc3Qgc3RyaW5nQ2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBsb2NhbGUpIHtcbiAgY29uc3QgaWQgPSBgJHtjb21wb25lbnROYW1lfSR7bG9jYWxlfWA7XG4gIGlmICghc3RyaW5nQ2FjaGVbaWRdKSB7XG4gICAgc3RyaW5nQ2FjaGVbaWRdID0gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSk7XG4gIH1cbiAgcmV0dXJuIHN0cmluZ0NhY2hlW2lkXTtcbn1cbi8qKlxuICogR2V0IHN0cmluZ3MgYW5kIGxhbmd1YWdlIGNvZGVzLlxuICogVGhpcyBtZXRob2QgcmV0dXJucyAyIGxhbmd1YWdlIGNvZGVzLlxuICogVGhlIGZpcnN0IG9uZSByZXR1cm5zIGEgY29kZSB0aGF0J3MgYWxzbyBzdXBwb3J0ZWQgYXMgYSBsYW5ndWFnZSBmaWxlLlxuICogVGhlIHNlY29uZCBvbmUgcmV0dXJucyBhIGNvZGUgd2hlcmUgdGhlcmUgaXMgc3VwcG9ydCBmb3IgdGhlIGZpcnN0IDIgbGV0dGVycyBvZiB0aGUgY29kZSBhcyBwYXJ0IG9mIGEgbGFuZ3VhZ2UgZmlsZSxcbiAqIGJ1dCB3aWxsIHJldHVybiB0aGUgb3JpZ2luYWwgNCBsZXR0ZXIgY29kZSBmcm9tIHRoZSBwYWdlLlxuICogRS5nLiBGb3IgXCJpdC1jaFwiIGl0IHdpbGwgcmV0dXJuIFwiaXRcIiBhcyB0aGUgZmlyc3QgbGFuZ3VhZ2UgY29kZSBhbmQgXCJpdC1jaFwiIGFzIHRoZSBzZWNvbmQuXG4gKiBUaGUgc2Vjb25kIG9uZSBpcyByZXF1aXJlZCBmb3IgZXNyaS5pbnRsLnNldExvY2FsZSgpIHRvIGdldCB0aGUgY29ycmVjdCBmb3JtYXR0aW5nLlxuICpcbiAqIElmIGEgdGFnTmFtZSBpcyBwcm92aWRlZCBpdCB3aWxsIG92ZXJ3aXRlIHRoZSBlbGVtZW50J3MgdGFnTmFtZVxuICpcbiAqICBAcmV0dXJuIFsgc3RyaW5ncywgZmlyc3QgbGFuZ3VhZ2UgY29kZSwgc2Vjb25kIGxhbmd1YWdlIGNvZGVdXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MoZWxlbWVudCwgdGFnTmFtZSkge1xuICBjb25zdCBjb21wb25lbnROYW1lID0gdGFnTmFtZSB8fCBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2UgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCk7XG4gIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlSW50bCA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCk7XG4gIGxldCBzdHJpbmdzO1xuICB0cnkge1xuICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgY29tcG9uZW50TGFuZ3VhZ2UpO1xuICB9XG4gIGNhdGNoIChlKSB7XG4gICAgY29uc29sZS53YXJuKGBubyBsb2NhbGUgZm9yICR7Y29tcG9uZW50TmFtZX0gKCR7Y29tcG9uZW50TGFuZ3VhZ2V9KSBsb2FkaW5nIGRlZmF1bHQgbG9jYWxlIGVuLmApO1xuICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgXCJlblwiKTtcbiAgfVxuICByZXR1cm4gW3N0cmluZ3MsIGNvbXBvbmVudExhbmd1YWdlLCBjb21wb25lbnRMYW5ndWFnZUludGxdO1xufVxuXG5leHBvcnQgeyBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UgYXMgYSwgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyBhcyBnIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGUgYXMgZXNjYXBlUmVnRXhwIH0gZnJvbSAnLi9mdW5jdGlvbmFsLWM4MmY1YWI5LmpzJztcblxuLy8gaW1wb3J0IHN0cmluZ1V0aWwgZnJvbSBcIi4vc3RyaW5nc1wiO1xuLyoqXG4gKiBVdGlsaXR5IG1ldGhvZHMgZm9yIGRlYWxpbmcgd2l0aCBzdG9yYWdlIG9mIHZhcmlvdXMgZm9ybXMgKGNvb2tpZXMsIGxvY2FsIHN0b3JhZ2UsIGFuZCBzZXNzaW9uIHN0b3JhZ2UpLlxuICovXG5mdW5jdGlvbiBzZXRDb29raWUobmFtZSwgY29va2llLCBwcm9wZXJ0aWVzLCBzdHJpbmdpZnkpIHtcbiAgd3JpdGVDb29raWUobmFtZSwgc3RyaW5naWZ5ID8gSlNPTi5zdHJpbmdpZnkoY29va2llKSA6IGNvb2tpZSwgcHJvcGVydGllcyk7XG59XG5mdW5jdGlvbiBnZXRDb29raWUobmFtZSwgcGFyc2UpIHtcbiAgY29uc3QgY29va2llID0gcmVhZENvb2tpZShuYW1lKTtcbiAgcmV0dXJuIGNvb2tpZSAmJiBwYXJzZSA/IEpTT04ucGFyc2UoY29va2llKSA6IGNvb2tpZTtcbn1cbmZ1bmN0aW9uIHNldExvY2FsU3RvcmFnZUl0ZW0obmFtZSwgaXRlbSwgc3RyaW5naWZ5KSB7XG4gIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShuYW1lLCBzdHJpbmdpZnkgPyBKU09OLnN0cmluZ2lmeShpdGVtKSA6IGl0ZW0pO1xufVxuZnVuY3Rpb24gZ2V0TG9jYWxTdG9yYWdlSXRlbShuYW1lLCBwYXJzZSkge1xuICBjb25zdCBpdGVtID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKG5hbWUpO1xuICByZXR1cm4gaXRlbSAmJiBwYXJzZSA/IEpTT04ucGFyc2UoaXRlbSkgOiBpdGVtO1xufVxuZnVuY3Rpb24gc2V0U2Vzc2lvblN0b3JhZ2VJdGVtKG5hbWUsIGl0ZW0sIHN0cmluZ2lmeSkge1xuICB3aW5kb3cuc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShuYW1lLCBzdHJpbmdpZnkgPyBKU09OLnN0cmluZ2lmeShpdGVtKSA6IGl0ZW0pO1xufVxuZnVuY3Rpb24gZ2V0U2Vzc2lvblN0b3JhZ2VJdGVtKG5hbWUsIHBhcnNlKSB7XG4gIGNvbnN0IGl0ZW0gPSB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShuYW1lKTtcbiAgcmV0dXJuIGl0ZW0gJiYgcGFyc2UgPyBKU09OLnBhcnNlKGl0ZW0pIDogaXRlbTtcbn1cbmZ1bmN0aW9uIHJlYWRDb29raWUobmFtZSkge1xuICBjb25zdCBjb29raWUgPSBkb2N1bWVudC5jb29raWU7XG4gIGNvbnN0IGNvb2tpZU5hbWVSRSA9IG5ldyBSZWdFeHAoYCg/Ol58OyApJHtlc2NhcGVSZWdFeHAobmFtZSl9PShbXjtdKilgKTtcbiAgY29uc3QgbWF0Y2hlZENvb2tpZXMgPSBjb29raWUubWF0Y2goY29va2llTmFtZVJFKTtcbiAgcmV0dXJuIG1hdGNoZWRDb29raWVzID8gZGVjb2RlVVJJQ29tcG9uZW50KG1hdGNoZWRDb29raWVzWzFdKSA6IHVuZGVmaW5lZDtcbn1cbmZ1bmN0aW9uIHdyaXRlQ29va2llKG5hbWUsIHZhbHVlLCBwcm9wZXJ0aWVzKSB7XG4gIHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzIHx8IHt9O1xuICBsZXQgZXhwaXJlcyA9IHByb3BlcnRpZXMgPT09IG51bGwgfHwgcHJvcGVydGllcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHJvcGVydGllcy5leHBpcmVzO1xuICBpZiAodHlwZW9mIGV4cGlyZXMgPT09IFwibnVtYmVyXCIpIHtcbiAgICBjb25zdCBleHBpcmF0aW9uRGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgZGF5c0Zyb21Ub2RheUluTXMgPSBleHBpcmVzICogMjQgKiA2MCAqIDYwICogMTAwMDtcbiAgICBleHBpcmF0aW9uRGF0ZS5zZXRUaW1lKERhdGUubm93KCkgKyBkYXlzRnJvbVRvZGF5SW5Ncyk7XG4gICAgZXhwaXJlcyA9IHByb3BlcnRpZXMuZXhwaXJlcyA9IGV4cGlyYXRpb25EYXRlO1xuICB9XG4gIGlmICh0eXBlb2YgZXhwaXJlcyAhPT0gXCJzdHJpbmdcIiAmJiAoZXhwaXJlcyA9PT0gbnVsbCB8fCBleHBpcmVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBleHBpcmVzLnRvVVRDU3RyaW5nKSkge1xuICAgIHByb3BlcnRpZXMuZXhwaXJlcyA9IGV4cGlyZXMudG9VVENTdHJpbmcoKTtcbiAgfVxuICBsZXQgY29va2llID0gYCR7bmFtZX09JHtlbmNvZGVVUklDb21wb25lbnQodmFsdWUpfWA7XG4gIGxldCBwcm9wZXJ0eTtcbiAgZm9yIChwcm9wZXJ0eSBpbiBwcm9wZXJ0aWVzKSB7XG4gICAgY29va2llICs9IGA7ICR7cHJvcGVydHl9YDtcbiAgICBjb25zdCBwcm9wZXJ0eVZhbHVlID0gcHJvcGVydGllc1twcm9wZXJ0eV07XG4gICAgaWYgKHByb3BlcnR5VmFsdWUgIT09IHRydWUpIHtcbiAgICAgIGNvb2tpZSArPSBgPSR7cHJvcGVydHlWYWx1ZX1gO1xuICAgIH1cbiAgfVxuICBkb2N1bWVudC5jb29raWUgPSBjb29raWU7XG59XG5cbmV4cG9ydCB7IGdldENvb2tpZSBhcyBhLCBzZXRDb29raWUgYXMgYiwgc2V0U2Vzc2lvblN0b3JhZ2VJdGVtIGFzIGMsIGdldFNlc3Npb25TdG9yYWdlSXRlbSBhcyBkLCBnZXRMb2NhbFN0b3JhZ2VJdGVtIGFzIGcsIHNldExvY2FsU3RvcmFnZUl0ZW0gYXMgcyB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9