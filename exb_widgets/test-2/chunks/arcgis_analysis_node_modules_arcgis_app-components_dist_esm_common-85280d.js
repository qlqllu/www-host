"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_common-85280d"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-f98a323c.js":
/*!*****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-f98a323c.js ***!
  \*****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   L: () => (/* binding */ LastSortyBy),
/* harmony export */   a: () => (/* binding */ fieldTypesEnum),
/* harmony export */   f: () => (/* binding */ fieldInfoPrefixEnum),
/* harmony export */   i: () => (/* binding */ imageComponentInputTypesEnum),
/* harmony export */   l: () => (/* binding */ layerDisplayTypeEnum),
/* harmony export */   s: () => (/* binding */ serviceTypeEnum)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
var imageComponentInputTypesEnum;
(function (imageComponentInputTypesEnum) {
  imageComponentInputTypesEnum["sourceUrl"] = "sourceUrl";
  imageComponentInputTypesEnum["title"] = "title";
  imageComponentInputTypesEnum["caption"] = "caption";
  imageComponentInputTypesEnum["linkUrl"] = "linkUrl";
  imageComponentInputTypesEnum["altText"] = "altText";
})(imageComponentInputTypesEnum || (imageComponentInputTypesEnum = {}));
var fieldInfoPrefixEnum;
(function (fieldInfoPrefixEnum) {
  fieldInfoPrefixEnum["expression"] = "expression/";
  fieldInfoPrefixEnum["relationship"] = "relationships/";
  fieldInfoPrefixEnum["raster"] = "Raster.";
})(fieldInfoPrefixEnum || (fieldInfoPrefixEnum = {}));
var layerDisplayTypeEnum;
(function (layerDisplayTypeEnum) {
  layerDisplayTypeEnum["feature"] = "feature";
  layerDisplayTypeEnum["cluster"] = "cluster";
  layerDisplayTypeEnum["mapNotes"] = "mapNotes";
})(layerDisplayTypeEnum || (layerDisplayTypeEnum = {}));
var serviceTypeEnum;
(function (serviceTypeEnum) {
  serviceTypeEnum["feature"] = "feature";
  serviceTypeEnum["mapImage"] = "map-image";
  serviceTypeEnum["scene"] = "scene";
  serviceTypeEnum["ogcFeature"] = "ogc-feature";
  serviceTypeEnum["imagery"] = "imagery";
  serviceTypeEnum["wfs"] = "wfs";
  serviceTypeEnum["wms"] = "wms";
  serviceTypeEnum["csv"] = "csv";
  serviceTypeEnum["geojson"] = "geojson";
  serviceTypeEnum["stream"] = "stream";
  serviceTypeEnum["imageryTile"] = "imagery-tile";
  serviceTypeEnum["tile"] = "tile";
  serviceTypeEnum["subtype"] = "subtype";
})(serviceTypeEnum || (serviceTypeEnum = {}));
// https://developers.arcgis.com/javascript/latest/api-reference/esri-layers-support-Field.html#type
var fieldTypesEnum;
(function (fieldTypesEnum) {
  fieldTypesEnum["integer"] = "integer";
  fieldTypesEnum["smallInteger"] = "small-integer";
  fieldTypesEnum["bigInteger"] = "big-integer";
  fieldTypesEnum["single"] = "single";
  fieldTypesEnum["double"] = "double";
  fieldTypesEnum["long"] = "long";
  fieldTypesEnum["string"] = "string";
  fieldTypesEnum["date"] = "date";
  fieldTypesEnum["dateOnly"] = "date-only";
  fieldTypesEnum["timeOnly"] = "time-only";
  fieldTypesEnum["timestampOffset"] = "timestamp-offset";
  fieldTypesEnum["oid"] = "oid";
  fieldTypesEnum["guid"] = "guid";
  fieldTypesEnum["globalId"] = "global-id";
  fieldTypesEnum["number"] = "number"; // for arcade
})(fieldTypesEnum || (fieldTypesEnum = {}));
var LastSortyBy;
(function (LastSortyBy) {
  LastSortyBy["default"] = "default";
  LastSortyBy["display"] = "display";
  LastSortyBy["type"] = "type";
  LastSortyBy["field"] = "field";
})(LastSortyBy || (LastSortyBy = {}));




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-5262b094.js":
/*!*********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-5262b094.js ***!
  \*********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getFieldType),
/* harmony export */   b: () => (/* binding */ getFieldDisplayName),
/* harmony export */   c: () => (/* binding */ getServiceType),
/* harmony export */   d: () => (/* binding */ generateLayerFieldsMap),
/* harmony export */   e: () => (/* binding */ generateArcadeExpressionMap),
/* harmony export */   f: () => (/* binding */ identifyOnMapImageLayer),
/* harmony export */   g: () => (/* binding */ getFeatureCount),
/* harmony export */   h: () => (/* binding */ getLayerGeometryType),
/* harmony export */   i: () => (/* binding */ isDefined),
/* harmony export */   j: () => (/* binding */ getFieldsFromLayer),
/* harmony export */   k: () => (/* binding */ getClusterFields),
/* harmony export */   l: () => (/* binding */ getSingleClusterFeature),
/* harmony export */   m: () => (/* binding */ getSingleFeature),
/* harmony export */   n: () => (/* binding */ getRasterCount),
/* harmony export */   o: () => (/* binding */ getPointFromGeometry),
/* harmony export */   p: () => (/* binding */ getServiceVersion),
/* harmony export */   q: () => (/* binding */ queryParentElement)
/* harmony export */ });
/* harmony import */ var _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./commonEnums-f98a323c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-f98a323c.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



// display name from fields for arcade
function getFieldDisplayName(field, arcadeMap) {
  if (field.fieldName.indexOf(_commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.f.expression) !== -1) {
    const tempArcade = arcadeMap.get(field.fieldName);
    return (tempArcade === null || tempArcade === void 0 ? void 0 : tempArcade.title) ? tempArcade.title : field.fieldName;
  }
  else {
    return field.label ? field.label : field.fieldName;
  }
}
function generateArcadeExpressionMap(popupTemplate) {
  const arcadeExpMap = new Map();
  if (popupTemplate === null || popupTemplate === void 0 ? void 0 : popupTemplate.expressionInfos) {
    popupTemplate.expressionInfos.forEach((expression) => {
      const expressionNameWithPrefix = `${_commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.f.expression}${expression.name}`;
      arcadeExpMap.set(expressionNameWithPrefix, expression);
    });
  }
  return arcadeExpMap;
}
async function generateLayerFieldsMap(layer) {
  return new Map((await getFieldsFromLayer(layer))
    .filter((field) => field.visible)
    .map((field) => [field.name, field]));
}
async function getSingleFeature(layer, mapView) {
  var _a, _b, _c, _d, _e, _f, _g, _h, _j;
  try {
    const serviceType = getServiceType(layer);
    if (serviceType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.mapImage &&
      layer.layer.version >= 10.5 &&
      !((_b = (_a = layer.layer.capabilities) === null || _a === void 0 ? void 0 : _a.operations) === null || _b === void 0 ? void 0 : _b.supportsQuery) &&
      ((_d = (_c = layer.layer.capabilities) === null || _c === void 0 ? void 0 : _c.operations) === null || _d === void 0 ? void 0 : _d.supportsIdentify)) {
      const currFeature = {
        features: [
          (await identifyOnMapImageLayer(layer, mapView)) ||
            (await generateSingleFeature(layer))
        ]
      };
      return currFeature;
    }
    if (serviceType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.scene &&
      !((_f = (_e = layer.capabilities) === null || _e === void 0 ? void 0 : _e.operations) === null || _f === void 0 ? void 0 : _f.supportsQuery)) {
      const singleFeature = {
        features: [await generateSingleFeature(layer)]
      };
      return singleFeature;
    }
    const currentLayer = serviceType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.ogcFeature
      ? (await mapView.whenLayerView(layer))
      : serviceType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.stream
        ? (await mapView.whenLayerView(layer))
        : layer;
    const queryParams = currentLayer.createQuery();
    queryParams.where =
      currentLayer.definitionExpression || "1=1";
    queryParams.outFields = ["*"];
    queryParams.returnM = "hasM" in layer && layer.hasM;
    queryParams.returnZ = "hasZ" in layer && layer.hasZ;
    // pagination always supported for OGCFeatureLayerView
    if (((_h = (_g = currentLayer.sourceJSON) === null || _g === void 0 ? void 0 : _g.advancedQueryCapabilities) === null || _h === void 0 ? void 0 : _h.supportsPagination) ||
      serviceType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.ogcFeature) {
      queryParams.start = 0;
      queryParams.num = 1;
    }
    queryParams.outSpatialReference = mapView.spatialReference;
    const singleFeatureResponse = await currentLayer.queryFeatures(queryParams);
    if (((_j = singleFeatureResponse === null || singleFeatureResponse === void 0 ? void 0 : singleFeatureResponse.features) === null || _j === void 0 ? void 0 : _j.length) === 0) {
      singleFeatureResponse.features[0] = await generateSingleFeature(layer);
    }
    return singleFeatureResponse;
  }
  catch (error) {
    console.error(error);
  }
}
async function generateSingleFeature(layer) {
  return new Promise((resolve, reject) => {
    (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_1__.l)(["esri/Graphic", "esri/geometry/Geometry"]).then(([Graphic, Geometry]) => {
      var _a;
      const tempGraphic = new Graphic();
      if ((_a = layer.fields) === null || _a === void 0 ? void 0 : _a.length) {
        const tempAttributes = {};
        layer.fields.forEach((feature) => {
          tempAttributes[feature.name] = feature.defaultValue;
        });
        tempGraphic.attributes = tempAttributes;
      }
      if (layer.geometryType) {
        const tempGeometry = new Geometry();
        tempGeometry.type = layer.geometryType;
        tempGraphic.geometry = tempGeometry;
      }
      resolve(tempGraphic);
    }, (error) => {
      reject(error);
    });
  });
}
function getServiceType(layer) {
  var _a, _b, _c;
  if (((_a = layer === null || layer === void 0 ? void 0 : layer.layer) === null || _a === void 0 ? void 0 : _a.type) === "map-image") {
    return _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.mapImage;
  }
  if ((layer === null || layer === void 0 ? void 0 : layer.type) === "subtype-sublayer") {
    return _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.subtype;
  }
  if (((_b = layer === null || layer === void 0 ? void 0 : layer.layer) === null || _b === void 0 ? void 0 : _b.type) === "tile") {
    return _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.tile;
  }
  if ((layer === null || layer === void 0 ? void 0 : layer.type) === "scene") {
    return _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.scene;
  }
  if ((layer === null || layer === void 0 ? void 0 : layer.type) === "ogc-feature") {
    return _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.ogcFeature;
  }
  if ((layer === null || layer === void 0 ? void 0 : layer.type) === "imagery") {
    return _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.imagery;
  }
  if ((layer === null || layer === void 0 ? void 0 : layer.type) === "imagery-tile") {
    return _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.imageryTile;
  }
  if ((layer === null || layer === void 0 ? void 0 : layer.type) === "wfs") {
    return _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.wfs;
  }
  if (((_c = layer === null || layer === void 0 ? void 0 : layer.layer) === null || _c === void 0 ? void 0 : _c.type) === "wms") {
    return _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.wms;
  }
  if ((layer === null || layer === void 0 ? void 0 : layer.type) === "csv") {
    return _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.csv;
  }
  if ((layer === null || layer === void 0 ? void 0 : layer.type) === "geojson") {
    return _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.geojson;
  }
  if ((layer === null || layer === void 0 ? void 0 : layer.type) === "stream") {
    return _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.stream;
  }
  return _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.feature;
}
function getServiceVersion(layer) {
  const type = getServiceType(layer);
  let version;
  if (type === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.wms || type === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.mapImage) {
    version = layer === null || layer === void 0 ? void 0 : layer.layer.version;
  }
  else if (type === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.imagery || type === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.feature || type === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.scene) {
    version = layer
      .version;
  }
  return Number.parseFloat(version);
}
// ThematicGroup fields are different than regular layer.fields
async function getFieldsFromLayer(layer) {
  return new Promise(async (resolve, reject) => {
    var _a, _b, _c, _d;
    const type = getServiceType(layer);
    switch (type) {
      case _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.feature:
      case _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.ogcFeature:
      case _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.stream:
        resolve(layer.fields);
        break;
      case _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.mapImage:
        if (((_a = layer === null || layer === void 0 ? void 0 : layer.layer) === null || _a === void 0 ? void 0 : _a.portalItem) &&
          ((_b = layer.layer) === null || _b === void 0 ? void 0 : _b.url.indexOf("https://demographics")) > -1 &&
          ((_c = layer.layer) === null || _c === void 0 ? void 0 : _c.url.indexOf(".arcgis.com")) > -1) {
          try {
            const response = await ((_d = layer.layer.portalItem) === null || _d === void 0 ? void 0 : _d.fetchData());
            if (response === null || response === void 0 ? void 0 : response.thematicGroup) {
              // create hash map for search optimization
              const layerFieldMap = new Map(layer.fields.map((field) => [field.name, field]));
              const fieldNames = response.thematicGroup.fieldNames;
              const returnFields = [];
              fieldNames.forEach((currentField) => {
                if (layerFieldMap.has(currentField)) {
                  returnFields.push(layerFieldMap.get(currentField));
                }
              });
              resolve(returnFields);
            }
            else {
              resolve(layer.fields);
            }
          }
          catch (error) {
            reject(error);
          }
        }
        else {
          resolve(layer.fields);
        }
        break;
      case _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.imagery:
        const iLayer = layer;
        resolve((iLayer.fields || []).concat(iLayer.rasterFields || []));
        break;
      case _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.imageryTile:
        // not sure why it used to be popupTemplate.fieldInfos...
        resolve(/* layer.popupTemplate?.fieldInfos || */ layer.rasterFields);
        break;
      default:
        resolve("fields" in layer && layer.fields);
    }
  });
}
async function getLayerGeometryType(layer) {
  return new Promise(async (resolve) => {
    var _a, _b, _c, _d, _e;
    if (getServiceType(layer) === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.stream) {
      resolve("point");
    }
    else if (layer.geometryType) {
      resolve(layer.geometryType);
    }
    else {
      if (getServiceType(layer) === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.s.mapImage && ((_b = (_a = layer === null || layer === void 0 ? void 0 : layer.layer) === null || _a === void 0 ? void 0 : _a.sourceJSON) === null || _b === void 0 ? void 0 : _b.layers)) {
        const tempGeometryType = (_d = (_c = layer.layer.sourceJSON.layers
          .find((sourceJSONLayer) => {
          if (sourceJSONLayer.id === layer.id) {
            return sourceJSONLayer;
          }
        })) === null || _c === void 0 ? void 0 : _c.geometryType) === null || _d === void 0 ? void 0 : _d.toLowerCase();
        if (tempGeometryType) {
          if (tempGeometryType.indexOf("point") > -1) {
            resolve("point");
          }
          else if (tempGeometryType.indexOf("line") > -1) {
            resolve("polyline");
          }
          else if (tempGeometryType.indexOf("polygon") > -1) {
            resolve("polygon");
          }
          else {
            resolve(tempGeometryType);
          }
        }
        else {
          // try to get it via sublayer.createFeatureLayer();
          const subLayer = (_e = layer === null || layer === void 0 ? void 0 : layer.layer) === null || _e === void 0 ? void 0 : _e.findSublayerById(layer.id);
          if (subLayer) {
            await (subLayer === null || subLayer === void 0 ? void 0 : subLayer.createFeatureLayer().then(async (featureLayer) => {
              const fLayer = await (featureLayer === null || featureLayer === void 0 ? void 0 : featureLayer.load());
              resolve(fLayer === null || fLayer === void 0 ? void 0 : fLayer.geometryType);
            }));
          }
          else {
            resolve(null);
          }
        }
      }
      else {
        resolve(null);
      }
    }
  });
}
function getFieldType(fieldName, layerFieldsMap, arcadeExpMap) {
  let type = "";
  if (/^raster.(item|service)pixelvalue/i.test(fieldName)) {
    // e.g. "Raster.ServicePixelValue" | "Raster.ItemPixelValue" | "Raster.ServicePixelValue.Raw"
    // layer.rasterFields reports them as type "string"
    type = "number";
  }
  else if (layerFieldsMap.has(fieldName)) {
    const fieldType = layerFieldsMap.get(fieldName);
    type = fieldType.type ? fieldType.type.toLowerCase() : "";
  }
  else if (arcadeExpMap.has(fieldName)) {
    const arcadeField = arcadeExpMap.get(fieldName);
    type = arcadeField.returnType ? arcadeField.returnType.toLowerCase() : "";
  }
  else {
    // default to number for cluster
    type = "number";
  }
  return type;
}
/**
 * Returns feature count of layer
 * @param layer - FeatureLayer | WFSLayer | OGCFeatureLayer | StreamLayer | CSVLayer
 * @param mapView - View
 */
async function getFeatureCount(layer, view) {
  if (layer.type === "feature" && !layer.url) {
    return getFeatureCountForCollection(layer);
  }
  else if (layer.type === "feature" ||
    layer.type === "csv" ||
    layer.type === "scene" ||
    layer.type === "wfs" ||
    layer.type === "geojson") {
    return await layer.queryFeatureCount();
  }
  else if (view && (layer.type === "stream" || layer.type === "ogc-feature")) {
    return getFeatureCountFromView(layer, view);
  }
}
/**
 * Returns feature count of feature collection layer
 * @param layer - FeatureLayer
 */
async function getFeatureCountForCollection(layer) {
  var _a;
  const query = layer.createQuery();
  query.outFields = ["*"];
  const result = await layer.queryFeatures(query);
  if ((_a = result.features) === null || _a === void 0 ? void 0 : _a.length) {
    return result.features.length;
  }
  else {
    throw new Error("could not get feature count");
  }
}
/**
 * Returns feature count of feature collection layer
 * @param layer - StreamLayer | OGCFeatureLayer
 */
async function getFeatureCountFromView(layer, view) {
  // we can only get the features from the map
  const layerView = (await view.whenLayerView(layer));
  return layerView.queryFeatureCount();
}
/**
 * Returns raster count of imagery layer
 * @param layer - Imagerylayer
 */
async function getRasterCount(layer) {
  if (!layer.url) {
    throw new Error("could not get layer.url");
  }
  const [execute] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_1__.l)(["esri/rest/query/executeForCount"]);
  const count = await execute.executeForCount(layer.url, {});
  if (count) {
    return count;
  }
  else {
    throw new Error("could not get raster count");
  }
}
const getClusterFields = (popupTemplate, getExpressionFields) => {
  let tempFields = [];
  popupTemplate === null || popupTemplate === void 0 ? void 0 : popupTemplate.fieldInfos.forEach((fieldInfo) => {
    if (fieldInfo.fieldName.includes(_commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.f.expression)) {
      // from layer.renderer, to be used as a field for cluster labeling
      // also needed for the existing option in arcade
      getExpressionFields &&
        tempFields.push({
          name: fieldInfo.fieldName.slice(_commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.f.expression.length),
          alias: fieldInfo.fieldName.slice(_commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_0__.f.expression.length),
          type: "string"
        });
    }
    else {
      tempFields.push({ name: fieldInfo.fieldName, alias: fieldInfo.label, type: "string" });
    }
  });
  return tempFields;
};
/**
 * Find an element up the DOM tree.
 * @param el - HTMLElement
 * @param selector - Selector
 */
function queryParentElement(el, selector) {
  let isIDSelector = selector.indexOf("#") === 0;
  let isClassSelector = selector.indexOf(".") === 0;
  if (isClassSelector || isIDSelector) {
    selector = selector.slice(1);
  }
  while (el) {
    if (isIDSelector) {
      if (el.id === selector) {
        return el;
      }
    }
    else if (isClassSelector) {
      if (el.classList.contains(selector)) {
        return el;
      }
    }
    else if (el.tagName.toLowerCase() === selector.toLowerCase()) {
      return el;
    }
    el = el.parentElement;
  }
  return null;
}
/**
 * Returns true if the value is defined
 * @param value - value to check
 */
function isDefined(value) {
  return value !== undefined && value !== null;
}
const identifyOnMapImageLayer = async (layer, mapView) => {
  var _a, _b;
  const [identify, IdentifyParameters] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_1__.l)([
    "esri/rest/identify",
    "esri/rest/support/IdentifyParameters"
  ]);
  const paramters = new IdentifyParameters();
  paramters.geometry = mapView.extent;
  paramters.mapExtent = mapView.extent;
  paramters.returnGeometry = true;
  paramters.tolerance = 6;
  paramters.layerOption = "popup";
  paramters.width = mapView.width;
  paramters.height = mapView.height;
  paramters.layerIds = [layer.id];
  const identifyResults = (_a = (await identify.identify(layer.layer.url, paramters))) === null || _a === void 0 ? void 0 : _a.results;
  const currFeature = (_b = identifyResults === null || identifyResults === void 0 ? void 0 : identifyResults[0]) === null || _b === void 0 ? void 0 : _b.feature;
  return currFeature;
};
const getSingleClusterFeature = async (mapView, layer, popupTemplate) => {
  var _a;
  const layerView = await mapView.whenLayerView(layer);
  const clusterFeatureSet = await layerView.queryAggregates();
  return await generateSingleClusterFeature(popupTemplate, (_a = clusterFeatureSet.features) === null || _a === void 0 ? void 0 : _a[0]);
};
const generateSingleClusterFeature = async (popupTemplate, currGraphic) => {
  const [Graphic, PointGeometry] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_1__.l)(["esri/Graphic", "esri/geometry/Point"]);
  let clusterGraphic;
  if (currGraphic) {
    clusterGraphic = currGraphic.clone();
  }
  else {
    clusterGraphic = new Graphic();
    const fields = getClusterFields(popupTemplate, false);
    if (fields === null || fields === void 0 ? void 0 : fields.length) {
      const tempAttributes = {};
      fields.forEach((feature) => {
        tempAttributes[feature.name] = "";
      });
      clusterGraphic.attributes = tempAttributes;
    }
    const tempGeometry = new PointGeometry();
    clusterGraphic.geometry = tempGeometry;
  }
  return clusterGraphic;
};
function getPointFromGeometry(geometry) {
  var _a;
  if (!geometry) {
    return null;
  }
  switch (geometry.type) {
    case "point":
      return geometry;
    case "extent":
      return geometry.center;
    case "polygon":
      return geometry.centroid;
    case "multipoint":
    case "polyline":
      return (_a = geometry.extent) === null || _a === void 0 ? void 0 : _a.center;
    default:
      return null;
  }
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



const languageMap = new Map([
  ["ar", "ar"],
  ["bg", "bg"],
  ["bs", "bs"],
  ["ca", "ca"],
  ["cs", "cs"],
  ["da", "da"],
  ["de", "de"],
  ["el", "el"],
  ["en", "en"],
  ["es", "es"],
  ["et", "et"],
  ["fi", "fi"],
  ["fr", "fr"],
  ["he", "he"],
  ["hr", "hr"],
  ["hu", "hu"],
  ["id", "id"],
  ["it", "it"],
  ["ja", "ja"],
  ["ko", "ko"],
  ["lt", "lt"],
  ["lv", "lv"],
  ["nb", "nb"],
  ["nl", "nl"],
  ["pl", "pl"],
  ["pt-br", "pt-BR"],
  ["pt-pt", "pt-PT"],
  ["ro", "ro"],
  ["ru", "ru"],
  ["sk", "sk"],
  ["sl", "sl"],
  ["sr", "sr"],
  ["sv", "sv"],
  ["th", "th"],
  ["tr", "tr"],
  ["uk", "uk"],
  ["vi", "vi"],
  ["zh-cn", "zh-CN"],
  ["zh-hk", "zh-HK"],
  ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
  return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
  const closestWithProp = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
  return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
  rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
  const { api, type, places } = options || {};
  if (api === 4) {
    const [intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
    const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
      places,
      style: type,
      digitSeparator: true
    });
    return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
  }
  const [dojoNumber] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
  return dojoNumber.format(number, {
    type,
    places,
    pattern: options === null || options === void 0 ? void 0 : options.pattern
  });
}
const cache = {};
function formatDate(date) {
  const lang = document.documentElement.lang;
  const dayShortMonthYear = {
    year: "numeric",
    month: "short",
    day: "numeric"
  };
  if (!cache[lang]) {
    cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
  }
  return cache[lang].format(date);
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fY29tbW9uLTg1MjgwZC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxvRUFBb0U7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsa0RBQWtEO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLG9EQUFvRDtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLDBDQUEwQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDO0FBQ3ZDLENBQUMsd0NBQXdDO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsa0NBQWtDOztBQUU0SDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDbkUvSjtBQUNBO0FBQ0E7QUFDQTtBQUMyRjtBQUM5Qjs7QUFFN0Q7QUFDQTtBQUNBLDhCQUE4Qix1REFBbUI7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyx1REFBbUIsWUFBWSxFQUFFLGdCQUFnQjtBQUMzRjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsdURBQWU7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QTtBQUM2RDtBQUNjOztBQUUzRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLG1EQUFpQyxTQUFTLEtBQUs7QUFDekU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLG9CQUFvQjtBQUM5QjtBQUNBLHlCQUF5QiwyREFBVztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxtRUFBbUUsOEJBQThCLGFBQWE7QUFDOUc7QUFDQSw2QkFBNkIsMkRBQVc7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFc0ciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9jb21tb25FbnVtcy1mOThhMzIzYy5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9jb21tb25GdW5jdGlvbnMtNTI2MmIwOTQuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xudmFyIGltYWdlQ29tcG9uZW50SW5wdXRUeXBlc0VudW07XG4oZnVuY3Rpb24gKGltYWdlQ29tcG9uZW50SW5wdXRUeXBlc0VudW0pIHtcbiAgaW1hZ2VDb21wb25lbnRJbnB1dFR5cGVzRW51bVtcInNvdXJjZVVybFwiXSA9IFwic291cmNlVXJsXCI7XG4gIGltYWdlQ29tcG9uZW50SW5wdXRUeXBlc0VudW1bXCJ0aXRsZVwiXSA9IFwidGl0bGVcIjtcbiAgaW1hZ2VDb21wb25lbnRJbnB1dFR5cGVzRW51bVtcImNhcHRpb25cIl0gPSBcImNhcHRpb25cIjtcbiAgaW1hZ2VDb21wb25lbnRJbnB1dFR5cGVzRW51bVtcImxpbmtVcmxcIl0gPSBcImxpbmtVcmxcIjtcbiAgaW1hZ2VDb21wb25lbnRJbnB1dFR5cGVzRW51bVtcImFsdFRleHRcIl0gPSBcImFsdFRleHRcIjtcbn0pKGltYWdlQ29tcG9uZW50SW5wdXRUeXBlc0VudW0gfHwgKGltYWdlQ29tcG9uZW50SW5wdXRUeXBlc0VudW0gPSB7fSkpO1xudmFyIGZpZWxkSW5mb1ByZWZpeEVudW07XG4oZnVuY3Rpb24gKGZpZWxkSW5mb1ByZWZpeEVudW0pIHtcbiAgZmllbGRJbmZvUHJlZml4RW51bVtcImV4cHJlc3Npb25cIl0gPSBcImV4cHJlc3Npb24vXCI7XG4gIGZpZWxkSW5mb1ByZWZpeEVudW1bXCJyZWxhdGlvbnNoaXBcIl0gPSBcInJlbGF0aW9uc2hpcHMvXCI7XG4gIGZpZWxkSW5mb1ByZWZpeEVudW1bXCJyYXN0ZXJcIl0gPSBcIlJhc3Rlci5cIjtcbn0pKGZpZWxkSW5mb1ByZWZpeEVudW0gfHwgKGZpZWxkSW5mb1ByZWZpeEVudW0gPSB7fSkpO1xudmFyIGxheWVyRGlzcGxheVR5cGVFbnVtO1xuKGZ1bmN0aW9uIChsYXllckRpc3BsYXlUeXBlRW51bSkge1xuICBsYXllckRpc3BsYXlUeXBlRW51bVtcImZlYXR1cmVcIl0gPSBcImZlYXR1cmVcIjtcbiAgbGF5ZXJEaXNwbGF5VHlwZUVudW1bXCJjbHVzdGVyXCJdID0gXCJjbHVzdGVyXCI7XG4gIGxheWVyRGlzcGxheVR5cGVFbnVtW1wibWFwTm90ZXNcIl0gPSBcIm1hcE5vdGVzXCI7XG59KShsYXllckRpc3BsYXlUeXBlRW51bSB8fCAobGF5ZXJEaXNwbGF5VHlwZUVudW0gPSB7fSkpO1xudmFyIHNlcnZpY2VUeXBlRW51bTtcbihmdW5jdGlvbiAoc2VydmljZVR5cGVFbnVtKSB7XG4gIHNlcnZpY2VUeXBlRW51bVtcImZlYXR1cmVcIl0gPSBcImZlYXR1cmVcIjtcbiAgc2VydmljZVR5cGVFbnVtW1wibWFwSW1hZ2VcIl0gPSBcIm1hcC1pbWFnZVwiO1xuICBzZXJ2aWNlVHlwZUVudW1bXCJzY2VuZVwiXSA9IFwic2NlbmVcIjtcbiAgc2VydmljZVR5cGVFbnVtW1wib2djRmVhdHVyZVwiXSA9IFwib2djLWZlYXR1cmVcIjtcbiAgc2VydmljZVR5cGVFbnVtW1wiaW1hZ2VyeVwiXSA9IFwiaW1hZ2VyeVwiO1xuICBzZXJ2aWNlVHlwZUVudW1bXCJ3ZnNcIl0gPSBcIndmc1wiO1xuICBzZXJ2aWNlVHlwZUVudW1bXCJ3bXNcIl0gPSBcIndtc1wiO1xuICBzZXJ2aWNlVHlwZUVudW1bXCJjc3ZcIl0gPSBcImNzdlwiO1xuICBzZXJ2aWNlVHlwZUVudW1bXCJnZW9qc29uXCJdID0gXCJnZW9qc29uXCI7XG4gIHNlcnZpY2VUeXBlRW51bVtcInN0cmVhbVwiXSA9IFwic3RyZWFtXCI7XG4gIHNlcnZpY2VUeXBlRW51bVtcImltYWdlcnlUaWxlXCJdID0gXCJpbWFnZXJ5LXRpbGVcIjtcbiAgc2VydmljZVR5cGVFbnVtW1widGlsZVwiXSA9IFwidGlsZVwiO1xuICBzZXJ2aWNlVHlwZUVudW1bXCJzdWJ0eXBlXCJdID0gXCJzdWJ0eXBlXCI7XG59KShzZXJ2aWNlVHlwZUVudW0gfHwgKHNlcnZpY2VUeXBlRW51bSA9IHt9KSk7XG4vLyBodHRwczovL2RldmVsb3BlcnMuYXJjZ2lzLmNvbS9qYXZhc2NyaXB0L2xhdGVzdC9hcGktcmVmZXJlbmNlL2VzcmktbGF5ZXJzLXN1cHBvcnQtRmllbGQuaHRtbCN0eXBlXG52YXIgZmllbGRUeXBlc0VudW07XG4oZnVuY3Rpb24gKGZpZWxkVHlwZXNFbnVtKSB7XG4gIGZpZWxkVHlwZXNFbnVtW1wiaW50ZWdlclwiXSA9IFwiaW50ZWdlclwiO1xuICBmaWVsZFR5cGVzRW51bVtcInNtYWxsSW50ZWdlclwiXSA9IFwic21hbGwtaW50ZWdlclwiO1xuICBmaWVsZFR5cGVzRW51bVtcImJpZ0ludGVnZXJcIl0gPSBcImJpZy1pbnRlZ2VyXCI7XG4gIGZpZWxkVHlwZXNFbnVtW1wic2luZ2xlXCJdID0gXCJzaW5nbGVcIjtcbiAgZmllbGRUeXBlc0VudW1bXCJkb3VibGVcIl0gPSBcImRvdWJsZVwiO1xuICBmaWVsZFR5cGVzRW51bVtcImxvbmdcIl0gPSBcImxvbmdcIjtcbiAgZmllbGRUeXBlc0VudW1bXCJzdHJpbmdcIl0gPSBcInN0cmluZ1wiO1xuICBmaWVsZFR5cGVzRW51bVtcImRhdGVcIl0gPSBcImRhdGVcIjtcbiAgZmllbGRUeXBlc0VudW1bXCJkYXRlT25seVwiXSA9IFwiZGF0ZS1vbmx5XCI7XG4gIGZpZWxkVHlwZXNFbnVtW1widGltZU9ubHlcIl0gPSBcInRpbWUtb25seVwiO1xuICBmaWVsZFR5cGVzRW51bVtcInRpbWVzdGFtcE9mZnNldFwiXSA9IFwidGltZXN0YW1wLW9mZnNldFwiO1xuICBmaWVsZFR5cGVzRW51bVtcIm9pZFwiXSA9IFwib2lkXCI7XG4gIGZpZWxkVHlwZXNFbnVtW1wiZ3VpZFwiXSA9IFwiZ3VpZFwiO1xuICBmaWVsZFR5cGVzRW51bVtcImdsb2JhbElkXCJdID0gXCJnbG9iYWwtaWRcIjtcbiAgZmllbGRUeXBlc0VudW1bXCJudW1iZXJcIl0gPSBcIm51bWJlclwiOyAvLyBmb3IgYXJjYWRlXG59KShmaWVsZFR5cGVzRW51bSB8fCAoZmllbGRUeXBlc0VudW0gPSB7fSkpO1xudmFyIExhc3RTb3J0eUJ5O1xuKGZ1bmN0aW9uIChMYXN0U29ydHlCeSkge1xuICBMYXN0U29ydHlCeVtcImRlZmF1bHRcIl0gPSBcImRlZmF1bHRcIjtcbiAgTGFzdFNvcnR5QnlbXCJkaXNwbGF5XCJdID0gXCJkaXNwbGF5XCI7XG4gIExhc3RTb3J0eUJ5W1widHlwZVwiXSA9IFwidHlwZVwiO1xuICBMYXN0U29ydHlCeVtcImZpZWxkXCJdID0gXCJmaWVsZFwiO1xufSkoTGFzdFNvcnR5QnkgfHwgKExhc3RTb3J0eUJ5ID0ge30pKTtcblxuZXhwb3J0IHsgTGFzdFNvcnR5QnkgYXMgTCwgZmllbGRUeXBlc0VudW0gYXMgYSwgZmllbGRJbmZvUHJlZml4RW51bSBhcyBmLCBpbWFnZUNvbXBvbmVudElucHV0VHlwZXNFbnVtIGFzIGksIGxheWVyRGlzcGxheVR5cGVFbnVtIGFzIGwsIHNlcnZpY2VUeXBlRW51bSBhcyBzIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IHMgYXMgc2VydmljZVR5cGVFbnVtLCBmIGFzIGZpZWxkSW5mb1ByZWZpeEVudW0gfSBmcm9tICcuL2NvbW1vbkVudW1zLWY5OGEzMjNjLmpzJztcbmltcG9ydCB7IGwgYXMgbG9hZE1vZHVsZXMgfSBmcm9tICcuL2xvYWRNb2R1bGVzLWFhZjMwYmQ2LmpzJztcblxuLy8gZGlzcGxheSBuYW1lIGZyb20gZmllbGRzIGZvciBhcmNhZGVcbmZ1bmN0aW9uIGdldEZpZWxkRGlzcGxheU5hbWUoZmllbGQsIGFyY2FkZU1hcCkge1xuICBpZiAoZmllbGQuZmllbGROYW1lLmluZGV4T2YoZmllbGRJbmZvUHJlZml4RW51bS5leHByZXNzaW9uKSAhPT0gLTEpIHtcbiAgICBjb25zdCB0ZW1wQXJjYWRlID0gYXJjYWRlTWFwLmdldChmaWVsZC5maWVsZE5hbWUpO1xuICAgIHJldHVybiAodGVtcEFyY2FkZSA9PT0gbnVsbCB8fCB0ZW1wQXJjYWRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZW1wQXJjYWRlLnRpdGxlKSA/IHRlbXBBcmNhZGUudGl0bGUgOiBmaWVsZC5maWVsZE5hbWU7XG4gIH1cbiAgZWxzZSB7XG4gICAgcmV0dXJuIGZpZWxkLmxhYmVsID8gZmllbGQubGFiZWwgOiBmaWVsZC5maWVsZE5hbWU7XG4gIH1cbn1cbmZ1bmN0aW9uIGdlbmVyYXRlQXJjYWRlRXhwcmVzc2lvbk1hcChwb3B1cFRlbXBsYXRlKSB7XG4gIGNvbnN0IGFyY2FkZUV4cE1hcCA9IG5ldyBNYXAoKTtcbiAgaWYgKHBvcHVwVGVtcGxhdGUgPT09IG51bGwgfHwgcG9wdXBUZW1wbGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9wdXBUZW1wbGF0ZS5leHByZXNzaW9uSW5mb3MpIHtcbiAgICBwb3B1cFRlbXBsYXRlLmV4cHJlc3Npb25JbmZvcy5mb3JFYWNoKChleHByZXNzaW9uKSA9PiB7XG4gICAgICBjb25zdCBleHByZXNzaW9uTmFtZVdpdGhQcmVmaXggPSBgJHtmaWVsZEluZm9QcmVmaXhFbnVtLmV4cHJlc3Npb259JHtleHByZXNzaW9uLm5hbWV9YDtcbiAgICAgIGFyY2FkZUV4cE1hcC5zZXQoZXhwcmVzc2lvbk5hbWVXaXRoUHJlZml4LCBleHByZXNzaW9uKTtcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gYXJjYWRlRXhwTWFwO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVMYXllckZpZWxkc01hcChsYXllcikge1xuICByZXR1cm4gbmV3IE1hcCgoYXdhaXQgZ2V0RmllbGRzRnJvbUxheWVyKGxheWVyKSlcbiAgICAuZmlsdGVyKChmaWVsZCkgPT4gZmllbGQudmlzaWJsZSlcbiAgICAubWFwKChmaWVsZCkgPT4gW2ZpZWxkLm5hbWUsIGZpZWxkXSkpO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0U2luZ2xlRmVhdHVyZShsYXllciwgbWFwVmlldykge1xuICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZiwgX2csIF9oLCBfajtcbiAgdHJ5IHtcbiAgICBjb25zdCBzZXJ2aWNlVHlwZSA9IGdldFNlcnZpY2VUeXBlKGxheWVyKTtcbiAgICBpZiAoc2VydmljZVR5cGUgPT09IHNlcnZpY2VUeXBlRW51bS5tYXBJbWFnZSAmJlxuICAgICAgbGF5ZXIubGF5ZXIudmVyc2lvbiA+PSAxMC41ICYmXG4gICAgICAhKChfYiA9IChfYSA9IGxheWVyLmxheWVyLmNhcGFiaWxpdGllcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm9wZXJhdGlvbnMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zdXBwb3J0c1F1ZXJ5KSAmJlxuICAgICAgKChfZCA9IChfYyA9IGxheWVyLmxheWVyLmNhcGFiaWxpdGllcykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLm9wZXJhdGlvbnMpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5zdXBwb3J0c0lkZW50aWZ5KSkge1xuICAgICAgY29uc3QgY3VyckZlYXR1cmUgPSB7XG4gICAgICAgIGZlYXR1cmVzOiBbXG4gICAgICAgICAgKGF3YWl0IGlkZW50aWZ5T25NYXBJbWFnZUxheWVyKGxheWVyLCBtYXBWaWV3KSkgfHxcbiAgICAgICAgICAgIChhd2FpdCBnZW5lcmF0ZVNpbmdsZUZlYXR1cmUobGF5ZXIpKVxuICAgICAgICBdXG4gICAgICB9O1xuICAgICAgcmV0dXJuIGN1cnJGZWF0dXJlO1xuICAgIH1cbiAgICBpZiAoc2VydmljZVR5cGUgPT09IHNlcnZpY2VUeXBlRW51bS5zY2VuZSAmJlxuICAgICAgISgoX2YgPSAoX2UgPSBsYXllci5jYXBhYmlsaXRpZXMpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5vcGVyYXRpb25zKSA9PT0gbnVsbCB8fCBfZiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Yuc3VwcG9ydHNRdWVyeSkpIHtcbiAgICAgIGNvbnN0IHNpbmdsZUZlYXR1cmUgPSB7XG4gICAgICAgIGZlYXR1cmVzOiBbYXdhaXQgZ2VuZXJhdGVTaW5nbGVGZWF0dXJlKGxheWVyKV1cbiAgICAgIH07XG4gICAgICByZXR1cm4gc2luZ2xlRmVhdHVyZTtcbiAgICB9XG4gICAgY29uc3QgY3VycmVudExheWVyID0gc2VydmljZVR5cGUgPT09IHNlcnZpY2VUeXBlRW51bS5vZ2NGZWF0dXJlXG4gICAgICA/IChhd2FpdCBtYXBWaWV3LndoZW5MYXllclZpZXcobGF5ZXIpKVxuICAgICAgOiBzZXJ2aWNlVHlwZSA9PT0gc2VydmljZVR5cGVFbnVtLnN0cmVhbVxuICAgICAgICA/IChhd2FpdCBtYXBWaWV3LndoZW5MYXllclZpZXcobGF5ZXIpKVxuICAgICAgICA6IGxheWVyO1xuICAgIGNvbnN0IHF1ZXJ5UGFyYW1zID0gY3VycmVudExheWVyLmNyZWF0ZVF1ZXJ5KCk7XG4gICAgcXVlcnlQYXJhbXMud2hlcmUgPVxuICAgICAgY3VycmVudExheWVyLmRlZmluaXRpb25FeHByZXNzaW9uIHx8IFwiMT0xXCI7XG4gICAgcXVlcnlQYXJhbXMub3V0RmllbGRzID0gW1wiKlwiXTtcbiAgICBxdWVyeVBhcmFtcy5yZXR1cm5NID0gXCJoYXNNXCIgaW4gbGF5ZXIgJiYgbGF5ZXIuaGFzTTtcbiAgICBxdWVyeVBhcmFtcy5yZXR1cm5aID0gXCJoYXNaXCIgaW4gbGF5ZXIgJiYgbGF5ZXIuaGFzWjtcbiAgICAvLyBwYWdpbmF0aW9uIGFsd2F5cyBzdXBwb3J0ZWQgZm9yIE9HQ0ZlYXR1cmVMYXllclZpZXdcbiAgICBpZiAoKChfaCA9IChfZyA9IGN1cnJlbnRMYXllci5zb3VyY2VKU09OKSA9PT0gbnVsbCB8fCBfZyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2cuYWR2YW5jZWRRdWVyeUNhcGFiaWxpdGllcykgPT09IG51bGwgfHwgX2ggPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9oLnN1cHBvcnRzUGFnaW5hdGlvbikgfHxcbiAgICAgIHNlcnZpY2VUeXBlID09PSBzZXJ2aWNlVHlwZUVudW0ub2djRmVhdHVyZSkge1xuICAgICAgcXVlcnlQYXJhbXMuc3RhcnQgPSAwO1xuICAgICAgcXVlcnlQYXJhbXMubnVtID0gMTtcbiAgICB9XG4gICAgcXVlcnlQYXJhbXMub3V0U3BhdGlhbFJlZmVyZW5jZSA9IG1hcFZpZXcuc3BhdGlhbFJlZmVyZW5jZTtcbiAgICBjb25zdCBzaW5nbGVGZWF0dXJlUmVzcG9uc2UgPSBhd2FpdCBjdXJyZW50TGF5ZXIucXVlcnlGZWF0dXJlcyhxdWVyeVBhcmFtcyk7XG4gICAgaWYgKCgoX2ogPSBzaW5nbGVGZWF0dXJlUmVzcG9uc2UgPT09IG51bGwgfHwgc2luZ2xlRmVhdHVyZVJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzaW5nbGVGZWF0dXJlUmVzcG9uc2UuZmVhdHVyZXMpID09PSBudWxsIHx8IF9qID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfai5sZW5ndGgpID09PSAwKSB7XG4gICAgICBzaW5nbGVGZWF0dXJlUmVzcG9uc2UuZmVhdHVyZXNbMF0gPSBhd2FpdCBnZW5lcmF0ZVNpbmdsZUZlYXR1cmUobGF5ZXIpO1xuICAgIH1cbiAgICByZXR1cm4gc2luZ2xlRmVhdHVyZVJlc3BvbnNlO1xuICB9XG4gIGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICB9XG59XG5hc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVNpbmdsZUZlYXR1cmUobGF5ZXIpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBsb2FkTW9kdWxlcyhbXCJlc3JpL0dyYXBoaWNcIiwgXCJlc3JpL2dlb21ldHJ5L0dlb21ldHJ5XCJdKS50aGVuKChbR3JhcGhpYywgR2VvbWV0cnldKSA9PiB7XG4gICAgICB2YXIgX2E7XG4gICAgICBjb25zdCB0ZW1wR3JhcGhpYyA9IG5ldyBHcmFwaGljKCk7XG4gICAgICBpZiAoKF9hID0gbGF5ZXIuZmllbGRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IHRlbXBBdHRyaWJ1dGVzID0ge307XG4gICAgICAgIGxheWVyLmZpZWxkcy5mb3JFYWNoKChmZWF0dXJlKSA9PiB7XG4gICAgICAgICAgdGVtcEF0dHJpYnV0ZXNbZmVhdHVyZS5uYW1lXSA9IGZlYXR1cmUuZGVmYXVsdFZhbHVlO1xuICAgICAgICB9KTtcbiAgICAgICAgdGVtcEdyYXBoaWMuYXR0cmlidXRlcyA9IHRlbXBBdHRyaWJ1dGVzO1xuICAgICAgfVxuICAgICAgaWYgKGxheWVyLmdlb21ldHJ5VHlwZSkge1xuICAgICAgICBjb25zdCB0ZW1wR2VvbWV0cnkgPSBuZXcgR2VvbWV0cnkoKTtcbiAgICAgICAgdGVtcEdlb21ldHJ5LnR5cGUgPSBsYXllci5nZW9tZXRyeVR5cGU7XG4gICAgICAgIHRlbXBHcmFwaGljLmdlb21ldHJ5ID0gdGVtcEdlb21ldHJ5O1xuICAgICAgfVxuICAgICAgcmVzb2x2ZSh0ZW1wR3JhcGhpYyk7XG4gICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICByZWplY3QoZXJyb3IpO1xuICAgIH0pO1xuICB9KTtcbn1cbmZ1bmN0aW9uIGdldFNlcnZpY2VUeXBlKGxheWVyKSB7XG4gIHZhciBfYSwgX2IsIF9jO1xuICBpZiAoKChfYSA9IGxheWVyID09PSBudWxsIHx8IGxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllci5sYXllcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnR5cGUpID09PSBcIm1hcC1pbWFnZVwiKSB7XG4gICAgcmV0dXJuIHNlcnZpY2VUeXBlRW51bS5tYXBJbWFnZTtcbiAgfVxuICBpZiAoKGxheWVyID09PSBudWxsIHx8IGxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllci50eXBlKSA9PT0gXCJzdWJ0eXBlLXN1YmxheWVyXCIpIHtcbiAgICByZXR1cm4gc2VydmljZVR5cGVFbnVtLnN1YnR5cGU7XG4gIH1cbiAgaWYgKCgoX2IgPSBsYXllciA9PT0gbnVsbCB8fCBsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXIubGF5ZXIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50eXBlKSA9PT0gXCJ0aWxlXCIpIHtcbiAgICByZXR1cm4gc2VydmljZVR5cGVFbnVtLnRpbGU7XG4gIH1cbiAgaWYgKChsYXllciA9PT0gbnVsbCB8fCBsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXIudHlwZSkgPT09IFwic2NlbmVcIikge1xuICAgIHJldHVybiBzZXJ2aWNlVHlwZUVudW0uc2NlbmU7XG4gIH1cbiAgaWYgKChsYXllciA9PT0gbnVsbCB8fCBsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXIudHlwZSkgPT09IFwib2djLWZlYXR1cmVcIikge1xuICAgIHJldHVybiBzZXJ2aWNlVHlwZUVudW0ub2djRmVhdHVyZTtcbiAgfVxuICBpZiAoKGxheWVyID09PSBudWxsIHx8IGxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllci50eXBlKSA9PT0gXCJpbWFnZXJ5XCIpIHtcbiAgICByZXR1cm4gc2VydmljZVR5cGVFbnVtLmltYWdlcnk7XG4gIH1cbiAgaWYgKChsYXllciA9PT0gbnVsbCB8fCBsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXIudHlwZSkgPT09IFwiaW1hZ2VyeS10aWxlXCIpIHtcbiAgICByZXR1cm4gc2VydmljZVR5cGVFbnVtLmltYWdlcnlUaWxlO1xuICB9XG4gIGlmICgobGF5ZXIgPT09IG51bGwgfHwgbGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxheWVyLnR5cGUpID09PSBcIndmc1wiKSB7XG4gICAgcmV0dXJuIHNlcnZpY2VUeXBlRW51bS53ZnM7XG4gIH1cbiAgaWYgKCgoX2MgPSBsYXllciA9PT0gbnVsbCB8fCBsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXIubGF5ZXIpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy50eXBlKSA9PT0gXCJ3bXNcIikge1xuICAgIHJldHVybiBzZXJ2aWNlVHlwZUVudW0ud21zO1xuICB9XG4gIGlmICgobGF5ZXIgPT09IG51bGwgfHwgbGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxheWVyLnR5cGUpID09PSBcImNzdlwiKSB7XG4gICAgcmV0dXJuIHNlcnZpY2VUeXBlRW51bS5jc3Y7XG4gIH1cbiAgaWYgKChsYXllciA9PT0gbnVsbCB8fCBsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXIudHlwZSkgPT09IFwiZ2VvanNvblwiKSB7XG4gICAgcmV0dXJuIHNlcnZpY2VUeXBlRW51bS5nZW9qc29uO1xuICB9XG4gIGlmICgobGF5ZXIgPT09IG51bGwgfHwgbGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxheWVyLnR5cGUpID09PSBcInN0cmVhbVwiKSB7XG4gICAgcmV0dXJuIHNlcnZpY2VUeXBlRW51bS5zdHJlYW07XG4gIH1cbiAgcmV0dXJuIHNlcnZpY2VUeXBlRW51bS5mZWF0dXJlO1xufVxuZnVuY3Rpb24gZ2V0U2VydmljZVZlcnNpb24obGF5ZXIpIHtcbiAgY29uc3QgdHlwZSA9IGdldFNlcnZpY2VUeXBlKGxheWVyKTtcbiAgbGV0IHZlcnNpb247XG4gIGlmICh0eXBlID09PSBzZXJ2aWNlVHlwZUVudW0ud21zIHx8IHR5cGUgPT09IHNlcnZpY2VUeXBlRW51bS5tYXBJbWFnZSkge1xuICAgIHZlcnNpb24gPSBsYXllciA9PT0gbnVsbCB8fCBsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXIubGF5ZXIudmVyc2lvbjtcbiAgfVxuICBlbHNlIGlmICh0eXBlID09PSBzZXJ2aWNlVHlwZUVudW0uaW1hZ2VyeSB8fCB0eXBlID09PSBzZXJ2aWNlVHlwZUVudW0uZmVhdHVyZSB8fCB0eXBlID09PSBzZXJ2aWNlVHlwZUVudW0uc2NlbmUpIHtcbiAgICB2ZXJzaW9uID0gbGF5ZXJcbiAgICAgIC52ZXJzaW9uO1xuICB9XG4gIHJldHVybiBOdW1iZXIucGFyc2VGbG9hdCh2ZXJzaW9uKTtcbn1cbi8vIFRoZW1hdGljR3JvdXAgZmllbGRzIGFyZSBkaWZmZXJlbnQgdGhhbiByZWd1bGFyIGxheWVyLmZpZWxkc1xuYXN5bmMgZnVuY3Rpb24gZ2V0RmllbGRzRnJvbUxheWVyKGxheWVyKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgIGNvbnN0IHR5cGUgPSBnZXRTZXJ2aWNlVHlwZShsYXllcik7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIHNlcnZpY2VUeXBlRW51bS5mZWF0dXJlOlxuICAgICAgY2FzZSBzZXJ2aWNlVHlwZUVudW0ub2djRmVhdHVyZTpcbiAgICAgIGNhc2Ugc2VydmljZVR5cGVFbnVtLnN0cmVhbTpcbiAgICAgICAgcmVzb2x2ZShsYXllci5maWVsZHMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2Ugc2VydmljZVR5cGVFbnVtLm1hcEltYWdlOlxuICAgICAgICBpZiAoKChfYSA9IGxheWVyID09PSBudWxsIHx8IGxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllci5sYXllcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnBvcnRhbEl0ZW0pICYmXG4gICAgICAgICAgKChfYiA9IGxheWVyLmxheWVyKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudXJsLmluZGV4T2YoXCJodHRwczovL2RlbW9ncmFwaGljc1wiKSkgPiAtMSAmJlxuICAgICAgICAgICgoX2MgPSBsYXllci5sYXllcikgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnVybC5pbmRleE9mKFwiLmFyY2dpcy5jb21cIikpID4gLTEpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCAoKF9kID0gbGF5ZXIubGF5ZXIucG9ydGFsSXRlbSkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmZldGNoRGF0YSgpKTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2UudGhlbWF0aWNHcm91cCkge1xuICAgICAgICAgICAgICAvLyBjcmVhdGUgaGFzaCBtYXAgZm9yIHNlYXJjaCBvcHRpbWl6YXRpb25cbiAgICAgICAgICAgICAgY29uc3QgbGF5ZXJGaWVsZE1hcCA9IG5ldyBNYXAobGF5ZXIuZmllbGRzLm1hcCgoZmllbGQpID0+IFtmaWVsZC5uYW1lLCBmaWVsZF0pKTtcbiAgICAgICAgICAgICAgY29uc3QgZmllbGROYW1lcyA9IHJlc3BvbnNlLnRoZW1hdGljR3JvdXAuZmllbGROYW1lcztcbiAgICAgICAgICAgICAgY29uc3QgcmV0dXJuRmllbGRzID0gW107XG4gICAgICAgICAgICAgIGZpZWxkTmFtZXMuZm9yRWFjaCgoY3VycmVudEZpZWxkKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGxheWVyRmllbGRNYXAuaGFzKGN1cnJlbnRGaWVsZCkpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybkZpZWxkcy5wdXNoKGxheWVyRmllbGRNYXAuZ2V0KGN1cnJlbnRGaWVsZCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHJlc29sdmUocmV0dXJuRmllbGRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICByZXNvbHZlKGxheWVyLmZpZWxkcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShsYXllci5maWVsZHMpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBzZXJ2aWNlVHlwZUVudW0uaW1hZ2VyeTpcbiAgICAgICAgY29uc3QgaUxheWVyID0gbGF5ZXI7XG4gICAgICAgIHJlc29sdmUoKGlMYXllci5maWVsZHMgfHwgW10pLmNvbmNhdChpTGF5ZXIucmFzdGVyRmllbGRzIHx8IFtdKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBzZXJ2aWNlVHlwZUVudW0uaW1hZ2VyeVRpbGU6XG4gICAgICAgIC8vIG5vdCBzdXJlIHdoeSBpdCB1c2VkIHRvIGJlIHBvcHVwVGVtcGxhdGUuZmllbGRJbmZvcy4uLlxuICAgICAgICByZXNvbHZlKC8qIGxheWVyLnBvcHVwVGVtcGxhdGU/LmZpZWxkSW5mb3MgfHwgKi8gbGF5ZXIucmFzdGVyRmllbGRzKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXNvbHZlKFwiZmllbGRzXCIgaW4gbGF5ZXIgJiYgbGF5ZXIuZmllbGRzKTtcbiAgICB9XG4gIH0pO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0TGF5ZXJHZW9tZXRyeVR5cGUobGF5ZXIpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlKSA9PiB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZTtcbiAgICBpZiAoZ2V0U2VydmljZVR5cGUobGF5ZXIpID09PSBzZXJ2aWNlVHlwZUVudW0uc3RyZWFtKSB7XG4gICAgICByZXNvbHZlKFwicG9pbnRcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGxheWVyLmdlb21ldHJ5VHlwZSkge1xuICAgICAgcmVzb2x2ZShsYXllci5nZW9tZXRyeVR5cGUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGlmIChnZXRTZXJ2aWNlVHlwZShsYXllcikgPT09IHNlcnZpY2VUeXBlRW51bS5tYXBJbWFnZSAmJiAoKF9iID0gKF9hID0gbGF5ZXIgPT09IG51bGwgfHwgbGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxheWVyLmxheWVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc291cmNlSlNPTikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmxheWVycykpIHtcbiAgICAgICAgY29uc3QgdGVtcEdlb21ldHJ5VHlwZSA9IChfZCA9IChfYyA9IGxheWVyLmxheWVyLnNvdXJjZUpTT04ubGF5ZXJzXG4gICAgICAgICAgLmZpbmQoKHNvdXJjZUpTT05MYXllcikgPT4ge1xuICAgICAgICAgIGlmIChzb3VyY2VKU09OTGF5ZXIuaWQgPT09IGxheWVyLmlkKSB7XG4gICAgICAgICAgICByZXR1cm4gc291cmNlSlNPTkxheWVyO1xuICAgICAgICAgIH1cbiAgICAgICAgfSkpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5nZW9tZXRyeVR5cGUpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAodGVtcEdlb21ldHJ5VHlwZSkge1xuICAgICAgICAgIGlmICh0ZW1wR2VvbWV0cnlUeXBlLmluZGV4T2YoXCJwb2ludFwiKSA+IC0xKSB7XG4gICAgICAgICAgICByZXNvbHZlKFwicG9pbnRcIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYgKHRlbXBHZW9tZXRyeVR5cGUuaW5kZXhPZihcImxpbmVcIikgPiAtMSkge1xuICAgICAgICAgICAgcmVzb2x2ZShcInBvbHlsaW5lXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmICh0ZW1wR2VvbWV0cnlUeXBlLmluZGV4T2YoXCJwb2x5Z29uXCIpID4gLTEpIHtcbiAgICAgICAgICAgIHJlc29sdmUoXCJwb2x5Z29uXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlc29sdmUodGVtcEdlb21ldHJ5VHlwZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIC8vIHRyeSB0byBnZXQgaXQgdmlhIHN1YmxheWVyLmNyZWF0ZUZlYXR1cmVMYXllcigpO1xuICAgICAgICAgIGNvbnN0IHN1YkxheWVyID0gKF9lID0gbGF5ZXIgPT09IG51bGwgfHwgbGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxheWVyLmxheWVyKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UuZmluZFN1YmxheWVyQnlJZChsYXllci5pZCk7XG4gICAgICAgICAgaWYgKHN1YkxheWVyKSB7XG4gICAgICAgICAgICBhd2FpdCAoc3ViTGF5ZXIgPT09IG51bGwgfHwgc3ViTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHN1YkxheWVyLmNyZWF0ZUZlYXR1cmVMYXllcigpLnRoZW4oYXN5bmMgKGZlYXR1cmVMYXllcikgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBmTGF5ZXIgPSBhd2FpdCAoZmVhdHVyZUxheWVyID09PSBudWxsIHx8IGZlYXR1cmVMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmVhdHVyZUxheWVyLmxvYWQoKSk7XG4gICAgICAgICAgICAgIHJlc29sdmUoZkxheWVyID09PSBudWxsIHx8IGZMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZkxheWVyLmdlb21ldHJ5VHlwZSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59XG5mdW5jdGlvbiBnZXRGaWVsZFR5cGUoZmllbGROYW1lLCBsYXllckZpZWxkc01hcCwgYXJjYWRlRXhwTWFwKSB7XG4gIGxldCB0eXBlID0gXCJcIjtcbiAgaWYgKC9ecmFzdGVyLihpdGVtfHNlcnZpY2UpcGl4ZWx2YWx1ZS9pLnRlc3QoZmllbGROYW1lKSkge1xuICAgIC8vIGUuZy4gXCJSYXN0ZXIuU2VydmljZVBpeGVsVmFsdWVcIiB8IFwiUmFzdGVyLkl0ZW1QaXhlbFZhbHVlXCIgfCBcIlJhc3Rlci5TZXJ2aWNlUGl4ZWxWYWx1ZS5SYXdcIlxuICAgIC8vIGxheWVyLnJhc3RlckZpZWxkcyByZXBvcnRzIHRoZW0gYXMgdHlwZSBcInN0cmluZ1wiXG4gICAgdHlwZSA9IFwibnVtYmVyXCI7XG4gIH1cbiAgZWxzZSBpZiAobGF5ZXJGaWVsZHNNYXAuaGFzKGZpZWxkTmFtZSkpIHtcbiAgICBjb25zdCBmaWVsZFR5cGUgPSBsYXllckZpZWxkc01hcC5nZXQoZmllbGROYW1lKTtcbiAgICB0eXBlID0gZmllbGRUeXBlLnR5cGUgPyBmaWVsZFR5cGUudHlwZS50b0xvd2VyQ2FzZSgpIDogXCJcIjtcbiAgfVxuICBlbHNlIGlmIChhcmNhZGVFeHBNYXAuaGFzKGZpZWxkTmFtZSkpIHtcbiAgICBjb25zdCBhcmNhZGVGaWVsZCA9IGFyY2FkZUV4cE1hcC5nZXQoZmllbGROYW1lKTtcbiAgICB0eXBlID0gYXJjYWRlRmllbGQucmV0dXJuVHlwZSA/IGFyY2FkZUZpZWxkLnJldHVyblR5cGUudG9Mb3dlckNhc2UoKSA6IFwiXCI7XG4gIH1cbiAgZWxzZSB7XG4gICAgLy8gZGVmYXVsdCB0byBudW1iZXIgZm9yIGNsdXN0ZXJcbiAgICB0eXBlID0gXCJudW1iZXJcIjtcbiAgfVxuICByZXR1cm4gdHlwZTtcbn1cbi8qKlxuICogUmV0dXJucyBmZWF0dXJlIGNvdW50IG9mIGxheWVyXG4gKiBAcGFyYW0gbGF5ZXIgLSBGZWF0dXJlTGF5ZXIgfCBXRlNMYXllciB8IE9HQ0ZlYXR1cmVMYXllciB8IFN0cmVhbUxheWVyIHwgQ1NWTGF5ZXJcbiAqIEBwYXJhbSBtYXBWaWV3IC0gVmlld1xuICovXG5hc3luYyBmdW5jdGlvbiBnZXRGZWF0dXJlQ291bnQobGF5ZXIsIHZpZXcpIHtcbiAgaWYgKGxheWVyLnR5cGUgPT09IFwiZmVhdHVyZVwiICYmICFsYXllci51cmwpIHtcbiAgICByZXR1cm4gZ2V0RmVhdHVyZUNvdW50Rm9yQ29sbGVjdGlvbihsYXllcik7XG4gIH1cbiAgZWxzZSBpZiAobGF5ZXIudHlwZSA9PT0gXCJmZWF0dXJlXCIgfHxcbiAgICBsYXllci50eXBlID09PSBcImNzdlwiIHx8XG4gICAgbGF5ZXIudHlwZSA9PT0gXCJzY2VuZVwiIHx8XG4gICAgbGF5ZXIudHlwZSA9PT0gXCJ3ZnNcIiB8fFxuICAgIGxheWVyLnR5cGUgPT09IFwiZ2VvanNvblwiKSB7XG4gICAgcmV0dXJuIGF3YWl0IGxheWVyLnF1ZXJ5RmVhdHVyZUNvdW50KCk7XG4gIH1cbiAgZWxzZSBpZiAodmlldyAmJiAobGF5ZXIudHlwZSA9PT0gXCJzdHJlYW1cIiB8fCBsYXllci50eXBlID09PSBcIm9nYy1mZWF0dXJlXCIpKSB7XG4gICAgcmV0dXJuIGdldEZlYXR1cmVDb3VudEZyb21WaWV3KGxheWVyLCB2aWV3KTtcbiAgfVxufVxuLyoqXG4gKiBSZXR1cm5zIGZlYXR1cmUgY291bnQgb2YgZmVhdHVyZSBjb2xsZWN0aW9uIGxheWVyXG4gKiBAcGFyYW0gbGF5ZXIgLSBGZWF0dXJlTGF5ZXJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0RmVhdHVyZUNvdW50Rm9yQ29sbGVjdGlvbihsYXllcikge1xuICB2YXIgX2E7XG4gIGNvbnN0IHF1ZXJ5ID0gbGF5ZXIuY3JlYXRlUXVlcnkoKTtcbiAgcXVlcnkub3V0RmllbGRzID0gW1wiKlwiXTtcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbGF5ZXIucXVlcnlGZWF0dXJlcyhxdWVyeSk7XG4gIGlmICgoX2EgPSByZXN1bHQuZmVhdHVyZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpIHtcbiAgICByZXR1cm4gcmVzdWx0LmZlYXR1cmVzLmxlbmd0aDtcbiAgfVxuICBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJjb3VsZCBub3QgZ2V0IGZlYXR1cmUgY291bnRcIik7XG4gIH1cbn1cbi8qKlxuICogUmV0dXJucyBmZWF0dXJlIGNvdW50IG9mIGZlYXR1cmUgY29sbGVjdGlvbiBsYXllclxuICogQHBhcmFtIGxheWVyIC0gU3RyZWFtTGF5ZXIgfCBPR0NGZWF0dXJlTGF5ZXJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0RmVhdHVyZUNvdW50RnJvbVZpZXcobGF5ZXIsIHZpZXcpIHtcbiAgLy8gd2UgY2FuIG9ubHkgZ2V0IHRoZSBmZWF0dXJlcyBmcm9tIHRoZSBtYXBcbiAgY29uc3QgbGF5ZXJWaWV3ID0gKGF3YWl0IHZpZXcud2hlbkxheWVyVmlldyhsYXllcikpO1xuICByZXR1cm4gbGF5ZXJWaWV3LnF1ZXJ5RmVhdHVyZUNvdW50KCk7XG59XG4vKipcbiAqIFJldHVybnMgcmFzdGVyIGNvdW50IG9mIGltYWdlcnkgbGF5ZXJcbiAqIEBwYXJhbSBsYXllciAtIEltYWdlcnlsYXllclxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRSYXN0ZXJDb3VudChsYXllcikge1xuICBpZiAoIWxheWVyLnVybCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcImNvdWxkIG5vdCBnZXQgbGF5ZXIudXJsXCIpO1xuICB9XG4gIGNvbnN0IFtleGVjdXRlXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvcmVzdC9xdWVyeS9leGVjdXRlRm9yQ291bnRcIl0pO1xuICBjb25zdCBjb3VudCA9IGF3YWl0IGV4ZWN1dGUuZXhlY3V0ZUZvckNvdW50KGxheWVyLnVybCwge30pO1xuICBpZiAoY291bnQpIHtcbiAgICByZXR1cm4gY291bnQ7XG4gIH1cbiAgZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiY291bGQgbm90IGdldCByYXN0ZXIgY291bnRcIik7XG4gIH1cbn1cbmNvbnN0IGdldENsdXN0ZXJGaWVsZHMgPSAocG9wdXBUZW1wbGF0ZSwgZ2V0RXhwcmVzc2lvbkZpZWxkcykgPT4ge1xuICBsZXQgdGVtcEZpZWxkcyA9IFtdO1xuICBwb3B1cFRlbXBsYXRlID09PSBudWxsIHx8IHBvcHVwVGVtcGxhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcHVwVGVtcGxhdGUuZmllbGRJbmZvcy5mb3JFYWNoKChmaWVsZEluZm8pID0+IHtcbiAgICBpZiAoZmllbGRJbmZvLmZpZWxkTmFtZS5pbmNsdWRlcyhmaWVsZEluZm9QcmVmaXhFbnVtLmV4cHJlc3Npb24pKSB7XG4gICAgICAvLyBmcm9tIGxheWVyLnJlbmRlcmVyLCB0byBiZSB1c2VkIGFzIGEgZmllbGQgZm9yIGNsdXN0ZXIgbGFiZWxpbmdcbiAgICAgIC8vIGFsc28gbmVlZGVkIGZvciB0aGUgZXhpc3Rpbmcgb3B0aW9uIGluIGFyY2FkZVxuICAgICAgZ2V0RXhwcmVzc2lvbkZpZWxkcyAmJlxuICAgICAgICB0ZW1wRmllbGRzLnB1c2goe1xuICAgICAgICAgIG5hbWU6IGZpZWxkSW5mby5maWVsZE5hbWUuc2xpY2UoZmllbGRJbmZvUHJlZml4RW51bS5leHByZXNzaW9uLmxlbmd0aCksXG4gICAgICAgICAgYWxpYXM6IGZpZWxkSW5mby5maWVsZE5hbWUuc2xpY2UoZmllbGRJbmZvUHJlZml4RW51bS5leHByZXNzaW9uLmxlbmd0aCksXG4gICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0ZW1wRmllbGRzLnB1c2goeyBuYW1lOiBmaWVsZEluZm8uZmllbGROYW1lLCBhbGlhczogZmllbGRJbmZvLmxhYmVsLCB0eXBlOiBcInN0cmluZ1wiIH0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiB0ZW1wRmllbGRzO1xufTtcbi8qKlxuICogRmluZCBhbiBlbGVtZW50IHVwIHRoZSBET00gdHJlZS5cbiAqIEBwYXJhbSBlbCAtIEhUTUxFbGVtZW50XG4gKiBAcGFyYW0gc2VsZWN0b3IgLSBTZWxlY3RvclxuICovXG5mdW5jdGlvbiBxdWVyeVBhcmVudEVsZW1lbnQoZWwsIHNlbGVjdG9yKSB7XG4gIGxldCBpc0lEU2VsZWN0b3IgPSBzZWxlY3Rvci5pbmRleE9mKFwiI1wiKSA9PT0gMDtcbiAgbGV0IGlzQ2xhc3NTZWxlY3RvciA9IHNlbGVjdG9yLmluZGV4T2YoXCIuXCIpID09PSAwO1xuICBpZiAoaXNDbGFzc1NlbGVjdG9yIHx8IGlzSURTZWxlY3Rvcikge1xuICAgIHNlbGVjdG9yID0gc2VsZWN0b3Iuc2xpY2UoMSk7XG4gIH1cbiAgd2hpbGUgKGVsKSB7XG4gICAgaWYgKGlzSURTZWxlY3Rvcikge1xuICAgICAgaWYgKGVsLmlkID09PSBzZWxlY3Rvcikge1xuICAgICAgICByZXR1cm4gZWw7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKGlzQ2xhc3NTZWxlY3Rvcikge1xuICAgICAgaWYgKGVsLmNsYXNzTGlzdC5jb250YWlucyhzZWxlY3RvcikpIHtcbiAgICAgICAgcmV0dXJuIGVsO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IHNlbGVjdG9yLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgIHJldHVybiBlbDtcbiAgICB9XG4gICAgZWwgPSBlbC5wYXJlbnRFbGVtZW50O1xuICB9XG4gIHJldHVybiBudWxsO1xufVxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIHZhbHVlIGlzIGRlZmluZWRcbiAqIEBwYXJhbSB2YWx1ZSAtIHZhbHVlIHRvIGNoZWNrXG4gKi9cbmZ1bmN0aW9uIGlzRGVmaW5lZCh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbDtcbn1cbmNvbnN0IGlkZW50aWZ5T25NYXBJbWFnZUxheWVyID0gYXN5bmMgKGxheWVyLCBtYXBWaWV3KSA9PiB7XG4gIHZhciBfYSwgX2I7XG4gIGNvbnN0IFtpZGVudGlmeSwgSWRlbnRpZnlQYXJhbWV0ZXJzXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcbiAgICBcImVzcmkvcmVzdC9pZGVudGlmeVwiLFxuICAgIFwiZXNyaS9yZXN0L3N1cHBvcnQvSWRlbnRpZnlQYXJhbWV0ZXJzXCJcbiAgXSk7XG4gIGNvbnN0IHBhcmFtdGVycyA9IG5ldyBJZGVudGlmeVBhcmFtZXRlcnMoKTtcbiAgcGFyYW10ZXJzLmdlb21ldHJ5ID0gbWFwVmlldy5leHRlbnQ7XG4gIHBhcmFtdGVycy5tYXBFeHRlbnQgPSBtYXBWaWV3LmV4dGVudDtcbiAgcGFyYW10ZXJzLnJldHVybkdlb21ldHJ5ID0gdHJ1ZTtcbiAgcGFyYW10ZXJzLnRvbGVyYW5jZSA9IDY7XG4gIHBhcmFtdGVycy5sYXllck9wdGlvbiA9IFwicG9wdXBcIjtcbiAgcGFyYW10ZXJzLndpZHRoID0gbWFwVmlldy53aWR0aDtcbiAgcGFyYW10ZXJzLmhlaWdodCA9IG1hcFZpZXcuaGVpZ2h0O1xuICBwYXJhbXRlcnMubGF5ZXJJZHMgPSBbbGF5ZXIuaWRdO1xuICBjb25zdCBpZGVudGlmeVJlc3VsdHMgPSAoX2EgPSAoYXdhaXQgaWRlbnRpZnkuaWRlbnRpZnkobGF5ZXIubGF5ZXIudXJsLCBwYXJhbXRlcnMpKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlc3VsdHM7XG4gIGNvbnN0IGN1cnJGZWF0dXJlID0gKF9iID0gaWRlbnRpZnlSZXN1bHRzID09PSBudWxsIHx8IGlkZW50aWZ5UmVzdWx0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogaWRlbnRpZnlSZXN1bHRzWzBdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZmVhdHVyZTtcbiAgcmV0dXJuIGN1cnJGZWF0dXJlO1xufTtcbmNvbnN0IGdldFNpbmdsZUNsdXN0ZXJGZWF0dXJlID0gYXN5bmMgKG1hcFZpZXcsIGxheWVyLCBwb3B1cFRlbXBsYXRlKSA9PiB7XG4gIHZhciBfYTtcbiAgY29uc3QgbGF5ZXJWaWV3ID0gYXdhaXQgbWFwVmlldy53aGVuTGF5ZXJWaWV3KGxheWVyKTtcbiAgY29uc3QgY2x1c3RlckZlYXR1cmVTZXQgPSBhd2FpdCBsYXllclZpZXcucXVlcnlBZ2dyZWdhdGVzKCk7XG4gIHJldHVybiBhd2FpdCBnZW5lcmF0ZVNpbmdsZUNsdXN0ZXJGZWF0dXJlKHBvcHVwVGVtcGxhdGUsIChfYSA9IGNsdXN0ZXJGZWF0dXJlU2V0LmZlYXR1cmVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF0pO1xufTtcbmNvbnN0IGdlbmVyYXRlU2luZ2xlQ2x1c3RlckZlYXR1cmUgPSBhc3luYyAocG9wdXBUZW1wbGF0ZSwgY3VyckdyYXBoaWMpID0+IHtcbiAgY29uc3QgW0dyYXBoaWMsIFBvaW50R2VvbWV0cnldID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9HcmFwaGljXCIsIFwiZXNyaS9nZW9tZXRyeS9Qb2ludFwiXSk7XG4gIGxldCBjbHVzdGVyR3JhcGhpYztcbiAgaWYgKGN1cnJHcmFwaGljKSB7XG4gICAgY2x1c3RlckdyYXBoaWMgPSBjdXJyR3JhcGhpYy5jbG9uZSgpO1xuICB9XG4gIGVsc2Uge1xuICAgIGNsdXN0ZXJHcmFwaGljID0gbmV3IEdyYXBoaWMoKTtcbiAgICBjb25zdCBmaWVsZHMgPSBnZXRDbHVzdGVyRmllbGRzKHBvcHVwVGVtcGxhdGUsIGZhbHNlKTtcbiAgICBpZiAoZmllbGRzID09PSBudWxsIHx8IGZpZWxkcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmllbGRzLmxlbmd0aCkge1xuICAgICAgY29uc3QgdGVtcEF0dHJpYnV0ZXMgPSB7fTtcbiAgICAgIGZpZWxkcy5mb3JFYWNoKChmZWF0dXJlKSA9PiB7XG4gICAgICAgIHRlbXBBdHRyaWJ1dGVzW2ZlYXR1cmUubmFtZV0gPSBcIlwiO1xuICAgICAgfSk7XG4gICAgICBjbHVzdGVyR3JhcGhpYy5hdHRyaWJ1dGVzID0gdGVtcEF0dHJpYnV0ZXM7XG4gICAgfVxuICAgIGNvbnN0IHRlbXBHZW9tZXRyeSA9IG5ldyBQb2ludEdlb21ldHJ5KCk7XG4gICAgY2x1c3RlckdyYXBoaWMuZ2VvbWV0cnkgPSB0ZW1wR2VvbWV0cnk7XG4gIH1cbiAgcmV0dXJuIGNsdXN0ZXJHcmFwaGljO1xufTtcbmZ1bmN0aW9uIGdldFBvaW50RnJvbUdlb21ldHJ5KGdlb21ldHJ5KSB7XG4gIHZhciBfYTtcbiAgaWYgKCFnZW9tZXRyeSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIHN3aXRjaCAoZ2VvbWV0cnkudHlwZSkge1xuICAgIGNhc2UgXCJwb2ludFwiOlxuICAgICAgcmV0dXJuIGdlb21ldHJ5O1xuICAgIGNhc2UgXCJleHRlbnRcIjpcbiAgICAgIHJldHVybiBnZW9tZXRyeS5jZW50ZXI7XG4gICAgY2FzZSBcInBvbHlnb25cIjpcbiAgICAgIHJldHVybiBnZW9tZXRyeS5jZW50cm9pZDtcbiAgICBjYXNlIFwibXVsdGlwb2ludFwiOlxuICAgIGNhc2UgXCJwb2x5bGluZVwiOlxuICAgICAgcmV0dXJuIChfYSA9IGdlb21ldHJ5LmV4dGVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNlbnRlcjtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuZXhwb3J0IHsgZ2V0RmllbGRUeXBlIGFzIGEsIGdldEZpZWxkRGlzcGxheU5hbWUgYXMgYiwgZ2V0U2VydmljZVR5cGUgYXMgYywgZ2VuZXJhdGVMYXllckZpZWxkc01hcCBhcyBkLCBnZW5lcmF0ZUFyY2FkZUV4cHJlc3Npb25NYXAgYXMgZSwgaWRlbnRpZnlPbk1hcEltYWdlTGF5ZXIgYXMgZiwgZ2V0RmVhdHVyZUNvdW50IGFzIGcsIGdldExheWVyR2VvbWV0cnlUeXBlIGFzIGgsIGlzRGVmaW5lZCBhcyBpLCBnZXRGaWVsZHNGcm9tTGF5ZXIgYXMgaiwgZ2V0Q2x1c3RlckZpZWxkcyBhcyBrLCBnZXRTaW5nbGVDbHVzdGVyRmVhdHVyZSBhcyBsLCBnZXRTaW5nbGVGZWF0dXJlIGFzIG0sIGdldFJhc3RlckNvdW50IGFzIG4sIGdldFBvaW50RnJvbUdlb21ldHJ5IGFzIG8sIGdldFNlcnZpY2VWZXJzaW9uIGFzIHAsIHF1ZXJ5UGFyZW50RWxlbWVudCBhcyBxIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGwgYXMgbG9hZE1vZHVsZXMgfSBmcm9tICcuL2xvYWRNb2R1bGVzLWFhZjMwYmQ2LmpzJztcbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tMTNmNWIwMGMuanMnO1xuXG5jb25zdCBsYW5ndWFnZU1hcCA9IG5ldyBNYXAoW1xuICBbXCJhclwiLCBcImFyXCJdLFxuICBbXCJiZ1wiLCBcImJnXCJdLFxuICBbXCJic1wiLCBcImJzXCJdLFxuICBbXCJjYVwiLCBcImNhXCJdLFxuICBbXCJjc1wiLCBcImNzXCJdLFxuICBbXCJkYVwiLCBcImRhXCJdLFxuICBbXCJkZVwiLCBcImRlXCJdLFxuICBbXCJlbFwiLCBcImVsXCJdLFxuICBbXCJlblwiLCBcImVuXCJdLFxuICBbXCJlc1wiLCBcImVzXCJdLFxuICBbXCJldFwiLCBcImV0XCJdLFxuICBbXCJmaVwiLCBcImZpXCJdLFxuICBbXCJmclwiLCBcImZyXCJdLFxuICBbXCJoZVwiLCBcImhlXCJdLFxuICBbXCJoclwiLCBcImhyXCJdLFxuICBbXCJodVwiLCBcImh1XCJdLFxuICBbXCJpZFwiLCBcImlkXCJdLFxuICBbXCJpdFwiLCBcIml0XCJdLFxuICBbXCJqYVwiLCBcImphXCJdLFxuICBbXCJrb1wiLCBcImtvXCJdLFxuICBbXCJsdFwiLCBcImx0XCJdLFxuICBbXCJsdlwiLCBcImx2XCJdLFxuICBbXCJuYlwiLCBcIm5iXCJdLFxuICBbXCJubFwiLCBcIm5sXCJdLFxuICBbXCJwbFwiLCBcInBsXCJdLFxuICBbXCJwdC1iclwiLCBcInB0LUJSXCJdLFxuICBbXCJwdC1wdFwiLCBcInB0LVBUXCJdLFxuICBbXCJyb1wiLCBcInJvXCJdLFxuICBbXCJydVwiLCBcInJ1XCJdLFxuICBbXCJza1wiLCBcInNrXCJdLFxuICBbXCJzbFwiLCBcInNsXCJdLFxuICBbXCJzclwiLCBcInNyXCJdLFxuICBbXCJzdlwiLCBcInN2XCJdLFxuICBbXCJ0aFwiLCBcInRoXCJdLFxuICBbXCJ0clwiLCBcInRyXCJdLFxuICBbXCJ1a1wiLCBcInVrXCJdLFxuICBbXCJ2aVwiLCBcInZpXCJdLFxuICBbXCJ6aC1jblwiLCBcInpoLUNOXCJdLFxuICBbXCJ6aC1oa1wiLCBcInpoLUhLXCJdLFxuICBbXCJ6aC10d1wiLCBcInpoLVRXXCJdXG5dKTtcbi8vIHJ0bFxuZnVuY3Rpb24gZ2V0RWxlbWVudERpcihlbCkge1xuICByZXR1cm4gZ2V0RWxlbWVudFByb3AoZWwsIFwiZGlyXCIsIFwibHRyXCIpO1xufVxuZnVuY3Rpb24gZ2V0RWxlbWVudFByb3AoZWwsIHByb3AsIHZhbHVlKSB7XG4gIGNvbnN0IGNsb3Nlc3RXaXRoUHJvcCA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbCwgYFske3Byb3B9XWApO1xuICByZXR1cm4gY2xvc2VzdFdpdGhQcm9wID8gY2xvc2VzdFdpdGhQcm9wLmdldEF0dHJpYnV0ZShwcm9wKSA6IHZhbHVlO1xufVxuLy8gY3NzXG5jb25zdCBDU1NfVVRJTElUWSA9IHtcbiAgcnRsOiBcImFyY2dpcy0tcnRsXCJcbn07XG5hc3luYyBmdW5jdGlvbiBmb3JtYXROdW1iZXIobnVtYmVyLCBvcHRpb25zKSB7XG4gIGNvbnN0IHsgYXBpLCB0eXBlLCBwbGFjZXMgfSA9IG9wdGlvbnMgfHwge307XG4gIGlmIChhcGkgPT09IDQpIHtcbiAgICBjb25zdCBbaW50bF0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL2ludGxcIl0pO1xuICAgIGNvbnN0IG51bWJlckZvcm1hdEludGxPcHRpb25zID0gaW50bC5jb252ZXJ0TnVtYmVyRm9ybWF0VG9JbnRsT3B0aW9ucyh7XG4gICAgICBwbGFjZXMsXG4gICAgICBzdHlsZTogdHlwZSxcbiAgICAgIGRpZ2l0U2VwYXJhdG9yOiB0cnVlXG4gICAgfSk7XG4gICAgcmV0dXJuIGludGwuZm9ybWF0TnVtYmVyKG51bWJlciwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyksIHsgc3R5bGU6IHR5cGUgfSkpO1xuICB9XG4gIGNvbnN0IFtkb2pvTnVtYmVyXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImRvam8vbnVtYmVyXCJdKTtcbiAgcmV0dXJuIGRvam9OdW1iZXIuZm9ybWF0KG51bWJlciwge1xuICAgIHR5cGUsXG4gICAgcGxhY2VzLFxuICAgIHBhdHRlcm46IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5wYXR0ZXJuXG4gIH0pO1xufVxuY29uc3QgY2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZSkge1xuICBjb25zdCBsYW5nID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lmxhbmc7XG4gIGNvbnN0IGRheVNob3J0TW9udGhZZWFyID0ge1xuICAgIHllYXI6IFwibnVtZXJpY1wiLFxuICAgIG1vbnRoOiBcInNob3J0XCIsXG4gICAgZGF5OiBcIm51bWVyaWNcIlxuICB9O1xuICBpZiAoIWNhY2hlW2xhbmddKSB7XG4gICAgY2FjaGVbbGFuZ10gPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZywgZGF5U2hvcnRNb250aFllYXIpO1xuICB9XG4gIHJldHVybiBjYWNoZVtsYW5nXS5mb3JtYXQoZGF0ZSk7XG59XG5cbmV4cG9ydCB7IENTU19VVElMSVRZIGFzIEMsIGZvcm1hdERhdGUgYXMgYSwgZm9ybWF0TnVtYmVyIGFzIGYsIGdldEVsZW1lbnREaXIgYXMgZywgbGFuZ3VhZ2VNYXAgYXMgbCB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9