"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-d2b4f9"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-layers-and-tables-summary-popup.entry.js":
/*!*****************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-layers-and-tables-summary-popup.entry.js ***!
  \*****************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_layers_and_tables_summary_popup: () => (/* binding */ ArcgisLayersAndTablesSummaryPopup)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _telemetry_2874e433_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./telemetry-2874e433.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/telemetry-2874e433.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _services_ce8cb0ef_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./services-ce8cb0ef.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/services-ce8cb0ef.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./url-f3b82cc7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-f3b82cc7.js");
/* harmony import */ var _storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./storage-d7f5822e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js");
/* harmony import */ var _ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./ags-68d4ae20.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-68d4ae20.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
















const layersAndTablesStore = (0,_index_81d548b7_js__WEBPACK_IMPORTED_MODULE_2__.c)({});
const layersAndTablesState = layersAndTablesStore.state;

const arcgisLayersAndTablesSummaryPopupCss = ":host{max-width:100%}arcgis-layers-and-tables-summary:not(.hydrated){visibility:hidden}.popover-content{width:380px;min-height:6rem;background-color:var(--calcite-ui-background)}.skeleton{padding:0.5rem;margin:1rem;margin-bottom:3rem;animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;border:1px solid var(--calcite-ui-border-2)}.skeleton-content{display:flex}.skeleton-left,.skeleton-right{width:1rem;height:1rem;background-color:var(--calcite-ui-border-3)}.skeleton-main{flex:1 1 0%;margin-left:1rem;margin-right:1rem}.skeleton-title{height:1rem;background-color:var(--calcite-ui-border-2)}.skeleton-subtitle{height:1rem;margin-top:0.25rem;background-color:var(--calcite-ui-border-3)}@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}.button{transition-property:all;padding:0;outline:2px solid transparent;outline-offset:2px;border-style:none;cursor:pointer;max-width:100%;color:inherit;background:transparent;font-family:inherit;font-size:inherit;line-height:1.5}.button:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:4px}.button--border{padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;border:1px solid var(--calcite-ui-foreground-3)}.button--border:focus{outline-offset:0}.button-text{pointer-events:none;display:flex}.button--icon{vertical-align:-3px;-webkit-margin-start:0.25rem;margin-inline-start:0.25rem}";

const ArcgisLayersAndTablesSummaryPopup = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.handleClick = async () => {
      var _a;
      const { layers, item } = this;
      (_a = this.button) === null || _a === void 0 ? void 0 : _a.focus();
      if (!layers) {
        this.loading = true;
      }
      if (!layersAndTablesState[item.id]) {
        layersAndTablesState[item.id] = this.fetchServiceInfo();
      }
      const response = await layersAndTablesState[item.id];
      if (response.error) {
        this.error = this.i18n.error;
        if (response.error.code === "serviceNotExist") {
          this.error.message = this.i18n.error.noServiceMessage;
        }
      }
      if (response.result) {
        this.sublayers = (0,_services_ce8cb0ef_js__WEBPACK_IMPORTED_MODULE_6__.s)(response.result, layers);
      }
      else {
        this.sublayers = layers;
      }
      this.loading = false;
      return;
    };
    this.handleWindowClick = ({ target }) => {
      if (this.el.contains(target)) {
        return;
      }
      else {
        this.popoverNode.open = false;
      }
    };
    this.handleKeyPress = ({ key }) => {
      switch (key) {
        case "Esc":
        case "Escape":
          if (this.popoverNode) {
            this.popoverNode.open = false;
          }
          break;
      }
    };
    this.api = 4;
    this.config = undefined;
    this.user = undefined;
    this.item = undefined;
    this.portal = undefined;
    this.layers = undefined;
    this.searchTerm = undefined;
    this.border = undefined;
    this.tooltip = undefined;
    this.telemetry = undefined;
    this.button = undefined;
    this.loading = true;
    this.error = undefined;
    this.sublayers = undefined;
  }
  async componentWillLoad() {
    const locale = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.el);
    this.i18n = locale[0];
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_3__.c.api = this.api;
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_3__.c.portal = this.portal;
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_3__.c.config = this.config;
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_3__.c.user = this.user;
    if (!this.layers) {
      this.loading = true;
    }
  }
  async fetchServiceInfo() {
    const { item, portal, layers } = this;
    const response = await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_5__.m)((0,_services_ce8cb0ef_js__WEBPACK_IMPORTED_MODULE_6__.f)({ item, portal, layers, isSecure: false }), 500);
    return response;
  }
  render() {
    const { i18n, portal, user, item, handleClick, handleKeyPress, loading, searchTerm, error, tooltip, telemetry } = this;
    const layers = this.sublayers || this.layers;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { onFocusout: (e) => {
        if (!e.relatedTarget || this.el.contains(e.relatedTarget)) {
          return;
        }
        else {
          this.popoverNode.open = false;
        }
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover-manager", { autoClose: true }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", Object.assign({ class: {
        button: true,
        "button--border": this.border
      }, ref: (el) => (this.button = el), onClick: handleClick, onTouchStart: handleClick, onKeyPress: handleKeyPress }, (tooltip ? { title: tooltip } : {})), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "button-text" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", null), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "caret-down", scale: "s", class: "button--icon" }))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { ref: (el) => (this.popoverNode = el), label: i18n.layersAndTables, pointerDisabled: true, referenceElement: this.button, closable: true, class: "popover", placement: "bottom", overlayPositioning: "fixed", heading: i18n.layersAndTables, onCalcitePopoverOpen: () => {
        var _a;
        (_a = this.telemetry) === null || _a === void 0 ? void 0 : _a.logEvent({
          category: "preview popup",
          action: "click",
          pageName: (0,_telemetry_2874e433_js__WEBPACK_IMPORTED_MODULE_4__.g)(),
          pageUrl: window.location.href
        });
        window.addEventListener("click", this.handleWindowClick);
      }, onCalcitePopoverClose: (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_5__.d)(() => {
        var _a;
        (_a = this.telemetry) === null || _a === void 0 ? void 0 : _a.logEvent({
          category: "preview popup",
          action: "close",
          pageName: (0,_telemetry_2874e433_js__WEBPACK_IMPORTED_MODULE_4__.g)(),
          pageUrl: window.location.href
        });
        window.removeEventListener("click", this.handleWindowClick);
      }, 200) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "popover-content" }, loading ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "skeleton" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "skeleton-content" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "skeleton-left" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "skeleton-main" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "skeleton-title" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "skeleton-subtitle" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "skeleton-right" })))) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-layers-and-tables-summary", { portal: portal, user: user, item: item, layers: layers, showMatched: searchTerm && !!this.layers, error: error,
      // @ts-ignore
      loading: !this.sublayers, telemetry: telemetry, onLayersAndTablesFocusEnd: () => {
        this.popoverNode.open = false;
      } })))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLayersAndTablesSummaryPopup.style = arcgisLayersAndTablesSummaryPopupCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



const languageMap = new Map([
  ["ar", "ar"],
  ["bg", "bg"],
  ["bs", "bs"],
  ["ca", "ca"],
  ["cs", "cs"],
  ["da", "da"],
  ["de", "de"],
  ["el", "el"],
  ["en", "en"],
  ["es", "es"],
  ["et", "et"],
  ["fi", "fi"],
  ["fr", "fr"],
  ["he", "he"],
  ["hr", "hr"],
  ["hu", "hu"],
  ["id", "id"],
  ["it", "it"],
  ["ja", "ja"],
  ["ko", "ko"],
  ["lt", "lt"],
  ["lv", "lv"],
  ["nb", "nb"],
  ["nl", "nl"],
  ["pl", "pl"],
  ["pt-br", "pt-BR"],
  ["pt-pt", "pt-PT"],
  ["ro", "ro"],
  ["ru", "ru"],
  ["sk", "sk"],
  ["sl", "sl"],
  ["sr", "sr"],
  ["sv", "sv"],
  ["th", "th"],
  ["tr", "tr"],
  ["uk", "uk"],
  ["vi", "vi"],
  ["zh-cn", "zh-CN"],
  ["zh-hk", "zh-HK"],
  ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
  return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
  const closestWithProp = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
  return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
  rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
  const { api, type, places } = options || {};
  if (api === 4) {
    const [intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
    const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
      places,
      style: type,
      digitSeparator: true
    });
    return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
  }
  const [dojoNumber] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
  return dojoNumber.format(number, {
    type,
    places,
    pattern: options === null || options === void 0 ? void 0 : options.pattern
  });
}
const cache = {};
function formatDate(date) {
  const lang = document.documentElement.lang;
  const dayShortMonthYear = {
    year: "numeric",
    month: "short",
    day: "numeric"
  };
  if (!cache[lang]) {
    cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
  }
  return cache[lang].format(date);
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
  var _a, _b, _c;
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    // "ru-RU" maps to "ru" use case
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
    }
    else {
      return "en";
    }
  }
}
function getComponentClosestLanguageIntl(element) {
  var _a, _b, _c;
  // it's OK if we don't have the 4 letter language file for it
  // 4 letter language code needed for formatting numbers
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      // we support the 2 letter coded language
      // e.g. it-CH vs it
      return lang;
    }
    else {
      return "en";
    }
  }
}
function fetchLocaleStringsForComponent(componentName, locale) {
  return new Promise((resolve, reject) => {
    fetch((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
      if (result.ok)
        resolve(result.json());
      else
        reject();
    }, () => reject());
  });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
  const id = `${componentName}${locale}`;
  if (!stringCache[id]) {
    stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
  }
  return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
  const componentName = tagName || element.tagName.toLowerCase();
  const componentLanguage = getComponentClosestLanguage(element);
  const componentLanguageIntl = getComponentClosestLanguageIntl(element);
  let strings;
  try {
    strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
  }
  catch (e) {
    console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
    strings = await fetchLocaleStringsFromCache(componentName, "en");
  }
  return [strings, componentLanguage, componentLanguageIntl];
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/services-ce8cb0ef.js":
/*!**************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/services-ce8cb0ef.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ fetchLayer),
/* harmony export */   f: () => (/* binding */ fetchFeatureServiceInfo),
/* harmony export */   s: () => (/* binding */ setMatched)
/* harmony export */ });
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./url-f3b82cc7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-f3b82cc7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




function parseSublayer(sublayer, layers, isTable) {
  var _a, _b;
  return {
    description: sublayer.description,
    fieldAliases: (_a = sublayer.fields) === null || _a === void 0 ? void 0 : _a.map((field) => field.alias),
    fields: sublayer.fields,
    geometryType: isTable ? "table" : sublayer.geometryType,
    id: sublayer.id,
    title: sublayer.name,
    type: sublayer.type,
    matched: (_b = layers === null || layers === void 0 ? void 0 : layers.find((layer) => layer.id === sublayer.id)) === null || _b === void 0 ? void 0 : _b.matched
  };
}
function serverRequest(url, isSecure) {
  const { config } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
  const hosted = (0,_url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_2__.a)(url);
  const requestOptions = Object.assign(Object.assign({ useProxy: false, timeout: config.isMultiTenant === false ? 60000 : 5000, addSSL: hosted }, (isSecure ? {} : { addTokenManually: false })), { usePost: true, disableIdentityLookup: true });
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, {}, requestOptions, "post");
}
function getErrorCode(error) {
  var _a, _b;
  return (error === null || error === void 0 ? void 0 : error.code) || ((_b = (_a = error === null || error === void 0 ? void 0 : error.details) === null || _a === void 0 ? void 0 : _a.raw) === null || _b === void 0 ? void 0 : _b.code);
}
function serviceDoesNotExist(error) {
  const code = getErrorCode(error);
  return [404, 500].includes(code) || (error === null || error === void 0 ? void 0 : error.message) === "Invalid URL";
}
function shouldRetryWithToken(isSecure, error) {
  const code = getErrorCode(error);
  return !isSecure && ((code === 499 && (error === null || error === void 0 ? void 0 : error.message) === "Token Required") || code === 403) && !!_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
}
async function fetchLayer(portal, id, url, isSecure) {
  const errorResult = { error: { code: "unhandledError" } };
  try {
    try {
      const result = await serverRequest(`${url}/${id}`, isSecure);
      return { result };
    }
    catch (error) {
      if (shouldRetryWithToken(isSecure, error)) {
        return fetchLayer(portal, id, url, true);
      }
      if (serviceDoesNotExist(error)) {
        errorResult.error.code = "serviceNotExist";
      }
      return errorResult;
    }
  }
  catch (error) {
    return errorResult;
  }
}
function filterLayers(layers, matchedLayers, data, isTable) {
  var _a, _b;
  const hasTables = data === null || data === void 0 ? void 0 : data.tables;
  const hasDefinedDataLayers = ((_a = data === null || data === void 0 ? void 0 : data.layers) === null || _a === void 0 ? void 0 : _a.length) > 0 || hasTables;
  const ids = [...((data === null || data === void 0 ? void 0 : data.layers) || []).map((layer) => layer.id), ...(_b = ((data === null || data === void 0 ? void 0 : data.tables) || [])) === null || _b === void 0 ? void 0 : _b.map((table) => table.id)];
  // if data has defined layers, only use layers in data, not the whole service (WebGIS/arcgis-portal-app#39768)
  // if data has defined layers, but no defined tables, allow all tables through (WebGIS/arcgis-portal-app#40067)
  const sublayers = (layers || [])
    .filter(({ id, type }) => !hasDefinedDataLayers || (type === "Table" && !hasTables) || ids.includes(id))
    .map((layer) => parseSublayer(layer, matchedLayers, isTable));
  return sublayers;
}
async function fetchLayers({ serviceInfo, item, layers, isSecure, data }) {
  var _a, _b;
  const { url } = item;
  if (!((_a = serviceInfo.layers) === null || _a === void 0 ? void 0 : _a.length) && !((_b = serviceInfo.tables) === null || _b === void 0 ? void 0 : _b.length) && (serviceInfo === null || serviceInfo === void 0 ? void 0 : serviceInfo.fields)) {
    return { result: [parseSublayer(serviceInfo, layers)] };
  }
  try {
    const { layers: sublayers, tables } = await serverRequest(`${url}/layers`, isSecure);
    return {
      result: [...filterLayers(sublayers, layers, data), ...filterLayers(tables, layers, data, true)].sort((a, b) => a.id - b.id)
    };
  }
  catch (error) {
    return { error: { code: "unhandledError" } };
  }
}
function setMatched(sublayers, matchedLayers) {
  return sublayers.map((sublayer) => {
    var _a;
    return Object.assign(Object.assign({}, sublayer), { matched: (_a = matchedLayers === null || matchedLayers === void 0 ? void 0 : matchedLayers.find((layer) => layer.id === sublayer.id)) === null || _a === void 0 ? void 0 : _a.matched });
  });
}
async function fetchFeatureServiceInfo({ item, portal, layers, isSecure, data, retry }) {
  var _a;
  const errorResult = { error: { code: "unhandledError" } };
  try {
    if (!data && !retry) {
      try {
        const token = (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.h)(portal);
        const tokenParam = token ? `&token=${token}` : "";
        const url = `${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}content/items/${item.id}/data?f=json${tokenParam}`;
        // Use fetch instead of request to stop redirects (WebGIS/arcgis-portal-app#40164)
        const response = await fetch(url);
        const text = await response.text();
        if (text) {
          data = JSON.parse(text);
        }
        if (data === null || data === void 0 ? void 0 : data.error) {
          // Treat this expired account as if the service doesn't exist (WebGIS/arcgis-portal-app#40163)
          if (data.error.code === 403 && ((_a = data.error) === null || _a === void 0 ? void 0 : _a.messageCode) === "SB_0006") {
            errorResult.error.code = "serviceNotExist";
            return errorResult;
          }
        }
      }
      catch (error) {
        // if we can't get item data, just move on
        data = null;
      }
    }
    if (item.type === "Feature Collection") {
      if (data === null || data === void 0 ? void 0 : data.layers) {
        return {
          result: data.layers.map(({ layerDefinition }, id) => {
            var _a;
            return ({
              description: "",
              fields: layerDefinition.fields,
              fieldAliases: (_a = layerDefinition.fields) === null || _a === void 0 ? void 0 : _a.map((field) => field.alias),
              geometryType: layerDefinition.geometryType,
              type: layerDefinition.type,
              id,
              matched: false,
              title: layerDefinition.name
            });
          })
        };
      }
    }
    try {
      const { url } = item;
      const serviceInfo = await serverRequest(url, isSecure);
      return fetchLayers({
        serviceInfo,
        item,
        layers,
        isSecure,
        data
      });
    }
    catch (error) {
      if (shouldRetryWithToken(isSecure, error)) {
        return fetchFeatureServiceInfo({ item, portal, layers, data, isSecure: true });
      }
      if (serviceDoesNotExist(error)) {
        errorResult.error.code = "serviceNotExist";
      }
      return errorResult;
    }
  }
  catch (error) {
    return errorResult;
  }
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/telemetry-2874e433.js":
/*!***************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/telemetry-2874e433.js ***!
  \***************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getPageName)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
function getPageName() {
  const { hash, pathname } = window.location;
  if (pathname.includes("group.html")) {
    return "group page";
  }
  if (pathname.includes("search.html")) {
    return "search result page";
  }
  switch (hash) {
    case "#favorites":
      return "favorites";
    case "#groups":
      return "my groups content";
    case "#organization":
      return "my org content";
    case "#livingAtlas":
      return "living atlas";
    default:
      return "my content";
  }
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWQyYjRmOS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDMkY7QUFDckI7QUFDZjtBQUNDO0FBQ0c7QUFDYTtBQUNlO0FBQzVEO0FBQ1M7QUFDRDtBQUNMO0FBQ0k7QUFDUDtBQUNJO0FBQ0o7O0FBRTNCLDZCQUE2QixxREFBVyxHQUFHO0FBQzNDOztBQUVBLG9EQUFvRCxlQUFlLGdEQUFnRCxrQkFBa0IsaUJBQWlCLFlBQVksZ0JBQWdCLDhDQUE4QyxVQUFVLGVBQWUsWUFBWSxtQkFBbUIseURBQXlELDRDQUE0QyxrQkFBa0IsYUFBYSwrQkFBK0IsV0FBVyxZQUFZLDRDQUE0QyxlQUFlLFlBQVksaUJBQWlCLGtCQUFrQixnQkFBZ0IsWUFBWSw0Q0FBNEMsbUJBQW1CLFlBQVksbUJBQW1CLDRDQUE0QyxpQkFBaUIsUUFBUSxVQUFVLElBQUksYUFBYSxRQUFRLHdCQUF3QixVQUFVLDhCQUE4QixtQkFBbUIsa0JBQWtCLGVBQWUsZUFBZSxjQUFjLHVCQUF1QixvQkFBb0Isa0JBQWtCLGdCQUFnQixjQUFjLDBDQUEwQyxtQkFBbUIsZ0JBQWdCLG9CQUFvQixxQkFBcUIsb0JBQW9CLHVCQUF1QixnREFBZ0Qsc0JBQXNCLGlCQUFpQixhQUFhLG9CQUFvQixhQUFhLGNBQWMsb0JBQW9CLDZCQUE2Qiw0QkFBNEI7O0FBRTM0QztBQUNBO0FBQ0EsSUFBSSxxREFBZ0I7QUFDcEI7QUFDQTtBQUNBLGNBQWMsZUFBZTtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsd0RBQVU7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxn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O0FBQ0E7QUFDQTs7QUFFMEU7Ozs7Ozs7Ozs7Ozs7OztBQ3ZLMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsaUJBQWlCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUU0QiIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1sYXllcnMtYW5kLXRhYmxlcy1zdW1tYXJ5LXBvcHVwLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xhbmd1YWdlVXRpbC0yMjI1OGM5MC5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sb2NhbGUtMTNlMDBhNzUuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vc2VydmljZXMtY2U4Y2IwZWYuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vdGVsZW1ldHJ5LTI4NzRlNDMzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtOTJlYmIzOTYuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIH0gZnJvbSAnLi9sb2NhbGUtMTNlMDBhNzUuanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVTdG9yZSB9IGZyb20gJy4vaW5kZXgtODFkNTQ4YjcuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLWViNWY3ZGMyLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0UGFnZU5hbWUgfSBmcm9tICcuL3RlbGVtZXRyeS0yODc0ZTQzMy5qcyc7XG5pbXBvcnQgeyBtIGFzIG1pbkRlbGF5LCBkIGFzIGRlYm91bmNlIH0gZnJvbSAnLi9mdW5jdGlvbmFsLWM4MmY1YWI5LmpzJztcbmltcG9ydCB7IHMgYXMgc2V0TWF0Y2hlZCwgZiBhcyBmZXRjaEZlYXR1cmVTZXJ2aWNlSW5mbyB9IGZyb20gJy4vc2VydmljZXMtY2U4Y2IwZWYuanMnO1xuaW1wb3J0ICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgJy4vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1hYWYzMGJkNi5qcyc7XG5pbXBvcnQgJy4vcG9ydGFsLTc5Y2FhZWZmLmpzJztcbmltcG9ydCAnLi9wcml2aWxlZ2VzLWNjZDVmMzdkLmpzJztcbmltcG9ydCAnLi91cmwtZjNiODJjYzcuanMnO1xuaW1wb3J0ICcuL3N0b3JhZ2UtZDdmNTgyMmUuanMnO1xuaW1wb3J0ICcuL2Fncy02OGQ0YWUyMC5qcyc7XG5cbmNvbnN0IGxheWVyc0FuZFRhYmxlc1N0b3JlID0gY3JlYXRlU3RvcmUoe30pO1xuY29uc3QgbGF5ZXJzQW5kVGFibGVzU3RhdGUgPSBsYXllcnNBbmRUYWJsZXNTdG9yZS5zdGF0ZTtcblxuY29uc3QgYXJjZ2lzTGF5ZXJzQW5kVGFibGVzU3VtbWFyeVBvcHVwQ3NzID0gXCI6aG9zdHttYXgtd2lkdGg6MTAwJX1hcmNnaXMtbGF5ZXJzLWFuZC10YWJsZXMtc3VtbWFyeTpub3QoLmh5ZHJhdGVkKXt2aXNpYmlsaXR5OmhpZGRlbn0ucG9wb3Zlci1jb250ZW50e3dpZHRoOjM4MHB4O21pbi1oZWlnaHQ6NnJlbTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktYmFja2dyb3VuZCl9LnNrZWxldG9ue3BhZGRpbmc6MC41cmVtO21hcmdpbjoxcmVtO21hcmdpbi1ib3R0b206M3JlbTthbmltYXRpb246cHVsc2UgMnMgY3ViaWMtYmV6aWVyKDAuNCwgMCwgMC42LCAxKSBpbmZpbml0ZTtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktYm9yZGVyLTIpfS5za2VsZXRvbi1jb250ZW50e2Rpc3BsYXk6ZmxleH0uc2tlbGV0b24tbGVmdCwuc2tlbGV0b24tcmlnaHR7d2lkdGg6MXJlbTtoZWlnaHQ6MXJlbTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktYm9yZGVyLTMpfS5za2VsZXRvbi1tYWlue2ZsZXg6MSAxIDAlO21hcmdpbi1sZWZ0OjFyZW07bWFyZ2luLXJpZ2h0OjFyZW19LnNrZWxldG9uLXRpdGxle2hlaWdodDoxcmVtO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1ib3JkZXItMil9LnNrZWxldG9uLXN1YnRpdGxle2hlaWdodDoxcmVtO21hcmdpbi10b3A6MC4yNXJlbTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktYm9yZGVyLTMpfUBrZXlmcmFtZXMgcHVsc2V7MCUsMTAwJXtvcGFjaXR5OjF9NTAle29wYWNpdHk6MC41fX0uYnV0dG9ue3RyYW5zaXRpb24tcHJvcGVydHk6YWxsO3BhZGRpbmc6MDtvdXRsaW5lOjJweCBzb2xpZCB0cmFuc3BhcmVudDtvdXRsaW5lLW9mZnNldDoycHg7Ym9yZGVyLXN0eWxlOm5vbmU7Y3Vyc29yOnBvaW50ZXI7bWF4LXdpZHRoOjEwMCU7Y29sb3I6aW5oZXJpdDtiYWNrZ3JvdW5kOnRyYW5zcGFyZW50O2ZvbnQtZmFtaWx5OmluaGVyaXQ7Zm9udC1zaXplOmluaGVyaXQ7bGluZS1oZWlnaHQ6MS41fS5idXR0b246Zm9jdXN7b3V0bGluZToycHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1icmFuZCk7b3V0bGluZS1vZmZzZXQ6NHB4fS5idXR0b24tLWJvcmRlcntwYWRkaW5nLWxlZnQ6MC41cmVtO3BhZGRpbmctcmlnaHQ6MC41cmVtO3BhZGRpbmctdG9wOjAuMjVyZW07cGFkZGluZy1ib3R0b206MC4yNXJlbTtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0zKX0uYnV0dG9uLS1ib3JkZXI6Zm9jdXN7b3V0bGluZS1vZmZzZXQ6MH0uYnV0dG9uLXRleHR7cG9pbnRlci1ldmVudHM6bm9uZTtkaXNwbGF5OmZsZXh9LmJ1dHRvbi0taWNvbnt2ZXJ0aWNhbC1hbGlnbjotM3B4Oy13ZWJraXQtbWFyZ2luLXN0YXJ0OjAuMjVyZW07bWFyZ2luLWlubGluZS1zdGFydDowLjI1cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNMYXllcnNBbmRUYWJsZXNTdW1tYXJ5UG9wdXAgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuaGFuZGxlQ2xpY2sgPSBhc3luYyAoKSA9PiB7XG4gICAgICB2YXIgX2E7XG4gICAgICBjb25zdCB7IGxheWVycywgaXRlbSB9ID0gdGhpcztcbiAgICAgIChfYSA9IHRoaXMuYnV0dG9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9jdXMoKTtcbiAgICAgIGlmICghbGF5ZXJzKSB7XG4gICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZiAoIWxheWVyc0FuZFRhYmxlc1N0YXRlW2l0ZW0uaWRdKSB7XG4gICAgICAgIGxheWVyc0FuZFRhYmxlc1N0YXRlW2l0ZW0uaWRdID0gdGhpcy5mZXRjaFNlcnZpY2VJbmZvKCk7XG4gICAgICB9XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGxheWVyc0FuZFRhYmxlc1N0YXRlW2l0ZW0uaWRdO1xuICAgICAgaWYgKHJlc3BvbnNlLmVycm9yKSB7XG4gICAgICAgIHRoaXMuZXJyb3IgPSB0aGlzLmkxOG4uZXJyb3I7XG4gICAgICAgIGlmIChyZXNwb25zZS5lcnJvci5jb2RlID09PSBcInNlcnZpY2VOb3RFeGlzdFwiKSB7XG4gICAgICAgICAgdGhpcy5lcnJvci5tZXNzYWdlID0gdGhpcy5pMThuLmVycm9yLm5vU2VydmljZU1lc3NhZ2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChyZXNwb25zZS5yZXN1bHQpIHtcbiAgICAgICAgdGhpcy5zdWJsYXllcnMgPSBzZXRNYXRjaGVkKHJlc3BvbnNlLnJlc3VsdCwgbGF5ZXJzKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLnN1YmxheWVycyA9IGxheWVycztcbiAgICAgIH1cbiAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgcmV0dXJuO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVXaW5kb3dDbGljayA9ICh7IHRhcmdldCB9KSA9PiB7XG4gICAgICBpZiAodGhpcy5lbC5jb250YWlucyh0YXJnZXQpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLnBvcG92ZXJOb2RlLm9wZW4gPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlS2V5UHJlc3MgPSAoeyBrZXkgfSkgPT4ge1xuICAgICAgc3dpdGNoIChrZXkpIHtcbiAgICAgICAgY2FzZSBcIkVzY1wiOlxuICAgICAgICBjYXNlIFwiRXNjYXBlXCI6XG4gICAgICAgICAgaWYgKHRoaXMucG9wb3Zlck5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMucG9wb3Zlck5vZGUub3BlbiA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuYXBpID0gNDtcbiAgICB0aGlzLmNvbmZpZyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pdGVtID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubGF5ZXJzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2VhcmNoVGVybSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmJvcmRlciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnRvb2x0aXAgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy50ZWxlbWV0cnkgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5idXR0b24gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICB0aGlzLmVycm9yID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc3VibGF5ZXJzID0gdW5kZWZpbmVkO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIGNvbnN0IGxvY2FsZSA9IGF3YWl0IGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3ModGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gbG9jYWxlWzBdO1xuICAgIGNvbmZpZ1N0YXRlLmFwaSA9IHRoaXMuYXBpO1xuICAgIGNvbmZpZ1N0YXRlLnBvcnRhbCA9IHRoaXMucG9ydGFsO1xuICAgIGNvbmZpZ1N0YXRlLmNvbmZpZyA9IHRoaXMuY29uZmlnO1xuICAgIGNvbmZpZ1N0YXRlLnVzZXIgPSB0aGlzLnVzZXI7XG4gICAgaWYgKCF0aGlzLmxheWVycykge1xuICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgZmV0Y2hTZXJ2aWNlSW5mbygpIHtcbiAgICBjb25zdCB7IGl0ZW0sIHBvcnRhbCwgbGF5ZXJzIH0gPSB0aGlzO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgbWluRGVsYXkoZmV0Y2hGZWF0dXJlU2VydmljZUluZm8oeyBpdGVtLCBwb3J0YWwsIGxheWVycywgaXNTZWN1cmU6IGZhbHNlIH0pLCA1MDApO1xuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBpMThuLCBwb3J0YWwsIHVzZXIsIGl0ZW0sIGhhbmRsZUNsaWNrLCBoYW5kbGVLZXlQcmVzcywgbG9hZGluZywgc2VhcmNoVGVybSwgZXJyb3IsIHRvb2x0aXAsIHRlbGVtZXRyeSB9ID0gdGhpcztcbiAgICBjb25zdCBsYXllcnMgPSB0aGlzLnN1YmxheWVycyB8fCB0aGlzLmxheWVycztcbiAgICByZXR1cm4gKGgoSG9zdCwgeyBvbkZvY3Vzb3V0OiAoZSkgPT4ge1xuICAgICAgICBpZiAoIWUucmVsYXRlZFRhcmdldCB8fCB0aGlzLmVsLmNvbnRhaW5zKGUucmVsYXRlZFRhcmdldCkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy5wb3BvdmVyTm9kZS5vcGVuID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0gfSwgaChcImNhbGNpdGUtcG9wb3Zlci1tYW5hZ2VyXCIsIHsgYXV0b0Nsb3NlOiB0cnVlIH0sIGgoXCJidXR0b25cIiwgT2JqZWN0LmFzc2lnbih7IGNsYXNzOiB7XG4gICAgICAgIGJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgXCJidXR0b24tLWJvcmRlclwiOiB0aGlzLmJvcmRlclxuICAgICAgfSwgcmVmOiAoZWwpID0+ICh0aGlzLmJ1dHRvbiA9IGVsKSwgb25DbGljazogaGFuZGxlQ2xpY2ssIG9uVG91Y2hTdGFydDogaGFuZGxlQ2xpY2ssIG9uS2V5UHJlc3M6IGhhbmRsZUtleVByZXNzIH0sICh0b29sdGlwID8geyB0aXRsZTogdG9vbHRpcCB9IDoge30pKSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJidXR0b24tdGV4dFwiIH0sIGgoXCJzbG90XCIsIG51bGwpLCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgaWNvbjogXCJjYXJldC1kb3duXCIsIHNjYWxlOiBcInNcIiwgY2xhc3M6IFwiYnV0dG9uLS1pY29uXCIgfSkpKSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IHJlZjogKGVsKSA9PiAodGhpcy5wb3BvdmVyTm9kZSA9IGVsKSwgbGFiZWw6IGkxOG4ubGF5ZXJzQW5kVGFibGVzLCBwb2ludGVyRGlzYWJsZWQ6IHRydWUsIHJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMuYnV0dG9uLCBjbG9zYWJsZTogdHJ1ZSwgY2xhc3M6IFwicG9wb3ZlclwiLCBwbGFjZW1lbnQ6IFwiYm90dG9tXCIsIG92ZXJsYXlQb3NpdGlvbmluZzogXCJmaXhlZFwiLCBoZWFkaW5nOiBpMThuLmxheWVyc0FuZFRhYmxlcywgb25DYWxjaXRlUG9wb3Zlck9wZW46ICgpID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLnRlbGVtZXRyeSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxvZ0V2ZW50KHtcbiAgICAgICAgICBjYXRlZ29yeTogXCJwcmV2aWV3IHBvcHVwXCIsXG4gICAgICAgICAgYWN0aW9uOiBcImNsaWNrXCIsXG4gICAgICAgICAgcGFnZU5hbWU6IGdldFBhZ2VOYW1lKCksXG4gICAgICAgICAgcGFnZVVybDogd2luZG93LmxvY2F0aW9uLmhyZWZcbiAgICAgICAgfSk7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5oYW5kbGVXaW5kb3dDbGljayk7XG4gICAgICB9LCBvbkNhbGNpdGVQb3BvdmVyQ2xvc2U6IGRlYm91bmNlKCgpID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLnRlbGVtZXRyeSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxvZ0V2ZW50KHtcbiAgICAgICAgICBjYXRlZ29yeTogXCJwcmV2aWV3IHBvcHVwXCIsXG4gICAgICAgICAgYWN0aW9uOiBcImNsb3NlXCIsXG4gICAgICAgICAgcGFnZU5hbWU6IGdldFBhZ2VOYW1lKCksXG4gICAgICAgICAgcGFnZVVybDogd2luZG93LmxvY2F0aW9uLmhyZWZcbiAgICAgICAgfSk7XG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5oYW5kbGVXaW5kb3dDbGljayk7XG4gICAgICB9LCAyMDApIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJwb3BvdmVyLWNvbnRlbnRcIiB9LCBsb2FkaW5nID8gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJza2VsZXRvblwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJza2VsZXRvbi1jb250ZW50XCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNrZWxldG9uLWxlZnRcIiB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNrZWxldG9uLW1haW5cIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2tlbGV0b24tdGl0bGVcIiB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNrZWxldG9uLXN1YnRpdGxlXCIgfSkpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2tlbGV0b24tcmlnaHRcIiB9KSkpKSA6IChoKFwiYXJjZ2lzLWxheWVycy1hbmQtdGFibGVzLXN1bW1hcnlcIiwgeyBwb3J0YWw6IHBvcnRhbCwgdXNlcjogdXNlciwgaXRlbTogaXRlbSwgbGF5ZXJzOiBsYXllcnMsIHNob3dNYXRjaGVkOiBzZWFyY2hUZXJtICYmICEhdGhpcy5sYXllcnMsIGVycm9yOiBlcnJvcixcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIGxvYWRpbmc6ICF0aGlzLnN1YmxheWVycywgdGVsZW1ldHJ5OiB0ZWxlbWV0cnksIG9uTGF5ZXJzQW5kVGFibGVzRm9jdXNFbmQ6ICgpID0+IHtcbiAgICAgICAgdGhpcy5wb3BvdmVyTm9kZS5vcGVuID0gZmFsc2U7XG4gICAgICB9IH0pKSkpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNMYXllcnNBbmRUYWJsZXNTdW1tYXJ5UG9wdXAuc3R5bGUgPSBhcmNnaXNMYXllcnNBbmRUYWJsZXNTdW1tYXJ5UG9wdXBDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc0xheWVyc0FuZFRhYmxlc1N1bW1hcnlQb3B1cCBhcyBhcmNnaXNfbGF5ZXJzX2FuZF90YWJsZXNfc3VtbWFyeV9wb3B1cCB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1hYWYzMGJkNi5qcyc7XG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTEzZjViMDBjLmpzJztcblxuY29uc3QgbGFuZ3VhZ2VNYXAgPSBuZXcgTWFwKFtcbiAgW1wiYXJcIiwgXCJhclwiXSxcbiAgW1wiYmdcIiwgXCJiZ1wiXSxcbiAgW1wiYnNcIiwgXCJic1wiXSxcbiAgW1wiY2FcIiwgXCJjYVwiXSxcbiAgW1wiY3NcIiwgXCJjc1wiXSxcbiAgW1wiZGFcIiwgXCJkYVwiXSxcbiAgW1wiZGVcIiwgXCJkZVwiXSxcbiAgW1wiZWxcIiwgXCJlbFwiXSxcbiAgW1wiZW5cIiwgXCJlblwiXSxcbiAgW1wiZXNcIiwgXCJlc1wiXSxcbiAgW1wiZXRcIiwgXCJldFwiXSxcbiAgW1wiZmlcIiwgXCJmaVwiXSxcbiAgW1wiZnJcIiwgXCJmclwiXSxcbiAgW1wiaGVcIiwgXCJoZVwiXSxcbiAgW1wiaHJcIiwgXCJoclwiXSxcbiAgW1wiaHVcIiwgXCJodVwiXSxcbiAgW1wiaWRcIiwgXCJpZFwiXSxcbiAgW1wiaXRcIiwgXCJpdFwiXSxcbiAgW1wiamFcIiwgXCJqYVwiXSxcbiAgW1wia29cIiwgXCJrb1wiXSxcbiAgW1wibHRcIiwgXCJsdFwiXSxcbiAgW1wibHZcIiwgXCJsdlwiXSxcbiAgW1wibmJcIiwgXCJuYlwiXSxcbiAgW1wibmxcIiwgXCJubFwiXSxcbiAgW1wicGxcIiwgXCJwbFwiXSxcbiAgW1wicHQtYnJcIiwgXCJwdC1CUlwiXSxcbiAgW1wicHQtcHRcIiwgXCJwdC1QVFwiXSxcbiAgW1wicm9cIiwgXCJyb1wiXSxcbiAgW1wicnVcIiwgXCJydVwiXSxcbiAgW1wic2tcIiwgXCJza1wiXSxcbiAgW1wic2xcIiwgXCJzbFwiXSxcbiAgW1wic3JcIiwgXCJzclwiXSxcbiAgW1wic3ZcIiwgXCJzdlwiXSxcbiAgW1widGhcIiwgXCJ0aFwiXSxcbiAgW1widHJcIiwgXCJ0clwiXSxcbiAgW1widWtcIiwgXCJ1a1wiXSxcbiAgW1widmlcIiwgXCJ2aVwiXSxcbiAgW1wiemgtY25cIiwgXCJ6aC1DTlwiXSxcbiAgW1wiemgtaGtcIiwgXCJ6aC1IS1wiXSxcbiAgW1wiemgtdHdcIiwgXCJ6aC1UV1wiXVxuXSk7XG4vLyBydGxcbmZ1bmN0aW9uIGdldEVsZW1lbnREaXIoZWwpIHtcbiAgcmV0dXJuIGdldEVsZW1lbnRQcm9wKGVsLCBcImRpclwiLCBcImx0clwiKTtcbn1cbmZ1bmN0aW9uIGdldEVsZW1lbnRQcm9wKGVsLCBwcm9wLCB2YWx1ZSkge1xuICBjb25zdCBjbG9zZXN0V2l0aFByb3AgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWwsIGBbJHtwcm9wfV1gKTtcbiAgcmV0dXJuIGNsb3Nlc3RXaXRoUHJvcCA/IGNsb3Nlc3RXaXRoUHJvcC5nZXRBdHRyaWJ1dGUocHJvcCkgOiB2YWx1ZTtcbn1cbi8vIGNzc1xuY29uc3QgQ1NTX1VUSUxJVFkgPSB7XG4gIHJ0bDogXCJhcmNnaXMtLXJ0bFwiXG59O1xuYXN5bmMgZnVuY3Rpb24gZm9ybWF0TnVtYmVyKG51bWJlciwgb3B0aW9ucykge1xuICBjb25zdCB7IGFwaSwgdHlwZSwgcGxhY2VzIH0gPSBvcHRpb25zIHx8IHt9O1xuICBpZiAoYXBpID09PSA0KSB7XG4gICAgY29uc3QgW2ludGxdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9pbnRsXCJdKTtcbiAgICBjb25zdCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyA9IGludGwuY29udmVydE51bWJlckZvcm1hdFRvSW50bE9wdGlvbnMoe1xuICAgICAgcGxhY2VzLFxuICAgICAgc3R5bGU6IHR5cGUsXG4gICAgICBkaWdpdFNlcGFyYXRvcjogdHJ1ZVxuICAgIH0pO1xuICAgIHJldHVybiBpbnRsLmZvcm1hdE51bWJlcihudW1iZXIsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMpLCB7IHN0eWxlOiB0eXBlIH0pKTtcbiAgfVxuICBjb25zdCBbZG9qb051bWJlcl0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJkb2pvL251bWJlclwiXSk7XG4gIHJldHVybiBkb2pvTnVtYmVyLmZvcm1hdChudW1iZXIsIHtcbiAgICB0eXBlLFxuICAgIHBsYWNlcyxcbiAgICBwYXR0ZXJuOiBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMucGF0dGVyblxuICB9KTtcbn1cbmNvbnN0IGNhY2hlID0ge307XG5mdW5jdGlvbiBmb3JtYXREYXRlKGRhdGUpIHtcbiAgY29uc3QgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nO1xuICBjb25zdCBkYXlTaG9ydE1vbnRoWWVhciA9IHtcbiAgICB5ZWFyOiBcIm51bWVyaWNcIixcbiAgICBtb250aDogXCJzaG9ydFwiLFxuICAgIGRheTogXCJudW1lcmljXCJcbiAgfTtcbiAgaWYgKCFjYWNoZVtsYW5nXSkge1xuICAgIGNhY2hlW2xhbmddID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmxhbmcsIGRheVNob3J0TW9udGhZZWFyKTtcbiAgfVxuICByZXR1cm4gY2FjaGVbbGFuZ10uZm9ybWF0KGRhdGUpO1xufVxuXG5leHBvcnQgeyBDU1NfVVRJTElUWSBhcyBDLCBmb3JtYXREYXRlIGFzIGEsIGZvcm1hdE51bWJlciBhcyBmLCBnZXRFbGVtZW50RGlyIGFzIGcsIGxhbmd1YWdlTWFwIGFzIGwgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgeyBsIGFzIGxhbmd1YWdlTWFwIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtMjIyNThjOTAuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRBc3NldFBhdGggfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcblxuLy8gaHR0cHM6Ly9tZWRpdW0uY29tL3N0ZW5jaWwtdHJpY2tzL2ltcGxlbWVudGluZy1pbnRlcm5hdGlvbmFsaXNhdGlvbi1pMThuLXdpdGgtc3RlbmNpbC01ZTY1NTk1NTQxMTdcbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KSB7XG4gIHZhciBfYSwgX2IsIF9jO1xuICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICB9XG4gIGVsc2Uge1xuICAgIC8vIFwicnUtUlVcIiBtYXBzIHRvIFwicnVcIiB1c2UgY2FzZVxuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZy5zbGljZSgwLCAyKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCkge1xuICB2YXIgX2EsIF9iLCBfYztcbiAgLy8gaXQncyBPSyBpZiB3ZSBkb24ndCBoYXZlIHRoZSA0IGxldHRlciBsYW5ndWFnZSBmaWxlIGZvciBpdFxuICAvLyA0IGxldHRlciBsYW5ndWFnZSBjb2RlIG5lZWRlZCBmb3IgZm9ybWF0dGluZyBudW1iZXJzXG4gIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgLy8gd2Ugc3VwcG9ydCB0aGUgMiBsZXR0ZXIgY29kZWQgbGFuZ3VhZ2VcbiAgICAgIC8vIGUuZy4gaXQtQ0ggdnMgaXRcbiAgICAgIHJldHVybiBsYW5nO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBcImVuXCI7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgZmV0Y2goZ2V0QXNzZXRQYXRoKGAuLi9hcmNnaXMtYXBwLWFzc2V0cy9pMThuLyR7Y29tcG9uZW50TmFtZX0uaTE4bi4ke2xvY2FsZX0uanNvbmApKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgIGlmIChyZXN1bHQub2spXG4gICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XG4gICAgICBlbHNlXG4gICAgICAgIHJlamVjdCgpO1xuICAgIH0sICgpID0+IHJlamVjdCgpKTtcbiAgfSk7XG59XG5jb25zdCBzdHJpbmdDYWNoZSA9IHt9O1xuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICBjb25zdCBpZCA9IGAke2NvbXBvbmVudE5hbWV9JHtsb2NhbGV9YDtcbiAgaWYgKCFzdHJpbmdDYWNoZVtpZF0pIHtcbiAgICBzdHJpbmdDYWNoZVtpZF0gPSBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKTtcbiAgfVxuICByZXR1cm4gc3RyaW5nQ2FjaGVbaWRdO1xufVxuLyoqXG4gKiBHZXQgc3RyaW5ncyBhbmQgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGlzIG1ldGhvZCByZXR1cm5zIDIgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGUgZmlyc3Qgb25lIHJldHVybnMgYSBjb2RlIHRoYXQncyBhbHNvIHN1cHBvcnRlZCBhcyBhIGxhbmd1YWdlIGZpbGUuXG4gKiBUaGUgc2Vjb25kIG9uZSByZXR1cm5zIGEgY29kZSB3aGVyZSB0aGVyZSBpcyBzdXBwb3J0IGZvciB0aGUgZmlyc3QgMiBsZXR0ZXJzIG9mIHRoZSBjb2RlIGFzIHBhcnQgb2YgYSBsYW5ndWFnZSBmaWxlLFxuICogYnV0IHdpbGwgcmV0dXJuIHRoZSBvcmlnaW5hbCA0IGxldHRlciBjb2RlIGZyb20gdGhlIHBhZ2UuXG4gKiBFLmcuIEZvciBcIml0LWNoXCIgaXQgd2lsbCByZXR1cm4gXCJpdFwiIGFzIHRoZSBmaXJzdCBsYW5ndWFnZSBjb2RlIGFuZCBcIml0LWNoXCIgYXMgdGhlIHNlY29uZC5cbiAqIFRoZSBzZWNvbmQgb25lIGlzIHJlcXVpcmVkIGZvciBlc3JpLmludGwuc2V0TG9jYWxlKCkgdG8gZ2V0IHRoZSBjb3JyZWN0IGZvcm1hdHRpbmcuXG4gKlxuICogSWYgYSB0YWdOYW1lIGlzIHByb3ZpZGVkIGl0IHdpbGwgb3ZlcndpdGUgdGhlIGVsZW1lbnQncyB0YWdOYW1lXG4gKlxuICogIEByZXR1cm4gWyBzdHJpbmdzLCBmaXJzdCBsYW5ndWFnZSBjb2RlLCBzZWNvbmQgbGFuZ3VhZ2UgY29kZV1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyhlbGVtZW50LCB0YWdOYW1lKSB7XG4gIGNvbnN0IGNvbXBvbmVudE5hbWUgPSB0YWdOYW1lIHx8IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCBjb21wb25lbnRMYW5ndWFnZSA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KTtcbiAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2VJbnRsID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KTtcbiAgbGV0IHN0cmluZ3M7XG4gIHRyeSB7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBjb21wb25lbnRMYW5ndWFnZSk7XG4gIH1cbiAgY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLndhcm4oYG5vIGxvY2FsZSBmb3IgJHtjb21wb25lbnROYW1lfSAoJHtjb21wb25lbnRMYW5ndWFnZX0pIGxvYWRpbmcgZGVmYXVsdCBsb2NhbGUgZW4uYCk7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBcImVuXCIpO1xuICB9XG4gIHJldHVybiBbc3RyaW5ncywgY29tcG9uZW50TGFuZ3VhZ2UsIGNvbXBvbmVudExhbmd1YWdlSW50bF07XG59XG5cbmV4cG9ydCB7IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZSBhcyBhLCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIGFzIGcgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgciBhcyByZXF1ZXN0LCBoIGFzIGdldFRva2VuLCBnIGFzIGdldFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9wb3J0YWwtNzljYWFlZmYuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLWViNWY3ZGMyLmpzJztcbmltcG9ydCB7IGEgYXMgaXNIb3N0ZWRTZXJ2aWNlIH0gZnJvbSAnLi91cmwtZjNiODJjYzcuanMnO1xuXG5mdW5jdGlvbiBwYXJzZVN1YmxheWVyKHN1YmxheWVyLCBsYXllcnMsIGlzVGFibGUpIHtcbiAgdmFyIF9hLCBfYjtcbiAgcmV0dXJuIHtcbiAgICBkZXNjcmlwdGlvbjogc3VibGF5ZXIuZGVzY3JpcHRpb24sXG4gICAgZmllbGRBbGlhc2VzOiAoX2EgPSBzdWJsYXllci5maWVsZHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tYXAoKGZpZWxkKSA9PiBmaWVsZC5hbGlhcyksXG4gICAgZmllbGRzOiBzdWJsYXllci5maWVsZHMsXG4gICAgZ2VvbWV0cnlUeXBlOiBpc1RhYmxlID8gXCJ0YWJsZVwiIDogc3VibGF5ZXIuZ2VvbWV0cnlUeXBlLFxuICAgIGlkOiBzdWJsYXllci5pZCxcbiAgICB0aXRsZTogc3VibGF5ZXIubmFtZSxcbiAgICB0eXBlOiBzdWJsYXllci50eXBlLFxuICAgIG1hdGNoZWQ6IChfYiA9IGxheWVycyA9PT0gbnVsbCB8fCBsYXllcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxheWVycy5maW5kKChsYXllcikgPT4gbGF5ZXIuaWQgPT09IHN1YmxheWVyLmlkKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm1hdGNoZWRcbiAgfTtcbn1cbmZ1bmN0aW9uIHNlcnZlclJlcXVlc3QodXJsLCBpc1NlY3VyZSkge1xuICBjb25zdCB7IGNvbmZpZyB9ID0gY29uZmlnU3RhdGU7XG4gIGNvbnN0IGhvc3RlZCA9IGlzSG9zdGVkU2VydmljZSh1cmwpO1xuICBjb25zdCByZXF1ZXN0T3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7IHVzZVByb3h5OiBmYWxzZSwgdGltZW91dDogY29uZmlnLmlzTXVsdGlUZW5hbnQgPT09IGZhbHNlID8gNjAwMDAgOiA1MDAwLCBhZGRTU0w6IGhvc3RlZCB9LCAoaXNTZWN1cmUgPyB7fSA6IHsgYWRkVG9rZW5NYW51YWxseTogZmFsc2UgfSkpLCB7IHVzZVBvc3Q6IHRydWUsIGRpc2FibGVJZGVudGl0eUxvb2t1cDogdHJ1ZSB9KTtcbiAgcmV0dXJuIHJlcXVlc3QodXJsLCB7fSwgcmVxdWVzdE9wdGlvbnMsIFwicG9zdFwiKTtcbn1cbmZ1bmN0aW9uIGdldEVycm9yQ29kZShlcnJvcikge1xuICB2YXIgX2EsIF9iO1xuICByZXR1cm4gKGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5jb2RlKSB8fCAoKF9iID0gKF9hID0gZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmRldGFpbHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yYXcpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jb2RlKTtcbn1cbmZ1bmN0aW9uIHNlcnZpY2VEb2VzTm90RXhpc3QoZXJyb3IpIHtcbiAgY29uc3QgY29kZSA9IGdldEVycm9yQ29kZShlcnJvcik7XG4gIHJldHVybiBbNDA0LCA1MDBdLmluY2x1ZGVzKGNvZGUpIHx8IChlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IubWVzc2FnZSkgPT09IFwiSW52YWxpZCBVUkxcIjtcbn1cbmZ1bmN0aW9uIHNob3VsZFJldHJ5V2l0aFRva2VuKGlzU2VjdXJlLCBlcnJvcikge1xuICBjb25zdCBjb2RlID0gZ2V0RXJyb3JDb2RlKGVycm9yKTtcbiAgcmV0dXJuICFpc1NlY3VyZSAmJiAoKGNvZGUgPT09IDQ5OSAmJiAoZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLm1lc3NhZ2UpID09PSBcIlRva2VuIFJlcXVpcmVkXCIpIHx8IGNvZGUgPT09IDQwMykgJiYgISFjb25maWdTdGF0ZS51c2VyO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hMYXllcihwb3J0YWwsIGlkLCB1cmwsIGlzU2VjdXJlKSB7XG4gIGNvbnN0IGVycm9yUmVzdWx0ID0geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICB0cnkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2ZXJSZXF1ZXN0KGAke3VybH0vJHtpZH1gLCBpc1NlY3VyZSk7XG4gICAgICByZXR1cm4geyByZXN1bHQgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoc2hvdWxkUmV0cnlXaXRoVG9rZW4oaXNTZWN1cmUsIGVycm9yKSkge1xuICAgICAgICByZXR1cm4gZmV0Y2hMYXllcihwb3J0YWwsIGlkLCB1cmwsIHRydWUpO1xuICAgICAgfVxuICAgICAgaWYgKHNlcnZpY2VEb2VzTm90RXhpc3QoZXJyb3IpKSB7XG4gICAgICAgIGVycm9yUmVzdWx0LmVycm9yLmNvZGUgPSBcInNlcnZpY2VOb3RFeGlzdFwiO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGVycm9yUmVzdWx0O1xuICAgIH1cbiAgfVxuICBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gZXJyb3JSZXN1bHQ7XG4gIH1cbn1cbmZ1bmN0aW9uIGZpbHRlckxheWVycyhsYXllcnMsIG1hdGNoZWRMYXllcnMsIGRhdGEsIGlzVGFibGUpIHtcbiAgdmFyIF9hLCBfYjtcbiAgY29uc3QgaGFzVGFibGVzID0gZGF0YSA9PT0gbnVsbCB8fCBkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhLnRhYmxlcztcbiAgY29uc3QgaGFzRGVmaW5lZERhdGFMYXllcnMgPSAoKF9hID0gZGF0YSA9PT0gbnVsbCB8fCBkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhLmxheWVycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgPiAwIHx8IGhhc1RhYmxlcztcbiAgY29uc3QgaWRzID0gWy4uLigoZGF0YSA9PT0gbnVsbCB8fCBkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhLmxheWVycykgfHwgW10pLm1hcCgobGF5ZXIpID0+IGxheWVyLmlkKSwgLi4uKF9iID0gKChkYXRhID09PSBudWxsIHx8IGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGEudGFibGVzKSB8fCBbXSkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5tYXAoKHRhYmxlKSA9PiB0YWJsZS5pZCldO1xuICAvLyBpZiBkYXRhIGhhcyBkZWZpbmVkIGxheWVycywgb25seSB1c2UgbGF5ZXJzIGluIGRhdGEsIG5vdCB0aGUgd2hvbGUgc2VydmljZSAoV2ViR0lTL2FyY2dpcy1wb3J0YWwtYXBwIzM5NzY4KVxuICAvLyBpZiBkYXRhIGhhcyBkZWZpbmVkIGxheWVycywgYnV0IG5vIGRlZmluZWQgdGFibGVzLCBhbGxvdyBhbGwgdGFibGVzIHRocm91Z2ggKFdlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcCM0MDA2NylcbiAgY29uc3Qgc3VibGF5ZXJzID0gKGxheWVycyB8fCBbXSlcbiAgICAuZmlsdGVyKCh7IGlkLCB0eXBlIH0pID0+ICFoYXNEZWZpbmVkRGF0YUxheWVycyB8fCAodHlwZSA9PT0gXCJUYWJsZVwiICYmICFoYXNUYWJsZXMpIHx8IGlkcy5pbmNsdWRlcyhpZCkpXG4gICAgLm1hcCgobGF5ZXIpID0+IHBhcnNlU3VibGF5ZXIobGF5ZXIsIG1hdGNoZWRMYXllcnMsIGlzVGFibGUpKTtcbiAgcmV0dXJuIHN1YmxheWVycztcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoTGF5ZXJzKHsgc2VydmljZUluZm8sIGl0ZW0sIGxheWVycywgaXNTZWN1cmUsIGRhdGEgfSkge1xuICB2YXIgX2EsIF9iO1xuICBjb25zdCB7IHVybCB9ID0gaXRlbTtcbiAgaWYgKCEoKF9hID0gc2VydmljZUluZm8ubGF5ZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSAmJiAhKChfYiA9IHNlcnZpY2VJbmZvLnRhYmxlcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmxlbmd0aCkgJiYgKHNlcnZpY2VJbmZvID09PSBudWxsIHx8IHNlcnZpY2VJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXJ2aWNlSW5mby5maWVsZHMpKSB7XG4gICAgcmV0dXJuIHsgcmVzdWx0OiBbcGFyc2VTdWJsYXllcihzZXJ2aWNlSW5mbywgbGF5ZXJzKV0gfTtcbiAgfVxuICB0cnkge1xuICAgIGNvbnN0IHsgbGF5ZXJzOiBzdWJsYXllcnMsIHRhYmxlcyB9ID0gYXdhaXQgc2VydmVyUmVxdWVzdChgJHt1cmx9L2xheWVyc2AsIGlzU2VjdXJlKTtcbiAgICByZXR1cm4ge1xuICAgICAgcmVzdWx0OiBbLi4uZmlsdGVyTGF5ZXJzKHN1YmxheWVycywgbGF5ZXJzLCBkYXRhKSwgLi4uZmlsdGVyTGF5ZXJzKHRhYmxlcywgbGF5ZXJzLCBkYXRhLCB0cnVlKV0uc29ydCgoYSwgYikgPT4gYS5pZCAtIGIuaWQpXG4gICAgfTtcbiAgfVxuICBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICB9XG59XG5mdW5jdGlvbiBzZXRNYXRjaGVkKHN1YmxheWVycywgbWF0Y2hlZExheWVycykge1xuICByZXR1cm4gc3VibGF5ZXJzLm1hcCgoc3VibGF5ZXIpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgc3VibGF5ZXIpLCB7IG1hdGNoZWQ6IChfYSA9IG1hdGNoZWRMYXllcnMgPT09IG51bGwgfHwgbWF0Y2hlZExheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWF0Y2hlZExheWVycy5maW5kKChsYXllcikgPT4gbGF5ZXIuaWQgPT09IHN1YmxheWVyLmlkKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1hdGNoZWQgfSk7XG4gIH0pO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hGZWF0dXJlU2VydmljZUluZm8oeyBpdGVtLCBwb3J0YWwsIGxheWVycywgaXNTZWN1cmUsIGRhdGEsIHJldHJ5IH0pIHtcbiAgdmFyIF9hO1xuICBjb25zdCBlcnJvclJlc3VsdCA9IHsgZXJyb3I6IHsgY29kZTogXCJ1bmhhbmRsZWRFcnJvclwiIH0gfTtcbiAgdHJ5IHtcbiAgICBpZiAoIWRhdGEgJiYgIXJldHJ5KSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB0b2tlbiA9IGdldFRva2VuKHBvcnRhbCk7XG4gICAgICAgIGNvbnN0IHRva2VuUGFyYW0gPSB0b2tlbiA/IGAmdG9rZW49JHt0b2tlbn1gIDogXCJcIjtcbiAgICAgICAgY29uc3QgdXJsID0gYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX1jb250ZW50L2l0ZW1zLyR7aXRlbS5pZH0vZGF0YT9mPWpzb24ke3Rva2VuUGFyYW19YDtcbiAgICAgICAgLy8gVXNlIGZldGNoIGluc3RlYWQgb2YgcmVxdWVzdCB0byBzdG9wIHJlZGlyZWN0cyAoV2ViR0lTL2FyY2dpcy1wb3J0YWwtYXBwIzQwMTY0KVxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCk7XG4gICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4gICAgICAgIGlmICh0ZXh0KSB7XG4gICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UodGV4dCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEgPT09IG51bGwgfHwgZGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YS5lcnJvcikge1xuICAgICAgICAgIC8vIFRyZWF0IHRoaXMgZXhwaXJlZCBhY2NvdW50IGFzIGlmIHRoZSBzZXJ2aWNlIGRvZXNuJ3QgZXhpc3QgKFdlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcCM0MDE2MylcbiAgICAgICAgICBpZiAoZGF0YS5lcnJvci5jb2RlID09PSA0MDMgJiYgKChfYSA9IGRhdGEuZXJyb3IpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tZXNzYWdlQ29kZSkgPT09IFwiU0JfMDAwNlwiKSB7XG4gICAgICAgICAgICBlcnJvclJlc3VsdC5lcnJvci5jb2RlID0gXCJzZXJ2aWNlTm90RXhpc3RcIjtcbiAgICAgICAgICAgIHJldHVybiBlcnJvclJlc3VsdDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBpZiB3ZSBjYW4ndCBnZXQgaXRlbSBkYXRhLCBqdXN0IG1vdmUgb25cbiAgICAgICAgZGF0YSA9IG51bGw7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChpdGVtLnR5cGUgPT09IFwiRmVhdHVyZSBDb2xsZWN0aW9uXCIpIHtcbiAgICAgIGlmIChkYXRhID09PSBudWxsIHx8IGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGEubGF5ZXJzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcmVzdWx0OiBkYXRhLmxheWVycy5tYXAoKHsgbGF5ZXJEZWZpbml0aW9uIH0sIGlkKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICByZXR1cm4gKHtcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiXCIsXG4gICAgICAgICAgICAgIGZpZWxkczogbGF5ZXJEZWZpbml0aW9uLmZpZWxkcyxcbiAgICAgICAgICAgICAgZmllbGRBbGlhc2VzOiAoX2EgPSBsYXllckRlZmluaXRpb24uZmllbGRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWFwKChmaWVsZCkgPT4gZmllbGQuYWxpYXMpLFxuICAgICAgICAgICAgICBnZW9tZXRyeVR5cGU6IGxheWVyRGVmaW5pdGlvbi5nZW9tZXRyeVR5cGUsXG4gICAgICAgICAgICAgIHR5cGU6IGxheWVyRGVmaW5pdGlvbi50eXBlLFxuICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgICAgbWF0Y2hlZDogZmFsc2UsXG4gICAgICAgICAgICAgIHRpdGxlOiBsYXllckRlZmluaXRpb24ubmFtZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSlcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgdXJsIH0gPSBpdGVtO1xuICAgICAgY29uc3Qgc2VydmljZUluZm8gPSBhd2FpdCBzZXJ2ZXJSZXF1ZXN0KHVybCwgaXNTZWN1cmUpO1xuICAgICAgcmV0dXJuIGZldGNoTGF5ZXJzKHtcbiAgICAgICAgc2VydmljZUluZm8sXG4gICAgICAgIGl0ZW0sXG4gICAgICAgIGxheWVycyxcbiAgICAgICAgaXNTZWN1cmUsXG4gICAgICAgIGRhdGFcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChzaG91bGRSZXRyeVdpdGhUb2tlbihpc1NlY3VyZSwgZXJyb3IpKSB7XG4gICAgICAgIHJldHVybiBmZXRjaEZlYXR1cmVTZXJ2aWNlSW5mbyh7IGl0ZW0sIHBvcnRhbCwgbGF5ZXJzLCBkYXRhLCBpc1NlY3VyZTogdHJ1ZSB9KTtcbiAgICAgIH1cbiAgICAgIGlmIChzZXJ2aWNlRG9lc05vdEV4aXN0KGVycm9yKSkge1xuICAgICAgICBlcnJvclJlc3VsdC5lcnJvci5jb2RlID0gXCJzZXJ2aWNlTm90RXhpc3RcIjtcbiAgICAgIH1cbiAgICAgIHJldHVybiBlcnJvclJlc3VsdDtcbiAgICB9XG4gIH1cbiAgY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIGVycm9yUmVzdWx0O1xuICB9XG59XG5cbmV4cG9ydCB7IGZldGNoTGF5ZXIgYXMgYSwgZmV0Y2hGZWF0dXJlU2VydmljZUluZm8gYXMgZiwgc2V0TWF0Y2hlZCBhcyBzIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmZ1bmN0aW9uIGdldFBhZ2VOYW1lKCkge1xuICBjb25zdCB7IGhhc2gsIHBhdGhuYW1lIH0gPSB3aW5kb3cubG9jYXRpb247XG4gIGlmIChwYXRobmFtZS5pbmNsdWRlcyhcImdyb3VwLmh0bWxcIikpIHtcbiAgICByZXR1cm4gXCJncm91cCBwYWdlXCI7XG4gIH1cbiAgaWYgKHBhdGhuYW1lLmluY2x1ZGVzKFwic2VhcmNoLmh0bWxcIikpIHtcbiAgICByZXR1cm4gXCJzZWFyY2ggcmVzdWx0IHBhZ2VcIjtcbiAgfVxuICBzd2l0Y2ggKGhhc2gpIHtcbiAgICBjYXNlIFwiI2Zhdm9yaXRlc1wiOlxuICAgICAgcmV0dXJuIFwiZmF2b3JpdGVzXCI7XG4gICAgY2FzZSBcIiNncm91cHNcIjpcbiAgICAgIHJldHVybiBcIm15IGdyb3VwcyBjb250ZW50XCI7XG4gICAgY2FzZSBcIiNvcmdhbml6YXRpb25cIjpcbiAgICAgIHJldHVybiBcIm15IG9yZyBjb250ZW50XCI7XG4gICAgY2FzZSBcIiNsaXZpbmdBdGxhc1wiOlxuICAgICAgcmV0dXJuIFwibGl2aW5nIGF0bGFzXCI7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBcIm15IGNvbnRlbnRcIjtcbiAgfVxufVxuXG5leHBvcnQgeyBnZXRQYWdlTmFtZSBhcyBnIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=