"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-b40bd9"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js":
/*!**************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addItemState),
/* harmony export */   b: () => (/* binding */ addItemUrlState),
/* harmony export */   c: () => (/* binding */ addItemRequestState),
/* harmony export */   d: () => (/* binding */ addItemStore)
/* harmony export */ });
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const addItemStore = (0,_index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__.c)({
  typeKeywords: [],
  customParameters: [],
  analyzedLocationTypes: [],
  allowStoredAuth: true,
  isSecured: null,
  checkAuth: false
});
// Entire add item state object
const addItemState = addItemStore.state;
// Subsets of add item state
const addItemRequestState = addItemStore.state;
const addItemUrlState = addItemStore.state;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-data-store-select-nosql-credentials.entry.js":
/*!************************************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-data-store-select-nosql-credentials.entry.js ***!
  \************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_data_store_select_nosql_credentials: () => (/* binding */ ArcgisNewItemPagesDataStoreSelectNosqlCredentials)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./i18n-6685247f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/i18n-6685247f.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */






const arcgisNewItemPagesDataStoreSelectNosqlCredentialsCss = ".noSql-connection-credential{margin-top:1.5rem}.noSql-credential-input{margin-top:0.25rem}.noSql-credential-text{margin:0}.noSql-footer-padding{margin-bottom:2rem}";

const ArcgisNewItemPagesDataStoreSelectNosqlCredentials = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.inputFields = [
      "connectionUri",
      "fallBackServers",
      "username",
      "password",
      "database"
    ];
    this.renderError = false;
    this.connectionUri = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.connectionUri || "";
    this.fallBackServers = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.fallBackServers || "";
    this.username = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.username || "";
    this.password = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.password || "";
    this.database = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.database || "";
    this.error = [];
  }
  async componentWillLoad() {
    this.provider = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.noSqlProvider;
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.dataStoreSelectNoSql;
  }
  validateInputs() {
    const { i18n } = this;
    const error = [];
    if (!this.connectionUri) {
      error.push(i18n.connectionUri);
    }
    if (!this.username) {
      error.push(i18n.username);
    }
    if (!this.password) {
      error.push(i18n.password);
    }
    if (!this.database) {
      error.push(i18n.database);
    }
    this.error = error;
  }
  renderErrorItem() {
    if (this.error !== null) {
      const errorMessage = this.i18n.errorMessage;
      const errorDescription = (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_2__.r)(errorMessage, this.error.join(", "), "missingFields")
        .replace(/([^,]*)$/, " " + this.i18n.and + "$1")
        .replace(/:/g, "");
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: this.i18n.error, description: errorDescription, active: this.error !== null, onAlertDismiss: () => {
          this.error = null;
        } }));
    }
  }
  handleNext() {
    this.validateInputs();
    if (this.error.length) {
      this.renderError = true;
      return;
    }
    this.renderError = false;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.connectionUri = this.connectionUri;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.fallBackServers = this.fallBackServers;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.username = this.username;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.password = this.password;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.database = this.database;
    this.newItemUpdatePage.emit("dataStoreSelectServerList");
  }
  render() {
    const { provider, i18n, inputFields } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: i18n.credentialDescription }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "noSql-connection-credential" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "noSql-credential-text" }, i18n.provider), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { class: "noSql-credential-input", value: provider, disabled: true })), inputFields.map((type, index) => {
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { key: type }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "noSql-credential-text" }, i18n[type]), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { class: {
          "noSql-credential-input": true,
          "noSql-footer-padding": index === inputFields.length - 1
        }, value: this[type], type: type === "password" ? "password" : "text", onCalciteInputChange: (e) => {
          const newValue = e.target.value;
          this[type] = newValue;
        } }), i18n[`${type}Example`] ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "noSql-credential-text" }, i18n[`${type}Example`])) : null)));
    })), this.renderError ? this.renderErrorItem() : null));
  }
};
ArcgisNewItemPagesDataStoreSelectNosqlCredentials.style = arcgisNewItemPagesDataStoreSelectNosqlCredentialsCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/i18n-6685247f.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/i18n-6685247f.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   r: () => (/* binding */ replaceI18NString)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
const regexLookupMap = {
  fileName: /\$\{fileName\}/g,
  fileType: /\$\{type\}/g,
  typeList: /\$\{typeList\}/g,
  missingFields: /\$\{\missingFields\}/g
};
const replaceI18NString = (str, replacementString, type) => {
  const typeRegEx = new RegExp(regexLookupMap[type]);
  return str === null || str === void 0 ? void 0 : str.replace(typeRegEx, replacementString);
};




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ createStore)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const appendToMap = (map, propName, value) => {
    const items = map.get(propName);
    if (!items) {
        map.set(propName, [value]);
    }
    else if (!items.includes(value)) {
        items.push(value);
    }
};
const debounce = (fn, ms) => {
    let timeoutId;
    return (...args) => {
        if (timeoutId) {
            clearTimeout(timeoutId);
        }
        timeoutId = setTimeout(() => {
            timeoutId = 0;
            fn(...args);
        }, ms);
    };
};

/**
 * Check if a possible element isConnected.
 * The property might not be there, so we check for it.
 *
 * We want it to return true if isConnected is not a property,
 * otherwise we would remove these elements and would not update.
 *
 * Better leak in Edge than to be useless.
 */
const isConnected = (maybeElement) => !('isConnected' in maybeElement) || maybeElement.isConnected;
const cleanupElements = debounce((map) => {
    for (let key of map.keys()) {
        map.set(key, map.get(key).filter(isConnected));
    }
}, 2000);
const stencilSubscription = () => {
    if (typeof _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.g !== 'function') {
        // If we are not in a stencil project, we do nothing.
        // This function is not really exported by @stencil/core.
        return {};
    }
    const elmsToUpdate = new Map();
    return {
        dispose: () => elmsToUpdate.clear(),
        get: (propName) => {
            const elm = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.g)();
            if (elm) {
                appendToMap(elmsToUpdate, propName, elm);
            }
        },
        set: (propName) => {
            const elements = elmsToUpdate.get(propName);
            if (elements) {
                elmsToUpdate.set(propName, elements.filter(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.f));
            }
            cleanupElements(elmsToUpdate);
        },
        reset: () => {
            elmsToUpdate.forEach((elms) => elms.forEach(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.f));
            cleanupElements(elmsToUpdate);
        },
    };
};

const unwrap = (val) => (typeof val === 'function' ? val() : val);
const createObservableMap = (defaultState, shouldUpdate = (a, b) => a !== b) => {
    const unwrappedState = unwrap(defaultState);
    let states = new Map(Object.entries(unwrappedState !== null && unwrappedState !== void 0 ? unwrappedState : {}));
    const handlers = {
        dispose: [],
        get: [],
        set: [],
        reset: [],
    };
    const reset = () => {
        var _a;
        // When resetting the state, the default state may be a function - unwrap it to invoke it.
        // otherwise, the state won't be properly reset
        states = new Map(Object.entries((_a = unwrap(defaultState)) !== null && _a !== void 0 ? _a : {}));
        handlers.reset.forEach((cb) => cb());
    };
    const dispose = () => {
        // Call first dispose as resetting the state would
        // cause less updates ;)
        handlers.dispose.forEach((cb) => cb());
        reset();
    };
    const get = (propName) => {
        handlers.get.forEach((cb) => cb(propName));
        return states.get(propName);
    };
    const set = (propName, value) => {
        const oldValue = states.get(propName);
        if (shouldUpdate(value, oldValue, propName)) {
            states.set(propName, value);
            handlers.set.forEach((cb) => cb(propName, value, oldValue));
        }
    };
    const state = (typeof Proxy === 'undefined'
        ? {}
        : new Proxy(unwrappedState, {
            get(_, propName) {
                return get(propName);
            },
            ownKeys(_) {
                return Array.from(states.keys());
            },
            getOwnPropertyDescriptor() {
                return {
                    enumerable: true,
                    configurable: true,
                };
            },
            has(_, propName) {
                return states.has(propName);
            },
            set(_, propName, value) {
                set(propName, value);
                return true;
            },
        }));
    const on = (eventName, callback) => {
        handlers[eventName].push(callback);
        return () => {
            removeFromArray(handlers[eventName], callback);
        };
    };
    const onChange = (propName, cb) => {
        const unSet = on('set', (key, newValue) => {
            if (key === propName) {
                cb(newValue);
            }
        });
        // We need to unwrap the defaultState because it might be a function.
        // Otherwise we might not be sending the right reset value.
        const unReset = on('reset', () => cb(unwrap(defaultState)[propName]));
        return () => {
            unSet();
            unReset();
        };
    };
    const use = (...subscriptions) => {
        const unsubs = subscriptions.reduce((unsubs, subscription) => {
            if (subscription.set) {
                unsubs.push(on('set', subscription.set));
            }
            if (subscription.get) {
                unsubs.push(on('get', subscription.get));
            }
            if (subscription.reset) {
                unsubs.push(on('reset', subscription.reset));
            }
            if (subscription.dispose) {
                unsubs.push(on('dispose', subscription.dispose));
            }
            return unsubs;
        }, []);
        return () => unsubs.forEach((unsub) => unsub());
    };
    const forceUpdate = (key) => {
        const oldValue = states.get(key);
        handlers.set.forEach((cb) => cb(key, oldValue, oldValue));
    };
    return {
        state,
        get,
        set,
        on,
        onChange,
        use,
        dispose,
        reset,
        forceUpdate,
    };
};
const removeFromArray = (array, item) => {
    const index = array.indexOf(item);
    if (index >= 0) {
        array[index] = array[array.length - 1];
        array.length--;
    }
};

const createStore = (defaultState, shouldUpdate) => {
    const map = createObservableMap(defaultState, shouldUpdate);
    map.use(stencilSubscription());
    return map;
};




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js":
/*!********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js ***!
  \********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ uiStore),
/* harmony export */   u: () => (/* binding */ uiStoreState)
/* harmony export */ });
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const uiStore = (0,_index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__.c)({
  nextText: "next",
  workflow: "content",
  scale: "m",
  disableScroll: false,
  featureFlags: { tileLayer3dTiles: false }
});
const uiStoreState = uiStore.state;




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWI0MGJkOS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ3VEOztBQUV2RCxxQkFBcUIscURBQVc7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRWdHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3BCaEc7QUFDQTtBQUNBO0FBQ0E7QUFDaUY7QUFDdEI7QUFDQztBQUNQO0FBQ3hCOztBQUU3QiwyRkFBMkYsa0JBQWtCLHdCQUF3QixtQkFBbUIsdUJBQXVCLFNBQVMsc0JBQXNCLG1CQUFtQjs7QUFFak87QUFDQTtBQUNBLElBQUkscURBQWdCO0FBQ3BCLDZCQUE2QixxREFBVztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLG9EQUFZO0FBQ3JDLDJCQUEyQixvREFBWTtBQUN2QyxvQkFBb0Isb0RBQVk7QUFDaEMsb0JBQW9CLG9EQUFZO0FBQ2hDLG9CQUFvQixvREFBWTtBQUNoQztBQUNBO0FBQ0E7QUFDQSxvQkFBb0Isb0RBQVk7QUFDaEMsZ0JBQWdCLDhDQUFZO0FBQzVCO0FBQ0E7QUFDQSxZQUFZLE9BQU87QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLG9EQUFpQjtBQUNoRDtBQUNBO0FBQ0EsY0FBYyxxREFBQyw0QkFBNEI7QUFDM0M7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxvREFBWTtBQUNoQixJQUFJLG9EQUFZO0FBQ2hCLElB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Iiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYWRkLWl0ZW0tOTdkNTc3YTkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtc2VsZWN0LW5vc3FsLWNyZWRlbnRpYWxzLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2kxOG4tNjY4NTI0N2YuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vaW5kZXgtODFkNTQ4YjcuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vdWktZWNmODZiYmEuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC04MWQ1NDhiNy5qcyc7XG5cbmNvbnN0IGFkZEl0ZW1TdG9yZSA9IGNyZWF0ZVN0b3JlKHtcbiAgdHlwZUtleXdvcmRzOiBbXSxcbiAgY3VzdG9tUGFyYW1ldGVyczogW10sXG4gIGFuYWx5emVkTG9jYXRpb25UeXBlczogW10sXG4gIGFsbG93U3RvcmVkQXV0aDogdHJ1ZSxcbiAgaXNTZWN1cmVkOiBudWxsLFxuICBjaGVja0F1dGg6IGZhbHNlXG59KTtcbi8vIEVudGlyZSBhZGQgaXRlbSBzdGF0ZSBvYmplY3RcbmNvbnN0IGFkZEl0ZW1TdGF0ZSA9IGFkZEl0ZW1TdG9yZS5zdGF0ZTtcbi8vIFN1YnNldHMgb2YgYWRkIGl0ZW0gc3RhdGVcbmNvbnN0IGFkZEl0ZW1SZXF1ZXN0U3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5jb25zdCBhZGRJdGVtVXJsU3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5cbmV4cG9ydCB7IGFkZEl0ZW1TdGF0ZSBhcyBhLCBhZGRJdGVtVXJsU3RhdGUgYXMgYiwgYWRkSXRlbVJlcXVlc3RTdGF0ZSBhcyBjLCBhZGRJdGVtU3RvcmUgYXMgZCB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGggfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcbmltcG9ydCB7IGEgYXMgYWRkSXRlbVN0YXRlIH0gZnJvbSAnLi9hZGQtaXRlbS05N2Q1NzdhOS5qcyc7XG5pbXBvcnQgeyByIGFzIHJlcGxhY2VJMThOU3RyaW5nIH0gZnJvbSAnLi9pMThuLTY2ODUyNDdmLmpzJztcbmltcG9ydCB7IHUgYXMgdWlTdG9yZVN0YXRlIH0gZnJvbSAnLi91aS1lY2Y4NmJiYS5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtODFkNTQ4YjcuanMnO1xuXG5jb25zdCBhcmNnaXNOZXdJdGVtUGFnZXNEYXRhU3RvcmVTZWxlY3ROb3NxbENyZWRlbnRpYWxzQ3NzID0gXCIubm9TcWwtY29ubmVjdGlvbi1jcmVkZW50aWFse21hcmdpbi10b3A6MS41cmVtfS5ub1NxbC1jcmVkZW50aWFsLWlucHV0e21hcmdpbi10b3A6MC4yNXJlbX0ubm9TcWwtY3JlZGVudGlhbC10ZXh0e21hcmdpbjowfS5ub1NxbC1mb290ZXItcGFkZGluZ3ttYXJnaW4tYm90dG9tOjJyZW19XCI7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1QYWdlc0RhdGFTdG9yZVNlbGVjdE5vc3FsQ3JlZGVudGlhbHMgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1VcGRhdGVQYWdlXCIsIDcpO1xuICAgIHRoaXMuaW5wdXRGaWVsZHMgPSBbXG4gICAgICBcImNvbm5lY3Rpb25VcmlcIixcbiAgICAgIFwiZmFsbEJhY2tTZXJ2ZXJzXCIsXG4gICAgICBcInVzZXJuYW1lXCIsXG4gICAgICBcInBhc3N3b3JkXCIsXG4gICAgICBcImRhdGFiYXNlXCJcbiAgICBdO1xuICAgIHRoaXMucmVuZGVyRXJyb3IgPSBmYWxzZTtcbiAgICB0aGlzLmNvbm5lY3Rpb25VcmkgPSBhZGRJdGVtU3RhdGUuY29ubmVjdGlvblVyaSB8fCBcIlwiO1xuICAgIHRoaXMuZmFsbEJhY2tTZXJ2ZXJzID0gYWRkSXRlbVN0YXRlLmZhbGxCYWNrU2VydmVycyB8fCBcIlwiO1xuICAgIHRoaXMudXNlcm5hbWUgPSBhZGRJdGVtU3RhdGUudXNlcm5hbWUgfHwgXCJcIjtcbiAgICB0aGlzLnBhc3N3b3JkID0gYWRkSXRlbVN0YXRlLnBhc3N3b3JkIHx8IFwiXCI7XG4gICAgdGhpcy5kYXRhYmFzZSA9IGFkZEl0ZW1TdGF0ZS5kYXRhYmFzZSB8fCBcIlwiO1xuICAgIHRoaXMuZXJyb3IgPSBbXTtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLnByb3ZpZGVyID0gYWRkSXRlbVN0YXRlLm5vU3FsUHJvdmlkZXI7XG4gICAgdGhpcy5pMThuID0gdWlTdG9yZVN0YXRlLmkxOG4uZGF0YVN0b3JlU2VsZWN0Tm9TcWw7XG4gIH1cbiAgdmFsaWRhdGVJbnB1dHMoKSB7XG4gICAgY29uc3QgeyBpMThuIH0gPSB0aGlzO1xuICAgIGNvbnN0IGVycm9yID0gW107XG4gICAgaWYgKCF0aGlzLmNvbm5lY3Rpb25VcmkpIHtcbiAgICAgIGVycm9yLnB1c2goaTE4bi5jb25uZWN0aW9uVXJpKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLnVzZXJuYW1lKSB7XG4gICAgICBlcnJvci5wdXNoKGkxOG4udXNlcm5hbWUpO1xuICAgIH1cbiAgICBpZiAoIXRoaXMucGFzc3dvcmQpIHtcbiAgICAgIGVycm9yLnB1c2goaTE4bi5wYXNzd29yZCk7XG4gICAgfVxuICAgIGlmICghdGhpcy5kYXRhYmFzZSkge1xuICAgICAgZXJyb3IucHVzaChpMThuLmRhdGFiYXNlKTtcbiAgICB9XG4gICAgdGhpcy5lcnJvciA9IGVycm9yO1xuICB9XG4gIHJlbmRlckVycm9ySXRlbSgpIHtcbiAgICBpZiAodGhpcy5lcnJvciAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gdGhpcy5pMThuLmVycm9yTWVzc2FnZTtcbiAgICAgIGNvbnN0IGVycm9yRGVzY3JpcHRpb24gPSByZXBsYWNlSTE4TlN0cmluZyhlcnJvck1lc3NhZ2UsIHRoaXMuZXJyb3Iuam9pbihcIiwgXCIpLCBcIm1pc3NpbmdGaWVsZHNcIilcbiAgICAgICAgLnJlcGxhY2UoLyhbXixdKikkLywgXCIgXCIgKyB0aGlzLmkxOG4uYW5kICsgXCIkMVwiKVxuICAgICAgICAucmVwbGFjZSgvOi9nLCBcIlwiKTtcbiAgICAgIHJldHVybiAoaChcImFyY2dpcy1uZXctaXRlbS1hbGVydFwiLCB7IGhlYWRpbmc6IHRoaXMuaTE4bi5lcnJvciwgZGVzY3JpcHRpb246IGVycm9yRGVzY3JpcHRpb24sIGFjdGl2ZTogdGhpcy5lcnJvciAhPT0gbnVsbCwgb25BbGVydERpc21pc3M6ICgpID0+IHtcbiAgICAgICAgICB0aGlzLmVycm9yID0gbnVsbDtcbiAgICAgICAgfSB9KSk7XG4gICAgfVxuICB9XG4gIGhhbmRsZU5leHQoKSB7XG4gICAgdGhpcy52YWxpZGF0ZUlucHV0cygpO1xuICAgIGlmICh0aGlzLmVycm9yLmxlbmd0aCkge1xuICAgICAgdGhpcy5yZW5kZXJFcnJvciA9IHRydWU7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMucmVuZGVyRXJyb3IgPSBmYWxzZTtcbiAgICBhZGRJdGVtU3RhdGUuY29ubmVjdGlvblVyaSA9IHRoaXMuY29ubmVjdGlvblVyaTtcbiAgICBhZGRJdGVtU3RhdGUuZmFsbEJhY2tTZXJ2ZXJzID0gdGhpcy5mYWxsQmFja1NlcnZlcnM7XG4gICAgYWRkSXRlbVN0YXRlLnVzZXJuYW1lID0gdGhpcy51c2VybmFtZTtcbiAgICBhZGRJdGVtU3RhdGUucGFzc3dvcmQgPSB0aGlzLnBhc3N3b3JkO1xuICAgIGFkZEl0ZW1TdGF0ZS5kYXRhYmFzZSA9IHRoaXMuZGF0YWJhc2U7XG4gICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiZGF0YVN0b3JlU2VsZWN0U2VydmVyTGlzdFwiKTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBwcm92aWRlciwgaTE4biwgaW5wdXRGaWVsZHMgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIG51bGwsIGgoXCJhcmNnaXMtbmV3LWl0ZW0tZGVzY3JpcHRpb25cIiwgeyBoZWFkZXI6IGkxOG4uY3JlZGVudGlhbERlc2NyaXB0aW9uIH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwibm9TcWwtY29ubmVjdGlvbi1jcmVkZW50aWFsXCIgfSwgaChcInBcIiwgeyBjbGFzczogXCJub1NxbC1jcmVkZW50aWFsLXRleHRcIiB9LCBpMThuLnByb3ZpZGVyKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyBjbGFzczogXCJub1NxbC1jcmVkZW50aWFsLWlucHV0XCIsIHZhbHVlOiBwcm92aWRlciwgZGlzYWJsZWQ6IHRydWUgfSkpLCBpbnB1dEZpZWxkcy5tYXAoKHR5cGUsIGluZGV4KSA9PiB7XG4gICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBrZXk6IHR5cGUgfSwgaChcInBcIiwgeyBjbGFzczogXCJub1NxbC1jcmVkZW50aWFsLXRleHRcIiB9LCBpMThuW3R5cGVdKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyBjbGFzczoge1xuICAgICAgICAgIFwibm9TcWwtY3JlZGVudGlhbC1pbnB1dFwiOiB0cnVlLFxuICAgICAgICAgIFwibm9TcWwtZm9vdGVyLXBhZGRpbmdcIjogaW5kZXggPT09IGlucHV0RmllbGRzLmxlbmd0aCAtIDFcbiAgICAgICAgfSwgdmFsdWU6IHRoaXNbdHlwZV0sIHR5cGU6IHR5cGUgPT09IFwicGFzc3dvcmRcIiA/IFwicGFzc3dvcmRcIiA6IFwidGV4dFwiLCBvbkNhbGNpdGVJbnB1dENoYW5nZTogKGUpID0+IHtcbiAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgIHRoaXNbdHlwZV0gPSBuZXdWYWx1ZTtcbiAgICAgICAgfSB9KSwgaTE4bltgJHt0eXBlfUV4YW1wbGVgXSA/IChoKFwicFwiLCB7IGNsYXNzOiBcIm5vU3FsLWNyZWRlbnRpYWwtdGV4dFwiIH0sIGkxOG5bYCR7dHlwZX1FeGFtcGxlYF0pKSA6IG51bGwpKSk7XG4gICAgfSkpLCB0aGlzLnJlbmRlckVycm9yID8gdGhpcy5yZW5kZXJFcnJvckl0ZW0oKSA6IG51bGwpKTtcbiAgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc0RhdGFTdG9yZVNlbGVjdE5vc3FsQ3JlZGVudGlhbHMuc3R5bGUgPSBhcmNnaXNOZXdJdGVtUGFnZXNEYXRhU3RvcmVTZWxlY3ROb3NxbENyZWRlbnRpYWxzQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNOZXdJdGVtUGFnZXNEYXRhU3RvcmVTZWxlY3ROb3NxbENyZWRlbnRpYWxzIGFzIGFyY2dpc19uZXdfaXRlbV9wYWdlc19kYXRhX3N0b3JlX3NlbGVjdF9ub3NxbF9jcmVkZW50aWFscyB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5jb25zdCByZWdleExvb2t1cE1hcCA9IHtcbiAgZmlsZU5hbWU6IC9cXCRcXHtmaWxlTmFtZVxcfS9nLFxuICBmaWxlVHlwZTogL1xcJFxce3R5cGVcXH0vZyxcbiAgdHlwZUxpc3Q6IC9cXCRcXHt0eXBlTGlzdFxcfS9nLFxuICBtaXNzaW5nRmllbGRzOiAvXFwkXFx7XFxtaXNzaW5nRmllbGRzXFx9L2dcbn07XG5jb25zdCByZXBsYWNlSTE4TlN0cmluZyA9IChzdHIsIHJlcGxhY2VtZW50U3RyaW5nLCB0eXBlKSA9PiB7XG4gIGNvbnN0IHR5cGVSZWdFeCA9IG5ldyBSZWdFeHAocmVnZXhMb29rdXBNYXBbdHlwZV0pO1xuICByZXR1cm4gc3RyID09PSBudWxsIHx8IHN0ciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3RyLnJlcGxhY2UodHlwZVJlZ0V4LCByZXBsYWNlbWVudFN0cmluZyk7XG59O1xuXG5leHBvcnQgeyByZXBsYWNlSTE4TlN0cmluZyBhcyByIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGcgYXMgZ2V0UmVuZGVyaW5nUmVmLCBmIGFzIGZvcmNlVXBkYXRlIH0gZnJvbSAnLi9pbmRleC05MmViYjM5Ni5qcyc7XG5cbmNvbnN0IGFwcGVuZFRvTWFwID0gKG1hcCwgcHJvcE5hbWUsIHZhbHVlKSA9PiB7XG4gICAgY29uc3QgaXRlbXMgPSBtYXAuZ2V0KHByb3BOYW1lKTtcbiAgICBpZiAoIWl0ZW1zKSB7XG4gICAgICAgIG1hcC5zZXQocHJvcE5hbWUsIFt2YWx1ZV0pO1xuICAgIH1cbiAgICBlbHNlIGlmICghaXRlbXMuaW5jbHVkZXModmFsdWUpKSB7XG4gICAgICAgIGl0ZW1zLnB1c2godmFsdWUpO1xuICAgIH1cbn07XG5jb25zdCBkZWJvdW5jZSA9IChmbiwgbXMpID0+IHtcbiAgICBsZXQgdGltZW91dElkO1xuICAgIHJldHVybiAoLi4uYXJncykgPT4ge1xuICAgICAgICBpZiAodGltZW91dElkKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgICAgfVxuICAgICAgICB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHRpbWVvdXRJZCA9IDA7XG4gICAgICAgICAgICBmbiguLi5hcmdzKTtcbiAgICAgICAgfSwgbXMpO1xuICAgIH07XG59O1xuXG4vKipcbiAqIENoZWNrIGlmIGEgcG9zc2libGUgZWxlbWVudCBpc0Nvbm5lY3RlZC5cbiAqIFRoZSBwcm9wZXJ0eSBtaWdodCBub3QgYmUgdGhlcmUsIHNvIHdlIGNoZWNrIGZvciBpdC5cbiAqXG4gKiBXZSB3YW50IGl0IHRvIHJldHVybiB0cnVlIGlmIGlzQ29ubmVjdGVkIGlzIG5vdCBhIHByb3BlcnR5LFxuICogb3RoZXJ3aXNlIHdlIHdvdWxkIHJlbW92ZSB0aGVzZSBlbGVtZW50cyBhbmQgd291bGQgbm90IHVwZGF0ZS5cbiAqXG4gKiBCZXR0ZXIgbGVhayBpbiBFZGdlIHRoYW4gdG8gYmUgdXNlbGVzcy5cbiAqL1xuY29uc3QgaXNDb25uZWN0ZWQgPSAobWF5YmVFbGVtZW50KSA9PiAhKCdpc0Nvbm5lY3RlZCcgaW4gbWF5YmVFbGVtZW50KSB8fCBtYXliZUVsZW1lbnQuaXNDb25uZWN0ZWQ7XG5jb25zdCBjbGVhbnVwRWxlbWVudHMgPSBkZWJvdW5jZSgobWFwKSA9PiB7XG4gICAgZm9yIChsZXQga2V5IG9mIG1hcC5rZXlzKCkpIHtcbiAgICAgICAgbWFwLnNldChrZXksIG1hcC5nZXQoa2V5KS5maWx0ZXIoaXNDb25uZWN0ZWQpKTtcbiAgICB9XG59LCAyMDAwKTtcbmNvbnN0IHN0ZW5jaWxTdWJzY3JpcHRpb24gPSAoKSA9PiB7XG4gICAgaWYgKHR5cGVvZiBnZXRSZW5kZXJpbmdSZWYgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgLy8gSWYgd2UgYXJlIG5vdCBpbiBhIHN0ZW5jaWwgcHJvamVjdCwgd2UgZG8gbm90aGluZy5cbiAgICAgICAgLy8gVGhpcyBmdW5jdGlvbiBpcyBub3QgcmVhbGx5IGV4cG9ydGVkIGJ5IEBzdGVuY2lsL2NvcmUuXG4gICAgICAgIHJldHVybiB7fTtcbiAgICB9XG4gICAgY29uc3QgZWxtc1RvVXBkYXRlID0gbmV3IE1hcCgpO1xuICAgIHJldHVybiB7XG4gICAgICAgIGRpc3Bvc2U6ICgpID0+IGVsbXNUb1VwZGF0ZS5jbGVhcigpLFxuICAgICAgICBnZXQ6IChwcm9wTmFtZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZWxtID0gZ2V0UmVuZGVyaW5nUmVmKCk7XG4gICAgICAgICAgICBpZiAoZWxtKSB7XG4gICAgICAgICAgICAgICAgYXBwZW5kVG9NYXAoZWxtc1RvVXBkYXRlLCBwcm9wTmFtZSwgZWxtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiAocHJvcE5hbWUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRzID0gZWxtc1RvVXBkYXRlLmdldChwcm9wTmFtZSk7XG4gICAgICAgICAgICBpZiAoZWxlbWVudHMpIHtcbiAgICAgICAgICAgICAgICBlbG1zVG9VcGRhdGUuc2V0KHByb3BOYW1lLCBlbGVtZW50cy5maWx0ZXIoZm9yY2VVcGRhdGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNsZWFudXBFbGVtZW50cyhlbG1zVG9VcGRhdGUpO1xuICAgICAgICB9LFxuICAgICAgICByZXNldDogKCkgPT4ge1xuICAgICAgICAgICAgZWxtc1RvVXBkYXRlLmZvckVhY2goKGVsbXMpID0+IGVsbXMuZm9yRWFjaChmb3JjZVVwZGF0ZSkpO1xuICAgICAgICAgICAgY2xlYW51cEVsZW1lbnRzKGVsbXNUb1VwZGF0ZSk7XG4gICAgICAgIH0sXG4gICAgfTtcbn07XG5cbmNvbnN0IHVud3JhcCA9ICh2YWwpID0+ICh0eXBlb2YgdmFsID09PSAnZnVuY3Rpb24nID8gdmFsKCkgOiB2YWwpO1xuY29uc3QgY3JlYXRlT2JzZXJ2YWJsZU1hcCA9IChkZWZhdWx0U3RhdGUsIHNob3VsZFVwZGF0ZSA9IChhLCBiKSA9PiBhICE9PSBiKSA9PiB7XG4gICAgY29uc3QgdW53cmFwcGVkU3RhdGUgPSB1bndyYXAoZGVmYXVsdFN0YXRlKTtcbiAgICBsZXQgc3RhdGVzID0gbmV3IE1hcChPYmplY3QuZW50cmllcyh1bndyYXBwZWRTdGF0ZSAhPT0gbnVsbCAmJiB1bndyYXBwZWRTdGF0ZSAhPT0gdm9pZCAwID8gdW53cmFwcGVkU3RhdGUgOiB7fSkpO1xuICAgIGNvbnN0IGhhbmRsZXJzID0ge1xuICAgICAgICBkaXNwb3NlOiBbXSxcbiAgICAgICAgZ2V0OiBbXSxcbiAgICAgICAgc2V0OiBbXSxcbiAgICAgICAgcmVzZXQ6IFtdLFxuICAgIH07XG4gICAgY29uc3QgcmVzZXQgPSAoKSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgLy8gV2hlbiByZXNldHRpbmcgdGhlIHN0YXRlLCB0aGUgZGVmYXVsdCBzdGF0ZSBtYXkgYmUgYSBmdW5jdGlvbiAtIHVud3JhcCBpdCB0byBpbnZva2UgaXQuXG4gICAgICAgIC8vIG90aGVyd2lzZSwgdGhlIHN0YXRlIHdvbid0IGJlIHByb3Blcmx5IHJlc2V0XG4gICAgICAgIHN0YXRlcyA9IG5ldyBNYXAoT2JqZWN0LmVudHJpZXMoKF9hID0gdW53cmFwKGRlZmF1bHRTdGF0ZSkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHt9KSk7XG4gICAgICAgIGhhbmRsZXJzLnJlc2V0LmZvckVhY2goKGNiKSA9PiBjYigpKTtcbiAgICB9O1xuICAgIGNvbnN0IGRpc3Bvc2UgPSAoKSA9PiB7XG4gICAgICAgIC8vIENhbGwgZmlyc3QgZGlzcG9zZSBhcyByZXNldHRpbmcgdGhlIHN0YXRlIHdvdWxkXG4gICAgICAgIC8vIGNhdXNlIGxlc3MgdXBkYXRlcyA7KVxuICAgICAgICBoYW5kbGVycy5kaXNwb3NlLmZvckVhY2goKGNiKSA9PiBjYigpKTtcbiAgICAgICAgcmVzZXQoKTtcbiAgICB9O1xuICAgIGNvbnN0IGdldCA9IChwcm9wTmFtZSkgPT4ge1xuICAgICAgICBoYW5kbGVycy5nZXQuZm9yRWFjaCgoY2IpID0+IGNiKHByb3BOYW1lKSk7XG4gICAgICAgIHJldHVybiBzdGF0ZXMuZ2V0KHByb3BOYW1lKTtcbiAgICB9O1xuICAgIGNvbnN0IHNldCA9IChwcm9wTmFtZSwgdmFsdWUpID0+IHtcbiAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSBzdGF0ZXMuZ2V0KHByb3BOYW1lKTtcbiAgICAgICAgaWYgKHNob3VsZFVwZGF0ZSh2YWx1ZSwgb2xkVmFsdWUsIHByb3BOYW1lKSkge1xuICAgICAgICAgICAgc3RhdGVzLnNldChwcm9wTmFtZSwgdmFsdWUpO1xuICAgICAgICAgICAgaGFuZGxlcnMuc2V0LmZvckVhY2goKGNiKSA9PiBjYihwcm9wTmFtZSwgdmFsdWUsIG9sZFZhbHVlKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IHN0YXRlID0gKHR5cGVvZiBQcm94eSA9PT0gJ3VuZGVmaW5lZCdcbiAgICAgICAgPyB7fVxuICAgICAgICA6IG5ldyBQcm94eSh1bndyYXBwZWRTdGF0ZSwge1xuICAgICAgICAgICAgZ2V0KF8sIHByb3BOYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldChwcm9wTmFtZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3duS2V5cyhfKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEFycmF5LmZyb20oc3RhdGVzLmtleXMoKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhhcyhfLCBwcm9wTmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZXMuaGFzKHByb3BOYW1lKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXQoXywgcHJvcE5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgc2V0KHByb3BOYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KSk7XG4gICAgY29uc3Qgb24gPSAoZXZlbnROYW1lLCBjYWxsYmFjaykgPT4ge1xuICAgICAgICBoYW5kbGVyc1tldmVudE5hbWVdLnB1c2goY2FsbGJhY2spO1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgcmVtb3ZlRnJvbUFycmF5KGhhbmRsZXJzW2V2ZW50TmFtZV0sIGNhbGxiYWNrKTtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGNvbnN0IG9uQ2hhbmdlID0gKHByb3BOYW1lLCBjYikgPT4ge1xuICAgICAgICBjb25zdCB1blNldCA9IG9uKCdzZXQnLCAoa2V5LCBuZXdWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGtleSA9PT0gcHJvcE5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYihuZXdWYWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBXZSBuZWVkIHRvIHVud3JhcCB0aGUgZGVmYXVsdFN0YXRlIGJlY2F1c2UgaXQgbWlnaHQgYmUgYSBmdW5jdGlvbi5cbiAgICAgICAgLy8gT3RoZXJ3aXNlIHdlIG1pZ2h0IG5vdCBiZSBzZW5kaW5nIHRoZSByaWdodCByZXNldCB2YWx1ZS5cbiAgICAgICAgY29uc3QgdW5SZXNldCA9IG9uKCdyZXNldCcsICgpID0+IGNiKHVud3JhcChkZWZhdWx0U3RhdGUpW3Byb3BOYW1lXSkpO1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgdW5TZXQoKTtcbiAgICAgICAgICAgIHVuUmVzZXQoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGNvbnN0IHVzZSA9ICguLi5zdWJzY3JpcHRpb25zKSA9PiB7XG4gICAgICAgIGNvbnN0IHVuc3VicyA9IHN1YnNjcmlwdGlvbnMucmVkdWNlKCh1bnN1YnMsIHN1YnNjcmlwdGlvbikgPT4ge1xuICAgICAgICAgICAgaWYgKHN1YnNjcmlwdGlvbi5zZXQpIHtcbiAgICAgICAgICAgICAgICB1bnN1YnMucHVzaChvbignc2V0Jywgc3Vic2NyaXB0aW9uLnNldCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN1YnNjcmlwdGlvbi5nZXQpIHtcbiAgICAgICAgICAgICAgICB1bnN1YnMucHVzaChvbignZ2V0Jywgc3Vic2NyaXB0aW9uLmdldCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN1YnNjcmlwdGlvbi5yZXNldCkge1xuICAgICAgICAgICAgICAgIHVuc3Vicy5wdXNoKG9uKCdyZXNldCcsIHN1YnNjcmlwdGlvbi5yZXNldCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN1YnNjcmlwdGlvbi5kaXNwb3NlKSB7XG4gICAgICAgICAgICAgICAgdW5zdWJzLnB1c2gob24oJ2Rpc3Bvc2UnLCBzdWJzY3JpcHRpb24uZGlzcG9zZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHVuc3VicztcbiAgICAgICAgfSwgW10pO1xuICAgICAgICByZXR1cm4gKCkgPT4gdW5zdWJzLmZvckVhY2goKHVuc3ViKSA9PiB1bnN1YigpKTtcbiAgICB9O1xuICAgIGNvbnN0IGZvcmNlVXBkYXRlID0gKGtleSkgPT4ge1xuICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IHN0YXRlcy5nZXQoa2V5KTtcbiAgICAgICAgaGFuZGxlcnMuc2V0LmZvckVhY2goKGNiKSA9PiBjYihrZXksIG9sZFZhbHVlLCBvbGRWYWx1ZSkpO1xuICAgIH07XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdGUsXG4gICAgICAgIGdldCxcbiAgICAgICAgc2V0LFxuICAgICAgICBvbixcbiAgICAgICAgb25DaGFuZ2UsXG4gICAgICAgIHVzZSxcbiAgICAgICAgZGlzcG9zZSxcbiAgICAgICAgcmVzZXQsXG4gICAgICAgIGZvcmNlVXBkYXRlLFxuICAgIH07XG59O1xuY29uc3QgcmVtb3ZlRnJvbUFycmF5ID0gKGFycmF5LCBpdGVtKSA9PiB7XG4gICAgY29uc3QgaW5kZXggPSBhcnJheS5pbmRleE9mKGl0ZW0pO1xuICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICAgIGFycmF5W2luZGV4XSA9IGFycmF5W2FycmF5Lmxlbmd0aCAtIDFdO1xuICAgICAgICBhcnJheS5sZW5ndGgtLTtcbiAgICB9XG59O1xuXG5jb25zdCBjcmVhdGVTdG9yZSA9IChkZWZhdWx0U3RhdGUsIHNob3VsZFVwZGF0ZSkgPT4ge1xuICAgIGNvbnN0IG1hcCA9IGNyZWF0ZU9ic2VydmFibGVNYXAoZGVmYXVsdFN0YXRlLCBzaG91bGRVcGRhdGUpO1xuICAgIG1hcC51c2Uoc3RlbmNpbFN1YnNjcmlwdGlvbigpKTtcbiAgICByZXR1cm4gbWFwO1xufTtcblxuZXhwb3J0IHsgY3JlYXRlU3RvcmUgYXMgYyB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC04MWQ1NDhiNy5qcyc7XG5cbmNvbnN0IHVpU3RvcmUgPSBjcmVhdGVTdG9yZSh7XG4gIG5leHRUZXh0OiBcIm5leHRcIixcbiAgd29ya2Zsb3c6IFwiY29udGVudFwiLFxuICBzY2FsZTogXCJtXCIsXG4gIGRpc2FibGVTY3JvbGw6IGZhbHNlLFxuICBmZWF0dXJlRmxhZ3M6IHsgdGlsZUxheWVyM2RUaWxlczogZmFsc2UgfVxufSk7XG5jb25zdCB1aVN0b3JlU3RhdGUgPSB1aVN0b3JlLnN0YXRlO1xuXG5leHBvcnQgeyB1aVN0b3JlIGFzIGEsIHVpU3RvcmVTdGF0ZSBhcyB1IH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=