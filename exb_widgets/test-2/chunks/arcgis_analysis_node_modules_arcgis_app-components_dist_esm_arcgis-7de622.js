"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-7de622"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js":
/*!**************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addItemState),
/* harmony export */   b: () => (/* binding */ addItemUrlState),
/* harmony export */   c: () => (/* binding */ addItemRequestState),
/* harmony export */   d: () => (/* binding */ addItemStore)
/* harmony export */ });
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const addItemStore = (0,_index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__.c)({
  typeKeywords: [],
  customParameters: [],
  analyzedLocationTypes: [],
  allowStoredAuth: true,
  isSecured: null,
  checkAuth: false
});
// Entire add item state object
const addItemState = addItemStore.state;
// Subsets of add item state
const addItemRequestState = addItemStore.state;
const addItemUrlState = addItemStore.state;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-notebook-runtime-select.entry.js":
/*!*********************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-notebook-runtime-select.entry.js ***!
  \*********************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_notebook_runtime_select: () => (/* binding */ ArcgisNotebookRuntimeSelect)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./privileges-35590eb4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-35590eb4.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */













async function getNotebookServer() {
  const { config, portal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_3__.c;
  return new Promise(async (resolve, reject) => {
    var _a, _b;
    if (!portal.isPortal) {
      const result = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_5__.r)(`${config.restBaseUrl}/portals/self/urls`);
      const url = (_b = (_a = result === null || result === void 0 ? void 0 : result.urls) === null || _a === void 0 ? void 0 : _a.notebooks) === null || _b === void 0 ? void 0 : _b.https;
      if (url) {
        return resolve({ url: `https://${url}`, adminContext: "" });
      }
    }
    else {
      if (config.userInfo) {
        portal.getFederatedServers().then((result) => {
          var _a;
          if ((_a = result === null || result === void 0 ? void 0 : result.servers) === null || _a === void 0 ? void 0 : _a.length) {
            const serversFilterResult = result.servers.filter(({ serverType, serverFunction }) => serverType === "ARCGIS_NOTEBOOK_SERVER" && serverFunction === "NotebookServer");
            if (serversFilterResult.length) {
              const notebookServer = serversFilterResult[0];
              notebookServer.adminContext = "/admin";
              return resolve(notebookServer);
            }
          }
        }, (error) => {
          reject(error);
        });
      }
      else
        reject();
    }
  });
}
function getNotebookRuntimesBase(url) {
  const options = {
    useJsonFormatParam: true,
    useCredentials: true
  };
  return notebookRequest(`${url}/admin/notebooks/runtimes`, "GET", null, options);
}
async function getCurrentRuntimeVersion(url) {
  const options = {
    useJsonFormatParam: true,
    useCredentials: true
  };
  const info = await notebookRequest(`${url}/rest/info`, "GET", null, options);
  return info.currentRuntimeVersion;
}
function formatNotebookRuntimeVersion(version) {
  const versionMap = {
    "10.7": "1.0",
    "10.7.0": "1.0",
    "10.7.1": "2.0",
    "10.8": "3.0",
    "10.8.0": "3.0",
    "10.8.1": "4.0"
  };
  return versionMap[version] || version;
}
function processRuntimes(runtimes = [], currentRuntimeVersion) {
  const { user } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_3__.c;
  const canCreateAdvanced = (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_6__.s)(user);
  return (runtimes
    // list esri provided runtimes first
    .sort((a, b) => (a.esriProvidedRuntime === b.esriProvidedRuntime ? 0 : a.esriProvidedRuntime ? -1 : 1))
    .filter((runtime) => {
    // filter our advanced notebooks for those that can't use them
    if (!canCreateAdvanced && runtime.requiresAdvancedPrivileges) {
      return false;
    }
    // only show current version or custom runtimes
    const currentVersion = formatNotebookRuntimeVersion(currentRuntimeVersion) === formatNotebookRuntimeVersion(runtime.version);
    return currentVersion || !runtime.esriProvidedRuntime;
  }));
}
async function getNotebookRuntimes() {
  var _a;
  const { url } = await getNotebookServer();
  const currentRuntimeVersion = await getCurrentRuntimeVersion(url);
  const runtimeInfo = await getNotebookRuntimesBase(url);
  if ((_a = runtimeInfo === null || runtimeInfo === void 0 ? void 0 : runtimeInfo.runtimes) === null || _a === void 0 ? void 0 : _a.length) {
    return processRuntimes(runtimeInfo.runtimes, currentRuntimeVersion);
  }
  return null;
}
function notebookServerConfigured() {
  var _a;
  const { config, portal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_3__.c;
  if (portal.isPortal) {
    // On-Prem
    return config.notebookServerEnabled && portal.supportsHostedNotebooks ? true : false;
  }
  else {
    // AGOL
    const blacklistedOrgTypes = ["Trial Developer", "Trial", "Trial Press", "Developer Subscription"];
    const hasBlacklistedOrgType = blacklistedOrgTypes.indexOf((_a = portal.subscriptionInfo) === null || _a === void 0 ? void 0 : _a.type) !== -1;
    return (config.notebookServerEnabled &&
      (!hasBlacklistedOrgType || ((portal === null || portal === void 0 ? void 0 : portal.allowedBetaFeatures) || []).indexOf("notebooks") !== -1));
  }
}
function canShowNotebookSelection() {
  const { user } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_3__.c;
  return notebookServerConfigured() && (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_6__.r)(user);
}
async function notebookRequest(url, method, data, options) {
  const [_request] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_4__.l)(["dojo/request"]);
  const { config } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_3__.c;
  options = options || {};
  let query = {};
  const headers = { "X-Requested-With": null };
  const token = config.userInfo ? config.userInfo.token : null;
  // This is needed because notebook server expects an f parameter
  // otherwise we get 'method not allowed'
  if (options.useJsonFormatParam) {
    query.f = "json";
  }
  if (method === "GET") {
    query = Object.assign(Object.assign({}, query), data);
  }
  if (!options.bypassCustomHeaders) {
    headers["X-Esri-Authorization"] = "Bearer " + token;
    if (options.useJsonBody) {
      headers["Content-Type"] = "application/json";
    }
  }
  if (options.contentType) {
    headers["Content-Type"] = options.contentType;
  }
  const requestOptions = {
    data: options.useJsonBody ? (data ? JSON.stringify(data) : null) : data,
    method: method,
    handleAs: "json",
    headers: Object.keys(headers).length ? headers : null,
    query: Object.keys(query).length ? query : null,
    preventCache: options.preventCache === false ? false : true,
    withCredentials: !options.bypassCustomHeaders ? true : false
  };
  return _request(url, requestOptions);
}

const arcgisNotebookRuntimeSelectCss = ":host{--arcgis-label-font-weight:400}.label{margin-top:0;margin-bottom:0;font-weight:var(--arcgis-label-font-weight)}.label--bold{--arcgis-label-font-weight:500}.loader{color:var(--calcite-ui-brand)}.leader-text{font-size:0.875rem;color:var(--calcite-ui-text-1)}";

const ArcgisNotebookRuntimeSelect = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.handleRuntimeChange = (e) => {
      const value = e.currentTarget.selectedOption.value;
      const i = parseInt(value, 10) || 0;
      this.selectedRuntimeIndex = i;
      this.updateProperties(this.runtimes[i]);
    };
    this.i18n = undefined;
    this.runtimes = undefined;
    this.loading = true;
    this.error = false;
    this.selectedRuntimeIndex = 0;
  }
  async componentWillLoad() {
    const locale = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.el);
    this.i18n = locale[0];
  }
  async componentDidLoad() {
    try {
      if (!canShowNotebookSelection())
        return;
      const runtimes = await getNotebookRuntimes();
      this.runtimes = runtimes;
      if (!runtimes || !runtimes.length) {
        throw new Error();
      }
      this.updateProperties(runtimes[0]);
    }
    catch (error) {
      this.error = true;
    }
    this.loading = false;
  }
  updateProperties(runtime) {
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_2__.a.properties = {
      notebookRuntimeName: runtime.name,
      notebookRuntimeVersion: formatNotebookRuntimeVersion(runtime.version)
    };
  }
  render() {
    const { i18n, selectedRuntimeIndex } = this;
    if (!canShowNotebookSelection())
      return null;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label" }, i18n.selectRuntime), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { icon: true, open: this.error, scale: "s", kind: "danger" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, i18n.error.title), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, i18n.error.runtimes)), this.loading ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { class: "loader", inline: true, label: i18n.loadingRuntimes }), " ", i18n.loadingRuntimes)) : (!this.error && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: i18n.selectRuntime, onCalciteSelectChange: this.handleRuntimeChange }, this.runtimes.map((runtime, i) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: i, selected: selectedRuntimeIndex === i }, runtime.name, " - ", runtime.version))))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNotebookRuntimeSelect.style = arcgisNotebookRuntimeSelectCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



const languageMap = new Map([
  ["ar", "ar"],
  ["bg", "bg"],
  ["bs", "bs"],
  ["ca", "ca"],
  ["cs", "cs"],
  ["da", "da"],
  ["de", "de"],
  ["el", "el"],
  ["en", "en"],
  ["es", "es"],
  ["et", "et"],
  ["fi", "fi"],
  ["fr", "fr"],
  ["he", "he"],
  ["hr", "hr"],
  ["hu", "hu"],
  ["id", "id"],
  ["it", "it"],
  ["ja", "ja"],
  ["ko", "ko"],
  ["lt", "lt"],
  ["lv", "lv"],
  ["nb", "nb"],
  ["nl", "nl"],
  ["pl", "pl"],
  ["pt-br", "pt-BR"],
  ["pt-pt", "pt-PT"],
  ["ro", "ro"],
  ["ru", "ru"],
  ["sk", "sk"],
  ["sl", "sl"],
  ["sr", "sr"],
  ["sv", "sv"],
  ["th", "th"],
  ["tr", "tr"],
  ["uk", "uk"],
  ["vi", "vi"],
  ["zh-cn", "zh-CN"],
  ["zh-hk", "zh-HK"],
  ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
  return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
  const closestWithProp = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
  return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
  rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
  const { api, type, places } = options || {};
  if (api === 4) {
    const [intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
    const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
      places,
      style: type,
      digitSeparator: true
    });
    return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
  }
  const [dojoNumber] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
  return dojoNumber.format(number, {
    type,
    places,
    pattern: options === null || options === void 0 ? void 0 : options.pattern
  });
}
const cache = {};
function formatDate(date) {
  const lang = document.documentElement.lang;
  const dayShortMonthYear = {
    year: "numeric",
    month: "short",
    day: "numeric"
  };
  if (!cache[lang]) {
    cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
  }
  return cache[lang].format(date);
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
  var _a, _b, _c;
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    // "ru-RU" maps to "ru" use case
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
    }
    else {
      return "en";
    }
  }
}
function getComponentClosestLanguageIntl(element) {
  var _a, _b, _c;
  // it's OK if we don't have the 4 letter language file for it
  // 4 letter language code needed for formatting numbers
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      // we support the 2 letter coded language
      // e.g. it-CH vs it
      return lang;
    }
    else {
      return "en";
    }
  }
}
function fetchLocaleStringsForComponent(componentName, locale) {
  return new Promise((resolve, reject) => {
    fetch((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
      if (result.ok)
        resolve(result.json());
      else
        reject();
    }, () => reject());
  });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
  const id = `${componentName}${locale}`;
  if (!stringCache[id]) {
    stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
  }
  return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
  const componentName = tagName || element.tagName.toLowerCase();
  const componentLanguage = getComponentClosestLanguage(element);
  const componentLanguageIntl = getComponentClosestLanguageIntl(element);
  let strings;
  try {
    strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
  }
  catch (e) {
    console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
    strings = await fetchLocaleStringsFromCache(componentName, "en");
  }
  return [strings, componentLanguage, componentLanguageIntl];
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTdkZTYyMi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ3VEOztBQUV2RCxxQkFBcUIscURBQVc7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRWdHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNwQmhHO0FBQ0E7QUFDQTtBQUNBO0FBQ2dGO0FBQ1Y7QUFDWDtBQUNIO0FBQ0s7QUFDVDtBQUNnRDtBQUN6RTtBQUNTO0FBQ1A7QUFDSztBQUNBOztBQUVsQztBQUNBLFVBQVUsaUJBQWlCLEVBQUUsa0RBQVc7QUFDeEM7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHNEQUFPLElBQUksbUJBQW1CO0FBQ3pEO0FBQ0E7QUFDQSx5QkFBeUIsZ0JBQWdCLElBQUkscUJBQXFCO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUVBQWlFLDRCQUE0QjtBQUM3RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLElBQUk7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLElBQUk7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsT0FBTyxFQUFFLGtEQUFXO0FBQzlCLDRCQUE0QiwwREFBMEI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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VztBQUN0QjtBQUNBO0FBQ0E7QUFDQSxRQUFRLHdEQUFXO0FBQ25CLGFBQWEsd0RBQVc7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsbURBQWlDO0FBQ2hFO0FBQ0E7QUFDQSxNQUFNLHdEQUFXO0FBQ2pCLFdBQVcsd0RBQVc7QUFDdEI7QUFDQTtBQUNBLFFBQVEsd0RBQVc7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUscURBQVksOEJBQThCLGNBQWMsUUFBUSxPQUFPO0FBQ2pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsY0FBYyxFQUFFLE9BQU87QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLGVBQWUsR0FBRyxrQkFBa0I7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7O0FBRTRFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYWRkLWl0ZW0tOTdkNTc3YTkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLW5vdGVib29rLXJ1bnRpbWUtc2VsZWN0LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xhbmd1YWdlVXRpbC0yMjI1OGM5MC5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sb2NhbGUtMTNlMDBhNzUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC04MWQ1NDhiNy5qcyc7XG5cbmNvbnN0IGFkZEl0ZW1TdG9yZSA9IGNyZWF0ZVN0b3JlKHtcbiAgdHlwZUtleXdvcmRzOiBbXSxcbiAgY3VzdG9tUGFyYW1ldGVyczogW10sXG4gIGFuYWx5emVkTG9jYXRpb25UeXBlczogW10sXG4gIGFsbG93U3RvcmVkQXV0aDogdHJ1ZSxcbiAgaXNTZWN1cmVkOiBudWxsLFxuICBjaGVja0F1dGg6IGZhbHNlXG59KTtcbi8vIEVudGlyZSBhZGQgaXRlbSBzdGF0ZSBvYmplY3RcbmNvbnN0IGFkZEl0ZW1TdGF0ZSA9IGFkZEl0ZW1TdG9yZS5zdGF0ZTtcbi8vIFN1YnNldHMgb2YgYWRkIGl0ZW0gc3RhdGVcbmNvbnN0IGFkZEl0ZW1SZXF1ZXN0U3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5jb25zdCBhZGRJdGVtVXJsU3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5cbmV4cG9ydCB7IGFkZEl0ZW1TdGF0ZSBhcyBhLCBhZGRJdGVtVXJsU3RhdGUgYXMgYiwgYWRkSXRlbVJlcXVlc3RTdGF0ZSBhcyBjLCBhZGRJdGVtU3RvcmUgYXMgZCB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGgsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtOTJlYmIzOTYuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIH0gZnJvbSAnLi9sb2NhbGUtMTNlMDBhNzUuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRJdGVtU3RhdGUgfSBmcm9tICcuL2FkZC1pdGVtLTk3ZDU3N2E5LmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy1lYjVmN2RjMi5qcyc7XG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1hYWYzMGJkNi5qcyc7XG5pbXBvcnQgeyByIGFzIHJlcXVlc3QgfSBmcm9tICcuL3BvcnRhbC03OWNhYWVmZi5qcyc7XG5pbXBvcnQgeyByIGFzIGNhbkNyZWF0ZU5vdGVib29rcywgcyBhcyBjYW5DcmVhdGVBZHZhbmNlZE5vdGVib29rcyB9IGZyb20gJy4vcHJpdmlsZWdlcy0zNTU5MGViNC5qcyc7XG5pbXBvcnQgJy4vZG9tLTEzZjViMDBjLmpzJztcbmltcG9ydCAnLi9sYW5ndWFnZVV0aWwtMjIyNThjOTAuanMnO1xuaW1wb3J0ICcuL2luZGV4LTgxZDU0OGI3LmpzJztcbmltcG9ydCAnLi9wcml2aWxlZ2VzLWNjZDVmMzdkLmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLWM4MmY1YWI5LmpzJztcblxuYXN5bmMgZnVuY3Rpb24gZ2V0Tm90ZWJvb2tTZXJ2ZXIoKSB7XG4gIGNvbnN0IHsgY29uZmlnLCBwb3J0YWwgfSA9IGNvbmZpZ1N0YXRlO1xuICByZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIHZhciBfYSwgX2I7XG4gICAgaWYgKCFwb3J0YWwuaXNQb3J0YWwpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlcXVlc3QoYCR7Y29uZmlnLnJlc3RCYXNlVXJsfS9wb3J0YWxzL3NlbGYvdXJsc2ApO1xuICAgICAgY29uc3QgdXJsID0gKF9iID0gKF9hID0gcmVzdWx0ID09PSBudWxsIHx8IHJlc3VsdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzdWx0LnVybHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5ub3RlYm9va3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5odHRwcztcbiAgICAgIGlmICh1cmwpIHtcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoeyB1cmw6IGBodHRwczovLyR7dXJsfWAsIGFkbWluQ29udGV4dDogXCJcIiB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBpZiAoY29uZmlnLnVzZXJJbmZvKSB7XG4gICAgICAgIHBvcnRhbC5nZXRGZWRlcmF0ZWRTZXJ2ZXJzKCkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgIGlmICgoX2EgPSByZXN1bHQgPT09IG51bGwgfHwgcmVzdWx0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXN1bHQuc2VydmVycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3Qgc2VydmVyc0ZpbHRlclJlc3VsdCA9IHJlc3VsdC5zZXJ2ZXJzLmZpbHRlcigoeyBzZXJ2ZXJUeXBlLCBzZXJ2ZXJGdW5jdGlvbiB9KSA9PiBzZXJ2ZXJUeXBlID09PSBcIkFSQ0dJU19OT1RFQk9PS19TRVJWRVJcIiAmJiBzZXJ2ZXJGdW5jdGlvbiA9PT0gXCJOb3RlYm9va1NlcnZlclwiKTtcbiAgICAgICAgICAgIGlmIChzZXJ2ZXJzRmlsdGVyUmVzdWx0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICBjb25zdCBub3RlYm9va1NlcnZlciA9IHNlcnZlcnNGaWx0ZXJSZXN1bHRbMF07XG4gICAgICAgICAgICAgIG5vdGVib29rU2VydmVyLmFkbWluQ29udGV4dCA9IFwiL2FkbWluXCI7XG4gICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKG5vdGVib29rU2VydmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgZWxzZVxuICAgICAgICByZWplY3QoKTtcbiAgICB9XG4gIH0pO1xufVxuZnVuY3Rpb24gZ2V0Tm90ZWJvb2tSdW50aW1lc0Jhc2UodXJsKSB7XG4gIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgdXNlSnNvbkZvcm1hdFBhcmFtOiB0cnVlLFxuICAgIHVzZUNyZWRlbnRpYWxzOiB0cnVlXG4gIH07XG4gIHJldHVybiBub3RlYm9va1JlcXVlc3QoYCR7dXJsfS9hZG1pbi9ub3RlYm9va3MvcnVudGltZXNgLCBcIkdFVFwiLCBudWxsLCBvcHRpb25zKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldEN1cnJlbnRSdW50aW1lVmVyc2lvbih1cmwpIHtcbiAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICB1c2VKc29uRm9ybWF0UGFyYW06IHRydWUsXG4gICAgdXNlQ3JlZGVudGlhbHM6IHRydWVcbiAgfTtcbiAgY29uc3QgaW5mbyA9IGF3YWl0IG5vdGVib29rUmVxdWVzdChgJHt1cmx9L3Jlc3QvaW5mb2AsIFwiR0VUXCIsIG51bGwsIG9wdGlvbnMpO1xuICByZXR1cm4gaW5mby5jdXJyZW50UnVudGltZVZlcnNpb247XG59XG5mdW5jdGlvbiBmb3JtYXROb3RlYm9va1J1bnRpbWVWZXJzaW9uKHZlcnNpb24pIHtcbiAgY29uc3QgdmVyc2lvbk1hcCA9IHtcbiAgICBcIjEwLjdcIjogXCIxLjBcIixcbiAgICBcIjEwLjcuMFwiOiBcIjEuMFwiLFxuICAgIFwiMTAuNy4xXCI6IFwiMi4wXCIsXG4gICAgXCIxMC44XCI6IFwiMy4wXCIsXG4gICAgXCIxMC44LjBcIjogXCIzLjBcIixcbiAgICBcIjEwLjguMVwiOiBcIjQuMFwiXG4gIH07XG4gIHJldHVybiB2ZXJzaW9uTWFwW3ZlcnNpb25dIHx8IHZlcnNpb247XG59XG5mdW5jdGlvbiBwcm9jZXNzUnVudGltZXMocnVudGltZXMgPSBbXSwgY3VycmVudFJ1bnRpbWVWZXJzaW9uKSB7XG4gIGNvbnN0IHsgdXNlciB9ID0gY29uZmlnU3RhdGU7XG4gIGNvbnN0IGNhbkNyZWF0ZUFkdmFuY2VkID0gY2FuQ3JlYXRlQWR2YW5jZWROb3RlYm9va3ModXNlcik7XG4gIHJldHVybiAocnVudGltZXNcbiAgICAvLyBsaXN0IGVzcmkgcHJvdmlkZWQgcnVudGltZXMgZmlyc3RcbiAgICAuc29ydCgoYSwgYikgPT4gKGEuZXNyaVByb3ZpZGVkUnVudGltZSA9PT0gYi5lc3JpUHJvdmlkZWRSdW50aW1lID8gMCA6IGEuZXNyaVByb3ZpZGVkUnVudGltZSA/IC0xIDogMSkpXG4gICAgLmZpbHRlcigocnVudGltZSkgPT4ge1xuICAgIC8vIGZpbHRlciBvdXIgYWR2YW5jZWQgbm90ZWJvb2tzIGZvciB0aG9zZSB0aGF0IGNhbid0IHVzZSB0aGVtXG4gICAgaWYgKCFjYW5DcmVhdGVBZHZhbmNlZCAmJiBydW50aW1lLnJlcXVpcmVzQWR2YW5jZWRQcml2aWxlZ2VzKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8vIG9ubHkgc2hvdyBjdXJyZW50IHZlcnNpb24gb3IgY3VzdG9tIHJ1bnRpbWVzXG4gICAgY29uc3QgY3VycmVudFZlcnNpb24gPSBmb3JtYXROb3RlYm9va1J1bnRpbWVWZXJzaW9uKGN1cnJlbnRSdW50aW1lVmVyc2lvbikgPT09IGZvcm1hdE5vdGVib29rUnVudGltZVZlcnNpb24ocnVudGltZS52ZXJzaW9uKTtcbiAgICByZXR1cm4gY3VycmVudFZlcnNpb24gfHwgIXJ1bnRpbWUuZXNyaVByb3ZpZGVkUnVudGltZTtcbiAgfSkpO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0Tm90ZWJvb2tSdW50aW1lcygpIHtcbiAgdmFyIF9hO1xuICBjb25zdCB7IHVybCB9ID0gYXdhaXQgZ2V0Tm90ZWJvb2tTZXJ2ZXIoKTtcbiAgY29uc3QgY3VycmVudFJ1bnRpbWVWZXJzaW9uID0gYXdhaXQgZ2V0Q3VycmVudFJ1bnRpbWVWZXJzaW9uKHVybCk7XG4gIGNvbnN0IHJ1bnRpbWVJbmZvID0gYXdhaXQgZ2V0Tm90ZWJvb2tSdW50aW1lc0Jhc2UodXJsKTtcbiAgaWYgKChfYSA9IHJ1bnRpbWVJbmZvID09PSBudWxsIHx8IHJ1bnRpbWVJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBydW50aW1lSW5mby5ydW50aW1lcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkge1xuICAgIHJldHVybiBwcm9jZXNzUnVudGltZXMocnVudGltZUluZm8ucnVudGltZXMsIGN1cnJlbnRSdW50aW1lVmVyc2lvbik7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5mdW5jdGlvbiBub3RlYm9va1NlcnZlckNvbmZpZ3VyZWQoKSB7XG4gIHZhciBfYTtcbiAgY29uc3QgeyBjb25maWcsIHBvcnRhbCB9ID0gY29uZmlnU3RhdGU7XG4gIGlmIChwb3J0YWwuaXNQb3J0YWwpIHtcbiAgICAvLyBPbi1QcmVtXG4gICAgcmV0dXJuIGNvbmZpZy5ub3RlYm9va1NlcnZlckVuYWJsZWQgJiYgcG9ydGFsLnN1cHBvcnRzSG9zdGVkTm90ZWJvb2tzID8gdHJ1ZSA6IGZhbHNlO1xuICB9XG4gIGVsc2Uge1xuICAgIC8vIEFHT0xcbiAgICBjb25zdCBibGFja2xpc3RlZE9yZ1R5cGVzID0gW1wiVHJpYWwgRGV2ZWxvcGVyXCIsIFwiVHJpYWxcIiwgXCJUcmlhbCBQcmVzc1wiLCBcIkRldmVsb3BlciBTdWJzY3JpcHRpb25cIl07XG4gICAgY29uc3QgaGFzQmxhY2tsaXN0ZWRPcmdUeXBlID0gYmxhY2tsaXN0ZWRPcmdUeXBlcy5pbmRleE9mKChfYSA9IHBvcnRhbC5zdWJzY3JpcHRpb25JbmZvKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgIT09IC0xO1xuICAgIHJldHVybiAoY29uZmlnLm5vdGVib29rU2VydmVyRW5hYmxlZCAmJlxuICAgICAgKCFoYXNCbGFja2xpc3RlZE9yZ1R5cGUgfHwgKChwb3J0YWwgPT09IG51bGwgfHwgcG9ydGFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3J0YWwuYWxsb3dlZEJldGFGZWF0dXJlcykgfHwgW10pLmluZGV4T2YoXCJub3RlYm9va3NcIikgIT09IC0xKSk7XG4gIH1cbn1cbmZ1bmN0aW9uIGNhblNob3dOb3RlYm9va1NlbGVjdGlvbigpIHtcbiAgY29uc3QgeyB1c2VyIH0gPSBjb25maWdTdGF0ZTtcbiAgcmV0dXJuIG5vdGVib29rU2VydmVyQ29uZmlndXJlZCgpICYmIGNhbkNyZWF0ZU5vdGVib29rcyh1c2VyKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIG5vdGVib29rUmVxdWVzdCh1cmwsIG1ldGhvZCwgZGF0YSwgb3B0aW9ucykge1xuICBjb25zdCBbX3JlcXVlc3RdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZG9qby9yZXF1ZXN0XCJdKTtcbiAgY29uc3QgeyBjb25maWcgfSA9IGNvbmZpZ1N0YXRlO1xuICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgbGV0IHF1ZXJ5ID0ge307XG4gIGNvbnN0IGhlYWRlcnMgPSB7IFwiWC1SZXF1ZXN0ZWQtV2l0aFwiOiBudWxsIH07XG4gIGNvbnN0IHRva2VuID0gY29uZmlnLnVzZXJJbmZvID8gY29uZmlnLnVzZXJJbmZvLnRva2VuIDogbnVsbDtcbiAgLy8gVGhpcyBpcyBuZWVkZWQgYmVjYXVzZSBub3RlYm9vayBzZXJ2ZXIgZXhwZWN0cyBhbiBmIHBhcmFtZXRlclxuICAvLyBvdGhlcndpc2Ugd2UgZ2V0ICdtZXRob2Qgbm90IGFsbG93ZWQnXG4gIGlmIChvcHRpb25zLnVzZUpzb25Gb3JtYXRQYXJhbSkge1xuICAgIHF1ZXJ5LmYgPSBcImpzb25cIjtcbiAgfVxuICBpZiAobWV0aG9kID09PSBcIkdFVFwiKSB7XG4gICAgcXVlcnkgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHF1ZXJ5KSwgZGF0YSk7XG4gIH1cbiAgaWYgKCFvcHRpb25zLmJ5cGFzc0N1c3RvbUhlYWRlcnMpIHtcbiAgICBoZWFkZXJzW1wiWC1Fc3JpLUF1dGhvcml6YXRpb25cIl0gPSBcIkJlYXJlciBcIiArIHRva2VuO1xuICAgIGlmIChvcHRpb25zLnVzZUpzb25Cb2R5KSB7XG4gICAgICBoZWFkZXJzW1wiQ29udGVudC1UeXBlXCJdID0gXCJhcHBsaWNhdGlvbi9qc29uXCI7XG4gICAgfVxuICB9XG4gIGlmIChvcHRpb25zLmNvbnRlbnRUeXBlKSB7XG4gICAgaGVhZGVyc1tcIkNvbnRlbnQtVHlwZVwiXSA9IG9wdGlvbnMuY29udGVudFR5cGU7XG4gIH1cbiAgY29uc3QgcmVxdWVzdE9wdGlvbnMgPSB7XG4gICAgZGF0YTogb3B0aW9ucy51c2VKc29uQm9keSA/IChkYXRhID8gSlNPTi5zdHJpbmdpZnkoZGF0YSkgOiBudWxsKSA6IGRhdGEsXG4gICAgbWV0aG9kOiBtZXRob2QsXG4gICAgaGFuZGxlQXM6IFwianNvblwiLFxuICAgIGhlYWRlcnM6IE9iamVjdC5rZXlzKGhlYWRlcnMpLmxlbmd0aCA/IGhlYWRlcnMgOiBudWxsLFxuICAgIHF1ZXJ5OiBPYmplY3Qua2V5cyhxdWVyeSkubGVuZ3RoID8gcXVlcnkgOiBudWxsLFxuICAgIHByZXZlbnRDYWNoZTogb3B0aW9ucy5wcmV2ZW50Q2FjaGUgPT09IGZhbHNlID8gZmFsc2UgOiB0cnVlLFxuICAgIHdpdGhDcmVkZW50aWFsczogIW9wdGlvbnMuYnlwYXNzQ3VzdG9tSGVhZGVycyA/IHRydWUgOiBmYWxzZVxuICB9O1xuICByZXR1cm4gX3JlcXVlc3QodXJsLCByZXF1ZXN0T3B0aW9ucyk7XG59XG5cbmNvbnN0IGFyY2dpc05vdGVib29rUnVudGltZVNlbGVjdENzcyA9IFwiOmhvc3R7LS1hcmNnaXMtbGFiZWwtZm9udC13ZWlnaHQ6NDAwfS5sYWJlbHttYXJnaW4tdG9wOjA7bWFyZ2luLWJvdHRvbTowO2ZvbnQtd2VpZ2h0OnZhcigtLWFyY2dpcy1sYWJlbC1mb250LXdlaWdodCl9LmxhYmVsLS1ib2xkey0tYXJjZ2lzLWxhYmVsLWZvbnQtd2VpZ2h0OjUwMH0ubG9hZGVye2NvbG9yOnZhcigtLWNhbGNpdGUtdWktYnJhbmQpfS5sZWFkZXItdGV4dHtmb250LXNpemU6MC44NzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpfVwiO1xuXG5jb25zdCBBcmNnaXNOb3RlYm9va1J1bnRpbWVTZWxlY3QgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuaGFuZGxlUnVudGltZUNoYW5nZSA9IChlKSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZSA9IGUuY3VycmVudFRhcmdldC5zZWxlY3RlZE9wdGlvbi52YWx1ZTtcbiAgICAgIGNvbnN0IGkgPSBwYXJzZUludCh2YWx1ZSwgMTApIHx8IDA7XG4gICAgICB0aGlzLnNlbGVjdGVkUnVudGltZUluZGV4ID0gaTtcbiAgICAgIHRoaXMudXBkYXRlUHJvcGVydGllcyh0aGlzLnJ1bnRpbWVzW2ldKTtcbiAgICB9O1xuICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnJ1bnRpbWVzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgdGhpcy5lcnJvciA9IGZhbHNlO1xuICAgIHRoaXMuc2VsZWN0ZWRSdW50aW1lSW5kZXggPSAwO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIGNvbnN0IGxvY2FsZSA9IGF3YWl0IGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3ModGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gbG9jYWxlWzBdO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICghY2FuU2hvd05vdGVib29rU2VsZWN0aW9uKCkpXG4gICAgICAgIHJldHVybjtcbiAgICAgIGNvbnN0IHJ1bnRpbWVzID0gYXdhaXQgZ2V0Tm90ZWJvb2tSdW50aW1lcygpO1xuICAgICAgdGhpcy5ydW50aW1lcyA9IHJ1bnRpbWVzO1xuICAgICAgaWYgKCFydW50aW1lcyB8fCAhcnVudGltZXMubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcigpO1xuICAgICAgfVxuICAgICAgdGhpcy51cGRhdGVQcm9wZXJ0aWVzKHJ1bnRpbWVzWzBdKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmVycm9yID0gdHJ1ZTtcbiAgICB9XG4gICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gIH1cbiAgdXBkYXRlUHJvcGVydGllcyhydW50aW1lKSB7XG4gICAgYWRkSXRlbVN0YXRlLnByb3BlcnRpZXMgPSB7XG4gICAgICBub3RlYm9va1J1bnRpbWVOYW1lOiBydW50aW1lLm5hbWUsXG4gICAgICBub3RlYm9va1J1bnRpbWVWZXJzaW9uOiBmb3JtYXROb3RlYm9va1J1bnRpbWVWZXJzaW9uKHJ1bnRpbWUudmVyc2lvbilcbiAgICB9O1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGkxOG4sIHNlbGVjdGVkUnVudGltZUluZGV4IH0gPSB0aGlzO1xuICAgIGlmICghY2FuU2hvd05vdGVib29rU2VsZWN0aW9uKCkpXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwibGFiZWxcIiB9LCBpMThuLnNlbGVjdFJ1bnRpbWUpLCBoKFwiY2FsY2l0ZS1ub3RpY2VcIiwgeyBpY29uOiB0cnVlLCBvcGVuOiB0aGlzLmVycm9yLCBzY2FsZTogXCJzXCIsIGtpbmQ6IFwiZGFuZ2VyXCIgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwidGl0bGVcIiB9LCBpMThuLmVycm9yLnRpdGxlKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwibWVzc2FnZVwiIH0sIGkxOG4uZXJyb3IucnVudGltZXMpKSwgdGhpcy5sb2FkaW5nID8gKGgoXCJzcGFuXCIsIG51bGwsIGgoXCJjYWxjaXRlLWxvYWRlclwiLCB7IGNsYXNzOiBcImxvYWRlclwiLCBpbmxpbmU6IHRydWUsIGxhYmVsOiBpMThuLmxvYWRpbmdSdW50aW1lcyB9KSwgXCIgXCIsIGkxOG4ubG9hZGluZ1J1bnRpbWVzKSkgOiAoIXRoaXMuZXJyb3IgJiYgKGgoXCJjYWxjaXRlLXNlbGVjdFwiLCB7IGxhYmVsOiBpMThuLnNlbGVjdFJ1bnRpbWUsIG9uQ2FsY2l0ZVNlbGVjdENoYW5nZTogdGhpcy5oYW5kbGVSdW50aW1lQ2hhbmdlIH0sIHRoaXMucnVudGltZXMubWFwKChydW50aW1lLCBpKSA9PiAoaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IGksIHNlbGVjdGVkOiBzZWxlY3RlZFJ1bnRpbWVJbmRleCA9PT0gaSB9LCBydW50aW1lLm5hbWUsIFwiIC0gXCIsIHJ1bnRpbWUudmVyc2lvbikpKSkpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNOb3RlYm9va1J1bnRpbWVTZWxlY3Quc3R5bGUgPSBhcmNnaXNOb3RlYm9va1J1bnRpbWVTZWxlY3RDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc05vdGVib29rUnVudGltZVNlbGVjdCBhcyBhcmNnaXNfbm90ZWJvb2tfcnVudGltZV9zZWxlY3QgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgbCBhcyBsb2FkTW9kdWxlcyB9IGZyb20gJy4vbG9hZE1vZHVsZXMtYWFmMzBiZDYuanMnO1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5cbmNvbnN0IGxhbmd1YWdlTWFwID0gbmV3IE1hcChbXG4gIFtcImFyXCIsIFwiYXJcIl0sXG4gIFtcImJnXCIsIFwiYmdcIl0sXG4gIFtcImJzXCIsIFwiYnNcIl0sXG4gIFtcImNhXCIsIFwiY2FcIl0sXG4gIFtcImNzXCIsIFwiY3NcIl0sXG4gIFtcImRhXCIsIFwiZGFcIl0sXG4gIFtcImRlXCIsIFwiZGVcIl0sXG4gIFtcImVsXCIsIFwiZWxcIl0sXG4gIFtcImVuXCIsIFwiZW5cIl0sXG4gIFtcImVzXCIsIFwiZXNcIl0sXG4gIFtcImV0XCIsIFwiZXRcIl0sXG4gIFtcImZpXCIsIFwiZmlcIl0sXG4gIFtcImZyXCIsIFwiZnJcIl0sXG4gIFtcImhlXCIsIFwiaGVcIl0sXG4gIFtcImhyXCIsIFwiaHJcIl0sXG4gIFtcImh1XCIsIFwiaHVcIl0sXG4gIFtcImlkXCIsIFwiaWRcIl0sXG4gIFtcIml0XCIsIFwiaXRcIl0sXG4gIFtcImphXCIsIFwiamFcIl0sXG4gIFtcImtvXCIsIFwia29cIl0sXG4gIFtcImx0XCIsIFwibHRcIl0sXG4gIFtcImx2XCIsIFwibHZcIl0sXG4gIFtcIm5iXCIsIFwibmJcIl0sXG4gIFtcIm5sXCIsIFwibmxcIl0sXG4gIFtcInBsXCIsIFwicGxcIl0sXG4gIFtcInB0LWJyXCIsIFwicHQtQlJcIl0sXG4gIFtcInB0LXB0XCIsIFwicHQtUFRcIl0sXG4gIFtcInJvXCIsIFwicm9cIl0sXG4gIFtcInJ1XCIsIFwicnVcIl0sXG4gIFtcInNrXCIsIFwic2tcIl0sXG4gIFtcInNsXCIsIFwic2xcIl0sXG4gIFtcInNyXCIsIFwic3JcIl0sXG4gIFtcInN2XCIsIFwic3ZcIl0sXG4gIFtcInRoXCIsIFwidGhcIl0sXG4gIFtcInRyXCIsIFwidHJcIl0sXG4gIFtcInVrXCIsIFwidWtcIl0sXG4gIFtcInZpXCIsIFwidmlcIl0sXG4gIFtcInpoLWNuXCIsIFwiemgtQ05cIl0sXG4gIFtcInpoLWhrXCIsIFwiemgtSEtcIl0sXG4gIFtcInpoLXR3XCIsIFwiemgtVFdcIl1cbl0pO1xuLy8gcnRsXG5mdW5jdGlvbiBnZXRFbGVtZW50RGlyKGVsKSB7XG4gIHJldHVybiBnZXRFbGVtZW50UHJvcChlbCwgXCJkaXJcIiwgXCJsdHJcIik7XG59XG5mdW5jdGlvbiBnZXRFbGVtZW50UHJvcChlbCwgcHJvcCwgdmFsdWUpIHtcbiAgY29uc3QgY2xvc2VzdFdpdGhQcm9wID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsLCBgWyR7cHJvcH1dYCk7XG4gIHJldHVybiBjbG9zZXN0V2l0aFByb3AgPyBjbG9zZXN0V2l0aFByb3AuZ2V0QXR0cmlidXRlKHByb3ApIDogdmFsdWU7XG59XG4vLyBjc3NcbmNvbnN0IENTU19VVElMSVRZID0ge1xuICBydGw6IFwiYXJjZ2lzLS1ydGxcIlxufTtcbmFzeW5jIGZ1bmN0aW9uIGZvcm1hdE51bWJlcihudW1iZXIsIG9wdGlvbnMpIHtcbiAgY29uc3QgeyBhcGksIHR5cGUsIHBsYWNlcyB9ID0gb3B0aW9ucyB8fCB7fTtcbiAgaWYgKGFwaSA9PT0gNCkge1xuICAgIGNvbnN0IFtpbnRsXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvaW50bFwiXSk7XG4gICAgY29uc3QgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMgPSBpbnRsLmNvbnZlcnROdW1iZXJGb3JtYXRUb0ludGxPcHRpb25zKHtcbiAgICAgIHBsYWNlcyxcbiAgICAgIHN0eWxlOiB0eXBlLFxuICAgICAgZGlnaXRTZXBhcmF0b3I6IHRydWVcbiAgICB9KTtcbiAgICByZXR1cm4gaW50bC5mb3JtYXROdW1iZXIobnVtYmVyLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG51bWJlckZvcm1hdEludGxPcHRpb25zKSwgeyBzdHlsZTogdHlwZSB9KSk7XG4gIH1cbiAgY29uc3QgW2Rvam9OdW1iZXJdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZG9qby9udW1iZXJcIl0pO1xuICByZXR1cm4gZG9qb051bWJlci5mb3JtYXQobnVtYmVyLCB7XG4gICAgdHlwZSxcbiAgICBwbGFjZXMsXG4gICAgcGF0dGVybjogb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLnBhdHRlcm5cbiAgfSk7XG59XG5jb25zdCBjYWNoZSA9IHt9O1xuZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlKSB7XG4gIGNvbnN0IGxhbmcgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZztcbiAgY29uc3QgZGF5U2hvcnRNb250aFllYXIgPSB7XG4gICAgeWVhcjogXCJudW1lcmljXCIsXG4gICAgbW9udGg6IFwic2hvcnRcIixcbiAgICBkYXk6IFwibnVtZXJpY1wiXG4gIH07XG4gIGlmICghY2FjaGVbbGFuZ10pIHtcbiAgICBjYWNoZVtsYW5nXSA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nLCBkYXlTaG9ydE1vbnRoWWVhcik7XG4gIH1cbiAgcmV0dXJuIGNhY2hlW2xhbmddLmZvcm1hdChkYXRlKTtcbn1cblxuZXhwb3J0IHsgQ1NTX1VUSUxJVFkgYXMgQywgZm9ybWF0RGF0ZSBhcyBhLCBmb3JtYXROdW1iZXIgYXMgZiwgZ2V0RWxlbWVudERpciBhcyBnLCBsYW5ndWFnZU1hcCBhcyBsIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tMTNmNWIwMGMuanMnO1xuaW1wb3J0IHsgbCBhcyBsYW5ndWFnZU1hcCB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0QXNzZXRQYXRoIH0gZnJvbSAnLi9pbmRleC05MmViYjM5Ni5qcyc7XG5cbi8vIGh0dHBzOi8vbWVkaXVtLmNvbS9zdGVuY2lsLXRyaWNrcy9pbXBsZW1lbnRpbmctaW50ZXJuYXRpb25hbGlzYXRpb24taTE4bi13aXRoLXN0ZW5jaWwtNWU2NTU5NTU0MTE3XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCkge1xuICB2YXIgX2EsIF9iLCBfYztcbiAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gIC8vIGxhbmd1YWdlIHNldCBieSB0aGUgY2FsbGluZyBhcHBsaWNhdGlvbiBvciBicm93c2VyLiBkZWZhdWx0cyB0byBlbmdsaXNoLlxuICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgfVxuICBlbHNlIHtcbiAgICAvLyBcInJ1LVJVXCIgbWFwcyB0byBcInJ1XCIgdXNlIGNhc2VcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcuc2xpY2UoMCwgMikpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBcImVuXCI7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpIHtcbiAgdmFyIF9hLCBfYiwgX2M7XG4gIC8vIGl0J3MgT0sgaWYgd2UgZG9uJ3QgaGF2ZSB0aGUgNCBsZXR0ZXIgbGFuZ3VhZ2UgZmlsZSBmb3IgaXRcbiAgLy8gNCBsZXR0ZXIgbGFuZ3VhZ2UgY29kZSBuZWVkZWQgZm9yIGZvcm1hdHRpbmcgbnVtYmVyc1xuICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICB9XG4gIGVsc2Uge1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgIC8vIHdlIHN1cHBvcnQgdGhlIDIgbGV0dGVyIGNvZGVkIGxhbmd1YWdlXG4gICAgICAvLyBlLmcuIGl0LUNIIHZzIGl0XG4gICAgICByZXR1cm4gbGFuZztcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXR1cm4gXCJlblwiO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGZldGNoKGdldEFzc2V0UGF0aChgLi4vYXJjZ2lzLWFwcC1hc3NldHMvaTE4bi8ke2NvbXBvbmVudE5hbWV9LmkxOG4uJHtsb2NhbGV9Lmpzb25gKSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICBpZiAocmVzdWx0Lm9rKVxuICAgICAgICByZXNvbHZlKHJlc3VsdC5qc29uKCkpO1xuICAgICAgZWxzZVxuICAgICAgICByZWplY3QoKTtcbiAgICB9LCAoKSA9PiByZWplY3QoKSk7XG4gIH0pO1xufVxuY29uc3Qgc3RyaW5nQ2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBsb2NhbGUpIHtcbiAgY29uc3QgaWQgPSBgJHtjb21wb25lbnROYW1lfSR7bG9jYWxlfWA7XG4gIGlmICghc3RyaW5nQ2FjaGVbaWRdKSB7XG4gICAgc3RyaW5nQ2FjaGVbaWRdID0gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSk7XG4gIH1cbiAgcmV0dXJuIHN0cmluZ0NhY2hlW2lkXTtcbn1cbi8qKlxuICogR2V0IHN0cmluZ3MgYW5kIGxhbmd1YWdlIGNvZGVzLlxuICogVGhpcyBtZXRob2QgcmV0dXJucyAyIGxhbmd1YWdlIGNvZGVzLlxuICogVGhlIGZpcnN0IG9uZSByZXR1cm5zIGEgY29kZSB0aGF0J3MgYWxzbyBzdXBwb3J0ZWQgYXMgYSBsYW5ndWFnZSBmaWxlLlxuICogVGhlIHNlY29uZCBvbmUgcmV0dXJucyBhIGNvZGUgd2hlcmUgdGhlcmUgaXMgc3VwcG9ydCBmb3IgdGhlIGZpcnN0IDIgbGV0dGVycyBvZiB0aGUgY29kZSBhcyBwYXJ0IG9mIGEgbGFuZ3VhZ2UgZmlsZSxcbiAqIGJ1dCB3aWxsIHJldHVybiB0aGUgb3JpZ2luYWwgNCBsZXR0ZXIgY29kZSBmcm9tIHRoZSBwYWdlLlxuICogRS5nLiBGb3IgXCJpdC1jaFwiIGl0IHdpbGwgcmV0dXJuIFwiaXRcIiBhcyB0aGUgZmlyc3QgbGFuZ3VhZ2UgY29kZSBhbmQgXCJpdC1jaFwiIGFzIHRoZSBzZWNvbmQuXG4gKiBUaGUgc2Vjb25kIG9uZSBpcyByZXF1aXJlZCBmb3IgZXNyaS5pbnRsLnNldExvY2FsZSgpIHRvIGdldCB0aGUgY29ycmVjdCBmb3JtYXR0aW5nLlxuICpcbiAqIElmIGEgdGFnTmFtZSBpcyBwcm92aWRlZCBpdCB3aWxsIG92ZXJ3aXRlIHRoZSBlbGVtZW50J3MgdGFnTmFtZVxuICpcbiAqICBAcmV0dXJuIFsgc3RyaW5ncywgZmlyc3QgbGFuZ3VhZ2UgY29kZSwgc2Vjb25kIGxhbmd1YWdlIGNvZGVdXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MoZWxlbWVudCwgdGFnTmFtZSkge1xuICBjb25zdCBjb21wb25lbnROYW1lID0gdGFnTmFtZSB8fCBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2UgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCk7XG4gIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlSW50bCA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCk7XG4gIGxldCBzdHJpbmdzO1xuICB0cnkge1xuICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgY29tcG9uZW50TGFuZ3VhZ2UpO1xuICB9XG4gIGNhdGNoIChlKSB7XG4gICAgY29uc29sZS53YXJuKGBubyBsb2NhbGUgZm9yICR7Y29tcG9uZW50TmFtZX0gKCR7Y29tcG9uZW50TGFuZ3VhZ2V9KSBsb2FkaW5nIGRlZmF1bHQgbG9jYWxlIGVuLmApO1xuICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgXCJlblwiKTtcbiAgfVxuICByZXR1cm4gW3N0cmluZ3MsIGNvbXBvbmVudExhbmd1YWdlLCBjb21wb25lbnRMYW5ndWFnZUludGxdO1xufVxuXG5leHBvcnQgeyBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UgYXMgYSwgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyBhcyBnIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=