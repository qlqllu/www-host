"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-9babcd"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-symbol-picker.entry.js":
/*!***********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-symbol-picker.entry.js ***!
  \***********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_symbol_picker: () => (/* binding */ ArcgisSymbolPicker)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./color-776689e9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/color-776689e9.js");
/* harmony import */ var _localStorage_f63100ef_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./localStorage-f63100ef.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/localStorage-f63100ef.js");
/* harmony import */ var _storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./storage-d7f5822e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */










function getInjectedRequestOptions(item) {
  // hack to inject authMode into request options
  return { authMode: item.access === "public" ? "anonymous" : "auto" };
}
const BASIC_SIMPLE_MARKER_SYMBOLS_JSON = [
  {
    name: "Circle",
    type: "esriSMS",
    style: "esriSMSCircle",
    color: [0, 0, 128, 128],
    size: 18,
    outline: {
      color: [0, 0, 128, 255],
      width: 1
    }
  },
  {
    name: "Square",
    type: "esriSMS",
    style: "esriSMSSquare",
    color: [0, 0, 128, 128],
    size: 18,
    outline: {
      color: [0, 0, 128, 255],
      width: 1
    }
  },
  {
    name: "Diamond",
    type: "esriSMS",
    style: "esriSMSDiamond",
    color: [0, 0, 128, 128],
    size: 18,
    outline: {
      color: [0, 0, 128, 255],
      width: 1
    }
  },
  {
    name: "Triangle",
    type: "esriSMS",
    style: "esriSMSTriangle",
    color: [0, 0, 128, 128],
    size: 18,
    outline: {
      color: [0, 0, 128, 255],
      width: 1
    }
  } /* ,
  {
    name: "Cross",
    type: "esriSMS",
    style: "esriSMSCross",
    color: [0, 0, 128, 128],
    size: 18,
    outline: {
      color: [0, 0, 128, 255],
      width: 1
    }
  },
  {
    name: "X",
    type: "esriSMS",
    style: "esriSMSX",
    color: [0, 0, 128, 128],
    size: 18,
    outline: {
      color: [0, 0, 128, 255],
      width: 1
    }
  } */
];
const BASIC_SIMPLE_LINE_SYMBOLS_JSON = [
  {
    type: "esriSLS",
    color: [0, 0, 0, 255],
    width: 0.75,
    style: "esriSLSSolid"
  }
];
const BASIC_SIMPLE_POLYGON_SYMBOLS_JSON = [
  {
    type: "esriSFS",
    color: [0, 0, 0, 64],
    outline: {
      type: "esriSLS",
      color: [0, 0, 0, 255],
      width: 0.75,
      style: "esriSLSSolid"
    },
    style: "esriSFSSolid"
  }
];
const symbolHeightAsMainAxis = 10;
const symbolRadiusFixed = 5;
function generateIconPrimitiveSymbolJson(strings) {
  const icons = [
    {
      title: strings.symbolSources.circle,
      name: "Circle",
      primitive: "circle"
    },
    {
      title: strings.symbolSources.square,
      name: "Square",
      primitive: "square"
    },
    {
      title: strings.symbolSources.cross,
      name: "Cross",
      primitive: "cross"
    },
    {
      title: strings.symbolSources.x,
      name: "X",
      primitive: "x"
    },
    {
      title: strings.symbolSources.kite,
      name: "Kite",
      primitive: "kite"
    },
    {
      title: strings.symbolSources.triangle,
      name: "Triangle",
      primitive: "triangle"
    }
  ];
  return icons.map((icon) => {
    var _a;
    return ({
      dimensionality: "flat",
      name: icon.name,
      title: icon.title,
      type: "PointSymbol3D",
      symbolLayers: [
        {
          type: "Icon",
          resource: {
            primitive: icon.primitive
          },
          material: {
            color: (_a = _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e === null || _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e === void 0 ? void 0 : _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.gfxUtils) === null || _a === void 0 ? void 0 : _a.defaultThematicColor
          },
          outline: {
            color: [0, 0, 0]
          }
        }
      ]
    });
  });
}
function generateObjectPrimitiveSymbolJson(strings) {
  const objects = [
    {
      title: strings.symbolSources.sphere,
      name: "Sphere",
      primitive: "sphere"
    },
    {
      title: strings.symbolSources.tallCylinder,
      name: "Tall_Cylinder",
      primitive: "cylinder",
      mixins: {
        width: symbolRadiusFixed,
        height: symbolHeightAsMainAxis,
        depth: symbolRadiusFixed
      }
    },
    {
      title: strings.symbolSources.cylinder,
      name: "Cylinder",
      primitive: "cylinder"
    },
    {
      title: strings.symbolSources.tallCube,
      name: "Tall_Cube",
      primitive: "cube",
      mixins: {
        width: symbolRadiusFixed,
        height: symbolHeightAsMainAxis,
        depth: symbolRadiusFixed,
        anchor: "bottom"
      }
    },
    {
      title: strings.symbolSources.cube,
      name: "Cube",
      primitive: "cube"
    },
    {
      title: strings.symbolSources.tallCone,
      name: "Tall_Cone",
      primitive: "cone",
      mixins: {
        width: symbolRadiusFixed,
        height: symbolHeightAsMainAxis,
        depth: symbolRadiusFixed
      }
    },
    {
      title: strings.symbolSources.cone,
      name: "Cone",
      primitive: "cone"
    },
    {
      title: strings.symbolSources.invertedCone,
      name: "Inverted_Cone",
      primitive: "invertedCone"
    },
    {
      title: strings.symbolSources.diamond,
      name: "Diamond",
      primitive: "diamond"
    },
    {
      title: strings.symbolSources.tetrahedron,
      name: "Tetrahedron",
      primitive: "tetrahedron"
    }
  ];
  return objects.map((object) => ({
    dimensionality: "volumetric",
    name: object.name,
    title: object.title,
    type: "PointSymbol3D",
    symbolLayers: [
      Object.assign({ type: "Object", resource: {
          primitive: object.primitive
        } }, object.mixins)
    ]
  }));
}
const symbolThumbnailSizeInPt = 24; // 24 pt => 32px
const symbolThumbnailSizeInPtFor3D = 42; // 42pt => 56px
function has3DFormat(itemData) {
  var _a, _b;
  const formatIncludes3D = (_a = itemData.formats) === null || _a === void 0 ? void 0 : _a.includes("web3d");
  const formatInfosIncludes3DHint = (_b = itemData.formatInfos) === null || _b === void 0 ? void 0 : _b.some((formatInfo) => formatInfo.type === "gltf" || formatInfo.type === "gltf_basisu");
  return formatIncludes3D || formatInfosIncludes3DHint;
}
async function getWebStyleSymbolThumbnailPreview(item) {
  var _a, _b;
  const itemData = item.data;
  let thumbnailUrl = (_a = itemData.thumbnail) === null || _a === void 0 ? void 0 : _a.href;
  const thumbnailData = (_b = itemData.thumbnail) === null || _b === void 0 ? void 0 : _b.imageData;
  const title = itemData.title || item.strings.symbolSources.noTitle;
  const wrapper = document.createElement("div");
  const isCIM = !!itemData.cimRef;
  const is3d = has3DFormat(itemData);
  const commonPreviewOptions = {
    size: is3d && itemData.dimensionality === "volumetric" ? symbolThumbnailSizeInPtFor3D : symbolThumbnailSizeInPt,
    disableUpsampling: false
  };
  if (
  /* symbol preview utils only support 2D CIM */
  isCIM &&
    !is3d) {
    const symbol = (await item.getSymbol());
    if (
    // lines/points use dynamically generated previews
    // polygons use thumbnail URLs since dynamically generated
    // previews may not display as nicely as authored ones
    !(0,_color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.g)(symbol)) {
      if ((0,_color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.j)(symbol)) {
        // we drop size for non-points to prevent a known rendering issue â€“ https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/41790
        delete commonPreviewOptions.size;
      }
      return appendPreview(wrapper, symbol, commonPreviewOptions, title);
    }
  }
  // When loading Esri provided styles on dev environments we get incorrect
  // symbol URLs.
  // If necessary and allowed, adjust the URL to work on dev environments
  // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/16832
  if (_color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.devEnvironmentUtils.isDevEnvironment()) {
    thumbnailUrl = _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.devEnvironmentUtils.adjustStaticAGOUrl(thumbnailUrl);
  }
  if (!thumbnailUrl && !thumbnailData) {
    wrapper.appendChild(createBlankThumbnail(title));
    return wrapper;
  }
  const symbol = new _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.WebStyleSymbol({
    name: itemData.name,
    styleUrl: `${item.portalItem.itemUrl}/data`,
    thumbnail: {
      url: thumbnailData
        ? `data:image/jpeg;base64, ${thumbnailData}`
        : _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.urlUtils.makeAbsolute(thumbnailUrl, item.portalItem.itemUrl)
    }
  });
  return appendPreview(wrapper, symbol, commonPreviewOptions, title);
}
async function appendPreview(node, symbol, options, title) {
  try {
    await _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.symbolUtils.renderPreviewHTML(symbol, Object.assign({ node }, options));
  }
  catch (e) {
    node.appendChild(createBlankThumbnail(title));
  }
  return node;
}
function createBlankThumbnail(title) {
  const element = document.createElement("span");
  // described by parent node
  element.setAttribute("alt", "");
  element.innerHTML = title;
  return element;
}
function webStyleSymbolStrategy(symbolType = "2d") {
  return {
    async getSymbol(item) {
      const { data, parentData, portalItem } = item;
      const symbol = await symbolFromWebStyleJSON(parentData, data.name, portalItem, parentData.cimVersion && symbolType === "2d" ? "cimRef" : "webRef");
      // Override color for 3d icon and object symbols to be thematic
      if (symbol.type === "point-3d") {
        symbol.symbolLayers.forEach((symbolLayer) => {
          if (symbolLayer.get("material.color")) {
            if (symbolLayer.type === "icon") {
              const material = symbolLayer.material != null
                ? symbolLayer.material
                : {
                /* autocasts as Symbol3DMaterial */
                };
              material.color = _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.gfxUtils.defaultThematicColor.clone();
              symbolLayer.material = material;
            }
            else if (symbolLayer.type === "object") {
              const material = symbolLayer.material != null
                ? symbolLayer.material
                : {
                /* autocasts as Symbol3DMaterial */
                };
              material.color = material.color || (0,_color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.d)([255, 255, 255]);
              symbolLayer.material = material;
            }
          }
        });
      }
      return symbol;
    },
    async getThumbnail(item) {
      return getWebStyleSymbolThumbnailPreview(item);
    }
  };
}
function webStyleCustomSymbolStrategy() {
  return {
    async getSymbol(item) {
      return item.data.symbol;
    },
    async getThumbnail(item) {
      const wrapper = document.createElement("div");
      const html = appendPreview(wrapper, item.data.symbol, {
        size: 24,
        disableUpsampling: false
      }, item.data.title);
      return html;
    }
  };
}
const flatSymbolStrategy = {
  async getSymbol(item) {
    return _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.jsonUtils.fromJSON(item.data);
  },
  async getThumbnail(item) {
    const symbol = (await item.getSymbol());
    const previewOptions = {
      size: (0,_color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.h)(symbol) === "line"
        ? {
          width: symbolThumbnailSizeInPt
        }
        : symbolThumbnailSizeInPt
    };
    return _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.symbolUtils.renderPreviewHTML(symbol, previewOptions);
  }
};
const volumetricSymbolStrategy = {
  async getSymbol(item) {
    return _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.jsonUtils.fromJSON(item.data);
  },
  async getThumbnail(item) {
    const symbol = await item.getSymbol();
    return _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.symbolUtils.renderPreviewHTML(symbol, { size: symbolThumbnailSizeInPtFor3D - 4 });
  }
};
const noop = Function.prototype;
class SymbolItem {
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  constructor({ data, parentData, portalItem, strategy, strings }) {
    this.data = data;
    this.parentData = parentData;
    this.portalItem = portalItem;
    this.strategy = strategy;
    this.strings = strings;
  }
  //--------------------------------------------------------------------------
  //
  //  Public Methods
  //
  //--------------------------------------------------------------------------
  async getSymbol() {
    if (!this._symbol) {
      const inflightSymbol = this._symbolRequest || (this._symbolRequest = this.strategy.getSymbol(this));
      this._symbol = await inflightSymbol;
    }
    return this._symbol.clone();
  }
  async getThumbnail(node) {
    if (this._thumbnail) {
      node.appendChild(this._thumbnail);
      return noop;
    }
    const inflightThumbnail = this._thumbnailRequest || (this._thumbnailRequest = this.strategy.getThumbnail(this));
    this._thumbnail = await inflightThumbnail;
    return () => node.appendChild(this._thumbnail);
  }
}
class PortalItemSymbolSourceBase {
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  constructor({ portalItem, strings, symbolType }) {
    this.symbolType = "2d";
    this.portalItem = portalItem;
    this.strings = strings;
    if (symbolType) {
      this.symbolType = symbolType;
    }
  }
  get data() {
    return this._data;
  }
  get id() {
    var _a;
    return (_a = this.portalItem) === null || _a === void 0 ? void 0 : _a.id;
  }
  get keywords() {
    var _a;
    return ((_a = this.portalItem) === null || _a === void 0 ? void 0 : _a.typeKeywords) || [];
  }
  get name() {
    var _a;
    return (_a = this.portalItem) === null || _a === void 0 ? void 0 : _a.name;
  }
  get title() {
    var _a;
    return (_a = this.portalItem) === null || _a === void 0 ? void 0 : _a.title;
  }
  //--------------------------------------------------------------------------
  //
  //  Public Methods
  //
  //--------------------------------------------------------------------------
  async fetchData(options) {
    if (_color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.promiseUtils.isAborted(options)) {
      throw _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.promiseUtils.createAbortError();
    }
    if (!this._data) {
      this._data = await this.portalItem.fetchData("json", Object.assign(Object.assign({}, options), getInjectedRequestOptions(this.portalItem)));
    }
    return this._data;
  }
}
class SymbolSetSymbolSource extends PortalItemSymbolSourceBase {
  constructor() {
    //--------------------------------------------------------------------------
    //
    //  Private Properties
    //
    //--------------------------------------------------------------------------
    super(...arguments);
    //--------------------------------------------------------------------------
    //
    //  Properties
    //
    //--------------------------------------------------------------------------
    this.type = "symbol-set";
  }
  //--------------------------------------------------------------------------
  //
  //  Protected Methods
  //
  //--------------------------------------------------------------------------
  async getItems(options) {
    if (_color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.promiseUtils.isAborted(options)) {
      throw _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.promiseUtils.createAbortError();
    }
    if (!this._items) {
      const data = await this.fetchData(options);
      this._items = data.map((item) => new SymbolItem({
        data: item,
        parentData: data,
        portalItem: this.portalItem,
        strategy: flatSymbolStrategy,
        strings: this.strings
      }));
    }
    return this._items;
  }
}
class WebStyleSymbolSource extends PortalItemSymbolSourceBase {
  constructor() {
    //--------------------------------------------------------------------------
    //
    //  Private Properties
    //
    //--------------------------------------------------------------------------
    super(...arguments);
    //--------------------------------------------------------------------------
    //
    //  Properties
    //
    //--------------------------------------------------------------------------
    this.type = "web-style";
  }
  //--------------------------------------------------------------------------
  //
  //  Public Methods
  //
  //--------------------------------------------------------------------------
  async getItems(options) {
    if (_color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.promiseUtils.isAborted(options)) {
      throw _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.promiseUtils.createAbortError();
    }
    if (!this._items) {
      const data = await this.fetchData(options);
      this._items = data.items.map((item) => new SymbolItem({
        data: item,
        parentData: data,
        portalItem: this.portalItem,
        strategy: webStyleSymbolStrategy(this.symbolType),
        strings: this.strings
      }));
    }
    return this._items;
  }
}
class BasicSymbolSetSource {
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  constructor({ strings }) {
    this.keywords = [];
    this.name = "Basic";
    this.type = "symbol-set";
    this.title = strings.symbolSources.basic;
  }
  //--------------------------------------------------------------------------
  //
  //  Public Methods
  //
  //--------------------------------------------------------------------------
  async getItems(options) {
    if (_color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.promiseUtils.isAborted(options)) {
      throw _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.promiseUtils.createAbortError();
    }
    if (!this._items) {
      // no parent data since it's local
      this._items = this.data.map((data) => new SymbolItem({
        data,
        strategy: flatSymbolStrategy,
        strings: this.strings
      }));
    }
    return this._items;
  }
}
const basicPointSymbolSetSourceId = "basic-symbol-set:point";
const basicLineSymbolSetSourceId = "basic-symbol-set:line";
const basicPolygonSymbolSetSourceId = "basic-symbol-set:polygon";
class BasicPointSymbolSetSource extends BasicSymbolSetSource {
  constructor() {
    //--------------------------------------------------------------------------
    //
    //  Properties
    //
    //--------------------------------------------------------------------------
    super(...arguments);
    this.data = BASIC_SIMPLE_MARKER_SYMBOLS_JSON;
    this.id = basicPointSymbolSetSourceId;
    this.keywords = ["Point"];
  }
}
class BasicLineSymbolSetSource extends BasicSymbolSetSource {
  constructor() {
    //--------------------------------------------------------------------------
    //
    //  Properties
    //
    //--------------------------------------------------------------------------
    super(...arguments);
    this.data = BASIC_SIMPLE_LINE_SYMBOLS_JSON;
    this.id = basicLineSymbolSetSourceId;
    this.keywords = ["Line"];
  }
}
class BasicPolygonSymbolSetSource extends BasicSymbolSetSource {
  constructor() {
    //--------------------------------------------------------------------------
    //
    //  Properties
    //
    //--------------------------------------------------------------------------
    super(...arguments);
    this.data = BASIC_SIMPLE_POLYGON_SYMBOLS_JSON;
    this.id = basicPolygonSymbolSetSourceId;
    this.keywords = ["Polygon"];
  }
}
class IconPrimitiveWebStyleSource {
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  constructor({ strings }) {
    this.keywords = ["3d"];
    this.id = "basic-web-style:flat";
    this.name = "Basic";
    this.type = "web-style";
    this.data = { items: generateIconPrimitiveSymbolJson(strings) };
    this.title = strings.symbolSources.basic;
  }
  //--------------------------------------------------------------------------
  //
  //  Public Methods
  //
  //--------------------------------------------------------------------------
  async getItems(options) {
    if (_color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.promiseUtils.isAborted(options)) {
      throw _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.promiseUtils.createAbortError();
    }
    if (!this._items) {
      // no parent data since it's local
      this._items = this.data.items.map((data) => new SymbolItem({
        data,
        strategy: flatSymbolStrategy,
        strings: this.strings
      }));
    }
    return this._items;
  }
}
class ObjectPrimitiveWebStyleSource {
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  constructor({ strings }) {
    this.id = "basic-web-style:volumetric";
    this.keywords = ["3d", "volumetric"];
    this.name = "Basic";
    this.type = "web-style";
    this.data = { items: generateObjectPrimitiveSymbolJson(strings) };
    this.title = strings.symbolSources.basic;
  }
  //--------------------------------------------------------------------------
  //
  //  Public Methods
  //
  //--------------------------------------------------------------------------
  async getItems(options) {
    if (_color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.promiseUtils.isAborted(options)) {
      throw _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.promiseUtils.createAbortError();
    }
    if (!this._items) {
      // no parent data since it's local
      this._items = this.data.items.map((data) => new SymbolItem({
        data,
        parentData: this.data,
        strategy: volumetricSymbolStrategy,
        strings: this.strings
      }));
    }
    return this._items;
  }
}
function styleNameFromItem(item) {
  // Find type keyword that looks like it's an esri style and hope it works
  for (const typeKeyword of item.typeKeywords) {
    if (/^Esri.*Style$/.test(typeKeyword) && typeKeyword !== "Esri Style") {
      return typeKeyword;
    }
  }
  return undefined;
}
async function symbolFromWebStyleJSON(style, name, item, type) {
  const styleName = styleNameFromItem(item);
  let styleUrl = null;
  if (!styleName) {
    styleUrl = `${item.itemUrl}/data`;
  }
  const styleResponse = {
    data: style,
    baseUrl: item.itemUrl,
    styleName,
    styleUrl
  };
  const { portal } = item;
  return _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.webStyleSymbolUtils.fetchSymbolFromStyle(styleResponse, name, { portal }, type, _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.styleUtils.symbolUrlFromStyleItem, getInjectedRequestOptions(item));
}

const CSS$1 = {
  markerItem: "marker-item",
  calciteDarkTheme: "calcite-mode-dark"
};
const MarkerItem = ({ item, index, observer }) => {
  const tooltip = item.data.title ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { "reference-element": item.data.name }, item.data.title)) : null;
  return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: `${CSS$1.markerItem} ${CSS$1.calciteDarkTheme}`, ref: (node) => {
      if (!node) {
        return;
      }
      const alreadyProcessed = node.item;
      if (alreadyProcessed) {
        return;
      }
      node.item = item;
      node.index = index;
      observer.observe(node);
    }, id: item.data.name, slot: "thumbnail" }, tooltip));
};

function fetchSymbolSetSymbolSources(portal, strings) {
  return fetchSymbolSets(portal).then((items) => items.map((item) => new SymbolSetSymbolSource({
    portalItem: item,
    strings
  })));
}
function fetchSymbolSets(portal) {
  return itemFetcher({
    portal,
    queries: {
      group: portal.symbolSetsGroupQuery,
      item: `type:"Symbol Set" AND (typekeywords:"by value" AND typekeywords:"marker")`
    }
  }).then(moveDefaultToFirst);
}
function fetchWebStyleSymbolSources(portal, type, strings) {
  return fetchWebStyles(portal, type).then((items) => items.map((item) => new WebStyleSymbolSource({
    portalItem: item,
    symbolType: type,
    strings
  })));
}
async function fetchWebStyles(portal, type) {
  const group = type === "2d" ? portal.stylesGroupQuery2d : portal.stylesGroupQuery3d;
  if (!group) {
    return [];
  }
  return itemFetcher({
    portal,
    queries: {
      group,
      item: `type:"Style"`
    }
  }).then(moveDefaultToFirst);
}
function getPrimitives(dimensionality, strings) {
  return dimensionality === "flat"
    ? new IconPrimitiveWebStyleSource({ strings })
    : new ObjectPrimitiveWebStyleSource({ strings });
}
function getBasic(strings, geometryType) {
  const props = { strings };
  return geometryType === "line"
    ? new BasicLineSymbolSetSource(props)
    : geometryType === "polygon"
      ? new BasicPolygonSymbolSetSource(props)
      : new BasicPointSymbolSetSource(props);
}
async function itemFetcher(options) {
  const portal = options.portal;
  const groupQuery = options.queries.group;
  const itemQuery = options.queries.item;
  const maxItems = 100;
  const { results } = await portal.queryGroups({ query: groupQuery, disableExtraQuery: true });
  if (results.length === 0) {
    return [];
  }
  const [group] = results;
  return (await group.queryItems({
    query: itemQuery,
    disableExtraQuery: true,
    num: maxItems,
    sortField: group.sortField
  })).results;
}
function hasKeyword(item, keyword) {
  return item.typeKeywords.indexOf(keyword) > -1;
}
function moveDefaultToFirst(results) {
  const sorted = [];
  results.forEach((set) => {
    if (hasKeyword(set, "default")) {
      sorted.unshift(set);
    }
    else {
      sorted.push(set);
    }
  });
  return sorted;
}

const cimGeometryItemType = {
  point: "pointSymbol",
  line: "lineSymbol",
  polygon: "polygonSymbol"
};
const isInterceptor = (portalOrPortalInterceptor) => !!portalOrPortalInterceptor.portal;
async function asyncFilter(items, predicate) {
  return Promise.all(items.map(predicate)).then((results) => items.filter((_item, index) => results[index]));
}
async function filterSymbolItems(source, symbolItems, markerType, geometryType, symbolType, filter) {
  const allowed = normalizeAllowedTypes(markerType);
  const defaultSourceFilter = symbolType === "2d"
    ? createDefaultSymbolItemFilter2d(geometryType, allowed)
    : createDefaultSymbolItemFilter3d(allowed);
  const effectiveFilter = async (symbolItem) => filter ? filter(symbolItem, source, defaultSourceFilter) : defaultSourceFilter(symbolItem, source);
  return asyncFilter(symbolItems, effectiveFilter);
}
function createDefaultSymbolItemFilter2d(geometryType, allowedTypes) {
  function symbolItemOnlyFilter(symbolItem) {
    if (allowedTypes.includes("all")) {
      return true;
    }
    const { data } = symbolItem;
    const { dimensionality, type: symbolType } = data;
    if (dimensionality === "volumetric") {
      return false;
    }
    if (geometryType === "point") {
      if (allowedTypes.includes("picture") && symbolType === "esriPMS") {
        return true;
      }
      if (allowedTypes.includes("simple") && symbolType === "esriSMS") {
        return true;
      }
    }
    if (geometryType === "line") {
      if (allowedTypes.includes("simple") && symbolType === "esriSLS") {
        return true;
      }
    }
    if (geometryType === "polygon") {
      if (allowedTypes.includes("simple") && symbolType === "esriSFS") {
        return true;
      }
    }
    const { formats } = data;
    if (hasCIMType(allowedTypes) && hasCIMType(formats)) {
      return true;
    }
    return false;
  }
  return async function defaultSymbolItemFilter2d(symbolItem, source) {
    const geometrySymbolFilter = geometryType === "point" ? _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.m : geometryType === "line" ? _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.j : _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.g;
    if (!symbolItemOnlyFilter(symbolItem)) {
      return false;
    }
    const hasPictureCIM = allowedTypes.includes("cim:picture");
    const hasVectorCIM = allowedTypes.includes("cim:vector");
    const hasAllOrNoCIMFilters = (hasPictureCIM && hasVectorCIM) || (!hasPictureCIM && !hasVectorCIM);
    // TODO: base on geomtype
    const isPointOnlyCimSource = hasCimPointKeyword(source) && !hasCimLineKeyword(source) && !hasCimPolygonKeyword(source);
    const isLineOnlyCimSource = hasCimLineKeyword(source) && !hasCimPointKeyword(source) && !hasCimPolygonKeyword(source);
    const isPolygonOnlyCimSource = hasCimPolygonKeyword(source) && !hasCimPointKeyword(source) && !hasCimLineKeyword(source);
    const requestedType = geometryType === "line"
      ? cimGeometryItemType.line
      : geometryType === "polygon"
        ? cimGeometryItemType.polygon
        : cimGeometryItemType.point;
    const isRequestedTypeCimSource = isPointOnlyCimSource || isLineOnlyCimSource || isPolygonOnlyCimSource;
    if ((isRequestedTypeCimSource && hasAllOrNoCIMFilters) ||
      source.type !== "web-style" ||
      symbolItem.data.itemType === requestedType) {
      return true;
    }
    const symbol = await symbolItem.getSymbol();
    // we only filter CIM symbols, the rest we let through
    return !(0,_color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.i)(symbol) || geometrySymbolFilter(symbol);
  };
}
function createDefaultSymbolItemFilter3d(allowedTypes) {
  return async function defaultSymbolItemFilter3d(symbolItem) {
    if (allowedTypes.includes("all") || allowedTypes.includes("3d")) {
      return true;
    }
    const { data: { dimensionality } } = symbolItem;
    return ((allowedTypes.includes("3d:flat") && dimensionality === "flat") ||
      (allowedTypes.includes("3d:volumetric") && dimensionality === "volumetric"));
  };
}
const geometryTypeKeywords = {
  point: "Point",
  line: "Line",
  polygon: "Polygon"
};
function hasCimPointKeyword({ keywords }) {
  return keywords.includes(geometryTypeKeywords.point) || keywords.includes("pointSymbol");
}
function hasMarkerKeyword({ keywords }) {
  return keywords.includes("marker");
}
function hasCimLineKeyword({ keywords }) {
  return keywords.includes(geometryTypeKeywords.line) || keywords.includes("lineSymbol");
}
function hasCimPolygonKeyword({ keywords }) {
  return keywords.includes(geometryTypeKeywords.polygon) || keywords.includes("polygonSymbol");
}
async function filterSources(sources, type, geometryType, symbolType, filter) {
  const allowed = normalizeAllowedTypes(type);
  const defaultSourceFilter = symbolType === "2d"
    ? createDefaultSymbolSourceFilter2d(geometryType, allowed)
    : createDefaultSymbolSourceFilter3d(allowed);
  const effectiveFilter = async (symbolSource) => filter ? filter(symbolSource, defaultSourceFilter) : defaultSourceFilter(symbolSource);
  return asyncFilter(sources, effectiveFilter);
}
function createDefaultSymbolSourceFilter2d(geometryType, allowedTypes) {
  return async (source) => {
    const is3d = source.keywords.includes("3d");
    const isDictionary = source.keywords.includes("Dictionary");
    const matchesGeometryType = geometryType === "point"
      ? hasCimPointKeyword(source) || hasMarkerKeyword(source)
      : geometryType === "line"
        ? hasCimLineKeyword(source)
        : hasCimPolygonKeyword(source);
    const hasAtLeastOneGeomKeyword = hasCimPointKeyword(source) ||
      hasMarkerKeyword(source) ||
      hasCimLineKeyword(source) ||
      hasCimPolygonKeyword(source);
    if (is3d || isDictionary || (!matchesGeometryType && hasAtLeastOneGeomKeyword)) {
      return false;
    }
    if (allowedTypes.includes("all")) {
      return true;
    }
    function getBasicSourceId() {
      return geometryType === "point"
        ? basicPointSymbolSetSourceId
        : geometryType === "line"
          ? basicLineSymbolSetSourceId
          : basicPolygonSymbolSetSourceId;
    }
    const basicSymbolSetSourceId = getBasicSourceId();
    if (allowedTypes.includes("picture") && source.id != basicSymbolSetSourceId && source.type === "symbol-set") {
      return true;
    }
    if (allowedTypes.includes("simple") && source.id === basicSymbolSetSourceId) {
      return true;
    }
    if (hasCIMType(allowedTypes) && source.type === "web-style") {
      return true;
    }
    return false;
  };
}
function isPortalSource(source) {
  return "portalItem" in source;
}
function createDefaultSymbolSourceFilter3d(allowedTypes) {
  const webStyleItemKeywordBlocklist = {
    EsriThematicShapesStyle: true
  };
  return async (source) => {
    if (source.keywords.every((keyword) => !webStyleItemKeywordBlocklist[keyword]) &&
      source.type === "web-style" &&
      (allowedTypes.includes("all") || allowedTypes.includes("3d"))) {
      return true;
    }
    if (isPortalSource(source)) {
      const data = await source.fetchData();
      const [first] = data.items;
      const { dimensionality } = first;
      return ((allowedTypes.includes("3d:flat") && dimensionality === "flat") ||
        (allowedTypes.includes("3d:volumetric") && dimensionality === "volumetric"));
    }
    return ((allowedTypes.includes("3d:flat") && source.id == "basic-web-style:flat") ||
      (allowedTypes.includes("3d:volumetric") && source.id == "basic-web-style:volumetric"));
  };
}
function hasCIMType(types) {
  return Array.isArray(types) && types.some((type) => type.includes("cim"));
}
function normalizeAllowedTypes(type = "all") {
  const types = Array.isArray(type) ? type : [type];
  const hasRedundantCIMTypes = types.find((type) => type === "cim" && types.find((type) => type.includes("cim:")));
  if (hasRedundantCIMTypes) {
    return types.filter((type) => !type.includes("cim:"));
  }
  return types;
}
async function fetchSources(portal, before, after, strings, type) {
  const interceptorData = {};
  if (before) {
    await before(portal, interceptorData);
  }
  await portal.load();
  const processedSources = await (type === "2d" ? build2dSources(portal, strings) : build3dSources(portal, strings));
  if (after) {
    await after(portal, interceptorData);
  }
  return processedSources;
}
async function build2dSources(portal, strings) {
  const originalSymbolSetsGroupQuery = portal.symbolSetsGroupQuery;
  portal.symbolSetsGroupQuery = 'owner:esri AND title:"Map Viewer Beta Symbols"';
  const [classic, sources] = await Promise.all([
    fetchSymbolSetSymbolSources(portal, strings),
    fetchWebStyleSymbolSources(portal, "2d", strings)
  ]);
  const filterOutBasicTypes = (source) => source.keywords.every((type) => type !== "Basic");
  const processedSources = [
    getBasic(strings, "point"),
    getBasic(strings, "line"),
    getBasic(strings, "polygon"),
    ...classic.filter(filterOutBasicTypes),
    ...sources.filter(filterOutBasicTypes)
  ];
  portal.symbolSetsGroupQuery = originalSymbolSetsGroupQuery;
  return processedSources;
}
async function build3dSources(portal, strings) {
  const [sources] = await Promise.all([fetchWebStyleSymbolSources(portal, "3d", strings)]);
  const filterOutBasicTypes = (source) => source.keywords.every((type) => type !== "Basic");
  const processedSources = [
    getPrimitives("flat", strings),
    getPrimitives("volumetric", strings),
    ...sources.filter(filterOutBasicTypes)
  ];
  return processedSources;
}

const arcgisSymbolPickerCss = ".scroller.sc-arcgis-symbol-picker{max-height:var(--scroller-max-height, min(100vh - 400px, 300px));overflow-y:auto;min-width:200px;overflow-x:hidden;display:flex;justify-content:center}.sc-arcgis-symbol-picker-h,.arcgis-symbol-picker__container.sc-arcgis-symbol-picker{display:flex;flex:1 1 auto;flex-flow:column nowrap;align-items:stretch}.categories.sc-arcgis-symbol-picker{display:flex;align-content:normal}.categories-center-action.sc-arcgis-symbol-picker{padding:0 5px}.marker-selection.sc-arcgis-symbol-picker{padding:8px}.marker-source-select.sc-arcgis-symbol-picker{width:calc(100% - 74px);display:block}.marker-source-select[hidden].sc-arcgis-symbol-picker+.marker-selection.sc-arcgis-symbol-picker{border-top:1px solid lightgray;background-color:var(--arcgis-app-background)}.marker-selection--dark.sc-arcgis-symbol-picker{background-color:var(--arcgis-app-foreground);color:var(--arcgis-app-background)}.empty-category-content.sc-arcgis-symbol-picker{display:flex;align-items:center;padding:var(--arcgis-app-spacing-half) var(--arcgis-app-spacing-quarter)}.incompatible-symbols-notice.sc-arcgis-symbol-picker{margin:8px 0}.marker-item.sc-arcgis-symbol-picker{height:40px;width:38.5px;display:flex;justify-content:center;align-items:center;background-color:var(--arcgis-app-background)}.marker-item.sc-arcgis-symbol-picker [slot=thumbnail].sc-arcgis-symbol-picker>div.sc-arcgis-symbol-picker{margin:8px 10px;display:flex;justify-content:center;align-items:center}.item-palette.sc-arcgis-symbol-picker{width:100%;display:flex;flex-direction:column}.file-upload.sc-arcgis-symbol-picker{margin-top:20px;width:auto}";

const CSS = {
  container: "arcgis-symbol-picker__container",
  markerSymbolContent: "marker-symbol-content",
  incompatibleSymbolsNotice: "incompatible-symbols-notice",
  emptyCategoryContent: "empty-category-content",
  markerSelectionDropdown: "marker-source-select",
  markerSelection: "marker-selection",
  markerSelectionDark: "marker-selection--dark",
  scroller: "scroller",
  itemPalette: "item-palette",
  fileUpload: "file-upload",
  categories: "categories",
  categoriesCenterAction: "categories-center-action"
};
const ArcgisSymbolPicker = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisActiveSymbolChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisActiveSymbolChange", 7);
    this.arcgisActiveSymbolItemChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisActiveSymbolItemChange", 7);
    this.arcgisActiveSourceIdChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisActiveSourceIdChange", 7);
    this.arcgisSymbolSourcesChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSymbolSourcesChange", 7);
    this.arcgisActiveSourceItemsChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisActiveSourceItemsChange", 7);
    this.allCustomFileInfos = [];
    this.customSymbolsStorageId = "arcgis-symbol-picker-custom-symbols";
    this.actionEls = [];
    this._onSymbolSourceChange = (event) => {
      const dropdown = event.currentTarget;
      const { selectedItems } = dropdown;
      const mostRecentSelection = selectedItems.find((item) => item.getAttribute("data-value") !== this._activeSourceId);
      this._activeSourceId = (mostRecentSelection === null || mostRecentSelection === void 0 ? void 0 : mostRecentSelection.getAttribute("data-value")) || this._activeSourceId;
      dropdown
        .querySelectorAll("calcite-dropdown-item")
        .forEach((item) => {
        if (item !== mostRecentSelection) {
          item.selected = false;
        }
      });
      event.stopPropagation();
    };
    this.symbol = undefined;
    this.portal = undefined;
    this.symbolFilter = undefined;
    this.activeSourceId = undefined;
    this.activeSymbolItem = undefined;
    this.hideHeader = false;
    this.symbolType = "2d";
    this.customSymbolItemFilter = undefined;
    this.customSymbolSourceFilter = undefined;
    this.itemsPerRow = 4;
    this.symbolSources = undefined;
    this.activeSymbolItems = undefined;
    this.messages = undefined;
    this._activeSourceId = undefined;
    this._symbolSources = undefined;
    this._activeSymbolItems = undefined;
    this.customSymbolError = undefined;
    this.isGridView = true;
    this._activeSymbolFetch = undefined;
  }
  /**
   * Whenever the activeSource changes, we fetch
   * the new symbol items for that sources.
   */
  handleActiveSourceItemIdChanges() {
    if (this._activeSourceId) {
      this._activeSourceId === "custom-symbol-set"
        ? this._setupCustomSymbols()
        : this._fetchAndSetUpSymbolItems(this._symbolSources.find(({ id }) => id === this._activeSourceId));
    }
  }
  get editGeometry() {
    return (0,_color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.h)(this.symbol);
  }
  handleFileUploadChange({ detail }) {
    const fileInfo = detail;
    const cimStr = fileInfo.cim && JSON.stringify(fileInfo.cim.toJSON());
    if (fileInfo.dataURL && fileInfo.dataURL.length > 200000) {
      this.customSymbolError = "too-large";
      return;
    }
    else if (fileInfo.cim && cimStr.length > 200000) {
      this.customSymbolError = "too-large";
      return;
    }
    else {
      this.customSymbolError = undefined;
    }
    const foundFileInfo = this.allCustomFileInfos.find((info) => (fileInfo.dataURL &&
      info.dataURL &&
      info.dataURL === fileInfo.dataURL &&
      info.fileName === fileInfo.fileName) ||
      (fileInfo.cim &&
        info.cim &&
        info.fileName === fileInfo.fileName &&
        cimStr === JSON.stringify(info.cim.toJSON())));
    try {
      let activeSymbolItem;
      if (!foundFileInfo) {
        const allCustomFileInfos = [...this.allCustomFileInfos, fileInfo];
        (0,_storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_3__.s)(this.customSymbolsStorageId, allCustomFileInfos.map((info) => info.dataURL ? info : Object.assign(Object.assign({}, info), { cim: JSON.stringify(info.cim.toJSON()) })), true);
        this.allCustomFileInfos = allCustomFileInfos;
        this._setupCustomSymbols();
        activeSymbolItem = this._activeSymbolItems[this._activeSymbolItems.length - 1];
      }
      else {
        activeSymbolItem = this._activeSymbolItems.find((symbolItem) => symbolItem.data.name === foundFileInfo.fileName);
      }
      // select active symbol
      this.activeSymbolItem = activeSymbolItem;
      this.arcgisActiveSymbolItemChange.emit(this.activeSymbolItem);
      this.activeSymbolItem
        .getSymbol()
        .then((symbol) => this.arcgisActiveSymbolChange.emit(symbol));
      setTimeout(() => requestAnimationFrame(() => {
        var _a;
        (_a = this.itemPaletteNode) === null || _a === void 0 ? void 0 : _a.setFocus();
        this.updateListSelection();
      }), 1);
    }
    catch (e) {
      // e.name === QuotaExceededError
      this.customSymbolError = "storage-full";
    }
  }
  handleInvalidFile() {
    this.customSymbolError = "invalid-file";
  }
  handleFileUploadError() {
    this.customSymbolError = "error";
  }
  //--------------------------------------------------------------------------
  //
  //  Private Methods
  //
  //--------------------------------------------------------------------------
  _renderSymbolSourceOptions(sources, activeSourceId) {
    const { messages: mergedStrings } = this;
    const classic = sources.filter((source) => source.type === "symbol-set");
    const webStyles = sources.filter((source) => source.type === "web-style");
    const showCustomSymbols = !this.symbolFilter ||
      !!(Array.isArray(this.symbolFilter) ? this.symbolFilter : [this.symbolFilter]).find((type) => type === "custom" || type === "picture");
    const customGroup = this.symbolType !== "3d" &&
      this.editGeometry === "point" &&
      showCustomSymbols && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { groupTitle: mergedStrings.customSymbols, selectionMode: "multiple", key: "custom" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { key: "custom", "data-value": "custom-symbol-set", selected: "custom-symbol-set" === activeSourceId }, mergedStrings.symbols)));
    const classicGroup = classic.length > 0 && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { groupTitle: mergedStrings.classicSymbols, selectionMode: "multiple", key: "classic" }, this._renderSourceDropdownItem(classic, activeSourceId)));
    const webStyleGroup = webStyles.length > 0 && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { groupTitle: mergedStrings.newSymbols, selectionMode: "multiple", key: "webstyles" }, this._renderSourceDropdownItem(webStyles, activeSourceId)));
    if (customGroup) {
      if (classicGroup) {
        if (webStyleGroup) {
          return [customGroup, classicGroup, webStyleGroup];
        }
        else {
          return [customGroup, classicGroup];
        }
      }
      else {
        return [customGroup, webStyleGroup];
      }
    }
    else if (classicGroup && webStyleGroup) {
      return [classicGroup, webStyleGroup];
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { key: "one-group" }, this._renderSourceDropdownItem([...classic, ...webStyles], activeSourceId)));
  }
  _renderSourceDropdownItem(sources, activeSourceId) {
    return sources.map((source) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { key: source.id, "data-value": source.id, selected: source.id === activeSourceId }, source.title)));
  }
  _setupCustomSymbols() {
    const existingSymbolItems = this.allCustomFileInfos.map((info) => {
      let width = 24;
      let height = 24;
      if (info.width > info.height) {
        height = Math.round((width / info.width) * info.height);
      }
      else if (info.width < info.height) {
        width = Math.round((height / info.height) * info.width);
      }
      if (info.dataURL) {
        const type = info.fileName.split(".")[1].toLowerCase();
        const contentType = type === "png" ? "image/png" : type === "gif" ? "image/gif" : "image/jpeg";
        return new SymbolItem({
          data: {
            angle: 0,
            contentType,
            height,
            imageData: info.dataURL.split(",")[1],
            name: info.fileName,
            type: "esriPMS",
            url: info.fileName,
            width,
            xoffset: 0,
            yoffset: 0
          },
          parentData: null,
          portalItem: null,
          strategy: flatSymbolStrategy,
          strings: this.messages
        });
      }
      else {
        return new SymbolItem({
          data: {
            symbol: info.cim,
            name: info.fileName
          },
          parentData: { cimVersion: "2.6.0" },
          portalItem: null,
          strategy: webStyleCustomSymbolStrategy(),
          strings: this.messages
        });
      }
    });
    this.setUpSymbolIntersectionObserver();
    this.customSymbolError = undefined;
    this._activeSymbolFetch = null;
    this._activeSymbolItems = existingSymbolItems;
    //if (this._activeSourceId !== "custom-symbol-set") {
    this.arcgisActiveSourceIdChange.emit("custom-symbol-set");
    //}
    this.arcgisActiveSourceItemsChange.emit(existingSymbolItems.map((item) => new SymbolItem(Object.assign({}, item))));
  }
  async _fetchAndSetUpSymbolItems(source) {
    if (this._activeSymbolFetch) {
      this._activeSymbolFetch.controller.abort();
    }
    const controller = new AbortController();
    const signal = controller.signal;
    this._activeSymbolFetch = {
      controller,
      id: source.id
    };
    // When loading for the first time, we check if there are some symbolItems passed
    // to the props and we trust it's the correct one for the current activeSymbolSource
    const symbolItems = (!this._activeSymbolItems && this.activeSymbolItems) || (await source.getItems(controller));
    if (signal === null || signal === void 0 ? void 0 : signal.aborted) {
      return;
    }
    const filteredSymbolItems = await filterSymbolItems(source, symbolItems, this.symbolFilter, this.editGeometry, this.symbolType, this.customSymbolItemFilter);
    if (signal === null || signal === void 0 ? void 0 : signal.aborted) {
      return;
    }
    this.setUpSymbolIntersectionObserver();
    this.customSymbolError = undefined;
    this._activeSymbolFetch = null;
    this._activeSymbolItems = filteredSymbolItems;
    this.arcgisActiveSourceIdChange.emit(this._activeSourceId);
    this.arcgisActiveSourceItemsChange.emit(filteredSymbolItems.map((item) => new SymbolItem(Object.assign({}, item))));
  }
  onIncompatibleVectorSymbolsDismiss(event) {
    (0,_localStorage_f63100ef_js__WEBPACK_IMPORTED_MODULE_2__.s)(_localStorage_f63100ef_js__WEBPACK_IMPORTED_MODULE_2__.l.ARCGIS_COMPONENT_NOTIFICATIONS, {
      key: _localStorage_f63100ef_js__WEBPACK_IMPORTED_MODULE_2__.a.INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED,
      value: "true"
    });
    event.stopPropagation();
  }
  tearDownSymbolIntersectionObserver() {
    var _a;
    (_a = this._symbolIntersectionObserver) === null || _a === void 0 ? void 0 : _a.disconnect();
    this._symbolIntersectionObserver = null;
  }
  setUpSymbolIntersectionObserver() {
    this.tearDownSymbolIntersectionObserver();
    let nowServingIndex = 0;
    const pendingAppends = {};
    this._symbolIntersectionObserver = new IntersectionObserver((entries, observer) => {
      function next() {
        nowServingIndex++;
        if (pendingAppends[nowServingIndex]) {
          pendingAppends[nowServingIndex]();
          delete pendingAppends[nowServingIndex];
          next();
        }
      }
      entries.forEach((entry) => {
        if (!entry.isIntersecting) {
          return;
        }
        const node = entry.target;
        node.item.getThumbnail(node).then((appendThumbnail) => {
          if (node.index === nowServingIndex) {
            appendThumbnail();
            next();
          }
          else {
            pendingAppends[node.index] = appendThumbnail;
          }
        });
        node.item.getSymbol();
        observer.unobserve(node);
      });
    });
  }
  async _fetchSources() {
    if (this._sourcesFetchController) {
      this._sourcesFetchController.abort();
    }
    this._sourcesFetchController = new AbortController();
    const signal = this._sourcesFetchController.signal;
    const portal = this.portal;
    const effectivePortal = isInterceptor(portal) ? portal.portal : portal;
    const beforeInterceptor = isInterceptor(portal) ? portal.before : null;
    const afterInterceptor = isInterceptor(portal) ? portal.after : null;
    const symbolSources = effectivePortal
      ? this.symbolSources ||
        (await fetchSources(effectivePortal, beforeInterceptor, afterInterceptor, this.messages, this.symbolType))
      : [];
    if (signal === null || signal === void 0 ? void 0 : signal.aborted) {
      return;
    }
    this._symbolSources = await filterSources(symbolSources, this.symbolFilter, (0,_color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.h)(this.symbol), this.symbolType, this.customSymbolSourceFilter);
    this.arcgisSymbolSourcesChange.emit(this._symbolSources);
    if (!this._activeSourceId) {
      let activeSourceId = this.activeSourceId;
      if (activeSourceId) {
        const activeSource = this._symbolSources.find((source) => source.id === this.activeSourceId);
        if (!activeSource) {
          // maybe different symbol geometry type now; can't re-use last source
          activeSourceId = undefined;
        }
      }
      this._activeSourceId = activeSourceId || this._symbolSources[0].id;
    }
  }
  _getCustomSymbolsFromStorage() {
    if (this.symbolType === "3d" || this.editGeometry !== "point") {
      return;
    }
    const fileInfos = (0,_storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_3__.g)(this.customSymbolsStorageId, true);
    if (fileInfos) {
      this.allCustomFileInfos = fileInfos.map((info) => info.dataURL ? info : Object.assign(Object.assign({}, info), { cim: _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.CIMSymbol.fromJSON(JSON.parse(info.cim)) }));
    }
  }
  _renderSourceSelection() {
    const { messages: mergedStrings } = this;
    const sources = this._symbolSources;
    if (!sources) {
      return;
    }
    const activeSource = this._symbolSources.find((source) => source.id === this._activeSourceId);
    const activeSourceTitle = this._activeSourceId === "custom-symbol-set"
      ? mergedStrings.customSymbols
      : activeSource === null || activeSource === void 0 ? void 0 : activeSource.title;
    const hasSingleSource = sources.length === 1;
    const dropdown = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown", { class: {
        [CSS.markerSelectionDropdown]: true
      }, hidden: hasSingleSource, maxItems: 7, onCalciteDropdownSelect: this._onSymbolSourceChange, overlayPositioning: "absolute" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { alignment: "space-between", appearance: "outline-fill", kind: "neutral", iconEnd: "chevron-down", scale: "m", slot: "trigger", width: "full" }, activeSourceTitle), this._renderSymbolSourceOptions(sources, this._activeSourceId)));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section", key: "header" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "section" }, !this.hideHeader ? this.messages.category : null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.categories }, dropdown, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { active: this.isGridView, appearance: "transparent", icon: "grid", scale: "s", class: CSS.categoriesCenterAction, text: this.messages.gridView, onClick: () => {
        this.isGridView = true;
        (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.el);
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { active: !this.isGridView, appearance: "transparent", icon: "list", iconFlipRtl: true, scale: "s", text: this.messages.listView, onClick: () => {
        this.isGridView = false;
        (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.el);
      } })))));
  }
  _renderItemSelection() {
    const { portal, messages: mergedStrings } = this;
    const fetchingSymbolItems = this._activeSymbolFetch;
    const effectivePortal = isInterceptor(portal) ? portal.portal : portal;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
        [CSS.scroller]: true,
        [CSS.markerSelection]: true
      }, key: "gallery" }, fetchingSymbolItems ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: "" })) : this._activeSymbolItems.length === 0 && this._activeSourceId === "custom-symbol-set" ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-symbol-picker-file-upload", { portal: effectivePortal, strings: mergedStrings })) : this._activeSymbolItems.length > 0 ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.itemPalette, key: this._activeSymbolItems.length }, this.isGridView ? this._renderGridView() : this._renderListView(), this._activeSourceId === "custom-symbol-set" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-symbol-picker-file-upload", { class: CSS.fileUpload, portal: effectivePortal, strings: mergedStrings })))) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.emptyCategoryContent }, this.messages.noSymbolsAvailable))));
  }
  _renderGridView() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-palette", { key: this._activeSourceId, items: this._activeSymbolItems.map((item, index) => ({
        item,
        index,
        observer: this._symbolIntersectionObserver
      })), ItemRenderer: MarkerItem, itemsPerRow: this.itemsPerRow, selected: ({ item }) => { var _a; return (item === null || item === void 0 ? void 0 : item.data) === ((_a = this.activeSymbolItem) === null || _a === void 0 ? void 0 : _a.data); }, onArcgisItemSelect: (event) => {
        const { detail: { item } } = event;
        this.customSymbolError = undefined;
        // This is just for the UI to remember which element is selected
        this.arcgisActiveSymbolItemChange.emit(item);
        this.activeSymbolItem = item;
        // Send back the actual symbol:
        item
          .getSymbol()
          .then((symbol) => this.arcgisActiveSymbolChange.emit(symbol));
        event.stopPropagation();
      }, ref: (node) => (this.itemPaletteNode = node) }));
  }
  _renderListView() {
    const isRtl = (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_5__.g)(this.el) === "rtl";
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { key: this._activeSourceId }, this._activeSymbolItems.map((item, index) => {
      var _a;
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { key: index, label: item.data.title || item.data.name, value: index, selected: ((_a = this.activeSymbolItem) === null || _a === void 0 ? void 0 : _a.data.name) === item.data.name, onCalciteListItemSelect: (event) => {
          const node = event.target;
          const selectedItem = this._activeSymbolItems[node.value];
          this.customSymbolError = undefined;
          // This is just for the UI to remember which element is selected
          this.arcgisActiveSymbolItemChange.emit(selectedItem);
          this.activeSymbolItem = selectedItem;
          // Send back the actual symbol:
          selectedItem
            .getSymbol()
            .then((symbol) => this.arcgisActiveSymbolChange.emit(symbol));
          event.stopPropagation();
        } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "actions-start", key: item.data.name, ref: (divNode) => {
          if (divNode) {
            item.getThumbnail(divNode).then((appendThumbnail) => appendThumbnail());
            item.getSymbol();
          }
        } }), this._activeSourceId === "custom-symbol-set" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "actions-end", appearance: "transparent", text: this.messages.removeSymbol, ref: (node) => {
          if (node) {
            this.actionEls[index] = node;
          }
        }, onClick: () => {
          this.removeCustomSymbol(index);
          (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.el);
        }, onMouseOver: () => this.addTooltip({
          referenceElement: this.actionEls[index],
          placement: isRtl ? "right-start" : "left-start",
          innerHTML: this.messages.removeSymbol
        }), onMouseOut: () => this.removeTooltip() }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "x" })))));
    })));
  }
  updateListSelection() {
    console.log("updateListSelection");
    this.el
      .querySelectorAll("CALCITE-LIST-ITEM")
      .forEach((listItem) => {
      listItem.selected = listItem.value === this.activeSymbolItem.data.name;
      if (listItem.selected) {
        listItem.setFocus();
      }
    });
  }
  removeCustomSymbol(index) {
    this.allCustomFileInfos.splice(index, 1);
    (0,_storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_3__.s)(this.customSymbolsStorageId, this.allCustomFileInfos.map((info) => info.dataURL ? info : Object.assign(Object.assign({}, info), { cim: JSON.stringify(info.cim.toJSON()) })), true);
    this._setupCustomSymbols();
    this.activeSymbolItem = undefined;
  }
  addTooltip(props) {
    this.removeTooltip();
    this.tooltipEl = document.createElement("calcite-tooltip");
    this.tooltipEl.placement = props.placement || "auto";
    this.tooltipEl.referenceElement = props.referenceElement;
    this.tooltipEl.overlayPositioning = "fixed";
    this.tooltipEl.innerHTML = props.innerHTML;
    this.tooltipEl.open = true;
    // it won't show if just added to this.el
    this.el.parentElement.appendChild(this.tooltipEl);
  }
  removeTooltip() {
    var _a;
    if ((_a = this.tooltipEl) === null || _a === void 0 ? void 0 : _a.parentNode) {
      this.tooltipEl.parentNode.removeChild(this.tooltipEl);
      this.tooltipEl = undefined;
    }
  }
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  async componentWillLoad() {
    const [, [strings]] = await Promise.all([
      _color_776689e9_js__WEBPACK_IMPORTED_MODULE_1__.e.load(),
      (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_4__.g)(this.el)
    ]);
    this.messages = strings;
  }
  componentDidLoad() {
    if (!this._symbolSources) {
      this._fetchSources();
    }
    this._getCustomSymbolsFromStorage();
  }
  connectedCallback() {
    var _a, _b;
    this.setUpSymbolIntersectionObserver();
    (_a = this._activeSymbolFetch) === null || _a === void 0 ? void 0 : _a.controller.abort();
    (_b = this._sourcesFetchController) === null || _b === void 0 ? void 0 : _b.abort();
  }
  disconnectedCallback() {
    this.tearDownSymbolIntersectionObserver();
  }
  render() {
    const sources = this._symbolSources;
    const fetchingSymbolItems = this._activeSymbolFetch;
    if (!sources || fetchingSymbolItems) {
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.container }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: "" })));
    }
    const activeSourceIsSMS = this._activeSourceId === "basic-symbol-set" || this._activeSourceId === "custom-symbol-set";
    const activeSource = this._symbolSources.find((source) => source.id === this._activeSourceId);
    const modernSymbolCategorySelected = !activeSourceIsSMS && (activeSource === null || activeSource === void 0 ? void 0 : activeSource.type) !== "symbol-set";
    const adobeSymbolCategorySelected = activeSource === null || activeSource === void 0 ? void 0 : activeSource.keywords.includes("Adobe");
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.container }, this._renderSourceSelection(), this._renderItemSelection(), adobeSymbolCategorySelected ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { open: true, kind: "danger", key: "copyright", scale: "s" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message", innerHTML: this.messages.adobeCopyright.replace("${year}", "2022") }))) : null, modernSymbolCategorySelected &&
      this.symbolType !== "3d" &&
      !(0,_localStorage_f63100ef_js__WEBPACK_IMPORTED_MODULE_2__.g)(_localStorage_f63100ef_js__WEBPACK_IMPORTED_MODULE_2__.l.ARCGIS_COMPONENT_NOTIFICATIONS, _localStorage_f63100ef_js__WEBPACK_IMPORTED_MODULE_2__.a.INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED) ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { open: true, class: CSS.incompatibleSymbolsNotice, closable: true, icon: true, key: "incompatible-symbols", onCalciteNoticeClose: this.onIncompatibleVectorSymbolsDismiss, scale: "s" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, this.messages.incompatibleSymbolWarning))) : null, this.customSymbolError ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { open: true, class: CSS.incompatibleSymbolsNotice, closable: true, icon: "exclamation-mark-circle", kind: "danger", key: "large-symbol", onCalciteNoticeClose: () => (this.customSymbolError = undefined), scale: "s" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, this.customSymbolError === "too-large"
      ? this.messages.customSymbolErrors.tooLarge
      : this.customSymbolError === "invalid-file"
        ? this.messages.customSymbolErrors.invalidFile
        : this.customSymbolError === "storage-full"
          ? this.messages.customSymbolErrors.outOfSpace
          : this.customSymbolError === "error"
            ? this.messages.customSymbolErrors.error
            : undefined))) : null));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "_activeSourceId": ["handleActiveSourceItemIdChanges"]
  }; }
};
ArcgisSymbolPicker.style = arcgisSymbolPickerCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/localStorage-f63100ef.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/localStorage-f63100ef.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ arcgisComponentNotificationsKeys),
/* harmony export */   g: () => (/* binding */ getSingleObjectLocalStorage),
/* harmony export */   l: () => (/* binding */ localStorageKeys),
/* harmony export */   s: () => (/* binding */ setSingleObjectLocalStorage)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
var localStorageKeys;
(function (localStorageKeys) {
  localStorageKeys["ARCGIS_COMPONENT_NOTIFICATIONS"] = "arcgisComponent_notifications";
})(localStorageKeys || (localStorageKeys = {}));
var arcgisComponentNotificationsKeys;
(function (arcgisComponentNotificationsKeys) {
  arcgisComponentNotificationsKeys["FEATURE_REDUCTION_WARNING_DISMISSED"] = "arcgis_feature_reduction_warning_dismissed";
  arcgisComponentNotificationsKeys["POPUP_WARNING_DISMISSED"] = "arcgis_popup_warning_dismissed";
  arcgisComponentNotificationsKeys["INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED"] = "arcgis_symbol_styler_incompatible_vector_symbols_dismissed";
  arcgisComponentNotificationsKeys["EFFECTS_TIP_DISMISSED"] = "arcgis_effects_tip_dismissed";
  arcgisComponentNotificationsKeys["LAYER_VIEW_DEFINITION_DISMISSED"] = "arcgis_layer_view_definition_dismissed";
  arcgisComponentNotificationsKeys["LAYER_OVERRIDE_STATUS_TIP_DISMISSED"] = "arcgis_layer_override_status_tip_dismissed";
  arcgisComponentNotificationsKeys["LAYER_VIEW_JOIN_TIP_DISMISSED"] = "arcgis_layer_view_join_tip_dismissed";
  arcgisComponentNotificationsKeys["MULTIDIMENSIONAL_INFO_TIP_DISMISSED"] = "arcgis_multidimensional_info_tip_dismissed";
})(arcgisComponentNotificationsKeys || (arcgisComponentNotificationsKeys = {}));
const getLocalStorage = (localStorageKey) => {
  return localStorage.getItem(localStorageKey);
};
const setLocalStorage = (localStorageKey, value) => {
  localStorage.setItem(localStorageKey, value);
};
const getObjectLocalStorage = (localStorageKey) => {
  return JSON.parse(getLocalStorage(localStorageKey)) || {};
};
const setSingleObjectLocalStorage = (localStorageKey, keyValueObject) => {
  const setLocalStorageVal = getObjectLocalStorage(localStorageKey);
  setLocalStorageVal[keyValueObject.key] = keyValueObject.value;
  setLocalStorage(localStorageKey, JSON.stringify(setLocalStorageVal));
};
const getSingleObjectLocalStorage = (localStorageKey, objectKey) => {
  const getLocalStorageVal = getObjectLocalStorage(localStorageKey);
  if (getLocalStorageVal === null || getLocalStorageVal === void 0 ? void 0 : getLocalStorageVal.hasOwnProperty(objectKey)) {
    return getLocalStorageVal[objectKey];
  }
  else {
    return null;
  }
};




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getCookie),
/* harmony export */   b: () => (/* binding */ setCookie),
/* harmony export */   c: () => (/* binding */ setSessionStorageItem),
/* harmony export */   d: () => (/* binding */ getSessionStorageItem),
/* harmony export */   g: () => (/* binding */ getLocalStorageItem),
/* harmony export */   s: () => (/* binding */ setLocalStorageItem)
/* harmony export */ });
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


// import stringUtil from "./strings";
/**
 * Utility methods for dealing with storage of various forms (cookies, local storage, and session storage).
 */
function setCookie(name, cookie, properties, stringify) {
  writeCookie(name, stringify ? JSON.stringify(cookie) : cookie, properties);
}
function getCookie(name, parse) {
  const cookie = readCookie(name);
  return cookie && parse ? JSON.parse(cookie) : cookie;
}
function setLocalStorageItem(name, item, stringify) {
  window.localStorage.setItem(name, stringify ? JSON.stringify(item) : item);
}
function getLocalStorageItem(name, parse) {
  const item = window.localStorage.getItem(name);
  return item && parse ? JSON.parse(item) : item;
}
function setSessionStorageItem(name, item, stringify) {
  window.sessionStorage.setItem(name, stringify ? JSON.stringify(item) : item);
}
function getSessionStorageItem(name, parse) {
  const item = window.sessionStorage.getItem(name);
  return item && parse ? JSON.parse(item) : item;
}
function readCookie(name) {
  const cookie = document.cookie;
  const cookieNameRE = new RegExp(`(?:^|; )${(0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_0__.e)(name)}=([^;]*)`);
  const matchedCookies = cookie.match(cookieNameRE);
  return matchedCookies ? decodeURIComponent(matchedCookies[1]) : undefined;
}
function writeCookie(name, value, properties) {
  properties = properties || {};
  let expires = properties === null || properties === void 0 ? void 0 : properties.expires;
  if (typeof expires === "number") {
    const expirationDate = new Date();
    const daysFromTodayInMs = expires * 24 * 60 * 60 * 1000;
    expirationDate.setTime(Date.now() + daysFromTodayInMs);
    expires = properties.expires = expirationDate;
  }
  if (typeof expires !== "string" && (expires === null || expires === void 0 ? void 0 : expires.toUTCString)) {
    properties.expires = expires.toUTCString();
  }
  let cookie = `${name}=${encodeURIComponent(value)}`;
  let property;
  for (property in properties) {
    cookie += `; ${property}`;
    const propertyValue = properties[property];
    if (propertyValue !== true) {
      cookie += `=${propertyValue}`;
    }
  }
  document.cookie = cookie;
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTliYWJjZC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDb0g7QUFDeUM7QUFDaUI7QUFDbkY7QUFDckI7QUFDTjtBQUM3QjtBQUNEO0FBQ1A7O0FBRTNCO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNM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aWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLXN5bWJvbC1waWNrZXIuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbG9jYWxTdG9yYWdlLWY2MzEwMGVmLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3N0b3JhZ2UtZDdmNTgyMmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBoLCByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGYgYXMgZm9yY2VVcGRhdGUsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtOTJlYmIzOTYuanMnO1xuaW1wb3J0IHsgZSBhcyBlc3JpTW9kdWxlcywgaCBhcyBnZW9tZXRyeVR5cGUsIGQgYXMgY3JlYXRlLCBnIGFzIGlzUG9seWdvbkNJTSwgaiBhcyBpc0xpbmVDSU0sIGkgYXMgaXNDSU1TeW1ib2wsIG0gYXMgaXNQb2ludENJTSB9IGZyb20gJy4vY29sb3ItNzc2Njg5ZTkuanMnO1xuaW1wb3J0IHsgcyBhcyBzZXRTaW5nbGVPYmplY3RMb2NhbFN0b3JhZ2UsIGcgYXMgZ2V0U2luZ2xlT2JqZWN0TG9jYWxTdG9yYWdlLCBhIGFzIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzLCBsIGFzIGxvY2FsU3RvcmFnZUtleXMgfSBmcm9tICcuL2xvY2FsU3RvcmFnZS1mNjMxMDBlZi5qcyc7XG5pbXBvcnQgeyBzIGFzIHNldExvY2FsU3RvcmFnZUl0ZW0sIGcgYXMgZ2V0TG9jYWxTdG9yYWdlSXRlbSB9IGZyb20gJy4vc3RvcmFnZS1kN2Y1ODIyZS5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgfSBmcm9tICcuL2xvY2FsZS0xM2UwMGE3NS5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEVsZW1lbnREaXIgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC0yMjI1OGM5MC5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYWFmMzBiZDYuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtYzgyZjVhYjkuanMnO1xuaW1wb3J0ICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5cbmZ1bmN0aW9uIGdldEluamVjdGVkUmVxdWVzdE9wdGlvbnMoaXRlbSkge1xuICAvLyBoYWNrIHRvIGluamVjdCBhdXRoTW9kZSBpbnRvIHJlcXVlc3Qgb3B0aW9uc1xuICByZXR1cm4geyBhdXRoTW9kZTogaXRlbS5hY2Nlc3MgPT09IFwicHVibGljXCIgPyBcImFub255bW91c1wiIDogXCJhdXRvXCIgfTtcbn1cbmNvbnN0IEJBU0lDX1NJTVBMRV9NQVJLRVJfU1lNQk9MU19KU09OID0gW1xuICB7XG4gICAgbmFtZTogXCJDaXJjbGVcIixcbiAgICB0eXBlOiBcImVzcmlTTVNcIixcbiAgICBzdHlsZTogXCJlc3JpU01TQ2lyY2xlXCIsXG4gICAgY29sb3I6IFswLCAwLCAxMjgsIDEyOF0sXG4gICAgc2l6ZTogMTgsXG4gICAgb3V0bGluZToge1xuICAgICAgY29sb3I6IFswLCAwLCAxMjgsIDI1NV0sXG4gICAgICB3aWR0aDogMVxuICAgIH1cbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiU3F1YXJlXCIsXG4gICAgdHlwZTogXCJlc3JpU01TXCIsXG4gICAgc3R5bGU6IFwiZXNyaVNNU1NxdWFyZVwiLFxuICAgIGNvbG9yOiBbMCwgMCwgMTI4LCAxMjhdLFxuICAgIHNpemU6IDE4LFxuICAgIG91dGxpbmU6IHtcbiAgICAgIGNvbG9yOiBbMCwgMCwgMTI4LCAyNTVdLFxuICAgICAgd2lkdGg6IDFcbiAgICB9XG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkRpYW1vbmRcIixcbiAgICB0eXBlOiBcImVzcmlTTVNcIixcbiAgICBzdHlsZTogXCJlc3JpU01TRGlhbW9uZFwiLFxuICAgIGNvbG9yOiBbMCwgMCwgMTI4LCAxMjhdLFxuICAgIHNpemU6IDE4LFxuICAgIG91dGxpbmU6IHtcbiAgICAgIGNvbG9yOiBbMCwgMCwgMTI4LCAyNTVdLFxuICAgICAgd2lkdGg6IDFcbiAgICB9XG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIlRyaWFuZ2xlXCIsXG4gICAgdHlwZTogXCJlc3JpU01TXCIsXG4gICAgc3R5bGU6IFwiZXNyaVNNU1RyaWFuZ2xlXCIsXG4gICAgY29sb3I6IFswLCAwLCAxMjgsIDEyOF0sXG4gICAgc2l6ZTogMTgsXG4gICAgb3V0bGluZToge1xuICAgICAgY29sb3I6IFswLCAwLCAxMjgsIDI1NV0sXG4gICAgICB3aWR0aDogMVxuICAgIH1cbiAgfSAvKiAsXG4gIHtcbiAgICBuYW1lOiBcIkNyb3NzXCIsXG4gICAgdHlwZTogXCJlc3JpU01TXCIsXG4gICAgc3R5bGU6IFwiZXNyaVNNU0Nyb3NzXCIsXG4gICAgY29sb3I6IFswLCAwLCAxMjgsIDEyOF0sXG4gICAgc2l6ZTogMTgsXG4gICAgb3V0bGluZToge1xuICAgICAgY29sb3I6IFswLCAwLCAxMjgsIDI1NV0sXG4gICAgICB3aWR0aDogMVxuICAgIH1cbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiWFwiLFxuICAgIHR5cGU6IFwiZXNyaVNNU1wiLFxuICAgIHN0eWxlOiBcImVzcmlTTVNYXCIsXG4gICAgY29sb3I6IFswLCAwLCAxMjgsIDEyOF0sXG4gICAgc2l6ZTogMTgsXG4gICAgb3V0bGluZToge1xuICAgICAgY29sb3I6IFswLCAwLCAxMjgsIDI1NV0sXG4gICAgICB3aWR0aDogMVxuICAgIH1cbiAgfSAqL1xuXTtcbmNvbnN0IEJBU0lDX1NJTVBMRV9MSU5FX1NZTUJPTFNfSlNPTiA9IFtcbiAge1xuICAgIHR5cGU6IFwiZXNyaVNMU1wiLFxuICAgIGNvbG9yOiBbMCwgMCwgMCwgMjU1XSxcbiAgICB3aWR0aDogMC43NSxcbiAgICBzdHlsZTogXCJlc3JpU0xTU29saWRcIlxuICB9XG5dO1xuY29uc3QgQkFTSUNfU0lNUExFX1BPTFlHT05fU1lNQk9MU19KU09OID0gW1xuICB7XG4gICAgdHlwZTogXCJlc3JpU0ZTXCIsXG4gICAgY29sb3I6IFswLCAwLCAwLCA2NF0sXG4gICAgb3V0bGluZToge1xuICAgICAgdHlwZTogXCJlc3JpU0xTXCIsXG4gICAgICBjb2xvcjogWzAsIDAsIDAsIDI1NV0sXG4gICAgICB3aWR0aDogMC43NSxcbiAgICAgIHN0eWxlOiBcImVzcmlTTFNTb2xpZFwiXG4gICAgfSxcbiAgICBzdHlsZTogXCJlc3JpU0ZTU29saWRcIlxuICB9XG5dO1xuY29uc3Qgc3ltYm9sSGVpZ2h0QXNNYWluQXhpcyA9IDEwO1xuY29uc3Qgc3ltYm9sUmFkaXVzRml4ZWQgPSA1O1xuZnVuY3Rpb24gZ2VuZXJhdGVJY29uUHJpbWl0aXZlU3ltYm9sSnNvbihzdHJpbmdzKSB7XG4gIGNvbnN0IGljb25zID0gW1xuICAgIHtcbiAgICAgIHRpdGxlOiBzdHJpbmdzLnN5bWJvbFNvdXJjZXMuY2lyY2xlLFxuICAgICAgbmFtZTogXCJDaXJjbGVcIixcbiAgICAgIHByaW1pdGl2ZTogXCJjaXJjbGVcIlxuICAgIH0sXG4gICAge1xuICAgICAgdGl0bGU6IHN0cmluZ3Muc3ltYm9sU291cmNlcy5zcXVhcmUsXG4gICAgICBuYW1lOiBcIlNxdWFyZVwiLFxuICAgICAgcHJpbWl0aXZlOiBcInNxdWFyZVwiXG4gICAgfSxcbiAgICB7XG4gICAgICB0aXRsZTogc3RyaW5ncy5zeW1ib2xTb3VyY2VzLmNyb3NzLFxuICAgICAgbmFtZTogXCJDcm9zc1wiLFxuICAgICAgcHJpbWl0aXZlOiBcImNyb3NzXCJcbiAgICB9LFxuICAgIHtcbiAgICAgIHRpdGxlOiBzdHJpbmdzLnN5bWJvbFNvdXJjZXMueCxcbiAgICAgIG5hbWU6IFwiWFwiLFxuICAgICAgcHJpbWl0aXZlOiBcInhcIlxuICAgIH0sXG4gICAge1xuICAgICAgdGl0bGU6IHN0cmluZ3Muc3ltYm9sU291cmNlcy5raXRlLFxuICAgICAgbmFtZTogXCJLaXRlXCIsXG4gICAgICBwcmltaXRpdmU6IFwia2l0ZVwiXG4gICAgfSxcbiAgICB7XG4gICAgICB0aXRsZTogc3RyaW5ncy5zeW1ib2xTb3VyY2VzLnRyaWFuZ2xlLFxuICAgICAgbmFtZTogXCJUcmlhbmdsZVwiLFxuICAgICAgcHJpbWl0aXZlOiBcInRyaWFuZ2xlXCJcbiAgICB9XG4gIF07XG4gIHJldHVybiBpY29ucy5tYXAoKGljb24pID0+IHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuICh7XG4gICAgICBkaW1lbnNpb25hbGl0eTogXCJmbGF0XCIsXG4gICAgICBuYW1lOiBpY29uLm5hbWUsXG4gICAgICB0aXRsZTogaWNvbi50aXRsZSxcbiAgICAgIHR5cGU6IFwiUG9pbnRTeW1ib2wzRFwiLFxuICAgICAgc3ltYm9sTGF5ZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiBcIkljb25cIixcbiAgICAgICAgICByZXNvdXJjZToge1xuICAgICAgICAgICAgcHJpbWl0aXZlOiBpY29uLnByaW1pdGl2ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgbWF0ZXJpYWw6IHtcbiAgICAgICAgICAgIGNvbG9yOiAoX2EgPSBlc3JpTW9kdWxlcyA9PT0gbnVsbCB8fCBlc3JpTW9kdWxlcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXNyaU1vZHVsZXMuZ2Z4VXRpbHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kZWZhdWx0VGhlbWF0aWNDb2xvclxuICAgICAgICAgIH0sXG4gICAgICAgICAgb3V0bGluZToge1xuICAgICAgICAgICAgY29sb3I6IFswLCAwLCAwXVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgXVxuICAgIH0pO1xuICB9KTtcbn1cbmZ1bmN0aW9uIGdlbmVyYXRlT2JqZWN0UHJpbWl0aXZlU3ltYm9sSnNvbihzdHJpbmdzKSB7XG4gIGNvbnN0IG9iamVjdHMgPSBbXG4gICAge1xuICAgICAgdGl0bGU6IHN0cmluZ3Muc3ltYm9sU291cmNlcy5zcGhlcmUsXG4gICAgICBuYW1lOiBcIlNwaGVyZVwiLFxuICAgICAgcHJpbWl0aXZlOiBcInNwaGVyZVwiXG4gICAgfSxcbiAgICB7XG4gICAgICB0aXRsZTogc3RyaW5ncy5zeW1ib2xTb3VyY2VzLnRhbGxDeWxpbmRlcixcbiAgICAgIG5hbWU6IFwiVGFsbF9DeWxpbmRlclwiLFxuICAgICAgcHJpbWl0aXZlOiBcImN5bGluZGVyXCIsXG4gICAgICBtaXhpbnM6IHtcbiAgICAgICAgd2lkdGg6IHN5bWJvbFJhZGl1c0ZpeGVkLFxuICAgICAgICBoZWlnaHQ6IHN5bWJvbEhlaWdodEFzTWFpbkF4aXMsXG4gICAgICAgIGRlcHRoOiBzeW1ib2xSYWRpdXNGaXhlZFxuICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgdGl0bGU6IHN0cmluZ3Muc3ltYm9sU291cmNlcy5jeWxpbmRlcixcbiAgICAgIG5hbWU6IFwiQ3lsaW5kZXJcIixcbiAgICAgIHByaW1pdGl2ZTogXCJjeWxpbmRlclwiXG4gICAgfSxcbiAgICB7XG4gICAgICB0aXRsZTogc3RyaW5ncy5zeW1ib2xTb3VyY2VzLnRhbGxDdWJlLFxuICAgICAgbmFtZTogXCJUYWxsX0N1YmVcIixcbiAgICAgIHByaW1pdGl2ZTogXCJjdWJlXCIsXG4gICAgICBtaXhpbnM6IHtcbiAgICAgICAgd2lkdGg6IHN5bWJvbFJhZGl1c0ZpeGVkLFxuICAgICAgICBoZWlnaHQ6IHN5bWJvbEhlaWdodEFzTWFpbkF4aXMsXG4gICAgICAgIGRlcHRoOiBzeW1ib2xSYWRpdXNGaXhlZCxcbiAgICAgICAgYW5jaG9yOiBcImJvdHRvbVwiXG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICB0aXRsZTogc3RyaW5ncy5zeW1ib2xTb3VyY2VzLmN1YmUsXG4gICAgICBuYW1lOiBcIkN1YmVcIixcbiAgICAgIHByaW1pdGl2ZTogXCJjdWJlXCJcbiAgICB9LFxuICAgIHtcbiAgICAgIHRpdGxlOiBzdHJpbmdzLnN5bWJvbFNvdXJjZXMudGFsbENvbmUsXG4gICAgICBuYW1lOiBcIlRhbGxfQ29uZVwiLFxuICAgICAgcHJpbWl0aXZlOiBcImNvbmVcIixcbiAgICAgIG1peGluczoge1xuICAgICAgICB3aWR0aDogc3ltYm9sUmFkaXVzRml4ZWQsXG4gICAgICAgIGhlaWdodDogc3ltYm9sSGVpZ2h0QXNNYWluQXhpcyxcbiAgICAgICAgZGVwdGg6IHN5bWJvbFJhZGl1c0ZpeGVkXG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICB0aXRsZTogc3RyaW5ncy5zeW1ib2xTb3VyY2VzLmNvbmUsXG4gICAgICBuYW1lOiBcIkNvbmVcIixcbiAgICAgIHByaW1pdGl2ZTogXCJjb25lXCJcbiAgICB9LFxuICAgIHtcbiAgICAgIHRpdGxlOiBzdHJpbmdzLnN5bWJvbFNvdXJjZXMuaW52ZXJ0ZWRDb25lLFxuICAgICAgbmFtZTogXCJJbnZlcnRlZF9Db25lXCIsXG4gICAgICBwcmltaXRpdmU6IFwiaW52ZXJ0ZWRDb25lXCJcbiAgICB9LFxuICAgIHtcbiAgICAgIHRpdGxlOiBzdHJpbmdzLnN5bWJvbFNvdXJjZXMuZGlhbW9uZCxcbiAgICAgIG5hbWU6IFwiRGlhbW9uZFwiLFxuICAgICAgcHJpbWl0aXZlOiBcImRpYW1vbmRcIlxuICAgIH0sXG4gICAge1xuICAgICAgdGl0bGU6IHN0cmluZ3Muc3ltYm9sU291cmNlcy50ZXRyYWhlZHJvbixcbiAgICAgIG5hbWU6IFwiVGV0cmFoZWRyb25cIixcbiAgICAgIHByaW1pdGl2ZTogXCJ0ZXRyYWhlZHJvblwiXG4gICAgfVxuICBdO1xuICByZXR1cm4gb2JqZWN0cy5tYXAoKG9iamVjdCkgPT4gKHtcbiAgICBkaW1lbnNpb25hbGl0eTogXCJ2b2x1bWV0cmljXCIsXG4gICAgbmFtZTogb2JqZWN0Lm5hbWUsXG4gICAgdGl0bGU6IG9iamVjdC50aXRsZSxcbiAgICB0eXBlOiBcIlBvaW50U3ltYm9sM0RcIixcbiAgICBzeW1ib2xMYXllcnM6IFtcbiAgICAgIE9iamVjdC5hc3NpZ24oeyB0eXBlOiBcIk9iamVjdFwiLCByZXNvdXJjZToge1xuICAgICAgICAgIHByaW1pdGl2ZTogb2JqZWN0LnByaW1pdGl2ZVxuICAgICAgICB9IH0sIG9iamVjdC5taXhpbnMpXG4gICAgXVxuICB9KSk7XG59XG5jb25zdCBzeW1ib2xUaHVtYm5haWxTaXplSW5QdCA9IDI0OyAvLyAyNCBwdCA9PiAzMnB4XG5jb25zdCBzeW1ib2xUaHVtYm5haWxTaXplSW5QdEZvcjNEID0gNDI7IC8vIDQycHQgPT4gNTZweFxuZnVuY3Rpb24gaGFzM0RGb3JtYXQoaXRlbURhdGEpIHtcbiAgdmFyIF9hLCBfYjtcbiAgY29uc3QgZm9ybWF0SW5jbHVkZXMzRCA9IChfYSA9IGl0ZW1EYXRhLmZvcm1hdHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhcIndlYjNkXCIpO1xuICBjb25zdCBmb3JtYXRJbmZvc0luY2x1ZGVzM0RIaW50ID0gKF9iID0gaXRlbURhdGEuZm9ybWF0SW5mb3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zb21lKChmb3JtYXRJbmZvKSA9PiBmb3JtYXRJbmZvLnR5cGUgPT09IFwiZ2x0ZlwiIHx8IGZvcm1hdEluZm8udHlwZSA9PT0gXCJnbHRmX2Jhc2lzdVwiKTtcbiAgcmV0dXJuIGZvcm1hdEluY2x1ZGVzM0QgfHwgZm9ybWF0SW5mb3NJbmNsdWRlczNESGludDtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldFdlYlN0eWxlU3ltYm9sVGh1bWJuYWlsUHJldmlldyhpdGVtKSB7XG4gIHZhciBfYSwgX2I7XG4gIGNvbnN0IGl0ZW1EYXRhID0gaXRlbS5kYXRhO1xuICBsZXQgdGh1bWJuYWlsVXJsID0gKF9hID0gaXRlbURhdGEudGh1bWJuYWlsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaHJlZjtcbiAgY29uc3QgdGh1bWJuYWlsRGF0YSA9IChfYiA9IGl0ZW1EYXRhLnRodW1ibmFpbCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmltYWdlRGF0YTtcbiAgY29uc3QgdGl0bGUgPSBpdGVtRGF0YS50aXRsZSB8fCBpdGVtLnN0cmluZ3Muc3ltYm9sU291cmNlcy5ub1RpdGxlO1xuICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgY29uc3QgaXNDSU0gPSAhIWl0ZW1EYXRhLmNpbVJlZjtcbiAgY29uc3QgaXMzZCA9IGhhczNERm9ybWF0KGl0ZW1EYXRhKTtcbiAgY29uc3QgY29tbW9uUHJldmlld09wdGlvbnMgPSB7XG4gICAgc2l6ZTogaXMzZCAmJiBpdGVtRGF0YS5kaW1lbnNpb25hbGl0eSA9PT0gXCJ2b2x1bWV0cmljXCIgPyBzeW1ib2xUaHVtYm5haWxTaXplSW5QdEZvcjNEIDogc3ltYm9sVGh1bWJuYWlsU2l6ZUluUHQsXG4gICAgZGlzYWJsZVVwc2FtcGxpbmc6IGZhbHNlXG4gIH07XG4gIGlmIChcbiAgLyogc3ltYm9sIHByZXZpZXcgdXRpbHMgb25seSBzdXBwb3J0IDJEIENJTSAqL1xuICBpc0NJTSAmJlxuICAgICFpczNkKSB7XG4gICAgY29uc3Qgc3ltYm9sID0gKGF3YWl0IGl0ZW0uZ2V0U3ltYm9sKCkpO1xuICAgIGlmIChcbiAgICAvLyBsaW5lcy9wb2ludHMgdXNlIGR5bmFtaWNhbGx5IGdlbmVyYXRlZCBwcmV2aWV3c1xuICAgIC8vIHBvbHlnb25zIHVzZSB0aHVtYm5haWwgVVJMcyBzaW5jZSBkeW5hbWljYWxseSBnZW5lcmF0ZWRcbiAgICAvLyBwcmV2aWV3cyBtYXkgbm90IGRpc3BsYXkgYXMgbmljZWx5IGFzIGF1dGhvcmVkIG9uZXNcbiAgICAhaXNQb2x5Z29uQ0lNKHN5bWJvbCkpIHtcbiAgICAgIGlmIChpc0xpbmVDSU0oc3ltYm9sKSkge1xuICAgICAgICAvLyB3ZSBkcm9wIHNpemUgZm9yIG5vbi1wb2ludHMgdG8gcHJldmVudCBhIGtub3duIHJlbmRlcmluZyBpc3N1ZSDigJMgaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWpzLWFwaS9pc3N1ZXMvNDE3OTBcbiAgICAgICAgZGVsZXRlIGNvbW1vblByZXZpZXdPcHRpb25zLnNpemU7XG4gICAgICB9XG4gICAgICByZXR1cm4gYXBwZW5kUHJldmlldyh3cmFwcGVyLCBzeW1ib2wsIGNvbW1vblByZXZpZXdPcHRpb25zLCB0aXRsZSk7XG4gICAgfVxuICB9XG4gIC8vIFdoZW4gbG9hZGluZyBFc3JpIHByb3ZpZGVkIHN0eWxlcyBvbiBkZXYgZW52aXJvbm1lbnRzIHdlIGdldCBpbmNvcnJlY3RcbiAgLy8gc3ltYm9sIFVSTHMuXG4gIC8vIElmIG5lY2Vzc2FyeSBhbmQgYWxsb3dlZCwgYWRqdXN0IHRoZSBVUkwgdG8gd29yayBvbiBkZXYgZW52aXJvbm1lbnRzXG4gIC8vIHNlZSBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtanMtYXBpL2lzc3Vlcy8xNjgzMlxuICBpZiAoZXNyaU1vZHVsZXMuZGV2RW52aXJvbm1lbnRVdGlscy5pc0RldkVudmlyb25tZW50KCkpIHtcbiAgICB0aHVtYm5haWxVcmwgPSBlc3JpTW9kdWxlcy5kZXZFbnZpcm9ubWVudFV0aWxzLmFkanVzdFN0YXRpY0FHT1VybCh0aHVtYm5haWxVcmwpO1xuICB9XG4gIGlmICghdGh1bWJuYWlsVXJsICYmICF0aHVtYm5haWxEYXRhKSB7XG4gICAgd3JhcHBlci5hcHBlbmRDaGlsZChjcmVhdGVCbGFua1RodW1ibmFpbCh0aXRsZSkpO1xuICAgIHJldHVybiB3cmFwcGVyO1xuICB9XG4gIGNvbnN0IHN5bWJvbCA9IG5ldyBlc3JpTW9kdWxlcy5XZWJTdHlsZVN5bWJvbCh7XG4gICAgbmFtZTogaXRlbURhdGEubmFtZSxcbiAgICBzdHlsZVVybDogYCR7aXRlbS5wb3J0YWxJdGVtLml0ZW1Vcmx9L2RhdGFgLFxuICAgIHRodW1ibmFpbDoge1xuICAgICAgdXJsOiB0aHVtYm5haWxEYXRhXG4gICAgICAgID8gYGRhdGE6aW1hZ2UvanBlZztiYXNlNjQsICR7dGh1bWJuYWlsRGF0YX1gXG4gICAgICAgIDogZXNyaU1vZHVsZXMudXJsVXRpbHMubWFrZUFic29sdXRlKHRodW1ibmFpbFVybCwgaXRlbS5wb3J0YWxJdGVtLml0ZW1VcmwpXG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGFwcGVuZFByZXZpZXcod3JhcHBlciwgc3ltYm9sLCBjb21tb25QcmV2aWV3T3B0aW9ucywgdGl0bGUpO1xufVxuYXN5bmMgZnVuY3Rpb24gYXBwZW5kUHJldmlldyhub2RlLCBzeW1ib2wsIG9wdGlvbnMsIHRpdGxlKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgZXNyaU1vZHVsZXMuc3ltYm9sVXRpbHMucmVuZGVyUHJldmlld0hUTUwoc3ltYm9sLCBPYmplY3QuYXNzaWduKHsgbm9kZSB9LCBvcHRpb25zKSk7XG4gIH1cbiAgY2F0Y2ggKGUpIHtcbiAgICBub2RlLmFwcGVuZENoaWxkKGNyZWF0ZUJsYW5rVGh1bWJuYWlsKHRpdGxlKSk7XG4gIH1cbiAgcmV0dXJuIG5vZGU7XG59XG5mdW5jdGlvbiBjcmVhdGVCbGFua1RodW1ibmFpbCh0aXRsZSkge1xuICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gIC8vIGRlc2NyaWJlZCBieSBwYXJlbnQgbm9kZVxuICBlbGVtZW50LnNldEF0dHJpYnV0ZShcImFsdFwiLCBcIlwiKTtcbiAgZWxlbWVudC5pbm5lckhUTUwgPSB0aXRsZTtcbiAgcmV0dXJuIGVsZW1lbnQ7XG59XG5mdW5jdGlvbiB3ZWJTdHlsZVN5bWJvbFN0cmF0ZWd5KHN5bWJvbFR5cGUgPSBcIjJkXCIpIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBnZXRTeW1ib2woaXRlbSkge1xuICAgICAgY29uc3QgeyBkYXRhLCBwYXJlbnREYXRhLCBwb3J0YWxJdGVtIH0gPSBpdGVtO1xuICAgICAgY29uc3Qgc3ltYm9sID0gYXdhaXQgc3ltYm9sRnJvbVdlYlN0eWxlSlNPTihwYXJlbnREYXRhLCBkYXRhLm5hbWUsIHBvcnRhbEl0ZW0sIHBhcmVudERhdGEuY2ltVmVyc2lvbiAmJiBzeW1ib2xUeXBlID09PSBcIjJkXCIgPyBcImNpbVJlZlwiIDogXCJ3ZWJSZWZcIik7XG4gICAgICAvLyBPdmVycmlkZSBjb2xvciBmb3IgM2QgaWNvbiBhbmQgb2JqZWN0IHN5bWJvbHMgdG8gYmUgdGhlbWF0aWNcbiAgICAgIGlmIChzeW1ib2wudHlwZSA9PT0gXCJwb2ludC0zZFwiKSB7XG4gICAgICAgIHN5bWJvbC5zeW1ib2xMYXllcnMuZm9yRWFjaCgoc3ltYm9sTGF5ZXIpID0+IHtcbiAgICAgICAgICBpZiAoc3ltYm9sTGF5ZXIuZ2V0KFwibWF0ZXJpYWwuY29sb3JcIikpIHtcbiAgICAgICAgICAgIGlmIChzeW1ib2xMYXllci50eXBlID09PSBcImljb25cIikge1xuICAgICAgICAgICAgICBjb25zdCBtYXRlcmlhbCA9IHN5bWJvbExheWVyLm1hdGVyaWFsICE9IG51bGxcbiAgICAgICAgICAgICAgICA/IHN5bWJvbExheWVyLm1hdGVyaWFsXG4gICAgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgLyogYXV0b2Nhc3RzIGFzIFN5bWJvbDNETWF0ZXJpYWwgKi9cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICBtYXRlcmlhbC5jb2xvciA9IGVzcmlNb2R1bGVzLmdmeFV0aWxzLmRlZmF1bHRUaGVtYXRpY0NvbG9yLmNsb25lKCk7XG4gICAgICAgICAgICAgIHN5bWJvbExheWVyLm1hdGVyaWFsID0gbWF0ZXJpYWw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChzeW1ib2xMYXllci50eXBlID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICAgIGNvbnN0IG1hdGVyaWFsID0gc3ltYm9sTGF5ZXIubWF0ZXJpYWwgIT0gbnVsbFxuICAgICAgICAgICAgICAgID8gc3ltYm9sTGF5ZXIubWF0ZXJpYWxcbiAgICAgICAgICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICAvKiBhdXRvY2FzdHMgYXMgU3ltYm9sM0RNYXRlcmlhbCAqL1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIG1hdGVyaWFsLmNvbG9yID0gbWF0ZXJpYWwuY29sb3IgfHwgY3JlYXRlKFsyNTUsIDI1NSwgMjU1XSk7XG4gICAgICAgICAgICAgIHN5bWJvbExheWVyLm1hdGVyaWFsID0gbWF0ZXJpYWw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzeW1ib2w7XG4gICAgfSxcbiAgICBhc3luYyBnZXRUaHVtYm5haWwoaXRlbSkge1xuICAgICAgcmV0dXJuIGdldFdlYlN0eWxlU3ltYm9sVGh1bWJuYWlsUHJldmlldyhpdGVtKTtcbiAgICB9XG4gIH07XG59XG5mdW5jdGlvbiB3ZWJTdHlsZUN1c3RvbVN5bWJvbFN0cmF0ZWd5KCkge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGdldFN5bWJvbChpdGVtKSB7XG4gICAgICByZXR1cm4gaXRlbS5kYXRhLnN5bWJvbDtcbiAgICB9LFxuICAgIGFzeW5jIGdldFRodW1ibmFpbChpdGVtKSB7XG4gICAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIGNvbnN0IGh0bWwgPSBhcHBlbmRQcmV2aWV3KHdyYXBwZXIsIGl0ZW0uZGF0YS5zeW1ib2wsIHtcbiAgICAgICAgc2l6ZTogMjQsXG4gICAgICAgIGRpc2FibGVVcHNhbXBsaW5nOiBmYWxzZVxuICAgICAgfSwgaXRlbS5kYXRhLnRpdGxlKTtcbiAgICAgIHJldHVybiBodG1sO1xuICAgIH1cbiAgfTtcbn1cbmNvbnN0IGZsYXRTeW1ib2xTdHJhdGVneSA9IHtcbiAgYXN5bmMgZ2V0U3ltYm9sKGl0ZW0pIHtcbiAgICByZXR1cm4gZXNyaU1vZHVsZXMuanNvblV0aWxzLmZyb21KU09OKGl0ZW0uZGF0YSk7XG4gIH0sXG4gIGFzeW5jIGdldFRodW1ibmFpbChpdGVtKSB7XG4gICAgY29uc3Qgc3ltYm9sID0gKGF3YWl0IGl0ZW0uZ2V0U3ltYm9sKCkpO1xuICAgIGNvbnN0IHByZXZpZXdPcHRpb25zID0ge1xuICAgICAgc2l6ZTogZ2VvbWV0cnlUeXBlKHN5bWJvbCkgPT09IFwibGluZVwiXG4gICAgICAgID8ge1xuICAgICAgICAgIHdpZHRoOiBzeW1ib2xUaHVtYm5haWxTaXplSW5QdFxuICAgICAgICB9XG4gICAgICAgIDogc3ltYm9sVGh1bWJuYWlsU2l6ZUluUHRcbiAgICB9O1xuICAgIHJldHVybiBlc3JpTW9kdWxlcy5zeW1ib2xVdGlscy5yZW5kZXJQcmV2aWV3SFRNTChzeW1ib2wsIHByZXZpZXdPcHRpb25zKTtcbiAgfVxufTtcbmNvbnN0IHZvbHVtZXRyaWNTeW1ib2xTdHJhdGVneSA9IHtcbiAgYXN5bmMgZ2V0U3ltYm9sKGl0ZW0pIHtcbiAgICByZXR1cm4gZXNyaU1vZHVsZXMuanNvblV0aWxzLmZyb21KU09OKGl0ZW0uZGF0YSk7XG4gIH0sXG4gIGFzeW5jIGdldFRodW1ibmFpbChpdGVtKSB7XG4gICAgY29uc3Qgc3ltYm9sID0gYXdhaXQgaXRlbS5nZXRTeW1ib2woKTtcbiAgICByZXR1cm4gZXNyaU1vZHVsZXMuc3ltYm9sVXRpbHMucmVuZGVyUHJldmlld0hUTUwoc3ltYm9sLCB7IHNpemU6IHN5bWJvbFRodW1ibmFpbFNpemVJblB0Rm9yM0QgLSA0IH0pO1xuICB9XG59O1xuY29uc3Qgbm9vcCA9IEZ1bmN0aW9uLnByb3RvdHlwZTtcbmNsYXNzIFN5bWJvbEl0ZW0ge1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBMaWZlY3ljbGVcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBjb25zdHJ1Y3Rvcih7IGRhdGEsIHBhcmVudERhdGEsIHBvcnRhbEl0ZW0sIHN0cmF0ZWd5LCBzdHJpbmdzIH0pIHtcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgIHRoaXMucGFyZW50RGF0YSA9IHBhcmVudERhdGE7XG4gICAgdGhpcy5wb3J0YWxJdGVtID0gcG9ydGFsSXRlbTtcbiAgICB0aGlzLnN0cmF0ZWd5ID0gc3RyYXRlZ3k7XG4gICAgdGhpcy5zdHJpbmdzID0gc3RyaW5ncztcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBQdWJsaWMgTWV0aG9kc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGFzeW5jIGdldFN5bWJvbCgpIHtcbiAgICBpZiAoIXRoaXMuX3N5bWJvbCkge1xuICAgICAgY29uc3QgaW5mbGlnaHRTeW1ib2wgPSB0aGlzLl9zeW1ib2xSZXF1ZXN0IHx8ICh0aGlzLl9zeW1ib2xSZXF1ZXN0ID0gdGhpcy5zdHJhdGVneS5nZXRTeW1ib2wodGhpcykpO1xuICAgICAgdGhpcy5fc3ltYm9sID0gYXdhaXQgaW5mbGlnaHRTeW1ib2w7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9zeW1ib2wuY2xvbmUoKTtcbiAgfVxuICBhc3luYyBnZXRUaHVtYm5haWwobm9kZSkge1xuICAgIGlmICh0aGlzLl90aHVtYm5haWwpIHtcbiAgICAgIG5vZGUuYXBwZW5kQ2hpbGQodGhpcy5fdGh1bWJuYWlsKTtcbiAgICAgIHJldHVybiBub29wO1xuICAgIH1cbiAgICBjb25zdCBpbmZsaWdodFRodW1ibmFpbCA9IHRoaXMuX3RodW1ibmFpbFJlcXVlc3QgfHwgKHRoaXMuX3RodW1ibmFpbFJlcXVlc3QgPSB0aGlzLnN0cmF0ZWd5LmdldFRodW1ibmFpbCh0aGlzKSk7XG4gICAgdGhpcy5fdGh1bWJuYWlsID0gYXdhaXQgaW5mbGlnaHRUaHVtYm5haWw7XG4gICAgcmV0dXJuICgpID0+IG5vZGUuYXBwZW5kQ2hpbGQodGhpcy5fdGh1bWJuYWlsKTtcbiAgfVxufVxuY2xhc3MgUG9ydGFsSXRlbVN5bWJvbFNvdXJjZUJhc2Uge1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBMaWZlY3ljbGVcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBjb25zdHJ1Y3Rvcih7IHBvcnRhbEl0ZW0sIHN0cmluZ3MsIHN5bWJvbFR5cGUgfSkge1xuICAgIHRoaXMuc3ltYm9sVHlwZSA9IFwiMmRcIjtcbiAgICB0aGlzLnBvcnRhbEl0ZW0gPSBwb3J0YWxJdGVtO1xuICAgIHRoaXMuc3RyaW5ncyA9IHN0cmluZ3M7XG4gICAgaWYgKHN5bWJvbFR5cGUpIHtcbiAgICAgIHRoaXMuc3ltYm9sVHlwZSA9IHN5bWJvbFR5cGU7XG4gICAgfVxuICB9XG4gIGdldCBkYXRhKCkge1xuICAgIHJldHVybiB0aGlzLl9kYXRhO1xuICB9XG4gIGdldCBpZCgpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIChfYSA9IHRoaXMucG9ydGFsSXRlbSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlkO1xuICB9XG4gIGdldCBrZXl3b3JkcygpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuICgoX2EgPSB0aGlzLnBvcnRhbEl0ZW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlS2V5d29yZHMpIHx8IFtdO1xuICB9XG4gIGdldCBuYW1lKCkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gKF9hID0gdGhpcy5wb3J0YWxJdGVtKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubmFtZTtcbiAgfVxuICBnZXQgdGl0bGUoKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAoX2EgPSB0aGlzLnBvcnRhbEl0ZW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50aXRsZTtcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBQdWJsaWMgTWV0aG9kc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGFzeW5jIGZldGNoRGF0YShvcHRpb25zKSB7XG4gICAgaWYgKGVzcmlNb2R1bGVzLnByb21pc2VVdGlscy5pc0Fib3J0ZWQob3B0aW9ucykpIHtcbiAgICAgIHRocm93IGVzcmlNb2R1bGVzLnByb21pc2VVdGlscy5jcmVhdGVBYm9ydEVycm9yKCk7XG4gICAgfVxuICAgIGlmICghdGhpcy5fZGF0YSkge1xuICAgICAgdGhpcy5fZGF0YSA9IGF3YWl0IHRoaXMucG9ydGFsSXRlbS5mZXRjaERhdGEoXCJqc29uXCIsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucyksIGdldEluamVjdGVkUmVxdWVzdE9wdGlvbnModGhpcy5wb3J0YWxJdGVtKSkpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fZGF0YTtcbiAgfVxufVxuY2xhc3MgU3ltYm9sU2V0U3ltYm9sU291cmNlIGV4dGVuZHMgUG9ydGFsSXRlbVN5bWJvbFNvdXJjZUJhc2Uge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBQcm9wZXJ0aWVzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJvcGVydGllc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMudHlwZSA9IFwic3ltYm9sLXNldFwiO1xuICB9XG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIFByb3RlY3RlZCBNZXRob2RzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgYXN5bmMgZ2V0SXRlbXMob3B0aW9ucykge1xuICAgIGlmIChlc3JpTW9kdWxlcy5wcm9taXNlVXRpbHMuaXNBYm9ydGVkKG9wdGlvbnMpKSB7XG4gICAgICB0aHJvdyBlc3JpTW9kdWxlcy5wcm9taXNlVXRpbHMuY3JlYXRlQWJvcnRFcnJvcigpO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuX2l0ZW1zKSB7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5mZXRjaERhdGEob3B0aW9ucyk7XG4gICAgICB0aGlzLl9pdGVtcyA9IGRhdGEubWFwKChpdGVtKSA9PiBuZXcgU3ltYm9sSXRlbSh7XG4gICAgICAgIGRhdGE6IGl0ZW0sXG4gICAgICAgIHBhcmVudERhdGE6IGRhdGEsXG4gICAgICAgIHBvcnRhbEl0ZW06IHRoaXMucG9ydGFsSXRlbSxcbiAgICAgICAgc3RyYXRlZ3k6IGZsYXRTeW1ib2xTdHJhdGVneSxcbiAgICAgICAgc3RyaW5nczogdGhpcy5zdHJpbmdzXG4gICAgICB9KSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9pdGVtcztcbiAgfVxufVxuY2xhc3MgV2ViU3R5bGVTeW1ib2xTb3VyY2UgZXh0ZW5kcyBQb3J0YWxJdGVtU3ltYm9sU291cmNlQmFzZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcml2YXRlIFByb3BlcnRpZXNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcm9wZXJ0aWVzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy50eXBlID0gXCJ3ZWItc3R5bGVcIjtcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBQdWJsaWMgTWV0aG9kc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGFzeW5jIGdldEl0ZW1zKG9wdGlvbnMpIHtcbiAgICBpZiAoZXNyaU1vZHVsZXMucHJvbWlzZVV0aWxzLmlzQWJvcnRlZChvcHRpb25zKSkge1xuICAgICAgdGhyb3cgZXNyaU1vZHVsZXMucHJvbWlzZVV0aWxzLmNyZWF0ZUFib3J0RXJyb3IoKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLl9pdGVtcykge1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuZmV0Y2hEYXRhKG9wdGlvbnMpO1xuICAgICAgdGhpcy5faXRlbXMgPSBkYXRhLml0ZW1zLm1hcCgoaXRlbSkgPT4gbmV3IFN5bWJvbEl0ZW0oe1xuICAgICAgICBkYXRhOiBpdGVtLFxuICAgICAgICBwYXJlbnREYXRhOiBkYXRhLFxuICAgICAgICBwb3J0YWxJdGVtOiB0aGlzLnBvcnRhbEl0ZW0sXG4gICAgICAgIHN0cmF0ZWd5OiB3ZWJTdHlsZVN5bWJvbFN0cmF0ZWd5KHRoaXMuc3ltYm9sVHlwZSksXG4gICAgICAgIHN0cmluZ3M6IHRoaXMuc3RyaW5nc1xuICAgICAgfSkpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5faXRlbXM7XG4gIH1cbn1cbmNsYXNzIEJhc2ljU3ltYm9sU2V0U291cmNlIHtcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgTGlmZWN5Y2xlXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgY29uc3RydWN0b3IoeyBzdHJpbmdzIH0pIHtcbiAgICB0aGlzLmtleXdvcmRzID0gW107XG4gICAgdGhpcy5uYW1lID0gXCJCYXNpY1wiO1xuICAgIHRoaXMudHlwZSA9IFwic3ltYm9sLXNldFwiO1xuICAgIHRoaXMudGl0bGUgPSBzdHJpbmdzLnN5bWJvbFNvdXJjZXMuYmFzaWM7XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUHVibGljIE1ldGhvZHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBhc3luYyBnZXRJdGVtcyhvcHRpb25zKSB7XG4gICAgaWYgKGVzcmlNb2R1bGVzLnByb21pc2VVdGlscy5pc0Fib3J0ZWQob3B0aW9ucykpIHtcbiAgICAgIHRocm93IGVzcmlNb2R1bGVzLnByb21pc2VVdGlscy5jcmVhdGVBYm9ydEVycm9yKCk7XG4gICAgfVxuICAgIGlmICghdGhpcy5faXRlbXMpIHtcbiAgICAgIC8vIG5vIHBhcmVudCBkYXRhIHNpbmNlIGl0J3MgbG9jYWxcbiAgICAgIHRoaXMuX2l0ZW1zID0gdGhpcy5kYXRhLm1hcCgoZGF0YSkgPT4gbmV3IFN5bWJvbEl0ZW0oe1xuICAgICAgICBkYXRhLFxuICAgICAgICBzdHJhdGVneTogZmxhdFN5bWJvbFN0cmF0ZWd5LFxuICAgICAgICBzdHJpbmdzOiB0aGlzLnN0cmluZ3NcbiAgICAgIH0pKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2l0ZW1zO1xuICB9XG59XG5jb25zdCBiYXNpY1BvaW50U3ltYm9sU2V0U291cmNlSWQgPSBcImJhc2ljLXN5bWJvbC1zZXQ6cG9pbnRcIjtcbmNvbnN0IGJhc2ljTGluZVN5bWJvbFNldFNvdXJjZUlkID0gXCJiYXNpYy1zeW1ib2wtc2V0OmxpbmVcIjtcbmNvbnN0IGJhc2ljUG9seWdvblN5bWJvbFNldFNvdXJjZUlkID0gXCJiYXNpYy1zeW1ib2wtc2V0OnBvbHlnb25cIjtcbmNsYXNzIEJhc2ljUG9pbnRTeW1ib2xTZXRTb3VyY2UgZXh0ZW5kcyBCYXNpY1N5bWJvbFNldFNvdXJjZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcm9wZXJ0aWVzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcbiAgICB0aGlzLmRhdGEgPSBCQVNJQ19TSU1QTEVfTUFSS0VSX1NZTUJPTFNfSlNPTjtcbiAgICB0aGlzLmlkID0gYmFzaWNQb2ludFN5bWJvbFNldFNvdXJjZUlkO1xuICAgIHRoaXMua2V5d29yZHMgPSBbXCJQb2ludFwiXTtcbiAgfVxufVxuY2xhc3MgQmFzaWNMaW5lU3ltYm9sU2V0U291cmNlIGV4dGVuZHMgQmFzaWNTeW1ib2xTZXRTb3VyY2Uge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJvcGVydGllc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG4gICAgdGhpcy5kYXRhID0gQkFTSUNfU0lNUExFX0xJTkVfU1lNQk9MU19KU09OO1xuICAgIHRoaXMuaWQgPSBiYXNpY0xpbmVTeW1ib2xTZXRTb3VyY2VJZDtcbiAgICB0aGlzLmtleXdvcmRzID0gW1wiTGluZVwiXTtcbiAgfVxufVxuY2xhc3MgQmFzaWNQb2x5Z29uU3ltYm9sU2V0U291cmNlIGV4dGVuZHMgQmFzaWNTeW1ib2xTZXRTb3VyY2Uge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJvcGVydGllc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG4gICAgdGhpcy5kYXRhID0gQkFTSUNfU0lNUExFX1BPTFlHT05fU1lNQk9MU19KU09OO1xuICAgIHRoaXMuaWQgPSBiYXNpY1BvbHlnb25TeW1ib2xTZXRTb3VyY2VJZDtcbiAgICB0aGlzLmtleXdvcmRzID0gW1wiUG9seWdvblwiXTtcbiAgfVxufVxuY2xhc3MgSWNvblByaW1pdGl2ZVdlYlN0eWxlU291cmNlIHtcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgTGlmZWN5Y2xlXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgY29uc3RydWN0b3IoeyBzdHJpbmdzIH0pIHtcbiAgICB0aGlzLmtleXdvcmRzID0gW1wiM2RcIl07XG4gICAgdGhpcy5pZCA9IFwiYmFzaWMtd2ViLXN0eWxlOmZsYXRcIjtcbiAgICB0aGlzLm5hbWUgPSBcIkJhc2ljXCI7XG4gICAgdGhpcy50eXBlID0gXCJ3ZWItc3R5bGVcIjtcbiAgICB0aGlzLmRhdGEgPSB7IGl0ZW1zOiBnZW5lcmF0ZUljb25QcmltaXRpdmVTeW1ib2xKc29uKHN0cmluZ3MpIH07XG4gICAgdGhpcy50aXRsZSA9IHN0cmluZ3Muc3ltYm9sU291cmNlcy5iYXNpYztcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBQdWJsaWMgTWV0aG9kc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGFzeW5jIGdldEl0ZW1zKG9wdGlvbnMpIHtcbiAgICBpZiAoZXNyaU1vZHVsZXMucHJvbWlzZVV0aWxzLmlzQWJvcnRlZChvcHRpb25zKSkge1xuICAgICAgdGhyb3cgZXNyaU1vZHVsZXMucHJvbWlzZVV0aWxzLmNyZWF0ZUFib3J0RXJyb3IoKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLl9pdGVtcykge1xuICAgICAgLy8gbm8gcGFyZW50IGRhdGEgc2luY2UgaXQncyBsb2NhbFxuICAgICAgdGhpcy5faXRlbXMgPSB0aGlzLmRhdGEuaXRlbXMubWFwKChkYXRhKSA9PiBuZXcgU3ltYm9sSXRlbSh7XG4gICAgICAgIGRhdGEsXG4gICAgICAgIHN0cmF0ZWd5OiBmbGF0U3ltYm9sU3RyYXRlZ3ksXG4gICAgICAgIHN0cmluZ3M6IHRoaXMuc3RyaW5nc1xuICAgICAgfSkpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5faXRlbXM7XG4gIH1cbn1cbmNsYXNzIE9iamVjdFByaW1pdGl2ZVdlYlN0eWxlU291cmNlIHtcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgTGlmZWN5Y2xlXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgY29uc3RydWN0b3IoeyBzdHJpbmdzIH0pIHtcbiAgICB0aGlzLmlkID0gXCJiYXNpYy13ZWItc3R5bGU6dm9sdW1ldHJpY1wiO1xuICAgIHRoaXMua2V5d29yZHMgPSBbXCIzZFwiLCBcInZvbHVtZXRyaWNcIl07XG4gICAgdGhpcy5uYW1lID0gXCJCYXNpY1wiO1xuICAgIHRoaXMudHlwZSA9IFwid2ViLXN0eWxlXCI7XG4gICAgdGhpcy5kYXRhID0geyBpdGVtczogZ2VuZXJhdGVPYmplY3RQcmltaXRpdmVTeW1ib2xKc29uKHN0cmluZ3MpIH07XG4gICAgdGhpcy50aXRsZSA9IHN0cmluZ3Muc3ltYm9sU291cmNlcy5iYXNpYztcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBQdWJsaWMgTWV0aG9kc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGFzeW5jIGdldEl0ZW1zKG9wdGlvbnMpIHtcbiAgICBpZiAoZXNyaU1vZHVsZXMucHJvbWlzZVV0aWxzLmlzQWJvcnRlZChvcHRpb25zKSkge1xuICAgICAgdGhyb3cgZXNyaU1vZHVsZXMucHJvbWlzZVV0aWxzLmNyZWF0ZUFib3J0RXJyb3IoKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLl9pdGVtcykge1xuICAgICAgLy8gbm8gcGFyZW50IGRhdGEgc2luY2UgaXQncyBsb2NhbFxuICAgICAgdGhpcy5faXRlbXMgPSB0aGlzLmRhdGEuaXRlbXMubWFwKChkYXRhKSA9PiBuZXcgU3ltYm9sSXRlbSh7XG4gICAgICAgIGRhdGEsXG4gICAgICAgIHBhcmVudERhdGE6IHRoaXMuZGF0YSxcbiAgICAgICAgc3RyYXRlZ3k6IHZvbHVtZXRyaWNTeW1ib2xTdHJhdGVneSxcbiAgICAgICAgc3RyaW5nczogdGhpcy5zdHJpbmdzXG4gICAgICB9KSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9pdGVtcztcbiAgfVxufVxuZnVuY3Rpb24gc3R5bGVOYW1lRnJvbUl0ZW0oaXRlbSkge1xuICAvLyBGaW5kIHR5cGUga2V5d29yZCB0aGF0IGxvb2tzIGxpa2UgaXQncyBhbiBlc3JpIHN0eWxlIGFuZCBob3BlIGl0IHdvcmtzXG4gIGZvciAoY29uc3QgdHlwZUtleXdvcmQgb2YgaXRlbS50eXBlS2V5d29yZHMpIHtcbiAgICBpZiAoL15Fc3JpLipTdHlsZSQvLnRlc3QodHlwZUtleXdvcmQpICYmIHR5cGVLZXl3b3JkICE9PSBcIkVzcmkgU3R5bGVcIikge1xuICAgICAgcmV0dXJuIHR5cGVLZXl3b3JkO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuYXN5bmMgZnVuY3Rpb24gc3ltYm9sRnJvbVdlYlN0eWxlSlNPTihzdHlsZSwgbmFtZSwgaXRlbSwgdHlwZSkge1xuICBjb25zdCBzdHlsZU5hbWUgPSBzdHlsZU5hbWVGcm9tSXRlbShpdGVtKTtcbiAgbGV0IHN0eWxlVXJsID0gbnVsbDtcbiAgaWYgKCFzdHlsZU5hbWUpIHtcbiAgICBzdHlsZVVybCA9IGAke2l0ZW0uaXRlbVVybH0vZGF0YWA7XG4gIH1cbiAgY29uc3Qgc3R5bGVSZXNwb25zZSA9IHtcbiAgICBkYXRhOiBzdHlsZSxcbiAgICBiYXNlVXJsOiBpdGVtLml0ZW1VcmwsXG4gICAgc3R5bGVOYW1lLFxuICAgIHN0eWxlVXJsXG4gIH07XG4gIGNvbnN0IHsgcG9ydGFsIH0gPSBpdGVtO1xuICByZXR1cm4gZXNyaU1vZHVsZXMud2ViU3R5bGVTeW1ib2xVdGlscy5mZXRjaFN5bWJvbEZyb21TdHlsZShzdHlsZVJlc3BvbnNlLCBuYW1lLCB7IHBvcnRhbCB9LCB0eXBlLCBlc3JpTW9kdWxlcy5zdHlsZVV0aWxzLnN5bWJvbFVybEZyb21TdHlsZUl0ZW0sIGdldEluamVjdGVkUmVxdWVzdE9wdGlvbnMoaXRlbSkpO1xufVxuXG5jb25zdCBDU1MkMSA9IHtcbiAgbWFya2VySXRlbTogXCJtYXJrZXItaXRlbVwiLFxuICBjYWxjaXRlRGFya1RoZW1lOiBcImNhbGNpdGUtbW9kZS1kYXJrXCJcbn07XG5jb25zdCBNYXJrZXJJdGVtID0gKHsgaXRlbSwgaW5kZXgsIG9ic2VydmVyIH0pID0+IHtcbiAgY29uc3QgdG9vbHRpcCA9IGl0ZW0uZGF0YS50aXRsZSA/IChoKFwiY2FsY2l0ZS10b29sdGlwXCIsIHsgXCJyZWZlcmVuY2UtZWxlbWVudFwiOiBpdGVtLmRhdGEubmFtZSB9LCBpdGVtLmRhdGEudGl0bGUpKSA6IG51bGw7XG4gIHJldHVybiAoaChcInNwYW5cIiwgeyBjbGFzczogYCR7Q1NTJDEubWFya2VySXRlbX0gJHtDU1MkMS5jYWxjaXRlRGFya1RoZW1lfWAsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgIGlmICghbm9kZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBhbHJlYWR5UHJvY2Vzc2VkID0gbm9kZS5pdGVtO1xuICAgICAgaWYgKGFscmVhZHlQcm9jZXNzZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgbm9kZS5pdGVtID0gaXRlbTtcbiAgICAgIG5vZGUuaW5kZXggPSBpbmRleDtcbiAgICAgIG9ic2VydmVyLm9ic2VydmUobm9kZSk7XG4gICAgfSwgaWQ6IGl0ZW0uZGF0YS5uYW1lLCBzbG90OiBcInRodW1ibmFpbFwiIH0sIHRvb2x0aXApKTtcbn07XG5cbmZ1bmN0aW9uIGZldGNoU3ltYm9sU2V0U3ltYm9sU291cmNlcyhwb3J0YWwsIHN0cmluZ3MpIHtcbiAgcmV0dXJuIGZldGNoU3ltYm9sU2V0cyhwb3J0YWwpLnRoZW4oKGl0ZW1zKSA9PiBpdGVtcy5tYXAoKGl0ZW0pID0+IG5ldyBTeW1ib2xTZXRTeW1ib2xTb3VyY2Uoe1xuICAgIHBvcnRhbEl0ZW06IGl0ZW0sXG4gICAgc3RyaW5nc1xuICB9KSkpO1xufVxuZnVuY3Rpb24gZmV0Y2hTeW1ib2xTZXRzKHBvcnRhbCkge1xuICByZXR1cm4gaXRlbUZldGNoZXIoe1xuICAgIHBvcnRhbCxcbiAgICBxdWVyaWVzOiB7XG4gICAgICBncm91cDogcG9ydGFsLnN5bWJvbFNldHNHcm91cFF1ZXJ5LFxuICAgICAgaXRlbTogYHR5cGU6XCJTeW1ib2wgU2V0XCIgQU5EICh0eXBla2V5d29yZHM6XCJieSB2YWx1ZVwiIEFORCB0eXBla2V5d29yZHM6XCJtYXJrZXJcIilgXG4gICAgfVxuICB9KS50aGVuKG1vdmVEZWZhdWx0VG9GaXJzdCk7XG59XG5mdW5jdGlvbiBmZXRjaFdlYlN0eWxlU3ltYm9sU291cmNlcyhwb3J0YWwsIHR5cGUsIHN0cmluZ3MpIHtcbiAgcmV0dXJuIGZldGNoV2ViU3R5bGVzKHBvcnRhbCwgdHlwZSkudGhlbigoaXRlbXMpID0+IGl0ZW1zLm1hcCgoaXRlbSkgPT4gbmV3IFdlYlN0eWxlU3ltYm9sU291cmNlKHtcbiAgICBwb3J0YWxJdGVtOiBpdGVtLFxuICAgIHN5bWJvbFR5cGU6IHR5cGUsXG4gICAgc3RyaW5nc1xuICB9KSkpO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hXZWJTdHlsZXMocG9ydGFsLCB0eXBlKSB7XG4gIGNvbnN0IGdyb3VwID0gdHlwZSA9PT0gXCIyZFwiID8gcG9ydGFsLnN0eWxlc0dyb3VwUXVlcnkyZCA6IHBvcnRhbC5zdHlsZXNHcm91cFF1ZXJ5M2Q7XG4gIGlmICghZ3JvdXApIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgcmV0dXJuIGl0ZW1GZXRjaGVyKHtcbiAgICBwb3J0YWwsXG4gICAgcXVlcmllczoge1xuICAgICAgZ3JvdXAsXG4gICAgICBpdGVtOiBgdHlwZTpcIlN0eWxlXCJgXG4gICAgfVxuICB9KS50aGVuKG1vdmVEZWZhdWx0VG9GaXJzdCk7XG59XG5mdW5jdGlvbiBnZXRQcmltaXRpdmVzKGRpbWVuc2lvbmFsaXR5LCBzdHJpbmdzKSB7XG4gIHJldHVybiBkaW1lbnNpb25hbGl0eSA9PT0gXCJmbGF0XCJcbiAgICA/IG5ldyBJY29uUHJpbWl0aXZlV2ViU3R5bGVTb3VyY2UoeyBzdHJpbmdzIH0pXG4gICAgOiBuZXcgT2JqZWN0UHJpbWl0aXZlV2ViU3R5bGVTb3VyY2UoeyBzdHJpbmdzIH0pO1xufVxuZnVuY3Rpb24gZ2V0QmFzaWMoc3RyaW5ncywgZ2VvbWV0cnlUeXBlKSB7XG4gIGNvbnN0IHByb3BzID0geyBzdHJpbmdzIH07XG4gIHJldHVybiBnZW9tZXRyeVR5cGUgPT09IFwibGluZVwiXG4gICAgPyBuZXcgQmFzaWNMaW5lU3ltYm9sU2V0U291cmNlKHByb3BzKVxuICAgIDogZ2VvbWV0cnlUeXBlID09PSBcInBvbHlnb25cIlxuICAgICAgPyBuZXcgQmFzaWNQb2x5Z29uU3ltYm9sU2V0U291cmNlKHByb3BzKVxuICAgICAgOiBuZXcgQmFzaWNQb2ludFN5bWJvbFNldFNvdXJjZShwcm9wcyk7XG59XG5hc3luYyBmdW5jdGlvbiBpdGVtRmV0Y2hlcihvcHRpb25zKSB7XG4gIGNvbnN0IHBvcnRhbCA9IG9wdGlvbnMucG9ydGFsO1xuICBjb25zdCBncm91cFF1ZXJ5ID0gb3B0aW9ucy5xdWVyaWVzLmdyb3VwO1xuICBjb25zdCBpdGVtUXVlcnkgPSBvcHRpb25zLnF1ZXJpZXMuaXRlbTtcbiAgY29uc3QgbWF4SXRlbXMgPSAxMDA7XG4gIGNvbnN0IHsgcmVzdWx0cyB9ID0gYXdhaXQgcG9ydGFsLnF1ZXJ5R3JvdXBzKHsgcXVlcnk6IGdyb3VwUXVlcnksIGRpc2FibGVFeHRyYVF1ZXJ5OiB0cnVlIH0pO1xuICBpZiAocmVzdWx0cy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgY29uc3QgW2dyb3VwXSA9IHJlc3VsdHM7XG4gIHJldHVybiAoYXdhaXQgZ3JvdXAucXVlcnlJdGVtcyh7XG4gICAgcXVlcnk6IGl0ZW1RdWVyeSxcbiAgICBkaXNhYmxlRXh0cmFRdWVyeTogdHJ1ZSxcbiAgICBudW06IG1heEl0ZW1zLFxuICAgIHNvcnRGaWVsZDogZ3JvdXAuc29ydEZpZWxkXG4gIH0pKS5yZXN1bHRzO1xufVxuZnVuY3Rpb24gaGFzS2V5d29yZChpdGVtLCBrZXl3b3JkKSB7XG4gIHJldHVybiBpdGVtLnR5cGVLZXl3b3Jkcy5pbmRleE9mKGtleXdvcmQpID4gLTE7XG59XG5mdW5jdGlvbiBtb3ZlRGVmYXVsdFRvRmlyc3QocmVzdWx0cykge1xuICBjb25zdCBzb3J0ZWQgPSBbXTtcbiAgcmVzdWx0cy5mb3JFYWNoKChzZXQpID0+IHtcbiAgICBpZiAoaGFzS2V5d29yZChzZXQsIFwiZGVmYXVsdFwiKSkge1xuICAgICAgc29ydGVkLnVuc2hpZnQoc2V0KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBzb3J0ZWQucHVzaChzZXQpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBzb3J0ZWQ7XG59XG5cbmNvbnN0IGNpbUdlb21ldHJ5SXRlbVR5cGUgPSB7XG4gIHBvaW50OiBcInBvaW50U3ltYm9sXCIsXG4gIGxpbmU6IFwibGluZVN5bWJvbFwiLFxuICBwb2x5Z29uOiBcInBvbHlnb25TeW1ib2xcIlxufTtcbmNvbnN0IGlzSW50ZXJjZXB0b3IgPSAocG9ydGFsT3JQb3J0YWxJbnRlcmNlcHRvcikgPT4gISFwb3J0YWxPclBvcnRhbEludGVyY2VwdG9yLnBvcnRhbDtcbmFzeW5jIGZ1bmN0aW9uIGFzeW5jRmlsdGVyKGl0ZW1zLCBwcmVkaWNhdGUpIHtcbiAgcmV0dXJuIFByb21pc2UuYWxsKGl0ZW1zLm1hcChwcmVkaWNhdGUpKS50aGVuKChyZXN1bHRzKSA9PiBpdGVtcy5maWx0ZXIoKF9pdGVtLCBpbmRleCkgPT4gcmVzdWx0c1tpbmRleF0pKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZpbHRlclN5bWJvbEl0ZW1zKHNvdXJjZSwgc3ltYm9sSXRlbXMsIG1hcmtlclR5cGUsIGdlb21ldHJ5VHlwZSwgc3ltYm9sVHlwZSwgZmlsdGVyKSB7XG4gIGNvbnN0IGFsbG93ZWQgPSBub3JtYWxpemVBbGxvd2VkVHlwZXMobWFya2VyVHlwZSk7XG4gIGNvbnN0IGRlZmF1bHRTb3VyY2VGaWx0ZXIgPSBzeW1ib2xUeXBlID09PSBcIjJkXCJcbiAgICA/IGNyZWF0ZURlZmF1bHRTeW1ib2xJdGVtRmlsdGVyMmQoZ2VvbWV0cnlUeXBlLCBhbGxvd2VkKVxuICAgIDogY3JlYXRlRGVmYXVsdFN5bWJvbEl0ZW1GaWx0ZXIzZChhbGxvd2VkKTtcbiAgY29uc3QgZWZmZWN0aXZlRmlsdGVyID0gYXN5bmMgKHN5bWJvbEl0ZW0pID0+IGZpbHRlciA/IGZpbHRlcihzeW1ib2xJdGVtLCBzb3VyY2UsIGRlZmF1bHRTb3VyY2VGaWx0ZXIpIDogZGVmYXVsdFNvdXJjZUZpbHRlcihzeW1ib2xJdGVtLCBzb3VyY2UpO1xuICByZXR1cm4gYXN5bmNGaWx0ZXIoc3ltYm9sSXRlbXMsIGVmZmVjdGl2ZUZpbHRlcik7XG59XG5mdW5jdGlvbiBjcmVhdGVEZWZhdWx0U3ltYm9sSXRlbUZpbHRlcjJkKGdlb21ldHJ5VHlwZSwgYWxsb3dlZFR5cGVzKSB7XG4gIGZ1bmN0aW9uIHN5bWJvbEl0ZW1Pbmx5RmlsdGVyKHN5bWJvbEl0ZW0pIHtcbiAgICBpZiAoYWxsb3dlZFR5cGVzLmluY2x1ZGVzKFwiYWxsXCIpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3QgeyBkYXRhIH0gPSBzeW1ib2xJdGVtO1xuICAgIGNvbnN0IHsgZGltZW5zaW9uYWxpdHksIHR5cGU6IHN5bWJvbFR5cGUgfSA9IGRhdGE7XG4gICAgaWYgKGRpbWVuc2lvbmFsaXR5ID09PSBcInZvbHVtZXRyaWNcIikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoZ2VvbWV0cnlUeXBlID09PSBcInBvaW50XCIpIHtcbiAgICAgIGlmIChhbGxvd2VkVHlwZXMuaW5jbHVkZXMoXCJwaWN0dXJlXCIpICYmIHN5bWJvbFR5cGUgPT09IFwiZXNyaVBNU1wiKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKGFsbG93ZWRUeXBlcy5pbmNsdWRlcyhcInNpbXBsZVwiKSAmJiBzeW1ib2xUeXBlID09PSBcImVzcmlTTVNcIikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGdlb21ldHJ5VHlwZSA9PT0gXCJsaW5lXCIpIHtcbiAgICAgIGlmIChhbGxvd2VkVHlwZXMuaW5jbHVkZXMoXCJzaW1wbGVcIikgJiYgc3ltYm9sVHlwZSA9PT0gXCJlc3JpU0xTXCIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChnZW9tZXRyeVR5cGUgPT09IFwicG9seWdvblwiKSB7XG4gICAgICBpZiAoYWxsb3dlZFR5cGVzLmluY2x1ZGVzKFwic2ltcGxlXCIpICYmIHN5bWJvbFR5cGUgPT09IFwiZXNyaVNGU1wiKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCB7IGZvcm1hdHMgfSA9IGRhdGE7XG4gICAgaWYgKGhhc0NJTVR5cGUoYWxsb3dlZFR5cGVzKSAmJiBoYXNDSU1UeXBlKGZvcm1hdHMpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiBhc3luYyBmdW5jdGlvbiBkZWZhdWx0U3ltYm9sSXRlbUZpbHRlcjJkKHN5bWJvbEl0ZW0sIHNvdXJjZSkge1xuICAgIGNvbnN0IGdlb21ldHJ5U3ltYm9sRmlsdGVyID0gZ2VvbWV0cnlUeXBlID09PSBcInBvaW50XCIgPyBpc1BvaW50Q0lNIDogZ2VvbWV0cnlUeXBlID09PSBcImxpbmVcIiA/IGlzTGluZUNJTSA6IGlzUG9seWdvbkNJTTtcbiAgICBpZiAoIXN5bWJvbEl0ZW1Pbmx5RmlsdGVyKHN5bWJvbEl0ZW0pKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGhhc1BpY3R1cmVDSU0gPSBhbGxvd2VkVHlwZXMuaW5jbHVkZXMoXCJjaW06cGljdHVyZVwiKTtcbiAgICBjb25zdCBoYXNWZWN0b3JDSU0gPSBhbGxvd2VkVHlwZXMuaW5jbHVkZXMoXCJjaW06dmVjdG9yXCIpO1xuICAgIGNvbnN0IGhhc0FsbE9yTm9DSU1GaWx0ZXJzID0gKGhhc1BpY3R1cmVDSU0gJiYgaGFzVmVjdG9yQ0lNKSB8fCAoIWhhc1BpY3R1cmVDSU0gJiYgIWhhc1ZlY3RvckNJTSk7XG4gICAgLy8gVE9ETzogYmFzZSBvbiBnZW9tdHlwZVxuICAgIGNvbnN0IGlzUG9pbnRPbmx5Q2ltU291cmNlID0gaGFzQ2ltUG9pbnRLZXl3b3JkKHNvdXJjZSkgJiYgIWhhc0NpbUxpbmVLZXl3b3JkKHNvdXJjZSkgJiYgIWhhc0NpbVBvbHlnb25LZXl3b3JkKHNvdXJjZSk7XG4gICAgY29uc3QgaXNMaW5lT25seUNpbVNvdXJjZSA9IGhhc0NpbUxpbmVLZXl3b3JkKHNvdXJjZSkgJiYgIWhhc0NpbVBvaW50S2V5d29yZChzb3VyY2UpICYmICFoYXNDaW1Qb2x5Z29uS2V5d29yZChzb3VyY2UpO1xuICAgIGNvbnN0IGlzUG9seWdvbk9ubHlDaW1Tb3VyY2UgPSBoYXNDaW1Qb2x5Z29uS2V5d29yZChzb3VyY2UpICYmICFoYXNDaW1Qb2ludEtleXdvcmQoc291cmNlKSAmJiAhaGFzQ2ltTGluZUtleXdvcmQoc291cmNlKTtcbiAgICBjb25zdCByZXF1ZXN0ZWRUeXBlID0gZ2VvbWV0cnlUeXBlID09PSBcImxpbmVcIlxuICAgICAgPyBjaW1HZW9tZXRyeUl0ZW1UeXBlLmxpbmVcbiAgICAgIDogZ2VvbWV0cnlUeXBlID09PSBcInBvbHlnb25cIlxuICAgICAgICA/IGNpbUdlb21ldHJ5SXRlbVR5cGUucG9seWdvblxuICAgICAgICA6IGNpbUdlb21ldHJ5SXRlbVR5cGUucG9pbnQ7XG4gICAgY29uc3QgaXNSZXF1ZXN0ZWRUeXBlQ2ltU291cmNlID0gaXNQb2ludE9ubHlDaW1Tb3VyY2UgfHwgaXNMaW5lT25seUNpbVNvdXJjZSB8fCBpc1BvbHlnb25Pbmx5Q2ltU291cmNlO1xuICAgIGlmICgoaXNSZXF1ZXN0ZWRUeXBlQ2ltU291cmNlICYmIGhhc0FsbE9yTm9DSU1GaWx0ZXJzKSB8fFxuICAgICAgc291cmNlLnR5cGUgIT09IFwid2ViLXN0eWxlXCIgfHxcbiAgICAgIHN5bWJvbEl0ZW0uZGF0YS5pdGVtVHlwZSA9PT0gcmVxdWVzdGVkVHlwZSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IHN5bWJvbCA9IGF3YWl0IHN5bWJvbEl0ZW0uZ2V0U3ltYm9sKCk7XG4gICAgLy8gd2Ugb25seSBmaWx0ZXIgQ0lNIHN5bWJvbHMsIHRoZSByZXN0IHdlIGxldCB0aHJvdWdoXG4gICAgcmV0dXJuICFpc0NJTVN5bWJvbChzeW1ib2wpIHx8IGdlb21ldHJ5U3ltYm9sRmlsdGVyKHN5bWJvbCk7XG4gIH07XG59XG5mdW5jdGlvbiBjcmVhdGVEZWZhdWx0U3ltYm9sSXRlbUZpbHRlcjNkKGFsbG93ZWRUeXBlcykge1xuICByZXR1cm4gYXN5bmMgZnVuY3Rpb24gZGVmYXVsdFN5bWJvbEl0ZW1GaWx0ZXIzZChzeW1ib2xJdGVtKSB7XG4gICAgaWYgKGFsbG93ZWRUeXBlcy5pbmNsdWRlcyhcImFsbFwiKSB8fCBhbGxvd2VkVHlwZXMuaW5jbHVkZXMoXCIzZFwiKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IHsgZGF0YTogeyBkaW1lbnNpb25hbGl0eSB9IH0gPSBzeW1ib2xJdGVtO1xuICAgIHJldHVybiAoKGFsbG93ZWRUeXBlcy5pbmNsdWRlcyhcIjNkOmZsYXRcIikgJiYgZGltZW5zaW9uYWxpdHkgPT09IFwiZmxhdFwiKSB8fFxuICAgICAgKGFsbG93ZWRUeXBlcy5pbmNsdWRlcyhcIjNkOnZvbHVtZXRyaWNcIikgJiYgZGltZW5zaW9uYWxpdHkgPT09IFwidm9sdW1ldHJpY1wiKSk7XG4gIH07XG59XG5jb25zdCBnZW9tZXRyeVR5cGVLZXl3b3JkcyA9IHtcbiAgcG9pbnQ6IFwiUG9pbnRcIixcbiAgbGluZTogXCJMaW5lXCIsXG4gIHBvbHlnb246IFwiUG9seWdvblwiXG59O1xuZnVuY3Rpb24gaGFzQ2ltUG9pbnRLZXl3b3JkKHsga2V5d29yZHMgfSkge1xuICByZXR1cm4ga2V5d29yZHMuaW5jbHVkZXMoZ2VvbWV0cnlUeXBlS2V5d29yZHMucG9pbnQpIHx8IGtleXdvcmRzLmluY2x1ZGVzKFwicG9pbnRTeW1ib2xcIik7XG59XG5mdW5jdGlvbiBoYXNNYXJrZXJLZXl3b3JkKHsga2V5d29yZHMgfSkge1xuICByZXR1cm4ga2V5d29yZHMuaW5jbHVkZXMoXCJtYXJrZXJcIik7XG59XG5mdW5jdGlvbiBoYXNDaW1MaW5lS2V5d29yZCh7IGtleXdvcmRzIH0pIHtcbiAgcmV0dXJuIGtleXdvcmRzLmluY2x1ZGVzKGdlb21ldHJ5VHlwZUtleXdvcmRzLmxpbmUpIHx8IGtleXdvcmRzLmluY2x1ZGVzKFwibGluZVN5bWJvbFwiKTtcbn1cbmZ1bmN0aW9uIGhhc0NpbVBvbHlnb25LZXl3b3JkKHsga2V5d29yZHMgfSkge1xuICByZXR1cm4ga2V5d29yZHMuaW5jbHVkZXMoZ2VvbWV0cnlUeXBlS2V5d29yZHMucG9seWdvbikgfHwga2V5d29yZHMuaW5jbHVkZXMoXCJwb2x5Z29uU3ltYm9sXCIpO1xufVxuYXN5bmMgZnVuY3Rpb24gZmlsdGVyU291cmNlcyhzb3VyY2VzLCB0eXBlLCBnZW9tZXRyeVR5cGUsIHN5bWJvbFR5cGUsIGZpbHRlcikge1xuICBjb25zdCBhbGxvd2VkID0gbm9ybWFsaXplQWxsb3dlZFR5cGVzKHR5cGUpO1xuICBjb25zdCBkZWZhdWx0U291cmNlRmlsdGVyID0gc3ltYm9sVHlwZSA9PT0gXCIyZFwiXG4gICAgPyBjcmVhdGVEZWZhdWx0U3ltYm9sU291cmNlRmlsdGVyMmQoZ2VvbWV0cnlUeXBlLCBhbGxvd2VkKVxuICAgIDogY3JlYXRlRGVmYXVsdFN5bWJvbFNvdXJjZUZpbHRlcjNkKGFsbG93ZWQpO1xuICBjb25zdCBlZmZlY3RpdmVGaWx0ZXIgPSBhc3luYyAoc3ltYm9sU291cmNlKSA9PiBmaWx0ZXIgPyBmaWx0ZXIoc3ltYm9sU291cmNlLCBkZWZhdWx0U291cmNlRmlsdGVyKSA6IGRlZmF1bHRTb3VyY2VGaWx0ZXIoc3ltYm9sU291cmNlKTtcbiAgcmV0dXJuIGFzeW5jRmlsdGVyKHNvdXJjZXMsIGVmZmVjdGl2ZUZpbHRlcik7XG59XG5mdW5jdGlvbiBjcmVhdGVEZWZhdWx0U3ltYm9sU291cmNlRmlsdGVyMmQoZ2VvbWV0cnlUeXBlLCBhbGxvd2VkVHlwZXMpIHtcbiAgcmV0dXJuIGFzeW5jIChzb3VyY2UpID0+IHtcbiAgICBjb25zdCBpczNkID0gc291cmNlLmtleXdvcmRzLmluY2x1ZGVzKFwiM2RcIik7XG4gICAgY29uc3QgaXNEaWN0aW9uYXJ5ID0gc291cmNlLmtleXdvcmRzLmluY2x1ZGVzKFwiRGljdGlvbmFyeVwiKTtcbiAgICBjb25zdCBtYXRjaGVzR2VvbWV0cnlUeXBlID0gZ2VvbWV0cnlUeXBlID09PSBcInBvaW50XCJcbiAgICAgID8gaGFzQ2ltUG9pbnRLZXl3b3JkKHNvdXJjZSkgfHwgaGFzTWFya2VyS2V5d29yZChzb3VyY2UpXG4gICAgICA6IGdlb21ldHJ5VHlwZSA9PT0gXCJsaW5lXCJcbiAgICAgICAgPyBoYXNDaW1MaW5lS2V5d29yZChzb3VyY2UpXG4gICAgICAgIDogaGFzQ2ltUG9seWdvbktleXdvcmQoc291cmNlKTtcbiAgICBjb25zdCBoYXNBdExlYXN0T25lR2VvbUtleXdvcmQgPSBoYXNDaW1Qb2ludEtleXdvcmQoc291cmNlKSB8fFxuICAgICAgaGFzTWFya2VyS2V5d29yZChzb3VyY2UpIHx8XG4gICAgICBoYXNDaW1MaW5lS2V5d29yZChzb3VyY2UpIHx8XG4gICAgICBoYXNDaW1Qb2x5Z29uS2V5d29yZChzb3VyY2UpO1xuICAgIGlmIChpczNkIHx8IGlzRGljdGlvbmFyeSB8fCAoIW1hdGNoZXNHZW9tZXRyeVR5cGUgJiYgaGFzQXRMZWFzdE9uZUdlb21LZXl3b3JkKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoYWxsb3dlZFR5cGVzLmluY2x1ZGVzKFwiYWxsXCIpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZ2V0QmFzaWNTb3VyY2VJZCgpIHtcbiAgICAgIHJldHVybiBnZW9tZXRyeVR5cGUgPT09IFwicG9pbnRcIlxuICAgICAgICA/IGJhc2ljUG9pbnRTeW1ib2xTZXRTb3VyY2VJZFxuICAgICAgICA6IGdlb21ldHJ5VHlwZSA9PT0gXCJsaW5lXCJcbiAgICAgICAgICA/IGJhc2ljTGluZVN5bWJvbFNldFNvdXJjZUlkXG4gICAgICAgICAgOiBiYXNpY1BvbHlnb25TeW1ib2xTZXRTb3VyY2VJZDtcbiAgICB9XG4gICAgY29uc3QgYmFzaWNTeW1ib2xTZXRTb3VyY2VJZCA9IGdldEJhc2ljU291cmNlSWQoKTtcbiAgICBpZiAoYWxsb3dlZFR5cGVzLmluY2x1ZGVzKFwicGljdHVyZVwiKSAmJiBzb3VyY2UuaWQgIT0gYmFzaWNTeW1ib2xTZXRTb3VyY2VJZCAmJiBzb3VyY2UudHlwZSA9PT0gXCJzeW1ib2wtc2V0XCIpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoYWxsb3dlZFR5cGVzLmluY2x1ZGVzKFwic2ltcGxlXCIpICYmIHNvdXJjZS5pZCA9PT0gYmFzaWNTeW1ib2xTZXRTb3VyY2VJZCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChoYXNDSU1UeXBlKGFsbG93ZWRUeXBlcykgJiYgc291cmNlLnR5cGUgPT09IFwid2ViLXN0eWxlXCIpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG59XG5mdW5jdGlvbiBpc1BvcnRhbFNvdXJjZShzb3VyY2UpIHtcbiAgcmV0dXJuIFwicG9ydGFsSXRlbVwiIGluIHNvdXJjZTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZURlZmF1bHRTeW1ib2xTb3VyY2VGaWx0ZXIzZChhbGxvd2VkVHlwZXMpIHtcbiAgY29uc3Qgd2ViU3R5bGVJdGVtS2V5d29yZEJsb2NrbGlzdCA9IHtcbiAgICBFc3JpVGhlbWF0aWNTaGFwZXNTdHlsZTogdHJ1ZVxuICB9O1xuICByZXR1cm4gYXN5bmMgKHNvdXJjZSkgPT4ge1xuICAgIGlmIChzb3VyY2Uua2V5d29yZHMuZXZlcnkoKGtleXdvcmQpID0+ICF3ZWJTdHlsZUl0ZW1LZXl3b3JkQmxvY2tsaXN0W2tleXdvcmRdKSAmJlxuICAgICAgc291cmNlLnR5cGUgPT09IFwid2ViLXN0eWxlXCIgJiZcbiAgICAgIChhbGxvd2VkVHlwZXMuaW5jbHVkZXMoXCJhbGxcIikgfHwgYWxsb3dlZFR5cGVzLmluY2x1ZGVzKFwiM2RcIikpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGlzUG9ydGFsU291cmNlKHNvdXJjZSkpIHtcbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBzb3VyY2UuZmV0Y2hEYXRhKCk7XG4gICAgICBjb25zdCBbZmlyc3RdID0gZGF0YS5pdGVtcztcbiAgICAgIGNvbnN0IHsgZGltZW5zaW9uYWxpdHkgfSA9IGZpcnN0O1xuICAgICAgcmV0dXJuICgoYWxsb3dlZFR5cGVzLmluY2x1ZGVzKFwiM2Q6ZmxhdFwiKSAmJiBkaW1lbnNpb25hbGl0eSA9PT0gXCJmbGF0XCIpIHx8XG4gICAgICAgIChhbGxvd2VkVHlwZXMuaW5jbHVkZXMoXCIzZDp2b2x1bWV0cmljXCIpICYmIGRpbWVuc2lvbmFsaXR5ID09PSBcInZvbHVtZXRyaWNcIikpO1xuICAgIH1cbiAgICByZXR1cm4gKChhbGxvd2VkVHlwZXMuaW5jbHVkZXMoXCIzZDpmbGF0XCIpICYmIHNvdXJjZS5pZCA9PSBcImJhc2ljLXdlYi1zdHlsZTpmbGF0XCIpIHx8XG4gICAgICAoYWxsb3dlZFR5cGVzLmluY2x1ZGVzKFwiM2Q6dm9sdW1ldHJpY1wiKSAmJiBzb3VyY2UuaWQgPT0gXCJiYXNpYy13ZWItc3R5bGU6dm9sdW1ldHJpY1wiKSk7XG4gIH07XG59XG5mdW5jdGlvbiBoYXNDSU1UeXBlKHR5cGVzKSB7XG4gIHJldHVybiBBcnJheS5pc0FycmF5KHR5cGVzKSAmJiB0eXBlcy5zb21lKCh0eXBlKSA9PiB0eXBlLmluY2x1ZGVzKFwiY2ltXCIpKTtcbn1cbmZ1bmN0aW9uIG5vcm1hbGl6ZUFsbG93ZWRUeXBlcyh0eXBlID0gXCJhbGxcIikge1xuICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkodHlwZSkgPyB0eXBlIDogW3R5cGVdO1xuICBjb25zdCBoYXNSZWR1bmRhbnRDSU1UeXBlcyA9IHR5cGVzLmZpbmQoKHR5cGUpID0+IHR5cGUgPT09IFwiY2ltXCIgJiYgdHlwZXMuZmluZCgodHlwZSkgPT4gdHlwZS5pbmNsdWRlcyhcImNpbTpcIikpKTtcbiAgaWYgKGhhc1JlZHVuZGFudENJTVR5cGVzKSB7XG4gICAgcmV0dXJuIHR5cGVzLmZpbHRlcigodHlwZSkgPT4gIXR5cGUuaW5jbHVkZXMoXCJjaW06XCIpKTtcbiAgfVxuICByZXR1cm4gdHlwZXM7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaFNvdXJjZXMocG9ydGFsLCBiZWZvcmUsIGFmdGVyLCBzdHJpbmdzLCB0eXBlKSB7XG4gIGNvbnN0IGludGVyY2VwdG9yRGF0YSA9IHt9O1xuICBpZiAoYmVmb3JlKSB7XG4gICAgYXdhaXQgYmVmb3JlKHBvcnRhbCwgaW50ZXJjZXB0b3JEYXRhKTtcbiAgfVxuICBhd2FpdCBwb3J0YWwubG9hZCgpO1xuICBjb25zdCBwcm9jZXNzZWRTb3VyY2VzID0gYXdhaXQgKHR5cGUgPT09IFwiMmRcIiA/IGJ1aWxkMmRTb3VyY2VzKHBvcnRhbCwgc3RyaW5ncykgOiBidWlsZDNkU291cmNlcyhwb3J0YWwsIHN0cmluZ3MpKTtcbiAgaWYgKGFmdGVyKSB7XG4gICAgYXdhaXQgYWZ0ZXIocG9ydGFsLCBpbnRlcmNlcHRvckRhdGEpO1xuICB9XG4gIHJldHVybiBwcm9jZXNzZWRTb3VyY2VzO1xufVxuYXN5bmMgZnVuY3Rpb24gYnVpbGQyZFNvdXJjZXMocG9ydGFsLCBzdHJpbmdzKSB7XG4gIGNvbnN0IG9yaWdpbmFsU3ltYm9sU2V0c0dyb3VwUXVlcnkgPSBwb3J0YWwuc3ltYm9sU2V0c0dyb3VwUXVlcnk7XG4gIHBvcnRhbC5zeW1ib2xTZXRzR3JvdXBRdWVyeSA9ICdvd25lcjplc3JpIEFORCB0aXRsZTpcIk1hcCBWaWV3ZXIgQmV0YSBTeW1ib2xzXCInO1xuICBjb25zdCBbY2xhc3NpYywgc291cmNlc10gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgZmV0Y2hTeW1ib2xTZXRTeW1ib2xTb3VyY2VzKHBvcnRhbCwgc3RyaW5ncyksXG4gICAgZmV0Y2hXZWJTdHlsZVN5bWJvbFNvdXJjZXMocG9ydGFsLCBcIjJkXCIsIHN0cmluZ3MpXG4gIF0pO1xuICBjb25zdCBmaWx0ZXJPdXRCYXNpY1R5cGVzID0gKHNvdXJjZSkgPT4gc291cmNlLmtleXdvcmRzLmV2ZXJ5KCh0eXBlKSA9PiB0eXBlICE9PSBcIkJhc2ljXCIpO1xuICBjb25zdCBwcm9jZXNzZWRTb3VyY2VzID0gW1xuICAgIGdldEJhc2ljKHN0cmluZ3MsIFwicG9pbnRcIiksXG4gICAgZ2V0QmFzaWMoc3RyaW5ncywgXCJsaW5lXCIpLFxuICAgIGdldEJhc2ljKHN0cmluZ3MsIFwicG9seWdvblwiKSxcbiAgICAuLi5jbGFzc2ljLmZpbHRlcihmaWx0ZXJPdXRCYXNpY1R5cGVzKSxcbiAgICAuLi5zb3VyY2VzLmZpbHRlcihmaWx0ZXJPdXRCYXNpY1R5cGVzKVxuICBdO1xuICBwb3J0YWwuc3ltYm9sU2V0c0dyb3VwUXVlcnkgPSBvcmlnaW5hbFN5bWJvbFNldHNHcm91cFF1ZXJ5O1xuICByZXR1cm4gcHJvY2Vzc2VkU291cmNlcztcbn1cbmFzeW5jIGZ1bmN0aW9uIGJ1aWxkM2RTb3VyY2VzKHBvcnRhbCwgc3RyaW5ncykge1xuICBjb25zdCBbc291cmNlc10gPSBhd2FpdCBQcm9taXNlLmFsbChbZmV0Y2hXZWJTdHlsZVN5bWJvbFNvdXJjZXMocG9ydGFsLCBcIjNkXCIsIHN0cmluZ3MpXSk7XG4gIGNvbnN0IGZpbHRlck91dEJhc2ljVHlwZXMgPSAoc291cmNlKSA9PiBzb3VyY2Uua2V5d29yZHMuZXZlcnkoKHR5cGUpID0+IHR5cGUgIT09IFwiQmFzaWNcIik7XG4gIGNvbnN0IHByb2Nlc3NlZFNvdXJjZXMgPSBbXG4gICAgZ2V0UHJpbWl0aXZlcyhcImZsYXRcIiwgc3RyaW5ncyksXG4gICAgZ2V0UHJpbWl0aXZlcyhcInZvbHVtZXRyaWNcIiwgc3RyaW5ncyksXG4gICAgLi4uc291cmNlcy5maWx0ZXIoZmlsdGVyT3V0QmFzaWNUeXBlcylcbiAgXTtcbiAgcmV0dXJuIHByb2Nlc3NlZFNvdXJjZXM7XG59XG5cbmNvbnN0IGFyY2dpc1N5bWJvbFBpY2tlckNzcyA9IFwiLnNjcm9sbGVyLnNjLWFyY2dpcy1zeW1ib2wtcGlja2Vye21heC1oZWlnaHQ6dmFyKC0tc2Nyb2xsZXItbWF4LWhlaWdodCwgbWluKDEwMHZoIC0gNDAwcHgsIDMwMHB4KSk7b3ZlcmZsb3cteTphdXRvO21pbi13aWR0aDoyMDBweDtvdmVyZmxvdy14OmhpZGRlbjtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OmNlbnRlcn0uc2MtYXJjZ2lzLXN5bWJvbC1waWNrZXItaCwuYXJjZ2lzLXN5bWJvbC1waWNrZXJfX2NvbnRhaW5lci5zYy1hcmNnaXMtc3ltYm9sLXBpY2tlcntkaXNwbGF5OmZsZXg7ZmxleDoxIDEgYXV0bztmbGV4LWZsb3c6Y29sdW1uIG5vd3JhcDthbGlnbi1pdGVtczpzdHJldGNofS5jYXRlZ29yaWVzLnNjLWFyY2dpcy1zeW1ib2wtcGlja2Vye2Rpc3BsYXk6ZmxleDthbGlnbi1jb250ZW50Om5vcm1hbH0uY2F0ZWdvcmllcy1jZW50ZXItYWN0aW9uLnNjLWFyY2dpcy1zeW1ib2wtcGlja2Vye3BhZGRpbmc6MCA1cHh9Lm1hcmtlci1zZWxlY3Rpb24uc2MtYXJjZ2lzLXN5bWJvbC1waWNrZXJ7cGFkZGluZzo4cHh9Lm1hcmtlci1zb3VyY2Utc2VsZWN0LnNjLWFyY2dpcy1zeW1ib2wtcGlja2Vye3dpZHRoOmNhbGMoMTAwJSAtIDc0cHgpO2Rpc3BsYXk6YmxvY2t9Lm1hcmtlci1zb3VyY2Utc2VsZWN0W2hpZGRlbl0uc2MtYXJjZ2lzLXN5bWJvbC1waWNrZXIrLm1hcmtlci1zZWxlY3Rpb24uc2MtYXJjZ2lzLXN5bWJvbC1waWNrZXJ7Ym9yZGVyLXRvcDoxcHggc29saWQgbGlnaHRncmF5O2JhY2tncm91bmQtY29sb3I6dmFyKC0tYXJjZ2lzLWFwcC1iYWNrZ3JvdW5kKX0ubWFya2VyLXNlbGVjdGlvbi0tZGFyay5zYy1hcmNnaXMtc3ltYm9sLXBpY2tlcntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWFyY2dpcy1hcHAtZm9yZWdyb3VuZCk7Y29sb3I6dmFyKC0tYXJjZ2lzLWFwcC1iYWNrZ3JvdW5kKX0uZW1wdHktY2F0ZWdvcnktY29udGVudC5zYy1hcmNnaXMtc3ltYm9sLXBpY2tlcntkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO3BhZGRpbmc6dmFyKC0tYXJjZ2lzLWFwcC1zcGFjaW5nLWhhbGYpIHZhcigtLWFyY2dpcy1hcHAtc3BhY2luZy1xdWFydGVyKX0uaW5jb21wYXRpYmxlLXN5bWJvbHMtbm90aWNlLnNjLWFyY2dpcy1zeW1ib2wtcGlja2Vye21hcmdpbjo4cHggMH0ubWFya2VyLWl0ZW0uc2MtYXJjZ2lzLXN5bWJvbC1waWNrZXJ7aGVpZ2h0OjQwcHg7d2lkdGg6MzguNXB4O2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2FsaWduLWl0ZW1zOmNlbnRlcjtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWFyY2dpcy1hcHAtYmFja2dyb3VuZCl9Lm1hcmtlci1pdGVtLnNjLWFyY2dpcy1zeW1ib2wtcGlja2VyIFtzbG90PXRodW1ibmFpbF0uc2MtYXJjZ2lzLXN5bWJvbC1waWNrZXI+ZGl2LnNjLWFyY2dpcy1zeW1ib2wtcGlja2Vye21hcmdpbjo4cHggMTBweDtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OmNlbnRlcjthbGlnbi1pdGVtczpjZW50ZXJ9Lml0ZW0tcGFsZXR0ZS5zYy1hcmNnaXMtc3ltYm9sLXBpY2tlcnt3aWR0aDoxMDAlO2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW59LmZpbGUtdXBsb2FkLnNjLWFyY2dpcy1zeW1ib2wtcGlja2Vye21hcmdpbi10b3A6MjBweDt3aWR0aDphdXRvfVwiO1xuXG5jb25zdCBDU1MgPSB7XG4gIGNvbnRhaW5lcjogXCJhcmNnaXMtc3ltYm9sLXBpY2tlcl9fY29udGFpbmVyXCIsXG4gIG1hcmtlclN5bWJvbENvbnRlbnQ6IFwibWFya2VyLXN5bWJvbC1jb250ZW50XCIsXG4gIGluY29tcGF0aWJsZVN5bWJvbHNOb3RpY2U6IFwiaW5jb21wYXRpYmxlLXN5bWJvbHMtbm90aWNlXCIsXG4gIGVtcHR5Q2F0ZWdvcnlDb250ZW50OiBcImVtcHR5LWNhdGVnb3J5LWNvbnRlbnRcIixcbiAgbWFya2VyU2VsZWN0aW9uRHJvcGRvd246IFwibWFya2VyLXNvdXJjZS1zZWxlY3RcIixcbiAgbWFya2VyU2VsZWN0aW9uOiBcIm1hcmtlci1zZWxlY3Rpb25cIixcbiAgbWFya2VyU2VsZWN0aW9uRGFyazogXCJtYXJrZXItc2VsZWN0aW9uLS1kYXJrXCIsXG4gIHNjcm9sbGVyOiBcInNjcm9sbGVyXCIsXG4gIGl0ZW1QYWxldHRlOiBcIml0ZW0tcGFsZXR0ZVwiLFxuICBmaWxlVXBsb2FkOiBcImZpbGUtdXBsb2FkXCIsXG4gIGNhdGVnb3JpZXM6IFwiY2F0ZWdvcmllc1wiLFxuICBjYXRlZ29yaWVzQ2VudGVyQWN0aW9uOiBcImNhdGVnb3JpZXMtY2VudGVyLWFjdGlvblwiXG59O1xuY29uc3QgQXJjZ2lzU3ltYm9sUGlja2VyID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc0FjdGl2ZVN5bWJvbENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzQWN0aXZlU3ltYm9sQ2hhbmdlXCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzQWN0aXZlU3ltYm9sSXRlbUNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzQWN0aXZlU3ltYm9sSXRlbUNoYW5nZVwiLCA3KTtcbiAgICB0aGlzLmFyY2dpc0FjdGl2ZVNvdXJjZUlkQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNBY3RpdmVTb3VyY2VJZENoYW5nZVwiLCA3KTtcbiAgICB0aGlzLmFyY2dpc1N5bWJvbFNvdXJjZXNDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1N5bWJvbFNvdXJjZXNDaGFuZ2VcIiwgNyk7XG4gICAgdGhpcy5hcmNnaXNBY3RpdmVTb3VyY2VJdGVtc0NoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzQWN0aXZlU291cmNlSXRlbXNDaGFuZ2VcIiwgNyk7XG4gICAgdGhpcy5hbGxDdXN0b21GaWxlSW5mb3MgPSBbXTtcbiAgICB0aGlzLmN1c3RvbVN5bWJvbHNTdG9yYWdlSWQgPSBcImFyY2dpcy1zeW1ib2wtcGlja2VyLWN1c3RvbS1zeW1ib2xzXCI7XG4gICAgdGhpcy5hY3Rpb25FbHMgPSBbXTtcbiAgICB0aGlzLl9vblN5bWJvbFNvdXJjZUNoYW5nZSA9IChldmVudCkgPT4ge1xuICAgICAgY29uc3QgZHJvcGRvd24gPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgICAgY29uc3QgeyBzZWxlY3RlZEl0ZW1zIH0gPSBkcm9wZG93bjtcbiAgICAgIGNvbnN0IG1vc3RSZWNlbnRTZWxlY3Rpb24gPSBzZWxlY3RlZEl0ZW1zLmZpbmQoKGl0ZW0pID0+IGl0ZW0uZ2V0QXR0cmlidXRlKFwiZGF0YS12YWx1ZVwiKSAhPT0gdGhpcy5fYWN0aXZlU291cmNlSWQpO1xuICAgICAgdGhpcy5fYWN0aXZlU291cmNlSWQgPSAobW9zdFJlY2VudFNlbGVjdGlvbiA9PT0gbnVsbCB8fCBtb3N0UmVjZW50U2VsZWN0aW9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtb3N0UmVjZW50U2VsZWN0aW9uLmdldEF0dHJpYnV0ZShcImRhdGEtdmFsdWVcIikpIHx8IHRoaXMuX2FjdGl2ZVNvdXJjZUlkO1xuICAgICAgZHJvcGRvd25cbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIilcbiAgICAgICAgLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgaWYgKGl0ZW0gIT09IG1vc3RSZWNlbnRTZWxlY3Rpb24pIHtcbiAgICAgICAgICBpdGVtLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfTtcbiAgICB0aGlzLnN5bWJvbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnN5bWJvbEZpbHRlciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmFjdGl2ZVNvdXJjZUlkID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuYWN0aXZlU3ltYm9sSXRlbSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmhpZGVIZWFkZXIgPSBmYWxzZTtcbiAgICB0aGlzLnN5bWJvbFR5cGUgPSBcIjJkXCI7XG4gICAgdGhpcy5jdXN0b21TeW1ib2xJdGVtRmlsdGVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuY3VzdG9tU3ltYm9sU291cmNlRmlsdGVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaXRlbXNQZXJSb3cgPSA0O1xuICAgIHRoaXMuc3ltYm9sU291cmNlcyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmFjdGl2ZVN5bWJvbEl0ZW1zID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubWVzc2FnZXMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5fYWN0aXZlU291cmNlSWQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5fc3ltYm9sU291cmNlcyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLl9hY3RpdmVTeW1ib2xJdGVtcyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmN1c3RvbVN5bWJvbEVycm9yID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaXNHcmlkVmlldyA9IHRydWU7XG4gICAgdGhpcy5fYWN0aXZlU3ltYm9sRmV0Y2ggPSB1bmRlZmluZWQ7XG4gIH1cbiAgLyoqXG4gICAqIFdoZW5ldmVyIHRoZSBhY3RpdmVTb3VyY2UgY2hhbmdlcywgd2UgZmV0Y2hcbiAgICogdGhlIG5ldyBzeW1ib2wgaXRlbXMgZm9yIHRoYXQgc291cmNlcy5cbiAgICovXG4gIGhhbmRsZUFjdGl2ZVNvdXJjZUl0ZW1JZENoYW5nZXMoKSB7XG4gICAgaWYgKHRoaXMuX2FjdGl2ZVNvdXJjZUlkKSB7XG4gICAgICB0aGlzLl9hY3RpdmVTb3VyY2VJZCA9PT0gXCJjdXN0b20tc3ltYm9sLXNldFwiXG4gICAgICAgID8gdGhpcy5fc2V0dXBDdXN0b21TeW1ib2xzKClcbiAgICAgICAgOiB0aGlzLl9mZXRjaEFuZFNldFVwU3ltYm9sSXRlbXModGhpcy5fc3ltYm9sU291cmNlcy5maW5kKCh7IGlkIH0pID0+IGlkID09PSB0aGlzLl9hY3RpdmVTb3VyY2VJZCkpO1xuICAgIH1cbiAgfVxuICBnZXQgZWRpdEdlb21ldHJ5KCkge1xuICAgIHJldHVybiBnZW9tZXRyeVR5cGUodGhpcy5zeW1ib2wpO1xuICB9XG4gIGhhbmRsZUZpbGVVcGxvYWRDaGFuZ2UoeyBkZXRhaWwgfSkge1xuICAgIGNvbnN0IGZpbGVJbmZvID0gZGV0YWlsO1xuICAgIGNvbnN0IGNpbVN0ciA9IGZpbGVJbmZvLmNpbSAmJiBKU09OLnN0cmluZ2lmeShmaWxlSW5mby5jaW0udG9KU09OKCkpO1xuICAgIGlmIChmaWxlSW5mby5kYXRhVVJMICYmIGZpbGVJbmZvLmRhdGFVUkwubGVuZ3RoID4gMjAwMDAwKSB7XG4gICAgICB0aGlzLmN1c3RvbVN5bWJvbEVycm9yID0gXCJ0b28tbGFyZ2VcIjtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZWxzZSBpZiAoZmlsZUluZm8uY2ltICYmIGNpbVN0ci5sZW5ndGggPiAyMDAwMDApIHtcbiAgICAgIHRoaXMuY3VzdG9tU3ltYm9sRXJyb3IgPSBcInRvby1sYXJnZVwiO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuY3VzdG9tU3ltYm9sRXJyb3IgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGNvbnN0IGZvdW5kRmlsZUluZm8gPSB0aGlzLmFsbEN1c3RvbUZpbGVJbmZvcy5maW5kKChpbmZvKSA9PiAoZmlsZUluZm8uZGF0YVVSTCAmJlxuICAgICAgaW5mby5kYXRhVVJMICYmXG4gICAgICBpbmZvLmRhdGFVUkwgPT09IGZpbGVJbmZvLmRhdGFVUkwgJiZcbiAgICAgIGluZm8uZmlsZU5hbWUgPT09IGZpbGVJbmZvLmZpbGVOYW1lKSB8fFxuICAgICAgKGZpbGVJbmZvLmNpbSAmJlxuICAgICAgICBpbmZvLmNpbSAmJlxuICAgICAgICBpbmZvLmZpbGVOYW1lID09PSBmaWxlSW5mby5maWxlTmFtZSAmJlxuICAgICAgICBjaW1TdHIgPT09IEpTT04uc3RyaW5naWZ5KGluZm8uY2ltLnRvSlNPTigpKSkpO1xuICAgIHRyeSB7XG4gICAgICBsZXQgYWN0aXZlU3ltYm9sSXRlbTtcbiAgICAgIGlmICghZm91bmRGaWxlSW5mbykge1xuICAgICAgICBjb25zdCBhbGxDdXN0b21GaWxlSW5mb3MgPSBbLi4udGhpcy5hbGxDdXN0b21GaWxlSW5mb3MsIGZpbGVJbmZvXTtcbiAgICAgICAgc2V0TG9jYWxTdG9yYWdlSXRlbSh0aGlzLmN1c3RvbVN5bWJvbHNTdG9yYWdlSWQsIGFsbEN1c3RvbUZpbGVJbmZvcy5tYXAoKGluZm8pID0+IGluZm8uZGF0YVVSTCA/IGluZm8gOiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGluZm8pLCB7IGNpbTogSlNPTi5zdHJpbmdpZnkoaW5mby5jaW0udG9KU09OKCkpIH0pKSwgdHJ1ZSk7XG4gICAgICAgIHRoaXMuYWxsQ3VzdG9tRmlsZUluZm9zID0gYWxsQ3VzdG9tRmlsZUluZm9zO1xuICAgICAgICB0aGlzLl9zZXR1cEN1c3RvbVN5bWJvbHMoKTtcbiAgICAgICAgYWN0aXZlU3ltYm9sSXRlbSA9IHRoaXMuX2FjdGl2ZVN5bWJvbEl0ZW1zW3RoaXMuX2FjdGl2ZVN5bWJvbEl0ZW1zLmxlbmd0aCAtIDFdO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGFjdGl2ZVN5bWJvbEl0ZW0gPSB0aGlzLl9hY3RpdmVTeW1ib2xJdGVtcy5maW5kKChzeW1ib2xJdGVtKSA9PiBzeW1ib2xJdGVtLmRhdGEubmFtZSA9PT0gZm91bmRGaWxlSW5mby5maWxlTmFtZSk7XG4gICAgICB9XG4gICAgICAvLyBzZWxlY3QgYWN0aXZlIHN5bWJvbFxuICAgICAgdGhpcy5hY3RpdmVTeW1ib2xJdGVtID0gYWN0aXZlU3ltYm9sSXRlbTtcbiAgICAgIHRoaXMuYXJjZ2lzQWN0aXZlU3ltYm9sSXRlbUNoYW5nZS5lbWl0KHRoaXMuYWN0aXZlU3ltYm9sSXRlbSk7XG4gICAgICB0aGlzLmFjdGl2ZVN5bWJvbEl0ZW1cbiAgICAgICAgLmdldFN5bWJvbCgpXG4gICAgICAgIC50aGVuKChzeW1ib2wpID0+IHRoaXMuYXJjZ2lzQWN0aXZlU3ltYm9sQ2hhbmdlLmVtaXQoc3ltYm9sKSk7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5pdGVtUGFsZXR0ZU5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgICAgICB0aGlzLnVwZGF0ZUxpc3RTZWxlY3Rpb24oKTtcbiAgICAgIH0pLCAxKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgIC8vIGUubmFtZSA9PT0gUXVvdGFFeGNlZWRlZEVycm9yXG4gICAgICB0aGlzLmN1c3RvbVN5bWJvbEVycm9yID0gXCJzdG9yYWdlLWZ1bGxcIjtcbiAgICB9XG4gIH1cbiAgaGFuZGxlSW52YWxpZEZpbGUoKSB7XG4gICAgdGhpcy5jdXN0b21TeW1ib2xFcnJvciA9IFwiaW52YWxpZC1maWxlXCI7XG4gIH1cbiAgaGFuZGxlRmlsZVVwbG9hZEVycm9yKCkge1xuICAgIHRoaXMuY3VzdG9tU3ltYm9sRXJyb3IgPSBcImVycm9yXCI7XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUHJpdmF0ZSBNZXRob2RzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgX3JlbmRlclN5bWJvbFNvdXJjZU9wdGlvbnMoc291cmNlcywgYWN0aXZlU291cmNlSWQpIHtcbiAgICBjb25zdCB7IG1lc3NhZ2VzOiBtZXJnZWRTdHJpbmdzIH0gPSB0aGlzO1xuICAgIGNvbnN0IGNsYXNzaWMgPSBzb3VyY2VzLmZpbHRlcigoc291cmNlKSA9PiBzb3VyY2UudHlwZSA9PT0gXCJzeW1ib2wtc2V0XCIpO1xuICAgIGNvbnN0IHdlYlN0eWxlcyA9IHNvdXJjZXMuZmlsdGVyKChzb3VyY2UpID0+IHNvdXJjZS50eXBlID09PSBcIndlYi1zdHlsZVwiKTtcbiAgICBjb25zdCBzaG93Q3VzdG9tU3ltYm9scyA9ICF0aGlzLnN5bWJvbEZpbHRlciB8fFxuICAgICAgISEoQXJyYXkuaXNBcnJheSh0aGlzLnN5bWJvbEZpbHRlcikgPyB0aGlzLnN5bWJvbEZpbHRlciA6IFt0aGlzLnN5bWJvbEZpbHRlcl0pLmZpbmQoKHR5cGUpID0+IHR5cGUgPT09IFwiY3VzdG9tXCIgfHwgdHlwZSA9PT0gXCJwaWN0dXJlXCIpO1xuICAgIGNvbnN0IGN1c3RvbUdyb3VwID0gdGhpcy5zeW1ib2xUeXBlICE9PSBcIjNkXCIgJiZcbiAgICAgIHRoaXMuZWRpdEdlb21ldHJ5ID09PSBcInBvaW50XCIgJiZcbiAgICAgIHNob3dDdXN0b21TeW1ib2xzICYmIChoKFwiY2FsY2l0ZS1kcm9wZG93bi1ncm91cFwiLCB7IGdyb3VwVGl0bGU6IG1lcmdlZFN0cmluZ3MuY3VzdG9tU3ltYm9scywgc2VsZWN0aW9uTW9kZTogXCJtdWx0aXBsZVwiLCBrZXk6IFwiY3VzdG9tXCIgfSwgaChcImNhbGNpdGUtZHJvcGRvd24taXRlbVwiLCB7IGtleTogXCJjdXN0b21cIiwgXCJkYXRhLXZhbHVlXCI6IFwiY3VzdG9tLXN5bWJvbC1zZXRcIiwgc2VsZWN0ZWQ6IFwiY3VzdG9tLXN5bWJvbC1zZXRcIiA9PT0gYWN0aXZlU291cmNlSWQgfSwgbWVyZ2VkU3RyaW5ncy5zeW1ib2xzKSkpO1xuICAgIGNvbnN0IGNsYXNzaWNHcm91cCA9IGNsYXNzaWMubGVuZ3RoID4gMCAmJiAoaChcImNhbGNpdGUtZHJvcGRvd24tZ3JvdXBcIiwgeyBncm91cFRpdGxlOiBtZXJnZWRTdHJpbmdzLmNsYXNzaWNTeW1ib2xzLCBzZWxlY3Rpb25Nb2RlOiBcIm11bHRpcGxlXCIsIGtleTogXCJjbGFzc2ljXCIgfSwgdGhpcy5fcmVuZGVyU291cmNlRHJvcGRvd25JdGVtKGNsYXNzaWMsIGFjdGl2ZVNvdXJjZUlkKSkpO1xuICAgIGNvbnN0IHdlYlN0eWxlR3JvdXAgPSB3ZWJTdHlsZXMubGVuZ3RoID4gMCAmJiAoaChcImNhbGNpdGUtZHJvcGRvd24tZ3JvdXBcIiwgeyBncm91cFRpdGxlOiBtZXJnZWRTdHJpbmdzLm5ld1N5bWJvbHMsIHNlbGVjdGlvbk1vZGU6IFwibXVsdGlwbGVcIiwga2V5OiBcIndlYnN0eWxlc1wiIH0sIHRoaXMuX3JlbmRlclNvdXJjZURyb3Bkb3duSXRlbSh3ZWJTdHlsZXMsIGFjdGl2ZVNvdXJjZUlkKSkpO1xuICAgIGlmIChjdXN0b21Hcm91cCkge1xuICAgICAgaWYgKGNsYXNzaWNHcm91cCkge1xuICAgICAgICBpZiAod2ViU3R5bGVHcm91cCkge1xuICAgICAgICAgIHJldHVybiBbY3VzdG9tR3JvdXAsIGNsYXNzaWNHcm91cCwgd2ViU3R5bGVHcm91cF07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIFtjdXN0b21Hcm91cCwgY2xhc3NpY0dyb3VwXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBbY3VzdG9tR3JvdXAsIHdlYlN0eWxlR3JvdXBdO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChjbGFzc2ljR3JvdXAgJiYgd2ViU3R5bGVHcm91cCkge1xuICAgICAgcmV0dXJuIFtjbGFzc2ljR3JvdXAsIHdlYlN0eWxlR3JvdXBdO1xuICAgIH1cbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWRyb3Bkb3duLWdyb3VwXCIsIHsga2V5OiBcIm9uZS1ncm91cFwiIH0sIHRoaXMuX3JlbmRlclNvdXJjZURyb3Bkb3duSXRlbShbLi4uY2xhc3NpYywgLi4ud2ViU3R5bGVzXSwgYWN0aXZlU291cmNlSWQpKSk7XG4gIH1cbiAgX3JlbmRlclNvdXJjZURyb3Bkb3duSXRlbShzb3VyY2VzLCBhY3RpdmVTb3VyY2VJZCkge1xuICAgIHJldHVybiBzb3VyY2VzLm1hcCgoc291cmNlKSA9PiAoaChcImNhbGNpdGUtZHJvcGRvd24taXRlbVwiLCB7IGtleTogc291cmNlLmlkLCBcImRhdGEtdmFsdWVcIjogc291cmNlLmlkLCBzZWxlY3RlZDogc291cmNlLmlkID09PSBhY3RpdmVTb3VyY2VJZCB9LCBzb3VyY2UudGl0bGUpKSk7XG4gIH1cbiAgX3NldHVwQ3VzdG9tU3ltYm9scygpIHtcbiAgICBjb25zdCBleGlzdGluZ1N5bWJvbEl0ZW1zID0gdGhpcy5hbGxDdXN0b21GaWxlSW5mb3MubWFwKChpbmZvKSA9PiB7XG4gICAgICBsZXQgd2lkdGggPSAyNDtcbiAgICAgIGxldCBoZWlnaHQgPSAyNDtcbiAgICAgIGlmIChpbmZvLndpZHRoID4gaW5mby5oZWlnaHQpIHtcbiAgICAgICAgaGVpZ2h0ID0gTWF0aC5yb3VuZCgod2lkdGggLyBpbmZvLndpZHRoKSAqIGluZm8uaGVpZ2h0KTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGluZm8ud2lkdGggPCBpbmZvLmhlaWdodCkge1xuICAgICAgICB3aWR0aCA9IE1hdGgucm91bmQoKGhlaWdodCAvIGluZm8uaGVpZ2h0KSAqIGluZm8ud2lkdGgpO1xuICAgICAgfVxuICAgICAgaWYgKGluZm8uZGF0YVVSTCkge1xuICAgICAgICBjb25zdCB0eXBlID0gaW5mby5maWxlTmFtZS5zcGxpdChcIi5cIilbMV0udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgY29uc3QgY29udGVudFR5cGUgPSB0eXBlID09PSBcInBuZ1wiID8gXCJpbWFnZS9wbmdcIiA6IHR5cGUgPT09IFwiZ2lmXCIgPyBcImltYWdlL2dpZlwiIDogXCJpbWFnZS9qcGVnXCI7XG4gICAgICAgIHJldHVybiBuZXcgU3ltYm9sSXRlbSh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgYW5nbGU6IDAsXG4gICAgICAgICAgICBjb250ZW50VHlwZSxcbiAgICAgICAgICAgIGhlaWdodCxcbiAgICAgICAgICAgIGltYWdlRGF0YTogaW5mby5kYXRhVVJMLnNwbGl0KFwiLFwiKVsxXSxcbiAgICAgICAgICAgIG5hbWU6IGluZm8uZmlsZU5hbWUsXG4gICAgICAgICAgICB0eXBlOiBcImVzcmlQTVNcIixcbiAgICAgICAgICAgIHVybDogaW5mby5maWxlTmFtZSxcbiAgICAgICAgICAgIHdpZHRoLFxuICAgICAgICAgICAgeG9mZnNldDogMCxcbiAgICAgICAgICAgIHlvZmZzZXQ6IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBhcmVudERhdGE6IG51bGwsXG4gICAgICAgICAgcG9ydGFsSXRlbTogbnVsbCxcbiAgICAgICAgICBzdHJhdGVneTogZmxhdFN5bWJvbFN0cmF0ZWd5LFxuICAgICAgICAgIHN0cmluZ3M6IHRoaXMubWVzc2FnZXNcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTeW1ib2xJdGVtKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBzeW1ib2w6IGluZm8uY2ltLFxuICAgICAgICAgICAgbmFtZTogaW5mby5maWxlTmFtZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcGFyZW50RGF0YTogeyBjaW1WZXJzaW9uOiBcIjIuNi4wXCIgfSxcbiAgICAgICAgICBwb3J0YWxJdGVtOiBudWxsLFxuICAgICAgICAgIHN0cmF0ZWd5OiB3ZWJTdHlsZUN1c3RvbVN5bWJvbFN0cmF0ZWd5KCksXG4gICAgICAgICAgc3RyaW5nczogdGhpcy5tZXNzYWdlc1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLnNldFVwU3ltYm9sSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKTtcbiAgICB0aGlzLmN1c3RvbVN5bWJvbEVycm9yID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuX2FjdGl2ZVN5bWJvbEZldGNoID0gbnVsbDtcbiAgICB0aGlzLl9hY3RpdmVTeW1ib2xJdGVtcyA9IGV4aXN0aW5nU3ltYm9sSXRlbXM7XG4gICAgLy9pZiAodGhpcy5fYWN0aXZlU291cmNlSWQgIT09IFwiY3VzdG9tLXN5bWJvbC1zZXRcIikge1xuICAgIHRoaXMuYXJjZ2lzQWN0aXZlU291cmNlSWRDaGFuZ2UuZW1pdChcImN1c3RvbS1zeW1ib2wtc2V0XCIpO1xuICAgIC8vfVxuICAgIHRoaXMuYXJjZ2lzQWN0aXZlU291cmNlSXRlbXNDaGFuZ2UuZW1pdChleGlzdGluZ1N5bWJvbEl0ZW1zLm1hcCgoaXRlbSkgPT4gbmV3IFN5bWJvbEl0ZW0oT2JqZWN0LmFzc2lnbih7fSwgaXRlbSkpKSk7XG4gIH1cbiAgYXN5bmMgX2ZldGNoQW5kU2V0VXBTeW1ib2xJdGVtcyhzb3VyY2UpIHtcbiAgICBpZiAodGhpcy5fYWN0aXZlU3ltYm9sRmV0Y2gpIHtcbiAgICAgIHRoaXMuX2FjdGl2ZVN5bWJvbEZldGNoLmNvbnRyb2xsZXIuYWJvcnQoKTtcbiAgICB9XG4gICAgY29uc3QgY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICBjb25zdCBzaWduYWwgPSBjb250cm9sbGVyLnNpZ25hbDtcbiAgICB0aGlzLl9hY3RpdmVTeW1ib2xGZXRjaCA9IHtcbiAgICAgIGNvbnRyb2xsZXIsXG4gICAgICBpZDogc291cmNlLmlkXG4gICAgfTtcbiAgICAvLyBXaGVuIGxvYWRpbmcgZm9yIHRoZSBmaXJzdCB0aW1lLCB3ZSBjaGVjayBpZiB0aGVyZSBhcmUgc29tZSBzeW1ib2xJdGVtcyBwYXNzZWRcbiAgICAvLyB0byB0aGUgcHJvcHMgYW5kIHdlIHRydXN0IGl0J3MgdGhlIGNvcnJlY3Qgb25lIGZvciB0aGUgY3VycmVudCBhY3RpdmVTeW1ib2xTb3VyY2VcbiAgICBjb25zdCBzeW1ib2xJdGVtcyA9ICghdGhpcy5fYWN0aXZlU3ltYm9sSXRlbXMgJiYgdGhpcy5hY3RpdmVTeW1ib2xJdGVtcykgfHwgKGF3YWl0IHNvdXJjZS5nZXRJdGVtcyhjb250cm9sbGVyKSk7XG4gICAgaWYgKHNpZ25hbCA9PT0gbnVsbCB8fCBzaWduYWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNpZ25hbC5hYm9ydGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGZpbHRlcmVkU3ltYm9sSXRlbXMgPSBhd2FpdCBmaWx0ZXJTeW1ib2xJdGVtcyhzb3VyY2UsIHN5bWJvbEl0ZW1zLCB0aGlzLnN5bWJvbEZpbHRlciwgdGhpcy5lZGl0R2VvbWV0cnksIHRoaXMuc3ltYm9sVHlwZSwgdGhpcy5jdXN0b21TeW1ib2xJdGVtRmlsdGVyKTtcbiAgICBpZiAoc2lnbmFsID09PSBudWxsIHx8IHNpZ25hbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2lnbmFsLmFib3J0ZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zZXRVcFN5bWJvbEludGVyc2VjdGlvbk9ic2VydmVyKCk7XG4gICAgdGhpcy5jdXN0b21TeW1ib2xFcnJvciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLl9hY3RpdmVTeW1ib2xGZXRjaCA9IG51bGw7XG4gICAgdGhpcy5fYWN0aXZlU3ltYm9sSXRlbXMgPSBmaWx0ZXJlZFN5bWJvbEl0ZW1zO1xuICAgIHRoaXMuYXJjZ2lzQWN0aXZlU291cmNlSWRDaGFuZ2UuZW1pdCh0aGlzLl9hY3RpdmVTb3VyY2VJZCk7XG4gICAgdGhpcy5hcmNnaXNBY3RpdmVTb3VyY2VJdGVtc0NoYW5nZS5lbWl0KGZpbHRlcmVkU3ltYm9sSXRlbXMubWFwKChpdGVtKSA9PiBuZXcgU3ltYm9sSXRlbShPYmplY3QuYXNzaWduKHt9LCBpdGVtKSkpKTtcbiAgfVxuICBvbkluY29tcGF0aWJsZVZlY3RvclN5bWJvbHNEaXNtaXNzKGV2ZW50KSB7XG4gICAgc2V0U2luZ2xlT2JqZWN0TG9jYWxTdG9yYWdlKGxvY2FsU3RvcmFnZUtleXMuQVJDR0lTX0NPTVBPTkVOVF9OT1RJRklDQVRJT05TLCB7XG4gICAgICBrZXk6IGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzLklOQ09NUEFUSUJMRV9WRUNUT1JfU1lNQk9MU19ESVNNSVNTRUQsXG4gICAgICB2YWx1ZTogXCJ0cnVlXCJcbiAgICB9KTtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfVxuICB0ZWFyRG93blN5bWJvbEludGVyc2VjdGlvbk9ic2VydmVyKCkge1xuICAgIHZhciBfYTtcbiAgICAoX2EgPSB0aGlzLl9zeW1ib2xJbnRlcnNlY3Rpb25PYnNlcnZlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRpc2Nvbm5lY3QoKTtcbiAgICB0aGlzLl9zeW1ib2xJbnRlcnNlY3Rpb25PYnNlcnZlciA9IG51bGw7XG4gIH1cbiAgc2V0VXBTeW1ib2xJbnRlcnNlY3Rpb25PYnNlcnZlcigpIHtcbiAgICB0aGlzLnRlYXJEb3duU3ltYm9sSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKTtcbiAgICBsZXQgbm93U2VydmluZ0luZGV4ID0gMDtcbiAgICBjb25zdCBwZW5kaW5nQXBwZW5kcyA9IHt9O1xuICAgIHRoaXMuX3N5bWJvbEludGVyc2VjdGlvbk9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKChlbnRyaWVzLCBvYnNlcnZlcikgPT4ge1xuICAgICAgZnVuY3Rpb24gbmV4dCgpIHtcbiAgICAgICAgbm93U2VydmluZ0luZGV4Kys7XG4gICAgICAgIGlmIChwZW5kaW5nQXBwZW5kc1tub3dTZXJ2aW5nSW5kZXhdKSB7XG4gICAgICAgICAgcGVuZGluZ0FwcGVuZHNbbm93U2VydmluZ0luZGV4XSgpO1xuICAgICAgICAgIGRlbGV0ZSBwZW5kaW5nQXBwZW5kc1tub3dTZXJ2aW5nSW5kZXhdO1xuICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZW50cmllcy5mb3JFYWNoKChlbnRyeSkgPT4ge1xuICAgICAgICBpZiAoIWVudHJ5LmlzSW50ZXJzZWN0aW5nKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5vZGUgPSBlbnRyeS50YXJnZXQ7XG4gICAgICAgIG5vZGUuaXRlbS5nZXRUaHVtYm5haWwobm9kZSkudGhlbigoYXBwZW5kVGh1bWJuYWlsKSA9PiB7XG4gICAgICAgICAgaWYgKG5vZGUuaW5kZXggPT09IG5vd1NlcnZpbmdJbmRleCkge1xuICAgICAgICAgICAgYXBwZW5kVGh1bWJuYWlsKCk7XG4gICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcGVuZGluZ0FwcGVuZHNbbm9kZS5pbmRleF0gPSBhcHBlbmRUaHVtYm5haWw7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgbm9kZS5pdGVtLmdldFN5bWJvbCgpO1xuICAgICAgICBvYnNlcnZlci51bm9ic2VydmUobm9kZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuICBhc3luYyBfZmV0Y2hTb3VyY2VzKCkge1xuICAgIGlmICh0aGlzLl9zb3VyY2VzRmV0Y2hDb250cm9sbGVyKSB7XG4gICAgICB0aGlzLl9zb3VyY2VzRmV0Y2hDb250cm9sbGVyLmFib3J0KCk7XG4gICAgfVxuICAgIHRoaXMuX3NvdXJjZXNGZXRjaENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG4gICAgY29uc3Qgc2lnbmFsID0gdGhpcy5fc291cmNlc0ZldGNoQ29udHJvbGxlci5zaWduYWw7XG4gICAgY29uc3QgcG9ydGFsID0gdGhpcy5wb3J0YWw7XG4gICAgY29uc3QgZWZmZWN0aXZlUG9ydGFsID0gaXNJbnRlcmNlcHRvcihwb3J0YWwpID8gcG9ydGFsLnBvcnRhbCA6IHBvcnRhbDtcbiAgICBjb25zdCBiZWZvcmVJbnRlcmNlcHRvciA9IGlzSW50ZXJjZXB0b3IocG9ydGFsKSA/IHBvcnRhbC5iZWZvcmUgOiBudWxsO1xuICAgIGNvbnN0IGFmdGVySW50ZXJjZXB0b3IgPSBpc0ludGVyY2VwdG9yKHBvcnRhbCkgPyBwb3J0YWwuYWZ0ZXIgOiBudWxsO1xuICAgIGNvbnN0IHN5bWJvbFNvdXJjZXMgPSBlZmZlY3RpdmVQb3J0YWxcbiAgICAgID8gdGhpcy5zeW1ib2xTb3VyY2VzIHx8XG4gICAgICAgIChhd2FpdCBmZXRjaFNvdXJjZXMoZWZmZWN0aXZlUG9ydGFsLCBiZWZvcmVJbnRlcmNlcHRvciwgYWZ0ZXJJbnRlcmNlcHRvciwgdGhpcy5tZXNzYWdlcywgdGhpcy5zeW1ib2xUeXBlKSlcbiAgICAgIDogW107XG4gICAgaWYgKHNpZ25hbCA9PT0gbnVsbCB8fCBzaWduYWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNpZ25hbC5hYm9ydGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuX3N5bWJvbFNvdXJjZXMgPSBhd2FpdCBmaWx0ZXJTb3VyY2VzKHN5bWJvbFNvdXJjZXMsIHRoaXMuc3ltYm9sRmlsdGVyLCBnZW9tZXRyeVR5cGUodGhpcy5zeW1ib2wpLCB0aGlzLnN5bWJvbFR5cGUsIHRoaXMuY3VzdG9tU3ltYm9sU291cmNlRmlsdGVyKTtcbiAgICB0aGlzLmFyY2dpc1N5bWJvbFNvdXJjZXNDaGFuZ2UuZW1pdCh0aGlzLl9zeW1ib2xTb3VyY2VzKTtcbiAgICBpZiAoIXRoaXMuX2FjdGl2ZVNvdXJjZUlkKSB7XG4gICAgICBsZXQgYWN0aXZlU291cmNlSWQgPSB0aGlzLmFjdGl2ZVNvdXJjZUlkO1xuICAgICAgaWYgKGFjdGl2ZVNvdXJjZUlkKSB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVNvdXJjZSA9IHRoaXMuX3N5bWJvbFNvdXJjZXMuZmluZCgoc291cmNlKSA9PiBzb3VyY2UuaWQgPT09IHRoaXMuYWN0aXZlU291cmNlSWQpO1xuICAgICAgICBpZiAoIWFjdGl2ZVNvdXJjZSkge1xuICAgICAgICAgIC8vIG1heWJlIGRpZmZlcmVudCBzeW1ib2wgZ2VvbWV0cnkgdHlwZSBub3c7IGNhbid0IHJlLXVzZSBsYXN0IHNvdXJjZVxuICAgICAgICAgIGFjdGl2ZVNvdXJjZUlkID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLl9hY3RpdmVTb3VyY2VJZCA9IGFjdGl2ZVNvdXJjZUlkIHx8IHRoaXMuX3N5bWJvbFNvdXJjZXNbMF0uaWQ7XG4gICAgfVxuICB9XG4gIF9nZXRDdXN0b21TeW1ib2xzRnJvbVN0b3JhZ2UoKSB7XG4gICAgaWYgKHRoaXMuc3ltYm9sVHlwZSA9PT0gXCIzZFwiIHx8IHRoaXMuZWRpdEdlb21ldHJ5ICE9PSBcInBvaW50XCIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgZmlsZUluZm9zID0gZ2V0TG9jYWxTdG9yYWdlSXRlbSh0aGlzLmN1c3RvbVN5bWJvbHNTdG9yYWdlSWQsIHRydWUpO1xuICAgIGlmIChmaWxlSW5mb3MpIHtcbiAgICAgIHRoaXMuYWxsQ3VzdG9tRmlsZUluZm9zID0gZmlsZUluZm9zLm1hcCgoaW5mbykgPT4gaW5mby5kYXRhVVJMID8gaW5mbyA6IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgaW5mbyksIHsgY2ltOiBlc3JpTW9kdWxlcy5DSU1TeW1ib2wuZnJvbUpTT04oSlNPTi5wYXJzZShpbmZvLmNpbSkpIH0pKTtcbiAgICB9XG4gIH1cbiAgX3JlbmRlclNvdXJjZVNlbGVjdGlvbigpIHtcbiAgICBjb25zdCB7IG1lc3NhZ2VzOiBtZXJnZWRTdHJpbmdzIH0gPSB0aGlzO1xuICAgIGNvbnN0IHNvdXJjZXMgPSB0aGlzLl9zeW1ib2xTb3VyY2VzO1xuICAgIGlmICghc291cmNlcykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBhY3RpdmVTb3VyY2UgPSB0aGlzLl9zeW1ib2xTb3VyY2VzLmZpbmQoKHNvdXJjZSkgPT4gc291cmNlLmlkID09PSB0aGlzLl9hY3RpdmVTb3VyY2VJZCk7XG4gICAgY29uc3QgYWN0aXZlU291cmNlVGl0bGUgPSB0aGlzLl9hY3RpdmVTb3VyY2VJZCA9PT0gXCJjdXN0b20tc3ltYm9sLXNldFwiXG4gICAgICA/IG1lcmdlZFN0cmluZ3MuY3VzdG9tU3ltYm9sc1xuICAgICAgOiBhY3RpdmVTb3VyY2UgPT09IG51bGwgfHwgYWN0aXZlU291cmNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhY3RpdmVTb3VyY2UudGl0bGU7XG4gICAgY29uc3QgaGFzU2luZ2xlU291cmNlID0gc291cmNlcy5sZW5ndGggPT09IDE7XG4gICAgY29uc3QgZHJvcGRvd24gPSAoaChcImNhbGNpdGUtZHJvcGRvd25cIiwgeyBjbGFzczoge1xuICAgICAgICBbQ1NTLm1hcmtlclNlbGVjdGlvbkRyb3Bkb3duXTogdHJ1ZVxuICAgICAgfSwgaGlkZGVuOiBoYXNTaW5nbGVTb3VyY2UsIG1heEl0ZW1zOiA3LCBvbkNhbGNpdGVEcm9wZG93blNlbGVjdDogdGhpcy5fb25TeW1ib2xTb3VyY2VDaGFuZ2UsIG92ZXJsYXlQb3NpdGlvbmluZzogXCJhYnNvbHV0ZVwiIH0sIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGFsaWdubWVudDogXCJzcGFjZS1iZXR3ZWVuXCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBpY29uRW5kOiBcImNoZXZyb24tZG93blwiLCBzY2FsZTogXCJtXCIsIHNsb3Q6IFwidHJpZ2dlclwiLCB3aWR0aDogXCJmdWxsXCIgfSwgYWN0aXZlU291cmNlVGl0bGUpLCB0aGlzLl9yZW5kZXJTeW1ib2xTb3VyY2VPcHRpb25zKHNvdXJjZXMsIHRoaXMuX2FjdGl2ZVNvdXJjZUlkKSkpO1xuICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNlY3Rpb25cIiwga2V5OiBcImhlYWRlclwiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgY2xhc3M6IFwic2VjdGlvblwiIH0sICF0aGlzLmhpZGVIZWFkZXIgPyB0aGlzLm1lc3NhZ2VzLmNhdGVnb3J5IDogbnVsbCwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MuY2F0ZWdvcmllcyB9LCBkcm9wZG93biwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgYWN0aXZlOiB0aGlzLmlzR3JpZFZpZXcsIGFwcGVhcmFuY2U6IFwidHJhbnNwYXJlbnRcIiwgaWNvbjogXCJncmlkXCIsIHNjYWxlOiBcInNcIiwgY2xhc3M6IENTUy5jYXRlZ29yaWVzQ2VudGVyQWN0aW9uLCB0ZXh0OiB0aGlzLm1lc3NhZ2VzLmdyaWRWaWV3LCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuaXNHcmlkVmlldyA9IHRydWU7XG4gICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuZWwpO1xuICAgICAgfSB9KSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgYWN0aXZlOiAhdGhpcy5pc0dyaWRWaWV3LCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIGljb246IFwibGlzdFwiLCBpY29uRmxpcFJ0bDogdHJ1ZSwgc2NhbGU6IFwic1wiLCB0ZXh0OiB0aGlzLm1lc3NhZ2VzLmxpc3RWaWV3LCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuaXNHcmlkVmlldyA9IGZhbHNlO1xuICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmVsKTtcbiAgICAgIH0gfSkpKSkpO1xuICB9XG4gIF9yZW5kZXJJdGVtU2VsZWN0aW9uKCkge1xuICAgIGNvbnN0IHsgcG9ydGFsLCBtZXNzYWdlczogbWVyZ2VkU3RyaW5ncyB9ID0gdGhpcztcbiAgICBjb25zdCBmZXRjaGluZ1N5bWJvbEl0ZW1zID0gdGhpcy5fYWN0aXZlU3ltYm9sRmV0Y2g7XG4gICAgY29uc3QgZWZmZWN0aXZlUG9ydGFsID0gaXNJbnRlcmNlcHRvcihwb3J0YWwpID8gcG9ydGFsLnBvcnRhbCA6IHBvcnRhbDtcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczoge1xuICAgICAgICBbQ1NTLnNjcm9sbGVyXTogdHJ1ZSxcbiAgICAgICAgW0NTUy5tYXJrZXJTZWxlY3Rpb25dOiB0cnVlXG4gICAgICB9LCBrZXk6IFwiZ2FsbGVyeVwiIH0sIGZldGNoaW5nU3ltYm9sSXRlbXMgPyAoaChcImNhbGNpdGUtbG9hZGVyXCIsIHsgbGFiZWw6IFwiXCIgfSkpIDogdGhpcy5fYWN0aXZlU3ltYm9sSXRlbXMubGVuZ3RoID09PSAwICYmIHRoaXMuX2FjdGl2ZVNvdXJjZUlkID09PSBcImN1c3RvbS1zeW1ib2wtc2V0XCIgPyAoaChcImFyY2dpcy1zeW1ib2wtcGlja2VyLWZpbGUtdXBsb2FkXCIsIHsgcG9ydGFsOiBlZmZlY3RpdmVQb3J0YWwsIHN0cmluZ3M6IG1lcmdlZFN0cmluZ3MgfSkpIDogdGhpcy5fYWN0aXZlU3ltYm9sSXRlbXMubGVuZ3RoID4gMCA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5pdGVtUGFsZXR0ZSwga2V5OiB0aGlzLl9hY3RpdmVTeW1ib2xJdGVtcy5sZW5ndGggfSwgdGhpcy5pc0dyaWRWaWV3ID8gdGhpcy5fcmVuZGVyR3JpZFZpZXcoKSA6IHRoaXMuX3JlbmRlckxpc3RWaWV3KCksIHRoaXMuX2FjdGl2ZVNvdXJjZUlkID09PSBcImN1c3RvbS1zeW1ib2wtc2V0XCIgJiYgKGgoXCJhcmNnaXMtc3ltYm9sLXBpY2tlci1maWxlLXVwbG9hZFwiLCB7IGNsYXNzOiBDU1MuZmlsZVVwbG9hZCwgcG9ydGFsOiBlZmZlY3RpdmVQb3J0YWwsIHN0cmluZ3M6IG1lcmdlZFN0cmluZ3MgfSkpKSkgOiAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1MuZW1wdHlDYXRlZ29yeUNvbnRlbnQgfSwgdGhpcy5tZXNzYWdlcy5ub1N5bWJvbHNBdmFpbGFibGUpKSkpO1xuICB9XG4gIF9yZW5kZXJHcmlkVmlldygpIHtcbiAgICByZXR1cm4gKGgoXCJhcmNnaXMtaXRlbS1wYWxldHRlXCIsIHsga2V5OiB0aGlzLl9hY3RpdmVTb3VyY2VJZCwgaXRlbXM6IHRoaXMuX2FjdGl2ZVN5bWJvbEl0ZW1zLm1hcCgoaXRlbSwgaW5kZXgpID0+ICh7XG4gICAgICAgIGl0ZW0sXG4gICAgICAgIGluZGV4LFxuICAgICAgICBvYnNlcnZlcjogdGhpcy5fc3ltYm9sSW50ZXJzZWN0aW9uT2JzZXJ2ZXJcbiAgICAgIH0pKSwgSXRlbVJlbmRlcmVyOiBNYXJrZXJJdGVtLCBpdGVtc1BlclJvdzogdGhpcy5pdGVtc1BlclJvdywgc2VsZWN0ZWQ6ICh7IGl0ZW0gfSkgPT4geyB2YXIgX2E7IHJldHVybiAoaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLmRhdGEpID09PSAoKF9hID0gdGhpcy5hY3RpdmVTeW1ib2xJdGVtKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZGF0YSk7IH0sIG9uQXJjZ2lzSXRlbVNlbGVjdDogKGV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgZGV0YWlsOiB7IGl0ZW0gfSB9ID0gZXZlbnQ7XG4gICAgICAgIHRoaXMuY3VzdG9tU3ltYm9sRXJyb3IgPSB1bmRlZmluZWQ7XG4gICAgICAgIC8vIFRoaXMgaXMganVzdCBmb3IgdGhlIFVJIHRvIHJlbWVtYmVyIHdoaWNoIGVsZW1lbnQgaXMgc2VsZWN0ZWRcbiAgICAgICAgdGhpcy5hcmNnaXNBY3RpdmVTeW1ib2xJdGVtQ2hhbmdlLmVtaXQoaXRlbSk7XG4gICAgICAgIHRoaXMuYWN0aXZlU3ltYm9sSXRlbSA9IGl0ZW07XG4gICAgICAgIC8vIFNlbmQgYmFjayB0aGUgYWN0dWFsIHN5bWJvbDpcbiAgICAgICAgaXRlbVxuICAgICAgICAgIC5nZXRTeW1ib2woKVxuICAgICAgICAgIC50aGVuKChzeW1ib2wpID0+IHRoaXMuYXJjZ2lzQWN0aXZlU3ltYm9sQ2hhbmdlLmVtaXQoc3ltYm9sKSk7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgfSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuaXRlbVBhbGV0dGVOb2RlID0gbm9kZSkgfSkpO1xuICB9XG4gIF9yZW5kZXJMaXN0VmlldygpIHtcbiAgICBjb25zdCBpc1J0bCA9IGdldEVsZW1lbnREaXIodGhpcy5lbCkgPT09IFwicnRsXCI7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1saXN0XCIsIHsga2V5OiB0aGlzLl9hY3RpdmVTb3VyY2VJZCB9LCB0aGlzLl9hY3RpdmVTeW1ib2xJdGVtcy5tYXAoKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICB2YXIgX2E7XG4gICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxpc3QtaXRlbVwiLCB7IGtleTogaW5kZXgsIGxhYmVsOiBpdGVtLmRhdGEudGl0bGUgfHwgaXRlbS5kYXRhLm5hbWUsIHZhbHVlOiBpbmRleCwgc2VsZWN0ZWQ6ICgoX2EgPSB0aGlzLmFjdGl2ZVN5bWJvbEl0ZW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kYXRhLm5hbWUpID09PSBpdGVtLmRhdGEubmFtZSwgb25DYWxjaXRlTGlzdEl0ZW1TZWxlY3Q6IChldmVudCkgPT4ge1xuICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgY29uc3Qgc2VsZWN0ZWRJdGVtID0gdGhpcy5fYWN0aXZlU3ltYm9sSXRlbXNbbm9kZS52YWx1ZV07XG4gICAgICAgICAgdGhpcy5jdXN0b21TeW1ib2xFcnJvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAvLyBUaGlzIGlzIGp1c3QgZm9yIHRoZSBVSSB0byByZW1lbWJlciB3aGljaCBlbGVtZW50IGlzIHNlbGVjdGVkXG4gICAgICAgICAgdGhpcy5hcmNnaXNBY3RpdmVTeW1ib2xJdGVtQ2hhbmdlLmVtaXQoc2VsZWN0ZWRJdGVtKTtcbiAgICAgICAgICB0aGlzLmFjdGl2ZVN5bWJvbEl0ZW0gPSBzZWxlY3RlZEl0ZW07XG4gICAgICAgICAgLy8gU2VuZCBiYWNrIHRoZSBhY3R1YWwgc3ltYm9sOlxuICAgICAgICAgIHNlbGVjdGVkSXRlbVxuICAgICAgICAgICAgLmdldFN5bWJvbCgpXG4gICAgICAgICAgICAudGhlbigoc3ltYm9sKSA9PiB0aGlzLmFyY2dpc0FjdGl2ZVN5bWJvbENoYW5nZS5lbWl0KHN5bWJvbCkpO1xuICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9IH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcImFjdGlvbnMtc3RhcnRcIiwga2V5OiBpdGVtLmRhdGEubmFtZSwgcmVmOiAoZGl2Tm9kZSkgPT4ge1xuICAgICAgICAgIGlmIChkaXZOb2RlKSB7XG4gICAgICAgICAgICBpdGVtLmdldFRodW1ibmFpbChkaXZOb2RlKS50aGVuKChhcHBlbmRUaHVtYm5haWwpID0+IGFwcGVuZFRodW1ibmFpbCgpKTtcbiAgICAgICAgICAgIGl0ZW0uZ2V0U3ltYm9sKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IH0pLCB0aGlzLl9hY3RpdmVTb3VyY2VJZCA9PT0gXCJjdXN0b20tc3ltYm9sLXNldFwiICYmIChoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBzbG90OiBcImFjdGlvbnMtZW5kXCIsIGFwcGVhcmFuY2U6IFwidHJhbnNwYXJlbnRcIiwgdGV4dDogdGhpcy5tZXNzYWdlcy5yZW1vdmVTeW1ib2wsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgdGhpcy5hY3Rpb25FbHNbaW5kZXhdID0gbm9kZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICB0aGlzLnJlbW92ZUN1c3RvbVN5bWJvbChpbmRleCk7XG4gICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5lbCk7XG4gICAgICAgIH0sIG9uTW91c2VPdmVyOiAoKSA9PiB0aGlzLmFkZFRvb2x0aXAoe1xuICAgICAgICAgIHJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMuYWN0aW9uRWxzW2luZGV4XSxcbiAgICAgICAgICBwbGFjZW1lbnQ6IGlzUnRsID8gXCJyaWdodC1zdGFydFwiIDogXCJsZWZ0LXN0YXJ0XCIsXG4gICAgICAgICAgaW5uZXJIVE1MOiB0aGlzLm1lc3NhZ2VzLnJlbW92ZVN5bWJvbFxuICAgICAgICB9KSwgb25Nb3VzZU91dDogKCkgPT4gdGhpcy5yZW1vdmVUb29sdGlwKCkgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgaWNvbjogXCJ4XCIgfSkpKSkpO1xuICAgIH0pKSk7XG4gIH1cbiAgdXBkYXRlTGlzdFNlbGVjdGlvbigpIHtcbiAgICBjb25zb2xlLmxvZyhcInVwZGF0ZUxpc3RTZWxlY3Rpb25cIik7XG4gICAgdGhpcy5lbFxuICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCJDQUxDSVRFLUxJU1QtSVRFTVwiKVxuICAgICAgLmZvckVhY2goKGxpc3RJdGVtKSA9PiB7XG4gICAgICBsaXN0SXRlbS5zZWxlY3RlZCA9IGxpc3RJdGVtLnZhbHVlID09PSB0aGlzLmFjdGl2ZVN5bWJvbEl0ZW0uZGF0YS5uYW1lO1xuICAgICAgaWYgKGxpc3RJdGVtLnNlbGVjdGVkKSB7XG4gICAgICAgIGxpc3RJdGVtLnNldEZvY3VzKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgcmVtb3ZlQ3VzdG9tU3ltYm9sKGluZGV4KSB7XG4gICAgdGhpcy5hbGxDdXN0b21GaWxlSW5mb3Muc3BsaWNlKGluZGV4LCAxKTtcbiAgICBzZXRMb2NhbFN0b3JhZ2VJdGVtKHRoaXMuY3VzdG9tU3ltYm9sc1N0b3JhZ2VJZCwgdGhpcy5hbGxDdXN0b21GaWxlSW5mb3MubWFwKChpbmZvKSA9PiBpbmZvLmRhdGFVUkwgPyBpbmZvIDogT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBpbmZvKSwgeyBjaW06IEpTT04uc3RyaW5naWZ5KGluZm8uY2ltLnRvSlNPTigpKSB9KSksIHRydWUpO1xuICAgIHRoaXMuX3NldHVwQ3VzdG9tU3ltYm9scygpO1xuICAgIHRoaXMuYWN0aXZlU3ltYm9sSXRlbSA9IHVuZGVmaW5lZDtcbiAgfVxuICBhZGRUb29sdGlwKHByb3BzKSB7XG4gICAgdGhpcy5yZW1vdmVUb29sdGlwKCk7XG4gICAgdGhpcy50b29sdGlwRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FsY2l0ZS10b29sdGlwXCIpO1xuICAgIHRoaXMudG9vbHRpcEVsLnBsYWNlbWVudCA9IHByb3BzLnBsYWNlbWVudCB8fCBcImF1dG9cIjtcbiAgICB0aGlzLnRvb2x0aXBFbC5yZWZlcmVuY2VFbGVtZW50ID0gcHJvcHMucmVmZXJlbmNlRWxlbWVudDtcbiAgICB0aGlzLnRvb2x0aXBFbC5vdmVybGF5UG9zaXRpb25pbmcgPSBcImZpeGVkXCI7XG4gICAgdGhpcy50b29sdGlwRWwuaW5uZXJIVE1MID0gcHJvcHMuaW5uZXJIVE1MO1xuICAgIHRoaXMudG9vbHRpcEVsLm9wZW4gPSB0cnVlO1xuICAgIC8vIGl0IHdvbid0IHNob3cgaWYganVzdCBhZGRlZCB0byB0aGlzLmVsXG4gICAgdGhpcy5lbC5wYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMudG9vbHRpcEVsKTtcbiAgfVxuICByZW1vdmVUb29sdGlwKCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAoKF9hID0gdGhpcy50b29sdGlwRWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5wYXJlbnROb2RlKSB7XG4gICAgICB0aGlzLnRvb2x0aXBFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMudG9vbHRpcEVsKTtcbiAgICAgIHRoaXMudG9vbHRpcEVsID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBMaWZlY3ljbGVcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICBjb25zdCBbLCBbc3RyaW5nc11dID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgZXNyaU1vZHVsZXMubG9hZCgpLFxuICAgICAgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyh0aGlzLmVsKVxuICAgIF0pO1xuICAgIHRoaXMubWVzc2FnZXMgPSBzdHJpbmdzO1xuICB9XG4gIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgaWYgKCF0aGlzLl9zeW1ib2xTb3VyY2VzKSB7XG4gICAgICB0aGlzLl9mZXRjaFNvdXJjZXMoKTtcbiAgICB9XG4gICAgdGhpcy5fZ2V0Q3VzdG9tU3ltYm9sc0Zyb21TdG9yYWdlKCk7XG4gIH1cbiAgY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICB0aGlzLnNldFVwU3ltYm9sSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKTtcbiAgICAoX2EgPSB0aGlzLl9hY3RpdmVTeW1ib2xGZXRjaCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNvbnRyb2xsZXIuYWJvcnQoKTtcbiAgICAoX2IgPSB0aGlzLl9zb3VyY2VzRmV0Y2hDb250cm9sbGVyKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuYWJvcnQoKTtcbiAgfVxuICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICB0aGlzLnRlYXJEb3duU3ltYm9sSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qgc291cmNlcyA9IHRoaXMuX3N5bWJvbFNvdXJjZXM7XG4gICAgY29uc3QgZmV0Y2hpbmdTeW1ib2xJdGVtcyA9IHRoaXMuX2FjdGl2ZVN5bWJvbEZldGNoO1xuICAgIGlmICghc291cmNlcyB8fCBmZXRjaGluZ1N5bWJvbEl0ZW1zKSB7XG4gICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLmNvbnRhaW5lciB9LCBoKFwiY2FsY2l0ZS1sb2FkZXJcIiwgeyBsYWJlbDogXCJcIiB9KSkpO1xuICAgIH1cbiAgICBjb25zdCBhY3RpdmVTb3VyY2VJc1NNUyA9IHRoaXMuX2FjdGl2ZVNvdXJjZUlkID09PSBcImJhc2ljLXN5bWJvbC1zZXRcIiB8fCB0aGlzLl9hY3RpdmVTb3VyY2VJZCA9PT0gXCJjdXN0b20tc3ltYm9sLXNldFwiO1xuICAgIGNvbnN0IGFjdGl2ZVNvdXJjZSA9IHRoaXMuX3N5bWJvbFNvdXJjZXMuZmluZCgoc291cmNlKSA9PiBzb3VyY2UuaWQgPT09IHRoaXMuX2FjdGl2ZVNvdXJjZUlkKTtcbiAgICBjb25zdCBtb2Rlcm5TeW1ib2xDYXRlZ29yeVNlbGVjdGVkID0gIWFjdGl2ZVNvdXJjZUlzU01TICYmIChhY3RpdmVTb3VyY2UgPT09IG51bGwgfHwgYWN0aXZlU291cmNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhY3RpdmVTb3VyY2UudHlwZSkgIT09IFwic3ltYm9sLXNldFwiO1xuICAgIGNvbnN0IGFkb2JlU3ltYm9sQ2F0ZWdvcnlTZWxlY3RlZCA9IGFjdGl2ZVNvdXJjZSA9PT0gbnVsbCB8fCBhY3RpdmVTb3VyY2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFjdGl2ZVNvdXJjZS5rZXl3b3Jkcy5pbmNsdWRlcyhcIkFkb2JlXCIpO1xuICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1MuY29udGFpbmVyIH0sIHRoaXMuX3JlbmRlclNvdXJjZVNlbGVjdGlvbigpLCB0aGlzLl9yZW5kZXJJdGVtU2VsZWN0aW9uKCksIGFkb2JlU3ltYm9sQ2F0ZWdvcnlTZWxlY3RlZCA/IChoKFwiY2FsY2l0ZS1ub3RpY2VcIiwgeyBvcGVuOiB0cnVlLCBraW5kOiBcImRhbmdlclwiLCBrZXk6IFwiY29weXJpZ2h0XCIsIHNjYWxlOiBcInNcIiB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJtZXNzYWdlXCIsIGlubmVySFRNTDogdGhpcy5tZXNzYWdlcy5hZG9iZUNvcHlyaWdodC5yZXBsYWNlKFwiJHt5ZWFyfVwiLCBcIjIwMjJcIikgfSkpKSA6IG51bGwsIG1vZGVyblN5bWJvbENhdGVnb3J5U2VsZWN0ZWQgJiZcbiAgICAgIHRoaXMuc3ltYm9sVHlwZSAhPT0gXCIzZFwiICYmXG4gICAgICAhZ2V0U2luZ2xlT2JqZWN0TG9jYWxTdG9yYWdlKGxvY2FsU3RvcmFnZUtleXMuQVJDR0lTX0NPTVBPTkVOVF9OT1RJRklDQVRJT05TLCBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5cy5JTkNPTVBBVElCTEVfVkVDVE9SX1NZTUJPTFNfRElTTUlTU0VEKSA/IChoKFwiY2FsY2l0ZS1ub3RpY2VcIiwgeyBvcGVuOiB0cnVlLCBjbGFzczogQ1NTLmluY29tcGF0aWJsZVN5bWJvbHNOb3RpY2UsIGNsb3NhYmxlOiB0cnVlLCBpY29uOiB0cnVlLCBrZXk6IFwiaW5jb21wYXRpYmxlLXN5bWJvbHNcIiwgb25DYWxjaXRlTm90aWNlQ2xvc2U6IHRoaXMub25JbmNvbXBhdGlibGVWZWN0b3JTeW1ib2xzRGlzbWlzcywgc2NhbGU6IFwic1wiIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcIm1lc3NhZ2VcIiB9LCB0aGlzLm1lc3NhZ2VzLmluY29tcGF0aWJsZVN5bWJvbFdhcm5pbmcpKSkgOiBudWxsLCB0aGlzLmN1c3RvbVN5bWJvbEVycm9yID8gKGgoXCJjYWxjaXRlLW5vdGljZVwiLCB7IG9wZW46IHRydWUsIGNsYXNzOiBDU1MuaW5jb21wYXRpYmxlU3ltYm9sc05vdGljZSwgY2xvc2FibGU6IHRydWUsIGljb246IFwiZXhjbGFtYXRpb24tbWFyay1jaXJjbGVcIiwga2luZDogXCJkYW5nZXJcIiwga2V5OiBcImxhcmdlLXN5bWJvbFwiLCBvbkNhbGNpdGVOb3RpY2VDbG9zZTogKCkgPT4gKHRoaXMuY3VzdG9tU3ltYm9sRXJyb3IgPSB1bmRlZmluZWQpLCBzY2FsZTogXCJzXCIgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwibWVzc2FnZVwiIH0sIHRoaXMuY3VzdG9tU3ltYm9sRXJyb3IgPT09IFwidG9vLWxhcmdlXCJcbiAgICAgID8gdGhpcy5tZXNzYWdlcy5jdXN0b21TeW1ib2xFcnJvcnMudG9vTGFyZ2VcbiAgICAgIDogdGhpcy5jdXN0b21TeW1ib2xFcnJvciA9PT0gXCJpbnZhbGlkLWZpbGVcIlxuICAgICAgICA/IHRoaXMubWVzc2FnZXMuY3VzdG9tU3ltYm9sRXJyb3JzLmludmFsaWRGaWxlXG4gICAgICAgIDogdGhpcy5jdXN0b21TeW1ib2xFcnJvciA9PT0gXCJzdG9yYWdlLWZ1bGxcIlxuICAgICAgICAgID8gdGhpcy5tZXNzYWdlcy5jdXN0b21TeW1ib2xFcnJvcnMub3V0T2ZTcGFjZVxuICAgICAgICAgIDogdGhpcy5jdXN0b21TeW1ib2xFcnJvciA9PT0gXCJlcnJvclwiXG4gICAgICAgICAgICA/IHRoaXMubWVzc2FnZXMuY3VzdG9tU3ltYm9sRXJyb3JzLmVycm9yXG4gICAgICAgICAgICA6IHVuZGVmaW5lZCkpKSA6IG51bGwpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgXCJfYWN0aXZlU291cmNlSWRcIjogW1wiaGFuZGxlQWN0aXZlU291cmNlSXRlbUlkQ2hhbmdlc1wiXVxuICB9OyB9XG59O1xuQXJjZ2lzU3ltYm9sUGlja2VyLnN0eWxlID0gYXJjZ2lzU3ltYm9sUGlja2VyQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNTeW1ib2xQaWNrZXIgYXMgYXJjZ2lzX3N5bWJvbF9waWNrZXIgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xudmFyIGxvY2FsU3RvcmFnZUtleXM7XG4oZnVuY3Rpb24gKGxvY2FsU3RvcmFnZUtleXMpIHtcbiAgbG9jYWxTdG9yYWdlS2V5c1tcIkFSQ0dJU19DT01QT05FTlRfTk9USUZJQ0FUSU9OU1wiXSA9IFwiYXJjZ2lzQ29tcG9uZW50X25vdGlmaWNhdGlvbnNcIjtcbn0pKGxvY2FsU3RvcmFnZUtleXMgfHwgKGxvY2FsU3RvcmFnZUtleXMgPSB7fSkpO1xudmFyIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzO1xuKGZ1bmN0aW9uIChhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5cykge1xuICBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5c1tcIkZFQVRVUkVfUkVEVUNUSU9OX1dBUk5JTkdfRElTTUlTU0VEXCJdID0gXCJhcmNnaXNfZmVhdHVyZV9yZWR1Y3Rpb25fd2FybmluZ19kaXNtaXNzZWRcIjtcbiAgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXNbXCJQT1BVUF9XQVJOSU5HX0RJU01JU1NFRFwiXSA9IFwiYXJjZ2lzX3BvcHVwX3dhcm5pbmdfZGlzbWlzc2VkXCI7XG4gIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzW1wiSU5DT01QQVRJQkxFX1ZFQ1RPUl9TWU1CT0xTX0RJU01JU1NFRFwiXSA9IFwiYXJjZ2lzX3N5bWJvbF9zdHlsZXJfaW5jb21wYXRpYmxlX3ZlY3Rvcl9zeW1ib2xzX2Rpc21pc3NlZFwiO1xuICBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5c1tcIkVGRkVDVFNfVElQX0RJU01JU1NFRFwiXSA9IFwiYXJjZ2lzX2VmZmVjdHNfdGlwX2Rpc21pc3NlZFwiO1xuICBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5c1tcIkxBWUVSX1ZJRVdfREVGSU5JVElPTl9ESVNNSVNTRURcIl0gPSBcImFyY2dpc19sYXllcl92aWV3X2RlZmluaXRpb25fZGlzbWlzc2VkXCI7XG4gIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzW1wiTEFZRVJfT1ZFUlJJREVfU1RBVFVTX1RJUF9ESVNNSVNTRURcIl0gPSBcImFyY2dpc19sYXllcl9vdmVycmlkZV9zdGF0dXNfdGlwX2Rpc21pc3NlZFwiO1xuICBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5c1tcIkxBWUVSX1ZJRVdfSk9JTl9USVBfRElTTUlTU0VEXCJdID0gXCJhcmNnaXNfbGF5ZXJfdmlld19qb2luX3RpcF9kaXNtaXNzZWRcIjtcbiAgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXNbXCJNVUxUSURJTUVOU0lPTkFMX0lORk9fVElQX0RJU01JU1NFRFwiXSA9IFwiYXJjZ2lzX211bHRpZGltZW5zaW9uYWxfaW5mb190aXBfZGlzbWlzc2VkXCI7XG59KShhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5cyB8fCAoYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXMgPSB7fSkpO1xuY29uc3QgZ2V0TG9jYWxTdG9yYWdlID0gKGxvY2FsU3RvcmFnZUtleSkgPT4ge1xuICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0obG9jYWxTdG9yYWdlS2V5KTtcbn07XG5jb25zdCBzZXRMb2NhbFN0b3JhZ2UgPSAobG9jYWxTdG9yYWdlS2V5LCB2YWx1ZSkgPT4ge1xuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShsb2NhbFN0b3JhZ2VLZXksIHZhbHVlKTtcbn07XG5jb25zdCBnZXRPYmplY3RMb2NhbFN0b3JhZ2UgPSAobG9jYWxTdG9yYWdlS2V5KSA9PiB7XG4gIHJldHVybiBKU09OLnBhcnNlKGdldExvY2FsU3RvcmFnZShsb2NhbFN0b3JhZ2VLZXkpKSB8fCB7fTtcbn07XG5jb25zdCBzZXRTaW5nbGVPYmplY3RMb2NhbFN0b3JhZ2UgPSAobG9jYWxTdG9yYWdlS2V5LCBrZXlWYWx1ZU9iamVjdCkgPT4ge1xuICBjb25zdCBzZXRMb2NhbFN0b3JhZ2VWYWwgPSBnZXRPYmplY3RMb2NhbFN0b3JhZ2UobG9jYWxTdG9yYWdlS2V5KTtcbiAgc2V0TG9jYWxTdG9yYWdlVmFsW2tleVZhbHVlT2JqZWN0LmtleV0gPSBrZXlWYWx1ZU9iamVjdC52YWx1ZTtcbiAgc2V0TG9jYWxTdG9yYWdlKGxvY2FsU3RvcmFnZUtleSwgSlNPTi5zdHJpbmdpZnkoc2V0TG9jYWxTdG9yYWdlVmFsKSk7XG59O1xuY29uc3QgZ2V0U2luZ2xlT2JqZWN0TG9jYWxTdG9yYWdlID0gKGxvY2FsU3RvcmFnZUtleSwgb2JqZWN0S2V5KSA9PiB7XG4gIGNvbnN0IGdldExvY2FsU3RvcmFnZVZhbCA9IGdldE9iamVjdExvY2FsU3RvcmFnZShsb2NhbFN0b3JhZ2VLZXkpO1xuICBpZiAoZ2V0TG9jYWxTdG9yYWdlVmFsID09PSBudWxsIHx8IGdldExvY2FsU3RvcmFnZVZhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ2V0TG9jYWxTdG9yYWdlVmFsLmhhc093blByb3BlcnR5KG9iamVjdEtleSkpIHtcbiAgICByZXR1cm4gZ2V0TG9jYWxTdG9yYWdlVmFsW29iamVjdEtleV07XG4gIH1cbiAgZWxzZSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn07XG5cbmV4cG9ydCB7IGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzIGFzIGEsIGdldFNpbmdsZU9iamVjdExvY2FsU3RvcmFnZSBhcyBnLCBsb2NhbFN0b3JhZ2VLZXlzIGFzIGwsIHNldFNpbmdsZU9iamVjdExvY2FsU3RvcmFnZSBhcyBzIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGUgYXMgZXNjYXBlUmVnRXhwIH0gZnJvbSAnLi9mdW5jdGlvbmFsLWM4MmY1YWI5LmpzJztcblxuLy8gaW1wb3J0IHN0cmluZ1V0aWwgZnJvbSBcIi4vc3RyaW5nc1wiO1xuLyoqXG4gKiBVdGlsaXR5IG1ldGhvZHMgZm9yIGRlYWxpbmcgd2l0aCBzdG9yYWdlIG9mIHZhcmlvdXMgZm9ybXMgKGNvb2tpZXMsIGxvY2FsIHN0b3JhZ2UsIGFuZCBzZXNzaW9uIHN0b3JhZ2UpLlxuICovXG5mdW5jdGlvbiBzZXRDb29raWUobmFtZSwgY29va2llLCBwcm9wZXJ0aWVzLCBzdHJpbmdpZnkpIHtcbiAgd3JpdGVDb29raWUobmFtZSwgc3RyaW5naWZ5ID8gSlNPTi5zdHJpbmdpZnkoY29va2llKSA6IGNvb2tpZSwgcHJvcGVydGllcyk7XG59XG5mdW5jdGlvbiBnZXRDb29raWUobmFtZSwgcGFyc2UpIHtcbiAgY29uc3QgY29va2llID0gcmVhZENvb2tpZShuYW1lKTtcbiAgcmV0dXJuIGNvb2tpZSAmJiBwYXJzZSA/IEpTT04ucGFyc2UoY29va2llKSA6IGNvb2tpZTtcbn1cbmZ1bmN0aW9uIHNldExvY2FsU3RvcmFnZUl0ZW0obmFtZSwgaXRlbSwgc3RyaW5naWZ5KSB7XG4gIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShuYW1lLCBzdHJpbmdpZnkgPyBKU09OLnN0cmluZ2lmeShpdGVtKSA6IGl0ZW0pO1xufVxuZnVuY3Rpb24gZ2V0TG9jYWxTdG9yYWdlSXRlbShuYW1lLCBwYXJzZSkge1xuICBjb25zdCBpdGVtID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKG5hbWUpO1xuICByZXR1cm4gaXRlbSAmJiBwYXJzZSA/IEpTT04ucGFyc2UoaXRlbSkgOiBpdGVtO1xufVxuZnVuY3Rpb24gc2V0U2Vzc2lvblN0b3JhZ2VJdGVtKG5hbWUsIGl0ZW0sIHN0cmluZ2lmeSkge1xuICB3aW5kb3cuc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShuYW1lLCBzdHJpbmdpZnkgPyBKU09OLnN0cmluZ2lmeShpdGVtKSA6IGl0ZW0pO1xufVxuZnVuY3Rpb24gZ2V0U2Vzc2lvblN0b3JhZ2VJdGVtKG5hbWUsIHBhcnNlKSB7XG4gIGNvbnN0IGl0ZW0gPSB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShuYW1lKTtcbiAgcmV0dXJuIGl0ZW0gJiYgcGFyc2UgPyBKU09OLnBhcnNlKGl0ZW0pIDogaXRlbTtcbn1cbmZ1bmN0aW9uIHJlYWRDb29raWUobmFtZSkge1xuICBjb25zdCBjb29raWUgPSBkb2N1bWVudC5jb29raWU7XG4gIGNvbnN0IGNvb2tpZU5hbWVSRSA9IG5ldyBSZWdFeHAoYCg/Ol58OyApJHtlc2NhcGVSZWdFeHAobmFtZSl9PShbXjtdKilgKTtcbiAgY29uc3QgbWF0Y2hlZENvb2tpZXMgPSBjb29raWUubWF0Y2goY29va2llTmFtZVJFKTtcbiAgcmV0dXJuIG1hdGNoZWRDb29raWVzID8gZGVjb2RlVVJJQ29tcG9uZW50KG1hdGNoZWRDb29raWVzWzFdKSA6IHVuZGVmaW5lZDtcbn1cbmZ1bmN0aW9uIHdyaXRlQ29va2llKG5hbWUsIHZhbHVlLCBwcm9wZXJ0aWVzKSB7XG4gIHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzIHx8IHt9O1xuICBsZXQgZXhwaXJlcyA9IHByb3BlcnRpZXMgPT09IG51bGwgfHwgcHJvcGVydGllcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHJvcGVydGllcy5leHBpcmVzO1xuICBpZiAodHlwZW9mIGV4cGlyZXMgPT09IFwibnVtYmVyXCIpIHtcbiAgICBjb25zdCBleHBpcmF0aW9uRGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgZGF5c0Zyb21Ub2RheUluTXMgPSBleHBpcmVzICogMjQgKiA2MCAqIDYwICogMTAwMDtcbiAgICBleHBpcmF0aW9uRGF0ZS5zZXRUaW1lKERhdGUubm93KCkgKyBkYXlzRnJvbVRvZGF5SW5Ncyk7XG4gICAgZXhwaXJlcyA9IHByb3BlcnRpZXMuZXhwaXJlcyA9IGV4cGlyYXRpb25EYXRlO1xuICB9XG4gIGlmICh0eXBlb2YgZXhwaXJlcyAhPT0gXCJzdHJpbmdcIiAmJiAoZXhwaXJlcyA9PT0gbnVsbCB8fCBleHBpcmVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBleHBpcmVzLnRvVVRDU3RyaW5nKSkge1xuICAgIHByb3BlcnRpZXMuZXhwaXJlcyA9IGV4cGlyZXMudG9VVENTdHJpbmcoKTtcbiAgfVxuICBsZXQgY29va2llID0gYCR7bmFtZX09JHtlbmNvZGVVUklDb21wb25lbnQodmFsdWUpfWA7XG4gIGxldCBwcm9wZXJ0eTtcbiAgZm9yIChwcm9wZXJ0eSBpbiBwcm9wZXJ0aWVzKSB7XG4gICAgY29va2llICs9IGA7ICR7cHJvcGVydHl9YDtcbiAgICBjb25zdCBwcm9wZXJ0eVZhbHVlID0gcHJvcGVydGllc1twcm9wZXJ0eV07XG4gICAgaWYgKHByb3BlcnR5VmFsdWUgIT09IHRydWUpIHtcbiAgICAgIGNvb2tpZSArPSBgPSR7cHJvcGVydHlWYWx1ZX1gO1xuICAgIH1cbiAgfVxuICBkb2N1bWVudC5jb29raWUgPSBjb29raWU7XG59XG5cbmV4cG9ydCB7IGdldENvb2tpZSBhcyBhLCBzZXRDb29raWUgYXMgYiwgc2V0U2Vzc2lvblN0b3JhZ2VJdGVtIGFzIGMsIGdldFNlc3Npb25TdG9yYWdlSXRlbSBhcyBkLCBnZXRMb2NhbFN0b3JhZ2VJdGVtIGFzIGcsIHNldExvY2FsU3RvcmFnZUl0ZW0gYXMgcyB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9