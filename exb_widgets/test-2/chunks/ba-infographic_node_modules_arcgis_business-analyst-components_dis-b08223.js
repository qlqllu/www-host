"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_ba-infographic_node_modules_arcgis_business-analyst-components_dis-b08223"],{

/***/ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-3ef1a00f.js":
/*!************************************************************************************************************************************************************!*\
  !*** ./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-3ef1a00f.js ***!
  \************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (/* binding */ ArcgisInfographic)
/* harmony export */ });
/* harmony import */ var _index_4e647411_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-4e647411.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/index-4e647411.js");
/* harmony import */ var _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ElementIds-a2c40592.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/ElementIds-a2c40592.js");
/* harmony import */ var _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./GEClient-f71049f8.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/GEClient-f71049f8.js");




class DebugLog {
  constructor() {
    this.fixForLint = '';
  }
  static log(title, ...list) {
    if (DebugLog.showDebugConsoleLogs) {
      console.log('=======>' + title + ': ');
      if (list && list.length) {
        for (let ii = 0; ii < list.length; ii++) {
          console.log('...', list[ii]);
        }
      }
    }
  }
}
DebugLog.showDebugConsoleLogs = false;

function setEnvironment(environment) {
  try {
    if (environment != null && environment.length > 0) {
      _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.S.setEnvironment(environment);
      return _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('ok');
    }
    else {
      return _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('invalid-environment');
    }
  }
  catch (ex) {
    return ex;
  }
}

class InfographicsHelper {
  constructor() {
  }
  static openInfographics(igItemId, hierarchyId, geometry, countryID) {
    try {
      InfographicsHelper._getInfographicsPlayerUrl().then((playerPageUrl) => {
        InfographicsHelper._openInfographicsTab(playerPageUrl, InfographicsHelper._getInfographicsParams(igItemId, hierarchyId, geometry, countryID));
      });
    }
    catch (ex) {
      _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.L.show('%e', 'InfographicHelper Error while getting player URL: ', ex);
    }
  }
  static _getInfographicsPlayerUrl() {
    return (new Promise(async (resolve, reject) => {
      if (InfographicsHelper._infographicsPlayerPageUrl) {
        return;
      }
      var playerPageUrl = _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.E.getUrl('infographics');
      fetch(playerPageUrl, { method: 'HEAD' })
        .then(response => {
        response.ok ? resolve(playerPageUrl) : reject();
      }).catch(error => {
        reject(error);
      });
    }));
  }
  static _openInfographicsTab(playerPageUrl, infographicParameters) {
    var wnd = window.open(playerPageUrl, '_blank');
    var onMessage = function (_wnd) {
      var messageHandler = function (event) {
        var href = event.data && event.data.href;
        var status = event.data && event.data.status;
        if (href === playerPageUrl && status === 'waiting_for_infographic_parameters') {
          _wnd.postMessage({
            type: 'infographic_parameters',
            infographicParameters: infographicParameters
          }, href);
        }
        window.removeEventListener('message', messageHandler);
      };
      return messageHandler;
    };
    window.addEventListener('message', onMessage(wnd));
  }
  static _getInfographicsParams(igItemId, hierarchyId, geometry, countryID) {
    var token = _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.T.token.access_token;
    var userId = _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.T.token.username;
    let tokenExpires = _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.T.token.expires_in;
    let ts = Date.now();
    let timeout = (tokenExpires == null) ? ts + 600000 : tokenExpires - ts;
    var expires = Math.floor(timeout / 60000 + 0.5);
    var server = _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.S.getPortalBaseUrl();
    // var fullPagesOnly = BA.LocalStorage.getValue(BA.settings.localStorageID_showFullInfographics);
    // fullPagesOnly = SettingsHelper.isTrueString(fullPagesOnly);
    var params = {
      server: server,
      userId: userId,
      token: token,
      expires: expires,
      reportID: igItemId,
      countryID: countryID,
      hierarchy: hierarchyId,
      // fullPagesOnly: fullPagesOnly
      analysisAreas: [{
          feature: {
            geometry: geometry
          }
        }]
    };
    return JSON.stringify(params);
  }
}

// noinspection JSUnusedGlobalSymbols
class TransportUtil {
  constructor() {
    this.fixForLint = '';
    // debug logging set to true
  }
  // public static GEUrl =
  //   'https://geoenrich.arcgis.com/arcgis/rest/services/World/geoenrichmentserver/Geoenrichment/Enrich';// eslint-disable-line no-eval
  static setToken(username, token) {
    _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.T.setToken(username, token);
  }
  /**
   * Makes GE call to generate drivetime or walktime buffers
   *
   * @param mode = 'drivetime' or 'walktime'
   * @param sourceCountry
   * @param units = 'minutes, 'miles' or 'kilometers'
   * @param bufferValues  = 1,3,5
   * @param longitude
   * @param latitude
   */
  static async getBuffers(mode, sourceCountry, units, bufferValues, longitude, latitude) {
    if (mode != 'drivetime' && mode != 'walktime') {
      throw ('TransportUtil - invalid args');
    }
    if (TransportUtil.hasText(sourceCountry) &&
      TransportUtil.hasText(units) &&
      bufferValues &&
      typeof longitude != undefined &&
      typeof latitude != undefined) {
      let params = await TransportUtil.getParams(mode, 
      // sourceCountry,
      units, bufferValues, longitude, latitude);
      let response = await _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.G.enrich(params);
      let spatial = response.results[0].value.FeatureSet[0].spatialReference;
      let obj = TransportUtil.parseRings(response);
      if (obj) {
        for (let ii = 0; ii < obj.length; ii++) {
          if (obj[ii]) {
            let item = obj[ii];
            // @ts-ignore
            item.transport = mode == 'drivetime' ? 'drive' : 'walk';
            // @ts-ignore
            item.latitude = latitude;
            // @ts-ignore
            item.longitude = longitude;
            // @ts-ignore
            item.spatial = spatial;
            // location marker
            item.location = {
              geometry: {
                x: longitude,
                y: latitude,
                spatialReference: {
                  wkid: 4326
                }
              },
              symbol: {
                type: 'esriPMS',
                width: 14,
                height: 26.6,
                xoffset: 0,
                yoffset: 12.6,
                contentType: 'image/png',
                imageData: 'iVBORw0KGgoAAAANSUhEUgAAABMAAAAjCAYAAAB2KjFhAAACtUlEQVRIS+2WS0wTURSG/zvT0kpfkGJ4pGCViA1Em9CtCQVx5QIWhiVRo8GdSNypqHElkcgOlzVh5ap1X6nEiAkQXzGBxkSKtZC0jdTSB7SdMXdwRjudB+w5q5t7T775z3/OzR0CWbT4x90Glh0CMEx43g1C3FIKz6/zhKwDCJYrldBWZIaupSDiqsE/3mBjmGeMyXLF7GiBubEVhmN2sIY6KblS3kO58BvFX5soZrbA7eYCWY67vR2Z2aZJAoyqMTLMvLXN47a1eeRiUSrmUSrmhHSGNYA11oGtMyO3FcVOYnW9xHH9VKUAcw1MfHSc9HktzvYaEN34B6suymSxCwozsQ+ReHi6n7gG7/iNZvv88W6/Ikgdtl+Y2d6I5NfXqJQK/cQ1MPHQ1uZ5oFSeSFdWtn9Ky93b/olsYvURhUWcXef7TPamGmWXfM3oPeVAi8OIeDKLpWgSrxY3qvIY1gjCl5GOvn2jCLOaWUyN9sDX6aj5wNJaErdm3yNbKAlnurCp0W709ThVPQy+i+H+ixV92OlWC+bGe1VB4sHlx2GsxTPayqhPkyNdurB7gRWEFmPasBsXT+D6YIcu7MnLz5gLf9OG0e7Njp3ThV2bXsBSNKUNo518ftML6p1aUK+oZwfqJgVRIAXLg47E1acLgvkHgtGk1kYTJkfOCEMrxnI0hbuBZSTSeWlPd87kaprqeWwkUopVHxqmdTePYMqTdeRZ9d1svzARtLnODlmbO1XvoqpnhMBkaUAhHUM2/iVE6ONrZZjIoZ+6v6BiZhOZ7yufdjjOL7ybesAaZQog+qpX/R6oKayCqYCoKAmmpVCCaYBqYGpAAbabF8z+3yPxh0XsXJUycVPuYWm3IIyAFkhRmRowl/4hdU2uSFOZHFjv7PDm0xtC+9VAmspkwOAOxw1rgWj+H4uVH6hj08HSAAAAAElFTkSuQmCC'
              }
            };
          }
        }
      }
      return obj;
    }
    return null;
  }
  static parseRings(response) {
    var rings = [];
    var checked = {};
    try {
      if (response && response.results && response.results.length > 0) {
        let featureSet = response.results[0].value.FeatureSet[0];
        if (featureSet.features && featureSet.features.length > 0) {
          for (let ii = 0; ii < featureSet.features.length; ii++) {
            let f = featureSet.features[ii];
            let bufferValue = f.attributes.bufferRadii;
            // filter out duplicate rings
            if (!checked[bufferValue]) {
              checked[bufferValue] = true;
              let bufferUnits = f.attributes.bufferUnits;
              let r = f.geometry.rings;
              rings.push({ value: bufferValue, units: bufferUnits, rings: r });
            }
          }
          return rings;
        }
      }
    }
    catch (ex) {
      _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.L.show('%e', 'TransportUtil parse GE result is invalid');
    }
    return undefined;
  }
  static hasText(s) {
    let test = (typeof s != undefined && s.trim().length > 0);
    return test;
  }
  static calculateSimplification(mode, bufferUnits, bufferValues) {
    let factor = 10;
    let max = 1;
    for (let ii = 0; ii < bufferValues.length; ii++) {
      max = (bufferValues[ii] > max) ? bufferValues[ii] : max;
    }
    if (mode === 'drivetime') {
      switch (bufferUnits) {
        case ('minutes'): {
          factor = Math.max(10, (0.00614 * max * max) + (3.5 * max) - 40);
          break;
        }
        case ('miles'): {
          factor = Math.max(10, (8.5 * max) - 100);
          break;
        }
        case ('kilometers'): {
          factor = Math.max(10, (5.3233 * max) - 60);
          break;
        }
      }
    }
    else if (mode === 'walktime') {
      switch (bufferUnits) {
        case ('minutes'): {
          factor = Math.max(2, (0.1437 * max) - 8.7);
          break;
        }
        case ('miles'): {
          factor = Math.max(2, (4.7 * max) - 26.8);
          break;
        }
        case ('kilometers'): {
          factor = Math.max(2, (3.11 * max) - 32.7);
          break;
        }
      }
    }
    return factor;
  }
  /*
   * getParams - generates request parameters for drivetime or walktime
   */
  static async getParams(mode, 
  // sourceCountry: string,
  units, bufferValues, longitude, latitude) {
    let isTime = units.toLowerCase() == 'minutes';
    let isDrivetime = mode == 'drivetime';
    // let defaultHierarchy = await GEClient.getGEDefaultHierarchy(sourceCountry)
    const simpleFactor = this.calculateSimplification(mode, units, bufferValues);
    // let countryObj = {
    //   sourceCountry: sourceCountry,
    //   hierarchy: defaultHierarchy
    // }
    // let jsonData: string = JSON.stringify(countryObj)
    let studyObj;
    // DRIVING BUFFERS
    if (isDrivetime) {
      studyObj = [
        {
          bufferUnits: isTime ? 'Minutes' : (units == 'miles') ? 'esriMiles' : 'esriKilometers',
          bufferRadii: bufferValues,
          areaType: 'NetworkServiceArea',
          travel_mode: {
            attributeParameterValues: [
              {
                attributeName: 'Avoid Unpaved Roads',
                parameterName: 'Restriction Usage',
                value: 'AVOID_HIGH'
              },
              {
                attributeName: 'Avoid Private Roads',
                parameterName: 'Restriction Usage',
                value: 'AVOID_MEDIUM'
              },
              {
                attributeName: 'Driving an Automobile',
                parameterName: 'Restriction Usage',
                value: 'PROHIBITED'
              },
              {
                attributeName: 'Through Traffic Prohibited',
                parameterName: 'Restriction Usage',
                value: 'AVOID_HIGH'
              },
              {
                attributeName: 'TravelTime',
                parameterName: 'Vehicle Maximum Speed (km/h)',
                value: 0
              },
              {
                attributeName: 'Roads Under Construction Prohibited',
                parameterName: 'Restriction Usage',
                value: 'PROHIBITED'
              },
              {
                attributeName: 'Avoid Gates',
                parameterName: 'Restriction Usage',
                value: 'AVOID_MEDIUM'
              },
              {
                attributeName: 'Avoid Express Lanes',
                parameterName: 'Restriction Usage',
                value: 'PROHIBITED'
              },
              {
                attributeName: 'Avoid Carpool Roads',
                parameterName: 'Restriction Usage',
                value: 'PROHIBITED'
              }
            ],
            distanceAttributeName: 'Kilometers',
            id: 'FEgifRtFndKNcJMJ',
            impedanceAttributeName: (isTime) ? 'TravelTime' : 'Kilometers',
            name: (isTime) ? 'Driving Time' : 'Driving Distance',
            restrictionAttributeNames: [
              'Avoid Unpaved Roads',
              'Avoid Private Roads',
              'Driving an Automobile',
              'Through Traffic Prohibited',
              'Roads Under Construction Prohibited',
              'Avoid Gates',
              'Avoid Express Lanes',
              'Avoid Carpool Roads'
            ],
            simplificationTolerance: simpleFactor,
            simplificationToleranceUnits: 'esriMeters',
            timeAttributeName: 'TravelTime',
            type: 'AUTOMOBILE',
            useHierarchy: true,
            uturnAtJunctions: 'esriNFSBAtDeadEndsAndIntersections',
            description: 'Models the movement of cars and other similar small automobiles, such as pickup trucks, and finds solutions that optimize travel time. Travel obeys one-way roads, avoids illegal turns, and follows other rules that are specific to cars. When you specify a start time, dynamic travel speeds based on traffic are used where it is available.',
          },
          networkOptions: {
            // travel_direction: 'Away From Facility',
            polygon_overlap_type: 'Disks'
          },
          returnGeometry: true,
          geometry: {
            x: longitude,
            y: latitude,
            spatialReference: {
              wkid: 4326,
              latestWkid: 4326
            }
          }
        }
      ];
    }
    else {
      // WALKING BUFFERS
      studyObj = [
        {
          bufferUnits: isTime ? 'Minutes' : (units == 'miles') ? 'esriMiles' : 'esriKilometers',
          bufferRadii: bufferValues,
          areaType: 'NetworkServiceArea',
          travel_mode: {
            attributeParameterValues: [
              {
                parameterName: 'Restriction Usage',
                attributeName: 'Avoid Private Roads',
                value: 'AVOID_MEDIUM'
              },
              {
                parameterName: 'Restriction Usage',
                attributeName: 'Walking',
                value: 'PROHIBITED'
              },
              {
                parameterName: 'Restriction Usage',
                attributeName: 'Preferred for Pedestrians',
                value: 'PREFER_LOW'
              },
              {
                parameterName: 'Walking Speed (km/h)',
                attributeName: 'WalkTime',
                value: 5
              },
              {
                parameterName: 'Restriction Usage',
                attributeName: 'Avoid Roads Unsuitable for Pedestrians',
                value: 'AVOID_HIGH'
              }
            ],
            description: 'Follows paths and roads that allow pedestrian traffic and finds solutions that optimize travel time. The walking speed is set to 5 kilometers per hour.',
            impedanceAttributeName: isTime ? 'WalkTime' : 'Kilometers',
            simplificationToleranceUnits: 'esriMeters',
            uturnAtJunctions: 'esriNFSBAllowBacktrack',
            restrictionAttributeNames: [
              'Avoid Private Roads',
              'Avoid Roads Unsuitable for Pedestrians',
              'Preferred for Pedestrians',
              'Walking'
            ],
            useHierarchy: false,
            simplificationTolerance: simpleFactor,
            timeAttributeName: 'WalkTime',
            distanceAttributeName: 'Kilometers',
            type: 'WALK',
            id: 'caFAgoThrvUpkFBW',
            name: isTime ? 'Walking Time' : 'Walking Distance'
          },
          networkOptions: {
            polygon_overlap_type: 'Disks'
          },
          returnGeometry: true,
          geometry: {
            x: longitude,
            y: latitude,
            spatialReference: {
              wkid: 4326,
              latestWkid: 4326
            }
          }
        }
      ];
    }
    let jsonStudy = JSON.stringify(studyObj);
    let json = {
      "dataCollections": ["GlobalIntersect"],
      "returnGeometry": true,
      "outSR": "{\"wkid\":4326, \"latestWkid\":4326}",
      "studyareas": jsonStudy,
      "forStorage": false,
      "f": "json"
    };
    return json;
  }
}

class GeometryUtil {
  /*
   *  getRings
   *
   *  Generates rings for a location in the specified 'units', for
   *  the 1-3 radius values
   *
   *  units = [miles or kilometers]
   *  values = array of radius values using 1 to 3 values
   */
  static getRings(lat, lon, units, values, locationName, locationAttributes) {
    if (!values || values.length <= 0 || values.length > 3
      || (units != 'miles' && units != 'kilometers')
      || (!lat || !lon)) {
      _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.L.show('%e', 'GeometryUtil: invalid args', lat, lon, values);
      throw 'GeometryUtil: invalid args';
    }
    // let latitude = parseFloat(lat);
    // let longitude = parseFloat(lon);
    let rings = [];
    for (let ii = 0; ii < values.length; ii++) {
      let area = this.getAnalysisAreaRings(lat, lon, units, values, ii, locationName, locationAttributes);
      rings.push(area);
    }
    return rings;
  }
  static getAnalysisAreaRings(lat, lon, units, values, index, locationName, locationAttributes) {
    if (!lat || !lon || units == undefined || !values || values.length < 0 || values.length > 3) {
      DebugLog.log('arcgis-infographic analysisAreas invalid args: ', lat, lon, units, values);
      throw ('GeometryUtil.getAnalysisAreaRings: invalid args');
    }
    let sUnits = (values[index] == 1) ?
      (units == 'miles') ? _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('mile') : _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('kilometer') :
      (units == 'miles') ? _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('milesLowercase') : _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('kilometersLowercase');
    function getDescription() {
      let _unit = (units == 'miles') ? ' ' + _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('mile') : ' ' + _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('kilometer');
      return (_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('ring-semicolon') + ' ' + values[index] + _unit + ' ' + _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('radiusLowercase'));
    }
    function getName() {
      return values[index] + ' ' + sUnits;
    }
    function getShortName() {
      return values[index] + ' ' + sUnits;
    }
    let result = {
      feature: {
        geometry: {
          rings: []
        },
        attributes: {
          RING: index + 1,
          DESCRIPTION: '',
          latitude: lat,
          longitude: lon,
          name: getName(),
          shortName: getShortName(),
          description: getDescription(),
        }
      },
      latitude: lat,
      longitude: lon,
      location: {
        geometry: {
          x: lon,
          y: lat,
          spatialReference: {
            wkid: 4326
          }
        },
        symbol: {
          type: 'esriPMS',
          width: 14,
          height: 26.6,
          xoffset: 0,
          yoffset: 12.6,
          contentType: 'image/png',
          imageData: 'iVBORw0KGgoAAAANSUhEUgAAABMAAAAjCAYAAAB2KjFhAAACtUlEQVRIS+2WS0wTURSG/zvT0kpfkGJ4pGCViA1Em9CtCQVx5QIWhiVRo8GdSNypqHElkcgOlzVh5ap1X6nEiAkQXzGBxkSKtZC0jdTSB7SdMXdwRjudB+w5q5t7T775z3/OzR0CWbT4x90Glh0CMEx43g1C3FIKz6/zhKwDCJYrldBWZIaupSDiqsE/3mBjmGeMyXLF7GiBubEVhmN2sIY6KblS3kO58BvFX5soZrbA7eYCWY67vR2Z2aZJAoyqMTLMvLXN47a1eeRiUSrmUSrmhHSGNYA11oGtMyO3FcVOYnW9xHH9VKUAcw1MfHSc9HktzvYaEN34B6suymSxCwozsQ+ReHi6n7gG7/iNZvv88W6/Ikgdtl+Y2d6I5NfXqJQK/cQ1MPHQ1uZ5oFSeSFdWtn9Ky93b/olsYvURhUWcXef7TPamGmWXfM3oPeVAi8OIeDKLpWgSrxY3qvIY1gjCl5GOvn2jCLOaWUyN9sDX6aj5wNJaErdm3yNbKAlnurCp0W709ThVPQy+i+H+ixV92OlWC+bGe1VB4sHlx2GsxTPayqhPkyNdurB7gRWEFmPasBsXT+D6YIcu7MnLz5gLf9OG0e7Njp3ThV2bXsBSNKUNo518ftML6p1aUK+oZwfqJgVRIAXLg47E1acLgvkHgtGk1kYTJkfOCEMrxnI0hbuBZSTSeWlPd87kaprqeWwkUopVHxqmdTePYMqTdeRZ9d1svzARtLnODlmbO1XvoqpnhMBkaUAhHUM2/iVE6ONrZZjIoZ+6v6BiZhOZ7yufdjjOL7ybesAaZQog+qpX/R6oKayCqYCoKAmmpVCCaYBqYGpAAbabF8z+3yPxh0XsXJUycVPuYWm3IIyAFkhRmRowl/4hdU2uSFOZHFjv7PDm0xtC+9VAmspkwOAOxw1rgWj+H4uVH6hj08HSAAAAAElFTkSuQmCC'
        }
      },
      name: locationName ? locationName : getName(),
      address: '',
      shortName: getShortName(),
      locationName: locationName ? locationName : getName(),
      description: getDescription()
    };
    // Add attributes that were passed in
    if (locationAttributes) {
      const mergedAttributes = {
        ...locationAttributes,
        ...result.feature.attributes
      };
      result.feature.attributes = mergedAttributes;
    }
    let r = GeometryUtil._generateRing(lat, lon, units, values[index]);
    // @ts-ignore
    result.feature.geometry.rings.push(r);
    return result;
  }
  // generate Analysis Areas for  infographic
  //
  // Expecting rings = [ {value,units,rings},...]
  //
  // Returns:  json geometry
  static getAnalysisAreasFromRings(data, locationName, locationAttributes) {
    var obj = {
      analysisAreas: []
    };
    for (let ii = 0; ii < data.length; ii++) {
      let d = data[ii];
      let isTime = d.units.toLowerCase() == 'minutes';
      // let isSingular = d.value == 1;
      let unitLow = d.units.toLowerCase();
      let displayUnits = isTime ? _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('minutes') : unitLow.indexOf('miles') >= 0 ? _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('milesLowercase') : _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('kilometersLowercase');
      let shortUnits = displayUnits.substr(0, displayUnits.length - 1);
      let shortName = d.value.toString() + ' ' + shortUnits + ' ' + d.transport;
      let descUnit = isTime ? ' ' + _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('time-semicolon') + ' ' : ' ' + _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('distance-semicolon') + ' ';
      let descValue = d.value.toString() + ' ' + (d.value == 1 ? shortUnits : displayUnits);
      let desc = (d.transport == 'drive' ? _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('drive') : _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('walk')) + descUnit + descValue;
      let buffer = {
        'feature': {
          'geometry': {
            'rings': d.rings,
            'spatialReference': { 'wkid': 4326 }
          },
          'attributes': {
            // "OBJECTID":      19,
            //   "RELID":         "028ddf01-c281-47f2-97bd-4cc586424890",
            'RING': ii,
            // "DESCRIPTION":   null,
            'SYMBOL': {
              'color': [204, 51, 0, 128],
              'outline': {
                'color': [204, 51, 0, 255],
                'width': 1.5,
                'type': 'esriSLS',
                'style': 'esriSLSSolid'
              },
              'type': 'esriSFS',
              'style': 'esriSFSSolid'
            }
          }
        },
        'latitude': d.latitude,
        'longitude': d.longitude,
        'name': locationName ? locationName : '',
        'address': '',
        'shortName': shortName,
        'locationName': locationName ? locationName : '',
        'description': desc,
        'location': {
          'geometry': {
            'x': d.longitude,
            'y': d.latitude,
            'spatialReference': {
              'wkid': '4326'
            }
          },
          'symbol': {
            'type': 'esriPMS',
            'width': 14,
            'height': 26.6,
            'xoffset': 0,
            'yoffset': 12.6,
            'contentType': 'image/png',
            'imageData': 'iVBORw0KGgoAAAANSUhEUgAAABMAAAAjCAYAAAB2KjFhAAACtUlEQVRIS+2WS0wTURSG/zvT0kpfkGJ4pGCViA1Em9CtCQVx5QIWhiVRo8GdSNypqHElkcgOlzVh5ap1X6nEiAkQXzGBxkSKtZC0jdTSB7SdMXdwRjudB+w5q5t7T775z3/OzR0CWbT4x90Glh0CMEx43g1C3FIKz6/zhKwDCJYrldBWZIaupSDiqsE/3mBjmGeMyXLF7GiBubEVhmN2sIY6KblS3kO58BvFX5soZrbA7eYCWY67vR2Z2aZJAoyqMTLMvLXN47a1eeRiUSrmUSrmhHSGNYA11oGtMyO3FcVOYnW9xHH9VKUAcw1MfHSc9HktzvYaEN34B6suymSxCwozsQ+ReHi6n7gG7/iNZvv88W6/Ikgdtl+Y2d6I5NfXqJQK/cQ1MPHQ1uZ5oFSeSFdWtn9Ky93b/olsYvURhUWcXef7TPamGmWXfM3oPeVAi8OIeDKLpWgSrxY3qvIY1gjCl5GOvn2jCLOaWUyN9sDX6aj5wNJaErdm3yNbKAlnurCp0W709ThVPQy+i+H+ixV92OlWC+bGe1VB4sHlx2GsxTPayqhPkyNdurB7gRWEFmPasBsXT+D6YIcu7MnLz5gLf9OG0e7Njp3ThV2bXsBSNKUNo518ftML6p1aUK+oZwfqJgVRIAXLg47E1acLgvkHgtGk1kYTJkfOCEMrxnI0hbuBZSTSeWlPd87kaprqeWwkUopVHxqmdTePYMqTdeRZ9d1svzARtLnODlmbO1XvoqpnhMBkaUAhHUM2/iVE6ONrZZjIoZ+6v6BiZhOZ7yufdjjOL7ybesAaZQog+qpX/R6oKayCqYCoKAmmpVCCaYBqYGpAAbabF8z+3yPxh0XsXJUycVPuYWm3IIyAFkhRmRowl/4hdU2uSFOZHFjv7PDm0xtC+9VAmspkwOAOxw1rgWj+H4uVH6hj08HSAAAAAElFTkSuQmCC'
          }
        }
      };
      // Add attributes that were passed in
      if (locationAttributes) {
        const mergedAttributes = {
          ...locationAttributes,
          ...buffer.feature.attributes
        };
        buffer.feature.attributes = mergedAttributes;
      }
      // @ts-ignore
      obj.analysisAreas.push(buffer);
    }
    let s = JSON.stringify(obj).replace('{"analysisAreas"', '"analysisAreas"');
    return s.substr(0, s.length - 1);
  }
  static getAnalysisAreasFromPolygon(data, locationName, locationAttributes) {
    if (!data || !data.rings || !data.spatial || !data.latitude || !data.longitude) {
      DebugLog.log('getAnalysisAreasFromPolygon', 'invalid args', data);
      return '';
    }
    const obj = {
      analysisAreas: [
        {
          feature: {
            name: locationName ? locationName : '',
            geometry: {
              rings: data.rings,
              spatialReference: data.spatial
            },
            attributes: {
              RING: 1,
              SYMBOL: {
                color: [204, 51, 0, 128],
                outline: {
                  color: [204, 51, 0, 255],
                  width: 1.5,
                  type: 'esriSLS',
                  style: 'esriSLSSolid'
                },
                type: 'esriSFS',
                style: 'esriSFSSolid'
              }
            }
          },
          name: locationName ? locationName : '',
          latitude: data.latitude,
          longitude: data.longitude,
          description: locationName ? locationName : 'feature polygon'
          // location: {
          //   geometry: {
          //     x: data.longitude,
          //     y: data.latitude,
          //     spatialReference: {
          //       wkid: 4326,
          //     },
          //   },
          //   symbol: {
          //     type: 'esriPMS',
          //     width: 14,
          //     height: 26.6,
          //     xoffset: 0,
          //     yoffset: 12.6,
          //     contentType: 'image/png',
          //     imageData: 'iVBORw0KGgoAAAANSUhEUgAAABMAAAAjCAYAAAB2KjFhAAACtUlEQVRIS+2WS0wTURSG/zvT0kpfkGJ4pGCViA1Em9CtCQVx5QIWhiVRo8GdSNypqHElkcgOlzVh5ap1X6nEiAkQXzGBxkSKtZC0jdTSB7SdMXdwRjudB+w5q5t7T775z3/OzR0CWbT4x90Glh0CMEx43g1C3FIKz6/zhKwDCJYrldBWZIaupSDiqsE/3mBjmGeMyXLF7GiBubEVhmN2sIY6KblS3kO58BvFX5soZrbA7eYCWY67vR2Z2aZJAoyqMTLMvLXN47a1eeRiUSrmUSrmhHSGNYA11oGtMyO3FcVOYnW9xHH9VKUAcw1MfHSc9HktzvYaEN34B6suymSxCwozsQ+ReHi6n7gG7/iNZvv88W6/Ikgdtl+Y2d6I5NfXqJQK/cQ1MPHQ1uZ5oFSeSFdWtn9Ky93b/olsYvURhUWcXef7TPamGmWXfM3oPeVAi8OIeDKLpWgSrxY3qvIY1gjCl5GOvn2jCLOaWUyN9sDX6aj5wNJaErdm3yNbKAlnurCp0W709ThVPQy+i+H+ixV92OlWC+bGe1VB4sHlx2GsxTPayqhPkyNdurB7gRWEFmPasBsXT+D6YIcu7MnLz5gLf9OG0e7Njp3ThV2bXsBSNKUNo518ftML6p1aUK+oZwfqJgVRIAXLg47E1acLgvkHgtGk1kYTJkfOCEMrxnI0hbuBZSTSeWlPd87kaprqeWwkUopVHxqmdTePYMqTdeRZ9d1svzARtLnODlmbO1XvoqpnhMBkaUAhHUM2/iVE6ONrZZjIoZ+6v6BiZhOZ7yufdjjOL7ybesAaZQog+qpX/R6oKayCqYCoKAmmpVCCaYBqYGpAAbabF8z+3yPxh0XsXJUycVPuYWm3IIyAFkhRmRowl/4hdU2uSFOZHFjv7PDm0xtC+9VAmspkwOAOxw1rgWj+H4uVH6hj08HSAAAAAElFTkSuQmCC',
          //   },
          // },
        }
      ]
    };
    // Add attributes that were passed in
    if (locationAttributes) {
      const mergedAttributes = {
        ...locationAttributes,
        ...obj.analysisAreas[0].feature.attributes
      };
      obj.analysisAreas[0].feature.attributes = mergedAttributes;
    }
    let s = JSON.stringify(obj).replace('{"analysisAreas"', '"analysisAreas"');
    return s.substr(0, s.length - 1);
  }
  /**
   * Takes data returned from getBuffers for DT/WT and returns
   * json analysis areas
   * @param data
   * @return {string}
   */
  static getAnalysisAreasFromEnrichBuffers(data, locationName, locationAttributes) {
    if (!data || data.length <= 0) {
      DebugLog.log('getAnalysisAreasFromEnrichBuffers', 'invalid args', data);
      return '';
    }
    const obj = {
      analysisAreas: [],
      spatialReference: data[0].spatial
    };
    let lat, lon;
    for (let ii = 0; ii < data.length; ii++) {
      let buffer = data[ii];
      if (!buffer || !buffer.latitude || !buffer.longitude || !buffer.rings)
        continue;
      let isTime = buffer.units.toLowerCase() == 'minutes';
      let isSingular = buffer.value == 1;
      let unitLow = buffer.units.toLowerCase();
      let displayUnits = isTime ? _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('minutes') : unitLow.toLowerCase().indexOf('miles') >= 0 ? _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('milesLowercase') : _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('kilometersLowercase');
      let shortUnits = displayUnits.substr(0, displayUnits.length - 1);
      let shortName = buffer.value.toString() + ' ' + shortUnits + ' ' + buffer.transport;
      let descUnit = isTime ? ' ' + _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('time-semicolon') + ' ' : ' ' + _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('distance-semicolon') + ' ';
      let descValue = buffer.value.toString() + ' ' + (isSingular ? shortUnits : displayUnits);
      let desc = (buffer.transport == 'drive' ? _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('drive') : _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('walk')) + descUnit + descValue;
      if (!lat)
        lat = buffer.latitude;
      if (!lon)
        lon = buffer.longitude;
      let area = {
        feature: {
          geometry: {
            rings: buffer.rings
          },
          attributes: {
            RING: 1,
            SYMBOL: {
              color: [204, 51, 0, 128],
              outline: {
                color: [204, 51, 0, 255],
                width: 1.5,
                type: 'esriSLS',
                style: 'esriSLSSolid'
              },
              type: 'esriSFS',
              style: 'esriSFSSolid'
            }
          }
        },
        latitude: lat,
        longitude: lon,
        description: desc,
        shortName: shortName,
        name: locationName ? locationName : '',
        location: {
          geometry: {
            x: lon,
            y: lat,
            spatialReference: {
              wkid: 4326
            }
          },
          symbol: {
            type: 'esriPMS',
            width: 14,
            height: 26.6,
            xoffset: 0,
            yoffset: 12.6,
            contentType: 'image/png',
            imageData: 'iVBORw0KGgoAAAANSUhEUgAAABMAAAAjCAYAAAB2KjFhAAACtUlEQVRIS+2WS0wTURSG/zvT0kpfkGJ4pGCViA1Em9CtCQVx5QIWhiVRo8GdSNypqHElkcgOlzVh5ap1X6nEiAkQXzGBxkSKtZC0jdTSB7SdMXdwRjudB+w5q5t7T775z3/OzR0CWbT4x90Glh0CMEx43g1C3FIKz6/zhKwDCJYrldBWZIaupSDiqsE/3mBjmGeMyXLF7GiBubEVhmN2sIY6KblS3kO58BvFX5soZrbA7eYCWY67vR2Z2aZJAoyqMTLMvLXN47a1eeRiUSrmUSrmhHSGNYA11oGtMyO3FcVOYnW9xHH9VKUAcw1MfHSc9HktzvYaEN34B6suymSxCwozsQ+ReHi6n7gG7/iNZvv88W6/Ikgdtl+Y2d6I5NfXqJQK/cQ1MPHQ1uZ5oFSeSFdWtn9Ky93b/olsYvURhUWcXef7TPamGmWXfM3oPeVAi8OIeDKLpWgSrxY3qvIY1gjCl5GOvn2jCLOaWUyN9sDX6aj5wNJaErdm3yNbKAlnurCp0W709ThVPQy+i+H+ixV92OlWC+bGe1VB4sHlx2GsxTPayqhPkyNdurB7gRWEFmPasBsXT+D6YIcu7MnLz5gLf9OG0e7Njp3ThV2bXsBSNKUNo518ftML6p1aUK+oZwfqJgVRIAXLg47E1acLgvkHgtGk1kYTJkfOCEMrxnI0hbuBZSTSeWlPd87kaprqeWwkUopVHxqmdTePYMqTdeRZ9d1svzARtLnODlmbO1XvoqpnhMBkaUAhHUM2/iVE6ONrZZjIoZ+6v6BiZhOZ7yufdjjOL7ybesAaZQog+qpX/R6oKayCqYCoKAmmpVCCaYBqYGpAAbabF8z+3yPxh0XsXJUycVPuYWm3IIyAFkhRmRowl/4hdU2uSFOZHFjv7PDm0xtC+9VAmspkwOAOxw1rgWj+H4uVH6hj08HSAAAAAElFTkSuQmCC'
          }
        }
      };
      // Add attributes that were passed in
      if (locationAttributes) {
        const mergedAttributes = {
          ...locationAttributes,
          ...area.feature.attributes
        };
        area.feature.attributes = mergedAttributes;
      }
      // @ts-ignore
      obj.analysisAreas.push(area);
    }
    let s = JSON.stringify(obj).replace('{"analysisAreas"', '"analysisAreas"');
    return s.substr(0, s.length - 1);
  }
  static getDemoPolygon() {
    return '"analysisAreas": [ \
      { \
        "feature": { \
          "geometry": { \
            "rings": [ \
              [ \
                [ \
                  -118.000083501802, \
                  34.0609396322877 \
                ], \
                [ \
                  -118.000083501802, \
                  34.0700406810389 \
                ], \
                [ \
                  -118.000083501802, \
                  34.0791407522251 \
                ], \
                [ \
                  -118.000083501802, \
                  34.0882398457216 \
                ], \
                [ \
                  -117.989097176058, \
                  34.0882398457216 \
                ], \
                [ \
                  -117.989097176058, \
                  34.0973379614042 \
                ], \
                [ \
                  -117.978110850314, \
                  34.1064350991486 \
                ], \
                [ \
                  -117.96712452457, \
                  34.1064350991486 \
                ], \
                [ \
                  -117.956138198827, \
                  34.1064350991486 \
                ], \
                [ \
                  -117.956138198827, \
                  34.1155312878821 \
                ], \
                [ \
                  -117.956138198827, \
                  34.1246264693743 \
                ], \
                [ \
                  -117.945151873083, \
                  34.1246264693743 \
                ], \
                [ \
                  -117.945151873083, \
                  34.1155312878821 \
                ], \
                [ \
                  -117.945151873083, \
                  34.1064350991486 \
                ], \
                [ \
                  -117.945151873083, \
                  34.0973379614042 \
                ], \
                [ \
                  -117.945151873083, \
                  34.0882398457216 \
                ], \
                [ \
                  -117.945151873083, \
                  34.0791407522251 \
                ], \
                [ \
                  -117.956138198827, \
                  34.0791407522251 \
                ], \
                [ \
                  -117.956138198827, \
                  34.0700406810389 \
                ], \
                [ \
                  -117.96712452457, \
                  34.0700406810389 \
                ], \
                [ \
                  -117.978110850314, \
                  34.0700406810389 \
                ], \
                [ \
                  -117.978110850314, \
                  34.0609396322877 \
                ], \
                [ \
                  -117.989097176058, \
                  34.0609396322877 \
                ], \
                [ \
                  -118.000083501802, \
                  34.0609396322877 \
                ] \
              ] \
            ], \
            "spatialReference": { \
              "wkid": 4326 \
            } \
          }, \
          "attributes": { \
            "OBJECTID": 6, \
            "NAME": "06 103", \
            "DESCRIPTION": "Area: 8.1 square miles", \
            "CREATED": 1518736922977, \
            "MODIFIED": 1518736922977, \
            "CREATOR": "fasil_ba", \
            "EDITOR": "fasil_ba", \
            "REGION": "US", \
            "FLAGS": 2, \
            "SYMBOL": {\"color\":[255,255,178,230],\"outline\":{\"color\":[0,0,0,255],\"width\":1.5,\"type\":\"esriSLS\",\"style\":\"esriSLSSolid\",\"marker\":null},\"type\":\"esriSFS\",\"style\":\"esriSFSSolid\"}, \
            "STATEFP": "06", \
            "UNSDLEA": "03690", \
            "GEOID": "0603690", \
            "NAME_": "Baldwin Park Unified School District", \
            "LSAD": "00", \
            "LOGRADE": "KG", \
            "HIGRADE": "12", \
            "MTFCC": "G5420", \
            "SDTYP": " ", \
            "FUNCSTAT": "E", \
            "ALAND": 22081431, \
            "AWATER": 626574, \
            "INTPTLAT": "+34.0896602", \
            "INTPTLON": "-117.9687223", \
            "GEOID2": 603690, \
            "COUNT_": 0, \
            "COUNT_1": 0, \
            "OID1": 75, \
            "YEAR_1": 1314, \
            "COUNTY_1": 19, \
            "DISTRICT_1": 1964287, \
            "DISTRICT_2": "Baldwin Park Unified", \
            "GEOGRAPH_1": "Baldwin Park Unified School District, CA", \
            "GEOID_12": 603690, \
            "HISP_1": 16310, \
            "PCTHISP_1": 86.91, \
            "AMIND_1": 62, \
            "PCTAMIND_1": 0.33, \
            "ASIAN_1": 731, \
            "PCTASIAN_1": 3.9, \
            "PAC_1": 32, \
            "PCTPAC_1": 0.17, \
            "FIL_1": 326, \
            "PCTFIL_1": 1.74, \
            "AFAM_1": 635, \
            "PCTAFAM_1": 3.38, \
            "WHITE_1": 552, \
            "PCTWHITE_1": 2.94, \
            "TWOORMOR_1": 107, \
            "PCTTWOOR_1": 0.57, \
            "NONEREPO_1": 12, \
            "PCTNONER_1": 0.06, \
            "TOTAL_1": 18767, \
            "NONWHITE_1": 18203, \
            "PCTNONWH_1": 97, \
            "SHAPE__Area": null, \
            "SHAPE__Length": null \
          } \
        }, \
        "name": "06 103", \
        "address": "06 103", \
        "shortName": "06 103", \
        "description": "Area: 8.1 square miles" \
      }]';
  }
  // static generateDriveTime(lat, lon, units, values) {
  //
  // }
  //
  // static generateWalkTime(lat, lon, units, values) {
  //
  // }
  /*
   * _generateRing - creates an array of arrays of lon,lat array coordinates that
   * define a circle around the given latitude, longitude at a given radius.
   *
   * Example:  [ [lon1,lat1], [lon2,lat2] ]
   *
   * 'units' - 'miles' or 'kilometers'
   * 'radius' - radius of circle in the 'units'
   */
  static _generateRing(lat, lon, units, radius) {
    if (!lat || !lon || (units != 'miles' && units != 'kilometers') || radius == undefined) {
      _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.L.show('%e', 'GeometryUtil Error: _generateRing invalid args=', lat, lon, units, radius);
    }
    var result = [];
    function fmod(X, Y) {
      return X % Y;
    }
    function toRad(n) {
      return n * Math.PI / 180;
    }
    function toDeg(n) {
      return n * 180 / Math.PI;
    }
    const earthRadius = 6371000; // meters
    var radInMeters = (units == 'miles') ? radius * 1609.344 : radius * 1000;
    var rLat = toRad(lat);
    var rLon = toRad(lon);
    var d_rad = radInMeters / earthRadius;
    for (let i = 0; i <= 360; i += 4) {
      var radial = toRad(i);
      var lat_rad = Math.asin(Math.sin(rLat) * Math.cos(d_rad) + Math.cos(rLat) * Math.sin(d_rad) * Math.cos(radial));
      var dlon_rad = Math.atan2(Math.sin(radial) * Math.sin(d_rad) * Math.cos(rLat), Math.cos(d_rad) - Math.sin(rLat) * Math.sin(lat_rad));
      var lon_rad = fmod((rLon + dlon_rad + Math.PI), 2 * Math.PI) - Math.PI;
      let coord = [];
      coord.push(toDeg(lon_rad));
      coord.push(toDeg(lat_rad));
      result.push(coord);
    }
    return result;
  }
}

/** InfographicCard
 *
 *  This class provides support for displaying an infographic inside
 *  an iframe element.
 */
class InfographicCard {
  constructor(username, token, env, options) {
    this.geoenrichmentUrl = '';
    this.portalUrl = '';
    this.portalOnlineGEProxy = false;
    this.langCode = 'en-us'; // [OPTIONAL] default language (default is en-us)
    this.sourceCountry = 'US'; // [OPTIONAL] default country code (default is US)
    this.bufferType = 'ring';
    this.bufferUnits = 'miles';
    this.bufferSizes = [1, 3, 5];
    DebugLog.showDebugConsoleLogs = true;
    this.username = username;
    this.token = token;
    this.environment = env;
    this._idPrefix = 'ba-infographic-frame-';
    const fid = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId(this._idPrefix);
    this._iFrame = { id: fid.id, container: null, instance: null };
    this.setOptions(options);
  }
  setShadowRoot(root) {
    this._containerShadowRoot = root;
  }
  /**
   * resetOptions - returns all options to their defaults
   */
  resetOptions() {
    this.bufferType = 'ring';
    this.bufferUnits = 'miles';
    this.bufferSizes = [1, 3, 5];
    this.viewMode = 'auto'; // view mode [full, stack, slides, stack-all]
    // report
    this.reportShowHeader = true; // infographic report header display on/off
    this.reportHeaderButtonPrint = true; // show print button in header on/off
    this.reportHeaderButtonZoomLevel = true; // show zoom level button in header on/off
    this.reportHeaderButtonFullscreen = true; // show Fullscreen button in header on/off
    // export
    this.reportHeaderButtonExcel = true; // show Excel button in header on/off
    this.reportHeaderButtonImage = true; // show image button in header on/off
    this.reportHeaderButtonPdf = true; // show PDF button in header on/off
    this.reportHeaderButtonDynHtml = true; // show Dynamic HTML button in header on/off
    // style
    this.reportColorBackground = '#fff'; // infographic background color
    this.reportColorHeader = 'blue'; // infographic header color
    this.reportColorHeaderText = '#fff'; // infographic header text color
    // map
    this.runReportOnClick = true; // Boolean - runs new report on map click
    this.showSearch = true; // Boolean - shows BA map search
  }
  /** setOptions
   *    Sets one or more config and display options.  Only the options that are
   *    found in the options argument get changed by default.   If the 'reset'
   *    flag is set 'true' then all the options will be reset back to their
   *    defaults before setting values found in 'options'.
   *
   * @param options   JSON string with only the options to be changed
   * @param reset     boolean, reset options to default before applying 'options'
   */
  setOptions(options, reset) {
    if (typeof options == undefined || options == null || !_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(options))
      return false;
    try {
      if (reset)
        this.resetOptions();
      const opt = JSON.parse(options);
      if (!opt || opt.length <= 0)
        return false;
      // console.log('%c BAC InfographicCard setOptions', 'color:blue;font-size:9pt;', opt)
      if (_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(opt.bufferType) && ['ring', 'drivetime', 'walktime'].includes(opt.bufferType))
        this.bufferType = opt.bufferType;
      if (_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(opt.bufferUnits) && ['miles', 'kilometers', 'minutes'].includes(opt.bufferUnits))
        this.bufferUnits = opt.bufferUnits;
      if (opt.bufferSizes && opt.bufferSizes.length > 0 && opt.bufferSizes.length <= 3)
        this.bufferSizes = opt.bufferSizes;
      if (_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(opt.viewMode) && ['full', 'stack', 'slides', 'stack-all'].includes(opt.viewMode))
        this.viewMode = opt.viewMode;
      if (opt.report) {
        if (opt.report.showHeader != typeof undefined)
          this.reportShowHeader = opt.report.showHeader;
        if (opt.report.showZoomLevel != typeof undefined)
          this.reportHeaderButtonZoomLevel = opt.report.showZoomLevel;
        if (opt.report.showFullscreen != typeof undefined)
          this.reportHeaderButtonFullscreen = opt.report.showFullscreen;
      }
      if (opt.export) {
        if (opt.export.excel != typeof undefined)
          this.reportHeaderButtonExcel = opt.export.excel;
        if (opt.export.image != typeof undefined)
          this.reportHeaderButtonImage = opt.export.image;
        if (opt.export.pdf != typeof undefined)
          this.reportHeaderButtonPdf = opt.export.pdf;
        if (opt.report.print != typeof undefined)
          this.reportHeaderButtonPrint = opt.export.print;
        if (opt.export.dynamicHtml != typeof undefined)
          this.reportHeaderButtonDynHtml = opt.export.dynamicHtml;
      }
      if (opt.style) {
        if (opt.style.igBackgroundColor !== undefined) {
          this.reportColorBackground = opt.style.igBackgroundColor;
        }
        else if (opt.style.backgroundColor !== undefined) {
          this.reportColorBackground = opt.style.backgroundColor;
        }
        if (opt.style.headerColor != typeof undefined)
          this.reportColorHeader = opt.style.headerColor;
        if (opt.style.headerTextColor != typeof undefined)
          this.reportColorHeaderText = opt.style.headerTextColor;
      }
      if (opt.map) {
        if (opt.map.runReportOnClick != typeof undefined)
          this.runReportOnClick = opt.map.runReportOnClick;
        if (opt.map.showSearch != typeof undefined)
          this.showSearch = opt.map.showSearch;
      }
      return true;
    }
    catch (ex) {
      _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.L.show('%e', 'InfographicCard error: ', ex);
    }
    return false;
  }
  // generate infographic display options
  _createInfographicPlayerStyleOptions() {
    let arr1 = [];
    let arr2 = [];
    let arr3 = [];
    arr1.push('"showCloseButton":false');
    if (this.reportShowHeader != undefined && this.reportShowHeader == false)
      arr1.push('"showHeader":false');
    if (this.viewMode != undefined) {
      const modes = {
        full: 'full-pages',
        stack: 'panels-in-stack',
        slides: 'panels-in-slides',
        'stack-all': 'panels-in-stack-all'
      };
      let m = modes[this.viewMode];
      if (m)
        arr1.push('"viewMode":"' + m + '","resizeMode":"auto"');
    }
    if (this.reportHeaderButtonFullscreen)
      arr1.push('"showFullscreenButton": true');
    if (this.reportHeaderButtonZoomLevel)
      arr1.push('"disableZoom": true');
    if (this.reportHeaderButtonExcel)
      arr2.push('"excel": true');
    if (this.reportHeaderButtonImage)
      arr2.push('"image": true');
    if (this.reportHeaderButtonPdf)
      arr2.push('"pdf": true');
    if (this.reportHeaderButtonPrint)
      arr2.push('"print": true');
    if (this.reportHeaderButtonDynHtml)
      arr2.push('"dynamicHtml": true');
    if (this.reportColorBackground)
      arr3.push('"background":"' + this.reportColorBackground + '"');
    if (this.reportColorHeader)
      arr3.push('"headerBackground":"' + this.reportColorHeader + '"');
    if (this.reportColorHeaderText)
      arr3.push('"headerText":"' + this.reportColorHeaderText + '"');
    if (arr2.length > 0)
      arr1.push('"exportOptions": {' + arr2.toString() + '}');
    if (arr3.length > 0)
      arr1.push('"theme": {' + arr3.toString() + '}');
    return arr1.toString();
  }
  _validateSetup() {
    if (!_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(this.environment)) {
      return false;
    }
    if (!_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(this.token)) {
      DebugLog.log('InfographicCard', 'invalid token');
      return false;
    }
    if (!_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(this.username)) {
      DebugLog.log('InfographicCard', 'invalid username');
      return false;
    }
    if (!_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(this.reportId)) {
      DebugLog.log('InfographicCard', 'invalid report ID');
      return false;
    }
    if (!this.reportLocation) {
      if (!this.reportGeometry && !this.reportGeography) {
        DebugLog.log('InfographicCard', 'invalid location, geometry or geography');
        return false;
      }
    }
    return true;
  }
  _checkBuffersAssignDefaults() {
    if (typeof this.bufferType != undefined && typeof this.bufferUnits != undefined && typeof this.bufferSizes != undefined) {
      if (!isNaN(this.bufferSizes[0])) {
        return;
      }
    }
    if (typeof this.bufferType == undefined) {
      this.bufferType = 'ring'; // default
    }
    if (typeof this.bufferUnits == undefined) {
      this.bufferUnits = 'miles'; // default
    }
    if (typeof this.bufferSizes == undefined || isNaN(this.bufferSizes[0])) {
      // use default
      this.bufferSizes = [1];
    }
  }
  /** regenerateContent
   *    Rebuilds the infographic Card using current settings
   *
   * @param suggested   boolean, if true = will NOT render unless infographic has
   *                    already been rendered before
   */
  async regenerateContent(suggested) {
    const self = this;
    try {
      if (!suggested || (self._iFrame.container && self._iFrame.instance)) {
        if (self._iFrame.container) {
          _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.U.removeChildren(self._iFrame.container);
        }
        self._iFrame.instance = undefined;
        // Run report with current parameters
        await self.loadInfographic(self._iFrame.id, self._iFrame.container, self.reportLocation, self.reportGeometry, self.reportId, self.reportGeography);
      }
    }
    catch (ex) {
      _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.L.show('%e', 'InfographicCard: regenerateContent', ex);
    }
  }
  _validateReportGeometry(data) {
    if (data && data.length > 0) {
      for (let ii = 0; ii < data.length; ii++) {
        let r = data[ii];
        if (!r
          || !_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(r.transport)
          || !r.latitude
          || !r.longitude
          || !r.value
          || !_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(r.units)
          || !r.rings)
          return false;
      }
      return true;
    }
    return false;
  }
  /** _getReportGeometryAnalysisAreas
   *
   *  Take the reportGeometry JS object and generates geometry json for
   *  Drivetimes, Walktimes, or Rings
   */
  async _getReportGeometryAnalysisAreas() {
    let json = '';
    if (this.reportGeometry) {
      if (this.reportGeometry.type && this.reportGeometry.type == 'polygon') {
        json = GeometryUtil.getAnalysisAreasFromPolygon(this.reportGeometry, this.reportLocationName, this.reportLocationAttributes);
      }
      else {
        if (this.bufferType == 'drivetime' || this.bufferType == 'walktime') {
          if (this._validateReportGeometry(this.reportGeometry)) {
            json = GeometryUtil.getAnalysisAreasFromRings(this.reportGeometry, this.reportLocationName, this.reportLocationAttributes);
          }
          else
            DebugLog.log('_getReportGeometryAnalysisAreas', 'reportGeometry is invalid', this.reportGeometry);
        }
      }
    }
    else if (this.bufferType == 'drivetime' || this.bufferType == 'walktime') {
      //
      // generate the DT/WT buffers using GE enrich request
      TransportUtil.setToken(this.username, this.token);
      let obj = await TransportUtil.getBuffers(this.bufferType, this.sourceCountry, this.bufferUnits, this.bufferSizes, this.reportLocation.lon, this.reportLocation.lat);
      json = GeometryUtil.getAnalysisAreasFromEnrichBuffers(obj, this.reportLocationName, this.reportLocationAttributes);
    }
    return json;
  }
  _checkBuffers() {
    if (typeof this.bufferType != undefined && typeof this.bufferUnits != undefined && typeof this.bufferSizes != undefined) {
      if (!isNaN(this.bufferSizes[0])) {
        return;
      }
    }
    if (typeof this.bufferType == undefined) {
      this.bufferType = 'ring'; // default
    }
    if (typeof this.bufferUnits == undefined) {
      this.bufferUnits = 'miles'; // default
    }
    if (typeof this.bufferSizes == undefined || isNaN(this.bufferSizes[0])) {
      // use default
      this.bufferSizes = [1];
    }
  }
  generateNotReadyHtml() {
    let nrId = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId('notReadyDiv');
    return '<div id="' + nrId + '" class="notReadyOuter" > \
          <svg class="notReadySvg" preserveAspectRatio="xMidYMid meet" width="66" height="58"> \
            <g transform="matrix(0.65909094 0 0 0.65909094 0.09090962 -0)"> \
              <g> \
                <path \
                  d="M48.445312 0.15625C 48.125 0.234375 47.5625 0.445312 47.195312 0.632812C 46.648438 0.90625 46.375 1.117188 45.734375 1.757812C 45.257812 2.226562 44.765625 2.804688 44.507812 3.203125C 43.84375 4.234375 39.1875 12.441406 21.367188 43.960938C 15.171875 54.91797 7.976562 67.65625 5.375 72.25391C 2.773438 76.85547 0.554688 80.83203 0.445312 81.08984C -0.171875 82.55469 -0.117188 84.171875 0.59375 85.46094C 0.710938 85.67969 1.09375 86.13281 1.4375 86.47656C 2.148438 87.17969 2.820312 87.5625 3.828125 87.84375L3.828125 87.84375L4.421875 88L50.351562 87.984375L96.28906 87.96094L96.921875 87.75C 99.75781 86.78125 100.78125 83.85156 99.296875 80.88672C 99.13281 80.55078 92.27344 68.53906 84.05469 54.183594C 75.83594 39.835938 66.02344 22.695312 62.25 16.097656C 58.46875 9.503906 55.148438 3.75 54.859375 3.320312C 53.9375 1.9375 52.765625 0.890625 51.585938 0.40625C 50.609375 0 49.460938 -0.09375 48.445312 0.15625zM61 26.804688C 67.19531 37.61328 76.77344 54.339844 82.28125 63.96875L82.28125 63.96875L92.30469 81.47266L71.11719 81.49609C 59.460938 81.50391 40.382812 81.50391 28.71875 81.49609L28.71875 81.49609L7.507812 81.47266L20.523438 58.45703C 45.429688 14.402344 49.625 7.011719 49.695312 7.097656C 49.726562 7.128906 54.8125 15.996094 61 26.804688z" \
                  stroke="none" \
                  fill="#D4D7DD" \
                  fill-rule="nonzero" \
                /> \
                <path \
                  d="M49.140625 26.460938C 49.03125 26.484375 48.664062 26.570312 48.328125 26.65625C 45.28125 27.421875 42.8125 30.363281 42.8125 33.19922C 42.8125 33.558594 42.984375 35.183594 43.203125 36.80078C 43.414062 38.41797 44.085938 43.5 44.6875 48.101562C 46.257812 60.097656 46.242188 59.95703 46.375 60.45703C 46.703125 61.75 47.476562 62.78125 48.492188 63.28125C 49.015625 63.539062 49.164062 63.578125 49.804688 63.601562C 50.992188 63.65625 51.726562 63.367188 52.523438 62.539062C 53.296875 61.71875 53.648438 60.789062 53.898438 58.910156C 53.984375 58.253906 54.375 55.30078 54.765625 52.339844C 55.148438 49.382812 55.789062 44.554688 56.171875 41.59375C 56.5625 38.640625 56.953125 35.683594 57.039062 35.027344C 57.226562 33.60547 57.234375 32.64453 57.070312 32.003906C 56.429688 29.480469 54.257812 27.320312 51.65625 26.640625C 51.070312 26.484375 49.578125 26.382812 49.140625 26.460938z" \
                  stroke="none" \
                  fill="#D4D7DD" \
                  fill-rule="nonzero" \
                /> \
                <path \
                  d="M49.390625 66.59375C 46.695312 66.9375 44.75 69.49219 45.078125 72.26953C 45.234375 73.56641 45.75 74.62109 46.671875 75.47266C 47.5625 76.30859 48.523438 76.72266 49.726562 76.80078C 51.1875 76.88672 52.351562 76.43359 53.4375 75.33984C 54.484375 74.29297 54.9375 73.20703 54.945312 71.70703C 54.953125 70.796875 54.84375 70.27344 54.492188 69.515625C 53.554688 67.47656 51.53125 66.32031 49.390625 66.59375z" \
                  stroke="none" \
                  fill="#D4D7DD" \
                  fill-rule="nonzero" \
                /> \
              </g> \
            </g> \
          </svg> \
        </div>';
  }
  async loadInfographic(id, container, location, geometry, reportId, geography) {
    const self = this;
    if (!id || !container || (!location && !geometry && !geography) || !reportId)
      throw ('infographicCard error: invalid args loading infographic');
    self._iFrame = { id: id, container: container, instance: null };
    self.reportGeometry = geometry;
    self.reportId = reportId;
    self.reportGeography = geography;
    self.reportLocation = location;
    _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.U.removeChildren(container);
    // create new iframe
    self._iFrame.container.innerHTML = '<iframe id="' + self._iFrame.id + '" class="arcgisInfographicFrame"></iframe>';
    // continue after dom settles
    const _continueLoading = async () => {
      self._iFrame.instance = self._containerShadowRoot.querySelector(_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.U.fixId(this._iFrame.id));
      if (!self._iFrame.instance) ;
      else {
        try {
          // message the infographic iframe with URL and params when loaded
          //
          // Options
          const env = _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.E.getEnvironment();
          // Environments env should always be correct
          // console.assert(env === self.environment)
          self.environment = env;
          setEnvironment(self.environment);
          const playerPageUrl = await InfographicsHelper._getInfographicsPlayerUrl();
          // default environment is 'www'
          const subdomain = self.environment === 'dev' ? 'devext' : self.environment === 'qa' ? 'qaext' : 'www';
          let lat = (self.reportLocation) ? self.reportLocation.lat : 0;
          let lon = (self.reportLocation) ? self.reportLocation.lon : 0;
          if (!self.reportGeometry && (!self.reportLocation || !lat || !lon) && !self.reportGeography) {
            _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.L.show('%e', 'InfographicCard error: invalid location, geometry or geography', self.reportLocation, self.reportGeometry, self.reportGeography);
          }
          else {
            self.langCode = self.langCode || 'en-us';
            self.sourceCountry = self.sourceCountry || 'US';
            const defaultHierarchy = await _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.G.getGEDefaultHierarchy(self.sourceCountry, self.portalOnlineGEProxy ? self.token : "");
            // Need to pass the second parameter in langCode as uppercase to ReportPlayer to work (e.g. pt-BR, not pt-br)
            const upperLangCode = self.langCode.length === 5 ? self.langCode.substring(0, 3) + self.langCode.substring(3).toUpperCase() : self.langCode;
            let params = '{ \
                "userId":"' + self.username + '", \
                "token":"' + self.token + '", \
                "expires":"' + (Math.floor(Date.now() + 86400000.5)).toString() + '", \
                "componentId":"' + self._iFrame.id + '", \
                "reportID":"' + self.reportId + '", \
                "countryID":"' + self.sourceCountry + '", \
                "langCode":"' + upperLangCode + '", \
                "allLanguages":true, \
                "hierarchy":"' + defaultHierarchy + '", ';
            if (self.geoenrichmentUrl) {
              params += ' "geoenrichmentUrl":"' + self.geoenrichmentUrl + '", ';
            }
            if (self.portalUrl) {
              params += ' "server":"' + self.portalUrl + '", ';
            }
            else {
              params += ' "server":"https://' + subdomain + '.arcgis.com" ,';
            }
            if (self.portalOnlineGEProxy) {
              params += ' "portalOnlineGEProxy":true ,';
            }
            let analysisAreas;
            // Use geography if it is set
            if (self.reportGeography) {
              analysisAreas = ' "analysisAreas": [{"locationName":"' + self.reportLocationName + '", "geographies":[' + JSON.stringify(self.reportGeography) + ']}] ';
            }
            else {
              analysisAreas = await self._getReportGeometryAnalysisAreas();
            }
            if (!analysisAreas) {
              // Infographic will be for a location with Rings
              if (self.bufferUnits == 'minutes') {
                // invalid units for rings
                self.bufferUnits = self.bufferUnits = 'miles'; // default units for rings
              }
              let areas = GeometryUtil.getRings(lat, lon, self.bufferUnits, self.bufferSizes, this.reportLocationName, this.reportLocationAttributes);
              params += ' "analysisAreas": ' + JSON.stringify(areas);
            }
            else {
              params += analysisAreas;
            }
            let options = self._createInfographicPlayerStyleOptions();
            if (options && options.length > 0) {
              params += ',' + options;
            }
            params += ' }';
            // After the iframe loads, we message it with the instructions about
            // the infographic that will be generated
            //
            // @ts-ignore
            self._iFrame.instance.onload = function () {
              function _delay() {
                // @ts-ignore
                if (self._iFrame && self._iFrame.instance && self._iFrame.instance.contentWindow) {
                  // console.log("%c infographicCard: iframe onload event: passing params to player => ",'color:blue;font-size:10pt', JSON.parse(params))
                  // @ts-ignore
                  self._iFrame.instance.contentWindow.postMessage({
                    type: 'infographic_parameters',
                    infographicParameters: params
                  }, playerPageUrl);
                }
              }
              setTimeout(_delay, 500);
            };
            // instantiate infographic player (report will display after loaded)
            // @ts-ignore
            self._iFrame.instance.src = playerPageUrl;
          }
        }
        catch (ex) {
          _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.L.show('%e', 'InfographicCard error', ex);
        }
      }
    };
    setTimeout(_continueLoading, 0);
  }
  // /**
  //  * Renders the infographic iframe OR the warning image
  //  *
  //  * Actual infographic display is done in the 'loadInfographic' function
  //  */
  // render() {
  //   let _showWarning = false
  //   this._checkBuffers()
  //   if(!this._validateSetup()) {
  //     DebugLog.log('InfographicCard', ' error - no location or boundary to display')
  //     _showWarning = true
  //   }
  //   if(!_showWarning && !this.reportLocation && !this.reportGeometry) {
  //     DebugLog.log('InfographicCard', ' error - no location or boundary to display')
  //     _showWarning = true
  //   }
  //   if(!_showWarning && (!this.username || !this.token)) {
  //     DebugLog.log('InfographicCard', ' render error - invalid username/token')
  //     _showWarning = true
  //   }
  //
  //   if(!_showWarning) {
  //     this._checkBuffersAssignDefaults()
  //     setToken(this.username, this.token)
  //     return '<iframe id="' + this._iFrame.id + '" class="arcgisInfographicFrame"></iframe>'
  //   } else {
  //     return this.generateNotReadyHtml()
  //   }
  // }
  /* Client interface */
  updateInfographic() {
    // assuming all properties have been updated already.
    this.regenerateContent();
  }
  /**  setReportLocation
   *      Updates the report location (lat/lon) for the report. The also
   *      forces a refresh
   *
   * @param loc see LocationType
   */
  setReportLocation(loc) {
    if (loc && loc.lat && loc.lon) {
      this.reportLocation = loc;
      this.regenerateContent(true);
    }
  }
  /**  setReportGeometry
   *      Updates the report geometry for the report and
   *      forces a refresh
   *
   * @param loc geometry object
   */
  setReportGeometry(geometry) {
    if (geometry) {
      this.reportGeometry = geometry;
      this.regenerateContent(true);
    }
  }
  /**  setReportGeography
   *      Updates the report geography for the report and
   *      forces a refresh
   *
   * @param loc geography object
   */
  setReportGeography(geography) {
    if (geography) {
      this.reportGeography = geography;
      this.regenerateContent(true);
    }
  }
  /** generateBuffers
   *    Generates drivetime or walktime buffers using the InfographicCard properties
   *
   *    Result: geometry is saved into this InfographicCard's reportGeometry
   *    Return: object = {
   *      success:boolean,
   *      error:string
   *    }
   */
  async generateBuffers() {
    // Validation
    if (!this.sourceCountry)
      return { success: false, error: 'InfographicCard sourceCountry not valid' };
    if (!this.bufferType || (this.bufferType != 'drivetime' && this.bufferType != 'walktime'))
      return {
        success: false,
        error: '[' + this.bufferType + '] invalid bufferType (must be "drivetime" or "walktime")'
      };
    if (!this.bufferSizes || this.bufferSizes.length <= 0)
      return { success: false, error: 'missing bufferSizes' };
    // let bufferValues = this.bufferSizes.toString();
    if (!this.bufferUnits || (this.bufferUnits != 'miles' && this.bufferUnits != 'kilometers' && this.bufferUnits != 'minutes'))
      return { error: 'invalid units' };
    if (!this.reportLocation || !this.reportLocation.lat)
      return { error: 'invalid latitude' };
    if (!this.reportLocation || !this.reportLocation.lon)
      return { error: 'invalid latitude' };
    // GE request to generate drivetime/walktime rings
    TransportUtil.setToken(this.username, this.token);
    let resultObject;
    let lat = this.reportLocation.lat;
    let lon = this.reportLocation.lon;
    if (this.bufferType == 'drivetime') {
      resultObject = await TransportUtil.getBuffers('drivetime', this.sourceCountry, this.bufferUnits, this.bufferSizes, lon, lat);
    }
    else {
      resultObject = await TransportUtil.getBuffers('walktime', this.sourceCountry, this.bufferUnits, this.bufferSizes, lon, lat);
    }
    // update the infographic to do the drivetime/walktime polygons
    // This assignment triggers an infographic refresh
    // this._isInternalUpdate = true;
    this.reportGeometry = resultObject;
    return resultObject;
  }
}

const arcgisInfographicCss = ":host{display:block}.notReadyOuter{position:absolute;top:0;left:0;width:100%;height:100%}.notReadyDiv{position:absolute;top:calc(50% - 50px);left:calc(50% - 50px);width:100px;height:100px}.notReadySvg{position:absolute;top:calc(50% - 29px);left:calc(50% - 33px)}.arcgisInfographicFrame{position:absolute;top:0;left:0;width:100%;height:100%;border:none}";

const ArcgisInfographic = class {
  constructor(hostRef) {
    (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_2__.r)(this, hostRef);
    this._isInternalUpdate = false; // flag to prevent full property update mechanism
    this._idPrefix = 'arcgis-infographic-';
    this._hasSetEnv = false;
    this._defaultOptions = JSON.stringify({
      bufferType: 'ring',
      bufferUnits: 'miles',
      bufferSizes: '1,3,5',
      viewMode: 'auto'
    });
    // debug logging set to true
    DebugLog.showDebugConsoleLogs = true;
  }
  // ---------------------------------------------------------------------------------------------------
  // watches
  onEnvChanged() {
    this.stEnv = this.env;
    _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.E.setEnvironment(this.env);
    if (this._infographicCard)
      this._infographicCard.environment = this.env;
    this._onPropChanged();
  }
  onTokenChanged() {
    this.stToken = this.token;
    if (this._infographicCard)
      this._infographicCard.token = this.token;
    this._onPropChanged();
  }
  onUsernameChanged() {
    this.stUsername = this.username;
    if (this._infographicCard)
      this._infographicCard.username = this.username;
    this._onPropChanged();
  }
  onLocationDisplayNameChanged() {
    // this._l('locationName',this.locationName)
    this.stLocationDisplayName = this.locationName;
    if (this._infographicCard)
      this._infographicCard.reportLocationName = this.locationName;
    this._onPropChanged();
  }
  onLocationAttributesChanged() {
    // this._l('locationName',this.locationName)
    this.stLocationAttributes = this.locationAttributes ? JSON.parse(this.locationAttributes) : {};
    if (this._infographicCard)
      this._infographicCard.reportLocationAttributes = this.stLocationAttributes;
    this._onPropChanged();
  }
  onLangCodeChanged() {
    this.stLangCode = this.langCode;
    if (this._infographicCard)
      this._infographicCard.langCode = this.langCode;
    _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B._initialize(this.stLangCode);
    this._onPropChanged();
  }
  onCountryChanged() {
    this.stSourceCountry = this.sourceCountry;
    if (this._infographicCard)
      this._infographicCard.sourceCountry = this.sourceCountry;
    this._onPropChanged();
  }
  onOptionsChanged() {
    this.stOptions = this.options;
    // console.log('%c BAC arcgis-infographic options changing...', 'color:blue;font-size:9pt;', this.options)
    if (this._infographicCard)
      this._infographicCard.setOptions(this.options, true);
    this._onPropChanged();
  }
  onReportIdChanged() {
    this.stReportId = this.reportId;
    if (this._infographicCard)
      this._infographicCard.reportId = this.reportId;
    this._onPropChanged();
  }
  onThemeChanged() {
    this.stTheme = JSON.parse(this.theme);
    this._onPropChanged();
  }
  onReportLocationChanged() {
    try {
      this.stReportLocation = this.reportLocation;
      this._onPropChanged();
    }
    catch (ex) {
      console.log(ex);
    }
  }
  onReportGeometryChanged() {
    this.stReportGeometry = this.reportgeometry;
    // if(!this._isInternalUpdate) {
    //   if(this._infographicCard) {
    //     if(Utils.hasText(this.reportgeometry))
    //       this._infographicCard.setReportGeometry(JSON.parse(this.reportgeometry))
    //   }
    this._onPropChanged();
    // } else this._isInternalUpdate = false //reset flag
  }
  onReportGeographyChanged() {
    this.stReportGeography = this.reportgeography;
    this._onPropChanged();
  }
  // Update the Infographic Report when the arcgis-report-list changes
  reportSelectedEventHandler(e) {
    let reportId = e.detail?.value;
    if (reportId) {
      this.stReportId = reportId;
      // destroy iframe
      let frame = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.A.queryElementById(this._iframeId);
      if (frame && frame.parentNode) {
        frame.parentNode.removeChild(frame);
      }
      this.componentDidLoad();
    }
  }
  // _l(...args) {
  //   console.log('%carcgis-infographic:', 'color:yellow', args)
  // }
  // Methods -------------------------------------------
  //
  /**
   * generateBuffers
   *
   * This function passes in values needed to do either a drivetime or walktime buffers
   * report.  The values passed in update the Props in the component, async returns the
   * rings, and generates a new infographic using the drivetime or walktime values.
   *
   * @param bufferType = 'walktime' or 'drivetime'
   * @param values     = string representing drivetime distance or time [example:"1,3,5"]
   * @param units      = "miles", "kilometers", or "minutes"
   * @param latitude   = map location
   * @param longitude
   *
   * @return = [
   *  { value: <bufferValue>, units: <bufferUnits>, rings: <geometry rings> },
   *  { value: <bufferValue>, units: <bufferUnits>, rings: <geometry rings> },
   *  <up to 3 results depending on length of values>
   * ]
   */
  async generateBuffers(bufferType, values, units, latitude, longitude) {
    const card = this._infographicCard;
    try {
      if (!card)
        return null;
      // bufferType
      if (_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(bufferType) && ['ring', 'drivetime', 'walktime'].includes(bufferType)) { // @ts-ignore
        card.bufferType = bufferType;
      }
      // values
      if (values && values.trim().length > 0) {
        let sizes = [];
        let arr = values.split(',');
        for (let ii = 0; ii < arr.length; ii++) {
          if (ii < 3 && arr[ii] && arr[ii].trim().length > 0) {
            sizes.push(parseFloat(arr[ii].trim()));
          }
        }
        if (sizes.length > 0)
          card.bufferSizes = sizes;
      }
      // units
      if (_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(units) && ['miles', 'kilometers', 'minutes'].includes(bufferType)) {
        // @ts-ignore
        card.bufferUnits = units;
      }
      // latitude, longitude
      if (_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(latitude) && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(longitude)) {
        let lat = parseFloat(latitude);
        let lon = parseFloat(longitude);
        card.reportLocation = { lat: lat, lon: lon };
        this.reportLocation = longitude + ', ' + latitude;
      }
      this._isInternalUpdate = true;
      return (card.generateBuffers());
    }
    catch (ex) {
      DebugLog.log('arcgis-infographic: generate buffers error: ', ex);
      return { error: 'exception: ' + ex.toString() };
    }
  }
  async onPropChange(callback, context) {
    this._onChangeCallback = { fn: callback, ctx: context };
  }
  async updateInfographic(name, reportId, location, geometry, geography) {
    if (name && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(name)) {
      this.locationName = name;
      this.stLocationDisplayName = name;
    }
    if (reportId && _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(reportId)) {
      this.reportId = reportId;
      this.stReportId = reportId;
    }
    if (location) {
      this.reportLocation = location;
      this.stReportLocation = location;
    }
    if (geometry) {
      this.reportgeometry = geometry;
      this.stReportGeometry = geometry;
    }
    if (geography) {
      this.reportgeography = geography;
      this.stReportGeography = geography;
    }
  }
  /**
   * Filters out multiple rapid events of the same type.  The callback
   * function will be called if no new events have happened during the
   * 'wait' time.
   * @param callback - your function to call when the events have settled
   * @param wait     - milliseconds delay (ex: 250)
   */
  _debounce2(callback, wait) {
    const self = this;
    const delayedCall = function () {
      self._debounceTimer = null;
      callback.apply(self);
    };
    // everytime _debounce2 is called we kill the previous timer
    if (self._debounceTimer)
      clearTimeout(self._debounceTimer);
    self._debounceTimer = setTimeout(delayedCall, wait);
  }
  _onFilteredPropChanged() {
    if (this._onChangeCallback)
      this._onChangeCallback.fn(this._onChangeCallback.ctx, this.reportLocation);
    else {
      console.log('WARN- arcgis-infographic component: property sync callback not found');
    }
    this.attemptInfographicRender();
  }
  _onPropChanged() {
    this._debounce2(this._onFilteredPropChanged, 250);
  }
  _debounce(func, wait, immediate) {
    let timeout;
    const self = this;
    return function () {
      let context = self, args = arguments;
      let later = function () {
        timeout = null;
        if (!immediate)
          func.apply(context, args);
      };
      let callNow = immediate && !timeout;
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
      if (callNow)
        func.apply(context, args);
    };
  }
  // Stencil lifecycle methods
  //
  componentWillLoad() {
    // console.log('%c BAC arcgis-infographic willLoad', 'color:blue;font-size:9pt;', this.options)
    // console.log('%c BAC arcgis-infographic willLoad creds', 'color:red;font-size:9pt;', this.username, this.token)
    try {
      // Each component has the ID with a suffix counter number that
      // is managed by the static instance of this component.  The
      // result is that we support multiple instances of the component
      // on any given webpage.
      if (!this._instanceId)
        this._instanceId = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId(this._idPrefix).id;
      if (!this._containerId)
        this._containerId = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId('componentOuter').id;
      if (!this._iframeId)
        this._iframeId = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId('igFrame').id;
      // initialize state variables here without causing another render()
      this.stEnv = this.env;
      this.stToken = this.token;
      this.stUsername = this.username;
      this.stLocationDisplayName = this.locationName;
      try {
        this.stLocationAttributes = JSON.parse(this.locationAttributes);
      }
      catch (error) {
        this.stLocationAttributes = {};
      }
      this.stLangCode = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(this.langCode) ? this.langCode : 'en-us';
      this.stSourceCountry = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(this.sourceCountry) ? this.sourceCountry : 'US';
      this.stReportId = this.reportId;
      this.stTheme = null;
      if (!this.options || !_ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(this.options)) {
        this.options = this._defaultOptions;
      }
      this.stOptions = JSON.parse(this.options);
      if (!this._hasSetEnv && this.env) {
        this._hasSetEnv = true;
        this.stEnv = this.env;
        _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.E.setEnvironment(this.env);
      }
      _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.B._initialize(this.stLangCode);
      // Set if GeoenrichmentUrl was optionally passed in
      if (this.geoenrichmentUrl) {
        _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.E.setGeoenrichmentUrl(this.geoenrichmentUrl);
      }
      // Set if Poratl Url was optionally passed in
      if (this.portalUrl) {
        _GEClient_f71049f8_js__WEBPACK_IMPORTED_MODULE_0__.E.setPortalUrl(this.portalUrl);
      }
      // console.log('%c BAC arcgis-infographic willLoad2', 'color:blue;font-size:9pt;', this.options)
      if (!this._infographicCard) {
        // console.log('%c BAC arcgis-infographic creating new InfographicCard', 'color:blue;font-size:9pt;')
        this._infographicCard = new InfographicCard(this.username, this.token, this.env, this.options);
        this._infographicCard.setOptions(this.options, true); //@@@@@@@@@@@@
        this._infographicCard.geoenrichmentUrl = this.geoenrichmentUrl;
        this._infographicCard.portalUrl = this.portalUrl;
        this._infographicCard.portalOnlineGEProxy = this.portalOnlineGEProxy;
        this._infographicCard.reportLocationName = this.stLocationDisplayName;
        this._infographicCard.reportLocationAttributes = this.stLocationAttributes;
        this._infographicCard.sourceCountry = this.stSourceCountry;
        this._infographicCard.langCode = this.stLangCode;
        this._infographicCard.setShadowRoot(this.el.shadowRoot);
      }
    }
    catch (ex) {
      console.log(ex);
    }
  }
  async attemptInfographicRender() {
    let container = _ElementIds_a2c40592_js__WEBPACK_IMPORTED_MODULE_1__.A.queryElementById.call(this, this._containerId);
    let location, geometry, geography, reportId;
    if (this._infographicCard && this.options)
      this._infographicCard.setOptions(this.options, true);
    // console.log('%c BAC arcgis-infographic attemptInfographicRender', 'color:blue;font-size:9pt;', this._infographicCard)
    // console.log('%c BAC arcgis-infographic attemptRender creds', 'color:red;font-size:9pt;', this.username, this.token)
    // Sync InfographicCard properties
    if (this.reportLocation) {
      let geo = this.reportLocation.split(',');
      if (geo && geo.length == 2) {
        let lat = parseFloat(geo[1]);
        let lon = parseFloat(geo[0]);
        location = { lat: lat, lon: lon };
        this._infographicCard.setReportLocation(location);
      }
    }
    if (this.reportgeometry) {
      geometry = JSON.parse(this.reportgeometry);
      this._infographicCard.setReportGeometry(geometry);
    }
    if (this.reportgeography) {
      geography = JSON.parse(this.reportgeography);
      this._infographicCard.setReportGeography(geography);
    }
    if (this.reportId) {
      reportId = this.reportId;
      this._infographicCard.reportId = this.reportId;
    }
    // validate required data to draw an infographic
    if (container && (location || geometry || geography) && reportId) {
      await this._infographicCard.loadInfographic(this._iframeId, container, location, geometry, reportId, geography);
    }
  }
  // Main component screen generation
  componentDidLoad() {
    this.attemptInfographicRender();
  }
  render() {
    // this._l(' render() running....')
    // This initially renders the component container only and
    // will update the contents when the Stencil life cycle function
    // componentDidLoad() runs.  This is because the card render()
    // function is async, so we load it then on 'componentDidLoad' we
    // assign the iframe 'src' and do a 'postmessage' when the
    // iframe is finally ready to accept options.
    //
    return (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_2__.h)("div", { id: this._containerId, class: 'componentOuter' });
  }
  get el() { return (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_2__.g)(this); }
  static get watchers() { return {
    "env": ["onEnvChanged"],
    "token": ["onTokenChanged"],
    "username": ["onUsernameChanged"],
    "locationName": ["onLocationDisplayNameChanged"],
    "locationAttributes": ["onLocationAttributesChanged"],
    "langCode": ["onLangCodeChanged"],
    "sourceCountry": ["onCountryChanged"],
    "options": ["onOptionsChanged"],
    "reportId": ["onReportIdChanged"],
    "theme": ["onThemeChanged"],
    "reportLocation": ["onReportLocationChanged"],
    "reportgeometry": ["onReportGeometryChanged"],
    "reportgeography": ["onReportGeographyChanged"]
  }; }
};
ArcgisInfographic.style = arcgisInfographicCss;



//# sourceMappingURL=arcgis-infographic-3ef1a00f.js.map

/***/ }),

/***/ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic.entry.js":
/*!*********************************************************************************************************************************************************!*\
  !*** ./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic.entry.js ***!
  \*********************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_infographic: () => (/* reexport safe */ _arcgis_infographic_3ef1a00f_js__WEBPACK_IMPORTED_MODULE_0__.A)
/* harmony export */ });
/* harmony import */ var _arcgis_infographic_3ef1a00f_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./arcgis-infographic-3ef1a00f.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-3ef1a00f.js");





//# sourceMappingURL=arcgis-infographic.entry.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYmEtaW5mb2dyYXBoaWNfbm9kZV9tb2R1bGVzX2FyY2dpc19idXNpbmVzcy1hbmFseXN0LWNvbXBvbmVudHNfZGlzLWIwODIyMy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQWdGO0FBQ3lDO0FBQ047O0FBRW5IO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsa0JBQWtCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sb0RBQWM7QUFDcEIsYUFBYSxzREFBaUI7QUFDOUI7QUFDQTtBQUNBLGFBQWEsc0RBQWlCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsTUFBTSxzREFBSTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLG9EQUFZO0FBQ3RDLDZCQUE2QixnQkFBZ0I7QUFDN0M7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG9EQUFhO0FBQzdCLGlCQUFpQixvREFBYTtBQUM5Qix1QkFBdUIsb0RBQWE7QUFDcEM7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLG9EQUFjO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBHQUEwRztBQUMxRztBQUNBLElBQUksb0RBQWE7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixvREFBUTtBQUNuQztBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsaUJBQWlCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsaUNBQWlDO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGtEQUFrRDtBQUM3RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sc0RBQUk7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQiwwQkFBMEI7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixtQ0FBbUM7QUFD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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0Isc0RBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0EscUZBQXFGLGNBQWM7QUFDbkcsK0VBQStFLGNBQWM7QUFDN0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcscURBQUMsVUFBVSxnREFBZ0Q7QUFDdEU7QUFDQSxhQUFhLE9BQU8scURBQVU7QUFDOUIsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVrQzs7QUFFbEM7Ozs7Ozs7Ozs7Ozs7OztBQ3Q2RDJFO0FBQzlDO0FBQ0s7QUFDRjs7QUFFaEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2JhLWluZm9ncmFwaGljL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2J1c2luZXNzLWFuYWx5c3QtY29tcG9uZW50cy9kaXN0L3N0ZW5jaWwtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtaW5mb2dyYXBoaWMtM2VmMWEwMGYuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9iYS1pbmZvZ3JhcGhpYy9ub2RlX21vZHVsZXMvQGFyY2dpcy9idXNpbmVzcy1hbmFseXN0LWNvbXBvbmVudHMvZGlzdC9zdGVuY2lsLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLWluZm9ncmFwaGljLmVudHJ5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgaCwgZyBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC00ZTY0NzQxMS5qcyc7XG5pbXBvcnQgeyBCIGFzIEJhUmVwb3J0c0xhbmd1YWdlLCBMIGFzIExvZ3osIEUgYXMgRWxlbWVudElkcywgVSBhcyBVdGlscywgQSBhcyBBQ0xVdGlscyB9IGZyb20gJy4vRWxlbWVudElkcy1hMmM0MDU5Mi5qcyc7XG5pbXBvcnQgeyBTIGFzIFNldHRpbmdzSGVscGVyLCBFIGFzIEVudmlyb25tZW50cywgVCBhcyBUb2tlblByb3ZpZGVyLCBHIGFzIEdFQ2xpZW50IH0gZnJvbSAnLi9HRUNsaWVudC1mNzEwNDlmOC5qcyc7XG5cbmNsYXNzIERlYnVnTG9nIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuZml4Rm9yTGludCA9ICcnO1xyXG4gIH1cclxuICBzdGF0aWMgbG9nKHRpdGxlLCAuLi5saXN0KSB7XHJcbiAgICBpZiAoRGVidWdMb2cuc2hvd0RlYnVnQ29uc29sZUxvZ3MpIHtcclxuICAgICAgY29uc29sZS5sb2coJz09PT09PT0+JyArIHRpdGxlICsgJzogJyk7XHJcbiAgICAgIGlmIChsaXN0ICYmIGxpc3QubGVuZ3RoKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IGxpc3QubGVuZ3RoOyBpaSsrKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnLi4uJywgbGlzdFtpaV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5EZWJ1Z0xvZy5zaG93RGVidWdDb25zb2xlTG9ncyA9IGZhbHNlO1xuXG5mdW5jdGlvbiBzZXRFbnZpcm9ubWVudChlbnZpcm9ubWVudCkge1xyXG4gIHRyeSB7XHJcbiAgICBpZiAoZW52aXJvbm1lbnQgIT0gbnVsbCAmJiBlbnZpcm9ubWVudC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIFNldHRpbmdzSGVscGVyLnNldEVudmlyb25tZW50KGVudmlyb25tZW50KTtcclxuICAgICAgcmV0dXJuIEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ29rJyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgcmV0dXJuIEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2ludmFsaWQtZW52aXJvbm1lbnQnKTtcclxuICAgIH1cclxuICB9XHJcbiAgY2F0Y2ggKGV4KSB7XHJcbiAgICByZXR1cm4gZXg7XHJcbiAgfVxyXG59XG5cbmNsYXNzIEluZm9ncmFwaGljc0hlbHBlciB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgfVxyXG4gIHN0YXRpYyBvcGVuSW5mb2dyYXBoaWNzKGlnSXRlbUlkLCBoaWVyYXJjaHlJZCwgZ2VvbWV0cnksIGNvdW50cnlJRCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgSW5mb2dyYXBoaWNzSGVscGVyLl9nZXRJbmZvZ3JhcGhpY3NQbGF5ZXJVcmwoKS50aGVuKChwbGF5ZXJQYWdlVXJsKSA9PiB7XHJcbiAgICAgICAgSW5mb2dyYXBoaWNzSGVscGVyLl9vcGVuSW5mb2dyYXBoaWNzVGFiKHBsYXllclBhZ2VVcmwsIEluZm9ncmFwaGljc0hlbHBlci5fZ2V0SW5mb2dyYXBoaWNzUGFyYW1zKGlnSXRlbUlkLCBoaWVyYXJjaHlJZCwgZ2VvbWV0cnksIGNvdW50cnlJRCkpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIGNhdGNoIChleCkge1xyXG4gICAgICBMb2d6LnNob3coJyVlJywgJ0luZm9ncmFwaGljSGVscGVyIEVycm9yIHdoaWxlIGdldHRpbmcgcGxheWVyIFVSTDogJywgZXgpO1xyXG4gICAgfVxyXG4gIH1cclxuICBzdGF0aWMgX2dldEluZm9ncmFwaGljc1BsYXllclVybCgpIHtcclxuICAgIHJldHVybiAobmV3IFByb21pc2UoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBpZiAoSW5mb2dyYXBoaWNzSGVscGVyLl9pbmZvZ3JhcGhpY3NQbGF5ZXJQYWdlVXJsKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIHZhciBwbGF5ZXJQYWdlVXJsID0gRW52aXJvbm1lbnRzLmdldFVybCgnaW5mb2dyYXBoaWNzJyk7XHJcbiAgICAgIGZldGNoKHBsYXllclBhZ2VVcmwsIHsgbWV0aG9kOiAnSEVBRCcgfSlcclxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgcmVzcG9uc2Uub2sgPyByZXNvbHZlKHBsYXllclBhZ2VVcmwpIDogcmVqZWN0KCk7XHJcbiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICB9KTtcclxuICAgIH0pKTtcclxuICB9XHJcbiAgc3RhdGljIF9vcGVuSW5mb2dyYXBoaWNzVGFiKHBsYXllclBhZ2VVcmwsIGluZm9ncmFwaGljUGFyYW1ldGVycykge1xyXG4gICAgdmFyIHduZCA9IHdpbmRvdy5vcGVuKHBsYXllclBhZ2VVcmwsICdfYmxhbmsnKTtcclxuICAgIHZhciBvbk1lc3NhZ2UgPSBmdW5jdGlvbiAoX3duZCkge1xyXG4gICAgICB2YXIgbWVzc2FnZUhhbmRsZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB2YXIgaHJlZiA9IGV2ZW50LmRhdGEgJiYgZXZlbnQuZGF0YS5ocmVmO1xyXG4gICAgICAgIHZhciBzdGF0dXMgPSBldmVudC5kYXRhICYmIGV2ZW50LmRhdGEuc3RhdHVzO1xyXG4gICAgICAgIGlmIChocmVmID09PSBwbGF5ZXJQYWdlVXJsICYmIHN0YXR1cyA9PT0gJ3dhaXRpbmdfZm9yX2luZm9ncmFwaGljX3BhcmFtZXRlcnMnKSB7XHJcbiAgICAgICAgICBfd25kLnBvc3RNZXNzYWdlKHtcclxuICAgICAgICAgICAgdHlwZTogJ2luZm9ncmFwaGljX3BhcmFtZXRlcnMnLFxyXG4gICAgICAgICAgICBpbmZvZ3JhcGhpY1BhcmFtZXRlcnM6IGluZm9ncmFwaGljUGFyYW1ldGVyc1xyXG4gICAgICAgICAgfSwgaHJlZik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgbWVzc2FnZUhhbmRsZXIpO1xyXG4gICAgICB9O1xyXG4gICAgICByZXR1cm4gbWVzc2FnZUhhbmRsZXI7XHJcbiAgICB9O1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBvbk1lc3NhZ2Uod25kKSk7XHJcbiAgfVxyXG4gIHN0YXRpYyBfZ2V0SW5mb2dyYXBoaWNzUGFyYW1zKGlnSXRlbUlkLCBoaWVyYXJjaHlJZCwgZ2VvbWV0cnksIGNvdW50cnlJRCkge1xyXG4gICAgdmFyIHRva2VuID0gVG9rZW5Qcm92aWRlci50b2tlbi5hY2Nlc3NfdG9rZW47XHJcbiAgICB2YXIgdXNlcklkID0gVG9rZW5Qcm92aWRlci50b2tlbi51c2VybmFtZTtcclxuICAgIGxldCB0b2tlbkV4cGlyZXMgPSBUb2tlblByb3ZpZGVyLnRva2VuLmV4cGlyZXNfaW47XHJcbiAgICBsZXQgdHMgPSBEYXRlLm5vdygpO1xyXG4gICAgbGV0IHRpbWVvdXQgPSAodG9rZW5FeHBpcmVzID09IG51bGwpID8gdHMgKyA2MDAwMDAgOiB0b2tlbkV4cGlyZXMgLSB0cztcclxuICAgIHZhciBleHBpcmVzID0gTWF0aC5mbG9vcih0aW1lb3V0IC8gNjAwMDAgKyAwLjUpO1xyXG4gICAgdmFyIHNlcnZlciA9IFNldHRpbmdzSGVscGVyLmdldFBvcnRhbEJhc2VVcmwoKTtcclxuICAgIC8vIHZhciBmdWxsUGFnZXNPbmx5ID0gQkEuTG9jYWxTdG9yYWdlLmdldFZhbHVlKEJBLnNldHRpbmdzLmxvY2FsU3RvcmFnZUlEX3Nob3dGdWxsSW5mb2dyYXBoaWNzKTtcclxuICAgIC8vIGZ1bGxQYWdlc09ubHkgPSBTZXR0aW5nc0hlbHBlci5pc1RydWVTdHJpbmcoZnVsbFBhZ2VzT25seSk7XHJcbiAgICB2YXIgcGFyYW1zID0ge1xyXG4gICAgICBzZXJ2ZXI6IHNlcnZlcixcclxuICAgICAgdXNlcklkOiB1c2VySWQsXHJcbiAgICAgIHRva2VuOiB0b2tlbixcclxuICAgICAgZXhwaXJlczogZXhwaXJlcyxcclxuICAgICAgcmVwb3J0SUQ6IGlnSXRlbUlkLFxyXG4gICAgICBjb3VudHJ5SUQ6IGNvdW50cnlJRCxcclxuICAgICAgaGllcmFyY2h5OiBoaWVyYXJjaHlJZCxcclxuICAgICAgLy8gZnVsbFBhZ2VzT25seTogZnVsbFBhZ2VzT25seVxyXG4gICAgICBhbmFseXNpc0FyZWFzOiBbe1xyXG4gICAgICAgICAgZmVhdHVyZToge1xyXG4gICAgICAgICAgICBnZW9tZXRyeTogZ2VvbWV0cnlcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XVxyXG4gICAgfTtcclxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShwYXJhbXMpO1xyXG4gIH1cclxufVxuXG4vLyBub2luc3BlY3Rpb24gSlNVbnVzZWRHbG9iYWxTeW1ib2xzXHJcbmNsYXNzIFRyYW5zcG9ydFV0aWwge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5maXhGb3JMaW50ID0gJyc7XHJcbiAgICAvLyBkZWJ1ZyBsb2dnaW5nIHNldCB0byB0cnVlXHJcbiAgfVxyXG4gIC8vIHB1YmxpYyBzdGF0aWMgR0VVcmwgPVxyXG4gIC8vICAgJ2h0dHBzOi8vZ2VvZW5yaWNoLmFyY2dpcy5jb20vYXJjZ2lzL3Jlc3Qvc2VydmljZXMvV29ybGQvZ2VvZW5yaWNobWVudHNlcnZlci9HZW9lbnJpY2htZW50L0VucmljaCc7Ly8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXHJcbiAgc3RhdGljIHNldFRva2VuKHVzZXJuYW1lLCB0b2tlbikge1xyXG4gICAgVG9rZW5Qcm92aWRlci5zZXRUb2tlbih1c2VybmFtZSwgdG9rZW4pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiBNYWtlcyBHRSBjYWxsIHRvIGdlbmVyYXRlIGRyaXZldGltZSBvciB3YWxrdGltZSBidWZmZXJzXHJcbiAgICpcclxuICAgKiBAcGFyYW0gbW9kZSA9ICdkcml2ZXRpbWUnIG9yICd3YWxrdGltZSdcclxuICAgKiBAcGFyYW0gc291cmNlQ291bnRyeVxyXG4gICAqIEBwYXJhbSB1bml0cyA9ICdtaW51dGVzLCAnbWlsZXMnIG9yICdraWxvbWV0ZXJzJ1xyXG4gICAqIEBwYXJhbSBidWZmZXJWYWx1ZXMgID0gMSwzLDVcclxuICAgKiBAcGFyYW0gbG9uZ2l0dWRlXHJcbiAgICogQHBhcmFtIGxhdGl0dWRlXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGdldEJ1ZmZlcnMobW9kZSwgc291cmNlQ291bnRyeSwgdW5pdHMsIGJ1ZmZlclZhbHVlcywgbG9uZ2l0dWRlLCBsYXRpdHVkZSkge1xyXG4gICAgaWYgKG1vZGUgIT0gJ2RyaXZldGltZScgJiYgbW9kZSAhPSAnd2Fsa3RpbWUnKSB7XHJcbiAgICAgIHRocm93ICgnVHJhbnNwb3J0VXRpbCAtIGludmFsaWQgYXJncycpO1xyXG4gICAgfVxyXG4gICAgaWYgKFRyYW5zcG9ydFV0aWwuaGFzVGV4dChzb3VyY2VDb3VudHJ5KSAmJlxyXG4gICAgICBUcmFuc3BvcnRVdGlsLmhhc1RleHQodW5pdHMpICYmXHJcbiAgICAgIGJ1ZmZlclZhbHVlcyAmJlxyXG4gICAgICB0eXBlb2YgbG9uZ2l0dWRlICE9IHVuZGVmaW5lZCAmJlxyXG4gICAgICB0eXBlb2YgbGF0aXR1ZGUgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGxldCBwYXJhbXMgPSBhd2FpdCBUcmFuc3BvcnRVdGlsLmdldFBhcmFtcyhtb2RlLCBcclxuICAgICAgLy8gc291cmNlQ291bnRyeSxcclxuICAgICAgdW5pdHMsIGJ1ZmZlclZhbHVlcywgbG9uZ2l0dWRlLCBsYXRpdHVkZSk7XHJcbiAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IEdFQ2xpZW50LmVucmljaChwYXJhbXMpO1xyXG4gICAgICBsZXQgc3BhdGlhbCA9IHJlc3BvbnNlLnJlc3VsdHNbMF0udmFsdWUuRmVhdHVyZVNldFswXS5zcGF0aWFsUmVmZXJlbmNlO1xyXG4gICAgICBsZXQgb2JqID0gVHJhbnNwb3J0VXRpbC5wYXJzZVJpbmdzKHJlc3BvbnNlKTtcclxuICAgICAgaWYgKG9iaikge1xyXG4gICAgICAgIGZvciAobGV0IGlpID0gMDsgaWkgPCBvYmoubGVuZ3RoOyBpaSsrKSB7XHJcbiAgICAgICAgICBpZiAob2JqW2lpXSkge1xyXG4gICAgICAgICAgICBsZXQgaXRlbSA9IG9ialtpaV07XHJcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgaXRlbS50cmFuc3BvcnQgPSBtb2RlID09ICdkcml2ZXRpbWUnID8gJ2RyaXZlJyA6ICd3YWxrJztcclxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICBpdGVtLmxhdGl0dWRlID0gbGF0aXR1ZGU7XHJcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgaXRlbS5sb25naXR1ZGUgPSBsb25naXR1ZGU7XHJcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgaXRlbS5zcGF0aWFsID0gc3BhdGlhbDtcclxuICAgICAgICAgICAgLy8gbG9jYXRpb24gbWFya2VyXHJcbiAgICAgICAgICAgIGl0ZW0ubG9jYXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgZ2VvbWV0cnk6IHtcclxuICAgICAgICAgICAgICAgIHg6IGxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgIHk6IGxhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgc3BhdGlhbFJlZmVyZW5jZToge1xyXG4gICAgICAgICAgICAgICAgICB3a2lkOiA0MzI2XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBzeW1ib2w6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6ICdlc3JpUE1TJyxcclxuICAgICAgICAgICAgICAgIHdpZHRoOiAxNCxcclxuICAgICAgICAgICAgICAgIGhlaWdodDogMjYuNixcclxuICAgICAgICAgICAgICAgIHhvZmZzZXQ6IDAsXHJcbiAgICAgICAgICAgICAgICB5b2Zmc2V0OiAxMi42LFxyXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdpbWFnZS9wbmcnLFxyXG4gICAgICAgICAgICAgICAgaW1hZ2VEYXRhOiAnaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUJNQUFBQWpDQVlBQUFCMktqRmhBQUFDdFVsRVFWUklTKzJXUzB3VFVSU0cvenZUMGtwZmtHSjRwR0NWaUExRW05Q3RDUVZ4NVFJV2hpVlJvOEdkU055cHFIRWxrY2dPbHpWaDVhcDFYNm5FaUFrUVh6R0J4a1NLdFpDMGpkVFNCN1NkTVhkd1JqdWRCK3c1cTV0N1Q3NzV6My9PelIwQ1diVDR4OTBHbGgwQ01FeDQzZzFDM0ZJS3o2L3poS3dEQ0pZcmxkQldaSWF1cFNEaXFzRS8zbUJqbUdlTXlYTEY3R2lCdWJFVmhtTjJzSVk2S2JsUzNrTzU4QnZGWDVzb1pyYkE3ZVlDV1k2N3ZSMloyYVpKQW95cU1UTE12TFhONDdhMWVlUmlVU3JtVVNybWhIU0dOWUExMW9HdE15TzNGY1ZPWW5XOXhISDlWS1VBY3cxTWZIU2M5SGt0enZZYUVOMzRCNnN1eW1TeEN3b3pzUStSZUhpNm43Z0c3L2lOWnZ2ODhXNi9Ja2dkdGwrWTJkNkk1TmZYcUpRSy9jUTFNUEhRMXVaNW9GU2VTRmRXdG45S3k5M2Ivb2xzWXZVUmhVV2NYZWY3VFBhbUdtV1hmTTNvUGVWQWk4T0llREtMcFdnU3J4WTNxdklZMWdqQ2w1R092bjJqQ0xPYVdVeU45c0RYNmFqNXdOSmFFcmRtM3lOYktBbG51ckNwMFc3MDlUaFZQUXkraStIK2l4VjkyT2xXQytiR2UxVkI0c0hseDJHc3hUUGF5cWhQa3lOZHVyQjdnUldFRm1QYXNCc1hUK0Q2WUljdTdNbkx6NWdMZjlPRzBlN05qcDNUaFYyYlhzQlNOS1VObzUxOGZ0TUw2cDFhVUsrb1p3ZnFKZ1ZSSUFYTGc0N0UxYWNMZ3ZrSGd0R2sxa1lUSmtmT0NFTXJ4bkkwaGJ1QlpTVFNlV2xQZDg3a2FwcnFlV3drVW9wVkh4cW1kVGVQWU1xVGRlUlo5ZDFzdnpBUnRMbk9EbG1iTzFYdm9xcG5oTUJrYVVBaEhVTTIvaVZFNk9OclpaaklvWis2djZCaVpoT1o3eXVmZGpqT0w3eWJlc0FhWlFvZytxcFgvUjZvS2F5Q3FZQ29LQW1tcFZDQ2FZQnFZR3BBQWJhYkY4eiszeVB4aDBYc1hKVXljVlB1WVdtM0lJeUFGa2hSbVJvd2wvNGhkVTJ1U0ZPWkhGanY3UERtMHh0Qys5VkFtc3Brd09BT3h3MXJnV2orSDR1Vkg2aGowOEhTQUFBQUFFbEZUa1N1UW1DQydcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBvYmo7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbiAgc3RhdGljIHBhcnNlUmluZ3MocmVzcG9uc2UpIHtcclxuICAgIHZhciByaW5ncyA9IFtdO1xyXG4gICAgdmFyIGNoZWNrZWQgPSB7fTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5yZXN1bHRzICYmIHJlc3BvbnNlLnJlc3VsdHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGxldCBmZWF0dXJlU2V0ID0gcmVzcG9uc2UucmVzdWx0c1swXS52YWx1ZS5GZWF0dXJlU2V0WzBdO1xyXG4gICAgICAgIGlmIChmZWF0dXJlU2V0LmZlYXR1cmVzICYmIGZlYXR1cmVTZXQuZmVhdHVyZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IGZlYXR1cmVTZXQuZmVhdHVyZXMubGVuZ3RoOyBpaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBmID0gZmVhdHVyZVNldC5mZWF0dXJlc1tpaV07XHJcbiAgICAgICAgICAgIGxldCBidWZmZXJWYWx1ZSA9IGYuYXR0cmlidXRlcy5idWZmZXJSYWRpaTtcclxuICAgICAgICAgICAgLy8gZmlsdGVyIG91dCBkdXBsaWNhdGUgcmluZ3NcclxuICAgICAgICAgICAgaWYgKCFjaGVja2VkW2J1ZmZlclZhbHVlXSkge1xyXG4gICAgICAgICAgICAgIGNoZWNrZWRbYnVmZmVyVmFsdWVdID0gdHJ1ZTtcclxuICAgICAgICAgICAgICBsZXQgYnVmZmVyVW5pdHMgPSBmLmF0dHJpYnV0ZXMuYnVmZmVyVW5pdHM7XHJcbiAgICAgICAgICAgICAgbGV0IHIgPSBmLmdlb21ldHJ5LnJpbmdzO1xyXG4gICAgICAgICAgICAgIHJpbmdzLnB1c2goeyB2YWx1ZTogYnVmZmVyVmFsdWUsIHVuaXRzOiBidWZmZXJVbml0cywgcmluZ3M6IHIgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiByaW5ncztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGNhdGNoIChleCkge1xyXG4gICAgICBMb2d6LnNob3coJyVlJywgJ1RyYW5zcG9ydFV0aWwgcGFyc2UgR0UgcmVzdWx0IGlzIGludmFsaWQnKTtcclxuICAgIH1cclxuICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgfVxyXG4gIHN0YXRpYyBoYXNUZXh0KHMpIHtcclxuICAgIGxldCB0ZXN0ID0gKHR5cGVvZiBzICE9IHVuZGVmaW5lZCAmJiBzLnRyaW0oKS5sZW5ndGggPiAwKTtcclxuICAgIHJldHVybiB0ZXN0O1xyXG4gIH1cclxuICBzdGF0aWMgY2FsY3VsYXRlU2ltcGxpZmljYXRpb24obW9kZSwgYnVmZmVyVW5pdHMsIGJ1ZmZlclZhbHVlcykge1xyXG4gICAgbGV0IGZhY3RvciA9IDEwO1xyXG4gICAgbGV0IG1heCA9IDE7XHJcbiAgICBmb3IgKGxldCBpaSA9IDA7IGlpIDwgYnVmZmVyVmFsdWVzLmxlbmd0aDsgaWkrKykge1xyXG4gICAgICBtYXggPSAoYnVmZmVyVmFsdWVzW2lpXSA+IG1heCkgPyBidWZmZXJWYWx1ZXNbaWldIDogbWF4O1xyXG4gICAgfVxyXG4gICAgaWYgKG1vZGUgPT09ICdkcml2ZXRpbWUnKSB7XHJcbiAgICAgIHN3aXRjaCAoYnVmZmVyVW5pdHMpIHtcclxuICAgICAgICBjYXNlICgnbWludXRlcycpOiB7XHJcbiAgICAgICAgICBmYWN0b3IgPSBNYXRoLm1heCgxMCwgKDAuMDA2MTQgKiBtYXggKiBtYXgpICsgKDMuNSAqIG1heCkgLSA0MCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSAoJ21pbGVzJyk6IHtcclxuICAgICAgICAgIGZhY3RvciA9IE1hdGgubWF4KDEwLCAoOC41ICogbWF4KSAtIDEwMCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSAoJ2tpbG9tZXRlcnMnKToge1xyXG4gICAgICAgICAgZmFjdG9yID0gTWF0aC5tYXgoMTAsICg1LjMyMzMgKiBtYXgpIC0gNjApO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChtb2RlID09PSAnd2Fsa3RpbWUnKSB7XHJcbiAgICAgIHN3aXRjaCAoYnVmZmVyVW5pdHMpIHtcclxuICAgICAgICBjYXNlICgnbWludXRlcycpOiB7XHJcbiAgICAgICAgICBmYWN0b3IgPSBNYXRoLm1heCgyLCAoMC4xNDM3ICogbWF4KSAtIDguNyk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSAoJ21pbGVzJyk6IHtcclxuICAgICAgICAgIGZhY3RvciA9IE1hdGgubWF4KDIsICg0LjcgKiBtYXgpIC0gMjYuOCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSAoJ2tpbG9tZXRlcnMnKToge1xyXG4gICAgICAgICAgZmFjdG9yID0gTWF0aC5tYXgoMiwgKDMuMTEgKiBtYXgpIC0gMzIuNyk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBmYWN0b3I7XHJcbiAgfVxyXG4gIC8qXHJcbiAgICogZ2V0UGFyYW1zIC0gZ2VuZXJhdGVzIHJlcXVlc3QgcGFyYW1ldGVycyBmb3IgZHJpdmV0aW1lIG9yIHdhbGt0aW1lXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGdldFBhcmFtcyhtb2RlLCBcclxuICAvLyBzb3VyY2VDb3VudHJ5OiBzdHJpbmcsXHJcbiAgdW5pdHMsIGJ1ZmZlclZhbHVlcywgbG9uZ2l0dWRlLCBsYXRpdHVkZSkge1xyXG4gICAgbGV0IGlzVGltZSA9IHVuaXRzLnRvTG93ZXJDYXNlKCkgPT0gJ21pbnV0ZXMnO1xyXG4gICAgbGV0IGlzRHJpdmV0aW1lID0gbW9kZSA9PSAnZHJpdmV0aW1lJztcclxuICAgIC8vIGxldCBkZWZhdWx0SGllcmFyY2h5ID0gYXdhaXQgR0VDbGllbnQuZ2V0R0VEZWZhdWx0SGllcmFyY2h5KHNvdXJjZUNvdW50cnkpXHJcbiAgICBjb25zdCBzaW1wbGVGYWN0b3IgPSB0aGlzLmNhbGN1bGF0ZVNpbXBsaWZpY2F0aW9uKG1vZGUsIHVuaXRzLCBidWZmZXJWYWx1ZXMpO1xyXG4gICAgLy8gbGV0IGNvdW50cnlPYmogPSB7XHJcbiAgICAvLyAgIHNvdXJjZUNvdW50cnk6IHNvdXJjZUNvdW50cnksXHJcbiAgICAvLyAgIGhpZXJhcmNoeTogZGVmYXVsdEhpZXJhcmNoeVxyXG4gICAgLy8gfVxyXG4gICAgLy8gbGV0IGpzb25EYXRhOiBzdHJpbmcgPSBKU09OLnN0cmluZ2lmeShjb3VudHJ5T2JqKVxyXG4gICAgbGV0IHN0dWR5T2JqO1xyXG4gICAgLy8gRFJJVklORyBCVUZGRVJTXHJcbiAgICBpZiAoaXNEcml2ZXRpbWUpIHtcclxuICAgICAgc3R1ZHlPYmogPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgYnVmZmVyVW5pdHM6IGlzVGltZSA/ICdNaW51dGVzJyA6ICh1bml0cyA9PSAnbWlsZXMnKSA/ICdlc3JpTWlsZXMnIDogJ2VzcmlLaWxvbWV0ZXJzJyxcclxuICAgICAgICAgIGJ1ZmZlclJhZGlpOiBidWZmZXJWYWx1ZXMsXHJcbiAgICAgICAgICBhcmVhVHlwZTogJ05ldHdvcmtTZXJ2aWNlQXJlYScsXHJcbiAgICAgICAgICB0cmF2ZWxfbW9kZToge1xyXG4gICAgICAgICAgICBhdHRyaWJ1dGVQYXJhbWV0ZXJWYWx1ZXM6IFtcclxuICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnQXZvaWQgVW5wYXZlZCBSb2FkcycsXHJcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lOiAnUmVzdHJpY3Rpb24gVXNhZ2UnLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6ICdBVk9JRF9ISUdIJ1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ0F2b2lkIFByaXZhdGUgUm9hZHMnLFxyXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyTmFtZTogJ1Jlc3RyaWN0aW9uIFVzYWdlJyxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiAnQVZPSURfTUVESVVNJ1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ0RyaXZpbmcgYW4gQXV0b21vYmlsZScsXHJcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lOiAnUmVzdHJpY3Rpb24gVXNhZ2UnLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6ICdQUk9ISUJJVEVEJ1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ1Rocm91Z2ggVHJhZmZpYyBQcm9oaWJpdGVkJyxcclxuICAgICAgICAgICAgICAgIHBhcmFtZXRlck5hbWU6ICdSZXN0cmljdGlvbiBVc2FnZScsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogJ0FWT0lEX0hJR0gnXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnVHJhdmVsVGltZScsXHJcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lOiAnVmVoaWNsZSBNYXhpbXVtIFNwZWVkIChrbS9oKScsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogMFxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ1JvYWRzIFVuZGVyIENvbnN0cnVjdGlvbiBQcm9oaWJpdGVkJyxcclxuICAgICAgICAgICAgICAgIHBhcmFtZXRlck5hbWU6ICdSZXN0cmljdGlvbiBVc2FnZScsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogJ1BST0hJQklURUQnXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnQXZvaWQgR2F0ZXMnLFxyXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyTmFtZTogJ1Jlc3RyaWN0aW9uIFVzYWdlJyxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiAnQVZPSURfTUVESVVNJ1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ0F2b2lkIEV4cHJlc3MgTGFuZXMnLFxyXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyTmFtZTogJ1Jlc3RyaWN0aW9uIFVzYWdlJyxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiAnUFJPSElCSVRFRCdcclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdBdm9pZCBDYXJwb29sIFJvYWRzJyxcclxuICAgICAgICAgICAgICAgIHBhcmFtZXRlck5hbWU6ICdSZXN0cmljdGlvbiBVc2FnZScsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogJ1BST0hJQklURUQnXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICBkaXN0YW5jZUF0dHJpYnV0ZU5hbWU6ICdLaWxvbWV0ZXJzJyxcclxuICAgICAgICAgICAgaWQ6ICdGRWdpZlJ0Rm5kS05jSk1KJyxcclxuICAgICAgICAgICAgaW1wZWRhbmNlQXR0cmlidXRlTmFtZTogKGlzVGltZSkgPyAnVHJhdmVsVGltZScgOiAnS2lsb21ldGVycycsXHJcbiAgICAgICAgICAgIG5hbWU6IChpc1RpbWUpID8gJ0RyaXZpbmcgVGltZScgOiAnRHJpdmluZyBEaXN0YW5jZScsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0aW9uQXR0cmlidXRlTmFtZXM6IFtcclxuICAgICAgICAgICAgICAnQXZvaWQgVW5wYXZlZCBSb2FkcycsXHJcbiAgICAgICAgICAgICAgJ0F2b2lkIFByaXZhdGUgUm9hZHMnLFxyXG4gICAgICAgICAgICAgICdEcml2aW5nIGFuIEF1dG9tb2JpbGUnLFxyXG4gICAgICAgICAgICAgICdUaHJvdWdoIFRyYWZmaWMgUHJvaGliaXRlZCcsXHJcbiAgICAgICAgICAgICAgJ1JvYWRzIFVuZGVyIENvbnN0cnVjdGlvbiBQcm9oaWJpdGVkJyxcclxuICAgICAgICAgICAgICAnQXZvaWQgR2F0ZXMnLFxyXG4gICAgICAgICAgICAgICdBdm9pZCBFeHByZXNzIExhbmVzJyxcclxuICAgICAgICAgICAgICAnQXZvaWQgQ2FycG9vbCBSb2FkcydcclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgc2ltcGxpZmljYXRpb25Ub2xlcmFuY2U6IHNpbXBsZUZhY3RvcixcclxuICAgICAgICAgICAgc2ltcGxpZmljYXRpb25Ub2xlcmFuY2VVbml0czogJ2VzcmlNZXRlcnMnLFxyXG4gICAgICAgICAgICB0aW1lQXR0cmlidXRlTmFtZTogJ1RyYXZlbFRpbWUnLFxyXG4gICAgICAgICAgICB0eXBlOiAnQVVUT01PQklMRScsXHJcbiAgICAgICAgICAgIHVzZUhpZXJhcmNoeTogdHJ1ZSxcclxuICAgICAgICAgICAgdXR1cm5BdEp1bmN0aW9uczogJ2VzcmlORlNCQXREZWFkRW5kc0FuZEludGVyc2VjdGlvbnMnLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ01vZGVscyB0aGUgbW92ZW1lbnQgb2YgY2FycyBhbmQgb3RoZXIgc2ltaWxhciBzbWFsbCBhdXRvbW9iaWxlcywgc3VjaCBhcyBwaWNrdXAgdHJ1Y2tzLCBhbmQgZmluZHMgc29sdXRpb25zIHRoYXQgb3B0aW1pemUgdHJhdmVsIHRpbWUuIFRyYXZlbCBvYmV5cyBvbmUtd2F5IHJvYWRzLCBhdm9pZHMgaWxsZWdhbCB0dXJucywgYW5kIGZvbGxvd3Mgb3RoZXIgcnVsZXMgdGhhdCBhcmUgc3BlY2lmaWMgdG8gY2Fycy4gV2hlbiB5b3Ugc3BlY2lmeSBhIHN0YXJ0IHRpbWUsIGR5bmFtaWMgdHJhdmVsIHNwZWVkcyBiYXNlZCBvbiB0cmFmZmljIGFyZSB1c2VkIHdoZXJlIGl0IGlzIGF2YWlsYWJsZS4nLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIG5ldHdvcmtPcHRpb25zOiB7XHJcbiAgICAgICAgICAgIC8vIHRyYXZlbF9kaXJlY3Rpb246ICdBd2F5IEZyb20gRmFjaWxpdHknLFxyXG4gICAgICAgICAgICBwb2x5Z29uX292ZXJsYXBfdHlwZTogJ0Rpc2tzJ1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHJldHVybkdlb21ldHJ5OiB0cnVlLFxyXG4gICAgICAgICAgZ2VvbWV0cnk6IHtcclxuICAgICAgICAgICAgeDogbG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICB5OiBsYXRpdHVkZSxcclxuICAgICAgICAgICAgc3BhdGlhbFJlZmVyZW5jZToge1xyXG4gICAgICAgICAgICAgIHdraWQ6IDQzMjYsXHJcbiAgICAgICAgICAgICAgbGF0ZXN0V2tpZDogNDMyNlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICBdO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIC8vIFdBTEtJTkcgQlVGRkVSU1xyXG4gICAgICBzdHVkeU9iaiA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBidWZmZXJVbml0czogaXNUaW1lID8gJ01pbnV0ZXMnIDogKHVuaXRzID09ICdtaWxlcycpID8gJ2VzcmlNaWxlcycgOiAnZXNyaUtpbG9tZXRlcnMnLFxyXG4gICAgICAgICAgYnVmZmVyUmFkaWk6IGJ1ZmZlclZhbHVlcyxcclxuICAgICAgICAgIGFyZWFUeXBlOiAnTmV0d29ya1NlcnZpY2VBcmVhJyxcclxuICAgICAgICAgIHRyYXZlbF9tb2RlOiB7XHJcbiAgICAgICAgICAgIGF0dHJpYnV0ZVBhcmFtZXRlclZhbHVlczogW1xyXG4gICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtZXRlck5hbWU6ICdSZXN0cmljdGlvbiBVc2FnZScsXHJcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnQXZvaWQgUHJpdmF0ZSBSb2FkcycsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogJ0FWT0lEX01FRElVTSdcclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtZXRlck5hbWU6ICdSZXN0cmljdGlvbiBVc2FnZScsXHJcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnV2Fsa2luZycsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogJ1BST0hJQklURUQnXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lOiAnUmVzdHJpY3Rpb24gVXNhZ2UnLFxyXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ1ByZWZlcnJlZCBmb3IgUGVkZXN0cmlhbnMnLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6ICdQUkVGRVJfTE9XJ1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyTmFtZTogJ1dhbGtpbmcgU3BlZWQgKGttL2gpJyxcclxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdXYWxrVGltZScsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogNVxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyTmFtZTogJ1Jlc3RyaWN0aW9uIFVzYWdlJyxcclxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdBdm9pZCBSb2FkcyBVbnN1aXRhYmxlIGZvciBQZWRlc3RyaWFucycsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogJ0FWT0lEX0hJR0gnXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0ZvbGxvd3MgcGF0aHMgYW5kIHJvYWRzIHRoYXQgYWxsb3cgcGVkZXN0cmlhbiB0cmFmZmljIGFuZCBmaW5kcyBzb2x1dGlvbnMgdGhhdCBvcHRpbWl6ZSB0cmF2ZWwgdGltZS4gVGhlIHdhbGtpbmcgc3BlZWQgaXMgc2V0IHRvIDUga2lsb21ldGVycyBwZXIgaG91ci4nLFxyXG4gICAgICAgICAgICBpbXBlZGFuY2VBdHRyaWJ1dGVOYW1lOiBpc1RpbWUgPyAnV2Fsa1RpbWUnIDogJ0tpbG9tZXRlcnMnLFxyXG4gICAgICAgICAgICBzaW1wbGlmaWNhdGlvblRvbGVyYW5jZVVuaXRzOiAnZXNyaU1ldGVycycsXHJcbiAgICAgICAgICAgIHV0dXJuQXRKdW5jdGlvbnM6ICdlc3JpTkZTQkFsbG93QmFja3RyYWNrJyxcclxuICAgICAgICAgICAgcmVzdHJpY3Rpb25BdHRyaWJ1dGVOYW1lczogW1xyXG4gICAgICAgICAgICAgICdBdm9pZCBQcml2YXRlIFJvYWRzJyxcclxuICAgICAgICAgICAgICAnQXZvaWQgUm9hZHMgVW5zdWl0YWJsZSBmb3IgUGVkZXN0cmlhbnMnLFxyXG4gICAgICAgICAgICAgICdQcmVmZXJyZWQgZm9yIFBlZGVzdHJpYW5zJyxcclxuICAgICAgICAgICAgICAnV2Fsa2luZydcclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgdXNlSGllcmFyY2h5OiBmYWxzZSxcclxuICAgICAgICAgICAgc2ltcGxpZmljYXRpb25Ub2xlcmFuY2U6IHNpbXBsZUZhY3RvcixcclxuICAgICAgICAgICAgdGltZUF0dHJpYnV0ZU5hbWU6ICdXYWxrVGltZScsXHJcbiAgICAgICAgICAgIGRpc3RhbmNlQXR0cmlidXRlTmFtZTogJ0tpbG9tZXRlcnMnLFxyXG4gICAgICAgICAgICB0eXBlOiAnV0FMSycsXHJcbiAgICAgICAgICAgIGlkOiAnY2FGQWdvVGhydlVwa0ZCVycsXHJcbiAgICAgICAgICAgIG5hbWU6IGlzVGltZSA/ICdXYWxraW5nIFRpbWUnIDogJ1dhbGtpbmcgRGlzdGFuY2UnXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgbmV0d29ya09wdGlvbnM6IHtcclxuICAgICAgICAgICAgcG9seWdvbl9vdmVybGFwX3R5cGU6ICdEaXNrcydcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICByZXR1cm5HZW9tZXRyeTogdHJ1ZSxcclxuICAgICAgICAgIGdlb21ldHJ5OiB7XHJcbiAgICAgICAgICAgIHg6IGxvbmdpdHVkZSxcclxuICAgICAgICAgICAgeTogbGF0aXR1ZGUsXHJcbiAgICAgICAgICAgIHNwYXRpYWxSZWZlcmVuY2U6IHtcclxuICAgICAgICAgICAgICB3a2lkOiA0MzI2LFxyXG4gICAgICAgICAgICAgIGxhdGVzdFdraWQ6IDQzMjZcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgXTtcclxuICAgIH1cclxuICAgIGxldCBqc29uU3R1ZHkgPSBKU09OLnN0cmluZ2lmeShzdHVkeU9iaik7XHJcbiAgICBsZXQganNvbiA9IHtcclxuICAgICAgXCJkYXRhQ29sbGVjdGlvbnNcIjogW1wiR2xvYmFsSW50ZXJzZWN0XCJdLFxyXG4gICAgICBcInJldHVybkdlb21ldHJ5XCI6IHRydWUsXHJcbiAgICAgIFwib3V0U1JcIjogXCJ7XFxcIndraWRcXFwiOjQzMjYsIFxcXCJsYXRlc3RXa2lkXFxcIjo0MzI2fVwiLFxyXG4gICAgICBcInN0dWR5YXJlYXNcIjoganNvblN0dWR5LFxyXG4gICAgICBcImZvclN0b3JhZ2VcIjogZmFsc2UsXHJcbiAgICAgIFwiZlwiOiBcImpzb25cIlxyXG4gICAgfTtcclxuICAgIHJldHVybiBqc29uO1xyXG4gIH1cclxufVxuXG5jbGFzcyBHZW9tZXRyeVV0aWwge1xyXG4gIC8qXHJcbiAgICogIGdldFJpbmdzXHJcbiAgICpcclxuICAgKiAgR2VuZXJhdGVzIHJpbmdzIGZvciBhIGxvY2F0aW9uIGluIHRoZSBzcGVjaWZpZWQgJ3VuaXRzJywgZm9yXHJcbiAgICogIHRoZSAxLTMgcmFkaXVzIHZhbHVlc1xyXG4gICAqXHJcbiAgICogIHVuaXRzID0gW21pbGVzIG9yIGtpbG9tZXRlcnNdXHJcbiAgICogIHZhbHVlcyA9IGFycmF5IG9mIHJhZGl1cyB2YWx1ZXMgdXNpbmcgMSB0byAzIHZhbHVlc1xyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXRSaW5ncyhsYXQsIGxvbiwgdW5pdHMsIHZhbHVlcywgbG9jYXRpb25OYW1lLCBsb2NhdGlvbkF0dHJpYnV0ZXMpIHtcclxuICAgIGlmICghdmFsdWVzIHx8IHZhbHVlcy5sZW5ndGggPD0gMCB8fCB2YWx1ZXMubGVuZ3RoID4gM1xyXG4gICAgICB8fCAodW5pdHMgIT0gJ21pbGVzJyAmJiB1bml0cyAhPSAna2lsb21ldGVycycpXHJcbiAgICAgIHx8ICghbGF0IHx8ICFsb24pKSB7XHJcbiAgICAgIExvZ3ouc2hvdygnJWUnLCAnR2VvbWV0cnlVdGlsOiBpbnZhbGlkIGFyZ3MnLCBsYXQsIGxvbiwgdmFsdWVzKTtcclxuICAgICAgdGhyb3cgJ0dlb21ldHJ5VXRpbDogaW52YWxpZCBhcmdzJztcclxuICAgIH1cclxuICAgIC8vIGxldCBsYXRpdHVkZSA9IHBhcnNlRmxvYXQobGF0KTtcclxuICAgIC8vIGxldCBsb25naXR1ZGUgPSBwYXJzZUZsb2F0KGxvbik7XHJcbiAgICBsZXQgcmluZ3MgPSBbXTtcclxuICAgIGZvciAobGV0IGlpID0gMDsgaWkgPCB2YWx1ZXMubGVuZ3RoOyBpaSsrKSB7XHJcbiAgICAgIGxldCBhcmVhID0gdGhpcy5nZXRBbmFseXNpc0FyZWFSaW5ncyhsYXQsIGxvbiwgdW5pdHMsIHZhbHVlcywgaWksIGxvY2F0aW9uTmFtZSwgbG9jYXRpb25BdHRyaWJ1dGVzKTtcclxuICAgICAgcmluZ3MucHVzaChhcmVhKTtcclxuICAgIH1cclxuICAgIHJldHVybiByaW5ncztcclxuICB9XHJcbiAgc3RhdGljIGdldEFuYWx5c2lzQXJlYVJpbmdzKGxhdCwgbG9uLCB1bml0cywgdmFsdWVzLCBpbmRleCwgbG9jYXRpb25OYW1lLCBsb2NhdGlvbkF0dHJpYnV0ZXMpIHtcclxuICAgIGlmICghbGF0IHx8ICFsb24gfHwgdW5pdHMgPT0gdW5kZWZpbmVkIHx8ICF2YWx1ZXMgfHwgdmFsdWVzLmxlbmd0aCA8IDAgfHwgdmFsdWVzLmxlbmd0aCA+IDMpIHtcclxuICAgICAgRGVidWdMb2cubG9nKCdhcmNnaXMtaW5mb2dyYXBoaWMgYW5hbHlzaXNBcmVhcyBpbnZhbGlkIGFyZ3M6ICcsIGxhdCwgbG9uLCB1bml0cywgdmFsdWVzKTtcclxuICAgICAgdGhyb3cgKCdHZW9tZXRyeVV0aWwuZ2V0QW5hbHlzaXNBcmVhUmluZ3M6IGludmFsaWQgYXJncycpO1xyXG4gICAgfVxyXG4gICAgbGV0IHNVbml0cyA9ICh2YWx1ZXNbaW5kZXhdID09IDEpID9cclxuICAgICAgKHVuaXRzID09ICdtaWxlcycpID8gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignbWlsZScpIDogQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bigna2lsb21ldGVyJykgOlxyXG4gICAgICAodW5pdHMgPT0gJ21pbGVzJykgPyBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdtaWxlc0xvd2VyY2FzZScpIDogQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bigna2lsb21ldGVyc0xvd2VyY2FzZScpO1xyXG4gICAgZnVuY3Rpb24gZ2V0RGVzY3JpcHRpb24oKSB7XHJcbiAgICAgIGxldCBfdW5pdCA9ICh1bml0cyA9PSAnbWlsZXMnKSA/ICcgJyArIEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ21pbGUnKSA6ICcgJyArIEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2tpbG9tZXRlcicpO1xyXG4gICAgICByZXR1cm4gKEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ3Jpbmctc2VtaWNvbG9uJykgKyAnICcgKyB2YWx1ZXNbaW5kZXhdICsgX3VuaXQgKyAnICcgKyBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdyYWRpdXNMb3dlcmNhc2UnKSk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBnZXROYW1lKCkge1xyXG4gICAgICByZXR1cm4gdmFsdWVzW2luZGV4XSArICcgJyArIHNVbml0cztcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGdldFNob3J0TmFtZSgpIHtcclxuICAgICAgcmV0dXJuIHZhbHVlc1tpbmRleF0gKyAnICcgKyBzVW5pdHM7XHJcbiAgICB9XHJcbiAgICBsZXQgcmVzdWx0ID0ge1xyXG4gICAgICBmZWF0dXJlOiB7XHJcbiAgICAgICAgZ2VvbWV0cnk6IHtcclxuICAgICAgICAgIHJpbmdzOiBbXVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYXR0cmlidXRlczoge1xyXG4gICAgICAgICAgUklORzogaW5kZXggKyAxLFxyXG4gICAgICAgICAgREVTQ1JJUFRJT046ICcnLFxyXG4gICAgICAgICAgbGF0aXR1ZGU6IGxhdCxcclxuICAgICAgICAgIGxvbmdpdHVkZTogbG9uLFxyXG4gICAgICAgICAgbmFtZTogZ2V0TmFtZSgpLFxyXG4gICAgICAgICAgc2hvcnROYW1lOiBnZXRTaG9ydE5hbWUoKSxcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBnZXREZXNjcmlwdGlvbigpLFxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgbGF0aXR1ZGU6IGxhdCxcclxuICAgICAgbG9uZ2l0dWRlOiBsb24sXHJcbiAgICAgIGxvY2F0aW9uOiB7XHJcbiAgICAgICAgZ2VvbWV0cnk6IHtcclxuICAgICAgICAgIHg6IGxvbixcclxuICAgICAgICAgIHk6IGxhdCxcclxuICAgICAgICAgIHNwYXRpYWxSZWZlcmVuY2U6IHtcclxuICAgICAgICAgICAgd2tpZDogNDMyNlxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc3ltYm9sOiB7XHJcbiAgICAgICAgICB0eXBlOiAnZXNyaVBNUycsXHJcbiAgICAgICAgICB3aWR0aDogMTQsXHJcbiAgICAgICAgICBoZWlnaHQ6IDI2LjYsXHJcbiAgICAgICAgICB4b2Zmc2V0OiAwLFxyXG4gICAgICAgICAgeW9mZnNldDogMTIuNixcclxuICAgICAgICAgIGNvbnRlbnRUeXBlOiAnaW1hZ2UvcG5nJyxcclxuICAgICAgICAgIGltYWdlRGF0YTogJ2lWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCTUFBQUFqQ0FZQUFBQjJLakZoQUFBQ3RVbEVRVlJJUysyV1Mwd1RVUlNHL3p2VDBrcGZrR0o0cEdDVmlBMUVtOUN0Q1FWeDVRSVdoaVZSbzhHZFNOeXBxSEVsa2NnT2x6Vmg1YXAxWDZuRWlBa1FYekdCeGtTS3RaQzBqZFRTQjdTZE1YZHdSanVkQit3NXE1dDdUNzc1ejMvT3pSMENXYlQ0eDkwR2xoMENNRXg0M2cxQzNGSUt6Ni96aEt3RENKWXJsZEJXWklhdXBTRGlxc0UvM21Cam1HZU15WExGN0dpQnViRVZobU4yc0lZNktibFMza081OEJ2Rlg1c29acmJBN2VZQ1dZNjd2UjJaMmFaSkFveXFNVExNdkxYTjQ3YTFlZVJpVVNybVVTcm1oSFNHTllBMTFvR3RNeU8zRmNWT1luVzl4SEg5VktVQWN3MU1mSFNjOUhrdHp2WWFFTjM0QjZzdXltU3hDd296c1ErUmVIaTZuN2dHNy9pTlp2djg4VzYvSWtnZHRsK1kyZDZJNU5mWHFKUUsvY1ExTVBIUTF1WjVvRlNlU0ZkV3RuOUt5OTNiL29sc1l2VVJoVVdjWGVmN1RQYW1HbVdYZk0zb1BlVkFpOE9JZURLTHBXZ1NyeFkzcXZJWTFnakNsNUdPdm4yakNMT2FXVXlOOXNEWDZhajV3TkphRXJkbTN5TmJLQWxudXJDcDBXNzA5VGhWUFF5K2krSCtpeFY5Mk9sV0MrYkdlMVZCNHNIbHgyR3N4VFBheXFoUGt5TmR1ckI3Z1JXRUZtUGFzQnNYVCtENllJY3U3TW5MejVnTGY5T0cwZTdOanAzVGhWMmJYc0JTTktVTm81MThmdE1MNnAxYVVLK29ad2ZxSmdWUklBWExnNDdFMWFjTGd2a0hndEdrMWtZVEprZk9DRU1yeG5JMGhidUJaU1RTZVdsUGQ4N2thcHJxZVd3a1VvcFZIeHFtZFRlUFlNcVRkZVJaOWQxc3Z6QVJ0TG5PRGxtYk8xWHZvcXBuaE1Ca2FVQWhIVU0yL2lWRTZPTnJaWmpJb1orNnY2QmlaaE9aN3l1ZmRqak9MN3liZXNBYVpRb2crcXBYL1I2b0theUNxWUNvS0FtbXBWQ0NhWUJxWUdwQUFiYWJGOHorM3lQeGgwWHNYSlV5Y1ZQdVlXbTNJSXlBRmtoUm1Sb3dsLzRoZFUydVNGT1pIRmp2N1BEbTB4dEMrOVZBbXNwa3dPQU94dzFyZ1dqK0g0dVZINmhqMDhIU0FBQUFBRWxGVGtTdVFtQ0MnXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBuYW1lOiBsb2NhdGlvbk5hbWUgPyBsb2NhdGlvbk5hbWUgOiBnZXROYW1lKCksXHJcbiAgICAgIGFkZHJlc3M6ICcnLFxyXG4gICAgICBzaG9ydE5hbWU6IGdldFNob3J0TmFtZSgpLFxyXG4gICAgICBsb2NhdGlvbk5hbWU6IGxvY2F0aW9uTmFtZSA/IGxvY2F0aW9uTmFtZSA6IGdldE5hbWUoKSxcclxuICAgICAgZGVzY3JpcHRpb246IGdldERlc2NyaXB0aW9uKClcclxuICAgIH07XHJcbiAgICAvLyBBZGQgYXR0cmlidXRlcyB0aGF0IHdlcmUgcGFzc2VkIGluXHJcbiAgICBpZiAobG9jYXRpb25BdHRyaWJ1dGVzKSB7XHJcbiAgICAgIGNvbnN0IG1lcmdlZEF0dHJpYnV0ZXMgPSB7XHJcbiAgICAgICAgLi4ubG9jYXRpb25BdHRyaWJ1dGVzLFxyXG4gICAgICAgIC4uLnJlc3VsdC5mZWF0dXJlLmF0dHJpYnV0ZXNcclxuICAgICAgfTtcclxuICAgICAgcmVzdWx0LmZlYXR1cmUuYXR0cmlidXRlcyA9IG1lcmdlZEF0dHJpYnV0ZXM7XHJcbiAgICB9XHJcbiAgICBsZXQgciA9IEdlb21ldHJ5VXRpbC5fZ2VuZXJhdGVSaW5nKGxhdCwgbG9uLCB1bml0cywgdmFsdWVzW2luZGV4XSk7XHJcbiAgICAvLyBAdHMtaWdub3JlXHJcbiAgICByZXN1bHQuZmVhdHVyZS5nZW9tZXRyeS5yaW5ncy5wdXNoKHIpO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcbiAgLy8gZ2VuZXJhdGUgQW5hbHlzaXMgQXJlYXMgZm9yICBpbmZvZ3JhcGhpY1xyXG4gIC8vXHJcbiAgLy8gRXhwZWN0aW5nIHJpbmdzID0gWyB7dmFsdWUsdW5pdHMscmluZ3N9LC4uLl1cclxuICAvL1xyXG4gIC8vIFJldHVybnM6ICBqc29uIGdlb21ldHJ5XHJcbiAgc3RhdGljIGdldEFuYWx5c2lzQXJlYXNGcm9tUmluZ3MoZGF0YSwgbG9jYXRpb25OYW1lLCBsb2NhdGlvbkF0dHJpYnV0ZXMpIHtcclxuICAgIHZhciBvYmogPSB7XHJcbiAgICAgIGFuYWx5c2lzQXJlYXM6IFtdXHJcbiAgICB9O1xyXG4gICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IGRhdGEubGVuZ3RoOyBpaSsrKSB7XHJcbiAgICAgIGxldCBkID0gZGF0YVtpaV07XHJcbiAgICAgIGxldCBpc1RpbWUgPSBkLnVuaXRzLnRvTG93ZXJDYXNlKCkgPT0gJ21pbnV0ZXMnO1xyXG4gICAgICAvLyBsZXQgaXNTaW5ndWxhciA9IGQudmFsdWUgPT0gMTtcclxuICAgICAgbGV0IHVuaXRMb3cgPSBkLnVuaXRzLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIGxldCBkaXNwbGF5VW5pdHMgPSBpc1RpbWUgPyBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdtaW51dGVzJykgOiB1bml0TG93LmluZGV4T2YoJ21pbGVzJykgPj0gMCA/IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ21pbGVzTG93ZXJjYXNlJykgOiBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdraWxvbWV0ZXJzTG93ZXJjYXNlJyk7XHJcbiAgICAgIGxldCBzaG9ydFVuaXRzID0gZGlzcGxheVVuaXRzLnN1YnN0cigwLCBkaXNwbGF5VW5pdHMubGVuZ3RoIC0gMSk7XHJcbiAgICAgIGxldCBzaG9ydE5hbWUgPSBkLnZhbHVlLnRvU3RyaW5nKCkgKyAnICcgKyBzaG9ydFVuaXRzICsgJyAnICsgZC50cmFuc3BvcnQ7XHJcbiAgICAgIGxldCBkZXNjVW5pdCA9IGlzVGltZSA/ICcgJyArIEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ3RpbWUtc2VtaWNvbG9uJykgKyAnICcgOiAnICcgKyBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdkaXN0YW5jZS1zZW1pY29sb24nKSArICcgJztcclxuICAgICAgbGV0IGRlc2NWYWx1ZSA9IGQudmFsdWUudG9TdHJpbmcoKSArICcgJyArIChkLnZhbHVlID09IDEgPyBzaG9ydFVuaXRzIDogZGlzcGxheVVuaXRzKTtcclxuICAgICAgbGV0IGRlc2MgPSAoZC50cmFuc3BvcnQgPT0gJ2RyaXZlJyA/IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2RyaXZlJykgOiBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCd3YWxrJykpICsgZGVzY1VuaXQgKyBkZXNjVmFsdWU7XHJcbiAgICAgIGxldCBidWZmZXIgPSB7XHJcbiAgICAgICAgJ2ZlYXR1cmUnOiB7XHJcbiAgICAgICAgICAnZ2VvbWV0cnknOiB7XHJcbiAgICAgICAgICAgICdyaW5ncyc6IGQucmluZ3MsXHJcbiAgICAgICAgICAgICdzcGF0aWFsUmVmZXJlbmNlJzogeyAnd2tpZCc6IDQzMjYgfVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgICdhdHRyaWJ1dGVzJzoge1xyXG4gICAgICAgICAgICAvLyBcIk9CSkVDVElEXCI6ICAgICAgMTksXHJcbiAgICAgICAgICAgIC8vICAgXCJSRUxJRFwiOiAgICAgICAgIFwiMDI4ZGRmMDEtYzI4MS00N2YyLTk3YmQtNGNjNTg2NDI0ODkwXCIsXHJcbiAgICAgICAgICAgICdSSU5HJzogaWksXHJcbiAgICAgICAgICAgIC8vIFwiREVTQ1JJUFRJT05cIjogICBudWxsLFxyXG4gICAgICAgICAgICAnU1lNQk9MJzoge1xyXG4gICAgICAgICAgICAgICdjb2xvcic6IFsyMDQsIDUxLCAwLCAxMjhdLFxyXG4gICAgICAgICAgICAgICdvdXRsaW5lJzoge1xyXG4gICAgICAgICAgICAgICAgJ2NvbG9yJzogWzIwNCwgNTEsIDAsIDI1NV0sXHJcbiAgICAgICAgICAgICAgICAnd2lkdGgnOiAxLjUsXHJcbiAgICAgICAgICAgICAgICAndHlwZSc6ICdlc3JpU0xTJyxcclxuICAgICAgICAgICAgICAgICdzdHlsZSc6ICdlc3JpU0xTU29saWQnXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAndHlwZSc6ICdlc3JpU0ZTJyxcclxuICAgICAgICAgICAgICAnc3R5bGUnOiAnZXNyaVNGU1NvbGlkJ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICAnbGF0aXR1ZGUnOiBkLmxhdGl0dWRlLFxyXG4gICAgICAgICdsb25naXR1ZGUnOiBkLmxvbmdpdHVkZSxcclxuICAgICAgICAnbmFtZSc6IGxvY2F0aW9uTmFtZSA/IGxvY2F0aW9uTmFtZSA6ICcnLFxyXG4gICAgICAgICdhZGRyZXNzJzogJycsXHJcbiAgICAgICAgJ3Nob3J0TmFtZSc6IHNob3J0TmFtZSxcclxuICAgICAgICAnbG9jYXRpb25OYW1lJzogbG9jYXRpb25OYW1lID8gbG9jYXRpb25OYW1lIDogJycsXHJcbiAgICAgICAgJ2Rlc2NyaXB0aW9uJzogZGVzYyxcclxuICAgICAgICAnbG9jYXRpb24nOiB7XHJcbiAgICAgICAgICAnZ2VvbWV0cnknOiB7XHJcbiAgICAgICAgICAgICd4JzogZC5sb25naXR1ZGUsXHJcbiAgICAgICAgICAgICd5JzogZC5sYXRpdHVkZSxcclxuICAgICAgICAgICAgJ3NwYXRpYWxSZWZlcmVuY2UnOiB7XHJcbiAgICAgICAgICAgICAgJ3draWQnOiAnNDMyNidcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgICdzeW1ib2wnOiB7XHJcbiAgICAgICAgICAgICd0eXBlJzogJ2VzcmlQTVMnLFxyXG4gICAgICAgICAgICAnd2lkdGgnOiAxNCxcclxuICAgICAgICAgICAgJ2hlaWdodCc6IDI2LjYsXHJcbiAgICAgICAgICAgICd4b2Zmc2V0JzogMCxcclxuICAgICAgICAgICAgJ3lvZmZzZXQnOiAxMi42LFxyXG4gICAgICAgICAgICAnY29udGVudFR5cGUnOiAnaW1hZ2UvcG5nJyxcclxuICAgICAgICAgICAgJ2ltYWdlRGF0YSc6ICdpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQk1BQUFBakNBWUFBQUIyS2pGaEFBQUN0VWxFUVZSSVMrMldTMHdUVVJTRy96dlQwa3Bma0dKNHBHQ1ZpQTFFbTlDdENRVng1UUlXaGlWUm84R2RTTnlwcUhFbGtjZ09selZoNWFwMVg2bkVpQWtRWHpHQnhrU0t0WkMwamRUU0I3U2RNWGR3Ump1ZEIrdzVxNXQ3VDc3NXozL096UjBDV2JUNHg5MEdsaDBDTUV4NDNnMUMzRklLejYvemhLd0RDSllybGRCV1pJYXVwU0RpcXNFLzNtQmptR2VNeVhMRjdHaUJ1YkVWaG1OMnNJWTZLYmxTM2tPNThCdkZYNXNvWnJiQTdlWUNXWTY3dlIyWjJhWkpBb3lxTVRMTXZMWE40N2ExZWVSaVVTcm1VU3JtaEhTR05ZQTExb0d0TXlPM0ZjVk9Zblc5eEhIOVZLVUFjdzFNZkhTYzlIa3R6dllhRU4zNEI2c3V5bVN4Q3dvenNRK1JlSGk2bjdnRzcvaU5adnY4OFc2L0lrZ2R0bCtZMmQ2STVOZlhxSlFLL2NRMU1QSFExdVo1b0ZTZVNGZFd0bjlLeTkzYi9vbHNZdlVSaFVXY1hlZjdUUGFtR21XWGZNM29QZVZBaThPSWVES0xwV2dTcnhZM3F2SVkxZ2pDbDVHT3ZuMmpDTE9hV1V5TjlzRFg2YWo1d05KYUVyZG0zeU5iS0FsbnVyQ3AwVzcwOVRoVlBReStpK0graXhWOTJPbFdDK2JHZTFWQjRzSGx4MkdzeFRQYXlxaFBreU5kdXJCN2dSV0VGbVBhc0JzWFQrRDZZSWN1N01uTHo1Z0xmOU9HMGU3TmpwM1RoVjJiWHNCU05LVU5vNTE4ZnRNTDZwMWFVSytvWndmcUpnVlJJQVhMZzQ3RTFhY0xndmtIZ3RHazFrWVRKa2ZPQ0VNcnhuSTBoYnVCWlNUU2VXbFBkODdrYXBycWVXd2tVb3BWSHhxbWRUZVBZTXFUZGVSWjlkMXN2ekFSdExuT0RsbWJPMVh2b3FwbmhNQmthVUFoSFVNMi9pVkU2T05yWlpqSW9aKzZ2NkJpWmhPWjd5dWZkampPTDd5YmVzQWFaUW9nK3FwWC9SNm9LYXlDcVlDb0tBbW1wVkNDYVlCcVlHcEFBYmFiRjh6KzN5UHhoMFhzWEpVeWNWUHVZV20zSUl5QUZraFJtUm93bC80aGRVMnVTRk9aSEZqdjdQRG0weHRDKzlWQW1zcGt3T0FPeHcxcmdXaitINHVWSDZoajA4SFNBQUFBQUVsRlRrU3VRbUNDJ1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgLy8gQWRkIGF0dHJpYnV0ZXMgdGhhdCB3ZXJlIHBhc3NlZCBpblxyXG4gICAgICBpZiAobG9jYXRpb25BdHRyaWJ1dGVzKSB7XHJcbiAgICAgICAgY29uc3QgbWVyZ2VkQXR0cmlidXRlcyA9IHtcclxuICAgICAgICAgIC4uLmxvY2F0aW9uQXR0cmlidXRlcyxcclxuICAgICAgICAgIC4uLmJ1ZmZlci5mZWF0dXJlLmF0dHJpYnV0ZXNcclxuICAgICAgICB9O1xyXG4gICAgICAgIGJ1ZmZlci5mZWF0dXJlLmF0dHJpYnV0ZXMgPSBtZXJnZWRBdHRyaWJ1dGVzO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgb2JqLmFuYWx5c2lzQXJlYXMucHVzaChidWZmZXIpO1xyXG4gICAgfVxyXG4gICAgbGV0IHMgPSBKU09OLnN0cmluZ2lmeShvYmopLnJlcGxhY2UoJ3tcImFuYWx5c2lzQXJlYXNcIicsICdcImFuYWx5c2lzQXJlYXNcIicpO1xyXG4gICAgcmV0dXJuIHMuc3Vic3RyKDAsIHMubGVuZ3RoIC0gMSk7XHJcbiAgfVxyXG4gIHN0YXRpYyBnZXRBbmFseXNpc0FyZWFzRnJvbVBvbHlnb24oZGF0YSwgbG9jYXRpb25OYW1lLCBsb2NhdGlvbkF0dHJpYnV0ZXMpIHtcclxuICAgIGlmICghZGF0YSB8fCAhZGF0YS5yaW5ncyB8fCAhZGF0YS5zcGF0aWFsIHx8ICFkYXRhLmxhdGl0dWRlIHx8ICFkYXRhLmxvbmdpdHVkZSkge1xyXG4gICAgICBEZWJ1Z0xvZy5sb2coJ2dldEFuYWx5c2lzQXJlYXNGcm9tUG9seWdvbicsICdpbnZhbGlkIGFyZ3MnLCBkYXRhKTtcclxuICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgb2JqID0ge1xyXG4gICAgICBhbmFseXNpc0FyZWFzOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgZmVhdHVyZToge1xyXG4gICAgICAgICAgICBuYW1lOiBsb2NhdGlvbk5hbWUgPyBsb2NhdGlvbk5hbWUgOiAnJyxcclxuICAgICAgICAgICAgZ2VvbWV0cnk6IHtcclxuICAgICAgICAgICAgICByaW5nczogZGF0YS5yaW5ncyxcclxuICAgICAgICAgICAgICBzcGF0aWFsUmVmZXJlbmNlOiBkYXRhLnNwYXRpYWxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgYXR0cmlidXRlczoge1xyXG4gICAgICAgICAgICAgIFJJTkc6IDEsXHJcbiAgICAgICAgICAgICAgU1lNQk9MOiB7XHJcbiAgICAgICAgICAgICAgICBjb2xvcjogWzIwNCwgNTEsIDAsIDEyOF0sXHJcbiAgICAgICAgICAgICAgICBvdXRsaW5lOiB7XHJcbiAgICAgICAgICAgICAgICAgIGNvbG9yOiBbMjA0LCA1MSwgMCwgMjU1XSxcclxuICAgICAgICAgICAgICAgICAgd2lkdGg6IDEuNSxcclxuICAgICAgICAgICAgICAgICAgdHlwZTogJ2VzcmlTTFMnLFxyXG4gICAgICAgICAgICAgICAgICBzdHlsZTogJ2VzcmlTTFNTb2xpZCdcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB0eXBlOiAnZXNyaVNGUycsXHJcbiAgICAgICAgICAgICAgICBzdHlsZTogJ2VzcmlTRlNTb2xpZCdcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBuYW1lOiBsb2NhdGlvbk5hbWUgPyBsb2NhdGlvbk5hbWUgOiAnJyxcclxuICAgICAgICAgIGxhdGl0dWRlOiBkYXRhLmxhdGl0dWRlLFxyXG4gICAgICAgICAgbG9uZ2l0dWRlOiBkYXRhLmxvbmdpdHVkZSxcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBsb2NhdGlvbk5hbWUgPyBsb2NhdGlvbk5hbWUgOiAnZmVhdHVyZSBwb2x5Z29uJ1xyXG4gICAgICAgICAgLy8gbG9jYXRpb246IHtcclxuICAgICAgICAgIC8vICAgZ2VvbWV0cnk6IHtcclxuICAgICAgICAgIC8vICAgICB4OiBkYXRhLmxvbmdpdHVkZSxcclxuICAgICAgICAgIC8vICAgICB5OiBkYXRhLmxhdGl0dWRlLFxyXG4gICAgICAgICAgLy8gICAgIHNwYXRpYWxSZWZlcmVuY2U6IHtcclxuICAgICAgICAgIC8vICAgICAgIHdraWQ6IDQzMjYsXHJcbiAgICAgICAgICAvLyAgICAgfSxcclxuICAgICAgICAgIC8vICAgfSxcclxuICAgICAgICAgIC8vICAgc3ltYm9sOiB7XHJcbiAgICAgICAgICAvLyAgICAgdHlwZTogJ2VzcmlQTVMnLFxyXG4gICAgICAgICAgLy8gICAgIHdpZHRoOiAxNCxcclxuICAgICAgICAgIC8vICAgICBoZWlnaHQ6IDI2LjYsXHJcbiAgICAgICAgICAvLyAgICAgeG9mZnNldDogMCxcclxuICAgICAgICAgIC8vICAgICB5b2Zmc2V0OiAxMi42LFxyXG4gICAgICAgICAgLy8gICAgIGNvbnRlbnRUeXBlOiAnaW1hZ2UvcG5nJyxcclxuICAgICAgICAgIC8vICAgICBpbWFnZURhdGE6ICdpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQk1BQUFBakNBWUFBQUIyS2pGaEFBQUN0VWxFUVZSSVMrMldTMHdUVVJTRy96dlQwa3Bma0dKNHBHQ1ZpQTFFbTlDdENRVng1UUlXaGlWUm84R2RTTnlwcUhFbGtjZ09selZoNWFwMVg2bkVpQWtRWHpHQnhrU0t0WkMwamRUU0I3U2RNWGR3Ump1ZEIrdzVxNXQ3VDc3NXozL096UjBDV2JUNHg5MEdsaDBDTUV4NDNnMUMzRklLejYvemhLd0RDSllybGRCV1pJYXVwU0RpcXNFLzNtQmptR2VNeVhMRjdHaUJ1YkVWaG1OMnNJWTZLYmxTM2tPNThCdkZYNXNvWnJiQTdlWUNXWTY3dlIyWjJhWkpBb3lxTVRMTXZMWE40N2ExZWVSaVVTcm1VU3JtaEhTR05ZQTExb0d0TXlPM0ZjVk9Zblc5eEhIOVZLVUFjdzFNZkhTYzlIa3R6dllhRU4zNEI2c3V5bVN4Q3dvenNRK1JlSGk2bjdnRzcvaU5adnY4OFc2L0lrZ2R0bCtZMmQ2STVOZlhxSlFLL2NRMU1QSFExdVo1b0ZTZVNGZFd0bjlLeTkzYi9vbHNZdlVSaFVXY1hlZjdUUGFtR21XWGZNM29QZVZBaThPSWVES0xwV2dTcnhZM3F2SVkxZ2pDbDVHT3ZuMmpDTE9hV1V5TjlzRFg2YWo1d05KYUVyZG0zeU5iS0FsbnVyQ3AwVzcwOVRoVlBReStpK0graXhWOTJPbFdDK2JHZTFWQjRzSGx4MkdzeFRQYXlxaFBreU5kdXJCN2dSV0VGbVBhc0JzWFQrRDZZSWN1N01uTHo1Z0xmOU9HMGU3TmpwM1RoVjJiWHNCU05LVU5vNTE4ZnRNTDZwMWFVSytvWndmcUpnVlJJQVhMZzQ3RTFhY0xndmtIZ3RHazFrWVRKa2ZPQ0VNcnhuSTBoYnVCWlNUU2VXbFBkODdrYXBycWVXd2tVb3BWSHhxbWRUZVBZTXFUZGVSWjlkMXN2ekFSdExuT0RsbWJPMVh2b3FwbmhNQmthVUFoSFVNMi9pVkU2T05yWlpqSW9aKzZ2NkJpWmhPWjd5dWZkampPTDd5YmVzQWFaUW9nK3FwWC9SNm9LYXlDcVlDb0tBbW1wVkNDYVlCcVlHcEFBYmFiRjh6KzN5UHhoMFhzWEpVeWNWUHVZV20zSUl5QUZraFJtUm93bC80aGRVMnVTRk9aSEZqdjdQRG0weHRDKzlWQW1zcGt3T0FPeHcxcmdXaitINHVWSDZoajA4SFNBQUFBQUVsRlRrU3VRbUNDJyxcclxuICAgICAgICAgIC8vICAgfSxcclxuICAgICAgICAgIC8vIH0sXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgICB9O1xyXG4gICAgLy8gQWRkIGF0dHJpYnV0ZXMgdGhhdCB3ZXJlIHBhc3NlZCBpblxyXG4gICAgaWYgKGxvY2F0aW9uQXR0cmlidXRlcykge1xyXG4gICAgICBjb25zdCBtZXJnZWRBdHRyaWJ1dGVzID0ge1xyXG4gICAgICAgIC4uLmxvY2F0aW9uQXR0cmlidXRlcyxcclxuICAgICAgICAuLi5vYmouYW5hbHlzaXNBcmVhc1swXS5mZWF0dXJlLmF0dHJpYnV0ZXNcclxuICAgICAgfTtcclxuICAgICAgb2JqLmFuYWx5c2lzQXJlYXNbMF0uZmVhdHVyZS5hdHRyaWJ1dGVzID0gbWVyZ2VkQXR0cmlidXRlcztcclxuICAgIH1cclxuICAgIGxldCBzID0gSlNPTi5zdHJpbmdpZnkob2JqKS5yZXBsYWNlKCd7XCJhbmFseXNpc0FyZWFzXCInLCAnXCJhbmFseXNpc0FyZWFzXCInKTtcclxuICAgIHJldHVybiBzLnN1YnN0cigwLCBzLmxlbmd0aCAtIDEpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiBUYWtlcyBkYXRhIHJldHVybmVkIGZyb20gZ2V0QnVmZmVycyBmb3IgRFQvV1QgYW5kIHJldHVybnNcclxuICAgKiBqc29uIGFuYWx5c2lzIGFyZWFzXHJcbiAgICogQHBhcmFtIGRhdGFcclxuICAgKiBAcmV0dXJuIHtzdHJpbmd9XHJcbiAgICovXHJcbiAgc3RhdGljIGdldEFuYWx5c2lzQXJlYXNGcm9tRW5yaWNoQnVmZmVycyhkYXRhLCBsb2NhdGlvbk5hbWUsIGxvY2F0aW9uQXR0cmlidXRlcykge1xyXG4gICAgaWYgKCFkYXRhIHx8IGRhdGEubGVuZ3RoIDw9IDApIHtcclxuICAgICAgRGVidWdMb2cubG9nKCdnZXRBbmFseXNpc0FyZWFzRnJvbUVucmljaEJ1ZmZlcnMnLCAnaW52YWxpZCBhcmdzJywgZGF0YSk7XHJcbiAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuICAgIGNvbnN0IG9iaiA9IHtcclxuICAgICAgYW5hbHlzaXNBcmVhczogW10sXHJcbiAgICAgIHNwYXRpYWxSZWZlcmVuY2U6IGRhdGFbMF0uc3BhdGlhbFxyXG4gICAgfTtcclxuICAgIGxldCBsYXQsIGxvbjtcclxuICAgIGZvciAobGV0IGlpID0gMDsgaWkgPCBkYXRhLmxlbmd0aDsgaWkrKykge1xyXG4gICAgICBsZXQgYnVmZmVyID0gZGF0YVtpaV07XHJcbiAgICAgIGlmICghYnVmZmVyIHx8ICFidWZmZXIubGF0aXR1ZGUgfHwgIWJ1ZmZlci5sb25naXR1ZGUgfHwgIWJ1ZmZlci5yaW5ncylcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgbGV0IGlzVGltZSA9IGJ1ZmZlci51bml0cy50b0xvd2VyQ2FzZSgpID09ICdtaW51dGVzJztcclxuICAgICAgbGV0IGlzU2luZ3VsYXIgPSBidWZmZXIudmFsdWUgPT0gMTtcclxuICAgICAgbGV0IHVuaXRMb3cgPSBidWZmZXIudW5pdHMudG9Mb3dlckNhc2UoKTtcclxuICAgICAgbGV0IGRpc3BsYXlVbml0cyA9IGlzVGltZSA/IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ21pbnV0ZXMnKSA6IHVuaXRMb3cudG9Mb3dlckNhc2UoKS5pbmRleE9mKCdtaWxlcycpID49IDAgPyBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdtaWxlc0xvd2VyY2FzZScpIDogQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bigna2lsb21ldGVyc0xvd2VyY2FzZScpO1xyXG4gICAgICBsZXQgc2hvcnRVbml0cyA9IGRpc3BsYXlVbml0cy5zdWJzdHIoMCwgZGlzcGxheVVuaXRzLmxlbmd0aCAtIDEpO1xyXG4gICAgICBsZXQgc2hvcnROYW1lID0gYnVmZmVyLnZhbHVlLnRvU3RyaW5nKCkgKyAnICcgKyBzaG9ydFVuaXRzICsgJyAnICsgYnVmZmVyLnRyYW5zcG9ydDtcclxuICAgICAgbGV0IGRlc2NVbml0ID0gaXNUaW1lID8gJyAnICsgQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bigndGltZS1zZW1pY29sb24nKSArICcgJyA6ICcgJyArIEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2Rpc3RhbmNlLXNlbWljb2xvbicpICsgJyAnO1xyXG4gICAgICBsZXQgZGVzY1ZhbHVlID0gYnVmZmVyLnZhbHVlLnRvU3RyaW5nKCkgKyAnICcgKyAoaXNTaW5ndWxhciA/IHNob3J0VW5pdHMgOiBkaXNwbGF5VW5pdHMpO1xyXG4gICAgICBsZXQgZGVzYyA9IChidWZmZXIudHJhbnNwb3J0ID09ICdkcml2ZScgPyBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdkcml2ZScpIDogQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignd2FsaycpKSArIGRlc2NVbml0ICsgZGVzY1ZhbHVlO1xyXG4gICAgICBpZiAoIWxhdClcclxuICAgICAgICBsYXQgPSBidWZmZXIubGF0aXR1ZGU7XHJcbiAgICAgIGlmICghbG9uKVxyXG4gICAgICAgIGxvbiA9IGJ1ZmZlci5sb25naXR1ZGU7XHJcbiAgICAgIGxldCBhcmVhID0ge1xyXG4gICAgICAgIGZlYXR1cmU6IHtcclxuICAgICAgICAgIGdlb21ldHJ5OiB7XHJcbiAgICAgICAgICAgIHJpbmdzOiBidWZmZXIucmluZ3NcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7XHJcbiAgICAgICAgICAgIFJJTkc6IDEsXHJcbiAgICAgICAgICAgIFNZTUJPTDoge1xyXG4gICAgICAgICAgICAgIGNvbG9yOiBbMjA0LCA1MSwgMCwgMTI4XSxcclxuICAgICAgICAgICAgICBvdXRsaW5lOiB7XHJcbiAgICAgICAgICAgICAgICBjb2xvcjogWzIwNCwgNTEsIDAsIDI1NV0sXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogMS41LFxyXG4gICAgICAgICAgICAgICAgdHlwZTogJ2VzcmlTTFMnLFxyXG4gICAgICAgICAgICAgICAgc3R5bGU6ICdlc3JpU0xTU29saWQnXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICB0eXBlOiAnZXNyaVNGUycsXHJcbiAgICAgICAgICAgICAgc3R5bGU6ICdlc3JpU0ZTU29saWQnXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGxhdGl0dWRlOiBsYXQsXHJcbiAgICAgICAgbG9uZ2l0dWRlOiBsb24sXHJcbiAgICAgICAgZGVzY3JpcHRpb246IGRlc2MsXHJcbiAgICAgICAgc2hvcnROYW1lOiBzaG9ydE5hbWUsXHJcbiAgICAgICAgbmFtZTogbG9jYXRpb25OYW1lID8gbG9jYXRpb25OYW1lIDogJycsXHJcbiAgICAgICAgbG9jYXRpb246IHtcclxuICAgICAgICAgIGdlb21ldHJ5OiB7XHJcbiAgICAgICAgICAgIHg6IGxvbixcclxuICAgICAgICAgICAgeTogbGF0LFxyXG4gICAgICAgICAgICBzcGF0aWFsUmVmZXJlbmNlOiB7XHJcbiAgICAgICAgICAgICAgd2tpZDogNDMyNlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgc3ltYm9sOiB7XHJcbiAgICAgICAgICAgIHR5cGU6ICdlc3JpUE1TJyxcclxuICAgICAgICAgICAgd2lkdGg6IDE0LFxyXG4gICAgICAgICAgICBoZWlnaHQ6IDI2LjYsXHJcbiAgICAgICAgICAgIHhvZmZzZXQ6IDAsXHJcbiAgICAgICAgICAgIHlvZmZzZXQ6IDEyLjYsXHJcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnaW1hZ2UvcG5nJyxcclxuICAgICAgICAgICAgaW1hZ2VEYXRhOiAnaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUJNQUFBQWpDQVlBQUFCMktqRmhBQUFDdFVsRVFWUklTKzJXUzB3VFVSU0cvenZUMGtwZmtHSjRwR0NWaUExRW05Q3RDUVZ4NVFJV2hpVlJvOEdkU055cHFIRWxrY2dPbHpWaDVhcDFYNm5FaUFrUVh6R0J4a1NLdFpDMGpkVFNCN1NkTVhkd1JqdWRCK3c1cTV0N1Q3NzV6My9PelIwQ1diVDR4OTBHbGgwQ01FeDQzZzFDM0ZJS3o2L3poS3dEQ0pZcmxkQldaSWF1cFNEaXFzRS8zbUJqbUdlTXlYTEY3R2lCdWJFVmhtTjJzSVk2S2JsUzNrTzU4QnZGWDVzb1pyYkE3ZVlDV1k2N3ZSMloyYVpKQW95cU1UTE12TFhONDdhMWVlUmlVU3JtVVNybWhIU0dOWUExMW9HdE15TzNGY1ZPWW5XOXhISDlWS1VBY3cxTWZIU2M5SGt0enZZYUVOMzRCNnN1eW1TeEN3b3pzUStSZUhpNm43Z0c3L2lOWnZ2ODhXNi9Ja2dkdGwrWTJkNkk1TmZYcUpRSy9jUTFNUEhRMXVaNW9GU2VTRmRXdG45S3k5M2Ivb2xzWXZVUmhVV2NYZWY3VFBhbUdtV1hmTTNvUGVWQWk4T0llREtMcFdnU3J4WTNxdklZMWdqQ2w1R092bjJqQ0xPYVdVeU45c0RYNmFqNXdOSmFFcmRtM3lOYktBbG51ckNwMFc3MDlUaFZQUXkraStIK2l4VjkyT2xXQytiR2UxVkI0c0hseDJHc3hUUGF5cWhQa3lOZHVyQjdnUldFRm1QYXNCc1hUK0Q2WUljdTdNbkx6NWdMZjlPRzBlN05qcDNUaFYyYlhzQlNOS1VObzUxOGZ0TUw2cDFhVUsrb1p3ZnFKZ1ZSSUFYTGc0N0UxYWNMZ3ZrSGd0R2sxa1lUSmtmT0NFTXJ4bkkwaGJ1QlpTVFNlV2xQZDg3a2FwcnFlV3drVW9wVkh4cW1kVGVQWU1xVGRlUlo5ZDFzdnpBUnRMbk9EbG1iTzFYdm9xcG5oTUJrYVVBaEhVTTIvaVZFNk9OclpaaklvWis2djZCaVpoT1o3eXVmZGpqT0w3eWJlc0FhWlFvZytxcFgvUjZvS2F5Q3FZQ29LQW1tcFZDQ2FZQnFZR3BBQWJhYkY4eiszeVB4aDBYc1hKVXljVlB1WVdtM0lJeUFGa2hSbVJvd2wvNGhkVTJ1U0ZPWkhGanY3UERtMHh0Qys5VkFtc3Brd09BT3h3MXJnV2orSDR1Vkg2aGowOEhTQUFBQUFFbEZUa1N1UW1DQydcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIC8vIEFkZCBhdHRyaWJ1dGVzIHRoYXQgd2VyZSBwYXNzZWQgaW5cclxuICAgICAgaWYgKGxvY2F0aW9uQXR0cmlidXRlcykge1xyXG4gICAgICAgIGNvbnN0IG1lcmdlZEF0dHJpYnV0ZXMgPSB7XHJcbiAgICAgICAgICAuLi5sb2NhdGlvbkF0dHJpYnV0ZXMsXHJcbiAgICAgICAgICAuLi5hcmVhLmZlYXR1cmUuYXR0cmlidXRlc1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgYXJlYS5mZWF0dXJlLmF0dHJpYnV0ZXMgPSBtZXJnZWRBdHRyaWJ1dGVzO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgb2JqLmFuYWx5c2lzQXJlYXMucHVzaChhcmVhKTtcclxuICAgIH1cclxuICAgIGxldCBzID0gSlNPTi5zdHJpbmdpZnkob2JqKS5yZXBsYWNlKCd7XCJhbmFseXNpc0FyZWFzXCInLCAnXCJhbmFseXNpc0FyZWFzXCInKTtcclxuICAgIHJldHVybiBzLnN1YnN0cigwLCBzLmxlbmd0aCAtIDEpO1xyXG4gIH1cclxuICBzdGF0aWMgZ2V0RGVtb1BvbHlnb24oKSB7XHJcbiAgICByZXR1cm4gJ1wiYW5hbHlzaXNBcmVhc1wiOiBbIFxcXHJcbiAgICAgIHsgXFxcclxuICAgICAgICBcImZlYXR1cmVcIjogeyBcXFxyXG4gICAgICAgICAgXCJnZW9tZXRyeVwiOiB7IFxcXHJcbiAgICAgICAgICAgIFwicmluZ3NcIjogWyBcXFxyXG4gICAgICAgICAgICAgIFsgXFxcclxuICAgICAgICAgICAgICAgIFsgXFxcclxuICAgICAgICAgICAgICAgICAgLTExOC4wMDAwODM1MDE4MDIsIFxcXHJcbiAgICAgICAgICAgICAgICAgIDM0LjA2MDkzOTYzMjI4NzcgXFxcclxuICAgICAgICAgICAgICAgIF0sIFxcXHJcbiAgICAgICAgICAgICAgICBbIFxcXHJcbiAgICAgICAgICAgICAgICAgIC0xMTguMDAwMDgzNTAxODAyLCBcXFxyXG4gICAgICAgICAgICAgICAgICAzNC4wNzAwNDA2ODEwMzg5IFxcXHJcbiAgICAgICAgICAgICAgICBdLCBcXFxyXG4gICAgICAgICAgICAgICAgWyBcXFxyXG4gICAgICAgICAgICAgICAgICAtMTE4LjAwMDA4MzUwMTgwMiwgXFxcclxuICAgICAgICAgICAgICAgICAgMzQuMDc5MTQwNzUyMjI1MSBcXFxyXG4gICAgICAgICAgICAgICAgXSwgXFxcclxuICAgICAgICAgICAgICAgIFsgXFxcclxuICAgICAgICAgICAgICAgICAgLTExOC4wMDAwODM1MDE4MDIsIFxcXHJcbiAgICAgICAgICAgICAgICAgIDM0LjA4ODIzOTg0NTcyMTYgXFxcclxuICAgICAgICAgICAgICAgIF0sIFxcXHJcbiAgICAgICAgICAgICAgICBbIFxcXHJcbiAgICAgICAgICAgICAgICAgIC0xMTcuOTg5MDk3MTc2MDU4LCBcXFxyXG4gICAgICAgICAgICAgICAgICAzNC4wODgyMzk4NDU3MjE2IFxcXHJcbiAgICAgICAgICAgICAgICBdLCBcXFxyXG4gICAgICAgICAgICAgICAgWyBcXFxyXG4gICAgICAgICAgICAgICAgICAtMTE3Ljk4OTA5NzE3NjA1OCwgXFxcclxuICAgICAgICAgICAgICAgICAgMzQuMDk3MzM3OTYxNDA0MiBcXFxyXG4gICAgICAgICAgICAgICAgXSwgXFxcclxuICAgICAgICAgICAgICAgIFsgXFxcclxuICAgICAgICAgICAgICAgICAgLTExNy45NzgxMTA4NTAzMTQsIFxcXHJcbiAgICAgICAgICAgICAgICAgIDM0LjEwNjQzNTA5OTE0ODYgXFxcclxuICAgICAgICAgICAgICAgIF0sIFxcXHJcbiAgICAgICAgICAgICAgICBbIFxcXHJcbiAgICAgICAgICAgICAgICAgIC0xMTcuOTY3MTI0NTI0NTcsIFxcXHJcbiAgICAgICAgICAgICAgICAgIDM0LjEwNjQzNTA5OTE0ODYgXFxcclxuICAgICAgICAgICAgICAgIF0sIFxcXHJcbiAgICAgICAgICAgICAgICBbIFxcXHJcbiAgICAgICAgICAgICAgICAgIC0xMTcuOTU2MTM4MTk4ODI3LCBcXFxyXG4gICAgICAgICAgICAgICAgICAzNC4xMDY0MzUwOTkxNDg2IFxcXHJcbiAgICAgICAgICAgICAgICBdLCBcXFxyXG4gICAgICAgICAgICAgICAgWyBcXFxyXG4gICAgICAgICAgICAgICAgICAtMTE3Ljk1NjEzODE5ODgyNywgXFxcclxuICAgICAgICAgICAgICAgICAgMzQuMTE1NTMxMjg3ODgyMSBcXFxyXG4gICAgICAgICAgICAgICAgXSwgXFxcclxuICAgICAgICAgICAgICAgIFsgXFxcclxuICAgICAgICAgICAgICAgICAgLTExNy45NTYxMzgxOTg4MjcsIFxcXHJcbiAgICAgICAgICAgICAgICAgIDM0LjEyNDYyNjQ2OTM3NDMgXFxcclxuICAgICAgICAgICAgICAgIF0sIFxcXHJcbiAgICAgICAgICAgICAgICBbIFxcXHJcbiAgICAgICAgICAgICAgICAgIC0xMTcuOTQ1MTUxODczMDgzLCBcXFxyXG4gICAgICAgICAgICAgICAgICAzNC4xMjQ2MjY0NjkzNzQzIFxcXHJcbiAgICAgICAgICAgICAgICBdLCBcXFxyXG4gICAgICAgICAgICAgICAgWyBcXFxyXG4gICAgICAgICAgICAgICAgICAtMTE3Ljk0NTE1MTg3MzA4MywgXFxcclxuICAgICAgICAgICAgICAgICAgMzQuMTE1NTMxMjg3ODgyMSBcXFxyXG4gICAgICAgICAgICAgICAgXSwgXFxcclxuICAgICAgICAgICAgICAgIFsgXFxcclxuICAgICAgICAgICAgICAgICAgLTExNy45NDUxNTE4NzMwODMsIFxcXHJcbiAgICAgICAgICAgICAgICAgIDM0LjEwNjQzNTA5OTE0ODYgXFxcclxuICAgICAgICAgICAgICAgIF0sIFxcXHJcbiAgICAgICAgICAgICAgICBbIFxcXHJcbiAgICAgICAgICAgICAgICAgIC0xMTcuOTQ1MTUxODczMDgzLCBcXFxyXG4gICAgICAgICAgICAgICAgICAzNC4wOTczMzc5NjE0MDQyIFxcXHJcbiAgICAgICAgICAgICAgICBdLCBcXFxyXG4gICAgICAgICAgICAgICAgWyBcXFxyXG4gICAgICAgICAgICAgICAgICAtMTE3Ljk0NTE1MTg3MzA4MywgXFxcclxuICAgICAgICAgICAgICAgICAgMzQuMDg4MjM5ODQ1NzIxNiBcXFxyXG4gICAgICAgICAgICAgICAgXSwgXFxcclxuICAgICAgICAgICAgICAgIFsgXFxcclxuICAgICAgICAgICAgICAgICAgLTExNy45NDUxNTE4NzMwODMsIFxcXHJcbiAgICAgICAgICAgICAgICAgIDM0LjA3OTE0MDc1MjIyNTEgXFxcclxuICAgICAgICAgICAgICAgIF0sIFxcXHJcbiAgICAgICAgICAgICAgICBbIFxcXHJcbiAgICAgICAgICAgICAgICAgIC0xMTcuOTU2MTM4MTk4ODI3LCBcXFxyXG4gICAgICAgICAgICAgICAgICAzNC4wNzkxNDA3NTIyMjUxIFxcXHJcbiAgICAgICAgICAgICAgICBdLCBcXFxyXG4gICAgICAgICAgICAgICAgWyBcXFxyXG4gICAgICAgICAgICAgICAgICAtMTE3Ljk1NjEzODE5ODgyNywgXFxcclxuICAgICAgICAgICAgICAgICAgMzQuMDcwMDQwNjgxMDM4OSBcXFxyXG4gICAgICAgICAgICAgICAgXSwgXFxcclxuICAgICAgICAgICAgICAgIFsgXFxcclxuICAgICAgICAgICAgICAgICAgLTExNy45NjcxMjQ1MjQ1NywgXFxcclxuICAgICAgICAgICAgICAgICAgMzQuMDcwMDQwNjgxMDM4OSBcXFxyXG4gICAgICAgICAgICAgICAgXSwgXFxcclxuICAgICAgICAgICAgICAgIFsgXFxcclxuICAgICAgICAgICAgICAgICAgLTExNy45NzgxMTA4NTAzMTQsIFxcXHJcbiAgICAgICAgICAgICAgICAgIDM0LjA3MDA0MDY4MTAzODkgXFxcclxuICAgICAgICAgICAgICAgIF0sIFxcXHJcbiAgICAgICAgICAgICAgICBbIFxcXHJcbiAgICAgICAgICAgICAgICAgIC0xMTcuOTc4MTEwODUwMzE0LCBcXFxyXG4gICAgICAgICAgICAgICAgICAzNC4wNjA5Mzk2MzIyODc3IFxcXHJcbiAgICAgICAgICAgICAgICBdLCBcXFxyXG4gICAgICAgICAgICAgICAgWyBcXFxyXG4gICAgICAgICAgICAgICAgICAtMTE3Ljk4OTA5NzE3NjA1OCwgXFxcclxuICAgICAgICAgICAgICAgICAgMzQuMDYwOTM5NjMyMjg3NyBcXFxyXG4gICAgICAgICAgICAgICAgXSwgXFxcclxuICAgICAgICAgICAgICAgIFsgXFxcclxuICAgICAgICAgICAgICAgICAgLTExOC4wMDAwODM1MDE4MDIsIFxcXHJcbiAgICAgICAgICAgICAgICAgIDM0LjA2MDkzOTYzMjI4NzcgXFxcclxuICAgICAgICAgICAgICAgIF0gXFxcclxuICAgICAgICAgICAgICBdIFxcXHJcbiAgICAgICAgICAgIF0sIFxcXHJcbiAgICAgICAgICAgIFwic3BhdGlhbFJlZmVyZW5jZVwiOiB7IFxcXHJcbiAgICAgICAgICAgICAgXCJ3a2lkXCI6IDQzMjYgXFxcclxuICAgICAgICAgICAgfSBcXFxyXG4gICAgICAgICAgfSwgXFxcclxuICAgICAgICAgIFwiYXR0cmlidXRlc1wiOiB7IFxcXHJcbiAgICAgICAgICAgIFwiT0JKRUNUSURcIjogNiwgXFxcclxuICAgICAgICAgICAgXCJOQU1FXCI6IFwiMDYgMTAzXCIsIFxcXHJcbiAgICAgICAgICAgIFwiREVTQ1JJUFRJT05cIjogXCJBcmVhOiA4LjEgc3F1YXJlIG1pbGVzXCIsIFxcXHJcbiAgICAgICAgICAgIFwiQ1JFQVRFRFwiOiAxNTE4NzM2OTIyOTc3LCBcXFxyXG4gICAgICAgICAgICBcIk1PRElGSUVEXCI6IDE1MTg3MzY5MjI5NzcsIFxcXHJcbiAgICAgICAgICAgIFwiQ1JFQVRPUlwiOiBcImZhc2lsX2JhXCIsIFxcXHJcbiAgICAgICAgICAgIFwiRURJVE9SXCI6IFwiZmFzaWxfYmFcIiwgXFxcclxuICAgICAgICAgICAgXCJSRUdJT05cIjogXCJVU1wiLCBcXFxyXG4gICAgICAgICAgICBcIkZMQUdTXCI6IDIsIFxcXHJcbiAgICAgICAgICAgIFwiU1lNQk9MXCI6IHtcXFwiY29sb3JcXFwiOlsyNTUsMjU1LDE3OCwyMzBdLFxcXCJvdXRsaW5lXFxcIjp7XFxcImNvbG9yXFxcIjpbMCwwLDAsMjU1XSxcXFwid2lkdGhcXFwiOjEuNSxcXFwidHlwZVxcXCI6XFxcImVzcmlTTFNcXFwiLFxcXCJzdHlsZVxcXCI6XFxcImVzcmlTTFNTb2xpZFxcXCIsXFxcIm1hcmtlclxcXCI6bnVsbH0sXFxcInR5cGVcXFwiOlxcXCJlc3JpU0ZTXFxcIixcXFwic3R5bGVcXFwiOlxcXCJlc3JpU0ZTU29saWRcXFwifSwgXFxcclxuICAgICAgICAgICAgXCJTVEFURUZQXCI6IFwiMDZcIiwgXFxcclxuICAgICAgICAgICAgXCJVTlNETEVBXCI6IFwiMDM2OTBcIiwgXFxcclxuICAgICAgICAgICAgXCJHRU9JRFwiOiBcIjA2MDM2OTBcIiwgXFxcclxuICAgICAgICAgICAgXCJOQU1FX1wiOiBcIkJhbGR3aW4gUGFyayBVbmlmaWVkIFNjaG9vbCBEaXN0cmljdFwiLCBcXFxyXG4gICAgICAgICAgICBcIkxTQURcIjogXCIwMFwiLCBcXFxyXG4gICAgICAgICAgICBcIkxPR1JBREVcIjogXCJLR1wiLCBcXFxyXG4gICAgICAgICAgICBcIkhJR1JBREVcIjogXCIxMlwiLCBcXFxyXG4gICAgICAgICAgICBcIk1URkNDXCI6IFwiRzU0MjBcIiwgXFxcclxuICAgICAgICAgICAgXCJTRFRZUFwiOiBcIiBcIiwgXFxcclxuICAgICAgICAgICAgXCJGVU5DU1RBVFwiOiBcIkVcIiwgXFxcclxuICAgICAgICAgICAgXCJBTEFORFwiOiAyMjA4MTQzMSwgXFxcclxuICAgICAgICAgICAgXCJBV0FURVJcIjogNjI2NTc0LCBcXFxyXG4gICAgICAgICAgICBcIklOVFBUTEFUXCI6IFwiKzM0LjA4OTY2MDJcIiwgXFxcclxuICAgICAgICAgICAgXCJJTlRQVExPTlwiOiBcIi0xMTcuOTY4NzIyM1wiLCBcXFxyXG4gICAgICAgICAgICBcIkdFT0lEMlwiOiA2MDM2OTAsIFxcXHJcbiAgICAgICAgICAgIFwiQ09VTlRfXCI6IDAsIFxcXHJcbiAgICAgICAgICAgIFwiQ09VTlRfMVwiOiAwLCBcXFxyXG4gICAgICAgICAgICBcIk9JRDFcIjogNzUsIFxcXHJcbiAgICAgICAgICAgIFwiWUVBUl8xXCI6IDEzMTQsIFxcXHJcbiAgICAgICAgICAgIFwiQ09VTlRZXzFcIjogMTksIFxcXHJcbiAgICAgICAgICAgIFwiRElTVFJJQ1RfMVwiOiAxOTY0Mjg3LCBcXFxyXG4gICAgICAgICAgICBcIkRJU1RSSUNUXzJcIjogXCJCYWxkd2luIFBhcmsgVW5pZmllZFwiLCBcXFxyXG4gICAgICAgICAgICBcIkdFT0dSQVBIXzFcIjogXCJCYWxkd2luIFBhcmsgVW5pZmllZCBTY2hvb2wgRGlzdHJpY3QsIENBXCIsIFxcXHJcbiAgICAgICAgICAgIFwiR0VPSURfMTJcIjogNjAzNjkwLCBcXFxyXG4gICAgICAgICAgICBcIkhJU1BfMVwiOiAxNjMxMCwgXFxcclxuICAgICAgICAgICAgXCJQQ1RISVNQXzFcIjogODYuOTEsIFxcXHJcbiAgICAgICAgICAgIFwiQU1JTkRfMVwiOiA2MiwgXFxcclxuICAgICAgICAgICAgXCJQQ1RBTUlORF8xXCI6IDAuMzMsIFxcXHJcbiAgICAgICAgICAgIFwiQVNJQU5fMVwiOiA3MzEsIFxcXHJcbiAgICAgICAgICAgIFwiUENUQVNJQU5fMVwiOiAzLjksIFxcXHJcbiAgICAgICAgICAgIFwiUEFDXzFcIjogMzIsIFxcXHJcbiAgICAgICAgICAgIFwiUENUUEFDXzFcIjogMC4xNywgXFxcclxuICAgICAgICAgICAgXCJGSUxfMVwiOiAzMjYsIFxcXHJcbiAgICAgICAgICAgIFwiUENURklMXzFcIjogMS43NCwgXFxcclxuICAgICAgICAgICAgXCJBRkFNXzFcIjogNjM1LCBcXFxyXG4gICAgICAgICAgICBcIlBDVEFGQU1fMVwiOiAzLjM4LCBcXFxyXG4gICAgICAgICAgICBcIldISVRFXzFcIjogNTUyLCBcXFxyXG4gICAgICAgICAgICBcIlBDVFdISVRFXzFcIjogMi45NCwgXFxcclxuICAgICAgICAgICAgXCJUV09PUk1PUl8xXCI6IDEwNywgXFxcclxuICAgICAgICAgICAgXCJQQ1RUV09PUl8xXCI6IDAuNTcsIFxcXHJcbiAgICAgICAgICAgIFwiTk9ORVJFUE9fMVwiOiAxMiwgXFxcclxuICAgICAgICAgICAgXCJQQ1ROT05FUl8xXCI6IDAuMDYsIFxcXHJcbiAgICAgICAgICAgIFwiVE9UQUxfMVwiOiAxODc2NywgXFxcclxuICAgICAgICAgICAgXCJOT05XSElURV8xXCI6IDE4MjAzLCBcXFxyXG4gICAgICAgICAgICBcIlBDVE5PTldIXzFcIjogOTcsIFxcXHJcbiAgICAgICAgICAgIFwiU0hBUEVfX0FyZWFcIjogbnVsbCwgXFxcclxuICAgICAgICAgICAgXCJTSEFQRV9fTGVuZ3RoXCI6IG51bGwgXFxcclxuICAgICAgICAgIH0gXFxcclxuICAgICAgICB9LCBcXFxyXG4gICAgICAgIFwibmFtZVwiOiBcIjA2IDEwM1wiLCBcXFxyXG4gICAgICAgIFwiYWRkcmVzc1wiOiBcIjA2IDEwM1wiLCBcXFxyXG4gICAgICAgIFwic2hvcnROYW1lXCI6IFwiMDYgMTAzXCIsIFxcXHJcbiAgICAgICAgXCJkZXNjcmlwdGlvblwiOiBcIkFyZWE6IDguMSBzcXVhcmUgbWlsZXNcIiBcXFxyXG4gICAgICB9XSc7XHJcbiAgfVxyXG4gIC8vIHN0YXRpYyBnZW5lcmF0ZURyaXZlVGltZShsYXQsIGxvbiwgdW5pdHMsIHZhbHVlcykge1xyXG4gIC8vXHJcbiAgLy8gfVxyXG4gIC8vXHJcbiAgLy8gc3RhdGljIGdlbmVyYXRlV2Fsa1RpbWUobGF0LCBsb24sIHVuaXRzLCB2YWx1ZXMpIHtcclxuICAvL1xyXG4gIC8vIH1cclxuICAvKlxyXG4gICAqIF9nZW5lcmF0ZVJpbmcgLSBjcmVhdGVzIGFuIGFycmF5IG9mIGFycmF5cyBvZiBsb24sbGF0IGFycmF5IGNvb3JkaW5hdGVzIHRoYXRcclxuICAgKiBkZWZpbmUgYSBjaXJjbGUgYXJvdW5kIHRoZSBnaXZlbiBsYXRpdHVkZSwgbG9uZ2l0dWRlIGF0IGEgZ2l2ZW4gcmFkaXVzLlxyXG4gICAqXHJcbiAgICogRXhhbXBsZTogIFsgW2xvbjEsbGF0MV0sIFtsb24yLGxhdDJdIF1cclxuICAgKlxyXG4gICAqICd1bml0cycgLSAnbWlsZXMnIG9yICdraWxvbWV0ZXJzJ1xyXG4gICAqICdyYWRpdXMnIC0gcmFkaXVzIG9mIGNpcmNsZSBpbiB0aGUgJ3VuaXRzJ1xyXG4gICAqL1xyXG4gIHN0YXRpYyBfZ2VuZXJhdGVSaW5nKGxhdCwgbG9uLCB1bml0cywgcmFkaXVzKSB7XHJcbiAgICBpZiAoIWxhdCB8fCAhbG9uIHx8ICh1bml0cyAhPSAnbWlsZXMnICYmIHVuaXRzICE9ICdraWxvbWV0ZXJzJykgfHwgcmFkaXVzID09IHVuZGVmaW5lZCkge1xyXG4gICAgICBMb2d6LnNob3coJyVlJywgJ0dlb21ldHJ5VXRpbCBFcnJvcjogX2dlbmVyYXRlUmluZyBpbnZhbGlkIGFyZ3M9JywgbGF0LCBsb24sIHVuaXRzLCByYWRpdXMpO1xyXG4gICAgfVxyXG4gICAgdmFyIHJlc3VsdCA9IFtdO1xyXG4gICAgZnVuY3Rpb24gZm1vZChYLCBZKSB7XHJcbiAgICAgIHJldHVybiBYICUgWTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIHRvUmFkKG4pIHtcclxuICAgICAgcmV0dXJuIG4gKiBNYXRoLlBJIC8gMTgwO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gdG9EZWcobikge1xyXG4gICAgICByZXR1cm4gbiAqIDE4MCAvIE1hdGguUEk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBlYXJ0aFJhZGl1cyA9IDYzNzEwMDA7IC8vIG1ldGVyc1xyXG4gICAgdmFyIHJhZEluTWV0ZXJzID0gKHVuaXRzID09ICdtaWxlcycpID8gcmFkaXVzICogMTYwOS4zNDQgOiByYWRpdXMgKiAxMDAwO1xyXG4gICAgdmFyIHJMYXQgPSB0b1JhZChsYXQpO1xyXG4gICAgdmFyIHJMb24gPSB0b1JhZChsb24pO1xyXG4gICAgdmFyIGRfcmFkID0gcmFkSW5NZXRlcnMgLyBlYXJ0aFJhZGl1cztcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IDM2MDsgaSArPSA0KSB7XHJcbiAgICAgIHZhciByYWRpYWwgPSB0b1JhZChpKTtcclxuICAgICAgdmFyIGxhdF9yYWQgPSBNYXRoLmFzaW4oTWF0aC5zaW4ockxhdCkgKiBNYXRoLmNvcyhkX3JhZCkgKyBNYXRoLmNvcyhyTGF0KSAqIE1hdGguc2luKGRfcmFkKSAqIE1hdGguY29zKHJhZGlhbCkpO1xyXG4gICAgICB2YXIgZGxvbl9yYWQgPSBNYXRoLmF0YW4yKE1hdGguc2luKHJhZGlhbCkgKiBNYXRoLnNpbihkX3JhZCkgKiBNYXRoLmNvcyhyTGF0KSwgTWF0aC5jb3MoZF9yYWQpIC0gTWF0aC5zaW4ockxhdCkgKiBNYXRoLnNpbihsYXRfcmFkKSk7XHJcbiAgICAgIHZhciBsb25fcmFkID0gZm1vZCgockxvbiArIGRsb25fcmFkICsgTWF0aC5QSSksIDIgKiBNYXRoLlBJKSAtIE1hdGguUEk7XHJcbiAgICAgIGxldCBjb29yZCA9IFtdO1xyXG4gICAgICBjb29yZC5wdXNoKHRvRGVnKGxvbl9yYWQpKTtcclxuICAgICAgY29vcmQucHVzaCh0b0RlZyhsYXRfcmFkKSk7XHJcbiAgICAgIHJlc3VsdC5wdXNoKGNvb3JkKTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG59XG5cbi8qKiBJbmZvZ3JhcGhpY0NhcmRcclxuICpcclxuICogIFRoaXMgY2xhc3MgcHJvdmlkZXMgc3VwcG9ydCBmb3IgZGlzcGxheWluZyBhbiBpbmZvZ3JhcGhpYyBpbnNpZGVcclxuICogIGFuIGlmcmFtZSBlbGVtZW50LlxyXG4gKi9cclxuY2xhc3MgSW5mb2dyYXBoaWNDYXJkIHtcclxuICBjb25zdHJ1Y3Rvcih1c2VybmFtZSwgdG9rZW4sIGVudiwgb3B0aW9ucykge1xyXG4gICAgdGhpcy5nZW9lbnJpY2htZW50VXJsID0gJyc7XHJcbiAgICB0aGlzLnBvcnRhbFVybCA9ICcnO1xyXG4gICAgdGhpcy5wb3J0YWxPbmxpbmVHRVByb3h5ID0gZmFsc2U7XHJcbiAgICB0aGlzLmxhbmdDb2RlID0gJ2VuLXVzJzsgLy8gW09QVElPTkFMXSBkZWZhdWx0IGxhbmd1YWdlIChkZWZhdWx0IGlzIGVuLXVzKVxyXG4gICAgdGhpcy5zb3VyY2VDb3VudHJ5ID0gJ1VTJzsgLy8gW09QVElPTkFMXSBkZWZhdWx0IGNvdW50cnkgY29kZSAoZGVmYXVsdCBpcyBVUylcclxuICAgIHRoaXMuYnVmZmVyVHlwZSA9ICdyaW5nJztcclxuICAgIHRoaXMuYnVmZmVyVW5pdHMgPSAnbWlsZXMnO1xyXG4gICAgdGhpcy5idWZmZXJTaXplcyA9IFsxLCAzLCA1XTtcclxuICAgIERlYnVnTG9nLnNob3dEZWJ1Z0NvbnNvbGVMb2dzID0gdHJ1ZTtcclxuICAgIHRoaXMudXNlcm5hbWUgPSB1c2VybmFtZTtcclxuICAgIHRoaXMudG9rZW4gPSB0b2tlbjtcclxuICAgIHRoaXMuZW52aXJvbm1lbnQgPSBlbnY7XHJcbiAgICB0aGlzLl9pZFByZWZpeCA9ICdiYS1pbmZvZ3JhcGhpYy1mcmFtZS0nO1xyXG4gICAgY29uc3QgZmlkID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2lkUHJlZml4KTtcclxuICAgIHRoaXMuX2lGcmFtZSA9IHsgaWQ6IGZpZC5pZCwgY29udGFpbmVyOiBudWxsLCBpbnN0YW5jZTogbnVsbCB9O1xyXG4gICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpO1xyXG4gIH1cclxuICBzZXRTaGFkb3dSb290KHJvb3QpIHtcclxuICAgIHRoaXMuX2NvbnRhaW5lclNoYWRvd1Jvb3QgPSByb290O1xyXG4gIH1cclxuICAvKipcclxuICAgKiByZXNldE9wdGlvbnMgLSByZXR1cm5zIGFsbCBvcHRpb25zIHRvIHRoZWlyIGRlZmF1bHRzXHJcbiAgICovXHJcbiAgcmVzZXRPcHRpb25zKCkge1xyXG4gICAgdGhpcy5idWZmZXJUeXBlID0gJ3JpbmcnO1xyXG4gICAgdGhpcy5idWZmZXJVbml0cyA9ICdtaWxlcyc7XHJcbiAgICB0aGlzLmJ1ZmZlclNpemVzID0gWzEsIDMsIDVdO1xyXG4gICAgdGhpcy52aWV3TW9kZSA9ICdhdXRvJzsgLy8gdmlldyBtb2RlIFtmdWxsLCBzdGFjaywgc2xpZGVzLCBzdGFjay1hbGxdXHJcbiAgICAvLyByZXBvcnRcclxuICAgIHRoaXMucmVwb3J0U2hvd0hlYWRlciA9IHRydWU7IC8vIGluZm9ncmFwaGljIHJlcG9ydCBoZWFkZXIgZGlzcGxheSBvbi9vZmZcclxuICAgIHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uUHJpbnQgPSB0cnVlOyAvLyBzaG93IHByaW50IGJ1dHRvbiBpbiBoZWFkZXIgb24vb2ZmXHJcbiAgICB0aGlzLnJlcG9ydEhlYWRlckJ1dHRvblpvb21MZXZlbCA9IHRydWU7IC8vIHNob3cgem9vbSBsZXZlbCBidXR0b24gaW4gaGVhZGVyIG9uL29mZlxyXG4gICAgdGhpcy5yZXBvcnRIZWFkZXJCdXR0b25GdWxsc2NyZWVuID0gdHJ1ZTsgLy8gc2hvdyBGdWxsc2NyZWVuIGJ1dHRvbiBpbiBoZWFkZXIgb24vb2ZmXHJcbiAgICAvLyBleHBvcnRcclxuICAgIHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uRXhjZWwgPSB0cnVlOyAvLyBzaG93IEV4Y2VsIGJ1dHRvbiBpbiBoZWFkZXIgb24vb2ZmXHJcbiAgICB0aGlzLnJlcG9ydEhlYWRlckJ1dHRvbkltYWdlID0gdHJ1ZTsgLy8gc2hvdyBpbWFnZSBidXR0b24gaW4gaGVhZGVyIG9uL29mZlxyXG4gICAgdGhpcy5yZXBvcnRIZWFkZXJCdXR0b25QZGYgPSB0cnVlOyAvLyBzaG93IFBERiBidXR0b24gaW4gaGVhZGVyIG9uL29mZlxyXG4gICAgdGhpcy5yZXBvcnRIZWFkZXJCdXR0b25EeW5IdG1sID0gdHJ1ZTsgLy8gc2hvdyBEeW5hbWljIEhUTUwgYnV0dG9uIGluIGhlYWRlciBvbi9vZmZcclxuICAgIC8vIHN0eWxlXHJcbiAgICB0aGlzLnJlcG9ydENvbG9yQmFja2dyb3VuZCA9ICcjZmZmJzsgLy8gaW5mb2dyYXBoaWMgYmFja2dyb3VuZCBjb2xvclxyXG4gICAgdGhpcy5yZXBvcnRDb2xvckhlYWRlciA9ICdibHVlJzsgLy8gaW5mb2dyYXBoaWMgaGVhZGVyIGNvbG9yXHJcbiAgICB0aGlzLnJlcG9ydENvbG9ySGVhZGVyVGV4dCA9ICcjZmZmJzsgLy8gaW5mb2dyYXBoaWMgaGVhZGVyIHRleHQgY29sb3JcclxuICAgIC8vIG1hcFxyXG4gICAgdGhpcy5ydW5SZXBvcnRPbkNsaWNrID0gdHJ1ZTsgLy8gQm9vbGVhbiAtIHJ1bnMgbmV3IHJlcG9ydCBvbiBtYXAgY2xpY2tcclxuICAgIHRoaXMuc2hvd1NlYXJjaCA9IHRydWU7IC8vIEJvb2xlYW4gLSBzaG93cyBCQSBtYXAgc2VhcmNoXHJcbiAgfVxyXG4gIC8qKiBzZXRPcHRpb25zXHJcbiAgICogICAgU2V0cyBvbmUgb3IgbW9yZSBjb25maWcgYW5kIGRpc3BsYXkgb3B0aW9ucy4gIE9ubHkgdGhlIG9wdGlvbnMgdGhhdCBhcmVcclxuICAgKiAgICBmb3VuZCBpbiB0aGUgb3B0aW9ucyBhcmd1bWVudCBnZXQgY2hhbmdlZCBieSBkZWZhdWx0LiAgIElmIHRoZSAncmVzZXQnXHJcbiAgICogICAgZmxhZyBpcyBzZXQgJ3RydWUnIHRoZW4gYWxsIHRoZSBvcHRpb25zIHdpbGwgYmUgcmVzZXQgYmFjayB0byB0aGVpclxyXG4gICAqICAgIGRlZmF1bHRzIGJlZm9yZSBzZXR0aW5nIHZhbHVlcyBmb3VuZCBpbiAnb3B0aW9ucycuXHJcbiAgICpcclxuICAgKiBAcGFyYW0gb3B0aW9ucyAgIEpTT04gc3RyaW5nIHdpdGggb25seSB0aGUgb3B0aW9ucyB0byBiZSBjaGFuZ2VkXHJcbiAgICogQHBhcmFtIHJlc2V0ICAgICBib29sZWFuLCByZXNldCBvcHRpb25zIHRvIGRlZmF1bHQgYmVmb3JlIGFwcGx5aW5nICdvcHRpb25zJ1xyXG4gICAqL1xyXG4gIHNldE9wdGlvbnMob3B0aW9ucywgcmVzZXQpIHtcclxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PSB1bmRlZmluZWQgfHwgb3B0aW9ucyA9PSBudWxsIHx8ICFVdGlscy5oYXNUZXh0KG9wdGlvbnMpKVxyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAocmVzZXQpXHJcbiAgICAgICAgdGhpcy5yZXNldE9wdGlvbnMoKTtcclxuICAgICAgY29uc3Qgb3B0ID0gSlNPTi5wYXJzZShvcHRpb25zKTtcclxuICAgICAgaWYgKCFvcHQgfHwgb3B0Lmxlbmd0aCA8PSAwKVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgLy8gY29uc29sZS5sb2coJyVjIEJBQyBJbmZvZ3JhcGhpY0NhcmQgc2V0T3B0aW9ucycsICdjb2xvcjpibHVlO2ZvbnQtc2l6ZTo5cHQ7Jywgb3B0KVxyXG4gICAgICBpZiAoVXRpbHMuaGFzVGV4dChvcHQuYnVmZmVyVHlwZSkgJiYgWydyaW5nJywgJ2RyaXZldGltZScsICd3YWxrdGltZSddLmluY2x1ZGVzKG9wdC5idWZmZXJUeXBlKSlcclxuICAgICAgICB0aGlzLmJ1ZmZlclR5cGUgPSBvcHQuYnVmZmVyVHlwZTtcclxuICAgICAgaWYgKFV0aWxzLmhhc1RleHQob3B0LmJ1ZmZlclVuaXRzKSAmJiBbJ21pbGVzJywgJ2tpbG9tZXRlcnMnLCAnbWludXRlcyddLmluY2x1ZGVzKG9wdC5idWZmZXJVbml0cykpXHJcbiAgICAgICAgdGhpcy5idWZmZXJVbml0cyA9IG9wdC5idWZmZXJVbml0cztcclxuICAgICAgaWYgKG9wdC5idWZmZXJTaXplcyAmJiBvcHQuYnVmZmVyU2l6ZXMubGVuZ3RoID4gMCAmJiBvcHQuYnVmZmVyU2l6ZXMubGVuZ3RoIDw9IDMpXHJcbiAgICAgICAgdGhpcy5idWZmZXJTaXplcyA9IG9wdC5idWZmZXJTaXplcztcclxuICAgICAgaWYgKFV0aWxzLmhhc1RleHQob3B0LnZpZXdNb2RlKSAmJiBbJ2Z1bGwnLCAnc3RhY2snLCAnc2xpZGVzJywgJ3N0YWNrLWFsbCddLmluY2x1ZGVzKG9wdC52aWV3TW9kZSkpXHJcbiAgICAgICAgdGhpcy52aWV3TW9kZSA9IG9wdC52aWV3TW9kZTtcclxuICAgICAgaWYgKG9wdC5yZXBvcnQpIHtcclxuICAgICAgICBpZiAob3B0LnJlcG9ydC5zaG93SGVhZGVyICE9IHR5cGVvZiB1bmRlZmluZWQpXHJcbiAgICAgICAgICB0aGlzLnJlcG9ydFNob3dIZWFkZXIgPSBvcHQucmVwb3J0LnNob3dIZWFkZXI7XHJcbiAgICAgICAgaWYgKG9wdC5yZXBvcnQuc2hvd1pvb21MZXZlbCAhPSB0eXBlb2YgdW5kZWZpbmVkKVxyXG4gICAgICAgICAgdGhpcy5yZXBvcnRIZWFkZXJCdXR0b25ab29tTGV2ZWwgPSBvcHQucmVwb3J0LnNob3dab29tTGV2ZWw7XHJcbiAgICAgICAgaWYgKG9wdC5yZXBvcnQuc2hvd0Z1bGxzY3JlZW4gIT0gdHlwZW9mIHVuZGVmaW5lZClcclxuICAgICAgICAgIHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uRnVsbHNjcmVlbiA9IG9wdC5yZXBvcnQuc2hvd0Z1bGxzY3JlZW47XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9wdC5leHBvcnQpIHtcclxuICAgICAgICBpZiAob3B0LmV4cG9ydC5leGNlbCAhPSB0eXBlb2YgdW5kZWZpbmVkKVxyXG4gICAgICAgICAgdGhpcy5yZXBvcnRIZWFkZXJCdXR0b25FeGNlbCA9IG9wdC5leHBvcnQuZXhjZWw7XHJcbiAgICAgICAgaWYgKG9wdC5leHBvcnQuaW1hZ2UgIT0gdHlwZW9mIHVuZGVmaW5lZClcclxuICAgICAgICAgIHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uSW1hZ2UgPSBvcHQuZXhwb3J0LmltYWdlO1xyXG4gICAgICAgIGlmIChvcHQuZXhwb3J0LnBkZiAhPSB0eXBlb2YgdW5kZWZpbmVkKVxyXG4gICAgICAgICAgdGhpcy5yZXBvcnRIZWFkZXJCdXR0b25QZGYgPSBvcHQuZXhwb3J0LnBkZjtcclxuICAgICAgICBpZiAob3B0LnJlcG9ydC5wcmludCAhPSB0eXBlb2YgdW5kZWZpbmVkKVxyXG4gICAgICAgICAgdGhpcy5yZXBvcnRIZWFkZXJCdXR0b25QcmludCA9IG9wdC5leHBvcnQucHJpbnQ7XHJcbiAgICAgICAgaWYgKG9wdC5leHBvcnQuZHluYW1pY0h0bWwgIT0gdHlwZW9mIHVuZGVmaW5lZClcclxuICAgICAgICAgIHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uRHluSHRtbCA9IG9wdC5leHBvcnQuZHluYW1pY0h0bWw7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9wdC5zdHlsZSkge1xyXG4gICAgICAgIGlmIChvcHQuc3R5bGUuaWdCYWNrZ3JvdW5kQ29sb3IgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgdGhpcy5yZXBvcnRDb2xvckJhY2tncm91bmQgPSBvcHQuc3R5bGUuaWdCYWNrZ3JvdW5kQ29sb3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKG9wdC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgdGhpcy5yZXBvcnRDb2xvckJhY2tncm91bmQgPSBvcHQuc3R5bGUuYmFja2dyb3VuZENvbG9yO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob3B0LnN0eWxlLmhlYWRlckNvbG9yICE9IHR5cGVvZiB1bmRlZmluZWQpXHJcbiAgICAgICAgICB0aGlzLnJlcG9ydENvbG9ySGVhZGVyID0gb3B0LnN0eWxlLmhlYWRlckNvbG9yO1xyXG4gICAgICAgIGlmIChvcHQuc3R5bGUuaGVhZGVyVGV4dENvbG9yICE9IHR5cGVvZiB1bmRlZmluZWQpXHJcbiAgICAgICAgICB0aGlzLnJlcG9ydENvbG9ySGVhZGVyVGV4dCA9IG9wdC5zdHlsZS5oZWFkZXJUZXh0Q29sb3I7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9wdC5tYXApIHtcclxuICAgICAgICBpZiAob3B0Lm1hcC5ydW5SZXBvcnRPbkNsaWNrICE9IHR5cGVvZiB1bmRlZmluZWQpXHJcbiAgICAgICAgICB0aGlzLnJ1blJlcG9ydE9uQ2xpY2sgPSBvcHQubWFwLnJ1blJlcG9ydE9uQ2xpY2s7XHJcbiAgICAgICAgaWYgKG9wdC5tYXAuc2hvd1NlYXJjaCAhPSB0eXBlb2YgdW5kZWZpbmVkKVxyXG4gICAgICAgICAgdGhpcy5zaG93U2VhcmNoID0gb3B0Lm1hcC5zaG93U2VhcmNoO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGV4KSB7XHJcbiAgICAgIExvZ3ouc2hvdygnJWUnLCAnSW5mb2dyYXBoaWNDYXJkIGVycm9yOiAnLCBleCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG4gIC8vIGdlbmVyYXRlIGluZm9ncmFwaGljIGRpc3BsYXkgb3B0aW9uc1xyXG4gIF9jcmVhdGVJbmZvZ3JhcGhpY1BsYXllclN0eWxlT3B0aW9ucygpIHtcclxuICAgIGxldCBhcnIxID0gW107XHJcbiAgICBsZXQgYXJyMiA9IFtdO1xyXG4gICAgbGV0IGFycjMgPSBbXTtcclxuICAgIGFycjEucHVzaCgnXCJzaG93Q2xvc2VCdXR0b25cIjpmYWxzZScpO1xyXG4gICAgaWYgKHRoaXMucmVwb3J0U2hvd0hlYWRlciAhPSB1bmRlZmluZWQgJiYgdGhpcy5yZXBvcnRTaG93SGVhZGVyID09IGZhbHNlKVxyXG4gICAgICBhcnIxLnB1c2goJ1wic2hvd0hlYWRlclwiOmZhbHNlJyk7XHJcbiAgICBpZiAodGhpcy52aWV3TW9kZSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgY29uc3QgbW9kZXMgPSB7XHJcbiAgICAgICAgZnVsbDogJ2Z1bGwtcGFnZXMnLFxyXG4gICAgICAgIHN0YWNrOiAncGFuZWxzLWluLXN0YWNrJyxcclxuICAgICAgICBzbGlkZXM6ICdwYW5lbHMtaW4tc2xpZGVzJyxcclxuICAgICAgICAnc3RhY2stYWxsJzogJ3BhbmVscy1pbi1zdGFjay1hbGwnXHJcbiAgICAgIH07XHJcbiAgICAgIGxldCBtID0gbW9kZXNbdGhpcy52aWV3TW9kZV07XHJcbiAgICAgIGlmIChtKVxyXG4gICAgICAgIGFycjEucHVzaCgnXCJ2aWV3TW9kZVwiOlwiJyArIG0gKyAnXCIsXCJyZXNpemVNb2RlXCI6XCJhdXRvXCInKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnJlcG9ydEhlYWRlckJ1dHRvbkZ1bGxzY3JlZW4pXHJcbiAgICAgIGFycjEucHVzaCgnXCJzaG93RnVsbHNjcmVlbkJ1dHRvblwiOiB0cnVlJyk7XHJcbiAgICBpZiAodGhpcy5yZXBvcnRIZWFkZXJCdXR0b25ab29tTGV2ZWwpXHJcbiAgICAgIGFycjEucHVzaCgnXCJkaXNhYmxlWm9vbVwiOiB0cnVlJyk7XHJcbiAgICBpZiAodGhpcy5yZXBvcnRIZWFkZXJCdXR0b25FeGNlbClcclxuICAgICAgYXJyMi5wdXNoKCdcImV4Y2VsXCI6IHRydWUnKTtcclxuICAgIGlmICh0aGlzLnJlcG9ydEhlYWRlckJ1dHRvbkltYWdlKVxyXG4gICAgICBhcnIyLnB1c2goJ1wiaW1hZ2VcIjogdHJ1ZScpO1xyXG4gICAgaWYgKHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uUGRmKVxyXG4gICAgICBhcnIyLnB1c2goJ1wicGRmXCI6IHRydWUnKTtcclxuICAgIGlmICh0aGlzLnJlcG9ydEhlYWRlckJ1dHRvblByaW50KVxyXG4gICAgICBhcnIyLnB1c2goJ1wicHJpbnRcIjogdHJ1ZScpO1xyXG4gICAgaWYgKHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uRHluSHRtbClcclxuICAgICAgYXJyMi5wdXNoKCdcImR5bmFtaWNIdG1sXCI6IHRydWUnKTtcclxuICAgIGlmICh0aGlzLnJlcG9ydENvbG9yQmFja2dyb3VuZClcclxuICAgICAgYXJyMy5wdXNoKCdcImJhY2tncm91bmRcIjpcIicgKyB0aGlzLnJlcG9ydENvbG9yQmFja2dyb3VuZCArICdcIicpO1xyXG4gICAgaWYgKHRoaXMucmVwb3J0Q29sb3JIZWFkZXIpXHJcbiAgICAgIGFycjMucHVzaCgnXCJoZWFkZXJCYWNrZ3JvdW5kXCI6XCInICsgdGhpcy5yZXBvcnRDb2xvckhlYWRlciArICdcIicpO1xyXG4gICAgaWYgKHRoaXMucmVwb3J0Q29sb3JIZWFkZXJUZXh0KVxyXG4gICAgICBhcnIzLnB1c2goJ1wiaGVhZGVyVGV4dFwiOlwiJyArIHRoaXMucmVwb3J0Q29sb3JIZWFkZXJUZXh0ICsgJ1wiJyk7XHJcbiAgICBpZiAoYXJyMi5sZW5ndGggPiAwKVxyXG4gICAgICBhcnIxLnB1c2goJ1wiZXhwb3J0T3B0aW9uc1wiOiB7JyArIGFycjIudG9TdHJpbmcoKSArICd9Jyk7XHJcbiAgICBpZiAoYXJyMy5sZW5ndGggPiAwKVxyXG4gICAgICBhcnIxLnB1c2goJ1widGhlbWVcIjogeycgKyBhcnIzLnRvU3RyaW5nKCkgKyAnfScpO1xyXG4gICAgcmV0dXJuIGFycjEudG9TdHJpbmcoKTtcclxuICB9XHJcbiAgX3ZhbGlkYXRlU2V0dXAoKSB7XHJcbiAgICBpZiAoIVV0aWxzLmhhc1RleHQodGhpcy5lbnZpcm9ubWVudCkpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKCFVdGlscy5oYXNUZXh0KHRoaXMudG9rZW4pKSB7XHJcbiAgICAgIERlYnVnTG9nLmxvZygnSW5mb2dyYXBoaWNDYXJkJywgJ2ludmFsaWQgdG9rZW4nKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKCFVdGlscy5oYXNUZXh0KHRoaXMudXNlcm5hbWUpKSB7XHJcbiAgICAgIERlYnVnTG9nLmxvZygnSW5mb2dyYXBoaWNDYXJkJywgJ2ludmFsaWQgdXNlcm5hbWUnKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKCFVdGlscy5oYXNUZXh0KHRoaXMucmVwb3J0SWQpKSB7XHJcbiAgICAgIERlYnVnTG9nLmxvZygnSW5mb2dyYXBoaWNDYXJkJywgJ2ludmFsaWQgcmVwb3J0IElEJyk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmICghdGhpcy5yZXBvcnRMb2NhdGlvbikge1xyXG4gICAgICBpZiAoIXRoaXMucmVwb3J0R2VvbWV0cnkgJiYgIXRoaXMucmVwb3J0R2VvZ3JhcGh5KSB7XHJcbiAgICAgICAgRGVidWdMb2cubG9nKCdJbmZvZ3JhcGhpY0NhcmQnLCAnaW52YWxpZCBsb2NhdGlvbiwgZ2VvbWV0cnkgb3IgZ2VvZ3JhcGh5Jyk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgX2NoZWNrQnVmZmVyc0Fzc2lnbkRlZmF1bHRzKCkge1xyXG4gICAgaWYgKHR5cGVvZiB0aGlzLmJ1ZmZlclR5cGUgIT0gdW5kZWZpbmVkICYmIHR5cGVvZiB0aGlzLmJ1ZmZlclVuaXRzICE9IHVuZGVmaW5lZCAmJiB0eXBlb2YgdGhpcy5idWZmZXJTaXplcyAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgaWYgKCFpc05hTih0aGlzLmJ1ZmZlclNpemVzWzBdKSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiB0aGlzLmJ1ZmZlclR5cGUgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHRoaXMuYnVmZmVyVHlwZSA9ICdyaW5nJzsgLy8gZGVmYXVsdFxyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiB0aGlzLmJ1ZmZlclVuaXRzID09IHVuZGVmaW5lZCkge1xyXG4gICAgICB0aGlzLmJ1ZmZlclVuaXRzID0gJ21pbGVzJzsgLy8gZGVmYXVsdFxyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiB0aGlzLmJ1ZmZlclNpemVzID09IHVuZGVmaW5lZCB8fCBpc05hTih0aGlzLmJ1ZmZlclNpemVzWzBdKSkge1xyXG4gICAgICAvLyB1c2UgZGVmYXVsdFxyXG4gICAgICB0aGlzLmJ1ZmZlclNpemVzID0gWzFdO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKiogcmVnZW5lcmF0ZUNvbnRlbnRcclxuICAgKiAgICBSZWJ1aWxkcyB0aGUgaW5mb2dyYXBoaWMgQ2FyZCB1c2luZyBjdXJyZW50IHNldHRpbmdzXHJcbiAgICpcclxuICAgKiBAcGFyYW0gc3VnZ2VzdGVkICAgYm9vbGVhbiwgaWYgdHJ1ZSA9IHdpbGwgTk9UIHJlbmRlciB1bmxlc3MgaW5mb2dyYXBoaWMgaGFzXHJcbiAgICogICAgICAgICAgICAgICAgICAgIGFscmVhZHkgYmVlbiByZW5kZXJlZCBiZWZvcmVcclxuICAgKi9cclxuICBhc3luYyByZWdlbmVyYXRlQ29udGVudChzdWdnZXN0ZWQpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKCFzdWdnZXN0ZWQgfHwgKHNlbGYuX2lGcmFtZS5jb250YWluZXIgJiYgc2VsZi5faUZyYW1lLmluc3RhbmNlKSkge1xyXG4gICAgICAgIGlmIChzZWxmLl9pRnJhbWUuY29udGFpbmVyKSB7XHJcbiAgICAgICAgICBVdGlscy5yZW1vdmVDaGlsZHJlbihzZWxmLl9pRnJhbWUuY29udGFpbmVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2VsZi5faUZyYW1lLmluc3RhbmNlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIC8vIFJ1biByZXBvcnQgd2l0aCBjdXJyZW50IHBhcmFtZXRlcnNcclxuICAgICAgICBhd2FpdCBzZWxmLmxvYWRJbmZvZ3JhcGhpYyhzZWxmLl9pRnJhbWUuaWQsIHNlbGYuX2lGcmFtZS5jb250YWluZXIsIHNlbGYucmVwb3J0TG9jYXRpb24sIHNlbGYucmVwb3J0R2VvbWV0cnksIHNlbGYucmVwb3J0SWQsIHNlbGYucmVwb3J0R2VvZ3JhcGh5KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGV4KSB7XHJcbiAgICAgIExvZ3ouc2hvdygnJWUnLCAnSW5mb2dyYXBoaWNDYXJkOiByZWdlbmVyYXRlQ29udGVudCcsIGV4KTtcclxuICAgIH1cclxuICB9XHJcbiAgX3ZhbGlkYXRlUmVwb3J0R2VvbWV0cnkoZGF0YSkge1xyXG4gICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAobGV0IGlpID0gMDsgaWkgPCBkYXRhLmxlbmd0aDsgaWkrKykge1xyXG4gICAgICAgIGxldCByID0gZGF0YVtpaV07XHJcbiAgICAgICAgaWYgKCFyXHJcbiAgICAgICAgICB8fCAhVXRpbHMuaGFzVGV4dChyLnRyYW5zcG9ydClcclxuICAgICAgICAgIHx8ICFyLmxhdGl0dWRlXHJcbiAgICAgICAgICB8fCAhci5sb25naXR1ZGVcclxuICAgICAgICAgIHx8ICFyLnZhbHVlXHJcbiAgICAgICAgICB8fCAhVXRpbHMuaGFzVGV4dChyLnVuaXRzKVxyXG4gICAgICAgICAgfHwgIXIucmluZ3MpXHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG4gIC8qKiBfZ2V0UmVwb3J0R2VvbWV0cnlBbmFseXNpc0FyZWFzXHJcbiAgICpcclxuICAgKiAgVGFrZSB0aGUgcmVwb3J0R2VvbWV0cnkgSlMgb2JqZWN0IGFuZCBnZW5lcmF0ZXMgZ2VvbWV0cnkganNvbiBmb3JcclxuICAgKiAgRHJpdmV0aW1lcywgV2Fsa3RpbWVzLCBvciBSaW5nc1xyXG4gICAqL1xyXG4gIGFzeW5jIF9nZXRSZXBvcnRHZW9tZXRyeUFuYWx5c2lzQXJlYXMoKSB7XHJcbiAgICBsZXQganNvbiA9ICcnO1xyXG4gICAgaWYgKHRoaXMucmVwb3J0R2VvbWV0cnkpIHtcclxuICAgICAgaWYgKHRoaXMucmVwb3J0R2VvbWV0cnkudHlwZSAmJiB0aGlzLnJlcG9ydEdlb21ldHJ5LnR5cGUgPT0gJ3BvbHlnb24nKSB7XHJcbiAgICAgICAganNvbiA9IEdlb21ldHJ5VXRpbC5nZXRBbmFseXNpc0FyZWFzRnJvbVBvbHlnb24odGhpcy5yZXBvcnRHZW9tZXRyeSwgdGhpcy5yZXBvcnRMb2NhdGlvbk5hbWUsIHRoaXMucmVwb3J0TG9jYXRpb25BdHRyaWJ1dGVzKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBpZiAodGhpcy5idWZmZXJUeXBlID09ICdkcml2ZXRpbWUnIHx8IHRoaXMuYnVmZmVyVHlwZSA9PSAnd2Fsa3RpbWUnKSB7XHJcbiAgICAgICAgICBpZiAodGhpcy5fdmFsaWRhdGVSZXBvcnRHZW9tZXRyeSh0aGlzLnJlcG9ydEdlb21ldHJ5KSkge1xyXG4gICAgICAgICAgICBqc29uID0gR2VvbWV0cnlVdGlsLmdldEFuYWx5c2lzQXJlYXNGcm9tUmluZ3ModGhpcy5yZXBvcnRHZW9tZXRyeSwgdGhpcy5yZXBvcnRMb2NhdGlvbk5hbWUsIHRoaXMucmVwb3J0TG9jYXRpb25BdHRyaWJ1dGVzKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgRGVidWdMb2cubG9nKCdfZ2V0UmVwb3J0R2VvbWV0cnlBbmFseXNpc0FyZWFzJywgJ3JlcG9ydEdlb21ldHJ5IGlzIGludmFsaWQnLCB0aGlzLnJlcG9ydEdlb21ldHJ5KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKHRoaXMuYnVmZmVyVHlwZSA9PSAnZHJpdmV0aW1lJyB8fCB0aGlzLmJ1ZmZlclR5cGUgPT0gJ3dhbGt0aW1lJykge1xyXG4gICAgICAvL1xyXG4gICAgICAvLyBnZW5lcmF0ZSB0aGUgRFQvV1QgYnVmZmVycyB1c2luZyBHRSBlbnJpY2ggcmVxdWVzdFxyXG4gICAgICBUcmFuc3BvcnRVdGlsLnNldFRva2VuKHRoaXMudXNlcm5hbWUsIHRoaXMudG9rZW4pO1xyXG4gICAgICBsZXQgb2JqID0gYXdhaXQgVHJhbnNwb3J0VXRpbC5nZXRCdWZmZXJzKHRoaXMuYnVmZmVyVHlwZSwgdGhpcy5zb3VyY2VDb3VudHJ5LCB0aGlzLmJ1ZmZlclVuaXRzLCB0aGlzLmJ1ZmZlclNpemVzLCB0aGlzLnJlcG9ydExvY2F0aW9uLmxvbiwgdGhpcy5yZXBvcnRMb2NhdGlvbi5sYXQpO1xyXG4gICAgICBqc29uID0gR2VvbWV0cnlVdGlsLmdldEFuYWx5c2lzQXJlYXNGcm9tRW5yaWNoQnVmZmVycyhvYmosIHRoaXMucmVwb3J0TG9jYXRpb25OYW1lLCB0aGlzLnJlcG9ydExvY2F0aW9uQXR0cmlidXRlcyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4ganNvbjtcclxuICB9XHJcbiAgX2NoZWNrQnVmZmVycygpIHtcclxuICAgIGlmICh0eXBlb2YgdGhpcy5idWZmZXJUeXBlICE9IHVuZGVmaW5lZCAmJiB0eXBlb2YgdGhpcy5idWZmZXJVbml0cyAhPSB1bmRlZmluZWQgJiYgdHlwZW9mIHRoaXMuYnVmZmVyU2l6ZXMgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGlmICghaXNOYU4odGhpcy5idWZmZXJTaXplc1swXSkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgdGhpcy5idWZmZXJUeXBlID09IHVuZGVmaW5lZCkge1xyXG4gICAgICB0aGlzLmJ1ZmZlclR5cGUgPSAncmluZyc7IC8vIGRlZmF1bHRcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgdGhpcy5idWZmZXJVbml0cyA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdGhpcy5idWZmZXJVbml0cyA9ICdtaWxlcyc7IC8vIGRlZmF1bHRcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgdGhpcy5idWZmZXJTaXplcyA9PSB1bmRlZmluZWQgfHwgaXNOYU4odGhpcy5idWZmZXJTaXplc1swXSkpIHtcclxuICAgICAgLy8gdXNlIGRlZmF1bHRcclxuICAgICAgdGhpcy5idWZmZXJTaXplcyA9IFsxXTtcclxuICAgIH1cclxuICB9XHJcbiAgZ2VuZXJhdGVOb3RSZWFkeUh0bWwoKSB7XHJcbiAgICBsZXQgbnJJZCA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCgnbm90UmVhZHlEaXYnKTtcclxuICAgIHJldHVybiAnPGRpdiBpZD1cIicgKyBucklkICsgJ1wiIGNsYXNzPVwibm90UmVhZHlPdXRlclwiID4gXFxcclxuICAgICAgICAgIDxzdmcgY2xhc3M9XCJub3RSZWFkeVN2Z1wiIHByZXNlcnZlQXNwZWN0UmF0aW89XCJ4TWlkWU1pZCBtZWV0XCIgd2lkdGg9XCI2NlwiIGhlaWdodD1cIjU4XCI+IFxcXHJcbiAgICAgICAgICAgIDxnIHRyYW5zZm9ybT1cIm1hdHJpeCgwLjY1OTA5MDk0IDAgMCAwLjY1OTA5MDk0IDAuMDkwOTA5NjIgLTApXCI+IFxcXHJcbiAgICAgICAgICAgICAgPGc+IFxcXHJcbiAgICAgICAgICAgICAgICA8cGF0aCBcXFxyXG4gICAgICAgICAgICAgICAgICBkPVwiTTQ4LjQ0NTMxMiAwLjE1NjI1QyA0OC4xMjUgMC4yMzQzNzUgNDcuNTYyNSAwLjQ0NTMxMiA0Ny4xOTUzMTIgMC42MzI4MTJDIDQ2LjY0ODQzOCAwLjkwNjI1IDQ2LjM3NSAxLjExNzE4OCA0NS43MzQzNzUgMS43NTc4MTJDIDQ1LjI1NzgxMiAyLjIyNjU2MiA0NC43NjU2MjUgMi44MDQ2ODggNDQuNTA3ODEyIDMuMjAzMTI1QyA0My44NDM3NSA0LjIzNDM3NSAzOS4xODc1IDEyLjQ0MTQwNiAyMS4zNjcxODggNDMuOTYwOTM4QyAxNS4xNzE4NzUgNTQuOTE3OTcgNy45NzY1NjIgNjcuNjU2MjUgNS4zNzUgNzIuMjUzOTFDIDIuNzczNDM4IDc2Ljg1NTQ3IDAuNTU0Njg4IDgwLjgzMjAzIDAuNDQ1MzEyIDgxLjA4OTg0QyAtMC4xNzE4NzUgODIuNTU0NjkgLTAuMTE3MTg4IDg0LjE3MTg3NSAwLjU5Mzc1IDg1LjQ2MDk0QyAwLjcxMDkzOCA4NS42Nzk2OSAxLjA5Mzc1IDg2LjEzMjgxIDEuNDM3NSA4Ni40NzY1NkMgMi4xNDg0MzggODcuMTc5NjkgMi44MjAzMTIgODcuNTYyNSAzLjgyODEyNSA4Ny44NDM3NUwzLjgyODEyNSA4Ny44NDM3NUw0LjQyMTg3NSA4OEw1MC4zNTE1NjIgODcuOTg0Mzc1TDk2LjI4OTA2IDg3Ljk2MDk0TDk2LjkyMTg3NSA4Ny43NUMgOTkuNzU3ODEgODYuNzgxMjUgMTAwLjc4MTI1IDgzLjg1MTU2IDk5LjI5Njg3NSA4MC44ODY3MkMgOTkuMTMyODEgODAuNTUwNzggOTIuMjczNDQgNjguNTM5MDYgODQuMDU0NjkgNTQuMTgzNTk0QyA3NS44MzU5NCAzOS44MzU5MzggNjYuMDIzNDQgMjIuNjk1MzEyIDYyLjI1IDE2LjA5NzY1NkMgNTguNDY4NzUgOS41MDM5MDYgNTUuMTQ4NDM4IDMuNzUgNTQuODU5Mzc1IDMuMzIwMzEyQyA1My45Mzc1IDEuOTM3NSA1Mi43NjU2MjUgMC44OTA2MjUgNTEuNTg1OTM4IDAuNDA2MjVDIDUwLjYwOTM3NSAwIDQ5LjQ2MDkzOCAtMC4wOTM3NSA0OC40NDUzMTIgMC4xNTYyNXpNNjEgMjYuODA0Njg4QyA2Ny4xOTUzMSAzNy42MTMyOCA3Ni43NzM0NCA1NC4zMzk4NDQgODIuMjgxMjUgNjMuOTY4NzVMODIuMjgxMjUgNjMuOTY4NzVMOTIuMzA0NjkgODEuNDcyNjZMNzEuMTE3MTkgODEuNDk2MDlDIDU5LjQ2MDkzOCA4MS41MDM5MSA0MC4zODI4MTIgODEuNTAzOTEgMjguNzE4NzUgODEuNDk2MDlMMjguNzE4NzUgODEuNDk2MDlMNy41MDc4MTIgODEuNDcyNjZMMjAuNTIzNDM4IDU4LjQ1NzAzQyA0NS40Mjk2ODggMTQuNDAyMzQ0IDQ5LjYyNSA3LjAxMTcxOSA0OS42OTUzMTIgNy4wOTc2NTZDIDQ5LjcyNjU2MiA3LjEyODkwNiA1NC44MTI1IDE1Ljk5NjA5NCA2MSAyNi44MDQ2ODh6XCIgXFxcclxuICAgICAgICAgICAgICAgICAgc3Ryb2tlPVwibm9uZVwiIFxcXHJcbiAgICAgICAgICAgICAgICAgIGZpbGw9XCIjRDREN0REXCIgXFxcclxuICAgICAgICAgICAgICAgICAgZmlsbC1ydWxlPVwibm9uemVyb1wiIFxcXHJcbiAgICAgICAgICAgICAgICAvPiBcXFxyXG4gICAgICAgICAgICAgICAgPHBhdGggXFxcclxuICAgICAgICAgICAgICAgICAgZD1cIk00OS4xNDA2MjUgMjYuNDYwOTM4QyA0OS4wMzEyNSAyNi40ODQzNzUgNDguNjY0MDYyIDI2LjU3MDMxMiA0OC4zMjgxMjUgMjYuNjU2MjVDIDQ1LjI4MTI1IDI3LjQyMTg3NSA0Mi44MTI1IDMwLjM2MzI4MSA0Mi44MTI1IDMzLjE5OTIyQyA0Mi44MTI1IDMzLjU1ODU5NCA0Mi45ODQzNzUgMzUuMTgzNTk0IDQzLjIwMzEyNSAzNi44MDA3OEMgNDMuNDE0MDYyIDM4LjQxNzk3IDQ0LjA4NTkzOCA0My41IDQ0LjY4NzUgNDguMTAxNTYyQyA0Ni4yNTc4MTIgNjAuMDk3NjU2IDQ2LjI0MjE4OCA1OS45NTcwMyA0Ni4zNzUgNjAuNDU3MDNDIDQ2LjcwMzEyNSA2MS43NSA0Ny40NzY1NjIgNjIuNzgxMjUgNDguNDkyMTg4IDYzLjI4MTI1QyA0OS4wMTU2MjUgNjMuNTM5MDYyIDQ5LjE2NDA2MiA2My41NzgxMjUgNDkuODA0Njg4IDYzLjYwMTU2MkMgNTAuOTkyMTg4IDYzLjY1NjI1IDUxLjcyNjU2MiA2My4zNjcxODggNTIuNTIzNDM4IDYyLjUzOTA2MkMgNTMuMjk2ODc1IDYxLjcxODc1IDUzLjY0ODQzOCA2MC43ODkwNjIgNTMuODk4NDM4IDU4LjkxMDE1NkMgNTMuOTg0Mzc1IDU4LjI1MzkwNiA1NC4zNzUgNTUuMzAwNzggNTQuNzY1NjI1IDUyLjMzOTg0NEMgNTUuMTQ4NDM4IDQ5LjM4MjgxMiA1NS43ODkwNjIgNDQuNTU0Njg4IDU2LjE3MTg3NSA0MS41OTM3NUMgNTYuNTYyNSAzOC42NDA2MjUgNTYuOTUzMTI1IDM1LjY4MzU5NCA1Ny4wMzkwNjIgMzUuMDI3MzQ0QyA1Ny4yMjY1NjIgMzMuNjA1NDcgNTcuMjM0Mzc1IDMyLjY0NDUzIDU3LjA3MDMxMiAzMi4wMDM5MDZDIDU2LjQyOTY4OCAyOS40ODA0NjkgNTQuMjU3ODEyIDI3LjMyMDMxMiA1MS42NTYyNSAyNi42NDA2MjVDIDUxLjA3MDMxMiAyNi40ODQzNzUgNDkuNTc4MTI1IDI2LjM4MjgxMiA0OS4xNDA2MjUgMjYuNDYwOTM4elwiIFxcXHJcbiAgICAgICAgICAgICAgICAgIHN0cm9rZT1cIm5vbmVcIiBcXFxyXG4gICAgICAgICAgICAgICAgICBmaWxsPVwiI0Q0RDdERFwiIFxcXHJcbiAgICAgICAgICAgICAgICAgIGZpbGwtcnVsZT1cIm5vbnplcm9cIiBcXFxyXG4gICAgICAgICAgICAgICAgLz4gXFxcclxuICAgICAgICAgICAgICAgIDxwYXRoIFxcXHJcbiAgICAgICAgICAgICAgICAgIGQ9XCJNNDkuMzkwNjI1IDY2LjU5Mzc1QyA0Ni42OTUzMTIgNjYuOTM3NSA0NC43NSA2OS40OTIxOSA0NS4wNzgxMjUgNzIuMjY5NTNDIDQ1LjIzNDM3NSA3My41NjY0MSA0NS43NSA3NC42MjEwOSA0Ni42NzE4NzUgNzUuNDcyNjZDIDQ3LjU2MjUgNzYuMzA4NTkgNDguNTIzNDM4IDc2LjcyMjY2IDQ5LjcyNjU2MiA3Ni44MDA3OEMgNTEuMTg3NSA3Ni44ODY3MiA1Mi4zNTE1NjIgNzYuNDMzNTkgNTMuNDM3NSA3NS4zMzk4NEMgNTQuNDg0Mzc1IDc0LjI5Mjk3IDU0LjkzNzUgNzMuMjA3MDMgNTQuOTQ1MzEyIDcxLjcwNzAzQyA1NC45NTMxMjUgNzAuNzk2ODc1IDU0Ljg0Mzc1IDcwLjI3MzQ0IDU0LjQ5MjE4OCA2OS41MTU2MjVDIDUzLjU1NDY4OCA2Ny40NzY1NiA1MS41MzEyNSA2Ni4zMjAzMSA0OS4zOTA2MjUgNjYuNTkzNzV6XCIgXFxcclxuICAgICAgICAgICAgICAgICAgc3Ryb2tlPVwibm9uZVwiIFxcXHJcbiAgICAgICAgICAgICAgICAgIGZpbGw9XCIjRDREN0REXCIgXFxcclxuICAgICAgICAgICAgICAgICAgZmlsbC1ydWxlPVwibm9uemVyb1wiIFxcXHJcbiAgICAgICAgICAgICAgICAvPiBcXFxyXG4gICAgICAgICAgICAgIDwvZz4gXFxcclxuICAgICAgICAgICAgPC9nPiBcXFxyXG4gICAgICAgICAgPC9zdmc+IFxcXHJcbiAgICAgICAgPC9kaXY+JztcclxuICB9XHJcbiAgYXN5bmMgbG9hZEluZm9ncmFwaGljKGlkLCBjb250YWluZXIsIGxvY2F0aW9uLCBnZW9tZXRyeSwgcmVwb3J0SWQsIGdlb2dyYXBoeSkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBpZiAoIWlkIHx8ICFjb250YWluZXIgfHwgKCFsb2NhdGlvbiAmJiAhZ2VvbWV0cnkgJiYgIWdlb2dyYXBoeSkgfHwgIXJlcG9ydElkKVxyXG4gICAgICB0aHJvdyAoJ2luZm9ncmFwaGljQ2FyZCBlcnJvcjogaW52YWxpZCBhcmdzIGxvYWRpbmcgaW5mb2dyYXBoaWMnKTtcclxuICAgIHNlbGYuX2lGcmFtZSA9IHsgaWQ6IGlkLCBjb250YWluZXI6IGNvbnRhaW5lciwgaW5zdGFuY2U6IG51bGwgfTtcclxuICAgIHNlbGYucmVwb3J0R2VvbWV0cnkgPSBnZW9tZXRyeTtcclxuICAgIHNlbGYucmVwb3J0SWQgPSByZXBvcnRJZDtcclxuICAgIHNlbGYucmVwb3J0R2VvZ3JhcGh5ID0gZ2VvZ3JhcGh5O1xyXG4gICAgc2VsZi5yZXBvcnRMb2NhdGlvbiA9IGxvY2F0aW9uO1xyXG4gICAgVXRpbHMucmVtb3ZlQ2hpbGRyZW4oY29udGFpbmVyKTtcclxuICAgIC8vIGNyZWF0ZSBuZXcgaWZyYW1lXHJcbiAgICBzZWxmLl9pRnJhbWUuY29udGFpbmVyLmlubmVySFRNTCA9ICc8aWZyYW1lIGlkPVwiJyArIHNlbGYuX2lGcmFtZS5pZCArICdcIiBjbGFzcz1cImFyY2dpc0luZm9ncmFwaGljRnJhbWVcIj48L2lmcmFtZT4nO1xyXG4gICAgLy8gY29udGludWUgYWZ0ZXIgZG9tIHNldHRsZXNcclxuICAgIGNvbnN0IF9jb250aW51ZUxvYWRpbmcgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgIHNlbGYuX2lGcmFtZS5pbnN0YW5jZSA9IHNlbGYuX2NvbnRhaW5lclNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihVdGlscy5maXhJZCh0aGlzLl9pRnJhbWUuaWQpKTtcclxuICAgICAgaWYgKCFzZWxmLl9pRnJhbWUuaW5zdGFuY2UpIDtcclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIC8vIG1lc3NhZ2UgdGhlIGluZm9ncmFwaGljIGlmcmFtZSB3aXRoIFVSTCBhbmQgcGFyYW1zIHdoZW4gbG9hZGVkXHJcbiAgICAgICAgICAvL1xyXG4gICAgICAgICAgLy8gT3B0aW9uc1xyXG4gICAgICAgICAgY29uc3QgZW52ID0gRW52aXJvbm1lbnRzLmdldEVudmlyb25tZW50KCk7XHJcbiAgICAgICAgICAvLyBFbnZpcm9ubWVudHMgZW52IHNob3VsZCBhbHdheXMgYmUgY29ycmVjdFxyXG4gICAgICAgICAgLy8gY29uc29sZS5hc3NlcnQoZW52ID09PSBzZWxmLmVudmlyb25tZW50KVxyXG4gICAgICAgICAgc2VsZi5lbnZpcm9ubWVudCA9IGVudjtcclxuICAgICAgICAgIHNldEVudmlyb25tZW50KHNlbGYuZW52aXJvbm1lbnQpO1xyXG4gICAgICAgICAgY29uc3QgcGxheWVyUGFnZVVybCA9IGF3YWl0IEluZm9ncmFwaGljc0hlbHBlci5fZ2V0SW5mb2dyYXBoaWNzUGxheWVyVXJsKCk7XHJcbiAgICAgICAgICAvLyBkZWZhdWx0IGVudmlyb25tZW50IGlzICd3d3cnXHJcbiAgICAgICAgICBjb25zdCBzdWJkb21haW4gPSBzZWxmLmVudmlyb25tZW50ID09PSAnZGV2JyA/ICdkZXZleHQnIDogc2VsZi5lbnZpcm9ubWVudCA9PT0gJ3FhJyA/ICdxYWV4dCcgOiAnd3d3JztcclxuICAgICAgICAgIGxldCBsYXQgPSAoc2VsZi5yZXBvcnRMb2NhdGlvbikgPyBzZWxmLnJlcG9ydExvY2F0aW9uLmxhdCA6IDA7XHJcbiAgICAgICAgICBsZXQgbG9uID0gKHNlbGYucmVwb3J0TG9jYXRpb24pID8gc2VsZi5yZXBvcnRMb2NhdGlvbi5sb24gOiAwO1xyXG4gICAgICAgICAgaWYgKCFzZWxmLnJlcG9ydEdlb21ldHJ5ICYmICghc2VsZi5yZXBvcnRMb2NhdGlvbiB8fCAhbGF0IHx8ICFsb24pICYmICFzZWxmLnJlcG9ydEdlb2dyYXBoeSkge1xyXG4gICAgICAgICAgICBMb2d6LnNob3coJyVlJywgJ0luZm9ncmFwaGljQ2FyZCBlcnJvcjogaW52YWxpZCBsb2NhdGlvbiwgZ2VvbWV0cnkgb3IgZ2VvZ3JhcGh5Jywgc2VsZi5yZXBvcnRMb2NhdGlvbiwgc2VsZi5yZXBvcnRHZW9tZXRyeSwgc2VsZi5yZXBvcnRHZW9ncmFwaHkpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHNlbGYubGFuZ0NvZGUgPSBzZWxmLmxhbmdDb2RlIHx8ICdlbi11cyc7XHJcbiAgICAgICAgICAgIHNlbGYuc291cmNlQ291bnRyeSA9IHNlbGYuc291cmNlQ291bnRyeSB8fCAnVVMnO1xyXG4gICAgICAgICAgICBjb25zdCBkZWZhdWx0SGllcmFyY2h5ID0gYXdhaXQgR0VDbGllbnQuZ2V0R0VEZWZhdWx0SGllcmFyY2h5KHNlbGYuc291cmNlQ291bnRyeSwgc2VsZi5wb3J0YWxPbmxpbmVHRVByb3h5ID8gc2VsZi50b2tlbiA6IFwiXCIpO1xyXG4gICAgICAgICAgICAvLyBOZWVkIHRvIHBhc3MgdGhlIHNlY29uZCBwYXJhbWV0ZXIgaW4gbGFuZ0NvZGUgYXMgdXBwZXJjYXNlIHRvIFJlcG9ydFBsYXllciB0byB3b3JrIChlLmcuIHB0LUJSLCBub3QgcHQtYnIpXHJcbiAgICAgICAgICAgIGNvbnN0IHVwcGVyTGFuZ0NvZGUgPSBzZWxmLmxhbmdDb2RlLmxlbmd0aCA9PT0gNSA/IHNlbGYubGFuZ0NvZGUuc3Vic3RyaW5nKDAsIDMpICsgc2VsZi5sYW5nQ29kZS5zdWJzdHJpbmcoMykudG9VcHBlckNhc2UoKSA6IHNlbGYubGFuZ0NvZGU7XHJcbiAgICAgICAgICAgIGxldCBwYXJhbXMgPSAneyBcXFxyXG4gICAgICAgICAgICAgICAgXCJ1c2VySWRcIjpcIicgKyBzZWxmLnVzZXJuYW1lICsgJ1wiLCBcXFxyXG4gICAgICAgICAgICAgICAgXCJ0b2tlblwiOlwiJyArIHNlbGYudG9rZW4gKyAnXCIsIFxcXHJcbiAgICAgICAgICAgICAgICBcImV4cGlyZXNcIjpcIicgKyAoTWF0aC5mbG9vcihEYXRlLm5vdygpICsgODY0MDAwMDAuNSkpLnRvU3RyaW5nKCkgKyAnXCIsIFxcXHJcbiAgICAgICAgICAgICAgICBcImNvbXBvbmVudElkXCI6XCInICsgc2VsZi5faUZyYW1lLmlkICsgJ1wiLCBcXFxyXG4gICAgICAgICAgICAgICAgXCJyZXBvcnRJRFwiOlwiJyArIHNlbGYucmVwb3J0SWQgKyAnXCIsIFxcXHJcbiAgICAgICAgICAgICAgICBcImNvdW50cnlJRFwiOlwiJyArIHNlbGYuc291cmNlQ291bnRyeSArICdcIiwgXFxcclxuICAgICAgICAgICAgICAgIFwibGFuZ0NvZGVcIjpcIicgKyB1cHBlckxhbmdDb2RlICsgJ1wiLCBcXFxyXG4gICAgICAgICAgICAgICAgXCJhbGxMYW5ndWFnZXNcIjp0cnVlLCBcXFxyXG4gICAgICAgICAgICAgICAgXCJoaWVyYXJjaHlcIjpcIicgKyBkZWZhdWx0SGllcmFyY2h5ICsgJ1wiLCAnO1xyXG4gICAgICAgICAgICBpZiAoc2VsZi5nZW9lbnJpY2htZW50VXJsKSB7XHJcbiAgICAgICAgICAgICAgcGFyYW1zICs9ICcgXCJnZW9lbnJpY2htZW50VXJsXCI6XCInICsgc2VsZi5nZW9lbnJpY2htZW50VXJsICsgJ1wiLCAnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChzZWxmLnBvcnRhbFVybCkge1xyXG4gICAgICAgICAgICAgIHBhcmFtcyArPSAnIFwic2VydmVyXCI6XCInICsgc2VsZi5wb3J0YWxVcmwgKyAnXCIsICc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgcGFyYW1zICs9ICcgXCJzZXJ2ZXJcIjpcImh0dHBzOi8vJyArIHN1YmRvbWFpbiArICcuYXJjZ2lzLmNvbVwiICwnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChzZWxmLnBvcnRhbE9ubGluZUdFUHJveHkpIHtcclxuICAgICAgICAgICAgICBwYXJhbXMgKz0gJyBcInBvcnRhbE9ubGluZUdFUHJveHlcIjp0cnVlICwnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBhbmFseXNpc0FyZWFzO1xyXG4gICAgICAgICAgICAvLyBVc2UgZ2VvZ3JhcGh5IGlmIGl0IGlzIHNldFxyXG4gICAgICAgICAgICBpZiAoc2VsZi5yZXBvcnRHZW9ncmFwaHkpIHtcclxuICAgICAgICAgICAgICBhbmFseXNpc0FyZWFzID0gJyBcImFuYWx5c2lzQXJlYXNcIjogW3tcImxvY2F0aW9uTmFtZVwiOlwiJyArIHNlbGYucmVwb3J0TG9jYXRpb25OYW1lICsgJ1wiLCBcImdlb2dyYXBoaWVzXCI6WycgKyBKU09OLnN0cmluZ2lmeShzZWxmLnJlcG9ydEdlb2dyYXBoeSkgKyAnXX1dICc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgYW5hbHlzaXNBcmVhcyA9IGF3YWl0IHNlbGYuX2dldFJlcG9ydEdlb21ldHJ5QW5hbHlzaXNBcmVhcygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghYW5hbHlzaXNBcmVhcykge1xyXG4gICAgICAgICAgICAgIC8vIEluZm9ncmFwaGljIHdpbGwgYmUgZm9yIGEgbG9jYXRpb24gd2l0aCBSaW5nc1xyXG4gICAgICAgICAgICAgIGlmIChzZWxmLmJ1ZmZlclVuaXRzID09ICdtaW51dGVzJykge1xyXG4gICAgICAgICAgICAgICAgLy8gaW52YWxpZCB1bml0cyBmb3IgcmluZ3NcclxuICAgICAgICAgICAgICAgIHNlbGYuYnVmZmVyVW5pdHMgPSBzZWxmLmJ1ZmZlclVuaXRzID0gJ21pbGVzJzsgLy8gZGVmYXVsdCB1bml0cyBmb3IgcmluZ3NcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgbGV0IGFyZWFzID0gR2VvbWV0cnlVdGlsLmdldFJpbmdzKGxhdCwgbG9uLCBzZWxmLmJ1ZmZlclVuaXRzLCBzZWxmLmJ1ZmZlclNpemVzLCB0aGlzLnJlcG9ydExvY2F0aW9uTmFtZSwgdGhpcy5yZXBvcnRMb2NhdGlvbkF0dHJpYnV0ZXMpO1xyXG4gICAgICAgICAgICAgIHBhcmFtcyArPSAnIFwiYW5hbHlzaXNBcmVhc1wiOiAnICsgSlNPTi5zdHJpbmdpZnkoYXJlYXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgIHBhcmFtcyArPSBhbmFseXNpc0FyZWFzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBvcHRpb25zID0gc2VsZi5fY3JlYXRlSW5mb2dyYXBoaWNQbGF5ZXJTdHlsZU9wdGlvbnMoKTtcclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgcGFyYW1zICs9ICcsJyArIG9wdGlvbnM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcGFyYW1zICs9ICcgfSc7XHJcbiAgICAgICAgICAgIC8vIEFmdGVyIHRoZSBpZnJhbWUgbG9hZHMsIHdlIG1lc3NhZ2UgaXQgd2l0aCB0aGUgaW5zdHJ1Y3Rpb25zIGFib3V0XHJcbiAgICAgICAgICAgIC8vIHRoZSBpbmZvZ3JhcGhpYyB0aGF0IHdpbGwgYmUgZ2VuZXJhdGVkXHJcbiAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgc2VsZi5faUZyYW1lLmluc3RhbmNlLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICBmdW5jdGlvbiBfZGVsYXkoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5faUZyYW1lICYmIHNlbGYuX2lGcmFtZS5pbnN0YW5jZSAmJiBzZWxmLl9pRnJhbWUuaW5zdGFuY2UuY29udGVudFdpbmRvdykge1xyXG4gICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIiVjIGluZm9ncmFwaGljQ2FyZDogaWZyYW1lIG9ubG9hZCBldmVudDogcGFzc2luZyBwYXJhbXMgdG8gcGxheWVyID0+IFwiLCdjb2xvcjpibHVlO2ZvbnQtc2l6ZToxMHB0JywgSlNPTi5wYXJzZShwYXJhbXMpKVxyXG4gICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICAgIHNlbGYuX2lGcmFtZS5pbnN0YW5jZS5jb250ZW50V2luZG93LnBvc3RNZXNzYWdlKHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaW5mb2dyYXBoaWNfcGFyYW1ldGVycycsXHJcbiAgICAgICAgICAgICAgICAgICAgaW5mb2dyYXBoaWNQYXJhbWV0ZXJzOiBwYXJhbXNcclxuICAgICAgICAgICAgICAgICAgfSwgcGxheWVyUGFnZVVybCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoX2RlbGF5LCA1MDApO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAvLyBpbnN0YW50aWF0ZSBpbmZvZ3JhcGhpYyBwbGF5ZXIgKHJlcG9ydCB3aWxsIGRpc3BsYXkgYWZ0ZXIgbG9hZGVkKVxyXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgIHNlbGYuX2lGcmFtZS5pbnN0YW5jZS5zcmMgPSBwbGF5ZXJQYWdlVXJsO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZXgpIHtcclxuICAgICAgICAgIExvZ3ouc2hvdygnJWUnLCAnSW5mb2dyYXBoaWNDYXJkIGVycm9yJywgZXgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHNldFRpbWVvdXQoX2NvbnRpbnVlTG9hZGluZywgMCk7XHJcbiAgfVxyXG4gIC8vIC8qKlxyXG4gIC8vICAqIFJlbmRlcnMgdGhlIGluZm9ncmFwaGljIGlmcmFtZSBPUiB0aGUgd2FybmluZyBpbWFnZVxyXG4gIC8vICAqXHJcbiAgLy8gICogQWN0dWFsIGluZm9ncmFwaGljIGRpc3BsYXkgaXMgZG9uZSBpbiB0aGUgJ2xvYWRJbmZvZ3JhcGhpYycgZnVuY3Rpb25cclxuICAvLyAgKi9cclxuICAvLyByZW5kZXIoKSB7XHJcbiAgLy8gICBsZXQgX3Nob3dXYXJuaW5nID0gZmFsc2VcclxuICAvLyAgIHRoaXMuX2NoZWNrQnVmZmVycygpXHJcbiAgLy8gICBpZighdGhpcy5fdmFsaWRhdGVTZXR1cCgpKSB7XHJcbiAgLy8gICAgIERlYnVnTG9nLmxvZygnSW5mb2dyYXBoaWNDYXJkJywgJyBlcnJvciAtIG5vIGxvY2F0aW9uIG9yIGJvdW5kYXJ5IHRvIGRpc3BsYXknKVxyXG4gIC8vICAgICBfc2hvd1dhcm5pbmcgPSB0cnVlXHJcbiAgLy8gICB9XHJcbiAgLy8gICBpZighX3Nob3dXYXJuaW5nICYmICF0aGlzLnJlcG9ydExvY2F0aW9uICYmICF0aGlzLnJlcG9ydEdlb21ldHJ5KSB7XHJcbiAgLy8gICAgIERlYnVnTG9nLmxvZygnSW5mb2dyYXBoaWNDYXJkJywgJyBlcnJvciAtIG5vIGxvY2F0aW9uIG9yIGJvdW5kYXJ5IHRvIGRpc3BsYXknKVxyXG4gIC8vICAgICBfc2hvd1dhcm5pbmcgPSB0cnVlXHJcbiAgLy8gICB9XHJcbiAgLy8gICBpZighX3Nob3dXYXJuaW5nICYmICghdGhpcy51c2VybmFtZSB8fCAhdGhpcy50b2tlbikpIHtcclxuICAvLyAgICAgRGVidWdMb2cubG9nKCdJbmZvZ3JhcGhpY0NhcmQnLCAnIHJlbmRlciBlcnJvciAtIGludmFsaWQgdXNlcm5hbWUvdG9rZW4nKVxyXG4gIC8vICAgICBfc2hvd1dhcm5pbmcgPSB0cnVlXHJcbiAgLy8gICB9XHJcbiAgLy9cclxuICAvLyAgIGlmKCFfc2hvd1dhcm5pbmcpIHtcclxuICAvLyAgICAgdGhpcy5fY2hlY2tCdWZmZXJzQXNzaWduRGVmYXVsdHMoKVxyXG4gIC8vICAgICBzZXRUb2tlbih0aGlzLnVzZXJuYW1lLCB0aGlzLnRva2VuKVxyXG4gIC8vICAgICByZXR1cm4gJzxpZnJhbWUgaWQ9XCInICsgdGhpcy5faUZyYW1lLmlkICsgJ1wiIGNsYXNzPVwiYXJjZ2lzSW5mb2dyYXBoaWNGcmFtZVwiPjwvaWZyYW1lPidcclxuICAvLyAgIH0gZWxzZSB7XHJcbiAgLy8gICAgIHJldHVybiB0aGlzLmdlbmVyYXRlTm90UmVhZHlIdG1sKClcclxuICAvLyAgIH1cclxuICAvLyB9XHJcbiAgLyogQ2xpZW50IGludGVyZmFjZSAqL1xyXG4gIHVwZGF0ZUluZm9ncmFwaGljKCkge1xyXG4gICAgLy8gYXNzdW1pbmcgYWxsIHByb3BlcnRpZXMgaGF2ZSBiZWVuIHVwZGF0ZWQgYWxyZWFkeS5cclxuICAgIHRoaXMucmVnZW5lcmF0ZUNvbnRlbnQoKTtcclxuICB9XHJcbiAgLyoqICBzZXRSZXBvcnRMb2NhdGlvblxyXG4gICAqICAgICAgVXBkYXRlcyB0aGUgcmVwb3J0IGxvY2F0aW9uIChsYXQvbG9uKSBmb3IgdGhlIHJlcG9ydC4gVGhlIGFsc29cclxuICAgKiAgICAgIGZvcmNlcyBhIHJlZnJlc2hcclxuICAgKlxyXG4gICAqIEBwYXJhbSBsb2Mgc2VlIExvY2F0aW9uVHlwZVxyXG4gICAqL1xyXG4gIHNldFJlcG9ydExvY2F0aW9uKGxvYykge1xyXG4gICAgaWYgKGxvYyAmJiBsb2MubGF0ICYmIGxvYy5sb24pIHtcclxuICAgICAgdGhpcy5yZXBvcnRMb2NhdGlvbiA9IGxvYztcclxuICAgICAgdGhpcy5yZWdlbmVyYXRlQ29udGVudCh0cnVlKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqICBzZXRSZXBvcnRHZW9tZXRyeVxyXG4gICAqICAgICAgVXBkYXRlcyB0aGUgcmVwb3J0IGdlb21ldHJ5IGZvciB0aGUgcmVwb3J0IGFuZFxyXG4gICAqICAgICAgZm9yY2VzIGEgcmVmcmVzaFxyXG4gICAqXHJcbiAgICogQHBhcmFtIGxvYyBnZW9tZXRyeSBvYmplY3RcclxuICAgKi9cclxuICBzZXRSZXBvcnRHZW9tZXRyeShnZW9tZXRyeSkge1xyXG4gICAgaWYgKGdlb21ldHJ5KSB7XHJcbiAgICAgIHRoaXMucmVwb3J0R2VvbWV0cnkgPSBnZW9tZXRyeTtcclxuICAgICAgdGhpcy5yZWdlbmVyYXRlQ29udGVudCh0cnVlKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqICBzZXRSZXBvcnRHZW9ncmFwaHlcclxuICAgKiAgICAgIFVwZGF0ZXMgdGhlIHJlcG9ydCBnZW9ncmFwaHkgZm9yIHRoZSByZXBvcnQgYW5kXHJcbiAgICogICAgICBmb3JjZXMgYSByZWZyZXNoXHJcbiAgICpcclxuICAgKiBAcGFyYW0gbG9jIGdlb2dyYXBoeSBvYmplY3RcclxuICAgKi9cclxuICBzZXRSZXBvcnRHZW9ncmFwaHkoZ2VvZ3JhcGh5KSB7XHJcbiAgICBpZiAoZ2VvZ3JhcGh5KSB7XHJcbiAgICAgIHRoaXMucmVwb3J0R2VvZ3JhcGh5ID0gZ2VvZ3JhcGh5O1xyXG4gICAgICB0aGlzLnJlZ2VuZXJhdGVDb250ZW50KHRydWUpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKiogZ2VuZXJhdGVCdWZmZXJzXHJcbiAgICogICAgR2VuZXJhdGVzIGRyaXZldGltZSBvciB3YWxrdGltZSBidWZmZXJzIHVzaW5nIHRoZSBJbmZvZ3JhcGhpY0NhcmQgcHJvcGVydGllc1xyXG4gICAqXHJcbiAgICogICAgUmVzdWx0OiBnZW9tZXRyeSBpcyBzYXZlZCBpbnRvIHRoaXMgSW5mb2dyYXBoaWNDYXJkJ3MgcmVwb3J0R2VvbWV0cnlcclxuICAgKiAgICBSZXR1cm46IG9iamVjdCA9IHtcclxuICAgKiAgICAgIHN1Y2Nlc3M6Ym9vbGVhbixcclxuICAgKiAgICAgIGVycm9yOnN0cmluZ1xyXG4gICAqICAgIH1cclxuICAgKi9cclxuICBhc3luYyBnZW5lcmF0ZUJ1ZmZlcnMoKSB7XHJcbiAgICAvLyBWYWxpZGF0aW9uXHJcbiAgICBpZiAoIXRoaXMuc291cmNlQ291bnRyeSlcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW5mb2dyYXBoaWNDYXJkIHNvdXJjZUNvdW50cnkgbm90IHZhbGlkJyB9O1xyXG4gICAgaWYgKCF0aGlzLmJ1ZmZlclR5cGUgfHwgKHRoaXMuYnVmZmVyVHlwZSAhPSAnZHJpdmV0aW1lJyAmJiB0aGlzLmJ1ZmZlclR5cGUgIT0gJ3dhbGt0aW1lJykpXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdbJyArIHRoaXMuYnVmZmVyVHlwZSArICddIGludmFsaWQgYnVmZmVyVHlwZSAobXVzdCBiZSBcImRyaXZldGltZVwiIG9yIFwid2Fsa3RpbWVcIiknXHJcbiAgICAgIH07XHJcbiAgICBpZiAoIXRoaXMuYnVmZmVyU2l6ZXMgfHwgdGhpcy5idWZmZXJTaXplcy5sZW5ndGggPD0gMClcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnbWlzc2luZyBidWZmZXJTaXplcycgfTtcclxuICAgIC8vIGxldCBidWZmZXJWYWx1ZXMgPSB0aGlzLmJ1ZmZlclNpemVzLnRvU3RyaW5nKCk7XHJcbiAgICBpZiAoIXRoaXMuYnVmZmVyVW5pdHMgfHwgKHRoaXMuYnVmZmVyVW5pdHMgIT0gJ21pbGVzJyAmJiB0aGlzLmJ1ZmZlclVuaXRzICE9ICdraWxvbWV0ZXJzJyAmJiB0aGlzLmJ1ZmZlclVuaXRzICE9ICdtaW51dGVzJykpXHJcbiAgICAgIHJldHVybiB7IGVycm9yOiAnaW52YWxpZCB1bml0cycgfTtcclxuICAgIGlmICghdGhpcy5yZXBvcnRMb2NhdGlvbiB8fCAhdGhpcy5yZXBvcnRMb2NhdGlvbi5sYXQpXHJcbiAgICAgIHJldHVybiB7IGVycm9yOiAnaW52YWxpZCBsYXRpdHVkZScgfTtcclxuICAgIGlmICghdGhpcy5yZXBvcnRMb2NhdGlvbiB8fCAhdGhpcy5yZXBvcnRMb2NhdGlvbi5sb24pXHJcbiAgICAgIHJldHVybiB7IGVycm9yOiAnaW52YWxpZCBsYXRpdHVkZScgfTtcclxuICAgIC8vIEdFIHJlcXVlc3QgdG8gZ2VuZXJhdGUgZHJpdmV0aW1lL3dhbGt0aW1lIHJpbmdzXHJcbiAgICBUcmFuc3BvcnRVdGlsLnNldFRva2VuKHRoaXMudXNlcm5hbWUsIHRoaXMudG9rZW4pO1xyXG4gICAgbGV0IHJlc3VsdE9iamVjdDtcclxuICAgIGxldCBsYXQgPSB0aGlzLnJlcG9ydExvY2F0aW9uLmxhdDtcclxuICAgIGxldCBsb24gPSB0aGlzLnJlcG9ydExvY2F0aW9uLmxvbjtcclxuICAgIGlmICh0aGlzLmJ1ZmZlclR5cGUgPT0gJ2RyaXZldGltZScpIHtcclxuICAgICAgcmVzdWx0T2JqZWN0ID0gYXdhaXQgVHJhbnNwb3J0VXRpbC5nZXRCdWZmZXJzKCdkcml2ZXRpbWUnLCB0aGlzLnNvdXJjZUNvdW50cnksIHRoaXMuYnVmZmVyVW5pdHMsIHRoaXMuYnVmZmVyU2l6ZXMsIGxvbiwgbGF0KTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICByZXN1bHRPYmplY3QgPSBhd2FpdCBUcmFuc3BvcnRVdGlsLmdldEJ1ZmZlcnMoJ3dhbGt0aW1lJywgdGhpcy5zb3VyY2VDb3VudHJ5LCB0aGlzLmJ1ZmZlclVuaXRzLCB0aGlzLmJ1ZmZlclNpemVzLCBsb24sIGxhdCk7XHJcbiAgICB9XHJcbiAgICAvLyB1cGRhdGUgdGhlIGluZm9ncmFwaGljIHRvIGRvIHRoZSBkcml2ZXRpbWUvd2Fsa3RpbWUgcG9seWdvbnNcclxuICAgIC8vIFRoaXMgYXNzaWdubWVudCB0cmlnZ2VycyBhbiBpbmZvZ3JhcGhpYyByZWZyZXNoXHJcbiAgICAvLyB0aGlzLl9pc0ludGVybmFsVXBkYXRlID0gdHJ1ZTtcclxuICAgIHRoaXMucmVwb3J0R2VvbWV0cnkgPSByZXN1bHRPYmplY3Q7XHJcbiAgICByZXR1cm4gcmVzdWx0T2JqZWN0O1xyXG4gIH1cclxufVxuXG5jb25zdCBhcmNnaXNJbmZvZ3JhcGhpY0NzcyA9IFwiOmhvc3R7ZGlzcGxheTpibG9ja30ubm90UmVhZHlPdXRlcntwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJX0ubm90UmVhZHlEaXZ7cG9zaXRpb246YWJzb2x1dGU7dG9wOmNhbGMoNTAlIC0gNTBweCk7bGVmdDpjYWxjKDUwJSAtIDUwcHgpO3dpZHRoOjEwMHB4O2hlaWdodDoxMDBweH0ubm90UmVhZHlTdmd7cG9zaXRpb246YWJzb2x1dGU7dG9wOmNhbGMoNTAlIC0gMjlweCk7bGVmdDpjYWxjKDUwJSAtIDMzcHgpfS5hcmNnaXNJbmZvZ3JhcGhpY0ZyYW1le3Bvc2l0aW9uOmFic29sdXRlO3RvcDowO2xlZnQ6MDt3aWR0aDoxMDAlO2hlaWdodDoxMDAlO2JvcmRlcjpub25lfVwiO1xuXG5jb25zdCBBcmNnaXNJbmZvZ3JhcGhpYyA9IGNsYXNzIHtcclxuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XHJcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xyXG4gICAgdGhpcy5faXNJbnRlcm5hbFVwZGF0ZSA9IGZhbHNlOyAvLyBmbGFnIHRvIHByZXZlbnQgZnVsbCBwcm9wZXJ0eSB1cGRhdGUgbWVjaGFuaXNtXHJcbiAgICB0aGlzLl9pZFByZWZpeCA9ICdhcmNnaXMtaW5mb2dyYXBoaWMtJztcclxuICAgIHRoaXMuX2hhc1NldEVudiA9IGZhbHNlO1xyXG4gICAgdGhpcy5fZGVmYXVsdE9wdGlvbnMgPSBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIGJ1ZmZlclR5cGU6ICdyaW5nJyxcclxuICAgICAgYnVmZmVyVW5pdHM6ICdtaWxlcycsXHJcbiAgICAgIGJ1ZmZlclNpemVzOiAnMSwzLDUnLFxyXG4gICAgICB2aWV3TW9kZTogJ2F1dG8nXHJcbiAgICB9KTtcclxuICAgIC8vIGRlYnVnIGxvZ2dpbmcgc2V0IHRvIHRydWVcclxuICAgIERlYnVnTG9nLnNob3dEZWJ1Z0NvbnNvbGVMb2dzID0gdHJ1ZTtcclxuICB9XHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgLy8gd2F0Y2hlc1xyXG4gIG9uRW52Q2hhbmdlZCgpIHtcclxuICAgIHRoaXMuc3RFbnYgPSB0aGlzLmVudjtcclxuICAgIEVudmlyb25tZW50cy5zZXRFbnZpcm9ubWVudCh0aGlzLmVudik7XHJcbiAgICBpZiAodGhpcy5faW5mb2dyYXBoaWNDYXJkKVxyXG4gICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQuZW52aXJvbm1lbnQgPSB0aGlzLmVudjtcclxuICAgIHRoaXMuX29uUHJvcENoYW5nZWQoKTtcclxuICB9XHJcbiAgb25Ub2tlbkNoYW5nZWQoKSB7XHJcbiAgICB0aGlzLnN0VG9rZW4gPSB0aGlzLnRva2VuO1xyXG4gICAgaWYgKHRoaXMuX2luZm9ncmFwaGljQ2FyZClcclxuICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnRva2VuID0gdGhpcy50b2tlbjtcclxuICAgIHRoaXMuX29uUHJvcENoYW5nZWQoKTtcclxuICB9XHJcbiAgb25Vc2VybmFtZUNoYW5nZWQoKSB7XHJcbiAgICB0aGlzLnN0VXNlcm5hbWUgPSB0aGlzLnVzZXJuYW1lO1xyXG4gICAgaWYgKHRoaXMuX2luZm9ncmFwaGljQ2FyZClcclxuICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnVzZXJuYW1lID0gdGhpcy51c2VybmFtZTtcclxuICAgIHRoaXMuX29uUHJvcENoYW5nZWQoKTtcclxuICB9XHJcbiAgb25Mb2NhdGlvbkRpc3BsYXlOYW1lQ2hhbmdlZCgpIHtcclxuICAgIC8vIHRoaXMuX2woJ2xvY2F0aW9uTmFtZScsdGhpcy5sb2NhdGlvbk5hbWUpXHJcbiAgICB0aGlzLnN0TG9jYXRpb25EaXNwbGF5TmFtZSA9IHRoaXMubG9jYXRpb25OYW1lO1xyXG4gICAgaWYgKHRoaXMuX2luZm9ncmFwaGljQ2FyZClcclxuICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnJlcG9ydExvY2F0aW9uTmFtZSA9IHRoaXMubG9jYXRpb25OYW1lO1xyXG4gICAgdGhpcy5fb25Qcm9wQ2hhbmdlZCgpO1xyXG4gIH1cclxuICBvbkxvY2F0aW9uQXR0cmlidXRlc0NoYW5nZWQoKSB7XHJcbiAgICAvLyB0aGlzLl9sKCdsb2NhdGlvbk5hbWUnLHRoaXMubG9jYXRpb25OYW1lKVxyXG4gICAgdGhpcy5zdExvY2F0aW9uQXR0cmlidXRlcyA9IHRoaXMubG9jYXRpb25BdHRyaWJ1dGVzID8gSlNPTi5wYXJzZSh0aGlzLmxvY2F0aW9uQXR0cmlidXRlcykgOiB7fTtcclxuICAgIGlmICh0aGlzLl9pbmZvZ3JhcGhpY0NhcmQpXHJcbiAgICAgIHRoaXMuX2luZm9ncmFwaGljQ2FyZC5yZXBvcnRMb2NhdGlvbkF0dHJpYnV0ZXMgPSB0aGlzLnN0TG9jYXRpb25BdHRyaWJ1dGVzO1xyXG4gICAgdGhpcy5fb25Qcm9wQ2hhbmdlZCgpO1xyXG4gIH1cclxuICBvbkxhbmdDb2RlQ2hhbmdlZCgpIHtcclxuICAgIHRoaXMuc3RMYW5nQ29kZSA9IHRoaXMubGFuZ0NvZGU7XHJcbiAgICBpZiAodGhpcy5faW5mb2dyYXBoaWNDYXJkKVxyXG4gICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQubGFuZ0NvZGUgPSB0aGlzLmxhbmdDb2RlO1xyXG4gICAgQmFSZXBvcnRzTGFuZ3VhZ2UuX2luaXRpYWxpemUodGhpcy5zdExhbmdDb2RlKTtcclxuICAgIHRoaXMuX29uUHJvcENoYW5nZWQoKTtcclxuICB9XHJcbiAgb25Db3VudHJ5Q2hhbmdlZCgpIHtcclxuICAgIHRoaXMuc3RTb3VyY2VDb3VudHJ5ID0gdGhpcy5zb3VyY2VDb3VudHJ5O1xyXG4gICAgaWYgKHRoaXMuX2luZm9ncmFwaGljQ2FyZClcclxuICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnNvdXJjZUNvdW50cnkgPSB0aGlzLnNvdXJjZUNvdW50cnk7XHJcbiAgICB0aGlzLl9vblByb3BDaGFuZ2VkKCk7XHJcbiAgfVxyXG4gIG9uT3B0aW9uc0NoYW5nZWQoKSB7XHJcbiAgICB0aGlzLnN0T3B0aW9ucyA9IHRoaXMub3B0aW9ucztcclxuICAgIC8vIGNvbnNvbGUubG9nKCclYyBCQUMgYXJjZ2lzLWluZm9ncmFwaGljIG9wdGlvbnMgY2hhbmdpbmcuLi4nLCAnY29sb3I6Ymx1ZTtmb250LXNpemU6OXB0OycsIHRoaXMub3B0aW9ucylcclxuICAgIGlmICh0aGlzLl9pbmZvZ3JhcGhpY0NhcmQpXHJcbiAgICAgIHRoaXMuX2luZm9ncmFwaGljQ2FyZC5zZXRPcHRpb25zKHRoaXMub3B0aW9ucywgdHJ1ZSk7XHJcbiAgICB0aGlzLl9vblByb3BDaGFuZ2VkKCk7XHJcbiAgfVxyXG4gIG9uUmVwb3J0SWRDaGFuZ2VkKCkge1xyXG4gICAgdGhpcy5zdFJlcG9ydElkID0gdGhpcy5yZXBvcnRJZDtcclxuICAgIGlmICh0aGlzLl9pbmZvZ3JhcGhpY0NhcmQpXHJcbiAgICAgIHRoaXMuX2luZm9ncmFwaGljQ2FyZC5yZXBvcnRJZCA9IHRoaXMucmVwb3J0SWQ7XHJcbiAgICB0aGlzLl9vblByb3BDaGFuZ2VkKCk7XHJcbiAgfVxyXG4gIG9uVGhlbWVDaGFuZ2VkKCkge1xyXG4gICAgdGhpcy5zdFRoZW1lID0gSlNPTi5wYXJzZSh0aGlzLnRoZW1lKTtcclxuICAgIHRoaXMuX29uUHJvcENoYW5nZWQoKTtcclxuICB9XHJcbiAgb25SZXBvcnRMb2NhdGlvbkNoYW5nZWQoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICB0aGlzLnN0UmVwb3J0TG9jYXRpb24gPSB0aGlzLnJlcG9ydExvY2F0aW9uO1xyXG4gICAgICB0aGlzLl9vblByb3BDaGFuZ2VkKCk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZXgpIHtcclxuICAgICAgY29uc29sZS5sb2coZXgpO1xyXG4gICAgfVxyXG4gIH1cclxuICBvblJlcG9ydEdlb21ldHJ5Q2hhbmdlZCgpIHtcclxuICAgIHRoaXMuc3RSZXBvcnRHZW9tZXRyeSA9IHRoaXMucmVwb3J0Z2VvbWV0cnk7XHJcbiAgICAvLyBpZighdGhpcy5faXNJbnRlcm5hbFVwZGF0ZSkge1xyXG4gICAgLy8gICBpZih0aGlzLl9pbmZvZ3JhcGhpY0NhcmQpIHtcclxuICAgIC8vICAgICBpZihVdGlscy5oYXNUZXh0KHRoaXMucmVwb3J0Z2VvbWV0cnkpKVxyXG4gICAgLy8gICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnNldFJlcG9ydEdlb21ldHJ5KEpTT04ucGFyc2UodGhpcy5yZXBvcnRnZW9tZXRyeSkpXHJcbiAgICAvLyAgIH1cclxuICAgIHRoaXMuX29uUHJvcENoYW5nZWQoKTtcclxuICAgIC8vIH0gZWxzZSB0aGlzLl9pc0ludGVybmFsVXBkYXRlID0gZmFsc2UgLy9yZXNldCBmbGFnXHJcbiAgfVxyXG4gIG9uUmVwb3J0R2VvZ3JhcGh5Q2hhbmdlZCgpIHtcclxuICAgIHRoaXMuc3RSZXBvcnRHZW9ncmFwaHkgPSB0aGlzLnJlcG9ydGdlb2dyYXBoeTtcclxuICAgIHRoaXMuX29uUHJvcENoYW5nZWQoKTtcclxuICB9XHJcbiAgLy8gVXBkYXRlIHRoZSBJbmZvZ3JhcGhpYyBSZXBvcnQgd2hlbiB0aGUgYXJjZ2lzLXJlcG9ydC1saXN0IGNoYW5nZXNcclxuICByZXBvcnRTZWxlY3RlZEV2ZW50SGFuZGxlcihlKSB7XHJcbiAgICBsZXQgcmVwb3J0SWQgPSBlLmRldGFpbD8udmFsdWU7XHJcbiAgICBpZiAocmVwb3J0SWQpIHtcclxuICAgICAgdGhpcy5zdFJlcG9ydElkID0gcmVwb3J0SWQ7XHJcbiAgICAgIC8vIGRlc3Ryb3kgaWZyYW1lXHJcbiAgICAgIGxldCBmcmFtZSA9IEFDTFV0aWxzLnF1ZXJ5RWxlbWVudEJ5SWQodGhpcy5faWZyYW1lSWQpO1xyXG4gICAgICBpZiAoZnJhbWUgJiYgZnJhbWUucGFyZW50Tm9kZSkge1xyXG4gICAgICAgIGZyYW1lLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZnJhbWUpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuY29tcG9uZW50RGlkTG9hZCgpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvLyBfbCguLi5hcmdzKSB7XHJcbiAgLy8gICBjb25zb2xlLmxvZygnJWNhcmNnaXMtaW5mb2dyYXBoaWM6JywgJ2NvbG9yOnllbGxvdycsIGFyZ3MpXHJcbiAgLy8gfVxyXG4gIC8vIE1ldGhvZHMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIC8vXHJcbiAgLyoqXHJcbiAgICogZ2VuZXJhdGVCdWZmZXJzXHJcbiAgICpcclxuICAgKiBUaGlzIGZ1bmN0aW9uIHBhc3NlcyBpbiB2YWx1ZXMgbmVlZGVkIHRvIGRvIGVpdGhlciBhIGRyaXZldGltZSBvciB3YWxrdGltZSBidWZmZXJzXHJcbiAgICogcmVwb3J0LiAgVGhlIHZhbHVlcyBwYXNzZWQgaW4gdXBkYXRlIHRoZSBQcm9wcyBpbiB0aGUgY29tcG9uZW50LCBhc3luYyByZXR1cm5zIHRoZVxyXG4gICAqIHJpbmdzLCBhbmQgZ2VuZXJhdGVzIGEgbmV3IGluZm9ncmFwaGljIHVzaW5nIHRoZSBkcml2ZXRpbWUgb3Igd2Fsa3RpbWUgdmFsdWVzLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIGJ1ZmZlclR5cGUgPSAnd2Fsa3RpbWUnIG9yICdkcml2ZXRpbWUnXHJcbiAgICogQHBhcmFtIHZhbHVlcyAgICAgPSBzdHJpbmcgcmVwcmVzZW50aW5nIGRyaXZldGltZSBkaXN0YW5jZSBvciB0aW1lIFtleGFtcGxlOlwiMSwzLDVcIl1cclxuICAgKiBAcGFyYW0gdW5pdHMgICAgICA9IFwibWlsZXNcIiwgXCJraWxvbWV0ZXJzXCIsIG9yIFwibWludXRlc1wiXHJcbiAgICogQHBhcmFtIGxhdGl0dWRlICAgPSBtYXAgbG9jYXRpb25cclxuICAgKiBAcGFyYW0gbG9uZ2l0dWRlXHJcbiAgICpcclxuICAgKiBAcmV0dXJuID0gW1xyXG4gICAqICB7IHZhbHVlOiA8YnVmZmVyVmFsdWU+LCB1bml0czogPGJ1ZmZlclVuaXRzPiwgcmluZ3M6IDxnZW9tZXRyeSByaW5ncz4gfSxcclxuICAgKiAgeyB2YWx1ZTogPGJ1ZmZlclZhbHVlPiwgdW5pdHM6IDxidWZmZXJVbml0cz4sIHJpbmdzOiA8Z2VvbWV0cnkgcmluZ3M+IH0sXHJcbiAgICogIDx1cCB0byAzIHJlc3VsdHMgZGVwZW5kaW5nIG9uIGxlbmd0aCBvZiB2YWx1ZXM+XHJcbiAgICogXVxyXG4gICAqL1xyXG4gIGFzeW5jIGdlbmVyYXRlQnVmZmVycyhidWZmZXJUeXBlLCB2YWx1ZXMsIHVuaXRzLCBsYXRpdHVkZSwgbG9uZ2l0dWRlKSB7XHJcbiAgICBjb25zdCBjYXJkID0gdGhpcy5faW5mb2dyYXBoaWNDYXJkO1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKCFjYXJkKVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAvLyBidWZmZXJUeXBlXHJcbiAgICAgIGlmIChBQ0xVdGlscy5oYXNUZXh0KGJ1ZmZlclR5cGUpICYmIFsncmluZycsICdkcml2ZXRpbWUnLCAnd2Fsa3RpbWUnXS5pbmNsdWRlcyhidWZmZXJUeXBlKSkgeyAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgY2FyZC5idWZmZXJUeXBlID0gYnVmZmVyVHlwZTtcclxuICAgICAgfVxyXG4gICAgICAvLyB2YWx1ZXNcclxuICAgICAgaWYgKHZhbHVlcyAmJiB2YWx1ZXMudHJpbSgpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBsZXQgc2l6ZXMgPSBbXTtcclxuICAgICAgICBsZXQgYXJyID0gdmFsdWVzLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IGFyci5sZW5ndGg7IGlpKyspIHtcclxuICAgICAgICAgIGlmIChpaSA8IDMgJiYgYXJyW2lpXSAmJiBhcnJbaWldLnRyaW0oKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHNpemVzLnB1c2gocGFyc2VGbG9hdChhcnJbaWldLnRyaW0oKSkpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc2l6ZXMubGVuZ3RoID4gMClcclxuICAgICAgICAgIGNhcmQuYnVmZmVyU2l6ZXMgPSBzaXplcztcclxuICAgICAgfVxyXG4gICAgICAvLyB1bml0c1xyXG4gICAgICBpZiAoQUNMVXRpbHMuaGFzVGV4dCh1bml0cykgJiYgWydtaWxlcycsICdraWxvbWV0ZXJzJywgJ21pbnV0ZXMnXS5pbmNsdWRlcyhidWZmZXJUeXBlKSkge1xyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICBjYXJkLmJ1ZmZlclVuaXRzID0gdW5pdHM7XHJcbiAgICAgIH1cclxuICAgICAgLy8gbGF0aXR1ZGUsIGxvbmdpdHVkZVxyXG4gICAgICBpZiAoQUNMVXRpbHMuaGFzVGV4dChsYXRpdHVkZSkgJiYgQUNMVXRpbHMuaGFzVGV4dChsb25naXR1ZGUpKSB7XHJcbiAgICAgICAgbGV0IGxhdCA9IHBhcnNlRmxvYXQobGF0aXR1ZGUpO1xyXG4gICAgICAgIGxldCBsb24gPSBwYXJzZUZsb2F0KGxvbmdpdHVkZSk7XHJcbiAgICAgICAgY2FyZC5yZXBvcnRMb2NhdGlvbiA9IHsgbGF0OiBsYXQsIGxvbjogbG9uIH07XHJcbiAgICAgICAgdGhpcy5yZXBvcnRMb2NhdGlvbiA9IGxvbmdpdHVkZSArICcsICcgKyBsYXRpdHVkZTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLl9pc0ludGVybmFsVXBkYXRlID0gdHJ1ZTtcclxuICAgICAgcmV0dXJuIChjYXJkLmdlbmVyYXRlQnVmZmVycygpKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChleCkge1xyXG4gICAgICBEZWJ1Z0xvZy5sb2coJ2FyY2dpcy1pbmZvZ3JhcGhpYzogZ2VuZXJhdGUgYnVmZmVycyBlcnJvcjogJywgZXgpO1xyXG4gICAgICByZXR1cm4geyBlcnJvcjogJ2V4Y2VwdGlvbjogJyArIGV4LnRvU3RyaW5nKCkgfTtcclxuICAgIH1cclxuICB9XHJcbiAgYXN5bmMgb25Qcm9wQ2hhbmdlKGNhbGxiYWNrLCBjb250ZXh0KSB7XHJcbiAgICB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrID0geyBmbjogY2FsbGJhY2ssIGN0eDogY29udGV4dCB9O1xyXG4gIH1cclxuICBhc3luYyB1cGRhdGVJbmZvZ3JhcGhpYyhuYW1lLCByZXBvcnRJZCwgbG9jYXRpb24sIGdlb21ldHJ5LCBnZW9ncmFwaHkpIHtcclxuICAgIGlmIChuYW1lICYmIEFDTFV0aWxzLmhhc1RleHQobmFtZSkpIHtcclxuICAgICAgdGhpcy5sb2NhdGlvbk5hbWUgPSBuYW1lO1xyXG4gICAgICB0aGlzLnN0TG9jYXRpb25EaXNwbGF5TmFtZSA9IG5hbWU7XHJcbiAgICB9XHJcbiAgICBpZiAocmVwb3J0SWQgJiYgQUNMVXRpbHMuaGFzVGV4dChyZXBvcnRJZCkpIHtcclxuICAgICAgdGhpcy5yZXBvcnRJZCA9IHJlcG9ydElkO1xyXG4gICAgICB0aGlzLnN0UmVwb3J0SWQgPSByZXBvcnRJZDtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbikge1xyXG4gICAgICB0aGlzLnJlcG9ydExvY2F0aW9uID0gbG9jYXRpb247XHJcbiAgICAgIHRoaXMuc3RSZXBvcnRMb2NhdGlvbiA9IGxvY2F0aW9uO1xyXG4gICAgfVxyXG4gICAgaWYgKGdlb21ldHJ5KSB7XHJcbiAgICAgIHRoaXMucmVwb3J0Z2VvbWV0cnkgPSBnZW9tZXRyeTtcclxuICAgICAgdGhpcy5zdFJlcG9ydEdlb21ldHJ5ID0gZ2VvbWV0cnk7XHJcbiAgICB9XHJcbiAgICBpZiAoZ2VvZ3JhcGh5KSB7XHJcbiAgICAgIHRoaXMucmVwb3J0Z2VvZ3JhcGh5ID0gZ2VvZ3JhcGh5O1xyXG4gICAgICB0aGlzLnN0UmVwb3J0R2VvZ3JhcGh5ID0gZ2VvZ3JhcGh5O1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiBGaWx0ZXJzIG91dCBtdWx0aXBsZSByYXBpZCBldmVudHMgb2YgdGhlIHNhbWUgdHlwZS4gIFRoZSBjYWxsYmFja1xyXG4gICAqIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIGlmIG5vIG5ldyBldmVudHMgaGF2ZSBoYXBwZW5lZCBkdXJpbmcgdGhlXHJcbiAgICogJ3dhaXQnIHRpbWUuXHJcbiAgICogQHBhcmFtIGNhbGxiYWNrIC0geW91ciBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIGV2ZW50cyBoYXZlIHNldHRsZWRcclxuICAgKiBAcGFyYW0gd2FpdCAgICAgLSBtaWxsaXNlY29uZHMgZGVsYXkgKGV4OiAyNTApXHJcbiAgICovXHJcbiAgX2RlYm91bmNlMihjYWxsYmFjaywgd2FpdCkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBjb25zdCBkZWxheWVkQ2FsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgc2VsZi5fZGVib3VuY2VUaW1lciA9IG51bGw7XHJcbiAgICAgIGNhbGxiYWNrLmFwcGx5KHNlbGYpO1xyXG4gICAgfTtcclxuICAgIC8vIGV2ZXJ5dGltZSBfZGVib3VuY2UyIGlzIGNhbGxlZCB3ZSBraWxsIHRoZSBwcmV2aW91cyB0aW1lclxyXG4gICAgaWYgKHNlbGYuX2RlYm91bmNlVGltZXIpXHJcbiAgICAgIGNsZWFyVGltZW91dChzZWxmLl9kZWJvdW5jZVRpbWVyKTtcclxuICAgIHNlbGYuX2RlYm91bmNlVGltZXIgPSBzZXRUaW1lb3V0KGRlbGF5ZWRDYWxsLCB3YWl0KTtcclxuICB9XHJcbiAgX29uRmlsdGVyZWRQcm9wQ2hhbmdlZCgpIHtcclxuICAgIGlmICh0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKVxyXG4gICAgICB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrLmZuKHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2suY3R4LCB0aGlzLnJlcG9ydExvY2F0aW9uKTtcclxuICAgIGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmxvZygnV0FSTi0gYXJjZ2lzLWluZm9ncmFwaGljIGNvbXBvbmVudDogcHJvcGVydHkgc3luYyBjYWxsYmFjayBub3QgZm91bmQnKTtcclxuICAgIH1cclxuICAgIHRoaXMuYXR0ZW1wdEluZm9ncmFwaGljUmVuZGVyKCk7XHJcbiAgfVxyXG4gIF9vblByb3BDaGFuZ2VkKCkge1xyXG4gICAgdGhpcy5fZGVib3VuY2UyKHRoaXMuX29uRmlsdGVyZWRQcm9wQ2hhbmdlZCwgMjUwKTtcclxuICB9XHJcbiAgX2RlYm91bmNlKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkge1xyXG4gICAgbGV0IHRpbWVvdXQ7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGxldCBjb250ZXh0ID0gc2VsZiwgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgbGV0IGxhdGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRpbWVvdXQgPSBudWxsO1xyXG4gICAgICAgIGlmICghaW1tZWRpYXRlKVxyXG4gICAgICAgICAgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcclxuICAgICAgfTtcclxuICAgICAgbGV0IGNhbGxOb3cgPSBpbW1lZGlhdGUgJiYgIXRpbWVvdXQ7XHJcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcclxuICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQpO1xyXG4gICAgICBpZiAoY2FsbE5vdylcclxuICAgICAgICBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xyXG4gICAgfTtcclxuICB9XHJcbiAgLy8gU3RlbmNpbCBsaWZlY3ljbGUgbWV0aG9kc1xyXG4gIC8vXHJcbiAgY29tcG9uZW50V2lsbExvYWQoKSB7XHJcbiAgICAvLyBjb25zb2xlLmxvZygnJWMgQkFDIGFyY2dpcy1pbmZvZ3JhcGhpYyB3aWxsTG9hZCcsICdjb2xvcjpibHVlO2ZvbnQtc2l6ZTo5cHQ7JywgdGhpcy5vcHRpb25zKVxyXG4gICAgLy8gY29uc29sZS5sb2coJyVjIEJBQyBhcmNnaXMtaW5mb2dyYXBoaWMgd2lsbExvYWQgY3JlZHMnLCAnY29sb3I6cmVkO2ZvbnQtc2l6ZTo5cHQ7JywgdGhpcy51c2VybmFtZSwgdGhpcy50b2tlbilcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIEVhY2ggY29tcG9uZW50IGhhcyB0aGUgSUQgd2l0aCBhIHN1ZmZpeCBjb3VudGVyIG51bWJlciB0aGF0XHJcbiAgICAgIC8vIGlzIG1hbmFnZWQgYnkgdGhlIHN0YXRpYyBpbnN0YW5jZSBvZiB0aGlzIGNvbXBvbmVudC4gIFRoZVxyXG4gICAgICAvLyByZXN1bHQgaXMgdGhhdCB3ZSBzdXBwb3J0IG11bHRpcGxlIGluc3RhbmNlcyBvZiB0aGUgY29tcG9uZW50XHJcbiAgICAgIC8vIG9uIGFueSBnaXZlbiB3ZWJwYWdlLlxyXG4gICAgICBpZiAoIXRoaXMuX2luc3RhbmNlSWQpXHJcbiAgICAgICAgdGhpcy5faW5zdGFuY2VJZCA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCh0aGlzLl9pZFByZWZpeCkuaWQ7XHJcbiAgICAgIGlmICghdGhpcy5fY29udGFpbmVySWQpXHJcbiAgICAgICAgdGhpcy5fY29udGFpbmVySWQgPSBFbGVtZW50SWRzLmdlbmVyYXRlSWQoJ2NvbXBvbmVudE91dGVyJykuaWQ7XHJcbiAgICAgIGlmICghdGhpcy5faWZyYW1lSWQpXHJcbiAgICAgICAgdGhpcy5faWZyYW1lSWQgPSBFbGVtZW50SWRzLmdlbmVyYXRlSWQoJ2lnRnJhbWUnKS5pZDtcclxuICAgICAgLy8gaW5pdGlhbGl6ZSBzdGF0ZSB2YXJpYWJsZXMgaGVyZSB3aXRob3V0IGNhdXNpbmcgYW5vdGhlciByZW5kZXIoKVxyXG4gICAgICB0aGlzLnN0RW52ID0gdGhpcy5lbnY7XHJcbiAgICAgIHRoaXMuc3RUb2tlbiA9IHRoaXMudG9rZW47XHJcbiAgICAgIHRoaXMuc3RVc2VybmFtZSA9IHRoaXMudXNlcm5hbWU7XHJcbiAgICAgIHRoaXMuc3RMb2NhdGlvbkRpc3BsYXlOYW1lID0gdGhpcy5sb2NhdGlvbk5hbWU7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgdGhpcy5zdExvY2F0aW9uQXR0cmlidXRlcyA9IEpTT04ucGFyc2UodGhpcy5sb2NhdGlvbkF0dHJpYnV0ZXMpO1xyXG4gICAgICB9XHJcbiAgICAgIGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHRoaXMuc3RMb2NhdGlvbkF0dHJpYnV0ZXMgPSB7fTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnN0TGFuZ0NvZGUgPSBBQ0xVdGlscy5oYXNUZXh0KHRoaXMubGFuZ0NvZGUpID8gdGhpcy5sYW5nQ29kZSA6ICdlbi11cyc7XHJcbiAgICAgIHRoaXMuc3RTb3VyY2VDb3VudHJ5ID0gQUNMVXRpbHMuaGFzVGV4dCh0aGlzLnNvdXJjZUNvdW50cnkpID8gdGhpcy5zb3VyY2VDb3VudHJ5IDogJ1VTJztcclxuICAgICAgdGhpcy5zdFJlcG9ydElkID0gdGhpcy5yZXBvcnRJZDtcclxuICAgICAgdGhpcy5zdFRoZW1lID0gbnVsbDtcclxuICAgICAgaWYgKCF0aGlzLm9wdGlvbnMgfHwgIUFDTFV0aWxzLmhhc1RleHQodGhpcy5vcHRpb25zKSkge1xyXG4gICAgICAgIHRoaXMub3B0aW9ucyA9IHRoaXMuX2RlZmF1bHRPcHRpb25zO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuc3RPcHRpb25zID0gSlNPTi5wYXJzZSh0aGlzLm9wdGlvbnMpO1xyXG4gICAgICBpZiAoIXRoaXMuX2hhc1NldEVudiAmJiB0aGlzLmVudikge1xyXG4gICAgICAgIHRoaXMuX2hhc1NldEVudiA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5zdEVudiA9IHRoaXMuZW52O1xyXG4gICAgICAgIEVudmlyb25tZW50cy5zZXRFbnZpcm9ubWVudCh0aGlzLmVudik7XHJcbiAgICAgIH1cclxuICAgICAgQmFSZXBvcnRzTGFuZ3VhZ2UuX2luaXRpYWxpemUodGhpcy5zdExhbmdDb2RlKTtcclxuICAgICAgLy8gU2V0IGlmIEdlb2VucmljaG1lbnRVcmwgd2FzIG9wdGlvbmFsbHkgcGFzc2VkIGluXHJcbiAgICAgIGlmICh0aGlzLmdlb2VucmljaG1lbnRVcmwpIHtcclxuICAgICAgICBFbnZpcm9ubWVudHMuc2V0R2VvZW5yaWNobWVudFVybCh0aGlzLmdlb2VucmljaG1lbnRVcmwpO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIFNldCBpZiBQb3JhdGwgVXJsIHdhcyBvcHRpb25hbGx5IHBhc3NlZCBpblxyXG4gICAgICBpZiAodGhpcy5wb3J0YWxVcmwpIHtcclxuICAgICAgICBFbnZpcm9ubWVudHMuc2V0UG9ydGFsVXJsKHRoaXMucG9ydGFsVXJsKTtcclxuICAgICAgfVxyXG4gICAgICAvLyBjb25zb2xlLmxvZygnJWMgQkFDIGFyY2dpcy1pbmZvZ3JhcGhpYyB3aWxsTG9hZDInLCAnY29sb3I6Ymx1ZTtmb250LXNpemU6OXB0OycsIHRoaXMub3B0aW9ucylcclxuICAgICAgaWYgKCF0aGlzLl9pbmZvZ3JhcGhpY0NhcmQpIHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygnJWMgQkFDIGFyY2dpcy1pbmZvZ3JhcGhpYyBjcmVhdGluZyBuZXcgSW5mb2dyYXBoaWNDYXJkJywgJ2NvbG9yOmJsdWU7Zm9udC1zaXplOjlwdDsnKVxyXG4gICAgICAgIHRoaXMuX2luZm9ncmFwaGljQ2FyZCA9IG5ldyBJbmZvZ3JhcGhpY0NhcmQodGhpcy51c2VybmFtZSwgdGhpcy50b2tlbiwgdGhpcy5lbnYsIHRoaXMub3B0aW9ucyk7XHJcbiAgICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnNldE9wdGlvbnModGhpcy5vcHRpb25zLCB0cnVlKTsgLy9AQEBAQEBAQEBAQEBcclxuICAgICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQuZ2VvZW5yaWNobWVudFVybCA9IHRoaXMuZ2VvZW5yaWNobWVudFVybDtcclxuICAgICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQucG9ydGFsVXJsID0gdGhpcy5wb3J0YWxVcmw7XHJcbiAgICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnBvcnRhbE9ubGluZUdFUHJveHkgPSB0aGlzLnBvcnRhbE9ubGluZUdFUHJveHk7XHJcbiAgICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnJlcG9ydExvY2F0aW9uTmFtZSA9IHRoaXMuc3RMb2NhdGlvbkRpc3BsYXlOYW1lO1xyXG4gICAgICAgIHRoaXMuX2luZm9ncmFwaGljQ2FyZC5yZXBvcnRMb2NhdGlvbkF0dHJpYnV0ZXMgPSB0aGlzLnN0TG9jYXRpb25BdHRyaWJ1dGVzO1xyXG4gICAgICAgIHRoaXMuX2luZm9ncmFwaGljQ2FyZC5zb3VyY2VDb3VudHJ5ID0gdGhpcy5zdFNvdXJjZUNvdW50cnk7XHJcbiAgICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLmxhbmdDb2RlID0gdGhpcy5zdExhbmdDb2RlO1xyXG4gICAgICAgIHRoaXMuX2luZm9ncmFwaGljQ2FyZC5zZXRTaGFkb3dSb290KHRoaXMuZWwuc2hhZG93Um9vdCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGNhdGNoIChleCkge1xyXG4gICAgICBjb25zb2xlLmxvZyhleCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGFzeW5jIGF0dGVtcHRJbmZvZ3JhcGhpY1JlbmRlcigpIHtcclxuICAgIGxldCBjb250YWluZXIgPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwodGhpcywgdGhpcy5fY29udGFpbmVySWQpO1xyXG4gICAgbGV0IGxvY2F0aW9uLCBnZW9tZXRyeSwgZ2VvZ3JhcGh5LCByZXBvcnRJZDtcclxuICAgIGlmICh0aGlzLl9pbmZvZ3JhcGhpY0NhcmQgJiYgdGhpcy5vcHRpb25zKVxyXG4gICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQuc2V0T3B0aW9ucyh0aGlzLm9wdGlvbnMsIHRydWUpO1xyXG4gICAgLy8gY29uc29sZS5sb2coJyVjIEJBQyBhcmNnaXMtaW5mb2dyYXBoaWMgYXR0ZW1wdEluZm9ncmFwaGljUmVuZGVyJywgJ2NvbG9yOmJsdWU7Zm9udC1zaXplOjlwdDsnLCB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQpXHJcbiAgICAvLyBjb25zb2xlLmxvZygnJWMgQkFDIGFyY2dpcy1pbmZvZ3JhcGhpYyBhdHRlbXB0UmVuZGVyIGNyZWRzJywgJ2NvbG9yOnJlZDtmb250LXNpemU6OXB0OycsIHRoaXMudXNlcm5hbWUsIHRoaXMudG9rZW4pXHJcbiAgICAvLyBTeW5jIEluZm9ncmFwaGljQ2FyZCBwcm9wZXJ0aWVzXHJcbiAgICBpZiAodGhpcy5yZXBvcnRMb2NhdGlvbikge1xyXG4gICAgICBsZXQgZ2VvID0gdGhpcy5yZXBvcnRMb2NhdGlvbi5zcGxpdCgnLCcpO1xyXG4gICAgICBpZiAoZ2VvICYmIGdlby5sZW5ndGggPT0gMikge1xyXG4gICAgICAgIGxldCBsYXQgPSBwYXJzZUZsb2F0KGdlb1sxXSk7XHJcbiAgICAgICAgbGV0IGxvbiA9IHBhcnNlRmxvYXQoZ2VvWzBdKTtcclxuICAgICAgICBsb2NhdGlvbiA9IHsgbGF0OiBsYXQsIGxvbjogbG9uIH07XHJcbiAgICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnNldFJlcG9ydExvY2F0aW9uKGxvY2F0aW9uKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMucmVwb3J0Z2VvbWV0cnkpIHtcclxuICAgICAgZ2VvbWV0cnkgPSBKU09OLnBhcnNlKHRoaXMucmVwb3J0Z2VvbWV0cnkpO1xyXG4gICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQuc2V0UmVwb3J0R2VvbWV0cnkoZ2VvbWV0cnkpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMucmVwb3J0Z2VvZ3JhcGh5KSB7XHJcbiAgICAgIGdlb2dyYXBoeSA9IEpTT04ucGFyc2UodGhpcy5yZXBvcnRnZW9ncmFwaHkpO1xyXG4gICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQuc2V0UmVwb3J0R2VvZ3JhcGh5KGdlb2dyYXBoeSk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5yZXBvcnRJZCkge1xyXG4gICAgICByZXBvcnRJZCA9IHRoaXMucmVwb3J0SWQ7XHJcbiAgICAgIHRoaXMuX2luZm9ncmFwaGljQ2FyZC5yZXBvcnRJZCA9IHRoaXMucmVwb3J0SWQ7XHJcbiAgICB9XHJcbiAgICAvLyB2YWxpZGF0ZSByZXF1aXJlZCBkYXRhIHRvIGRyYXcgYW4gaW5mb2dyYXBoaWNcclxuICAgIGlmIChjb250YWluZXIgJiYgKGxvY2F0aW9uIHx8IGdlb21ldHJ5IHx8IGdlb2dyYXBoeSkgJiYgcmVwb3J0SWQpIHtcclxuICAgICAgYXdhaXQgdGhpcy5faW5mb2dyYXBoaWNDYXJkLmxvYWRJbmZvZ3JhcGhpYyh0aGlzLl9pZnJhbWVJZCwgY29udGFpbmVyLCBsb2NhdGlvbiwgZ2VvbWV0cnksIHJlcG9ydElkLCBnZW9ncmFwaHkpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvLyBNYWluIGNvbXBvbmVudCBzY3JlZW4gZ2VuZXJhdGlvblxyXG4gIGNvbXBvbmVudERpZExvYWQoKSB7XHJcbiAgICB0aGlzLmF0dGVtcHRJbmZvZ3JhcGhpY1JlbmRlcigpO1xyXG4gIH1cclxuICByZW5kZXIoKSB7XHJcbiAgICAvLyB0aGlzLl9sKCcgcmVuZGVyKCkgcnVubmluZy4uLi4nKVxyXG4gICAgLy8gVGhpcyBpbml0aWFsbHkgcmVuZGVycyB0aGUgY29tcG9uZW50IGNvbnRhaW5lciBvbmx5IGFuZFxyXG4gICAgLy8gd2lsbCB1cGRhdGUgdGhlIGNvbnRlbnRzIHdoZW4gdGhlIFN0ZW5jaWwgbGlmZSBjeWNsZSBmdW5jdGlvblxyXG4gICAgLy8gY29tcG9uZW50RGlkTG9hZCgpIHJ1bnMuICBUaGlzIGlzIGJlY2F1c2UgdGhlIGNhcmQgcmVuZGVyKClcclxuICAgIC8vIGZ1bmN0aW9uIGlzIGFzeW5jLCBzbyB3ZSBsb2FkIGl0IHRoZW4gb24gJ2NvbXBvbmVudERpZExvYWQnIHdlXHJcbiAgICAvLyBhc3NpZ24gdGhlIGlmcmFtZSAnc3JjJyBhbmQgZG8gYSAncG9zdG1lc3NhZ2UnIHdoZW4gdGhlXHJcbiAgICAvLyBpZnJhbWUgaXMgZmluYWxseSByZWFkeSB0byBhY2NlcHQgb3B0aW9ucy5cclxuICAgIC8vXHJcbiAgICByZXR1cm4gaChcImRpdlwiLCB7IGlkOiB0aGlzLl9jb250YWluZXJJZCwgY2xhc3M6ICdjb21wb25lbnRPdXRlcicgfSk7XHJcbiAgfVxyXG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cclxuICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xyXG4gICAgXCJlbnZcIjogW1wib25FbnZDaGFuZ2VkXCJdLFxyXG4gICAgXCJ0b2tlblwiOiBbXCJvblRva2VuQ2hhbmdlZFwiXSxcclxuICAgIFwidXNlcm5hbWVcIjogW1wib25Vc2VybmFtZUNoYW5nZWRcIl0sXHJcbiAgICBcImxvY2F0aW9uTmFtZVwiOiBbXCJvbkxvY2F0aW9uRGlzcGxheU5hbWVDaGFuZ2VkXCJdLFxyXG4gICAgXCJsb2NhdGlvbkF0dHJpYnV0ZXNcIjogW1wib25Mb2NhdGlvbkF0dHJpYnV0ZXNDaGFuZ2VkXCJdLFxyXG4gICAgXCJsYW5nQ29kZVwiOiBbXCJvbkxhbmdDb2RlQ2hhbmdlZFwiXSxcclxuICAgIFwic291cmNlQ291bnRyeVwiOiBbXCJvbkNvdW50cnlDaGFuZ2VkXCJdLFxyXG4gICAgXCJvcHRpb25zXCI6IFtcIm9uT3B0aW9uc0NoYW5nZWRcIl0sXHJcbiAgICBcInJlcG9ydElkXCI6IFtcIm9uUmVwb3J0SWRDaGFuZ2VkXCJdLFxyXG4gICAgXCJ0aGVtZVwiOiBbXCJvblRoZW1lQ2hhbmdlZFwiXSxcclxuICAgIFwicmVwb3J0TG9jYXRpb25cIjogW1wib25SZXBvcnRMb2NhdGlvbkNoYW5nZWRcIl0sXHJcbiAgICBcInJlcG9ydGdlb21ldHJ5XCI6IFtcIm9uUmVwb3J0R2VvbWV0cnlDaGFuZ2VkXCJdLFxyXG4gICAgXCJyZXBvcnRnZW9ncmFwaHlcIjogW1wib25SZXBvcnRHZW9ncmFwaHlDaGFuZ2VkXCJdXHJcbiAgfTsgfVxyXG59O1xyXG5BcmNnaXNJbmZvZ3JhcGhpYy5zdHlsZSA9IGFyY2dpc0luZm9ncmFwaGljQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNJbmZvZ3JhcGhpYyBhcyBBIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1pbmZvZ3JhcGhpYy0zZWYxYTAwZi5qcy5tYXAiLCJleHBvcnQgeyBBIGFzIGFyY2dpc19pbmZvZ3JhcGhpYyB9IGZyb20gJy4vYXJjZ2lzLWluZm9ncmFwaGljLTNlZjFhMDBmLmpzJztcbmltcG9ydCAnLi9pbmRleC00ZTY0NzQxMS5qcyc7XG5pbXBvcnQgJy4vRWxlbWVudElkcy1hMmM0MDU5Mi5qcyc7XG5pbXBvcnQgJy4vR0VDbGllbnQtZjcxMDQ5ZjguanMnO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtaW5mb2dyYXBoaWMuZW50cnkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9