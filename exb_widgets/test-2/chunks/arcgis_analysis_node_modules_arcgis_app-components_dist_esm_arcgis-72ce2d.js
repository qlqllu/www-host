"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-72ce2d"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-color-contrast_8.entry.js":
/*!**************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-color-contrast_8.entry.js ***!
  \**************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_color_contrast: () => (/* binding */ ArcgisColorContrast),
/* harmony export */   arcgis_color_edit: () => (/* binding */ ArcgisColorEdit),
/* harmony export */   arcgis_color_swatch: () => (/* binding */ ArcgisColorSwatch),
/* harmony export */   arcgis_color_text_input: () => (/* binding */ ArcgisColorTextInput),
/* harmony export */   arcgis_configure_colors_table: () => (/* binding */ ArcgisConfigureColorsTable),
/* harmony export */   arcgis_contrast_preview: () => (/* binding */ ArcgisContrastPreview),
/* harmony export */   arcgis_preset_colors: () => (/* binding */ ArcgisPresetColors),
/* harmony export */   arcgis_shared_theme_colors: () => (/* binding */ ArcgisSharedThemeColors)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */







function checkContrast(a, b) {
  // complete shorthand hex codes
  a = expandHexAbbr(a);
  b = expandHexAbbr(b);
  const lum = [a, b].map(hexRgb).map(relativeLuminance);
  const contrast = luminance(lum[0], lum[1]);
  return {
    contrast,
    passesDoubleA: contrast >= 4.5
  };
}
function expandHexAbbr(hex) {
  if (hex.length !== 4) {
    return hex;
  }
  const h = hex.split("");
  return `#${h[1]}${h[1]}${h[2]}${h[2]}${h[3]}${h[3]}`;
}
function hexRgb(hex) {
  hex = hex.replace(/^#/, "");
  const alpha = 255;
  const num = parseInt(hex, 16);
  const red = num >> 16;
  const green = (num >> 8) & 255;
  const blue = num & 255;
  return [red, green, blue, alpha];
}
function relativeLuminance(rgb) {
  const rc = 0.2126;
  const gc = 0.7152;
  const bc = 0.0722;
  const lowc = 1 / 12.92;
  const rsrgb = rgb[0] / 255;
  const gsrgb = rgb[1] / 255;
  const bsrgb = rgb[2] / 255;
  const r = rsrgb <= 0.03928 ? rsrgb * lowc : adjustGamma(rsrgb), g = gsrgb <= 0.03928 ? gsrgb * lowc : adjustGamma(gsrgb), b = bsrgb <= 0.03928 ? bsrgb * lowc : adjustGamma(bsrgb);
  return r * rc + g * gc + b * bc;
}
function adjustGamma(x) {
  return Math.pow((x + 0.055) / 1.055, 2.4);
}
function luminance(a, b) {
  const l1 = Math.max(a, b);
  const l2 = Math.min(a, b);
  return (l1 + 0.05) / (l2 + 0.05);
}

const arcgisColorContrastCss = ".color-contrast{--calcite-modal-width:830px}.contrast-warning-modal{--calcite-modal-width:415px}.color-contrast__modal-content{padding:var(--arcgis-app-cap-spacing-half);position:relative;min-height:500px}.color-contrast__container{display:flex}@media screen and (max-width: 640px){.color-contrast__container{flex-direction:column}}.config-color-panel{flex:1 1 auto;min-width:0;margin-right:var(--arcgis-app-side-spacing-double);width:50%}@media screen and (max-width: 640px){.config-color-panel{width:100%}}.color-contrast__preview-panel{width:45%;flex:1 1 auto;min-width:0;display:flex;flex-direction:column}@media screen and (max-width: 640px){.color-contrast__preview-panel{width:100%}}.color-contrast__color-picker-container{position:absolute;left:50%}.hide{display:none}html[dir=rtl] .config-color-panel{margin-right:0;margin-left:var(--arcgis-app-side-spacing-double)}";

const ArcgisColorContrast = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.save = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "save", 7);
    this.cancel = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "cancel", 7);
    this.handleProceedAnayway = () => {
      this.showWarning = false;
      this.proceedToSave();
    };
    this.handleAcceptWarning = () => {
      this.showWarning = false;
    };
    this.handleSaveClick = () => {
      const hasInvalid = Object.keys(this.colorValues).some((key) => !this.colorValues[key].isBackground && !this.colorValues[key].isValidContrast);
      if (hasInvalid) {
        this.showWarning = true;
        return;
      }
      this.proceedToSave();
    };
    this.proceedToSave = () => {
      const colorResults = {};
      Object.keys(this.colorValues).forEach((key) => {
        colorResults[key] = Object.assign({}, this.colorValues[key]);
        delete colorResults[key].isBackground;
        delete colorResults[key].isLink;
      });
      this.save.emit({
        textResults: Object.assign({}, this.textValues),
        colorResults
      });
    };
    this.handleCancelClick = () => {
      this.cancel.emit();
      this.isActive = false;
    };
    this.handleEditColorClick = async (evt) => {
      this.editingKey = evt.detail;
      this.showColorPicker = true;
      await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_2__.t)(100);
      this.colorPickerEl.setFocus();
    };
    this.handleColorPickerChange = (evt) => {
      if (this.colorValues[this.editingKey].color !== evt.target.value) {
        this.setColorValue(evt.target.value);
      }
    };
    this.handlePresetColorSelect = (evt) => {
      this.setColorValue(evt.detail);
    };
    this.handleTextInputChange = (evt) => {
      const { key, value } = evt.detail;
      this.textValues = Object.assign(Object.assign({}, this.textValues), { [key]: value });
    };
    this.handleModalClose = () => {
      this.isActive = false;
    };
    this.modalTitle = "";
    this.colorConfigs = undefined;
    this.textInputConfigs = undefined;
    this.sharedTheme = undefined;
    this.isActive = true;
    this.showColorPicker = false;
    this.colorValues = {};
    this.textValues = {};
    this.editingKey = "";
    this.showWarning = false;
  }
  // Public Methods
  async open() {
    this.isActive = true;
  }
  async close() {
    this.isActive = false;
  }
  handleBodyClick(evt) {
    if (!this.showColorPicker) {
      return;
    }
    if (!this.colorPickerContainer || evt.path.indexOf(this.colorPickerContainer) === -1) {
      this.showColorPicker = false;
    }
  }
  setColorValue(color) {
    var _a;
    const updateValue = (key, props) => {
      const value = this.colorValues[key];
      this.colorValues = Object.assign(Object.assign({}, this.colorValues), { [key]: Object.assign(Object.assign({}, value), props) });
    };
    const colorValue = this.colorValues[this.editingKey];
    if (colorValue.isBackground) {
      this.colorValues = Object.assign(Object.assign({}, this.colorValues), { [this.editingKey]: Object.assign(Object.assign({}, colorValue), { color }) });
      Object.keys(this.colorValues).forEach((key) => {
        const value = this.colorValues[key];
        if (value.isBackground) {
          return;
        }
        const { contrast, passesDoubleA } = checkContrast(color, value.color);
        updateValue(key, { contrastRatio: +contrast.toFixed(1), isValidContrast: passesDoubleA });
      });
      return;
    }
    const backgroundConfig = this.getBackgroundConfig();
    const backgroundColor = (_a = this.colorValues[backgroundConfig.key]) === null || _a === void 0 ? void 0 : _a.color;
    const { contrast, passesDoubleA } = checkContrast(backgroundColor, color);
    updateValue(this.editingKey, {
      color,
      contrastRatio: +contrast.toFixed(1),
      isValidContrast: passesDoubleA
    });
  }
  getBackgroundConfig() {
    return this.colorConfigs.find((config) => config.isBackground);
  }
  async componentWillLoad() {
    var _a;
    const locale = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.el);
    this.i18n = locale[0];
    this.colorValues = this.colorConfigs.reduce((acc, { key, defaultColor, isBackground, isLink }) => {
      acc[key] = {
        color: defaultColor,
        isBackground,
        isLink
      };
      return acc;
    }, {});
    const backgroundConfig = this.getBackgroundConfig();
    if (!backgroundConfig) {
      return;
    }
    const backgroundColor = (_a = this.colorValues[backgroundConfig.key]) === null || _a === void 0 ? void 0 : _a.color;
    Object.keys(this.colorValues).forEach((key) => {
      const value = this.colorValues[key];
      if (value.isBackground) {
        return;
      }
      const { contrast, passesDoubleA } = checkContrast(value.color, backgroundColor);
      value.contrastRatio = +contrast.toFixed(1);
      value.isValidContrast = passesDoubleA;
    });
    this.textInputConfigs.forEach((config) => {
      this.textValues[config.key] = config.defaultValue || "";
    });
  }
  render() {
    var _a;
    const backgroundConfig = this.getBackgroundConfig();
    const linkConfig = this.colorConfigs.filter((config) => config.isLink)[0];
    const otherConfigs = this.colorConfigs.filter((config) => !config.isBackground && !config.isLink);
    const backgroundColor = backgroundConfig ? this.colorValues[backgroundConfig.key].color : "";
    if (!backgroundConfig) {
      return;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { open: this.isActive, class: "color-contrast", onCalciteModalClose: this.handleModalClose }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { slot: "header" }, this.modalTitle), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", class: "color-contrast__modal-content" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-contrast__container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "config-color-panel" }, this.textInputConfigs.map((config) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-text-input", { key: config.key, keyValue: config.key, label: config.label, defaultValue: config.defaultValue, onInputChange: this.handleTextInputChange }))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-configure-colors-table", { i18n: this.i18n, backgroundConfig: backgroundConfig, otherConfigs: otherConfigs, linkConfig: linkConfig, colorValues: this.colorValues, onEditClick: this.handleEditColorClick })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-contrast__preview-panel" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.i18n.preview), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-contrast-preview", { backgroundColor: backgroundColor, textColorConfigs: otherConfigs, linkConfig: linkConfig, colorValues: this.colorValues })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
        "color-contrast__color-picker-container": true,
        hide: !this.showColorPicker
      }, ref: (el) => (this.colorPickerContainer = el) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-color-picker", { scale: "s", value: (_a = this.colorValues[this.editingKey]) === null || _a === void 0 ? void 0 : _a.color, hideSaved: true, ref: (el) => (this.colorPickerEl = el), onCalciteColorPickerInput: this.handleColorPickerChange }), this.sharedTheme && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-shared-theme-colors", { sharedTheme: this.sharedTheme, i18n: this.i18n, onSelectColor: this.handlePresetColorSelect }))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-preset-colors", { i18n: this.i18n, onSelectColor: this.handlePresetColorSelect }))))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "outline-fill", onClick: this.handleCancelClick }, this.i18n.cancel), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", onClick: this.handleSaveClick }, this.i18n.save)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { open: this.showWarning, kind: "danger", class: "contrast-warning-modal" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { slot: "header", class: "trailer-0 font-size-1" }, this.i18n.contrastWarning.title), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content" }, this.i18n.contrastWarning.description), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", onClick: this.handleAcceptWarning }, this.i18n.contrastWarning.editColors), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", kind: "danger", appearance: "transparent", onClick: this.handleProceedAnayway }, this.i18n.contrastWarning.proceedAnyway))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisColorContrast.style = arcgisColorContrastCss;

const arcgisColorEditCss = ".color-edit-container{padding:var(--arcgis-app-side-spacing-quarter);display:flex;align-items:center;cursor:pointer}.color-tile{border:1px solid #a9a9a9;width:30px;height:30px;margin-right:var(--arcgis-app-side-spacing-three-quarters)}.color-edit__label-value{flex:1 1 auto;min-width:0;text-align:start}.color-edit-label{font-size:var(--arcgis-app-font-size--2);font-weight:normal}.color-edit-value{font-size:var(--arcgis-app-font-size--1);font-weight:var(--arcgis-app-font-weight-demi)}.color-edit-icon{margin-right:var(--arcgis-app-side-spacing-three-quarters)}html[dir=rtl] .color-tile{margin-right:0;margin-left:var(--arcgis-app-side-spacing-three-quarters)}html[dir=rtl] .color-edit-icon{margin-right:0;margin-left:var(--arcgis-app-side-spacing-three-quarters)}";

const ArcgisColorEdit = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.colorEditClick = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "colorEditClick", 7);
    this.handleClick = (evt) => {
      evt === null || evt === void 0 ? void 0 : evt.stopPropagation();
      this.colorEditClick.emit(this.editKey);
    };
    this.handleKeyup = (event) => {
      if (event.key === " " || event.key === "Enter") {
        event.preventDefault();
        this.handleClick(event);
      }
    };
    this.editKey = "";
    this.labelText = "";
    this.colorValue = "";
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-edit-container", tabIndex: 0, onClick: this.handleClick, onKeyUp: this.handleKeyup }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-tile", style: { backgroundColor: this.colorValue } })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-edit__label-value" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-edit-label" }, this.labelText), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-edit-value " }, this.colorValue)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-edit-icon" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "pencil" }))));
  }
};
ArcgisColorEdit.style = arcgisColorEditCss;

const arcgisColorSwatchCss = ".color-swatch{display:inline-block;height:16px;width:16px;box-sizing:border-box;margin-right:2px;overflow:hidden}";

const ArcgisColorSwatch = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.swatchClick = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "swatchClick", 7);
    this.handleClick = () => {
      this.swatchClick.emit(this.color);
    };
    this.handleKeyUp = (event) => {
      if (event.key === " " || event.key === "Enter") {
        this.handleClick();
      }
    };
    this.color = "";
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-swatch", onClick: this.handleClick, onKeyUp: this.handleKeyUp, tabIndex: 0 }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("svg", { width: "16", height: "16" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { width: "16", height: "16", fill: this.color }))));
  }
};
ArcgisColorSwatch.style = arcgisColorSwatchCss;

const ArcgisColorTextInput = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.inputChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "inputChange", 7);
    this.handleInputChange = (evt) => {
      const node = evt.target;
      this.value = node.value;
      this.inputChange.emit({
        key: this.keyValue,
        value: node.value
      });
    };
    this.keyValue = undefined;
    this.label = undefined;
    this.defaultValue = undefined;
    this.value = "";
  }
  componentWillLoad() {
    if (this.defaultValue) {
      this.value = this.defaultValue;
    }
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.label, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { value: this.value, onCalciteInputInput: this.handleInputChange, scale: "s" })));
  }
};

const ColorRow = ({ key, colorConfig, color, contrastRatio, isValidContrast, i18n, onColorEditClick }) => {
  return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("tr", { "data-key": key },
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", { class: "color-contrast__color-col" },
      (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-edit", { editKey: colorConfig.key, labelText: colorConfig.label, colorValue: color, onColorEditClick: onColorEditClick })),
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", { class: "color-contrast__ratio-col" }, contrastRatio),
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", { class: "color-contrast__legibility-col" },
      (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-row__legibility" }, isValidContrast ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.F, null,
        (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "check-circle-f", class: "color-contrast--valid" }),
        (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-contrast__legible-label" }, i18n.legible))) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.F, null,
        (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "x-circle-f", class: "color-contrast--invalid" }),
        (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-contrast__legible-label" }, i18n.notLegible)))))));
};

const arcgisConfigureColorsTableCss = ".config-color-table{width:100%;border-collapse:collapse}th,td{border:1px solid #dddd;text-align:center;font-size:var(--arcgis-app-font-size--1)}.color-contrast__legibility-col{padding:0.5rem;text-align:start;width:6rem}.color-contrast--valid{color:green}.color-contrast--invalid{color:red}.color-row__legibility{display:flex;align-items:center}.color-contrast__legible-label{margin:0 0.5rem}.contrast-info{font-size:0.8rem}";

const ArcgisConfigureColorsTable = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.editClick = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "editClick", 7);
    this.handleEditClick = (evt) => {
      this.editClick.emit(evt.detail);
    };
    this.i18n = undefined;
    this.backgroundConfig = undefined;
    this.otherConfigs = undefined;
    this.linkConfig = undefined;
    this.colorValues = {};
  }
  render() {
    var _a;
    const backgroundColor = this.colorValues[this.backgroundConfig.key].color;
    const linkValue = this.colorValues[(_a = this.linkConfig) === null || _a === void 0 ? void 0 : _a.key];
    const linkColor = (linkValue === null || linkValue === void 0 ? void 0 : linkValue.color) || "";
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.i18n.configure, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("table", { class: "config-color-table" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("thead", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("tr", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("th", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-edit", { editKey: this.backgroundConfig.key, labelText: this.backgroundConfig.label || this.i18n.background, colorValue: backgroundColor, onColorEditClick: this.handleEditClick })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("th", { class: "color-edit-label" }, this.i18n.contrastRatio), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("th", { class: "color-edit-label" }, this.i18n.legibility))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("tbody", null, this.otherConfigs.map((config) => {
      const { color, contrastRatio, isValidContrast } = this.colorValues[config.key];
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(ColorRow, { key: config.key, colorConfig: config, color: color, contrastRatio: contrastRatio, isValidContrast: isValidContrast, i18n: this.i18n, onColorEditClick: this.handleEditClick }));
    }), this.linkConfig && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(ColorRow, { key: this.linkConfig.key, colorConfig: this.linkConfig, color: linkColor, contrastRatio: linkValue === null || linkValue === void 0 ? void 0 : linkValue.contrastRatio, isValidContrast: linkValue === null || linkValue === void 0 ? void 0 : linkValue.isValidContrast, i18n: this.i18n, onColorEditClick: this.handleEditClick })))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "contrast-info" }, this.i18n.contrastInfo)));
  }
};
ArcgisConfigureColorsTable.style = arcgisConfigureColorsTableCss;

const arcgisContrastPreviewCss = ".contrast-preview{padding:1rem;flex:1 1 auto;min-width:0}.contrast-preview h2,.contrast-preview p,.contrast-preview button{margin-bottom:1rem;margin-top:0}";

const ArcgisContrastPreview = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.backgroundColor = "";
    this.textColorConfigs = undefined;
    this.linkConfig = undefined;
    this.colorValues = undefined;
  }
  renderLinkConfig() {
    var _a;
    if (!((_a = this.linkConfig) === null || _a === void 0 ? void 0 : _a.preview)) {
      return;
    }
    const { preview } = this.linkConfig;
    if (preview.isButton) {
      return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", null, preview.text);
    }
    return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, preview.text);
  }
  render() {
    var _a;
    const linkColor = this.colorValues[(_a = this.linkConfig) === null || _a === void 0 ? void 0 : _a.key].color || "#00a0ff";
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("style", { innerHTML: `.contrast-preview a {
          color: ${linkColor || "inherit"};
        } .contrast-preview button {
          color: ${linkColor || "inherit"};
          border: ${linkColor ? `1px solid ${linkColor}` : "inherit"};
          background: ${linkColor ? "none" : "inherit"};
          padding: 0.375rem 1rem;
        }` }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "contrast-preview", style: { backgroundColor: this.backgroundColor } }, this.textColorConfigs.map(({ preview, key }) => {
      const { color } = this.colorValues[key];
      if (!preview) {
        return;
      }
      if (preview.isHeading) {
        return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h2", { style: { color }, innerHTML: preview.text });
      }
      return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { style: { color }, innerHTML: preview.text });
    }), this.renderLinkConfig())));
  }
};
ArcgisContrastPreview.style = arcgisContrastPreviewCss;

const arcgisPresetColorsCss = ".preset-colors{max-width:160px;padding:8px 16px;background-color:#fff;border:1px solid #ccc;border-top:none;box-sizing:border-box}.preset-colors .preset-colors__title{font-size:0.825rem}.preset-colors .preset-row{max-height:16px;margin-bottom:2px}";

const ArcgisPresetColors = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.selectColor = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "selectColor", 7);
    this.presetColors = {
      brown: ["f2ece6", "7c410a", "3e2105"],
      blue: ["e5f1f9", "0079c1", "003d61"],
      green: ["e9f3ea", "288835", "14441b"],
      yellow: ["fefced", "f9e54e", "7d7327"],
      orange: ["fef5e9", "f89927", "7c4d14"],
      red: ["fbeae8", "d83020", "6c1810"],
      violet: ["efebf5", "633b9b", "321e4e"]
    };
    this.handleSwatchClick = (evt) => {
      this.selectColor.emit(evt.detail);
    };
    this.i18n = undefined;
  }
  render() {
    const colorRows = [];
    for (let i = 2; i >= 0; i--) {
      const row = [];
      Object.keys(this.presetColors).forEach((key) => {
        const colorArr = this.presetColors[key];
        row.push(`#${colorArr[i]}`);
      });
      colorRows.push(row);
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "preset-colors" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "preset-colors__title" }, this.i18n.presetColors), colorRows.map((row) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "preset-row" }, row.map((color) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-swatch", { key: color, color: color, onSwatchClick: this.handleSwatchClick }))))))));
  }
};
ArcgisPresetColors.style = arcgisPresetColorsCss;

const arcgisSharedThemeColorsCss = ".shared-theme{max-width:160px;padding:8px 16px;background-color:#fff;border:1px solid #ccc;border-top:none;box-sizing:border-box}.shared-theme-colors__title{font-size:0.825rem}.shared-theme__row{max-height:16px;margin-bottom:2px}";

const ArcgisSharedThemeColors = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.selectColor = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "selectColor", 7);
    this.handleSwatchClick = (evt) => {
      this.selectColor.emit(evt.detail);
    };
    this.i18n = undefined;
    this.sharedTheme = undefined;
  }
  render() {
    if (!this.sharedTheme) {
      return;
    }
    const colors = {};
    Object.keys(this.sharedTheme).forEach((key) => {
      if (!this.sharedTheme[key]) {
        return;
      }
      const { background, text, link } = this.sharedTheme[key];
      if (background) {
        colors[background] = true;
      }
      if (text) {
        colors[text] = true;
      }
      if (link) {
        colors[link] = true;
      }
    });
    if (!Object.keys(colors).length) {
      return;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "shared-theme" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "shared-theme-colors__title" }, this.i18n.sharedTheme), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "shared-theme__row" }, Object.keys(colors).sort().map((color) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-swatch", { key: color, color: color, onSwatchClick: this.handleSwatchClick }))))));
  }
};
ArcgisSharedThemeColors.style = arcgisSharedThemeColorsCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ arrayToLookupMap),
/* harmony export */   b: () => (/* binding */ unique),
/* harmony export */   c: () => (/* binding */ throttle),
/* harmony export */   d: () => (/* binding */ debounce),
/* harmony export */   e: () => (/* binding */ escapeRegExp),
/* harmony export */   f: () => (/* binding */ arraysAreEquivalent),
/* harmony export */   g: () => (/* binding */ chunk),
/* harmony export */   i: () => (/* binding */ isDefined),
/* harmony export */   m: () => (/* binding */ minDelay),
/* harmony export */   t: () => (/* binding */ timeout),
/* harmony export */   u: () => (/* binding */ uniqueBy)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
/**
 * Call a function only after it has not been called for n milliseconds
 * @param fn    - function to call
 * @param delay - delay in milliseconds
 */
const debounce = (fn, delay) => {
  let timeout;
  let status = "idle";
  function flush(...args) {
    status = "flushed";
    return debounced(...args);
  }
  function invoke(...args) {
    status = "invoked";
    return debounced(...args);
  }
  function cancel(...args) {
    status = "cancelled";
    return debounced(...args);
  }
  function getStatus() {
    return status;
  }
  const debounced = (...args) => new Promise((resolve) => {
    switch (status) {
      case "flushed":
        status = "idle";
        if (timeout) {
          clearTimeout(timeout);
          resolve(fn(...args));
        }
        else {
          resolve(null);
        }
        break;
      case "invoked":
        clearTimeout(timeout);
        status = "idle";
        resolve(fn(...args));
        break;
      case "cancelled":
        clearTimeout(timeout);
        status = "idle";
        resolve(null);
        break;
      default:
        if (timeout) {
          clearTimeout(timeout);
        }
        status = "pending";
        timeout = setTimeout(() => {
          status = "idle";
          return resolve(fn(...args));
        }, delay);
        break;
    }
  });
  debounced.flush = flush;
  debounced.invoke = invoke;
  debounced.cancel = cancel;
  debounced.getStatus = getStatus;
  return debounced;
};
/**
 * Call a function only after n milliseconds have elapsed
 * @param fn    - function to call
 * @param delay - delay in milliseconds
 */
const throttle = (fn, delay) => {
  let timeout;
  return (...args) => new Promise((resolve) => {
    if (timeout) {
      return;
    }
    timeout = setTimeout(() => {
      clearTimeout(timeout);
      timeout = undefined;
      resolve(fn(...args));
    }, delay);
  });
};
function escapeRegExp(str) {
  return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"); // $& means the whole matched string
}
function isDefined(value) {
  return value !== undefined && value !== null;
}
/**
 * Set a minimum time for a promise to resolve (useful for preventing flash of loaders)
 */
async function minDelay(promise, minDelay) {
  await Promise.all([promise, timeout(minDelay)]);
  return promise;
}
/**
 * Helper method to inline setTimeout as an await in async functions
 */
function timeout(ms) {
  return new Promise((resolve) => setTimeout(resolve, ms));
}
const arrayToLookupMap = (dataArr, getKeyAndItem) => Object.fromEntries((dataArr || []).map((item) => {
  const { key, data } = getKeyAndItem(item);
  return [key, data];
}));
/**
 * Check whether two arrays have the same number of elements
 * and whether they contain the same elements
 * regardless of order
 */
const arraysAreEquivalent = (arr1, arr2) => arr1.length === arr2.length && arr1.reduce((memo, str) => memo && arr2.indexOf(str) > -1, true);
function uniqueBy(myArr, getItemId) {
  const resultArr = [];
  const lookupMap = {};
  myArr.forEach((item) => {
    const id = getItemId(item);
    if (lookupMap[id] == null) {
      lookupMap[id] = item;
      resultArr.push(item);
    }
  });
  return resultArr;
}
function unique(myArr) {
  const primitives = { boolean: {}, number: {}, string: {} };
  const objs = [];
  return myArr.filter((item) => {
    let type = typeof item;
    if (type in primitives) {
      return primitives[type].hasOwnProperty(item) ? false : (primitives[type][item] = true);
    }
    else {
      return objs.indexOf(item) >= 0 ? false : objs.push(item);
    }
  });
}
const chunk = (arr, size) => [...Array(Math.ceil(arr.length / size))].map((_, i) => arr.slice(size * i, size + size * i));




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



const languageMap = new Map([
  ["ar", "ar"],
  ["bg", "bg"],
  ["bs", "bs"],
  ["ca", "ca"],
  ["cs", "cs"],
  ["da", "da"],
  ["de", "de"],
  ["el", "el"],
  ["en", "en"],
  ["es", "es"],
  ["et", "et"],
  ["fi", "fi"],
  ["fr", "fr"],
  ["he", "he"],
  ["hr", "hr"],
  ["hu", "hu"],
  ["id", "id"],
  ["it", "it"],
  ["ja", "ja"],
  ["ko", "ko"],
  ["lt", "lt"],
  ["lv", "lv"],
  ["nb", "nb"],
  ["nl", "nl"],
  ["pl", "pl"],
  ["pt-br", "pt-BR"],
  ["pt-pt", "pt-PT"],
  ["ro", "ro"],
  ["ru", "ru"],
  ["sk", "sk"],
  ["sl", "sl"],
  ["sr", "sr"],
  ["sv", "sv"],
  ["th", "th"],
  ["tr", "tr"],
  ["uk", "uk"],
  ["vi", "vi"],
  ["zh-cn", "zh-CN"],
  ["zh-hk", "zh-HK"],
  ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
  return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
  const closestWithProp = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
  return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
  rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
  const { api, type, places } = options || {};
  if (api === 4) {
    const [intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
    const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
      places,
      style: type,
      digitSeparator: true
    });
    return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
  }
  const [dojoNumber] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
  return dojoNumber.format(number, {
    type,
    places,
    pattern: options === null || options === void 0 ? void 0 : options.pattern
  });
}
const cache = {};
function formatDate(date) {
  const lang = document.documentElement.lang;
  const dayShortMonthYear = {
    year: "numeric",
    month: "short",
    day: "numeric"
  };
  if (!cache[lang]) {
    cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
  }
  return cache[lang].format(date);
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
  var _a, _b, _c;
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    // "ru-RU" maps to "ru" use case
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
    }
    else {
      return "en";
    }
  }
}
function getComponentClosestLanguageIntl(element) {
  var _a, _b, _c;
  // it's OK if we don't have the 4 letter language file for it
  // 4 letter language code needed for formatting numbers
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      // we support the 2 letter coded language
      // e.g. it-CH vs it
      return lang;
    }
    else {
      return "en";
    }
  }
}
function fetchLocaleStringsForComponent(componentName, locale) {
  return new Promise((resolve, reject) => {
    fetch((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
      if (result.ok)
        resolve(result.json());
      else
        reject();
    }, () => reject());
  });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
  const id = `${componentName}${locale}`;
  if (!stringCache[id]) {
    stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
  }
  return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
  const componentName = tagName || element.tagName.toLowerCase();
  const componentLanguage = getComponentClosestLanguage(element);
  const componentLanguageIntl = getComponentClosestLanguageIntl(element);
  let strings;
  try {
    strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
  }
  catch (e) {
    console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
    strings = await fetchLocaleStringsFromCache(componentName, "en");
  }
  return [strings, componentLanguage, componentLanguageIntl];
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTcyY2UyZC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzRIO0FBQ3REO0FBQ2Q7QUFDN0I7QUFDUztBQUNEOztBQUVuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsZ0RBQWdELDRCQUE0Qix3QkFBd0IsNEJBQTRCLCtCQUErQiwyQ0FBMkMsa0JBQWtCLGlCQUFpQiwyQkFBMkIsYUFBYSxxQ0FBcUMsMkJBQTJCLHVCQUF1QixvQkFBb0IsY0FBYyxZQUFZLG1EQUFtRCxVQUFVLHFDQUFxQyxvQkFBb0IsWUFBWSwrQkFBK0IsVUFBVSxjQUFjLFlBQVksYUFBYSxzQkFBc0IscUNBQXFDLCtCQUErQixZQUFZLHdDQUF3QyxrQkFBa0IsU0FBUyxNQUFNLGFBQWEsa0NBQWtDLGVBQWUsa0RBQWtEOztBQUUzNEI7QUFDQTtBQUNBLElBQUkscURBQWdCO0FBQ3BCLGdCQUFnQixxREFBVztBQUMzQixrQkFBa0IscURBQVc7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QUFXO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBLFFBQVEsd0RBQVc7QUFDbkIsYUFBYSx3REFBVztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixtREFBaUM7QUFDaEU7QUFDQTtBQUNBLE1BQU0sd0RBQVc7QUFDakIsV0FBVyx3REFBVztBQUN0QjtBQUNBO0FBQ0EsUUFBUSx3REFBVztBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxxREFBWSw4QkFBOEIsY0FBYyxRQUFRLE9BQU87QUFDakY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixjQUFjLEVBQUUsT0FBTztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsZUFBZSxHQUFHLGtCQUFrQjtBQUN0RTtBQUNBO0FBQ0E7QUFDQTs7QUFFNEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtY29sb3ItY29udHJhc3RfOC5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9mdW5jdGlvbmFsLWM4MmY1YWI5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xhbmd1YWdlVXRpbC0yMjI1OGM5MC5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sb2NhbGUtMTNlMDBhNzUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIEggYXMgSG9zdCwgZCBhcyBnZXRFbGVtZW50LCBGIGFzIEZyYWdtZW50IH0gZnJvbSAnLi9pbmRleC05MmViYjM5Ni5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgfSBmcm9tICcuL2xvY2FsZS0xM2UwMGE3NS5qcyc7XG5pbXBvcnQgeyB0IGFzIHRpbWVvdXQgfSBmcm9tICcuL2Z1bmN0aW9uYWwtYzgyZjVhYjkuanMnO1xuaW1wb3J0ICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgJy4vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1hYWYzMGJkNi5qcyc7XG5cbmZ1bmN0aW9uIGNoZWNrQ29udHJhc3QoYSwgYikge1xuICAvLyBjb21wbGV0ZSBzaG9ydGhhbmQgaGV4IGNvZGVzXG4gIGEgPSBleHBhbmRIZXhBYmJyKGEpO1xuICBiID0gZXhwYW5kSGV4QWJicihiKTtcbiAgY29uc3QgbHVtID0gW2EsIGJdLm1hcChoZXhSZ2IpLm1hcChyZWxhdGl2ZUx1bWluYW5jZSk7XG4gIGNvbnN0IGNvbnRyYXN0ID0gbHVtaW5hbmNlKGx1bVswXSwgbHVtWzFdKTtcbiAgcmV0dXJuIHtcbiAgICBjb250cmFzdCxcbiAgICBwYXNzZXNEb3VibGVBOiBjb250cmFzdCA+PSA0LjVcbiAgfTtcbn1cbmZ1bmN0aW9uIGV4cGFuZEhleEFiYnIoaGV4KSB7XG4gIGlmIChoZXgubGVuZ3RoICE9PSA0KSB7XG4gICAgcmV0dXJuIGhleDtcbiAgfVxuICBjb25zdCBoID0gaGV4LnNwbGl0KFwiXCIpO1xuICByZXR1cm4gYCMke2hbMV19JHtoWzFdfSR7aFsyXX0ke2hbMl19JHtoWzNdfSR7aFszXX1gO1xufVxuZnVuY3Rpb24gaGV4UmdiKGhleCkge1xuICBoZXggPSBoZXgucmVwbGFjZSgvXiMvLCBcIlwiKTtcbiAgY29uc3QgYWxwaGEgPSAyNTU7XG4gIGNvbnN0IG51bSA9IHBhcnNlSW50KGhleCwgMTYpO1xuICBjb25zdCByZWQgPSBudW0gPj4gMTY7XG4gIGNvbnN0IGdyZWVuID0gKG51bSA+PiA4KSAmIDI1NTtcbiAgY29uc3QgYmx1ZSA9IG51bSAmIDI1NTtcbiAgcmV0dXJuIFtyZWQsIGdyZWVuLCBibHVlLCBhbHBoYV07XG59XG5mdW5jdGlvbiByZWxhdGl2ZUx1bWluYW5jZShyZ2IpIHtcbiAgY29uc3QgcmMgPSAwLjIxMjY7XG4gIGNvbnN0IGdjID0gMC43MTUyO1xuICBjb25zdCBiYyA9IDAuMDcyMjtcbiAgY29uc3QgbG93YyA9IDEgLyAxMi45MjtcbiAgY29uc3QgcnNyZ2IgPSByZ2JbMF0gLyAyNTU7XG4gIGNvbnN0IGdzcmdiID0gcmdiWzFdIC8gMjU1O1xuICBjb25zdCBic3JnYiA9IHJnYlsyXSAvIDI1NTtcbiAgY29uc3QgciA9IHJzcmdiIDw9IDAuMDM5MjggPyByc3JnYiAqIGxvd2MgOiBhZGp1c3RHYW1tYShyc3JnYiksIGcgPSBnc3JnYiA8PSAwLjAzOTI4ID8gZ3NyZ2IgKiBsb3djIDogYWRqdXN0R2FtbWEoZ3NyZ2IpLCBiID0gYnNyZ2IgPD0gMC4wMzkyOCA/IGJzcmdiICogbG93YyA6IGFkanVzdEdhbW1hKGJzcmdiKTtcbiAgcmV0dXJuIHIgKiByYyArIGcgKiBnYyArIGIgKiBiYztcbn1cbmZ1bmN0aW9uIGFkanVzdEdhbW1hKHgpIHtcbiAgcmV0dXJuIE1hdGgucG93KCh4ICsgMC4wNTUpIC8gMS4wNTUsIDIuNCk7XG59XG5mdW5jdGlvbiBsdW1pbmFuY2UoYSwgYikge1xuICBjb25zdCBsMSA9IE1hdGgubWF4KGEsIGIpO1xuICBjb25zdCBsMiA9IE1hdGgubWluKGEsIGIpO1xuICByZXR1cm4gKGwxICsgMC4wNSkgLyAobDIgKyAwLjA1KTtcbn1cblxuY29uc3QgYXJjZ2lzQ29sb3JDb250cmFzdENzcyA9IFwiLmNvbG9yLWNvbnRyYXN0ey0tY2FsY2l0ZS1tb2RhbC13aWR0aDo4MzBweH0uY29udHJhc3Qtd2FybmluZy1tb2RhbHstLWNhbGNpdGUtbW9kYWwtd2lkdGg6NDE1cHh9LmNvbG9yLWNvbnRyYXN0X19tb2RhbC1jb250ZW50e3BhZGRpbmc6dmFyKC0tYXJjZ2lzLWFwcC1jYXAtc3BhY2luZy1oYWxmKTtwb3NpdGlvbjpyZWxhdGl2ZTttaW4taGVpZ2h0OjUwMHB4fS5jb2xvci1jb250cmFzdF9fY29udGFpbmVye2Rpc3BsYXk6ZmxleH1AbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA2NDBweCl7LmNvbG9yLWNvbnRyYXN0X19jb250YWluZXJ7ZmxleC1kaXJlY3Rpb246Y29sdW1ufX0uY29uZmlnLWNvbG9yLXBhbmVse2ZsZXg6MSAxIGF1dG87bWluLXdpZHRoOjA7bWFyZ2luLXJpZ2h0OnZhcigtLWFyY2dpcy1hcHAtc2lkZS1zcGFjaW5nLWRvdWJsZSk7d2lkdGg6NTAlfUBtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDY0MHB4KXsuY29uZmlnLWNvbG9yLXBhbmVse3dpZHRoOjEwMCV9fS5jb2xvci1jb250cmFzdF9fcHJldmlldy1wYW5lbHt3aWR0aDo0NSU7ZmxleDoxIDEgYXV0bzttaW4td2lkdGg6MDtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1ufUBtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDY0MHB4KXsuY29sb3ItY29udHJhc3RfX3ByZXZpZXctcGFuZWx7d2lkdGg6MTAwJX19LmNvbG9yLWNvbnRyYXN0X19jb2xvci1waWNrZXItY29udGFpbmVye3Bvc2l0aW9uOmFic29sdXRlO2xlZnQ6NTAlfS5oaWRle2Rpc3BsYXk6bm9uZX1odG1sW2Rpcj1ydGxdIC5jb25maWctY29sb3ItcGFuZWx7bWFyZ2luLXJpZ2h0OjA7bWFyZ2luLWxlZnQ6dmFyKC0tYXJjZ2lzLWFwcC1zaWRlLXNwYWNpbmctZG91YmxlKX1cIjtcblxuY29uc3QgQXJjZ2lzQ29sb3JDb250cmFzdCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5zYXZlID0gY3JlYXRlRXZlbnQodGhpcywgXCJzYXZlXCIsIDcpO1xuICAgIHRoaXMuY2FuY2VsID0gY3JlYXRlRXZlbnQodGhpcywgXCJjYW5jZWxcIiwgNyk7XG4gICAgdGhpcy5oYW5kbGVQcm9jZWVkQW5heXdheSA9ICgpID0+IHtcbiAgICAgIHRoaXMuc2hvd1dhcm5pbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMucHJvY2VlZFRvU2F2ZSgpO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVBY2NlcHRXYXJuaW5nID0gKCkgPT4ge1xuICAgICAgdGhpcy5zaG93V2FybmluZyA9IGZhbHNlO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVTYXZlQ2xpY2sgPSAoKSA9PiB7XG4gICAgICBjb25zdCBoYXNJbnZhbGlkID0gT2JqZWN0LmtleXModGhpcy5jb2xvclZhbHVlcykuc29tZSgoa2V5KSA9PiAhdGhpcy5jb2xvclZhbHVlc1trZXldLmlzQmFja2dyb3VuZCAmJiAhdGhpcy5jb2xvclZhbHVlc1trZXldLmlzVmFsaWRDb250cmFzdCk7XG4gICAgICBpZiAoaGFzSW52YWxpZCkge1xuICAgICAgICB0aGlzLnNob3dXYXJuaW5nID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5wcm9jZWVkVG9TYXZlKCk7XG4gICAgfTtcbiAgICB0aGlzLnByb2NlZWRUb1NhdmUgPSAoKSA9PiB7XG4gICAgICBjb25zdCBjb2xvclJlc3VsdHMgPSB7fTtcbiAgICAgIE9iamVjdC5rZXlzKHRoaXMuY29sb3JWYWx1ZXMpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICBjb2xvclJlc3VsdHNba2V5XSA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY29sb3JWYWx1ZXNba2V5XSk7XG4gICAgICAgIGRlbGV0ZSBjb2xvclJlc3VsdHNba2V5XS5pc0JhY2tncm91bmQ7XG4gICAgICAgIGRlbGV0ZSBjb2xvclJlc3VsdHNba2V5XS5pc0xpbms7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuc2F2ZS5lbWl0KHtcbiAgICAgICAgdGV4dFJlc3VsdHM6IE9iamVjdC5hc3NpZ24oe30sIHRoaXMudGV4dFZhbHVlcyksXG4gICAgICAgIGNvbG9yUmVzdWx0c1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZUNhbmNlbENsaWNrID0gKCkgPT4ge1xuICAgICAgdGhpcy5jYW5jZWwuZW1pdCgpO1xuICAgICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVFZGl0Q29sb3JDbGljayA9IGFzeW5jIChldnQpID0+IHtcbiAgICAgIHRoaXMuZWRpdGluZ0tleSA9IGV2dC5kZXRhaWw7XG4gICAgICB0aGlzLnNob3dDb2xvclBpY2tlciA9IHRydWU7XG4gICAgICBhd2FpdCB0aW1lb3V0KDEwMCk7XG4gICAgICB0aGlzLmNvbG9yUGlja2VyRWwuc2V0Rm9jdXMoKTtcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlQ29sb3JQaWNrZXJDaGFuZ2UgPSAoZXZ0KSA9PiB7XG4gICAgICBpZiAodGhpcy5jb2xvclZhbHVlc1t0aGlzLmVkaXRpbmdLZXldLmNvbG9yICE9PSBldnQudGFyZ2V0LnZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0Q29sb3JWYWx1ZShldnQudGFyZ2V0LnZhbHVlKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlUHJlc2V0Q29sb3JTZWxlY3QgPSAoZXZ0KSA9PiB7XG4gICAgICB0aGlzLnNldENvbG9yVmFsdWUoZXZ0LmRldGFpbCk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZVRleHRJbnB1dENoYW5nZSA9IChldnQpID0+IHtcbiAgICAgIGNvbnN0IHsga2V5LCB2YWx1ZSB9ID0gZXZ0LmRldGFpbDtcbiAgICAgIHRoaXMudGV4dFZhbHVlcyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy50ZXh0VmFsdWVzKSwgeyBba2V5XTogdmFsdWUgfSk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZU1vZGFsQ2xvc2UgPSAoKSA9PiB7XG4gICAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7XG4gICAgfTtcbiAgICB0aGlzLm1vZGFsVGl0bGUgPSBcIlwiO1xuICAgIHRoaXMuY29sb3JDb25maWdzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudGV4dElucHV0Q29uZmlncyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNoYXJlZFRoZW1lID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaXNBY3RpdmUgPSB0cnVlO1xuICAgIHRoaXMuc2hvd0NvbG9yUGlja2VyID0gZmFsc2U7XG4gICAgdGhpcy5jb2xvclZhbHVlcyA9IHt9O1xuICAgIHRoaXMudGV4dFZhbHVlcyA9IHt9O1xuICAgIHRoaXMuZWRpdGluZ0tleSA9IFwiXCI7XG4gICAgdGhpcy5zaG93V2FybmluZyA9IGZhbHNlO1xuICB9XG4gIC8vIFB1YmxpYyBNZXRob2RzXG4gIGFzeW5jIG9wZW4oKSB7XG4gICAgdGhpcy5pc0FjdGl2ZSA9IHRydWU7XG4gIH1cbiAgYXN5bmMgY2xvc2UoKSB7XG4gICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlO1xuICB9XG4gIGhhbmRsZUJvZHlDbGljayhldnQpIHtcbiAgICBpZiAoIXRoaXMuc2hvd0NvbG9yUGlja2VyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghdGhpcy5jb2xvclBpY2tlckNvbnRhaW5lciB8fCBldnQucGF0aC5pbmRleE9mKHRoaXMuY29sb3JQaWNrZXJDb250YWluZXIpID09PSAtMSkge1xuICAgICAgdGhpcy5zaG93Q29sb3JQaWNrZXIgPSBmYWxzZTtcbiAgICB9XG4gIH1cbiAgc2V0Q29sb3JWYWx1ZShjb2xvcikge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB1cGRhdGVWYWx1ZSA9IChrZXksIHByb3BzKSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuY29sb3JWYWx1ZXNba2V5XTtcbiAgICAgIHRoaXMuY29sb3JWYWx1ZXMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY29sb3JWYWx1ZXMpLCB7IFtrZXldOiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHZhbHVlKSwgcHJvcHMpIH0pO1xuICAgIH07XG4gICAgY29uc3QgY29sb3JWYWx1ZSA9IHRoaXMuY29sb3JWYWx1ZXNbdGhpcy5lZGl0aW5nS2V5XTtcbiAgICBpZiAoY29sb3JWYWx1ZS5pc0JhY2tncm91bmQpIHtcbiAgICAgIHRoaXMuY29sb3JWYWx1ZXMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY29sb3JWYWx1ZXMpLCB7IFt0aGlzLmVkaXRpbmdLZXldOiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGNvbG9yVmFsdWUpLCB7IGNvbG9yIH0pIH0pO1xuICAgICAgT2JqZWN0LmtleXModGhpcy5jb2xvclZhbHVlcykuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5jb2xvclZhbHVlc1trZXldO1xuICAgICAgICBpZiAodmFsdWUuaXNCYWNrZ3JvdW5kKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgY29udHJhc3QsIHBhc3Nlc0RvdWJsZUEgfSA9IGNoZWNrQ29udHJhc3QoY29sb3IsIHZhbHVlLmNvbG9yKTtcbiAgICAgICAgdXBkYXRlVmFsdWUoa2V5LCB7IGNvbnRyYXN0UmF0aW86ICtjb250cmFzdC50b0ZpeGVkKDEpLCBpc1ZhbGlkQ29udHJhc3Q6IHBhc3Nlc0RvdWJsZUEgfSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgYmFja2dyb3VuZENvbmZpZyA9IHRoaXMuZ2V0QmFja2dyb3VuZENvbmZpZygpO1xuICAgIGNvbnN0IGJhY2tncm91bmRDb2xvciA9IChfYSA9IHRoaXMuY29sb3JWYWx1ZXNbYmFja2dyb3VuZENvbmZpZy5rZXldKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY29sb3I7XG4gICAgY29uc3QgeyBjb250cmFzdCwgcGFzc2VzRG91YmxlQSB9ID0gY2hlY2tDb250cmFzdChiYWNrZ3JvdW5kQ29sb3IsIGNvbG9yKTtcbiAgICB1cGRhdGVWYWx1ZSh0aGlzLmVkaXRpbmdLZXksIHtcbiAgICAgIGNvbG9yLFxuICAgICAgY29udHJhc3RSYXRpbzogK2NvbnRyYXN0LnRvRml4ZWQoMSksXG4gICAgICBpc1ZhbGlkQ29udHJhc3Q6IHBhc3Nlc0RvdWJsZUFcbiAgICB9KTtcbiAgfVxuICBnZXRCYWNrZ3JvdW5kQ29uZmlnKCkge1xuICAgIHJldHVybiB0aGlzLmNvbG9yQ29uZmlncy5maW5kKChjb25maWcpID0+IGNvbmZpZy5pc0JhY2tncm91bmQpO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBsb2NhbGUgPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuZWwpO1xuICAgIHRoaXMuaTE4biA9IGxvY2FsZVswXTtcbiAgICB0aGlzLmNvbG9yVmFsdWVzID0gdGhpcy5jb2xvckNvbmZpZ3MucmVkdWNlKChhY2MsIHsga2V5LCBkZWZhdWx0Q29sb3IsIGlzQmFja2dyb3VuZCwgaXNMaW5rIH0pID0+IHtcbiAgICAgIGFjY1trZXldID0ge1xuICAgICAgICBjb2xvcjogZGVmYXVsdENvbG9yLFxuICAgICAgICBpc0JhY2tncm91bmQsXG4gICAgICAgIGlzTGlua1xuICAgICAgfTtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwge30pO1xuICAgIGNvbnN0IGJhY2tncm91bmRDb25maWcgPSB0aGlzLmdldEJhY2tncm91bmRDb25maWcoKTtcbiAgICBpZiAoIWJhY2tncm91bmRDb25maWcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgYmFja2dyb3VuZENvbG9yID0gKF9hID0gdGhpcy5jb2xvclZhbHVlc1tiYWNrZ3JvdW5kQ29uZmlnLmtleV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jb2xvcjtcbiAgICBPYmplY3Qua2V5cyh0aGlzLmNvbG9yVmFsdWVzKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5jb2xvclZhbHVlc1trZXldO1xuICAgICAgaWYgKHZhbHVlLmlzQmFja2dyb3VuZCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCB7IGNvbnRyYXN0LCBwYXNzZXNEb3VibGVBIH0gPSBjaGVja0NvbnRyYXN0KHZhbHVlLmNvbG9yLCBiYWNrZ3JvdW5kQ29sb3IpO1xuICAgICAgdmFsdWUuY29udHJhc3RSYXRpbyA9ICtjb250cmFzdC50b0ZpeGVkKDEpO1xuICAgICAgdmFsdWUuaXNWYWxpZENvbnRyYXN0ID0gcGFzc2VzRG91YmxlQTtcbiAgICB9KTtcbiAgICB0aGlzLnRleHRJbnB1dENvbmZpZ3MuZm9yRWFjaCgoY29uZmlnKSA9PiB7XG4gICAgICB0aGlzLnRleHRWYWx1ZXNbY29uZmlnLmtleV0gPSBjb25maWcuZGVmYXVsdFZhbHVlIHx8IFwiXCI7XG4gICAgfSk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBiYWNrZ3JvdW5kQ29uZmlnID0gdGhpcy5nZXRCYWNrZ3JvdW5kQ29uZmlnKCk7XG4gICAgY29uc3QgbGlua0NvbmZpZyA9IHRoaXMuY29sb3JDb25maWdzLmZpbHRlcigoY29uZmlnKSA9PiBjb25maWcuaXNMaW5rKVswXTtcbiAgICBjb25zdCBvdGhlckNvbmZpZ3MgPSB0aGlzLmNvbG9yQ29uZmlncy5maWx0ZXIoKGNvbmZpZykgPT4gIWNvbmZpZy5pc0JhY2tncm91bmQgJiYgIWNvbmZpZy5pc0xpbmspO1xuICAgIGNvbnN0IGJhY2tncm91bmRDb2xvciA9IGJhY2tncm91bmRDb25maWcgPyB0aGlzLmNvbG9yVmFsdWVzW2JhY2tncm91bmRDb25maWcua2V5XS5jb2xvciA6IFwiXCI7XG4gICAgaWYgKCFiYWNrZ3JvdW5kQ29uZmlnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiY2FsY2l0ZS1tb2RhbFwiLCB7IG9wZW46IHRoaXMuaXNBY3RpdmUsIGNsYXNzOiBcImNvbG9yLWNvbnRyYXN0XCIsIG9uQ2FsY2l0ZU1vZGFsQ2xvc2U6IHRoaXMuaGFuZGxlTW9kYWxDbG9zZSB9LCBoKFwiaDNcIiwgeyBzbG90OiBcImhlYWRlclwiIH0sIHRoaXMubW9kYWxUaXRsZSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRlbnRcIiwgY2xhc3M6IFwiY29sb3ItY29udHJhc3RfX21vZGFsLWNvbnRlbnRcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29sb3ItY29udHJhc3RfX2NvbnRhaW5lclwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjb25maWctY29sb3ItcGFuZWxcIiB9LCB0aGlzLnRleHRJbnB1dENvbmZpZ3MubWFwKChjb25maWcpID0+IChoKFwiYXJjZ2lzLWNvbG9yLXRleHQtaW5wdXRcIiwgeyBrZXk6IGNvbmZpZy5rZXksIGtleVZhbHVlOiBjb25maWcua2V5LCBsYWJlbDogY29uZmlnLmxhYmVsLCBkZWZhdWx0VmFsdWU6IGNvbmZpZy5kZWZhdWx0VmFsdWUsIG9uSW5wdXRDaGFuZ2U6IHRoaXMuaGFuZGxlVGV4dElucHV0Q2hhbmdlIH0pKSksIGgoXCJhcmNnaXMtY29uZmlndXJlLWNvbG9ycy10YWJsZVwiLCB7IGkxOG46IHRoaXMuaTE4biwgYmFja2dyb3VuZENvbmZpZzogYmFja2dyb3VuZENvbmZpZywgb3RoZXJDb25maWdzOiBvdGhlckNvbmZpZ3MsIGxpbmtDb25maWc6IGxpbmtDb25maWcsIGNvbG9yVmFsdWVzOiB0aGlzLmNvbG9yVmFsdWVzLCBvbkVkaXRDbGljazogdGhpcy5oYW5kbGVFZGl0Q29sb3JDbGljayB9KSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjb2xvci1jb250cmFzdF9fcHJldmlldy1wYW5lbFwiIH0sIGgoXCJkaXZcIiwgbnVsbCwgdGhpcy5pMThuLnByZXZpZXcpLCBoKFwiYXJjZ2lzLWNvbnRyYXN0LXByZXZpZXdcIiwgeyBiYWNrZ3JvdW5kQ29sb3I6IGJhY2tncm91bmRDb2xvciwgdGV4dENvbG9yQ29uZmlnczogb3RoZXJDb25maWdzLCBsaW5rQ29uZmlnOiBsaW5rQ29uZmlnLCBjb2xvclZhbHVlczogdGhpcy5jb2xvclZhbHVlcyB9KSksIGgoXCJkaXZcIiwgeyBjbGFzczoge1xuICAgICAgICBcImNvbG9yLWNvbnRyYXN0X19jb2xvci1waWNrZXItY29udGFpbmVyXCI6IHRydWUsXG4gICAgICAgIGhpZGU6ICF0aGlzLnNob3dDb2xvclBpY2tlclxuICAgICAgfSwgcmVmOiAoZWwpID0+ICh0aGlzLmNvbG9yUGlja2VyQ29udGFpbmVyID0gZWwpIH0sIGgoXCJjYWxjaXRlLWNvbG9yLXBpY2tlclwiLCB7IHNjYWxlOiBcInNcIiwgdmFsdWU6IChfYSA9IHRoaXMuY29sb3JWYWx1ZXNbdGhpcy5lZGl0aW5nS2V5XSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNvbG9yLCBoaWRlU2F2ZWQ6IHRydWUsIHJlZjogKGVsKSA9PiAodGhpcy5jb2xvclBpY2tlckVsID0gZWwpLCBvbkNhbGNpdGVDb2xvclBpY2tlcklucHV0OiB0aGlzLmhhbmRsZUNvbG9yUGlja2VyQ2hhbmdlIH0pLCB0aGlzLnNoYXJlZFRoZW1lICYmIChoKFwiZGl2XCIsIG51bGwsIGgoXCJhcmNnaXMtc2hhcmVkLXRoZW1lLWNvbG9yc1wiLCB7IHNoYXJlZFRoZW1lOiB0aGlzLnNoYXJlZFRoZW1lLCBpMThuOiB0aGlzLmkxOG4sIG9uU2VsZWN0Q29sb3I6IHRoaXMuaGFuZGxlUHJlc2V0Q29sb3JTZWxlY3QgfSkpKSwgaChcImRpdlwiLCBudWxsLCBoKFwiYXJjZ2lzLXByZXNldC1jb2xvcnNcIiwgeyBpMThuOiB0aGlzLmkxOG4sIG9uU2VsZWN0Q29sb3I6IHRoaXMuaGFuZGxlUHJlc2V0Q29sb3JTZWxlY3QgfSkpKSkpLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcInNlY29uZGFyeVwiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNhbmNlbENsaWNrIH0sIHRoaXMuaTE4bi5jYW5jZWwpLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcInByaW1hcnlcIiwgb25DbGljazogdGhpcy5oYW5kbGVTYXZlQ2xpY2sgfSwgdGhpcy5pMThuLnNhdmUpKSwgaChcImNhbGNpdGUtbW9kYWxcIiwgeyBvcGVuOiB0aGlzLnNob3dXYXJuaW5nLCBraW5kOiBcImRhbmdlclwiLCBjbGFzczogXCJjb250cmFzdC13YXJuaW5nLW1vZGFsXCIgfSwgaChcImgzXCIsIHsgc2xvdDogXCJoZWFkZXJcIiwgY2xhc3M6IFwidHJhaWxlci0wIGZvbnQtc2l6ZS0xXCIgfSwgdGhpcy5pMThuLmNvbnRyYXN0V2FybmluZy50aXRsZSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRlbnRcIiB9LCB0aGlzLmkxOG4uY29udHJhc3RXYXJuaW5nLmRlc2NyaXB0aW9uKSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJwcmltYXJ5XCIsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlQWNjZXB0V2FybmluZyB9LCB0aGlzLmkxOG4uY29udHJhc3RXYXJuaW5nLmVkaXRDb2xvcnMpLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcInNlY29uZGFyeVwiLCBraW5kOiBcImRhbmdlclwiLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlUHJvY2VlZEFuYXl3YXkgfSwgdGhpcy5pMThuLmNvbnRyYXN0V2FybmluZy5wcm9jZWVkQW55d2F5KSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzQ29sb3JDb250cmFzdC5zdHlsZSA9IGFyY2dpc0NvbG9yQ29udHJhc3RDc3M7XG5cbmNvbnN0IGFyY2dpc0NvbG9yRWRpdENzcyA9IFwiLmNvbG9yLWVkaXQtY29udGFpbmVye3BhZGRpbmc6dmFyKC0tYXJjZ2lzLWFwcC1zaWRlLXNwYWNpbmctcXVhcnRlcik7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtjdXJzb3I6cG9pbnRlcn0uY29sb3ItdGlsZXtib3JkZXI6MXB4IHNvbGlkICNhOWE5YTk7d2lkdGg6MzBweDtoZWlnaHQ6MzBweDttYXJnaW4tcmlnaHQ6dmFyKC0tYXJjZ2lzLWFwcC1zaWRlLXNwYWNpbmctdGhyZWUtcXVhcnRlcnMpfS5jb2xvci1lZGl0X19sYWJlbC12YWx1ZXtmbGV4OjEgMSBhdXRvO21pbi13aWR0aDowO3RleHQtYWxpZ246c3RhcnR9LmNvbG9yLWVkaXQtbGFiZWx7Zm9udC1zaXplOnZhcigtLWFyY2dpcy1hcHAtZm9udC1zaXplLS0yKTtmb250LXdlaWdodDpub3JtYWx9LmNvbG9yLWVkaXQtdmFsdWV7Zm9udC1zaXplOnZhcigtLWFyY2dpcy1hcHAtZm9udC1zaXplLS0xKTtmb250LXdlaWdodDp2YXIoLS1hcmNnaXMtYXBwLWZvbnQtd2VpZ2h0LWRlbWkpfS5jb2xvci1lZGl0LWljb257bWFyZ2luLXJpZ2h0OnZhcigtLWFyY2dpcy1hcHAtc2lkZS1zcGFjaW5nLXRocmVlLXF1YXJ0ZXJzKX1odG1sW2Rpcj1ydGxdIC5jb2xvci10aWxle21hcmdpbi1yaWdodDowO21hcmdpbi1sZWZ0OnZhcigtLWFyY2dpcy1hcHAtc2lkZS1zcGFjaW5nLXRocmVlLXF1YXJ0ZXJzKX1odG1sW2Rpcj1ydGxdIC5jb2xvci1lZGl0LWljb257bWFyZ2luLXJpZ2h0OjA7bWFyZ2luLWxlZnQ6dmFyKC0tYXJjZ2lzLWFwcC1zaWRlLXNwYWNpbmctdGhyZWUtcXVhcnRlcnMpfVwiO1xuXG5jb25zdCBBcmNnaXNDb2xvckVkaXQgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuY29sb3JFZGl0Q2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcImNvbG9yRWRpdENsaWNrXCIsIDcpO1xuICAgIHRoaXMuaGFuZGxlQ2xpY2sgPSAoZXZ0KSA9PiB7XG4gICAgICBldnQgPT09IG51bGwgfHwgZXZ0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB0aGlzLmNvbG9yRWRpdENsaWNrLmVtaXQodGhpcy5lZGl0S2V5KTtcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlS2V5dXAgPSAoZXZlbnQpID0+IHtcbiAgICAgIGlmIChldmVudC5rZXkgPT09IFwiIFwiIHx8IGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMuaGFuZGxlQ2xpY2soZXZlbnQpO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5lZGl0S2V5ID0gXCJcIjtcbiAgICB0aGlzLmxhYmVsVGV4dCA9IFwiXCI7XG4gICAgdGhpcy5jb2xvclZhbHVlID0gXCJcIjtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29sb3ItZWRpdC1jb250YWluZXJcIiwgdGFiSW5kZXg6IDAsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlQ2xpY2ssIG9uS2V5VXA6IHRoaXMuaGFuZGxlS2V5dXAgfSwgaChcImRpdlwiLCBudWxsLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29sb3ItdGlsZVwiLCBzdHlsZTogeyBiYWNrZ3JvdW5kQ29sb3I6IHRoaXMuY29sb3JWYWx1ZSB9IH0pKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbG9yLWVkaXRfX2xhYmVsLXZhbHVlXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbG9yLWVkaXQtbGFiZWxcIiB9LCB0aGlzLmxhYmVsVGV4dCksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjb2xvci1lZGl0LXZhbHVlIFwiIH0sIHRoaXMuY29sb3JWYWx1ZSkpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29sb3ItZWRpdC1pY29uXCIgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgaWNvbjogXCJwZW5jaWxcIiB9KSkpKTtcbiAgfVxufTtcbkFyY2dpc0NvbG9yRWRpdC5zdHlsZSA9IGFyY2dpc0NvbG9yRWRpdENzcztcblxuY29uc3QgYXJjZ2lzQ29sb3JTd2F0Y2hDc3MgPSBcIi5jb2xvci1zd2F0Y2h7ZGlzcGxheTppbmxpbmUtYmxvY2s7aGVpZ2h0OjE2cHg7d2lkdGg6MTZweDtib3gtc2l6aW5nOmJvcmRlci1ib3g7bWFyZ2luLXJpZ2h0OjJweDtvdmVyZmxvdzpoaWRkZW59XCI7XG5cbmNvbnN0IEFyY2dpc0NvbG9yU3dhdGNoID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLnN3YXRjaENsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJzd2F0Y2hDbGlja1wiLCA3KTtcbiAgICB0aGlzLmhhbmRsZUNsaWNrID0gKCkgPT4ge1xuICAgICAgdGhpcy5zd2F0Y2hDbGljay5lbWl0KHRoaXMuY29sb3IpO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVLZXlVcCA9IChldmVudCkgPT4ge1xuICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgdGhpcy5oYW5kbGVDbGljaygpO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5jb2xvciA9IFwiXCI7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbG9yLXN3YXRjaFwiLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNsaWNrLCBvbktleVVwOiB0aGlzLmhhbmRsZUtleVVwLCB0YWJJbmRleDogMCB9LCBoKFwic3ZnXCIsIHsgd2lkdGg6IFwiMTZcIiwgaGVpZ2h0OiBcIjE2XCIgfSwgaChcInJlY3RcIiwgeyB3aWR0aDogXCIxNlwiLCBoZWlnaHQ6IFwiMTZcIiwgZmlsbDogdGhpcy5jb2xvciB9KSkpKTtcbiAgfVxufTtcbkFyY2dpc0NvbG9yU3dhdGNoLnN0eWxlID0gYXJjZ2lzQ29sb3JTd2F0Y2hDc3M7XG5cbmNvbnN0IEFyY2dpc0NvbG9yVGV4dElucHV0ID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmlucHV0Q2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJpbnB1dENoYW5nZVwiLCA3KTtcbiAgICB0aGlzLmhhbmRsZUlucHV0Q2hhbmdlID0gKGV2dCkgPT4ge1xuICAgICAgY29uc3Qgbm9kZSA9IGV2dC50YXJnZXQ7XG4gICAgICB0aGlzLnZhbHVlID0gbm9kZS52YWx1ZTtcbiAgICAgIHRoaXMuaW5wdXRDaGFuZ2UuZW1pdCh7XG4gICAgICAgIGtleTogdGhpcy5rZXlWYWx1ZSxcbiAgICAgICAgdmFsdWU6IG5vZGUudmFsdWVcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdGhpcy5rZXlWYWx1ZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxhYmVsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZGVmYXVsdFZhbHVlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudmFsdWUgPSBcIlwiO1xuICB9XG4gIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIGlmICh0aGlzLmRlZmF1bHRWYWx1ZSkge1xuICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuZGVmYXVsdFZhbHVlO1xuICAgIH1cbiAgfVxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCB0aGlzLmxhYmVsLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHZhbHVlOiB0aGlzLnZhbHVlLCBvbkNhbGNpdGVJbnB1dElucHV0OiB0aGlzLmhhbmRsZUlucHV0Q2hhbmdlLCBzY2FsZTogXCJzXCIgfSkpKTtcbiAgfVxufTtcblxuY29uc3QgQ29sb3JSb3cgPSAoeyBrZXksIGNvbG9yQ29uZmlnLCBjb2xvciwgY29udHJhc3RSYXRpbywgaXNWYWxpZENvbnRyYXN0LCBpMThuLCBvbkNvbG9yRWRpdENsaWNrIH0pID0+IHtcbiAgcmV0dXJuIChoKFwidHJcIiwgeyBcImRhdGEta2V5XCI6IGtleSB9LFxuICAgIGgoXCJ0ZFwiLCB7IGNsYXNzOiBcImNvbG9yLWNvbnRyYXN0X19jb2xvci1jb2xcIiB9LFxuICAgICAgaChcImFyY2dpcy1jb2xvci1lZGl0XCIsIHsgZWRpdEtleTogY29sb3JDb25maWcua2V5LCBsYWJlbFRleHQ6IGNvbG9yQ29uZmlnLmxhYmVsLCBjb2xvclZhbHVlOiBjb2xvciwgb25Db2xvckVkaXRDbGljazogb25Db2xvckVkaXRDbGljayB9KSksXG4gICAgaChcInRkXCIsIHsgY2xhc3M6IFwiY29sb3ItY29udHJhc3RfX3JhdGlvLWNvbFwiIH0sIGNvbnRyYXN0UmF0aW8pLFxuICAgIGgoXCJ0ZFwiLCB7IGNsYXNzOiBcImNvbG9yLWNvbnRyYXN0X19sZWdpYmlsaXR5LWNvbFwiIH0sXG4gICAgICBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29sb3Itcm93X19sZWdpYmlsaXR5XCIgfSwgaXNWYWxpZENvbnRyYXN0ID8gKGgoRnJhZ21lbnQsIG51bGwsXG4gICAgICAgIGgoXCJjYWxjaXRlLWljb25cIiwgeyBzY2FsZTogXCJzXCIsIGljb246IFwiY2hlY2stY2lyY2xlLWZcIiwgY2xhc3M6IFwiY29sb3ItY29udHJhc3QtLXZhbGlkXCIgfSksXG4gICAgICAgIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjb2xvci1jb250cmFzdF9fbGVnaWJsZS1sYWJlbFwiIH0sIGkxOG4ubGVnaWJsZSkpKSA6IChoKEZyYWdtZW50LCBudWxsLFxuICAgICAgICBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBpY29uOiBcIngtY2lyY2xlLWZcIiwgY2xhc3M6IFwiY29sb3ItY29udHJhc3QtLWludmFsaWRcIiB9KSxcbiAgICAgICAgaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbG9yLWNvbnRyYXN0X19sZWdpYmxlLWxhYmVsXCIgfSwgaTE4bi5ub3RMZWdpYmxlKSkpKSkpKTtcbn07XG5cbmNvbnN0IGFyY2dpc0NvbmZpZ3VyZUNvbG9yc1RhYmxlQ3NzID0gXCIuY29uZmlnLWNvbG9yLXRhYmxle3dpZHRoOjEwMCU7Ym9yZGVyLWNvbGxhcHNlOmNvbGxhcHNlfXRoLHRke2JvcmRlcjoxcHggc29saWQgI2RkZGQ7dGV4dC1hbGlnbjpjZW50ZXI7Zm9udC1zaXplOnZhcigtLWFyY2dpcy1hcHAtZm9udC1zaXplLS0xKX0uY29sb3ItY29udHJhc3RfX2xlZ2liaWxpdHktY29se3BhZGRpbmc6MC41cmVtO3RleHQtYWxpZ246c3RhcnQ7d2lkdGg6NnJlbX0uY29sb3ItY29udHJhc3QtLXZhbGlke2NvbG9yOmdyZWVufS5jb2xvci1jb250cmFzdC0taW52YWxpZHtjb2xvcjpyZWR9LmNvbG9yLXJvd19fbGVnaWJpbGl0eXtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyfS5jb2xvci1jb250cmFzdF9fbGVnaWJsZS1sYWJlbHttYXJnaW46MCAwLjVyZW19LmNvbnRyYXN0LWluZm97Zm9udC1zaXplOjAuOHJlbX1cIjtcblxuY29uc3QgQXJjZ2lzQ29uZmlndXJlQ29sb3JzVGFibGUgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuZWRpdENsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJlZGl0Q2xpY2tcIiwgNyk7XG4gICAgdGhpcy5oYW5kbGVFZGl0Q2xpY2sgPSAoZXZ0KSA9PiB7XG4gICAgICB0aGlzLmVkaXRDbGljay5lbWl0KGV2dC5kZXRhaWwpO1xuICAgIH07XG4gICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuYmFja2dyb3VuZENvbmZpZyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm90aGVyQ29uZmlncyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxpbmtDb25maWcgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jb2xvclZhbHVlcyA9IHt9O1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgYmFja2dyb3VuZENvbG9yID0gdGhpcy5jb2xvclZhbHVlc1t0aGlzLmJhY2tncm91bmRDb25maWcua2V5XS5jb2xvcjtcbiAgICBjb25zdCBsaW5rVmFsdWUgPSB0aGlzLmNvbG9yVmFsdWVzWyhfYSA9IHRoaXMubGlua0NvbmZpZykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmtleV07XG4gICAgY29uc3QgbGlua0NvbG9yID0gKGxpbmtWYWx1ZSA9PT0gbnVsbCB8fCBsaW5rVmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxpbmtWYWx1ZS5jb2xvcikgfHwgXCJcIjtcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgbnVsbCwgdGhpcy5pMThuLmNvbmZpZ3VyZSwgaChcInRhYmxlXCIsIHsgY2xhc3M6IFwiY29uZmlnLWNvbG9yLXRhYmxlXCIgfSwgaChcInRoZWFkXCIsIG51bGwsIGgoXCJ0clwiLCBudWxsLCBoKFwidGhcIiwgbnVsbCwgaChcImFyY2dpcy1jb2xvci1lZGl0XCIsIHsgZWRpdEtleTogdGhpcy5iYWNrZ3JvdW5kQ29uZmlnLmtleSwgbGFiZWxUZXh0OiB0aGlzLmJhY2tncm91bmRDb25maWcubGFiZWwgfHwgdGhpcy5pMThuLmJhY2tncm91bmQsIGNvbG9yVmFsdWU6IGJhY2tncm91bmRDb2xvciwgb25Db2xvckVkaXRDbGljazogdGhpcy5oYW5kbGVFZGl0Q2xpY2sgfSkpLCBoKFwidGhcIiwgeyBjbGFzczogXCJjb2xvci1lZGl0LWxhYmVsXCIgfSwgdGhpcy5pMThuLmNvbnRyYXN0UmF0aW8pLCBoKFwidGhcIiwgeyBjbGFzczogXCJjb2xvci1lZGl0LWxhYmVsXCIgfSwgdGhpcy5pMThuLmxlZ2liaWxpdHkpKSksIGgoXCJ0Ym9keVwiLCBudWxsLCB0aGlzLm90aGVyQ29uZmlncy5tYXAoKGNvbmZpZykgPT4ge1xuICAgICAgY29uc3QgeyBjb2xvciwgY29udHJhc3RSYXRpbywgaXNWYWxpZENvbnRyYXN0IH0gPSB0aGlzLmNvbG9yVmFsdWVzW2NvbmZpZy5rZXldO1xuICAgICAgcmV0dXJuIChoKENvbG9yUm93LCB7IGtleTogY29uZmlnLmtleSwgY29sb3JDb25maWc6IGNvbmZpZywgY29sb3I6IGNvbG9yLCBjb250cmFzdFJhdGlvOiBjb250cmFzdFJhdGlvLCBpc1ZhbGlkQ29udHJhc3Q6IGlzVmFsaWRDb250cmFzdCwgaTE4bjogdGhpcy5pMThuLCBvbkNvbG9yRWRpdENsaWNrOiB0aGlzLmhhbmRsZUVkaXRDbGljayB9KSk7XG4gICAgfSksIHRoaXMubGlua0NvbmZpZyAmJiAoaChDb2xvclJvdywgeyBrZXk6IHRoaXMubGlua0NvbmZpZy5rZXksIGNvbG9yQ29uZmlnOiB0aGlzLmxpbmtDb25maWcsIGNvbG9yOiBsaW5rQ29sb3IsIGNvbnRyYXN0UmF0aW86IGxpbmtWYWx1ZSA9PT0gbnVsbCB8fCBsaW5rVmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxpbmtWYWx1ZS5jb250cmFzdFJhdGlvLCBpc1ZhbGlkQ29udHJhc3Q6IGxpbmtWYWx1ZSA9PT0gbnVsbCB8fCBsaW5rVmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxpbmtWYWx1ZS5pc1ZhbGlkQ29udHJhc3QsIGkxOG46IHRoaXMuaTE4biwgb25Db2xvckVkaXRDbGljazogdGhpcy5oYW5kbGVFZGl0Q2xpY2sgfSkpKSksIGgoXCJwXCIsIHsgY2xhc3M6IFwiY29udHJhc3QtaW5mb1wiIH0sIHRoaXMuaTE4bi5jb250cmFzdEluZm8pKSk7XG4gIH1cbn07XG5BcmNnaXNDb25maWd1cmVDb2xvcnNUYWJsZS5zdHlsZSA9IGFyY2dpc0NvbmZpZ3VyZUNvbG9yc1RhYmxlQ3NzO1xuXG5jb25zdCBhcmNnaXNDb250cmFzdFByZXZpZXdDc3MgPSBcIi5jb250cmFzdC1wcmV2aWV3e3BhZGRpbmc6MXJlbTtmbGV4OjEgMSBhdXRvO21pbi13aWR0aDowfS5jb250cmFzdC1wcmV2aWV3IGgyLC5jb250cmFzdC1wcmV2aWV3IHAsLmNvbnRyYXN0LXByZXZpZXcgYnV0dG9ue21hcmdpbi1ib3R0b206MXJlbTttYXJnaW4tdG9wOjB9XCI7XG5cbmNvbnN0IEFyY2dpc0NvbnRyYXN0UHJldmlldyA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5iYWNrZ3JvdW5kQ29sb3IgPSBcIlwiO1xuICAgIHRoaXMudGV4dENvbG9yQ29uZmlncyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxpbmtDb25maWcgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jb2xvclZhbHVlcyA9IHVuZGVmaW5lZDtcbiAgfVxuICByZW5kZXJMaW5rQ29uZmlnKCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAoISgoX2EgPSB0aGlzLmxpbmtDb25maWcpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5wcmV2aWV3KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB7IHByZXZpZXcgfSA9IHRoaXMubGlua0NvbmZpZztcbiAgICBpZiAocHJldmlldy5pc0J1dHRvbikge1xuICAgICAgcmV0dXJuIGgoXCJidXR0b25cIiwgbnVsbCwgcHJldmlldy50ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIGgoXCJhXCIsIG51bGwsIHByZXZpZXcudGV4dCk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBsaW5rQ29sb3IgPSB0aGlzLmNvbG9yVmFsdWVzWyhfYSA9IHRoaXMubGlua0NvbmZpZykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmtleV0uY29sb3IgfHwgXCIjMDBhMGZmXCI7XG4gICAgcmV0dXJuIChoKEZyYWdtZW50LCBudWxsLCBoKFwic3R5bGVcIiwgeyBpbm5lckhUTUw6IGAuY29udHJhc3QtcHJldmlldyBhIHtcbiAgICAgICAgICBjb2xvcjogJHtsaW5rQ29sb3IgfHwgXCJpbmhlcml0XCJ9O1xuICAgICAgICB9IC5jb250cmFzdC1wcmV2aWV3IGJ1dHRvbiB7XG4gICAgICAgICAgY29sb3I6ICR7bGlua0NvbG9yIHx8IFwiaW5oZXJpdFwifTtcbiAgICAgICAgICBib3JkZXI6ICR7bGlua0NvbG9yID8gYDFweCBzb2xpZCAke2xpbmtDb2xvcn1gIDogXCJpbmhlcml0XCJ9O1xuICAgICAgICAgIGJhY2tncm91bmQ6ICR7bGlua0NvbG9yID8gXCJub25lXCIgOiBcImluaGVyaXRcIn07XG4gICAgICAgICAgcGFkZGluZzogMC4zNzVyZW0gMXJlbTtcbiAgICAgICAgfWAgfSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjb250cmFzdC1wcmV2aWV3XCIsIHN0eWxlOiB7IGJhY2tncm91bmRDb2xvcjogdGhpcy5iYWNrZ3JvdW5kQ29sb3IgfSB9LCB0aGlzLnRleHRDb2xvckNvbmZpZ3MubWFwKCh7IHByZXZpZXcsIGtleSB9KSA9PiB7XG4gICAgICBjb25zdCB7IGNvbG9yIH0gPSB0aGlzLmNvbG9yVmFsdWVzW2tleV07XG4gICAgICBpZiAoIXByZXZpZXcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHByZXZpZXcuaXNIZWFkaW5nKSB7XG4gICAgICAgIHJldHVybiBoKFwiaDJcIiwgeyBzdHlsZTogeyBjb2xvciB9LCBpbm5lckhUTUw6IHByZXZpZXcudGV4dCB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBoKFwicFwiLCB7IHN0eWxlOiB7IGNvbG9yIH0sIGlubmVySFRNTDogcHJldmlldy50ZXh0IH0pO1xuICAgIH0pLCB0aGlzLnJlbmRlckxpbmtDb25maWcoKSkpKTtcbiAgfVxufTtcbkFyY2dpc0NvbnRyYXN0UHJldmlldy5zdHlsZSA9IGFyY2dpc0NvbnRyYXN0UHJldmlld0NzcztcblxuY29uc3QgYXJjZ2lzUHJlc2V0Q29sb3JzQ3NzID0gXCIucHJlc2V0LWNvbG9yc3ttYXgtd2lkdGg6MTYwcHg7cGFkZGluZzo4cHggMTZweDtiYWNrZ3JvdW5kLWNvbG9yOiNmZmY7Ym9yZGVyOjFweCBzb2xpZCAjY2NjO2JvcmRlci10b3A6bm9uZTtib3gtc2l6aW5nOmJvcmRlci1ib3h9LnByZXNldC1jb2xvcnMgLnByZXNldC1jb2xvcnNfX3RpdGxle2ZvbnQtc2l6ZTowLjgyNXJlbX0ucHJlc2V0LWNvbG9ycyAucHJlc2V0LXJvd3ttYXgtaGVpZ2h0OjE2cHg7bWFyZ2luLWJvdHRvbToycHh9XCI7XG5cbmNvbnN0IEFyY2dpc1ByZXNldENvbG9ycyA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5zZWxlY3RDb2xvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwic2VsZWN0Q29sb3JcIiwgNyk7XG4gICAgdGhpcy5wcmVzZXRDb2xvcnMgPSB7XG4gICAgICBicm93bjogW1wiZjJlY2U2XCIsIFwiN2M0MTBhXCIsIFwiM2UyMTA1XCJdLFxuICAgICAgYmx1ZTogW1wiZTVmMWY5XCIsIFwiMDA3OWMxXCIsIFwiMDAzZDYxXCJdLFxuICAgICAgZ3JlZW46IFtcImU5ZjNlYVwiLCBcIjI4ODgzNVwiLCBcIjE0NDQxYlwiXSxcbiAgICAgIHllbGxvdzogW1wiZmVmY2VkXCIsIFwiZjllNTRlXCIsIFwiN2Q3MzI3XCJdLFxuICAgICAgb3JhbmdlOiBbXCJmZWY1ZTlcIiwgXCJmODk5MjdcIiwgXCI3YzRkMTRcIl0sXG4gICAgICByZWQ6IFtcImZiZWFlOFwiLCBcImQ4MzAyMFwiLCBcIjZjMTgxMFwiXSxcbiAgICAgIHZpb2xldDogW1wiZWZlYmY1XCIsIFwiNjMzYjliXCIsIFwiMzIxZTRlXCJdXG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZVN3YXRjaENsaWNrID0gKGV2dCkgPT4ge1xuICAgICAgdGhpcy5zZWxlY3RDb2xvci5lbWl0KGV2dC5kZXRhaWwpO1xuICAgIH07XG4gICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCBjb2xvclJvd3MgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMjsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGNvbnN0IHJvdyA9IFtdO1xuICAgICAgT2JqZWN0LmtleXModGhpcy5wcmVzZXRDb2xvcnMpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICBjb25zdCBjb2xvckFyciA9IHRoaXMucHJlc2V0Q29sb3JzW2tleV07XG4gICAgICAgIHJvdy5wdXNoKGAjJHtjb2xvckFycltpXX1gKTtcbiAgICAgIH0pO1xuICAgICAgY29sb3JSb3dzLnB1c2gocm93KTtcbiAgICB9XG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwicHJlc2V0LWNvbG9yc1wiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJwcmVzZXQtY29sb3JzX190aXRsZVwiIH0sIHRoaXMuaTE4bi5wcmVzZXRDb2xvcnMpLCBjb2xvclJvd3MubWFwKChyb3cpID0+IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwicHJlc2V0LXJvd1wiIH0sIHJvdy5tYXAoKGNvbG9yKSA9PiAoaChcImFyY2dpcy1jb2xvci1zd2F0Y2hcIiwgeyBrZXk6IGNvbG9yLCBjb2xvcjogY29sb3IsIG9uU3dhdGNoQ2xpY2s6IHRoaXMuaGFuZGxlU3dhdGNoQ2xpY2sgfSkpKSkpKSkpO1xuICB9XG59O1xuQXJjZ2lzUHJlc2V0Q29sb3JzLnN0eWxlID0gYXJjZ2lzUHJlc2V0Q29sb3JzQ3NzO1xuXG5jb25zdCBhcmNnaXNTaGFyZWRUaGVtZUNvbG9yc0NzcyA9IFwiLnNoYXJlZC10aGVtZXttYXgtd2lkdGg6MTYwcHg7cGFkZGluZzo4cHggMTZweDtiYWNrZ3JvdW5kLWNvbG9yOiNmZmY7Ym9yZGVyOjFweCBzb2xpZCAjY2NjO2JvcmRlci10b3A6bm9uZTtib3gtc2l6aW5nOmJvcmRlci1ib3h9LnNoYXJlZC10aGVtZS1jb2xvcnNfX3RpdGxle2ZvbnQtc2l6ZTowLjgyNXJlbX0uc2hhcmVkLXRoZW1lX19yb3d7bWF4LWhlaWdodDoxNnB4O21hcmdpbi1ib3R0b206MnB4fVwiO1xuXG5jb25zdCBBcmNnaXNTaGFyZWRUaGVtZUNvbG9ycyA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5zZWxlY3RDb2xvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwic2VsZWN0Q29sb3JcIiwgNyk7XG4gICAgdGhpcy5oYW5kbGVTd2F0Y2hDbGljayA9IChldnQpID0+IHtcbiAgICAgIHRoaXMuc2VsZWN0Q29sb3IuZW1pdChldnQuZGV0YWlsKTtcbiAgICB9O1xuICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNoYXJlZFRoZW1lID0gdW5kZWZpbmVkO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBpZiAoIXRoaXMuc2hhcmVkVGhlbWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgY29sb3JzID0ge307XG4gICAgT2JqZWN0LmtleXModGhpcy5zaGFyZWRUaGVtZSkuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICBpZiAoIXRoaXMuc2hhcmVkVGhlbWVba2V5XSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCB7IGJhY2tncm91bmQsIHRleHQsIGxpbmsgfSA9IHRoaXMuc2hhcmVkVGhlbWVba2V5XTtcbiAgICAgIGlmIChiYWNrZ3JvdW5kKSB7XG4gICAgICAgIGNvbG9yc1tiYWNrZ3JvdW5kXSA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZiAodGV4dCkge1xuICAgICAgICBjb2xvcnNbdGV4dF0gPSB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKGxpbmspIHtcbiAgICAgICAgY29sb3JzW2xpbmtdID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoIU9iamVjdC5rZXlzKGNvbG9ycykubGVuZ3RoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNoYXJlZC10aGVtZVwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzaGFyZWQtdGhlbWUtY29sb3JzX190aXRsZVwiIH0sIHRoaXMuaTE4bi5zaGFyZWRUaGVtZSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzaGFyZWQtdGhlbWVfX3Jvd1wiIH0sIE9iamVjdC5rZXlzKGNvbG9ycykuc29ydCgpLm1hcCgoY29sb3IpID0+IChoKFwiYXJjZ2lzLWNvbG9yLXN3YXRjaFwiLCB7IGtleTogY29sb3IsIGNvbG9yOiBjb2xvciwgb25Td2F0Y2hDbGljazogdGhpcy5oYW5kbGVTd2F0Y2hDbGljayB9KSkpKSkpO1xuICB9XG59O1xuQXJjZ2lzU2hhcmVkVGhlbWVDb2xvcnMuc3R5bGUgPSBhcmNnaXNTaGFyZWRUaGVtZUNvbG9yc0NzcztcblxuZXhwb3J0IHsgQXJjZ2lzQ29sb3JDb250cmFzdCBhcyBhcmNnaXNfY29sb3JfY29udHJhc3QsIEFyY2dpc0NvbG9yRWRpdCBhcyBhcmNnaXNfY29sb3JfZWRpdCwgQXJjZ2lzQ29sb3JTd2F0Y2ggYXMgYXJjZ2lzX2NvbG9yX3N3YXRjaCwgQXJjZ2lzQ29sb3JUZXh0SW5wdXQgYXMgYXJjZ2lzX2NvbG9yX3RleHRfaW5wdXQsIEFyY2dpc0NvbmZpZ3VyZUNvbG9yc1RhYmxlIGFzIGFyY2dpc19jb25maWd1cmVfY29sb3JzX3RhYmxlLCBBcmNnaXNDb250cmFzdFByZXZpZXcgYXMgYXJjZ2lzX2NvbnRyYXN0X3ByZXZpZXcsIEFyY2dpc1ByZXNldENvbG9ycyBhcyBhcmNnaXNfcHJlc2V0X2NvbG9ycywgQXJjZ2lzU2hhcmVkVGhlbWVDb2xvcnMgYXMgYXJjZ2lzX3NoYXJlZF90aGVtZV9jb2xvcnMgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuLyoqXG4gKiBDYWxsIGEgZnVuY3Rpb24gb25seSBhZnRlciBpdCBoYXMgbm90IGJlZW4gY2FsbGVkIGZvciBuIG1pbGxpc2Vjb25kc1xuICogQHBhcmFtIGZuICAgIC0gZnVuY3Rpb24gdG8gY2FsbFxuICogQHBhcmFtIGRlbGF5IC0gZGVsYXkgaW4gbWlsbGlzZWNvbmRzXG4gKi9cbmNvbnN0IGRlYm91bmNlID0gKGZuLCBkZWxheSkgPT4ge1xuICBsZXQgdGltZW91dDtcbiAgbGV0IHN0YXR1cyA9IFwiaWRsZVwiO1xuICBmdW5jdGlvbiBmbHVzaCguLi5hcmdzKSB7XG4gICAgc3RhdHVzID0gXCJmbHVzaGVkXCI7XG4gICAgcmV0dXJuIGRlYm91bmNlZCguLi5hcmdzKTtcbiAgfVxuICBmdW5jdGlvbiBpbnZva2UoLi4uYXJncykge1xuICAgIHN0YXR1cyA9IFwiaW52b2tlZFwiO1xuICAgIHJldHVybiBkZWJvdW5jZWQoLi4uYXJncyk7XG4gIH1cbiAgZnVuY3Rpb24gY2FuY2VsKC4uLmFyZ3MpIHtcbiAgICBzdGF0dXMgPSBcImNhbmNlbGxlZFwiO1xuICAgIHJldHVybiBkZWJvdW5jZWQoLi4uYXJncyk7XG4gIH1cbiAgZnVuY3Rpb24gZ2V0U3RhdHVzKCkge1xuICAgIHJldHVybiBzdGF0dXM7XG4gIH1cbiAgY29uc3QgZGVib3VuY2VkID0gKC4uLmFyZ3MpID0+IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgc3dpdGNoIChzdGF0dXMpIHtcbiAgICAgIGNhc2UgXCJmbHVzaGVkXCI6XG4gICAgICAgIHN0YXR1cyA9IFwiaWRsZVwiO1xuICAgICAgICBpZiAodGltZW91dCkge1xuICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICByZXNvbHZlKGZuKC4uLmFyZ3MpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImludm9rZWRcIjpcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICBzdGF0dXMgPSBcImlkbGVcIjtcbiAgICAgICAgcmVzb2x2ZShmbiguLi5hcmdzKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImNhbmNlbGxlZFwiOlxuICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgIHN0YXR1cyA9IFwiaWRsZVwiO1xuICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGlmICh0aW1lb3V0KSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICB9XG4gICAgICAgIHN0YXR1cyA9IFwicGVuZGluZ1wiO1xuICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgc3RhdHVzID0gXCJpZGxlXCI7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUoZm4oLi4uYXJncykpO1xuICAgICAgICB9LCBkZWxheSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfSk7XG4gIGRlYm91bmNlZC5mbHVzaCA9IGZsdXNoO1xuICBkZWJvdW5jZWQuaW52b2tlID0gaW52b2tlO1xuICBkZWJvdW5jZWQuY2FuY2VsID0gY2FuY2VsO1xuICBkZWJvdW5jZWQuZ2V0U3RhdHVzID0gZ2V0U3RhdHVzO1xuICByZXR1cm4gZGVib3VuY2VkO1xufTtcbi8qKlxuICogQ2FsbCBhIGZ1bmN0aW9uIG9ubHkgYWZ0ZXIgbiBtaWxsaXNlY29uZHMgaGF2ZSBlbGFwc2VkXG4gKiBAcGFyYW0gZm4gICAgLSBmdW5jdGlvbiB0byBjYWxsXG4gKiBAcGFyYW0gZGVsYXkgLSBkZWxheSBpbiBtaWxsaXNlY29uZHNcbiAqL1xuY29uc3QgdGhyb3R0bGUgPSAoZm4sIGRlbGF5KSA9PiB7XG4gIGxldCB0aW1lb3V0O1xuICByZXR1cm4gKC4uLmFyZ3MpID0+IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgdGltZW91dCA9IHVuZGVmaW5lZDtcbiAgICAgIHJlc29sdmUoZm4oLi4uYXJncykpO1xuICAgIH0sIGRlbGF5KTtcbiAgfSk7XG59O1xuZnVuY3Rpb24gZXNjYXBlUmVnRXhwKHN0cikge1xuICByZXR1cm4gc3RyLnJlcGxhY2UoL1suKis/XiR7fSgpfFtcXF1cXFxcXS9nLCBcIlxcXFwkJlwiKTsgLy8gJCYgbWVhbnMgdGhlIHdob2xlIG1hdGNoZWQgc3RyaW5nXG59XG5mdW5jdGlvbiBpc0RlZmluZWQodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGw7XG59XG4vKipcbiAqIFNldCBhIG1pbmltdW0gdGltZSBmb3IgYSBwcm9taXNlIHRvIHJlc29sdmUgKHVzZWZ1bCBmb3IgcHJldmVudGluZyBmbGFzaCBvZiBsb2FkZXJzKVxuICovXG5hc3luYyBmdW5jdGlvbiBtaW5EZWxheShwcm9taXNlLCBtaW5EZWxheSkge1xuICBhd2FpdCBQcm9taXNlLmFsbChbcHJvbWlzZSwgdGltZW91dChtaW5EZWxheSldKTtcbiAgcmV0dXJuIHByb21pc2U7XG59XG4vKipcbiAqIEhlbHBlciBtZXRob2QgdG8gaW5saW5lIHNldFRpbWVvdXQgYXMgYW4gYXdhaXQgaW4gYXN5bmMgZnVuY3Rpb25zXG4gKi9cbmZ1bmN0aW9uIHRpbWVvdXQobXMpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XG59XG5jb25zdCBhcnJheVRvTG9va3VwTWFwID0gKGRhdGFBcnIsIGdldEtleUFuZEl0ZW0pID0+IE9iamVjdC5mcm9tRW50cmllcygoZGF0YUFyciB8fCBbXSkubWFwKChpdGVtKSA9PiB7XG4gIGNvbnN0IHsga2V5LCBkYXRhIH0gPSBnZXRLZXlBbmRJdGVtKGl0ZW0pO1xuICByZXR1cm4gW2tleSwgZGF0YV07XG59KSk7XG4vKipcbiAqIENoZWNrIHdoZXRoZXIgdHdvIGFycmF5cyBoYXZlIHRoZSBzYW1lIG51bWJlciBvZiBlbGVtZW50c1xuICogYW5kIHdoZXRoZXIgdGhleSBjb250YWluIHRoZSBzYW1lIGVsZW1lbnRzXG4gKiByZWdhcmRsZXNzIG9mIG9yZGVyXG4gKi9cbmNvbnN0IGFycmF5c0FyZUVxdWl2YWxlbnQgPSAoYXJyMSwgYXJyMikgPT4gYXJyMS5sZW5ndGggPT09IGFycjIubGVuZ3RoICYmIGFycjEucmVkdWNlKChtZW1vLCBzdHIpID0+IG1lbW8gJiYgYXJyMi5pbmRleE9mKHN0cikgPiAtMSwgdHJ1ZSk7XG5mdW5jdGlvbiB1bmlxdWVCeShteUFyciwgZ2V0SXRlbUlkKSB7XG4gIGNvbnN0IHJlc3VsdEFyciA9IFtdO1xuICBjb25zdCBsb29rdXBNYXAgPSB7fTtcbiAgbXlBcnIuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgIGNvbnN0IGlkID0gZ2V0SXRlbUlkKGl0ZW0pO1xuICAgIGlmIChsb29rdXBNYXBbaWRdID09IG51bGwpIHtcbiAgICAgIGxvb2t1cE1hcFtpZF0gPSBpdGVtO1xuICAgICAgcmVzdWx0QXJyLnB1c2goaXRlbSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHJlc3VsdEFycjtcbn1cbmZ1bmN0aW9uIHVuaXF1ZShteUFycikge1xuICBjb25zdCBwcmltaXRpdmVzID0geyBib29sZWFuOiB7fSwgbnVtYmVyOiB7fSwgc3RyaW5nOiB7fSB9O1xuICBjb25zdCBvYmpzID0gW107XG4gIHJldHVybiBteUFyci5maWx0ZXIoKGl0ZW0pID0+IHtcbiAgICBsZXQgdHlwZSA9IHR5cGVvZiBpdGVtO1xuICAgIGlmICh0eXBlIGluIHByaW1pdGl2ZXMpIHtcbiAgICAgIHJldHVybiBwcmltaXRpdmVzW3R5cGVdLmhhc093blByb3BlcnR5KGl0ZW0pID8gZmFsc2UgOiAocHJpbWl0aXZlc1t0eXBlXVtpdGVtXSA9IHRydWUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBvYmpzLmluZGV4T2YoaXRlbSkgPj0gMCA/IGZhbHNlIDogb2Jqcy5wdXNoKGl0ZW0pO1xuICAgIH1cbiAgfSk7XG59XG5jb25zdCBjaHVuayA9IChhcnIsIHNpemUpID0+IFsuLi5BcnJheShNYXRoLmNlaWwoYXJyLmxlbmd0aCAvIHNpemUpKV0ubWFwKChfLCBpKSA9PiBhcnIuc2xpY2Uoc2l6ZSAqIGksIHNpemUgKyBzaXplICogaSkpO1xuXG5leHBvcnQgeyBhcnJheVRvTG9va3VwTWFwIGFzIGEsIHVuaXF1ZSBhcyBiLCB0aHJvdHRsZSBhcyBjLCBkZWJvdW5jZSBhcyBkLCBlc2NhcGVSZWdFeHAgYXMgZSwgYXJyYXlzQXJlRXF1aXZhbGVudCBhcyBmLCBjaHVuayBhcyBnLCBpc0RlZmluZWQgYXMgaSwgbWluRGVsYXkgYXMgbSwgdGltZW91dCBhcyB0LCB1bmlxdWVCeSBhcyB1IH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGwgYXMgbG9hZE1vZHVsZXMgfSBmcm9tICcuL2xvYWRNb2R1bGVzLWFhZjMwYmQ2LmpzJztcbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tMTNmNWIwMGMuanMnO1xuXG5jb25zdCBsYW5ndWFnZU1hcCA9IG5ldyBNYXAoW1xuICBbXCJhclwiLCBcImFyXCJdLFxuICBbXCJiZ1wiLCBcImJnXCJdLFxuICBbXCJic1wiLCBcImJzXCJdLFxuICBbXCJjYVwiLCBcImNhXCJdLFxuICBbXCJjc1wiLCBcImNzXCJdLFxuICBbXCJkYVwiLCBcImRhXCJdLFxuICBbXCJkZVwiLCBcImRlXCJdLFxuICBbXCJlbFwiLCBcImVsXCJdLFxuICBbXCJlblwiLCBcImVuXCJdLFxuICBbXCJlc1wiLCBcImVzXCJdLFxuICBbXCJldFwiLCBcImV0XCJdLFxuICBbXCJmaVwiLCBcImZpXCJdLFxuICBbXCJmclwiLCBcImZyXCJdLFxuICBbXCJoZVwiLCBcImhlXCJdLFxuICBbXCJoclwiLCBcImhyXCJdLFxuICBbXCJodVwiLCBcImh1XCJdLFxuICBbXCJpZFwiLCBcImlkXCJdLFxuICBbXCJpdFwiLCBcIml0XCJdLFxuICBbXCJqYVwiLCBcImphXCJdLFxuICBbXCJrb1wiLCBcImtvXCJdLFxuICBbXCJsdFwiLCBcImx0XCJdLFxuICBbXCJsdlwiLCBcImx2XCJdLFxuICBbXCJuYlwiLCBcIm5iXCJdLFxuICBbXCJubFwiLCBcIm5sXCJdLFxuICBbXCJwbFwiLCBcInBsXCJdLFxuICBbXCJwdC1iclwiLCBcInB0LUJSXCJdLFxuICBbXCJwdC1wdFwiLCBcInB0LVBUXCJdLFxuICBbXCJyb1wiLCBcInJvXCJdLFxuICBbXCJydVwiLCBcInJ1XCJdLFxuICBbXCJza1wiLCBcInNrXCJdLFxuICBbXCJzbFwiLCBcInNsXCJdLFxuICBbXCJzclwiLCBcInNyXCJdLFxuICBbXCJzdlwiLCBcInN2XCJdLFxuICBbXCJ0aFwiLCBcInRoXCJdLFxuICBbXCJ0clwiLCBcInRyXCJdLFxuICBbXCJ1a1wiLCBcInVrXCJdLFxuICBbXCJ2aVwiLCBcInZpXCJdLFxuICBbXCJ6aC1jblwiLCBcInpoLUNOXCJdLFxuICBbXCJ6aC1oa1wiLCBcInpoLUhLXCJdLFxuICBbXCJ6aC10d1wiLCBcInpoLVRXXCJdXG5dKTtcbi8vIHJ0bFxuZnVuY3Rpb24gZ2V0RWxlbWVudERpcihlbCkge1xuICByZXR1cm4gZ2V0RWxlbWVudFByb3AoZWwsIFwiZGlyXCIsIFwibHRyXCIpO1xufVxuZnVuY3Rpb24gZ2V0RWxlbWVudFByb3AoZWwsIHByb3AsIHZhbHVlKSB7XG4gIGNvbnN0IGNsb3Nlc3RXaXRoUHJvcCA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbCwgYFske3Byb3B9XWApO1xuICByZXR1cm4gY2xvc2VzdFdpdGhQcm9wID8gY2xvc2VzdFdpdGhQcm9wLmdldEF0dHJpYnV0ZShwcm9wKSA6IHZhbHVlO1xufVxuLy8gY3NzXG5jb25zdCBDU1NfVVRJTElUWSA9IHtcbiAgcnRsOiBcImFyY2dpcy0tcnRsXCJcbn07XG5hc3luYyBmdW5jdGlvbiBmb3JtYXROdW1iZXIobnVtYmVyLCBvcHRpb25zKSB7XG4gIGNvbnN0IHsgYXBpLCB0eXBlLCBwbGFjZXMgfSA9IG9wdGlvbnMgfHwge307XG4gIGlmIChhcGkgPT09IDQpIHtcbiAgICBjb25zdCBbaW50bF0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL2ludGxcIl0pO1xuICAgIGNvbnN0IG51bWJlckZvcm1hdEludGxPcHRpb25zID0gaW50bC5jb252ZXJ0TnVtYmVyRm9ybWF0VG9JbnRsT3B0aW9ucyh7XG4gICAgICBwbGFjZXMsXG4gICAgICBzdHlsZTogdHlwZSxcbiAgICAgIGRpZ2l0U2VwYXJhdG9yOiB0cnVlXG4gICAgfSk7XG4gICAgcmV0dXJuIGludGwuZm9ybWF0TnVtYmVyKG51bWJlciwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyksIHsgc3R5bGU6IHR5cGUgfSkpO1xuICB9XG4gIGNvbnN0IFtkb2pvTnVtYmVyXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImRvam8vbnVtYmVyXCJdKTtcbiAgcmV0dXJuIGRvam9OdW1iZXIuZm9ybWF0KG51bWJlciwge1xuICAgIHR5cGUsXG4gICAgcGxhY2VzLFxuICAgIHBhdHRlcm46IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5wYXR0ZXJuXG4gIH0pO1xufVxuY29uc3QgY2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZSkge1xuICBjb25zdCBsYW5nID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lmxhbmc7XG4gIGNvbnN0IGRheVNob3J0TW9udGhZZWFyID0ge1xuICAgIHllYXI6IFwibnVtZXJpY1wiLFxuICAgIG1vbnRoOiBcInNob3J0XCIsXG4gICAgZGF5OiBcIm51bWVyaWNcIlxuICB9O1xuICBpZiAoIWNhY2hlW2xhbmddKSB7XG4gICAgY2FjaGVbbGFuZ10gPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZywgZGF5U2hvcnRNb250aFllYXIpO1xuICB9XG4gIHJldHVybiBjYWNoZVtsYW5nXS5mb3JtYXQoZGF0ZSk7XG59XG5cbmV4cG9ydCB7IENTU19VVElMSVRZIGFzIEMsIGZvcm1hdERhdGUgYXMgYSwgZm9ybWF0TnVtYmVyIGFzIGYsIGdldEVsZW1lbnREaXIgYXMgZywgbGFuZ3VhZ2VNYXAgYXMgbCB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTEzZjViMDBjLmpzJztcbmltcG9ydCB7IGwgYXMgbGFuZ3VhZ2VNYXAgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC0yMjI1OGM5MC5qcyc7XG5pbXBvcnQgeyBhIGFzIGdldEFzc2V0UGF0aCB9IGZyb20gJy4vaW5kZXgtOTJlYmIzOTYuanMnO1xuXG4vLyBodHRwczovL21lZGl1bS5jb20vc3RlbmNpbC10cmlja3MvaW1wbGVtZW50aW5nLWludGVybmF0aW9uYWxpc2F0aW9uLWkxOG4td2l0aC1zdGVuY2lsLTVlNjU1OTU1NDExN1xuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpIHtcbiAgdmFyIF9hLCBfYiwgX2M7XG4gIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gIH1cbiAgZWxzZSB7XG4gICAgLy8gXCJydS1SVVwiIG1hcHMgdG8gXCJydVwiIHVzZSBjYXNlXG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nLnNsaWNlKDAsIDIpKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXR1cm4gXCJlblwiO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KSB7XG4gIHZhciBfYSwgX2IsIF9jO1xuICAvLyBpdCdzIE9LIGlmIHdlIGRvbid0IGhhdmUgdGhlIDQgbGV0dGVyIGxhbmd1YWdlIGZpbGUgZm9yIGl0XG4gIC8vIDQgbGV0dGVyIGxhbmd1YWdlIGNvZGUgbmVlZGVkIGZvciBmb3JtYXR0aW5nIG51bWJlcnNcbiAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gIC8vIGxhbmd1YWdlIHNldCBieSB0aGUgY2FsbGluZyBhcHBsaWNhdGlvbiBvciBicm93c2VyLiBkZWZhdWx0cyB0byBlbmdsaXNoLlxuICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgfVxuICBlbHNlIHtcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAvLyB3ZSBzdXBwb3J0IHRoZSAyIGxldHRlciBjb2RlZCBsYW5ndWFnZVxuICAgICAgLy8gZS5nLiBpdC1DSCB2cyBpdFxuICAgICAgcmV0dXJuIGxhbmc7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGZldGNoTG9jYWxlU3RyaW5nc0ZvckNvbXBvbmVudChjb21wb25lbnROYW1lLCBsb2NhbGUpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBmZXRjaChnZXRBc3NldFBhdGgoYC4uL2FyY2dpcy1hcHAtYXNzZXRzL2kxOG4vJHtjb21wb25lbnROYW1lfS5pMThuLiR7bG9jYWxlfS5qc29uYCkpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgaWYgKHJlc3VsdC5vaylcbiAgICAgICAgcmVzb2x2ZShyZXN1bHQuanNvbigpKTtcbiAgICAgIGVsc2VcbiAgICAgICAgcmVqZWN0KCk7XG4gICAgfSwgKCkgPT4gcmVqZWN0KCkpO1xuICB9KTtcbn1cbmNvbnN0IHN0cmluZ0NhY2hlID0ge307XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gIGNvbnN0IGlkID0gYCR7Y29tcG9uZW50TmFtZX0ke2xvY2FsZX1gO1xuICBpZiAoIXN0cmluZ0NhY2hlW2lkXSkge1xuICAgIHN0cmluZ0NhY2hlW2lkXSA9IGZldGNoTG9jYWxlU3RyaW5nc0ZvckNvbXBvbmVudChjb21wb25lbnROYW1lLCBsb2NhbGUpO1xuICB9XG4gIHJldHVybiBzdHJpbmdDYWNoZVtpZF07XG59XG4vKipcbiAqIEdldCBzdHJpbmdzIGFuZCBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoaXMgbWV0aG9kIHJldHVybnMgMiBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoZSBmaXJzdCBvbmUgcmV0dXJucyBhIGNvZGUgdGhhdCdzIGFsc28gc3VwcG9ydGVkIGFzIGEgbGFuZ3VhZ2UgZmlsZS5cbiAqIFRoZSBzZWNvbmQgb25lIHJldHVybnMgYSBjb2RlIHdoZXJlIHRoZXJlIGlzIHN1cHBvcnQgZm9yIHRoZSBmaXJzdCAyIGxldHRlcnMgb2YgdGhlIGNvZGUgYXMgcGFydCBvZiBhIGxhbmd1YWdlIGZpbGUsXG4gKiBidXQgd2lsbCByZXR1cm4gdGhlIG9yaWdpbmFsIDQgbGV0dGVyIGNvZGUgZnJvbSB0aGUgcGFnZS5cbiAqIEUuZy4gRm9yIFwiaXQtY2hcIiBpdCB3aWxsIHJldHVybiBcIml0XCIgYXMgdGhlIGZpcnN0IGxhbmd1YWdlIGNvZGUgYW5kIFwiaXQtY2hcIiBhcyB0aGUgc2Vjb25kLlxuICogVGhlIHNlY29uZCBvbmUgaXMgcmVxdWlyZWQgZm9yIGVzcmkuaW50bC5zZXRMb2NhbGUoKSB0byBnZXQgdGhlIGNvcnJlY3QgZm9ybWF0dGluZy5cbiAqXG4gKiBJZiBhIHRhZ05hbWUgaXMgcHJvdmlkZWQgaXQgd2lsbCBvdmVyd2l0ZSB0aGUgZWxlbWVudCdzIHRhZ05hbWVcbiAqXG4gKiAgQHJldHVybiBbIHN0cmluZ3MsIGZpcnN0IGxhbmd1YWdlIGNvZGUsIHNlY29uZCBsYW5ndWFnZSBjb2RlXVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKGVsZW1lbnQsIHRhZ05hbWUpIHtcbiAgY29uc3QgY29tcG9uZW50TmFtZSA9IHRhZ05hbWUgfHwgZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpO1xuICBjb25zdCBjb21wb25lbnRMYW5ndWFnZUludGwgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpO1xuICBsZXQgc3RyaW5ncztcbiAgdHJ5IHtcbiAgICBzdHJpbmdzID0gYXdhaXQgZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGNvbXBvbmVudExhbmd1YWdlKTtcbiAgfVxuICBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUud2Fybihgbm8gbG9jYWxlIGZvciAke2NvbXBvbmVudE5hbWV9ICgke2NvbXBvbmVudExhbmd1YWdlfSkgbG9hZGluZyBkZWZhdWx0IGxvY2FsZSBlbi5gKTtcbiAgICBzdHJpbmdzID0gYXdhaXQgZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIFwiZW5cIik7XG4gIH1cbiAgcmV0dXJuIFtzdHJpbmdzLCBjb21wb25lbnRMYW5ndWFnZSwgY29tcG9uZW50TGFuZ3VhZ2VJbnRsXTtcbn1cblxuZXhwb3J0IHsgZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlIGFzIGEsIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgYXMgZyB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9