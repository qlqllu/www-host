"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-6f5ce0"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-upload.entry.js":
/*!**************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-upload.entry.js ***!
  \**************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_append_upload: () => (/* binding */ ArcgisNewItemPagesAppendUpload)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _file_f36193e9_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./file-f36193e9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-f36193e9.js");
/* harmony import */ var _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./item-properties-e6412a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js");
/* harmony import */ var _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./feature-layer-38cdae87.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-38cdae87.js");
/* harmony import */ var _analyze_a3711367_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./analyze-a3711367.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/analyze-a3711367.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./server-item-f12153e6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js");
/* harmony import */ var _overwrite_3049b7af_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./overwrite-3049b7af.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/overwrite-3049b7af.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./append-58a7e7ab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-58a7e7ab.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/* harmony import */ var _item_types_054054c6_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./item-types-054054c6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-054054c6.js");
/* harmony import */ var _geometries_f295af3a_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./geometries-f295af3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geometries-f295af3a.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./guid-4f4176ba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _feature_layer_d33ea114_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./feature-layer-d33ea114.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-d33ea114.js");
/* harmony import */ var _thumbnail_0b7adfcd_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./thumbnail-0b7adfcd.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-0b7adfcd.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./query-4f7b7e4d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-4f7b7e4d.js");
/* harmony import */ var _user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./user-e3dedc4a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js");
/* harmony import */ var _api_f7934cd7_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./api-f7934cd7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-f7934cd7.js");
/* harmony import */ var _item_d9d70416_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./item-d9d70416.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-d9d70416.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _feature_layer_69305a85_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./feature-layer-69305a85.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-69305a85.js");
/* harmony import */ var _functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./functional-9f648bee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-9f648bee.js");
/* harmony import */ var _ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./ags-68d4ae20.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-68d4ae20.js");
/* harmony import */ var _url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./url-f3b82cc7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-f3b82cc7.js");
/* harmony import */ var _storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./storage-d7f5822e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js");
/* harmony import */ var _store_3210b604_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./store-3210b604.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-3210b604.js");
/* harmony import */ var _basic_ee9c674c_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./basic-ee9c674c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/basic-ee9c674c.js");
/* harmony import */ var _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./commonEnums-f98a323c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-f98a323c.js");
/* harmony import */ var _geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./geocode-7eb7c0df.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-7eb7c0df.js");
/* harmony import */ var _privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./privileges-35590eb4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-35590eb4.js");
/* harmony import */ var _publish_item_82ffa7f8_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./publish-item-82ffa7f8.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/publish-item-82ffa7f8.js");
/* harmony import */ var _tile_layer_90a6b901_js__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./tile-layer-90a6b901.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-90a6b901.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */








































/**
 * Different methods to delete item and reset add item store property
 */
async function deleteAddItemStateItem() {
  try {
    await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_7__.d)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.id, { permanentDelete: true });
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.id = null;
  }
  catch (error) {
    console.warn("Delete item failed", error);
  }
}

const arcgisNewItemPagesAppendUploadCss = ":host{overflow:hidden}.file-browser-container{display:block;height:95%}.file-browser-container--has-description{display:block;height:90%}.upload-step{display:block;margin-bottom:0}.upload-step--header-with-description{display:block;margin-bottom:0.75rem}.read-only{display:block;z-index:50}.zip-select-heading{font-weight:500}";

const ArcgisNewItemPagesAppendUpload = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.fileSelect = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "fileSelect", 7);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.newItemToggleNavigationEnabled = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
    this.newItemPrevPage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemPrevPage", 7);
    this.workflowComplete = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
    this.sourceName = "";
    this.itemTypes = [
      { value: "File Geodatabase", icon: "data", publishable: true },
      { value: "Shapefile", icon: "file-zip", publishable: true }
    ];
    this.insideModal = true;
    this.fullHeight = true;
    this.selectedZipFile = "File Geodatabase";
    this.step = "upload";
    this.loading = undefined;
    this.loaderMessage = undefined;
    this.loaderType = "indeterminate";
    this.error = undefined;
    this.overwriteProcess = false;
    this.file = undefined;
    this.header = undefined;
    this.description = undefined;
  }
  async handlePrev(event) {
    event.preventDefault();
    if (this.loading) {
      return;
    }
    if (this.step === "analyzeZip") {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.file = null;
      this.step = "upload";
      return;
    }
    if (this.item.layers.length > 1) {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.sourceDataLayer = null;
    }
    this.newItemPrevPage.emit();
  }
  async handleNext() {
    var _a;
    if (this.overwriteProcess && _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption === "overwrite") {
      const { addAppendSelectOption } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a;
      const emitPayload = Object.assign({ id: (_a = this.publishResponse) === null || _a === void 0 ? void 0 : _a.id, appendType: addAppendSelectOption, item: Object.assign({}, _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a), overwriteStatus: this.overwriteStatus }, this.publishResponse);
      this.workflowComplete.emit(emitPayload);
      return;
    }
    if (!_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.file) {
      this.handleError({ code: "providePath" });
      return;
    }
    if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.extension === "zip") {
      this.step = "analyzeZip";
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.type = _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_11__.a[this.selectedZipFile].type;
      const response = await this.uploadAndAnalyzeFile();
      if (response) {
        this.nextStep();
      }
    }
  }
  // Triggered when a file is selected (via drop or button)
  async fileSelectHandler(event) {
    var _a;
    const file = event.detail.file;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.originalFileName = file.name;
    const { title, fileName, extension } = (0,_file_f36193e9_js__WEBPACK_IMPORTED_MODULE_2__.s)(file, true);
    if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption === "overwrite" &&
      !(0,_file_f36193e9_js__WEBPACK_IMPORTED_MODULE_2__.v)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.originalFileName, this.sourceName)) {
      this.handleError({ code: "useSameFileName" });
      return;
    }
    _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.title = title;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.file = file;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.fileName = fileName;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "file";
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.extension = extension;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.type =
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.extension === "zip" && this.isEnterprise
        ? "Shapefile"
        : (0,_item_types_054054c6_js__WEBPACK_IMPORTED_MODULE_12__.f)(extension, this.validTypes)[0].type;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.addAsUniqueFile = true;
    if (((_a = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.sourceDataLayer) === null || _a === void 0 ? void 0 : _a.geometryType) === "esriGeometryMultiPatch" &&
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.type !== "File Geodatabase" &&
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.type !== "Shapefile" &&
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption !== "update") {
      // Multipatch BUG: https://desktopqa/SFTriage/#/BUG-000156207
      this.step = "upload";
      this.handleError({ code: "multiPatchRestriction" });
      return;
    }
    if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption === "overwrite") {
      await this.handleOverwrite();
    }
    else {
      if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.extension === "zip" && !this.isEnterprise) {
        this.step = "analyzeZip";
      }
      else {
        this.step = "analyze";
        const response = await this.uploadAndAnalyzeFile();
        if (response) {
          this.nextStep();
        }
      }
    }
  }
  async componentWillLoad() {
    var _a, _b, _c;
    const { existingItem, addAppendSelectOption } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a;
    const { config, portal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
    this.item = existingItem;
    this.sourceName = ((_a = this.item.sourceData) === null || _a === void 0 ? void 0 : _a.name) || this.item.name;
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.appendUpload;
    this.config = config;
    this.isEnterprise = portal.isPortal;
    const sourceType = (_c = (_b = this.item) === null || _b === void 0 ? void 0 : _b.sourceData) === null || _c === void 0 ? void 0 : _c.type; //overwrite is disabled when sourceData is null.
    this.allowedExtensions =
      addAppendSelectOption === "overwrite"
        ? (0,_item_types_054054c6_js__WEBPACK_IMPORTED_MODULE_12__.m)([
          sourceType.toLowerCase() === "geojson" ? "GeoJson" : sourceType
        ])
        : portal.isPortal
          ? _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_10__.c
          : _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_10__.d;
    this.header = this.i18n.selectData;
    this.description = "";
    this.validTypes = Object.values(_item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_11__.a).filter((value) => {
      return value.appendUploadFormat;
    });
    if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.id) {
      await deleteAddItemStateItem();
    }
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.file = null; //reset store when user goes back to this page
  }
  async handleOverwrite() {
    const { existingItem, file, keepDescription } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a;
    _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_9__.u.nextText = "proceed";
    const item = existingItem;
    this.loading = true;
    this.overwriteProcess = true;
    this.newItemToggleNavigationEnabled.emit(false);
    this.loaderMessage = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.append.appendLoadingMessages.overwriting;
    const { error } = await (0,_overwrite_3049b7af_js__WEBPACK_IMPORTED_MODULE_8__.f)(item, item.itemOwner.userContentUrl, {
      // ! Use fetchUser if itemOwner is not available
      file,
      overwrite: true,
      keepDescription
    });
    if (error) {
      this.handleError(error);
      this.loading = false;
      return false;
    }
    try {
      this.publishResponse = await (0,_overwrite_3049b7af_js__WEBPACK_IMPORTED_MODULE_8__.p)(existingItem, _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.title, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
      await (0,_overwrite_3049b7af_js__WEBPACK_IMPORTED_MODULE_8__.r)(item);
      await this.checkStatus(item);
    }
    catch (error) {
      this.handleError({ code: "unhandledError" });
      this.loading = false;
      return false;
    }
  }
  async checkStatus(item) {
    var _a;
    this.newItemToggleNavigationEnabled.emit(true);
    const response = await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_4__.w)(item.id); //checking update of source data's job.
    this.overwriteStatus = response === null || response === void 0 ? void 0 : response.status;
    const emitPayload = Object.assign({ id: (_a = this.publishResponse) === null || _a === void 0 ? void 0 : _a.id, item: Object.assign({}, _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a), overwriteStatus: this.overwriteStatus, appendType: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption }, this.publishResponse);
    if ((response === null || response === void 0 ? void 0 : response.status.toLowerCase()) === "completed") {
      emitPayload.overwriteStatus = response === null || response === void 0 ? void 0 : response.status;
      this.workflowComplete.emit(emitPayload);
      return;
    }
    else if ((response === null || response === void 0 ? void 0 : response.status.toLowerCase()) === "failed") {
      _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_9__.u.nextText = "next";
      this.loading = false;
      this.handleError({ code: "unhandledError" });
    }
    return response;
  }
  nextStep() {
    var _a, _b, _c;
    //Determine next step in workflow.
    let nextPage = "appendSelectLayer";
    const { analyzeResults } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a;
    const publishParameters = analyzeResults.publishParameters;
    if (((_a = analyzeResults.publishParameters.layers) === null || _a === void 0 ? void 0 : _a.length) === 1 ||
      !analyzeResults.publishParameters.layers) {
      //CSV is never multi-layered so does not have layers property
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.dataLayer = (_c = (_b = publishParameters === null || publishParameters === void 0 ? void 0 : publishParameters.layers) === null || _b === void 0 ? void 0 : _b[0]) !== null && _c !== void 0 ? _c : publishParameters;
      if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption !== "update") {
        const isCompatibleGeometries = (0,_geometries_f295af3a_js__WEBPACK_IMPORTED_MODULE_13__.c)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.dataLayer, _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.sourceDataLayer, _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.type);
        if (!isCompatibleGeometries) {
          this.handleError({ code: "incompatibleGeometries" });
          return;
        }
      }
      if ((_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.type === "Microsoft Excel" || _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.type === "CSV") &&
        (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a === null || _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a === void 0 ? void 0 : _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.sourceDataLayer.geometryType) === "esriGeometryPoint" &&
        (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a === null || _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a === void 0 ? void 0 : _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.sourceDataLayer.type) !== "Table") {
        nextPage = "csvLocationFields";
      }
      else if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption === "add" &&
        (!_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.backupLayerFields.some((field) => field.type === "esriFieldTypeDate") ||
          this.isEnterprise)) {
        nextPage = "appendMatchFields";
      }
      else {
        nextPage = "appendKeyPairSelect";
      }
    }
    this.newItemToggleNavigationEnabled.emit(true);
    this.newItemUpdatePage.emit(nextPage);
  }
  updateLoader(loaderType, loaderMessage) {
    this.loaderType = loaderType;
    this.loaderMessage = loaderMessage;
  }
  async uploadAndAnalyzeFile() {
    const { file, originalFileName, type } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a;
    const { portal, user, config, lang } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
    this.loading = true;
    this.newItemToggleNavigationEnabled.emit(false);
    this.updateLoader((file === null || file === void 0 ? void 0 : file.size) > _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_4__.M ? "determinate" : "indeterminate", _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.append.appendLoadingMessages.uploading.replace("${fileName}", originalFileName));
    let error = null;
    ({ error } = await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_4__.x)()); //upload file includes check status
    if (error) {
      this.handleError(error);
      return false;
    }
    this.updateLoader("indeterminate", this.i18n.analyzing);
    ({ error } = await (0,_analyze_a3711367_js__WEBPACK_IMPORTED_MODULE_5__.a)({
      analyzeArgs: { type: "item", itemid: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.id, workflow: "append" },
      itemArgs: { itemType: type },
      configArgs: { portal, user, config, lang },
      initialize: true
    }));
    if (error) {
      this.handleError(error);
      if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.id) {
        await deleteAddItemStateItem();
      }
    }
    return !error;
  }
  async handleError(error) {
    this.newItemToggleNavigationEnabled.emit(true);
    let errorTitle = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.error;
    let errorMessage = this.i18n.errors.errorWhileUpload;
    switch (error.code) {
      case "exceedsFileSize":
        errorMessage = this.i18n.errors.errorExceedFileSize;
        break;
      case "invalidFileGeodatabase":
        errorTitle = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.itemProperties.invalidGeodatabase.title;
        errorMessage = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.itemProperties.invalidGeodatabase.description;
        break;
      case "invalidShapefile":
        errorTitle = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.itemProperties.invalidShapefile.title;
        errorMessage = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.itemProperties.invalidShapefile.description;
        break;
      case "useSameFileName":
        errorMessage = this.i18n.errors.sameFileName.replace("${x}", this.sourceName);
        break;
      case "providePath":
        errorMessage = this.i18n.errors.providePath;
        break;
      case "incompatibleGeometries":
        errorTitle = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.appendSelectLayer.sameGeometryWarningTitle;
        errorMessage = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.appendSelectLayer.sameGeometryWarningDescription;
        break;
      case "multiPatchRestriction":
        errorTitle = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.appendSelectLayer.sameGeometryWarningTitle;
        errorMessage = this.i18n.errors.multiPatchErrorDescription;
        break;
      case "unhandledError":
        if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption === "overwrite") {
          errorMessage = this.i18n.errors.errorUpdate;
        }
        break;
    }
    if (error.code === "incompatibleGeometries" ||
      (error.code === "multiPatchRestriction" && _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.id)) {
      //delete the temp item for incorrect file upload
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.file = null;
      await deleteAddItemStateItem();
    }
    this.loading = false;
    this.error = { title: errorTitle, description: errorMessage };
  }
  renderPickZip() {
    const options = this.itemTypes.map(({ value, icon }) => ({
      optionTitle: this.i18n[value].title,
      value,
      description: this.i18n[value].description,
      icon
    }));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "zip-select" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "zip-select-heading" }, this.i18n.itemType), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", { layout: "vertical", class: "tile-select" }, Object.keys(options).map((key) => {
      const { icon, value, optionTitle, description } = options[key];
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { key: value, checked: value === this.selectedZipFile, heading: optionTitle, description: description, icon: icon, name: "select-zip-file-for-append", "input-enabled": true, width: "full", type: "radio", value: value, onCalciteTileSelectChange: (e) => {
          this.selectedZipFile = e.target.value;
        } }));
    }))));
  }
  render() {
    const { i18n, error, loaderType, loaderMessage, step, loading, config, sourceName, validTypes, allowedExtensions, isEnterprise } = this;
    const isOverwrite = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption === "overwrite";
    if (isOverwrite) {
      this.header = i18n.selectData;
      this.description = i18n.sameFileNameDescription.replace("${fileName}", sourceName);
    }
    const helpNumber = isEnterprise && isOverwrite ? "120004189" : "120001300";
    const helpLink = `${config.helpBase}${config.helpMap[helpNumber]}`;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: { "overflow-hidden": loading } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: loaderType, active: loading, text: loaderMessage }), step !== "analyzeZip" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: { "upload-step": true, "upload-step--header-with-description": isOverwrite } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: this.header, content: this.description }))), step !== "analyzeZip" && ( //Have file browser still present when error occurs in analyze
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
        "file-browser-container": true,
        "file-browser-container--has-description": isOverwrite
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-file-browser", { cloud: false, validTypes: validTypes, allowedExtensions: allowedExtensions, insideModal: true, config: config, helpText: i18n.learnMore, helpLink: helpLink, helpIdType: "append", fullHeight: true }))), step === "analyzeZip" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "analyze-step" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-input-readonly", { label: i18n.file }), _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_6__.a.extension === "zip" && this.renderPickZip())), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: error === null || error === void 0 ? void 0 : error.title, description: error === null || error === void 0 ? void 0 : error.description, link: { href: error === null || error === void 0 ? void 0 : error.link, title: error === null || error === void 0 ? void 0 : error.linkText }, active: !!error, onAlertDismiss: () => (this.error = null) })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesAppendUpload.style = arcgisNewItemPagesAppendUploadCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geometries-f295af3a.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geometries-f295af3a.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ checkCompatibleGeometries),
/* harmony export */   v: () => (/* binding */ verifyGeometries)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
function verifyGeometries(args) {
  var _a, _b;
  const { dataLayer, type, sourceDataLayer } = args;
  const dataLayerGeometry = (_a = dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.geometryType) !== null && _a !== void 0 ? _a : (_b = dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.layerInfo) === null || _b === void 0 ? void 0 : _b.geometryType;
  if (type === "Microsoft Excel" || type === "CSV") {
    if (((dataLayer.locationType === "address" && dataLayer.addressFields) || dataLayer.locationType === "coordinates") && //check location type is address in case "none" is selected and addressFields linger
      (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) === "esriGeometryPoint") {
      return null;
    }
    else if (!dataLayerGeometry || dataLayer.locationType === "none" || (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.type) === "Table") {
      return { title: "noGeometryMatchTitle", description: "noGeometryTableMessage" };
    }
    else if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) !== dataLayerGeometry) {
      return { title: "noGeometryMatchTitle", description: "noGeometryMatchMessage" };
    }
  }
  else {
    if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) !== (dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.geometryType)) {
      return { title: "noGeometryMatchTitle", description: "noGeometryMatchMessage" };
    }
  }
}
function checkCompatibleGeometries(dataLayer, sourceDataLayer, type) {
  if (type === "Microsoft Excel" || type === "CSV") {
    if (((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) === "esriGeometryPoint" || (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.type) === "Table") &&
      (dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.locationType) === "none") {
      return true;
    }
    if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) === "esriGeometryPoint") {
      return !!dataLayer.addressFields || dataLayer.locationType !== "none";
    }
    return false;
  }
  else {
    return (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.type) === "Table" || (dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.geometryType) === (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType);
  }
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-054054c6.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-054054c6.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isLargeCSV),
/* harmony export */   f: () => (/* binding */ findPossibleItemTypesByExtension),
/* harmony export */   i: () => (/* binding */ isLargeGeoJSON),
/* harmony export */   m: () => (/* binding */ mapItemTypesToFileExtensions)
/* harmony export */ });
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



function findPossibleItemTypesByExtension(extension, validationTypes) {
  // Search item types extensions for the one imported
  let itemTypes;
  if (validationTypes) {
    itemTypes = validationTypes.map((value) => {
      return value.type;
    });
  }
  else {
    itemTypes = Object.keys(_item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__.a);
  }
  let possibleItemTypes = [];
  itemTypes.forEach((type) => {
    var _a;
    if (((_a = _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__.a[type].fileExt) === null || _a === void 0 ? void 0 : _a.indexOf(extension)) >= 0) {
      possibleItemTypes.push(_item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__.a[type]);
    }
  });
  return possibleItemTypes;
}
function mapItemTypesToFileExtensions(types) {
  if (!types) {
    return null;
  }
  return (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_0__.b)(types.flatMap((type) => { var _a; return (_a = _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__.a[type]) === null || _a === void 0 ? void 0 : _a.fileExt; }).filter((valid) => !!valid));
}
const isLargeGeoJSON = (sizeInBytes) => {
  const sizeInMB = sizeInBytes / 1024 / 1024;
  // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2553#issuecomment-3645404
  return sizeInMB > 50; // 50MB
};
const isLargeCSV = (sizeInBytes) => {
  const sizeInMB = sizeInBytes / 1024 / 1024;
  // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2875#issuecomment-3748913
  return sizeInMB > 20; // 20MB
};




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTZmNWNlMC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDNkc7QUFDckQ7QUFDb0M7QUFDbkI7QUFDOEM7QUFDbEU7QUFDTTtBQUNDO0FBQ3dEO0FBQy9EO0FBQzRDO0FBQzlCO0FBQ2lEO0FBQzFDO0FBQzdDO0FBQ0Q7QUFDTTtBQUNBO0FBQ0c7QUFDSjtBQUNIO0FBQ0s7QUFDTjtBQUNEO0FBQ0Q7QUFDQztBQUNEO0FBQ1U7QUFDSDtBQUNQO0FBQ0E7QUFDSTtBQUNGO0FBQ0E7QUFDTTtBQUNKO0FBQ0c7QUFDRTtBQUNGOztBQUVsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSwyREFBVSxDQUFDLG9EQUFZLE9BQU8sdUJBQXVCO0FBQy9ELElBQUksb0RBQVk7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxpREFBaUQsZ0JBQWdCLHdCQUF3QixjQUFjLFdBQVcseUNBQXlDLGNBQWMsV0FBVyxhQUFhLGNBQWMsZ0JBQWdCLHNDQUFzQyxjQUFjLHNCQUFzQixXQUFXLGNBQWMsV0FBVyxvQkFBb0IsZ0JBQWdCOztBQUVqWDtBQUNBO0FBQ0EsSUFBSSxxREFBZ0I7QUFDcEIsc0JBQXNCLHFEQUFXO0FBQ2pDLDZCQUE2QixxREFBVztBQUN4QywwQ0FBMEMscURBQVc7QUFDckQsMkJBQTJCLHFEQUFXO0FBQ3RDLDRCQUE0QixxREFBVztBQUN2QztBQUNBO0FBQ0EsUUFBUSw0REFBNEQ7QUFDcEUsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVpRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUMxQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ3VEO0FBQ1k7O0FBRW5FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsNEJBQTRCLHNEQUFrQjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsc0RBQWtCO0FBQ2pDLDZCQUE2QixzREFBa0I7QUFDL0M7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUywwREFBTSwyQkFBMkIsUUFBUSxhQUFhLHNEQUFrQiwwREFBMEQ7QUFDM0k7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7O0FBRTBIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWFwcGVuZC11cGxvYWQuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vZ2VvbWV0cmllcy1mMjk1YWYzYS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9pdGVtLXR5cGVzLTA1NDA1NGM2LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtOTJlYmIzOTYuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLWViNWY3ZGMyLmpzJztcbmltcG9ydCB7IHMgYXMgc2FuaXRpemVGaWxlSW5wdXQsIHYgYXMgdmFsaWRhdGVPdmVyd3JpdGVGaWxlTmFtZSB9IGZyb20gJy4vZmlsZS1mMzYxOTNlOS5qcyc7XG5pbXBvcnQgeyBpIGFzIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUgfSBmcm9tICcuL2l0ZW0tcHJvcGVydGllcy1lNjQxMmE5YS5qcyc7XG5pbXBvcnQgeyB3IGFzIGdldEl0ZW1TdGF0dXMsIE0gYXMgTVVMVElfUEFSVF9VUExPQURfTUlOSU1VTV9TSVpFLCB4IGFzIHVwbG9hZEZpbGUgfSBmcm9tICcuL2ZlYXR1cmUtbGF5ZXItMzhjZGFlODcuanMnO1xuaW1wb3J0IHsgYSBhcyBhbmFseXplIH0gZnJvbSAnLi9hbmFseXplLWEzNzExMzY3LmpzJztcbmltcG9ydCB7IGEgYXMgYWRkSXRlbVN0YXRlIH0gZnJvbSAnLi9hZGQtaXRlbS05N2Q1NzdhOS5qcyc7XG5pbXBvcnQgeyBkIGFzIGRlbGV0ZUl0ZW0gfSBmcm9tICcuL3NlcnZlci1pdGVtLWYxMjE1M2U2LmpzJztcbmltcG9ydCB7IGYgYXMgZmV0Y2hBbmRVcGRhdGVJdGVtLCBwIGFzIHB1Ymxpc2hGb3JPdmVyd3JpdGUsIHIgYXMgcmVzZXRTZXJ2aWNlVGl0bGUgfSBmcm9tICcuL292ZXJ3cml0ZS0zMDQ5YjdhZi5qcyc7XG5pbXBvcnQgeyB1IGFzIHVpU3RvcmVTdGF0ZSB9IGZyb20gJy4vdWktZWNmODZiYmEuanMnO1xuaW1wb3J0IHsgYyBhcyBhcHBlbmRFeHRlbnNpb25zRm9yRW50ZXJwcmlzZSwgZCBhcyBhcHBlbmRFeHRlbnNpb25zIH0gZnJvbSAnLi9hcHBlbmQtNThhN2U3YWIuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRDcmVhdGVJdGVtVHlwZXMgfSBmcm9tICcuL2l0ZW0tdHlwZXMtYjRmZTg2YWQuanMnO1xuaW1wb3J0IHsgZiBhcyBmaW5kUG9zc2libGVJdGVtVHlwZXNCeUV4dGVuc2lvbiwgbSBhcyBtYXBJdGVtVHlwZXNUb0ZpbGVFeHRlbnNpb25zIH0gZnJvbSAnLi9pdGVtLXR5cGVzLTA1NDA1NGM2LmpzJztcbmltcG9ydCB7IGMgYXMgY2hlY2tDb21wYXRpYmxlR2VvbWV0cmllcyB9IGZyb20gJy4vZ2VvbWV0cmllcy1mMjk1YWYzYS5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtODFkNTQ4YjcuanMnO1xuaW1wb3J0ICcuL2d1aWQtNGY0MTc2YmEuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtYzgyZjVhYjkuanMnO1xuaW1wb3J0ICcuL3ByaXZpbGVnZXMtY2NkNWYzN2QuanMnO1xuaW1wb3J0ICcuL2ZlYXR1cmUtbGF5ZXItZDMzZWExMTQuanMnO1xuaW1wb3J0ICcuL3RodW1ibmFpbC0wYjdhZGZjZC5qcyc7XG5pbXBvcnQgJy4vcG9ydGFsLTc5Y2FhZWZmLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1hYWYzMGJkNi5qcyc7XG5pbXBvcnQgJy4vcXVlcnktNGY3YjdlNGQuanMnO1xuaW1wb3J0ICcuL3VzZXItZTNkZWRjNGEuanMnO1xuaW1wb3J0ICcuL2FwaS1mNzkzNGNkNy5qcyc7XG5pbXBvcnQgJy4vaXRlbS1kOWQ3MDQxNi5qcyc7XG5pbXBvcnQgJy4vZG9tLTEzZjViMDBjLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTY5MzA1YTg1LmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTlmNjQ4YmVlLmpzJztcbmltcG9ydCAnLi9hZ3MtNjhkNGFlMjAuanMnO1xuaW1wb3J0ICcuL3VybC1mM2I4MmNjNy5qcyc7XG5pbXBvcnQgJy4vc3RvcmFnZS1kN2Y1ODIyZS5qcyc7XG5pbXBvcnQgJy4vc3RvcmUtMzIxMGI2MDQuanMnO1xuaW1wb3J0ICcuL2Jhc2ljLWVlOWM2NzRjLmpzJztcbmltcG9ydCAnLi9jb21tb25FbnVtcy1mOThhMzIzYy5qcyc7XG5pbXBvcnQgJy4vZ2VvY29kZS03ZWI3YzBkZi5qcyc7XG5pbXBvcnQgJy4vcHJpdmlsZWdlcy0zNTU5MGViNC5qcyc7XG5pbXBvcnQgJy4vcHVibGlzaC1pdGVtLTgyZmZhN2Y4LmpzJztcbmltcG9ydCAnLi90aWxlLWxheWVyLTkwYTZiOTAxLmpzJztcblxuLyoqXG4gKiBEaWZmZXJlbnQgbWV0aG9kcyB0byBkZWxldGUgaXRlbSBhbmQgcmVzZXQgYWRkIGl0ZW0gc3RvcmUgcHJvcGVydHlcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZGVsZXRlQWRkSXRlbVN0YXRlSXRlbSgpIHtcbiAgdHJ5IHtcbiAgICBhd2FpdCBkZWxldGVJdGVtKGFkZEl0ZW1TdGF0ZS5pZCwgeyBwZXJtYW5lbnREZWxldGU6IHRydWUgfSk7XG4gICAgYWRkSXRlbVN0YXRlLmlkID0gbnVsbDtcbiAgfVxuICBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLndhcm4oXCJEZWxldGUgaXRlbSBmYWlsZWRcIiwgZXJyb3IpO1xuICB9XG59XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZFVwbG9hZENzcyA9IFwiOmhvc3R7b3ZlcmZsb3c6aGlkZGVufS5maWxlLWJyb3dzZXItY29udGFpbmVye2Rpc3BsYXk6YmxvY2s7aGVpZ2h0Ojk1JX0uZmlsZS1icm93c2VyLWNvbnRhaW5lci0taGFzLWRlc2NyaXB0aW9ue2Rpc3BsYXk6YmxvY2s7aGVpZ2h0OjkwJX0udXBsb2FkLXN0ZXB7ZGlzcGxheTpibG9jazttYXJnaW4tYm90dG9tOjB9LnVwbG9hZC1zdGVwLS1oZWFkZXItd2l0aC1kZXNjcmlwdGlvbntkaXNwbGF5OmJsb2NrO21hcmdpbi1ib3R0b206MC43NXJlbX0ucmVhZC1vbmx5e2Rpc3BsYXk6YmxvY2s7ei1pbmRleDo1MH0uemlwLXNlbGVjdC1oZWFkaW5ne2ZvbnQtd2VpZ2h0OjUwMH1cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kVXBsb2FkID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmZpbGVTZWxlY3QgPSBjcmVhdGVFdmVudCh0aGlzLCBcImZpbGVTZWxlY3RcIiwgNyk7XG4gICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVVwZGF0ZVBhZ2VcIiwgNyk7XG4gICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZFwiLCA3KTtcbiAgICB0aGlzLm5ld0l0ZW1QcmV2UGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVByZXZQYWdlXCIsIDcpO1xuICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwid29ya2Zsb3dDb21wbGV0ZVwiLCA3KTtcbiAgICB0aGlzLnNvdXJjZU5hbWUgPSBcIlwiO1xuICAgIHRoaXMuaXRlbVR5cGVzID0gW1xuICAgICAgeyB2YWx1ZTogXCJGaWxlIEdlb2RhdGFiYXNlXCIsIGljb246IFwiZGF0YVwiLCBwdWJsaXNoYWJsZTogdHJ1ZSB9LFxuICAgICAgeyB2YWx1ZTogXCJTaGFwZWZpbGVcIiwgaWNvbjogXCJmaWxlLXppcFwiLCBwdWJsaXNoYWJsZTogdHJ1ZSB9XG4gICAgXTtcbiAgICB0aGlzLmluc2lkZU1vZGFsID0gdHJ1ZTtcbiAgICB0aGlzLmZ1bGxIZWlnaHQgPSB0cnVlO1xuICAgIHRoaXMuc2VsZWN0ZWRaaXBGaWxlID0gXCJGaWxlIEdlb2RhdGFiYXNlXCI7XG4gICAgdGhpcy5zdGVwID0gXCJ1cGxvYWRcIjtcbiAgICB0aGlzLmxvYWRpbmcgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sb2FkZXJNZXNzYWdlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubG9hZGVyVHlwZSA9IFwiaW5kZXRlcm1pbmF0ZVwiO1xuICAgIHRoaXMuZXJyb3IgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5vdmVyd3JpdGVQcm9jZXNzID0gZmFsc2U7XG4gICAgdGhpcy5maWxlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaGVhZGVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZGVzY3JpcHRpb24gPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgaGFuZGxlUHJldihldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgaWYgKHRoaXMubG9hZGluZykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy5zdGVwID09PSBcImFuYWx5emVaaXBcIikge1xuICAgICAgYWRkSXRlbVN0YXRlLmZpbGUgPSBudWxsO1xuICAgICAgdGhpcy5zdGVwID0gXCJ1cGxvYWRcIjtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHRoaXMuaXRlbS5sYXllcnMubGVuZ3RoID4gMSkge1xuICAgICAgYWRkSXRlbVN0YXRlLnNvdXJjZURhdGFMYXllciA9IG51bGw7XG4gICAgfVxuICAgIHRoaXMubmV3SXRlbVByZXZQYWdlLmVtaXQoKTtcbiAgfVxuICBhc3luYyBoYW5kbGVOZXh0KCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAodGhpcy5vdmVyd3JpdGVQcm9jZXNzICYmIGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwib3ZlcndyaXRlXCIpIHtcbiAgICAgIGNvbnN0IHsgYWRkQXBwZW5kU2VsZWN0T3B0aW9uIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICBjb25zdCBlbWl0UGF5bG9hZCA9IE9iamVjdC5hc3NpZ24oeyBpZDogKF9hID0gdGhpcy5wdWJsaXNoUmVzcG9uc2UpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pZCwgYXBwZW5kVHlwZTogYWRkQXBwZW5kU2VsZWN0T3B0aW9uLCBpdGVtOiBPYmplY3QuYXNzaWduKHt9LCBhZGRJdGVtU3RhdGUpLCBvdmVyd3JpdGVTdGF0dXM6IHRoaXMub3ZlcndyaXRlU3RhdHVzIH0sIHRoaXMucHVibGlzaFJlc3BvbnNlKTtcbiAgICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZS5lbWl0KGVtaXRQYXlsb2FkKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFhZGRJdGVtU3RhdGUuZmlsZSkge1xuICAgICAgdGhpcy5oYW5kbGVFcnJvcih7IGNvZGU6IFwicHJvdmlkZVBhdGhcIiB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGFkZEl0ZW1TdGF0ZS5leHRlbnNpb24gPT09IFwiemlwXCIpIHtcbiAgICAgIHRoaXMuc3RlcCA9IFwiYW5hbHl6ZVppcFwiO1xuICAgICAgYWRkSXRlbVN0YXRlLnR5cGUgPSBhZGRDcmVhdGVJdGVtVHlwZXNbdGhpcy5zZWxlY3RlZFppcEZpbGVdLnR5cGU7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMudXBsb2FkQW5kQW5hbHl6ZUZpbGUoKTtcbiAgICAgIGlmIChyZXNwb25zZSkge1xuICAgICAgICB0aGlzLm5leHRTdGVwKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8vIFRyaWdnZXJlZCB3aGVuIGEgZmlsZSBpcyBzZWxlY3RlZCAodmlhIGRyb3Agb3IgYnV0dG9uKVxuICBhc3luYyBmaWxlU2VsZWN0SGFuZGxlcihldmVudCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBmaWxlID0gZXZlbnQuZGV0YWlsLmZpbGU7XG4gICAgYWRkSXRlbVN0YXRlLm9yaWdpbmFsRmlsZU5hbWUgPSBmaWxlLm5hbWU7XG4gICAgY29uc3QgeyB0aXRsZSwgZmlsZU5hbWUsIGV4dGVuc2lvbiB9ID0gc2FuaXRpemVGaWxlSW5wdXQoZmlsZSwgdHJ1ZSk7XG4gICAgaWYgKGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwib3ZlcndyaXRlXCIgJiZcbiAgICAgICF2YWxpZGF0ZU92ZXJ3cml0ZUZpbGVOYW1lKGFkZEl0ZW1TdGF0ZS5vcmlnaW5hbEZpbGVOYW1lLCB0aGlzLnNvdXJjZU5hbWUpKSB7XG4gICAgICB0aGlzLmhhbmRsZUVycm9yKHsgY29kZTogXCJ1c2VTYW1lRmlsZU5hbWVcIiB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSA9IHRpdGxlO1xuICAgIGFkZEl0ZW1TdGF0ZS5maWxlID0gZmlsZTtcbiAgICBhZGRJdGVtU3RhdGUuZmlsZU5hbWUgPSBmaWxlTmFtZTtcbiAgICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPSBcImZpbGVcIjtcbiAgICBhZGRJdGVtU3RhdGUuZXh0ZW5zaW9uID0gZXh0ZW5zaW9uO1xuICAgIGFkZEl0ZW1TdGF0ZS50eXBlID1cbiAgICAgIGFkZEl0ZW1TdGF0ZS5leHRlbnNpb24gPT09IFwiemlwXCIgJiYgdGhpcy5pc0VudGVycHJpc2VcbiAgICAgICAgPyBcIlNoYXBlZmlsZVwiXG4gICAgICAgIDogZmluZFBvc3NpYmxlSXRlbVR5cGVzQnlFeHRlbnNpb24oZXh0ZW5zaW9uLCB0aGlzLnZhbGlkVHlwZXMpWzBdLnR5cGU7XG4gICAgYWRkSXRlbVN0YXRlLmFkZEFzVW5pcXVlRmlsZSA9IHRydWU7XG4gICAgaWYgKCgoX2EgPSBhZGRJdGVtU3RhdGUuc291cmNlRGF0YUxheWVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZ2VvbWV0cnlUeXBlKSA9PT0gXCJlc3JpR2VvbWV0cnlNdWx0aVBhdGNoXCIgJiZcbiAgICAgIGFkZEl0ZW1TdGF0ZS50eXBlICE9PSBcIkZpbGUgR2VvZGF0YWJhc2VcIiAmJlxuICAgICAgYWRkSXRlbVN0YXRlLnR5cGUgIT09IFwiU2hhcGVmaWxlXCIgJiZcbiAgICAgIGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gIT09IFwidXBkYXRlXCIpIHtcbiAgICAgIC8vIE11bHRpcGF0Y2ggQlVHOiBodHRwczovL2Rlc2t0b3BxYS9TRlRyaWFnZS8jL0JVRy0wMDAxNTYyMDdcbiAgICAgIHRoaXMuc3RlcCA9IFwidXBsb2FkXCI7XG4gICAgICB0aGlzLmhhbmRsZUVycm9yKHsgY29kZTogXCJtdWx0aVBhdGNoUmVzdHJpY3Rpb25cIiB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwib3ZlcndyaXRlXCIpIHtcbiAgICAgIGF3YWl0IHRoaXMuaGFuZGxlT3ZlcndyaXRlKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgaWYgKGFkZEl0ZW1TdGF0ZS5leHRlbnNpb24gPT09IFwiemlwXCIgJiYgIXRoaXMuaXNFbnRlcnByaXNlKSB7XG4gICAgICAgIHRoaXMuc3RlcCA9IFwiYW5hbHl6ZVppcFwiO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuc3RlcCA9IFwiYW5hbHl6ZVwiO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMudXBsb2FkQW5kQW5hbHl6ZUZpbGUoKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlKSB7XG4gICAgICAgICAgdGhpcy5uZXh0U3RlcCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIGNvbnN0IHsgZXhpc3RpbmdJdGVtLCBhZGRBcHBlbmRTZWxlY3RPcHRpb24gfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBjb25zdCB7IGNvbmZpZywgcG9ydGFsIH0gPSBjb25maWdTdGF0ZTtcbiAgICB0aGlzLml0ZW0gPSBleGlzdGluZ0l0ZW07XG4gICAgdGhpcy5zb3VyY2VOYW1lID0gKChfYSA9IHRoaXMuaXRlbS5zb3VyY2VEYXRhKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubmFtZSkgfHwgdGhpcy5pdGVtLm5hbWU7XG4gICAgdGhpcy5pMThuID0gdWlTdG9yZVN0YXRlLmkxOG4uYXBwZW5kVXBsb2FkO1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMuaXNFbnRlcnByaXNlID0gcG9ydGFsLmlzUG9ydGFsO1xuICAgIGNvbnN0IHNvdXJjZVR5cGUgPSAoX2MgPSAoX2IgPSB0aGlzLml0ZW0pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zb3VyY2VEYXRhKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MudHlwZTsgLy9vdmVyd3JpdGUgaXMgZGlzYWJsZWQgd2hlbiBzb3VyY2VEYXRhIGlzIG51bGwuXG4gICAgdGhpcy5hbGxvd2VkRXh0ZW5zaW9ucyA9XG4gICAgICBhZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwib3ZlcndyaXRlXCJcbiAgICAgICAgPyBtYXBJdGVtVHlwZXNUb0ZpbGVFeHRlbnNpb25zKFtcbiAgICAgICAgICBzb3VyY2VUeXBlLnRvTG93ZXJDYXNlKCkgPT09IFwiZ2VvanNvblwiID8gXCJHZW9Kc29uXCIgOiBzb3VyY2VUeXBlXG4gICAgICAgIF0pXG4gICAgICAgIDogcG9ydGFsLmlzUG9ydGFsXG4gICAgICAgICAgPyBhcHBlbmRFeHRlbnNpb25zRm9yRW50ZXJwcmlzZVxuICAgICAgICAgIDogYXBwZW5kRXh0ZW5zaW9ucztcbiAgICB0aGlzLmhlYWRlciA9IHRoaXMuaTE4bi5zZWxlY3REYXRhO1xuICAgIHRoaXMuZGVzY3JpcHRpb24gPSBcIlwiO1xuICAgIHRoaXMudmFsaWRUeXBlcyA9IE9iamVjdC52YWx1ZXMoYWRkQ3JlYXRlSXRlbVR5cGVzKS5maWx0ZXIoKHZhbHVlKSA9PiB7XG4gICAgICByZXR1cm4gdmFsdWUuYXBwZW5kVXBsb2FkRm9ybWF0O1xuICAgIH0pO1xuICAgIGlmIChhZGRJdGVtU3RhdGUuaWQpIHtcbiAgICAgIGF3YWl0IGRlbGV0ZUFkZEl0ZW1TdGF0ZUl0ZW0oKTtcbiAgICB9XG4gICAgYWRkSXRlbVN0YXRlLmZpbGUgPSBudWxsOyAvL3Jlc2V0IHN0b3JlIHdoZW4gdXNlciBnb2VzIGJhY2sgdG8gdGhpcyBwYWdlXG4gIH1cbiAgYXN5bmMgaGFuZGxlT3ZlcndyaXRlKCkge1xuICAgIGNvbnN0IHsgZXhpc3RpbmdJdGVtLCBmaWxlLCBrZWVwRGVzY3JpcHRpb24gfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICB1aVN0b3JlU3RhdGUubmV4dFRleHQgPSBcInByb2NlZWRcIjtcbiAgICBjb25zdCBpdGVtID0gZXhpc3RpbmdJdGVtO1xuICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgdGhpcy5vdmVyd3JpdGVQcm9jZXNzID0gdHJ1ZTtcbiAgICB0aGlzLm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZC5lbWl0KGZhbHNlKTtcbiAgICB0aGlzLmxvYWRlck1lc3NhZ2UgPSB1aVN0b3JlU3RhdGUuaTE4bi5hcHBlbmQuYXBwZW5kTG9hZGluZ01lc3NhZ2VzLm92ZXJ3cml0aW5nO1xuICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IGZldGNoQW5kVXBkYXRlSXRlbShpdGVtLCBpdGVtLml0ZW1Pd25lci51c2VyQ29udGVudFVybCwge1xuICAgICAgLy8gISBVc2UgZmV0Y2hVc2VyIGlmIGl0ZW1Pd25lciBpcyBub3QgYXZhaWxhYmxlXG4gICAgICBmaWxlLFxuICAgICAgb3ZlcndyaXRlOiB0cnVlLFxuICAgICAga2VlcERlc2NyaXB0aW9uXG4gICAgfSk7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICB0aGlzLmhhbmRsZUVycm9yKGVycm9yKTtcbiAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgdGhpcy5wdWJsaXNoUmVzcG9uc2UgPSBhd2FpdCBwdWJsaXNoRm9yT3ZlcndyaXRlKGV4aXN0aW5nSXRlbSwgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSwgY29uZmlnU3RhdGUucG9ydGFsLCBjb25maWdTdGF0ZS51c2VyKTtcbiAgICAgIGF3YWl0IHJlc2V0U2VydmljZVRpdGxlKGl0ZW0pO1xuICAgICAgYXdhaXQgdGhpcy5jaGVja1N0YXR1cyhpdGVtKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmhhbmRsZUVycm9yKHsgY29kZTogXCJ1bmhhbmRsZWRFcnJvclwiIH0pO1xuICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIGFzeW5jIGNoZWNrU3RhdHVzKGl0ZW0pIHtcbiAgICB2YXIgX2E7XG4gICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdCh0cnVlKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGdldEl0ZW1TdGF0dXMoaXRlbS5pZCk7IC8vY2hlY2tpbmcgdXBkYXRlIG9mIHNvdXJjZSBkYXRhJ3Mgam9iLlxuICAgIHRoaXMub3ZlcndyaXRlU3RhdHVzID0gcmVzcG9uc2UgPT09IG51bGwgfHwgcmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3BvbnNlLnN0YXR1cztcbiAgICBjb25zdCBlbWl0UGF5bG9hZCA9IE9iamVjdC5hc3NpZ24oeyBpZDogKF9hID0gdGhpcy5wdWJsaXNoUmVzcG9uc2UpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pZCwgaXRlbTogT2JqZWN0LmFzc2lnbih7fSwgYWRkSXRlbVN0YXRlKSwgb3ZlcndyaXRlU3RhdHVzOiB0aGlzLm92ZXJ3cml0ZVN0YXR1cywgYXBwZW5kVHlwZTogYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiB9LCB0aGlzLnB1Ymxpc2hSZXNwb25zZSk7XG4gICAgaWYgKChyZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2Uuc3RhdHVzLnRvTG93ZXJDYXNlKCkpID09PSBcImNvbXBsZXRlZFwiKSB7XG4gICAgICBlbWl0UGF5bG9hZC5vdmVyd3JpdGVTdGF0dXMgPSByZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2Uuc3RhdHVzO1xuICAgICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlLmVtaXQoZW1pdFBheWxvYWQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBlbHNlIGlmICgocmVzcG9uc2UgPT09IG51bGwgfHwgcmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3BvbnNlLnN0YXR1cy50b0xvd2VyQ2FzZSgpKSA9PT0gXCJmYWlsZWRcIikge1xuICAgICAgdWlTdG9yZVN0YXRlLm5leHRUZXh0ID0gXCJuZXh0XCI7XG4gICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMuaGFuZGxlRXJyb3IoeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuICBuZXh0U3RlcCgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAvL0RldGVybWluZSBuZXh0IHN0ZXAgaW4gd29ya2Zsb3cuXG4gICAgbGV0IG5leHRQYWdlID0gXCJhcHBlbmRTZWxlY3RMYXllclwiO1xuICAgIGNvbnN0IHsgYW5hbHl6ZVJlc3VsdHMgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBjb25zdCBwdWJsaXNoUGFyYW1ldGVycyA9IGFuYWx5emVSZXN1bHRzLnB1Ymxpc2hQYXJhbWV0ZXJzO1xuICAgIGlmICgoKF9hID0gYW5hbHl6ZVJlc3VsdHMucHVibGlzaFBhcmFtZXRlcnMubGF5ZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSA9PT0gMSB8fFxuICAgICAgIWFuYWx5emVSZXN1bHRzLnB1Ymxpc2hQYXJhbWV0ZXJzLmxheWVycykge1xuICAgICAgLy9DU1YgaXMgbmV2ZXIgbXVsdGktbGF5ZXJlZCBzbyBkb2VzIG5vdCBoYXZlIGxheWVycyBwcm9wZXJ0eVxuICAgICAgYWRkSXRlbVN0YXRlLmRhdGFMYXllciA9IChfYyA9IChfYiA9IHB1Ymxpc2hQYXJhbWV0ZXJzID09PSBudWxsIHx8IHB1Ymxpc2hQYXJhbWV0ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwdWJsaXNoUGFyYW1ldGVycy5sYXllcnMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYlswXSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogcHVibGlzaFBhcmFtZXRlcnM7XG4gICAgICBpZiAoYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiAhPT0gXCJ1cGRhdGVcIikge1xuICAgICAgICBjb25zdCBpc0NvbXBhdGlibGVHZW9tZXRyaWVzID0gY2hlY2tDb21wYXRpYmxlR2VvbWV0cmllcyhhZGRJdGVtU3RhdGUuZGF0YUxheWVyLCBhZGRJdGVtU3RhdGUuc291cmNlRGF0YUxheWVyLCBhZGRJdGVtU3RhdGUudHlwZSk7XG4gICAgICAgIGlmICghaXNDb21wYXRpYmxlR2VvbWV0cmllcykge1xuICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoeyBjb2RlOiBcImluY29tcGF0aWJsZUdlb21ldHJpZXNcIiB9KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICgoYWRkSXRlbVN0YXRlLnR5cGUgPT09IFwiTWljcm9zb2Z0IEV4Y2VsXCIgfHwgYWRkSXRlbVN0YXRlLnR5cGUgPT09IFwiQ1NWXCIpICYmXG4gICAgICAgIChhZGRJdGVtU3RhdGUgPT09IG51bGwgfHwgYWRkSXRlbVN0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhZGRJdGVtU3RhdGUuc291cmNlRGF0YUxheWVyLmdlb21ldHJ5VHlwZSkgPT09IFwiZXNyaUdlb21ldHJ5UG9pbnRcIiAmJlxuICAgICAgICAoYWRkSXRlbVN0YXRlID09PSBudWxsIHx8IGFkZEl0ZW1TdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogYWRkSXRlbVN0YXRlLnNvdXJjZURhdGFMYXllci50eXBlKSAhPT0gXCJUYWJsZVwiKSB7XG4gICAgICAgIG5leHRQYWdlID0gXCJjc3ZMb2NhdGlvbkZpZWxkc1wiO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJhZGRcIiAmJlxuICAgICAgICAoIWFkZEl0ZW1TdGF0ZS5iYWNrdXBMYXllckZpZWxkcy5zb21lKChmaWVsZCkgPT4gZmllbGQudHlwZSA9PT0gXCJlc3JpRmllbGRUeXBlRGF0ZVwiKSB8fFxuICAgICAgICAgIHRoaXMuaXNFbnRlcnByaXNlKSkge1xuICAgICAgICBuZXh0UGFnZSA9IFwiYXBwZW5kTWF0Y2hGaWVsZHNcIjtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBuZXh0UGFnZSA9IFwiYXBwZW5kS2V5UGFpclNlbGVjdFwiO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZC5lbWl0KHRydWUpO1xuICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChuZXh0UGFnZSk7XG4gIH1cbiAgdXBkYXRlTG9hZGVyKGxvYWRlclR5cGUsIGxvYWRlck1lc3NhZ2UpIHtcbiAgICB0aGlzLmxvYWRlclR5cGUgPSBsb2FkZXJUeXBlO1xuICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IGxvYWRlck1lc3NhZ2U7XG4gIH1cbiAgYXN5bmMgdXBsb2FkQW5kQW5hbHl6ZUZpbGUoKSB7XG4gICAgY29uc3QgeyBmaWxlLCBvcmlnaW5hbEZpbGVOYW1lLCB0eXBlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgY29uc3QgeyBwb3J0YWwsIHVzZXIsIGNvbmZpZywgbGFuZyB9ID0gY29uZmlnU3RhdGU7XG4gICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICB0aGlzLm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZC5lbWl0KGZhbHNlKTtcbiAgICB0aGlzLnVwZGF0ZUxvYWRlcigoZmlsZSA9PT0gbnVsbCB8fCBmaWxlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWxlLnNpemUpID4gTVVMVElfUEFSVF9VUExPQURfTUlOSU1VTV9TSVpFID8gXCJkZXRlcm1pbmF0ZVwiIDogXCJpbmRldGVybWluYXRlXCIsIHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZC5hcHBlbmRMb2FkaW5nTWVzc2FnZXMudXBsb2FkaW5nLnJlcGxhY2UoXCIke2ZpbGVOYW1lfVwiLCBvcmlnaW5hbEZpbGVOYW1lKSk7XG4gICAgbGV0IGVycm9yID0gbnVsbDtcbiAgICAoeyBlcnJvciB9ID0gYXdhaXQgdXBsb2FkRmlsZSgpKTsgLy91cGxvYWQgZmlsZSBpbmNsdWRlcyBjaGVjayBzdGF0dXNcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLnVwZGF0ZUxvYWRlcihcImluZGV0ZXJtaW5hdGVcIiwgdGhpcy5pMThuLmFuYWx5emluZyk7XG4gICAgKHsgZXJyb3IgfSA9IGF3YWl0IGFuYWx5emUoe1xuICAgICAgYW5hbHl6ZUFyZ3M6IHsgdHlwZTogXCJpdGVtXCIsIGl0ZW1pZDogYWRkSXRlbVN0YXRlLmlkLCB3b3JrZmxvdzogXCJhcHBlbmRcIiB9LFxuICAgICAgaXRlbUFyZ3M6IHsgaXRlbVR5cGU6IHR5cGUgfSxcbiAgICAgIGNvbmZpZ0FyZ3M6IHsgcG9ydGFsLCB1c2VyLCBjb25maWcsIGxhbmcgfSxcbiAgICAgIGluaXRpYWxpemU6IHRydWVcbiAgICB9KSk7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICB0aGlzLmhhbmRsZUVycm9yKGVycm9yKTtcbiAgICAgIGlmIChhZGRJdGVtU3RhdGUuaWQpIHtcbiAgICAgICAgYXdhaXQgZGVsZXRlQWRkSXRlbVN0YXRlSXRlbSgpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gIWVycm9yO1xuICB9XG4gIGFzeW5jIGhhbmRsZUVycm9yKGVycm9yKSB7XG4gICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdCh0cnVlKTtcbiAgICBsZXQgZXJyb3JUaXRsZSA9IHVpU3RvcmVTdGF0ZS5pMThuLmVycm9yO1xuICAgIGxldCBlcnJvck1lc3NhZ2UgPSB0aGlzLmkxOG4uZXJyb3JzLmVycm9yV2hpbGVVcGxvYWQ7XG4gICAgc3dpdGNoIChlcnJvci5jb2RlKSB7XG4gICAgICBjYXNlIFwiZXhjZWVkc0ZpbGVTaXplXCI6XG4gICAgICAgIGVycm9yTWVzc2FnZSA9IHRoaXMuaTE4bi5lcnJvcnMuZXJyb3JFeGNlZWRGaWxlU2l6ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiaW52YWxpZEZpbGVHZW9kYXRhYmFzZVwiOlxuICAgICAgICBlcnJvclRpdGxlID0gdWlTdG9yZVN0YXRlLmkxOG4uaXRlbVByb3BlcnRpZXMuaW52YWxpZEdlb2RhdGFiYXNlLnRpdGxlO1xuICAgICAgICBlcnJvck1lc3NhZ2UgPSB1aVN0b3JlU3RhdGUuaTE4bi5pdGVtUHJvcGVydGllcy5pbnZhbGlkR2VvZGF0YWJhc2UuZGVzY3JpcHRpb247XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImludmFsaWRTaGFwZWZpbGVcIjpcbiAgICAgICAgZXJyb3JUaXRsZSA9IHVpU3RvcmVTdGF0ZS5pMThuLml0ZW1Qcm9wZXJ0aWVzLmludmFsaWRTaGFwZWZpbGUudGl0bGU7XG4gICAgICAgIGVycm9yTWVzc2FnZSA9IHVpU3RvcmVTdGF0ZS5pMThuLml0ZW1Qcm9wZXJ0aWVzLmludmFsaWRTaGFwZWZpbGUuZGVzY3JpcHRpb247XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInVzZVNhbWVGaWxlTmFtZVwiOlxuICAgICAgICBlcnJvck1lc3NhZ2UgPSB0aGlzLmkxOG4uZXJyb3JzLnNhbWVGaWxlTmFtZS5yZXBsYWNlKFwiJHt4fVwiLCB0aGlzLnNvdXJjZU5hbWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJwcm92aWRlUGF0aFwiOlxuICAgICAgICBlcnJvck1lc3NhZ2UgPSB0aGlzLmkxOG4uZXJyb3JzLnByb3ZpZGVQYXRoO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJpbmNvbXBhdGlibGVHZW9tZXRyaWVzXCI6XG4gICAgICAgIGVycm9yVGl0bGUgPSB1aVN0b3JlU3RhdGUuaTE4bi5hcHBlbmRTZWxlY3RMYXllci5zYW1lR2VvbWV0cnlXYXJuaW5nVGl0bGU7XG4gICAgICAgIGVycm9yTWVzc2FnZSA9IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZFNlbGVjdExheWVyLnNhbWVHZW9tZXRyeVdhcm5pbmdEZXNjcmlwdGlvbjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwibXVsdGlQYXRjaFJlc3RyaWN0aW9uXCI6XG4gICAgICAgIGVycm9yVGl0bGUgPSB1aVN0b3JlU3RhdGUuaTE4bi5hcHBlbmRTZWxlY3RMYXllci5zYW1lR2VvbWV0cnlXYXJuaW5nVGl0bGU7XG4gICAgICAgIGVycm9yTWVzc2FnZSA9IHRoaXMuaTE4bi5lcnJvcnMubXVsdGlQYXRjaEVycm9yRGVzY3JpcHRpb247XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInVuaGFuZGxlZEVycm9yXCI6XG4gICAgICAgIGlmIChhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcIm92ZXJ3cml0ZVwiKSB7XG4gICAgICAgICAgZXJyb3JNZXNzYWdlID0gdGhpcy5pMThuLmVycm9ycy5lcnJvclVwZGF0ZTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgaWYgKGVycm9yLmNvZGUgPT09IFwiaW5jb21wYXRpYmxlR2VvbWV0cmllc1wiIHx8XG4gICAgICAoZXJyb3IuY29kZSA9PT0gXCJtdWx0aVBhdGNoUmVzdHJpY3Rpb25cIiAmJiBhZGRJdGVtU3RhdGUuaWQpKSB7XG4gICAgICAvL2RlbGV0ZSB0aGUgdGVtcCBpdGVtIGZvciBpbmNvcnJlY3QgZmlsZSB1cGxvYWRcbiAgICAgIGFkZEl0ZW1TdGF0ZS5maWxlID0gbnVsbDtcbiAgICAgIGF3YWl0IGRlbGV0ZUFkZEl0ZW1TdGF0ZUl0ZW0oKTtcbiAgICB9XG4gICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgdGhpcy5lcnJvciA9IHsgdGl0bGU6IGVycm9yVGl0bGUsIGRlc2NyaXB0aW9uOiBlcnJvck1lc3NhZ2UgfTtcbiAgfVxuICByZW5kZXJQaWNrWmlwKCkge1xuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLml0ZW1UeXBlcy5tYXAoKHsgdmFsdWUsIGljb24gfSkgPT4gKHtcbiAgICAgIG9wdGlvblRpdGxlOiB0aGlzLmkxOG5bdmFsdWVdLnRpdGxlLFxuICAgICAgdmFsdWUsXG4gICAgICBkZXNjcmlwdGlvbjogdGhpcy5pMThuW3ZhbHVlXS5kZXNjcmlwdGlvbixcbiAgICAgIGljb25cbiAgICB9KSk7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcInppcC1zZWxlY3RcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiemlwLXNlbGVjdC1oZWFkaW5nXCIgfSwgdGhpcy5pMThuLml0ZW1UeXBlKSwgaChcImNhbGNpdGUtdGlsZS1zZWxlY3QtZ3JvdXBcIiwgeyBsYXlvdXQ6IFwidmVydGljYWxcIiwgY2xhc3M6IFwidGlsZS1zZWxlY3RcIiB9LCBPYmplY3Qua2V5cyhvcHRpb25zKS5tYXAoKGtleSkgPT4ge1xuICAgICAgY29uc3QgeyBpY29uLCB2YWx1ZSwgb3B0aW9uVGl0bGUsIGRlc2NyaXB0aW9uIH0gPSBvcHRpb25zW2tleV07XG4gICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLXRpbGUtc2VsZWN0XCIsIHsga2V5OiB2YWx1ZSwgY2hlY2tlZDogdmFsdWUgPT09IHRoaXMuc2VsZWN0ZWRaaXBGaWxlLCBoZWFkaW5nOiBvcHRpb25UaXRsZSwgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLCBpY29uOiBpY29uLCBuYW1lOiBcInNlbGVjdC16aXAtZmlsZS1mb3ItYXBwZW5kXCIsIFwiaW5wdXQtZW5hYmxlZFwiOiB0cnVlLCB3aWR0aDogXCJmdWxsXCIsIHR5cGU6IFwicmFkaW9cIiwgdmFsdWU6IHZhbHVlLCBvbkNhbGNpdGVUaWxlU2VsZWN0Q2hhbmdlOiAoZSkgPT4ge1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRaaXBGaWxlID0gZS50YXJnZXQudmFsdWU7XG4gICAgICAgIH0gfSkpO1xuICAgIH0pKSkpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGkxOG4sIGVycm9yLCBsb2FkZXJUeXBlLCBsb2FkZXJNZXNzYWdlLCBzdGVwLCBsb2FkaW5nLCBjb25maWcsIHNvdXJjZU5hbWUsIHZhbGlkVHlwZXMsIGFsbG93ZWRFeHRlbnNpb25zLCBpc0VudGVycHJpc2UgfSA9IHRoaXM7XG4gICAgY29uc3QgaXNPdmVyd3JpdGUgPSBhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcIm92ZXJ3cml0ZVwiO1xuICAgIGlmIChpc092ZXJ3cml0ZSkge1xuICAgICAgdGhpcy5oZWFkZXIgPSBpMThuLnNlbGVjdERhdGE7XG4gICAgICB0aGlzLmRlc2NyaXB0aW9uID0gaTE4bi5zYW1lRmlsZU5hbWVEZXNjcmlwdGlvbi5yZXBsYWNlKFwiJHtmaWxlTmFtZX1cIiwgc291cmNlTmFtZSk7XG4gICAgfVxuICAgIGNvbnN0IGhlbHBOdW1iZXIgPSBpc0VudGVycHJpc2UgJiYgaXNPdmVyd3JpdGUgPyBcIjEyMDAwNDE4OVwiIDogXCIxMjAwMDEzMDBcIjtcbiAgICBjb25zdCBoZWxwTGluayA9IGAke2NvbmZpZy5oZWxwQmFzZX0ke2NvbmZpZy5oZWxwTWFwW2hlbHBOdW1iZXJdfWA7XG4gICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IHsgXCJvdmVyZmxvdy1oaWRkZW5cIjogbG9hZGluZyB9IH0sIGgoXCJhcmNnaXMtbmV3LWl0ZW0tbG9hZGVyXCIsIHsgdHlwZTogbG9hZGVyVHlwZSwgYWN0aXZlOiBsb2FkaW5nLCB0ZXh0OiBsb2FkZXJNZXNzYWdlIH0pLCBzdGVwICE9PSBcImFuYWx5emVaaXBcIiAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiB7IFwidXBsb2FkLXN0ZXBcIjogdHJ1ZSwgXCJ1cGxvYWQtc3RlcC0taGVhZGVyLXdpdGgtZGVzY3JpcHRpb25cIjogaXNPdmVyd3JpdGUgfSB9LCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWRlc2NyaXB0aW9uXCIsIHsgaGVhZGVyOiB0aGlzLmhlYWRlciwgY29udGVudDogdGhpcy5kZXNjcmlwdGlvbiB9KSkpLCBzdGVwICE9PSBcImFuYWx5emVaaXBcIiAmJiAoIC8vSGF2ZSBmaWxlIGJyb3dzZXIgc3RpbGwgcHJlc2VudCB3aGVuIGVycm9yIG9jY3VycyBpbiBhbmFseXplXG4gICAgaChcImRpdlwiLCB7IGNsYXNzOiB7XG4gICAgICAgIFwiZmlsZS1icm93c2VyLWNvbnRhaW5lclwiOiB0cnVlLFxuICAgICAgICBcImZpbGUtYnJvd3Nlci1jb250YWluZXItLWhhcy1kZXNjcmlwdGlvblwiOiBpc092ZXJ3cml0ZVxuICAgICAgfSB9LCBoKFwiYXJjZ2lzLWZpbGUtYnJvd3NlclwiLCB7IGNsb3VkOiBmYWxzZSwgdmFsaWRUeXBlczogdmFsaWRUeXBlcywgYWxsb3dlZEV4dGVuc2lvbnM6IGFsbG93ZWRFeHRlbnNpb25zLCBpbnNpZGVNb2RhbDogdHJ1ZSwgY29uZmlnOiBjb25maWcsIGhlbHBUZXh0OiBpMThuLmxlYXJuTW9yZSwgaGVscExpbms6IGhlbHBMaW5rLCBoZWxwSWRUeXBlOiBcImFwcGVuZFwiLCBmdWxsSGVpZ2h0OiB0cnVlIH0pKSksIHN0ZXAgPT09IFwiYW5hbHl6ZVppcFwiICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiYW5hbHl6ZS1zdGVwXCIgfSwgaChcImFyY2dpcy1uZXctaXRlbS1pbnB1dC1yZWFkb25seVwiLCB7IGxhYmVsOiBpMThuLmZpbGUgfSksIGFkZEl0ZW1TdGF0ZS5leHRlbnNpb24gPT09IFwiemlwXCIgJiYgdGhpcy5yZW5kZXJQaWNrWmlwKCkpKSwgaChcImFyY2dpcy1uZXctaXRlbS1hbGVydFwiLCB7IGhlYWRpbmc6IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci50aXRsZSwgZGVzY3JpcHRpb246IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5kZXNjcmlwdGlvbiwgbGluazogeyBocmVmOiBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IubGluaywgdGl0bGU6IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5saW5rVGV4dCB9LCBhY3RpdmU6ICEhZXJyb3IsIG9uQWxlcnREaXNtaXNzOiAoKSA9PiAodGhpcy5lcnJvciA9IG51bGwpIH0pKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZFVwbG9hZC5zdHlsZSA9IGFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZFVwbG9hZENzcztcblxuZXhwb3J0IHsgQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kVXBsb2FkIGFzIGFyY2dpc19uZXdfaXRlbV9wYWdlc19hcHBlbmRfdXBsb2FkIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmZ1bmN0aW9uIHZlcmlmeUdlb21ldHJpZXMoYXJncykge1xuICB2YXIgX2EsIF9iO1xuICBjb25zdCB7IGRhdGFMYXllciwgdHlwZSwgc291cmNlRGF0YUxheWVyIH0gPSBhcmdzO1xuICBjb25zdCBkYXRhTGF5ZXJHZW9tZXRyeSA9IChfYSA9IGRhdGFMYXllciA9PT0gbnVsbCB8fCBkYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGFMYXllci5nZW9tZXRyeVR5cGUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYiA9IGRhdGFMYXllciA9PT0gbnVsbCB8fCBkYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGFMYXllci5sYXllckluZm8pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5nZW9tZXRyeVR5cGU7XG4gIGlmICh0eXBlID09PSBcIk1pY3Jvc29mdCBFeGNlbFwiIHx8IHR5cGUgPT09IFwiQ1NWXCIpIHtcbiAgICBpZiAoKChkYXRhTGF5ZXIubG9jYXRpb25UeXBlID09PSBcImFkZHJlc3NcIiAmJiBkYXRhTGF5ZXIuYWRkcmVzc0ZpZWxkcykgfHwgZGF0YUxheWVyLmxvY2F0aW9uVHlwZSA9PT0gXCJjb29yZGluYXRlc1wiKSAmJiAvL2NoZWNrIGxvY2F0aW9uIHR5cGUgaXMgYWRkcmVzcyBpbiBjYXNlIFwibm9uZVwiIGlzIHNlbGVjdGVkIGFuZCBhZGRyZXNzRmllbGRzIGxpbmdlclxuICAgICAgKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci5nZW9tZXRyeVR5cGUpID09PSBcImVzcmlHZW9tZXRyeVBvaW50XCIpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBlbHNlIGlmICghZGF0YUxheWVyR2VvbWV0cnkgfHwgZGF0YUxheWVyLmxvY2F0aW9uVHlwZSA9PT0gXCJub25lXCIgfHwgKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci50eXBlKSA9PT0gXCJUYWJsZVwiKSB7XG4gICAgICByZXR1cm4geyB0aXRsZTogXCJub0dlb21ldHJ5TWF0Y2hUaXRsZVwiLCBkZXNjcmlwdGlvbjogXCJub0dlb21ldHJ5VGFibGVNZXNzYWdlXCIgfTtcbiAgICB9XG4gICAgZWxzZSBpZiAoKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci5nZW9tZXRyeVR5cGUpICE9PSBkYXRhTGF5ZXJHZW9tZXRyeSkge1xuICAgICAgcmV0dXJuIHsgdGl0bGU6IFwibm9HZW9tZXRyeU1hdGNoVGl0bGVcIiwgZGVzY3JpcHRpb246IFwibm9HZW9tZXRyeU1hdGNoTWVzc2FnZVwiIH07XG4gICAgfVxuICB9XG4gIGVsc2Uge1xuICAgIGlmICgoc291cmNlRGF0YUxheWVyID09PSBudWxsIHx8IHNvdXJjZURhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlRGF0YUxheWVyLmdlb21ldHJ5VHlwZSkgIT09IChkYXRhTGF5ZXIgPT09IG51bGwgfHwgZGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhTGF5ZXIuZ2VvbWV0cnlUeXBlKSkge1xuICAgICAgcmV0dXJuIHsgdGl0bGU6IFwibm9HZW9tZXRyeU1hdGNoVGl0bGVcIiwgZGVzY3JpcHRpb246IFwibm9HZW9tZXRyeU1hdGNoTWVzc2FnZVwiIH07XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBjaGVja0NvbXBhdGlibGVHZW9tZXRyaWVzKGRhdGFMYXllciwgc291cmNlRGF0YUxheWVyLCB0eXBlKSB7XG4gIGlmICh0eXBlID09PSBcIk1pY3Jvc29mdCBFeGNlbFwiIHx8IHR5cGUgPT09IFwiQ1NWXCIpIHtcbiAgICBpZiAoKChzb3VyY2VEYXRhTGF5ZXIgPT09IG51bGwgfHwgc291cmNlRGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzb3VyY2VEYXRhTGF5ZXIuZ2VvbWV0cnlUeXBlKSA9PT0gXCJlc3JpR2VvbWV0cnlQb2ludFwiIHx8IChzb3VyY2VEYXRhTGF5ZXIgPT09IG51bGwgfHwgc291cmNlRGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzb3VyY2VEYXRhTGF5ZXIudHlwZSkgPT09IFwiVGFibGVcIikgJiZcbiAgICAgIChkYXRhTGF5ZXIgPT09IG51bGwgfHwgZGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhTGF5ZXIubG9jYXRpb25UeXBlKSA9PT0gXCJub25lXCIpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci5nZW9tZXRyeVR5cGUpID09PSBcImVzcmlHZW9tZXRyeVBvaW50XCIpIHtcbiAgICAgIHJldHVybiAhIWRhdGFMYXllci5hZGRyZXNzRmllbGRzIHx8IGRhdGFMYXllci5sb2NhdGlvblR5cGUgIT09IFwibm9uZVwiO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZWxzZSB7XG4gICAgcmV0dXJuIChzb3VyY2VEYXRhTGF5ZXIgPT09IG51bGwgfHwgc291cmNlRGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzb3VyY2VEYXRhTGF5ZXIudHlwZSkgPT09IFwiVGFibGVcIiB8fCAoZGF0YUxheWVyID09PSBudWxsIHx8IGRhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YUxheWVyLmdlb21ldHJ5VHlwZSkgPT09IChzb3VyY2VEYXRhTGF5ZXIgPT09IG51bGwgfHwgc291cmNlRGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzb3VyY2VEYXRhTGF5ZXIuZ2VvbWV0cnlUeXBlKTtcbiAgfVxufVxuXG5leHBvcnQgeyBjaGVja0NvbXBhdGlibGVHZW9tZXRyaWVzIGFzIGMsIHZlcmlmeUdlb21ldHJpZXMgYXMgdiB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBiIGFzIHVuaXF1ZSB9IGZyb20gJy4vZnVuY3Rpb25hbC1jODJmNWFiOS5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZENyZWF0ZUl0ZW1UeXBlcyB9IGZyb20gJy4vaXRlbS10eXBlcy1iNGZlODZhZC5qcyc7XG5cbmZ1bmN0aW9uIGZpbmRQb3NzaWJsZUl0ZW1UeXBlc0J5RXh0ZW5zaW9uKGV4dGVuc2lvbiwgdmFsaWRhdGlvblR5cGVzKSB7XG4gIC8vIFNlYXJjaCBpdGVtIHR5cGVzIGV4dGVuc2lvbnMgZm9yIHRoZSBvbmUgaW1wb3J0ZWRcbiAgbGV0IGl0ZW1UeXBlcztcbiAgaWYgKHZhbGlkYXRpb25UeXBlcykge1xuICAgIGl0ZW1UeXBlcyA9IHZhbGlkYXRpb25UeXBlcy5tYXAoKHZhbHVlKSA9PiB7XG4gICAgICByZXR1cm4gdmFsdWUudHlwZTtcbiAgICB9KTtcbiAgfVxuICBlbHNlIHtcbiAgICBpdGVtVHlwZXMgPSBPYmplY3Qua2V5cyhhZGRDcmVhdGVJdGVtVHlwZXMpO1xuICB9XG4gIGxldCBwb3NzaWJsZUl0ZW1UeXBlcyA9IFtdO1xuICBpdGVtVHlwZXMuZm9yRWFjaCgodHlwZSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBpZiAoKChfYSA9IGFkZENyZWF0ZUl0ZW1UeXBlc1t0eXBlXS5maWxlRXh0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5kZXhPZihleHRlbnNpb24pKSA+PSAwKSB7XG4gICAgICBwb3NzaWJsZUl0ZW1UeXBlcy5wdXNoKGFkZENyZWF0ZUl0ZW1UeXBlc1t0eXBlXSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHBvc3NpYmxlSXRlbVR5cGVzO1xufVxuZnVuY3Rpb24gbWFwSXRlbVR5cGVzVG9GaWxlRXh0ZW5zaW9ucyh0eXBlcykge1xuICBpZiAoIXR5cGVzKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgcmV0dXJuIHVuaXF1ZSh0eXBlcy5mbGF0TWFwKCh0eXBlKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IGFkZENyZWF0ZUl0ZW1UeXBlc1t0eXBlXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbGVFeHQ7IH0pLmZpbHRlcigodmFsaWQpID0+ICEhdmFsaWQpKTtcbn1cbmNvbnN0IGlzTGFyZ2VHZW9KU09OID0gKHNpemVJbkJ5dGVzKSA9PiB7XG4gIGNvbnN0IHNpemVJbk1CID0gc2l6ZUluQnl0ZXMgLyAxMDI0IC8gMTAyNDtcbiAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWFwcC1jb21wb25lbnRzL2lzc3Vlcy8yNTUzI2lzc3VlY29tbWVudC0zNjQ1NDA0XG4gIHJldHVybiBzaXplSW5NQiA+IDUwOyAvLyA1ME1CXG59O1xuY29uc3QgaXNMYXJnZUNTViA9IChzaXplSW5CeXRlcykgPT4ge1xuICBjb25zdCBzaXplSW5NQiA9IHNpemVJbkJ5dGVzIC8gMTAyNCAvIDEwMjQ7XG4gIC8vIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1hcHAtY29tcG9uZW50cy9pc3N1ZXMvMjg3NSNpc3N1ZWNvbW1lbnQtMzc0ODkxM1xuICByZXR1cm4gc2l6ZUluTUIgPiAyMDsgLy8gMjBNQlxufTtcblxuZXhwb3J0IHsgaXNMYXJnZUNTViBhcyBhLCBmaW5kUG9zc2libGVJdGVtVHlwZXNCeUV4dGVuc2lvbiBhcyBmLCBpc0xhcmdlR2VvSlNPTiBhcyBpLCBtYXBJdGVtVHlwZXNUb0ZpbGVFeHRlbnNpb25zIGFzIG0gfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==