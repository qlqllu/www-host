"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-f81c2f"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-dependency-check_3.entry.js":
/*!****************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-dependency-check_3.entry.js ***!
  \****************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_dependency_check: () => (/* binding */ ArcgisDependencyCheck),
/* harmony export */   arcgis_item_share_group: () => (/* binding */ ArcgisItemShareGroup),
/* harmony export */   arcgis_item_share_group_card: () => (/* binding */ ArcgisItemShareGroupCard)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _services_adddeef9_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./services-adddeef9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/services-adddeef9.js");
/* harmony import */ var _utils_fba8960d_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./utils-fba8960d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-fba8960d.js");
/* harmony import */ var _item_d9d70416_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./item-d9d70416.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-d9d70416.js");
/* harmony import */ var _user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./user-e3dedc4a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./server-item-f12153e6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js");
/* harmony import */ var _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./item-properties-e6412a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./functional-9f648bee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-9f648bee.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */





















const arcgisDependencyCheckCss = ".stage{height:100%;overflow:hidden;transform:translate(0, 0)}@media screen and (min-width: 1080px){.stage{height:min(700px, 60vh)}}calcite-modal{--calcite-modal-content-padding:0;--calcite-modal-width:1080px}.top-bar{font-weight:500;padding-top:1.5rem;padding-bottom:0.5rem;padding-left:1rem;padding-right:1rem;font-size:0.875rem}@media screen and (min-width: 1080px){.top-bar{padding-left:0;padding-right:0}}.top-notice{padding-bottom:0.75rem;margin-bottom:0.75rem;border-bottom:1px solid var(--calcite-ui-border-1)}.open-item{-webkit-margin-start:0.25rem;margin-inline-start:0.25rem;-webkit-border-start:1px solid var(--calcite-ui-border-1);border-inline-start:1px solid var(--calcite-ui-border-1);-webkit-padding-start:0.25rem;padding-inline-start:0.25rem}.status-banner{display:flex;align-items:center;padding-left:1rem;padding-right:1rem;padding-top:0.25rem;padding-bottom:0.25rem;font-size:0.75rem;border-bottom:1px solid var(--calcite-ui-border-2)}.status-banner>calcite-icon{color:var(--calcite-ui-danger);-webkit-margin-end:0.5rem;margin-inline-end:0.5rem}.status-banner>span{margin-top:2px}.status-banner--info>calcite-icon{color:var(--calcite-ui-info)}.compact-grid-content{--arcgis-item-browser-content-spacing:0.5rem}.preview-notice{margin-bottom:1rem}";

const ArcgisDependencyCheck = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.workflowCancel = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowCancel", 7);
    this.workflowComplete = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
    this.analyzeSharingDetail = async () => {
      let { preProcessedSharingDetail: newShareDetail, items, portal, i18n } = this;
      this.loadingText = "loadingInfo";
      let errorCode;
      if (!this.preProcessedSharingDetail) {
        const analyzeResults = await Promise.all(items.map(({ item, overrideLayers }) => (0,_services_adddeef9_js__WEBPACK_IMPORTED_MODULE_4__.a)(item, portal, overrideLayers, // TODO: remove this assertion when we have a proper type for layerType
        { clearDataCacheOnDone: false })));
        _services_adddeef9_js__WEBPACK_IMPORTED_MODULE_4__.e.forEach((type) => (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.c)(type));
        newShareDetail = analyzeResults.reduce((acc, { error, result }) => {
          // TODO: hair splitting this maybe
          errorCode = error === null || error === void 0 ? void 0 : error.code;
          if (result) {
            Object.keys(result).forEach((key) => {
              acc[key] = [...acc[key], ...result[key]];
            });
          }
          return acc;
        }, {
          needEditableLayers: [],
          needPubliclyEditableLayers: [],
          needDataCollectionLayers: [],
          needsShareLevelUpdateLayers: [],
          premiumLayers: [],
          notEditableLayers: []
        });
      }
      this.sharingDetail = newShareDetail;
      if (!this.sharingDetail || errorCode === "dataNotAvailable") {
        this.errorMessage = i18n.unableToGetItem;
        return [];
      }
      return this.filterAndGetSharingDetails();
    };
    this.filterAndGetSharingDetails = () => {
      const { sharingDetail } = this;
      if (Object.keys(sharingDetail).every((key) => { var _a; return !((_a = sharingDetail[key]) === null || _a === void 0 ? void 0 : _a.length); })) {
        // No error to show
        return;
      }
      const { needEditableLayers, needsShareLevelUpdateLayers } = sharingDetail;
      this.needsShareLevelUpdateLayers = needsShareLevelUpdateLayers;
      this.needEditableLayers = needEditableLayers;
      this.shareableItemCount = [...needsShareLevelUpdateLayers, ...needEditableLayers].length;
      const displayItems = Object.keys(sharingDetail).reduce((acc, key) => {
        var _a;
        (_a = sharingDetail[key]) === null || _a === void 0 ? void 0 : _a.forEach((layer) => {
          acc.push({ item: layer.sourceItem, state: key });
        });
        return acc;
      }, []);
      this.displayItems = displayItems;
      return displayItems;
    };
    this.closeDialog = () => {
      this.workflowCancel.emit();
    };
    this.updateSharing = async () => {
      const { needsShareLevelUpdateLayers, needEditableLayers, portal, items } = this;
      this.isLoading = true;
      this.loadingText = "updatingSharing";
      const needsUpdateLayerInfo = [...needsShareLevelUpdateLayers, ...needEditableLayers];
      const updatedSourceItems = needsUpdateLayerInfo.map(({ sourceItem }) => sourceItem);
      const shouldUpdateShareLevel = needsUpdateLayerInfo.some(({ detail }) => detail.needsShareLevelUpdate);
      const newShareLevel = shouldUpdateShareLevel
        ? // ! This assume all items have the same level of access because that's the only use case right now
          items[0].item.access
        : null;
      const shouldUpdateGroup = needsUpdateLayerInfo.some(({ detail }) => detail.needsGroupUpdate) &&
        // people in groups can already see the item shared to org or public
        //  so there is no need to share to groups which can cause noises
        newShareLevel !== "public";
      if (!shouldUpdateShareLevel && !shouldUpdateGroup) {
        // The update button shouldn't even show up if there is nothing to update
        console.warn("Unexpected state: no need to update share level or group");
      }
      else {
        await (0,_services_adddeef9_js__WEBPACK_IMPORTED_MODULE_4__.s)(updatedSourceItems, items.map(({ item }) => item), newShareLevel, portal, shouldUpdateGroup);
      }
      this.isLoading = false;
      this.workflowComplete.emit({ updatedSourceItems, oldSharingDetail: this.sharingDetail });
    };
    this.getStatusInfoForLayerState = (state) => {
      switch (state) {
        case "needEditableLayers":
          return {
            i18nKey: "sharingPDCEnabled",
            kind: "info"
          };
        case "needPubliclyEditableLayers":
        case "needDataCollectionLayers":
          return {
            i18nKey: "pdc",
            kind: "danger",
            link: "https://doc.arcgis.com/en/arcgis-online/manage-data/manage-editing-hfl.htm#ESRI_SECTION2_82D598D7970A4A97923EED07CEB4A6A2"
          };
        case "premiumLayers":
          return {
            i18nKey: "premium",
            kind: "info",
            link: "https://doc.arcgis.com/en/arcgis-online/reference/faq.htm#SHARE_SUBSCR_LYR"
          };
        case "notEditableLayers":
          return { i18nKey: "noPermission", kind: "danger" };
        default:
          return null;
      }
    };
    this.renderPreviewItemNotice = () => {
      const { previewItemState, getStatusInfoForLayerState, i18n } = this;
      const previewItemStatusInfo = previewItemState
        ? getStatusInfoForLayerState(previewItemState)
        : null;
      if (!previewItemStatusInfo) {
        return null;
      }
      const { i18nKey, kind, link } = previewItemStatusInfo;
      const needShareI18N = i18n.needShare;
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { open: true, closable: false, scale: "m", kind: kind, slot: "preview-summary-top", class: "preview-notice" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, needShareI18N[i18nKey].panel), link && i18nKey !== "noPermission" && i18nKey !== "sharingPDCEnabled" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { slot: "link", href: link, target: "_blank", rel: "noopener" }, needShareI18N[i18nKey].learnMore))));
    };
    this.user = undefined;
    this.portal = undefined;
    this.config = undefined;
    this.api = undefined;
    this.isActive = true;
    this.items = undefined;
    this.preProcessedSharingDetail = undefined;
    this.isLoading = undefined;
    this.sharingDetail = undefined;
    this.sections = [];
    this.needsShareLevelUpdateLayers = [];
    this.needEditableLayers = [];
    this.displayItems = [];
    this.previewItemState = null;
    this.loadingText = "loadingInfo";
    this.errorMessage = null;
    this.shareableItemCount = 0;
  }
  async componentWillLoad() {
    this.items = this.items.map((itemInfo) => {
      var _a;
      return (Object.assign(Object.assign({}, itemInfo), { item: (_a = itemInfo.item.sourceJSON) !== null && _a !== void 0 ? _a : itemInfo.item }));
    });
    const { el } = this;
    const locale = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_3__.g)(el);
    this.i18n = locale[0];
  }
  handleNewPreProcessedSharingDetail() {
    var _a;
    (_a = this.itemBrowserRef) === null || _a === void 0 ? void 0 : _a.refresh();
  }
  componentDidLoad() {
    // Data processing will be handled by item browser on load below
  }
  render() {
    const { updateSharing, isActive, api, closeDialog, i18n, isLoading, loadingText, shareableItemCount, errorMessage, portal, user, config, analyzeSharingDetail, getStatusInfoForLayerState, displayItems, renderPreviewItemNotice } = this;
    const canUpdate = shareableItemCount > 0;
    const hasError = !!errorMessage;
    const needShareI18N = i18n.needShare;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { onCalciteModalClose: closeDialog, open: isActive, outsideCloseDisabled: true, escapeDisabled: true }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header", class: "header" }, i18n.updateSharing), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", class: "stage" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-alert", { icon: true, open: hasError, label: errorMessage, kind: "danger", onCalciteAlertClose: () => (this.errorMessage = null) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, errorMessage)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { active: isLoading, text: i18n[loadingText] }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser", { fetch: async () => {
        var _a;
        const displayItems = (_a = (await analyzeSharingDetail())) !== null && _a !== void 0 ? _a : [];
        return {
          total: displayItems.length,
          nextStart: 0,
          num: displayItems.length,
          start: 0,
          results: displayItems.map(({ item }) => item)
        };
      }, onArcgisItemBrowserPreview: ({ detail: previewItem }) => {
        var _a, _b;
        if (!previewItem) {
          this.previewItemState = null;
        }
        this.previewItemState =
          (_b = (_a = displayItems.find(({ item }) => item.id === previewItem.id)) === null || _a === void 0 ? void 0 : _a.state) !== null && _b !== void 0 ? _b : null;
      }, hideContentTop: true, contentPaddedBottom: true, hidePreviewFooters: true, portal: portal, user: user, config: config, selection: "none", api: api, num: 99999, ref: (ele) => (this.itemBrowserRef = ele) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-content", { class: "compact-grid-content", slot: "content" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "top-bar" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "top-notice", innerHTML: i18n[portal.isPortal ? "noticeEnterprise" : "notice"] }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, i18n.canBeShared
      .replace("${count}", shareableItemCount.toString())
      .replace("${total}", displayItems.length.toString()))), displayItems.map(({ item, state }) => {
      const statusInfo = getStatusInfoForLayerState(state);
      const isInfoStatus = (statusInfo === null || statusInfo === void 0 ? void 0 : statusInfo.kind) === "info";
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-card", { key: item.id, item: item, portal: portal, user: user, baseUrl: config.baseUrl, preview: "top", showOwner: true, showDateUpdated: true, showItemType: true, showSummary: true, showBadges: true }, statusInfo && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-top", class: {
          "status-banner": true,
          "status-banner--info": isInfoStatus
        } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: isInfoStatus ? "information" : "exclamationMarkTriangle", scale: "s" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, needShareI18N[statusInfo.i18nKey].notice))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "actions-end", class: "open-item" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { scale: "s", appearance: "transparent", kind: "neutral", onClick: () => window.open((0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_2__.m)(item.id, config.baseUrl), "_blank", "noopener") }, i18n.goToItem))));
    })), renderPreviewItemNotice())), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", appearance: canUpdate ? "outline" : "solid", kind: "brand", "data-id": "cancelButton", onClick: () => (this.isActive = false), width: "full" }, i18n[canUpdate ? "cancel" : "ok"]), canUpdate && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "solid", kind: "brand", "data-id": "nextButton", onClick: updateSharing, width: "full", disabled: isLoading }, i18n.update))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "preProcessedSharingDetail": ["handleNewPreProcessedSharingDetail"]
  }; }
};
ArcgisDependencyCheck.style = arcgisDependencyCheckCss;

const getUserGroups = async ({ items, portal, shareMode, user }) => {
  try {
    const itemOwner = await getItemOwner({ user, items, portal });
    // Useful in case we're admin trying to change the owner's item
    const allUsers = user.username === itemOwner.username ? [user] : [user, itemOwner];
    const userGroupLookup = await queryUserDetails({
      portal,
      user,
      shareMode,
      itemOwner
    });
    const groupResults = await Promise.all(allUsers.map((currentUser) => getAllGroupsForUser({ user: currentUser, portalUser: user, portal, shareMode, userGroupLookup, items })));
    const flattenedGroups = groupResults.flatMap((result) => result.result);
    const groupIds = flattenedGroups.map(({ id }) => id);
    const uniqueGroups = flattenedGroups.filter((group, i) => groupIds.indexOf(group.id) === i);
    return {
      result: {
        uniqueGroups,
        userGroupLookup,
        allUsers,
        searchUsername: user.username === itemOwner.username ? user.username : itemOwner.username
      }
    };
  }
  catch (error) {
    console.error(error);
    return { error: { code: "unhandledError" } };
  }
};
const MAX_GROUP_SEARCH = 100;
/** Fetch the group for the item that the user is also a part of */
const getItemGroups = async (itemIds, userGroupIds, portal) => {
  try {
    const itemGroupResponses = await Promise.all((0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_8__.g)(userGroupIds, MAX_GROUP_SEARCH).map(async (groupIds) => (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.g)(portal)}/content/itemsgroups`, {
      items: itemIds.join(","),
      groups: groupIds.join(",")
    })));
    const result = {};
    itemGroupResponses.forEach((response) => {
      Object.keys(response).forEach((groupId) => {
        const group = response[groupId];
        if (!result[groupId]) {
          result[groupId] = group;
        }
        else {
          result[groupId].items = [...result[groupId].items, ...group.items];
        }
      });
    });
    return { result };
  }
  catch (error) {
    console.error(error);
    return { error: { code: "unhandledError" } };
  }
};
/**
 * Given a user, get all of their groups using the groups search endpoint
 *
 * pseudocode:
 * get the first 100 groups (the max allowed by groups search endpoint)
 * if that accounts for all of a user's groups, return them
 * else, get all the other groups
 * (in parallel batched requests based on response.nextStart)
 * and return them
 */
const getAllGroupsForUser = async ({ user, portalUser, portal, shareMode, userGroupLookup, items }) => {
  var _a;
  const params = {
    q: (0,_utils_fba8960d_js__WEBPACK_IMPORTED_MODULE_5__.a)({
      shareMode,
      currentUsername: portalUser.username,
      user,
      userGroupLookup,
      isPrivate: ((_a = items[0]) === null || _a === void 0 ? void 0 : _a.access) === "private"
    }),
    num: 100,
    searchUserAccess: "groupMember",
    searchUserName: user.username
  };
  try {
    const firstGroupSearchResult = await fetchGroups(portal, params);
    // if nextStart is -1, we've got all the groups.
    if (firstGroupSearchResult.nextStart === -1) {
      return { result: firstGroupSearchResult.results };
    }
    // if not, we'll have to make n more requests
    // we can do these in parallel, and concatenate them with Promise.all()
    const requestsNeeded = Math.ceil(firstGroupSearchResult.total / 100) - 1;
    const groupSearchPromises = [];
    for (let i = 0; i < requestsNeeded; i++) {
      groupSearchPromises.push(new Promise(async (innerResolve) => {
        const start = (i + 1) * 100 + 1;
        const innerResponse = await fetchGroups(portal, Object.assign(Object.assign({}, params), { start }));
        innerResolve(innerResponse.results);
      }));
    }
    const otherGroupSearchResults = (await Promise.all(groupSearchPromises)).flat();
    return { result: [...firstGroupSearchResult.results, ...otherGroupSearchResults] };
  }
  catch (error) {
    console.error(error);
    return { error: { code: "unhandledError" } };
  }
};
const fetchGroups = (portal, params) => (0,_item_d9d70416_js__WEBPACK_IMPORTED_MODULE_6__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.k)(portal)}/community/groups`, portal, {
  body: params,
  usePost: true
});
const getItemOwner = async ({ user, items, portal }) => {
  var _a;
  if ((0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_2__.F)(items, user) &&
    (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_2__.E)({ items, user, portal }) &&
    (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_2__.G)(user)) {
    const firstItem = items[0];
    return (_a = firstItem.itemOwner) !== null && _a !== void 0 ? _a : (await (0,_user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_7__.f)(firstItem.owner, portal));
  }
  return user;
};
const queryUserDetails = async ({ user, portal, shareMode, itemOwner }) => {
  const userDetailResults = await Promise.all([
    (0,_user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_7__.f)(user.username, portal),
    // for admin case, we also fetch the item owner's group
    shareMode === "admin" && itemOwner.username !== user.username ? (0,_user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_7__.f)(itemOwner.username, portal) : null
  ]);
  return Object.assign({ [user.username]: userDetailResults[0].groups }, (!!userDetailResults[1] && { [itemOwner.username]: userDetailResults[1].groups }));
};

const arcgisItemShareGroupCss = ".content{display:flex;justify-content:space-between;align-items:center;margin-top:1rem}.information-text{font-size:0.875rem;margin-top:0;margin-bottom:0}.text-padding{margin-top:0.5rem}";

const ArcgisItemShareGroup = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.editGroupClick = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "editGroupClick", 7);
    this.dirtyChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "dirtyChange", 7);
    this.analyzeUserGroupComplete = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "analyzeUserGroupComplete", 7);
    this.removeClick = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "removeClick", 7);
    this.revertClick = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "revertClick", 7);
    this.hasGroups = false;
    this.user = undefined;
    this.portal = undefined;
    this.config = undefined;
    this.items = undefined;
    this.shareMode = undefined;
    this.isLoading = undefined;
    this.i18n = undefined;
    this.selectedGroupData = [];
    this.initialSelectedGroups = [];
    this.canShareItemToGroup = false;
    this.isDirty = false;
    this.isSharingMixed = false;
  }
  handleSelectedGroupsChange(newList) {
    const { user, initialSelectedGroups, items } = this;
    this.canShareItemToGroup = (0,_utils_fba8960d_js__WEBPACK_IMPORTED_MODULE_5__.k)(newList, user);
    this.isDirty = (0,_utils_fba8960d_js__WEBPACK_IMPORTED_MODULE_5__.i)(newList, initialSelectedGroups);
    this.isSharingMixed = (0,_utils_fba8960d_js__WEBPACK_IMPORTED_MODULE_5__.l)(items, newList);
    this.dirtyChange.emit(this.isDirty);
  }
  async componentDidLoad() {
    const { user, portal, items, shareMode } = this;
    this.isLoading = true;
    // TODO: handle error
    const { result } = await getUserGroups({
      user,
      portal,
      items,
      shareMode
    });
    const { uniqueGroups: userGroups, userGroupLookup, searchUsername, allUsers } = result;
    const { result: itemGroupInfo } = await getItemGroups(items.map((item) => item.id), userGroups.map((group) => group.id), portal);
    const initialGroups = userGroups
      // Find the intersect of the groups that the user is a member of
      //  and the groups that the item is shared to
      .filter(({ id }) => !!itemGroupInfo[id])
      .map((group) => ({
      group,
      selectedByItemIds: items
        .filter(({ id }) => !!itemGroupInfo[group.id].items.find((item) => item.itemId === id))
        .map((item) => item.id)
    }));
    this.hasGroups = userGroups.length > 0;
    this.canShareItemToGroup = (0,_utils_fba8960d_js__WEBPACK_IMPORTED_MODULE_5__.k)(initialGroups, user);
    this.initialSelectedGroups = initialGroups;
    this.isLoading = false;
    this.analyzeUserGroupComplete.emit({
      allUsers,
      initialSelectedGroups: initialGroups,
      userGroupLookup,
      searchUsername
    });
  }
  render() {
    const { i18n, isLoading, canShareItemToGroup, removeClick, revertClick, selectedGroupData, hasGroups, isDirty, isSharingMixed } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: i18n.title, headerSideContent: isDirty ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "transparent", iconStart: "reset", disabled: isLoading, onClick: () => revertClick.emit() }, i18n.revert)) : (selectedGroupData.length > 0 && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "transparent", iconStart: "x", disabled: isLoading, onClick: () => removeClick.emit() }, i18n.remove))) }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "content" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "group-container" }, selectedGroupData.length > 0 ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-thumbnail-stack", { groups: selectedGroupData.map(({ group }) => group) })) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "information-text" }, i18n[hasGroups ? "noneYet" : "noGroup"]))), hasGroups && canShareItemToGroup && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { iconStart: "group", appearance: "outline-fill", disabled: isLoading, onClick: () => this.editGroupClick.emit() }, i18n.edit))), !isLoading && isSharingMixed && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "information-text text-padding" }, i18n.mixedGroupSharing))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "selectedGroupData": ["handleSelectedGroupsChange"]
  }; }
};
ArcgisItemShareGroup.style = arcgisItemShareGroupCss;

const arcgisItemShareGroupCardCss = ":host{display:contents}";

const ArcgisItemShareGroupCard = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.revertClick = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "revertClick", 7);
    this.user = undefined;
    this.portal = undefined;
    this.group = undefined;
    this.groupCount = undefined;
    this.initialSelectedGroupDataLookup = undefined;
    this.selectedGroupDataLookup = undefined;
    this.totalItemCount = undefined;
    this.i18n = undefined;
  }
  render() {
    const { group, groupCount, totalItemCount, initialSelectedGroupDataLookup, selectedGroupDataLookup, revertClick, portal, user, i18n } = this;
    const totalItemCountStr = totalItemCount.toString();
    const groupId = group.id;
    const curGroupCount = groupCount[group.id];
    let selectionType = "none";
    switch (true) {
      case curGroupCount < totalItemCount:
        selectionType = "indeterminate";
        break;
      case curGroupCount === totalItemCount:
        selectionType = "all";
        break;
    }
    const initialSelectionType = initialSelectedGroupDataLookup[groupId];
    /**
     * We can't just do initialSelectionType !== selectionType because
     *  initialSelectionType can be undefined if a group is not selected initially
     *  since we construct `initialSelectedGroupDataLookup` based on the pre-selected group
     *  and don't have the knowledge about other groups since they're from the API
     * So it will still show the revert button even if the group is not selected initially and selectionType === "none"
     *  without that condition
     */
    const isGroupSelectionChanged = (!!initialSelectionType || selectionType !== "none") &&
      initialSelectionType !== selectionType;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-card", { group: group, portal: portal, user: user, name: group.title, selected: !!selectedGroupDataLookup[groupId], indeterminate: selectionType === "indeterminate", selection: "multiple", preview: "action", view: "compact", showOwner: true, showDateUpdated: true, showSummary: true, key: groupId }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { slot: "content-end" }, curGroupCount && curGroupCount > 0 && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "group-item-counter" }, i18n[isGroupSelectionChanged ? "willShareCountHint" : "sharedCountHint"]
      .replace("${numItem}", curGroupCount.toLocaleString())
      .replace("${totalItem}", totalItemCountStr))), isGroupSelectionChanged && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: "revert-single-group-cta", appearance: "transparent", onClick: (event) => {
        event.stopPropagation();
        revertClick.emit();
      } }, i18n.revert)))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemShareGroupCard.style = arcgisItemShareGroupCardCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getSignedInUsersGroups),
/* harmony export */   b: () => (/* binding */ getSignedInUsersFavoritesGroup),
/* harmony export */   c: () => (/* binding */ createFolder),
/* harmony export */   d: () => (/* binding */ getFolderFromId),
/* harmony export */   e: () => (/* binding */ getHomeFolderForUser),
/* harmony export */   f: () => (/* binding */ fetchUser),
/* harmony export */   g: () => (/* binding */ getFolders)
/* harmony export */ });
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



async function fetchUser(username, portal) {
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/community/users/${username}`);
}
async function fetchSelf() {
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)()}/community/self`);
}
async function getSignedInUsersGroups() {
  var _a;
  const user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
  if (!user) {
    return [];
  }
  const self = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => fetchSelf(), "communitySelf", user.username);
  return (_a = self === null || self === void 0 ? void 0 : self.groups) !== null && _a !== void 0 ? _a : [];
}
async function getSignedInUsersFavoritesGroup() {
  const user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
  if (!user) {
    return null;
  }
  const self = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => fetchSelf(), "communitySelf", user.username);
  return self.favGroupId;
}
async function getUserContent(portalUser) {
  var _a, _b;
  const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
  const portal = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal;
  (_b = user.userContentUrl) !== null && _b !== void 0 ? _b : (user.userContentUrl = (portal === null || portal === void 0 ? void 0 : portal.restUrl) + "/content/users/" + portalUser.username);
  const response = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(user.userContentUrl, { num: 1 });
  return Promise.resolve(response);
}
async function getFolders(portalUser) {
  var _a;
  const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
  const { folders } = await getUserContent(user);
  const { username } = user;
  // add the home folder as if it's in the list
  return [{ username, id: username, title: username, created: "now" }, ...folders];
}
async function getFolderFromId(folderId, portalUser) {
  var _a;
  const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
  const folders = await getFolders(user);
  return folders.find((folder) => folder.id === folderId);
}
function getHomeFolderForUser(username) {
  return { username, id: username, title: username, created: "now" };
}
async function createFolder(folderName, portalUser) {
  var _a;
  const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
  const url = `${user.userContentUrl}/createFolder`;
  const folderResponse = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { title: folderName }, {}, "post");
  return folderResponse;
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWY4MWMyZi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzZHO0FBQ1E7QUFDaUM7QUFDaEY7QUFDNEQ7QUFDYTtBQUN4RjtBQUNIO0FBQ0U7QUFDbkI7QUFDTDtBQUNEO0FBQ0Y7QUFDUztBQUNEO0FBQ0k7QUFDUDtBQUNOO0FBQ1E7QUFDQTs7QUFFbEMseUNBQXlDLFlBQVksZ0JBQWdCLDBCQUEwQixzQ0FBc0MsT0FBTyx5QkFBeUIsY0FBYyxrQ0FBa0MsNkJBQTZCLFNBQVMsZ0JBQWdCLG1CQUFtQixzQkFBc0Isa0JBQWtCLG1CQUFtQixtQkFBbUIsc0NBQXNDLFNBQVMsZUFBZSxpQkFBaUIsWUFBWSx1QkFBdUIsc0JBQXNCLG1EQUFtRCxXQUFXLDZCQUE2Qiw0QkFBNEIsMERBQTBELHlEQUF5RCw4QkFBOEIsNkJBQTZCLGVBQWUsYUFBYSxtQkFBbUIsa0JBQWtCLG1CQUFtQixvQkFBb0IsdUJBQXVCLGtCQUFrQixtREFBbUQsNEJBQTRCLCtCQUErQiwwQkFBMEIseUJBQXlCLG9CQUFvQixlQUFlLGtDQUFrQyw2QkFBNkIsc0JBQXNCLDZDQUE2QyxnQkFBZ0IsbUJBQW1COztBQUVueEM7QUFDQTtBQUNBLElBQUkscURBQWdCO0FBQ3BCLDBCQUEwQixxREFBVztBQUNyQyw0QkFBNEIscURBQVc7QUFDdkM7QUFDQSxZQUFZLGlFQUFpRTtBQUM3RTtBQUNBO0FBQ0E7QUFDQSw4REFBOEQsc0JBQXNCLEtBQUssd0RBQW9CO0FBQzdHLFVBQVUsNkJBQTZCO0FBQ3ZDLFFBQVEsb0RBQXlCLG1CQUFtQixzREFBVTtBQUM5RCx1REFBdUQsZUFBZTtBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsZ0JBQWdCO0FBQzlCLHNEQUFzRCxRQUFRLHFGQUFxRjtBQUNuSjtBQUNBO0FBQ0E7QUFDQSxjQUFjLGtEQUFrRDtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsb0NBQW9DO0FBQ3pELFNBQVM7QUFDVDtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsaUVBQWlFO0FBQy9FO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RCxZQUFZO0FBQ3pFLGtFQUFrRSxRQUFRO0FBQzFFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZELFFBQVE7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsd0RBQXdCLGtDQUFrQyxNQUFNO0FBQzlFO0FBQ0E7QUFDQSxtQ0FBbUMsMERBQTBEO0FBQzdGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLHFEQUFxRDtBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLHNCQUFzQjtBQUNwQztBQUNBLGNBQWMscURBQUMscUJBQXFCLDJHQUEyRyxFQUFFLHFEQUFDLFVBQVUsaUJBQWlCLDJHQUEyRyxxREFBQyxtQkFBbUIsNkRBQTZEO0FBQ3pXO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLGVBQWUsc0ZBQXNGO0FBQ2pKLEtBQUs7QUFDTCxZQUFZLEtBQUs7QUFDakIseUJBQXlCLHNEQUF5QjtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksMk5BQTJOO0FBQ3ZPO0FBQ0E7QUFDQTtBQUNBLFlBQVkscURBQUMsb0JBQW9CLG9HQUFvRyxFQUFFLHFEQUFDLFVBQVUsaUNBQWlDLHVCQUF1QixxREFBQyxVQUFVLGlDQUFpQyxFQUFFLHFEQUFDLG9CQUFvQix3SEFBd0gsRUFBRSxxREFBQyxVQUFVLGlCQUFpQixrQkFBa0IscURBQUMsNkJBQTZCLDRDQUE0QyxHQUFHLHFEQUFDLDBCQUEwQjtBQUM3aEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsTUFBTTtBQUM3QztBQUNBLE9BQU8saUNBQWlDLHFCQUFxQjtBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLE1BQU07QUFDakQsT0FBTyw2TUFBNk0sRUFBRSxxREFBQyxrQ0FBa0MsZ0RBQWdELEVBQUUscURBQUMsVUFBVSxrQkFBa0IsRUFBRSxxREFBQyxVQUFVLHVGQUF1RixHQUFHLHFEQUFDO0FBQ2hiLGtCQUFrQixNQUFNO0FBQ3hCLGtCQUFrQixNQUFNLDBEQUEwRCxhQUFhO0FBQy9GO0FBQ0E7QUFDQSxjQUFjLHFEQUFDLCtCQUErQixnTUFBZ00saUJBQWlCLHFEQUFDLFVBQVU7QUFDMVE7QUFDQTtBQUNBLFdBQVcsRUFBRSxxREFBQyxtQkFBbUIsNEVBQTRFLEdBQUcscURBQUMsNERBQTRELHFEQUFDLFVBQVUseUNBQXlDLEVBQUUscURBQUMscUJBQXFCLG1GQUFtRiwwREFBaUIsa0RBQWtEO0FBQy9ZLEtBQUssaUNBQWlDLHFEQUFDLHFCQUFxQiwrSkFBK0osb0RBQW9ELHFEQUFDLHFCQUFxQiw0SUFBNEk7QUFDamI7QUFDQSxhQUFhLE9BQU8scURBQVU7QUFDOUIsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBOztBQUVBLCtCQUErQixnQ0FBZ0M7QUFDL0Q7QUFDQSwyQ0FBMkMscUJBQXFCO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLCtGQUErRixnRkFBZ0Y7QUFDL0s7QUFDQSw0Q0FBNEMsSUFBSTtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLFNBQVM7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELDBEQUFLLHlEQUF5RCxzREFBTyxJQUFJLHNEQUFjLFNBQVM7QUFDako7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0wsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWEsU0FBUztBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsNkRBQTZEO0FBQ2xHO0FBQ0E7QUFDQSxPQUFPLHFEQUFnQjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixvQkFBb0I7QUFDeEM7QUFDQTtBQUNBLHNGQUFzRixhQUFhLE9BQU87QUFDMUc7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhLFNBQVM7QUFDdEI7QUFDQTtBQUNBLHdDQUF3QyxvREFBWSxJQUFJLHNEQUFvQixTQUFTO0FBQ3JGO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsOEJBQThCLHFCQUFxQjtBQUNuRDtBQUNBLE1BQU0sMERBQW9CO0FBQzFCLElBQUksMERBQXNCLEdBQUcscUJBQXFCO0FBQ2xELElBQUksMERBQXFCO0FBQ3pCO0FBQ0EsOEVBQThFLG9EQUFTO0FBQ3ZGO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxvQ0FBb0M7QUFDdEU7QUFDQSxJQUFJLG9EQUFTO0FBQ2I7QUFDQSxvRUFBb0Usb0RBQVM7QUFDN0U7QUFDQSx5QkFBeUIsOENBQThDLCtCQUErQixtREFBbUQ7QUFDeko7O0FBRUEsMENBQTBDLGFBQWEsOEJBQThCLG1CQUFtQixnQkFBZ0Isa0JBQWtCLG1CQUFtQixhQUFhLGdCQUFnQixjQUFjLGtCQUFrQjs7QUFFMU47QUFDQTtBQUNBLElBQUkscURBQWdCO0FBQ3BCLDBCQUEwQixxREFBVztBQUNyQyx1QkFBdUIscURBQVc7QUFDbEMsb0NBQW9DLHFEQUFXO0FBQy9DLHVCQUF1QixxREFBVztBQUNsQyx1QkFBdUIscURBQVc7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxxQ0FBcUM7QUFDakQsK0JBQStCLHFEQUFtQjtBQUNsRCxtQkFBbUIscURBQXdCO0FBQzNDLDBCQUEwQixxREFBbUI7QUFDN0M7QUFDQTtBQUNBO0FBQ0EsWUFBWSxpQ0FBaUM7QUFDN0M7QUFDQTtBQUNBLFlBQVksU0FBUztBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZLHNFQUFzRTtBQUNsRixZQUFZLHdCQUF3QjtBQUNwQztBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsSUFBSTtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsSUFBSTtBQUN2QjtBQUNBLEtBQUs7QUFDTDtBQUNBLCtCQUErQixxREFBbUI7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVksd0hBQXdIO0FBQ3BJLFlBQVkscURBQUMsQ0FBQyxpREFBSSxRQUFRLHFEQUFDLGtDQUFrQyxrREFBa0QscURBQUMscUJBQXFCLHVHQUF1RyxvREFBb0QscURBQUMscUJBQXFCLG1HQUFtRyxrQkFBa0IsR0FBRyxxREFBQyxVQUFVLGtCQUFrQixFQUFFLHFEQUFDLFVBQVUsMEJBQTBCLGtDQUFrQyxxREFBQyxtQ0FBbUMsaUNBQWlDLE9BQU8sYUFBYSxNQUFNLHFEQUFDLFFBQVEsMkJBQTJCLG1GQUFtRixxREFBQyxxQkFBcUIsZ0hBQWdILGlEQUFpRCxxREFBQyxRQUFRLHdDQUF3QztBQUNsOUI7QUFDQSxhQUFhLE9BQU8scURBQVU7QUFDOUIsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDJDQUEyQyxpQkFBaUI7O0FBRTVEO0FBQ0E7QUFDQSxJQUFJLHFEQUFnQjtBQUNwQix1QkFBdUIscURBQVc7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDhIQUE4SDtBQUMxSTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxxREFBQyx3QkFBd0IsaVNBQWlTLEVBQUUscURBQUMsV0FBVyxxQkFBcUIseUNBQXlDLHFEQUFDLFdBQVcsNkJBQTZCO0FBQzNiLGtCQUFrQixRQUFRO0FBQzFCLGtCQUFrQixVQUFVLHFEQUFxRCxxREFBQyxxQkFBcUI7QUFDdkc7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLGFBQWEsT0FBTyxxREFBVTtBQUM5QjtBQUNBOztBQUV1Szs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUMvZHZLO0FBQ0E7QUFDQTtBQUNBO0FBQ3lGO0FBQ2pDOztBQUV4RDtBQUNBLFNBQVMsc0RBQU8sSUFBSSxzREFBYyxTQUFTLG1CQUFtQixTQUFTO0FBQ3ZFO0FBQ0E7QUFDQSxTQUFTLHNEQUFPLElBQUksc0RBQWMsR0FBRztBQUNyQztBQUNBO0FBQ0E7QUFDQSxlQUFlLGtEQUFXLGFBQWEsa0RBQVcsdUJBQXVCLGtEQUFXO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixzREFBUztBQUM5QjtBQUNBO0FBQ0E7QUFDQSxlQUFlLGtEQUFXLGFBQWEsa0RBQVcsdUJBQXVCLGtEQUFXO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixzREFBUztBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlGQUFpRixrREFBVyx3Q0FBd0Msa0RBQVc7QUFDL0ksaUJBQWlCLGtEQUFXO0FBQzVCO0FBQ0EseUJBQXlCLHNEQUFPLHdCQUF3QixRQUFRO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUZBQWlGLGtEQUFXLHdDQUF3QyxrREFBVztBQUMvSSxVQUFVLFVBQVU7QUFDcEIsVUFBVSxXQUFXO0FBQ3JCO0FBQ0EsWUFBWSx5REFBeUQ7QUFDckU7QUFDQTtBQUNBO0FBQ0EsaUZBQWlGLGtEQUFXLHdDQUF3QyxrREFBVztBQUMvSTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxpRkFBaUYsa0RBQVcsd0NBQXdDLGtEQUFXO0FBQy9JLGlCQUFpQixvQkFBb0I7QUFDckMsK0JBQStCLHNEQUFPLFFBQVEsbUJBQW1CLElBQUk7QUFDckU7QUFDQTs7QUFFaUwiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtZGVwZW5kZW5jeS1jaGVja18zLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3VzZXItZTNkZWRjNGEuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIGQgYXMgZ2V0RWxlbWVudCwgSCBhcyBIb3N0IH0gZnJvbSAnLi9pbmRleC05MmViYjM5Ni5qcyc7XG5pbXBvcnQgeyBjIGFzIGNsZWFyQ2FjaGUsIHIgYXMgcmVxdWVzdCwgZyBhcyBnZXRSZXN0QmFzZVVybCwgayBhcyBnZXRQb3J0YWxSZXN0QmFzZVVybCB9IGZyb20gJy4vcG9ydGFsLTc5Y2FhZWZmLmpzJztcbmltcG9ydCB7IG0gYXMgZ2V0SXRlbUhvbWVBcHBVcmwsIEYgYXMgaXRlbXNCZWxvbmdUb1VzZXJPcmcsIEUgYXMgaGFzQWRtaW5TaGFyZVByaXZpbGVnZSwgRyBhcyBjYW5WaWV3T3RoZXJzT3JnSXRlbXMgfSBmcm9tICcuL3ByaXZpbGVnZXMtY2NkNWYzN2QuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIH0gZnJvbSAnLi9sb2NhbGUtMTNlMDBhNzUuanMnO1xuaW1wb3J0IHsgYSBhcyBhbmFseXplU2hhcmluZ0RldGFpbCwgZSBhcyBkZXBlbmRlbmN5Q2hlY2tDYWNoZVR5cGVzLCBzIGFzIHNoYXJlSXRlbXNUb1NoYXJlZEdyb3VwcyB9IGZyb20gJy4vc2VydmljZXMtYWRkZGVlZjkuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRVc2VybmFtZVF1ZXJ5LCBrIGFzIGNhblNoYXJlSXRlbVRvR3JvdXAsIGkgYXMgaXNTZWxlY3RlZEdyb3VwRGF0YURpcnR5LCBsIGFzIGNoZWNrSWZTaGFyaW5nTWl4ZWQgfSBmcm9tICcuL3V0aWxzLWZiYTg5NjBkLmpzJztcbmltcG9ydCB7IHIgYXMgcmVxdWVzdEZldGNoIH0gZnJvbSAnLi9pdGVtLWQ5ZDcwNDE2LmpzJztcbmltcG9ydCB7IGYgYXMgZmV0Y2hVc2VyIH0gZnJvbSAnLi91c2VyLWUzZGVkYzRhLmpzJztcbmltcG9ydCB7IGcgYXMgY2h1bmsgfSBmcm9tICcuL2Z1bmN0aW9uYWwtYzgyZjVhYjkuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWFhZjMwYmQ2LmpzJztcbmltcG9ydCAnLi9jb25maWctZWI1ZjdkYzIuanMnO1xuaW1wb3J0ICcuL2luZGV4LTgxZDU0OGI3LmpzJztcbmltcG9ydCAnLi9kb20tMTNmNWIwMGMuanMnO1xuaW1wb3J0ICcuL2xhbmd1YWdlVXRpbC0yMjI1OGM5MC5qcyc7XG5pbXBvcnQgJy4vc2VydmVyLWl0ZW0tZjEyMTUzZTYuanMnO1xuaW1wb3J0ICcuL2l0ZW0tcHJvcGVydGllcy1lNjQxMmE5YS5qcyc7XG5pbXBvcnQgJy4vYWRkLWl0ZW0tOTdkNTc3YTkuanMnO1xuaW1wb3J0ICcuL3VpLWVjZjg2YmJhLmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTlmNjQ4YmVlLmpzJztcbmltcG9ydCAnLi9pdGVtLXR5cGVzLWI0ZmU4NmFkLmpzJztcblxuY29uc3QgYXJjZ2lzRGVwZW5kZW5jeUNoZWNrQ3NzID0gXCIuc3RhZ2V7aGVpZ2h0OjEwMCU7b3ZlcmZsb3c6aGlkZGVuO3RyYW5zZm9ybTp0cmFuc2xhdGUoMCwgMCl9QG1lZGlhIHNjcmVlbiBhbmQgKG1pbi13aWR0aDogMTA4MHB4KXsuc3RhZ2V7aGVpZ2h0Om1pbig3MDBweCwgNjB2aCl9fWNhbGNpdGUtbW9kYWx7LS1jYWxjaXRlLW1vZGFsLWNvbnRlbnQtcGFkZGluZzowOy0tY2FsY2l0ZS1tb2RhbC13aWR0aDoxMDgwcHh9LnRvcC1iYXJ7Zm9udC13ZWlnaHQ6NTAwO3BhZGRpbmctdG9wOjEuNXJlbTtwYWRkaW5nLWJvdHRvbTowLjVyZW07cGFkZGluZy1sZWZ0OjFyZW07cGFkZGluZy1yaWdodDoxcmVtO2ZvbnQtc2l6ZTowLjg3NXJlbX1AbWVkaWEgc2NyZWVuIGFuZCAobWluLXdpZHRoOiAxMDgwcHgpey50b3AtYmFye3BhZGRpbmctbGVmdDowO3BhZGRpbmctcmlnaHQ6MH19LnRvcC1ub3RpY2V7cGFkZGluZy1ib3R0b206MC43NXJlbTttYXJnaW4tYm90dG9tOjAuNzVyZW07Ym9yZGVyLWJvdHRvbToxcHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1ib3JkZXItMSl9Lm9wZW4taXRlbXstd2Via2l0LW1hcmdpbi1zdGFydDowLjI1cmVtO21hcmdpbi1pbmxpbmUtc3RhcnQ6MC4yNXJlbTstd2Via2l0LWJvcmRlci1zdGFydDoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1ib3JkZXItMSk7Ym9yZGVyLWlubGluZS1zdGFydDoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1ib3JkZXItMSk7LXdlYmtpdC1wYWRkaW5nLXN0YXJ0OjAuMjVyZW07cGFkZGluZy1pbmxpbmUtc3RhcnQ6MC4yNXJlbX0uc3RhdHVzLWJhbm5lcntkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO3BhZGRpbmctbGVmdDoxcmVtO3BhZGRpbmctcmlnaHQ6MXJlbTtwYWRkaW5nLXRvcDowLjI1cmVtO3BhZGRpbmctYm90dG9tOjAuMjVyZW07Zm9udC1zaXplOjAuNzVyZW07Ym9yZGVyLWJvdHRvbToxcHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1ib3JkZXItMil9LnN0YXR1cy1iYW5uZXI+Y2FsY2l0ZS1pY29ue2NvbG9yOnZhcigtLWNhbGNpdGUtdWktZGFuZ2VyKTstd2Via2l0LW1hcmdpbi1lbmQ6MC41cmVtO21hcmdpbi1pbmxpbmUtZW5kOjAuNXJlbX0uc3RhdHVzLWJhbm5lcj5zcGFue21hcmdpbi10b3A6MnB4fS5zdGF0dXMtYmFubmVyLS1pbmZvPmNhbGNpdGUtaWNvbntjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWluZm8pfS5jb21wYWN0LWdyaWQtY29udGVudHstLWFyY2dpcy1pdGVtLWJyb3dzZXItY29udGVudC1zcGFjaW5nOjAuNXJlbX0ucHJldmlldy1ub3RpY2V7bWFyZ2luLWJvdHRvbToxcmVtfVwiO1xuXG5jb25zdCBBcmNnaXNEZXBlbmRlbmN5Q2hlY2sgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMud29ya2Zsb3dDYW5jZWwgPSBjcmVhdGVFdmVudCh0aGlzLCBcIndvcmtmbG93Q2FuY2VsXCIsIDcpO1xuICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwid29ya2Zsb3dDb21wbGV0ZVwiLCA3KTtcbiAgICB0aGlzLmFuYWx5emVTaGFyaW5nRGV0YWlsID0gYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHsgcHJlUHJvY2Vzc2VkU2hhcmluZ0RldGFpbDogbmV3U2hhcmVEZXRhaWwsIGl0ZW1zLCBwb3J0YWwsIGkxOG4gfSA9IHRoaXM7XG4gICAgICB0aGlzLmxvYWRpbmdUZXh0ID0gXCJsb2FkaW5nSW5mb1wiO1xuICAgICAgbGV0IGVycm9yQ29kZTtcbiAgICAgIGlmICghdGhpcy5wcmVQcm9jZXNzZWRTaGFyaW5nRGV0YWlsKSB7XG4gICAgICAgIGNvbnN0IGFuYWx5emVSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoaXRlbXMubWFwKCh7IGl0ZW0sIG92ZXJyaWRlTGF5ZXJzIH0pID0+IGFuYWx5emVTaGFyaW5nRGV0YWlsKGl0ZW0sIHBvcnRhbCwgb3ZlcnJpZGVMYXllcnMsIC8vIFRPRE86IHJlbW92ZSB0aGlzIGFzc2VydGlvbiB3aGVuIHdlIGhhdmUgYSBwcm9wZXIgdHlwZSBmb3IgbGF5ZXJUeXBlXG4gICAgICAgIHsgY2xlYXJEYXRhQ2FjaGVPbkRvbmU6IGZhbHNlIH0pKSk7XG4gICAgICAgIGRlcGVuZGVuY3lDaGVja0NhY2hlVHlwZXMuZm9yRWFjaCgodHlwZSkgPT4gY2xlYXJDYWNoZSh0eXBlKSk7XG4gICAgICAgIG5ld1NoYXJlRGV0YWlsID0gYW5hbHl6ZVJlc3VsdHMucmVkdWNlKChhY2MsIHsgZXJyb3IsIHJlc3VsdCB9KSA9PiB7XG4gICAgICAgICAgLy8gVE9ETzogaGFpciBzcGxpdHRpbmcgdGhpcyBtYXliZVxuICAgICAgICAgIGVycm9yQ29kZSA9IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5jb2RlO1xuICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKHJlc3VsdCkuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgICAgICAgIGFjY1trZXldID0gWy4uLmFjY1trZXldLCAuLi5yZXN1bHRba2V5XV07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgfSwge1xuICAgICAgICAgIG5lZWRFZGl0YWJsZUxheWVyczogW10sXG4gICAgICAgICAgbmVlZFB1YmxpY2x5RWRpdGFibGVMYXllcnM6IFtdLFxuICAgICAgICAgIG5lZWREYXRhQ29sbGVjdGlvbkxheWVyczogW10sXG4gICAgICAgICAgbmVlZHNTaGFyZUxldmVsVXBkYXRlTGF5ZXJzOiBbXSxcbiAgICAgICAgICBwcmVtaXVtTGF5ZXJzOiBbXSxcbiAgICAgICAgICBub3RFZGl0YWJsZUxheWVyczogW11cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLnNoYXJpbmdEZXRhaWwgPSBuZXdTaGFyZURldGFpbDtcbiAgICAgIGlmICghdGhpcy5zaGFyaW5nRGV0YWlsIHx8IGVycm9yQ29kZSA9PT0gXCJkYXRhTm90QXZhaWxhYmxlXCIpIHtcbiAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBpMThuLnVuYWJsZVRvR2V0SXRlbTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyQW5kR2V0U2hhcmluZ0RldGFpbHMoKTtcbiAgICB9O1xuICAgIHRoaXMuZmlsdGVyQW5kR2V0U2hhcmluZ0RldGFpbHMgPSAoKSA9PiB7XG4gICAgICBjb25zdCB7IHNoYXJpbmdEZXRhaWwgfSA9IHRoaXM7XG4gICAgICBpZiAoT2JqZWN0LmtleXMoc2hhcmluZ0RldGFpbCkuZXZlcnkoKGtleSkgPT4geyB2YXIgX2E7IHJldHVybiAhKChfYSA9IHNoYXJpbmdEZXRhaWxba2V5XSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCk7IH0pKSB7XG4gICAgICAgIC8vIE5vIGVycm9yIHRvIHNob3dcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBuZWVkRWRpdGFibGVMYXllcnMsIG5lZWRzU2hhcmVMZXZlbFVwZGF0ZUxheWVycyB9ID0gc2hhcmluZ0RldGFpbDtcbiAgICAgIHRoaXMubmVlZHNTaGFyZUxldmVsVXBkYXRlTGF5ZXJzID0gbmVlZHNTaGFyZUxldmVsVXBkYXRlTGF5ZXJzO1xuICAgICAgdGhpcy5uZWVkRWRpdGFibGVMYXllcnMgPSBuZWVkRWRpdGFibGVMYXllcnM7XG4gICAgICB0aGlzLnNoYXJlYWJsZUl0ZW1Db3VudCA9IFsuLi5uZWVkc1NoYXJlTGV2ZWxVcGRhdGVMYXllcnMsIC4uLm5lZWRFZGl0YWJsZUxheWVyc10ubGVuZ3RoO1xuICAgICAgY29uc3QgZGlzcGxheUl0ZW1zID0gT2JqZWN0LmtleXMoc2hhcmluZ0RldGFpbCkucmVkdWNlKChhY2MsIGtleSkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHNoYXJpbmdEZXRhaWxba2V5XSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKGxheWVyKSA9PiB7XG4gICAgICAgICAgYWNjLnB1c2goeyBpdGVtOiBsYXllci5zb3VyY2VJdGVtLCBzdGF0ZToga2V5IH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH0sIFtdKTtcbiAgICAgIHRoaXMuZGlzcGxheUl0ZW1zID0gZGlzcGxheUl0ZW1zO1xuICAgICAgcmV0dXJuIGRpc3BsYXlJdGVtcztcbiAgICB9O1xuICAgIHRoaXMuY2xvc2VEaWFsb2cgPSAoKSA9PiB7XG4gICAgICB0aGlzLndvcmtmbG93Q2FuY2VsLmVtaXQoKTtcbiAgICB9O1xuICAgIHRoaXMudXBkYXRlU2hhcmluZyA9IGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHsgbmVlZHNTaGFyZUxldmVsVXBkYXRlTGF5ZXJzLCBuZWVkRWRpdGFibGVMYXllcnMsIHBvcnRhbCwgaXRlbXMgfSA9IHRoaXM7XG4gICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgICB0aGlzLmxvYWRpbmdUZXh0ID0gXCJ1cGRhdGluZ1NoYXJpbmdcIjtcbiAgICAgIGNvbnN0IG5lZWRzVXBkYXRlTGF5ZXJJbmZvID0gWy4uLm5lZWRzU2hhcmVMZXZlbFVwZGF0ZUxheWVycywgLi4ubmVlZEVkaXRhYmxlTGF5ZXJzXTtcbiAgICAgIGNvbnN0IHVwZGF0ZWRTb3VyY2VJdGVtcyA9IG5lZWRzVXBkYXRlTGF5ZXJJbmZvLm1hcCgoeyBzb3VyY2VJdGVtIH0pID0+IHNvdXJjZUl0ZW0pO1xuICAgICAgY29uc3Qgc2hvdWxkVXBkYXRlU2hhcmVMZXZlbCA9IG5lZWRzVXBkYXRlTGF5ZXJJbmZvLnNvbWUoKHsgZGV0YWlsIH0pID0+IGRldGFpbC5uZWVkc1NoYXJlTGV2ZWxVcGRhdGUpO1xuICAgICAgY29uc3QgbmV3U2hhcmVMZXZlbCA9IHNob3VsZFVwZGF0ZVNoYXJlTGV2ZWxcbiAgICAgICAgPyAvLyAhIFRoaXMgYXNzdW1lIGFsbCBpdGVtcyBoYXZlIHRoZSBzYW1lIGxldmVsIG9mIGFjY2VzcyBiZWNhdXNlIHRoYXQncyB0aGUgb25seSB1c2UgY2FzZSByaWdodCBub3dcbiAgICAgICAgICBpdGVtc1swXS5pdGVtLmFjY2Vzc1xuICAgICAgICA6IG51bGw7XG4gICAgICBjb25zdCBzaG91bGRVcGRhdGVHcm91cCA9IG5lZWRzVXBkYXRlTGF5ZXJJbmZvLnNvbWUoKHsgZGV0YWlsIH0pID0+IGRldGFpbC5uZWVkc0dyb3VwVXBkYXRlKSAmJlxuICAgICAgICAvLyBwZW9wbGUgaW4gZ3JvdXBzIGNhbiBhbHJlYWR5IHNlZSB0aGUgaXRlbSBzaGFyZWQgdG8gb3JnIG9yIHB1YmxpY1xuICAgICAgICAvLyAgc28gdGhlcmUgaXMgbm8gbmVlZCB0byBzaGFyZSB0byBncm91cHMgd2hpY2ggY2FuIGNhdXNlIG5vaXNlc1xuICAgICAgICBuZXdTaGFyZUxldmVsICE9PSBcInB1YmxpY1wiO1xuICAgICAgaWYgKCFzaG91bGRVcGRhdGVTaGFyZUxldmVsICYmICFzaG91bGRVcGRhdGVHcm91cCkge1xuICAgICAgICAvLyBUaGUgdXBkYXRlIGJ1dHRvbiBzaG91bGRuJ3QgZXZlbiBzaG93IHVwIGlmIHRoZXJlIGlzIG5vdGhpbmcgdG8gdXBkYXRlXG4gICAgICAgIGNvbnNvbGUud2FybihcIlVuZXhwZWN0ZWQgc3RhdGU6IG5vIG5lZWQgdG8gdXBkYXRlIHNoYXJlIGxldmVsIG9yIGdyb3VwXCIpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGF3YWl0IHNoYXJlSXRlbXNUb1NoYXJlZEdyb3Vwcyh1cGRhdGVkU291cmNlSXRlbXMsIGl0ZW1zLm1hcCgoeyBpdGVtIH0pID0+IGl0ZW0pLCBuZXdTaGFyZUxldmVsLCBwb3J0YWwsIHNob3VsZFVwZGF0ZUdyb3VwKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUuZW1pdCh7IHVwZGF0ZWRTb3VyY2VJdGVtcywgb2xkU2hhcmluZ0RldGFpbDogdGhpcy5zaGFyaW5nRGV0YWlsIH0pO1xuICAgIH07XG4gICAgdGhpcy5nZXRTdGF0dXNJbmZvRm9yTGF5ZXJTdGF0ZSA9IChzdGF0ZSkgPT4ge1xuICAgICAgc3dpdGNoIChzdGF0ZSkge1xuICAgICAgICBjYXNlIFwibmVlZEVkaXRhYmxlTGF5ZXJzXCI6XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGkxOG5LZXk6IFwic2hhcmluZ1BEQ0VuYWJsZWRcIixcbiAgICAgICAgICAgIGtpbmQ6IFwiaW5mb1wiXG4gICAgICAgICAgfTtcbiAgICAgICAgY2FzZSBcIm5lZWRQdWJsaWNseUVkaXRhYmxlTGF5ZXJzXCI6XG4gICAgICAgIGNhc2UgXCJuZWVkRGF0YUNvbGxlY3Rpb25MYXllcnNcIjpcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaTE4bktleTogXCJwZGNcIixcbiAgICAgICAgICAgIGtpbmQ6IFwiZGFuZ2VyXCIsXG4gICAgICAgICAgICBsaW5rOiBcImh0dHBzOi8vZG9jLmFyY2dpcy5jb20vZW4vYXJjZ2lzLW9ubGluZS9tYW5hZ2UtZGF0YS9tYW5hZ2UtZWRpdGluZy1oZmwuaHRtI0VTUklfU0VDVElPTjJfODJENTk4RDc5NzBBNEE5NzkyM0VFRDA3Q0VCNEE2QTJcIlxuICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgXCJwcmVtaXVtTGF5ZXJzXCI6XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGkxOG5LZXk6IFwicHJlbWl1bVwiLFxuICAgICAgICAgICAga2luZDogXCJpbmZvXCIsXG4gICAgICAgICAgICBsaW5rOiBcImh0dHBzOi8vZG9jLmFyY2dpcy5jb20vZW4vYXJjZ2lzLW9ubGluZS9yZWZlcmVuY2UvZmFxLmh0bSNTSEFSRV9TVUJTQ1JfTFlSXCJcbiAgICAgICAgICB9O1xuICAgICAgICBjYXNlIFwibm90RWRpdGFibGVMYXllcnNcIjpcbiAgICAgICAgICByZXR1cm4geyBpMThuS2V5OiBcIm5vUGVybWlzc2lvblwiLCBraW5kOiBcImRhbmdlclwiIH07XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLnJlbmRlclByZXZpZXdJdGVtTm90aWNlID0gKCkgPT4ge1xuICAgICAgY29uc3QgeyBwcmV2aWV3SXRlbVN0YXRlLCBnZXRTdGF0dXNJbmZvRm9yTGF5ZXJTdGF0ZSwgaTE4biB9ID0gdGhpcztcbiAgICAgIGNvbnN0IHByZXZpZXdJdGVtU3RhdHVzSW5mbyA9IHByZXZpZXdJdGVtU3RhdGVcbiAgICAgICAgPyBnZXRTdGF0dXNJbmZvRm9yTGF5ZXJTdGF0ZShwcmV2aWV3SXRlbVN0YXRlKVxuICAgICAgICA6IG51bGw7XG4gICAgICBpZiAoIXByZXZpZXdJdGVtU3RhdHVzSW5mbykge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgaTE4bktleSwga2luZCwgbGluayB9ID0gcHJldmlld0l0ZW1TdGF0dXNJbmZvO1xuICAgICAgY29uc3QgbmVlZFNoYXJlSTE4TiA9IGkxOG4ubmVlZFNoYXJlO1xuICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1ub3RpY2VcIiwgeyBvcGVuOiB0cnVlLCBjbG9zYWJsZTogZmFsc2UsIHNjYWxlOiBcIm1cIiwga2luZDoga2luZCwgc2xvdDogXCJwcmV2aWV3LXN1bW1hcnktdG9wXCIsIGNsYXNzOiBcInByZXZpZXctbm90aWNlXCIgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwibWVzc2FnZVwiIH0sIG5lZWRTaGFyZUkxOE5baTE4bktleV0ucGFuZWwpLCBsaW5rICYmIGkxOG5LZXkgIT09IFwibm9QZXJtaXNzaW9uXCIgJiYgaTE4bktleSAhPT0gXCJzaGFyaW5nUERDRW5hYmxlZFwiICYmIChoKFwiY2FsY2l0ZS1saW5rXCIsIHsgc2xvdDogXCJsaW5rXCIsIGhyZWY6IGxpbmssIHRhcmdldDogXCJfYmxhbmtcIiwgcmVsOiBcIm5vb3BlbmVyXCIgfSwgbmVlZFNoYXJlSTE4TltpMThuS2V5XS5sZWFybk1vcmUpKSkpO1xuICAgIH07XG4gICAgdGhpcy51c2VyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuY29uZmlnID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuYXBpID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaXNBY3RpdmUgPSB0cnVlO1xuICAgIHRoaXMuaXRlbXMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wcmVQcm9jZXNzZWRTaGFyaW5nRGV0YWlsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaXNMb2FkaW5nID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2hhcmluZ0RldGFpbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNlY3Rpb25zID0gW107XG4gICAgdGhpcy5uZWVkc1NoYXJlTGV2ZWxVcGRhdGVMYXllcnMgPSBbXTtcbiAgICB0aGlzLm5lZWRFZGl0YWJsZUxheWVycyA9IFtdO1xuICAgIHRoaXMuZGlzcGxheUl0ZW1zID0gW107XG4gICAgdGhpcy5wcmV2aWV3SXRlbVN0YXRlID0gbnVsbDtcbiAgICB0aGlzLmxvYWRpbmdUZXh0ID0gXCJsb2FkaW5nSW5mb1wiO1xuICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gbnVsbDtcbiAgICB0aGlzLnNoYXJlYWJsZUl0ZW1Db3VudCA9IDA7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5pdGVtcyA9IHRoaXMuaXRlbXMubWFwKChpdGVtSW5mbykgPT4ge1xuICAgICAgdmFyIF9hO1xuICAgICAgcmV0dXJuIChPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGl0ZW1JbmZvKSwgeyBpdGVtOiAoX2EgPSBpdGVtSW5mby5pdGVtLnNvdXJjZUpTT04pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGl0ZW1JbmZvLml0ZW0gfSkpO1xuICAgIH0pO1xuICAgIGNvbnN0IHsgZWwgfSA9IHRoaXM7XG4gICAgY29uc3QgbG9jYWxlID0gYXdhaXQgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyhlbCk7XG4gICAgdGhpcy5pMThuID0gbG9jYWxlWzBdO1xuICB9XG4gIGhhbmRsZU5ld1ByZVByb2Nlc3NlZFNoYXJpbmdEZXRhaWwoKSB7XG4gICAgdmFyIF9hO1xuICAgIChfYSA9IHRoaXMuaXRlbUJyb3dzZXJSZWYpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZWZyZXNoKCk7XG4gIH1cbiAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAvLyBEYXRhIHByb2Nlc3Npbmcgd2lsbCBiZSBoYW5kbGVkIGJ5IGl0ZW0gYnJvd3NlciBvbiBsb2FkIGJlbG93XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgdXBkYXRlU2hhcmluZywgaXNBY3RpdmUsIGFwaSwgY2xvc2VEaWFsb2csIGkxOG4sIGlzTG9hZGluZywgbG9hZGluZ1RleHQsIHNoYXJlYWJsZUl0ZW1Db3VudCwgZXJyb3JNZXNzYWdlLCBwb3J0YWwsIHVzZXIsIGNvbmZpZywgYW5hbHl6ZVNoYXJpbmdEZXRhaWwsIGdldFN0YXR1c0luZm9Gb3JMYXllclN0YXRlLCBkaXNwbGF5SXRlbXMsIHJlbmRlclByZXZpZXdJdGVtTm90aWNlIH0gPSB0aGlzO1xuICAgIGNvbnN0IGNhblVwZGF0ZSA9IHNoYXJlYWJsZUl0ZW1Db3VudCA+IDA7XG4gICAgY29uc3QgaGFzRXJyb3IgPSAhIWVycm9yTWVzc2FnZTtcbiAgICBjb25zdCBuZWVkU2hhcmVJMThOID0gaTE4bi5uZWVkU2hhcmU7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1tb2RhbFwiLCB7IG9uQ2FsY2l0ZU1vZGFsQ2xvc2U6IGNsb3NlRGlhbG9nLCBvcGVuOiBpc0FjdGl2ZSwgb3V0c2lkZUNsb3NlRGlzYWJsZWQ6IHRydWUsIGVzY2FwZURpc2FibGVkOiB0cnVlIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcImhlYWRlclwiLCBjbGFzczogXCJoZWFkZXJcIiB9LCBpMThuLnVwZGF0ZVNoYXJpbmcpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJjb250ZW50XCIsIGNsYXNzOiBcInN0YWdlXCIgfSwgaChcImNhbGNpdGUtYWxlcnRcIiwgeyBpY29uOiB0cnVlLCBvcGVuOiBoYXNFcnJvciwgbGFiZWw6IGVycm9yTWVzc2FnZSwga2luZDogXCJkYW5nZXJcIiwgb25DYWxjaXRlQWxlcnRDbG9zZTogKCkgPT4gKHRoaXMuZXJyb3JNZXNzYWdlID0gbnVsbCkgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwibWVzc2FnZVwiIH0sIGVycm9yTWVzc2FnZSkpLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWxvYWRlclwiLCB7IGFjdGl2ZTogaXNMb2FkaW5nLCB0ZXh0OiBpMThuW2xvYWRpbmdUZXh0XSB9KSwgaChcImFyY2dpcy1pdGVtLWJyb3dzZXJcIiwgeyBmZXRjaDogYXN5bmMgKCkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IGRpc3BsYXlJdGVtcyA9IChfYSA9IChhd2FpdCBhbmFseXplU2hhcmluZ0RldGFpbCgpKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogW107XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdG90YWw6IGRpc3BsYXlJdGVtcy5sZW5ndGgsXG4gICAgICAgICAgbmV4dFN0YXJ0OiAwLFxuICAgICAgICAgIG51bTogZGlzcGxheUl0ZW1zLmxlbmd0aCxcbiAgICAgICAgICBzdGFydDogMCxcbiAgICAgICAgICByZXN1bHRzOiBkaXNwbGF5SXRlbXMubWFwKCh7IGl0ZW0gfSkgPT4gaXRlbSlcbiAgICAgICAgfTtcbiAgICAgIH0sIG9uQXJjZ2lzSXRlbUJyb3dzZXJQcmV2aWV3OiAoeyBkZXRhaWw6IHByZXZpZXdJdGVtIH0pID0+IHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgaWYgKCFwcmV2aWV3SXRlbSkge1xuICAgICAgICAgIHRoaXMucHJldmlld0l0ZW1TdGF0ZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wcmV2aWV3SXRlbVN0YXRlID1cbiAgICAgICAgICAoX2IgPSAoX2EgPSBkaXNwbGF5SXRlbXMuZmluZCgoeyBpdGVtIH0pID0+IGl0ZW0uaWQgPT09IHByZXZpZXdJdGVtLmlkKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBudWxsO1xuICAgICAgfSwgaGlkZUNvbnRlbnRUb3A6IHRydWUsIGNvbnRlbnRQYWRkZWRCb3R0b206IHRydWUsIGhpZGVQcmV2aWV3Rm9vdGVyczogdHJ1ZSwgcG9ydGFsOiBwb3J0YWwsIHVzZXI6IHVzZXIsIGNvbmZpZzogY29uZmlnLCBzZWxlY3Rpb246IFwibm9uZVwiLCBhcGk6IGFwaSwgbnVtOiA5OTk5OSwgcmVmOiAoZWxlKSA9PiAodGhpcy5pdGVtQnJvd3NlclJlZiA9IGVsZSkgfSwgaChcImFyY2dpcy1pdGVtLWJyb3dzZXItY29udGVudFwiLCB7IGNsYXNzOiBcImNvbXBhY3QtZ3JpZC1jb250ZW50XCIsIHNsb3Q6IFwiY29udGVudFwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJ0b3AtYmFyXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInRvcC1ub3RpY2VcIiwgaW5uZXJIVE1MOiBpMThuW3BvcnRhbC5pc1BvcnRhbCA/IFwibm90aWNlRW50ZXJwcmlzZVwiIDogXCJub3RpY2VcIl0gfSksIGgoXCJkaXZcIiwgbnVsbCwgaTE4bi5jYW5CZVNoYXJlZFxuICAgICAgLnJlcGxhY2UoXCIke2NvdW50fVwiLCBzaGFyZWFibGVJdGVtQ291bnQudG9TdHJpbmcoKSlcbiAgICAgIC5yZXBsYWNlKFwiJHt0b3RhbH1cIiwgZGlzcGxheUl0ZW1zLmxlbmd0aC50b1N0cmluZygpKSkpLCBkaXNwbGF5SXRlbXMubWFwKCh7IGl0ZW0sIHN0YXRlIH0pID0+IHtcbiAgICAgIGNvbnN0IHN0YXR1c0luZm8gPSBnZXRTdGF0dXNJbmZvRm9yTGF5ZXJTdGF0ZShzdGF0ZSk7XG4gICAgICBjb25zdCBpc0luZm9TdGF0dXMgPSAoc3RhdHVzSW5mbyA9PT0gbnVsbCB8fCBzdGF0dXNJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzdGF0dXNJbmZvLmtpbmQpID09PSBcImluZm9cIjtcbiAgICAgIHJldHVybiAoaChcImFyY2dpcy1pdGVtLWJyb3dzZXItY2FyZFwiLCB7IGtleTogaXRlbS5pZCwgaXRlbTogaXRlbSwgcG9ydGFsOiBwb3J0YWwsIHVzZXI6IHVzZXIsIGJhc2VVcmw6IGNvbmZpZy5iYXNlVXJsLCBwcmV2aWV3OiBcInRvcFwiLCBzaG93T3duZXI6IHRydWUsIHNob3dEYXRlVXBkYXRlZDogdHJ1ZSwgc2hvd0l0ZW1UeXBlOiB0cnVlLCBzaG93U3VtbWFyeTogdHJ1ZSwgc2hvd0JhZGdlczogdHJ1ZSB9LCBzdGF0dXNJbmZvICYmIChoKFwiZGl2XCIsIHsgc2xvdDogXCJjb250ZW50LXRvcFwiLCBjbGFzczoge1xuICAgICAgICAgIFwic3RhdHVzLWJhbm5lclwiOiB0cnVlLFxuICAgICAgICAgIFwic3RhdHVzLWJhbm5lci0taW5mb1wiOiBpc0luZm9TdGF0dXNcbiAgICAgICAgfSB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgaWNvbjogaXNJbmZvU3RhdHVzID8gXCJpbmZvcm1hdGlvblwiIDogXCJleGNsYW1hdGlvbk1hcmtUcmlhbmdsZVwiLCBzY2FsZTogXCJzXCIgfSksIGgoXCJzcGFuXCIsIG51bGwsIG5lZWRTaGFyZUkxOE5bc3RhdHVzSW5mby5pMThuS2V5XS5ub3RpY2UpKSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImFjdGlvbnMtZW5kXCIsIGNsYXNzOiBcIm9wZW4taXRlbVwiIH0sIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNjYWxlOiBcInNcIiwgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgb25DbGljazogKCkgPT4gd2luZG93Lm9wZW4oZ2V0SXRlbUhvbWVBcHBVcmwoaXRlbS5pZCwgY29uZmlnLmJhc2VVcmwpLCBcIl9ibGFua1wiLCBcIm5vb3BlbmVyXCIpIH0sIGkxOG4uZ29Ub0l0ZW0pKSkpO1xuICAgIH0pKSwgcmVuZGVyUHJldmlld0l0ZW1Ob3RpY2UoKSkpLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcInByaW1hcnlcIiwgYXBwZWFyYW5jZTogY2FuVXBkYXRlID8gXCJvdXRsaW5lXCIgOiBcInNvbGlkXCIsIGtpbmQ6IFwiYnJhbmRcIiwgXCJkYXRhLWlkXCI6IFwiY2FuY2VsQnV0dG9uXCIsIG9uQ2xpY2s6ICgpID0+ICh0aGlzLmlzQWN0aXZlID0gZmFsc2UpLCB3aWR0aDogXCJmdWxsXCIgfSwgaTE4bltjYW5VcGRhdGUgPyBcImNhbmNlbFwiIDogXCJva1wiXSksIGNhblVwZGF0ZSAmJiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJzZWNvbmRhcnlcIiwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCBraW5kOiBcImJyYW5kXCIsIFwiZGF0YS1pZFwiOiBcIm5leHRCdXR0b25cIiwgb25DbGljazogdXBkYXRlU2hhcmluZywgd2lkdGg6IFwiZnVsbFwiLCBkaXNhYmxlZDogaXNMb2FkaW5nIH0sIGkxOG4udXBkYXRlKSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgXCJwcmVQcm9jZXNzZWRTaGFyaW5nRGV0YWlsXCI6IFtcImhhbmRsZU5ld1ByZVByb2Nlc3NlZFNoYXJpbmdEZXRhaWxcIl1cbiAgfTsgfVxufTtcbkFyY2dpc0RlcGVuZGVuY3lDaGVjay5zdHlsZSA9IGFyY2dpc0RlcGVuZGVuY3lDaGVja0NzcztcblxuY29uc3QgZ2V0VXNlckdyb3VwcyA9IGFzeW5jICh7IGl0ZW1zLCBwb3J0YWwsIHNoYXJlTW9kZSwgdXNlciB9KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgaXRlbU93bmVyID0gYXdhaXQgZ2V0SXRlbU93bmVyKHsgdXNlciwgaXRlbXMsIHBvcnRhbCB9KTtcbiAgICAvLyBVc2VmdWwgaW4gY2FzZSB3ZSdyZSBhZG1pbiB0cnlpbmcgdG8gY2hhbmdlIHRoZSBvd25lcidzIGl0ZW1cbiAgICBjb25zdCBhbGxVc2VycyA9IHVzZXIudXNlcm5hbWUgPT09IGl0ZW1Pd25lci51c2VybmFtZSA/IFt1c2VyXSA6IFt1c2VyLCBpdGVtT3duZXJdO1xuICAgIGNvbnN0IHVzZXJHcm91cExvb2t1cCA9IGF3YWl0IHF1ZXJ5VXNlckRldGFpbHMoe1xuICAgICAgcG9ydGFsLFxuICAgICAgdXNlcixcbiAgICAgIHNoYXJlTW9kZSxcbiAgICAgIGl0ZW1Pd25lclxuICAgIH0pO1xuICAgIGNvbnN0IGdyb3VwUmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKGFsbFVzZXJzLm1hcCgoY3VycmVudFVzZXIpID0+IGdldEFsbEdyb3Vwc0ZvclVzZXIoeyB1c2VyOiBjdXJyZW50VXNlciwgcG9ydGFsVXNlcjogdXNlciwgcG9ydGFsLCBzaGFyZU1vZGUsIHVzZXJHcm91cExvb2t1cCwgaXRlbXMgfSkpKTtcbiAgICBjb25zdCBmbGF0dGVuZWRHcm91cHMgPSBncm91cFJlc3VsdHMuZmxhdE1hcCgocmVzdWx0KSA9PiByZXN1bHQucmVzdWx0KTtcbiAgICBjb25zdCBncm91cElkcyA9IGZsYXR0ZW5lZEdyb3Vwcy5tYXAoKHsgaWQgfSkgPT4gaWQpO1xuICAgIGNvbnN0IHVuaXF1ZUdyb3VwcyA9IGZsYXR0ZW5lZEdyb3Vwcy5maWx0ZXIoKGdyb3VwLCBpKSA9PiBncm91cElkcy5pbmRleE9mKGdyb3VwLmlkKSA9PT0gaSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlc3VsdDoge1xuICAgICAgICB1bmlxdWVHcm91cHMsXG4gICAgICAgIHVzZXJHcm91cExvb2t1cCxcbiAgICAgICAgYWxsVXNlcnMsXG4gICAgICAgIHNlYXJjaFVzZXJuYW1lOiB1c2VyLnVzZXJuYW1lID09PSBpdGVtT3duZXIudXNlcm5hbWUgPyB1c2VyLnVzZXJuYW1lIDogaXRlbU93bmVyLnVzZXJuYW1lXG4gICAgICB9XG4gICAgfTtcbiAgfVxuICBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICB9XG59O1xuY29uc3QgTUFYX0dST1VQX1NFQVJDSCA9IDEwMDtcbi8qKiBGZXRjaCB0aGUgZ3JvdXAgZm9yIHRoZSBpdGVtIHRoYXQgdGhlIHVzZXIgaXMgYWxzbyBhIHBhcnQgb2YgKi9cbmNvbnN0IGdldEl0ZW1Hcm91cHMgPSBhc3luYyAoaXRlbUlkcywgdXNlckdyb3VwSWRzLCBwb3J0YWwpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBpdGVtR3JvdXBSZXNwb25zZXMgPSBhd2FpdCBQcm9taXNlLmFsbChjaHVuayh1c2VyR3JvdXBJZHMsIE1BWF9HUk9VUF9TRUFSQ0gpLm1hcChhc3luYyAoZ3JvdXBJZHMpID0+IHJlcXVlc3QoYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX0vY29udGVudC9pdGVtc2dyb3Vwc2AsIHtcbiAgICAgIGl0ZW1zOiBpdGVtSWRzLmpvaW4oXCIsXCIpLFxuICAgICAgZ3JvdXBzOiBncm91cElkcy5qb2luKFwiLFwiKVxuICAgIH0pKSk7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgaXRlbUdyb3VwUmVzcG9uc2VzLmZvckVhY2goKHJlc3BvbnNlKSA9PiB7XG4gICAgICBPYmplY3Qua2V5cyhyZXNwb25zZSkuZm9yRWFjaCgoZ3JvdXBJZCkgPT4ge1xuICAgICAgICBjb25zdCBncm91cCA9IHJlc3BvbnNlW2dyb3VwSWRdO1xuICAgICAgICBpZiAoIXJlc3VsdFtncm91cElkXSkge1xuICAgICAgICAgIHJlc3VsdFtncm91cElkXSA9IGdyb3VwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHJlc3VsdFtncm91cElkXS5pdGVtcyA9IFsuLi5yZXN1bHRbZ3JvdXBJZF0uaXRlbXMsIC4uLmdyb3VwLml0ZW1zXTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHsgcmVzdWx0IH07XG4gIH1cbiAgY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgcmV0dXJuIHsgZXJyb3I6IHsgY29kZTogXCJ1bmhhbmRsZWRFcnJvclwiIH0gfTtcbiAgfVxufTtcbi8qKlxuICogR2l2ZW4gYSB1c2VyLCBnZXQgYWxsIG9mIHRoZWlyIGdyb3VwcyB1c2luZyB0aGUgZ3JvdXBzIHNlYXJjaCBlbmRwb2ludFxuICpcbiAqIHBzZXVkb2NvZGU6XG4gKiBnZXQgdGhlIGZpcnN0IDEwMCBncm91cHMgKHRoZSBtYXggYWxsb3dlZCBieSBncm91cHMgc2VhcmNoIGVuZHBvaW50KVxuICogaWYgdGhhdCBhY2NvdW50cyBmb3IgYWxsIG9mIGEgdXNlcidzIGdyb3VwcywgcmV0dXJuIHRoZW1cbiAqIGVsc2UsIGdldCBhbGwgdGhlIG90aGVyIGdyb3Vwc1xuICogKGluIHBhcmFsbGVsIGJhdGNoZWQgcmVxdWVzdHMgYmFzZWQgb24gcmVzcG9uc2UubmV4dFN0YXJ0KVxuICogYW5kIHJldHVybiB0aGVtXG4gKi9cbmNvbnN0IGdldEFsbEdyb3Vwc0ZvclVzZXIgPSBhc3luYyAoeyB1c2VyLCBwb3J0YWxVc2VyLCBwb3J0YWwsIHNoYXJlTW9kZSwgdXNlckdyb3VwTG9va3VwLCBpdGVtcyB9KSA9PiB7XG4gIHZhciBfYTtcbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIHE6IGdldFVzZXJuYW1lUXVlcnkoe1xuICAgICAgc2hhcmVNb2RlLFxuICAgICAgY3VycmVudFVzZXJuYW1lOiBwb3J0YWxVc2VyLnVzZXJuYW1lLFxuICAgICAgdXNlcixcbiAgICAgIHVzZXJHcm91cExvb2t1cCxcbiAgICAgIGlzUHJpdmF0ZTogKChfYSA9IGl0ZW1zWzBdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuYWNjZXNzKSA9PT0gXCJwcml2YXRlXCJcbiAgICB9KSxcbiAgICBudW06IDEwMCxcbiAgICBzZWFyY2hVc2VyQWNjZXNzOiBcImdyb3VwTWVtYmVyXCIsXG4gICAgc2VhcmNoVXNlck5hbWU6IHVzZXIudXNlcm5hbWVcbiAgfTtcbiAgdHJ5IHtcbiAgICBjb25zdCBmaXJzdEdyb3VwU2VhcmNoUmVzdWx0ID0gYXdhaXQgZmV0Y2hHcm91cHMocG9ydGFsLCBwYXJhbXMpO1xuICAgIC8vIGlmIG5leHRTdGFydCBpcyAtMSwgd2UndmUgZ290IGFsbCB0aGUgZ3JvdXBzLlxuICAgIGlmIChmaXJzdEdyb3VwU2VhcmNoUmVzdWx0Lm5leHRTdGFydCA9PT0gLTEpIHtcbiAgICAgIHJldHVybiB7IHJlc3VsdDogZmlyc3RHcm91cFNlYXJjaFJlc3VsdC5yZXN1bHRzIH07XG4gICAgfVxuICAgIC8vIGlmIG5vdCwgd2UnbGwgaGF2ZSB0byBtYWtlIG4gbW9yZSByZXF1ZXN0c1xuICAgIC8vIHdlIGNhbiBkbyB0aGVzZSBpbiBwYXJhbGxlbCwgYW5kIGNvbmNhdGVuYXRlIHRoZW0gd2l0aCBQcm9taXNlLmFsbCgpXG4gICAgY29uc3QgcmVxdWVzdHNOZWVkZWQgPSBNYXRoLmNlaWwoZmlyc3RHcm91cFNlYXJjaFJlc3VsdC50b3RhbCAvIDEwMCkgLSAxO1xuICAgIGNvbnN0IGdyb3VwU2VhcmNoUHJvbWlzZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlcXVlc3RzTmVlZGVkOyBpKyspIHtcbiAgICAgIGdyb3VwU2VhcmNoUHJvbWlzZXMucHVzaChuZXcgUHJvbWlzZShhc3luYyAoaW5uZXJSZXNvbHZlKSA9PiB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gKGkgKyAxKSAqIDEwMCArIDE7XG4gICAgICAgIGNvbnN0IGlubmVyUmVzcG9uc2UgPSBhd2FpdCBmZXRjaEdyb3Vwcyhwb3J0YWwsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgcGFyYW1zKSwgeyBzdGFydCB9KSk7XG4gICAgICAgIGlubmVyUmVzb2x2ZShpbm5lclJlc3BvbnNlLnJlc3VsdHMpO1xuICAgICAgfSkpO1xuICAgIH1cbiAgICBjb25zdCBvdGhlckdyb3VwU2VhcmNoUmVzdWx0cyA9IChhd2FpdCBQcm9taXNlLmFsbChncm91cFNlYXJjaFByb21pc2VzKSkuZmxhdCgpO1xuICAgIHJldHVybiB7IHJlc3VsdDogWy4uLmZpcnN0R3JvdXBTZWFyY2hSZXN1bHQucmVzdWx0cywgLi4ub3RoZXJHcm91cFNlYXJjaFJlc3VsdHNdIH07XG4gIH1cbiAgY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgcmV0dXJuIHsgZXJyb3I6IHsgY29kZTogXCJ1bmhhbmRsZWRFcnJvclwiIH0gfTtcbiAgfVxufTtcbmNvbnN0IGZldGNoR3JvdXBzID0gKHBvcnRhbCwgcGFyYW1zKSA9PiByZXF1ZXN0RmV0Y2goYCR7Z2V0UG9ydGFsUmVzdEJhc2VVcmwocG9ydGFsKX0vY29tbXVuaXR5L2dyb3Vwc2AsIHBvcnRhbCwge1xuICBib2R5OiBwYXJhbXMsXG4gIHVzZVBvc3Q6IHRydWVcbn0pO1xuY29uc3QgZ2V0SXRlbU93bmVyID0gYXN5bmMgKHsgdXNlciwgaXRlbXMsIHBvcnRhbCB9KSA9PiB7XG4gIHZhciBfYTtcbiAgaWYgKGl0ZW1zQmVsb25nVG9Vc2VyT3JnKGl0ZW1zLCB1c2VyKSAmJlxuICAgIGhhc0FkbWluU2hhcmVQcml2aWxlZ2UoeyBpdGVtcywgdXNlciwgcG9ydGFsIH0pICYmXG4gICAgY2FuVmlld090aGVyc09yZ0l0ZW1zKHVzZXIpKSB7XG4gICAgY29uc3QgZmlyc3RJdGVtID0gaXRlbXNbMF07XG4gICAgcmV0dXJuIChfYSA9IGZpcnN0SXRlbS5pdGVtT3duZXIpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChhd2FpdCBmZXRjaFVzZXIoZmlyc3RJdGVtLm93bmVyLCBwb3J0YWwpKTtcbiAgfVxuICByZXR1cm4gdXNlcjtcbn07XG5jb25zdCBxdWVyeVVzZXJEZXRhaWxzID0gYXN5bmMgKHsgdXNlciwgcG9ydGFsLCBzaGFyZU1vZGUsIGl0ZW1Pd25lciB9KSA9PiB7XG4gIGNvbnN0IHVzZXJEZXRhaWxSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgIGZldGNoVXNlcih1c2VyLnVzZXJuYW1lLCBwb3J0YWwpLFxuICAgIC8vIGZvciBhZG1pbiBjYXNlLCB3ZSBhbHNvIGZldGNoIHRoZSBpdGVtIG93bmVyJ3MgZ3JvdXBcbiAgICBzaGFyZU1vZGUgPT09IFwiYWRtaW5cIiAmJiBpdGVtT3duZXIudXNlcm5hbWUgIT09IHVzZXIudXNlcm5hbWUgPyBmZXRjaFVzZXIoaXRlbU93bmVyLnVzZXJuYW1lLCBwb3J0YWwpIDogbnVsbFxuICBdKTtcbiAgcmV0dXJuIE9iamVjdC5hc3NpZ24oeyBbdXNlci51c2VybmFtZV06IHVzZXJEZXRhaWxSZXN1bHRzWzBdLmdyb3VwcyB9LCAoISF1c2VyRGV0YWlsUmVzdWx0c1sxXSAmJiB7IFtpdGVtT3duZXIudXNlcm5hbWVdOiB1c2VyRGV0YWlsUmVzdWx0c1sxXS5ncm91cHMgfSkpO1xufTtcblxuY29uc3QgYXJjZ2lzSXRlbVNoYXJlR3JvdXBDc3MgPSBcIi5jb250ZW50e2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpjZW50ZXI7bWFyZ2luLXRvcDoxcmVtfS5pbmZvcm1hdGlvbi10ZXh0e2ZvbnQtc2l6ZTowLjg3NXJlbTttYXJnaW4tdG9wOjA7bWFyZ2luLWJvdHRvbTowfS50ZXh0LXBhZGRpbmd7bWFyZ2luLXRvcDowLjVyZW19XCI7XG5cbmNvbnN0IEFyY2dpc0l0ZW1TaGFyZUdyb3VwID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmVkaXRHcm91cENsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJlZGl0R3JvdXBDbGlja1wiLCA3KTtcbiAgICB0aGlzLmRpcnR5Q2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJkaXJ0eUNoYW5nZVwiLCA3KTtcbiAgICB0aGlzLmFuYWx5emVVc2VyR3JvdXBDb21wbGV0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYW5hbHl6ZVVzZXJHcm91cENvbXBsZXRlXCIsIDcpO1xuICAgIHRoaXMucmVtb3ZlQ2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcInJlbW92ZUNsaWNrXCIsIDcpO1xuICAgIHRoaXMucmV2ZXJ0Q2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcInJldmVydENsaWNrXCIsIDcpO1xuICAgIHRoaXMuaGFzR3JvdXBzID0gZmFsc2U7XG4gICAgdGhpcy51c2VyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuY29uZmlnID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaXRlbXMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zaGFyZU1vZGUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pc0xvYWRpbmcgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2VsZWN0ZWRHcm91cERhdGEgPSBbXTtcbiAgICB0aGlzLmluaXRpYWxTZWxlY3RlZEdyb3VwcyA9IFtdO1xuICAgIHRoaXMuY2FuU2hhcmVJdGVtVG9Hcm91cCA9IGZhbHNlO1xuICAgIHRoaXMuaXNEaXJ0eSA9IGZhbHNlO1xuICAgIHRoaXMuaXNTaGFyaW5nTWl4ZWQgPSBmYWxzZTtcbiAgfVxuICBoYW5kbGVTZWxlY3RlZEdyb3Vwc0NoYW5nZShuZXdMaXN0KSB7XG4gICAgY29uc3QgeyB1c2VyLCBpbml0aWFsU2VsZWN0ZWRHcm91cHMsIGl0ZW1zIH0gPSB0aGlzO1xuICAgIHRoaXMuY2FuU2hhcmVJdGVtVG9Hcm91cCA9IGNhblNoYXJlSXRlbVRvR3JvdXAobmV3TGlzdCwgdXNlcik7XG4gICAgdGhpcy5pc0RpcnR5ID0gaXNTZWxlY3RlZEdyb3VwRGF0YURpcnR5KG5ld0xpc3QsIGluaXRpYWxTZWxlY3RlZEdyb3Vwcyk7XG4gICAgdGhpcy5pc1NoYXJpbmdNaXhlZCA9IGNoZWNrSWZTaGFyaW5nTWl4ZWQoaXRlbXMsIG5ld0xpc3QpO1xuICAgIHRoaXMuZGlydHlDaGFuZ2UuZW1pdCh0aGlzLmlzRGlydHkpO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgY29uc3QgeyB1c2VyLCBwb3J0YWwsIGl0ZW1zLCBzaGFyZU1vZGUgfSA9IHRoaXM7XG4gICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuICAgIC8vIFRPRE86IGhhbmRsZSBlcnJvclxuICAgIGNvbnN0IHsgcmVzdWx0IH0gPSBhd2FpdCBnZXRVc2VyR3JvdXBzKHtcbiAgICAgIHVzZXIsXG4gICAgICBwb3J0YWwsXG4gICAgICBpdGVtcyxcbiAgICAgIHNoYXJlTW9kZVxuICAgIH0pO1xuICAgIGNvbnN0IHsgdW5pcXVlR3JvdXBzOiB1c2VyR3JvdXBzLCB1c2VyR3JvdXBMb29rdXAsIHNlYXJjaFVzZXJuYW1lLCBhbGxVc2VycyB9ID0gcmVzdWx0O1xuICAgIGNvbnN0IHsgcmVzdWx0OiBpdGVtR3JvdXBJbmZvIH0gPSBhd2FpdCBnZXRJdGVtR3JvdXBzKGl0ZW1zLm1hcCgoaXRlbSkgPT4gaXRlbS5pZCksIHVzZXJHcm91cHMubWFwKChncm91cCkgPT4gZ3JvdXAuaWQpLCBwb3J0YWwpO1xuICAgIGNvbnN0IGluaXRpYWxHcm91cHMgPSB1c2VyR3JvdXBzXG4gICAgICAvLyBGaW5kIHRoZSBpbnRlcnNlY3Qgb2YgdGhlIGdyb3VwcyB0aGF0IHRoZSB1c2VyIGlzIGEgbWVtYmVyIG9mXG4gICAgICAvLyAgYW5kIHRoZSBncm91cHMgdGhhdCB0aGUgaXRlbSBpcyBzaGFyZWQgdG9cbiAgICAgIC5maWx0ZXIoKHsgaWQgfSkgPT4gISFpdGVtR3JvdXBJbmZvW2lkXSlcbiAgICAgIC5tYXAoKGdyb3VwKSA9PiAoe1xuICAgICAgZ3JvdXAsXG4gICAgICBzZWxlY3RlZEJ5SXRlbUlkczogaXRlbXNcbiAgICAgICAgLmZpbHRlcigoeyBpZCB9KSA9PiAhIWl0ZW1Hcm91cEluZm9bZ3JvdXAuaWRdLml0ZW1zLmZpbmQoKGl0ZW0pID0+IGl0ZW0uaXRlbUlkID09PSBpZCkpXG4gICAgICAgIC5tYXAoKGl0ZW0pID0+IGl0ZW0uaWQpXG4gICAgfSkpO1xuICAgIHRoaXMuaGFzR3JvdXBzID0gdXNlckdyb3Vwcy5sZW5ndGggPiAwO1xuICAgIHRoaXMuY2FuU2hhcmVJdGVtVG9Hcm91cCA9IGNhblNoYXJlSXRlbVRvR3JvdXAoaW5pdGlhbEdyb3VwcywgdXNlcik7XG4gICAgdGhpcy5pbml0aWFsU2VsZWN0ZWRHcm91cHMgPSBpbml0aWFsR3JvdXBzO1xuICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgdGhpcy5hbmFseXplVXNlckdyb3VwQ29tcGxldGUuZW1pdCh7XG4gICAgICBhbGxVc2VycyxcbiAgICAgIGluaXRpYWxTZWxlY3RlZEdyb3VwczogaW5pdGlhbEdyb3VwcyxcbiAgICAgIHVzZXJHcm91cExvb2t1cCxcbiAgICAgIHNlYXJjaFVzZXJuYW1lXG4gICAgfSk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgaTE4biwgaXNMb2FkaW5nLCBjYW5TaGFyZUl0ZW1Ub0dyb3VwLCByZW1vdmVDbGljaywgcmV2ZXJ0Q2xpY2ssIHNlbGVjdGVkR3JvdXBEYXRhLCBoYXNHcm91cHMsIGlzRGlydHksIGlzU2hhcmluZ01peGVkIH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWRlc2NyaXB0aW9uXCIsIHsgaGVhZGVyOiBpMThuLnRpdGxlLCBoZWFkZXJTaWRlQ29udGVudDogaXNEaXJ0eSA/IChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIGljb25TdGFydDogXCJyZXNldFwiLCBkaXNhYmxlZDogaXNMb2FkaW5nLCBvbkNsaWNrOiAoKSA9PiByZXZlcnRDbGljay5lbWl0KCkgfSwgaTE4bi5yZXZlcnQpKSA6IChzZWxlY3RlZEdyb3VwRGF0YS5sZW5ndGggPiAwICYmIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIGljb25TdGFydDogXCJ4XCIsIGRpc2FibGVkOiBpc0xvYWRpbmcsIG9uQ2xpY2s6ICgpID0+IHJlbW92ZUNsaWNrLmVtaXQoKSB9LCBpMThuLnJlbW92ZSkpKSB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbnRlbnRcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZ3JvdXAtY29udGFpbmVyXCIgfSwgc2VsZWN0ZWRHcm91cERhdGEubGVuZ3RoID4gMCA/IChoKFwiYXJjZ2lzLWdyb3VwLXRodW1ibmFpbC1zdGFja1wiLCB7IGdyb3Vwczogc2VsZWN0ZWRHcm91cERhdGEubWFwKCh7IGdyb3VwIH0pID0+IGdyb3VwKSB9KSkgOiAoaChcInBcIiwgeyBjbGFzczogXCJpbmZvcm1hdGlvbi10ZXh0XCIgfSwgaTE4bltoYXNHcm91cHMgPyBcIm5vbmVZZXRcIiA6IFwibm9Hcm91cFwiXSkpKSwgaGFzR3JvdXBzICYmIGNhblNoYXJlSXRlbVRvR3JvdXAgJiYgKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGljb25TdGFydDogXCJncm91cFwiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBkaXNhYmxlZDogaXNMb2FkaW5nLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmVkaXRHcm91cENsaWNrLmVtaXQoKSB9LCBpMThuLmVkaXQpKSksICFpc0xvYWRpbmcgJiYgaXNTaGFyaW5nTWl4ZWQgJiYgKGgoXCJwXCIsIHsgY2xhc3M6IFwiaW5mb3JtYXRpb24tdGV4dCB0ZXh0LXBhZGRpbmdcIiB9LCBpMThuLm1peGVkR3JvdXBTaGFyaW5nKSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgXCJzZWxlY3RlZEdyb3VwRGF0YVwiOiBbXCJoYW5kbGVTZWxlY3RlZEdyb3Vwc0NoYW5nZVwiXVxuICB9OyB9XG59O1xuQXJjZ2lzSXRlbVNoYXJlR3JvdXAuc3R5bGUgPSBhcmNnaXNJdGVtU2hhcmVHcm91cENzcztcblxuY29uc3QgYXJjZ2lzSXRlbVNoYXJlR3JvdXBDYXJkQ3NzID0gXCI6aG9zdHtkaXNwbGF5OmNvbnRlbnRzfVwiO1xuXG5jb25zdCBBcmNnaXNJdGVtU2hhcmVHcm91cENhcmQgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMucmV2ZXJ0Q2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcInJldmVydENsaWNrXCIsIDcpO1xuICAgIHRoaXMudXNlciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmdyb3VwID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZ3JvdXBDb3VudCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmluaXRpYWxTZWxlY3RlZEdyb3VwRGF0YUxvb2t1cCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNlbGVjdGVkR3JvdXBEYXRhTG9va3VwID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudG90YWxJdGVtQ291bnQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGdyb3VwLCBncm91cENvdW50LCB0b3RhbEl0ZW1Db3VudCwgaW5pdGlhbFNlbGVjdGVkR3JvdXBEYXRhTG9va3VwLCBzZWxlY3RlZEdyb3VwRGF0YUxvb2t1cCwgcmV2ZXJ0Q2xpY2ssIHBvcnRhbCwgdXNlciwgaTE4biB9ID0gdGhpcztcbiAgICBjb25zdCB0b3RhbEl0ZW1Db3VudFN0ciA9IHRvdGFsSXRlbUNvdW50LnRvU3RyaW5nKCk7XG4gICAgY29uc3QgZ3JvdXBJZCA9IGdyb3VwLmlkO1xuICAgIGNvbnN0IGN1ckdyb3VwQ291bnQgPSBncm91cENvdW50W2dyb3VwLmlkXTtcbiAgICBsZXQgc2VsZWN0aW9uVHlwZSA9IFwibm9uZVwiO1xuICAgIHN3aXRjaCAodHJ1ZSkge1xuICAgICAgY2FzZSBjdXJHcm91cENvdW50IDwgdG90YWxJdGVtQ291bnQ6XG4gICAgICAgIHNlbGVjdGlvblR5cGUgPSBcImluZGV0ZXJtaW5hdGVcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGN1ckdyb3VwQ291bnQgPT09IHRvdGFsSXRlbUNvdW50OlxuICAgICAgICBzZWxlY3Rpb25UeXBlID0gXCJhbGxcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNvbnN0IGluaXRpYWxTZWxlY3Rpb25UeXBlID0gaW5pdGlhbFNlbGVjdGVkR3JvdXBEYXRhTG9va3VwW2dyb3VwSWRdO1xuICAgIC8qKlxuICAgICAqIFdlIGNhbid0IGp1c3QgZG8gaW5pdGlhbFNlbGVjdGlvblR5cGUgIT09IHNlbGVjdGlvblR5cGUgYmVjYXVzZVxuICAgICAqICBpbml0aWFsU2VsZWN0aW9uVHlwZSBjYW4gYmUgdW5kZWZpbmVkIGlmIGEgZ3JvdXAgaXMgbm90IHNlbGVjdGVkIGluaXRpYWxseVxuICAgICAqICBzaW5jZSB3ZSBjb25zdHJ1Y3QgYGluaXRpYWxTZWxlY3RlZEdyb3VwRGF0YUxvb2t1cGAgYmFzZWQgb24gdGhlIHByZS1zZWxlY3RlZCBncm91cFxuICAgICAqICBhbmQgZG9uJ3QgaGF2ZSB0aGUga25vd2xlZGdlIGFib3V0IG90aGVyIGdyb3VwcyBzaW5jZSB0aGV5J3JlIGZyb20gdGhlIEFQSVxuICAgICAqIFNvIGl0IHdpbGwgc3RpbGwgc2hvdyB0aGUgcmV2ZXJ0IGJ1dHRvbiBldmVuIGlmIHRoZSBncm91cCBpcyBub3Qgc2VsZWN0ZWQgaW5pdGlhbGx5IGFuZCBzZWxlY3Rpb25UeXBlID09PSBcIm5vbmVcIlxuICAgICAqICB3aXRob3V0IHRoYXQgY29uZGl0aW9uXG4gICAgICovXG4gICAgY29uc3QgaXNHcm91cFNlbGVjdGlvbkNoYW5nZWQgPSAoISFpbml0aWFsU2VsZWN0aW9uVHlwZSB8fCBzZWxlY3Rpb25UeXBlICE9PSBcIm5vbmVcIikgJiZcbiAgICAgIGluaXRpYWxTZWxlY3Rpb25UeXBlICE9PSBzZWxlY3Rpb25UeXBlO1xuICAgIHJldHVybiAoaChcImFyY2dpcy1ncm91cC1jYXJkXCIsIHsgZ3JvdXA6IGdyb3VwLCBwb3J0YWw6IHBvcnRhbCwgdXNlcjogdXNlciwgbmFtZTogZ3JvdXAudGl0bGUsIHNlbGVjdGVkOiAhIXNlbGVjdGVkR3JvdXBEYXRhTG9va3VwW2dyb3VwSWRdLCBpbmRldGVybWluYXRlOiBzZWxlY3Rpb25UeXBlID09PSBcImluZGV0ZXJtaW5hdGVcIiwgc2VsZWN0aW9uOiBcIm11bHRpcGxlXCIsIHByZXZpZXc6IFwiYWN0aW9uXCIsIHZpZXc6IFwiY29tcGFjdFwiLCBzaG93T3duZXI6IHRydWUsIHNob3dEYXRlVXBkYXRlZDogdHJ1ZSwgc2hvd1N1bW1hcnk6IHRydWUsIGtleTogZ3JvdXBJZCB9LCBoKFwic3BhblwiLCB7IHNsb3Q6IFwiY29udGVudC1lbmRcIiB9LCBjdXJHcm91cENvdW50ICYmIGN1ckdyb3VwQ291bnQgPiAwICYmIChoKFwic3BhblwiLCB7IGNsYXNzOiBcImdyb3VwLWl0ZW0tY291bnRlclwiIH0sIGkxOG5baXNHcm91cFNlbGVjdGlvbkNoYW5nZWQgPyBcIndpbGxTaGFyZUNvdW50SGludFwiIDogXCJzaGFyZWRDb3VudEhpbnRcIl1cbiAgICAgIC5yZXBsYWNlKFwiJHtudW1JdGVtfVwiLCBjdXJHcm91cENvdW50LnRvTG9jYWxlU3RyaW5nKCkpXG4gICAgICAucmVwbGFjZShcIiR7dG90YWxJdGVtfVwiLCB0b3RhbEl0ZW1Db3VudFN0cikpKSwgaXNHcm91cFNlbGVjdGlvbkNoYW5nZWQgJiYgKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGNsYXNzOiBcInJldmVydC1zaW5nbGUtZ3JvdXAtY3RhXCIsIGFwcGVhcmFuY2U6IFwidHJhbnNwYXJlbnRcIiwgb25DbGljazogKGV2ZW50KSA9PiB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICByZXZlcnRDbGljay5lbWl0KCk7XG4gICAgICB9IH0sIGkxOG4ucmV2ZXJ0KSkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0l0ZW1TaGFyZUdyb3VwQ2FyZC5zdHlsZSA9IGFyY2dpc0l0ZW1TaGFyZUdyb3VwQ2FyZENzcztcblxuZXhwb3J0IHsgQXJjZ2lzRGVwZW5kZW5jeUNoZWNrIGFzIGFyY2dpc19kZXBlbmRlbmN5X2NoZWNrLCBBcmNnaXNJdGVtU2hhcmVHcm91cCBhcyBhcmNnaXNfaXRlbV9zaGFyZV9ncm91cCwgQXJjZ2lzSXRlbVNoYXJlR3JvdXBDYXJkIGFzIGFyY2dpc19pdGVtX3NoYXJlX2dyb3VwX2NhcmQgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgZiBhcyBmcm9tQ2FjaGUsIHIgYXMgcmVxdWVzdCwgZyBhcyBnZXRSZXN0QmFzZVVybCB9IGZyb20gJy4vcG9ydGFsLTc5Y2FhZWZmLmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy1lYjVmN2RjMi5qcyc7XG5cbmFzeW5jIGZ1bmN0aW9uIGZldGNoVXNlcih1c2VybmFtZSwgcG9ydGFsKSB7XG4gIHJldHVybiByZXF1ZXN0KGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9L2NvbW11bml0eS91c2Vycy8ke3VzZXJuYW1lfWApO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hTZWxmKCkge1xuICByZXR1cm4gcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybCgpfS9jb21tdW5pdHkvc2VsZmApO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0U2lnbmVkSW5Vc2Vyc0dyb3VwcygpIHtcbiAgdmFyIF9hO1xuICBjb25zdCB1c2VyID0gY29uZmlnU3RhdGUgPT09IG51bGwgfHwgY29uZmlnU3RhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbmZpZ1N0YXRlLnVzZXI7XG4gIGlmICghdXNlcikge1xuICAgIHJldHVybiBbXTtcbiAgfVxuICBjb25zdCBzZWxmID0gYXdhaXQgZnJvbUNhY2hlKCgpID0+IGZldGNoU2VsZigpLCBcImNvbW11bml0eVNlbGZcIiwgdXNlci51c2VybmFtZSk7XG4gIHJldHVybiAoX2EgPSBzZWxmID09PSBudWxsIHx8IHNlbGYgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGYuZ3JvdXBzKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBbXTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldFNpZ25lZEluVXNlcnNGYXZvcml0ZXNHcm91cCgpIHtcbiAgY29uc3QgdXNlciA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS51c2VyO1xuICBpZiAoIXVzZXIpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCBzZWxmID0gYXdhaXQgZnJvbUNhY2hlKCgpID0+IGZldGNoU2VsZigpLCBcImNvbW11bml0eVNlbGZcIiwgdXNlci51c2VybmFtZSk7XG4gIHJldHVybiBzZWxmLmZhdkdyb3VwSWQ7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRVc2VyQ29udGVudChwb3J0YWxVc2VyKSB7XG4gIHZhciBfYSwgX2I7XG4gIGNvbnN0IHVzZXIgPSAoX2EgPSBwb3J0YWxVc2VyICE9PSBudWxsICYmIHBvcnRhbFVzZXIgIT09IHZvaWQgMCA/IHBvcnRhbFVzZXIgOiBjb25maWdTdGF0ZS51c2VyKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBjb25maWdTdGF0ZS5wb3J0YWwudXNlcjtcbiAgY29uc3QgcG9ydGFsID0gY29uZmlnU3RhdGUucG9ydGFsO1xuICAoX2IgPSB1c2VyLnVzZXJDb250ZW50VXJsKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAodXNlci51c2VyQ29udGVudFVybCA9IChwb3J0YWwgPT09IG51bGwgfHwgcG9ydGFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3J0YWwucmVzdFVybCkgKyBcIi9jb250ZW50L3VzZXJzL1wiICsgcG9ydGFsVXNlci51c2VybmFtZSk7XG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdCh1c2VyLnVzZXJDb250ZW50VXJsLCB7IG51bTogMSB9KTtcbiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXNwb25zZSk7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRGb2xkZXJzKHBvcnRhbFVzZXIpIHtcbiAgdmFyIF9hO1xuICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gIGNvbnN0IHsgZm9sZGVycyB9ID0gYXdhaXQgZ2V0VXNlckNvbnRlbnQodXNlcik7XG4gIGNvbnN0IHsgdXNlcm5hbWUgfSA9IHVzZXI7XG4gIC8vIGFkZCB0aGUgaG9tZSBmb2xkZXIgYXMgaWYgaXQncyBpbiB0aGUgbGlzdFxuICByZXR1cm4gW3sgdXNlcm5hbWUsIGlkOiB1c2VybmFtZSwgdGl0bGU6IHVzZXJuYW1lLCBjcmVhdGVkOiBcIm5vd1wiIH0sIC4uLmZvbGRlcnNdO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0Rm9sZGVyRnJvbUlkKGZvbGRlcklkLCBwb3J0YWxVc2VyKSB7XG4gIHZhciBfYTtcbiAgY29uc3QgdXNlciA9IChfYSA9IHBvcnRhbFVzZXIgIT09IG51bGwgJiYgcG9ydGFsVXNlciAhPT0gdm9pZCAwID8gcG9ydGFsVXNlciA6IGNvbmZpZ1N0YXRlLnVzZXIpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGNvbmZpZ1N0YXRlLnBvcnRhbC51c2VyO1xuICBjb25zdCBmb2xkZXJzID0gYXdhaXQgZ2V0Rm9sZGVycyh1c2VyKTtcbiAgcmV0dXJuIGZvbGRlcnMuZmluZCgoZm9sZGVyKSA9PiBmb2xkZXIuaWQgPT09IGZvbGRlcklkKTtcbn1cbmZ1bmN0aW9uIGdldEhvbWVGb2xkZXJGb3JVc2VyKHVzZXJuYW1lKSB7XG4gIHJldHVybiB7IHVzZXJuYW1lLCBpZDogdXNlcm5hbWUsIHRpdGxlOiB1c2VybmFtZSwgY3JlYXRlZDogXCJub3dcIiB9O1xufVxuYXN5bmMgZnVuY3Rpb24gY3JlYXRlRm9sZGVyKGZvbGRlck5hbWUsIHBvcnRhbFVzZXIpIHtcbiAgdmFyIF9hO1xuICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gIGNvbnN0IHVybCA9IGAke3VzZXIudXNlckNvbnRlbnRVcmx9L2NyZWF0ZUZvbGRlcmA7XG4gIGNvbnN0IGZvbGRlclJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdCh1cmwsIHsgdGl0bGU6IGZvbGRlck5hbWUgfSwge30sIFwicG9zdFwiKTtcbiAgcmV0dXJuIGZvbGRlclJlc3BvbnNlO1xufVxuXG5leHBvcnQgeyBnZXRTaWduZWRJblVzZXJzR3JvdXBzIGFzIGEsIGdldFNpZ25lZEluVXNlcnNGYXZvcml0ZXNHcm91cCBhcyBiLCBjcmVhdGVGb2xkZXIgYXMgYywgZ2V0Rm9sZGVyRnJvbUlkIGFzIGQsIGdldEhvbWVGb2xkZXJGb3JVc2VyIGFzIGUsIGZldGNoVXNlciBhcyBmLCBnZXRGb2xkZXJzIGFzIGcgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==