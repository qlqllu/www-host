"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-b887ec"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-image-upload_3.entry.js":
/*!************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-image-upload_3.entry.js ***!
  \************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_image_upload: () => (/* binding */ ArcgisImageUpload),
/* harmony export */   arcgis_image_upload_edit_step: () => (/* binding */ ArcgisImageUploadEditStep),
/* harmony export */   arcgis_image_upload_file_step: () => (/* binding */ ArcgisImageUploadFileStep)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */






const arcgisImageUploadCss = ".image-upload__modal{--calcite-modal-width:650px}.image-upload__title{font-size:1.25rem;margin-bottom:0}.image-upload__content{padding-top:1rem;padding-bottom:1.5rem;padding-left:2rem;padding-right:2rem;box-sizing:border-box;background-color:var(--calcite-ui-background);border:1px solid var(--calcite-ui-border-3)}.image-upload__content--with-map{min-height:400px}.image-upload__content--no-padding{padding:0}.image-upload__canvas{visibility:hidden;position:fixed;left:-10000px}.or-container{margin-top:1rem;margin-bottom:1rem;text-align:center;font-weight:500}.or-container:before,.or-container:after{display:inline-block;vertical-align:middle;content:\"\";border-top:solid 1px var(--calcite-ui-border-input);width:15%;height:1px;z-index:1}.or-wrapper{padding-left:0.5rem;padding-right:0.5rem}.image-upload__from-map-button{background-color:var(--calcite-ui-foreground-1);text-align:center;padding:1rem;border:1px solid var(--calcite-ui-foreground-3)}.image-upload__from-map-button:hover{border:1px solid var(--calcite-ui-brand)}.image-upload__from-map-title{display:inline-block}.from-map-title-wrapper{display:flex;align-items:center}.from-map-icon{margin-right:0.5rem}.image-upload__from-map-desc{font-size:0.875rem;margin:0}";

const ArcgisImageUpload = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisImageUploadCancel = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisImageUploadCancel", 7);
    this.arcgisImageUploadError = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisImageUploadError", 7);
    this.arcgisImageUploadSave = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisImageUploadSave", 7);
    this.imageFormat = "png";
    this.fileName = "";
    this.handleCancel = () => {
      this.showError = false;
      this.arcgisImageUploadCancel.emit();
    };
    this.handleChooseDiffClick = () => {
      this.activeStep = "file";
      this.previewSrc = "";
      this.editExisting = false;
    };
    this.handleSaveClick = async () => {
      if (this.activeStep === "file") {
        this.showError = true;
        return;
      }
      this.showError = false;
      this.saving = true;
      if (this.activeStep === "map") {
        this.takeMapScreenshot();
        return;
      }
      const data = await this.getCanvasImage();
      this.arcgisImageUploadSave.emit(data);
    };
    this.takeMapScreenshot = async () => {
      if (this.mapView["_stage"]) {
        this.mapView["_stage"]["_supersampleScreenshots"] = false;
      }
      const result = await this.mapView.takeScreenshot({
        format: "png"
      });
      const data = {
        blob: this.dataURIToBlob(result.dataUrl),
        base64: result.dataUrl,
        format: "png",
        fileName: ""
      };
      this.arcgisImageUploadSave.emit(data);
    };
    this.handleFromMapClick = () => {
      this.activeStep = "map";
    };
    this.handleMapViewLoaded = (evt) => {
      this.mapView = evt.detail;
    };
    this.modalTitle = undefined;
    this.sizeDescription = undefined;
    this.zoomToFit = true;
    this.maxWidth = undefined;
    this.maxHeight = undefined;
    this.fillBackground = false;
    this.active = undefined;
    this.height = window.innerWidth < 412 ? 200 : 300;
    this.aspectRatio = 1;
    this.portal = undefined;
    this.itemId = undefined;
    this.jsapiUrl = undefined;
    this.previewSrc = undefined;
    this.saving = false;
    this.editExisting = false;
    this.isModified = false;
    this.activeStep = "file";
    this.showError = false;
  }
  handleFileChange(evt) {
    const { fileName, dataURL } = evt.detail;
    this.fileName = fileName;
    this.previewSrc = dataURL;
    this.activeStep = "edit";
    this.showError = false;
  }
  handleInvalidFile() {
    this.showError = true;
    this.arcgisImageUploadError.emit("invalid file type.");
  }
  handleImageChange() {
    this.isModified = true;
  }
  handleActiveChange() {
    var _a;
    if (!this.active) {
      this.activeStep = "file";
      this.saving = false;
      this.isModified = false;
      this.previewSrc = "";
      this.editExisting = false;
      (_a = this.fileStep) === null || _a === void 0 ? void 0 : _a.resetFileInput();
    }
  }
  async componentWillLoad() {
    const locale = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.el);
    this.strings = locale[0];
  }
  dataURIToBlob(dataURI) {
    const byteString = atob(dataURI.split(",")[1]);
    const mimeString = dataURI.split(",")[0].split(":")[1].split(";")[0];
    const arrayBuffer = new ArrayBuffer(byteString.length);
    const uintArray = new Uint8Array(arrayBuffer);
    for (let i = 0; i < byteString.length; i++) {
      uintArray[i] = byteString.charCodeAt(i);
    }
    const blob = new Blob([arrayBuffer], {
      type: mimeString
    });
    return blob;
  }
  drawImage({ selectionX, selectionY, selectionWidth, selectionHeight, canvasWidth, canvasHeight, minWidth, minHeight, drawDimensions }, scaleFactor, img, context) {
    this.canvasEl.width = canvasWidth < minWidth ? minWidth : canvasWidth * scaleFactor;
    this.canvasEl.height = canvasHeight < minHeight ? minHeight : canvasHeight * scaleFactor;
    if (this.maxWidth) {
      if (this.canvasEl.width > this.maxWidth) {
        this.canvasEl.width = this.maxWidth;
      }
    }
    if (this.maxHeight) {
      if (this.canvasEl.height > this.maxHeight) {
        this.canvasEl.height = this.maxHeight;
      }
    }
    const left = drawDimensions.left * this.canvasEl.width;
    const top = drawDimensions.top * this.canvasEl.height;
    const width = drawDimensions.width * this.canvasEl.width;
    const height = drawDimensions.height * this.canvasEl.height;
    if (this.fillBackground) {
      context.fillStyle = "#efefef";
      context.fillRect(0, 0, this.canvasEl.width, this.canvasEl.height);
    }
    context.drawImage(img, selectionX, selectionY, selectionWidth, selectionHeight, left, top, width, height);
    const base64 = this.canvasEl.toDataURL("image/png");
    const blob = this.dataURIToBlob(base64);
    return {
      base64,
      blob
    };
  }
  async getScaledImageData(img) {
    const context = this.canvasEl.getContext("2d");
    const drawParameters = await this.editStepEl.getDrawParameters();
    let results;
    function retry() {
      context.clearRect(0, 0, this.canvasEl.width, this.canvasEl.height);
      return this.drawImage(drawParameters, 1600 / img.width, img, context);
    }
    try {
      results = this.drawImage(drawParameters, 1, img, context);
      if (results.blob.size > 10000000 || results.blob.size === 0) {
        results = retry();
      }
    }
    catch (e) {
      if (e.name !== "NS_ERROR_FAILURE") {
        this.arcgisImageUploadError.emit("unable to save the image provided.");
      }
      else {
        results = retry();
      }
    }
    return {
      blob: results === null || results === void 0 ? void 0 : results.blob,
      base64: results === null || results === void 0 ? void 0 : results.base64,
      format: this.imageFormat,
      fileName: this.fileName
    };
  }
  getCanvasImage() {
    return new Promise((resolve) => {
      const img = new Image();
      if (this.previewSrc.indexOf("arcgis.com") > -1) {
        img.crossOrigin = "Anonymous";
      }
      img.onload = () => {
        const properAspectRatio = Math.abs(this.aspectRatio - img.width / img.height) < 0.01;
        if (properAspectRatio && !this.isModified) {
          resolve({
            blob: this.dataURIToBlob(this.previewSrc),
            base64: this.previewSrc,
            format: this.imageFormat,
            fileName: this.fileName
          });
          return;
        }
        resolve(this.getScaledImageData(img));
      };
      img.src = this.previewSrc;
    });
  }
  render() {
    const hasMap = !!this.portal && !!this.itemId && !!this.jsapiUrl;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { class: "image-upload__modal", open: this.active, role: "dialog", "aria-modal": "true", "aria-labelledby": "image-upload-modal-title", outsideCloseDisabled: true, onCalciteModalClose: this.handleCancel }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { slot: "header", id: "image-upload-modal-title", class: "image-upload__title", "aria-label": this.modalTitle }, this.modalTitle), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", class: {
        "image-upload__content": true,
        "image-upload__content--with-map": hasMap,
        "image-upload__content--no-padding": this.activeStep === "map"
      } }, this.activeStep === "file" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-image-upload-file-step", { ref: (el) => {
        this.fileStep = el;
      }, strings: this.strings, sizeDescription: this.sizeDescription }), hasMap && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "or-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "or-wrapper" }, this.strings.or)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "image-upload__from-map-button", tabIndex: 0, onClick: this.handleFromMapClick, onKeyDown: (evt) => {
        if (evt.code === "Space" || evt.code === "Enter") {
          this.handleFromMapClick();
        }
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "image-upload__from-map-title" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "from-map-title-wrapper" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "map", scale: "m", class: "from-map-icon" }), this.strings.fromMap)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "image-upload__from-map-desc" }, this.strings.fromMapDesc)))))), this.activeStep === "map" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-image-upload-from-map", { portal: this.portal, itemId: this.itemId, jsapiUrl: this.jsapiUrl, changeBasemapText: this.strings.changeBasemap, loadingText: this.strings.loading, onArcgisImageUploadFromMapReady: this.handleMapViewLoaded })), this.activeStep === "edit" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-image-upload-edit-step", { ref: (el) => {
        this.editStepEl = el;
      }, strings: this.strings, height: this.height, aspectRatio: this.aspectRatio, previewSrc: this.previewSrc, zoomToFit: this.zoomToFit })), this.activeStep === "edit" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("canvas", { ref: (el) => {
        this.canvasEl = el;
      }, class: "image-upload__canvas" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-alert", { label: this.strings.imageRequired, open: this.showError, ref: (el) => {
        this.alertEl = el;
      }, icon: "exclamation-mark-circle", placement: "bottom", kind: "danger" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, this.strings.imageRequired))), (this.activeStep === "edit" || this.activeStep === "map") && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "back", appearance: "transparent", "icon-start": "chevron-left", width: "full", disabled: this.saving, onClick: this.handleChooseDiffClick, iconFlipRtl: "start" }, this.strings.chooseDiff)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "outline-fill", width: "full", disabled: this.saving, onClick: this.handleCancel }, this.strings.cancel), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", appearance: "solid", width: "full", loading: this.saving, onClick: this.handleSaveClick }, this.strings.save)));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "active": ["handleActiveChange"]
  }; }
};
ArcgisImageUpload.style = arcgisImageUploadCss;

const arcgisImageUploadEditStepCss = ":host{overflow:hidden;display:block;position:relative;min-height:20.625rem}.edit-step__loader{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%)}.edit-step__crop-thumb-container{position:relative;width:100%;overflow:hidden}.edit-step__crop-thumb-container--hidden{visibility:hidden}.edit-step__translucent-container{overflow:hidden;position:absolute;top:0;left:50%;cursor:all-scroll;transform:translate(-50%)}.edit-step__translucent-container:after{box-sizing:border-box;position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;content:\"\";opacity:0.9;border:1.875rem solid white}.edit-step__transparent-container{position:absolute;overflow-x:visible;box-sizing:border-box;outline:2px solid transparent;outline-offset:2px;background-color:var(--calcite-ui-foreground-3);border:1px solid var(--calcite-ui-border-1);margin-right:-50%;top:50%;left:50%;transform:translate(-50%, -50%)}.edit-step__preview-image{margin:0;position:absolute;left:0;top:0;transform-origin:50% 50%}.edit-step__preview-image--loading{visibility:hidden}.edit-step__transparent-container:focus .edit-step__preview-image{box-shadow:0px 0px 6px 4px var(--calcite-ui-brand)}.edit-step__zoom-control{--calcite-label-margin-bottom:0}.edit-step__zoom-control--hidden{visibility:hidden}.edit-step__zoom-control-label{display:flex;height:2rem}.edit-step__zoom-control-label-spacer{flex:1 1 0%}";

const ArcgisImageUploadEditStep = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisImageUploadEditStepImageChanged = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisImageUploadEditStepImageChanged", 7);
    this.handleWheel = (event) => {
      event.preventDefault();
      const imageScale = event.deltaY > 0 ? (this.imageProperties.scale * 1) / 1.1 : this.imageProperties.scale * 1.1;
      this.zoomValue = `${50 + Math.log(imageScale) / Math.log(1.1)}`;
      this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { scale: imageScale });
    };
    this.handleDragStart = () => {
      this.dragging = true;
    };
    this.handleDrag = (event) => {
      if (!this.dragging) {
        return;
      }
      const { touches } = event;
      let { clientX, clientY } = event;
      if (clientX === undefined || clientY === undefined) {
        // on touch devices, use the clientX and clientY properties inside touches array property
        if (!touches.length) {
          return;
        }
        clientX = touches[0].clientX;
        clientY = touches[0].clientY;
      }
      if (!this.previousPosition) {
        this.previousPosition = {
          top: clientY,
          left: clientX
        };
        return;
      }
      const { top, left } = this.previousPosition;
      const yDiff = clientY - top;
      const xDiff = clientX - left;
      this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { top: this.imageProperties.top + yDiff, left: this.imageProperties.left + xDiff });
      this.previousPosition = {
        top: top + yDiff,
        left: left + xDiff
      };
    };
    this.handleDragEnd = () => {
      this.dragging = false;
      this.previousPosition = undefined;
    };
    this.handleImageLoaded = () => {
      if (this.editingExisting) {
        this.loadingImage = false;
        this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { scale: this.height / this.imageEl.width, top: 0, left: 0, origin: { x: "0%", y: "0%" } });
        this.isLoading = false;
        return;
      }
      const width = this.height * this.aspectRatio;
      const { clientWidth, clientHeight } = this.imageEl;
      const heightScale = (this.height + 2) / clientHeight;
      const widthScale = (width + 2) / clientWidth;
      const imageScale = heightScale > widthScale ? heightScale : widthScale;
      let updates = Object.assign({}, this.imageProperties);
      updates = Object.assign(Object.assign({}, updates), { top: Math.floor(this.height / 2 - clientHeight / 2), left: Math.floor((this.height * this.aspectRatio) / 2 - clientWidth / 2), origin: { x: "50%", y: "50%" } });
      if (this.zoomToFit) {
        updates = Object.assign(Object.assign({}, updates), { top: updates.top - 1, left: updates.left - 1, scale: imageScale });
        this.initiallySettingZoom = true;
        this.zoomValue = `${50 + Math.log(imageScale) / Math.log(1.1)}`;
      }
      this.imageProperties = Object.assign({}, updates);
      this.isLoading = false;
    };
    this.handleZoomInput = (event) => {
      if (this.initiallySettingZoom) {
        this.initiallySettingZoom = false;
      }
      this.zoomValue = event.target.value;
      this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { scale: Math.pow(1.1, event.target.value - 50) });
    };
    this.handleImageKeydown = (event) => {
      const key = event.key;
      let modified = false;
      switch (key) {
        case "ArrowUp":
          this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { top: this.imageProperties.top - 1 });
          modified = true;
          break;
        case "ArrowDown":
          this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { top: this.imageProperties.top + 1 });
          modified = true;
          break;
        case "ArrowLeft":
          this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { left: this.imageProperties.left - 1 });
          modified = true;
          break;
        case "ArrowRight":
          this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { left: this.imageProperties.left + 1 });
          modified = true;
          break;
      }
      if (modified) {
        event.preventDefault();
      }
    };
    this.strings = undefined;
    this.aspectRatio = undefined;
    this.previewSrc = undefined;
    this.loadingImage = false;
    this.editingExisting = false;
    this.zoomToFit = false;
    this.height = undefined;
    this.imageProperties = {
      scale: 1,
      top: 0,
      left: 0,
      origin: {
        x: "50%",
        y: "50%"
      }
    };
    this.dragging = false;
    this.previousPosition = undefined;
    this.previewStyle = undefined;
    this.zoomValue = "50";
    this.initiallySettingZoom = false;
    this.firstImagePropertiesChange = true;
    this.isLoading = true;
  }
  componentWillLoad() {
    const padding = 60;
    const width = this.height * this.aspectRatio;
    const heightWithPaddingPx = `${this.height + padding}px`;
    this.thumbContainerStyle = {
      height: heightWithPaddingPx
    };
    this.translucentContainerStyle = {
      width: `${width + padding}px`,
      height: heightWithPaddingPx
    };
    this.transparentContainerStyle = {
      width: `${width}px`,
      height: `${this.height}px`
    };
    this.previewStyle = {
      transform: `scale(${this.imageProperties.scale})`,
      top: `${this.imageProperties.top}px`,
      left: `${this.imageProperties.left}px`,
      transformOrigin: `${this.imageProperties.origin.x} ${this.imageProperties.origin.y}`
    };
  }
  componentDidLoad() {
    this.imageContainerEl.focus();
  }
  getImageExtent() {
    const imageRect = this.imageEl.getBoundingClientRect();
    const containerRect = this.imageContainerEl.getBoundingClientRect();
    return {
      left: (containerRect.left - imageRect.left) / imageRect.width,
      right: (containerRect.right - imageRect.left) / imageRect.width,
      top: (containerRect.top - imageRect.top) / imageRect.height,
      bottom: (containerRect.bottom - imageRect.top) / imageRect.height
    };
  }
  getDrawDimensions() {
    const imageRect = this.imageEl.getBoundingClientRect();
    const selectedRect = this.imageContainerEl.getBoundingClientRect();
    const top = imageRect.top - selectedRect.top > 0 ? imageRect.top - selectedRect.top : 0;
    const left = imageRect.left - selectedRect.left > 0 ? imageRect.left - selectedRect.left : 0;
    const newImgLeft = imageRect.left < selectedRect.left ? selectedRect.left : imageRect.left;
    const newImgTop = imageRect.top < selectedRect.top ? selectedRect.top : imageRect.top;
    const newImgRight = imageRect.right > selectedRect.right ? selectedRect.right : imageRect.right;
    const newImgBottom = imageRect.bottom > selectedRect.bottom ? selectedRect.bottom : imageRect.bottom;
    return {
      left: left / selectedRect.width,
      top: top / selectedRect.height,
      width: (newImgRight - newImgLeft) / selectedRect.width,
      height: (newImgBottom - newImgTop) / selectedRect.height
    };
  }
  async getDrawParameters() {
    const minWidth = this.height * this.aspectRatio;
    const minHeight = this.height;
    const { left, right, top, bottom } = this.getImageExtent();
    const sourceExtent = {
      left: left < 0 ? 0 : left,
      top: top < 0 ? 0 : top,
      right: right > 1 ? 1 : right,
      bottom: bottom > 1 ? 1 : bottom
    };
    const drawDimensions = this.getDrawDimensions();
    const imageWidth = this.imageEl.clientWidth;
    const imageHeight = this.imageEl.clientHeight;
    const selectionX = sourceExtent.left * imageWidth;
    const selectionY = sourceExtent.top * imageHeight;
    const selectionWidth = sourceExtent.right * imageWidth - sourceExtent.left * imageWidth;
    const selectionHeight = sourceExtent.bottom * imageHeight - sourceExtent.top * imageHeight;
    const canvasWidth = right * imageWidth - left * imageWidth;
    const canvasHeight = bottom * imageHeight - top * imageHeight;
    return {
      selectionX,
      selectionY,
      selectionWidth,
      selectionHeight,
      canvasWidth,
      canvasHeight,
      minWidth,
      minHeight,
      drawDimensions
    };
  }
  handleImagePropertiesChange() {
    this.previewStyle = {
      transform: `scale(${this.imageProperties.scale})`,
      top: `${this.imageProperties.top}px`,
      left: `${this.imageProperties.left}px`,
      transformOrigin: `${this.imageProperties.origin.x} ${this.imageProperties.origin.y}`
    };
    if (this.firstImagePropertiesChange) {
      this.firstImagePropertiesChange = false;
      if (this.zoomToFit) {
        this.arcgisImageUploadEditStepImageChanged.emit();
      }
    }
    else {
      this.arcgisImageUploadEditStepImageChanged.emit();
    }
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { onWheel: this.handleWheel }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { class: "edit-step__loader", label: "", hidden: !this.isLoading }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: `edit-step__crop-thumb-container ${this.isLoading ? "edit-step__crop-thumb-container--hidden" : ""}`, style: this.thumbContainerStyle }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "edit-step__translucent-container", style: this.translucentContainerStyle, onMouseDown: this.handleDragStart, onTouchStart: this.handleDragStart, onMouseMove: this.handleDrag, onTouchMove: this.handleDrag, onMouseUp: this.handleDragEnd, onTouchEnd: this.handleDragEnd, onMouseOut: this.handleDragEnd }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (el) => {
        this.imageContainerEl = el;
      }, class: "edit-step__transparent-container", tabIndex: 0, style: this.transparentContainerStyle, onKeyDown: this.handleImageKeydown }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("img", { ref: (el) => {
        this.imageEl = el;
      }, src: this.previewSrc, alt: "", class: `edit-step__preview-image ${this.loadingImage ? "edit-step__preview-image--loading" : ""}`, style: this.previewStyle, onLoad: this.handleImageLoaded })))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: {
        "edit-step__zoom-control": true,
        "edit-step__zoom-control--hidden": this.isLoading
      } }, this.strings.zoom, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-slider", { "aria-label": this.strings.zoom, scale: "l", min: 0, max: 100, value: +this.zoomValue, onCalciteSliderInput: this.handleZoomInput, mirrored: (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.el) === "rtl" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "edit-step__zoom-control-label" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "edit-step__zoom-control-icon-s" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "image", scale: "s" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "edit-step__zoom-control-label-spacer" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "edit-step__zoom-control-icon-l" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "image", scale: "l" }))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "imageProperties": ["handleImagePropertiesChange"]
  }; }
};
ArcgisImageUploadEditStep.style = arcgisImageUploadEditStepCss;

const arcgisImageUploadFileStepCss = ".file-step{text-align:center}.file-step__upload-icon{margin-bottom:0.5rem;margin-top:0.25rem;color:var(--calcite-ui-text-3)}.file-step__upload-icon calcite-icon{width:4rem;height:4rem}.file-step__drag-text{font-size:1.25rem;margin-bottom:0.25rem}.file-step__browse-button{margin-top:1rem}.file-step__file-input{display:none}";

const ArcgisImageUploadFileStep = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisImageUploadFileStepFileChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisImageUploadFileStepFileChange", 7);
    this.arcgisImageUploadFileStepInvalidFile = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisImageUploadFileStepInvalidFile", 7);
    this.handleDragOver = (event) => {
      event.preventDefault();
    };
    this.handleDrop = (event) => {
      event.preventDefault();
      this.processFile(event.dataTransfer.files[0]);
    };
    this.handleFileInputChange = (event) => {
      this.processFile(event.target.files[0]);
    };
    this.strings = undefined;
    this.sizeDescription = undefined;
  }
  async resetFileInput() {
    this.fileInput.value = "";
  }
  processFile(file) {
    if (!file) {
      return;
    }
    if (file) {
      if (!this.isValidFile(file)) {
        this.arcgisImageUploadFileStepInvalidFile.emit();
        return;
      }
      const reader = new FileReader();
      reader.onload = async (event) => {
        this.arcgisImageUploadFileStepFileChange.emit({
          dataURL: event.target.result,
          fileName: file.name || ""
        });
      };
      reader.readAsDataURL(file);
    }
  }
  isValidFile(file) {
    return (file === null || file === void 0 ? void 0 : file.name) && /\.(gif|jpg|jpeg|png)$/i.test(file.name);
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "file-step", "aria-label": this.strings.dragDrop, onDragOver: this.handleDragOver, onDragEnter: this.handleDragOver, onDrop: this.handleDrop }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "file-step__upload-icon" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "upload" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "file-step__drag-text", "aria-label": this.strings.dragDrop }, this.strings.dragDrop), this.sizeDescription && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { "aria-label": this.sizeDescription }, this.sizeDescription)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: "file-step__browse-button", appearance: "transparent", iconStart: "image", scale: "l", onClick: () => {
        this.fileInput.click();
      } }, this.strings.browse), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("input", { ref: (el) => {
        this.fileInput = el;
      }, onChange: this.handleFileInputChange, class: "file-step__file-input", type: "file", accept: ".jpg,.gif,.png,.jpeg" }))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisImageUploadFileStep.style = arcgisImageUploadFileStepCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



const languageMap = new Map([
  ["ar", "ar"],
  ["bg", "bg"],
  ["bs", "bs"],
  ["ca", "ca"],
  ["cs", "cs"],
  ["da", "da"],
  ["de", "de"],
  ["el", "el"],
  ["en", "en"],
  ["es", "es"],
  ["et", "et"],
  ["fi", "fi"],
  ["fr", "fr"],
  ["he", "he"],
  ["hr", "hr"],
  ["hu", "hu"],
  ["id", "id"],
  ["it", "it"],
  ["ja", "ja"],
  ["ko", "ko"],
  ["lt", "lt"],
  ["lv", "lv"],
  ["nb", "nb"],
  ["nl", "nl"],
  ["pl", "pl"],
  ["pt-br", "pt-BR"],
  ["pt-pt", "pt-PT"],
  ["ro", "ro"],
  ["ru", "ru"],
  ["sk", "sk"],
  ["sl", "sl"],
  ["sr", "sr"],
  ["sv", "sv"],
  ["th", "th"],
  ["tr", "tr"],
  ["uk", "uk"],
  ["vi", "vi"],
  ["zh-cn", "zh-CN"],
  ["zh-hk", "zh-HK"],
  ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
  return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
  const closestWithProp = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
  return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
  rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
  const { api, type, places } = options || {};
  if (api === 4) {
    const [intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
    const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
      places,
      style: type,
      digitSeparator: true
    });
    return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
  }
  const [dojoNumber] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
  return dojoNumber.format(number, {
    type,
    places,
    pattern: options === null || options === void 0 ? void 0 : options.pattern
  });
}
const cache = {};
function formatDate(date) {
  const lang = document.documentElement.lang;
  const dayShortMonthYear = {
    year: "numeric",
    month: "short",
    day: "numeric"
  };
  if (!cache[lang]) {
    cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
  }
  return cache[lang].format(date);
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
  var _a, _b, _c;
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    // "ru-RU" maps to "ru" use case
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
    }
    else {
      return "en";
    }
  }
}
function getComponentClosestLanguageIntl(element) {
  var _a, _b, _c;
  // it's OK if we don't have the 4 letter language file for it
  // 4 letter language code needed for formatting numbers
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      // we support the 2 letter coded language
      // e.g. it-CH vs it
      return lang;
    }
    else {
      return "en";
    }
  }
}
function fetchLocaleStringsForComponent(componentName, locale) {
  return new Promise((resolve, reject) => {
    fetch((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
      if (result.ok)
        resolve(result.json());
      else
        reject();
    }, () => reject());
  });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
  const id = `${componentName}${locale}`;
  if (!stringCache[id]) {
    stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
  }
  return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
  const componentName = tagName || element.tagName.toLowerCase();
  const componentLanguage = getComponentClosestLanguage(element);
  const componentLanguageIntl = getComponentClosestLanguageIntl(element);
  let strings;
  try {
    strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
  }
  catch (e) {
    console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
    strings = await fetchLocaleStringsFromCache(componentName, "en");
  }
  return [strings, componentLanguage, componentLanguageIntl];
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWI4ODdlYy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzRIO0FBQ3REO0FBQ047QUFDckM7QUFDUTs7QUFFbkMsbURBQW1ELDRCQUE0QixxQkFBcUIsa0JBQWtCLGdCQUFnQix1QkFBdUIsaUJBQWlCLHNCQUFzQixrQkFBa0IsbUJBQW1CLHNCQUFzQiw4Q0FBOEMsNENBQTRDLGlDQUFpQyxpQkFBaUIsbUNBQW1DLFVBQVUsc0JBQXNCLGtCQUFrQixlQUFlLGNBQWMsY0FBYyxnQkFBZ0IsbUJBQW1CLGtCQUFrQixnQkFBZ0IseUNBQXlDLHFCQUFxQixzQkFBc0IsYUFBYSxvREFBb0QsVUFBVSxXQUFXLFVBQVUsWUFBWSxvQkFBb0IscUJBQXFCLCtCQUErQixnREFBZ0Qsa0JBQWtCLGFBQWEsZ0RBQWdELHFDQUFxQyx5Q0FBeUMsOEJBQThCLHFCQUFxQix3QkFBd0IsYUFBYSxtQkFBbUIsZUFBZSxvQkFBb0IsNkJBQTZCLG1CQUFtQixTQUFTOztBQUU1dUM7QUFDQTtBQUNBLElBQUkscURBQWdCO0FBQ3BCLG1DQUFtQyxxREFBVztBQUM5QyxrQ0FBa0MscURBQVc7QUFDN0MsaUNBQWlDLHFEQUFXO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QixXQUFXLHdEQUFXO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBLFFBQVEsd0RBQVc7QUFDbkIsYUFBYSx3REFBVztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixtREFBaUM7QUFDaEU7QUFDQTtBQUNBLE1BQU0sd0RBQVc7QUFDakIsV0FBVyx3REFBVztBQUN0QjtBQUNBO0FBQ0EsUUFBUSx3REFBVztBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxxREFBWSw4QkFBOEIsY0FBYyxRQUFRLE9BQU87QUFDakY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixjQUFjLEVBQUUsT0FBTztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsZUFBZSxHQUFHLGtCQUFrQjtBQUN0RTtBQUNBO0FBQ0E7QUFDQTs7QUFFNEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtaW1hZ2UtdXBsb2FkXzMuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xvY2FsZS0xM2UwMGE3NS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgRiBhcyBGcmFnbWVudCwgZCBhcyBnZXRFbGVtZW50LCBIIGFzIEhvc3QgfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyB9IGZyb20gJy4vbG9jYWxlLTEzZTAwYTc1LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0RWxlbWVudERpciB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzJztcbmltcG9ydCAnLi9kb20tMTNmNWIwMGMuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWFhZjMwYmQ2LmpzJztcblxuY29uc3QgYXJjZ2lzSW1hZ2VVcGxvYWRDc3MgPSBcIi5pbWFnZS11cGxvYWRfX21vZGFsey0tY2FsY2l0ZS1tb2RhbC13aWR0aDo2NTBweH0uaW1hZ2UtdXBsb2FkX190aXRsZXtmb250LXNpemU6MS4yNXJlbTttYXJnaW4tYm90dG9tOjB9LmltYWdlLXVwbG9hZF9fY29udGVudHtwYWRkaW5nLXRvcDoxcmVtO3BhZGRpbmctYm90dG9tOjEuNXJlbTtwYWRkaW5nLWxlZnQ6MnJlbTtwYWRkaW5nLXJpZ2h0OjJyZW07Ym94LXNpemluZzpib3JkZXItYm94O2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1iYWNrZ3JvdW5kKTtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktYm9yZGVyLTMpfS5pbWFnZS11cGxvYWRfX2NvbnRlbnQtLXdpdGgtbWFwe21pbi1oZWlnaHQ6NDAwcHh9LmltYWdlLXVwbG9hZF9fY29udGVudC0tbm8tcGFkZGluZ3twYWRkaW5nOjB9LmltYWdlLXVwbG9hZF9fY2FudmFze3Zpc2liaWxpdHk6aGlkZGVuO3Bvc2l0aW9uOmZpeGVkO2xlZnQ6LTEwMDAwcHh9Lm9yLWNvbnRhaW5lcnttYXJnaW4tdG9wOjFyZW07bWFyZ2luLWJvdHRvbToxcmVtO3RleHQtYWxpZ246Y2VudGVyO2ZvbnQtd2VpZ2h0OjUwMH0ub3ItY29udGFpbmVyOmJlZm9yZSwub3ItY29udGFpbmVyOmFmdGVye2Rpc3BsYXk6aW5saW5lLWJsb2NrO3ZlcnRpY2FsLWFsaWduOm1pZGRsZTtjb250ZW50OlxcXCJcXFwiO2JvcmRlci10b3A6c29saWQgMXB4IHZhcigtLWNhbGNpdGUtdWktYm9yZGVyLWlucHV0KTt3aWR0aDoxNSU7aGVpZ2h0OjFweDt6LWluZGV4OjF9Lm9yLXdyYXBwZXJ7cGFkZGluZy1sZWZ0OjAuNXJlbTtwYWRkaW5nLXJpZ2h0OjAuNXJlbX0uaW1hZ2UtdXBsb2FkX19mcm9tLW1hcC1idXR0b257YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMSk7dGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzoxcmVtO2JvcmRlcjoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTMpfS5pbWFnZS11cGxvYWRfX2Zyb20tbWFwLWJ1dHRvbjpob3Zlcntib3JkZXI6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktYnJhbmQpfS5pbWFnZS11cGxvYWRfX2Zyb20tbWFwLXRpdGxle2Rpc3BsYXk6aW5saW5lLWJsb2NrfS5mcm9tLW1hcC10aXRsZS13cmFwcGVye2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXJ9LmZyb20tbWFwLWljb257bWFyZ2luLXJpZ2h0OjAuNXJlbX0uaW1hZ2UtdXBsb2FkX19mcm9tLW1hcC1kZXNje2ZvbnQtc2l6ZTowLjg3NXJlbTttYXJnaW46MH1cIjtcblxuY29uc3QgQXJjZ2lzSW1hZ2VVcGxvYWQgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzSW1hZ2VVcGxvYWRDYW5jZWwgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0ltYWdlVXBsb2FkQ2FuY2VsXCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzSW1hZ2VVcGxvYWRFcnJvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSW1hZ2VVcGxvYWRFcnJvclwiLCA3KTtcbiAgICB0aGlzLmFyY2dpc0ltYWdlVXBsb2FkU2F2ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSW1hZ2VVcGxvYWRTYXZlXCIsIDcpO1xuICAgIHRoaXMuaW1hZ2VGb3JtYXQgPSBcInBuZ1wiO1xuICAgIHRoaXMuZmlsZU5hbWUgPSBcIlwiO1xuICAgIHRoaXMuaGFuZGxlQ2FuY2VsID0gKCkgPT4ge1xuICAgICAgdGhpcy5zaG93RXJyb3IgPSBmYWxzZTtcbiAgICAgIHRoaXMuYXJjZ2lzSW1hZ2VVcGxvYWRDYW5jZWwuZW1pdCgpO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVDaG9vc2VEaWZmQ2xpY2sgPSAoKSA9PiB7XG4gICAgICB0aGlzLmFjdGl2ZVN0ZXAgPSBcImZpbGVcIjtcbiAgICAgIHRoaXMucHJldmlld1NyYyA9IFwiXCI7XG4gICAgICB0aGlzLmVkaXRFeGlzdGluZyA9IGZhbHNlO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVTYXZlQ2xpY2sgPSBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5hY3RpdmVTdGVwID09PSBcImZpbGVcIikge1xuICAgICAgICB0aGlzLnNob3dFcnJvciA9IHRydWU7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2hvd0Vycm9yID0gZmFsc2U7XG4gICAgICB0aGlzLnNhdmluZyA9IHRydWU7XG4gICAgICBpZiAodGhpcy5hY3RpdmVTdGVwID09PSBcIm1hcFwiKSB7XG4gICAgICAgIHRoaXMudGFrZU1hcFNjcmVlbnNob3QoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuZ2V0Q2FudmFzSW1hZ2UoKTtcbiAgICAgIHRoaXMuYXJjZ2lzSW1hZ2VVcGxvYWRTYXZlLmVtaXQoZGF0YSk7XG4gICAgfTtcbiAgICB0aGlzLnRha2VNYXBTY3JlZW5zaG90ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMubWFwVmlld1tcIl9zdGFnZVwiXSkge1xuICAgICAgICB0aGlzLm1hcFZpZXdbXCJfc3RhZ2VcIl1bXCJfc3VwZXJzYW1wbGVTY3JlZW5zaG90c1wiXSA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5tYXBWaWV3LnRha2VTY3JlZW5zaG90KHtcbiAgICAgICAgZm9ybWF0OiBcInBuZ1wiXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgIGJsb2I6IHRoaXMuZGF0YVVSSVRvQmxvYihyZXN1bHQuZGF0YVVybCksXG4gICAgICAgIGJhc2U2NDogcmVzdWx0LmRhdGFVcmwsXG4gICAgICAgIGZvcm1hdDogXCJwbmdcIixcbiAgICAgICAgZmlsZU5hbWU6IFwiXCJcbiAgICAgIH07XG4gICAgICB0aGlzLmFyY2dpc0ltYWdlVXBsb2FkU2F2ZS5lbWl0KGRhdGEpO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVGcm9tTWFwQ2xpY2sgPSAoKSA9PiB7XG4gICAgICB0aGlzLmFjdGl2ZVN0ZXAgPSBcIm1hcFwiO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVNYXBWaWV3TG9hZGVkID0gKGV2dCkgPT4ge1xuICAgICAgdGhpcy5tYXBWaWV3ID0gZXZ0LmRldGFpbDtcbiAgICB9O1xuICAgIHRoaXMubW9kYWxUaXRsZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNpemVEZXNjcmlwdGlvbiA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnpvb21Ub0ZpdCA9IHRydWU7XG4gICAgdGhpcy5tYXhXaWR0aCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm1heEhlaWdodCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmZpbGxCYWNrZ3JvdW5kID0gZmFsc2U7XG4gICAgdGhpcy5hY3RpdmUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJXaWR0aCA8IDQxMiA/IDIwMCA6IDMwMDtcbiAgICB0aGlzLmFzcGVjdFJhdGlvID0gMTtcbiAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLml0ZW1JZCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmpzYXBpVXJsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucHJldmlld1NyYyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNhdmluZyA9IGZhbHNlO1xuICAgIHRoaXMuZWRpdEV4aXN0aW5nID0gZmFsc2U7XG4gICAgdGhpcy5pc01vZGlmaWVkID0gZmFsc2U7XG4gICAgdGhpcy5hY3RpdmVTdGVwID0gXCJmaWxlXCI7XG4gICAgdGhpcy5zaG93RXJyb3IgPSBmYWxzZTtcbiAgfVxuICBoYW5kbGVGaWxlQ2hhbmdlKGV2dCkge1xuICAgIGNvbnN0IHsgZmlsZU5hbWUsIGRhdGFVUkwgfSA9IGV2dC5kZXRhaWw7XG4gICAgdGhpcy5maWxlTmFtZSA9IGZpbGVOYW1lO1xuICAgIHRoaXMucHJldmlld1NyYyA9IGRhdGFVUkw7XG4gICAgdGhpcy5hY3RpdmVTdGVwID0gXCJlZGl0XCI7XG4gICAgdGhpcy5zaG93RXJyb3IgPSBmYWxzZTtcbiAgfVxuICBoYW5kbGVJbnZhbGlkRmlsZSgpIHtcbiAgICB0aGlzLnNob3dFcnJvciA9IHRydWU7XG4gICAgdGhpcy5hcmNnaXNJbWFnZVVwbG9hZEVycm9yLmVtaXQoXCJpbnZhbGlkIGZpbGUgdHlwZS5cIik7XG4gIH1cbiAgaGFuZGxlSW1hZ2VDaGFuZ2UoKSB7XG4gICAgdGhpcy5pc01vZGlmaWVkID0gdHJ1ZTtcbiAgfVxuICBoYW5kbGVBY3RpdmVDaGFuZ2UoKSB7XG4gICAgdmFyIF9hO1xuICAgIGlmICghdGhpcy5hY3RpdmUpIHtcbiAgICAgIHRoaXMuYWN0aXZlU3RlcCA9IFwiZmlsZVwiO1xuICAgICAgdGhpcy5zYXZpbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMuaXNNb2RpZmllZCA9IGZhbHNlO1xuICAgICAgdGhpcy5wcmV2aWV3U3JjID0gXCJcIjtcbiAgICAgIHRoaXMuZWRpdEV4aXN0aW5nID0gZmFsc2U7XG4gICAgICAoX2EgPSB0aGlzLmZpbGVTdGVwKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVzZXRGaWxlSW5wdXQoKTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgY29uc3QgbG9jYWxlID0gYXdhaXQgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyh0aGlzLmVsKTtcbiAgICB0aGlzLnN0cmluZ3MgPSBsb2NhbGVbMF07XG4gIH1cbiAgZGF0YVVSSVRvQmxvYihkYXRhVVJJKSB7XG4gICAgY29uc3QgYnl0ZVN0cmluZyA9IGF0b2IoZGF0YVVSSS5zcGxpdChcIixcIilbMV0pO1xuICAgIGNvbnN0IG1pbWVTdHJpbmcgPSBkYXRhVVJJLnNwbGl0KFwiLFwiKVswXS5zcGxpdChcIjpcIilbMV0uc3BsaXQoXCI7XCIpWzBdO1xuICAgIGNvbnN0IGFycmF5QnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKGJ5dGVTdHJpbmcubGVuZ3RoKTtcbiAgICBjb25zdCB1aW50QXJyYXkgPSBuZXcgVWludDhBcnJheShhcnJheUJ1ZmZlcik7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBieXRlU3RyaW5nLmxlbmd0aDsgaSsrKSB7XG4gICAgICB1aW50QXJyYXlbaV0gPSBieXRlU3RyaW5nLmNoYXJDb2RlQXQoaSk7XG4gICAgfVxuICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbYXJyYXlCdWZmZXJdLCB7XG4gICAgICB0eXBlOiBtaW1lU3RyaW5nXG4gICAgfSk7XG4gICAgcmV0dXJuIGJsb2I7XG4gIH1cbiAgZHJhd0ltYWdlKHsgc2VsZWN0aW9uWCwgc2VsZWN0aW9uWSwgc2VsZWN0aW9uV2lkdGgsIHNlbGVjdGlvbkhlaWdodCwgY2FudmFzV2lkdGgsIGNhbnZhc0hlaWdodCwgbWluV2lkdGgsIG1pbkhlaWdodCwgZHJhd0RpbWVuc2lvbnMgfSwgc2NhbGVGYWN0b3IsIGltZywgY29udGV4dCkge1xuICAgIHRoaXMuY2FudmFzRWwud2lkdGggPSBjYW52YXNXaWR0aCA8IG1pbldpZHRoID8gbWluV2lkdGggOiBjYW52YXNXaWR0aCAqIHNjYWxlRmFjdG9yO1xuICAgIHRoaXMuY2FudmFzRWwuaGVpZ2h0ID0gY2FudmFzSGVpZ2h0IDwgbWluSGVpZ2h0ID8gbWluSGVpZ2h0IDogY2FudmFzSGVpZ2h0ICogc2NhbGVGYWN0b3I7XG4gICAgaWYgKHRoaXMubWF4V2lkdGgpIHtcbiAgICAgIGlmICh0aGlzLmNhbnZhc0VsLndpZHRoID4gdGhpcy5tYXhXaWR0aCkge1xuICAgICAgICB0aGlzLmNhbnZhc0VsLndpZHRoID0gdGhpcy5tYXhXaWR0aDtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMubWF4SGVpZ2h0KSB7XG4gICAgICBpZiAodGhpcy5jYW52YXNFbC5oZWlnaHQgPiB0aGlzLm1heEhlaWdodCkge1xuICAgICAgICB0aGlzLmNhbnZhc0VsLmhlaWdodCA9IHRoaXMubWF4SGVpZ2h0O1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBsZWZ0ID0gZHJhd0RpbWVuc2lvbnMubGVmdCAqIHRoaXMuY2FudmFzRWwud2lkdGg7XG4gICAgY29uc3QgdG9wID0gZHJhd0RpbWVuc2lvbnMudG9wICogdGhpcy5jYW52YXNFbC5oZWlnaHQ7XG4gICAgY29uc3Qgd2lkdGggPSBkcmF3RGltZW5zaW9ucy53aWR0aCAqIHRoaXMuY2FudmFzRWwud2lkdGg7XG4gICAgY29uc3QgaGVpZ2h0ID0gZHJhd0RpbWVuc2lvbnMuaGVpZ2h0ICogdGhpcy5jYW52YXNFbC5oZWlnaHQ7XG4gICAgaWYgKHRoaXMuZmlsbEJhY2tncm91bmQpIHtcbiAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gXCIjZWZlZmVmXCI7XG4gICAgICBjb250ZXh0LmZpbGxSZWN0KDAsIDAsIHRoaXMuY2FudmFzRWwud2lkdGgsIHRoaXMuY2FudmFzRWwuaGVpZ2h0KTtcbiAgICB9XG4gICAgY29udGV4dC5kcmF3SW1hZ2UoaW1nLCBzZWxlY3Rpb25YLCBzZWxlY3Rpb25ZLCBzZWxlY3Rpb25XaWR0aCwgc2VsZWN0aW9uSGVpZ2h0LCBsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpO1xuICAgIGNvbnN0IGJhc2U2NCA9IHRoaXMuY2FudmFzRWwudG9EYXRhVVJMKFwiaW1hZ2UvcG5nXCIpO1xuICAgIGNvbnN0IGJsb2IgPSB0aGlzLmRhdGFVUklUb0Jsb2IoYmFzZTY0KTtcbiAgICByZXR1cm4ge1xuICAgICAgYmFzZTY0LFxuICAgICAgYmxvYlxuICAgIH07XG4gIH1cbiAgYXN5bmMgZ2V0U2NhbGVkSW1hZ2VEYXRhKGltZykge1xuICAgIGNvbnN0IGNvbnRleHQgPSB0aGlzLmNhbnZhc0VsLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICBjb25zdCBkcmF3UGFyYW1ldGVycyA9IGF3YWl0IHRoaXMuZWRpdFN0ZXBFbC5nZXREcmF3UGFyYW1ldGVycygpO1xuICAgIGxldCByZXN1bHRzO1xuICAgIGZ1bmN0aW9uIHJldHJ5KCkge1xuICAgICAgY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXNFbC53aWR0aCwgdGhpcy5jYW52YXNFbC5oZWlnaHQpO1xuICAgICAgcmV0dXJuIHRoaXMuZHJhd0ltYWdlKGRyYXdQYXJhbWV0ZXJzLCAxNjAwIC8gaW1nLndpZHRoLCBpbWcsIGNvbnRleHQpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgcmVzdWx0cyA9IHRoaXMuZHJhd0ltYWdlKGRyYXdQYXJhbWV0ZXJzLCAxLCBpbWcsIGNvbnRleHQpO1xuICAgICAgaWYgKHJlc3VsdHMuYmxvYi5zaXplID4gMTAwMDAwMDAgfHwgcmVzdWx0cy5ibG9iLnNpemUgPT09IDApIHtcbiAgICAgICAgcmVzdWx0cyA9IHJldHJ5KCk7XG4gICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICBpZiAoZS5uYW1lICE9PSBcIk5TX0VSUk9SX0ZBSUxVUkVcIikge1xuICAgICAgICB0aGlzLmFyY2dpc0ltYWdlVXBsb2FkRXJyb3IuZW1pdChcInVuYWJsZSB0byBzYXZlIHRoZSBpbWFnZSBwcm92aWRlZC5cIik7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgcmVzdWx0cyA9IHJldHJ5KCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBibG9iOiByZXN1bHRzID09PSBudWxsIHx8IHJlc3VsdHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3VsdHMuYmxvYixcbiAgICAgIGJhc2U2NDogcmVzdWx0cyA9PT0gbnVsbCB8fCByZXN1bHRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXN1bHRzLmJhc2U2NCxcbiAgICAgIGZvcm1hdDogdGhpcy5pbWFnZUZvcm1hdCxcbiAgICAgIGZpbGVOYW1lOiB0aGlzLmZpbGVOYW1lXG4gICAgfTtcbiAgfVxuICBnZXRDYW52YXNJbWFnZSgpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgaWYgKHRoaXMucHJldmlld1NyYy5pbmRleE9mKFwiYXJjZ2lzLmNvbVwiKSA+IC0xKSB7XG4gICAgICAgIGltZy5jcm9zc09yaWdpbiA9IFwiQW5vbnltb3VzXCI7XG4gICAgICB9XG4gICAgICBpbWcub25sb2FkID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBwcm9wZXJBc3BlY3RSYXRpbyA9IE1hdGguYWJzKHRoaXMuYXNwZWN0UmF0aW8gLSBpbWcud2lkdGggLyBpbWcuaGVpZ2h0KSA8IDAuMDE7XG4gICAgICAgIGlmIChwcm9wZXJBc3BlY3RSYXRpbyAmJiAhdGhpcy5pc01vZGlmaWVkKSB7XG4gICAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgICBibG9iOiB0aGlzLmRhdGFVUklUb0Jsb2IodGhpcy5wcmV2aWV3U3JjKSxcbiAgICAgICAgICAgIGJhc2U2NDogdGhpcy5wcmV2aWV3U3JjLFxuICAgICAgICAgICAgZm9ybWF0OiB0aGlzLmltYWdlRm9ybWF0LFxuICAgICAgICAgICAgZmlsZU5hbWU6IHRoaXMuZmlsZU5hbWVcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmVzb2x2ZSh0aGlzLmdldFNjYWxlZEltYWdlRGF0YShpbWcpKTtcbiAgICAgIH07XG4gICAgICBpbWcuc3JjID0gdGhpcy5wcmV2aWV3U3JjO1xuICAgIH0pO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCBoYXNNYXAgPSAhIXRoaXMucG9ydGFsICYmICEhdGhpcy5pdGVtSWQgJiYgISF0aGlzLmpzYXBpVXJsO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtbW9kYWxcIiwgeyBjbGFzczogXCJpbWFnZS11cGxvYWRfX21vZGFsXCIsIG9wZW46IHRoaXMuYWN0aXZlLCByb2xlOiBcImRpYWxvZ1wiLCBcImFyaWEtbW9kYWxcIjogXCJ0cnVlXCIsIFwiYXJpYS1sYWJlbGxlZGJ5XCI6IFwiaW1hZ2UtdXBsb2FkLW1vZGFsLXRpdGxlXCIsIG91dHNpZGVDbG9zZURpc2FibGVkOiB0cnVlLCBvbkNhbGNpdGVNb2RhbENsb3NlOiB0aGlzLmhhbmRsZUNhbmNlbCB9LCBoKFwiaDNcIiwgeyBzbG90OiBcImhlYWRlclwiLCBpZDogXCJpbWFnZS11cGxvYWQtbW9kYWwtdGl0bGVcIiwgY2xhc3M6IFwiaW1hZ2UtdXBsb2FkX190aXRsZVwiLCBcImFyaWEtbGFiZWxcIjogdGhpcy5tb2RhbFRpdGxlIH0sIHRoaXMubW9kYWxUaXRsZSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRlbnRcIiwgY2xhc3M6IHtcbiAgICAgICAgXCJpbWFnZS11cGxvYWRfX2NvbnRlbnRcIjogdHJ1ZSxcbiAgICAgICAgXCJpbWFnZS11cGxvYWRfX2NvbnRlbnQtLXdpdGgtbWFwXCI6IGhhc01hcCxcbiAgICAgICAgXCJpbWFnZS11cGxvYWRfX2NvbnRlbnQtLW5vLXBhZGRpbmdcIjogdGhpcy5hY3RpdmVTdGVwID09PSBcIm1hcFwiXG4gICAgICB9IH0sIHRoaXMuYWN0aXZlU3RlcCA9PT0gXCJmaWxlXCIgJiYgKGgoXCJkaXZcIiwgbnVsbCwgaChcImFyY2dpcy1pbWFnZS11cGxvYWQtZmlsZS1zdGVwXCIsIHsgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgdGhpcy5maWxlU3RlcCA9IGVsO1xuICAgICAgfSwgc3RyaW5nczogdGhpcy5zdHJpbmdzLCBzaXplRGVzY3JpcHRpb246IHRoaXMuc2l6ZURlc2NyaXB0aW9uIH0pLCBoYXNNYXAgJiYgKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogXCJvci1jb250YWluZXJcIiB9LCBoKFwic3BhblwiLCB7IGNsYXNzOiBcIm9yLXdyYXBwZXJcIiB9LCB0aGlzLnN0cmluZ3Mub3IpKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImltYWdlLXVwbG9hZF9fZnJvbS1tYXAtYnV0dG9uXCIsIHRhYkluZGV4OiAwLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUZyb21NYXBDbGljaywgb25LZXlEb3duOiAoZXZ0KSA9PiB7XG4gICAgICAgIGlmIChldnQuY29kZSA9PT0gXCJTcGFjZVwiIHx8IGV2dC5jb2RlID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICB0aGlzLmhhbmRsZUZyb21NYXBDbGljaygpO1xuICAgICAgICB9XG4gICAgICB9IH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJpbWFnZS11cGxvYWRfX2Zyb20tbWFwLXRpdGxlXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImZyb20tbWFwLXRpdGxlLXdyYXBwZXJcIiB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgaWNvbjogXCJtYXBcIiwgc2NhbGU6IFwibVwiLCBjbGFzczogXCJmcm9tLW1hcC1pY29uXCIgfSksIHRoaXMuc3RyaW5ncy5mcm9tTWFwKSksIGgoXCJwXCIsIHsgY2xhc3M6IFwiaW1hZ2UtdXBsb2FkX19mcm9tLW1hcC1kZXNjXCIgfSwgdGhpcy5zdHJpbmdzLmZyb21NYXBEZXNjKSkpKSkpLCB0aGlzLmFjdGl2ZVN0ZXAgPT09IFwibWFwXCIgJiYgKGgoXCJhcmNnaXMtaW1hZ2UtdXBsb2FkLWZyb20tbWFwXCIsIHsgcG9ydGFsOiB0aGlzLnBvcnRhbCwgaXRlbUlkOiB0aGlzLml0ZW1JZCwganNhcGlVcmw6IHRoaXMuanNhcGlVcmwsIGNoYW5nZUJhc2VtYXBUZXh0OiB0aGlzLnN0cmluZ3MuY2hhbmdlQmFzZW1hcCwgbG9hZGluZ1RleHQ6IHRoaXMuc3RyaW5ncy5sb2FkaW5nLCBvbkFyY2dpc0ltYWdlVXBsb2FkRnJvbU1hcFJlYWR5OiB0aGlzLmhhbmRsZU1hcFZpZXdMb2FkZWQgfSkpLCB0aGlzLmFjdGl2ZVN0ZXAgPT09IFwiZWRpdFwiICYmIChoKFwiYXJjZ2lzLWltYWdlLXVwbG9hZC1lZGl0LXN0ZXBcIiwgeyByZWY6IChlbCkgPT4ge1xuICAgICAgICB0aGlzLmVkaXRTdGVwRWwgPSBlbDtcbiAgICAgIH0sIHN0cmluZ3M6IHRoaXMuc3RyaW5ncywgaGVpZ2h0OiB0aGlzLmhlaWdodCwgYXNwZWN0UmF0aW86IHRoaXMuYXNwZWN0UmF0aW8sIHByZXZpZXdTcmM6IHRoaXMucHJldmlld1NyYywgem9vbVRvRml0OiB0aGlzLnpvb21Ub0ZpdCB9KSksIHRoaXMuYWN0aXZlU3RlcCA9PT0gXCJlZGl0XCIgJiYgKGgoXCJjYW52YXNcIiwgeyByZWY6IChlbCkgPT4ge1xuICAgICAgICB0aGlzLmNhbnZhc0VsID0gZWw7XG4gICAgICB9LCBjbGFzczogXCJpbWFnZS11cGxvYWRfX2NhbnZhc1wiIH0pKSwgaChcImNhbGNpdGUtYWxlcnRcIiwgeyBsYWJlbDogdGhpcy5zdHJpbmdzLmltYWdlUmVxdWlyZWQsIG9wZW46IHRoaXMuc2hvd0Vycm9yLCByZWY6IChlbCkgPT4ge1xuICAgICAgICB0aGlzLmFsZXJ0RWwgPSBlbDtcbiAgICAgIH0sIGljb246IFwiZXhjbGFtYXRpb24tbWFyay1jaXJjbGVcIiwgcGxhY2VtZW50OiBcImJvdHRvbVwiLCBraW5kOiBcImRhbmdlclwiIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcIm1lc3NhZ2VcIiB9LCB0aGlzLnN0cmluZ3MuaW1hZ2VSZXF1aXJlZCkpKSwgKHRoaXMuYWN0aXZlU3RlcCA9PT0gXCJlZGl0XCIgfHwgdGhpcy5hY3RpdmVTdGVwID09PSBcIm1hcFwiKSAmJiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJiYWNrXCIsIGFwcGVhcmFuY2U6IFwidHJhbnNwYXJlbnRcIiwgXCJpY29uLXN0YXJ0XCI6IFwiY2hldnJvbi1sZWZ0XCIsIHdpZHRoOiBcImZ1bGxcIiwgZGlzYWJsZWQ6IHRoaXMuc2F2aW5nLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNob29zZURpZmZDbGljaywgaWNvbkZsaXBSdGw6IFwic3RhcnRcIiB9LCB0aGlzLnN0cmluZ3MuY2hvb3NlRGlmZikpLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcInNlY29uZGFyeVwiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCB3aWR0aDogXCJmdWxsXCIsIGRpc2FibGVkOiB0aGlzLnNhdmluZywgb25DbGljazogdGhpcy5oYW5kbGVDYW5jZWwgfSwgdGhpcy5zdHJpbmdzLmNhbmNlbCksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwicHJpbWFyeVwiLCBhcHBlYXJhbmNlOiBcInNvbGlkXCIsIHdpZHRoOiBcImZ1bGxcIiwgbG9hZGluZzogdGhpcy5zYXZpbmcsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlU2F2ZUNsaWNrIH0sIHRoaXMuc3RyaW5ncy5zYXZlKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICBcImFjdGl2ZVwiOiBbXCJoYW5kbGVBY3RpdmVDaGFuZ2VcIl1cbiAgfTsgfVxufTtcbkFyY2dpc0ltYWdlVXBsb2FkLnN0eWxlID0gYXJjZ2lzSW1hZ2VVcGxvYWRDc3M7XG5cbmNvbnN0IGFyY2dpc0ltYWdlVXBsb2FkRWRpdFN0ZXBDc3MgPSBcIjpob3N0e292ZXJmbG93OmhpZGRlbjtkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOnJlbGF0aXZlO21pbi1oZWlnaHQ6MjAuNjI1cmVtfS5lZGl0LXN0ZXBfX2xvYWRlcntwb3NpdGlvbjphYnNvbHV0ZTt0b3A6NTAlO2xlZnQ6NTAlO3RyYW5zZm9ybTp0cmFuc2xhdGUoLTUwJSwgLTUwJSl9LmVkaXQtc3RlcF9fY3JvcC10aHVtYi1jb250YWluZXJ7cG9zaXRpb246cmVsYXRpdmU7d2lkdGg6MTAwJTtvdmVyZmxvdzpoaWRkZW59LmVkaXQtc3RlcF9fY3JvcC10aHVtYi1jb250YWluZXItLWhpZGRlbnt2aXNpYmlsaXR5OmhpZGRlbn0uZWRpdC1zdGVwX190cmFuc2x1Y2VudC1jb250YWluZXJ7b3ZlcmZsb3c6aGlkZGVuO3Bvc2l0aW9uOmFic29sdXRlO3RvcDowO2xlZnQ6NTAlO2N1cnNvcjphbGwtc2Nyb2xsO3RyYW5zZm9ybTp0cmFuc2xhdGUoLTUwJSl9LmVkaXQtc3RlcF9fdHJhbnNsdWNlbnQtY29udGFpbmVyOmFmdGVye2JveC1zaXppbmc6Ym9yZGVyLWJveDtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtyaWdodDowO2JvdHRvbTowO2xlZnQ6MDt3aWR0aDoxMDAlO2hlaWdodDoxMDAlO2NvbnRlbnQ6XFxcIlxcXCI7b3BhY2l0eTowLjk7Ym9yZGVyOjEuODc1cmVtIHNvbGlkIHdoaXRlfS5lZGl0LXN0ZXBfX3RyYW5zcGFyZW50LWNvbnRhaW5lcntwb3NpdGlvbjphYnNvbHV0ZTtvdmVyZmxvdy14OnZpc2libGU7Ym94LXNpemluZzpib3JkZXItYm94O291dGxpbmU6MnB4IHNvbGlkIHRyYW5zcGFyZW50O291dGxpbmUtb2Zmc2V0OjJweDtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0zKTtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktYm9yZGVyLTEpO21hcmdpbi1yaWdodDotNTAlO3RvcDo1MCU7bGVmdDo1MCU7dHJhbnNmb3JtOnRyYW5zbGF0ZSgtNTAlLCAtNTAlKX0uZWRpdC1zdGVwX19wcmV2aWV3LWltYWdle21hcmdpbjowO3Bvc2l0aW9uOmFic29sdXRlO2xlZnQ6MDt0b3A6MDt0cmFuc2Zvcm0tb3JpZ2luOjUwJSA1MCV9LmVkaXQtc3RlcF9fcHJldmlldy1pbWFnZS0tbG9hZGluZ3t2aXNpYmlsaXR5OmhpZGRlbn0uZWRpdC1zdGVwX190cmFuc3BhcmVudC1jb250YWluZXI6Zm9jdXMgLmVkaXQtc3RlcF9fcHJldmlldy1pbWFnZXtib3gtc2hhZG93OjBweCAwcHggNnB4IDRweCB2YXIoLS1jYWxjaXRlLXVpLWJyYW5kKX0uZWRpdC1zdGVwX196b29tLWNvbnRyb2x7LS1jYWxjaXRlLWxhYmVsLW1hcmdpbi1ib3R0b206MH0uZWRpdC1zdGVwX196b29tLWNvbnRyb2wtLWhpZGRlbnt2aXNpYmlsaXR5OmhpZGRlbn0uZWRpdC1zdGVwX196b29tLWNvbnRyb2wtbGFiZWx7ZGlzcGxheTpmbGV4O2hlaWdodDoycmVtfS5lZGl0LXN0ZXBfX3pvb20tY29udHJvbC1sYWJlbC1zcGFjZXJ7ZmxleDoxIDEgMCV9XCI7XG5cbmNvbnN0IEFyY2dpc0ltYWdlVXBsb2FkRWRpdFN0ZXAgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzSW1hZ2VVcGxvYWRFZGl0U3RlcEltYWdlQ2hhbmdlZCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSW1hZ2VVcGxvYWRFZGl0U3RlcEltYWdlQ2hhbmdlZFwiLCA3KTtcbiAgICB0aGlzLmhhbmRsZVdoZWVsID0gKGV2ZW50KSA9PiB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY29uc3QgaW1hZ2VTY2FsZSA9IGV2ZW50LmRlbHRhWSA+IDAgPyAodGhpcy5pbWFnZVByb3BlcnRpZXMuc2NhbGUgKiAxKSAvIDEuMSA6IHRoaXMuaW1hZ2VQcm9wZXJ0aWVzLnNjYWxlICogMS4xO1xuICAgICAgdGhpcy56b29tVmFsdWUgPSBgJHs1MCArIE1hdGgubG9nKGltYWdlU2NhbGUpIC8gTWF0aC5sb2coMS4xKX1gO1xuICAgICAgdGhpcy5pbWFnZVByb3BlcnRpZXMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzKSwgeyBzY2FsZTogaW1hZ2VTY2FsZSB9KTtcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlRHJhZ1N0YXJ0ID0gKCkgPT4ge1xuICAgICAgdGhpcy5kcmFnZ2luZyA9IHRydWU7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZURyYWcgPSAoZXZlbnQpID0+IHtcbiAgICAgIGlmICghdGhpcy5kcmFnZ2luZykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCB7IHRvdWNoZXMgfSA9IGV2ZW50O1xuICAgICAgbGV0IHsgY2xpZW50WCwgY2xpZW50WSB9ID0gZXZlbnQ7XG4gICAgICBpZiAoY2xpZW50WCA9PT0gdW5kZWZpbmVkIHx8IGNsaWVudFkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAvLyBvbiB0b3VjaCBkZXZpY2VzLCB1c2UgdGhlIGNsaWVudFggYW5kIGNsaWVudFkgcHJvcGVydGllcyBpbnNpZGUgdG91Y2hlcyBhcnJheSBwcm9wZXJ0eVxuICAgICAgICBpZiAoIXRvdWNoZXMubGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNsaWVudFggPSB0b3VjaGVzWzBdLmNsaWVudFg7XG4gICAgICAgIGNsaWVudFkgPSB0b3VjaGVzWzBdLmNsaWVudFk7XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMucHJldmlvdXNQb3NpdGlvbikge1xuICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24gPSB7XG4gICAgICAgICAgdG9wOiBjbGllbnRZLFxuICAgICAgICAgIGxlZnQ6IGNsaWVudFhcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgeyB0b3AsIGxlZnQgfSA9IHRoaXMucHJldmlvdXNQb3NpdGlvbjtcbiAgICAgIGNvbnN0IHlEaWZmID0gY2xpZW50WSAtIHRvcDtcbiAgICAgIGNvbnN0IHhEaWZmID0gY2xpZW50WCAtIGxlZnQ7XG4gICAgICB0aGlzLmltYWdlUHJvcGVydGllcyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5pbWFnZVByb3BlcnRpZXMpLCB7IHRvcDogdGhpcy5pbWFnZVByb3BlcnRpZXMudG9wICsgeURpZmYsIGxlZnQ6IHRoaXMuaW1hZ2VQcm9wZXJ0aWVzLmxlZnQgKyB4RGlmZiB9KTtcbiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IHtcbiAgICAgICAgdG9wOiB0b3AgKyB5RGlmZixcbiAgICAgICAgbGVmdDogbGVmdCArIHhEaWZmXG4gICAgICB9O1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVEcmFnRW5kID0gKCkgPT4ge1xuICAgICAgdGhpcy5kcmFnZ2luZyA9IGZhbHNlO1xuICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uID0gdW5kZWZpbmVkO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVJbWFnZUxvYWRlZCA9ICgpID0+IHtcbiAgICAgIGlmICh0aGlzLmVkaXRpbmdFeGlzdGluZykge1xuICAgICAgICB0aGlzLmxvYWRpbmdJbWFnZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmltYWdlUHJvcGVydGllcyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5pbWFnZVByb3BlcnRpZXMpLCB7IHNjYWxlOiB0aGlzLmhlaWdodCAvIHRoaXMuaW1hZ2VFbC53aWR0aCwgdG9wOiAwLCBsZWZ0OiAwLCBvcmlnaW46IHsgeDogXCIwJVwiLCB5OiBcIjAlXCIgfSB9KTtcbiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLmhlaWdodCAqIHRoaXMuYXNwZWN0UmF0aW87XG4gICAgICBjb25zdCB7IGNsaWVudFdpZHRoLCBjbGllbnRIZWlnaHQgfSA9IHRoaXMuaW1hZ2VFbDtcbiAgICAgIGNvbnN0IGhlaWdodFNjYWxlID0gKHRoaXMuaGVpZ2h0ICsgMikgLyBjbGllbnRIZWlnaHQ7XG4gICAgICBjb25zdCB3aWR0aFNjYWxlID0gKHdpZHRoICsgMikgLyBjbGllbnRXaWR0aDtcbiAgICAgIGNvbnN0IGltYWdlU2NhbGUgPSBoZWlnaHRTY2FsZSA+IHdpZHRoU2NhbGUgPyBoZWlnaHRTY2FsZSA6IHdpZHRoU2NhbGU7XG4gICAgICBsZXQgdXBkYXRlcyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzKTtcbiAgICAgIHVwZGF0ZXMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHVwZGF0ZXMpLCB7IHRvcDogTWF0aC5mbG9vcih0aGlzLmhlaWdodCAvIDIgLSBjbGllbnRIZWlnaHQgLyAyKSwgbGVmdDogTWF0aC5mbG9vcigodGhpcy5oZWlnaHQgKiB0aGlzLmFzcGVjdFJhdGlvKSAvIDIgLSBjbGllbnRXaWR0aCAvIDIpLCBvcmlnaW46IHsgeDogXCI1MCVcIiwgeTogXCI1MCVcIiB9IH0pO1xuICAgICAgaWYgKHRoaXMuem9vbVRvRml0KSB7XG4gICAgICAgIHVwZGF0ZXMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHVwZGF0ZXMpLCB7IHRvcDogdXBkYXRlcy50b3AgLSAxLCBsZWZ0OiB1cGRhdGVzLmxlZnQgLSAxLCBzY2FsZTogaW1hZ2VTY2FsZSB9KTtcbiAgICAgICAgdGhpcy5pbml0aWFsbHlTZXR0aW5nWm9vbSA9IHRydWU7XG4gICAgICAgIHRoaXMuem9vbVZhbHVlID0gYCR7NTAgKyBNYXRoLmxvZyhpbWFnZVNjYWxlKSAvIE1hdGgubG9nKDEuMSl9YDtcbiAgICAgIH1cbiAgICAgIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbih7fSwgdXBkYXRlcyk7XG4gICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVab29tSW5wdXQgPSAoZXZlbnQpID0+IHtcbiAgICAgIGlmICh0aGlzLmluaXRpYWxseVNldHRpbmdab29tKSB7XG4gICAgICAgIHRoaXMuaW5pdGlhbGx5U2V0dGluZ1pvb20gPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHRoaXMuem9vbVZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgICAgdGhpcy5pbWFnZVByb3BlcnRpZXMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzKSwgeyBzY2FsZTogTWF0aC5wb3coMS4xLCBldmVudC50YXJnZXQudmFsdWUgLSA1MCkgfSk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZUltYWdlS2V5ZG93biA9IChldmVudCkgPT4ge1xuICAgICAgY29uc3Qga2V5ID0gZXZlbnQua2V5O1xuICAgICAgbGV0IG1vZGlmaWVkID0gZmFsc2U7XG4gICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICBjYXNlIFwiQXJyb3dVcFwiOlxuICAgICAgICAgIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLmltYWdlUHJvcGVydGllcyksIHsgdG9wOiB0aGlzLmltYWdlUHJvcGVydGllcy50b3AgLSAxIH0pO1xuICAgICAgICAgIG1vZGlmaWVkID0gdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIkFycm93RG93blwiOlxuICAgICAgICAgIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLmltYWdlUHJvcGVydGllcyksIHsgdG9wOiB0aGlzLmltYWdlUHJvcGVydGllcy50b3AgKyAxIH0pO1xuICAgICAgICAgIG1vZGlmaWVkID0gdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIkFycm93TGVmdFwiOlxuICAgICAgICAgIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLmltYWdlUHJvcGVydGllcyksIHsgbGVmdDogdGhpcy5pbWFnZVByb3BlcnRpZXMubGVmdCAtIDEgfSk7XG4gICAgICAgICAgbW9kaWZpZWQgPSB0cnVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiQXJyb3dSaWdodFwiOlxuICAgICAgICAgIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLmltYWdlUHJvcGVydGllcyksIHsgbGVmdDogdGhpcy5pbWFnZVByb3BlcnRpZXMubGVmdCArIDEgfSk7XG4gICAgICAgICAgbW9kaWZpZWQgPSB0cnVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYgKG1vZGlmaWVkKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLnN0cmluZ3MgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5hc3BlY3RSYXRpbyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnByZXZpZXdTcmMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sb2FkaW5nSW1hZ2UgPSBmYWxzZTtcbiAgICB0aGlzLmVkaXRpbmdFeGlzdGluZyA9IGZhbHNlO1xuICAgIHRoaXMuem9vbVRvRml0ID0gZmFsc2U7XG4gICAgdGhpcy5oZWlnaHQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pbWFnZVByb3BlcnRpZXMgPSB7XG4gICAgICBzY2FsZTogMSxcbiAgICAgIHRvcDogMCxcbiAgICAgIGxlZnQ6IDAsXG4gICAgICBvcmlnaW46IHtcbiAgICAgICAgeDogXCI1MCVcIixcbiAgICAgICAgeTogXCI1MCVcIlxuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5kcmFnZ2luZyA9IGZhbHNlO1xuICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnByZXZpZXdTdHlsZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnpvb21WYWx1ZSA9IFwiNTBcIjtcbiAgICB0aGlzLmluaXRpYWxseVNldHRpbmdab29tID0gZmFsc2U7XG4gICAgdGhpcy5maXJzdEltYWdlUHJvcGVydGllc0NoYW5nZSA9IHRydWU7XG4gICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuICB9XG4gIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIGNvbnN0IHBhZGRpbmcgPSA2MDtcbiAgICBjb25zdCB3aWR0aCA9IHRoaXMuaGVpZ2h0ICogdGhpcy5hc3BlY3RSYXRpbztcbiAgICBjb25zdCBoZWlnaHRXaXRoUGFkZGluZ1B4ID0gYCR7dGhpcy5oZWlnaHQgKyBwYWRkaW5nfXB4YDtcbiAgICB0aGlzLnRodW1iQ29udGFpbmVyU3R5bGUgPSB7XG4gICAgICBoZWlnaHQ6IGhlaWdodFdpdGhQYWRkaW5nUHhcbiAgICB9O1xuICAgIHRoaXMudHJhbnNsdWNlbnRDb250YWluZXJTdHlsZSA9IHtcbiAgICAgIHdpZHRoOiBgJHt3aWR0aCArIHBhZGRpbmd9cHhgLFxuICAgICAgaGVpZ2h0OiBoZWlnaHRXaXRoUGFkZGluZ1B4XG4gICAgfTtcbiAgICB0aGlzLnRyYW5zcGFyZW50Q29udGFpbmVyU3R5bGUgPSB7XG4gICAgICB3aWR0aDogYCR7d2lkdGh9cHhgLFxuICAgICAgaGVpZ2h0OiBgJHt0aGlzLmhlaWdodH1weGBcbiAgICB9O1xuICAgIHRoaXMucHJldmlld1N0eWxlID0ge1xuICAgICAgdHJhbnNmb3JtOiBgc2NhbGUoJHt0aGlzLmltYWdlUHJvcGVydGllcy5zY2FsZX0pYCxcbiAgICAgIHRvcDogYCR7dGhpcy5pbWFnZVByb3BlcnRpZXMudG9wfXB4YCxcbiAgICAgIGxlZnQ6IGAke3RoaXMuaW1hZ2VQcm9wZXJ0aWVzLmxlZnR9cHhgLFxuICAgICAgdHJhbnNmb3JtT3JpZ2luOiBgJHt0aGlzLmltYWdlUHJvcGVydGllcy5vcmlnaW4ueH0gJHt0aGlzLmltYWdlUHJvcGVydGllcy5vcmlnaW4ueX1gXG4gICAgfTtcbiAgfVxuICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgIHRoaXMuaW1hZ2VDb250YWluZXJFbC5mb2N1cygpO1xuICB9XG4gIGdldEltYWdlRXh0ZW50KCkge1xuICAgIGNvbnN0IGltYWdlUmVjdCA9IHRoaXMuaW1hZ2VFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCBjb250YWluZXJSZWN0ID0gdGhpcy5pbWFnZUNvbnRhaW5lckVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJldHVybiB7XG4gICAgICBsZWZ0OiAoY29udGFpbmVyUmVjdC5sZWZ0IC0gaW1hZ2VSZWN0LmxlZnQpIC8gaW1hZ2VSZWN0LndpZHRoLFxuICAgICAgcmlnaHQ6IChjb250YWluZXJSZWN0LnJpZ2h0IC0gaW1hZ2VSZWN0LmxlZnQpIC8gaW1hZ2VSZWN0LndpZHRoLFxuICAgICAgdG9wOiAoY29udGFpbmVyUmVjdC50b3AgLSBpbWFnZVJlY3QudG9wKSAvIGltYWdlUmVjdC5oZWlnaHQsXG4gICAgICBib3R0b206IChjb250YWluZXJSZWN0LmJvdHRvbSAtIGltYWdlUmVjdC50b3ApIC8gaW1hZ2VSZWN0LmhlaWdodFxuICAgIH07XG4gIH1cbiAgZ2V0RHJhd0RpbWVuc2lvbnMoKSB7XG4gICAgY29uc3QgaW1hZ2VSZWN0ID0gdGhpcy5pbWFnZUVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IHNlbGVjdGVkUmVjdCA9IHRoaXMuaW1hZ2VDb250YWluZXJFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCB0b3AgPSBpbWFnZVJlY3QudG9wIC0gc2VsZWN0ZWRSZWN0LnRvcCA+IDAgPyBpbWFnZVJlY3QudG9wIC0gc2VsZWN0ZWRSZWN0LnRvcCA6IDA7XG4gICAgY29uc3QgbGVmdCA9IGltYWdlUmVjdC5sZWZ0IC0gc2VsZWN0ZWRSZWN0LmxlZnQgPiAwID8gaW1hZ2VSZWN0LmxlZnQgLSBzZWxlY3RlZFJlY3QubGVmdCA6IDA7XG4gICAgY29uc3QgbmV3SW1nTGVmdCA9IGltYWdlUmVjdC5sZWZ0IDwgc2VsZWN0ZWRSZWN0LmxlZnQgPyBzZWxlY3RlZFJlY3QubGVmdCA6IGltYWdlUmVjdC5sZWZ0O1xuICAgIGNvbnN0IG5ld0ltZ1RvcCA9IGltYWdlUmVjdC50b3AgPCBzZWxlY3RlZFJlY3QudG9wID8gc2VsZWN0ZWRSZWN0LnRvcCA6IGltYWdlUmVjdC50b3A7XG4gICAgY29uc3QgbmV3SW1nUmlnaHQgPSBpbWFnZVJlY3QucmlnaHQgPiBzZWxlY3RlZFJlY3QucmlnaHQgPyBzZWxlY3RlZFJlY3QucmlnaHQgOiBpbWFnZVJlY3QucmlnaHQ7XG4gICAgY29uc3QgbmV3SW1nQm90dG9tID0gaW1hZ2VSZWN0LmJvdHRvbSA+IHNlbGVjdGVkUmVjdC5ib3R0b20gPyBzZWxlY3RlZFJlY3QuYm90dG9tIDogaW1hZ2VSZWN0LmJvdHRvbTtcbiAgICByZXR1cm4ge1xuICAgICAgbGVmdDogbGVmdCAvIHNlbGVjdGVkUmVjdC53aWR0aCxcbiAgICAgIHRvcDogdG9wIC8gc2VsZWN0ZWRSZWN0LmhlaWdodCxcbiAgICAgIHdpZHRoOiAobmV3SW1nUmlnaHQgLSBuZXdJbWdMZWZ0KSAvIHNlbGVjdGVkUmVjdC53aWR0aCxcbiAgICAgIGhlaWdodDogKG5ld0ltZ0JvdHRvbSAtIG5ld0ltZ1RvcCkgLyBzZWxlY3RlZFJlY3QuaGVpZ2h0XG4gICAgfTtcbiAgfVxuICBhc3luYyBnZXREcmF3UGFyYW1ldGVycygpIHtcbiAgICBjb25zdCBtaW5XaWR0aCA9IHRoaXMuaGVpZ2h0ICogdGhpcy5hc3BlY3RSYXRpbztcbiAgICBjb25zdCBtaW5IZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICBjb25zdCB7IGxlZnQsIHJpZ2h0LCB0b3AsIGJvdHRvbSB9ID0gdGhpcy5nZXRJbWFnZUV4dGVudCgpO1xuICAgIGNvbnN0IHNvdXJjZUV4dGVudCA9IHtcbiAgICAgIGxlZnQ6IGxlZnQgPCAwID8gMCA6IGxlZnQsXG4gICAgICB0b3A6IHRvcCA8IDAgPyAwIDogdG9wLFxuICAgICAgcmlnaHQ6IHJpZ2h0ID4gMSA/IDEgOiByaWdodCxcbiAgICAgIGJvdHRvbTogYm90dG9tID4gMSA/IDEgOiBib3R0b21cbiAgICB9O1xuICAgIGNvbnN0IGRyYXdEaW1lbnNpb25zID0gdGhpcy5nZXREcmF3RGltZW5zaW9ucygpO1xuICAgIGNvbnN0IGltYWdlV2lkdGggPSB0aGlzLmltYWdlRWwuY2xpZW50V2lkdGg7XG4gICAgY29uc3QgaW1hZ2VIZWlnaHQgPSB0aGlzLmltYWdlRWwuY2xpZW50SGVpZ2h0O1xuICAgIGNvbnN0IHNlbGVjdGlvblggPSBzb3VyY2VFeHRlbnQubGVmdCAqIGltYWdlV2lkdGg7XG4gICAgY29uc3Qgc2VsZWN0aW9uWSA9IHNvdXJjZUV4dGVudC50b3AgKiBpbWFnZUhlaWdodDtcbiAgICBjb25zdCBzZWxlY3Rpb25XaWR0aCA9IHNvdXJjZUV4dGVudC5yaWdodCAqIGltYWdlV2lkdGggLSBzb3VyY2VFeHRlbnQubGVmdCAqIGltYWdlV2lkdGg7XG4gICAgY29uc3Qgc2VsZWN0aW9uSGVpZ2h0ID0gc291cmNlRXh0ZW50LmJvdHRvbSAqIGltYWdlSGVpZ2h0IC0gc291cmNlRXh0ZW50LnRvcCAqIGltYWdlSGVpZ2h0O1xuICAgIGNvbnN0IGNhbnZhc1dpZHRoID0gcmlnaHQgKiBpbWFnZVdpZHRoIC0gbGVmdCAqIGltYWdlV2lkdGg7XG4gICAgY29uc3QgY2FudmFzSGVpZ2h0ID0gYm90dG9tICogaW1hZ2VIZWlnaHQgLSB0b3AgKiBpbWFnZUhlaWdodDtcbiAgICByZXR1cm4ge1xuICAgICAgc2VsZWN0aW9uWCxcbiAgICAgIHNlbGVjdGlvblksXG4gICAgICBzZWxlY3Rpb25XaWR0aCxcbiAgICAgIHNlbGVjdGlvbkhlaWdodCxcbiAgICAgIGNhbnZhc1dpZHRoLFxuICAgICAgY2FudmFzSGVpZ2h0LFxuICAgICAgbWluV2lkdGgsXG4gICAgICBtaW5IZWlnaHQsXG4gICAgICBkcmF3RGltZW5zaW9uc1xuICAgIH07XG4gIH1cbiAgaGFuZGxlSW1hZ2VQcm9wZXJ0aWVzQ2hhbmdlKCkge1xuICAgIHRoaXMucHJldmlld1N0eWxlID0ge1xuICAgICAgdHJhbnNmb3JtOiBgc2NhbGUoJHt0aGlzLmltYWdlUHJvcGVydGllcy5zY2FsZX0pYCxcbiAgICAgIHRvcDogYCR7dGhpcy5pbWFnZVByb3BlcnRpZXMudG9wfXB4YCxcbiAgICAgIGxlZnQ6IGAke3RoaXMuaW1hZ2VQcm9wZXJ0aWVzLmxlZnR9cHhgLFxuICAgICAgdHJhbnNmb3JtT3JpZ2luOiBgJHt0aGlzLmltYWdlUHJvcGVydGllcy5vcmlnaW4ueH0gJHt0aGlzLmltYWdlUHJvcGVydGllcy5vcmlnaW4ueX1gXG4gICAgfTtcbiAgICBpZiAodGhpcy5maXJzdEltYWdlUHJvcGVydGllc0NoYW5nZSkge1xuICAgICAgdGhpcy5maXJzdEltYWdlUHJvcGVydGllc0NoYW5nZSA9IGZhbHNlO1xuICAgICAgaWYgKHRoaXMuem9vbVRvRml0KSB7XG4gICAgICAgIHRoaXMuYXJjZ2lzSW1hZ2VVcGxvYWRFZGl0U3RlcEltYWdlQ2hhbmdlZC5lbWl0KCk7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5hcmNnaXNJbWFnZVVwbG9hZEVkaXRTdGVwSW1hZ2VDaGFuZ2VkLmVtaXQoKTtcbiAgICB9XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoaChIb3N0LCB7IG9uV2hlZWw6IHRoaXMuaGFuZGxlV2hlZWwgfSwgaChcImNhbGNpdGUtbG9hZGVyXCIsIHsgY2xhc3M6IFwiZWRpdC1zdGVwX19sb2FkZXJcIiwgbGFiZWw6IFwiXCIsIGhpZGRlbjogIXRoaXMuaXNMb2FkaW5nIH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IGBlZGl0LXN0ZXBfX2Nyb3AtdGh1bWItY29udGFpbmVyICR7dGhpcy5pc0xvYWRpbmcgPyBcImVkaXQtc3RlcF9fY3JvcC10aHVtYi1jb250YWluZXItLWhpZGRlblwiIDogXCJcIn1gLCBzdHlsZTogdGhpcy50aHVtYkNvbnRhaW5lclN0eWxlIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJlZGl0LXN0ZXBfX3RyYW5zbHVjZW50LWNvbnRhaW5lclwiLCBzdHlsZTogdGhpcy50cmFuc2x1Y2VudENvbnRhaW5lclN0eWxlLCBvbk1vdXNlRG93bjogdGhpcy5oYW5kbGVEcmFnU3RhcnQsIG9uVG91Y2hTdGFydDogdGhpcy5oYW5kbGVEcmFnU3RhcnQsIG9uTW91c2VNb3ZlOiB0aGlzLmhhbmRsZURyYWcsIG9uVG91Y2hNb3ZlOiB0aGlzLmhhbmRsZURyYWcsIG9uTW91c2VVcDogdGhpcy5oYW5kbGVEcmFnRW5kLCBvblRvdWNoRW5kOiB0aGlzLmhhbmRsZURyYWdFbmQsIG9uTW91c2VPdXQ6IHRoaXMuaGFuZGxlRHJhZ0VuZCB9LCBoKFwiZGl2XCIsIHsgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgdGhpcy5pbWFnZUNvbnRhaW5lckVsID0gZWw7XG4gICAgICB9LCBjbGFzczogXCJlZGl0LXN0ZXBfX3RyYW5zcGFyZW50LWNvbnRhaW5lclwiLCB0YWJJbmRleDogMCwgc3R5bGU6IHRoaXMudHJhbnNwYXJlbnRDb250YWluZXJTdHlsZSwgb25LZXlEb3duOiB0aGlzLmhhbmRsZUltYWdlS2V5ZG93biB9LCBoKFwiaW1nXCIsIHsgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgdGhpcy5pbWFnZUVsID0gZWw7XG4gICAgICB9LCBzcmM6IHRoaXMucHJldmlld1NyYywgYWx0OiBcIlwiLCBjbGFzczogYGVkaXQtc3RlcF9fcHJldmlldy1pbWFnZSAke3RoaXMubG9hZGluZ0ltYWdlID8gXCJlZGl0LXN0ZXBfX3ByZXZpZXctaW1hZ2UtLWxvYWRpbmdcIiA6IFwiXCJ9YCwgc3R5bGU6IHRoaXMucHJldmlld1N0eWxlLCBvbkxvYWQ6IHRoaXMuaGFuZGxlSW1hZ2VMb2FkZWQgfSkpKSksIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgY2xhc3M6IHtcbiAgICAgICAgXCJlZGl0LXN0ZXBfX3pvb20tY29udHJvbFwiOiB0cnVlLFxuICAgICAgICBcImVkaXQtc3RlcF9fem9vbS1jb250cm9sLS1oaWRkZW5cIjogdGhpcy5pc0xvYWRpbmdcbiAgICAgIH0gfSwgdGhpcy5zdHJpbmdzLnpvb20sIGgoXCJjYWxjaXRlLXNsaWRlclwiLCB7IFwiYXJpYS1sYWJlbFwiOiB0aGlzLnN0cmluZ3Muem9vbSwgc2NhbGU6IFwibFwiLCBtaW46IDAsIG1heDogMTAwLCB2YWx1ZTogK3RoaXMuem9vbVZhbHVlLCBvbkNhbGNpdGVTbGlkZXJJbnB1dDogdGhpcy5oYW5kbGVab29tSW5wdXQsIG1pcnJvcmVkOiBnZXRFbGVtZW50RGlyKHRoaXMuZWwpID09PSBcInJ0bFwiIH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZWRpdC1zdGVwX196b29tLWNvbnRyb2wtbGFiZWxcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZWRpdC1zdGVwX196b29tLWNvbnRyb2wtaWNvbi1zXCIgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IGljb246IFwiaW1hZ2VcIiwgc2NhbGU6IFwic1wiIH0pKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImVkaXQtc3RlcF9fem9vbS1jb250cm9sLWxhYmVsLXNwYWNlclwiIH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZWRpdC1zdGVwX196b29tLWNvbnRyb2wtaWNvbi1sXCIgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IGljb246IFwiaW1hZ2VcIiwgc2NhbGU6IFwibFwiIH0pKSkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgIFwiaW1hZ2VQcm9wZXJ0aWVzXCI6IFtcImhhbmRsZUltYWdlUHJvcGVydGllc0NoYW5nZVwiXVxuICB9OyB9XG59O1xuQXJjZ2lzSW1hZ2VVcGxvYWRFZGl0U3RlcC5zdHlsZSA9IGFyY2dpc0ltYWdlVXBsb2FkRWRpdFN0ZXBDc3M7XG5cbmNvbnN0IGFyY2dpc0ltYWdlVXBsb2FkRmlsZVN0ZXBDc3MgPSBcIi5maWxlLXN0ZXB7dGV4dC1hbGlnbjpjZW50ZXJ9LmZpbGUtc3RlcF9fdXBsb2FkLWljb257bWFyZ2luLWJvdHRvbTowLjVyZW07bWFyZ2luLXRvcDowLjI1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0zKX0uZmlsZS1zdGVwX191cGxvYWQtaWNvbiBjYWxjaXRlLWljb257d2lkdGg6NHJlbTtoZWlnaHQ6NHJlbX0uZmlsZS1zdGVwX19kcmFnLXRleHR7Zm9udC1zaXplOjEuMjVyZW07bWFyZ2luLWJvdHRvbTowLjI1cmVtfS5maWxlLXN0ZXBfX2Jyb3dzZS1idXR0b257bWFyZ2luLXRvcDoxcmVtfS5maWxlLXN0ZXBfX2ZpbGUtaW5wdXR7ZGlzcGxheTpub25lfVwiO1xuXG5jb25zdCBBcmNnaXNJbWFnZVVwbG9hZEZpbGVTdGVwID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc0ltYWdlVXBsb2FkRmlsZVN0ZXBGaWxlQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJbWFnZVVwbG9hZEZpbGVTdGVwRmlsZUNoYW5nZVwiLCA3KTtcbiAgICB0aGlzLmFyY2dpc0ltYWdlVXBsb2FkRmlsZVN0ZXBJbnZhbGlkRmlsZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSW1hZ2VVcGxvYWRGaWxlU3RlcEludmFsaWRGaWxlXCIsIDcpO1xuICAgIHRoaXMuaGFuZGxlRHJhZ092ZXIgPSAoZXZlbnQpID0+IHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZURyb3AgPSAoZXZlbnQpID0+IHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLnByb2Nlc3NGaWxlKGV2ZW50LmRhdGFUcmFuc2Zlci5maWxlc1swXSk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZUZpbGVJbnB1dENoYW5nZSA9IChldmVudCkgPT4ge1xuICAgICAgdGhpcy5wcm9jZXNzRmlsZShldmVudC50YXJnZXQuZmlsZXNbMF0pO1xuICAgIH07XG4gICAgdGhpcy5zdHJpbmdzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2l6ZURlc2NyaXB0aW9uID0gdW5kZWZpbmVkO1xuICB9XG4gIGFzeW5jIHJlc2V0RmlsZUlucHV0KCkge1xuICAgIHRoaXMuZmlsZUlucHV0LnZhbHVlID0gXCJcIjtcbiAgfVxuICBwcm9jZXNzRmlsZShmaWxlKSB7XG4gICAgaWYgKCFmaWxlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChmaWxlKSB7XG4gICAgICBpZiAoIXRoaXMuaXNWYWxpZEZpbGUoZmlsZSkpIHtcbiAgICAgICAgdGhpcy5hcmNnaXNJbWFnZVVwbG9hZEZpbGVTdGVwSW52YWxpZEZpbGUuZW1pdCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgcmVhZGVyLm9ubG9hZCA9IGFzeW5jIChldmVudCkgPT4ge1xuICAgICAgICB0aGlzLmFyY2dpc0ltYWdlVXBsb2FkRmlsZVN0ZXBGaWxlQ2hhbmdlLmVtaXQoe1xuICAgICAgICAgIGRhdGFVUkw6IGV2ZW50LnRhcmdldC5yZXN1bHQsXG4gICAgICAgICAgZmlsZU5hbWU6IGZpbGUubmFtZSB8fCBcIlwiXG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuICAgIH1cbiAgfVxuICBpc1ZhbGlkRmlsZShmaWxlKSB7XG4gICAgcmV0dXJuIChmaWxlID09PSBudWxsIHx8IGZpbGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpbGUubmFtZSkgJiYgL1xcLihnaWZ8anBnfGpwZWd8cG5nKSQvaS50ZXN0KGZpbGUubmFtZSk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImZpbGUtc3RlcFwiLCBcImFyaWEtbGFiZWxcIjogdGhpcy5zdHJpbmdzLmRyYWdEcm9wLCBvbkRyYWdPdmVyOiB0aGlzLmhhbmRsZURyYWdPdmVyLCBvbkRyYWdFbnRlcjogdGhpcy5oYW5kbGVEcmFnT3Zlciwgb25Ecm9wOiB0aGlzLmhhbmRsZURyb3AgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImZpbGUtc3RlcF9fdXBsb2FkLWljb25cIiB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgaWNvbjogXCJ1cGxvYWRcIiB9KSksIGgoXCJkaXZcIiwgbnVsbCwgaChcImRpdlwiLCB7IGNsYXNzOiBcImZpbGUtc3RlcF9fZHJhZy10ZXh0XCIsIFwiYXJpYS1sYWJlbFwiOiB0aGlzLnN0cmluZ3MuZHJhZ0Ryb3AgfSwgdGhpcy5zdHJpbmdzLmRyYWdEcm9wKSwgdGhpcy5zaXplRGVzY3JpcHRpb24gJiYgKGgoXCJkaXZcIiwgeyBcImFyaWEtbGFiZWxcIjogdGhpcy5zaXplRGVzY3JpcHRpb24gfSwgdGhpcy5zaXplRGVzY3JpcHRpb24pKSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgY2xhc3M6IFwiZmlsZS1zdGVwX19icm93c2UtYnV0dG9uXCIsIGFwcGVhcmFuY2U6IFwidHJhbnNwYXJlbnRcIiwgaWNvblN0YXJ0OiBcImltYWdlXCIsIHNjYWxlOiBcImxcIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICB0aGlzLmZpbGVJbnB1dC5jbGljaygpO1xuICAgICAgfSB9LCB0aGlzLnN0cmluZ3MuYnJvd3NlKSwgaChcImlucHV0XCIsIHsgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgdGhpcy5maWxlSW5wdXQgPSBlbDtcbiAgICAgIH0sIG9uQ2hhbmdlOiB0aGlzLmhhbmRsZUZpbGVJbnB1dENoYW5nZSwgY2xhc3M6IFwiZmlsZS1zdGVwX19maWxlLWlucHV0XCIsIHR5cGU6IFwiZmlsZVwiLCBhY2NlcHQ6IFwiLmpwZywuZ2lmLC5wbmcsLmpwZWdcIiB9KSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzSW1hZ2VVcGxvYWRGaWxlU3RlcC5zdHlsZSA9IGFyY2dpc0ltYWdlVXBsb2FkRmlsZVN0ZXBDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc0ltYWdlVXBsb2FkIGFzIGFyY2dpc19pbWFnZV91cGxvYWQsIEFyY2dpc0ltYWdlVXBsb2FkRWRpdFN0ZXAgYXMgYXJjZ2lzX2ltYWdlX3VwbG9hZF9lZGl0X3N0ZXAsIEFyY2dpc0ltYWdlVXBsb2FkRmlsZVN0ZXAgYXMgYXJjZ2lzX2ltYWdlX3VwbG9hZF9maWxlX3N0ZXAgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgbCBhcyBsb2FkTW9kdWxlcyB9IGZyb20gJy4vbG9hZE1vZHVsZXMtYWFmMzBiZDYuanMnO1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5cbmNvbnN0IGxhbmd1YWdlTWFwID0gbmV3IE1hcChbXG4gIFtcImFyXCIsIFwiYXJcIl0sXG4gIFtcImJnXCIsIFwiYmdcIl0sXG4gIFtcImJzXCIsIFwiYnNcIl0sXG4gIFtcImNhXCIsIFwiY2FcIl0sXG4gIFtcImNzXCIsIFwiY3NcIl0sXG4gIFtcImRhXCIsIFwiZGFcIl0sXG4gIFtcImRlXCIsIFwiZGVcIl0sXG4gIFtcImVsXCIsIFwiZWxcIl0sXG4gIFtcImVuXCIsIFwiZW5cIl0sXG4gIFtcImVzXCIsIFwiZXNcIl0sXG4gIFtcImV0XCIsIFwiZXRcIl0sXG4gIFtcImZpXCIsIFwiZmlcIl0sXG4gIFtcImZyXCIsIFwiZnJcIl0sXG4gIFtcImhlXCIsIFwiaGVcIl0sXG4gIFtcImhyXCIsIFwiaHJcIl0sXG4gIFtcImh1XCIsIFwiaHVcIl0sXG4gIFtcImlkXCIsIFwiaWRcIl0sXG4gIFtcIml0XCIsIFwiaXRcIl0sXG4gIFtcImphXCIsIFwiamFcIl0sXG4gIFtcImtvXCIsIFwia29cIl0sXG4gIFtcImx0XCIsIFwibHRcIl0sXG4gIFtcImx2XCIsIFwibHZcIl0sXG4gIFtcIm5iXCIsIFwibmJcIl0sXG4gIFtcIm5sXCIsIFwibmxcIl0sXG4gIFtcInBsXCIsIFwicGxcIl0sXG4gIFtcInB0LWJyXCIsIFwicHQtQlJcIl0sXG4gIFtcInB0LXB0XCIsIFwicHQtUFRcIl0sXG4gIFtcInJvXCIsIFwicm9cIl0sXG4gIFtcInJ1XCIsIFwicnVcIl0sXG4gIFtcInNrXCIsIFwic2tcIl0sXG4gIFtcInNsXCIsIFwic2xcIl0sXG4gIFtcInNyXCIsIFwic3JcIl0sXG4gIFtcInN2XCIsIFwic3ZcIl0sXG4gIFtcInRoXCIsIFwidGhcIl0sXG4gIFtcInRyXCIsIFwidHJcIl0sXG4gIFtcInVrXCIsIFwidWtcIl0sXG4gIFtcInZpXCIsIFwidmlcIl0sXG4gIFtcInpoLWNuXCIsIFwiemgtQ05cIl0sXG4gIFtcInpoLWhrXCIsIFwiemgtSEtcIl0sXG4gIFtcInpoLXR3XCIsIFwiemgtVFdcIl1cbl0pO1xuLy8gcnRsXG5mdW5jdGlvbiBnZXRFbGVtZW50RGlyKGVsKSB7XG4gIHJldHVybiBnZXRFbGVtZW50UHJvcChlbCwgXCJkaXJcIiwgXCJsdHJcIik7XG59XG5mdW5jdGlvbiBnZXRFbGVtZW50UHJvcChlbCwgcHJvcCwgdmFsdWUpIHtcbiAgY29uc3QgY2xvc2VzdFdpdGhQcm9wID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsLCBgWyR7cHJvcH1dYCk7XG4gIHJldHVybiBjbG9zZXN0V2l0aFByb3AgPyBjbG9zZXN0V2l0aFByb3AuZ2V0QXR0cmlidXRlKHByb3ApIDogdmFsdWU7XG59XG4vLyBjc3NcbmNvbnN0IENTU19VVElMSVRZID0ge1xuICBydGw6IFwiYXJjZ2lzLS1ydGxcIlxufTtcbmFzeW5jIGZ1bmN0aW9uIGZvcm1hdE51bWJlcihudW1iZXIsIG9wdGlvbnMpIHtcbiAgY29uc3QgeyBhcGksIHR5cGUsIHBsYWNlcyB9ID0gb3B0aW9ucyB8fCB7fTtcbiAgaWYgKGFwaSA9PT0gNCkge1xuICAgIGNvbnN0IFtpbnRsXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvaW50bFwiXSk7XG4gICAgY29uc3QgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMgPSBpbnRsLmNvbnZlcnROdW1iZXJGb3JtYXRUb0ludGxPcHRpb25zKHtcbiAgICAgIHBsYWNlcyxcbiAgICAgIHN0eWxlOiB0eXBlLFxuICAgICAgZGlnaXRTZXBhcmF0b3I6IHRydWVcbiAgICB9KTtcbiAgICByZXR1cm4gaW50bC5mb3JtYXROdW1iZXIobnVtYmVyLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG51bWJlckZvcm1hdEludGxPcHRpb25zKSwgeyBzdHlsZTogdHlwZSB9KSk7XG4gIH1cbiAgY29uc3QgW2Rvam9OdW1iZXJdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZG9qby9udW1iZXJcIl0pO1xuICByZXR1cm4gZG9qb051bWJlci5mb3JtYXQobnVtYmVyLCB7XG4gICAgdHlwZSxcbiAgICBwbGFjZXMsXG4gICAgcGF0dGVybjogb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLnBhdHRlcm5cbiAgfSk7XG59XG5jb25zdCBjYWNoZSA9IHt9O1xuZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlKSB7XG4gIGNvbnN0IGxhbmcgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZztcbiAgY29uc3QgZGF5U2hvcnRNb250aFllYXIgPSB7XG4gICAgeWVhcjogXCJudW1lcmljXCIsXG4gICAgbW9udGg6IFwic2hvcnRcIixcbiAgICBkYXk6IFwibnVtZXJpY1wiXG4gIH07XG4gIGlmICghY2FjaGVbbGFuZ10pIHtcbiAgICBjYWNoZVtsYW5nXSA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nLCBkYXlTaG9ydE1vbnRoWWVhcik7XG4gIH1cbiAgcmV0dXJuIGNhY2hlW2xhbmddLmZvcm1hdChkYXRlKTtcbn1cblxuZXhwb3J0IHsgQ1NTX1VUSUxJVFkgYXMgQywgZm9ybWF0RGF0ZSBhcyBhLCBmb3JtYXROdW1iZXIgYXMgZiwgZ2V0RWxlbWVudERpciBhcyBnLCBsYW5ndWFnZU1hcCBhcyBsIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tMTNmNWIwMGMuanMnO1xuaW1wb3J0IHsgbCBhcyBsYW5ndWFnZU1hcCB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0QXNzZXRQYXRoIH0gZnJvbSAnLi9pbmRleC05MmViYjM5Ni5qcyc7XG5cbi8vIGh0dHBzOi8vbWVkaXVtLmNvbS9zdGVuY2lsLXRyaWNrcy9pbXBsZW1lbnRpbmctaW50ZXJuYXRpb25hbGlzYXRpb24taTE4bi13aXRoLXN0ZW5jaWwtNWU2NTU5NTU0MTE3XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCkge1xuICB2YXIgX2EsIF9iLCBfYztcbiAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gIC8vIGxhbmd1YWdlIHNldCBieSB0aGUgY2FsbGluZyBhcHBsaWNhdGlvbiBvciBicm93c2VyLiBkZWZhdWx0cyB0byBlbmdsaXNoLlxuICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgfVxuICBlbHNlIHtcbiAgICAvLyBcInJ1LVJVXCIgbWFwcyB0byBcInJ1XCIgdXNlIGNhc2VcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcuc2xpY2UoMCwgMikpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBcImVuXCI7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpIHtcbiAgdmFyIF9hLCBfYiwgX2M7XG4gIC8vIGl0J3MgT0sgaWYgd2UgZG9uJ3QgaGF2ZSB0aGUgNCBsZXR0ZXIgbGFuZ3VhZ2UgZmlsZSBmb3IgaXRcbiAgLy8gNCBsZXR0ZXIgbGFuZ3VhZ2UgY29kZSBuZWVkZWQgZm9yIGZvcm1hdHRpbmcgbnVtYmVyc1xuICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICB9XG4gIGVsc2Uge1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgIC8vIHdlIHN1cHBvcnQgdGhlIDIgbGV0dGVyIGNvZGVkIGxhbmd1YWdlXG4gICAgICAvLyBlLmcuIGl0LUNIIHZzIGl0XG4gICAgICByZXR1cm4gbGFuZztcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXR1cm4gXCJlblwiO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGZldGNoKGdldEFzc2V0UGF0aChgLi4vYXJjZ2lzLWFwcC1hc3NldHMvaTE4bi8ke2NvbXBvbmVudE5hbWV9LmkxOG4uJHtsb2NhbGV9Lmpzb25gKSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICBpZiAocmVzdWx0Lm9rKVxuICAgICAgICByZXNvbHZlKHJlc3VsdC5qc29uKCkpO1xuICAgICAgZWxzZVxuICAgICAgICByZWplY3QoKTtcbiAgICB9LCAoKSA9PiByZWplY3QoKSk7XG4gIH0pO1xufVxuY29uc3Qgc3RyaW5nQ2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBsb2NhbGUpIHtcbiAgY29uc3QgaWQgPSBgJHtjb21wb25lbnROYW1lfSR7bG9jYWxlfWA7XG4gIGlmICghc3RyaW5nQ2FjaGVbaWRdKSB7XG4gICAgc3RyaW5nQ2FjaGVbaWRdID0gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSk7XG4gIH1cbiAgcmV0dXJuIHN0cmluZ0NhY2hlW2lkXTtcbn1cbi8qKlxuICogR2V0IHN0cmluZ3MgYW5kIGxhbmd1YWdlIGNvZGVzLlxuICogVGhpcyBtZXRob2QgcmV0dXJucyAyIGxhbmd1YWdlIGNvZGVzLlxuICogVGhlIGZpcnN0IG9uZSByZXR1cm5zIGEgY29kZSB0aGF0J3MgYWxzbyBzdXBwb3J0ZWQgYXMgYSBsYW5ndWFnZSBmaWxlLlxuICogVGhlIHNlY29uZCBvbmUgcmV0dXJucyBhIGNvZGUgd2hlcmUgdGhlcmUgaXMgc3VwcG9ydCBmb3IgdGhlIGZpcnN0IDIgbGV0dGVycyBvZiB0aGUgY29kZSBhcyBwYXJ0IG9mIGEgbGFuZ3VhZ2UgZmlsZSxcbiAqIGJ1dCB3aWxsIHJldHVybiB0aGUgb3JpZ2luYWwgNCBsZXR0ZXIgY29kZSBmcm9tIHRoZSBwYWdlLlxuICogRS5nLiBGb3IgXCJpdC1jaFwiIGl0IHdpbGwgcmV0dXJuIFwiaXRcIiBhcyB0aGUgZmlyc3QgbGFuZ3VhZ2UgY29kZSBhbmQgXCJpdC1jaFwiIGFzIHRoZSBzZWNvbmQuXG4gKiBUaGUgc2Vjb25kIG9uZSBpcyByZXF1aXJlZCBmb3IgZXNyaS5pbnRsLnNldExvY2FsZSgpIHRvIGdldCB0aGUgY29ycmVjdCBmb3JtYXR0aW5nLlxuICpcbiAqIElmIGEgdGFnTmFtZSBpcyBwcm92aWRlZCBpdCB3aWxsIG92ZXJ3aXRlIHRoZSBlbGVtZW50J3MgdGFnTmFtZVxuICpcbiAqICBAcmV0dXJuIFsgc3RyaW5ncywgZmlyc3QgbGFuZ3VhZ2UgY29kZSwgc2Vjb25kIGxhbmd1YWdlIGNvZGVdXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MoZWxlbWVudCwgdGFnTmFtZSkge1xuICBjb25zdCBjb21wb25lbnROYW1lID0gdGFnTmFtZSB8fCBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2UgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCk7XG4gIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlSW50bCA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCk7XG4gIGxldCBzdHJpbmdzO1xuICB0cnkge1xuICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgY29tcG9uZW50TGFuZ3VhZ2UpO1xuICB9XG4gIGNhdGNoIChlKSB7XG4gICAgY29uc29sZS53YXJuKGBubyBsb2NhbGUgZm9yICR7Y29tcG9uZW50TmFtZX0gKCR7Y29tcG9uZW50TGFuZ3VhZ2V9KSBsb2FkaW5nIGRlZmF1bHQgbG9jYWxlIGVuLmApO1xuICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgXCJlblwiKTtcbiAgfVxuICByZXR1cm4gW3N0cmluZ3MsIGNvbXBvbmVudExhbmd1YWdlLCBjb21wb25lbnRMYW5ndWFnZUludGxdO1xufVxuXG5leHBvcnQgeyBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UgYXMgYSwgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyBhcyBnIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=