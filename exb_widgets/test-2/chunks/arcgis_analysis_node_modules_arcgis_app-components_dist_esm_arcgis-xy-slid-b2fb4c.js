"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-xy-slid-b2fb4c"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-xy-slider.entry.js":
/*!*******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-xy-slider.entry.js ***!
  \*******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_xy_slider: () => (/* binding */ ArcgisXySlider)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const arcgisXySliderCss = ":host{display:inline-flex}.container{position:relative;width:100px;height:100px}.grid{width:100px;height:100px}.thumb{position:absolute;background-color:var(--calcite-ui-brand);width:12px;height:12px;display:inline-block;border-radius:50%;margin-left:-6px;margin-top:-6px;pointer-events:none}";

const ArcgisXySlider = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisXYSliderChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisXYSliderChange", 7);
    this.arcgisXYSliderInput = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisXYSliderInput", 7);
    this.snapKeyDown = false;
    this.dragging = false;
    this.width = 100;
    this.height = 100;
    this.gridMouseDownHandler = (event) => {
      const { offsetX, offsetY } = event;
      this.dragging = true;
      this.captureValue(offsetX, offsetY);
      // prevent text selection outside of color field & slider area
      event.preventDefault();
      document.addEventListener("pointermove", this.globalMouseMoveHandler);
      document.addEventListener("pointerup", this.globalMouseUpHandler, { once: true });
      this.activeGridRect = this.context.canvas.getBoundingClientRect();
      this.setFocus();
      this.drawGrid();
    };
    this.globalMouseMoveHandler = (event) => {
      const { el, activeGridRect } = this;
      if (!el.isConnected) {
        return;
      }
      let samplingX;
      let samplingY;
      const gridRect = activeGridRect;
      const { clientX, clientY } = event;
      if (this.gridHovered) {
        samplingX = clientX - gridRect.x;
        samplingY = clientY - gridRect.y;
      }
      else {
        const gridWidth = gridRect.width;
        const gridHeight = gridRect.height;
        if (clientX < gridRect.x + gridWidth && clientX > gridRect.x) {
          samplingX = clientX - gridRect.x;
        }
        else if (clientX < gridRect.x) {
          samplingX = 0;
        }
        else {
          samplingX = gridWidth;
        }
        if (clientY < gridRect.y + gridHeight && clientY > gridRect.y) {
          samplingY = clientY - gridRect.y;
        }
        else if (clientY < gridRect.y) {
          samplingY = 0;
        }
        else {
          samplingY = gridHeight;
        }
      }
      this.captureValue(samplingX, samplingY);
      this.drawGrid();
    };
    this.globalMouseUpHandler = () => {
      this.dragging = false;
      // TODO: need to compare w/ onclick x/y values before emitting
      this.arcgisXYSliderChange.emit();
      document.removeEventListener("mousemove", this.globalMouseMoveHandler);
      document.removeEventListener("pointermove", this.globalMouseMoveHandler);
    };
    this.gridMouseEnter = () => {
      this.gridHovered = true;
    };
    this.gridMouseLeave = () => {
      this.gridHovered = false;
    };
    this.handleThumbKeyDown = ({ key }) => {
      let x;
      let y;
      if (key === "ArrowDown") {
        y = this.clamp(this.y + this.step, this.maxY, this.minY);
      }
      else if (key === "ArrowUp") {
        y = this.clamp(this.y - this.step, this.maxY, this.minY);
      }
      else {
        y = this.y;
      }
      if (key === "ArrowLeft") {
        x = this.clamp(this.x - this.step, this.maxX, this.minX);
      }
      else if (key === "ArrowRight") {
        x = this.clamp(this.x + this.step, this.maxX, this.minX);
      }
      else {
        x = this.x;
      }
      this.userSetXY(x, y);
      this.drawGrid();
    };
    this.handleKeyUp = ({ shiftKey }) => {
      this.snapKeyDown = shiftKey;
    };
    this.handleKeyDown = ({ shiftKey }) => {
      this.snapKeyDown = shiftKey;
    };
    this.initGrid = (canvas) => {
      this.context = canvas.getContext("2d");
      this.setCanvasContextSize(canvas, {
        width: this.width,
        height: this.height
      });
      this.drawGrid();
    };
    this.maxX = 10;
    this.minX = -10;
    this.maxY = 10;
    this.minY = -10;
    this.snappable = false;
    this.step = 1;
    this.x = 0;
    this.y = 0;
  }
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  disconnectedCallback() {
    document.removeEventListener("pointermove", this.globalMouseMoveHandler);
    document.removeEventListener("pointerup", this.globalMouseUpHandler);
  }
  handleXChange(x) {
    this.x = this.clampX(x);
    this.drawGrid();
  }
  handleYChange(y) {
    this.y = this.clampY(y);
    this.drawGrid();
  }
  //--------------------------------------------------------------------------
  //
  //  Private Methods
  //
  //--------------------------------------------------------------------------
  clamp(value, max, min) {
    return Math.min(max, Math.max(min, value));
  }
  clampX(x) {
    return this.clamp(x, this.maxX, this.minX);
  }
  clampY(y) {
    return this.clamp(y, this.maxY, this.minY);
  }
  userSetXY(x, y) {
    x = this.normalize(x);
    y = this.normalize(y);
    if (this.x === x && this.y === y) {
      return;
    }
    this.x = x;
    this.y = y;
    this.arcgisXYSliderInput.emit();
    if (!this.dragging) {
      this.arcgisXYSliderChange.emit();
    }
  }
  mapToRange(valueA, rangeAMin, rangeAMax, rangeBMin, rangeBMax) {
    return rangeBMin + ((valueA - rangeAMin) * (rangeBMax - rangeBMin)) / (rangeAMax - rangeAMin);
  }
  setCanvasContextSize(canvas, { height, width }) {
    const devicePixelRatio = window.devicePixelRatio || 1;
    canvas.width = width * devicePixelRatio;
    canvas.height = height * devicePixelRatio;
    canvas.style.height = `${height}px`;
    canvas.style.width = `${width}px`;
    const context = canvas.getContext("2d");
    context.scale(devicePixelRatio, devicePixelRatio);
  }
  normalize(value) {
    return this.snappable || this.snapKeyDown ? Math.floor(value / this.step) : value;
  }
  captureValue(x, y) {
    this.userSetXY(this.mapToRange(x, 0, this.width, this.minX, this.maxX), this.mapToRange(y, 0, this.height, this.minY, this.maxY));
  }
  drawGrid() {
    const { context, height, width } = this;
    // border and background
    context.fillStyle = "#ffffff";
    context.strokeStyle = "#d4d4d4";
    context.lineWidth = 2;
    context.setLineDash([2]);
    context.fillRect(0, 0, width, height);
    context.strokeRect(0, 0, width, height);
    // horizontal grid line
    context.beginPath();
    context.moveTo(0, height / 2);
    context.lineTo(width, height / 2);
    context.stroke();
    // vertical grid line
    context.beginPath();
    context.moveTo(width / 2, 0);
    context.lineTo(width / 2, height);
    context.stroke();
    // value-connecting line
    context.setLineDash([]);
    const x = this.mapToRange(this.x, this.minX, this.maxX, 0, this.width);
    const y = this.mapToRange(this.y, this.minY, this.maxY, 0, this.height);
    context.strokeStyle = "rgba(0, 97, 155, 0.4)";
    context.lineWidth = 2;
    context.beginPath();
    context.moveTo(width / 2, height / 2);
    context.lineTo(x, y);
    context.stroke();
  }
  //--------------------------------------------------------------------------
  //
  //  Public Methods
  //
  //--------------------------------------------------------------------------
  /**
   * Sets focus on the component.
   */
  async setFocus() {
    this.thumbEl.focus();
  }
  //--------------------------------------------------------------------------
  //
  //  Render
  //
  //--------------------------------------------------------------------------
  render() {
    const left = `${this.mapToRange(this.x, this.minX, this.maxX, 0, this.width)}%`;
    const top = `${this.mapToRange(this.y, this.minY, this.maxY, 0, this.height)}%`;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { onKeyUp: this.handleKeyUp, onKeyDown: this.handleKeyDown }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("canvas", { class: "grid", onPointerDown: this.gridMouseDownHandler, onPointerEnter: this.gridMouseEnter, onPointerLeave: this.gridMouseLeave, ref: this.initGrid }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "thumb", ref: (el) => (this.thumbEl = el), style: {
        left,
        top
      }, tabIndex: 0, onKeyDown: this.handleThumbKeyDown }))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "x": ["handleXChange"],
    "y": ["handleYChange"]
  }; }
};
ArcgisXySlider.style = arcgisXySliderCss;




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLXh5LXNsaWQtYjJmYjRjLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDNkc7O0FBRTdHLGlDQUFpQyxvQkFBb0IsV0FBVyxrQkFBa0IsWUFBWSxhQUFhLE1BQU0sWUFBWSxhQUFhLE9BQU8sa0JBQWtCLHlDQUF5QyxXQUFXLFlBQVkscUJBQXFCLGtCQUFrQixpQkFBaUIsZ0JBQWdCLG9CQUFvQjs7QUFFL1Q7QUFDQTtBQUNBLElBQUkscURBQWdCO0FBQ3BCLGdDQUFnQyxxREFBVztBQUMzQywrQkFBK0IscURBQVc7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsbUJBQW1CO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwRUFBMEUsWUFBWTtBQUN0RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxxQkFBcUI7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxtQkFBbUI7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLEtBQUs7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixVQUFVO0FBQ3BDO0FBQ0E7QUFDQSw0QkFBNEIsVUFBVTtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxlQUFlO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixPQUFPO0FBQ3BDLDRCQUE0QixNQUFNO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx5QkFBeUI7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLDZEQUE2RDtBQUNqRixtQkFBbUIsOERBQThEO0FBQ2pGLFlBQVkscURBQUMsQ0FBQyxpREFBSSxJQUFJLDBEQUEwRCxFQUFFLHFEQUFDLFVBQVUsb0JBQW9CLEVBQUUscURBQUMsYUFBYSx1SkFBdUosR0FBRyxxREFBQyxVQUFVO0FBQ3RTO0FBQ0E7QUFDQSxPQUFPLG1EQUFtRDtBQUMxRDtBQUNBLGFBQWEsT0FBTyxxREFBVTtBQUM5QiwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFOEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMteHktc2xpZGVyLmVudHJ5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtOTJlYmIzOTYuanMnO1xuXG5jb25zdCBhcmNnaXNYeVNsaWRlckNzcyA9IFwiOmhvc3R7ZGlzcGxheTppbmxpbmUtZmxleH0uY29udGFpbmVye3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjEwMHB4O2hlaWdodDoxMDBweH0uZ3JpZHt3aWR0aDoxMDBweDtoZWlnaHQ6MTAwcHh9LnRodW1ie3Bvc2l0aW9uOmFic29sdXRlO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1icmFuZCk7d2lkdGg6MTJweDtoZWlnaHQ6MTJweDtkaXNwbGF5OmlubGluZS1ibG9jaztib3JkZXItcmFkaXVzOjUwJTttYXJnaW4tbGVmdDotNnB4O21hcmdpbi10b3A6LTZweDtwb2ludGVyLWV2ZW50czpub25lfVwiO1xuXG5jb25zdCBBcmNnaXNYeVNsaWRlciA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNYWVNsaWRlckNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzWFlTbGlkZXJDaGFuZ2VcIiwgNyk7XG4gICAgdGhpcy5hcmNnaXNYWVNsaWRlcklucHV0ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNYWVNsaWRlcklucHV0XCIsIDcpO1xuICAgIHRoaXMuc25hcEtleURvd24gPSBmYWxzZTtcbiAgICB0aGlzLmRyYWdnaW5nID0gZmFsc2U7XG4gICAgdGhpcy53aWR0aCA9IDEwMDtcbiAgICB0aGlzLmhlaWdodCA9IDEwMDtcbiAgICB0aGlzLmdyaWRNb3VzZURvd25IYW5kbGVyID0gKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCB7IG9mZnNldFgsIG9mZnNldFkgfSA9IGV2ZW50O1xuICAgICAgdGhpcy5kcmFnZ2luZyA9IHRydWU7XG4gICAgICB0aGlzLmNhcHR1cmVWYWx1ZShvZmZzZXRYLCBvZmZzZXRZKTtcbiAgICAgIC8vIHByZXZlbnQgdGV4dCBzZWxlY3Rpb24gb3V0c2lkZSBvZiBjb2xvciBmaWVsZCAmIHNsaWRlciBhcmVhXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJtb3ZlXCIsIHRoaXMuZ2xvYmFsTW91c2VNb3ZlSGFuZGxlcik7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwicG9pbnRlcnVwXCIsIHRoaXMuZ2xvYmFsTW91c2VVcEhhbmRsZXIsIHsgb25jZTogdHJ1ZSB9KTtcbiAgICAgIHRoaXMuYWN0aXZlR3JpZFJlY3QgPSB0aGlzLmNvbnRleHQuY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgdGhpcy5zZXRGb2N1cygpO1xuICAgICAgdGhpcy5kcmF3R3JpZCgpO1xuICAgIH07XG4gICAgdGhpcy5nbG9iYWxNb3VzZU1vdmVIYW5kbGVyID0gKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCB7IGVsLCBhY3RpdmVHcmlkUmVjdCB9ID0gdGhpcztcbiAgICAgIGlmICghZWwuaXNDb25uZWN0ZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgbGV0IHNhbXBsaW5nWDtcbiAgICAgIGxldCBzYW1wbGluZ1k7XG4gICAgICBjb25zdCBncmlkUmVjdCA9IGFjdGl2ZUdyaWRSZWN0O1xuICAgICAgY29uc3QgeyBjbGllbnRYLCBjbGllbnRZIH0gPSBldmVudDtcbiAgICAgIGlmICh0aGlzLmdyaWRIb3ZlcmVkKSB7XG4gICAgICAgIHNhbXBsaW5nWCA9IGNsaWVudFggLSBncmlkUmVjdC54O1xuICAgICAgICBzYW1wbGluZ1kgPSBjbGllbnRZIC0gZ3JpZFJlY3QueTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBjb25zdCBncmlkV2lkdGggPSBncmlkUmVjdC53aWR0aDtcbiAgICAgICAgY29uc3QgZ3JpZEhlaWdodCA9IGdyaWRSZWN0LmhlaWdodDtcbiAgICAgICAgaWYgKGNsaWVudFggPCBncmlkUmVjdC54ICsgZ3JpZFdpZHRoICYmIGNsaWVudFggPiBncmlkUmVjdC54KSB7XG4gICAgICAgICAgc2FtcGxpbmdYID0gY2xpZW50WCAtIGdyaWRSZWN0Lng7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY2xpZW50WCA8IGdyaWRSZWN0LngpIHtcbiAgICAgICAgICBzYW1wbGluZ1ggPSAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHNhbXBsaW5nWCA9IGdyaWRXaWR0aDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2xpZW50WSA8IGdyaWRSZWN0LnkgKyBncmlkSGVpZ2h0ICYmIGNsaWVudFkgPiBncmlkUmVjdC55KSB7XG4gICAgICAgICAgc2FtcGxpbmdZID0gY2xpZW50WSAtIGdyaWRSZWN0Lnk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY2xpZW50WSA8IGdyaWRSZWN0LnkpIHtcbiAgICAgICAgICBzYW1wbGluZ1kgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHNhbXBsaW5nWSA9IGdyaWRIZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuY2FwdHVyZVZhbHVlKHNhbXBsaW5nWCwgc2FtcGxpbmdZKTtcbiAgICAgIHRoaXMuZHJhd0dyaWQoKTtcbiAgICB9O1xuICAgIHRoaXMuZ2xvYmFsTW91c2VVcEhhbmRsZXIgPSAoKSA9PiB7XG4gICAgICB0aGlzLmRyYWdnaW5nID0gZmFsc2U7XG4gICAgICAvLyBUT0RPOiBuZWVkIHRvIGNvbXBhcmUgdy8gb25jbGljayB4L3kgdmFsdWVzIGJlZm9yZSBlbWl0dGluZ1xuICAgICAgdGhpcy5hcmNnaXNYWVNsaWRlckNoYW5nZS5lbWl0KCk7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHRoaXMuZ2xvYmFsTW91c2VNb3ZlSGFuZGxlcik7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9pbnRlcm1vdmVcIiwgdGhpcy5nbG9iYWxNb3VzZU1vdmVIYW5kbGVyKTtcbiAgICB9O1xuICAgIHRoaXMuZ3JpZE1vdXNlRW50ZXIgPSAoKSA9PiB7XG4gICAgICB0aGlzLmdyaWRIb3ZlcmVkID0gdHJ1ZTtcbiAgICB9O1xuICAgIHRoaXMuZ3JpZE1vdXNlTGVhdmUgPSAoKSA9PiB7XG4gICAgICB0aGlzLmdyaWRIb3ZlcmVkID0gZmFsc2U7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZVRodW1iS2V5RG93biA9ICh7IGtleSB9KSA9PiB7XG4gICAgICBsZXQgeDtcbiAgICAgIGxldCB5O1xuICAgICAgaWYgKGtleSA9PT0gXCJBcnJvd0Rvd25cIikge1xuICAgICAgICB5ID0gdGhpcy5jbGFtcCh0aGlzLnkgKyB0aGlzLnN0ZXAsIHRoaXMubWF4WSwgdGhpcy5taW5ZKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGtleSA9PT0gXCJBcnJvd1VwXCIpIHtcbiAgICAgICAgeSA9IHRoaXMuY2xhbXAodGhpcy55IC0gdGhpcy5zdGVwLCB0aGlzLm1heFksIHRoaXMubWluWSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgeSA9IHRoaXMueTtcbiAgICAgIH1cbiAgICAgIGlmIChrZXkgPT09IFwiQXJyb3dMZWZ0XCIpIHtcbiAgICAgICAgeCA9IHRoaXMuY2xhbXAodGhpcy54IC0gdGhpcy5zdGVwLCB0aGlzLm1heFgsIHRoaXMubWluWCk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChrZXkgPT09IFwiQXJyb3dSaWdodFwiKSB7XG4gICAgICAgIHggPSB0aGlzLmNsYW1wKHRoaXMueCArIHRoaXMuc3RlcCwgdGhpcy5tYXhYLCB0aGlzLm1pblgpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHggPSB0aGlzLng7XG4gICAgICB9XG4gICAgICB0aGlzLnVzZXJTZXRYWSh4LCB5KTtcbiAgICAgIHRoaXMuZHJhd0dyaWQoKTtcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlS2V5VXAgPSAoeyBzaGlmdEtleSB9KSA9PiB7XG4gICAgICB0aGlzLnNuYXBLZXlEb3duID0gc2hpZnRLZXk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZUtleURvd24gPSAoeyBzaGlmdEtleSB9KSA9PiB7XG4gICAgICB0aGlzLnNuYXBLZXlEb3duID0gc2hpZnRLZXk7XG4gICAgfTtcbiAgICB0aGlzLmluaXRHcmlkID0gKGNhbnZhcykgPT4ge1xuICAgICAgdGhpcy5jb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgIHRoaXMuc2V0Q2FudmFzQ29udGV4dFNpemUoY2FudmFzLCB7XG4gICAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0XG4gICAgICB9KTtcbiAgICAgIHRoaXMuZHJhd0dyaWQoKTtcbiAgICB9O1xuICAgIHRoaXMubWF4WCA9IDEwO1xuICAgIHRoaXMubWluWCA9IC0xMDtcbiAgICB0aGlzLm1heFkgPSAxMDtcbiAgICB0aGlzLm1pblkgPSAtMTA7XG4gICAgdGhpcy5zbmFwcGFibGUgPSBmYWxzZTtcbiAgICB0aGlzLnN0ZXAgPSAxO1xuICAgIHRoaXMueCA9IDA7XG4gICAgdGhpcy55ID0gMDtcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBMaWZlY3ljbGVcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9pbnRlcm1vdmVcIiwgdGhpcy5nbG9iYWxNb3VzZU1vdmVIYW5kbGVyKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9pbnRlcnVwXCIsIHRoaXMuZ2xvYmFsTW91c2VVcEhhbmRsZXIpO1xuICB9XG4gIGhhbmRsZVhDaGFuZ2UoeCkge1xuICAgIHRoaXMueCA9IHRoaXMuY2xhbXBYKHgpO1xuICAgIHRoaXMuZHJhd0dyaWQoKTtcbiAgfVxuICBoYW5kbGVZQ2hhbmdlKHkpIHtcbiAgICB0aGlzLnkgPSB0aGlzLmNsYW1wWSh5KTtcbiAgICB0aGlzLmRyYXdHcmlkKCk7XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUHJpdmF0ZSBNZXRob2RzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgY2xhbXAodmFsdWUsIG1heCwgbWluKSB7XG4gICAgcmV0dXJuIE1hdGgubWluKG1heCwgTWF0aC5tYXgobWluLCB2YWx1ZSkpO1xuICB9XG4gIGNsYW1wWCh4KSB7XG4gICAgcmV0dXJuIHRoaXMuY2xhbXAoeCwgdGhpcy5tYXhYLCB0aGlzLm1pblgpO1xuICB9XG4gIGNsYW1wWSh5KSB7XG4gICAgcmV0dXJuIHRoaXMuY2xhbXAoeSwgdGhpcy5tYXhZLCB0aGlzLm1pblkpO1xuICB9XG4gIHVzZXJTZXRYWSh4LCB5KSB7XG4gICAgeCA9IHRoaXMubm9ybWFsaXplKHgpO1xuICAgIHkgPSB0aGlzLm5vcm1hbGl6ZSh5KTtcbiAgICBpZiAodGhpcy54ID09PSB4ICYmIHRoaXMueSA9PT0geSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnggPSB4O1xuICAgIHRoaXMueSA9IHk7XG4gICAgdGhpcy5hcmNnaXNYWVNsaWRlcklucHV0LmVtaXQoKTtcbiAgICBpZiAoIXRoaXMuZHJhZ2dpbmcpIHtcbiAgICAgIHRoaXMuYXJjZ2lzWFlTbGlkZXJDaGFuZ2UuZW1pdCgpO1xuICAgIH1cbiAgfVxuICBtYXBUb1JhbmdlKHZhbHVlQSwgcmFuZ2VBTWluLCByYW5nZUFNYXgsIHJhbmdlQk1pbiwgcmFuZ2VCTWF4KSB7XG4gICAgcmV0dXJuIHJhbmdlQk1pbiArICgodmFsdWVBIC0gcmFuZ2VBTWluKSAqIChyYW5nZUJNYXggLSByYW5nZUJNaW4pKSAvIChyYW5nZUFNYXggLSByYW5nZUFNaW4pO1xuICB9XG4gIHNldENhbnZhc0NvbnRleHRTaXplKGNhbnZhcywgeyBoZWlnaHQsIHdpZHRoIH0pIHtcbiAgICBjb25zdCBkZXZpY2VQaXhlbFJhdGlvID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTtcbiAgICBjYW52YXMud2lkdGggPSB3aWR0aCAqIGRldmljZVBpeGVsUmF0aW87XG4gICAgY2FudmFzLmhlaWdodCA9IGhlaWdodCAqIGRldmljZVBpeGVsUmF0aW87XG4gICAgY2FudmFzLnN0eWxlLmhlaWdodCA9IGAke2hlaWdodH1weGA7XG4gICAgY2FudmFzLnN0eWxlLndpZHRoID0gYCR7d2lkdGh9cHhgO1xuICAgIGNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGNvbnRleHQuc2NhbGUoZGV2aWNlUGl4ZWxSYXRpbywgZGV2aWNlUGl4ZWxSYXRpbyk7XG4gIH1cbiAgbm9ybWFsaXplKHZhbHVlKSB7XG4gICAgcmV0dXJuIHRoaXMuc25hcHBhYmxlIHx8IHRoaXMuc25hcEtleURvd24gPyBNYXRoLmZsb29yKHZhbHVlIC8gdGhpcy5zdGVwKSA6IHZhbHVlO1xuICB9XG4gIGNhcHR1cmVWYWx1ZSh4LCB5KSB7XG4gICAgdGhpcy51c2VyU2V0WFkodGhpcy5tYXBUb1JhbmdlKHgsIDAsIHRoaXMud2lkdGgsIHRoaXMubWluWCwgdGhpcy5tYXhYKSwgdGhpcy5tYXBUb1JhbmdlKHksIDAsIHRoaXMuaGVpZ2h0LCB0aGlzLm1pblksIHRoaXMubWF4WSkpO1xuICB9XG4gIGRyYXdHcmlkKCkge1xuICAgIGNvbnN0IHsgY29udGV4dCwgaGVpZ2h0LCB3aWR0aCB9ID0gdGhpcztcbiAgICAvLyBib3JkZXIgYW5kIGJhY2tncm91bmRcbiAgICBjb250ZXh0LmZpbGxTdHlsZSA9IFwiI2ZmZmZmZlwiO1xuICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSBcIiNkNGQ0ZDRcIjtcbiAgICBjb250ZXh0LmxpbmVXaWR0aCA9IDI7XG4gICAgY29udGV4dC5zZXRMaW5lRGFzaChbMl0pO1xuICAgIGNvbnRleHQuZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7XG4gICAgY29udGV4dC5zdHJva2VSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgIC8vIGhvcml6b250YWwgZ3JpZCBsaW5lXG4gICAgY29udGV4dC5iZWdpblBhdGgoKTtcbiAgICBjb250ZXh0Lm1vdmVUbygwLCBoZWlnaHQgLyAyKTtcbiAgICBjb250ZXh0LmxpbmVUbyh3aWR0aCwgaGVpZ2h0IC8gMik7XG4gICAgY29udGV4dC5zdHJva2UoKTtcbiAgICAvLyB2ZXJ0aWNhbCBncmlkIGxpbmVcbiAgICBjb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgIGNvbnRleHQubW92ZVRvKHdpZHRoIC8gMiwgMCk7XG4gICAgY29udGV4dC5saW5lVG8od2lkdGggLyAyLCBoZWlnaHQpO1xuICAgIGNvbnRleHQuc3Ryb2tlKCk7XG4gICAgLy8gdmFsdWUtY29ubmVjdGluZyBsaW5lXG4gICAgY29udGV4dC5zZXRMaW5lRGFzaChbXSk7XG4gICAgY29uc3QgeCA9IHRoaXMubWFwVG9SYW5nZSh0aGlzLngsIHRoaXMubWluWCwgdGhpcy5tYXhYLCAwLCB0aGlzLndpZHRoKTtcbiAgICBjb25zdCB5ID0gdGhpcy5tYXBUb1JhbmdlKHRoaXMueSwgdGhpcy5taW5ZLCB0aGlzLm1heFksIDAsIHRoaXMuaGVpZ2h0KTtcbiAgICBjb250ZXh0LnN0cm9rZVN0eWxlID0gXCJyZ2JhKDAsIDk3LCAxNTUsIDAuNClcIjtcbiAgICBjb250ZXh0LmxpbmVXaWR0aCA9IDI7XG4gICAgY29udGV4dC5iZWdpblBhdGgoKTtcbiAgICBjb250ZXh0Lm1vdmVUbyh3aWR0aCAvIDIsIGhlaWdodCAvIDIpO1xuICAgIGNvbnRleHQubGluZVRvKHgsIHkpO1xuICAgIGNvbnRleHQuc3Ryb2tlKCk7XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUHVibGljIE1ldGhvZHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogU2V0cyBmb2N1cyBvbiB0aGUgY29tcG9uZW50LlxuICAgKi9cbiAgYXN5bmMgc2V0Rm9jdXMoKSB7XG4gICAgdGhpcy50aHVtYkVsLmZvY3VzKCk7XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUmVuZGVyXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IGxlZnQgPSBgJHt0aGlzLm1hcFRvUmFuZ2UodGhpcy54LCB0aGlzLm1pblgsIHRoaXMubWF4WCwgMCwgdGhpcy53aWR0aCl9JWA7XG4gICAgY29uc3QgdG9wID0gYCR7dGhpcy5tYXBUb1JhbmdlKHRoaXMueSwgdGhpcy5taW5ZLCB0aGlzLm1heFksIDAsIHRoaXMuaGVpZ2h0KX0lYDtcbiAgICByZXR1cm4gKGgoSG9zdCwgeyBvbktleVVwOiB0aGlzLmhhbmRsZUtleVVwLCBvbktleURvd246IHRoaXMuaGFuZGxlS2V5RG93biB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29udGFpbmVyXCIgfSwgaChcImNhbnZhc1wiLCB7IGNsYXNzOiBcImdyaWRcIiwgb25Qb2ludGVyRG93bjogdGhpcy5ncmlkTW91c2VEb3duSGFuZGxlciwgb25Qb2ludGVyRW50ZXI6IHRoaXMuZ3JpZE1vdXNlRW50ZXIsIG9uUG9pbnRlckxlYXZlOiB0aGlzLmdyaWRNb3VzZUxlYXZlLCByZWY6IHRoaXMuaW5pdEdyaWQgfSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJ0aHVtYlwiLCByZWY6IChlbCkgPT4gKHRoaXMudGh1bWJFbCA9IGVsKSwgc3R5bGU6IHtcbiAgICAgICAgbGVmdCxcbiAgICAgICAgdG9wXG4gICAgICB9LCB0YWJJbmRleDogMCwgb25LZXlEb3duOiB0aGlzLmhhbmRsZVRodW1iS2V5RG93biB9KSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgXCJ4XCI6IFtcImhhbmRsZVhDaGFuZ2VcIl0sXG4gICAgXCJ5XCI6IFtcImhhbmRsZVlDaGFuZ2VcIl1cbiAgfTsgfVxufTtcbkFyY2dpc1h5U2xpZGVyLnN0eWxlID0gYXJjZ2lzWHlTbGlkZXJDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc1h5U2xpZGVyIGFzIGFyY2dpc194eV9zbGlkZXIgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==