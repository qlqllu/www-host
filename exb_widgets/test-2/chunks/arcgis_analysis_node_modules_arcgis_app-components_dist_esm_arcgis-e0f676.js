"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-e0f676"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-image-upload-from-map.entry.js":
/*!*******************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-image-upload-from-map.entry.js ***!
  \*******************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_image_upload_from_map: () => (/* binding */ ArcgisImageUploadFromMap)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */






const arcgisImageUploadFromMapCss = ".from-map-wrapper{position:relative;padding:0.5rem}.loader-container{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%)}.map-container{width:600px;height:400px}.esri-zoom{position:absolute;top:50px;left:538px}.is-rtl .esri-zoom{left:0}.basemap-toggle{position:absolute;cursor:pointer;padding:0.5rem;font-size:0.875rem;background-color:var(--calcite-ui-foreground-1);top:1.5rem;left:1.5rem;max-width:50%;box-shadow:0 1px 2px rgba(0, 0, 0, 0.3)}.is-rtl .basemap-toggle{right:1.5rem;left:auto}:host .esri-basemap-gallery{display:none;overflow-y:auto;max-height:310px;top:57px;left:15px;min-width:0}.is-rtl .esri-basemap-gallery{left:auto;right:15px}.esri-basemap-gallery__item-thumbnail{display:none}";

const ArcgisImageUploadFromMap = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisImageUploadFromMapReady = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisImageUploadFromMapReady", 7);
    this.isRTL = false;
    this.lang = "en";
    this.handleBasemapToggle = () => {
      const gallery = this.container.querySelector(".esri-basemap-gallery");
      if (gallery.style.display === "block") {
        gallery.style.display = "none";
      }
      else {
        gallery.style.display = "block";
      }
    };
    this.portal = undefined;
    this.itemId = undefined;
    this.changeBasemapText = undefined;
    this.loadingText = undefined;
    this.jsapiUrl = undefined;
    this.loading = true;
  }
  async componentWillLoad() {
    this.isRTL = (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.el) === "rtl";
    this.lang = (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_3__.a)(this.el);
  }
  async componentDidLoad() {
    // add JSAPI CSS link element before the component <style> tag
    this.el.shadowRoot.firstElementChild.insertAdjacentHTML("beforebegin", `<link rel="stylesheet" href="${this.jsapiUrl}/themes/light/main.css" />`);
    try {
      const [PortalItem, Map, WebMap, Layer, GraphicsLayer] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_1__.l)([
        "esri/portal/PortalItem",
        "esri/Map",
        "esri/WebMap",
        "esri/layers/Layer",
        "esri/layers/GraphicsLayer"
      ]);
      this.map = new Map({
        basemap: "streets-vector"
      });
      this.item = new PortalItem({
        id: this.itemId
      });
      await this.item.load();
      const types = ["Feature Service", "Feature Collection", "Map Service", "Vector Tile Service"];
      if (types.includes(this.item.type)) {
        const layer = await Layer.fromPortalItem({
          portalItem: this.item
        });
        layer.visible = true;
        this.map.add(layer);
        layer.when(() => {
          layer.popupEnabled = false;
        });
      }
      let basemap = "gray";
      if (this.portal.defaultBasemap) {
        basemap = this.portal.useVectorBasemaps
          ? this.portal.defaultVectorBasemap
          : this.portal.defaultBasemap;
      }
      this.map.basemap = basemap;
      if (this.item.type !== "Web Map") {
        this.makeMapView();
      }
      else {
        this.webMap = new WebMap({
          portalItem: {
            id: this.item.id
          }
        });
        const data = await this.item.fetchData();
        if (parseFloat(data.version) < 2) {
          this.makeMapView(true);
        }
        else {
          try {
            await this.webMap.load();
            const areasLayer = new GraphicsLayer({ id: "areaGraphics" });
            this.map.add(areasLayer);
            this.makeMapView();
          }
          catch (e) {
            this.makeMapView(true);
          }
        }
      }
    }
    catch (e) {
      console.error(e);
    }
  }
  async makeMapView(noWebMap) {
    try {
      const [MapView] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_1__.l)(["esri/views/MapView"]);
      const mapViewMap = noWebMap || !this.webMap ? this.map : this.webMap;
      this.mapView = new MapView({
        map: mapViewMap,
        zoom: 2,
        center: [0, 0],
        container: this.container
      });
      mapViewMap.watch("basemap.title", () => {
        const gallery = this.container.querySelector(".esri-basemap-gallery");
        gallery.style.display = "none";
      });
      this.mapView.when(() => {
        const extent = this.item.extent || this.portal.defaultExtent;
        if (extent) {
          this.mapView.extent = extent;
        }
        this.addWidgets();
        this.loading = false;
      });
    }
    catch (e) { }
  }
  async addWidgets() {
    try {
      const [Search, BasemapGallery, intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_1__.l)([
        "esri/widgets/Search",
        "esri/widgets/BasemapGallery",
        "esri/intl"
      ]);
      if (this.lang) {
        intl.setLocale(this.lang);
      }
      const searchWidget = new Search({
        view: this.mapView,
        popupEnabled: false,
        resultGraphicEnabled: false
      });
      const vm = searchWidget.viewModel;
      // fix zoomScale issue for drawing extent
      searchWidget.viewModel.allSources.on("change", () => {
        vm.allSources.forEach((source) => {
          source.zoomScale = null;
        });
      });
      this.mapView.ui.add(searchWidget, this.isRTL ? "top-left" : "top-right");
      searchWidget.on("select-result", (r) => {
        this.mapView.goTo(r.result.extent);
      });
      const basemapGallery = new BasemapGallery({
        view: this.mapView,
        source: { portal: this.portal }
      });
      this.mapView.ui.add(basemapGallery);
      this.arcgisImageUploadFromMapReady.emit(this.mapView);
    }
    catch (e) { }
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: { "from-map-wrapper": true, "is-rtl": this.isRTL } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "map-container", ref: (el) => (this.container = el) }), this.loading ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "loader-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: this.loadingText }))) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "basemap-toggle", onClick: this.handleBasemapToggle }, this.changeBasemapText)))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisImageUploadFromMap.style = arcgisImageUploadFromMapCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



const languageMap = new Map([
  ["ar", "ar"],
  ["bg", "bg"],
  ["bs", "bs"],
  ["ca", "ca"],
  ["cs", "cs"],
  ["da", "da"],
  ["de", "de"],
  ["el", "el"],
  ["en", "en"],
  ["es", "es"],
  ["et", "et"],
  ["fi", "fi"],
  ["fr", "fr"],
  ["he", "he"],
  ["hr", "hr"],
  ["hu", "hu"],
  ["id", "id"],
  ["it", "it"],
  ["ja", "ja"],
  ["ko", "ko"],
  ["lt", "lt"],
  ["lv", "lv"],
  ["nb", "nb"],
  ["nl", "nl"],
  ["pl", "pl"],
  ["pt-br", "pt-BR"],
  ["pt-pt", "pt-PT"],
  ["ro", "ro"],
  ["ru", "ru"],
  ["sk", "sk"],
  ["sl", "sl"],
  ["sr", "sr"],
  ["sv", "sv"],
  ["th", "th"],
  ["tr", "tr"],
  ["uk", "uk"],
  ["vi", "vi"],
  ["zh-cn", "zh-CN"],
  ["zh-hk", "zh-HK"],
  ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
  return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
  const closestWithProp = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
  return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
  rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
  const { api, type, places } = options || {};
  if (api === 4) {
    const [intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
    const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
      places,
      style: type,
      digitSeparator: true
    });
    return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
  }
  const [dojoNumber] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
  return dojoNumber.format(number, {
    type,
    places,
    pattern: options === null || options === void 0 ? void 0 : options.pattern
  });
}
const cache = {};
function formatDate(date) {
  const lang = document.documentElement.lang;
  const dayShortMonthYear = {
    year: "numeric",
    month: "short",
    day: "numeric"
  };
  if (!cache[lang]) {
    cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
  }
  return cache[lang].format(date);
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
  var _a, _b, _c;
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    // "ru-RU" maps to "ru" use case
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
    }
    else {
      return "en";
    }
  }
}
function getComponentClosestLanguageIntl(element) {
  var _a, _b, _c;
  // it's OK if we don't have the 4 letter language file for it
  // 4 letter language code needed for formatting numbers
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      // we support the 2 letter coded language
      // e.g. it-CH vs it
      return lang;
    }
    else {
      return "en";
    }
  }
}
function fetchLocaleStringsForComponent(componentName, locale) {
  return new Promise((resolve, reject) => {
    fetch((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
      if (result.ok)
        resolve(result.json());
      else
        reject();
    }, () => reject());
  });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
  const id = `${componentName}${locale}`;
  if (!stringCache[id]) {
    stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
  }
  return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
  const componentName = tagName || element.tagName.toLowerCase();
  const componentLanguage = getComponentClosestLanguage(element);
  const componentLanguageIntl = getComponentClosestLanguageIntl(element);
  let strings;
  try {
    strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
  }
  catch (e) {
    console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
    strings = await fetchLocaleStringsFromCache(componentName, "en");
  }
  return [strings, componentLanguage, componentLanguageIntl];
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWUwZjY3Ni5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUM2RztBQUNoRDtBQUNHO0FBQ1E7QUFDN0M7O0FBRTNCLHVEQUF1RCxrQkFBa0IsZUFBZSxrQkFBa0Isa0JBQWtCLFFBQVEsU0FBUyxnQ0FBZ0MsZUFBZSxZQUFZLGFBQWEsV0FBVyxrQkFBa0IsU0FBUyxXQUFXLG1CQUFtQixPQUFPLGdCQUFnQixrQkFBa0IsZUFBZSxlQUFlLG1CQUFtQixnREFBZ0QsV0FBVyxZQUFZLGNBQWMsd0NBQXdDLHdCQUF3QixhQUFhLFVBQVUsNEJBQTRCLGFBQWEsZ0JBQWdCLGlCQUFpQixTQUFTLFVBQVUsWUFBWSw4QkFBOEIsVUFBVSxXQUFXLHNDQUFzQyxhQUFhOztBQUU5dUI7QUFDQTtBQUNBLElBQUkscURBQWdCO0FBQ3BCLHlDQUF5QyxxREFBVztBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQiw0REFBYTtBQUM5QixnQkFBZ0Isc0RBQTJCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBLDJHQUEyRyxjQUFjO0FBQ3pIO0FBQ0Esb0VBQW9FLDJEQUFXO0FBQy9FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLGVBQWUsR0FBRyxrQkFBa0I7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7O0FBRTRFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLWltYWdlLXVwbG9hZC1mcm9tLW1hcC5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sYW5ndWFnZVV0aWwtMjIyNThjOTAuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbG9jYWxlLTEzZTAwYTc1LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtOTJlYmIzOTYuanMnO1xuaW1wb3J0IHsgbCBhcyBsb2FkTW9kdWxlcyB9IGZyb20gJy4vbG9hZE1vZHVsZXMtYWFmMzBiZDYuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRFbGVtZW50RGlyIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtMjIyNThjOTAuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UgfSBmcm9tICcuL2xvY2FsZS0xM2UwMGE3NS5qcyc7XG5pbXBvcnQgJy4vZG9tLTEzZjViMDBjLmpzJztcblxuY29uc3QgYXJjZ2lzSW1hZ2VVcGxvYWRGcm9tTWFwQ3NzID0gXCIuZnJvbS1tYXAtd3JhcHBlcntwb3NpdGlvbjpyZWxhdGl2ZTtwYWRkaW5nOjAuNXJlbX0ubG9hZGVyLWNvbnRhaW5lcntwb3NpdGlvbjphYnNvbHV0ZTt0b3A6NTAlO2xlZnQ6NTAlO3RyYW5zZm9ybTp0cmFuc2xhdGUoLTUwJSwgLTUwJSl9Lm1hcC1jb250YWluZXJ7d2lkdGg6NjAwcHg7aGVpZ2h0OjQwMHB4fS5lc3JpLXpvb217cG9zaXRpb246YWJzb2x1dGU7dG9wOjUwcHg7bGVmdDo1MzhweH0uaXMtcnRsIC5lc3JpLXpvb217bGVmdDowfS5iYXNlbWFwLXRvZ2dsZXtwb3NpdGlvbjphYnNvbHV0ZTtjdXJzb3I6cG9pbnRlcjtwYWRkaW5nOjAuNXJlbTtmb250LXNpemU6MC44NzVyZW07YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMSk7dG9wOjEuNXJlbTtsZWZ0OjEuNXJlbTttYXgtd2lkdGg6NTAlO2JveC1zaGFkb3c6MCAxcHggMnB4IHJnYmEoMCwgMCwgMCwgMC4zKX0uaXMtcnRsIC5iYXNlbWFwLXRvZ2dsZXtyaWdodDoxLjVyZW07bGVmdDphdXRvfTpob3N0IC5lc3JpLWJhc2VtYXAtZ2FsbGVyeXtkaXNwbGF5Om5vbmU7b3ZlcmZsb3cteTphdXRvO21heC1oZWlnaHQ6MzEwcHg7dG9wOjU3cHg7bGVmdDoxNXB4O21pbi13aWR0aDowfS5pcy1ydGwgLmVzcmktYmFzZW1hcC1nYWxsZXJ5e2xlZnQ6YXV0bztyaWdodDoxNXB4fS5lc3JpLWJhc2VtYXAtZ2FsbGVyeV9faXRlbS10aHVtYm5haWx7ZGlzcGxheTpub25lfVwiO1xuXG5jb25zdCBBcmNnaXNJbWFnZVVwbG9hZEZyb21NYXAgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzSW1hZ2VVcGxvYWRGcm9tTWFwUmVhZHkgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0ltYWdlVXBsb2FkRnJvbU1hcFJlYWR5XCIsIDcpO1xuICAgIHRoaXMuaXNSVEwgPSBmYWxzZTtcbiAgICB0aGlzLmxhbmcgPSBcImVuXCI7XG4gICAgdGhpcy5oYW5kbGVCYXNlbWFwVG9nZ2xlID0gKCkgPT4ge1xuICAgICAgY29uc3QgZ2FsbGVyeSA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIuZXNyaS1iYXNlbWFwLWdhbGxlcnlcIik7XG4gICAgICBpZiAoZ2FsbGVyeS5zdHlsZS5kaXNwbGF5ID09PSBcImJsb2NrXCIpIHtcbiAgICAgICAgZ2FsbGVyeS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgZ2FsbGVyeS5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pdGVtSWQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jaGFuZ2VCYXNlbWFwVGV4dCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxvYWRpbmdUZXh0ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuanNhcGlVcmwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLmlzUlRMID0gZ2V0RWxlbWVudERpcih0aGlzLmVsKSA9PT0gXCJydGxcIjtcbiAgICB0aGlzLmxhbmcgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UodGhpcy5lbCk7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAvLyBhZGQgSlNBUEkgQ1NTIGxpbmsgZWxlbWVudCBiZWZvcmUgdGhlIGNvbXBvbmVudCA8c3R5bGU+IHRhZ1xuICAgIHRoaXMuZWwuc2hhZG93Um9vdC5maXJzdEVsZW1lbnRDaGlsZC5pbnNlcnRBZGphY2VudEhUTUwoXCJiZWZvcmViZWdpblwiLCBgPGxpbmsgcmVsPVwic3R5bGVzaGVldFwiIGhyZWY9XCIke3RoaXMuanNhcGlVcmx9L3RoZW1lcy9saWdodC9tYWluLmNzc1wiIC8+YCk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IFtQb3J0YWxJdGVtLCBNYXAsIFdlYk1hcCwgTGF5ZXIsIEdyYXBoaWNzTGF5ZXJdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1xuICAgICAgICBcImVzcmkvcG9ydGFsL1BvcnRhbEl0ZW1cIixcbiAgICAgICAgXCJlc3JpL01hcFwiLFxuICAgICAgICBcImVzcmkvV2ViTWFwXCIsXG4gICAgICAgIFwiZXNyaS9sYXllcnMvTGF5ZXJcIixcbiAgICAgICAgXCJlc3JpL2xheWVycy9HcmFwaGljc0xheWVyXCJcbiAgICAgIF0pO1xuICAgICAgdGhpcy5tYXAgPSBuZXcgTWFwKHtcbiAgICAgICAgYmFzZW1hcDogXCJzdHJlZXRzLXZlY3RvclwiXG4gICAgICB9KTtcbiAgICAgIHRoaXMuaXRlbSA9IG5ldyBQb3J0YWxJdGVtKHtcbiAgICAgICAgaWQ6IHRoaXMuaXRlbUlkXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IHRoaXMuaXRlbS5sb2FkKCk7XG4gICAgICBjb25zdCB0eXBlcyA9IFtcIkZlYXR1cmUgU2VydmljZVwiLCBcIkZlYXR1cmUgQ29sbGVjdGlvblwiLCBcIk1hcCBTZXJ2aWNlXCIsIFwiVmVjdG9yIFRpbGUgU2VydmljZVwiXTtcbiAgICAgIGlmICh0eXBlcy5pbmNsdWRlcyh0aGlzLml0ZW0udHlwZSkpIHtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBhd2FpdCBMYXllci5mcm9tUG9ydGFsSXRlbSh7XG4gICAgICAgICAgcG9ydGFsSXRlbTogdGhpcy5pdGVtXG4gICAgICAgIH0pO1xuICAgICAgICBsYXllci52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5tYXAuYWRkKGxheWVyKTtcbiAgICAgICAgbGF5ZXIud2hlbigoKSA9PiB7XG4gICAgICAgICAgbGF5ZXIucG9wdXBFbmFibGVkID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgbGV0IGJhc2VtYXAgPSBcImdyYXlcIjtcbiAgICAgIGlmICh0aGlzLnBvcnRhbC5kZWZhdWx0QmFzZW1hcCkge1xuICAgICAgICBiYXNlbWFwID0gdGhpcy5wb3J0YWwudXNlVmVjdG9yQmFzZW1hcHNcbiAgICAgICAgICA/IHRoaXMucG9ydGFsLmRlZmF1bHRWZWN0b3JCYXNlbWFwXG4gICAgICAgICAgOiB0aGlzLnBvcnRhbC5kZWZhdWx0QmFzZW1hcDtcbiAgICAgIH1cbiAgICAgIHRoaXMubWFwLmJhc2VtYXAgPSBiYXNlbWFwO1xuICAgICAgaWYgKHRoaXMuaXRlbS50eXBlICE9PSBcIldlYiBNYXBcIikge1xuICAgICAgICB0aGlzLm1ha2VNYXBWaWV3KCk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy53ZWJNYXAgPSBuZXcgV2ViTWFwKHtcbiAgICAgICAgICBwb3J0YWxJdGVtOiB7XG4gICAgICAgICAgICBpZDogdGhpcy5pdGVtLmlkXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuaXRlbS5mZXRjaERhdGEoKTtcbiAgICAgICAgaWYgKHBhcnNlRmxvYXQoZGF0YS52ZXJzaW9uKSA8IDIpIHtcbiAgICAgICAgICB0aGlzLm1ha2VNYXBWaWV3KHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLndlYk1hcC5sb2FkKCk7XG4gICAgICAgICAgICBjb25zdCBhcmVhc0xheWVyID0gbmV3IEdyYXBoaWNzTGF5ZXIoeyBpZDogXCJhcmVhR3JhcGhpY3NcIiB9KTtcbiAgICAgICAgICAgIHRoaXMubWFwLmFkZChhcmVhc0xheWVyKTtcbiAgICAgICAgICAgIHRoaXMubWFrZU1hcFZpZXcoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRoaXMubWFrZU1hcFZpZXcodHJ1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgIH1cbiAgfVxuICBhc3luYyBtYWtlTWFwVmlldyhub1dlYk1hcCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBbTWFwVmlld10gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL3ZpZXdzL01hcFZpZXdcIl0pO1xuICAgICAgY29uc3QgbWFwVmlld01hcCA9IG5vV2ViTWFwIHx8ICF0aGlzLndlYk1hcCA/IHRoaXMubWFwIDogdGhpcy53ZWJNYXA7XG4gICAgICB0aGlzLm1hcFZpZXcgPSBuZXcgTWFwVmlldyh7XG4gICAgICAgIG1hcDogbWFwVmlld01hcCxcbiAgICAgICAgem9vbTogMixcbiAgICAgICAgY2VudGVyOiBbMCwgMF0sXG4gICAgICAgIGNvbnRhaW5lcjogdGhpcy5jb250YWluZXJcbiAgICAgIH0pO1xuICAgICAgbWFwVmlld01hcC53YXRjaChcImJhc2VtYXAudGl0bGVcIiwgKCkgPT4ge1xuICAgICAgICBjb25zdCBnYWxsZXJ5ID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvcihcIi5lc3JpLWJhc2VtYXAtZ2FsbGVyeVwiKTtcbiAgICAgICAgZ2FsbGVyeS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICB9KTtcbiAgICAgIHRoaXMubWFwVmlldy53aGVuKCgpID0+IHtcbiAgICAgICAgY29uc3QgZXh0ZW50ID0gdGhpcy5pdGVtLmV4dGVudCB8fCB0aGlzLnBvcnRhbC5kZWZhdWx0RXh0ZW50O1xuICAgICAgICBpZiAoZXh0ZW50KSB7XG4gICAgICAgICAgdGhpcy5tYXBWaWV3LmV4dGVudCA9IGV4dGVudDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFkZFdpZGdldHMoKTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICB9KTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfVxuICB9XG4gIGFzeW5jIGFkZFdpZGdldHMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IFtTZWFyY2gsIEJhc2VtYXBHYWxsZXJ5LCBpbnRsXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcbiAgICAgICAgXCJlc3JpL3dpZGdldHMvU2VhcmNoXCIsXG4gICAgICAgIFwiZXNyaS93aWRnZXRzL0Jhc2VtYXBHYWxsZXJ5XCIsXG4gICAgICAgIFwiZXNyaS9pbnRsXCJcbiAgICAgIF0pO1xuICAgICAgaWYgKHRoaXMubGFuZykge1xuICAgICAgICBpbnRsLnNldExvY2FsZSh0aGlzLmxhbmcpO1xuICAgICAgfVxuICAgICAgY29uc3Qgc2VhcmNoV2lkZ2V0ID0gbmV3IFNlYXJjaCh7XG4gICAgICAgIHZpZXc6IHRoaXMubWFwVmlldyxcbiAgICAgICAgcG9wdXBFbmFibGVkOiBmYWxzZSxcbiAgICAgICAgcmVzdWx0R3JhcGhpY0VuYWJsZWQ6IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHZtID0gc2VhcmNoV2lkZ2V0LnZpZXdNb2RlbDtcbiAgICAgIC8vIGZpeCB6b29tU2NhbGUgaXNzdWUgZm9yIGRyYXdpbmcgZXh0ZW50XG4gICAgICBzZWFyY2hXaWRnZXQudmlld01vZGVsLmFsbFNvdXJjZXMub24oXCJjaGFuZ2VcIiwgKCkgPT4ge1xuICAgICAgICB2bS5hbGxTb3VyY2VzLmZvckVhY2goKHNvdXJjZSkgPT4ge1xuICAgICAgICAgIHNvdXJjZS56b29tU2NhbGUgPSBudWxsO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5tYXBWaWV3LnVpLmFkZChzZWFyY2hXaWRnZXQsIHRoaXMuaXNSVEwgPyBcInRvcC1sZWZ0XCIgOiBcInRvcC1yaWdodFwiKTtcbiAgICAgIHNlYXJjaFdpZGdldC5vbihcInNlbGVjdC1yZXN1bHRcIiwgKHIpID0+IHtcbiAgICAgICAgdGhpcy5tYXBWaWV3LmdvVG8oci5yZXN1bHQuZXh0ZW50KTtcbiAgICAgIH0pO1xuICAgICAgY29uc3QgYmFzZW1hcEdhbGxlcnkgPSBuZXcgQmFzZW1hcEdhbGxlcnkoe1xuICAgICAgICB2aWV3OiB0aGlzLm1hcFZpZXcsXG4gICAgICAgIHNvdXJjZTogeyBwb3J0YWw6IHRoaXMucG9ydGFsIH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5tYXBWaWV3LnVpLmFkZChiYXNlbWFwR2FsbGVyeSk7XG4gICAgICB0aGlzLmFyY2dpc0ltYWdlVXBsb2FkRnJvbU1hcFJlYWR5LmVtaXQodGhpcy5tYXBWaWV3KTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfVxuICB9XG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImRpdlwiLCB7IGNsYXNzOiB7IFwiZnJvbS1tYXAtd3JhcHBlclwiOiB0cnVlLCBcImlzLXJ0bFwiOiB0aGlzLmlzUlRMIH0gfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcIm1hcC1jb250YWluZXJcIiwgcmVmOiAoZWwpID0+ICh0aGlzLmNvbnRhaW5lciA9IGVsKSB9KSwgdGhpcy5sb2FkaW5nID8gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJsb2FkZXItY29udGFpbmVyXCIgfSwgaChcImNhbGNpdGUtbG9hZGVyXCIsIHsgbGFiZWw6IHRoaXMubG9hZGluZ1RleHQgfSkpKSA6IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiYmFzZW1hcC10b2dnbGVcIiwgb25DbGljazogdGhpcy5oYW5kbGVCYXNlbWFwVG9nZ2xlIH0sIHRoaXMuY2hhbmdlQmFzZW1hcFRleHQpKSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzSW1hZ2VVcGxvYWRGcm9tTWFwLnN0eWxlID0gYXJjZ2lzSW1hZ2VVcGxvYWRGcm9tTWFwQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNJbWFnZVVwbG9hZEZyb21NYXAgYXMgYXJjZ2lzX2ltYWdlX3VwbG9hZF9mcm9tX21hcCB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1hYWYzMGJkNi5qcyc7XG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTEzZjViMDBjLmpzJztcblxuY29uc3QgbGFuZ3VhZ2VNYXAgPSBuZXcgTWFwKFtcbiAgW1wiYXJcIiwgXCJhclwiXSxcbiAgW1wiYmdcIiwgXCJiZ1wiXSxcbiAgW1wiYnNcIiwgXCJic1wiXSxcbiAgW1wiY2FcIiwgXCJjYVwiXSxcbiAgW1wiY3NcIiwgXCJjc1wiXSxcbiAgW1wiZGFcIiwgXCJkYVwiXSxcbiAgW1wiZGVcIiwgXCJkZVwiXSxcbiAgW1wiZWxcIiwgXCJlbFwiXSxcbiAgW1wiZW5cIiwgXCJlblwiXSxcbiAgW1wiZXNcIiwgXCJlc1wiXSxcbiAgW1wiZXRcIiwgXCJldFwiXSxcbiAgW1wiZmlcIiwgXCJmaVwiXSxcbiAgW1wiZnJcIiwgXCJmclwiXSxcbiAgW1wiaGVcIiwgXCJoZVwiXSxcbiAgW1wiaHJcIiwgXCJoclwiXSxcbiAgW1wiaHVcIiwgXCJodVwiXSxcbiAgW1wiaWRcIiwgXCJpZFwiXSxcbiAgW1wiaXRcIiwgXCJpdFwiXSxcbiAgW1wiamFcIiwgXCJqYVwiXSxcbiAgW1wia29cIiwgXCJrb1wiXSxcbiAgW1wibHRcIiwgXCJsdFwiXSxcbiAgW1wibHZcIiwgXCJsdlwiXSxcbiAgW1wibmJcIiwgXCJuYlwiXSxcbiAgW1wibmxcIiwgXCJubFwiXSxcbiAgW1wicGxcIiwgXCJwbFwiXSxcbiAgW1wicHQtYnJcIiwgXCJwdC1CUlwiXSxcbiAgW1wicHQtcHRcIiwgXCJwdC1QVFwiXSxcbiAgW1wicm9cIiwgXCJyb1wiXSxcbiAgW1wicnVcIiwgXCJydVwiXSxcbiAgW1wic2tcIiwgXCJza1wiXSxcbiAgW1wic2xcIiwgXCJzbFwiXSxcbiAgW1wic3JcIiwgXCJzclwiXSxcbiAgW1wic3ZcIiwgXCJzdlwiXSxcbiAgW1widGhcIiwgXCJ0aFwiXSxcbiAgW1widHJcIiwgXCJ0clwiXSxcbiAgW1widWtcIiwgXCJ1a1wiXSxcbiAgW1widmlcIiwgXCJ2aVwiXSxcbiAgW1wiemgtY25cIiwgXCJ6aC1DTlwiXSxcbiAgW1wiemgtaGtcIiwgXCJ6aC1IS1wiXSxcbiAgW1wiemgtdHdcIiwgXCJ6aC1UV1wiXVxuXSk7XG4vLyBydGxcbmZ1bmN0aW9uIGdldEVsZW1lbnREaXIoZWwpIHtcbiAgcmV0dXJuIGdldEVsZW1lbnRQcm9wKGVsLCBcImRpclwiLCBcImx0clwiKTtcbn1cbmZ1bmN0aW9uIGdldEVsZW1lbnRQcm9wKGVsLCBwcm9wLCB2YWx1ZSkge1xuICBjb25zdCBjbG9zZXN0V2l0aFByb3AgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWwsIGBbJHtwcm9wfV1gKTtcbiAgcmV0dXJuIGNsb3Nlc3RXaXRoUHJvcCA/IGNsb3Nlc3RXaXRoUHJvcC5nZXRBdHRyaWJ1dGUocHJvcCkgOiB2YWx1ZTtcbn1cbi8vIGNzc1xuY29uc3QgQ1NTX1VUSUxJVFkgPSB7XG4gIHJ0bDogXCJhcmNnaXMtLXJ0bFwiXG59O1xuYXN5bmMgZnVuY3Rpb24gZm9ybWF0TnVtYmVyKG51bWJlciwgb3B0aW9ucykge1xuICBjb25zdCB7IGFwaSwgdHlwZSwgcGxhY2VzIH0gPSBvcHRpb25zIHx8IHt9O1xuICBpZiAoYXBpID09PSA0KSB7XG4gICAgY29uc3QgW2ludGxdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9pbnRsXCJdKTtcbiAgICBjb25zdCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyA9IGludGwuY29udmVydE51bWJlckZvcm1hdFRvSW50bE9wdGlvbnMoe1xuICAgICAgcGxhY2VzLFxuICAgICAgc3R5bGU6IHR5cGUsXG4gICAgICBkaWdpdFNlcGFyYXRvcjogdHJ1ZVxuICAgIH0pO1xuICAgIHJldHVybiBpbnRsLmZvcm1hdE51bWJlcihudW1iZXIsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMpLCB7IHN0eWxlOiB0eXBlIH0pKTtcbiAgfVxuICBjb25zdCBbZG9qb051bWJlcl0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJkb2pvL251bWJlclwiXSk7XG4gIHJldHVybiBkb2pvTnVtYmVyLmZvcm1hdChudW1iZXIsIHtcbiAgICB0eXBlLFxuICAgIHBsYWNlcyxcbiAgICBwYXR0ZXJuOiBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMucGF0dGVyblxuICB9KTtcbn1cbmNvbnN0IGNhY2hlID0ge307XG5mdW5jdGlvbiBmb3JtYXREYXRlKGRhdGUpIHtcbiAgY29uc3QgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nO1xuICBjb25zdCBkYXlTaG9ydE1vbnRoWWVhciA9IHtcbiAgICB5ZWFyOiBcIm51bWVyaWNcIixcbiAgICBtb250aDogXCJzaG9ydFwiLFxuICAgIGRheTogXCJudW1lcmljXCJcbiAgfTtcbiAgaWYgKCFjYWNoZVtsYW5nXSkge1xuICAgIGNhY2hlW2xhbmddID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmxhbmcsIGRheVNob3J0TW9udGhZZWFyKTtcbiAgfVxuICByZXR1cm4gY2FjaGVbbGFuZ10uZm9ybWF0KGRhdGUpO1xufVxuXG5leHBvcnQgeyBDU1NfVVRJTElUWSBhcyBDLCBmb3JtYXREYXRlIGFzIGEsIGZvcm1hdE51bWJlciBhcyBmLCBnZXRFbGVtZW50RGlyIGFzIGcsIGxhbmd1YWdlTWFwIGFzIGwgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgeyBsIGFzIGxhbmd1YWdlTWFwIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtMjIyNThjOTAuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRBc3NldFBhdGggfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcblxuLy8gaHR0cHM6Ly9tZWRpdW0uY29tL3N0ZW5jaWwtdHJpY2tzL2ltcGxlbWVudGluZy1pbnRlcm5hdGlvbmFsaXNhdGlvbi1pMThuLXdpdGgtc3RlbmNpbC01ZTY1NTk1NTQxMTdcbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KSB7XG4gIHZhciBfYSwgX2IsIF9jO1xuICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICB9XG4gIGVsc2Uge1xuICAgIC8vIFwicnUtUlVcIiBtYXBzIHRvIFwicnVcIiB1c2UgY2FzZVxuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZy5zbGljZSgwLCAyKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCkge1xuICB2YXIgX2EsIF9iLCBfYztcbiAgLy8gaXQncyBPSyBpZiB3ZSBkb24ndCBoYXZlIHRoZSA0IGxldHRlciBsYW5ndWFnZSBmaWxlIGZvciBpdFxuICAvLyA0IGxldHRlciBsYW5ndWFnZSBjb2RlIG5lZWRlZCBmb3IgZm9ybWF0dGluZyBudW1iZXJzXG4gIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgLy8gd2Ugc3VwcG9ydCB0aGUgMiBsZXR0ZXIgY29kZWQgbGFuZ3VhZ2VcbiAgICAgIC8vIGUuZy4gaXQtQ0ggdnMgaXRcbiAgICAgIHJldHVybiBsYW5nO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBcImVuXCI7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgZmV0Y2goZ2V0QXNzZXRQYXRoKGAuLi9hcmNnaXMtYXBwLWFzc2V0cy9pMThuLyR7Y29tcG9uZW50TmFtZX0uaTE4bi4ke2xvY2FsZX0uanNvbmApKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgIGlmIChyZXN1bHQub2spXG4gICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XG4gICAgICBlbHNlXG4gICAgICAgIHJlamVjdCgpO1xuICAgIH0sICgpID0+IHJlamVjdCgpKTtcbiAgfSk7XG59XG5jb25zdCBzdHJpbmdDYWNoZSA9IHt9O1xuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICBjb25zdCBpZCA9IGAke2NvbXBvbmVudE5hbWV9JHtsb2NhbGV9YDtcbiAgaWYgKCFzdHJpbmdDYWNoZVtpZF0pIHtcbiAgICBzdHJpbmdDYWNoZVtpZF0gPSBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKTtcbiAgfVxuICByZXR1cm4gc3RyaW5nQ2FjaGVbaWRdO1xufVxuLyoqXG4gKiBHZXQgc3RyaW5ncyBhbmQgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGlzIG1ldGhvZCByZXR1cm5zIDIgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGUgZmlyc3Qgb25lIHJldHVybnMgYSBjb2RlIHRoYXQncyBhbHNvIHN1cHBvcnRlZCBhcyBhIGxhbmd1YWdlIGZpbGUuXG4gKiBUaGUgc2Vjb25kIG9uZSByZXR1cm5zIGEgY29kZSB3aGVyZSB0aGVyZSBpcyBzdXBwb3J0IGZvciB0aGUgZmlyc3QgMiBsZXR0ZXJzIG9mIHRoZSBjb2RlIGFzIHBhcnQgb2YgYSBsYW5ndWFnZSBmaWxlLFxuICogYnV0IHdpbGwgcmV0dXJuIHRoZSBvcmlnaW5hbCA0IGxldHRlciBjb2RlIGZyb20gdGhlIHBhZ2UuXG4gKiBFLmcuIEZvciBcIml0LWNoXCIgaXQgd2lsbCByZXR1cm4gXCJpdFwiIGFzIHRoZSBmaXJzdCBsYW5ndWFnZSBjb2RlIGFuZCBcIml0LWNoXCIgYXMgdGhlIHNlY29uZC5cbiAqIFRoZSBzZWNvbmQgb25lIGlzIHJlcXVpcmVkIGZvciBlc3JpLmludGwuc2V0TG9jYWxlKCkgdG8gZ2V0IHRoZSBjb3JyZWN0IGZvcm1hdHRpbmcuXG4gKlxuICogSWYgYSB0YWdOYW1lIGlzIHByb3ZpZGVkIGl0IHdpbGwgb3ZlcndpdGUgdGhlIGVsZW1lbnQncyB0YWdOYW1lXG4gKlxuICogIEByZXR1cm4gWyBzdHJpbmdzLCBmaXJzdCBsYW5ndWFnZSBjb2RlLCBzZWNvbmQgbGFuZ3VhZ2UgY29kZV1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyhlbGVtZW50LCB0YWdOYW1lKSB7XG4gIGNvbnN0IGNvbXBvbmVudE5hbWUgPSB0YWdOYW1lIHx8IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCBjb21wb25lbnRMYW5ndWFnZSA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KTtcbiAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2VJbnRsID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KTtcbiAgbGV0IHN0cmluZ3M7XG4gIHRyeSB7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBjb21wb25lbnRMYW5ndWFnZSk7XG4gIH1cbiAgY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLndhcm4oYG5vIGxvY2FsZSBmb3IgJHtjb21wb25lbnROYW1lfSAoJHtjb21wb25lbnRMYW5ndWFnZX0pIGxvYWRpbmcgZGVmYXVsdCBsb2NhbGUgZW4uYCk7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBcImVuXCIpO1xuICB9XG4gIHJldHVybiBbc3RyaW5ncywgY29tcG9uZW50TGFuZ3VhZ2UsIGNvbXBvbmVudExhbmd1YWdlSW50bF07XG59XG5cbmV4cG9ydCB7IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZSBhcyBhLCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIGFzIGcgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==