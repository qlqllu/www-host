"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-5a65ec"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-layer-override_3.entry.js":
/*!**************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-layer-override_3.entry.js ***!
  \**************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_layer_override: () => (/* binding */ ArcgisLayerOverride),
/* harmony export */   arcgis_layer_override_properties: () => (/* binding */ ArcgisLayerOverrideProperties),
/* harmony export */   arcgis_layer_override_status: () => (/* binding */ ArcgisLayerOverrideStatus)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commonFunctions-5262b094.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-5262b094.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _localStorage_f63100ef_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./localStorage-f63100ef.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/localStorage-f63100ef.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./commonEnums-f98a323c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-f98a323c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */









const CSS$2 = {
  container: "container",
  details: "details",
  buttons: "buttons",
  topButton: "top-button",
  properties: "properties",
  propertiesIcon: "properties-icon"
};

/**
 * get override status
 * @param props - LayerOverrideProps
 */
function getLayerOriginInfo(props) {
  const { layer, layerOriginUtils } = props;
  props.layerOriginInfo = layerOriginUtils.getLayerOriginInfo(layer, "web-map");
  //console.log("layerOriginInfo (web-map)", props.layerOriginInfo);
  //console.log("layerOriginInfo (portal-item)", layerOriginUtils.getLayerOriginInfo(layer, "portal-item"));
}

const arcgisLayerOverrideCss = ":host{height:100%}.container{padding:6px;background-color:white}.details{width:100%;margin-bottom:8px;cursor:pointer}.buttons{margin-bottom:14px}.top-button{margin-bottom:4px}.properties{margin-bottom:16px;cursor:pointer}.properties-icon{height:100%;padding:0 var(--calcite-notice-spacing-token-large)}";

const ArcgisLayerOverride = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisLayerOverrideChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisLayerOverrideChange", 7);
    this.arcgisLayerOverrideDuplicateClick = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisLayerOverrideDuplicateClick", 7);
    this.arcgisLayerOverrideSaveLayerClick = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisLayerOverrideSaveLayerClick", 7);
    this.arcgisLayerOverrideSaveAsLayerClick = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisLayerOverrideSaveAsLayerClick", 7);
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    this.afterCreateSource = (node) => {
      this.sourceNode = node;
    };
    this.afterCreateStatusAction = (node) => {
      this.statusActionNode = node;
    };
    this.afterCreatePropertiesButton = (node) => {
      this.propertiesNode = node;
    };
    this.onPanelScroll = async () => {
      var _a, _b;
      if (this.statusPopover) {
        const rect = await ((_a = this.statusPopover) === null || _a === void 0 ? void 0 : _a.getPopoverRect());
        if ((rect === null || rect === void 0 ? void 0 : rect.top) < 0) {
          this.closePopovers();
        }
      }
      if (this.propertiesPopover) {
        const rect = await ((_b = this.propertiesPopover) === null || _b === void 0 ? void 0 : _b.getPopoverRect());
        if ((rect === null || rect === void 0 ? void 0 : rect.top) < 0) {
          this.closePopovers();
        }
      }
    };
    this.openDetails = () => {
      const { layer } = this;
      const { portalItem } = layer;
      let url;
      if (portalItem === null || portalItem === void 0 ? void 0 : portalItem.portal) {
        if (portalItem.portal.urlKey) {
          url = `//${portalItem.portal.urlKey}.${portalItem.portal.customBaseUrl}/home/item.html?id=${portalItem.id}&sublayer=${layer.layerId}`;
        }
        else {
          url = `//${portalItem.portal.portalHostname}/home/item.html?id=${portalItem.id}&sublayer=${layer.layerId}`;
        }
      }
      else {
        url = `${layer.url}/${layer.layerId}`;
      }
      window.open(url);
    };
    this.saveLayer = (event) => {
      event.stopPropagation();
      const { layer } = this;
      this.arcgisLayerOverrideSaveLayerClick.emit(layer.id);
    };
    this.saveAsLayer = (event) => {
      event.stopPropagation();
      const { layer } = this;
      this.arcgisLayerOverrideSaveAsLayerClick.emit(layer.id);
    };
    this.duplicateLayer = (event) => {
      event.stopPropagation();
      const { layer } = this;
      this.arcgisLayerOverrideDuplicateClick.emit(layer.id);
    };
    this.openStatus = async (event) => {
      event.stopPropagation();
      if (this.containerPanelNode.disabled) {
        return;
      }
      // layer status floating panel
      if (this.statusPopover) {
        if (this.statusPopover.parentNode) {
          // already open, hide it
          this.statusPopover.parentNode.removeChild(this.statusPopover);
          this.statusPopover = null;
          return;
        }
        else {
          // got closed by something outside
          this.statusPopover = null;
        }
      }
      this.closePopovers();
      await this.scrollIntoView(this.sourceNode);
      const { props, strings } = this;
      const popover = document.createElement("arcgis-layer-override-status");
      popover.props = props;
      popover.strings = strings;
      popover.popoverReferenceElement = this.sourceNode;
      document.body.appendChild(popover);
      this.statusPopover = popover;
      this.disableContainer(true);
    };
    this.openManageProps = async () => {
      // manage layer properties floating panel
      // layer status floating panel
      if (this.propertiesPopover) {
        if (this.propertiesPopover.parentNode) {
          // already open, hide it
          this.propertiesPopover.parentNode.removeChild(this.propertiesPopover);
          this.propertiesPopover = null;
          return;
        }
        else {
          // got closed by something outside
          this.propertiesPopover = null;
        }
      }
      this.closePopovers();
      await this.scrollIntoView(this.sourceNode);
      const { props, strings } = this;
      const popover = document.createElement("arcgis-layer-override-properties");
      popover.props = props;
      popover.strings = strings;
      popover.popoverReferenceElement = this.sourceNode;
      document.body.appendChild(popover);
      this.propertiesPopover = popover;
      this.disableContainer(true);
    };
    this.layer = undefined;
    this.config = undefined;
    this.portal = undefined;
    this.props = undefined;
    this.reRender = false;
  }
  closeAllPopoversHandler() {
    this.closePopovers();
  }
  arcgisLayerOverridePropChange() {
    this.arcgisLayerOverrideChange.emit();
    this.reRender = !this.reRender;
  }
  arcgisLayerOverrideStatusChange() {
    this.reRender = !this.reRender;
  }
  //--------------------------------------------------------------------------
  //
  //  public calls
  //
  //--------------------------------------------------------------------------
  /**
   * Set focus on component
   */
  async setFocus() { }
  /**
   * Close popovers before removing component
   */
  async done() {
    this.closePopovers();
  }
  /**
   * Refresh content, e.g. after layer properties changes
   */
  async refresh() {
    getLayerOriginInfo(this.props);
    this.reRender = !this.reRender;
  }
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  async componentWillLoad() {
    const [strings] = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement);
    this.strings = strings;
    // build LayerOverrideProps
    this.props = {
      layer: this.layer,
      portal: this.portal,
      config: this.config
    };
    const [layerOriginUtils] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_3__.l)(["esri/layers/support/layerOriginUtils"]);
    this.props.layerOriginUtils = layerOriginUtils;
    layerOriginUtils.isSupportedLayer(this.layer);
    getLayerOriginInfo(this.props);
  }
  async componentDidLoad() {
    var _a;
    // once component is visible make other calls
    this.containerPanelNode = (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_2__.q)(this.hostElement, "calcite-panel");
    if (!this.containerPanelNode) {
      this.containerPanelNode = (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_2__.q)(this.hostElement, "calcite-flow-item");
    }
    (_a = this.containerPanelNode) === null || _a === void 0 ? void 0 : _a.addEventListener("calcitePanelScroll", this.onPanelScroll);
  }
  disconnectedCallback() {
    var _a;
    (_a = this.containerPanelNode) === null || _a === void 0 ? void 0 : _a.removeEventListener("calcitePanelScroll", this.onPanelScroll);
    this.closePopovers();
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.container }, this.renderSource(), this.renderCopy(), this.renderStatus(), this.renderProperties())));
  }
  renderSource() {
    var _a;
    const { strings, layer } = this;
    const itemTitle = (_a = layer.portalItem) === null || _a === void 0 ? void 0 : _a.title;
    const layerTitle = layer.title;
    const rtl = (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_4__.g)(this.hostElement) === "rtl";
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { ref: this.afterCreateSource }, strings.sourceLayer, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile", { class: CSS$2.details, heading: itemTitle
        ? rtl
          ? `${layerTitle} / ${itemTitle}`
          : `${itemTitle} / ${layerTitle}`
        : layerTitle, description: layer.isTable ? "Table" : "Feature layer", onClick: this.openDetails }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { scale: "s", compact: true, slot: "content-end", icon: "launch", text: strings.sourceLayer, onClick: this.openDetails }))));
  }
  renderCopy() {
    var _a;
    const { strings, layer, props } = this;
    const { portal } = props;
    const canCreateItems = this.canCreateItems(portal === null || portal === void 0 ? void 0 : portal.user);
    const canSave = ["admin", "update"].indexOf((_a = layer.portalItem) === null || _a === void 0 ? void 0 : _a.itemControl) > -1;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.buttons }, canSave && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { width: "full", appearance: "outline-fill", kind: "neutral", iconStart: "save", class: CSS$2.topButton, label: strings.save, onClick: this.saveLayer }, strings.save)), canCreateItems && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { width: "full", appearance: "outline-fill", kind: "neutral", iconStart: "save", class: CSS$2.topButton, label: strings.saveAs, onClick: this.saveAsLayer }, strings.saveAs)), !layer.isTable && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { width: "full", appearance: "outline-fill", kind: "neutral", iconStart: "duplicate", label: strings.duplicate, onClick: this.duplicateLayer }, strings.duplicate))));
  }
  renderStatus() {
    const { strings, layer, props } = this;
    const { layerOriginInfo } = props;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { class: CSS$2.properties, width: "full", scale: "s", open: true, onClick: this.openStatus }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, layerOriginInfo.status === "source"
      ? strings.propsFromSource
      : layerOriginInfo.status === "overridden"
        ? strings.propsSetInWebmap
        : strings.somePropsSetInWebmap), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "actions-end", icon: "information", scale: "s", compact: true, class: CSS$2.propertiesIcon, text: layer.isTable ? strings.tableStatus : strings.layerStatus, onClick: this.openStatus, ref: this.afterCreateStatusAction })));
  }
  renderProperties() {
    const { strings, layer } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", kind: "neutral", width: "full", label: layer.isTable ? strings.manageTableProps : strings.manageLayerProps, onClick: this.openManageProps, ref: this.afterCreatePropertiesButton }, layer.isTable ? strings.manageTableProps : strings.manageLayerProps));
  }
  closePopovers() {
    this.closeStatusPopover();
    this.closePropertiesPopover();
    this.disableContainer(false);
  }
  closeStatusPopover() {
    var _a;
    if (this.statusPopover) {
      (_a = this.statusPopover.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(this.statusPopover);
      this.statusPopover = null;
      setTimeout(() => {
        // doesn't work without timeout
        this.statusActionNode.setFocus();
      }, 300);
    }
  }
  closePropertiesPopover() {
    var _a;
    if (this.propertiesPopover) {
      (_a = this.propertiesPopover.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(this.propertiesPopover);
      this.propertiesPopover = null;
      setTimeout(() => {
        // doesn't work without timeout
        this.propertiesNode.setFocus();
      }, 300);
    }
  }
  scrollIntoView(referenceElement) {
    var _a;
    if (((_a = referenceElement.getBoundingClientRect()) === null || _a === void 0 ? void 0 : _a.top) < 0) {
      // let's make sure it fully shows
      referenceElement.scrollIntoView({
        behavior: "smooth",
        block: "nearest",
        inline: "start"
      });
      // wait until scrolling is done
      return new Promise(async (resolve) => {
        let count = 0;
        const hndl = setInterval(() => {
          var _a;
          if (count > 10 || ((_a = referenceElement.getBoundingClientRect()) === null || _a === void 0 ? void 0 : _a.top) >= 0) {
            clearInterval(hndl);
            resolve();
          }
          count++;
        }, 100);
      });
    }
    else {
      return Promise.resolve();
    }
  }
  disableContainer(disable) {
    if (this.containerPanelNode) {
      this.containerPanelNode.disabled = disable;
    }
  }
  canCreateItems(user) {
    var _a;
    return user && (this.isPublicUser(user) || ((_a = user.privileges) === null || _a === void 0 ? void 0 : _a.includes("portal:user:createItem")));
  }
  isPublicUser(user) {
    return !user.orgId;
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLayerOverride.style = arcgisLayerOverrideCss;

const CSS$1 = {
  popover: "popover",
  content: "content",
  notice: "notice",
  tile: "tile",
  tooltip: "tooltip"
};

const arcgisLayerOverridePropertiesCss = ".popover{z-index:100}.content{padding:0.5rem 0.75rem;background-color:#ffffff;max-height:80vh}.notice{margin-bottom:16px}.tile{cursor:pointer}.tooltip{max-width:80%}";

const ArcgisLayerOverrideProperties = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.closeAllPopovers = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeAllPopovers", 7);
    this.arcgisLayerOverridePropertiesChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisLayerOverridePropertiesChange", 7);
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    this.afterCreatePopover = (node) => {
      this.popoverNode = node;
    };
    this.afterCreateCloseButton = (node) => {
      this.closeButtonNode = node;
    };
    this.handleCloseClick = () => {
      this.closeAllPopovers.emit();
    };
    this.resetToSource = (event) => {
      event.stopPropagation();
      const { props } = this;
      const { layer, layerOriginUtils } = props;
      layerOriginUtils.clearOverrides(layer, "web-map");
      this.reRender = !this.reRender;
      this.arcgisLayerOverridePropertiesChange.emit();
    };
    this.disconnectProps = (event) => {
      event.stopPropagation();
      const { props } = this;
      const { layer, layerOriginUtils } = props;
      layerOriginUtils.disconnectFromSource(layer, "web-map");
      this.reRender = !this.reRender;
      this.arcgisLayerOverridePropertiesChange.emit();
    };
    this.props = undefined;
    this.popoverReferenceElement = undefined;
    this.strings = undefined;
    this.reRender = false;
    this.isOpen = false;
  }
  //--------------------------------------------------------------------------
  //
  //  public calls
  //
  //--------------------------------------------------------------------------
  /**
   * Repositions popover
   */
  async reposition() {
    var _a;
    (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.reposition();
  }
  /**
   * Calls getBoundingClientRect() on popover
   */
  async getPopoverRect() {
    var _a;
    return (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect();
  }
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  componentDidLoad() {
    this.popoverNode.reposition();
    this.isOpen = true;
    // need timeout because of re-render
    setTimeout(() => requestAnimationFrame(() => this.closeButtonNode.setFocus()), 100);
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    var _a;
    const { popoverReferenceElement, strings, props } = this;
    const { layer } = props;
    const nodeWidth = popoverReferenceElement.clientWidth;
    // let the popover start at the top of the reference element
    const offsetDistance = popoverReferenceElement.clientHeight ||
      ((_a = popoverReferenceElement.getBoundingClientRect()) === null || _a === void 0 ? void 0 : _a.height) ||
      96;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { placement: "bottom", dir: document.dir, open: this.isOpen, pointerDisabled: true, referenceElement: popoverReferenceElement, offsetDistance: -1 * offsetDistance, offsetSkidding: 0, class: CSS$1.popover, style: nodeWidth
        ? {
          width: `${nodeWidth + 60}px`
        }
        : null, label: layer.isTable ? strings.manageTableProps : strings.manageLayerProps, ref: this.afterCreatePopover, onCalcitePopoverBeforeClose: () => this.closeAllPopovers.emit() }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { style: nodeWidth
        ? {
          width: `${nodeWidth + 58}px`
        }
        : null }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: layer.isTable ? strings.manageTableProps : strings.manageLayerProps }, this.renderCloseButton(), this.renderContent())))));
  }
  renderCloseButton() {
    const { strings } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { text: strings.close, scale: "s", slot: "header-actions-end", onClick: this.handleCloseClick, ref: this.afterCreateCloseButton, icon: "x" }));
  }
  renderContent() {
    const { strings, props } = this;
    const { layer } = props;
    // always make a new call in case things have changed
    getLayerOriginInfo(props);
    const { layerOriginInfo } = props;
    const resetToSourceDisabled = layerOriginInfo.status === "source";
    const disconnectDisabled = layerOriginInfo.status === "overridden";
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$1.content }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { class: CSS$1.notice, width: "full", scale: "s", open: true }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, layerOriginInfo.status === "source"
      ? strings.propsFromSource
      : layerOriginInfo.status === "overridden"
        ? strings.propsSetInWebmap
        : strings.somePropsSetInWebmap)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { id: "layer-override-reset" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile", { heading: strings.resetToSource, description: strings.discardProps, class: CSS$1.tile, disabled: resetToSourceDisabled, onClick: !resetToSourceDisabled ? this.resetToSource : null }, resetToSourceDisabled ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", slot: "content-start", icon: "reset" })) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { scale: "s", compact: true, slot: "content-start", icon: "reset", text: strings.resetToSource, onClick: !resetToSourceDisabled ? this.resetToSource : null })))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { id: "layer-override-disconnect" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile", { heading: layer.isTable ? strings.disconnectPropsTable : strings.disconnectProps, description: strings.setPropsInWebmap, class: CSS$1.tile, disabled: disconnectDisabled, onClick: !disconnectDisabled ? this.disconnectProps : null }, disconnectDisabled ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", slot: "content-start", icon: "unlink" })) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { scale: "s", compact: true, slot: "content-start", icon: "unlink", text: strings.disconnectProps, onClick: !disconnectDisabled ? this.disconnectProps : null })))), resetToSourceDisabled && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { class: CSS$1.tooltip, placement: "top", offsetDistance: -50, overlayPositioning: "fixed", referenceElement: "layer-override-reset", label: strings.propsCannotBeReset }, strings.propsCannotBeReset)), disconnectDisabled && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { class: CSS$1.tooltip, placement: "top", offsetDistance: -50, overlayPositioning: "fixed", referenceElement: "layer-override-disconnect", label: strings.propsCannotBeDisconnected }, strings.propsCannotBeDisconnected))));
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLayerOverrideProperties.style = arcgisLayerOverridePropertiesCss;

const CSS = {
  popover: "popover",
  content: "content",
  notice: "notice",
  filter: "filter",
  blockContent: "block-content",
  listHeader: "list-header"
};

const arcgisLayerOverrideStatusCss = ".popover{z-index:100}.content{max-height:60vh}.notice{margin:8px}.filter{border-width:0px 0px 1px;border-color:var(--calcite-ui-border-3);border-style:solid}.block-content{background-color:var(--calcite-ui-foreground-2)}.list-header{padding:0.75rem 0.5rem 0.25rem 0.5rem}";

const ArcgisLayerOverrideStatus = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.closeAllPopovers = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeAllPopovers", 7);
    this.arcgisLayerOverrideStatusChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisLayerOverrideStatusChange", 7);
    this.documentTabHandler = undefined;
    this.documentClickHandler = undefined;
    this.allItems = [];
    this.dataTypes = [
      "data",
      "definition-expression",
      "popup",
      "refresh-interval",
      "use-view-time",
      //"editing-enabled",
      "form-template",
      "floor-info",
      "custom-parameters",
      "charts"
    ];
    this.appearanceTypes = [
      "renderer",
      "labels",
      "scale-range",
      "opacity",
      "feature-reduction",
      "blend-mode",
      "effect",
      "legend-enabled",
      "order-by"
    ];
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    this.afterCreatePopover = (node) => {
      this.popoverNode = node;
    };
    this.afterCreateCloseButton = (node) => {
      this.closeButtonNode = node;
    };
    this.handleCloseClick = () => {
      this.closeAllPopovers.emit();
    };
    this.props = undefined;
    this.popoverReferenceElement = undefined;
    this.strings = undefined;
    this.reRender = false;
    this.filteredItems = undefined;
    this.isOpen = false;
  }
  //--------------------------------------------------------------------------
  //
  //  public calls
  //
  //--------------------------------------------------------------------------
  /**
   * Repositions popover
   */
  async reposition() {
    var _a;
    (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.reposition();
  }
  /**
   * Calls getBoundingClientRect() on popover
   */
  async getPopoverRect() {
    var _a;
    return (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect();
  }
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  async componentWillLoad() {
    var _a, _b;
    const { strings } = this;
    // always make a new call in case things have changed
    const beforeStatus = (_a = this.props.layerOriginInfo) === null || _a === void 0 ? void 0 : _a.status;
    getLayerOriginInfo(this.props);
    const afterStatus = (_b = this.props.layerOriginInfo) === null || _b === void 0 ? void 0 : _b.status;
    if (beforeStatus !== afterStatus) {
      // refesh notice text
      this.arcgisLayerOverrideStatusChange.emit();
    }
    this.allItems = [
      {
        value: "data",
        title: strings.status.data
      },
      {
        value: "definition-expression",
        title: strings.status.filter
      },
      {
        value: "popup",
        title: strings.status.popupsAndAttributes
      },
      {
        value: "refresh-interval",
        title: strings.status.refreshInterval
      },
      {
        value: "use-view-time",
        title: strings.status.time
      },
      {
        value: "editing-enabled",
        title: strings.status.editing
      },
      {
        value: "form-template",
        title: strings.status.formTemplate
      },
      {
        value: "floor-info",
        title: strings.status.floorInfo
      },
      {
        value: "custom-parameters",
        title: strings.status.customParameters
      },
      {
        value: "charts",
        title: strings.status.charts
      },
      {
        value: "renderer",
        title: strings.status.style
      },
      {
        value: "labels",
        title: strings.status.labels
      },
      {
        value: "scale-range",
        title: strings.status.visibleRange
      },
      {
        value: "opacity",
        title: strings.status.transparency
      },
      {
        value: "feature-reduction",
        title: strings.status.aggregation
      },
      {
        value: "blend-mode",
        title: strings.status.blending
      },
      {
        value: "effect",
        title: strings.status.effects
      },
      {
        value: "legend-enabled",
        title: strings.status.legend
      },
      {
        value: "order-by",
        title: strings.status.orderBy
      }
    ];
  }
  componentDidLoad() {
    this.popoverNode.reposition();
    this.isOpen = true;
    // need timeout because of re-render
    setTimeout(() => requestAnimationFrame(() => this.closeButtonNode.setFocus()), 100);
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    var _a;
    const { popoverReferenceElement, strings, props } = this;
    const { layer } = props;
    const nodeWidth = popoverReferenceElement.clientWidth;
    const nodeHeight = document.body.clientHeight;
    // let the popover start at the top of the reference element
    const offsetDistance = popoverReferenceElement.clientHeight ||
      ((_a = popoverReferenceElement.getBoundingClientRect()) === null || _a === void 0 ? void 0 : _a.height) ||
      96;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { placement: "bottom", dir: document.dir, open: this.isOpen, pointerDisabled: true, referenceElement: popoverReferenceElement, offsetDistance: -1 * offsetDistance, offsetSkidding: 0, class: CSS.popover, style: nodeWidth
        ? {
          width: `${nodeWidth + 60}px`
        }
        : null, label: "", ref: this.afterCreatePopover, onCalcitePopoverBeforeClose: () => this.closeAllPopovers.emit() }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { style: nodeWidth
        ? {
          width: `${nodeWidth + 58}px`,
          maxHeight: `${nodeHeight * 0.7}px`
        }
        : null }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: layer.isTable ? strings.tableStatus : strings.layerStatus, ref: (node) => {
        node.addEventListener("calciteFlowItemScroll", () => this.closeInfoPopover());
      } }, this.renderCloseButton(), this.renderContent())))));
  }
  renderCloseButton() {
    const { strings } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { text: strings.close, scale: "s", slot: "header-actions-end", onClick: this.handleCloseClick, ref: this.afterCreateCloseButton, icon: "x" }));
  }
  renderContent() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.content }, this.renderInfo(), this.renderSearch(), this.renderDataContent(), this.renderAppearanceContent()));
  }
  renderInfo() {
    const { props, strings } = this;
    const { config } = props;
    const { helpBase, helpMap } = config;
    if ((0,_localStorage_f63100ef_js__WEBPACK_IMPORTED_MODULE_5__.g)(_localStorage_f63100ef_js__WEBPACK_IMPORTED_MODULE_5__.l.ARCGIS_COMPONENT_NOTIFICATIONS, _localStorage_f63100ef_js__WEBPACK_IMPORTED_MODULE_5__.a.LAYER_OVERRIDE_STATUS_TIP_DISMISSED)) {
      return null;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { class: CSS.notice, open: true, closable: true, scale: "s", width: "auto", onCalciteNoticeClose: () => {
        (0,_localStorage_f63100ef_js__WEBPACK_IMPORTED_MODULE_5__.s)(_localStorage_f63100ef_js__WEBPACK_IMPORTED_MODULE_5__.l.ARCGIS_COMPONENT_NOTIFICATIONS, {
          key: _localStorage_f63100ef_js__WEBPACK_IMPORTED_MODULE_5__.a.LAYER_OVERRIDE_STATUS_TIP_DISMISSED,
          value: "true"
        });
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, strings.tip), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { slot: "link", title: strings.learnMore, target: "_blank", href: `${helpBase}${helpMap["120002913"]}` }, strings.learnMore)));
  }
  renderSearch() {
    const { allItems, strings } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-filter", { items: allItems, messageOverrides: { label: strings.status.searchPlaceholder, clear: strings.status.clear }, placeholder: strings.status.searchPlaceholder, class: CSS.filter, onCalciteFilterChange: (event) => {
        this.filteredItems = event.target.filteredItems;
        this.dataBlockNode.open = true;
        if (this.appearanceBlockNode) {
          this.appearanceBlockNode.open = true;
        }
        setTimeout(() => {
          // doesn't work without timeout
          this.reposition();
        }, 100);
      } }));
  }
  renderDataContent() {
    const { allItems, filteredItems, dataTypes, strings } = this;
    let items = (filteredItems || allItems)
      .filter((item) => dataTypes.indexOf(item.value) > -1)
      .map((item) => {
      if (item.value === "data") {
        // data is never overridden
        return [item.title, "source"];
      }
      else {
        return [item.title, this.getOverrideType(item.value)];
      }
    });
    items.sort((a, b) => a[0].localeCompare(b[0]));
    // move "data" to beginning of list; unless it's filtered out
    const dataItem = items.find((item) => item[0] === strings.status.data);
    if (dataItem) {
      items = items.filter((item) => item[0] !== strings.status.data);
      items.unshift(dataItem);
    }
    const sourceItems = items.filter((item) => item[1] === "source");
    const mapItems = items.filter((item) => item[1] === "webmap");
    const hasSourceItems = sourceItems.length > 0;
    const hasMapItems = mapItems.length > 0;
    const summary = hasSourceItems && hasMapItems
      ? strings.somePropsSetInWebmap
      : hasSourceItems
        ? strings.propsFromSource
        : strings.propsSetInWebmap;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { heading: strings.status.dataProps, description: summary, collapsible: true, open: hasMapItems, onCalciteBlockToggle: () => {
        setTimeout(() => {
          // doesn't work without timeout
          this.reposition();
        }, 100);
      }, ref: (node) => (this.dataBlockNode = node) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.blockContent }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", null, hasMapItems && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: CSS.listHeader, scale: "s" }, strings.setInWebmap)), hasMapItems && mapItems.map(([label, type]) => this.renderListItem(label, type)), hasSourceItems && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: CSS.listHeader, scale: "s" }, strings.setFromSource)), hasSourceItems && sourceItems.map(([label, type]) => this.renderListItem(label, type))))));
  }
  renderAppearanceContent() {
    const { allItems, filteredItems, appearanceTypes, strings, props } = this;
    const { layer } = props;
    if (layer.isTable) {
      return null;
    }
    const items = (filteredItems || allItems)
      .filter((item) => appearanceTypes.indexOf(item.value) > -1)
      .map((item) => [item.title, this.getOverrideType(item.value)]);
    items.sort((a, b) => a[0].localeCompare(b[0]));
    const sourceItems = items.filter((item) => item[1] === "source");
    const mapItems = items.filter((item) => item[1] === "webmap");
    const hasSourceItems = sourceItems.length > 0;
    const hasMapItems = mapItems.length > 0;
    const summary = hasSourceItems && hasMapItems
      ? strings.somePropsSetInWebmap
      : hasSourceItems
        ? strings.propsFromSource
        : strings.propsSetInWebmap;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { heading: strings.status.appearanceProps, description: summary, collapsible: true, open: hasMapItems, onCalciteBlockToggle: () => {
        setTimeout(() => {
          // doesn't work without timeout
          this.reposition();
        }, 100);
      }, ref: (node) => (this.appearanceBlockNode = node) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.blockContent }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", null, hasMapItems && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.listHeader }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: "s" }, strings.setInWebmap))), hasMapItems && mapItems.map(([label, type]) => this.renderListItem(label, type)), hasSourceItems && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.listHeader }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: "s" }, strings.setFromSource))), hasSourceItems && sourceItems.map(([label, type]) => this.renderListItem(label, type))))));
  }
  renderListItem(label, type) {
    const { strings } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { label: label }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "actions-end", text: strings.moreInfo, icon: "information", onClick: (event) => this.moreInfo(label, type, event) })));
  }
  moreInfo(label, type, event) {
    const { popoverNode, strings } = this;
    const referenceNode = event.currentTarget;
    this.closeInfoPopover();
    const div = document.createElement("div");
    div.innerHTML =
      type === "source"
        ? strings.propReflectUpdates.replace("${label}", label)
        : strings.propNotConnected.replace("${label}", label);
    div.style = `width: ${popoverNode.clientWidth * 0.8}px; font-size: var(--calcite-font-size--1); line-height: 1rem; margin: 0.75rem;`;
    /* issue with calcite
    const labelNode = document.createElement("calcite-label");
    labelNode.scale = "m";
    labelNode.innerHTML = type === "source" ? strings.propReflectUpdates : strings.propNotConnected;
    (labelNode as any).style = `width: ${popoverNode.clientWidth * 0.7}px;`;
    */
    const moreInfoPopover = document.createElement("calcite-popover");
    moreInfoPopover.heading = type === "source" ? strings.setFromSource : strings.setInWebmap;
    moreInfoPopover.placement = "auto";
    moreInfoPopover.offsetSkidding = 5;
    moreInfoPopover.closable = true;
    moreInfoPopover.label = strings.moreInfo;
    moreInfoPopover.referenceElement = referenceNode;
    moreInfoPopover.className = `js-app-flyout`; // js-app-flyout needed by app
    document.body.appendChild(moreInfoPopover);
    moreInfoPopover.appendChild(div);
    moreInfoPopover.setAttribute("open", "true");
    moreInfoPopover.reposition();
    moreInfoPopover.addEventListener("calcitePopoverClose", () => {
      this.closeInfoPopover();
    });
    // need to wait until it's all visible
    setTimeout(() => moreInfoPopover.setFocus(), 100);
    setTimeout(() => {
      // close popover when tabbing out
      this.documentTabHandler = (event) => {
        if (event.key === "Tab") {
          event.stopPropagation();
          this.closeInfoPopover();
        }
      };
      document.addEventListener("keydown", this.documentTabHandler);
      // close popover when clicking outside
      this.documentClickHandler = () => this.closeInfoPopover();
      document.addEventListener("click", this.documentClickHandler);
    }, 100);
    this.moreInfoPopoverNode = moreInfoPopover;
  }
  closeInfoPopover() {
    var _a;
    if (this.moreInfoPopoverNode) {
      (_a = this.moreInfoPopoverNode.referenceElement) === null || _a === void 0 ? void 0 : _a.setFocus();
      document.body.removeChild(this.moreInfoPopoverNode);
      this.moreInfoPopoverNode = null;
    }
    if (this.documentTabHandler) {
      document.removeEventListener("keydown", this.documentTabHandler);
      this.documentTabHandler = undefined;
    }
    if (this.documentClickHandler) {
      document.removeEventListener("click", this.documentClickHandler);
      this.documentClickHandler = undefined;
    }
  }
  isOverridden(id) {
    var _a, _b, _c;
    const { props } = this;
    const { layerOriginInfo } = props;
    return !!(((_c = (_b = (_a = layerOriginInfo === null || layerOriginInfo === void 0 ? void 0 : layerOriginInfo.propertyGroupOriginInfos) === null || _a === void 0 ? void 0 : _a.filter((info) => info.id === id)) === null || _b === void 0 ? void 0 : _b[0]) === null || _c === void 0 ? void 0 : _c.status) === "overridden");
  }
  getOverrideType(id) {
    return this.isOverridden(id) ? "webmap" : "source";
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLayerOverrideStatus.style = arcgisLayerOverrideStatusCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/localStorage-f63100ef.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/localStorage-f63100ef.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ arcgisComponentNotificationsKeys),
/* harmony export */   g: () => (/* binding */ getSingleObjectLocalStorage),
/* harmony export */   l: () => (/* binding */ localStorageKeys),
/* harmony export */   s: () => (/* binding */ setSingleObjectLocalStorage)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
var localStorageKeys;
(function (localStorageKeys) {
  localStorageKeys["ARCGIS_COMPONENT_NOTIFICATIONS"] = "arcgisComponent_notifications";
})(localStorageKeys || (localStorageKeys = {}));
var arcgisComponentNotificationsKeys;
(function (arcgisComponentNotificationsKeys) {
  arcgisComponentNotificationsKeys["FEATURE_REDUCTION_WARNING_DISMISSED"] = "arcgis_feature_reduction_warning_dismissed";
  arcgisComponentNotificationsKeys["POPUP_WARNING_DISMISSED"] = "arcgis_popup_warning_dismissed";
  arcgisComponentNotificationsKeys["INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED"] = "arcgis_symbol_styler_incompatible_vector_symbols_dismissed";
  arcgisComponentNotificationsKeys["EFFECTS_TIP_DISMISSED"] = "arcgis_effects_tip_dismissed";
  arcgisComponentNotificationsKeys["LAYER_VIEW_DEFINITION_DISMISSED"] = "arcgis_layer_view_definition_dismissed";
  arcgisComponentNotificationsKeys["LAYER_OVERRIDE_STATUS_TIP_DISMISSED"] = "arcgis_layer_override_status_tip_dismissed";
  arcgisComponentNotificationsKeys["LAYER_VIEW_JOIN_TIP_DISMISSED"] = "arcgis_layer_view_join_tip_dismissed";
  arcgisComponentNotificationsKeys["MULTIDIMENSIONAL_INFO_TIP_DISMISSED"] = "arcgis_multidimensional_info_tip_dismissed";
})(arcgisComponentNotificationsKeys || (arcgisComponentNotificationsKeys = {}));
const getLocalStorage = (localStorageKey) => {
  return localStorage.getItem(localStorageKey);
};
const setLocalStorage = (localStorageKey, value) => {
  localStorage.setItem(localStorageKey, value);
};
const getObjectLocalStorage = (localStorageKey) => {
  return JSON.parse(getLocalStorage(localStorageKey)) || {};
};
const setSingleObjectLocalStorage = (localStorageKey, keyValueObject) => {
  const setLocalStorageVal = getObjectLocalStorage(localStorageKey);
  setLocalStorageVal[keyValueObject.key] = keyValueObject.value;
  setLocalStorage(localStorageKey, JSON.stringify(setLocalStorageVal));
};
const getSingleObjectLocalStorage = (localStorageKey, objectKey) => {
  const getLocalStorageVal = getObjectLocalStorage(localStorageKey);
  if (getLocalStorageVal === null || getLocalStorageVal === void 0 ? void 0 : getLocalStorageVal.hasOwnProperty(objectKey)) {
    return getLocalStorageVal[objectKey];
  }
  else {
    return null;
  }
};




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
  var _a, _b, _c;
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    // "ru-RU" maps to "ru" use case
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
    }
    else {
      return "en";
    }
  }
}
function getComponentClosestLanguageIntl(element) {
  var _a, _b, _c;
  // it's OK if we don't have the 4 letter language file for it
  // 4 letter language code needed for formatting numbers
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      // we support the 2 letter coded language
      // e.g. it-CH vs it
      return lang;
    }
    else {
      return "en";
    }
  }
}
function fetchLocaleStringsForComponent(componentName, locale) {
  return new Promise((resolve, reject) => {
    fetch((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
      if (result.ok)
        resolve(result.json());
      else
        reject();
    }, () => reject());
  });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
  const id = `${componentName}${locale}`;
  if (!stringCache[id]) {
    stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
  }
  return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
  const componentName = tagName || element.tagName.toLowerCase();
  const componentLanguage = getComponentClosestLanguage(element);
  const componentLanguageIntl = getComponentClosestLanguageIntl(element);
  let strings;
  try {
    strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
  }
  catch (e) {
    console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
    strings = await fetchLocaleStringsFromCache(componentName, "en");
  }
  return [strings, componentLanguage, componentLanguageIntl];
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTVhNjVlYy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzZHO0FBQ3ZDO0FBQ0U7QUFDWDtBQUNHO0FBQzhHO0FBQ25KO0FBQ1E7O0FBRW5DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsMEJBQTBCO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHNDQUFzQyxZQUFZLFdBQVcsWUFBWSx1QkFBdUIsU0FBUyxXQUFXLGtCQUFrQixlQUFlLFNBQVMsbUJBQW1CLFlBQVksa0JBQWtCLFlBQVksbUJBQW1CLGVBQWUsaUJBQWlCLFlBQVksb0RBQW9EOztBQUU5VTtBQUNBO0FBQ0EsSUFBSSxxREFBZ0I7QUFDcEIscUNBQXFDLHFEQUFXO0FBQ2hELDZDQUE2QyxxREFBVztBQUN4RCw2Q0FBNkMscURBQVc7QUFDeEQsK0NBQStDLHFEQUFXO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsUUFBUTtBQUN0QixjQUFjLGFBQWE7QUFDM0I7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLHlCQUF5QixHQUFHLGdDQUFnQyxxQkFBcUIsY0FBYyxZQUFZLGNBQWM7QUFDOUk7QUFDQTtBQUNBLHFCQUFxQixpQ0FBaUMscUJBQXFCLGNBQWMsWUFBWSxjQUFjO0FBQ25IO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixVQUFVLEdBQUcsY0FBYztBQUM1QztBQUNBO0FB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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFVBQVU7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDBDQUEwQztBQUN0RCxZQUFZLFFBQVE7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxxREFBQyxDQUFDLGlE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R0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixjQUFjLEVBQUUsT0FBTztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsZUFBZSxHQUFHLGtCQUFrQjtBQUN0RTtBQUNBO0FBQ0E7QUFDQTs7QUFFNEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtbGF5ZXItb3ZlcnJpZGVfMy5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sb2NhbFN0b3JhZ2UtZjYzMTAwZWYuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbG9jYWxlLTEzZTAwYTc1LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtOTJlYmIzOTYuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIH0gZnJvbSAnLi9sb2NhbGUtMTNlMDBhNzUuanMnO1xuaW1wb3J0IHsgcSBhcyBxdWVyeVBhcmVudEVsZW1lbnQgfSBmcm9tICcuL2NvbW1vbkZ1bmN0aW9ucy01MjYyYjA5NC5qcyc7XG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1hYWYzMGJkNi5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEVsZW1lbnREaXIgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC0yMjI1OGM5MC5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldFNpbmdsZU9iamVjdExvY2FsU3RvcmFnZSwgcyBhcyBzZXRTaW5nbGVPYmplY3RMb2NhbFN0b3JhZ2UsIGEgYXMgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXMsIGwgYXMgbG9jYWxTdG9yYWdlS2V5cyB9IGZyb20gJy4vbG9jYWxTdG9yYWdlLWY2MzEwMGVmLmpzJztcbmltcG9ydCAnLi9kb20tMTNmNWIwMGMuanMnO1xuaW1wb3J0ICcuL2NvbW1vbkVudW1zLWY5OGEzMjNjLmpzJztcblxuY29uc3QgQ1NTJDIgPSB7XG4gIGNvbnRhaW5lcjogXCJjb250YWluZXJcIixcbiAgZGV0YWlsczogXCJkZXRhaWxzXCIsXG4gIGJ1dHRvbnM6IFwiYnV0dG9uc1wiLFxuICB0b3BCdXR0b246IFwidG9wLWJ1dHRvblwiLFxuICBwcm9wZXJ0aWVzOiBcInByb3BlcnRpZXNcIixcbiAgcHJvcGVydGllc0ljb246IFwicHJvcGVydGllcy1pY29uXCJcbn07XG5cbi8qKlxuICogZ2V0IG92ZXJyaWRlIHN0YXR1c1xuICogQHBhcmFtIHByb3BzIC0gTGF5ZXJPdmVycmlkZVByb3BzXG4gKi9cbmZ1bmN0aW9uIGdldExheWVyT3JpZ2luSW5mbyhwcm9wcykge1xuICBjb25zdCB7IGxheWVyLCBsYXllck9yaWdpblV0aWxzIH0gPSBwcm9wcztcbiAgcHJvcHMubGF5ZXJPcmlnaW5JbmZvID0gbGF5ZXJPcmlnaW5VdGlscy5nZXRMYXllck9yaWdpbkluZm8obGF5ZXIsIFwid2ViLW1hcFwiKTtcbiAgLy9jb25zb2xlLmxvZyhcImxheWVyT3JpZ2luSW5mbyAod2ViLW1hcClcIiwgcHJvcHMubGF5ZXJPcmlnaW5JbmZvKTtcbiAgLy9jb25zb2xlLmxvZyhcImxheWVyT3JpZ2luSW5mbyAocG9ydGFsLWl0ZW0pXCIsIGxheWVyT3JpZ2luVXRpbHMuZ2V0TGF5ZXJPcmlnaW5JbmZvKGxheWVyLCBcInBvcnRhbC1pdGVtXCIpKTtcbn1cblxuY29uc3QgYXJjZ2lzTGF5ZXJPdmVycmlkZUNzcyA9IFwiOmhvc3R7aGVpZ2h0OjEwMCV9LmNvbnRhaW5lcntwYWRkaW5nOjZweDtiYWNrZ3JvdW5kLWNvbG9yOndoaXRlfS5kZXRhaWxze3dpZHRoOjEwMCU7bWFyZ2luLWJvdHRvbTo4cHg7Y3Vyc29yOnBvaW50ZXJ9LmJ1dHRvbnN7bWFyZ2luLWJvdHRvbToxNHB4fS50b3AtYnV0dG9ue21hcmdpbi1ib3R0b206NHB4fS5wcm9wZXJ0aWVze21hcmdpbi1ib3R0b206MTZweDtjdXJzb3I6cG9pbnRlcn0ucHJvcGVydGllcy1pY29ue2hlaWdodDoxMDAlO3BhZGRpbmc6MCB2YXIoLS1jYWxjaXRlLW5vdGljZS1zcGFjaW5nLXRva2VuLWxhcmdlKX1cIjtcblxuY29uc3QgQXJjZ2lzTGF5ZXJPdmVycmlkZSA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNMYXllck92ZXJyaWRlQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNMYXllck92ZXJyaWRlQ2hhbmdlXCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzTGF5ZXJPdmVycmlkZUR1cGxpY2F0ZUNsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNMYXllck92ZXJyaWRlRHVwbGljYXRlQ2xpY2tcIiwgNyk7XG4gICAgdGhpcy5hcmNnaXNMYXllck92ZXJyaWRlU2F2ZUxheWVyQ2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0xheWVyT3ZlcnJpZGVTYXZlTGF5ZXJDbGlja1wiLCA3KTtcbiAgICB0aGlzLmFyY2dpc0xheWVyT3ZlcnJpZGVTYXZlQXNMYXllckNsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNMYXllck92ZXJyaWRlU2F2ZUFzTGF5ZXJDbGlja1wiLCA3KTtcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICB0aGlzLmFmdGVyQ3JlYXRlU291cmNlID0gKG5vZGUpID0+IHtcbiAgICAgIHRoaXMuc291cmNlTm9kZSA9IG5vZGU7XG4gICAgfTtcbiAgICB0aGlzLmFmdGVyQ3JlYXRlU3RhdHVzQWN0aW9uID0gKG5vZGUpID0+IHtcbiAgICAgIHRoaXMuc3RhdHVzQWN0aW9uTm9kZSA9IG5vZGU7XG4gICAgfTtcbiAgICB0aGlzLmFmdGVyQ3JlYXRlUHJvcGVydGllc0J1dHRvbiA9IChub2RlKSA9PiB7XG4gICAgICB0aGlzLnByb3BlcnRpZXNOb2RlID0gbm9kZTtcbiAgICB9O1xuICAgIHRoaXMub25QYW5lbFNjcm9sbCA9IGFzeW5jICgpID0+IHtcbiAgICAgIHZhciBfYSwgX2I7XG4gICAgICBpZiAodGhpcy5zdGF0dXNQb3BvdmVyKSB7XG4gICAgICAgIGNvbnN0IHJlY3QgPSBhd2FpdCAoKF9hID0gdGhpcy5zdGF0dXNQb3BvdmVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZ2V0UG9wb3ZlclJlY3QoKSk7XG4gICAgICAgIGlmICgocmVjdCA9PT0gbnVsbCB8fCByZWN0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZWN0LnRvcCkgPCAwKSB7XG4gICAgICAgICAgdGhpcy5jbG9zZVBvcG92ZXJzKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLnByb3BlcnRpZXNQb3BvdmVyKSB7XG4gICAgICAgIGNvbnN0IHJlY3QgPSBhd2FpdCAoKF9iID0gdGhpcy5wcm9wZXJ0aWVzUG9wb3ZlcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmdldFBvcG92ZXJSZWN0KCkpO1xuICAgICAgICBpZiAoKHJlY3QgPT09IG51bGwgfHwgcmVjdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVjdC50b3ApIDwgMCkge1xuICAgICAgICAgIHRoaXMuY2xvc2VQb3BvdmVycygpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLm9wZW5EZXRhaWxzID0gKCkgPT4ge1xuICAgICAgY29uc3QgeyBsYXllciB9ID0gdGhpcztcbiAgICAgIGNvbnN0IHsgcG9ydGFsSXRlbSB9ID0gbGF5ZXI7XG4gICAgICBsZXQgdXJsO1xuICAgICAgaWYgKHBvcnRhbEl0ZW0gPT09IG51bGwgfHwgcG9ydGFsSXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9ydGFsSXRlbS5wb3J0YWwpIHtcbiAgICAgICAgaWYgKHBvcnRhbEl0ZW0ucG9ydGFsLnVybEtleSkge1xuICAgICAgICAgIHVybCA9IGAvLyR7cG9ydGFsSXRlbS5wb3J0YWwudXJsS2V5fS4ke3BvcnRhbEl0ZW0ucG9ydGFsLmN1c3RvbUJhc2VVcmx9L2hvbWUvaXRlbS5odG1sP2lkPSR7cG9ydGFsSXRlbS5pZH0mc3VibGF5ZXI9JHtsYXllci5sYXllcklkfWA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdXJsID0gYC8vJHtwb3J0YWxJdGVtLnBvcnRhbC5wb3J0YWxIb3N0bmFtZX0vaG9tZS9pdGVtLmh0bWw/aWQ9JHtwb3J0YWxJdGVtLmlkfSZzdWJsYXllcj0ke2xheWVyLmxheWVySWR9YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHVybCA9IGAke2xheWVyLnVybH0vJHtsYXllci5sYXllcklkfWA7XG4gICAgICB9XG4gICAgICB3aW5kb3cub3Blbih1cmwpO1xuICAgIH07XG4gICAgdGhpcy5zYXZlTGF5ZXIgPSAoZXZlbnQpID0+IHtcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgY29uc3QgeyBsYXllciB9ID0gdGhpcztcbiAgICAgIHRoaXMuYXJjZ2lzTGF5ZXJPdmVycmlkZVNhdmVMYXllckNsaWNrLmVtaXQobGF5ZXIuaWQpO1xuICAgIH07XG4gICAgdGhpcy5zYXZlQXNMYXllciA9IChldmVudCkgPT4ge1xuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBjb25zdCB7IGxheWVyIH0gPSB0aGlzO1xuICAgICAgdGhpcy5hcmNnaXNMYXllck92ZXJyaWRlU2F2ZUFzTGF5ZXJDbGljay5lbWl0KGxheWVyLmlkKTtcbiAgICB9O1xuICAgIHRoaXMuZHVwbGljYXRlTGF5ZXIgPSAoZXZlbnQpID0+IHtcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgY29uc3QgeyBsYXllciB9ID0gdGhpcztcbiAgICAgIHRoaXMuYXJjZ2lzTGF5ZXJPdmVycmlkZUR1cGxpY2F0ZUNsaWNrLmVtaXQobGF5ZXIuaWQpO1xuICAgIH07XG4gICAgdGhpcy5vcGVuU3RhdHVzID0gYXN5bmMgKGV2ZW50KSA9PiB7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGlmICh0aGlzLmNvbnRhaW5lclBhbmVsTm9kZS5kaXNhYmxlZCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICAvLyBsYXllciBzdGF0dXMgZmxvYXRpbmcgcGFuZWxcbiAgICAgIGlmICh0aGlzLnN0YXR1c1BvcG92ZXIpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdHVzUG9wb3Zlci5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgLy8gYWxyZWFkeSBvcGVuLCBoaWRlIGl0XG4gICAgICAgICAgdGhpcy5zdGF0dXNQb3BvdmVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5zdGF0dXNQb3BvdmVyKTtcbiAgICAgICAgICB0aGlzLnN0YXR1c1BvcG92ZXIgPSBudWxsO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAvLyBnb3QgY2xvc2VkIGJ5IHNvbWV0aGluZyBvdXRzaWRlXG4gICAgICAgICAgdGhpcy5zdGF0dXNQb3BvdmVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5jbG9zZVBvcG92ZXJzKCk7XG4gICAgICBhd2FpdCB0aGlzLnNjcm9sbEludG9WaWV3KHRoaXMuc291cmNlTm9kZSk7XG4gICAgICBjb25zdCB7IHByb3BzLCBzdHJpbmdzIH0gPSB0aGlzO1xuICAgICAgY29uc3QgcG9wb3ZlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtbGF5ZXItb3ZlcnJpZGUtc3RhdHVzXCIpO1xuICAgICAgcG9wb3Zlci5wcm9wcyA9IHByb3BzO1xuICAgICAgcG9wb3Zlci5zdHJpbmdzID0gc3RyaW5ncztcbiAgICAgIHBvcG92ZXIucG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQgPSB0aGlzLnNvdXJjZU5vZGU7XG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHBvcG92ZXIpO1xuICAgICAgdGhpcy5zdGF0dXNQb3BvdmVyID0gcG9wb3ZlcjtcbiAgICAgIHRoaXMuZGlzYWJsZUNvbnRhaW5lcih0cnVlKTtcbiAgICB9O1xuICAgIHRoaXMub3Blbk1hbmFnZVByb3BzID0gYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gbWFuYWdlIGxheWVyIHByb3BlcnRpZXMgZmxvYXRpbmcgcGFuZWxcbiAgICAgIC8vIGxheWVyIHN0YXR1cyBmbG9hdGluZyBwYW5lbFxuICAgICAgaWYgKHRoaXMucHJvcGVydGllc1BvcG92ZXIpIHtcbiAgICAgICAgaWYgKHRoaXMucHJvcGVydGllc1BvcG92ZXIucGFyZW50Tm9kZSkge1xuICAgICAgICAgIC8vIGFscmVhZHkgb3BlbiwgaGlkZSBpdFxuICAgICAgICAgIHRoaXMucHJvcGVydGllc1BvcG92ZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnByb3BlcnRpZXNQb3BvdmVyKTtcbiAgICAgICAgICB0aGlzLnByb3BlcnRpZXNQb3BvdmVyID0gbnVsbDtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgLy8gZ290IGNsb3NlZCBieSBzb21ldGhpbmcgb3V0c2lkZVxuICAgICAgICAgIHRoaXMucHJvcGVydGllc1BvcG92ZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLmNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgIGF3YWl0IHRoaXMuc2Nyb2xsSW50b1ZpZXcodGhpcy5zb3VyY2VOb2RlKTtcbiAgICAgIGNvbnN0IHsgcHJvcHMsIHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgICBjb25zdCBwb3BvdmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1sYXllci1vdmVycmlkZS1wcm9wZXJ0aWVzXCIpO1xuICAgICAgcG9wb3Zlci5wcm9wcyA9IHByb3BzO1xuICAgICAgcG9wb3Zlci5zdHJpbmdzID0gc3RyaW5ncztcbiAgICAgIHBvcG92ZXIucG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQgPSB0aGlzLnNvdXJjZU5vZGU7XG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHBvcG92ZXIpO1xuICAgICAgdGhpcy5wcm9wZXJ0aWVzUG9wb3ZlciA9IHBvcG92ZXI7XG4gICAgICB0aGlzLmRpc2FibGVDb250YWluZXIodHJ1ZSk7XG4gICAgfTtcbiAgICB0aGlzLmxheWVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuY29uZmlnID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucHJvcHMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5yZVJlbmRlciA9IGZhbHNlO1xuICB9XG4gIGNsb3NlQWxsUG9wb3ZlcnNIYW5kbGVyKCkge1xuICAgIHRoaXMuY2xvc2VQb3BvdmVycygpO1xuICB9XG4gIGFyY2dpc0xheWVyT3ZlcnJpZGVQcm9wQ2hhbmdlKCkge1xuICAgIHRoaXMuYXJjZ2lzTGF5ZXJPdmVycmlkZUNoYW5nZS5lbWl0KCk7XG4gICAgdGhpcy5yZVJlbmRlciA9ICF0aGlzLnJlUmVuZGVyO1xuICB9XG4gIGFyY2dpc0xheWVyT3ZlcnJpZGVTdGF0dXNDaGFuZ2UoKSB7XG4gICAgdGhpcy5yZVJlbmRlciA9ICF0aGlzLnJlUmVuZGVyO1xuICB9XG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIHB1YmxpYyBjYWxsc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBTZXQgZm9jdXMgb24gY29tcG9uZW50XG4gICAqL1xuICBhc3luYyBzZXRGb2N1cygpIHsgfVxuICAvKipcbiAgICogQ2xvc2UgcG9wb3ZlcnMgYmVmb3JlIHJlbW92aW5nIGNvbXBvbmVudFxuICAgKi9cbiAgYXN5bmMgZG9uZSgpIHtcbiAgICB0aGlzLmNsb3NlUG9wb3ZlcnMoKTtcbiAgfVxuICAvKipcbiAgICogUmVmcmVzaCBjb250ZW50LCBlLmcuIGFmdGVyIGxheWVyIHByb3BlcnRpZXMgY2hhbmdlc1xuICAgKi9cbiAgYXN5bmMgcmVmcmVzaCgpIHtcbiAgICBnZXRMYXllck9yaWdpbkluZm8odGhpcy5wcm9wcyk7XG4gICAgdGhpcy5yZVJlbmRlciA9ICF0aGlzLnJlUmVuZGVyO1xuICB9XG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIExpZmVjeWNsZVxuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIGNvbnN0IFtzdHJpbmdzXSA9IGF3YWl0IGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3ModGhpcy5ob3N0RWxlbWVudCk7XG4gICAgdGhpcy5zdHJpbmdzID0gc3RyaW5ncztcbiAgICAvLyBidWlsZCBMYXllck92ZXJyaWRlUHJvcHNcbiAgICB0aGlzLnByb3BzID0ge1xuICAgICAgbGF5ZXI6IHRoaXMubGF5ZXIsXG4gICAgICBwb3J0YWw6IHRoaXMucG9ydGFsLFxuICAgICAgY29uZmlnOiB0aGlzLmNvbmZpZ1xuICAgIH07XG4gICAgY29uc3QgW2xheWVyT3JpZ2luVXRpbHNdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9sYXllcnMvc3VwcG9ydC9sYXllck9yaWdpblV0aWxzXCJdKTtcbiAgICB0aGlzLnByb3BzLmxheWVyT3JpZ2luVXRpbHMgPSBsYXllck9yaWdpblV0aWxzO1xuICAgIGxheWVyT3JpZ2luVXRpbHMuaXNTdXBwb3J0ZWRMYXllcih0aGlzLmxheWVyKTtcbiAgICBnZXRMYXllck9yaWdpbkluZm8odGhpcy5wcm9wcyk7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICB2YXIgX2E7XG4gICAgLy8gb25jZSBjb21wb25lbnQgaXMgdmlzaWJsZSBtYWtlIG90aGVyIGNhbGxzXG4gICAgdGhpcy5jb250YWluZXJQYW5lbE5vZGUgPSBxdWVyeVBhcmVudEVsZW1lbnQodGhpcy5ob3N0RWxlbWVudCwgXCJjYWxjaXRlLXBhbmVsXCIpO1xuICAgIGlmICghdGhpcy5jb250YWluZXJQYW5lbE5vZGUpIHtcbiAgICAgIHRoaXMuY29udGFpbmVyUGFuZWxOb2RlID0gcXVlcnlQYXJlbnRFbGVtZW50KHRoaXMuaG9zdEVsZW1lbnQsIFwiY2FsY2l0ZS1mbG93LWl0ZW1cIik7XG4gICAgfVxuICAgIChfYSA9IHRoaXMuY29udGFpbmVyUGFuZWxOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuYWRkRXZlbnRMaXN0ZW5lcihcImNhbGNpdGVQYW5lbFNjcm9sbFwiLCB0aGlzLm9uUGFuZWxTY3JvbGwpO1xuICB9XG4gIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgIHZhciBfYTtcbiAgICAoX2EgPSB0aGlzLmNvbnRhaW5lclBhbmVsTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjYWxjaXRlUGFuZWxTY3JvbGxcIiwgdGhpcy5vblBhbmVsU2Nyb2xsKTtcbiAgICB0aGlzLmNsb3NlUG9wb3ZlcnMoKTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTJDIuY29udGFpbmVyIH0sIHRoaXMucmVuZGVyU291cmNlKCksIHRoaXMucmVuZGVyQ29weSgpLCB0aGlzLnJlbmRlclN0YXR1cygpLCB0aGlzLnJlbmRlclByb3BlcnRpZXMoKSkpKTtcbiAgfVxuICByZW5kZXJTb3VyY2UoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgc3RyaW5ncywgbGF5ZXIgfSA9IHRoaXM7XG4gICAgY29uc3QgaXRlbVRpdGxlID0gKF9hID0gbGF5ZXIucG9ydGFsSXRlbSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRpdGxlO1xuICAgIGNvbnN0IGxheWVyVGl0bGUgPSBsYXllci50aXRsZTtcbiAgICBjb25zdCBydGwgPSBnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpID09PSBcInJ0bFwiO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyByZWY6IHRoaXMuYWZ0ZXJDcmVhdGVTb3VyY2UgfSwgc3RyaW5ncy5zb3VyY2VMYXllciwgaChcImNhbGNpdGUtdGlsZVwiLCB7IGNsYXNzOiBDU1MkMi5kZXRhaWxzLCBoZWFkaW5nOiBpdGVtVGl0bGVcbiAgICAgICAgPyBydGxcbiAgICAgICAgICA/IGAke2xheWVyVGl0bGV9IC8gJHtpdGVtVGl0bGV9YFxuICAgICAgICAgIDogYCR7aXRlbVRpdGxlfSAvICR7bGF5ZXJUaXRsZX1gXG4gICAgICAgIDogbGF5ZXJUaXRsZSwgZGVzY3JpcHRpb246IGxheWVyLmlzVGFibGUgPyBcIlRhYmxlXCIgOiBcIkZlYXR1cmUgbGF5ZXJcIiwgb25DbGljazogdGhpcy5vcGVuRGV0YWlscyB9LCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBzY2FsZTogXCJzXCIsIGNvbXBhY3Q6IHRydWUsIHNsb3Q6IFwiY29udGVudC1lbmRcIiwgaWNvbjogXCJsYXVuY2hcIiwgdGV4dDogc3RyaW5ncy5zb3VyY2VMYXllciwgb25DbGljazogdGhpcy5vcGVuRGV0YWlscyB9KSkpKTtcbiAgfVxuICByZW5kZXJDb3B5KCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB7IHN0cmluZ3MsIGxheWVyLCBwcm9wcyB9ID0gdGhpcztcbiAgICBjb25zdCB7IHBvcnRhbCB9ID0gcHJvcHM7XG4gICAgY29uc3QgY2FuQ3JlYXRlSXRlbXMgPSB0aGlzLmNhbkNyZWF0ZUl0ZW1zKHBvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC51c2VyKTtcbiAgICBjb25zdCBjYW5TYXZlID0gW1wiYWRtaW5cIiwgXCJ1cGRhdGVcIl0uaW5kZXhPZigoX2EgPSBsYXllci5wb3J0YWxJdGVtKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaXRlbUNvbnRyb2wpID4gLTE7XG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUyQyLmJ1dHRvbnMgfSwgY2FuU2F2ZSAmJiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgd2lkdGg6IFwiZnVsbFwiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgaWNvblN0YXJ0OiBcInNhdmVcIiwgY2xhc3M6IENTUyQyLnRvcEJ1dHRvbiwgbGFiZWw6IHN0cmluZ3Muc2F2ZSwgb25DbGljazogdGhpcy5zYXZlTGF5ZXIgfSwgc3RyaW5ncy5zYXZlKSksIGNhbkNyZWF0ZUl0ZW1zICYmIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyB3aWR0aDogXCJmdWxsXCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBpY29uU3RhcnQ6IFwic2F2ZVwiLCBjbGFzczogQ1NTJDIudG9wQnV0dG9uLCBsYWJlbDogc3RyaW5ncy5zYXZlQXMsIG9uQ2xpY2s6IHRoaXMuc2F2ZUFzTGF5ZXIgfSwgc3RyaW5ncy5zYXZlQXMpKSwgIWxheWVyLmlzVGFibGUgJiYgKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHdpZHRoOiBcImZ1bGxcIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwga2luZDogXCJuZXV0cmFsXCIsIGljb25TdGFydDogXCJkdXBsaWNhdGVcIiwgbGFiZWw6IHN0cmluZ3MuZHVwbGljYXRlLCBvbkNsaWNrOiB0aGlzLmR1cGxpY2F0ZUxheWVyIH0sIHN0cmluZ3MuZHVwbGljYXRlKSkpKTtcbiAgfVxuICByZW5kZXJTdGF0dXMoKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzLCBsYXllciwgcHJvcHMgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBsYXllck9yaWdpbkluZm8gfSA9IHByb3BzO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtbm90aWNlXCIsIHsgY2xhc3M6IENTUyQyLnByb3BlcnRpZXMsIHdpZHRoOiBcImZ1bGxcIiwgc2NhbGU6IFwic1wiLCBvcGVuOiB0cnVlLCBvbkNsaWNrOiB0aGlzLm9wZW5TdGF0dXMgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwidGl0bGVcIiB9LCBsYXllck9yaWdpbkluZm8uc3RhdHVzID09PSBcInNvdXJjZVwiXG4gICAgICA/IHN0cmluZ3MucHJvcHNGcm9tU291cmNlXG4gICAgICA6IGxheWVyT3JpZ2luSW5mby5zdGF0dXMgPT09IFwib3ZlcnJpZGRlblwiXG4gICAgICAgID8gc3RyaW5ncy5wcm9wc1NldEluV2VibWFwXG4gICAgICAgIDogc3RyaW5ncy5zb21lUHJvcHNTZXRJbldlYm1hcCksIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHNsb3Q6IFwiYWN0aW9ucy1lbmRcIiwgaWNvbjogXCJpbmZvcm1hdGlvblwiLCBzY2FsZTogXCJzXCIsIGNvbXBhY3Q6IHRydWUsIGNsYXNzOiBDU1MkMi5wcm9wZXJ0aWVzSWNvbiwgdGV4dDogbGF5ZXIuaXNUYWJsZSA/IHN0cmluZ3MudGFibGVTdGF0dXMgOiBzdHJpbmdzLmxheWVyU3RhdHVzLCBvbkNsaWNrOiB0aGlzLm9wZW5TdGF0dXMsIHJlZjogdGhpcy5hZnRlckNyZWF0ZVN0YXR1c0FjdGlvbiB9KSkpO1xuICB9XG4gIHJlbmRlclByb3BlcnRpZXMoKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzLCBsYXllciB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCB3aWR0aDogXCJmdWxsXCIsIGxhYmVsOiBsYXllci5pc1RhYmxlID8gc3RyaW5ncy5tYW5hZ2VUYWJsZVByb3BzIDogc3RyaW5ncy5tYW5hZ2VMYXllclByb3BzLCBvbkNsaWNrOiB0aGlzLm9wZW5NYW5hZ2VQcm9wcywgcmVmOiB0aGlzLmFmdGVyQ3JlYXRlUHJvcGVydGllc0J1dHRvbiB9LCBsYXllci5pc1RhYmxlID8gc3RyaW5ncy5tYW5hZ2VUYWJsZVByb3BzIDogc3RyaW5ncy5tYW5hZ2VMYXllclByb3BzKSk7XG4gIH1cbiAgY2xvc2VQb3BvdmVycygpIHtcbiAgICB0aGlzLmNsb3NlU3RhdHVzUG9wb3ZlcigpO1xuICAgIHRoaXMuY2xvc2VQcm9wZXJ0aWVzUG9wb3ZlcigpO1xuICAgIHRoaXMuZGlzYWJsZUNvbnRhaW5lcihmYWxzZSk7XG4gIH1cbiAgY2xvc2VTdGF0dXNQb3BvdmVyKCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAodGhpcy5zdGF0dXNQb3BvdmVyKSB7XG4gICAgICAoX2EgPSB0aGlzLnN0YXR1c1BvcG92ZXIucGFyZW50Tm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlbW92ZUNoaWxkKHRoaXMuc3RhdHVzUG9wb3Zlcik7XG4gICAgICB0aGlzLnN0YXR1c1BvcG92ZXIgPSBudWxsO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIC8vIGRvZXNuJ3Qgd29yayB3aXRob3V0IHRpbWVvdXRcbiAgICAgICAgdGhpcy5zdGF0dXNBY3Rpb25Ob2RlLnNldEZvY3VzKCk7XG4gICAgICB9LCAzMDApO1xuICAgIH1cbiAgfVxuICBjbG9zZVByb3BlcnRpZXNQb3BvdmVyKCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAodGhpcy5wcm9wZXJ0aWVzUG9wb3Zlcikge1xuICAgICAgKF9hID0gdGhpcy5wcm9wZXJ0aWVzUG9wb3Zlci5wYXJlbnROb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVtb3ZlQ2hpbGQodGhpcy5wcm9wZXJ0aWVzUG9wb3Zlcik7XG4gICAgICB0aGlzLnByb3BlcnRpZXNQb3BvdmVyID0gbnVsbDtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAvLyBkb2Vzbid0IHdvcmsgd2l0aG91dCB0aW1lb3V0XG4gICAgICAgIHRoaXMucHJvcGVydGllc05vZGUuc2V0Rm9jdXMoKTtcbiAgICAgIH0sIDMwMCk7XG4gICAgfVxuICB9XG4gIHNjcm9sbEludG9WaWV3KHJlZmVyZW5jZUVsZW1lbnQpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKCgoX2EgPSByZWZlcmVuY2VFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudG9wKSA8IDApIHtcbiAgICAgIC8vIGxldCdzIG1ha2Ugc3VyZSBpdCBmdWxseSBzaG93c1xuICAgICAgcmVmZXJlbmNlRWxlbWVudC5zY3JvbGxJbnRvVmlldyh7XG4gICAgICAgIGJlaGF2aW9yOiBcInNtb290aFwiLFxuICAgICAgICBibG9jazogXCJuZWFyZXN0XCIsXG4gICAgICAgIGlubGluZTogXCJzdGFydFwiXG4gICAgICB9KTtcbiAgICAgIC8vIHdhaXQgdW50aWwgc2Nyb2xsaW5nIGlzIGRvbmVcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSkgPT4ge1xuICAgICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgICBjb25zdCBobmRsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICBpZiAoY291bnQgPiAxMCB8fCAoKF9hID0gcmVmZXJlbmNlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRvcCkgPj0gMCkge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChobmRsKTtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY291bnQrKztcbiAgICAgICAgfSwgMTAwKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gIH1cbiAgZGlzYWJsZUNvbnRhaW5lcihkaXNhYmxlKSB7XG4gICAgaWYgKHRoaXMuY29udGFpbmVyUGFuZWxOb2RlKSB7XG4gICAgICB0aGlzLmNvbnRhaW5lclBhbmVsTm9kZS5kaXNhYmxlZCA9IGRpc2FibGU7XG4gICAgfVxuICB9XG4gIGNhbkNyZWF0ZUl0ZW1zKHVzZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIHVzZXIgJiYgKHRoaXMuaXNQdWJsaWNVc2VyKHVzZXIpIHx8ICgoX2EgPSB1c2VyLnByaXZpbGVnZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhcInBvcnRhbDp1c2VyOmNyZWF0ZUl0ZW1cIikpKTtcbiAgfVxuICBpc1B1YmxpY1VzZXIodXNlcikge1xuICAgIHJldHVybiAhdXNlci5vcmdJZDtcbiAgfVxuICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzTGF5ZXJPdmVycmlkZS5zdHlsZSA9IGFyY2dpc0xheWVyT3ZlcnJpZGVDc3M7XG5cbmNvbnN0IENTUyQxID0ge1xuICBwb3BvdmVyOiBcInBvcG92ZXJcIixcbiAgY29udGVudDogXCJjb250ZW50XCIsXG4gIG5vdGljZTogXCJub3RpY2VcIixcbiAgdGlsZTogXCJ0aWxlXCIsXG4gIHRvb2x0aXA6IFwidG9vbHRpcFwiXG59O1xuXG5jb25zdCBhcmNnaXNMYXllck92ZXJyaWRlUHJvcGVydGllc0NzcyA9IFwiLnBvcG92ZXJ7ei1pbmRleDoxMDB9LmNvbnRlbnR7cGFkZGluZzowLjVyZW0gMC43NXJlbTtiYWNrZ3JvdW5kLWNvbG9yOiNmZmZmZmY7bWF4LWhlaWdodDo4MHZofS5ub3RpY2V7bWFyZ2luLWJvdHRvbToxNnB4fS50aWxle2N1cnNvcjpwb2ludGVyfS50b29sdGlwe21heC13aWR0aDo4MCV9XCI7XG5cbmNvbnN0IEFyY2dpc0xheWVyT3ZlcnJpZGVQcm9wZXJ0aWVzID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmNsb3NlQWxsUG9wb3ZlcnMgPSBjcmVhdGVFdmVudCh0aGlzLCBcImNsb3NlQWxsUG9wb3ZlcnNcIiwgNyk7XG4gICAgdGhpcy5hcmNnaXNMYXllck92ZXJyaWRlUHJvcGVydGllc0NoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzTGF5ZXJPdmVycmlkZVByb3BlcnRpZXNDaGFuZ2VcIiwgNyk7XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5hZnRlckNyZWF0ZVBvcG92ZXIgPSAobm9kZSkgPT4ge1xuICAgICAgdGhpcy5wb3BvdmVyTm9kZSA9IG5vZGU7XG4gICAgfTtcbiAgICB0aGlzLmFmdGVyQ3JlYXRlQ2xvc2VCdXR0b24gPSAobm9kZSkgPT4ge1xuICAgICAgdGhpcy5jbG9zZUJ1dHRvbk5vZGUgPSBub2RlO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVDbG9zZUNsaWNrID0gKCkgPT4ge1xuICAgICAgdGhpcy5jbG9zZUFsbFBvcG92ZXJzLmVtaXQoKTtcbiAgICB9O1xuICAgIHRoaXMucmVzZXRUb1NvdXJjZSA9IChldmVudCkgPT4ge1xuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBjb25zdCB7IHByb3BzIH0gPSB0aGlzO1xuICAgICAgY29uc3QgeyBsYXllciwgbGF5ZXJPcmlnaW5VdGlscyB9ID0gcHJvcHM7XG4gICAgICBsYXllck9yaWdpblV0aWxzLmNsZWFyT3ZlcnJpZGVzKGxheWVyLCBcIndlYi1tYXBcIik7XG4gICAgICB0aGlzLnJlUmVuZGVyID0gIXRoaXMucmVSZW5kZXI7XG4gICAgICB0aGlzLmFyY2dpc0xheWVyT3ZlcnJpZGVQcm9wZXJ0aWVzQ2hhbmdlLmVtaXQoKTtcbiAgICB9O1xuICAgIHRoaXMuZGlzY29ubmVjdFByb3BzID0gKGV2ZW50KSA9PiB7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGNvbnN0IHsgcHJvcHMgfSA9IHRoaXM7XG4gICAgICBjb25zdCB7IGxheWVyLCBsYXllck9yaWdpblV0aWxzIH0gPSBwcm9wcztcbiAgICAgIGxheWVyT3JpZ2luVXRpbHMuZGlzY29ubmVjdEZyb21Tb3VyY2UobGF5ZXIsIFwid2ViLW1hcFwiKTtcbiAgICAgIHRoaXMucmVSZW5kZXIgPSAhdGhpcy5yZVJlbmRlcjtcbiAgICAgIHRoaXMuYXJjZ2lzTGF5ZXJPdmVycmlkZVByb3BlcnRpZXNDaGFuZ2UuZW1pdCgpO1xuICAgIH07XG4gICAgdGhpcy5wcm9wcyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnBvcG92ZXJSZWZlcmVuY2VFbGVtZW50ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc3RyaW5ncyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnJlUmVuZGVyID0gZmFsc2U7XG4gICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBwdWJsaWMgY2FsbHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogUmVwb3NpdGlvbnMgcG9wb3ZlclxuICAgKi9cbiAgYXN5bmMgcmVwb3NpdGlvbigpIHtcbiAgICB2YXIgX2E7XG4gICAgKF9hID0gdGhpcy5wb3BvdmVyTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlcG9zaXRpb24oKTtcbiAgfVxuICAvKipcbiAgICogQ2FsbHMgZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgb24gcG9wb3ZlclxuICAgKi9cbiAgYXN5bmMgZ2V0UG9wb3ZlclJlY3QoKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAoX2EgPSB0aGlzLnBvcG92ZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgTGlmZWN5Y2xlXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICB0aGlzLnBvcG92ZXJOb2RlLnJlcG9zaXRpb24oKTtcbiAgICB0aGlzLmlzT3BlbiA9IHRydWU7XG4gICAgLy8gbmVlZCB0aW1lb3V0IGJlY2F1c2Ugb2YgcmUtcmVuZGVyXG4gICAgc2V0VGltZW91dCgoKSA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5jbG9zZUJ1dHRvbk5vZGUuc2V0Rm9jdXMoKSksIDEwMCk7XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIFJlbmRlciBNZXRob2RzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcmVuZGVyKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB7IHBvcG92ZXJSZWZlcmVuY2VFbGVtZW50LCBzdHJpbmdzLCBwcm9wcyB9ID0gdGhpcztcbiAgICBjb25zdCB7IGxheWVyIH0gPSBwcm9wcztcbiAgICBjb25zdCBub2RlV2lkdGggPSBwb3BvdmVyUmVmZXJlbmNlRWxlbWVudC5jbGllbnRXaWR0aDtcbiAgICAvLyBsZXQgdGhlIHBvcG92ZXIgc3RhcnQgYXQgdGhlIHRvcCBvZiB0aGUgcmVmZXJlbmNlIGVsZW1lbnRcbiAgICBjb25zdCBvZmZzZXREaXN0YW5jZSA9IHBvcG92ZXJSZWZlcmVuY2VFbGVtZW50LmNsaWVudEhlaWdodCB8fFxuICAgICAgKChfYSA9IHBvcG92ZXJSZWZlcmVuY2VFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaGVpZ2h0KSB8fFxuICAgICAgOTY7XG4gICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwianMtYXBwLWZseW91dFwiIH0sIGgoXCJjYWxjaXRlLXBvcG92ZXJcIiwgeyBwbGFjZW1lbnQ6IFwiYm90dG9tXCIsIGRpcjogZG9jdW1lbnQuZGlyLCBvcGVuOiB0aGlzLmlzT3BlbiwgcG9pbnRlckRpc2FibGVkOiB0cnVlLCByZWZlcmVuY2VFbGVtZW50OiBwb3BvdmVyUmVmZXJlbmNlRWxlbWVudCwgb2Zmc2V0RGlzdGFuY2U6IC0xICogb2Zmc2V0RGlzdGFuY2UsIG9mZnNldFNraWRkaW5nOiAwLCBjbGFzczogQ1NTJDEucG9wb3Zlciwgc3R5bGU6IG5vZGVXaWR0aFxuICAgICAgICA/IHtcbiAgICAgICAgICB3aWR0aDogYCR7bm9kZVdpZHRoICsgNjB9cHhgXG4gICAgICAgIH1cbiAgICAgICAgOiBudWxsLCBsYWJlbDogbGF5ZXIuaXNUYWJsZSA/IHN0cmluZ3MubWFuYWdlVGFibGVQcm9wcyA6IHN0cmluZ3MubWFuYWdlTGF5ZXJQcm9wcywgcmVmOiB0aGlzLmFmdGVyQ3JlYXRlUG9wb3Zlciwgb25DYWxjaXRlUG9wb3ZlckJlZm9yZUNsb3NlOiAoKSA9PiB0aGlzLmNsb3NlQWxsUG9wb3ZlcnMuZW1pdCgpIH0sIGgoXCJjYWxjaXRlLWZsb3dcIiwgeyBzdHlsZTogbm9kZVdpZHRoXG4gICAgICAgID8ge1xuICAgICAgICAgIHdpZHRoOiBgJHtub2RlV2lkdGggKyA1OH1weGBcbiAgICAgICAgfVxuICAgICAgICA6IG51bGwgfSwgaChcImNhbGNpdGUtZmxvdy1pdGVtXCIsIHsgaGVhZGluZzogbGF5ZXIuaXNUYWJsZSA/IHN0cmluZ3MubWFuYWdlVGFibGVQcm9wcyA6IHN0cmluZ3MubWFuYWdlTGF5ZXJQcm9wcyB9LCB0aGlzLnJlbmRlckNsb3NlQnV0dG9uKCksIHRoaXMucmVuZGVyQ29udGVudCgpKSkpKSk7XG4gIH1cbiAgcmVuZGVyQ2xvc2VCdXR0b24oKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzIH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgdGV4dDogc3RyaW5ncy5jbG9zZSwgc2NhbGU6IFwic1wiLCBzbG90OiBcImhlYWRlci1hY3Rpb25zLWVuZFwiLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNsb3NlQ2xpY2ssIHJlZjogdGhpcy5hZnRlckNyZWF0ZUNsb3NlQnV0dG9uLCBpY29uOiBcInhcIiB9KSk7XG4gIH1cbiAgcmVuZGVyQ29udGVudCgpIHtcbiAgICBjb25zdCB7IHN0cmluZ3MsIHByb3BzIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHByb3BzO1xuICAgIC8vIGFsd2F5cyBtYWtlIGEgbmV3IGNhbGwgaW4gY2FzZSB0aGluZ3MgaGF2ZSBjaGFuZ2VkXG4gICAgZ2V0TGF5ZXJPcmlnaW5JbmZvKHByb3BzKTtcbiAgICBjb25zdCB7IGxheWVyT3JpZ2luSW5mbyB9ID0gcHJvcHM7XG4gICAgY29uc3QgcmVzZXRUb1NvdXJjZURpc2FibGVkID0gbGF5ZXJPcmlnaW5JbmZvLnN0YXR1cyA9PT0gXCJzb3VyY2VcIjtcbiAgICBjb25zdCBkaXNjb25uZWN0RGlzYWJsZWQgPSBsYXllck9yaWdpbkluZm8uc3RhdHVzID09PSBcIm92ZXJyaWRkZW5cIjtcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTJDEuY29udGVudCB9LCBoKFwiY2FsY2l0ZS1ub3RpY2VcIiwgeyBjbGFzczogQ1NTJDEubm90aWNlLCB3aWR0aDogXCJmdWxsXCIsIHNjYWxlOiBcInNcIiwgb3BlbjogdHJ1ZSB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJ0aXRsZVwiIH0sIGxheWVyT3JpZ2luSW5mby5zdGF0dXMgPT09IFwic291cmNlXCJcbiAgICAgID8gc3RyaW5ncy5wcm9wc0Zyb21Tb3VyY2VcbiAgICAgIDogbGF5ZXJPcmlnaW5JbmZvLnN0YXR1cyA9PT0gXCJvdmVycmlkZGVuXCJcbiAgICAgICAgPyBzdHJpbmdzLnByb3BzU2V0SW5XZWJtYXBcbiAgICAgICAgOiBzdHJpbmdzLnNvbWVQcm9wc1NldEluV2VibWFwKSksIGgoXCJkaXZcIiwgeyBpZDogXCJsYXllci1vdmVycmlkZS1yZXNldFwiIH0sIGgoXCJjYWxjaXRlLXRpbGVcIiwgeyBoZWFkaW5nOiBzdHJpbmdzLnJlc2V0VG9Tb3VyY2UsIGRlc2NyaXB0aW9uOiBzdHJpbmdzLmRpc2NhcmRQcm9wcywgY2xhc3M6IENTUyQxLnRpbGUsIGRpc2FibGVkOiByZXNldFRvU291cmNlRGlzYWJsZWQsIG9uQ2xpY2s6ICFyZXNldFRvU291cmNlRGlzYWJsZWQgPyB0aGlzLnJlc2V0VG9Tb3VyY2UgOiBudWxsIH0sIHJlc2V0VG9Tb3VyY2VEaXNhYmxlZCA/IChoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBzbG90OiBcImNvbnRlbnQtc3RhcnRcIiwgaWNvbjogXCJyZXNldFwiIH0pKSA6IChoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBzY2FsZTogXCJzXCIsIGNvbXBhY3Q6IHRydWUsIHNsb3Q6IFwiY29udGVudC1zdGFydFwiLCBpY29uOiBcInJlc2V0XCIsIHRleHQ6IHN0cmluZ3MucmVzZXRUb1NvdXJjZSwgb25DbGljazogIXJlc2V0VG9Tb3VyY2VEaXNhYmxlZCA/IHRoaXMucmVzZXRUb1NvdXJjZSA6IG51bGwgfSkpKSksIGgoXCJkaXZcIiwgeyBpZDogXCJsYXllci1vdmVycmlkZS1kaXNjb25uZWN0XCIgfSwgaChcImNhbGNpdGUtdGlsZVwiLCB7IGhlYWRpbmc6IGxheWVyLmlzVGFibGUgPyBzdHJpbmdzLmRpc2Nvbm5lY3RQcm9wc1RhYmxlIDogc3RyaW5ncy5kaXNjb25uZWN0UHJvcHMsIGRlc2NyaXB0aW9uOiBzdHJpbmdzLnNldFByb3BzSW5XZWJtYXAsIGNsYXNzOiBDU1MkMS50aWxlLCBkaXNhYmxlZDogZGlzY29ubmVjdERpc2FibGVkLCBvbkNsaWNrOiAhZGlzY29ubmVjdERpc2FibGVkID8gdGhpcy5kaXNjb25uZWN0UHJvcHMgOiBudWxsIH0sIGRpc2Nvbm5lY3REaXNhYmxlZCA/IChoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBzbG90OiBcImNvbnRlbnQtc3RhcnRcIiwgaWNvbjogXCJ1bmxpbmtcIiB9KSkgOiAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgc2NhbGU6IFwic1wiLCBjb21wYWN0OiB0cnVlLCBzbG90OiBcImNvbnRlbnQtc3RhcnRcIiwgaWNvbjogXCJ1bmxpbmtcIiwgdGV4dDogc3RyaW5ncy5kaXNjb25uZWN0UHJvcHMsIG9uQ2xpY2s6ICFkaXNjb25uZWN0RGlzYWJsZWQgPyB0aGlzLmRpc2Nvbm5lY3RQcm9wcyA6IG51bGwgfSkpKSksIHJlc2V0VG9Tb3VyY2VEaXNhYmxlZCAmJiAoaChcImNhbGNpdGUtdG9vbHRpcFwiLCB7IGNsYXNzOiBDU1MkMS50b29sdGlwLCBwbGFjZW1lbnQ6IFwidG9wXCIsIG9mZnNldERpc3RhbmNlOiAtNTAsIG92ZXJsYXlQb3NpdGlvbmluZzogXCJmaXhlZFwiLCByZWZlcmVuY2VFbGVtZW50OiBcImxheWVyLW92ZXJyaWRlLXJlc2V0XCIsIGxhYmVsOiBzdHJpbmdzLnByb3BzQ2Fubm90QmVSZXNldCB9LCBzdHJpbmdzLnByb3BzQ2Fubm90QmVSZXNldCkpLCBkaXNjb25uZWN0RGlzYWJsZWQgJiYgKGgoXCJjYWxjaXRlLXRvb2x0aXBcIiwgeyBjbGFzczogQ1NTJDEudG9vbHRpcCwgcGxhY2VtZW50OiBcInRvcFwiLCBvZmZzZXREaXN0YW5jZTogLTUwLCBvdmVybGF5UG9zaXRpb25pbmc6IFwiZml4ZWRcIiwgcmVmZXJlbmNlRWxlbWVudDogXCJsYXllci1vdmVycmlkZS1kaXNjb25uZWN0XCIsIGxhYmVsOiBzdHJpbmdzLnByb3BzQ2Fubm90QmVEaXNjb25uZWN0ZWQgfSwgc3RyaW5ncy5wcm9wc0Nhbm5vdEJlRGlzY29ubmVjdGVkKSkpKTtcbiAgfVxuICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzTGF5ZXJPdmVycmlkZVByb3BlcnRpZXMuc3R5bGUgPSBhcmNnaXNMYXllck92ZXJyaWRlUHJvcGVydGllc0NzcztcblxuY29uc3QgQ1NTID0ge1xuICBwb3BvdmVyOiBcInBvcG92ZXJcIixcbiAgY29udGVudDogXCJjb250ZW50XCIsXG4gIG5vdGljZTogXCJub3RpY2VcIixcbiAgZmlsdGVyOiBcImZpbHRlclwiLFxuICBibG9ja0NvbnRlbnQ6IFwiYmxvY2stY29udGVudFwiLFxuICBsaXN0SGVhZGVyOiBcImxpc3QtaGVhZGVyXCJcbn07XG5cbmNvbnN0IGFyY2dpc0xheWVyT3ZlcnJpZGVTdGF0dXNDc3MgPSBcIi5wb3BvdmVye3otaW5kZXg6MTAwfS5jb250ZW50e21heC1oZWlnaHQ6NjB2aH0ubm90aWNle21hcmdpbjo4cHh9LmZpbHRlcntib3JkZXItd2lkdGg6MHB4IDBweCAxcHg7Ym9yZGVyLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktYm9yZGVyLTMpO2JvcmRlci1zdHlsZTpzb2xpZH0uYmxvY2stY29udGVudHtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0yKX0ubGlzdC1oZWFkZXJ7cGFkZGluZzowLjc1cmVtIDAuNXJlbSAwLjI1cmVtIDAuNXJlbX1cIjtcblxuY29uc3QgQXJjZ2lzTGF5ZXJPdmVycmlkZVN0YXR1cyA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5jbG9zZUFsbFBvcG92ZXJzID0gY3JlYXRlRXZlbnQodGhpcywgXCJjbG9zZUFsbFBvcG92ZXJzXCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzTGF5ZXJPdmVycmlkZVN0YXR1c0NoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzTGF5ZXJPdmVycmlkZVN0YXR1c0NoYW5nZVwiLCA3KTtcbiAgICB0aGlzLmRvY3VtZW50VGFiSGFuZGxlciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmRvY3VtZW50Q2xpY2tIYW5kbGVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuYWxsSXRlbXMgPSBbXTtcbiAgICB0aGlzLmRhdGFUeXBlcyA9IFtcbiAgICAgIFwiZGF0YVwiLFxuICAgICAgXCJkZWZpbml0aW9uLWV4cHJlc3Npb25cIixcbiAgICAgIFwicG9wdXBcIixcbiAgICAgIFwicmVmcmVzaC1pbnRlcnZhbFwiLFxuICAgICAgXCJ1c2Utdmlldy10aW1lXCIsXG4gICAgICAvL1wiZWRpdGluZy1lbmFibGVkXCIsXG4gICAgICBcImZvcm0tdGVtcGxhdGVcIixcbiAgICAgIFwiZmxvb3ItaW5mb1wiLFxuICAgICAgXCJjdXN0b20tcGFyYW1ldGVyc1wiLFxuICAgICAgXCJjaGFydHNcIlxuICAgIF07XG4gICAgdGhpcy5hcHBlYXJhbmNlVHlwZXMgPSBbXG4gICAgICBcInJlbmRlcmVyXCIsXG4gICAgICBcImxhYmVsc1wiLFxuICAgICAgXCJzY2FsZS1yYW5nZVwiLFxuICAgICAgXCJvcGFjaXR5XCIsXG4gICAgICBcImZlYXR1cmUtcmVkdWN0aW9uXCIsXG4gICAgICBcImJsZW5kLW1vZGVcIixcbiAgICAgIFwiZWZmZWN0XCIsXG4gICAgICBcImxlZ2VuZC1lbmFibGVkXCIsXG4gICAgICBcIm9yZGVyLWJ5XCJcbiAgICBdO1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMuYWZ0ZXJDcmVhdGVQb3BvdmVyID0gKG5vZGUpID0+IHtcbiAgICAgIHRoaXMucG9wb3Zlck5vZGUgPSBub2RlO1xuICAgIH07XG4gICAgdGhpcy5hZnRlckNyZWF0ZUNsb3NlQnV0dG9uID0gKG5vZGUpID0+IHtcbiAgICAgIHRoaXMuY2xvc2VCdXR0b25Ob2RlID0gbm9kZTtcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlQ2xvc2VDbGljayA9ICgpID0+IHtcbiAgICAgIHRoaXMuY2xvc2VBbGxQb3BvdmVycy5lbWl0KCk7XG4gICAgfTtcbiAgICB0aGlzLnByb3BzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zdHJpbmdzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucmVSZW5kZXIgPSBmYWxzZTtcbiAgICB0aGlzLmZpbHRlcmVkSXRlbXMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBwdWJsaWMgY2FsbHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogUmVwb3NpdGlvbnMgcG9wb3ZlclxuICAgKi9cbiAgYXN5bmMgcmVwb3NpdGlvbigpIHtcbiAgICB2YXIgX2E7XG4gICAgKF9hID0gdGhpcy5wb3BvdmVyTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlcG9zaXRpb24oKTtcbiAgfVxuICAvKipcbiAgICogQ2FsbHMgZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgb24gcG9wb3ZlclxuICAgKi9cbiAgYXN5bmMgZ2V0UG9wb3ZlclJlY3QoKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAoX2EgPSB0aGlzLnBvcG92ZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgTGlmZWN5Y2xlXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgLy8gYWx3YXlzIG1ha2UgYSBuZXcgY2FsbCBpbiBjYXNlIHRoaW5ncyBoYXZlIGNoYW5nZWRcbiAgICBjb25zdCBiZWZvcmVTdGF0dXMgPSAoX2EgPSB0aGlzLnByb3BzLmxheWVyT3JpZ2luSW5mbykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXR1cztcbiAgICBnZXRMYXllck9yaWdpbkluZm8odGhpcy5wcm9wcyk7XG4gICAgY29uc3QgYWZ0ZXJTdGF0dXMgPSAoX2IgPSB0aGlzLnByb3BzLmxheWVyT3JpZ2luSW5mbykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnN0YXR1cztcbiAgICBpZiAoYmVmb3JlU3RhdHVzICE9PSBhZnRlclN0YXR1cykge1xuICAgICAgLy8gcmVmZXNoIG5vdGljZSB0ZXh0XG4gICAgICB0aGlzLmFyY2dpc0xheWVyT3ZlcnJpZGVTdGF0dXNDaGFuZ2UuZW1pdCgpO1xuICAgIH1cbiAgICB0aGlzLmFsbEl0ZW1zID0gW1xuICAgICAge1xuICAgICAgICB2YWx1ZTogXCJkYXRhXCIsXG4gICAgICAgIHRpdGxlOiBzdHJpbmdzLnN0YXR1cy5kYXRhXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB2YWx1ZTogXCJkZWZpbml0aW9uLWV4cHJlc3Npb25cIixcbiAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3RhdHVzLmZpbHRlclxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdmFsdWU6IFwicG9wdXBcIixcbiAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3RhdHVzLnBvcHVwc0FuZEF0dHJpYnV0ZXNcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHZhbHVlOiBcInJlZnJlc2gtaW50ZXJ2YWxcIixcbiAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3RhdHVzLnJlZnJlc2hJbnRlcnZhbFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdmFsdWU6IFwidXNlLXZpZXctdGltZVwiLFxuICAgICAgICB0aXRsZTogc3RyaW5ncy5zdGF0dXMudGltZVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdmFsdWU6IFwiZWRpdGluZy1lbmFibGVkXCIsXG4gICAgICAgIHRpdGxlOiBzdHJpbmdzLnN0YXR1cy5lZGl0aW5nXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB2YWx1ZTogXCJmb3JtLXRlbXBsYXRlXCIsXG4gICAgICAgIHRpdGxlOiBzdHJpbmdzLnN0YXR1cy5mb3JtVGVtcGxhdGVcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHZhbHVlOiBcImZsb29yLWluZm9cIixcbiAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3RhdHVzLmZsb29ySW5mb1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdmFsdWU6IFwiY3VzdG9tLXBhcmFtZXRlcnNcIixcbiAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3RhdHVzLmN1c3RvbVBhcmFtZXRlcnNcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHZhbHVlOiBcImNoYXJ0c1wiLFxuICAgICAgICB0aXRsZTogc3RyaW5ncy5zdGF0dXMuY2hhcnRzXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB2YWx1ZTogXCJyZW5kZXJlclwiLFxuICAgICAgICB0aXRsZTogc3RyaW5ncy5zdGF0dXMuc3R5bGVcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHZhbHVlOiBcImxhYmVsc1wiLFxuICAgICAgICB0aXRsZTogc3RyaW5ncy5zdGF0dXMubGFiZWxzXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB2YWx1ZTogXCJzY2FsZS1yYW5nZVwiLFxuICAgICAgICB0aXRsZTogc3RyaW5ncy5zdGF0dXMudmlzaWJsZVJhbmdlXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB2YWx1ZTogXCJvcGFjaXR5XCIsXG4gICAgICAgIHRpdGxlOiBzdHJpbmdzLnN0YXR1cy50cmFuc3BhcmVuY3lcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHZhbHVlOiBcImZlYXR1cmUtcmVkdWN0aW9uXCIsXG4gICAgICAgIHRpdGxlOiBzdHJpbmdzLnN0YXR1cy5hZ2dyZWdhdGlvblxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdmFsdWU6IFwiYmxlbmQtbW9kZVwiLFxuICAgICAgICB0aXRsZTogc3RyaW5ncy5zdGF0dXMuYmxlbmRpbmdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHZhbHVlOiBcImVmZmVjdFwiLFxuICAgICAgICB0aXRsZTogc3RyaW5ncy5zdGF0dXMuZWZmZWN0c1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdmFsdWU6IFwibGVnZW5kLWVuYWJsZWRcIixcbiAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3RhdHVzLmxlZ2VuZFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdmFsdWU6IFwib3JkZXItYnlcIixcbiAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3RhdHVzLm9yZGVyQnlcbiAgICAgIH1cbiAgICBdO1xuICB9XG4gIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgdGhpcy5wb3BvdmVyTm9kZS5yZXBvc2l0aW9uKCk7XG4gICAgdGhpcy5pc09wZW4gPSB0cnVlO1xuICAgIC8vIG5lZWQgdGltZW91dCBiZWNhdXNlIG9mIHJlLXJlbmRlclxuICAgIHNldFRpbWVvdXQoKCkgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMuY2xvc2VCdXR0b25Ob2RlLnNldEZvY3VzKCkpLCAxMDApO1xuICB9XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBSZW5kZXIgTWV0aG9kc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIHJlbmRlcigpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyBwb3BvdmVyUmVmZXJlbmNlRWxlbWVudCwgc3RyaW5ncywgcHJvcHMgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBsYXllciB9ID0gcHJvcHM7XG4gICAgY29uc3Qgbm9kZVdpZHRoID0gcG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQuY2xpZW50V2lkdGg7XG4gICAgY29uc3Qgbm9kZUhlaWdodCA9IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0O1xuICAgIC8vIGxldCB0aGUgcG9wb3ZlciBzdGFydCBhdCB0aGUgdG9wIG9mIHRoZSByZWZlcmVuY2UgZWxlbWVudFxuICAgIGNvbnN0IG9mZnNldERpc3RhbmNlID0gcG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQuY2xpZW50SGVpZ2h0IHx8XG4gICAgICAoKF9hID0gcG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5oZWlnaHQpIHx8XG4gICAgICA5NjtcbiAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJqcy1hcHAtZmx5b3V0XCIgfSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IHBsYWNlbWVudDogXCJib3R0b21cIiwgZGlyOiBkb2N1bWVudC5kaXIsIG9wZW46IHRoaXMuaXNPcGVuLCBwb2ludGVyRGlzYWJsZWQ6IHRydWUsIHJlZmVyZW5jZUVsZW1lbnQ6IHBvcG92ZXJSZWZlcmVuY2VFbGVtZW50LCBvZmZzZXREaXN0YW5jZTogLTEgKiBvZmZzZXREaXN0YW5jZSwgb2Zmc2V0U2tpZGRpbmc6IDAsIGNsYXNzOiBDU1MucG9wb3Zlciwgc3R5bGU6IG5vZGVXaWR0aFxuICAgICAgICA/IHtcbiAgICAgICAgICB3aWR0aDogYCR7bm9kZVdpZHRoICsgNjB9cHhgXG4gICAgICAgIH1cbiAgICAgICAgOiBudWxsLCBsYWJlbDogXCJcIiwgcmVmOiB0aGlzLmFmdGVyQ3JlYXRlUG9wb3Zlciwgb25DYWxjaXRlUG9wb3ZlckJlZm9yZUNsb3NlOiAoKSA9PiB0aGlzLmNsb3NlQWxsUG9wb3ZlcnMuZW1pdCgpIH0sIGgoXCJjYWxjaXRlLWZsb3dcIiwgeyBzdHlsZTogbm9kZVdpZHRoXG4gICAgICAgID8ge1xuICAgICAgICAgIHdpZHRoOiBgJHtub2RlV2lkdGggKyA1OH1weGAsXG4gICAgICAgICAgbWF4SGVpZ2h0OiBgJHtub2RlSGVpZ2h0ICogMC43fXB4YFxuICAgICAgICB9XG4gICAgICAgIDogbnVsbCB9LCBoKFwiY2FsY2l0ZS1mbG93LWl0ZW1cIiwgeyBoZWFkaW5nOiBsYXllci5pc1RhYmxlID8gc3RyaW5ncy50YWJsZVN0YXR1cyA6IHN0cmluZ3MubGF5ZXJTdGF0dXMsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKFwiY2FsY2l0ZUZsb3dJdGVtU2Nyb2xsXCIsICgpID0+IHRoaXMuY2xvc2VJbmZvUG9wb3ZlcigpKTtcbiAgICAgIH0gfSwgdGhpcy5yZW5kZXJDbG9zZUJ1dHRvbigpLCB0aGlzLnJlbmRlckNvbnRlbnQoKSkpKSkpO1xuICB9XG4gIHJlbmRlckNsb3NlQnV0dG9uKCkge1xuICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHRleHQ6IHN0cmluZ3MuY2xvc2UsIHNjYWxlOiBcInNcIiwgc2xvdDogXCJoZWFkZXItYWN0aW9ucy1lbmRcIiwgb25DbGljazogdGhpcy5oYW5kbGVDbG9zZUNsaWNrLCByZWY6IHRoaXMuYWZ0ZXJDcmVhdGVDbG9zZUJ1dHRvbiwgaWNvbjogXCJ4XCIgfSkpO1xuICB9XG4gIHJlbmRlckNvbnRlbnQoKSB7XG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5jb250ZW50IH0sIHRoaXMucmVuZGVySW5mbygpLCB0aGlzLnJlbmRlclNlYXJjaCgpLCB0aGlzLnJlbmRlckRhdGFDb250ZW50KCksIHRoaXMucmVuZGVyQXBwZWFyYW5jZUNvbnRlbnQoKSkpO1xuICB9XG4gIHJlbmRlckluZm8oKSB7XG4gICAgY29uc3QgeyBwcm9wcywgc3RyaW5ncyB9ID0gdGhpcztcbiAgICBjb25zdCB7IGNvbmZpZyB9ID0gcHJvcHM7XG4gICAgY29uc3QgeyBoZWxwQmFzZSwgaGVscE1hcCB9ID0gY29uZmlnO1xuICAgIGlmIChnZXRTaW5nbGVPYmplY3RMb2NhbFN0b3JhZ2UobG9jYWxTdG9yYWdlS2V5cy5BUkNHSVNfQ09NUE9ORU5UX05PVElGSUNBVElPTlMsIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzLkxBWUVSX09WRVJSSURFX1NUQVRVU19USVBfRElTTUlTU0VEKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiAoaChcImNhbGNpdGUtbm90aWNlXCIsIHsgY2xhc3M6IENTUy5ub3RpY2UsIG9wZW46IHRydWUsIGNsb3NhYmxlOiB0cnVlLCBzY2FsZTogXCJzXCIsIHdpZHRoOiBcImF1dG9cIiwgb25DYWxjaXRlTm90aWNlQ2xvc2U6ICgpID0+IHtcbiAgICAgICAgc2V0U2luZ2xlT2JqZWN0TG9jYWxTdG9yYWdlKGxvY2FsU3RvcmFnZUtleXMuQVJDR0lTX0NPTVBPTkVOVF9OT1RJRklDQVRJT05TLCB7XG4gICAgICAgICAga2V5OiBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5cy5MQVlFUl9PVkVSUklERV9TVEFUVVNfVElQX0RJU01JU1NFRCxcbiAgICAgICAgICB2YWx1ZTogXCJ0cnVlXCJcbiAgICAgICAgfSk7XG4gICAgICB9IH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcIm1lc3NhZ2VcIiB9LCBzdHJpbmdzLnRpcCksIGgoXCJjYWxjaXRlLWxpbmtcIiwgeyBzbG90OiBcImxpbmtcIiwgdGl0bGU6IHN0cmluZ3MubGVhcm5Nb3JlLCB0YXJnZXQ6IFwiX2JsYW5rXCIsIGhyZWY6IGAke2hlbHBCYXNlfSR7aGVscE1hcFtcIjEyMDAwMjkxM1wiXX1gIH0sIHN0cmluZ3MubGVhcm5Nb3JlKSkpO1xuICB9XG4gIHJlbmRlclNlYXJjaCgpIHtcbiAgICBjb25zdCB7IGFsbEl0ZW1zLCBzdHJpbmdzIH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtZmlsdGVyXCIsIHsgaXRlbXM6IGFsbEl0ZW1zLCBtZXNzYWdlT3ZlcnJpZGVzOiB7IGxhYmVsOiBzdHJpbmdzLnN0YXR1cy5zZWFyY2hQbGFjZWhvbGRlciwgY2xlYXI6IHN0cmluZ3Muc3RhdHVzLmNsZWFyIH0sIHBsYWNlaG9sZGVyOiBzdHJpbmdzLnN0YXR1cy5zZWFyY2hQbGFjZWhvbGRlciwgY2xhc3M6IENTUy5maWx0ZXIsIG9uQ2FsY2l0ZUZpbHRlckNoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgIHRoaXMuZmlsdGVyZWRJdGVtcyA9IGV2ZW50LnRhcmdldC5maWx0ZXJlZEl0ZW1zO1xuICAgICAgICB0aGlzLmRhdGFCbG9ja05vZGUub3BlbiA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLmFwcGVhcmFuY2VCbG9ja05vZGUpIHtcbiAgICAgICAgICB0aGlzLmFwcGVhcmFuY2VCbG9ja05vZGUub3BlbiA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgLy8gZG9lc24ndCB3b3JrIHdpdGhvdXQgdGltZW91dFxuICAgICAgICAgIHRoaXMucmVwb3NpdGlvbigpO1xuICAgICAgICB9LCAxMDApO1xuICAgICAgfSB9KSk7XG4gIH1cbiAgcmVuZGVyRGF0YUNvbnRlbnQoKSB7XG4gICAgY29uc3QgeyBhbGxJdGVtcywgZmlsdGVyZWRJdGVtcywgZGF0YVR5cGVzLCBzdHJpbmdzIH0gPSB0aGlzO1xuICAgIGxldCBpdGVtcyA9IChmaWx0ZXJlZEl0ZW1zIHx8IGFsbEl0ZW1zKVxuICAgICAgLmZpbHRlcigoaXRlbSkgPT4gZGF0YVR5cGVzLmluZGV4T2YoaXRlbS52YWx1ZSkgPiAtMSlcbiAgICAgIC5tYXAoKGl0ZW0pID0+IHtcbiAgICAgIGlmIChpdGVtLnZhbHVlID09PSBcImRhdGFcIikge1xuICAgICAgICAvLyBkYXRhIGlzIG5ldmVyIG92ZXJyaWRkZW5cbiAgICAgICAgcmV0dXJuIFtpdGVtLnRpdGxlLCBcInNvdXJjZVwiXTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gW2l0ZW0udGl0bGUsIHRoaXMuZ2V0T3ZlcnJpZGVUeXBlKGl0ZW0udmFsdWUpXTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpdGVtcy5zb3J0KChhLCBiKSA9PiBhWzBdLmxvY2FsZUNvbXBhcmUoYlswXSkpO1xuICAgIC8vIG1vdmUgXCJkYXRhXCIgdG8gYmVnaW5uaW5nIG9mIGxpc3Q7IHVubGVzcyBpdCdzIGZpbHRlcmVkIG91dFxuICAgIGNvbnN0IGRhdGFJdGVtID0gaXRlbXMuZmluZCgoaXRlbSkgPT4gaXRlbVswXSA9PT0gc3RyaW5ncy5zdGF0dXMuZGF0YSk7XG4gICAgaWYgKGRhdGFJdGVtKSB7XG4gICAgICBpdGVtcyA9IGl0ZW1zLmZpbHRlcigoaXRlbSkgPT4gaXRlbVswXSAhPT0gc3RyaW5ncy5zdGF0dXMuZGF0YSk7XG4gICAgICBpdGVtcy51bnNoaWZ0KGRhdGFJdGVtKTtcbiAgICB9XG4gICAgY29uc3Qgc291cmNlSXRlbXMgPSBpdGVtcy5maWx0ZXIoKGl0ZW0pID0+IGl0ZW1bMV0gPT09IFwic291cmNlXCIpO1xuICAgIGNvbnN0IG1hcEl0ZW1zID0gaXRlbXMuZmlsdGVyKChpdGVtKSA9PiBpdGVtWzFdID09PSBcIndlYm1hcFwiKTtcbiAgICBjb25zdCBoYXNTb3VyY2VJdGVtcyA9IHNvdXJjZUl0ZW1zLmxlbmd0aCA+IDA7XG4gICAgY29uc3QgaGFzTWFwSXRlbXMgPSBtYXBJdGVtcy5sZW5ndGggPiAwO1xuICAgIGNvbnN0IHN1bW1hcnkgPSBoYXNTb3VyY2VJdGVtcyAmJiBoYXNNYXBJdGVtc1xuICAgICAgPyBzdHJpbmdzLnNvbWVQcm9wc1NldEluV2VibWFwXG4gICAgICA6IGhhc1NvdXJjZUl0ZW1zXG4gICAgICAgID8gc3RyaW5ncy5wcm9wc0Zyb21Tb3VyY2VcbiAgICAgICAgOiBzdHJpbmdzLnByb3BzU2V0SW5XZWJtYXA7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1ibG9ja1wiLCB7IGhlYWRpbmc6IHN0cmluZ3Muc3RhdHVzLmRhdGFQcm9wcywgZGVzY3JpcHRpb246IHN1bW1hcnksIGNvbGxhcHNpYmxlOiB0cnVlLCBvcGVuOiBoYXNNYXBJdGVtcywgb25DYWxjaXRlQmxvY2tUb2dnbGU6ICgpID0+IHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgLy8gZG9lc24ndCB3b3JrIHdpdGhvdXQgdGltZW91dFxuICAgICAgICAgIHRoaXMucmVwb3NpdGlvbigpO1xuICAgICAgICB9LCAxMDApO1xuICAgICAgfSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZGF0YUJsb2NrTm9kZSA9IG5vZGUpIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLmJsb2NrQ29udGVudCB9LCBoKFwiY2FsY2l0ZS1saXN0XCIsIG51bGwsIGhhc01hcEl0ZW1zICYmIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBDU1MubGlzdEhlYWRlciwgc2NhbGU6IFwic1wiIH0sIHN0cmluZ3Muc2V0SW5XZWJtYXApKSwgaGFzTWFwSXRlbXMgJiYgbWFwSXRlbXMubWFwKChbbGFiZWwsIHR5cGVdKSA9PiB0aGlzLnJlbmRlckxpc3RJdGVtKGxhYmVsLCB0eXBlKSksIGhhc1NvdXJjZUl0ZW1zICYmIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBDU1MubGlzdEhlYWRlciwgc2NhbGU6IFwic1wiIH0sIHN0cmluZ3Muc2V0RnJvbVNvdXJjZSkpLCBoYXNTb3VyY2VJdGVtcyAmJiBzb3VyY2VJdGVtcy5tYXAoKFtsYWJlbCwgdHlwZV0pID0+IHRoaXMucmVuZGVyTGlzdEl0ZW0obGFiZWwsIHR5cGUpKSkpKSk7XG4gIH1cbiAgcmVuZGVyQXBwZWFyYW5jZUNvbnRlbnQoKSB7XG4gICAgY29uc3QgeyBhbGxJdGVtcywgZmlsdGVyZWRJdGVtcywgYXBwZWFyYW5jZVR5cGVzLCBzdHJpbmdzLCBwcm9wcyB9ID0gdGhpcztcbiAgICBjb25zdCB7IGxheWVyIH0gPSBwcm9wcztcbiAgICBpZiAobGF5ZXIuaXNUYWJsZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGl0ZW1zID0gKGZpbHRlcmVkSXRlbXMgfHwgYWxsSXRlbXMpXG4gICAgICAuZmlsdGVyKChpdGVtKSA9PiBhcHBlYXJhbmNlVHlwZXMuaW5kZXhPZihpdGVtLnZhbHVlKSA+IC0xKVxuICAgICAgLm1hcCgoaXRlbSkgPT4gW2l0ZW0udGl0bGUsIHRoaXMuZ2V0T3ZlcnJpZGVUeXBlKGl0ZW0udmFsdWUpXSk7XG4gICAgaXRlbXMuc29ydCgoYSwgYikgPT4gYVswXS5sb2NhbGVDb21wYXJlKGJbMF0pKTtcbiAgICBjb25zdCBzb3VyY2VJdGVtcyA9IGl0ZW1zLmZpbHRlcigoaXRlbSkgPT4gaXRlbVsxXSA9PT0gXCJzb3VyY2VcIik7XG4gICAgY29uc3QgbWFwSXRlbXMgPSBpdGVtcy5maWx0ZXIoKGl0ZW0pID0+IGl0ZW1bMV0gPT09IFwid2VibWFwXCIpO1xuICAgIGNvbnN0IGhhc1NvdXJjZUl0ZW1zID0gc291cmNlSXRlbXMubGVuZ3RoID4gMDtcbiAgICBjb25zdCBoYXNNYXBJdGVtcyA9IG1hcEl0ZW1zLmxlbmd0aCA+IDA7XG4gICAgY29uc3Qgc3VtbWFyeSA9IGhhc1NvdXJjZUl0ZW1zICYmIGhhc01hcEl0ZW1zXG4gICAgICA/IHN0cmluZ3Muc29tZVByb3BzU2V0SW5XZWJtYXBcbiAgICAgIDogaGFzU291cmNlSXRlbXNcbiAgICAgICAgPyBzdHJpbmdzLnByb3BzRnJvbVNvdXJjZVxuICAgICAgICA6IHN0cmluZ3MucHJvcHNTZXRJbldlYm1hcDtcbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgaGVhZGluZzogc3RyaW5ncy5zdGF0dXMuYXBwZWFyYW5jZVByb3BzLCBkZXNjcmlwdGlvbjogc3VtbWFyeSwgY29sbGFwc2libGU6IHRydWUsIG9wZW46IGhhc01hcEl0ZW1zLCBvbkNhbGNpdGVCbG9ja1RvZ2dsZTogKCkgPT4ge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAvLyBkb2Vzbid0IHdvcmsgd2l0aG91dCB0aW1lb3V0XG4gICAgICAgICAgdGhpcy5yZXBvc2l0aW9uKCk7XG4gICAgICAgIH0sIDEwMCk7XG4gICAgICB9LCByZWY6IChub2RlKSA9PiAodGhpcy5hcHBlYXJhbmNlQmxvY2tOb2RlID0gbm9kZSkgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MuYmxvY2tDb250ZW50IH0sIGgoXCJjYWxjaXRlLWxpc3RcIiwgbnVsbCwgaGFzTWFwSXRlbXMgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLmxpc3RIZWFkZXIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBzY2FsZTogXCJzXCIgfSwgc3RyaW5ncy5zZXRJbldlYm1hcCkpKSwgaGFzTWFwSXRlbXMgJiYgbWFwSXRlbXMubWFwKChbbGFiZWwsIHR5cGVdKSA9PiB0aGlzLnJlbmRlckxpc3RJdGVtKGxhYmVsLCB0eXBlKSksIGhhc1NvdXJjZUl0ZW1zICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5saXN0SGVhZGVyIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgc2NhbGU6IFwic1wiIH0sIHN0cmluZ3Muc2V0RnJvbVNvdXJjZSkpKSwgaGFzU291cmNlSXRlbXMgJiYgc291cmNlSXRlbXMubWFwKChbbGFiZWwsIHR5cGVdKSA9PiB0aGlzLnJlbmRlckxpc3RJdGVtKGxhYmVsLCB0eXBlKSkpKSkpO1xuICB9XG4gIHJlbmRlckxpc3RJdGVtKGxhYmVsLCB0eXBlKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzIH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtbGlzdC1pdGVtXCIsIHsgbGFiZWw6IGxhYmVsIH0sIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHNsb3Q6IFwiYWN0aW9ucy1lbmRcIiwgdGV4dDogc3RyaW5ncy5tb3JlSW5mbywgaWNvbjogXCJpbmZvcm1hdGlvblwiLCBvbkNsaWNrOiAoZXZlbnQpID0+IHRoaXMubW9yZUluZm8obGFiZWwsIHR5cGUsIGV2ZW50KSB9KSkpO1xuICB9XG4gIG1vcmVJbmZvKGxhYmVsLCB0eXBlLCBldmVudCkge1xuICAgIGNvbnN0IHsgcG9wb3Zlck5vZGUsIHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgY29uc3QgcmVmZXJlbmNlTm9kZSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQ7XG4gICAgdGhpcy5jbG9zZUluZm9Qb3BvdmVyKCk7XG4gICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBkaXYuaW5uZXJIVE1MID1cbiAgICAgIHR5cGUgPT09IFwic291cmNlXCJcbiAgICAgICAgPyBzdHJpbmdzLnByb3BSZWZsZWN0VXBkYXRlcy5yZXBsYWNlKFwiJHtsYWJlbH1cIiwgbGFiZWwpXG4gICAgICAgIDogc3RyaW5ncy5wcm9wTm90Q29ubmVjdGVkLnJlcGxhY2UoXCIke2xhYmVsfVwiLCBsYWJlbCk7XG4gICAgZGl2LnN0eWxlID0gYHdpZHRoOiAke3BvcG92ZXJOb2RlLmNsaWVudFdpZHRoICogMC44fXB4OyBmb250LXNpemU6IHZhcigtLWNhbGNpdGUtZm9udC1zaXplLS0xKTsgbGluZS1oZWlnaHQ6IDFyZW07IG1hcmdpbjogMC43NXJlbTtgO1xuICAgIC8qIGlzc3VlIHdpdGggY2FsY2l0ZVxuICAgIGNvbnN0IGxhYmVsTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYWxjaXRlLWxhYmVsXCIpO1xuICAgIGxhYmVsTm9kZS5zY2FsZSA9IFwibVwiO1xuICAgIGxhYmVsTm9kZS5pbm5lckhUTUwgPSB0eXBlID09PSBcInNvdXJjZVwiID8gc3RyaW5ncy5wcm9wUmVmbGVjdFVwZGF0ZXMgOiBzdHJpbmdzLnByb3BOb3RDb25uZWN0ZWQ7XG4gICAgKGxhYmVsTm9kZSBhcyBhbnkpLnN0eWxlID0gYHdpZHRoOiAke3BvcG92ZXJOb2RlLmNsaWVudFdpZHRoICogMC43fXB4O2A7XG4gICAgKi9cbiAgICBjb25zdCBtb3JlSW5mb1BvcG92ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FsY2l0ZS1wb3BvdmVyXCIpO1xuICAgIG1vcmVJbmZvUG9wb3Zlci5oZWFkaW5nID0gdHlwZSA9PT0gXCJzb3VyY2VcIiA/IHN0cmluZ3Muc2V0RnJvbVNvdXJjZSA6IHN0cmluZ3Muc2V0SW5XZWJtYXA7XG4gICAgbW9yZUluZm9Qb3BvdmVyLnBsYWNlbWVudCA9IFwiYXV0b1wiO1xuICAgIG1vcmVJbmZvUG9wb3Zlci5vZmZzZXRTa2lkZGluZyA9IDU7XG4gICAgbW9yZUluZm9Qb3BvdmVyLmNsb3NhYmxlID0gdHJ1ZTtcbiAgICBtb3JlSW5mb1BvcG92ZXIubGFiZWwgPSBzdHJpbmdzLm1vcmVJbmZvO1xuICAgIG1vcmVJbmZvUG9wb3Zlci5yZWZlcmVuY2VFbGVtZW50ID0gcmVmZXJlbmNlTm9kZTtcbiAgICBtb3JlSW5mb1BvcG92ZXIuY2xhc3NOYW1lID0gYGpzLWFwcC1mbHlvdXRgOyAvLyBqcy1hcHAtZmx5b3V0IG5lZWRlZCBieSBhcHBcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG1vcmVJbmZvUG9wb3Zlcik7XG4gICAgbW9yZUluZm9Qb3BvdmVyLmFwcGVuZENoaWxkKGRpdik7XG4gICAgbW9yZUluZm9Qb3BvdmVyLnNldEF0dHJpYnV0ZShcIm9wZW5cIiwgXCJ0cnVlXCIpO1xuICAgIG1vcmVJbmZvUG9wb3Zlci5yZXBvc2l0aW9uKCk7XG4gICAgbW9yZUluZm9Qb3BvdmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJjYWxjaXRlUG9wb3ZlckNsb3NlXCIsICgpID0+IHtcbiAgICAgIHRoaXMuY2xvc2VJbmZvUG9wb3ZlcigpO1xuICAgIH0pO1xuICAgIC8vIG5lZWQgdG8gd2FpdCB1bnRpbCBpdCdzIGFsbCB2aXNpYmxlXG4gICAgc2V0VGltZW91dCgoKSA9PiBtb3JlSW5mb1BvcG92ZXIuc2V0Rm9jdXMoKSwgMTAwKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIC8vIGNsb3NlIHBvcG92ZXIgd2hlbiB0YWJiaW5nIG91dFxuICAgICAgdGhpcy5kb2N1bWVudFRhYkhhbmRsZXIgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCJUYWJcIikge1xuICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgIHRoaXMuY2xvc2VJbmZvUG9wb3ZlcigpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5kb2N1bWVudFRhYkhhbmRsZXIpO1xuICAgICAgLy8gY2xvc2UgcG9wb3ZlciB3aGVuIGNsaWNraW5nIG91dHNpZGVcbiAgICAgIHRoaXMuZG9jdW1lbnRDbGlja0hhbmRsZXIgPSAoKSA9PiB0aGlzLmNsb3NlSW5mb1BvcG92ZXIoKTtcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmRvY3VtZW50Q2xpY2tIYW5kbGVyKTtcbiAgICB9LCAxMDApO1xuICAgIHRoaXMubW9yZUluZm9Qb3BvdmVyTm9kZSA9IG1vcmVJbmZvUG9wb3ZlcjtcbiAgfVxuICBjbG9zZUluZm9Qb3BvdmVyKCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAodGhpcy5tb3JlSW5mb1BvcG92ZXJOb2RlKSB7XG4gICAgICAoX2EgPSB0aGlzLm1vcmVJbmZvUG9wb3Zlck5vZGUucmVmZXJlbmNlRWxlbWVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMubW9yZUluZm9Qb3BvdmVyTm9kZSk7XG4gICAgICB0aGlzLm1vcmVJbmZvUG9wb3Zlck5vZGUgPSBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy5kb2N1bWVudFRhYkhhbmRsZXIpIHtcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuZG9jdW1lbnRUYWJIYW5kbGVyKTtcbiAgICAgIHRoaXMuZG9jdW1lbnRUYWJIYW5kbGVyID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBpZiAodGhpcy5kb2N1bWVudENsaWNrSGFuZGxlcikge1xuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuZG9jdW1lbnRDbGlja0hhbmRsZXIpO1xuICAgICAgdGhpcy5kb2N1bWVudENsaWNrSGFuZGxlciA9IHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cbiAgaXNPdmVycmlkZGVuKGlkKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgY29uc3QgeyBwcm9wcyB9ID0gdGhpcztcbiAgICBjb25zdCB7IGxheWVyT3JpZ2luSW5mbyB9ID0gcHJvcHM7XG4gICAgcmV0dXJuICEhKCgoX2MgPSAoX2IgPSAoX2EgPSBsYXllck9yaWdpbkluZm8gPT09IG51bGwgfHwgbGF5ZXJPcmlnaW5JbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllck9yaWdpbkluZm8ucHJvcGVydHlHcm91cE9yaWdpbkluZm9zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmlsdGVyKChpbmZvKSA9PiBpbmZvLmlkID09PSBpZCkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYlswXSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnN0YXR1cykgPT09IFwib3ZlcnJpZGRlblwiKTtcbiAgfVxuICBnZXRPdmVycmlkZVR5cGUoaWQpIHtcbiAgICByZXR1cm4gdGhpcy5pc092ZXJyaWRkZW4oaWQpID8gXCJ3ZWJtYXBcIiA6IFwic291cmNlXCI7XG4gIH1cbiAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0xheWVyT3ZlcnJpZGVTdGF0dXMuc3R5bGUgPSBhcmNnaXNMYXllck92ZXJyaWRlU3RhdHVzQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNMYXllck92ZXJyaWRlIGFzIGFyY2dpc19sYXllcl9vdmVycmlkZSwgQXJjZ2lzTGF5ZXJPdmVycmlkZVByb3BlcnRpZXMgYXMgYXJjZ2lzX2xheWVyX292ZXJyaWRlX3Byb3BlcnRpZXMsIEFyY2dpc0xheWVyT3ZlcnJpZGVTdGF0dXMgYXMgYXJjZ2lzX2xheWVyX292ZXJyaWRlX3N0YXR1cyB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG52YXIgbG9jYWxTdG9yYWdlS2V5cztcbihmdW5jdGlvbiAobG9jYWxTdG9yYWdlS2V5cykge1xuICBsb2NhbFN0b3JhZ2VLZXlzW1wiQVJDR0lTX0NPTVBPTkVOVF9OT1RJRklDQVRJT05TXCJdID0gXCJhcmNnaXNDb21wb25lbnRfbm90aWZpY2F0aW9uc1wiO1xufSkobG9jYWxTdG9yYWdlS2V5cyB8fCAobG9jYWxTdG9yYWdlS2V5cyA9IHt9KSk7XG52YXIgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXM7XG4oZnVuY3Rpb24gKGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzKSB7XG4gIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzW1wiRkVBVFVSRV9SRURVQ1RJT05fV0FSTklOR19ESVNNSVNTRURcIl0gPSBcImFyY2dpc19mZWF0dXJlX3JlZHVjdGlvbl93YXJuaW5nX2Rpc21pc3NlZFwiO1xuICBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5c1tcIlBPUFVQX1dBUk5JTkdfRElTTUlTU0VEXCJdID0gXCJhcmNnaXNfcG9wdXBfd2FybmluZ19kaXNtaXNzZWRcIjtcbiAgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXNbXCJJTkNPTVBBVElCTEVfVkVDVE9SX1NZTUJPTFNfRElTTUlTU0VEXCJdID0gXCJhcmNnaXNfc3ltYm9sX3N0eWxlcl9pbmNvbXBhdGlibGVfdmVjdG9yX3N5bWJvbHNfZGlzbWlzc2VkXCI7XG4gIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzW1wiRUZGRUNUU19USVBfRElTTUlTU0VEXCJdID0gXCJhcmNnaXNfZWZmZWN0c190aXBfZGlzbWlzc2VkXCI7XG4gIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzW1wiTEFZRVJfVklFV19ERUZJTklUSU9OX0RJU01JU1NFRFwiXSA9IFwiYXJjZ2lzX2xheWVyX3ZpZXdfZGVmaW5pdGlvbl9kaXNtaXNzZWRcIjtcbiAgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXNbXCJMQVlFUl9PVkVSUklERV9TVEFUVVNfVElQX0RJU01JU1NFRFwiXSA9IFwiYXJjZ2lzX2xheWVyX292ZXJyaWRlX3N0YXR1c190aXBfZGlzbWlzc2VkXCI7XG4gIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzW1wiTEFZRVJfVklFV19KT0lOX1RJUF9ESVNNSVNTRURcIl0gPSBcImFyY2dpc19sYXllcl92aWV3X2pvaW5fdGlwX2Rpc21pc3NlZFwiO1xuICBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5c1tcIk1VTFRJRElNRU5TSU9OQUxfSU5GT19USVBfRElTTUlTU0VEXCJdID0gXCJhcmNnaXNfbXVsdGlkaW1lbnNpb25hbF9pbmZvX3RpcF9kaXNtaXNzZWRcIjtcbn0pKGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzIHx8IChhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5cyA9IHt9KSk7XG5jb25zdCBnZXRMb2NhbFN0b3JhZ2UgPSAobG9jYWxTdG9yYWdlS2V5KSA9PiB7XG4gIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShsb2NhbFN0b3JhZ2VLZXkpO1xufTtcbmNvbnN0IHNldExvY2FsU3RvcmFnZSA9IChsb2NhbFN0b3JhZ2VLZXksIHZhbHVlKSA9PiB7XG4gIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGxvY2FsU3RvcmFnZUtleSwgdmFsdWUpO1xufTtcbmNvbnN0IGdldE9iamVjdExvY2FsU3RvcmFnZSA9IChsb2NhbFN0b3JhZ2VLZXkpID0+IHtcbiAgcmV0dXJuIEpTT04ucGFyc2UoZ2V0TG9jYWxTdG9yYWdlKGxvY2FsU3RvcmFnZUtleSkpIHx8IHt9O1xufTtcbmNvbnN0IHNldFNpbmdsZU9iamVjdExvY2FsU3RvcmFnZSA9IChsb2NhbFN0b3JhZ2VLZXksIGtleVZhbHVlT2JqZWN0KSA9PiB7XG4gIGNvbnN0IHNldExvY2FsU3RvcmFnZVZhbCA9IGdldE9iamVjdExvY2FsU3RvcmFnZShsb2NhbFN0b3JhZ2VLZXkpO1xuICBzZXRMb2NhbFN0b3JhZ2VWYWxba2V5VmFsdWVPYmplY3Qua2V5XSA9IGtleVZhbHVlT2JqZWN0LnZhbHVlO1xuICBzZXRMb2NhbFN0b3JhZ2UobG9jYWxTdG9yYWdlS2V5LCBKU09OLnN0cmluZ2lmeShzZXRMb2NhbFN0b3JhZ2VWYWwpKTtcbn07XG5jb25zdCBnZXRTaW5nbGVPYmplY3RMb2NhbFN0b3JhZ2UgPSAobG9jYWxTdG9yYWdlS2V5LCBvYmplY3RLZXkpID0+IHtcbiAgY29uc3QgZ2V0TG9jYWxTdG9yYWdlVmFsID0gZ2V0T2JqZWN0TG9jYWxTdG9yYWdlKGxvY2FsU3RvcmFnZUtleSk7XG4gIGlmIChnZXRMb2NhbFN0b3JhZ2VWYWwgPT09IG51bGwgfHwgZ2V0TG9jYWxTdG9yYWdlVmFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBnZXRMb2NhbFN0b3JhZ2VWYWwuaGFzT3duUHJvcGVydHkob2JqZWN0S2V5KSkge1xuICAgIHJldHVybiBnZXRMb2NhbFN0b3JhZ2VWYWxbb2JqZWN0S2V5XTtcbiAgfVxuICBlbHNlIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufTtcblxuZXhwb3J0IHsgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXMgYXMgYSwgZ2V0U2luZ2xlT2JqZWN0TG9jYWxTdG9yYWdlIGFzIGcsIGxvY2FsU3RvcmFnZUtleXMgYXMgbCwgc2V0U2luZ2xlT2JqZWN0TG9jYWxTdG9yYWdlIGFzIHMgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgeyBsIGFzIGxhbmd1YWdlTWFwIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtMjIyNThjOTAuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRBc3NldFBhdGggfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcblxuLy8gaHR0cHM6Ly9tZWRpdW0uY29tL3N0ZW5jaWwtdHJpY2tzL2ltcGxlbWVudGluZy1pbnRlcm5hdGlvbmFsaXNhdGlvbi1pMThuLXdpdGgtc3RlbmNpbC01ZTY1NTk1NTQxMTdcbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KSB7XG4gIHZhciBfYSwgX2IsIF9jO1xuICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICB9XG4gIGVsc2Uge1xuICAgIC8vIFwicnUtUlVcIiBtYXBzIHRvIFwicnVcIiB1c2UgY2FzZVxuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZy5zbGljZSgwLCAyKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCkge1xuICB2YXIgX2EsIF9iLCBfYztcbiAgLy8gaXQncyBPSyBpZiB3ZSBkb24ndCBoYXZlIHRoZSA0IGxldHRlciBsYW5ndWFnZSBmaWxlIGZvciBpdFxuICAvLyA0IGxldHRlciBsYW5ndWFnZSBjb2RlIG5lZWRlZCBmb3IgZm9ybWF0dGluZyBudW1iZXJzXG4gIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgLy8gd2Ugc3VwcG9ydCB0aGUgMiBsZXR0ZXIgY29kZWQgbGFuZ3VhZ2VcbiAgICAgIC8vIGUuZy4gaXQtQ0ggdnMgaXRcbiAgICAgIHJldHVybiBsYW5nO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBcImVuXCI7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgZmV0Y2goZ2V0QXNzZXRQYXRoKGAuLi9hcmNnaXMtYXBwLWFzc2V0cy9pMThuLyR7Y29tcG9uZW50TmFtZX0uaTE4bi4ke2xvY2FsZX0uanNvbmApKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgIGlmIChyZXN1bHQub2spXG4gICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XG4gICAgICBlbHNlXG4gICAgICAgIHJlamVjdCgpO1xuICAgIH0sICgpID0+IHJlamVjdCgpKTtcbiAgfSk7XG59XG5jb25zdCBzdHJpbmdDYWNoZSA9IHt9O1xuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICBjb25zdCBpZCA9IGAke2NvbXBvbmVudE5hbWV9JHtsb2NhbGV9YDtcbiAgaWYgKCFzdHJpbmdDYWNoZVtpZF0pIHtcbiAgICBzdHJpbmdDYWNoZVtpZF0gPSBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKTtcbiAgfVxuICByZXR1cm4gc3RyaW5nQ2FjaGVbaWRdO1xufVxuLyoqXG4gKiBHZXQgc3RyaW5ncyBhbmQgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGlzIG1ldGhvZCByZXR1cm5zIDIgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGUgZmlyc3Qgb25lIHJldHVybnMgYSBjb2RlIHRoYXQncyBhbHNvIHN1cHBvcnRlZCBhcyBhIGxhbmd1YWdlIGZpbGUuXG4gKiBUaGUgc2Vjb25kIG9uZSByZXR1cm5zIGEgY29kZSB3aGVyZSB0aGVyZSBpcyBzdXBwb3J0IGZvciB0aGUgZmlyc3QgMiBsZXR0ZXJzIG9mIHRoZSBjb2RlIGFzIHBhcnQgb2YgYSBsYW5ndWFnZSBmaWxlLFxuICogYnV0IHdpbGwgcmV0dXJuIHRoZSBvcmlnaW5hbCA0IGxldHRlciBjb2RlIGZyb20gdGhlIHBhZ2UuXG4gKiBFLmcuIEZvciBcIml0LWNoXCIgaXQgd2lsbCByZXR1cm4gXCJpdFwiIGFzIHRoZSBmaXJzdCBsYW5ndWFnZSBjb2RlIGFuZCBcIml0LWNoXCIgYXMgdGhlIHNlY29uZC5cbiAqIFRoZSBzZWNvbmQgb25lIGlzIHJlcXVpcmVkIGZvciBlc3JpLmludGwuc2V0TG9jYWxlKCkgdG8gZ2V0IHRoZSBjb3JyZWN0IGZvcm1hdHRpbmcuXG4gKlxuICogSWYgYSB0YWdOYW1lIGlzIHByb3ZpZGVkIGl0IHdpbGwgb3ZlcndpdGUgdGhlIGVsZW1lbnQncyB0YWdOYW1lXG4gKlxuICogIEByZXR1cm4gWyBzdHJpbmdzLCBmaXJzdCBsYW5ndWFnZSBjb2RlLCBzZWNvbmQgbGFuZ3VhZ2UgY29kZV1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyhlbGVtZW50LCB0YWdOYW1lKSB7XG4gIGNvbnN0IGNvbXBvbmVudE5hbWUgPSB0YWdOYW1lIHx8IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCBjb21wb25lbnRMYW5ndWFnZSA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KTtcbiAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2VJbnRsID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KTtcbiAgbGV0IHN0cmluZ3M7XG4gIHRyeSB7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBjb21wb25lbnRMYW5ndWFnZSk7XG4gIH1cbiAgY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLndhcm4oYG5vIGxvY2FsZSBmb3IgJHtjb21wb25lbnROYW1lfSAoJHtjb21wb25lbnRMYW5ndWFnZX0pIGxvYWRpbmcgZGVmYXVsdCBsb2NhbGUgZW4uYCk7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBcImVuXCIpO1xuICB9XG4gIHJldHVybiBbc3RyaW5ncywgY29tcG9uZW50TGFuZ3VhZ2UsIGNvbXBvbmVudExhbmd1YWdlSW50bF07XG59XG5cbmV4cG9ydCB7IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZSBhcyBhLCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIGFzIGcgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==