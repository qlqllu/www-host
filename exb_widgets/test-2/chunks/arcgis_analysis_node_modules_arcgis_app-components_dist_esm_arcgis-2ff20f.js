"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-2ff20f"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-352083fd.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-352083fd.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ append)
/* harmony export */ });
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _append_63c5ce83_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./append-63c5ce83.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-63c5ce83.js");
/* harmony import */ var _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./feature-layer-38cdae87.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-38cdae87.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




async function append(addItemProps) {
  var _a;
  const appendParameters = (0,_append_63c5ce83_js__WEBPACK_IMPORTED_MODULE_1__.g)(addItemProps);
  const serviceUrl = (_a = addItemProps.existingItem) === null || _a === void 0 ? void 0 : _a.url;
  const appendUrl = `${serviceUrl}/${addItemProps.sourceDataLayer.id}/append`;
  try {
    const appendResponse = (await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(appendUrl, appendParameters, {}, "post"));
    const { status, recordCount } = await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_2__.w)(addItemProps.id, {}, appendResponse === null || appendResponse === void 0 ? void 0 : appendResponse.statusUrl);
    return { result: { status, recordCount } };
  }
  catch ({ error }) {
    console.error(error);
    return { error: { code: "unhandledError", message: JSON.stringify(error) } };
  }
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-58a7e7ab.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-58a7e7ab.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (/* binding */ AppendOverwriteCloudPublishTypes),
/* harmony export */   N: () => (/* binding */ NONE_VALUE),
/* harmony export */   a: () => (/* binding */ appendFileTypes),
/* harmony export */   b: () => (/* binding */ AppendOverwritePublishTypes),
/* harmony export */   c: () => (/* binding */ appendExtensionsForEnterprise),
/* harmony export */   d: () => (/* binding */ appendExtensions),
/* harmony export */   u: () => (/* binding */ uidFields)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
const uidFields = ["esriFieldTypeOID", "esriFieldTypeGlobalID"];
const NONE_VALUE = "<None>";
const AppendOverwritePublishTypes = {
  "file geodatabase": "filegeodatabase",
  shapefile: "shapefile",
  geojson: "geojson",
  csv: "CSV",
  "microsoft excel": "excel",
  geopackage: "geoPackage"
};
const appendFileTypes = {
  Shapefile: "shapefile",
  "File Geodatabase": "fileGeodatabase",
  CSV: "csv",
  "Microsoft Excel": "excel",
  GeoJson: "geojson",
  GeoPackage: "geoPackage"
};
const AppendOverwriteCloudPublishTypes = {
  csv: "CSV",
  excel: "Microsoft Excel",
  shapefile: "Shapefile",
  fgdb: "File Geodatabase",
  geojson: "GeoJson",
  googlesheets: "Microsoft Excel"
};
const appendExtensions = ["zip", "csv", "xls", "xlsx", "geojson", "gpkg", "json"];
const appendExtensionsForEnterprise = ["zip", "csv", "xls", "xlsx"];




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-63c5ce83.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-63c5ce83.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ canMatchField),
/* harmony export */   g: () => (/* binding */ getAppendParameters)
/* harmony export */ });
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./append-58a7e7ab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-58a7e7ab.js");
/* harmony import */ var _geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./geocode-7eb7c0df.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-7eb7c0df.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */





var __rest = ( false) || function (s, e) {
  var t = {};
  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
    t[p] = s[p];
  if (s != null && typeof Object.getOwnPropertySymbols === "function")
    for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
      if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
        t[p[i]] = s[p[i]];
    }
  return t;
};
function canMatchField(field, matchField) {
  var _a;
  const fieldType = (field === null || field === void 0 ? void 0 : field.type) || null;
  const matchFieldType = (matchField === null || matchField === void 0 ? void 0 : matchField.type) || null;
  const matchFields = {
    esriFieldTypeSmallInteger: ["esriFieldTypeSmallInteger"],
    esriFieldTypeInteger: ["esriFieldTypeInteger", "esriFieldTypeSmallInteger"],
    esriFieldTypeSingle: ["esriFieldTypeSingle", "esriFieldTypeDouble"],
    esriFieldTypeDouble: [
      "esriFieldTypeDouble",
      "esriFieldTypeSingle",
      "esriFieldTypeInteger",
      "esriFieldTypeSmallInteger"
    ],
    esriFieldTypeDate: ["esriFieldTypeDate"],
    esriFieldTypeString: [
      "esriFieldTypeString",
      "esriFieldTypeSmallInteger",
      "esriFieldTypeInteger",
      "esriFieldTypeSingle",
      "esriFieldTypeDouble",
      "esriFieldTypeDate",
      "esriFieldTypeGUID"
    ],
    esriFieldTypeGUID: ["esriFieldTypeGUID", "esriFieldTypeString"],
    esriFieldTypeOID: ["esriFieldTypeOID", "esriFieldTypeSmallInteger", "esriFieldTypeInteger"],
    esriFieldTypeGlobalID: ["esriFieldTypeGlobalID", "esriFieldTypeGUID", "esriFieldTypeString"],
    esriFieldTypeDateOnly: ["esriFieldTypeDateOnly"],
    esriFieldTypeTimeOnly: ["esriFieldTypeTimeOnly"],
    esriFieldTypeTimestampOffset: ["esriFieldTypeTimestampOffset"],
    esriFieldTypeBigInteger: ["esriFieldTypeBigInteger"]
  };
  return matchFieldType && (matchFieldType === fieldType || ((_a = matchFields[fieldType]) === null || _a === void 0 ? void 0 : _a.indexOf(matchFieldType)) > -1);
}
function getAppendParameters(addItemProps) {
  var _a;
  const { timezone, analyzeResults, type, fieldMappings, dataLayer, id, uidPair, addAppendSelectOption, sourceDataLayer } = addItemProps;
  let finalAppendParameters, appendSourceInfo;
  const { publishParameters } = analyzeResults, rest = __rest(analyzeResults, ["publishParameters"]);
  const upsert = addAppendSelectOption === "upsert" || addAppendSelectOption === "update";
  const finalFieldMappings = formatFieldMappings(fieldMappings);
  const appendFields = createAppendFields(finalFieldMappings);
  const timezoneInfo = {
    dateFieldsTimeReference: {
      timeZone: timezone || "UTC",
      respectsDaylightSaving: true
    }
  };
  const defaultAppendParams = {
    sourceTableName: dataLayer.name,
    fieldMappings: (finalFieldMappings === null || finalFieldMappings === void 0 ? void 0 : finalFieldMappings.length) ? JSON.stringify(finalFieldMappings) : null,
    upsert,
    skipInserts: addAppendSelectOption === "update",
    skipUpdates: false,
    useGlobalIds: upsert && (uidPair === null || uidPair === void 0 ? void 0 : uidPair.type) === "esriFieldTypeGlobalID",
    updateGeometry: upsert ? _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_0__.a.addAppendSelectUpdateTypeOption === "attributeAndGeometry" : true,
    appendFields: appendFields.length ? JSON.stringify(appendFields) : null,
    appendItemId: id,
    appendUploadFormat: _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_3__.a[_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_0__.a.type].appendUploadFormat,
    rollbackOnFailure: true
  };
  const publishInfo = __rest(publishParameters, ["layers"]);
  if (type === "CSV") {
    publishParameters.layerInfo.dateFieldsTimeReference = timezoneInfo.dateFieldsTimeReference;
    appendSourceInfo = Object.assign(Object.assign(Object.assign({}, timezoneInfo), publishParameters), rest);
  }
  else if (type === "Microsoft Excel") {
    const layerInfo = (0,_geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_2__.a)({}, true);
    const formattedLayerInfo = getLayerToAppend(layerInfo, publishInfo); //Updated info needs to be added to the layers [] rather than the root for excel
    formattedLayerInfo.dateFieldsTimeReference = timezoneInfo.dateFieldsTimeReference;
    publishInfo.name = dataLayer.name;
    appendSourceInfo = Object.assign(Object.assign(Object.assign(Object.assign({}, timezoneInfo), { layers: [formattedLayerInfo] }), publishInfo), rest);
  }
  else {
    appendSourceInfo = Object.assign(Object.assign(Object.assign({}, timezoneInfo), publishParameters), rest);
  }
  finalAppendParameters = Object.assign(Object.assign({}, defaultAppendParams), { appendSourceInfo: JSON.stringify(appendSourceInfo) });
  if (addAppendSelectOption === "add") {
    finalAppendParameters.upsertMatchingField = sourceDataLayer.objectIdField || ((_a = sourceDataLayer.uniqueField) === null || _a === void 0 ? void 0 : _a.name);
  }
  else {
    if (upsert && (uidPair === null || uidPair === void 0 ? void 0 : uidPair.isUniqueIndex)) {
      finalAppendParameters.upsertMatchingField = uidPair === null || uidPair === void 0 ? void 0 : uidPair.name;
    }
  }
  return finalAppendParameters;
}
function getLayerToAppend(layerInfo, updatedInfo) {
  const formattedLayer = Object.assign({}, layerInfo);
  formattedLayer.locationType = updatedInfo.locationType;
  if (formattedLayer.locationType === "address") {
    formattedLayer.addressFields = updatedInfo.addressFields;
    formattedLayer.sourceCountry = updatedInfo.sourceCountry;
  }
  else if (formattedLayer.locationType === "coordinates") {
    formattedLayer.coordinateFieldType = updatedInfo.coordinateFieldType;
    if (formattedLayer.coordinateFieldType === "LatitudeAndLongitude") {
      formattedLayer.latitudeFieldName = updatedInfo.latitudeFieldName;
      formattedLayer.longitudeFieldName = updatedInfo.longitudeFieldName;
    }
    else {
      formattedLayer.coordinateFieldName = updatedInfo.coordinateFieldName;
    }
  }
  return formattedLayer;
}
function formatFieldMappings(fieldMappings) {
  const fields = fieldMappings.filter((fieldMapping) => {
    return fieldMapping.source !== _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_1__.N;
  });
  const finalFieldMappings = fields.map(({ source, name }) => {
    return { source, name };
  });
  return finalFieldMappings;
}
function createAppendFields(fieldMappings) {
  const appendFields = fieldMappings.map((mapping) => {
    return mapping.name;
  });
  return appendFields;
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-select-update.entry.js":
/*!*********************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-select-update.entry.js ***!
  \*********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_append_select_update: () => (/* binding */ ArcgisNewItemPagesAppendSelectUpdate)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _append_352083fd_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./append-352083fd.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-352083fd.js");
/* harmony import */ var _overwrite_3049b7af_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./overwrite-3049b7af.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/overwrite-3049b7af.js");
/* harmony import */ var _server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./server-item-f12153e6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _geometries_f295af3a_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./geometries-f295af3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geometries-f295af3a.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _append_63c5ce83_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./append-63c5ce83.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-63c5ce83.js");
/* harmony import */ var _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./append-58a7e7ab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-58a7e7ab.js");
/* harmony import */ var _geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./geocode-7eb7c0df.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-7eb7c0df.js");
/* harmony import */ var _privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./privileges-35590eb4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-35590eb4.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/* harmony import */ var _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./feature-layer-38cdae87.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-38cdae87.js");
/* harmony import */ var _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./item-properties-e6412a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js");
/* harmony import */ var _feature_layer_d33ea114_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./feature-layer-d33ea114.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-d33ea114.js");
/* harmony import */ var _guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./guid-4f4176ba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js");
/* harmony import */ var _thumbnail_0b7adfcd_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./thumbnail-0b7adfcd.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-0b7adfcd.js");
/* harmony import */ var _query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./query-4f7b7e4d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-4f7b7e4d.js");
/* harmony import */ var _user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./user-e3dedc4a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js");
/* harmony import */ var _api_f7934cd7_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./api-f7934cd7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-f7934cd7.js");
/* harmony import */ var _item_d9d70416_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./item-d9d70416.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-d9d70416.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _feature_layer_69305a85_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./feature-layer-69305a85.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-69305a85.js");
/* harmony import */ var _functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./functional-9f648bee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-9f648bee.js");
/* harmony import */ var _ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./ags-68d4ae20.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-68d4ae20.js");
/* harmony import */ var _url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./url-f3b82cc7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-f3b82cc7.js");
/* harmony import */ var _storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./storage-d7f5822e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js");
/* harmony import */ var _file_f36193e9_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./file-f36193e9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-f36193e9.js");
/* harmony import */ var _store_3210b604_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./store-3210b604.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-3210b604.js");
/* harmony import */ var _publish_item_82ffa7f8_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./publish-item-82ffa7f8.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/publish-item-82ffa7f8.js");
/* harmony import */ var _tile_layer_90a6b901_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./tile-layer-90a6b901.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-90a6b901.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */






































const arcgisNewItemPagesAppendSelectUpdateCss = ".tile-select{margin-top:1.25rem}.need-geometries-notice{margin-top:1.5rem}";

const ArcgisNewItemPagesAppendSelectUpdate = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.workflowComplete = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
    this.newItemToggleNavigationEnabled = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
    this.newItemDisableCloseButtons = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemDisableCloseButtons", 7);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.newItemPrevPage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemPrevPage", 7);
    this.appendOptions = {
      attribute: {
        icon: "table",
        updateGeometry: false
      },
      attributeAndGeometry: {
        icon: "multiple-variables",
        updateGeometry: true
      }
    };
    this.updateOptions = {
      uploaded: {
        icon: "upload-to",
        keepDescription: false
      },
      existing: {
        icon: "feature-details",
        keepDescription: true
      }
    };
    this.noticeMessage = null;
    this.selected = undefined;
    this.cannotUpdateGeometry = false;
    this.loading = false;
    this.loaderType = "indeterminate";
    this.loaderMessage = undefined;
    this.error = undefined;
  }
  async componentWillLoad() {
    var _a;
    this.selected = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "append" ? "attribute" : "uploaded";
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.appendSelectUpdateType;
    if (_ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "append") {
      (_a = this.noticeMessage) !== null && _a !== void 0 ? _a : (this.noticeMessage = (0,_geometries_f295af3a_js__WEBPACK_IMPORTED_MODULE_6__.v)({
        dataLayer: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.dataLayer,
        type: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.type,
        sourceDataLayer: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.sourceDataLayer
      }));
      this.cannotUpdateGeometry = !!this.noticeMessage;
    }
    _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.nextText = "updateAppend";
  }
  async handleNext() {
    const selected = this.selected;
    if (_ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "update") {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.addUpdateItemPropertiesOption = selected;
      const keepDescription = selected === "uploaded" ? true : false;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.keepDescription = keepDescription;
      this.handleUpdate();
    }
    else {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.addAppendSelectUpdateTypeOption = selected;
      this.handleAppend();
    }
  }
  async handlePrev(event) {
    event.preventDefault();
    !this.loading && this.newItemPrevPage.emit();
  }
  async handleUpdate() {
    this.loading = true;
    this.loaderMessage = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.append.appendLoadingMessages.updating;
    const { file, overwrite, keepDescription, existingItem } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a;
    const response = await (0,_overwrite_3049b7af_js__WEBPACK_IMPORTED_MODULE_2__.b)(existingItem, existingItem.itemOwner.userContentUrl, // ! Use fetchUser if itemOwner is not available
    { file, overwrite, keepDescription });
    if (!response.success) {
      this.loading = false;
      this.error = {
        title: _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.error,
        description: _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.appendOverwrite.errors.errorWhileUpdate
      };
    }
    else {
      this.workflowComplete.emit({
        success: response.success
      });
    }
  }
  disableModalButtons(disable) {
    this.newItemToggleNavigationEnabled.emit(!disable);
    this.newItemDisableCloseButtons.emit(disable);
  }
  async handleAppend() {
    var _a;
    this.disableModalButtons(true);
    this.loading = true;
    this.loaderMessage = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.append.appendLoadingMessages.appendCloseNotice;
    const response = await (0,_append_352083fd_js__WEBPACK_IMPORTED_MODULE_1__.a)({
      sourceDataLayer: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.sourceDataLayer,
      existingItem: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.existingItem,
      timezone: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.timezone,
      analyzeResults: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.analyzeResults,
      type: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.type,
      fieldMappings: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.fieldMappings,
      dataLayer: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.dataLayer,
      id: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.id,
      uidPair: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.uidPair,
      addAppendSelectOption: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.addAppendSelectOption
    });
    if (((_a = response === null || response === void 0 ? void 0 : response.result) === null || _a === void 0 ? void 0 : _a.status.toLowerCase()) === "completed") {
      await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_3__.d)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.id, { permanentDelete: true });
      const emitPayload = Object.assign({ appendType: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.addAppendSelectOption }, response);
      this.workflowComplete.emit(emitPayload);
      return;
    }
    else {
      this.disableModalButtons(false);
      this.loading = false;
      this.error = {
        title: _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.error,
        description: _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.append.appendErrorMessages.appendError
      };
    }
  }
  render() {
    const { i18n, appendOptions, updateOptions, noticeMessage, error } = this;
    let options = appendOptions;
    let header = i18n.header;
    let optionsString = "appendOptions";
    if (_ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "update") {
      options = updateOptions;
      header = i18n.itemPropertiesHeader;
      optionsString = "updateOptions";
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: { "overflow-hidden": this.loading } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: header }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", { layout: "vertical", class: "tile-select" }, Object.keys(options).map((key) => {
      const { icon } = options[key];
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { key: key, checked: this.selected === key, heading: i18n[optionsString][key].title, description: i18n[optionsString][key].description, icon: icon, name: "feature-layer-create-mode", "input-enabled": true, width: "full", type: "radio", value: key, disabled: key === "attributeAndGeometry" && this.cannotUpdateGeometry, onCalciteTileSelectChange: (e) => {
          this.selected = e.target.value;
        } }));
    })), _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "append" && this.cannotUpdateGeometry && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { class: "need-geometries-notice", open: true, icon: "lightbulb" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, i18n[noticeMessage.title]), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, i18n[noticeMessage.description]))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: this.loaderType, active: this.loading, text: this.loaderMessage }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: error === null || error === void 0 ? void 0 : error.title, description: error === null || error === void 0 ? void 0 : error.description, link: { href: error === null || error === void 0 ? void 0 : error.link, title: error === null || error === void 0 ? void 0 : error.linkText }, active: !!error, onAlertDismiss: () => (this.error = null) })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesAppendSelectUpdate.style = arcgisNewItemPagesAppendSelectUpdateCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geometries-f295af3a.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geometries-f295af3a.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ checkCompatibleGeometries),
/* harmony export */   v: () => (/* binding */ verifyGeometries)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
function verifyGeometries(args) {
  var _a, _b;
  const { dataLayer, type, sourceDataLayer } = args;
  const dataLayerGeometry = (_a = dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.geometryType) !== null && _a !== void 0 ? _a : (_b = dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.layerInfo) === null || _b === void 0 ? void 0 : _b.geometryType;
  if (type === "Microsoft Excel" || type === "CSV") {
    if (((dataLayer.locationType === "address" && dataLayer.addressFields) || dataLayer.locationType === "coordinates") && //check location type is address in case "none" is selected and addressFields linger
      (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) === "esriGeometryPoint") {
      return null;
    }
    else if (!dataLayerGeometry || dataLayer.locationType === "none" || (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.type) === "Table") {
      return { title: "noGeometryMatchTitle", description: "noGeometryTableMessage" };
    }
    else if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) !== dataLayerGeometry) {
      return { title: "noGeometryMatchTitle", description: "noGeometryMatchMessage" };
    }
  }
  else {
    if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) !== (dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.geometryType)) {
      return { title: "noGeometryMatchTitle", description: "noGeometryMatchMessage" };
    }
  }
}
function checkCompatibleGeometries(dataLayer, sourceDataLayer, type) {
  if (type === "Microsoft Excel" || type === "CSV") {
    if (((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) === "esriGeometryPoint" || (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.type) === "Table") &&
      (dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.locationType) === "none") {
      return true;
    }
    if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) === "esriGeometryPoint") {
      return !!dataLayer.addressFields || dataLayer.locationType !== "none";
    }
    return false;
  }
  else {
    return (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.type) === "Table" || (dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.geometryType) === (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType);
  }
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTJmZjIwZi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDb0Q7QUFDWTtBQUNDOztBQUVqRTtBQUNBO0FBQ0EsMkJBQTJCLHNEQUFtQjtBQUM5QztBQUNBLHVCQUF1QixXQUFXLEdBQUcsZ0NBQWdDO0FBQ3JFO0FBQ0Esa0NBQWtDLHNEQUFPLGdDQUFnQztBQUN6RSxZQUFZLHNCQUFzQixRQUFRLDZEQUFhLG9CQUFvQjtBQUMzRSxhQUFhLFVBQVU7QUFDdkI7QUFDQSxXQUFXLE9BQU87QUFDbEI7QUFDQSxhQUFhLFNBQVM7QUFDdEI7QUFDQTs7QUFFdUI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3hCdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFcU07Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDakNyTTtBQUNBO0FBQ0E7QUFDQTtBQUMyRDtBQUNKO0FBQ1c7QUFDQzs7QUFFbkUsY0FBYyxNQUE2QjtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RCxjQUFjO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRWlFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXBwZW5kLTM1MjA4M2ZkLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FwcGVuZC01OGE3ZTdhYi5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcHBlbmQtNjNjNWNlODMuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWFwcGVuZC1zZWxlY3QtdXBkYXRlLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2dlb21ldHJpZXMtZjI5NWFmM2EuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyByIGFzIHJlcXVlc3QgfSBmcm9tICcuL3BvcnRhbC03OWNhYWVmZi5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEFwcGVuZFBhcmFtZXRlcnMgfSBmcm9tICcuL2FwcGVuZC02M2M1Y2U4My5qcyc7XG5pbXBvcnQgeyB3IGFzIGdldEl0ZW1TdGF0dXMgfSBmcm9tICcuL2ZlYXR1cmUtbGF5ZXItMzhjZGFlODcuanMnO1xuXG5hc3luYyBmdW5jdGlvbiBhcHBlbmQoYWRkSXRlbVByb3BzKSB7XG4gIHZhciBfYTtcbiAgY29uc3QgYXBwZW5kUGFyYW1ldGVycyA9IGdldEFwcGVuZFBhcmFtZXRlcnMoYWRkSXRlbVByb3BzKTtcbiAgY29uc3Qgc2VydmljZVVybCA9IChfYSA9IGFkZEl0ZW1Qcm9wcy5leGlzdGluZ0l0ZW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51cmw7XG4gIGNvbnN0IGFwcGVuZFVybCA9IGAke3NlcnZpY2VVcmx9LyR7YWRkSXRlbVByb3BzLnNvdXJjZURhdGFMYXllci5pZH0vYXBwZW5kYDtcbiAgdHJ5IHtcbiAgICBjb25zdCBhcHBlbmRSZXNwb25zZSA9IChhd2FpdCByZXF1ZXN0KGFwcGVuZFVybCwgYXBwZW5kUGFyYW1ldGVycywge30sIFwicG9zdFwiKSk7XG4gICAgY29uc3QgeyBzdGF0dXMsIHJlY29yZENvdW50IH0gPSBhd2FpdCBnZXRJdGVtU3RhdHVzKGFkZEl0ZW1Qcm9wcy5pZCwge30sIGFwcGVuZFJlc3BvbnNlID09PSBudWxsIHx8IGFwcGVuZFJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhcHBlbmRSZXNwb25zZS5zdGF0dXNVcmwpO1xuICAgIHJldHVybiB7IHJlc3VsdDogeyBzdGF0dXMsIHJlY29yZENvdW50IH0gfTtcbiAgfVxuICBjYXRjaCAoeyBlcnJvciB9KSB7XG4gICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgcmV0dXJuIHsgZXJyb3I6IHsgY29kZTogXCJ1bmhhbmRsZWRFcnJvclwiLCBtZXNzYWdlOiBKU09OLnN0cmluZ2lmeShlcnJvcikgfSB9O1xuICB9XG59XG5cbmV4cG9ydCB7IGFwcGVuZCBhcyBhIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmNvbnN0IHVpZEZpZWxkcyA9IFtcImVzcmlGaWVsZFR5cGVPSURcIiwgXCJlc3JpRmllbGRUeXBlR2xvYmFsSURcIl07XG5jb25zdCBOT05FX1ZBTFVFID0gXCI8Tm9uZT5cIjtcbmNvbnN0IEFwcGVuZE92ZXJ3cml0ZVB1Ymxpc2hUeXBlcyA9IHtcbiAgXCJmaWxlIGdlb2RhdGFiYXNlXCI6IFwiZmlsZWdlb2RhdGFiYXNlXCIsXG4gIHNoYXBlZmlsZTogXCJzaGFwZWZpbGVcIixcbiAgZ2VvanNvbjogXCJnZW9qc29uXCIsXG4gIGNzdjogXCJDU1ZcIixcbiAgXCJtaWNyb3NvZnQgZXhjZWxcIjogXCJleGNlbFwiLFxuICBnZW9wYWNrYWdlOiBcImdlb1BhY2thZ2VcIlxufTtcbmNvbnN0IGFwcGVuZEZpbGVUeXBlcyA9IHtcbiAgU2hhcGVmaWxlOiBcInNoYXBlZmlsZVwiLFxuICBcIkZpbGUgR2VvZGF0YWJhc2VcIjogXCJmaWxlR2VvZGF0YWJhc2VcIixcbiAgQ1NWOiBcImNzdlwiLFxuICBcIk1pY3Jvc29mdCBFeGNlbFwiOiBcImV4Y2VsXCIsXG4gIEdlb0pzb246IFwiZ2VvanNvblwiLFxuICBHZW9QYWNrYWdlOiBcImdlb1BhY2thZ2VcIlxufTtcbmNvbnN0IEFwcGVuZE92ZXJ3cml0ZUNsb3VkUHVibGlzaFR5cGVzID0ge1xuICBjc3Y6IFwiQ1NWXCIsXG4gIGV4Y2VsOiBcIk1pY3Jvc29mdCBFeGNlbFwiLFxuICBzaGFwZWZpbGU6IFwiU2hhcGVmaWxlXCIsXG4gIGZnZGI6IFwiRmlsZSBHZW9kYXRhYmFzZVwiLFxuICBnZW9qc29uOiBcIkdlb0pzb25cIixcbiAgZ29vZ2xlc2hlZXRzOiBcIk1pY3Jvc29mdCBFeGNlbFwiXG59O1xuY29uc3QgYXBwZW5kRXh0ZW5zaW9ucyA9IFtcInppcFwiLCBcImNzdlwiLCBcInhsc1wiLCBcInhsc3hcIiwgXCJnZW9qc29uXCIsIFwiZ3BrZ1wiLCBcImpzb25cIl07XG5jb25zdCBhcHBlbmRFeHRlbnNpb25zRm9yRW50ZXJwcmlzZSA9IFtcInppcFwiLCBcImNzdlwiLCBcInhsc1wiLCBcInhsc3hcIl07XG5cbmV4cG9ydCB7IEFwcGVuZE92ZXJ3cml0ZUNsb3VkUHVibGlzaFR5cGVzIGFzIEEsIE5PTkVfVkFMVUUgYXMgTiwgYXBwZW5kRmlsZVR5cGVzIGFzIGEsIEFwcGVuZE92ZXJ3cml0ZVB1Ymxpc2hUeXBlcyBhcyBiLCBhcHBlbmRFeHRlbnNpb25zRm9yRW50ZXJwcmlzZSBhcyBjLCBhcHBlbmRFeHRlbnNpb25zIGFzIGQsIHVpZEZpZWxkcyBhcyB1IH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGEgYXMgYWRkSXRlbVN0YXRlIH0gZnJvbSAnLi9hZGQtaXRlbS05N2Q1NzdhOS5qcyc7XG5pbXBvcnQgeyBOIGFzIE5PTkVfVkFMVUUgfSBmcm9tICcuL2FwcGVuZC01OGE3ZTdhYi5qcyc7XG5pbXBvcnQgeyBhIGFzIGdldEFuYWx5emVkTGF5ZXJJbmZvIH0gZnJvbSAnLi9nZW9jb2RlLTdlYjdjMGRmLmpzJztcbmltcG9ydCB7IGEgYXMgYWRkQ3JlYXRlSXRlbVR5cGVzIH0gZnJvbSAnLi9pdGVtLXR5cGVzLWI0ZmU4NmFkLmpzJztcblxudmFyIF9fcmVzdCA9ICh1bmRlZmluZWQgJiYgdW5kZWZpbmVkLl9fcmVzdCkgfHwgZnVuY3Rpb24gKHMsIGUpIHtcbiAgdmFyIHQgPSB7fTtcbiAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApICYmIGUuaW5kZXhPZihwKSA8IDApXG4gICAgdFtwXSA9IHNbcF07XG4gIGlmIChzICE9IG51bGwgJiYgdHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09IFwiZnVuY3Rpb25cIilcbiAgICBmb3IgKHZhciBpID0gMCwgcCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMocyk7IGkgPCBwLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoZS5pbmRleE9mKHBbaV0pIDwgMCAmJiBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwocywgcFtpXSkpXG4gICAgICAgIHRbcFtpXV0gPSBzW3BbaV1dO1xuICAgIH1cbiAgcmV0dXJuIHQ7XG59O1xuZnVuY3Rpb24gY2FuTWF0Y2hGaWVsZChmaWVsZCwgbWF0Y2hGaWVsZCkge1xuICB2YXIgX2E7XG4gIGNvbnN0IGZpZWxkVHlwZSA9IChmaWVsZCA9PT0gbnVsbCB8fCBmaWVsZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmllbGQudHlwZSkgfHwgbnVsbDtcbiAgY29uc3QgbWF0Y2hGaWVsZFR5cGUgPSAobWF0Y2hGaWVsZCA9PT0gbnVsbCB8fCBtYXRjaEZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXRjaEZpZWxkLnR5cGUpIHx8IG51bGw7XG4gIGNvbnN0IG1hdGNoRmllbGRzID0ge1xuICAgIGVzcmlGaWVsZFR5cGVTbWFsbEludGVnZXI6IFtcImVzcmlGaWVsZFR5cGVTbWFsbEludGVnZXJcIl0sXG4gICAgZXNyaUZpZWxkVHlwZUludGVnZXI6IFtcImVzcmlGaWVsZFR5cGVJbnRlZ2VyXCIsIFwiZXNyaUZpZWxkVHlwZVNtYWxsSW50ZWdlclwiXSxcbiAgICBlc3JpRmllbGRUeXBlU2luZ2xlOiBbXCJlc3JpRmllbGRUeXBlU2luZ2xlXCIsIFwiZXNyaUZpZWxkVHlwZURvdWJsZVwiXSxcbiAgICBlc3JpRmllbGRUeXBlRG91YmxlOiBbXG4gICAgICBcImVzcmlGaWVsZFR5cGVEb3VibGVcIixcbiAgICAgIFwiZXNyaUZpZWxkVHlwZVNpbmdsZVwiLFxuICAgICAgXCJlc3JpRmllbGRUeXBlSW50ZWdlclwiLFxuICAgICAgXCJlc3JpRmllbGRUeXBlU21hbGxJbnRlZ2VyXCJcbiAgICBdLFxuICAgIGVzcmlGaWVsZFR5cGVEYXRlOiBbXCJlc3JpRmllbGRUeXBlRGF0ZVwiXSxcbiAgICBlc3JpRmllbGRUeXBlU3RyaW5nOiBbXG4gICAgICBcImVzcmlGaWVsZFR5cGVTdHJpbmdcIixcbiAgICAgIFwiZXNyaUZpZWxkVHlwZVNtYWxsSW50ZWdlclwiLFxuICAgICAgXCJlc3JpRmllbGRUeXBlSW50ZWdlclwiLFxuICAgICAgXCJlc3JpRmllbGRUeXBlU2luZ2xlXCIsXG4gICAgICBcImVzcmlGaWVsZFR5cGVEb3VibGVcIixcbiAgICAgIFwiZXNyaUZpZWxkVHlwZURhdGVcIixcbiAgICAgIFwiZXNyaUZpZWxkVHlwZUdVSURcIlxuICAgIF0sXG4gICAgZXNyaUZpZWxkVHlwZUdVSUQ6IFtcImVzcmlGaWVsZFR5cGVHVUlEXCIsIFwiZXNyaUZpZWxkVHlwZVN0cmluZ1wiXSxcbiAgICBlc3JpRmllbGRUeXBlT0lEOiBbXCJlc3JpRmllbGRUeXBlT0lEXCIsIFwiZXNyaUZpZWxkVHlwZVNtYWxsSW50ZWdlclwiLCBcImVzcmlGaWVsZFR5cGVJbnRlZ2VyXCJdLFxuICAgIGVzcmlGaWVsZFR5cGVHbG9iYWxJRDogW1wiZXNyaUZpZWxkVHlwZUdsb2JhbElEXCIsIFwiZXNyaUZpZWxkVHlwZUdVSURcIiwgXCJlc3JpRmllbGRUeXBlU3RyaW5nXCJdLFxuICAgIGVzcmlGaWVsZFR5cGVEYXRlT25seTogW1wiZXNyaUZpZWxkVHlwZURhdGVPbmx5XCJdLFxuICAgIGVzcmlGaWVsZFR5cGVUaW1lT25seTogW1wiZXNyaUZpZWxkVHlwZVRpbWVPbmx5XCJdLFxuICAgIGVzcmlGaWVsZFR5cGVUaW1lc3RhbXBPZmZzZXQ6IFtcImVzcmlGaWVsZFR5cGVUaW1lc3RhbXBPZmZzZXRcIl0sXG4gICAgZXNyaUZpZWxkVHlwZUJpZ0ludGVnZXI6IFtcImVzcmlGaWVsZFR5cGVCaWdJbnRlZ2VyXCJdXG4gIH07XG4gIHJldHVybiBtYXRjaEZpZWxkVHlwZSAmJiAobWF0Y2hGaWVsZFR5cGUgPT09IGZpZWxkVHlwZSB8fCAoKF9hID0gbWF0Y2hGaWVsZHNbZmllbGRUeXBlXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluZGV4T2YobWF0Y2hGaWVsZFR5cGUpKSA+IC0xKTtcbn1cbmZ1bmN0aW9uIGdldEFwcGVuZFBhcmFtZXRlcnMoYWRkSXRlbVByb3BzKSB7XG4gIHZhciBfYTtcbiAgY29uc3QgeyB0aW1lem9uZSwgYW5hbHl6ZVJlc3VsdHMsIHR5cGUsIGZpZWxkTWFwcGluZ3MsIGRhdGFMYXllciwgaWQsIHVpZFBhaXIsIGFkZEFwcGVuZFNlbGVjdE9wdGlvbiwgc291cmNlRGF0YUxheWVyIH0gPSBhZGRJdGVtUHJvcHM7XG4gIGxldCBmaW5hbEFwcGVuZFBhcmFtZXRlcnMsIGFwcGVuZFNvdXJjZUluZm87XG4gIGNvbnN0IHsgcHVibGlzaFBhcmFtZXRlcnMgfSA9IGFuYWx5emVSZXN1bHRzLCByZXN0ID0gX19yZXN0KGFuYWx5emVSZXN1bHRzLCBbXCJwdWJsaXNoUGFyYW1ldGVyc1wiXSk7XG4gIGNvbnN0IHVwc2VydCA9IGFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJ1cHNlcnRcIiB8fCBhZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwidXBkYXRlXCI7XG4gIGNvbnN0IGZpbmFsRmllbGRNYXBwaW5ncyA9IGZvcm1hdEZpZWxkTWFwcGluZ3MoZmllbGRNYXBwaW5ncyk7XG4gIGNvbnN0IGFwcGVuZEZpZWxkcyA9IGNyZWF0ZUFwcGVuZEZpZWxkcyhmaW5hbEZpZWxkTWFwcGluZ3MpO1xuICBjb25zdCB0aW1lem9uZUluZm8gPSB7XG4gICAgZGF0ZUZpZWxkc1RpbWVSZWZlcmVuY2U6IHtcbiAgICAgIHRpbWVab25lOiB0aW1lem9uZSB8fCBcIlVUQ1wiLFxuICAgICAgcmVzcGVjdHNEYXlsaWdodFNhdmluZzogdHJ1ZVxuICAgIH1cbiAgfTtcbiAgY29uc3QgZGVmYXVsdEFwcGVuZFBhcmFtcyA9IHtcbiAgICBzb3VyY2VUYWJsZU5hbWU6IGRhdGFMYXllci5uYW1lLFxuICAgIGZpZWxkTWFwcGluZ3M6IChmaW5hbEZpZWxkTWFwcGluZ3MgPT09IG51bGwgfHwgZmluYWxGaWVsZE1hcHBpbmdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaW5hbEZpZWxkTWFwcGluZ3MubGVuZ3RoKSA/IEpTT04uc3RyaW5naWZ5KGZpbmFsRmllbGRNYXBwaW5ncykgOiBudWxsLFxuICAgIHVwc2VydCxcbiAgICBza2lwSW5zZXJ0czogYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcInVwZGF0ZVwiLFxuICAgIHNraXBVcGRhdGVzOiBmYWxzZSxcbiAgICB1c2VHbG9iYWxJZHM6IHVwc2VydCAmJiAodWlkUGFpciA9PT0gbnVsbCB8fCB1aWRQYWlyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1aWRQYWlyLnR5cGUpID09PSBcImVzcmlGaWVsZFR5cGVHbG9iYWxJRFwiLFxuICAgIHVwZGF0ZUdlb21ldHJ5OiB1cHNlcnQgPyBhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0VXBkYXRlVHlwZU9wdGlvbiA9PT0gXCJhdHRyaWJ1dGVBbmRHZW9tZXRyeVwiIDogdHJ1ZSxcbiAgICBhcHBlbmRGaWVsZHM6IGFwcGVuZEZpZWxkcy5sZW5ndGggPyBKU09OLnN0cmluZ2lmeShhcHBlbmRGaWVsZHMpIDogbnVsbCxcbiAgICBhcHBlbmRJdGVtSWQ6IGlkLFxuICAgIGFwcGVuZFVwbG9hZEZvcm1hdDogYWRkQ3JlYXRlSXRlbVR5cGVzW2FkZEl0ZW1TdGF0ZS50eXBlXS5hcHBlbmRVcGxvYWRGb3JtYXQsXG4gICAgcm9sbGJhY2tPbkZhaWx1cmU6IHRydWVcbiAgfTtcbiAgY29uc3QgcHVibGlzaEluZm8gPSBfX3Jlc3QocHVibGlzaFBhcmFtZXRlcnMsIFtcImxheWVyc1wiXSk7XG4gIGlmICh0eXBlID09PSBcIkNTVlwiKSB7XG4gICAgcHVibGlzaFBhcmFtZXRlcnMubGF5ZXJJbmZvLmRhdGVGaWVsZHNUaW1lUmVmZXJlbmNlID0gdGltZXpvbmVJbmZvLmRhdGVGaWVsZHNUaW1lUmVmZXJlbmNlO1xuICAgIGFwcGVuZFNvdXJjZUluZm8gPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGltZXpvbmVJbmZvKSwgcHVibGlzaFBhcmFtZXRlcnMpLCByZXN0KTtcbiAgfVxuICBlbHNlIGlmICh0eXBlID09PSBcIk1pY3Jvc29mdCBFeGNlbFwiKSB7XG4gICAgY29uc3QgbGF5ZXJJbmZvID0gZ2V0QW5hbHl6ZWRMYXllckluZm8oe30sIHRydWUpO1xuICAgIGNvbnN0IGZvcm1hdHRlZExheWVySW5mbyA9IGdldExheWVyVG9BcHBlbmQobGF5ZXJJbmZvLCBwdWJsaXNoSW5mbyk7IC8vVXBkYXRlZCBpbmZvIG5lZWRzIHRvIGJlIGFkZGVkIHRvIHRoZSBsYXllcnMgW10gcmF0aGVyIHRoYW4gdGhlIHJvb3QgZm9yIGV4Y2VsXG4gICAgZm9ybWF0dGVkTGF5ZXJJbmZvLmRhdGVGaWVsZHNUaW1lUmVmZXJlbmNlID0gdGltZXpvbmVJbmZvLmRhdGVGaWVsZHNUaW1lUmVmZXJlbmNlO1xuICAgIHB1Ymxpc2hJbmZvLm5hbWUgPSBkYXRhTGF5ZXIubmFtZTtcbiAgICBhcHBlbmRTb3VyY2VJbmZvID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGltZXpvbmVJbmZvKSwgeyBsYXllcnM6IFtmb3JtYXR0ZWRMYXllckluZm9dIH0pLCBwdWJsaXNoSW5mbyksIHJlc3QpO1xuICB9XG4gIGVsc2Uge1xuICAgIGFwcGVuZFNvdXJjZUluZm8gPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGltZXpvbmVJbmZvKSwgcHVibGlzaFBhcmFtZXRlcnMpLCByZXN0KTtcbiAgfVxuICBmaW5hbEFwcGVuZFBhcmFtZXRlcnMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRBcHBlbmRQYXJhbXMpLCB7IGFwcGVuZFNvdXJjZUluZm86IEpTT04uc3RyaW5naWZ5KGFwcGVuZFNvdXJjZUluZm8pIH0pO1xuICBpZiAoYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcImFkZFwiKSB7XG4gICAgZmluYWxBcHBlbmRQYXJhbWV0ZXJzLnVwc2VydE1hdGNoaW5nRmllbGQgPSBzb3VyY2VEYXRhTGF5ZXIub2JqZWN0SWRGaWVsZCB8fCAoKF9hID0gc291cmNlRGF0YUxheWVyLnVuaXF1ZUZpZWxkKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubmFtZSk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYgKHVwc2VydCAmJiAodWlkUGFpciA9PT0gbnVsbCB8fCB1aWRQYWlyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1aWRQYWlyLmlzVW5pcXVlSW5kZXgpKSB7XG4gICAgICBmaW5hbEFwcGVuZFBhcmFtZXRlcnMudXBzZXJ0TWF0Y2hpbmdGaWVsZCA9IHVpZFBhaXIgPT09IG51bGwgfHwgdWlkUGFpciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdWlkUGFpci5uYW1lO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmluYWxBcHBlbmRQYXJhbWV0ZXJzO1xufVxuZnVuY3Rpb24gZ2V0TGF5ZXJUb0FwcGVuZChsYXllckluZm8sIHVwZGF0ZWRJbmZvKSB7XG4gIGNvbnN0IGZvcm1hdHRlZExheWVyID0gT2JqZWN0LmFzc2lnbih7fSwgbGF5ZXJJbmZvKTtcbiAgZm9ybWF0dGVkTGF5ZXIubG9jYXRpb25UeXBlID0gdXBkYXRlZEluZm8ubG9jYXRpb25UeXBlO1xuICBpZiAoZm9ybWF0dGVkTGF5ZXIubG9jYXRpb25UeXBlID09PSBcImFkZHJlc3NcIikge1xuICAgIGZvcm1hdHRlZExheWVyLmFkZHJlc3NGaWVsZHMgPSB1cGRhdGVkSW5mby5hZGRyZXNzRmllbGRzO1xuICAgIGZvcm1hdHRlZExheWVyLnNvdXJjZUNvdW50cnkgPSB1cGRhdGVkSW5mby5zb3VyY2VDb3VudHJ5O1xuICB9XG4gIGVsc2UgaWYgKGZvcm1hdHRlZExheWVyLmxvY2F0aW9uVHlwZSA9PT0gXCJjb29yZGluYXRlc1wiKSB7XG4gICAgZm9ybWF0dGVkTGF5ZXIuY29vcmRpbmF0ZUZpZWxkVHlwZSA9IHVwZGF0ZWRJbmZvLmNvb3JkaW5hdGVGaWVsZFR5cGU7XG4gICAgaWYgKGZvcm1hdHRlZExheWVyLmNvb3JkaW5hdGVGaWVsZFR5cGUgPT09IFwiTGF0aXR1ZGVBbmRMb25naXR1ZGVcIikge1xuICAgICAgZm9ybWF0dGVkTGF5ZXIubGF0aXR1ZGVGaWVsZE5hbWUgPSB1cGRhdGVkSW5mby5sYXRpdHVkZUZpZWxkTmFtZTtcbiAgICAgIGZvcm1hdHRlZExheWVyLmxvbmdpdHVkZUZpZWxkTmFtZSA9IHVwZGF0ZWRJbmZvLmxvbmdpdHVkZUZpZWxkTmFtZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBmb3JtYXR0ZWRMYXllci5jb29yZGluYXRlRmllbGROYW1lID0gdXBkYXRlZEluZm8uY29vcmRpbmF0ZUZpZWxkTmFtZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZvcm1hdHRlZExheWVyO1xufVxuZnVuY3Rpb24gZm9ybWF0RmllbGRNYXBwaW5ncyhmaWVsZE1hcHBpbmdzKSB7XG4gIGNvbnN0IGZpZWxkcyA9IGZpZWxkTWFwcGluZ3MuZmlsdGVyKChmaWVsZE1hcHBpbmcpID0+IHtcbiAgICByZXR1cm4gZmllbGRNYXBwaW5nLnNvdXJjZSAhPT0gTk9ORV9WQUxVRTtcbiAgfSk7XG4gIGNvbnN0IGZpbmFsRmllbGRNYXBwaW5ncyA9IGZpZWxkcy5tYXAoKHsgc291cmNlLCBuYW1lIH0pID0+IHtcbiAgICByZXR1cm4geyBzb3VyY2UsIG5hbWUgfTtcbiAgfSk7XG4gIHJldHVybiBmaW5hbEZpZWxkTWFwcGluZ3M7XG59XG5mdW5jdGlvbiBjcmVhdGVBcHBlbmRGaWVsZHMoZmllbGRNYXBwaW5ncykge1xuICBjb25zdCBhcHBlbmRGaWVsZHMgPSBmaWVsZE1hcHBpbmdzLm1hcCgobWFwcGluZykgPT4ge1xuICAgIHJldHVybiBtYXBwaW5nLm5hbWU7XG4gIH0pO1xuICByZXR1cm4gYXBwZW5kRmllbGRzO1xufVxuXG5leHBvcnQgeyBjYW5NYXRjaEZpZWxkIGFzIGMsIGdldEFwcGVuZFBhcmFtZXRlcnMgYXMgZyB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIEggYXMgSG9zdCwgZCBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC05MmViYjM5Ni5qcyc7XG5pbXBvcnQgeyBhIGFzIGFwcGVuZCB9IGZyb20gJy4vYXBwZW5kLTM1MjA4M2ZkLmpzJztcbmltcG9ydCB7IGIgYXMgdXBkYXRlSXRlbU92ZXJ3cml0ZSB9IGZyb20gJy4vb3ZlcndyaXRlLTMwNDliN2FmLmpzJztcbmltcG9ydCB7IGQgYXMgZGVsZXRlSXRlbSB9IGZyb20gJy4vc2VydmVyLWl0ZW0tZjEyMTUzZTYuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRJdGVtU3RhdGUgfSBmcm9tICcuL2FkZC1pdGVtLTk3ZDU3N2E5LmpzJztcbmltcG9ydCB7IHUgYXMgdWlTdG9yZVN0YXRlIH0gZnJvbSAnLi91aS1lY2Y4NmJiYS5qcyc7XG5pbXBvcnQgeyB2IGFzIHZlcmlmeUdlb21ldHJpZXMgfSBmcm9tICcuL2dlb21ldHJpZXMtZjI5NWFmM2EuanMnO1xuaW1wb3J0ICcuL3BvcnRhbC03OWNhYWVmZi5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYWFmMzBiZDYuanMnO1xuaW1wb3J0ICcuL2NvbmZpZy1lYjVmN2RjMi5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtODFkNTQ4YjcuanMnO1xuaW1wb3J0ICcuL3ByaXZpbGVnZXMtY2NkNWYzN2QuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtYzgyZjVhYjkuanMnO1xuaW1wb3J0ICcuL2FwcGVuZC02M2M1Y2U4My5qcyc7XG5pbXBvcnQgJy4vYXBwZW5kLTU4YTdlN2FiLmpzJztcbmltcG9ydCAnLi9nZW9jb2RlLTdlYjdjMGRmLmpzJztcbmltcG9ydCAnLi9wcml2aWxlZ2VzLTM1NTkwZWI0LmpzJztcbmltcG9ydCAnLi9pdGVtLXR5cGVzLWI0ZmU4NmFkLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTM4Y2RhZTg3LmpzJztcbmltcG9ydCAnLi9pdGVtLXByb3BlcnRpZXMtZTY0MTJhOWEuanMnO1xuaW1wb3J0ICcuL2ZlYXR1cmUtbGF5ZXItZDMzZWExMTQuanMnO1xuaW1wb3J0ICcuL2d1aWQtNGY0MTc2YmEuanMnO1xuaW1wb3J0ICcuL3RodW1ibmFpbC0wYjdhZGZjZC5qcyc7XG5pbXBvcnQgJy4vcXVlcnktNGY3YjdlNGQuanMnO1xuaW1wb3J0ICcuL3VzZXItZTNkZWRjNGEuanMnO1xuaW1wb3J0ICcuL2FwaS1mNzkzNGNkNy5qcyc7XG5pbXBvcnQgJy4vaXRlbS1kOWQ3MDQxNi5qcyc7XG5pbXBvcnQgJy4vZG9tLTEzZjViMDBjLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTY5MzA1YTg1LmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTlmNjQ4YmVlLmpzJztcbmltcG9ydCAnLi9hZ3MtNjhkNGFlMjAuanMnO1xuaW1wb3J0ICcuL3VybC1mM2I4MmNjNy5qcyc7XG5pbXBvcnQgJy4vc3RvcmFnZS1kN2Y1ODIyZS5qcyc7XG5pbXBvcnQgJy4vZmlsZS1mMzYxOTNlOS5qcyc7XG5pbXBvcnQgJy4vc3RvcmUtMzIxMGI2MDQuanMnO1xuaW1wb3J0ICcuL3B1Ymxpc2gtaXRlbS04MmZmYTdmOC5qcyc7XG5pbXBvcnQgJy4vdGlsZS1sYXllci05MGE2YjkwMS5qcyc7XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZFNlbGVjdFVwZGF0ZUNzcyA9IFwiLnRpbGUtc2VsZWN0e21hcmdpbi10b3A6MS4yNXJlbX0ubmVlZC1nZW9tZXRyaWVzLW5vdGljZXttYXJnaW4tdG9wOjEuNXJlbX1cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kU2VsZWN0VXBkYXRlID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLndvcmtmbG93Q29tcGxldGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcIndvcmtmbG93Q29tcGxldGVcIiwgNyk7XG4gICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZFwiLCA3KTtcbiAgICB0aGlzLm5ld0l0ZW1EaXNhYmxlQ2xvc2VCdXR0b25zID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtRGlzYWJsZUNsb3NlQnV0dG9uc1wiLCA3KTtcbiAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVXBkYXRlUGFnZVwiLCA3KTtcbiAgICB0aGlzLm5ld0l0ZW1QcmV2UGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVByZXZQYWdlXCIsIDcpO1xuICAgIHRoaXMuYXBwZW5kT3B0aW9ucyA9IHtcbiAgICAgIGF0dHJpYnV0ZToge1xuICAgICAgICBpY29uOiBcInRhYmxlXCIsXG4gICAgICAgIHVwZGF0ZUdlb21ldHJ5OiBmYWxzZVxuICAgICAgfSxcbiAgICAgIGF0dHJpYnV0ZUFuZEdlb21ldHJ5OiB7XG4gICAgICAgIGljb246IFwibXVsdGlwbGUtdmFyaWFibGVzXCIsXG4gICAgICAgIHVwZGF0ZUdlb21ldHJ5OiB0cnVlXG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLnVwZGF0ZU9wdGlvbnMgPSB7XG4gICAgICB1cGxvYWRlZDoge1xuICAgICAgICBpY29uOiBcInVwbG9hZC10b1wiLFxuICAgICAgICBrZWVwRGVzY3JpcHRpb246IGZhbHNlXG4gICAgICB9LFxuICAgICAgZXhpc3Rpbmc6IHtcbiAgICAgICAgaWNvbjogXCJmZWF0dXJlLWRldGFpbHNcIixcbiAgICAgICAga2VlcERlc2NyaXB0aW9uOiB0cnVlXG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLm5vdGljZU1lc3NhZ2UgPSBudWxsO1xuICAgIHRoaXMuc2VsZWN0ZWQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jYW5ub3RVcGRhdGVHZW9tZXRyeSA9IGZhbHNlO1xuICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgIHRoaXMubG9hZGVyVHlwZSA9IFwiaW5kZXRlcm1pbmF0ZVwiO1xuICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmVycm9yID0gdW5kZWZpbmVkO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHZhciBfYTtcbiAgICB0aGlzLnNlbGVjdGVkID0gdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcImFwcGVuZFwiID8gXCJhdHRyaWJ1dGVcIiA6IFwidXBsb2FkZWRcIjtcbiAgICB0aGlzLmkxOG4gPSB1aVN0b3JlU3RhdGUuaTE4bi5hcHBlbmRTZWxlY3RVcGRhdGVUeXBlO1xuICAgIGlmICh1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwiYXBwZW5kXCIpIHtcbiAgICAgIChfYSA9IHRoaXMubm90aWNlTWVzc2FnZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKHRoaXMubm90aWNlTWVzc2FnZSA9IHZlcmlmeUdlb21ldHJpZXMoe1xuICAgICAgICBkYXRhTGF5ZXI6IGFkZEl0ZW1TdGF0ZS5kYXRhTGF5ZXIsXG4gICAgICAgIHR5cGU6IGFkZEl0ZW1TdGF0ZS50eXBlLFxuICAgICAgICBzb3VyY2VEYXRhTGF5ZXI6IGFkZEl0ZW1TdGF0ZS5zb3VyY2VEYXRhTGF5ZXJcbiAgICAgIH0pKTtcbiAgICAgIHRoaXMuY2Fubm90VXBkYXRlR2VvbWV0cnkgPSAhIXRoaXMubm90aWNlTWVzc2FnZTtcbiAgICB9XG4gICAgdWlTdG9yZVN0YXRlLm5leHRUZXh0ID0gXCJ1cGRhdGVBcHBlbmRcIjtcbiAgfVxuICBhc3luYyBoYW5kbGVOZXh0KCkge1xuICAgIGNvbnN0IHNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZDtcbiAgICBpZiAodWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcInVwZGF0ZVwiKSB7XG4gICAgICBhZGRJdGVtU3RhdGUuYWRkVXBkYXRlSXRlbVByb3BlcnRpZXNPcHRpb24gPSBzZWxlY3RlZDtcbiAgICAgIGNvbnN0IGtlZXBEZXNjcmlwdGlvbiA9IHNlbGVjdGVkID09PSBcInVwbG9hZGVkXCIgPyB0cnVlIDogZmFsc2U7XG4gICAgICBhZGRJdGVtU3RhdGUua2VlcERlc2NyaXB0aW9uID0ga2VlcERlc2NyaXB0aW9uO1xuICAgICAgdGhpcy5oYW5kbGVVcGRhdGUoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0VXBkYXRlVHlwZU9wdGlvbiA9IHNlbGVjdGVkO1xuICAgICAgdGhpcy5oYW5kbGVBcHBlbmQoKTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgaGFuZGxlUHJldihldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgIXRoaXMubG9hZGluZyAmJiB0aGlzLm5ld0l0ZW1QcmV2UGFnZS5lbWl0KCk7XG4gIH1cbiAgYXN5bmMgaGFuZGxlVXBkYXRlKCkge1xuICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgdGhpcy5sb2FkZXJNZXNzYWdlID0gdWlTdG9yZVN0YXRlLmkxOG4uYXBwZW5kLmFwcGVuZExvYWRpbmdNZXNzYWdlcy51cGRhdGluZztcbiAgICBjb25zdCB7IGZpbGUsIG92ZXJ3cml0ZSwga2VlcERlc2NyaXB0aW9uLCBleGlzdGluZ0l0ZW0gfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHVwZGF0ZUl0ZW1PdmVyd3JpdGUoZXhpc3RpbmdJdGVtLCBleGlzdGluZ0l0ZW0uaXRlbU93bmVyLnVzZXJDb250ZW50VXJsLCAvLyAhIFVzZSBmZXRjaFVzZXIgaWYgaXRlbU93bmVyIGlzIG5vdCBhdmFpbGFibGVcbiAgICB7IGZpbGUsIG92ZXJ3cml0ZSwga2VlcERlc2NyaXB0aW9uIH0pO1xuICAgIGlmICghcmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICB0aGlzLmVycm9yID0ge1xuICAgICAgICB0aXRsZTogdWlTdG9yZVN0YXRlLmkxOG4uZXJyb3IsXG4gICAgICAgIGRlc2NyaXB0aW9uOiB1aVN0b3JlU3RhdGUuaTE4bi5hcHBlbmRPdmVyd3JpdGUuZXJyb3JzLmVycm9yV2hpbGVVcGRhdGVcbiAgICAgIH07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlLmVtaXQoe1xuICAgICAgICBzdWNjZXNzOiByZXNwb25zZS5zdWNjZXNzXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgZGlzYWJsZU1vZGFsQnV0dG9ucyhkaXNhYmxlKSB7XG4gICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdCghZGlzYWJsZSk7XG4gICAgdGhpcy5uZXdJdGVtRGlzYWJsZUNsb3NlQnV0dG9ucy5lbWl0KGRpc2FibGUpO1xuICB9XG4gIGFzeW5jIGhhbmRsZUFwcGVuZCgpIHtcbiAgICB2YXIgX2E7XG4gICAgdGhpcy5kaXNhYmxlTW9kYWxCdXR0b25zKHRydWUpO1xuICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgdGhpcy5sb2FkZXJNZXNzYWdlID0gdWlTdG9yZVN0YXRlLmkxOG4uYXBwZW5kLmFwcGVuZExvYWRpbmdNZXNzYWdlcy5hcHBlbmRDbG9zZU5vdGljZTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFwcGVuZCh7XG4gICAgICBzb3VyY2VEYXRhTGF5ZXI6IGFkZEl0ZW1TdGF0ZS5zb3VyY2VEYXRhTGF5ZXIsXG4gICAgICBleGlzdGluZ0l0ZW06IGFkZEl0ZW1TdGF0ZS5leGlzdGluZ0l0ZW0sXG4gICAgICB0aW1lem9uZTogYWRkSXRlbVN0YXRlLnRpbWV6b25lLFxuICAgICAgYW5hbHl6ZVJlc3VsdHM6IGFkZEl0ZW1TdGF0ZS5hbmFseXplUmVzdWx0cyxcbiAgICAgIHR5cGU6IGFkZEl0ZW1TdGF0ZS50eXBlLFxuICAgICAgZmllbGRNYXBwaW5nczogYWRkSXRlbVN0YXRlLmZpZWxkTWFwcGluZ3MsXG4gICAgICBkYXRhTGF5ZXI6IGFkZEl0ZW1TdGF0ZS5kYXRhTGF5ZXIsXG4gICAgICBpZDogYWRkSXRlbVN0YXRlLmlkLFxuICAgICAgdWlkUGFpcjogYWRkSXRlbVN0YXRlLnVpZFBhaXIsXG4gICAgICBhZGRBcHBlbmRTZWxlY3RPcHRpb246IGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb25cbiAgICB9KTtcbiAgICBpZiAoKChfYSA9IHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5yZXN1bHQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0dXMudG9Mb3dlckNhc2UoKSkgPT09IFwiY29tcGxldGVkXCIpIHtcbiAgICAgIGF3YWl0IGRlbGV0ZUl0ZW0oYWRkSXRlbVN0YXRlLmlkLCB7IHBlcm1hbmVudERlbGV0ZTogdHJ1ZSB9KTtcbiAgICAgIGNvbnN0IGVtaXRQYXlsb2FkID0gT2JqZWN0LmFzc2lnbih7IGFwcGVuZFR5cGU6IGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gfSwgcmVzcG9uc2UpO1xuICAgICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlLmVtaXQoZW1pdFBheWxvYWQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuZGlzYWJsZU1vZGFsQnV0dG9ucyhmYWxzZSk7XG4gICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMuZXJyb3IgPSB7XG4gICAgICAgIHRpdGxlOiB1aVN0b3JlU3RhdGUuaTE4bi5lcnJvcixcbiAgICAgICAgZGVzY3JpcHRpb246IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZC5hcHBlbmRFcnJvck1lc3NhZ2VzLmFwcGVuZEVycm9yXG4gICAgICB9O1xuICAgIH1cbiAgfVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBpMThuLCBhcHBlbmRPcHRpb25zLCB1cGRhdGVPcHRpb25zLCBub3RpY2VNZXNzYWdlLCBlcnJvciB9ID0gdGhpcztcbiAgICBsZXQgb3B0aW9ucyA9IGFwcGVuZE9wdGlvbnM7XG4gICAgbGV0IGhlYWRlciA9IGkxOG4uaGVhZGVyO1xuICAgIGxldCBvcHRpb25zU3RyaW5nID0gXCJhcHBlbmRPcHRpb25zXCI7XG4gICAgaWYgKHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJ1cGRhdGVcIikge1xuICAgICAgb3B0aW9ucyA9IHVwZGF0ZU9wdGlvbnM7XG4gICAgICBoZWFkZXIgPSBpMThuLml0ZW1Qcm9wZXJ0aWVzSGVhZGVyO1xuICAgICAgb3B0aW9uc1N0cmluZyA9IFwidXBkYXRlT3B0aW9uc1wiO1xuICAgIH1cbiAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogeyBcIm92ZXJmbG93LWhpZGRlblwiOiB0aGlzLmxvYWRpbmcgfSB9LCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWRlc2NyaXB0aW9uXCIsIHsgaGVhZGVyOiBoZWFkZXIgfSksIGgoXCJjYWxjaXRlLXRpbGUtc2VsZWN0LWdyb3VwXCIsIHsgbGF5b3V0OiBcInZlcnRpY2FsXCIsIGNsYXNzOiBcInRpbGUtc2VsZWN0XCIgfSwgT2JqZWN0LmtleXMob3B0aW9ucykubWFwKChrZXkpID0+IHtcbiAgICAgIGNvbnN0IHsgaWNvbiB9ID0gb3B0aW9uc1trZXldO1xuICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS10aWxlLXNlbGVjdFwiLCB7IGtleToga2V5LCBjaGVja2VkOiB0aGlzLnNlbGVjdGVkID09PSBrZXksIGhlYWRpbmc6IGkxOG5bb3B0aW9uc1N0cmluZ11ba2V5XS50aXRsZSwgZGVzY3JpcHRpb246IGkxOG5bb3B0aW9uc1N0cmluZ11ba2V5XS5kZXNjcmlwdGlvbiwgaWNvbjogaWNvbiwgbmFtZTogXCJmZWF0dXJlLWxheWVyLWNyZWF0ZS1tb2RlXCIsIFwiaW5wdXQtZW5hYmxlZFwiOiB0cnVlLCB3aWR0aDogXCJmdWxsXCIsIHR5cGU6IFwicmFkaW9cIiwgdmFsdWU6IGtleSwgZGlzYWJsZWQ6IGtleSA9PT0gXCJhdHRyaWJ1dGVBbmRHZW9tZXRyeVwiICYmIHRoaXMuY2Fubm90VXBkYXRlR2VvbWV0cnksIG9uQ2FsY2l0ZVRpbGVTZWxlY3RDaGFuZ2U6IChlKSA9PiB7XG4gICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICB9IH0pKTtcbiAgICB9KSksIHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJhcHBlbmRcIiAmJiB0aGlzLmNhbm5vdFVwZGF0ZUdlb21ldHJ5ICYmIChoKFwiY2FsY2l0ZS1ub3RpY2VcIiwgeyBjbGFzczogXCJuZWVkLWdlb21ldHJpZXMtbm90aWNlXCIsIG9wZW46IHRydWUsIGljb246IFwibGlnaHRidWxiXCIgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwidGl0bGVcIiB9LCBpMThuW25vdGljZU1lc3NhZ2UudGl0bGVdKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwibWVzc2FnZVwiIH0sIGkxOG5bbm90aWNlTWVzc2FnZS5kZXNjcmlwdGlvbl0pKSksIGgoXCJhcmNnaXMtbmV3LWl0ZW0tbG9hZGVyXCIsIHsgdHlwZTogdGhpcy5sb2FkZXJUeXBlLCBhY3RpdmU6IHRoaXMubG9hZGluZywgdGV4dDogdGhpcy5sb2FkZXJNZXNzYWdlIH0pLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWFsZXJ0XCIsIHsgaGVhZGluZzogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLnRpdGxlLCBkZXNjcmlwdGlvbjogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmRlc2NyaXB0aW9uLCBsaW5rOiB7IGhyZWY6IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5saW5rLCB0aXRsZTogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmxpbmtUZXh0IH0sIGFjdGl2ZTogISFlcnJvciwgb25BbGVydERpc21pc3M6ICgpID0+ICh0aGlzLmVycm9yID0gbnVsbCkgfSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kU2VsZWN0VXBkYXRlLnN0eWxlID0gYXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kU2VsZWN0VXBkYXRlQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNOZXdJdGVtUGFnZXNBcHBlbmRTZWxlY3RVcGRhdGUgYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX2FwcGVuZF9zZWxlY3RfdXBkYXRlIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmZ1bmN0aW9uIHZlcmlmeUdlb21ldHJpZXMoYXJncykge1xuICB2YXIgX2EsIF9iO1xuICBjb25zdCB7IGRhdGFMYXllciwgdHlwZSwgc291cmNlRGF0YUxheWVyIH0gPSBhcmdzO1xuICBjb25zdCBkYXRhTGF5ZXJHZW9tZXRyeSA9IChfYSA9IGRhdGFMYXllciA9PT0gbnVsbCB8fCBkYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGFMYXllci5nZW9tZXRyeVR5cGUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYiA9IGRhdGFMYXllciA9PT0gbnVsbCB8fCBkYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGFMYXllci5sYXllckluZm8pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5nZW9tZXRyeVR5cGU7XG4gIGlmICh0eXBlID09PSBcIk1pY3Jvc29mdCBFeGNlbFwiIHx8IHR5cGUgPT09IFwiQ1NWXCIpIHtcbiAgICBpZiAoKChkYXRhTGF5ZXIubG9jYXRpb25UeXBlID09PSBcImFkZHJlc3NcIiAmJiBkYXRhTGF5ZXIuYWRkcmVzc0ZpZWxkcykgfHwgZGF0YUxheWVyLmxvY2F0aW9uVHlwZSA9PT0gXCJjb29yZGluYXRlc1wiKSAmJiAvL2NoZWNrIGxvY2F0aW9uIHR5cGUgaXMgYWRkcmVzcyBpbiBjYXNlIFwibm9uZVwiIGlzIHNlbGVjdGVkIGFuZCBhZGRyZXNzRmllbGRzIGxpbmdlclxuICAgICAgKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci5nZW9tZXRyeVR5cGUpID09PSBcImVzcmlHZW9tZXRyeVBvaW50XCIpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBlbHNlIGlmICghZGF0YUxheWVyR2VvbWV0cnkgfHwgZGF0YUxheWVyLmxvY2F0aW9uVHlwZSA9PT0gXCJub25lXCIgfHwgKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci50eXBlKSA9PT0gXCJUYWJsZVwiKSB7XG4gICAgICByZXR1cm4geyB0aXRsZTogXCJub0dlb21ldHJ5TWF0Y2hUaXRsZVwiLCBkZXNjcmlwdGlvbjogXCJub0dlb21ldHJ5VGFibGVNZXNzYWdlXCIgfTtcbiAgICB9XG4gICAgZWxzZSBpZiAoKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci5nZW9tZXRyeVR5cGUpICE9PSBkYXRhTGF5ZXJHZW9tZXRyeSkge1xuICAgICAgcmV0dXJuIHsgdGl0bGU6IFwibm9HZW9tZXRyeU1hdGNoVGl0bGVcIiwgZGVzY3JpcHRpb246IFwibm9HZW9tZXRyeU1hdGNoTWVzc2FnZVwiIH07XG4gICAgfVxuICB9XG4gIGVsc2Uge1xuICAgIGlmICgoc291cmNlRGF0YUxheWVyID09PSBudWxsIHx8IHNvdXJjZURhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlRGF0YUxheWVyLmdlb21ldHJ5VHlwZSkgIT09IChkYXRhTGF5ZXIgPT09IG51bGwgfHwgZGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhTGF5ZXIuZ2VvbWV0cnlUeXBlKSkge1xuICAgICAgcmV0dXJuIHsgdGl0bGU6IFwibm9HZW9tZXRyeU1hdGNoVGl0bGVcIiwgZGVzY3JpcHRpb246IFwibm9HZW9tZXRyeU1hdGNoTWVzc2FnZVwiIH07XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBjaGVja0NvbXBhdGlibGVHZW9tZXRyaWVzKGRhdGFMYXllciwgc291cmNlRGF0YUxheWVyLCB0eXBlKSB7XG4gIGlmICh0eXBlID09PSBcIk1pY3Jvc29mdCBFeGNlbFwiIHx8IHR5cGUgPT09IFwiQ1NWXCIpIHtcbiAgICBpZiAoKChzb3VyY2VEYXRhTGF5ZXIgPT09IG51bGwgfHwgc291cmNlRGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzb3VyY2VEYXRhTGF5ZXIuZ2VvbWV0cnlUeXBlKSA9PT0gXCJlc3JpR2VvbWV0cnlQb2ludFwiIHx8IChzb3VyY2VEYXRhTGF5ZXIgPT09IG51bGwgfHwgc291cmNlRGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzb3VyY2VEYXRhTGF5ZXIudHlwZSkgPT09IFwiVGFibGVcIikgJiZcbiAgICAgIChkYXRhTGF5ZXIgPT09IG51bGwgfHwgZGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhTGF5ZXIubG9jYXRpb25UeXBlKSA9PT0gXCJub25lXCIpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci5nZW9tZXRyeVR5cGUpID09PSBcImVzcmlHZW9tZXRyeVBvaW50XCIpIHtcbiAgICAgIHJldHVybiAhIWRhdGFMYXllci5hZGRyZXNzRmllbGRzIHx8IGRhdGFMYXllci5sb2NhdGlvblR5cGUgIT09IFwibm9uZVwiO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZWxzZSB7XG4gICAgcmV0dXJuIChzb3VyY2VEYXRhTGF5ZXIgPT09IG51bGwgfHwgc291cmNlRGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzb3VyY2VEYXRhTGF5ZXIudHlwZSkgPT09IFwiVGFibGVcIiB8fCAoZGF0YUxheWVyID09PSBudWxsIHx8IGRhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YUxheWVyLmdlb21ldHJ5VHlwZSkgPT09IChzb3VyY2VEYXRhTGF5ZXIgPT09IG51bGwgfHwgc291cmNlRGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzb3VyY2VEYXRhTGF5ZXIuZ2VvbWV0cnlUeXBlKTtcbiAgfVxufVxuXG5leHBvcnQgeyBjaGVja0NvbXBhdGlibGVHZW9tZXRyaWVzIGFzIGMsIHZlcmlmeUdlb21ldHJpZXMgYXMgdiB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9