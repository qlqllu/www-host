"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-8f1989"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-table_3.entry.js":
/*!*****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-table_3.entry.js ***!
  \*****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_table: () => (/* binding */ ArcgisTable),
/* harmony export */   arcgis_table_column_info: () => (/* binding */ ArcgisTableColumnInfo),
/* harmony export */   arcgis_table_field_selection: () => (/* binding */ ArcgisTableFieldSelection)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _basic_ee9c674c_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./basic-ee9c674c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/basic-ee9c674c.js");
/* harmony import */ var _commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./commonFunctions-5262b094.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-5262b094.js");
/* harmony import */ var _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./commonEnums-f98a323c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-f98a323c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */









const CSS$2 = {
  host: "host",
  content: "content",
  manager: "manager",
  actionBar: "action-bar",
  menuActions: "menu-actions",
  table: "table",
  tooltip: "tooltip"
};

/**
 * Returns true if the layer supports attachments
 * @param layer - FeatureLayer
 */
function hasAttachmentsEnabled(layer) {
  if (!(layer === null || layer === void 0 ? void 0 : layer.capabilities)) {
    return false;
  }
  const { capabilities: { data: { supportsAttachment }, operations: { supportsQueryAttachments } } } = layer;
  return supportsAttachment && supportsQueryAttachments;
}
/**
 * Returns the layer type, and "sublayer" for Sublayer
 * @param layer - FeatureLayer
 */
function getLayerType(layer) {
  if (layer.declaredClass === "esri.layers.support.Sublayer") {
    return "sublayer";
  }
  else {
    return (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_4__.c)(layer);
  }
}

/**
 * gives the parameters for identify
 * @param extent - extent at which the identify should be done
 * @param map - map object
 * @param layer - the layer on which identify should perform
 */
async function getIdentifyParams(extent, map, layer) {
  const [Polygon, Point, ImageIdentifyParameters] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_2__.l)([
    "esri/geometry/Polygon",
    "esri/geometry/Point",
    "esri/rest/support/ImageIdentifyParameters"
  ]);
  const polygon = new Polygon(extent.spatialReference);
  polygon.addRing([
    [extent.xmin, extent.ymin],
    [extent.xmin, extent.ymax],
    [extent.xmax, extent.ymax],
    [extent.xmax, extent.ymin],
    [extent.xmin, extent.ymin]
  ]);
  const psX = (extent.xmax - extent.xmin) / map.width;
  const psY = (extent.ymax - extent.ymin) / map.height;
  const psSR = extent.spatialReference;
  const pixelSize = new Point(psX, psY, psSR);
  // Generate Task Params
  const taskParams = new ImageIdentifyParameters();
  taskParams.geometry = polygon;
  taskParams.returnGeometry = true;
  taskParams.pixelSize = pixelSize;
  const mosaicRule = layer.mosaicRule.clone();
  if (layer.definitionExpression) {
    mosaicRule.where = layer.definitionExpression;
  }
  taskParams.mosaicRule = mosaicRule;
  return taskParams;
}

const arcgisTableCss = ".host.sc-arcgis-table{width:100%}.content.sc-arcgis-table{height:100%;display:flex}.manager.sc-arcgis-table{height:100%}.action-bar.sc-arcgis-table{height:100%;border-width:0 1px 0 0;border-style:solid;border-color:var(--calcite-ui-border-2)}.menu-actions.sc-arcgis-table{display:inline-flex;justify-self:stretch}.table.sc-arcgis-table{height:100%}.tooltip.sc-arcgis-table{white-space:nowrap}.arcgis--rtl.sc-arcgis-table .action-bar.sc-arcgis-table{border-width:0 0 0 1px}";

const ArcgisTable = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisTableScaleChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisTableScaleChange", 7);
    this.arcgisTableDismissedChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisTableDismissedChange", 7);
    this.selectedOnlyMode = false;
    this.recordsCount = 0;
    this.selectedCount = 0;
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    this.panelKeyDownHandler = (event) => {
      if (this.dismissible && event.key === "Escape" && !event.defaultPrevented) {
        this.handleCloseClick();
        event.preventDefault();
      }
    };
    this.afterCreatePanel = async (node) => {
      const { layer, view } = this.props;
      if (layer.type === "imagery") {
        this.recordsCount = await (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_4__.n)(layer);
      }
      else if (layer.type === "wfs") {
        this.recordsCount = await layer.queryFeatureCount();
      }
      else {
        this.recordsCount = await (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_4__.g)(layer, view);
      }
      this.displayCount();
      this.panelNode = node;
      this.watchTitleHandler = layer.watch("title", () => {
        this.reRender = !this.reRender;
      });
    };
    this.afterCreateCloseButton = (node) => {
      this.closeButtonNode = node;
    };
    this.afterCreateTableNode = (node) => {
      const { props, selectedFeatureIds, reactiveUtils, supportsSelection } = this;
      const { layer, view } = props;
      const { table } = this;
      if (table) {
        return;
      }
      const { tableTemplate } = this;
      const supportsEditing = layer.type === "feature" && layer.effectiveEditingEnabled;
      this.table = new this.FeatureTable({
        layer,
        view,
        tableTemplate,
        editingEnabled: supportsEditing,
        attachmentsEnabled: layer.type === "feature" && hasAttachmentsEnabled(layer),
        highlightOnRowSelectEnabled: supportsSelection,
        multiSortEnabled: false,
        visibleElements: {
          header: false,
          menu: false
        },
        container: node
      });
      // hide selection checkboxes
      if (!supportsSelection) {
        this.table.grid.visibleElements = { selectionColumn: false };
      }
      this.watchHndlSize = reactiveUtils.watch(() => this.table.viewModel.size, (count) => {
        this.recordsCount = count;
        this.displayCount();
      });
      if (supportsSelection) {
        this.table.highlightIds.on("change", (event) => {
          event.removed.forEach((objectId) => {
            const idx = selectedFeatureIds.indexOf(objectId);
            if (idx > -1) {
              selectedFeatureIds.splice(idx, 1);
            }
          });
          event.added.forEach((objectId) => {
            if (selectedFeatureIds.indexOf(objectId) === -1) {
              selectedFeatureIds.push(objectId);
            } // could happen after clicking for popup
          });
          this.selectedCount = selectedFeatureIds.length;
          this.displayCount();
          this.lockRasters();
          this.reRender = !this.reRender;
        });
        this.watchHndlActive = reactiveUtils.watch(() => { var _a, _b; return (_b = (_a = view.popup) === null || _a === void 0 ? void 0 : _a.viewModel) === null || _b === void 0 ? void 0 : _b.active; }, () => {
          const selectedFeature = view.popup.selectedFeature;
          if (selectedFeature && view.popup.visible) {
            // delete entire selection in table
            this.table.highlightIds.removeAll();
            // only add popup features
            const id = view.popup.selectedFeature.getObjectId();
            this.table.highlightIds.push(id);
            selectedFeatureIds.push(id);
          }
          else if (selectedFeature && !view.popup.visible) {
            // popup got closed,
            // delete entire selection in table
            this.table.highlightIds.removeAll();
          }
        });
      }
    };
    this.handleEditingClick = () => {
      const { strings } = this;
      this.removeEditingPopover();
      this.editingPopoverNode = document.createElement("arcgis-table-editing-popover");
      this.editingPopoverNode.referenceElement = this.editingActionNode;
      this.editingPopoverNode.strings = strings;
      this.editingPopoverNode.addEventListener("arcgisTableEditingPopoverClose", (event) => {
        event.stopPropagation();
        this.removeEditingPopover();
        setTimeout(() => this.editingActionNode.setFocus(), 200);
      });
      this.editingPopoverNode.addEventListener("arcgisTableEditingPopoverDisconnected", (event) => {
        event.stopPropagation();
        this.removeEditingPopover();
      });
      document.body.appendChild(this.editingPopoverNode);
      this.editingPopoverNode.setOpen(true);
      // need to wait until it's all visible
      setTimeout(() => this.editingPopoverNode.setFocus(), 100);
    };
    this.handleVisibilityClick = (event) => {
      if (this.fieldSelectionPopover) {
        // already open, do nothing
        return;
      }
      document.removeEventListener("click", this.clickHandler);
      const { layer } = this.props;
      const { props, strings, currentLanguageIntl, tableTemplate, table, fieldSortOrder } = this;
      const popover = document.createElement("arcgis-table-field-selection");
      popover.props = props;
      popover.strings = strings;
      popover.currentLanguage = currentLanguageIntl;
      popover.columnTemplates = tableTemplate.columnTemplates;
      popover.sortBy = fieldSortOrder;
      popover.attachmentsEnabled =
        layer.type === "feature" && hasAttachmentsEnabled(layer) ? table.attachmentsEnabled : false;
      popover.popoverReferenceElement = event.target;
      popover.addEventListener("columnTemplatesChange", (event) => {
        event.stopPropagation();
        this.updateTable(new this.TableTemplate({ columnTemplates: event.detail }));
      });
      popover.addEventListener("attachmentsChange", (event) => {
        event.stopPropagation();
        this.table.attachmentsEnabled = event.detail;
      });
      popover.addEventListener("fieldSortByChange", (event) => {
        event.stopPropagation();
        this.fieldSortOrder = event.detail;
      });
      popover.addEventListener("arcgisTableFieldSelectionClose", () => {
        this.closePopovers();
        setTimeout(() => this.settingsActionNode.setFocus(), 200);
      });
      document.body.appendChild(popover);
      this.fieldSelectionPopover = popover;
      setTimeout(() => document.addEventListener("click", this.clickHandler), 200);
    };
    this.clickHandler = (event) => {
      if (!this.fieldSelectionPopover) {
        // popover got removed another way
        document.removeEventListener("click", this.clickHandler);
      }
      else if (!(0,_basic_ee9c674c_js__WEBPACK_IMPORTED_MODULE_3__.i)(event.target, "arcgis-table-field-selection")) {
        document.body.removeChild(this.fieldSelectionPopover);
        this.fieldSelectionPopover = null;
        document.removeEventListener("click", this.clickHandler);
      }
    };
    this.handleHomeClick = () => {
      const { view, initialViewpoint } = this;
      view.goTo(initialViewpoint);
    };
    this.handleZoomToClick = () => {
      const { layer, view, selectedFeatureIds, Query } = this;
      if (getLayerType(layer) === "imagery") {
        const query = new Query();
        query.outSpatialReference = view.spatialReference;
        query.objectIds = [...selectedFeatureIds];
        query.returnGeometry = true;
        layer.queryRasters(query).then((results) => {
          view.goTo(results.features);
        });
      }
      else {
        const query = layer.createQuery();
        query.outSpatialReference = view.spatialReference;
        query.objectIds = [...selectedFeatureIds];
        query.returnGeometry = true;
        layer.queryFeatures(query).then((results) => {
          view.goTo(results.features);
        });
      }
    };
    this.handleClearClick = () => {
      const { table, supportsSelection } = this;
      const { viewModel, grid } = table;
      table.highlightIds.removeAll();
      viewModel.clearSelectionFilter();
      this.selectedOnlyMode = false;
      if (supportsSelection) {
        grid.visibleElements = { selectionColumn: true };
      }
    };
    this.handleShowSelectedClick = () => {
      const { table } = this;
      const { viewModel } = table;
      this.selectedOnlyMode = true;
      viewModel.filterBySelection();
      this.reRender = !this.reRender;
    };
    this.handleShowAllClick = () => {
      const { table } = this;
      const { viewModel } = table;
      this.selectedOnlyMode = false;
      viewModel.clearSelectionFilter();
      this.reRender = !this.reRender;
    };
    this.handleSelectVisibleClick = async () => {
      const { layer, view, table } = this;
      table.highlightIds.removeAll();
      const extent = view.get("extent");
      // to do to normalize extend
      // if (getLayerType(layer) === "imagery" && (layer as ImageryLayer).version >=10 && view.wrapAround) {
      //   extent = extent._normalize(true);
      // }
      // Convert extent to polygon
      const identifyParams = await getIdentifyParams(extent, view, layer);
      this.selectFeaturesFromIdentify(identifyParams);
    };
    this.handleDisplaySelectedClick = () => {
      this.lockRaster = true;
      this.lockRasters();
    };
    this.handleDisplayAllClick = () => {
      var _a;
      const { MosaicRule } = this;
      this.lockRaster = false;
      // use service's default mosaic rule, filtered out certain mosaic methods that're not supported without additional inputs.
      const layer = this.layer;
      const { sourceJSON } = layer;
      const methods = sourceJSON.allowedMosaicMethods
        .split(",")
        .map((method) => method.trim().toLowerCase());
      methods.unshift(sourceJSON.defaultMosaicMethod.toLowerCase());
      // viewpoint is not available from sourceJSON, sortField can be null too.
      const defaultMosaicMethod = (_a = methods.find((method) => method !== "lockraster" &&
        method !== "viewpoint" &&
        (method !== "byattribute" || !!sourceJSON.sortField))) !== null && _a !== void 0 ? _a : "none";
      layer.mosaicRule = MosaicRule.fromJSON(Object.assign(Object.assign({}, sourceJSON), { defaultMosaicMethod }));
      layer.visible = true;
    };
    this.handleRefreshClick = () => {
      const { table } = this;
      table.refresh();
      this.reRender = !this.reRender;
    };
    this.handleExpandClick = () => {
      const { scale } = this;
      const newScale = scale === _basic_ee9c674c_js__WEBPACK_IMPORTED_MODULE_3__.s.SMALL ? _basic_ee9c674c_js__WEBPACK_IMPORTED_MODULE_3__.s.MEDIUM : _basic_ee9c674c_js__WEBPACK_IMPORTED_MODULE_3__.s.SMALL;
      this.arcgisTableScaleChange.emit(newScale);
      this.scale = newScale;
      this.closePopovers();
    };
    this.handleCloseClick = () => {
      this.arcgisTableDismissedChange.emit();
    };
    this.view = undefined;
    this.layer = undefined;
    this.initialViewpoint = undefined;
    this.scale = _basic_ee9c674c_js__WEBPACK_IMPORTED_MODULE_3__.s.SMALL;
    this.dismissible = false;
    this.tableTemplate = undefined;
    this.reRender = false;
    this.lockRaster = false;
    this.isBarExpanded = false;
    this.selectedFeatureIds = [];
  }
  //--------------------------------------------------------------------------
  //
  //  public calls
  //
  //--------------------------------------------------------------------------
  async setFocus(focusId) {
    var _a, _b;
    if (focusId === "dismiss-button" || (!focusId && this.dismissible)) {
      (_a = this.closeButtonNode) === null || _a === void 0 ? void 0 : _a.setFocus();
      return;
    }
    (_b = this.settingsActionNode) === null || _b === void 0 ? void 0 : _b.setFocus();
  }
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  async componentWillLoad() {
    const [strings, currentLanguage, currentLanguageIntl] = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement);
    this.strings = strings;
    this.currentLanguage = currentLanguage;
    this.currentLanguageIntl = currentLanguageIntl;
    await this.loadAllModules();
    /*
    // also load JS-API styles
    setDefaultOptions({
      css: true
      url: `https://jsdev.arcgis.com/4.16`,
      css: "https://jsdev.arcgis.com/4.16/esri/css/main.css"
    }); */
    const { view, layer } = this;
    if (getLayerType(layer) === "sublayer") {
      // need to create a FeatureLayer
      this.supportsSelection = false;
      const mapImageSublayer = layer;
      await this.reactiveUtils.whenOnce(() => !view.updating);
      const sublayerFL = await mapImageSublayer.createFeatureLayer();
      await sublayerFL.load();
      this.props = {
        view,
        layer: sublayerFL,
        mapImageSublayer
      };
    }
    else if ((0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_4__.c)(layer) === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_5__.s.imagery) {
      this.supportsSelection = true;
      this.imagerySelection = true;
      this.props = {
        view,
        layer: layer
      };
    }
    else {
      this.supportsSelection = !("isTable" in layer && layer.isTable);
      this.props = {
        view,
        layer: layer
      };
    }
    await this.getFieldTemplates();
  }
  componentDidLoad() {
    requestAnimationFrame(() => this.closeButtonNode.setFocus());
  }
  disconnectedCallback() {
    var _a, _b, _c;
    this.closePopovers();
    const { table } = this;
    table === null || table === void 0 ? void 0 : table.destroy();
    (_a = this.watchTitleHandler) === null || _a === void 0 ? void 0 : _a.remove();
    (_b = this.watchHndlSize) === null || _b === void 0 ? void 0 : _b.remove();
    (_c = this.watchHndlActive) === null || _c === void 0 ? void 0 : _c.remove();
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    const { props } = this;
    const { layer } = props;
    if (!layer) {
      return null;
    }
    const rtl = (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_6__.g)(this.hostElement) === "rtl";
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: CSS$2.host }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
        [CSS$2.content]: true,
        [_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_6__.C.rtl]: rtl
      } }, this.renderActionBar(), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { heading: layer.title, ref: this.afterCreatePanel, onKeyDown: this.panelKeyDownHandler }, this.renderHeaderActions(), this.renderTable()))));
  }
  renderActionBar() {
    const { supportsSelection, selectedFeatureIds, imagerySelection, isBarExpanded, strings } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action-bar", { class: CSS$2.actionBar, onCalciteActionBarToggle: (event) => {
        this.isBarExpanded = event.target.expanded;
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action-group", null, supportsSelection && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { id: "zoom", icon: "zoom-to-object", text: strings.zoomToSelection, disabled: !(selectedFeatureIds === null || selectedFeatureIds === void 0 ? void 0 : selectedFeatureIds.length), onClick: this.handleZoomToClick }), !isBarExpanded && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { referenceElement: "zoom", label: strings.zoomToSelection }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.tooltip }, strings.zoomToSelection))))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { id: "home", icon: "home", text: strings.home, onClick: this.handleHomeClick }), !isBarExpanded && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { referenceElement: "home", label: strings.home }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.tooltip }, strings.home))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { slot: "menu-tooltip", label: strings.more }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.tooltip }, strings.more))), !imagerySelection && this.renderTableActions(), imagerySelection && supportsSelection && this.renderImageryTableActions(), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { slot: "expand-tooltip", label: strings.expand }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.tooltip }, strings.expand))));
  }
  renderTableActions() {
    var _a, _b;
    const { selectedFeatureIds, supportsSelection, table, isBarExpanded, strings } = this;
    const hasSelectionFilter = !!((_b = (_a = table === null || table === void 0 ? void 0 : table.viewModel) === null || _a === void 0 ? void 0 : _a.activeFilters) === null || _b === void 0 ? void 0 : _b.find((filter) => filter.type === "selection"));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action-group", null, supportsSelection && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { id: "erase", icon: "erase", text: strings.clearSelection, disabled: !(selectedFeatureIds === null || selectedFeatureIds === void 0 ? void 0 : selectedFeatureIds.length), onClick: this.handleClearClick }), !isBarExpanded && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { referenceElement: "erase", label: strings.clearSelection }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.tooltip }, strings.clearSelection))))), supportsSelection && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { id: "showSelected", icon: "selected-items-filter", text: strings.showSelected, disabled: !(selectedFeatureIds === null || selectedFeatureIds === void 0 ? void 0 : selectedFeatureIds.length), onClick: this.handleShowSelectedClick }), !isBarExpanded && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { referenceElement: "showSelected", label: strings.showSelected }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.tooltip }, strings.showSelected))))), supportsSelection && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { id: "showAll", icon: "list", text: strings.showAll, disabled: !hasSelectionFilter, onClick: this.handleShowAllClick }), !isBarExpanded && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { referenceElement: "showAll", label: strings.showAll }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.tooltip }, strings.showAll))))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { id: "refresh", icon: "refresh", text: strings.refresh, onClick: this.handleRefreshClick }), !isBarExpanded && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { referenceElement: "refresh", label: strings.refresh }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.tooltip }, strings.refresh))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { slot: "menu-tooltip", label: strings.more }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.tooltip }, strings.more))));
  }
  renderImageryTableActions() {
    const { selectedFeatureIds, lockRaster, isBarExpanded, strings } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action-group", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { id: "erase", icon: "erase", text: strings.clearSelection, disabled: !(selectedFeatureIds === null || selectedFeatureIds === void 0 ? void 0 : selectedFeatureIds.length), onClick: this.handleClearClick }), !isBarExpanded && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { referenceElement: "erase", label: strings.clearSelection }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.tooltip }, strings.clearSelection))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { id: "visible", icon: "select-visible", text: strings.selectVisible, onClick: this.handleSelectVisibleClick }), !isBarExpanded && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { referenceElement: "visible", label: strings.selectVisible }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.tooltip }, strings.selectVisible))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { id: "displayImage", icon: lockRaster ? "unlock" : "lock", text: lockRaster ? strings.displayAll : strings.displaySelected, onClick: lockRaster ? this.handleDisplayAllClick : this.handleDisplaySelectedClick }), !isBarExpanded && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { referenceElement: "displayImage", label: lockRaster ? strings.displayAll : strings.displaySelected }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.tooltip }, lockRaster ? strings.displayAll : strings.displaySelected))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { slot: "menu-tooltip", label: strings.more }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.tooltip }, strings.more))));
  }
  renderHeaderActions() {
    const { layer, scale, strings, dismissible } = this;
    const supportsEditingOnlyForUser = "type" in layer &&
      layer.type === "feature" &&
      layer.effectiveEditingEnabled &&
      !layer.editingEnabled;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header-actions-end", class: CSS$2.menuActions }, supportsEditingOnlyForUser && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { id: "table-editing-action", text: strings.layerEditing, scale: "m", onClick: this.handleEditingClick, ref: (node) => (this.editingActionNode = node) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "exclamation-mark-circle" }))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { id: "table-settings-action", text: strings.fieldVisibility, scale: "m", onClick: this.handleVisibilityClick, ref: (node) => (this.settingsActionNode = node) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "gear" })), scale === _basic_ee9c674c_js__WEBPACK_IMPORTED_MODULE_3__.s.SMALL ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { key: "expand-table", text: strings.expand, scale: "s", onClick: this.handleExpandClick }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "m", icon: "chevrons-up" }))) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { key: "expand", text: strings.shrink, scale: "s", onClick: this.handleExpandClick }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "m", icon: "chevrons-down" }))), dismissible ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { text: strings.close, icon: "x", onClick: this.handleCloseClick, ref: this.afterCreateCloseButton })) : null));
  }
  renderTable() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.table }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: this.afterCreateTableNode })));
  }
  removeEditingPopover() {
    if (this.editingPopoverNode) {
      try {
        document.body.removeChild(this.editingPopoverNode);
        this.editingPopoverNode = null;
      }
      catch (e) { }
    }
  }
  handleHideClick(fieldName) {
    this.table.hideColumn(fieldName);
    this.tableTemplate.columnTemplates.forEach((columnTemplate) => {
      if (columnTemplate.fieldName === fieldName) {
        columnTemplate.visible = false;
      }
    });
  }
  handleColumnInfo(fieldName) {
    const { currentLanguageIntl } = this;
    if (this.columnInfoPopover) {
      // already open, hide it
      this.columnInfoPopover.parentNode.removeChild(this.columnInfoPopover);
    }
    const { props, strings } = this;
    const popover = document.createElement("arcgis-table-column-info");
    popover.props = props;
    popover.strings = strings;
    popover.currentLanguage = currentLanguageIntl;
    popover.fieldName = fieldName;
    popover.popoverReferenceElement = document.getElementById("table-settings-action");
    popover.addEventListener("arcgisTableColumnInfoClose", () => {
      this.closePopovers();
      setTimeout(() => this.closeButtonNode.setFocus(), 100);
    });
    document.body.appendChild(popover);
    this.columnInfoPopover = popover;
  }
  closePopovers() {
    document.removeEventListener("click", this.clickHandler);
    if (this.fieldSelectionPopover) {
      document.body.removeChild(this.fieldSelectionPopover);
      this.fieldSelectionPopover = null;
    }
    if (this.columnInfoPopover) {
      document.body.removeChild(this.columnInfoPopover);
      this.columnInfoPopover = null;
    }
    this.removeEditingPopover();
  }
  async selectFeaturesFromIdentify(params) {
    var _a;
    const { layer, imageService } = this;
    let queryResult = [];
    if (layer.visible) {
      const result = await imageService.identify(layer.url, params);
      if (((_a = result === null || result === void 0 ? void 0 : result.catalogItems) === null || _a === void 0 ? void 0 : _a.features) && result.catalogItemVisibilities) {
        for (let i = 0; i < result.catalogItems.features.length; i++) {
          if (result.catalogItemVisibilities[i] > 0) {
            queryResult.push(result.catalogItems.features[i]);
          }
        }
      }
      const graphics = queryResult.map((feature) => new this.Graphic({
        attributes: feature.attributes,
        geometry: feature.geometry,
        sourceLayer: this.table.layer,
        layer: this.table.layer
      }));
      if (!graphics.length) {
        this.table.highlightIds.removeAll();
      }
      else {
        this.table.selectRows(graphics);
      }
    }
  }
  async lockRasters() {
    const { selectedFeatureIds, layer, imagerySelection, MosaicRule } = this;
    if (this.lockRaster) {
      if (imagerySelection && selectedFeatureIds.length) {
        const ids = [...selectedFeatureIds];
        const mosaicRuleObject = new MosaicRule();
        mosaicRuleObject.method = "lock-raster";
        mosaicRuleObject.lockRasterIds = ids;
        const where = layer.definitionExpression;
        if (where) {
          mosaicRuleObject.where = where;
        }
        layer.mosaicRule = mosaicRuleObject;
        layer.visible = true;
      }
      else {
        layer.visible = false;
      }
    }
  }
  updateTable(tableTemplate) {
    this.table.tableTemplate = tableTemplate;
  }
  async getFieldTemplates() {
    var _a;
    const { layer } = this.props;
    const { strings } = this;
    const getMenuConfig = (fieldName) => {
      return {
        items: [
          {
            label: strings.information,
            iconClass: "esri-icon-description",
            autoCloseMenu: true,
            clickFunction: () => {
              this.handleColumnInfo(fieldName);
            }
          },
          {
            label: strings.hideField,
            iconClass: "esri-icon-non-visible",
            autoCloseMenu: true,
            clickFunction: () => {
              this.handleHideClick(fieldName);
            }
          }
        ]
      };
    };
    this.tableTemplate = new this.TableTemplate({ columnTemplates: [] });
    // use default popup settings for field visibility
    const fieldInfos = this.popupUtils.createFieldInfos({
      fields: layer.fields,
      objectIdField: layer.objectIdField
    });
    const fieldInfosMap = new Map(fieldInfos.map((fieldInfo) => [
      fieldInfo.fieldName,
      fieldInfo
    ]));
    let popupFieldsMap;
    if ((_a = layer.popupTemplate) === null || _a === void 0 ? void 0 : _a.fieldInfos) {
      const { popupTemplate } = layer;
      popupFieldsMap = new Map(popupTemplate.fieldInfos.map((fieldInfo) => [
        fieldInfo.fieldName,
        fieldInfo
      ]));
      /* popupTemplate.fieldInfos.forEach((fieldInfo: FieldInfo) => {
        if (fieldInfo.fieldName.startsWith("expression/")) {
          // TODO
        } else if (fieldInfo.fieldName.startsWith("relationships/")) {
          // TODO
        }
      }); */
      // watch for changes
      this.reactiveUtils.watch(() => layer.popupTemplate, () => {
        const { popupTemplate } = layer;
        this.tableTemplate.columnTemplates.forEach((columnTemplate) => {
          popupTemplate.fieldInfos.forEach((fieldInfo) => {
            if (columnTemplate.fieldName === fieldInfo.fieldName) {
              columnTemplate.label = fieldInfo.label;
              columnTemplate.format = fieldInfo.format;
            }
          });
        });
        this.updateTable(this.tableTemplate);
      });
    }
    layer.fields.forEach((field) => {
      if (field.type === "geometry") {
        return;
      }
      const fieldInfo = fieldInfosMap.get(field.name);
      const popupFieldInfo = popupFieldsMap === null || popupFieldsMap === void 0 ? void 0 : popupFieldsMap.get(field.name);
      const fieldColumnTemplate = {
        fieldName: field.name,
        label: (popupFieldInfo === null || popupFieldInfo === void 0 ? void 0 : popupFieldInfo.label) || field.alias || field.name,
        visible: fieldInfo === null || fieldInfo === void 0 ? void 0 : fieldInfo.visible,
        format: (popupFieldInfo === null || popupFieldInfo === void 0 ? void 0 : popupFieldInfo.format) || this.getDefaultFormat(field),
        menuConfig: getMenuConfig(field.name)
      }; /* FieldColumnTemplate */
      this.tableTemplate.columnTemplates.push(fieldColumnTemplate);
    });
  }
  getDefaultFormat(field) {
    if (["integer", "small-integer", "big-integer"].indexOf(field.type) > -1) {
      return new this.FieldInfoFormat({ digitSeparator: false, places: 0 });
    }
    else if (["single", "double", "long"].indexOf(field.type) > -1) {
      return new this.FieldInfoFormat({
        digitSeparator: false,
        places: 2
      });
    }
    else if (["date", "time-only", "timestamp-offset"].indexOf(field.type) > -1) {
      return new this.FieldInfoFormat({
        dateFormat: "short-date-short-time"
      });
    }
    else if ("date-only" === field.type) {
      return new this.FieldInfoFormat({
        dateFormat: "short-date"
      });
    }
    return undefined;
  }
  displayCount() {
    const { strings, panelNode, recordsCount, selectedCount, supportsSelection, intl } = this;
    if (!panelNode) {
      return;
    }
    const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
      digitSeparator: true
    });
    const recordsCountStr = intl.formatNumber(recordsCount, numberFormatIntlOptions);
    if (!(0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_4__.i)(selectedCount) || !supportsSelection) {
      if (recordsCount === 0) {
        panelNode.description = strings.zeroRecords;
      }
      else if (recordsCount === 1) {
        panelNode.description = strings.oneRecord;
      }
      else {
        panelNode.description = strings.numRecords.replace("${count}", `${recordsCountStr}`);
      }
    }
    else if (selectedCount === 0) {
      if (recordsCount === 0) {
        panelNode.description = strings.zeroRecordsZeroSel;
      }
      else if (recordsCount === 1) {
        panelNode.description = strings.oneRecordZeroSel;
      }
      else {
        panelNode.description = strings.numRecordsZeroSel.replace("${count}", `${recordsCountStr}`);
      }
    }
    else if (selectedCount === 1) {
      if (recordsCount === 0) {
        panelNode.description = strings.zeroRecordsOneSel;
      }
      else if (recordsCount === 1) {
        panelNode.description = strings.oneRecordOneSel;
      }
      else {
        panelNode.description = strings.numRecordsOneSel.replace("${count}", `${recordsCountStr}`);
      }
    }
    else {
      // n selected
      const selectedCountStr = intl.formatNumber(selectedCount, numberFormatIntlOptions);
      if (recordsCount === 0) {
        panelNode.description = strings.zeroRecordsNumSel.replace("${countSel}", `${selectedCountStr}`);
      }
      else if (recordsCount === 1) {
        panelNode.description = strings.oneRecordNumSel.replace("${countSel}", `${selectedCountStr}`);
      }
      else {
        panelNode.description = strings.numRecordsNumSel
          .replace("${count}", `${recordsCountStr}`)
          .replace("${countSel}", `${selectedCountStr}`);
      }
    }
  }
  async loadAllModules() {
    const [FeatureTable, TableTemplate, popupUtils, reactiveUtils, FieldInfoFormat, Query, imageService, MosaicRule, Graphic, intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_2__.l)([
      "esri/widgets/FeatureTable",
      "esri/widgets/FeatureTable/support/TableTemplate",
      "esri/support/popupUtils",
      "esri/core/reactiveUtils",
      "esri/popup/support/FieldInfoFormat",
      "esri/rest/support/Query",
      "esri/rest/imageService",
      "esri/layers/support/MosaicRule",
      "esri/Graphic",
      "esri/intl"
    ]);
    this.FeatureTable = FeatureTable;
    this.TableTemplate = TableTemplate;
    this.popupUtils = popupUtils;
    this.reactiveUtils = reactiveUtils;
    this.FieldInfoFormat = FieldInfoFormat;
    this.Query = Query;
    this.imageService = imageService;
    this.MosaicRule = MosaicRule;
    this.Graphic = Graphic;
    this.intl = intl;
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisTable.style = arcgisTableCss;

const CSS$1 = {
  popover: "popover",
  flow: "flow",
  info: "info"
};

const arcgisTableColumnInfoCss = ".flow{max-height:400px}.info{background-color:#ffffff;max-height:400px;width:20vw;max-width:420px;min-width:240px}";

const ArcgisTableColumnInfo = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisTableColumnInfoClose = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisTableColumnInfoClose", 7);
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    this.afterCreatePopover = (node) => {
      this.popoverNode = node;
    };
    this.afterCreateCloseButton = (node) => {
      this.closeButtonNode = node;
    };
    this.afterCreateFieldInfo = (node) => {
      node.addEventListener("arcgisFieldInfoComplete", () => this.reposition());
    };
    this.handleCloseClick = () => {
      this.arcgisTableColumnInfoClose.emit();
    };
    this.props = undefined;
    this.fieldName = undefined;
    this.popoverReferenceElement = undefined;
    this.strings = undefined;
    this.currentLanguage = undefined;
    this.isOpen = false;
    this.reRender = false;
  }
  //--------------------------------------------------------------------------
  //
  //  Public Methods
  //
  //--------------------------------------------------------------------------
  async reposition() {
    var _a;
    (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.reposition();
  }
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  async componentWillLoad() {
    const { layer } = this.props;
    this.fieldsMap = await (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_4__.d)(layer);
  }
  componentDidLoad() {
    this.reposition();
    this.isOpen = true;
    // need timeout because of re-render
    setTimeout(() => requestAnimationFrame(() => this.closeButtonNode.setFocus()), 100);
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    const { fieldName, fieldsMap, popoverReferenceElement } = this;
    const field = fieldsMap.get(fieldName);
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { placement: "leading", dir: document.dir, open: this.isOpen, pointerDisabled: true, referenceElement: popoverReferenceElement, offsetDistance: -48, offsetSkidding: 0, class: CSS$1.popover, label: "", ref: this.afterCreatePopover }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { class: CSS$1.flow }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: field.alias || field.name, description: fieldName }, this.renderCloseButton(), this.renderInfo())))));
  }
  renderCloseButton() {
    const { strings } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { text: strings.close, scale: "s", slot: "header-actions-end", onClick: this.handleCloseClick, ref: this.afterCreateCloseButton, icon: "x" }));
  }
  renderInfo() {
    const { layer, view } = this.props;
    const { fieldName, currentLanguage } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-field-info", { fieldName: fieldName, layer: layer, view: view, lang: currentLanguage, class: CSS$1.info, ref: this.afterCreateFieldInfo }));
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisTableColumnInfo.style = arcgisTableColumnInfoCss;

const CSS = {
  popover: "popover",
  flow: "flow",
  info: "info",
  selectButton: "select-button"
};

const arcgisTableFieldSelectionCss = ".flow{max-height:400px;width:280px}.content{max-height:80vh}.info{background-color:#ffffff}.select-button{margin:4px 0}";

const ArcgisTableFieldSelection = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisTableFieldSelectionClose = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisTableFieldSelectionClose", 7);
    this.columnTemplatesChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "columnTemplatesChange", 7);
    this.fieldSortByChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "fieldSortByChange", 7);
    this.attachmentsChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "attachmentsChange", 7);
    this.waitHandler = null;
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    this.afterCreatePopover = (node) => {
      this.popoverNode = node;
    };
    this.afterCreateFlow = (node) => {
      this.flowNode = node;
    };
    this.afterCreateFlowItem = (node) => {
      this.firstPanelNode = node;
    };
    this.afterCreateCloseButton = (node) => {
      this.closeButtonNode = node;
    };
    this.afterCreatePickList = (node) => {
      this.pickListNode = node;
    };
    this.afterCreatePickListItem = (node) => {
      node.addEventListener("calciteListItemChange", (event) => {
        this.handleCalciteListItemChange(event);
      });
    };
    this.afterCreatePickListItemAttachments = (node) => {
      node.addEventListener("calciteListItemChange", (event) => {
        this.handleCalciteAttachmentsItemChange(event);
      });
    };
    this.handleCloseClick = () => {
      this.arcgisTableFieldSelectionClose.emit();
    };
    this.props = undefined;
    this.columnTemplates = undefined;
    this.attachmentsEnabled = false;
    this.popoverReferenceElement = undefined;
    this.sortBy = undefined;
    this.strings = undefined;
    this.currentLanguage = undefined;
    this.reRender = false;
    this.lastSortBy = _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_5__.L.display;
    this.filterFields = null;
    this.isOpen = false;
  }
  //--------------------------------------------------------------------------
  //
  //  Public Methods
  //
  //--------------------------------------------------------------------------
  async reposition() {
    var _a;
    (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.reposition();
  }
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  async componentWillLoad() {
    const { layer } = this.props;
    this.fieldsMap = await (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_4__.d)(layer);
    this.totalCounts = this.getTotalFieldTypeCount();
    this.lastSortBy = this.sortBy || _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_5__.L.default;
  }
  componentDidLoad() {
    this.reposition();
    this.isOpen = true;
    // need timeout because of re-render
    setTimeout(() => requestAnimationFrame(() => this.closeButtonNode.setFocus()), 200);
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    const { strings, popoverReferenceElement } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { placement: "leading", dir: document.dir, open: this.isOpen, pointerDisabled: true, referenceElement: popoverReferenceElement, offsetDistance: -48, offsetSkidding: 0, class: CSS.popover, label: "", ref: this.afterCreatePopover }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { class: CSS.flow, ref: this.afterCreateFlow }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.fieldVisibility, ref: this.afterCreateFlowItem }, this.renderCloseButton(), this.renderDoneButton(), this.renderPickList())))));
  }
  renderCloseButton() {
    const { strings } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { text: strings.close, scale: "s", slot: "header-actions-end", onClick: this.handleCloseClick, icon: "x", ref: this.afterCreateCloseButton }));
  }
  renderDoneButton() {
    const { strings } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", scale: "m", slot: "footer", width: "full", onClick: this.handleCloseClick, label: strings.done }, strings.done));
  }
  renderPickList() {
    const { strings } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pick-list", { class: "content", "drag-enabled": false, multiple: true, filterEnabled: true, filterPlaceholder: strings.filterFields, ref: this.afterCreatePickList, onCalciteListFilter: (event) => {
        const node = event.target;
        this.filterFields = node.filteredItems;
      } }, this.renderSelection(), this.renderSort(), this.renderPickListItems(), this.renderAttachmentPickListItem()));
  }
  renderSelection() {
    const { filterFields, strings } = this;
    const containsAll = this.filterContainsAll();
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { key: `${filterFields}`, class: CSS.selectButton, appearance: "transparent", scale: "s", width: "full", onClick: () => this.handleSelectionAllClick(containsAll), label: containsAll ? strings.deselectAll : strings.selectAll }, containsAll ? strings.deselectAll : strings.selectAll));
  }
  renderSort() {
    const { lastSortBy, totalCounts, strings } = this;
    let hasNumberFields = totalCounts.number > 0;
    let hasStringFields = totalCounts.string > 0;
    let hasDateFields = totalCounts.date > 0;
    let canShowSort = hasNumberFields && (hasStringFields || hasDateFields)
      ? true
      : hasStringFields && hasDateFields
        ? true
        : false;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown", { slot: "menu-actions", placement: "bottom-end", overlayPositioning: "fixed" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "trigger", text: strings.sortFields, label: strings.sortFields, "aria-label": strings.sortFields }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "sortDescending" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { "group-title": strings.sortBy }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { selected: lastSortBy === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_5__.L.default, onClick: () => {
        this.lastSortBy = _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_5__.L.default;
        this.fieldSortByChange.emit(this.lastSortBy);
      } }, strings.default), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { selected: lastSortBy === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_5__.L.display, onClick: () => {
        this.lastSortBy = _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_5__.L.display;
        this.fieldSortByChange.emit(this.lastSortBy);
      } }, strings.sortByDisplayName), canShowSort ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { selected: lastSortBy === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_5__.L.type, onClick: () => {
        this.lastSortBy = _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_5__.L.type;
        this.fieldSortByChange.emit(this.lastSortBy);
      } }, strings.sortByType)) : null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { selected: lastSortBy === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_5__.L.field, onClick: () => {
        this.lastSortBy = _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_5__.L.field;
        this.fieldSortByChange.emit(this.lastSortBy);
      } }, strings.sortByFieldName))));
  }
  renderPickListItems() {
    const { lastSortBy } = this;
    let columnTemplates = this.cloneFieldTemplates();
    if (lastSortBy === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_5__.L.display) {
      columnTemplates = this.sortFieldsAlphabetically(columnTemplates);
    }
    else if (lastSortBy === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_5__.L.type) {
      columnTemplates = this.sortFieldsByType(this.sortFieldsAlphabetically(columnTemplates));
    }
    else if (lastSortBy === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_5__.L.field) {
      columnTemplates.sort((a, b) => {
        return a.fieldName.localeCompare(b.fieldName);
      });
    }
    else ;
    return columnTemplates.map((columnTemplate) => this.renderPickListItem(columnTemplate));
  }
  renderPickListItem(columnTemplate) {
    const { strings, filterFields } = this;
    let isHidden = false;
    if (filterFields &&
      !filterFields.some((filterField) => filterField.value === columnTemplate.fieldName)) {
      isHidden = true;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pick-list-item", { key: columnTemplate.fieldName, label: columnTemplate.label,
      //description={fieldConfig.name}
      value: columnTemplate.fieldName, selected: columnTemplate.visible, hidden: isHidden, ref: this.afterCreatePickListItem }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "actions-end", text: strings.info, onClick: (event) => {
        event.stopPropagation();
        this.handleInfoClick(columnTemplate, event.target);
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "information" }))));
  }
  renderAttachmentPickListItem() {
    const { layer } = this.props;
    const { strings, attachmentsEnabled } = this;
    if (layer.type === "imagery") {
      return null;
    }
    if (layer.type === "feature" && !hasAttachmentsEnabled(layer)) {
      return null;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pick-list-item", { key: "attachments", label: strings.photosAndFiles, description: strings.attachments, value: "__attachments", selected: attachmentsEnabled, hidden: false, ref: this.afterCreatePickListItemAttachments }));
  }
  handleSelectionAllClick(containsAll) {
    const { columnTemplates, filterFields } = this;
    // update fieldConfigs
    columnTemplates.forEach((columnTemplate) => {
      if (!filterFields ||
        filterFields.some((filterField) => filterField.value === columnTemplate.fieldName)) {
        columnTemplate.visible = !containsAll;
      }
    });
    // update pick-list-items
    this.pickListNode
      .querySelectorAll("calcite-pick-list-item")
      .forEach((item) => {
      if (!filterFields ||
        filterFields.some((filterField) => filterField.value === item.getAttribute("value"))) {
        if (!containsAll) {
          item.setAttribute("selected", "true");
        }
        else {
          item.removeAttribute("selected");
        }
      }
    });
    this.reRender = !this.reRender;
  }
  handleCalciteListItemChange({ detail: { value, selected } }) {
    const { columnTemplates } = this;
    columnTemplates.forEach((columnTemplate) => {
      if (columnTemplate.fieldName === value) {
        columnTemplate.visible = selected;
      }
    });
    // don't fire too many updates at once
    // e.g. after a user clicks 'Select all'
    if (this.waitHandler) {
      clearTimeout(this.waitHandler);
    }
    this.waitHandler = setTimeout(() => {
      this.waitHandler = null;
      this.columnTemplatesChange.emit(this.cloneFieldTemplates());
      // causes a state change
      this.reRender = !this.reRender;
    }, 100);
  }
  handleCalciteAttachmentsItemChange({ detail: { selected } }) {
    this.attachmentsChange.emit(selected);
    this.attachmentsEnabled = selected;
  }
  handleInfoClick(columnTemplate, action) {
    var _a;
    const { layer, view } = this.props;
    const { flowNode, firstPanelNode, currentLanguage } = this;
    const rect = firstPanelNode.getBoundingClientRect();
    const fieldInfo = document.createElement("arcgis-field-info");
    fieldInfo.lang = currentLanguage;
    fieldInfo.fieldName = columnTemplate.fieldName;
    fieldInfo.layer = layer;
    fieldInfo.view = view;
    fieldInfo.className = CSS.info;
    const fieldInfoFlowItem = document.createElement("calcite-flow-item");
    fieldInfoFlowItem.heading = (_a = columnTemplate.label) !== null && _a !== void 0 ? _a : columnTemplate.fieldName;
    fieldInfoFlowItem.description = columnTemplate.fieldName;
    // making the switch smoothly
    fieldInfoFlowItem.style.height = `${rect.height}px`;
    fieldInfoFlowItem.style.width = `${rect.width}px`;
    fieldInfoFlowItem.appendChild(fieldInfo);
    fieldInfoFlowItem.addEventListener("calciteFlowItemBack", () => requestAnimationFrame(() => action.setFocus()));
    flowNode.appendChild(fieldInfoFlowItem);
    setTimeout(() => fieldInfoFlowItem.setFocus(), 200);
    this.reposition();
  }
  cloneFieldTemplates() {
    return this.columnTemplates.map((columnTemplate) => {
      return Object.assign({}, columnTemplate);
    });
  }
  // check if filter contains all current field configs
  filterContainsAll() {
    const { columnTemplates, filterFields, attachmentsEnabled } = this;
    if (filterFields) {
      // attachment column is part of the filter, but not part of the fieldConfigs
      const filterFieldsFields = filterFields
        .filter((filterField) => filterField.value !== "__attachments")
        .map((filterField) => ({ value: filterField.value, selected: filterField.selected }));
      const fieldConfigsInFilter = columnTemplates.filter((columnTemplate) => filterFieldsFields.some((filterField) => columnTemplate.fieldName === filterField.value));
      let hasAttachments = filterFields.length !== filterFieldsFields.length;
      const containsAll = filterFieldsFields.every((filter) => !fieldConfigsInFilter.some((columnTemplate) => columnTemplate.fieldName === filter.value && !columnTemplate.visible));
      return containsAll && ((hasAttachments && attachmentsEnabled) || !hasAttachments);
    }
    else {
      return !columnTemplates.some((columnTemplate) => {
        return !columnTemplate.visible;
      });
    }
  }
  getTotalFieldTypeCount() {
    const { columnTemplates, fieldsMap } = this;
    const counts = { string: 0, number: 0, date: 0 };
    columnTemplates.forEach((columnTemplate) => {
      const field = fieldsMap.get(columnTemplate.fieldName);
      switch (field.type) {
        case "small-integer":
        case "big-integer":
        case "integer":
        case "single":
        case "double":
        case "long":
        case "oid":
        case "guid":
          counts.number++;
          break;
        case "string":
          counts.string++;
          break;
        case "date":
        case "date-only":
        case "time-only":
        case "timestamp-offset":
          counts.date++;
          break;
      }
    });
    return counts;
  }
  sortFieldsAlphabetically(columnTemplates) {
    return columnTemplates.sort((a, b) => {
      return a.label.charAt(0) === "_"
        ? 1
        : b.label.charAt(0) === "_"
          ? -1
          : a.label.localeCompare(b.label);
    });
  }
  sortFieldsByType(columnTemplates) {
    // order: number, string, date, oid, guid
    const { fieldsMap } = this;
    return columnTemplates
      .filter((columnTemplate) => ["small-integer", "big-integer", "integer", "single", "double", "long"].indexOf(fieldsMap.get(columnTemplate.fieldName).type) > -1)
      .map((columnTemplate) => {
      return columnTemplate;
    })
      .concat(columnTemplates
      .filter((columnTemplate) => fieldsMap.get(columnTemplate.fieldName).type === "string")
      .map((columnTemplate) => {
      return columnTemplate;
    }))
      .concat(columnTemplates
      .filter((columnTemplate) => ["date", "date-only", "time-only", "timestamp-offset"].indexOf(fieldsMap.get(columnTemplate.fieldName).type) > -1)
      .map((columnTemplate) => {
      return columnTemplate;
    }))
      .concat(columnTemplates
      .filter((columnTemplate) => fieldsMap.get(columnTemplate.fieldName).type === "oid")
      .map((columnTemplate) => {
      return columnTemplate;
    }))
      .concat(columnTemplates
      .filter((columnTemplate) => fieldsMap.get(columnTemplate.fieldName).type === "guid")
      .map((columnTemplate) => {
      return columnTemplate;
    }))
      .concat(columnTemplates
      .filter((columnTemplate) => [
      "small-integer",
      "big-integer",
      "integer",
      "single",
      "double",
      "long",
      "string",
      "date",
      "date-only",
      "time-only",
      "timestamp-offset",
      "oid",
      "guid"
    ].indexOf(fieldsMap.get(columnTemplate.fieldName).type) === -1)
      .map((columnTemplate) => {
      return columnTemplate;
    }));
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisTableFieldSelection.style = arcgisTableFieldSelectionCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/basic-ee9c674c.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/basic-ee9c674c.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isDefined),
/* harmony export */   i: () => (/* binding */ isInNode),
/* harmony export */   s: () => (/* binding */ scales)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
var scales;
(function (scales) {
  scales["SMALL"] = "s";
  scales["MEDIUM"] = "m";
  scales["LARGE"] = "l";
})(scales || (scales = {}));
/**
 * Returns true if the value is defined
 * @param value - value to check
 */
function isDefined(value) {
  return value !== undefined && value !== null;
}
/**
 * Returns true if node has nodeName or is contained in a parent node with nodeName
 * @param node
 * @param nodeName
 */
function isInNode(node, nodeName) {
  while (node) {
    if (node.nodeName === nodeName.toUpperCase()) {
      return true;
    }
    node = node.parentElement;
  }
  return false;
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
  var _a, _b, _c;
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    // "ru-RU" maps to "ru" use case
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
    }
    else {
      return "en";
    }
  }
}
function getComponentClosestLanguageIntl(element) {
  var _a, _b, _c;
  // it's OK if we don't have the 4 letter language file for it
  // 4 letter language code needed for formatting numbers
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      // we support the 2 letter coded language
      // e.g. it-CH vs it
      return lang;
    }
    else {
      return "en";
    }
  }
}
function fetchLocaleStringsForComponent(componentName, locale) {
  return new Promise((resolve, reject) => {
    fetch((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
      if (result.ok)
        resolve(result.json());
      else
        reject();
    }, () => reject());
  });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
  const id = `${componentName}${locale}`;
  if (!stringCache[id]) {
    stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
  }
  return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
  const componentName = tagName || element.tagName.toLowerCase();
  const componentLanguage = getComponentClosestLanguage(element);
  const componentLanguageIntl = getComponentClosestLanguageIntl(element);
  let strings;
  try {
    strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
  }
  catch (e) {
    console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
    strings = await fetchLocaleStringsFromCache(componentName, "en");
  }
  return [strings, componentLanguage, componentLanguageIntl];
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLThmMTk4OS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzRIO0FBQ3REO0FBQ1Q7QUFDSTtBQUMyRjtBQUN6RTtBQUNEO0FBQ3ZEOztBQUUzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsZ0JBQWdCLFFBQVEsb0JBQW9CLGdCQUFnQiwrQkFBK0I7QUFDckc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsK0RBQWM7QUFDekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBEQUEwRCwyREFBVztBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSw4Q0FBOEMsV0FBVyx5QkFBeUIsWUFBWSxhQUFhLHlCQUF5QixZQUFZLDRCQUE0QixZQUFZLHVCQUF1QixtQkFBbUIsd0NBQXdDLDhCQUE4QixvQkFBb0IscUJBQXFCLHVCQUF1QixZQUFZLHlCQUF5QixtQkFBbUIseURBQXlELHVCQUF1Qjs7QUFFaGY7QUFDQTtBQUNBLElBQUkscURBQWdCO0FBQ3BCLGtDQUFrQyxxREFBVztBQUM3QyxzQ0FBc0MscURBQVc7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVzRDs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ2hDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDMkU7QUFDYjtBQUNOOztBQUV4RDtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsbURBQWlDO0FBQ2hFO0FBQ0E7QUFDQSxNQUFNLHdEQUFXO0FBQ2pCLFdBQVcsd0RBQVc7QUFDdEI7QUFDQTtBQUNBO0FBQ0EsUUFBUSx3REFBVztBQUNuQixhQUFhLHdEQUFXO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLG1EQUFpQztBQUNoRTtBQUNBO0FBQ0EsTUFBTSx3REFBVztBQUNqQixXQUFXLHdEQUFXO0FBQ3RCO0FBQ0E7QUFDQSxRQUFRLHdEQUFXO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLHFEQUFZLDhCQUE4QixjQUFjLFFBQVEsT0FBTztBQUNqRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGNBQWMsRUFBRSxPQUFPO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxlQUFlLEdBQUcsa0JBQWtCO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBOztBQUU0RSIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy10YWJsZV8zLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2Jhc2ljLWVlOWM2NzRjLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xvY2FsZS0xM2UwMGE3NS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBGIGFzIEZyYWdtZW50LCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyB9IGZyb20gJy4vbG9jYWxlLTEzZTAwYTc1LmpzJztcbmltcG9ydCB7IGwgYXMgbG9hZE1vZHVsZXMgfSBmcm9tICcuL2xvYWRNb2R1bGVzLWFhZjMwYmQ2LmpzJztcbmltcG9ydCB7IGkgYXMgaXNJbk5vZGUsIHMgYXMgc2NhbGVzIH0gZnJvbSAnLi9iYXNpYy1lZTljNjc0Yy5qcyc7XG5pbXBvcnQgeyBjIGFzIGdldFNlcnZpY2VUeXBlLCBuIGFzIGdldFJhc3RlckNvdW50LCBnIGFzIGdldEZlYXR1cmVDb3VudCwgaSBhcyBpc0RlZmluZWQsIGQgYXMgZ2VuZXJhdGVMYXllckZpZWxkc01hcCB9IGZyb20gJy4vY29tbW9uRnVuY3Rpb25zLTUyNjJiMDk0LmpzJztcbmltcG9ydCB7IHMgYXMgc2VydmljZVR5cGVFbnVtLCBMIGFzIExhc3RTb3J0eUJ5IH0gZnJvbSAnLi9jb21tb25FbnVtcy1mOThhMzIzYy5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEVsZW1lbnREaXIsIEMgYXMgQ1NTX1VUSUxJVFkgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC0yMjI1OGM5MC5qcyc7XG5pbXBvcnQgJy4vZG9tLTEzZjViMDBjLmpzJztcblxuY29uc3QgQ1NTJDIgPSB7XG4gIGhvc3Q6IFwiaG9zdFwiLFxuICBjb250ZW50OiBcImNvbnRlbnRcIixcbiAgbWFuYWdlcjogXCJtYW5hZ2VyXCIsXG4gIGFjdGlvbkJhcjogXCJhY3Rpb24tYmFyXCIsXG4gIG1lbnVBY3Rpb25zOiBcIm1lbnUtYWN0aW9uc1wiLFxuICB0YWJsZTogXCJ0YWJsZVwiLFxuICB0b29sdGlwOiBcInRvb2x0aXBcIlxufTtcblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIGxheWVyIHN1cHBvcnRzIGF0dGFjaG1lbnRzXG4gKiBAcGFyYW0gbGF5ZXIgLSBGZWF0dXJlTGF5ZXJcbiAqL1xuZnVuY3Rpb24gaGFzQXR0YWNobWVudHNFbmFibGVkKGxheWVyKSB7XG4gIGlmICghKGxheWVyID09PSBudWxsIHx8IGxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllci5jYXBhYmlsaXRpZXMpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IHsgY2FwYWJpbGl0aWVzOiB7IGRhdGE6IHsgc3VwcG9ydHNBdHRhY2htZW50IH0sIG9wZXJhdGlvbnM6IHsgc3VwcG9ydHNRdWVyeUF0dGFjaG1lbnRzIH0gfSB9ID0gbGF5ZXI7XG4gIHJldHVybiBzdXBwb3J0c0F0dGFjaG1lbnQgJiYgc3VwcG9ydHNRdWVyeUF0dGFjaG1lbnRzO1xufVxuLyoqXG4gKiBSZXR1cm5zIHRoZSBsYXllciB0eXBlLCBhbmQgXCJzdWJsYXllclwiIGZvciBTdWJsYXllclxuICogQHBhcmFtIGxheWVyIC0gRmVhdHVyZUxheWVyXG4gKi9cbmZ1bmN0aW9uIGdldExheWVyVHlwZShsYXllcikge1xuICBpZiAobGF5ZXIuZGVjbGFyZWRDbGFzcyA9PT0gXCJlc3JpLmxheWVycy5zdXBwb3J0LlN1YmxheWVyXCIpIHtcbiAgICByZXR1cm4gXCJzdWJsYXllclwiO1xuICB9XG4gIGVsc2Uge1xuICAgIHJldHVybiBnZXRTZXJ2aWNlVHlwZShsYXllcik7XG4gIH1cbn1cblxuLyoqXG4gKiBnaXZlcyB0aGUgcGFyYW1ldGVycyBmb3IgaWRlbnRpZnlcbiAqIEBwYXJhbSBleHRlbnQgLSBleHRlbnQgYXQgd2hpY2ggdGhlIGlkZW50aWZ5IHNob3VsZCBiZSBkb25lXG4gKiBAcGFyYW0gbWFwIC0gbWFwIG9iamVjdFxuICogQHBhcmFtIGxheWVyIC0gdGhlIGxheWVyIG9uIHdoaWNoIGlkZW50aWZ5IHNob3VsZCBwZXJmb3JtXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldElkZW50aWZ5UGFyYW1zKGV4dGVudCwgbWFwLCBsYXllcikge1xuICBjb25zdCBbUG9seWdvbiwgUG9pbnQsIEltYWdlSWRlbnRpZnlQYXJhbWV0ZXJzXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcbiAgICBcImVzcmkvZ2VvbWV0cnkvUG9seWdvblwiLFxuICAgIFwiZXNyaS9nZW9tZXRyeS9Qb2ludFwiLFxuICAgIFwiZXNyaS9yZXN0L3N1cHBvcnQvSW1hZ2VJZGVudGlmeVBhcmFtZXRlcnNcIlxuICBdKTtcbiAgY29uc3QgcG9seWdvbiA9IG5ldyBQb2x5Z29uKGV4dGVudC5zcGF0aWFsUmVmZXJlbmNlKTtcbiAgcG9seWdvbi5hZGRSaW5nKFtcbiAgICBbZXh0ZW50LnhtaW4sIGV4dGVudC55bWluXSxcbiAgICBbZXh0ZW50LnhtaW4sIGV4dGVudC55bWF4XSxcbiAgICBbZXh0ZW50LnhtYXgsIGV4dGVudC55bWF4XSxcbiAgICBbZXh0ZW50LnhtYXgsIGV4dGVudC55bWluXSxcbiAgICBbZXh0ZW50LnhtaW4sIGV4dGVudC55bWluXVxuICBdKTtcbiAgY29uc3QgcHNYID0gKGV4dGVudC54bWF4IC0gZXh0ZW50LnhtaW4pIC8gbWFwLndpZHRoO1xuICBjb25zdCBwc1kgPSAoZXh0ZW50LnltYXggLSBleHRlbnQueW1pbikgLyBtYXAuaGVpZ2h0O1xuICBjb25zdCBwc1NSID0gZXh0ZW50LnNwYXRpYWxSZWZlcmVuY2U7XG4gIGNvbnN0IHBpeGVsU2l6ZSA9IG5ldyBQb2ludChwc1gsIHBzWSwgcHNTUik7XG4gIC8vIEdlbmVyYXRlIFRhc2sgUGFyYW1zXG4gIGNvbnN0IHRhc2tQYXJhbXMgPSBuZXcgSW1hZ2VJZGVudGlmeVBhcmFtZXRlcnMoKTtcbiAgdGFza1BhcmFtcy5nZW9tZXRyeSA9IHBvbHlnb247XG4gIHRhc2tQYXJhbXMucmV0dXJuR2VvbWV0cnkgPSB0cnVlO1xuICB0YXNrUGFyYW1zLnBpeGVsU2l6ZSA9IHBpeGVsU2l6ZTtcbiAgY29uc3QgbW9zYWljUnVsZSA9IGxheWVyLm1vc2FpY1J1bGUuY2xvbmUoKTtcbiAgaWYgKGxheWVyLmRlZmluaXRpb25FeHByZXNzaW9uKSB7XG4gICAgbW9zYWljUnVsZS53aGVyZSA9IGxheWVyLmRlZmluaXRpb25FeHByZXNzaW9uO1xuICB9XG4gIHRhc2tQYXJhbXMubW9zYWljUnVsZSA9IG1vc2FpY1J1bGU7XG4gIHJldHVybiB0YXNrUGFyYW1zO1xufVxuXG5jb25zdCBhcmNnaXNUYWJsZUNzcyA9IFwiLmhvc3Quc2MtYXJjZ2lzLXRhYmxle3dpZHRoOjEwMCV9LmNvbnRlbnQuc2MtYXJjZ2lzLXRhYmxle2hlaWdodDoxMDAlO2Rpc3BsYXk6ZmxleH0ubWFuYWdlci5zYy1hcmNnaXMtdGFibGV7aGVpZ2h0OjEwMCV9LmFjdGlvbi1iYXIuc2MtYXJjZ2lzLXRhYmxle2hlaWdodDoxMDAlO2JvcmRlci13aWR0aDowIDFweCAwIDA7Ym9yZGVyLXN0eWxlOnNvbGlkO2JvcmRlci1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWJvcmRlci0yKX0ubWVudS1hY3Rpb25zLnNjLWFyY2dpcy10YWJsZXtkaXNwbGF5OmlubGluZS1mbGV4O2p1c3RpZnktc2VsZjpzdHJldGNofS50YWJsZS5zYy1hcmNnaXMtdGFibGV7aGVpZ2h0OjEwMCV9LnRvb2x0aXAuc2MtYXJjZ2lzLXRhYmxle3doaXRlLXNwYWNlOm5vd3JhcH0uYXJjZ2lzLS1ydGwuc2MtYXJjZ2lzLXRhYmxlIC5hY3Rpb24tYmFyLnNjLWFyY2dpcy10YWJsZXtib3JkZXItd2lkdGg6MCAwIDAgMXB4fVwiO1xuXG5jb25zdCBBcmNnaXNUYWJsZSA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNUYWJsZVNjYWxlQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNUYWJsZVNjYWxlQ2hhbmdlXCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzVGFibGVEaXNtaXNzZWRDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1RhYmxlRGlzbWlzc2VkQ2hhbmdlXCIsIDcpO1xuICAgIHRoaXMuc2VsZWN0ZWRPbmx5TW9kZSA9IGZhbHNlO1xuICAgIHRoaXMucmVjb3Jkc0NvdW50ID0gMDtcbiAgICB0aGlzLnNlbGVjdGVkQ291bnQgPSAwO1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMucGFuZWxLZXlEb3duSGFuZGxlciA9IChldmVudCkgPT4ge1xuICAgICAgaWYgKHRoaXMuZGlzbWlzc2libGUgJiYgZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiICYmICFldmVudC5kZWZhdWx0UHJldmVudGVkKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlQ2xvc2VDbGljaygpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5hZnRlckNyZWF0ZVBhbmVsID0gYXN5bmMgKG5vZGUpID0+IHtcbiAgICAgIGNvbnN0IHsgbGF5ZXIsIHZpZXcgfSA9IHRoaXMucHJvcHM7XG4gICAgICBpZiAobGF5ZXIudHlwZSA9PT0gXCJpbWFnZXJ5XCIpIHtcbiAgICAgICAgdGhpcy5yZWNvcmRzQ291bnQgPSBhd2FpdCBnZXRSYXN0ZXJDb3VudChsYXllcik7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChsYXllci50eXBlID09PSBcIndmc1wiKSB7XG4gICAgICAgIHRoaXMucmVjb3Jkc0NvdW50ID0gYXdhaXQgbGF5ZXIucXVlcnlGZWF0dXJlQ291bnQoKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLnJlY29yZHNDb3VudCA9IGF3YWl0IGdldEZlYXR1cmVDb3VudChsYXllciwgdmlldyk7XG4gICAgICB9XG4gICAgICB0aGlzLmRpc3BsYXlDb3VudCgpO1xuICAgICAgdGhpcy5wYW5lbE5vZGUgPSBub2RlO1xuICAgICAgdGhpcy53YXRjaFRpdGxlSGFuZGxlciA9IGxheWVyLndhdGNoKFwidGl0bGVcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLnJlUmVuZGVyID0gIXRoaXMucmVSZW5kZXI7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHRoaXMuYWZ0ZXJDcmVhdGVDbG9zZUJ1dHRvbiA9IChub2RlKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlQnV0dG9uTm9kZSA9IG5vZGU7XG4gICAgfTtcbiAgICB0aGlzLmFmdGVyQ3JlYXRlVGFibGVOb2RlID0gKG5vZGUpID0+IHtcbiAgICAgIGNvbnN0IHsgcHJvcHMsIHNlbGVjdGVkRmVhdHVyZUlkcywgcmVhY3RpdmVVdGlscywgc3VwcG9ydHNTZWxlY3Rpb24gfSA9IHRoaXM7XG4gICAgICBjb25zdCB7IGxheWVyLCB2aWV3IH0gPSBwcm9wcztcbiAgICAgIGNvbnN0IHsgdGFibGUgfSA9IHRoaXM7XG4gICAgICBpZiAodGFibGUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgeyB0YWJsZVRlbXBsYXRlIH0gPSB0aGlzO1xuICAgICAgY29uc3Qgc3VwcG9ydHNFZGl0aW5nID0gbGF5ZXIudHlwZSA9PT0gXCJmZWF0dXJlXCIgJiYgbGF5ZXIuZWZmZWN0aXZlRWRpdGluZ0VuYWJsZWQ7XG4gICAgICB0aGlzLnRhYmxlID0gbmV3IHRoaXMuRmVhdHVyZVRhYmxlKHtcbiAgICAgICAgbGF5ZXIsXG4gICAgICAgIHZpZXcsXG4gICAgICAgIHRhYmxlVGVtcGxhdGUsXG4gICAgICAgIGVkaXRpbmdFbmFibGVkOiBzdXBwb3J0c0VkaXRpbmcsXG4gICAgICAgIGF0dGFjaG1lbnRzRW5hYmxlZDogbGF5ZXIudHlwZSA9PT0gXCJmZWF0dXJlXCIgJiYgaGFzQXR0YWNobWVudHNFbmFibGVkKGxheWVyKSxcbiAgICAgICAgaGlnaGxpZ2h0T25Sb3dTZWxlY3RFbmFibGVkOiBzdXBwb3J0c1NlbGVjdGlvbixcbiAgICAgICAgbXVsdGlTb3J0RW5hYmxlZDogZmFsc2UsXG4gICAgICAgIHZpc2libGVFbGVtZW50czoge1xuICAgICAgICAgIGhlYWRlcjogZmFsc2UsXG4gICAgICAgICAgbWVudTogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAgY29udGFpbmVyOiBub2RlXG4gICAgICB9KTtcbiAgICAgIC8vIGhpZGUgc2VsZWN0aW9uIGNoZWNrYm94ZXNcbiAgICAgIGlmICghc3VwcG9ydHNTZWxlY3Rpb24pIHtcbiAgICAgICAgdGhpcy50YWJsZS5ncmlkLnZpc2libGVFbGVtZW50cyA9IHsgc2VsZWN0aW9uQ29sdW1uOiBmYWxzZSB9O1xuICAgICAgfVxuICAgICAgdGhpcy53YXRjaEhuZGxTaXplID0gcmVhY3RpdmVVdGlscy53YXRjaCgoKSA9PiB0aGlzLnRhYmxlLnZpZXdNb2RlbC5zaXplLCAoY291bnQpID0+IHtcbiAgICAgICAgdGhpcy5yZWNvcmRzQ291bnQgPSBjb3VudDtcbiAgICAgICAgdGhpcy5kaXNwbGF5Q291bnQoKTtcbiAgICAgIH0pO1xuICAgICAgaWYgKHN1cHBvcnRzU2VsZWN0aW9uKSB7XG4gICAgICAgIHRoaXMudGFibGUuaGlnaGxpZ2h0SWRzLm9uKFwiY2hhbmdlXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgIGV2ZW50LnJlbW92ZWQuZm9yRWFjaCgob2JqZWN0SWQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGlkeCA9IHNlbGVjdGVkRmVhdHVyZUlkcy5pbmRleE9mKG9iamVjdElkKTtcbiAgICAgICAgICAgIGlmIChpZHggPiAtMSkge1xuICAgICAgICAgICAgICBzZWxlY3RlZEZlYXR1cmVJZHMuc3BsaWNlKGlkeCwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZXZlbnQuYWRkZWQuZm9yRWFjaCgob2JqZWN0SWQpID0+IHtcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZEZlYXR1cmVJZHMuaW5kZXhPZihvYmplY3RJZCkgPT09IC0xKSB7XG4gICAgICAgICAgICAgIHNlbGVjdGVkRmVhdHVyZUlkcy5wdXNoKG9iamVjdElkKTtcbiAgICAgICAgICAgIH0gLy8gY291bGQgaGFwcGVuIGFmdGVyIGNsaWNraW5nIGZvciBwb3B1cFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDb3VudCA9IHNlbGVjdGVkRmVhdHVyZUlkcy5sZW5ndGg7XG4gICAgICAgICAgdGhpcy5kaXNwbGF5Q291bnQoKTtcbiAgICAgICAgICB0aGlzLmxvY2tSYXN0ZXJzKCk7XG4gICAgICAgICAgdGhpcy5yZVJlbmRlciA9ICF0aGlzLnJlUmVuZGVyO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy53YXRjaEhuZGxBY3RpdmUgPSByZWFjdGl2ZVV0aWxzLndhdGNoKCgpID0+IHsgdmFyIF9hLCBfYjsgcmV0dXJuIChfYiA9IChfYSA9IHZpZXcucG9wdXApID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS52aWV3TW9kZWwpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5hY3RpdmU7IH0sICgpID0+IHtcbiAgICAgICAgICBjb25zdCBzZWxlY3RlZEZlYXR1cmUgPSB2aWV3LnBvcHVwLnNlbGVjdGVkRmVhdHVyZTtcbiAgICAgICAgICBpZiAoc2VsZWN0ZWRGZWF0dXJlICYmIHZpZXcucG9wdXAudmlzaWJsZSkge1xuICAgICAgICAgICAgLy8gZGVsZXRlIGVudGlyZSBzZWxlY3Rpb24gaW4gdGFibGVcbiAgICAgICAgICAgIHRoaXMudGFibGUuaGlnaGxpZ2h0SWRzLnJlbW92ZUFsbCgpO1xuICAgICAgICAgICAgLy8gb25seSBhZGQgcG9wdXAgZmVhdHVyZXNcbiAgICAgICAgICAgIGNvbnN0IGlkID0gdmlldy5wb3B1cC5zZWxlY3RlZEZlYXR1cmUuZ2V0T2JqZWN0SWQoKTtcbiAgICAgICAgICAgIHRoaXMudGFibGUuaGlnaGxpZ2h0SWRzLnB1c2goaWQpO1xuICAgICAgICAgICAgc2VsZWN0ZWRGZWF0dXJlSWRzLnB1c2goaWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmIChzZWxlY3RlZEZlYXR1cmUgJiYgIXZpZXcucG9wdXAudmlzaWJsZSkge1xuICAgICAgICAgICAgLy8gcG9wdXAgZ290IGNsb3NlZCxcbiAgICAgICAgICAgIC8vIGRlbGV0ZSBlbnRpcmUgc2VsZWN0aW9uIGluIHRhYmxlXG4gICAgICAgICAgICB0aGlzLnRhYmxlLmhpZ2hsaWdodElkcy5yZW1vdmVBbGwoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5oYW5kbGVFZGl0aW5nQ2xpY2sgPSAoKSA9PiB7XG4gICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgICB0aGlzLnJlbW92ZUVkaXRpbmdQb3BvdmVyKCk7XG4gICAgICB0aGlzLmVkaXRpbmdQb3BvdmVyTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtdGFibGUtZWRpdGluZy1wb3BvdmVyXCIpO1xuICAgICAgdGhpcy5lZGl0aW5nUG9wb3Zlck5vZGUucmVmZXJlbmNlRWxlbWVudCA9IHRoaXMuZWRpdGluZ0FjdGlvbk5vZGU7XG4gICAgICB0aGlzLmVkaXRpbmdQb3BvdmVyTm9kZS5zdHJpbmdzID0gc3RyaW5ncztcbiAgICAgIHRoaXMuZWRpdGluZ1BvcG92ZXJOb2RlLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNUYWJsZUVkaXRpbmdQb3BvdmVyQ2xvc2VcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLnJlbW92ZUVkaXRpbmdQb3BvdmVyKCk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5lZGl0aW5nQWN0aW9uTm9kZS5zZXRGb2N1cygpLCAyMDApO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmVkaXRpbmdQb3BvdmVyTm9kZS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzVGFibGVFZGl0aW5nUG9wb3ZlckRpc2Nvbm5lY3RlZFwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMucmVtb3ZlRWRpdGluZ1BvcG92ZXIoKTtcbiAgICAgIH0pO1xuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmVkaXRpbmdQb3BvdmVyTm9kZSk7XG4gICAgICB0aGlzLmVkaXRpbmdQb3BvdmVyTm9kZS5zZXRPcGVuKHRydWUpO1xuICAgICAgLy8gbmVlZCB0byB3YWl0IHVudGlsIGl0J3MgYWxsIHZpc2libGVcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5lZGl0aW5nUG9wb3Zlck5vZGUuc2V0Rm9jdXMoKSwgMTAwKTtcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlVmlzaWJpbGl0eUNsaWNrID0gKGV2ZW50KSA9PiB7XG4gICAgICBpZiAodGhpcy5maWVsZFNlbGVjdGlvblBvcG92ZXIpIHtcbiAgICAgICAgLy8gYWxyZWFkeSBvcGVuLCBkbyBub3RoaW5nXG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmNsaWNrSGFuZGxlcik7XG4gICAgICBjb25zdCB7IGxheWVyIH0gPSB0aGlzLnByb3BzO1xuICAgICAgY29uc3QgeyBwcm9wcywgc3RyaW5ncywgY3VycmVudExhbmd1YWdlSW50bCwgdGFibGVUZW1wbGF0ZSwgdGFibGUsIGZpZWxkU29ydE9yZGVyIH0gPSB0aGlzO1xuICAgICAgY29uc3QgcG9wb3ZlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtdGFibGUtZmllbGQtc2VsZWN0aW9uXCIpO1xuICAgICAgcG9wb3Zlci5wcm9wcyA9IHByb3BzO1xuICAgICAgcG9wb3Zlci5zdHJpbmdzID0gc3RyaW5ncztcbiAgICAgIHBvcG92ZXIuY3VycmVudExhbmd1YWdlID0gY3VycmVudExhbmd1YWdlSW50bDtcbiAgICAgIHBvcG92ZXIuY29sdW1uVGVtcGxhdGVzID0gdGFibGVUZW1wbGF0ZS5jb2x1bW5UZW1wbGF0ZXM7XG4gICAgICBwb3BvdmVyLnNvcnRCeSA9IGZpZWxkU29ydE9yZGVyO1xuICAgICAgcG9wb3Zlci5hdHRhY2htZW50c0VuYWJsZWQgPVxuICAgICAgICBsYXllci50eXBlID09PSBcImZlYXR1cmVcIiAmJiBoYXNBdHRhY2htZW50c0VuYWJsZWQobGF5ZXIpID8gdGFibGUuYXR0YWNobWVudHNFbmFibGVkIDogZmFsc2U7XG4gICAgICBwb3BvdmVyLnBvcG92ZXJSZWZlcmVuY2VFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgcG9wb3Zlci5hZGRFdmVudExpc3RlbmVyKFwiY29sdW1uVGVtcGxhdGVzQ2hhbmdlXCIsIChldmVudCkgPT4ge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy51cGRhdGVUYWJsZShuZXcgdGhpcy5UYWJsZVRlbXBsYXRlKHsgY29sdW1uVGVtcGxhdGVzOiBldmVudC5kZXRhaWwgfSkpO1xuICAgICAgfSk7XG4gICAgICBwb3BvdmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJhdHRhY2htZW50c0NoYW5nZVwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMudGFibGUuYXR0YWNobWVudHNFbmFibGVkID0gZXZlbnQuZGV0YWlsO1xuICAgICAgfSk7XG4gICAgICBwb3BvdmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJmaWVsZFNvcnRCeUNoYW5nZVwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuZmllbGRTb3J0T3JkZXIgPSBldmVudC5kZXRhaWw7XG4gICAgICB9KTtcbiAgICAgIHBvcG92ZXIuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1RhYmxlRmllbGRTZWxlY3Rpb25DbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuY2xvc2VQb3BvdmVycygpO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuc2V0dGluZ3NBY3Rpb25Ob2RlLnNldEZvY3VzKCksIDIwMCk7XG4gICAgICB9KTtcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocG9wb3Zlcik7XG4gICAgICB0aGlzLmZpZWxkU2VsZWN0aW9uUG9wb3ZlciA9IHBvcG92ZXI7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmNsaWNrSGFuZGxlciksIDIwMCk7XG4gICAgfTtcbiAgICB0aGlzLmNsaWNrSGFuZGxlciA9IChldmVudCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLmZpZWxkU2VsZWN0aW9uUG9wb3Zlcikge1xuICAgICAgICAvLyBwb3BvdmVyIGdvdCByZW1vdmVkIGFub3RoZXIgd2F5XG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmNsaWNrSGFuZGxlcik7XG4gICAgICB9XG4gICAgICBlbHNlIGlmICghaXNJbk5vZGUoZXZlbnQudGFyZ2V0LCBcImFyY2dpcy10YWJsZS1maWVsZC1zZWxlY3Rpb25cIikpIHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmZpZWxkU2VsZWN0aW9uUG9wb3Zlcik7XG4gICAgICAgIHRoaXMuZmllbGRTZWxlY3Rpb25Qb3BvdmVyID0gbnVsbDtcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuY2xpY2tIYW5kbGVyKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlSG9tZUNsaWNrID0gKCkgPT4ge1xuICAgICAgY29uc3QgeyB2aWV3LCBpbml0aWFsVmlld3BvaW50IH0gPSB0aGlzO1xuICAgICAgdmlldy5nb1RvKGluaXRpYWxWaWV3cG9pbnQpO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVab29tVG9DbGljayA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHsgbGF5ZXIsIHZpZXcsIHNlbGVjdGVkRmVhdHVyZUlkcywgUXVlcnkgfSA9IHRoaXM7XG4gICAgICBpZiAoZ2V0TGF5ZXJUeXBlKGxheWVyKSA9PT0gXCJpbWFnZXJ5XCIpIHtcbiAgICAgICAgY29uc3QgcXVlcnkgPSBuZXcgUXVlcnkoKTtcbiAgICAgICAgcXVlcnkub3V0U3BhdGlhbFJlZmVyZW5jZSA9IHZpZXcuc3BhdGlhbFJlZmVyZW5jZTtcbiAgICAgICAgcXVlcnkub2JqZWN0SWRzID0gWy4uLnNlbGVjdGVkRmVhdHVyZUlkc107XG4gICAgICAgIHF1ZXJ5LnJldHVybkdlb21ldHJ5ID0gdHJ1ZTtcbiAgICAgICAgbGF5ZXIucXVlcnlSYXN0ZXJzKHF1ZXJ5KS50aGVuKChyZXN1bHRzKSA9PiB7XG4gICAgICAgICAgdmlldy5nb1RvKHJlc3VsdHMuZmVhdHVyZXMpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBjb25zdCBxdWVyeSA9IGxheWVyLmNyZWF0ZVF1ZXJ5KCk7XG4gICAgICAgIHF1ZXJ5Lm91dFNwYXRpYWxSZWZlcmVuY2UgPSB2aWV3LnNwYXRpYWxSZWZlcmVuY2U7XG4gICAgICAgIHF1ZXJ5Lm9iamVjdElkcyA9IFsuLi5zZWxlY3RlZEZlYXR1cmVJZHNdO1xuICAgICAgICBxdWVyeS5yZXR1cm5HZW9tZXRyeSA9IHRydWU7XG4gICAgICAgIGxheWVyLnF1ZXJ5RmVhdHVyZXMocXVlcnkpLnRoZW4oKHJlc3VsdHMpID0+IHtcbiAgICAgICAgICB2aWV3LmdvVG8ocmVzdWx0cy5mZWF0dXJlcyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5oYW5kbGVDbGVhckNsaWNrID0gKCkgPT4ge1xuICAgICAgY29uc3QgeyB0YWJsZSwgc3VwcG9ydHNTZWxlY3Rpb24gfSA9IHRoaXM7XG4gICAgICBjb25zdCB7IHZpZXdNb2RlbCwgZ3JpZCB9ID0gdGFibGU7XG4gICAgICB0YWJsZS5oaWdobGlnaHRJZHMucmVtb3ZlQWxsKCk7XG4gICAgICB2aWV3TW9kZWwuY2xlYXJTZWxlY3Rpb25GaWx0ZXIoKTtcbiAgICAgIHRoaXMuc2VsZWN0ZWRPbmx5TW9kZSA9IGZhbHNlO1xuICAgICAgaWYgKHN1cHBvcnRzU2VsZWN0aW9uKSB7XG4gICAgICAgIGdyaWQudmlzaWJsZUVsZW1lbnRzID0geyBzZWxlY3Rpb25Db2x1bW46IHRydWUgfTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlU2hvd1NlbGVjdGVkQ2xpY2sgPSAoKSA9PiB7XG4gICAgICBjb25zdCB7IHRhYmxlIH0gPSB0aGlzO1xuICAgICAgY29uc3QgeyB2aWV3TW9kZWwgfSA9IHRhYmxlO1xuICAgICAgdGhpcy5zZWxlY3RlZE9ubHlNb2RlID0gdHJ1ZTtcbiAgICAgIHZpZXdNb2RlbC5maWx0ZXJCeVNlbGVjdGlvbigpO1xuICAgICAgdGhpcy5yZVJlbmRlciA9ICF0aGlzLnJlUmVuZGVyO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVTaG93QWxsQ2xpY2sgPSAoKSA9PiB7XG4gICAgICBjb25zdCB7IHRhYmxlIH0gPSB0aGlzO1xuICAgICAgY29uc3QgeyB2aWV3TW9kZWwgfSA9IHRhYmxlO1xuICAgICAgdGhpcy5zZWxlY3RlZE9ubHlNb2RlID0gZmFsc2U7XG4gICAgICB2aWV3TW9kZWwuY2xlYXJTZWxlY3Rpb25GaWx0ZXIoKTtcbiAgICAgIHRoaXMucmVSZW5kZXIgPSAhdGhpcy5yZVJlbmRlcjtcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlU2VsZWN0VmlzaWJsZUNsaWNrID0gYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBsYXllciwgdmlldywgdGFibGUgfSA9IHRoaXM7XG4gICAgICB0YWJsZS5oaWdobGlnaHRJZHMucmVtb3ZlQWxsKCk7XG4gICAgICBjb25zdCBleHRlbnQgPSB2aWV3LmdldChcImV4dGVudFwiKTtcbiAgICAgIC8vIHRvIGRvIHRvIG5vcm1hbGl6ZSBleHRlbmRcbiAgICAgIC8vIGlmIChnZXRMYXllclR5cGUobGF5ZXIpID09PSBcImltYWdlcnlcIiAmJiAobGF5ZXIgYXMgSW1hZ2VyeUxheWVyKS52ZXJzaW9uID49MTAgJiYgdmlldy53cmFwQXJvdW5kKSB7XG4gICAgICAvLyAgIGV4dGVudCA9IGV4dGVudC5fbm9ybWFsaXplKHRydWUpO1xuICAgICAgLy8gfVxuICAgICAgLy8gQ29udmVydCBleHRlbnQgdG8gcG9seWdvblxuICAgICAgY29uc3QgaWRlbnRpZnlQYXJhbXMgPSBhd2FpdCBnZXRJZGVudGlmeVBhcmFtcyhleHRlbnQsIHZpZXcsIGxheWVyKTtcbiAgICAgIHRoaXMuc2VsZWN0RmVhdHVyZXNGcm9tSWRlbnRpZnkoaWRlbnRpZnlQYXJhbXMpO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVEaXNwbGF5U2VsZWN0ZWRDbGljayA9ICgpID0+IHtcbiAgICAgIHRoaXMubG9ja1Jhc3RlciA9IHRydWU7XG4gICAgICB0aGlzLmxvY2tSYXN0ZXJzKCk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZURpc3BsYXlBbGxDbGljayA9ICgpID0+IHtcbiAgICAgIHZhciBfYTtcbiAgICAgIGNvbnN0IHsgTW9zYWljUnVsZSB9ID0gdGhpcztcbiAgICAgIHRoaXMubG9ja1Jhc3RlciA9IGZhbHNlO1xuICAgICAgLy8gdXNlIHNlcnZpY2UncyBkZWZhdWx0IG1vc2FpYyBydWxlLCBmaWx0ZXJlZCBvdXQgY2VydGFpbiBtb3NhaWMgbWV0aG9kcyB0aGF0J3JlIG5vdCBzdXBwb3J0ZWQgd2l0aG91dCBhZGRpdGlvbmFsIGlucHV0cy5cbiAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5sYXllcjtcbiAgICAgIGNvbnN0IHsgc291cmNlSlNPTiB9ID0gbGF5ZXI7XG4gICAgICBjb25zdCBtZXRob2RzID0gc291cmNlSlNPTi5hbGxvd2VkTW9zYWljTWV0aG9kc1xuICAgICAgICAuc3BsaXQoXCIsXCIpXG4gICAgICAgIC5tYXAoKG1ldGhvZCkgPT4gbWV0aG9kLnRyaW0oKS50b0xvd2VyQ2FzZSgpKTtcbiAgICAgIG1ldGhvZHMudW5zaGlmdChzb3VyY2VKU09OLmRlZmF1bHRNb3NhaWNNZXRob2QudG9Mb3dlckNhc2UoKSk7XG4gICAgICAvLyB2aWV3cG9pbnQgaXMgbm90IGF2YWlsYWJsZSBmcm9tIHNvdXJjZUpTT04sIHNvcnRGaWVsZCBjYW4gYmUgbnVsbCB0b28uXG4gICAgICBjb25zdCBkZWZhdWx0TW9zYWljTWV0aG9kID0gKF9hID0gbWV0aG9kcy5maW5kKChtZXRob2QpID0+IG1ldGhvZCAhPT0gXCJsb2NrcmFzdGVyXCIgJiZcbiAgICAgICAgbWV0aG9kICE9PSBcInZpZXdwb2ludFwiICYmXG4gICAgICAgIChtZXRob2QgIT09IFwiYnlhdHRyaWJ1dGVcIiB8fCAhIXNvdXJjZUpTT04uc29ydEZpZWxkKSkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwibm9uZVwiO1xuICAgICAgbGF5ZXIubW9zYWljUnVsZSA9IE1vc2FpY1J1bGUuZnJvbUpTT04oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBzb3VyY2VKU09OKSwgeyBkZWZhdWx0TW9zYWljTWV0aG9kIH0pKTtcbiAgICAgIGxheWVyLnZpc2libGUgPSB0cnVlO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVSZWZyZXNoQ2xpY2sgPSAoKSA9PiB7XG4gICAgICBjb25zdCB7IHRhYmxlIH0gPSB0aGlzO1xuICAgICAgdGFibGUucmVmcmVzaCgpO1xuICAgICAgdGhpcy5yZVJlbmRlciA9ICF0aGlzLnJlUmVuZGVyO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVFeHBhbmRDbGljayA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHsgc2NhbGUgfSA9IHRoaXM7XG4gICAgICBjb25zdCBuZXdTY2FsZSA9IHNjYWxlID09PSBzY2FsZXMuU01BTEwgPyBzY2FsZXMuTUVESVVNIDogc2NhbGVzLlNNQUxMO1xuICAgICAgdGhpcy5hcmNnaXNUYWJsZVNjYWxlQ2hhbmdlLmVtaXQobmV3U2NhbGUpO1xuICAgICAgdGhpcy5zY2FsZSA9IG5ld1NjYWxlO1xuICAgICAgdGhpcy5jbG9zZVBvcG92ZXJzKCk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZUNsb3NlQ2xpY2sgPSAoKSA9PiB7XG4gICAgICB0aGlzLmFyY2dpc1RhYmxlRGlzbWlzc2VkQ2hhbmdlLmVtaXQoKTtcbiAgICB9O1xuICAgIHRoaXMudmlldyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxheWVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaW5pdGlhbFZpZXdwb2ludCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNjYWxlID0gc2NhbGVzLlNNQUxMO1xuICAgIHRoaXMuZGlzbWlzc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLnRhYmxlVGVtcGxhdGUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5yZVJlbmRlciA9IGZhbHNlO1xuICAgIHRoaXMubG9ja1Jhc3RlciA9IGZhbHNlO1xuICAgIHRoaXMuaXNCYXJFeHBhbmRlZCA9IGZhbHNlO1xuICAgIHRoaXMuc2VsZWN0ZWRGZWF0dXJlSWRzID0gW107XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgcHVibGljIGNhbGxzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgYXN5bmMgc2V0Rm9jdXMoZm9jdXNJZCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgaWYgKGZvY3VzSWQgPT09IFwiZGlzbWlzcy1idXR0b25cIiB8fCAoIWZvY3VzSWQgJiYgdGhpcy5kaXNtaXNzaWJsZSkpIHtcbiAgICAgIChfYSA9IHRoaXMuY2xvc2VCdXR0b25Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgKF9iID0gdGhpcy5zZXR0aW5nc0FjdGlvbk5vZGUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zZXRGb2N1cygpO1xuICB9XG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIExpZmVjeWNsZVxuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIGNvbnN0IFtzdHJpbmdzLCBjdXJyZW50TGFuZ3VhZ2UsIGN1cnJlbnRMYW5ndWFnZUludGxdID0gYXdhaXQgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICB0aGlzLnN0cmluZ3MgPSBzdHJpbmdzO1xuICAgIHRoaXMuY3VycmVudExhbmd1YWdlID0gY3VycmVudExhbmd1YWdlO1xuICAgIHRoaXMuY3VycmVudExhbmd1YWdlSW50bCA9IGN1cnJlbnRMYW5ndWFnZUludGw7XG4gICAgYXdhaXQgdGhpcy5sb2FkQWxsTW9kdWxlcygpO1xuICAgIC8qXG4gICAgLy8gYWxzbyBsb2FkIEpTLUFQSSBzdHlsZXNcbiAgICBzZXREZWZhdWx0T3B0aW9ucyh7XG4gICAgICBjc3M6IHRydWVcbiAgICAgIHVybDogYGh0dHBzOi8vanNkZXYuYXJjZ2lzLmNvbS80LjE2YCxcbiAgICAgIGNzczogXCJodHRwczovL2pzZGV2LmFyY2dpcy5jb20vNC4xNi9lc3JpL2Nzcy9tYWluLmNzc1wiXG4gICAgfSk7ICovXG4gICAgY29uc3QgeyB2aWV3LCBsYXllciB9ID0gdGhpcztcbiAgICBpZiAoZ2V0TGF5ZXJUeXBlKGxheWVyKSA9PT0gXCJzdWJsYXllclwiKSB7XG4gICAgICAvLyBuZWVkIHRvIGNyZWF0ZSBhIEZlYXR1cmVMYXllclxuICAgICAgdGhpcy5zdXBwb3J0c1NlbGVjdGlvbiA9IGZhbHNlO1xuICAgICAgY29uc3QgbWFwSW1hZ2VTdWJsYXllciA9IGxheWVyO1xuICAgICAgYXdhaXQgdGhpcy5yZWFjdGl2ZVV0aWxzLndoZW5PbmNlKCgpID0+ICF2aWV3LnVwZGF0aW5nKTtcbiAgICAgIGNvbnN0IHN1YmxheWVyRkwgPSBhd2FpdCBtYXBJbWFnZVN1YmxheWVyLmNyZWF0ZUZlYXR1cmVMYXllcigpO1xuICAgICAgYXdhaXQgc3VibGF5ZXJGTC5sb2FkKCk7XG4gICAgICB0aGlzLnByb3BzID0ge1xuICAgICAgICB2aWV3LFxuICAgICAgICBsYXllcjogc3VibGF5ZXJGTCxcbiAgICAgICAgbWFwSW1hZ2VTdWJsYXllclxuICAgICAgfTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZ2V0U2VydmljZVR5cGUobGF5ZXIpID09PSBzZXJ2aWNlVHlwZUVudW0uaW1hZ2VyeSkge1xuICAgICAgdGhpcy5zdXBwb3J0c1NlbGVjdGlvbiA9IHRydWU7XG4gICAgICB0aGlzLmltYWdlcnlTZWxlY3Rpb24gPSB0cnVlO1xuICAgICAgdGhpcy5wcm9wcyA9IHtcbiAgICAgICAgdmlldyxcbiAgICAgICAgbGF5ZXI6IGxheWVyXG4gICAgICB9O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuc3VwcG9ydHNTZWxlY3Rpb24gPSAhKFwiaXNUYWJsZVwiIGluIGxheWVyICYmIGxheWVyLmlzVGFibGUpO1xuICAgICAgdGhpcy5wcm9wcyA9IHtcbiAgICAgICAgdmlldyxcbiAgICAgICAgbGF5ZXI6IGxheWVyXG4gICAgICB9O1xuICAgIH1cbiAgICBhd2FpdCB0aGlzLmdldEZpZWxkVGVtcGxhdGVzKCk7XG4gIH1cbiAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5jbG9zZUJ1dHRvbk5vZGUuc2V0Rm9jdXMoKSk7XG4gIH1cbiAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgdGhpcy5jbG9zZVBvcG92ZXJzKCk7XG4gICAgY29uc3QgeyB0YWJsZSB9ID0gdGhpcztcbiAgICB0YWJsZSA9PT0gbnVsbCB8fCB0YWJsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGFibGUuZGVzdHJveSgpO1xuICAgIChfYSA9IHRoaXMud2F0Y2hUaXRsZUhhbmRsZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZW1vdmUoKTtcbiAgICAoX2IgPSB0aGlzLndhdGNoSG5kbFNpemUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5yZW1vdmUoKTtcbiAgICAoX2MgPSB0aGlzLndhdGNoSG5kbEFjdGl2ZSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnJlbW92ZSgpO1xuICB9XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBSZW5kZXIgTWV0aG9kc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IHByb3BzIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHByb3BzO1xuICAgIGlmICghbGF5ZXIpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBydGwgPSBnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpID09PSBcInJ0bFwiO1xuICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiBDU1MkMi5ob3N0IH0sIGgoXCJkaXZcIiwgeyBjbGFzczoge1xuICAgICAgICBbQ1NTJDIuY29udGVudF06IHRydWUsXG4gICAgICAgIFtDU1NfVVRJTElUWS5ydGxdOiBydGxcbiAgICAgIH0gfSwgdGhpcy5yZW5kZXJBY3Rpb25CYXIoKSwgaChcImNhbGNpdGUtcGFuZWxcIiwgeyBoZWFkaW5nOiBsYXllci50aXRsZSwgcmVmOiB0aGlzLmFmdGVyQ3JlYXRlUGFuZWwsIG9uS2V5RG93bjogdGhpcy5wYW5lbEtleURvd25IYW5kbGVyIH0sIHRoaXMucmVuZGVySGVhZGVyQWN0aW9ucygpLCB0aGlzLnJlbmRlclRhYmxlKCkpKSkpO1xuICB9XG4gIHJlbmRlckFjdGlvbkJhcigpIHtcbiAgICBjb25zdCB7IHN1cHBvcnRzU2VsZWN0aW9uLCBzZWxlY3RlZEZlYXR1cmVJZHMsIGltYWdlcnlTZWxlY3Rpb24sIGlzQmFyRXhwYW5kZWQsIHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1hY3Rpb24tYmFyXCIsIHsgY2xhc3M6IENTUyQyLmFjdGlvbkJhciwgb25DYWxjaXRlQWN0aW9uQmFyVG9nZ2xlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgdGhpcy5pc0JhckV4cGFuZGVkID0gZXZlbnQudGFyZ2V0LmV4cGFuZGVkO1xuICAgICAgfSB9LCBoKFwiY2FsY2l0ZS1hY3Rpb24tZ3JvdXBcIiwgbnVsbCwgc3VwcG9ydHNTZWxlY3Rpb24gJiYgKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IGlkOiBcInpvb21cIiwgaWNvbjogXCJ6b29tLXRvLW9iamVjdFwiLCB0ZXh0OiBzdHJpbmdzLnpvb21Ub1NlbGVjdGlvbiwgZGlzYWJsZWQ6ICEoc2VsZWN0ZWRGZWF0dXJlSWRzID09PSBudWxsIHx8IHNlbGVjdGVkRmVhdHVyZUlkcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0ZWRGZWF0dXJlSWRzLmxlbmd0aCksIG9uQ2xpY2s6IHRoaXMuaGFuZGxlWm9vbVRvQ2xpY2sgfSksICFpc0JhckV4cGFuZGVkICYmIChoKFwiY2FsY2l0ZS10b29sdGlwXCIsIHsgcmVmZXJlbmNlRWxlbWVudDogXCJ6b29tXCIsIGxhYmVsOiBzdHJpbmdzLnpvb21Ub1NlbGVjdGlvbiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUyQyLnRvb2x0aXAgfSwgc3RyaW5ncy56b29tVG9TZWxlY3Rpb24pKSkpKSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgaWQ6IFwiaG9tZVwiLCBpY29uOiBcImhvbWVcIiwgdGV4dDogc3RyaW5ncy5ob21lLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUhvbWVDbGljayB9KSwgIWlzQmFyRXhwYW5kZWQgJiYgKGgoXCJjYWxjaXRlLXRvb2x0aXBcIiwgeyByZWZlcmVuY2VFbGVtZW50OiBcImhvbWVcIiwgbGFiZWw6IHN0cmluZ3MuaG9tZSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUyQyLnRvb2x0aXAgfSwgc3RyaW5ncy5ob21lKSkpLCBoKFwiY2FsY2l0ZS10b29sdGlwXCIsIHsgc2xvdDogXCJtZW51LXRvb2x0aXBcIiwgbGFiZWw6IHN0cmluZ3MubW9yZSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUyQyLnRvb2x0aXAgfSwgc3RyaW5ncy5tb3JlKSkpLCAhaW1hZ2VyeVNlbGVjdGlvbiAmJiB0aGlzLnJlbmRlclRhYmxlQWN0aW9ucygpLCBpbWFnZXJ5U2VsZWN0aW9uICYmIHN1cHBvcnRzU2VsZWN0aW9uICYmIHRoaXMucmVuZGVySW1hZ2VyeVRhYmxlQWN0aW9ucygpLCBoKFwiY2FsY2l0ZS10b29sdGlwXCIsIHsgc2xvdDogXCJleHBhbmQtdG9vbHRpcFwiLCBsYWJlbDogc3RyaW5ncy5leHBhbmQgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MkMi50b29sdGlwIH0sIHN0cmluZ3MuZXhwYW5kKSkpKTtcbiAgfVxuICByZW5kZXJUYWJsZUFjdGlvbnMoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCB7IHNlbGVjdGVkRmVhdHVyZUlkcywgc3VwcG9ydHNTZWxlY3Rpb24sIHRhYmxlLCBpc0JhckV4cGFuZGVkLCBzdHJpbmdzIH0gPSB0aGlzO1xuICAgIGNvbnN0IGhhc1NlbGVjdGlvbkZpbHRlciA9ICEhKChfYiA9IChfYSA9IHRhYmxlID09PSBudWxsIHx8IHRhYmxlID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0YWJsZS52aWV3TW9kZWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hY3RpdmVGaWx0ZXJzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZmluZCgoZmlsdGVyKSA9PiBmaWx0ZXIudHlwZSA9PT0gXCJzZWxlY3Rpb25cIikpO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtYWN0aW9uLWdyb3VwXCIsIG51bGwsIHN1cHBvcnRzU2VsZWN0aW9uICYmIChoKEZyYWdtZW50LCBudWxsLCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBpZDogXCJlcmFzZVwiLCBpY29uOiBcImVyYXNlXCIsIHRleHQ6IHN0cmluZ3MuY2xlYXJTZWxlY3Rpb24sIGRpc2FibGVkOiAhKHNlbGVjdGVkRmVhdHVyZUlkcyA9PT0gbnVsbCB8fCBzZWxlY3RlZEZlYXR1cmVJZHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdGVkRmVhdHVyZUlkcy5sZW5ndGgpLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNsZWFyQ2xpY2sgfSksICFpc0JhckV4cGFuZGVkICYmIChoKFwiY2FsY2l0ZS10b29sdGlwXCIsIHsgcmVmZXJlbmNlRWxlbWVudDogXCJlcmFzZVwiLCBsYWJlbDogc3RyaW5ncy5jbGVhclNlbGVjdGlvbiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUyQyLnRvb2x0aXAgfSwgc3RyaW5ncy5jbGVhclNlbGVjdGlvbikpKSkpLCBzdXBwb3J0c1NlbGVjdGlvbiAmJiAoaChGcmFnbWVudCwgbnVsbCwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgaWQ6IFwic2hvd1NlbGVjdGVkXCIsIGljb246IFwic2VsZWN0ZWQtaXRlbXMtZmlsdGVyXCIsIHRleHQ6IHN0cmluZ3Muc2hvd1NlbGVjdGVkLCBkaXNhYmxlZDogIShzZWxlY3RlZEZlYXR1cmVJZHMgPT09IG51bGwgfHwgc2VsZWN0ZWRGZWF0dXJlSWRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZEZlYXR1cmVJZHMubGVuZ3RoKSwgb25DbGljazogdGhpcy5oYW5kbGVTaG93U2VsZWN0ZWRDbGljayB9KSwgIWlzQmFyRXhwYW5kZWQgJiYgKGgoXCJjYWxjaXRlLXRvb2x0aXBcIiwgeyByZWZlcmVuY2VFbGVtZW50OiBcInNob3dTZWxlY3RlZFwiLCBsYWJlbDogc3RyaW5ncy5zaG93U2VsZWN0ZWQgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MkMi50b29sdGlwIH0sIHN0cmluZ3Muc2hvd1NlbGVjdGVkKSkpKSksIHN1cHBvcnRzU2VsZWN0aW9uICYmIChoKEZyYWdtZW50LCBudWxsLCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBpZDogXCJzaG93QWxsXCIsIGljb246IFwibGlzdFwiLCB0ZXh0OiBzdHJpbmdzLnNob3dBbGwsIGRpc2FibGVkOiAhaGFzU2VsZWN0aW9uRmlsdGVyLCBvbkNsaWNrOiB0aGlzLmhhbmRsZVNob3dBbGxDbGljayB9KSwgIWlzQmFyRXhwYW5kZWQgJiYgKGgoXCJjYWxjaXRlLXRvb2x0aXBcIiwgeyByZWZlcmVuY2VFbGVtZW50OiBcInNob3dBbGxcIiwgbGFiZWw6IHN0cmluZ3Muc2hvd0FsbCB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUyQyLnRvb2x0aXAgfSwgc3RyaW5ncy5zaG93QWxsKSkpKSksIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IGlkOiBcInJlZnJlc2hcIiwgaWNvbjogXCJyZWZyZXNoXCIsIHRleHQ6IHN0cmluZ3MucmVmcmVzaCwgb25DbGljazogdGhpcy5oYW5kbGVSZWZyZXNoQ2xpY2sgfSksICFpc0JhckV4cGFuZGVkICYmIChoKFwiY2FsY2l0ZS10b29sdGlwXCIsIHsgcmVmZXJlbmNlRWxlbWVudDogXCJyZWZyZXNoXCIsIGxhYmVsOiBzdHJpbmdzLnJlZnJlc2ggfSwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MkMi50b29sdGlwIH0sIHN0cmluZ3MucmVmcmVzaCkpKSwgaChcImNhbGNpdGUtdG9vbHRpcFwiLCB7IHNsb3Q6IFwibWVudS10b29sdGlwXCIsIGxhYmVsOiBzdHJpbmdzLm1vcmUgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MkMi50b29sdGlwIH0sIHN0cmluZ3MubW9yZSkpKSk7XG4gIH1cbiAgcmVuZGVySW1hZ2VyeVRhYmxlQWN0aW9ucygpIHtcbiAgICBjb25zdCB7IHNlbGVjdGVkRmVhdHVyZUlkcywgbG9ja1Jhc3RlciwgaXNCYXJFeHBhbmRlZCwgc3RyaW5ncyB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWFjdGlvbi1ncm91cFwiLCBudWxsLCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBpZDogXCJlcmFzZVwiLCBpY29uOiBcImVyYXNlXCIsIHRleHQ6IHN0cmluZ3MuY2xlYXJTZWxlY3Rpb24sIGRpc2FibGVkOiAhKHNlbGVjdGVkRmVhdHVyZUlkcyA9PT0gbnVsbCB8fCBzZWxlY3RlZEZlYXR1cmVJZHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdGVkRmVhdHVyZUlkcy5sZW5ndGgpLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNsZWFyQ2xpY2sgfSksICFpc0JhckV4cGFuZGVkICYmIChoKFwiY2FsY2l0ZS10b29sdGlwXCIsIHsgcmVmZXJlbmNlRWxlbWVudDogXCJlcmFzZVwiLCBsYWJlbDogc3RyaW5ncy5jbGVhclNlbGVjdGlvbiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUyQyLnRvb2x0aXAgfSwgc3RyaW5ncy5jbGVhclNlbGVjdGlvbikpKSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgaWQ6IFwidmlzaWJsZVwiLCBpY29uOiBcInNlbGVjdC12aXNpYmxlXCIsIHRleHQ6IHN0cmluZ3Muc2VsZWN0VmlzaWJsZSwgb25DbGljazogdGhpcy5oYW5kbGVTZWxlY3RWaXNpYmxlQ2xpY2sgfSksICFpc0JhckV4cGFuZGVkICYmIChoKFwiY2FsY2l0ZS10b29sdGlwXCIsIHsgcmVmZXJlbmNlRWxlbWVudDogXCJ2aXNpYmxlXCIsIGxhYmVsOiBzdHJpbmdzLnNlbGVjdFZpc2libGUgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MkMi50b29sdGlwIH0sIHN0cmluZ3Muc2VsZWN0VmlzaWJsZSkpKSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgaWQ6IFwiZGlzcGxheUltYWdlXCIsIGljb246IGxvY2tSYXN0ZXIgPyBcInVubG9ja1wiIDogXCJsb2NrXCIsIHRleHQ6IGxvY2tSYXN0ZXIgPyBzdHJpbmdzLmRpc3BsYXlBbGwgOiBzdHJpbmdzLmRpc3BsYXlTZWxlY3RlZCwgb25DbGljazogbG9ja1Jhc3RlciA/IHRoaXMuaGFuZGxlRGlzcGxheUFsbENsaWNrIDogdGhpcy5oYW5kbGVEaXNwbGF5U2VsZWN0ZWRDbGljayB9KSwgIWlzQmFyRXhwYW5kZWQgJiYgKGgoXCJjYWxjaXRlLXRvb2x0aXBcIiwgeyByZWZlcmVuY2VFbGVtZW50OiBcImRpc3BsYXlJbWFnZVwiLCBsYWJlbDogbG9ja1Jhc3RlciA/IHN0cmluZ3MuZGlzcGxheUFsbCA6IHN0cmluZ3MuZGlzcGxheVNlbGVjdGVkIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTJDIudG9vbHRpcCB9LCBsb2NrUmFzdGVyID8gc3RyaW5ncy5kaXNwbGF5QWxsIDogc3RyaW5ncy5kaXNwbGF5U2VsZWN0ZWQpKSksIGgoXCJjYWxjaXRlLXRvb2x0aXBcIiwgeyBzbG90OiBcIm1lbnUtdG9vbHRpcFwiLCBsYWJlbDogc3RyaW5ncy5tb3JlIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTJDIudG9vbHRpcCB9LCBzdHJpbmdzLm1vcmUpKSkpO1xuICB9XG4gIHJlbmRlckhlYWRlckFjdGlvbnMoKSB7XG4gICAgY29uc3QgeyBsYXllciwgc2NhbGUsIHN0cmluZ3MsIGRpc21pc3NpYmxlIH0gPSB0aGlzO1xuICAgIGNvbnN0IHN1cHBvcnRzRWRpdGluZ09ubHlGb3JVc2VyID0gXCJ0eXBlXCIgaW4gbGF5ZXIgJiZcbiAgICAgIGxheWVyLnR5cGUgPT09IFwiZmVhdHVyZVwiICYmXG4gICAgICBsYXllci5lZmZlY3RpdmVFZGl0aW5nRW5hYmxlZCAmJlxuICAgICAgIWxheWVyLmVkaXRpbmdFbmFibGVkO1xuICAgIHJldHVybiAoaChcImRpdlwiLCB7IHNsb3Q6IFwiaGVhZGVyLWFjdGlvbnMtZW5kXCIsIGNsYXNzOiBDU1MkMi5tZW51QWN0aW9ucyB9LCBzdXBwb3J0c0VkaXRpbmdPbmx5Rm9yVXNlciAmJiAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgaWQ6IFwidGFibGUtZWRpdGluZy1hY3Rpb25cIiwgdGV4dDogc3RyaW5ncy5sYXllckVkaXRpbmcsIHNjYWxlOiBcIm1cIiwgb25DbGljazogdGhpcy5oYW5kbGVFZGl0aW5nQ2xpY2ssIHJlZjogKG5vZGUpID0+ICh0aGlzLmVkaXRpbmdBY3Rpb25Ob2RlID0gbm9kZSkgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgaWNvbjogXCJleGNsYW1hdGlvbi1tYXJrLWNpcmNsZVwiIH0pKSksIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IGlkOiBcInRhYmxlLXNldHRpbmdzLWFjdGlvblwiLCB0ZXh0OiBzdHJpbmdzLmZpZWxkVmlzaWJpbGl0eSwgc2NhbGU6IFwibVwiLCBvbkNsaWNrOiB0aGlzLmhhbmRsZVZpc2liaWxpdHlDbGljaywgcmVmOiAobm9kZSkgPT4gKHRoaXMuc2V0dGluZ3NBY3Rpb25Ob2RlID0gbm9kZSkgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgaWNvbjogXCJnZWFyXCIgfSkpLCBzY2FsZSA9PT0gc2NhbGVzLlNNQUxMID8gKGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IGtleTogXCJleHBhbmQtdGFibGVcIiwgdGV4dDogc3RyaW5ncy5leHBhbmQsIHNjYWxlOiBcInNcIiwgb25DbGljazogdGhpcy5oYW5kbGVFeHBhbmRDbGljayB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwibVwiLCBpY29uOiBcImNoZXZyb25zLXVwXCIgfSkpKSA6IChoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBrZXk6IFwiZXhwYW5kXCIsIHRleHQ6IHN0cmluZ3Muc2hyaW5rLCBzY2FsZTogXCJzXCIsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlRXhwYW5kQ2xpY2sgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcIm1cIiwgaWNvbjogXCJjaGV2cm9ucy1kb3duXCIgfSkpKSwgZGlzbWlzc2libGUgPyAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgdGV4dDogc3RyaW5ncy5jbG9zZSwgaWNvbjogXCJ4XCIsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlQ2xvc2VDbGljaywgcmVmOiB0aGlzLmFmdGVyQ3JlYXRlQ2xvc2VCdXR0b24gfSkpIDogbnVsbCkpO1xuICB9XG4gIHJlbmRlclRhYmxlKCkge1xuICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1MkMi50YWJsZSB9LCBoKFwiZGl2XCIsIHsgcmVmOiB0aGlzLmFmdGVyQ3JlYXRlVGFibGVOb2RlIH0pKSk7XG4gIH1cbiAgcmVtb3ZlRWRpdGluZ1BvcG92ZXIoKSB7XG4gICAgaWYgKHRoaXMuZWRpdGluZ1BvcG92ZXJOb2RlKSB7XG4gICAgICB0cnkge1xuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuZWRpdGluZ1BvcG92ZXJOb2RlKTtcbiAgICAgICAgdGhpcy5lZGl0aW5nUG9wb3Zlck5vZGUgPSBudWxsO1xuICAgICAgfVxuICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgIH1cbiAgfVxuICBoYW5kbGVIaWRlQ2xpY2soZmllbGROYW1lKSB7XG4gICAgdGhpcy50YWJsZS5oaWRlQ29sdW1uKGZpZWxkTmFtZSk7XG4gICAgdGhpcy50YWJsZVRlbXBsYXRlLmNvbHVtblRlbXBsYXRlcy5mb3JFYWNoKChjb2x1bW5UZW1wbGF0ZSkgPT4ge1xuICAgICAgaWYgKGNvbHVtblRlbXBsYXRlLmZpZWxkTmFtZSA9PT0gZmllbGROYW1lKSB7XG4gICAgICAgIGNvbHVtblRlbXBsYXRlLnZpc2libGUgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBoYW5kbGVDb2x1bW5JbmZvKGZpZWxkTmFtZSkge1xuICAgIGNvbnN0IHsgY3VycmVudExhbmd1YWdlSW50bCB9ID0gdGhpcztcbiAgICBpZiAodGhpcy5jb2x1bW5JbmZvUG9wb3Zlcikge1xuICAgICAgLy8gYWxyZWFkeSBvcGVuLCBoaWRlIGl0XG4gICAgICB0aGlzLmNvbHVtbkluZm9Qb3BvdmVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5jb2x1bW5JbmZvUG9wb3Zlcik7XG4gICAgfVxuICAgIGNvbnN0IHsgcHJvcHMsIHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgY29uc3QgcG9wb3ZlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtdGFibGUtY29sdW1uLWluZm9cIik7XG4gICAgcG9wb3Zlci5wcm9wcyA9IHByb3BzO1xuICAgIHBvcG92ZXIuc3RyaW5ncyA9IHN0cmluZ3M7XG4gICAgcG9wb3Zlci5jdXJyZW50TGFuZ3VhZ2UgPSBjdXJyZW50TGFuZ3VhZ2VJbnRsO1xuICAgIHBvcG92ZXIuZmllbGROYW1lID0gZmllbGROYW1lO1xuICAgIHBvcG92ZXIucG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInRhYmxlLXNldHRpbmdzLWFjdGlvblwiKTtcbiAgICBwb3BvdmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNUYWJsZUNvbHVtbkluZm9DbG9zZVwiLCAoKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5jbG9zZUJ1dHRvbk5vZGUuc2V0Rm9jdXMoKSwgMTAwKTtcbiAgICB9KTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHBvcG92ZXIpO1xuICAgIHRoaXMuY29sdW1uSW5mb1BvcG92ZXIgPSBwb3BvdmVyO1xuICB9XG4gIGNsb3NlUG9wb3ZlcnMoKSB7XG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuY2xpY2tIYW5kbGVyKTtcbiAgICBpZiAodGhpcy5maWVsZFNlbGVjdGlvblBvcG92ZXIpIHtcbiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5maWVsZFNlbGVjdGlvblBvcG92ZXIpO1xuICAgICAgdGhpcy5maWVsZFNlbGVjdGlvblBvcG92ZXIgPSBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy5jb2x1bW5JbmZvUG9wb3Zlcikge1xuICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmNvbHVtbkluZm9Qb3BvdmVyKTtcbiAgICAgIHRoaXMuY29sdW1uSW5mb1BvcG92ZXIgPSBudWxsO1xuICAgIH1cbiAgICB0aGlzLnJlbW92ZUVkaXRpbmdQb3BvdmVyKCk7XG4gIH1cbiAgYXN5bmMgc2VsZWN0RmVhdHVyZXNGcm9tSWRlbnRpZnkocGFyYW1zKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgbGF5ZXIsIGltYWdlU2VydmljZSB9ID0gdGhpcztcbiAgICBsZXQgcXVlcnlSZXN1bHQgPSBbXTtcbiAgICBpZiAobGF5ZXIudmlzaWJsZSkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW1hZ2VTZXJ2aWNlLmlkZW50aWZ5KGxheWVyLnVybCwgcGFyYW1zKTtcbiAgICAgIGlmICgoKF9hID0gcmVzdWx0ID09PSBudWxsIHx8IHJlc3VsdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzdWx0LmNhdGFsb2dJdGVtcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZlYXR1cmVzKSAmJiByZXN1bHQuY2F0YWxvZ0l0ZW1WaXNpYmlsaXRpZXMpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXN1bHQuY2F0YWxvZ0l0ZW1zLmZlYXR1cmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYgKHJlc3VsdC5jYXRhbG9nSXRlbVZpc2liaWxpdGllc1tpXSA+IDApIHtcbiAgICAgICAgICAgIHF1ZXJ5UmVzdWx0LnB1c2gocmVzdWx0LmNhdGFsb2dJdGVtcy5mZWF0dXJlc1tpXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb25zdCBncmFwaGljcyA9IHF1ZXJ5UmVzdWx0Lm1hcCgoZmVhdHVyZSkgPT4gbmV3IHRoaXMuR3JhcGhpYyh7XG4gICAgICAgIGF0dHJpYnV0ZXM6IGZlYXR1cmUuYXR0cmlidXRlcyxcbiAgICAgICAgZ2VvbWV0cnk6IGZlYXR1cmUuZ2VvbWV0cnksXG4gICAgICAgIHNvdXJjZUxheWVyOiB0aGlzLnRhYmxlLmxheWVyLFxuICAgICAgICBsYXllcjogdGhpcy50YWJsZS5sYXllclxuICAgICAgfSkpO1xuICAgICAgaWYgKCFncmFwaGljcy5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy50YWJsZS5oaWdobGlnaHRJZHMucmVtb3ZlQWxsKCk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy50YWJsZS5zZWxlY3RSb3dzKGdyYXBoaWNzKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgYXN5bmMgbG9ja1Jhc3RlcnMoKSB7XG4gICAgY29uc3QgeyBzZWxlY3RlZEZlYXR1cmVJZHMsIGxheWVyLCBpbWFnZXJ5U2VsZWN0aW9uLCBNb3NhaWNSdWxlIH0gPSB0aGlzO1xuICAgIGlmICh0aGlzLmxvY2tSYXN0ZXIpIHtcbiAgICAgIGlmIChpbWFnZXJ5U2VsZWN0aW9uICYmIHNlbGVjdGVkRmVhdHVyZUlkcy5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgaWRzID0gWy4uLnNlbGVjdGVkRmVhdHVyZUlkc107XG4gICAgICAgIGNvbnN0IG1vc2FpY1J1bGVPYmplY3QgPSBuZXcgTW9zYWljUnVsZSgpO1xuICAgICAgICBtb3NhaWNSdWxlT2JqZWN0Lm1ldGhvZCA9IFwibG9jay1yYXN0ZXJcIjtcbiAgICAgICAgbW9zYWljUnVsZU9iamVjdC5sb2NrUmFzdGVySWRzID0gaWRzO1xuICAgICAgICBjb25zdCB3aGVyZSA9IGxheWVyLmRlZmluaXRpb25FeHByZXNzaW9uO1xuICAgICAgICBpZiAod2hlcmUpIHtcbiAgICAgICAgICBtb3NhaWNSdWxlT2JqZWN0LndoZXJlID0gd2hlcmU7XG4gICAgICAgIH1cbiAgICAgICAgbGF5ZXIubW9zYWljUnVsZSA9IG1vc2FpY1J1bGVPYmplY3Q7XG4gICAgICAgIGxheWVyLnZpc2libGUgPSB0cnVlO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGxheWVyLnZpc2libGUgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgdXBkYXRlVGFibGUodGFibGVUZW1wbGF0ZSkge1xuICAgIHRoaXMudGFibGUudGFibGVUZW1wbGF0ZSA9IHRhYmxlVGVtcGxhdGU7XG4gIH1cbiAgYXN5bmMgZ2V0RmllbGRUZW1wbGF0ZXMoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBzdHJpbmdzIH0gPSB0aGlzO1xuICAgIGNvbnN0IGdldE1lbnVDb25maWcgPSAoZmllbGROYW1lKSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiBzdHJpbmdzLmluZm9ybWF0aW9uLFxuICAgICAgICAgICAgaWNvbkNsYXNzOiBcImVzcmktaWNvbi1kZXNjcmlwdGlvblwiLFxuICAgICAgICAgICAgYXV0b0Nsb3NlTWVudTogdHJ1ZSxcbiAgICAgICAgICAgIGNsaWNrRnVuY3Rpb246ICgpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5oYW5kbGVDb2x1bW5JbmZvKGZpZWxkTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogc3RyaW5ncy5oaWRlRmllbGQsXG4gICAgICAgICAgICBpY29uQ2xhc3M6IFwiZXNyaS1pY29uLW5vbi12aXNpYmxlXCIsXG4gICAgICAgICAgICBhdXRvQ2xvc2VNZW51OiB0cnVlLFxuICAgICAgICAgICAgY2xpY2tGdW5jdGlvbjogKCkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLmhhbmRsZUhpZGVDbGljayhmaWVsZE5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfTtcbiAgICB9O1xuICAgIHRoaXMudGFibGVUZW1wbGF0ZSA9IG5ldyB0aGlzLlRhYmxlVGVtcGxhdGUoeyBjb2x1bW5UZW1wbGF0ZXM6IFtdIH0pO1xuICAgIC8vIHVzZSBkZWZhdWx0IHBvcHVwIHNldHRpbmdzIGZvciBmaWVsZCB2aXNpYmlsaXR5XG4gICAgY29uc3QgZmllbGRJbmZvcyA9IHRoaXMucG9wdXBVdGlscy5jcmVhdGVGaWVsZEluZm9zKHtcbiAgICAgIGZpZWxkczogbGF5ZXIuZmllbGRzLFxuICAgICAgb2JqZWN0SWRGaWVsZDogbGF5ZXIub2JqZWN0SWRGaWVsZFxuICAgIH0pO1xuICAgIGNvbnN0IGZpZWxkSW5mb3NNYXAgPSBuZXcgTWFwKGZpZWxkSW5mb3MubWFwKChmaWVsZEluZm8pID0+IFtcbiAgICAgIGZpZWxkSW5mby5maWVsZE5hbWUsXG4gICAgICBmaWVsZEluZm9cbiAgICBdKSk7XG4gICAgbGV0IHBvcHVwRmllbGRzTWFwO1xuICAgIGlmICgoX2EgPSBsYXllci5wb3B1cFRlbXBsYXRlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmllbGRJbmZvcykge1xuICAgICAgY29uc3QgeyBwb3B1cFRlbXBsYXRlIH0gPSBsYXllcjtcbiAgICAgIHBvcHVwRmllbGRzTWFwID0gbmV3IE1hcChwb3B1cFRlbXBsYXRlLmZpZWxkSW5mb3MubWFwKChmaWVsZEluZm8pID0+IFtcbiAgICAgICAgZmllbGRJbmZvLmZpZWxkTmFtZSxcbiAgICAgICAgZmllbGRJbmZvXG4gICAgICBdKSk7XG4gICAgICAvKiBwb3B1cFRlbXBsYXRlLmZpZWxkSW5mb3MuZm9yRWFjaCgoZmllbGRJbmZvOiBGaWVsZEluZm8pID0+IHtcbiAgICAgICAgaWYgKGZpZWxkSW5mby5maWVsZE5hbWUuc3RhcnRzV2l0aChcImV4cHJlc3Npb24vXCIpKSB7XG4gICAgICAgICAgLy8gVE9ET1xuICAgICAgICB9IGVsc2UgaWYgKGZpZWxkSW5mby5maWVsZE5hbWUuc3RhcnRzV2l0aChcInJlbGF0aW9uc2hpcHMvXCIpKSB7XG4gICAgICAgICAgLy8gVE9ET1xuICAgICAgICB9XG4gICAgICB9KTsgKi9cbiAgICAgIC8vIHdhdGNoIGZvciBjaGFuZ2VzXG4gICAgICB0aGlzLnJlYWN0aXZlVXRpbHMud2F0Y2goKCkgPT4gbGF5ZXIucG9wdXBUZW1wbGF0ZSwgKCkgPT4ge1xuICAgICAgICBjb25zdCB7IHBvcHVwVGVtcGxhdGUgfSA9IGxheWVyO1xuICAgICAgICB0aGlzLnRhYmxlVGVtcGxhdGUuY29sdW1uVGVtcGxhdGVzLmZvckVhY2goKGNvbHVtblRlbXBsYXRlKSA9PiB7XG4gICAgICAgICAgcG9wdXBUZW1wbGF0ZS5maWVsZEluZm9zLmZvckVhY2goKGZpZWxkSW5mbykgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbHVtblRlbXBsYXRlLmZpZWxkTmFtZSA9PT0gZmllbGRJbmZvLmZpZWxkTmFtZSkge1xuICAgICAgICAgICAgICBjb2x1bW5UZW1wbGF0ZS5sYWJlbCA9IGZpZWxkSW5mby5sYWJlbDtcbiAgICAgICAgICAgICAgY29sdW1uVGVtcGxhdGUuZm9ybWF0ID0gZmllbGRJbmZvLmZvcm1hdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudXBkYXRlVGFibGUodGhpcy50YWJsZVRlbXBsYXRlKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBsYXllci5maWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgIGlmIChmaWVsZC50eXBlID09PSBcImdlb21ldHJ5XCIpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgZmllbGRJbmZvID0gZmllbGRJbmZvc01hcC5nZXQoZmllbGQubmFtZSk7XG4gICAgICBjb25zdCBwb3B1cEZpZWxkSW5mbyA9IHBvcHVwRmllbGRzTWFwID09PSBudWxsIHx8IHBvcHVwRmllbGRzTWFwID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3B1cEZpZWxkc01hcC5nZXQoZmllbGQubmFtZSk7XG4gICAgICBjb25zdCBmaWVsZENvbHVtblRlbXBsYXRlID0ge1xuICAgICAgICBmaWVsZE5hbWU6IGZpZWxkLm5hbWUsXG4gICAgICAgIGxhYmVsOiAocG9wdXBGaWVsZEluZm8gPT09IG51bGwgfHwgcG9wdXBGaWVsZEluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcHVwRmllbGRJbmZvLmxhYmVsKSB8fCBmaWVsZC5hbGlhcyB8fCBmaWVsZC5uYW1lLFxuICAgICAgICB2aXNpYmxlOiBmaWVsZEluZm8gPT09IG51bGwgfHwgZmllbGRJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZEluZm8udmlzaWJsZSxcbiAgICAgICAgZm9ybWF0OiAocG9wdXBGaWVsZEluZm8gPT09IG51bGwgfHwgcG9wdXBGaWVsZEluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcHVwRmllbGRJbmZvLmZvcm1hdCkgfHwgdGhpcy5nZXREZWZhdWx0Rm9ybWF0KGZpZWxkKSxcbiAgICAgICAgbWVudUNvbmZpZzogZ2V0TWVudUNvbmZpZyhmaWVsZC5uYW1lKVxuICAgICAgfTsgLyogRmllbGRDb2x1bW5UZW1wbGF0ZSAqL1xuICAgICAgdGhpcy50YWJsZVRlbXBsYXRlLmNvbHVtblRlbXBsYXRlcy5wdXNoKGZpZWxkQ29sdW1uVGVtcGxhdGUpO1xuICAgIH0pO1xuICB9XG4gIGdldERlZmF1bHRGb3JtYXQoZmllbGQpIHtcbiAgICBpZiAoW1wiaW50ZWdlclwiLCBcInNtYWxsLWludGVnZXJcIiwgXCJiaWctaW50ZWdlclwiXS5pbmRleE9mKGZpZWxkLnR5cGUpID4gLTEpIHtcbiAgICAgIHJldHVybiBuZXcgdGhpcy5GaWVsZEluZm9Gb3JtYXQoeyBkaWdpdFNlcGFyYXRvcjogZmFsc2UsIHBsYWNlczogMCB9KTtcbiAgICB9XG4gICAgZWxzZSBpZiAoW1wic2luZ2xlXCIsIFwiZG91YmxlXCIsIFwibG9uZ1wiXS5pbmRleE9mKGZpZWxkLnR5cGUpID4gLTEpIHtcbiAgICAgIHJldHVybiBuZXcgdGhpcy5GaWVsZEluZm9Gb3JtYXQoe1xuICAgICAgICBkaWdpdFNlcGFyYXRvcjogZmFsc2UsXG4gICAgICAgIHBsYWNlczogMlxuICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKFtcImRhdGVcIiwgXCJ0aW1lLW9ubHlcIiwgXCJ0aW1lc3RhbXAtb2Zmc2V0XCJdLmluZGV4T2YoZmllbGQudHlwZSkgPiAtMSkge1xuICAgICAgcmV0dXJuIG5ldyB0aGlzLkZpZWxkSW5mb0Zvcm1hdCh7XG4gICAgICAgIGRhdGVGb3JtYXQ6IFwic2hvcnQtZGF0ZS1zaG9ydC10aW1lXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIGlmIChcImRhdGUtb25seVwiID09PSBmaWVsZC50eXBlKSB7XG4gICAgICByZXR1cm4gbmV3IHRoaXMuRmllbGRJbmZvRm9ybWF0KHtcbiAgICAgICAgZGF0ZUZvcm1hdDogXCJzaG9ydC1kYXRlXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG4gIGRpc3BsYXlDb3VudCgpIHtcbiAgICBjb25zdCB7IHN0cmluZ3MsIHBhbmVsTm9kZSwgcmVjb3Jkc0NvdW50LCBzZWxlY3RlZENvdW50LCBzdXBwb3J0c1NlbGVjdGlvbiwgaW50bCB9ID0gdGhpcztcbiAgICBpZiAoIXBhbmVsTm9kZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyA9IGludGwuY29udmVydE51bWJlckZvcm1hdFRvSW50bE9wdGlvbnMoe1xuICAgICAgZGlnaXRTZXBhcmF0b3I6IHRydWVcbiAgICB9KTtcbiAgICBjb25zdCByZWNvcmRzQ291bnRTdHIgPSBpbnRsLmZvcm1hdE51bWJlcihyZWNvcmRzQ291bnQsIG51bWJlckZvcm1hdEludGxPcHRpb25zKTtcbiAgICBpZiAoIWlzRGVmaW5lZChzZWxlY3RlZENvdW50KSB8fCAhc3VwcG9ydHNTZWxlY3Rpb24pIHtcbiAgICAgIGlmIChyZWNvcmRzQ291bnQgPT09IDApIHtcbiAgICAgICAgcGFuZWxOb2RlLmRlc2NyaXB0aW9uID0gc3RyaW5ncy56ZXJvUmVjb3JkcztcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHJlY29yZHNDb3VudCA9PT0gMSkge1xuICAgICAgICBwYW5lbE5vZGUuZGVzY3JpcHRpb24gPSBzdHJpbmdzLm9uZVJlY29yZDtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBwYW5lbE5vZGUuZGVzY3JpcHRpb24gPSBzdHJpbmdzLm51bVJlY29yZHMucmVwbGFjZShcIiR7Y291bnR9XCIsIGAke3JlY29yZHNDb3VudFN0cn1gKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoc2VsZWN0ZWRDb3VudCA9PT0gMCkge1xuICAgICAgaWYgKHJlY29yZHNDb3VudCA9PT0gMCkge1xuICAgICAgICBwYW5lbE5vZGUuZGVzY3JpcHRpb24gPSBzdHJpbmdzLnplcm9SZWNvcmRzWmVyb1NlbDtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHJlY29yZHNDb3VudCA9PT0gMSkge1xuICAgICAgICBwYW5lbE5vZGUuZGVzY3JpcHRpb24gPSBzdHJpbmdzLm9uZVJlY29yZFplcm9TZWw7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgcGFuZWxOb2RlLmRlc2NyaXB0aW9uID0gc3RyaW5ncy5udW1SZWNvcmRzWmVyb1NlbC5yZXBsYWNlKFwiJHtjb3VudH1cIiwgYCR7cmVjb3Jkc0NvdW50U3RyfWApO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChzZWxlY3RlZENvdW50ID09PSAxKSB7XG4gICAgICBpZiAocmVjb3Jkc0NvdW50ID09PSAwKSB7XG4gICAgICAgIHBhbmVsTm9kZS5kZXNjcmlwdGlvbiA9IHN0cmluZ3MuemVyb1JlY29yZHNPbmVTZWw7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChyZWNvcmRzQ291bnQgPT09IDEpIHtcbiAgICAgICAgcGFuZWxOb2RlLmRlc2NyaXB0aW9uID0gc3RyaW5ncy5vbmVSZWNvcmRPbmVTZWw7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgcGFuZWxOb2RlLmRlc2NyaXB0aW9uID0gc3RyaW5ncy5udW1SZWNvcmRzT25lU2VsLnJlcGxhY2UoXCIke2NvdW50fVwiLCBgJHtyZWNvcmRzQ291bnRTdHJ9YCk7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgLy8gbiBzZWxlY3RlZFxuICAgICAgY29uc3Qgc2VsZWN0ZWRDb3VudFN0ciA9IGludGwuZm9ybWF0TnVtYmVyKHNlbGVjdGVkQ291bnQsIG51bWJlckZvcm1hdEludGxPcHRpb25zKTtcbiAgICAgIGlmIChyZWNvcmRzQ291bnQgPT09IDApIHtcbiAgICAgICAgcGFuZWxOb2RlLmRlc2NyaXB0aW9uID0gc3RyaW5ncy56ZXJvUmVjb3Jkc051bVNlbC5yZXBsYWNlKFwiJHtjb3VudFNlbH1cIiwgYCR7c2VsZWN0ZWRDb3VudFN0cn1gKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHJlY29yZHNDb3VudCA9PT0gMSkge1xuICAgICAgICBwYW5lbE5vZGUuZGVzY3JpcHRpb24gPSBzdHJpbmdzLm9uZVJlY29yZE51bVNlbC5yZXBsYWNlKFwiJHtjb3VudFNlbH1cIiwgYCR7c2VsZWN0ZWRDb3VudFN0cn1gKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBwYW5lbE5vZGUuZGVzY3JpcHRpb24gPSBzdHJpbmdzLm51bVJlY29yZHNOdW1TZWxcbiAgICAgICAgICAucmVwbGFjZShcIiR7Y291bnR9XCIsIGAke3JlY29yZHNDb3VudFN0cn1gKVxuICAgICAgICAgIC5yZXBsYWNlKFwiJHtjb3VudFNlbH1cIiwgYCR7c2VsZWN0ZWRDb3VudFN0cn1gKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgYXN5bmMgbG9hZEFsbE1vZHVsZXMoKSB7XG4gICAgY29uc3QgW0ZlYXR1cmVUYWJsZSwgVGFibGVUZW1wbGF0ZSwgcG9wdXBVdGlscywgcmVhY3RpdmVVdGlscywgRmllbGRJbmZvRm9ybWF0LCBRdWVyeSwgaW1hZ2VTZXJ2aWNlLCBNb3NhaWNSdWxlLCBHcmFwaGljLCBpbnRsXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcbiAgICAgIFwiZXNyaS93aWRnZXRzL0ZlYXR1cmVUYWJsZVwiLFxuICAgICAgXCJlc3JpL3dpZGdldHMvRmVhdHVyZVRhYmxlL3N1cHBvcnQvVGFibGVUZW1wbGF0ZVwiLFxuICAgICAgXCJlc3JpL3N1cHBvcnQvcG9wdXBVdGlsc1wiLFxuICAgICAgXCJlc3JpL2NvcmUvcmVhY3RpdmVVdGlsc1wiLFxuICAgICAgXCJlc3JpL3BvcHVwL3N1cHBvcnQvRmllbGRJbmZvRm9ybWF0XCIsXG4gICAgICBcImVzcmkvcmVzdC9zdXBwb3J0L1F1ZXJ5XCIsXG4gICAgICBcImVzcmkvcmVzdC9pbWFnZVNlcnZpY2VcIixcbiAgICAgIFwiZXNyaS9sYXllcnMvc3VwcG9ydC9Nb3NhaWNSdWxlXCIsXG4gICAgICBcImVzcmkvR3JhcGhpY1wiLFxuICAgICAgXCJlc3JpL2ludGxcIlxuICAgIF0pO1xuICAgIHRoaXMuRmVhdHVyZVRhYmxlID0gRmVhdHVyZVRhYmxlO1xuICAgIHRoaXMuVGFibGVUZW1wbGF0ZSA9IFRhYmxlVGVtcGxhdGU7XG4gICAgdGhpcy5wb3B1cFV0aWxzID0gcG9wdXBVdGlscztcbiAgICB0aGlzLnJlYWN0aXZlVXRpbHMgPSByZWFjdGl2ZVV0aWxzO1xuICAgIHRoaXMuRmllbGRJbmZvRm9ybWF0ID0gRmllbGRJbmZvRm9ybWF0O1xuICAgIHRoaXMuUXVlcnkgPSBRdWVyeTtcbiAgICB0aGlzLmltYWdlU2VydmljZSA9IGltYWdlU2VydmljZTtcbiAgICB0aGlzLk1vc2FpY1J1bGUgPSBNb3NhaWNSdWxlO1xuICAgIHRoaXMuR3JhcGhpYyA9IEdyYXBoaWM7XG4gICAgdGhpcy5pbnRsID0gaW50bDtcbiAgfVxuICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzVGFibGUuc3R5bGUgPSBhcmNnaXNUYWJsZUNzcztcblxuY29uc3QgQ1NTJDEgPSB7XG4gIHBvcG92ZXI6IFwicG9wb3ZlclwiLFxuICBmbG93OiBcImZsb3dcIixcbiAgaW5mbzogXCJpbmZvXCJcbn07XG5cbmNvbnN0IGFyY2dpc1RhYmxlQ29sdW1uSW5mb0NzcyA9IFwiLmZsb3d7bWF4LWhlaWdodDo0MDBweH0uaW5mb3tiYWNrZ3JvdW5kLWNvbG9yOiNmZmZmZmY7bWF4LWhlaWdodDo0MDBweDt3aWR0aDoyMHZ3O21heC13aWR0aDo0MjBweDttaW4td2lkdGg6MjQwcHh9XCI7XG5cbmNvbnN0IEFyY2dpc1RhYmxlQ29sdW1uSW5mbyA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNUYWJsZUNvbHVtbkluZm9DbG9zZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzVGFibGVDb2x1bW5JbmZvQ2xvc2VcIiwgNyk7XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5hZnRlckNyZWF0ZVBvcG92ZXIgPSAobm9kZSkgPT4ge1xuICAgICAgdGhpcy5wb3BvdmVyTm9kZSA9IG5vZGU7XG4gICAgfTtcbiAgICB0aGlzLmFmdGVyQ3JlYXRlQ2xvc2VCdXR0b24gPSAobm9kZSkgPT4ge1xuICAgICAgdGhpcy5jbG9zZUJ1dHRvbk5vZGUgPSBub2RlO1xuICAgIH07XG4gICAgdGhpcy5hZnRlckNyZWF0ZUZpZWxkSW5mbyA9IChub2RlKSA9PiB7XG4gICAgICBub2RlLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNGaWVsZEluZm9Db21wbGV0ZVwiLCAoKSA9PiB0aGlzLnJlcG9zaXRpb24oKSk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZUNsb3NlQ2xpY2sgPSAoKSA9PiB7XG4gICAgICB0aGlzLmFyY2dpc1RhYmxlQ29sdW1uSW5mb0Nsb3NlLmVtaXQoKTtcbiAgICB9O1xuICAgIHRoaXMucHJvcHMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5maWVsZE5hbWUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wb3BvdmVyUmVmZXJlbmNlRWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnN0cmluZ3MgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jdXJyZW50TGFuZ3VhZ2UgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcbiAgICB0aGlzLnJlUmVuZGVyID0gZmFsc2U7XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUHVibGljIE1ldGhvZHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBhc3luYyByZXBvc2l0aW9uKCkge1xuICAgIHZhciBfYTtcbiAgICAoX2EgPSB0aGlzLnBvcG92ZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVwb3NpdGlvbigpO1xuICB9XG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIExpZmVjeWNsZVxuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgdGhpcy5maWVsZHNNYXAgPSBhd2FpdCBnZW5lcmF0ZUxheWVyRmllbGRzTWFwKGxheWVyKTtcbiAgfVxuICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgIHRoaXMucmVwb3NpdGlvbigpO1xuICAgIHRoaXMuaXNPcGVuID0gdHJ1ZTtcbiAgICAvLyBuZWVkIHRpbWVvdXQgYmVjYXVzZSBvZiByZS1yZW5kZXJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmNsb3NlQnV0dG9uTm9kZS5zZXRGb2N1cygpKSwgMTAwKTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBmaWVsZE5hbWUsIGZpZWxkc01hcCwgcG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQgfSA9IHRoaXM7XG4gICAgY29uc3QgZmllbGQgPSBmaWVsZHNNYXAuZ2V0KGZpZWxkTmFtZSk7XG4gICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwianMtYXBwLWZseW91dFwiIH0sIGgoXCJjYWxjaXRlLXBvcG92ZXJcIiwgeyBwbGFjZW1lbnQ6IFwibGVhZGluZ1wiLCBkaXI6IGRvY3VtZW50LmRpciwgb3BlbjogdGhpcy5pc09wZW4sIHBvaW50ZXJEaXNhYmxlZDogdHJ1ZSwgcmVmZXJlbmNlRWxlbWVudDogcG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQsIG9mZnNldERpc3RhbmNlOiAtNDgsIG9mZnNldFNraWRkaW5nOiAwLCBjbGFzczogQ1NTJDEucG9wb3ZlciwgbGFiZWw6IFwiXCIsIHJlZjogdGhpcy5hZnRlckNyZWF0ZVBvcG92ZXIgfSwgaChcImNhbGNpdGUtZmxvd1wiLCB7IGNsYXNzOiBDU1MkMS5mbG93IH0sIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IGhlYWRpbmc6IGZpZWxkLmFsaWFzIHx8IGZpZWxkLm5hbWUsIGRlc2NyaXB0aW9uOiBmaWVsZE5hbWUgfSwgdGhpcy5yZW5kZXJDbG9zZUJ1dHRvbigpLCB0aGlzLnJlbmRlckluZm8oKSkpKSkpO1xuICB9XG4gIHJlbmRlckNsb3NlQnV0dG9uKCkge1xuICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHRleHQ6IHN0cmluZ3MuY2xvc2UsIHNjYWxlOiBcInNcIiwgc2xvdDogXCJoZWFkZXItYWN0aW9ucy1lbmRcIiwgb25DbGljazogdGhpcy5oYW5kbGVDbG9zZUNsaWNrLCByZWY6IHRoaXMuYWZ0ZXJDcmVhdGVDbG9zZUJ1dHRvbiwgaWNvbjogXCJ4XCIgfSkpO1xuICB9XG4gIHJlbmRlckluZm8oKSB7XG4gICAgY29uc3QgeyBsYXllciwgdmlldyB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGZpZWxkTmFtZSwgY3VycmVudExhbmd1YWdlIH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChcImFyY2dpcy1maWVsZC1pbmZvXCIsIHsgZmllbGROYW1lOiBmaWVsZE5hbWUsIGxheWVyOiBsYXllciwgdmlldzogdmlldywgbGFuZzogY3VycmVudExhbmd1YWdlLCBjbGFzczogQ1NTJDEuaW5mbywgcmVmOiB0aGlzLmFmdGVyQ3JlYXRlRmllbGRJbmZvIH0pKTtcbiAgfVxuICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzVGFibGVDb2x1bW5JbmZvLnN0eWxlID0gYXJjZ2lzVGFibGVDb2x1bW5JbmZvQ3NzO1xuXG5jb25zdCBDU1MgPSB7XG4gIHBvcG92ZXI6IFwicG9wb3ZlclwiLFxuICBmbG93OiBcImZsb3dcIixcbiAgaW5mbzogXCJpbmZvXCIsXG4gIHNlbGVjdEJ1dHRvbjogXCJzZWxlY3QtYnV0dG9uXCJcbn07XG5cbmNvbnN0IGFyY2dpc1RhYmxlRmllbGRTZWxlY3Rpb25Dc3MgPSBcIi5mbG93e21heC1oZWlnaHQ6NDAwcHg7d2lkdGg6MjgwcHh9LmNvbnRlbnR7bWF4LWhlaWdodDo4MHZofS5pbmZve2JhY2tncm91bmQtY29sb3I6I2ZmZmZmZn0uc2VsZWN0LWJ1dHRvbnttYXJnaW46NHB4IDB9XCI7XG5cbmNvbnN0IEFyY2dpc1RhYmxlRmllbGRTZWxlY3Rpb24gPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzVGFibGVGaWVsZFNlbGVjdGlvbkNsb3NlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNUYWJsZUZpZWxkU2VsZWN0aW9uQ2xvc2VcIiwgNyk7XG4gICAgdGhpcy5jb2x1bW5UZW1wbGF0ZXNDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImNvbHVtblRlbXBsYXRlc0NoYW5nZVwiLCA3KTtcbiAgICB0aGlzLmZpZWxkU29ydEJ5Q2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJmaWVsZFNvcnRCeUNoYW5nZVwiLCA3KTtcbiAgICB0aGlzLmF0dGFjaG1lbnRzQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhdHRhY2htZW50c0NoYW5nZVwiLCA3KTtcbiAgICB0aGlzLndhaXRIYW5kbGVyID0gbnVsbDtcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICB0aGlzLmFmdGVyQ3JlYXRlUG9wb3ZlciA9IChub2RlKSA9PiB7XG4gICAgICB0aGlzLnBvcG92ZXJOb2RlID0gbm9kZTtcbiAgICB9O1xuICAgIHRoaXMuYWZ0ZXJDcmVhdGVGbG93ID0gKG5vZGUpID0+IHtcbiAgICAgIHRoaXMuZmxvd05vZGUgPSBub2RlO1xuICAgIH07XG4gICAgdGhpcy5hZnRlckNyZWF0ZUZsb3dJdGVtID0gKG5vZGUpID0+IHtcbiAgICAgIHRoaXMuZmlyc3RQYW5lbE5vZGUgPSBub2RlO1xuICAgIH07XG4gICAgdGhpcy5hZnRlckNyZWF0ZUNsb3NlQnV0dG9uID0gKG5vZGUpID0+IHtcbiAgICAgIHRoaXMuY2xvc2VCdXR0b25Ob2RlID0gbm9kZTtcbiAgICB9O1xuICAgIHRoaXMuYWZ0ZXJDcmVhdGVQaWNrTGlzdCA9IChub2RlKSA9PiB7XG4gICAgICB0aGlzLnBpY2tMaXN0Tm9kZSA9IG5vZGU7XG4gICAgfTtcbiAgICB0aGlzLmFmdGVyQ3JlYXRlUGlja0xpc3RJdGVtID0gKG5vZGUpID0+IHtcbiAgICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcihcImNhbGNpdGVMaXN0SXRlbUNoYW5nZVwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVDYWxjaXRlTGlzdEl0ZW1DaGFuZ2UoZXZlbnQpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB0aGlzLmFmdGVyQ3JlYXRlUGlja0xpc3RJdGVtQXR0YWNobWVudHMgPSAobm9kZSkgPT4ge1xuICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKFwiY2FsY2l0ZUxpc3RJdGVtQ2hhbmdlXCIsIChldmVudCkgPT4ge1xuICAgICAgICB0aGlzLmhhbmRsZUNhbGNpdGVBdHRhY2htZW50c0l0ZW1DaGFuZ2UoZXZlbnQpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZUNsb3NlQ2xpY2sgPSAoKSA9PiB7XG4gICAgICB0aGlzLmFyY2dpc1RhYmxlRmllbGRTZWxlY3Rpb25DbG9zZS5lbWl0KCk7XG4gICAgfTtcbiAgICB0aGlzLnByb3BzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuY29sdW1uVGVtcGxhdGVzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuYXR0YWNobWVudHNFbmFibGVkID0gZmFsc2U7XG4gICAgdGhpcy5wb3BvdmVyUmVmZXJlbmNlRWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNvcnRCeSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnN0cmluZ3MgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jdXJyZW50TGFuZ3VhZ2UgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5yZVJlbmRlciA9IGZhbHNlO1xuICAgIHRoaXMubGFzdFNvcnRCeSA9IExhc3RTb3J0eUJ5LmRpc3BsYXk7XG4gICAgdGhpcy5maWx0ZXJGaWVsZHMgPSBudWxsO1xuICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUHVibGljIE1ldGhvZHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBhc3luYyByZXBvc2l0aW9uKCkge1xuICAgIHZhciBfYTtcbiAgICAoX2EgPSB0aGlzLnBvcG92ZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVwb3NpdGlvbigpO1xuICB9XG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIExpZmVjeWNsZVxuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgdGhpcy5maWVsZHNNYXAgPSBhd2FpdCBnZW5lcmF0ZUxheWVyRmllbGRzTWFwKGxheWVyKTtcbiAgICB0aGlzLnRvdGFsQ291bnRzID0gdGhpcy5nZXRUb3RhbEZpZWxkVHlwZUNvdW50KCk7XG4gICAgdGhpcy5sYXN0U29ydEJ5ID0gdGhpcy5zb3J0QnkgfHwgTGFzdFNvcnR5QnkuZGVmYXVsdDtcbiAgfVxuICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgIHRoaXMucmVwb3NpdGlvbigpO1xuICAgIHRoaXMuaXNPcGVuID0gdHJ1ZTtcbiAgICAvLyBuZWVkIHRpbWVvdXQgYmVjYXVzZSBvZiByZS1yZW5kZXJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmNsb3NlQnV0dG9uTm9kZS5zZXRGb2N1cygpKSwgMjAwKTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzLCBwb3BvdmVyUmVmZXJlbmNlRWxlbWVudCB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJqcy1hcHAtZmx5b3V0XCIgfSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IHBsYWNlbWVudDogXCJsZWFkaW5nXCIsIGRpcjogZG9jdW1lbnQuZGlyLCBvcGVuOiB0aGlzLmlzT3BlbiwgcG9pbnRlckRpc2FibGVkOiB0cnVlLCByZWZlcmVuY2VFbGVtZW50OiBwb3BvdmVyUmVmZXJlbmNlRWxlbWVudCwgb2Zmc2V0RGlzdGFuY2U6IC00OCwgb2Zmc2V0U2tpZGRpbmc6IDAsIGNsYXNzOiBDU1MucG9wb3ZlciwgbGFiZWw6IFwiXCIsIHJlZjogdGhpcy5hZnRlckNyZWF0ZVBvcG92ZXIgfSwgaChcImNhbGNpdGUtZmxvd1wiLCB7IGNsYXNzOiBDU1MuZmxvdywgcmVmOiB0aGlzLmFmdGVyQ3JlYXRlRmxvdyB9LCBoKFwiY2FsY2l0ZS1mbG93LWl0ZW1cIiwgeyBoZWFkaW5nOiBzdHJpbmdzLmZpZWxkVmlzaWJpbGl0eSwgcmVmOiB0aGlzLmFmdGVyQ3JlYXRlRmxvd0l0ZW0gfSwgdGhpcy5yZW5kZXJDbG9zZUJ1dHRvbigpLCB0aGlzLnJlbmRlckRvbmVCdXR0b24oKSwgdGhpcy5yZW5kZXJQaWNrTGlzdCgpKSkpKSk7XG4gIH1cbiAgcmVuZGVyQ2xvc2VCdXR0b24oKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzIH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgdGV4dDogc3RyaW5ncy5jbG9zZSwgc2NhbGU6IFwic1wiLCBzbG90OiBcImhlYWRlci1hY3Rpb25zLWVuZFwiLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNsb3NlQ2xpY2ssIGljb246IFwieFwiLCByZWY6IHRoaXMuYWZ0ZXJDcmVhdGVDbG9zZUJ1dHRvbiB9KSk7XG4gIH1cbiAgcmVuZGVyRG9uZUJ1dHRvbigpIHtcbiAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBzY2FsZTogXCJtXCIsIHNsb3Q6IFwiZm9vdGVyXCIsIHdpZHRoOiBcImZ1bGxcIiwgb25DbGljazogdGhpcy5oYW5kbGVDbG9zZUNsaWNrLCBsYWJlbDogc3RyaW5ncy5kb25lIH0sIHN0cmluZ3MuZG9uZSkpO1xuICB9XG4gIHJlbmRlclBpY2tMaXN0KCkge1xuICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLXBpY2stbGlzdFwiLCB7IGNsYXNzOiBcImNvbnRlbnRcIiwgXCJkcmFnLWVuYWJsZWRcIjogZmFsc2UsIG11bHRpcGxlOiB0cnVlLCBmaWx0ZXJFbmFibGVkOiB0cnVlLCBmaWx0ZXJQbGFjZWhvbGRlcjogc3RyaW5ncy5maWx0ZXJGaWVsZHMsIHJlZjogdGhpcy5hZnRlckNyZWF0ZVBpY2tMaXN0LCBvbkNhbGNpdGVMaXN0RmlsdGVyOiAoZXZlbnQpID0+IHtcbiAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgdGhpcy5maWx0ZXJGaWVsZHMgPSBub2RlLmZpbHRlcmVkSXRlbXM7XG4gICAgICB9IH0sIHRoaXMucmVuZGVyU2VsZWN0aW9uKCksIHRoaXMucmVuZGVyU29ydCgpLCB0aGlzLnJlbmRlclBpY2tMaXN0SXRlbXMoKSwgdGhpcy5yZW5kZXJBdHRhY2htZW50UGlja0xpc3RJdGVtKCkpKTtcbiAgfVxuICByZW5kZXJTZWxlY3Rpb24oKSB7XG4gICAgY29uc3QgeyBmaWx0ZXJGaWVsZHMsIHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgY29uc3QgY29udGFpbnNBbGwgPSB0aGlzLmZpbHRlckNvbnRhaW5zQWxsKCk7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBrZXk6IGAke2ZpbHRlckZpZWxkc31gLCBjbGFzczogQ1NTLnNlbGVjdEJ1dHRvbiwgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBzY2FsZTogXCJzXCIsIHdpZHRoOiBcImZ1bGxcIiwgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVTZWxlY3Rpb25BbGxDbGljayhjb250YWluc0FsbCksIGxhYmVsOiBjb250YWluc0FsbCA/IHN0cmluZ3MuZGVzZWxlY3RBbGwgOiBzdHJpbmdzLnNlbGVjdEFsbCB9LCBjb250YWluc0FsbCA/IHN0cmluZ3MuZGVzZWxlY3RBbGwgOiBzdHJpbmdzLnNlbGVjdEFsbCkpO1xuICB9XG4gIHJlbmRlclNvcnQoKSB7XG4gICAgY29uc3QgeyBsYXN0U29ydEJ5LCB0b3RhbENvdW50cywgc3RyaW5ncyB9ID0gdGhpcztcbiAgICBsZXQgaGFzTnVtYmVyRmllbGRzID0gdG90YWxDb3VudHMubnVtYmVyID4gMDtcbiAgICBsZXQgaGFzU3RyaW5nRmllbGRzID0gdG90YWxDb3VudHMuc3RyaW5nID4gMDtcbiAgICBsZXQgaGFzRGF0ZUZpZWxkcyA9IHRvdGFsQ291bnRzLmRhdGUgPiAwO1xuICAgIGxldCBjYW5TaG93U29ydCA9IGhhc051bWJlckZpZWxkcyAmJiAoaGFzU3RyaW5nRmllbGRzIHx8IGhhc0RhdGVGaWVsZHMpXG4gICAgICA/IHRydWVcbiAgICAgIDogaGFzU3RyaW5nRmllbGRzICYmIGhhc0RhdGVGaWVsZHNcbiAgICAgICAgPyB0cnVlXG4gICAgICAgIDogZmFsc2U7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1kcm9wZG93blwiLCB7IHNsb3Q6IFwibWVudS1hY3Rpb25zXCIsIHBsYWNlbWVudDogXCJib3R0b20tZW5kXCIsIG92ZXJsYXlQb3NpdGlvbmluZzogXCJmaXhlZFwiIH0sIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHNsb3Q6IFwidHJpZ2dlclwiLCB0ZXh0OiBzdHJpbmdzLnNvcnRGaWVsZHMsIGxhYmVsOiBzdHJpbmdzLnNvcnRGaWVsZHMsIFwiYXJpYS1sYWJlbFwiOiBzdHJpbmdzLnNvcnRGaWVsZHMgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgaWNvbjogXCJzb3J0RGVzY2VuZGluZ1wiIH0pKSwgaChcImNhbGNpdGUtZHJvcGRvd24tZ3JvdXBcIiwgeyBcImdyb3VwLXRpdGxlXCI6IHN0cmluZ3Muc29ydEJ5IH0sIGgoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIiwgeyBzZWxlY3RlZDogbGFzdFNvcnRCeSA9PT0gTGFzdFNvcnR5QnkuZGVmYXVsdCwgb25DbGljazogKCkgPT4ge1xuICAgICAgICB0aGlzLmxhc3RTb3J0QnkgPSBMYXN0U29ydHlCeS5kZWZhdWx0O1xuICAgICAgICB0aGlzLmZpZWxkU29ydEJ5Q2hhbmdlLmVtaXQodGhpcy5sYXN0U29ydEJ5KTtcbiAgICAgIH0gfSwgc3RyaW5ncy5kZWZhdWx0KSwgaChcImNhbGNpdGUtZHJvcGRvd24taXRlbVwiLCB7IHNlbGVjdGVkOiBsYXN0U29ydEJ5ID09PSBMYXN0U29ydHlCeS5kaXNwbGF5LCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgIHRoaXMubGFzdFNvcnRCeSA9IExhc3RTb3J0eUJ5LmRpc3BsYXk7XG4gICAgICAgIHRoaXMuZmllbGRTb3J0QnlDaGFuZ2UuZW1pdCh0aGlzLmxhc3RTb3J0QnkpO1xuICAgICAgfSB9LCBzdHJpbmdzLnNvcnRCeURpc3BsYXlOYW1lKSwgY2FuU2hvd1NvcnQgPyAoaChcImNhbGNpdGUtZHJvcGRvd24taXRlbVwiLCB7IHNlbGVjdGVkOiBsYXN0U29ydEJ5ID09PSBMYXN0U29ydHlCeS50eXBlLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgIHRoaXMubGFzdFNvcnRCeSA9IExhc3RTb3J0eUJ5LnR5cGU7XG4gICAgICAgIHRoaXMuZmllbGRTb3J0QnlDaGFuZ2UuZW1pdCh0aGlzLmxhc3RTb3J0QnkpO1xuICAgICAgfSB9LCBzdHJpbmdzLnNvcnRCeVR5cGUpKSA6IG51bGwsIGgoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIiwgeyBzZWxlY3RlZDogbGFzdFNvcnRCeSA9PT0gTGFzdFNvcnR5QnkuZmllbGQsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgdGhpcy5sYXN0U29ydEJ5ID0gTGFzdFNvcnR5QnkuZmllbGQ7XG4gICAgICAgIHRoaXMuZmllbGRTb3J0QnlDaGFuZ2UuZW1pdCh0aGlzLmxhc3RTb3J0QnkpO1xuICAgICAgfSB9LCBzdHJpbmdzLnNvcnRCeUZpZWxkTmFtZSkpKSk7XG4gIH1cbiAgcmVuZGVyUGlja0xpc3RJdGVtcygpIHtcbiAgICBjb25zdCB7IGxhc3RTb3J0QnkgfSA9IHRoaXM7XG4gICAgbGV0IGNvbHVtblRlbXBsYXRlcyA9IHRoaXMuY2xvbmVGaWVsZFRlbXBsYXRlcygpO1xuICAgIGlmIChsYXN0U29ydEJ5ID09PSBMYXN0U29ydHlCeS5kaXNwbGF5KSB7XG4gICAgICBjb2x1bW5UZW1wbGF0ZXMgPSB0aGlzLnNvcnRGaWVsZHNBbHBoYWJldGljYWxseShjb2x1bW5UZW1wbGF0ZXMpO1xuICAgIH1cbiAgICBlbHNlIGlmIChsYXN0U29ydEJ5ID09PSBMYXN0U29ydHlCeS50eXBlKSB7XG4gICAgICBjb2x1bW5UZW1wbGF0ZXMgPSB0aGlzLnNvcnRGaWVsZHNCeVR5cGUodGhpcy5zb3J0RmllbGRzQWxwaGFiZXRpY2FsbHkoY29sdW1uVGVtcGxhdGVzKSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGxhc3RTb3J0QnkgPT09IExhc3RTb3J0eUJ5LmZpZWxkKSB7XG4gICAgICBjb2x1bW5UZW1wbGF0ZXMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICByZXR1cm4gYS5maWVsZE5hbWUubG9jYWxlQ29tcGFyZShiLmZpZWxkTmFtZSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSA7XG4gICAgcmV0dXJuIGNvbHVtblRlbXBsYXRlcy5tYXAoKGNvbHVtblRlbXBsYXRlKSA9PiB0aGlzLnJlbmRlclBpY2tMaXN0SXRlbShjb2x1bW5UZW1wbGF0ZSkpO1xuICB9XG4gIHJlbmRlclBpY2tMaXN0SXRlbShjb2x1bW5UZW1wbGF0ZSkge1xuICAgIGNvbnN0IHsgc3RyaW5ncywgZmlsdGVyRmllbGRzIH0gPSB0aGlzO1xuICAgIGxldCBpc0hpZGRlbiA9IGZhbHNlO1xuICAgIGlmIChmaWx0ZXJGaWVsZHMgJiZcbiAgICAgICFmaWx0ZXJGaWVsZHMuc29tZSgoZmlsdGVyRmllbGQpID0+IGZpbHRlckZpZWxkLnZhbHVlID09PSBjb2x1bW5UZW1wbGF0ZS5maWVsZE5hbWUpKSB7XG4gICAgICBpc0hpZGRlbiA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiAoaChcImNhbGNpdGUtcGljay1saXN0LWl0ZW1cIiwgeyBrZXk6IGNvbHVtblRlbXBsYXRlLmZpZWxkTmFtZSwgbGFiZWw6IGNvbHVtblRlbXBsYXRlLmxhYmVsLFxuICAgICAgLy9kZXNjcmlwdGlvbj17ZmllbGRDb25maWcubmFtZX1cbiAgICAgIHZhbHVlOiBjb2x1bW5UZW1wbGF0ZS5maWVsZE5hbWUsIHNlbGVjdGVkOiBjb2x1bW5UZW1wbGF0ZS52aXNpYmxlLCBoaWRkZW46IGlzSGlkZGVuLCByZWY6IHRoaXMuYWZ0ZXJDcmVhdGVQaWNrTGlzdEl0ZW0gfSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgc2xvdDogXCJhY3Rpb25zLWVuZFwiLCB0ZXh0OiBzdHJpbmdzLmluZm8sIG9uQ2xpY2s6IChldmVudCkgPT4ge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5oYW5kbGVJbmZvQ2xpY2soY29sdW1uVGVtcGxhdGUsIGV2ZW50LnRhcmdldCk7XG4gICAgICB9IH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBzY2FsZTogXCJzXCIsIGljb246IFwiaW5mb3JtYXRpb25cIiB9KSkpKTtcbiAgfVxuICByZW5kZXJBdHRhY2htZW50UGlja0xpc3RJdGVtKCkge1xuICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBzdHJpbmdzLCBhdHRhY2htZW50c0VuYWJsZWQgfSA9IHRoaXM7XG4gICAgaWYgKGxheWVyLnR5cGUgPT09IFwiaW1hZ2VyeVwiKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgaWYgKGxheWVyLnR5cGUgPT09IFwiZmVhdHVyZVwiICYmICFoYXNBdHRhY2htZW50c0VuYWJsZWQobGF5ZXIpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1waWNrLWxpc3QtaXRlbVwiLCB7IGtleTogXCJhdHRhY2htZW50c1wiLCBsYWJlbDogc3RyaW5ncy5waG90b3NBbmRGaWxlcywgZGVzY3JpcHRpb246IHN0cmluZ3MuYXR0YWNobWVudHMsIHZhbHVlOiBcIl9fYXR0YWNobWVudHNcIiwgc2VsZWN0ZWQ6IGF0dGFjaG1lbnRzRW5hYmxlZCwgaGlkZGVuOiBmYWxzZSwgcmVmOiB0aGlzLmFmdGVyQ3JlYXRlUGlja0xpc3RJdGVtQXR0YWNobWVudHMgfSkpO1xuICB9XG4gIGhhbmRsZVNlbGVjdGlvbkFsbENsaWNrKGNvbnRhaW5zQWxsKSB7XG4gICAgY29uc3QgeyBjb2x1bW5UZW1wbGF0ZXMsIGZpbHRlckZpZWxkcyB9ID0gdGhpcztcbiAgICAvLyB1cGRhdGUgZmllbGRDb25maWdzXG4gICAgY29sdW1uVGVtcGxhdGVzLmZvckVhY2goKGNvbHVtblRlbXBsYXRlKSA9PiB7XG4gICAgICBpZiAoIWZpbHRlckZpZWxkcyB8fFxuICAgICAgICBmaWx0ZXJGaWVsZHMuc29tZSgoZmlsdGVyRmllbGQpID0+IGZpbHRlckZpZWxkLnZhbHVlID09PSBjb2x1bW5UZW1wbGF0ZS5maWVsZE5hbWUpKSB7XG4gICAgICAgIGNvbHVtblRlbXBsYXRlLnZpc2libGUgPSAhY29udGFpbnNBbGw7XG4gICAgICB9XG4gICAgfSk7XG4gICAgLy8gdXBkYXRlIHBpY2stbGlzdC1pdGVtc1xuICAgIHRoaXMucGlja0xpc3ROb2RlXG4gICAgICAucXVlcnlTZWxlY3RvckFsbChcImNhbGNpdGUtcGljay1saXN0LWl0ZW1cIilcbiAgICAgIC5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICBpZiAoIWZpbHRlckZpZWxkcyB8fFxuICAgICAgICBmaWx0ZXJGaWVsZHMuc29tZSgoZmlsdGVyRmllbGQpID0+IGZpbHRlckZpZWxkLnZhbHVlID09PSBpdGVtLmdldEF0dHJpYnV0ZShcInZhbHVlXCIpKSkge1xuICAgICAgICBpZiAoIWNvbnRhaW5zQWxsKSB7XG4gICAgICAgICAgaXRlbS5zZXRBdHRyaWJ1dGUoXCJzZWxlY3RlZFwiLCBcInRydWVcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgaXRlbS5yZW1vdmVBdHRyaWJ1dGUoXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMucmVSZW5kZXIgPSAhdGhpcy5yZVJlbmRlcjtcbiAgfVxuICBoYW5kbGVDYWxjaXRlTGlzdEl0ZW1DaGFuZ2UoeyBkZXRhaWw6IHsgdmFsdWUsIHNlbGVjdGVkIH0gfSkge1xuICAgIGNvbnN0IHsgY29sdW1uVGVtcGxhdGVzIH0gPSB0aGlzO1xuICAgIGNvbHVtblRlbXBsYXRlcy5mb3JFYWNoKChjb2x1bW5UZW1wbGF0ZSkgPT4ge1xuICAgICAgaWYgKGNvbHVtblRlbXBsYXRlLmZpZWxkTmFtZSA9PT0gdmFsdWUpIHtcbiAgICAgICAgY29sdW1uVGVtcGxhdGUudmlzaWJsZSA9IHNlbGVjdGVkO1xuICAgICAgfVxuICAgIH0pO1xuICAgIC8vIGRvbid0IGZpcmUgdG9vIG1hbnkgdXBkYXRlcyBhdCBvbmNlXG4gICAgLy8gZS5nLiBhZnRlciBhIHVzZXIgY2xpY2tzICdTZWxlY3QgYWxsJ1xuICAgIGlmICh0aGlzLndhaXRIYW5kbGVyKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy53YWl0SGFuZGxlcik7XG4gICAgfVxuICAgIHRoaXMud2FpdEhhbmRsZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMud2FpdEhhbmRsZXIgPSBudWxsO1xuICAgICAgdGhpcy5jb2x1bW5UZW1wbGF0ZXNDaGFuZ2UuZW1pdCh0aGlzLmNsb25lRmllbGRUZW1wbGF0ZXMoKSk7XG4gICAgICAvLyBjYXVzZXMgYSBzdGF0ZSBjaGFuZ2VcbiAgICAgIHRoaXMucmVSZW5kZXIgPSAhdGhpcy5yZVJlbmRlcjtcbiAgICB9LCAxMDApO1xuICB9XG4gIGhhbmRsZUNhbGNpdGVBdHRhY2htZW50c0l0ZW1DaGFuZ2UoeyBkZXRhaWw6IHsgc2VsZWN0ZWQgfSB9KSB7XG4gICAgdGhpcy5hdHRhY2htZW50c0NoYW5nZS5lbWl0KHNlbGVjdGVkKTtcbiAgICB0aGlzLmF0dGFjaG1lbnRzRW5hYmxlZCA9IHNlbGVjdGVkO1xuICB9XG4gIGhhbmRsZUluZm9DbGljayhjb2x1bW5UZW1wbGF0ZSwgYWN0aW9uKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgbGF5ZXIsIHZpZXcgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBmbG93Tm9kZSwgZmlyc3RQYW5lbE5vZGUsIGN1cnJlbnRMYW5ndWFnZSB9ID0gdGhpcztcbiAgICBjb25zdCByZWN0ID0gZmlyc3RQYW5lbE5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgY29uc3QgZmllbGRJbmZvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1maWVsZC1pbmZvXCIpO1xuICAgIGZpZWxkSW5mby5sYW5nID0gY3VycmVudExhbmd1YWdlO1xuICAgIGZpZWxkSW5mby5maWVsZE5hbWUgPSBjb2x1bW5UZW1wbGF0ZS5maWVsZE5hbWU7XG4gICAgZmllbGRJbmZvLmxheWVyID0gbGF5ZXI7XG4gICAgZmllbGRJbmZvLnZpZXcgPSB2aWV3O1xuICAgIGZpZWxkSW5mby5jbGFzc05hbWUgPSBDU1MuaW5mbztcbiAgICBjb25zdCBmaWVsZEluZm9GbG93SXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYWxjaXRlLWZsb3ctaXRlbVwiKTtcbiAgICBmaWVsZEluZm9GbG93SXRlbS5oZWFkaW5nID0gKF9hID0gY29sdW1uVGVtcGxhdGUubGFiZWwpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGNvbHVtblRlbXBsYXRlLmZpZWxkTmFtZTtcbiAgICBmaWVsZEluZm9GbG93SXRlbS5kZXNjcmlwdGlvbiA9IGNvbHVtblRlbXBsYXRlLmZpZWxkTmFtZTtcbiAgICAvLyBtYWtpbmcgdGhlIHN3aXRjaCBzbW9vdGhseVxuICAgIGZpZWxkSW5mb0Zsb3dJdGVtLnN0eWxlLmhlaWdodCA9IGAke3JlY3QuaGVpZ2h0fXB4YDtcbiAgICBmaWVsZEluZm9GbG93SXRlbS5zdHlsZS53aWR0aCA9IGAke3JlY3Qud2lkdGh9cHhgO1xuICAgIGZpZWxkSW5mb0Zsb3dJdGVtLmFwcGVuZENoaWxkKGZpZWxkSW5mbyk7XG4gICAgZmllbGRJbmZvRmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImNhbGNpdGVGbG93SXRlbUJhY2tcIiwgKCkgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IGFjdGlvbi5zZXRGb2N1cygpKSk7XG4gICAgZmxvd05vZGUuYXBwZW5kQ2hpbGQoZmllbGRJbmZvRmxvd0l0ZW0pO1xuICAgIHNldFRpbWVvdXQoKCkgPT4gZmllbGRJbmZvRmxvd0l0ZW0uc2V0Rm9jdXMoKSwgMjAwKTtcbiAgICB0aGlzLnJlcG9zaXRpb24oKTtcbiAgfVxuICBjbG9uZUZpZWxkVGVtcGxhdGVzKCkge1xuICAgIHJldHVybiB0aGlzLmNvbHVtblRlbXBsYXRlcy5tYXAoKGNvbHVtblRlbXBsYXRlKSA9PiB7XG4gICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgY29sdW1uVGVtcGxhdGUpO1xuICAgIH0pO1xuICB9XG4gIC8vIGNoZWNrIGlmIGZpbHRlciBjb250YWlucyBhbGwgY3VycmVudCBmaWVsZCBjb25maWdzXG4gIGZpbHRlckNvbnRhaW5zQWxsKCkge1xuICAgIGNvbnN0IHsgY29sdW1uVGVtcGxhdGVzLCBmaWx0ZXJGaWVsZHMsIGF0dGFjaG1lbnRzRW5hYmxlZCB9ID0gdGhpcztcbiAgICBpZiAoZmlsdGVyRmllbGRzKSB7XG4gICAgICAvLyBhdHRhY2htZW50IGNvbHVtbiBpcyBwYXJ0IG9mIHRoZSBmaWx0ZXIsIGJ1dCBub3QgcGFydCBvZiB0aGUgZmllbGRDb25maWdzXG4gICAgICBjb25zdCBmaWx0ZXJGaWVsZHNGaWVsZHMgPSBmaWx0ZXJGaWVsZHNcbiAgICAgICAgLmZpbHRlcigoZmlsdGVyRmllbGQpID0+IGZpbHRlckZpZWxkLnZhbHVlICE9PSBcIl9fYXR0YWNobWVudHNcIilcbiAgICAgICAgLm1hcCgoZmlsdGVyRmllbGQpID0+ICh7IHZhbHVlOiBmaWx0ZXJGaWVsZC52YWx1ZSwgc2VsZWN0ZWQ6IGZpbHRlckZpZWxkLnNlbGVjdGVkIH0pKTtcbiAgICAgIGNvbnN0IGZpZWxkQ29uZmlnc0luRmlsdGVyID0gY29sdW1uVGVtcGxhdGVzLmZpbHRlcigoY29sdW1uVGVtcGxhdGUpID0+IGZpbHRlckZpZWxkc0ZpZWxkcy5zb21lKChmaWx0ZXJGaWVsZCkgPT4gY29sdW1uVGVtcGxhdGUuZmllbGROYW1lID09PSBmaWx0ZXJGaWVsZC52YWx1ZSkpO1xuICAgICAgbGV0IGhhc0F0dGFjaG1lbnRzID0gZmlsdGVyRmllbGRzLmxlbmd0aCAhPT0gZmlsdGVyRmllbGRzRmllbGRzLmxlbmd0aDtcbiAgICAgIGNvbnN0IGNvbnRhaW5zQWxsID0gZmlsdGVyRmllbGRzRmllbGRzLmV2ZXJ5KChmaWx0ZXIpID0+ICFmaWVsZENvbmZpZ3NJbkZpbHRlci5zb21lKChjb2x1bW5UZW1wbGF0ZSkgPT4gY29sdW1uVGVtcGxhdGUuZmllbGROYW1lID09PSBmaWx0ZXIudmFsdWUgJiYgIWNvbHVtblRlbXBsYXRlLnZpc2libGUpKTtcbiAgICAgIHJldHVybiBjb250YWluc0FsbCAmJiAoKGhhc0F0dGFjaG1lbnRzICYmIGF0dGFjaG1lbnRzRW5hYmxlZCkgfHwgIWhhc0F0dGFjaG1lbnRzKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXR1cm4gIWNvbHVtblRlbXBsYXRlcy5zb21lKChjb2x1bW5UZW1wbGF0ZSkgPT4ge1xuICAgICAgICByZXR1cm4gIWNvbHVtblRlbXBsYXRlLnZpc2libGU7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgZ2V0VG90YWxGaWVsZFR5cGVDb3VudCgpIHtcbiAgICBjb25zdCB7IGNvbHVtblRlbXBsYXRlcywgZmllbGRzTWFwIH0gPSB0aGlzO1xuICAgIGNvbnN0IGNvdW50cyA9IHsgc3RyaW5nOiAwLCBudW1iZXI6IDAsIGRhdGU6IDAgfTtcbiAgICBjb2x1bW5UZW1wbGF0ZXMuZm9yRWFjaCgoY29sdW1uVGVtcGxhdGUpID0+IHtcbiAgICAgIGNvbnN0IGZpZWxkID0gZmllbGRzTWFwLmdldChjb2x1bW5UZW1wbGF0ZS5maWVsZE5hbWUpO1xuICAgICAgc3dpdGNoIChmaWVsZC50eXBlKSB7XG4gICAgICAgIGNhc2UgXCJzbWFsbC1pbnRlZ2VyXCI6XG4gICAgICAgIGNhc2UgXCJiaWctaW50ZWdlclwiOlxuICAgICAgICBjYXNlIFwiaW50ZWdlclwiOlxuICAgICAgICBjYXNlIFwic2luZ2xlXCI6XG4gICAgICAgIGNhc2UgXCJkb3VibGVcIjpcbiAgICAgICAgY2FzZSBcImxvbmdcIjpcbiAgICAgICAgY2FzZSBcIm9pZFwiOlxuICAgICAgICBjYXNlIFwiZ3VpZFwiOlxuICAgICAgICAgIGNvdW50cy5udW1iZXIrKztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInN0cmluZ1wiOlxuICAgICAgICAgIGNvdW50cy5zdHJpbmcrKztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImRhdGVcIjpcbiAgICAgICAgY2FzZSBcImRhdGUtb25seVwiOlxuICAgICAgICBjYXNlIFwidGltZS1vbmx5XCI6XG4gICAgICAgIGNhc2UgXCJ0aW1lc3RhbXAtb2Zmc2V0XCI6XG4gICAgICAgICAgY291bnRzLmRhdGUrKztcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gY291bnRzO1xuICB9XG4gIHNvcnRGaWVsZHNBbHBoYWJldGljYWxseShjb2x1bW5UZW1wbGF0ZXMpIHtcbiAgICByZXR1cm4gY29sdW1uVGVtcGxhdGVzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIHJldHVybiBhLmxhYmVsLmNoYXJBdCgwKSA9PT0gXCJfXCJcbiAgICAgICAgPyAxXG4gICAgICAgIDogYi5sYWJlbC5jaGFyQXQoMCkgPT09IFwiX1wiXG4gICAgICAgICAgPyAtMVxuICAgICAgICAgIDogYS5sYWJlbC5sb2NhbGVDb21wYXJlKGIubGFiZWwpO1xuICAgIH0pO1xuICB9XG4gIHNvcnRGaWVsZHNCeVR5cGUoY29sdW1uVGVtcGxhdGVzKSB7XG4gICAgLy8gb3JkZXI6IG51bWJlciwgc3RyaW5nLCBkYXRlLCBvaWQsIGd1aWRcbiAgICBjb25zdCB7IGZpZWxkc01hcCB9ID0gdGhpcztcbiAgICByZXR1cm4gY29sdW1uVGVtcGxhdGVzXG4gICAgICAuZmlsdGVyKChjb2x1bW5UZW1wbGF0ZSkgPT4gW1wic21hbGwtaW50ZWdlclwiLCBcImJpZy1pbnRlZ2VyXCIsIFwiaW50ZWdlclwiLCBcInNpbmdsZVwiLCBcImRvdWJsZVwiLCBcImxvbmdcIl0uaW5kZXhPZihmaWVsZHNNYXAuZ2V0KGNvbHVtblRlbXBsYXRlLmZpZWxkTmFtZSkudHlwZSkgPiAtMSlcbiAgICAgIC5tYXAoKGNvbHVtblRlbXBsYXRlKSA9PiB7XG4gICAgICByZXR1cm4gY29sdW1uVGVtcGxhdGU7XG4gICAgfSlcbiAgICAgIC5jb25jYXQoY29sdW1uVGVtcGxhdGVzXG4gICAgICAuZmlsdGVyKChjb2x1bW5UZW1wbGF0ZSkgPT4gZmllbGRzTWFwLmdldChjb2x1bW5UZW1wbGF0ZS5maWVsZE5hbWUpLnR5cGUgPT09IFwic3RyaW5nXCIpXG4gICAgICAubWFwKChjb2x1bW5UZW1wbGF0ZSkgPT4ge1xuICAgICAgcmV0dXJuIGNvbHVtblRlbXBsYXRlO1xuICAgIH0pKVxuICAgICAgLmNvbmNhdChjb2x1bW5UZW1wbGF0ZXNcbiAgICAgIC5maWx0ZXIoKGNvbHVtblRlbXBsYXRlKSA9PiBbXCJkYXRlXCIsIFwiZGF0ZS1vbmx5XCIsIFwidGltZS1vbmx5XCIsIFwidGltZXN0YW1wLW9mZnNldFwiXS5pbmRleE9mKGZpZWxkc01hcC5nZXQoY29sdW1uVGVtcGxhdGUuZmllbGROYW1lKS50eXBlKSA+IC0xKVxuICAgICAgLm1hcCgoY29sdW1uVGVtcGxhdGUpID0+IHtcbiAgICAgIHJldHVybiBjb2x1bW5UZW1wbGF0ZTtcbiAgICB9KSlcbiAgICAgIC5jb25jYXQoY29sdW1uVGVtcGxhdGVzXG4gICAgICAuZmlsdGVyKChjb2x1bW5UZW1wbGF0ZSkgPT4gZmllbGRzTWFwLmdldChjb2x1bW5UZW1wbGF0ZS5maWVsZE5hbWUpLnR5cGUgPT09IFwib2lkXCIpXG4gICAgICAubWFwKChjb2x1bW5UZW1wbGF0ZSkgPT4ge1xuICAgICAgcmV0dXJuIGNvbHVtblRlbXBsYXRlO1xuICAgIH0pKVxuICAgICAgLmNvbmNhdChjb2x1bW5UZW1wbGF0ZXNcbiAgICAgIC5maWx0ZXIoKGNvbHVtblRlbXBsYXRlKSA9PiBmaWVsZHNNYXAuZ2V0KGNvbHVtblRlbXBsYXRlLmZpZWxkTmFtZSkudHlwZSA9PT0gXCJndWlkXCIpXG4gICAgICAubWFwKChjb2x1bW5UZW1wbGF0ZSkgPT4ge1xuICAgICAgcmV0dXJuIGNvbHVtblRlbXBsYXRlO1xuICAgIH0pKVxuICAgICAgLmNvbmNhdChjb2x1bW5UZW1wbGF0ZXNcbiAgICAgIC5maWx0ZXIoKGNvbHVtblRlbXBsYXRlKSA9PiBbXG4gICAgICBcInNtYWxsLWludGVnZXJcIixcbiAgICAgIFwiYmlnLWludGVnZXJcIixcbiAgICAgIFwiaW50ZWdlclwiLFxuICAgICAgXCJzaW5nbGVcIixcbiAgICAgIFwiZG91YmxlXCIsXG4gICAgICBcImxvbmdcIixcbiAgICAgIFwic3RyaW5nXCIsXG4gICAgICBcImRhdGVcIixcbiAgICAgIFwiZGF0ZS1vbmx5XCIsXG4gICAgICBcInRpbWUtb25seVwiLFxuICAgICAgXCJ0aW1lc3RhbXAtb2Zmc2V0XCIsXG4gICAgICBcIm9pZFwiLFxuICAgICAgXCJndWlkXCJcbiAgICBdLmluZGV4T2YoZmllbGRzTWFwLmdldChjb2x1bW5UZW1wbGF0ZS5maWVsZE5hbWUpLnR5cGUpID09PSAtMSlcbiAgICAgIC5tYXAoKGNvbHVtblRlbXBsYXRlKSA9PiB7XG4gICAgICByZXR1cm4gY29sdW1uVGVtcGxhdGU7XG4gICAgfSkpO1xuICB9XG4gIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNUYWJsZUZpZWxkU2VsZWN0aW9uLnN0eWxlID0gYXJjZ2lzVGFibGVGaWVsZFNlbGVjdGlvbkNzcztcblxuZXhwb3J0IHsgQXJjZ2lzVGFibGUgYXMgYXJjZ2lzX3RhYmxlLCBBcmNnaXNUYWJsZUNvbHVtbkluZm8gYXMgYXJjZ2lzX3RhYmxlX2NvbHVtbl9pbmZvLCBBcmNnaXNUYWJsZUZpZWxkU2VsZWN0aW9uIGFzIGFyY2dpc190YWJsZV9maWVsZF9zZWxlY3Rpb24gfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xudmFyIHNjYWxlcztcbihmdW5jdGlvbiAoc2NhbGVzKSB7XG4gIHNjYWxlc1tcIlNNQUxMXCJdID0gXCJzXCI7XG4gIHNjYWxlc1tcIk1FRElVTVwiXSA9IFwibVwiO1xuICBzY2FsZXNbXCJMQVJHRVwiXSA9IFwibFwiO1xufSkoc2NhbGVzIHx8IChzY2FsZXMgPSB7fSkpO1xuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIHZhbHVlIGlzIGRlZmluZWRcbiAqIEBwYXJhbSB2YWx1ZSAtIHZhbHVlIHRvIGNoZWNrXG4gKi9cbmZ1bmN0aW9uIGlzRGVmaW5lZCh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbDtcbn1cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIG5vZGUgaGFzIG5vZGVOYW1lIG9yIGlzIGNvbnRhaW5lZCBpbiBhIHBhcmVudCBub2RlIHdpdGggbm9kZU5hbWVcbiAqIEBwYXJhbSBub2RlXG4gKiBAcGFyYW0gbm9kZU5hbWVcbiAqL1xuZnVuY3Rpb24gaXNJbk5vZGUobm9kZSwgbm9kZU5hbWUpIHtcbiAgd2hpbGUgKG5vZGUpIHtcbiAgICBpZiAobm9kZS5ub2RlTmFtZSA9PT0gbm9kZU5hbWUudG9VcHBlckNhc2UoKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIG5vZGUgPSBub2RlLnBhcmVudEVsZW1lbnQ7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5leHBvcnQgeyBpc0RlZmluZWQgYXMgYSwgaXNJbk5vZGUgYXMgaSwgc2NhbGVzIGFzIHMgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgeyBsIGFzIGxhbmd1YWdlTWFwIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtMjIyNThjOTAuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRBc3NldFBhdGggfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcblxuLy8gaHR0cHM6Ly9tZWRpdW0uY29tL3N0ZW5jaWwtdHJpY2tzL2ltcGxlbWVudGluZy1pbnRlcm5hdGlvbmFsaXNhdGlvbi1pMThuLXdpdGgtc3RlbmNpbC01ZTY1NTk1NTQxMTdcbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KSB7XG4gIHZhciBfYSwgX2IsIF9jO1xuICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICB9XG4gIGVsc2Uge1xuICAgIC8vIFwicnUtUlVcIiBtYXBzIHRvIFwicnVcIiB1c2UgY2FzZVxuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZy5zbGljZSgwLCAyKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCkge1xuICB2YXIgX2EsIF9iLCBfYztcbiAgLy8gaXQncyBPSyBpZiB3ZSBkb24ndCBoYXZlIHRoZSA0IGxldHRlciBsYW5ndWFnZSBmaWxlIGZvciBpdFxuICAvLyA0IGxldHRlciBsYW5ndWFnZSBjb2RlIG5lZWRlZCBmb3IgZm9ybWF0dGluZyBudW1iZXJzXG4gIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgLy8gd2Ugc3VwcG9ydCB0aGUgMiBsZXR0ZXIgY29kZWQgbGFuZ3VhZ2VcbiAgICAgIC8vIGUuZy4gaXQtQ0ggdnMgaXRcbiAgICAgIHJldHVybiBsYW5nO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBcImVuXCI7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgZmV0Y2goZ2V0QXNzZXRQYXRoKGAuLi9hcmNnaXMtYXBwLWFzc2V0cy9pMThuLyR7Y29tcG9uZW50TmFtZX0uaTE4bi4ke2xvY2FsZX0uanNvbmApKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgIGlmIChyZXN1bHQub2spXG4gICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XG4gICAgICBlbHNlXG4gICAgICAgIHJlamVjdCgpO1xuICAgIH0sICgpID0+IHJlamVjdCgpKTtcbiAgfSk7XG59XG5jb25zdCBzdHJpbmdDYWNoZSA9IHt9O1xuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICBjb25zdCBpZCA9IGAke2NvbXBvbmVudE5hbWV9JHtsb2NhbGV9YDtcbiAgaWYgKCFzdHJpbmdDYWNoZVtpZF0pIHtcbiAgICBzdHJpbmdDYWNoZVtpZF0gPSBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKTtcbiAgfVxuICByZXR1cm4gc3RyaW5nQ2FjaGVbaWRdO1xufVxuLyoqXG4gKiBHZXQgc3RyaW5ncyBhbmQgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGlzIG1ldGhvZCByZXR1cm5zIDIgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGUgZmlyc3Qgb25lIHJldHVybnMgYSBjb2RlIHRoYXQncyBhbHNvIHN1cHBvcnRlZCBhcyBhIGxhbmd1YWdlIGZpbGUuXG4gKiBUaGUgc2Vjb25kIG9uZSByZXR1cm5zIGEgY29kZSB3aGVyZSB0aGVyZSBpcyBzdXBwb3J0IGZvciB0aGUgZmlyc3QgMiBsZXR0ZXJzIG9mIHRoZSBjb2RlIGFzIHBhcnQgb2YgYSBsYW5ndWFnZSBmaWxlLFxuICogYnV0IHdpbGwgcmV0dXJuIHRoZSBvcmlnaW5hbCA0IGxldHRlciBjb2RlIGZyb20gdGhlIHBhZ2UuXG4gKiBFLmcuIEZvciBcIml0LWNoXCIgaXQgd2lsbCByZXR1cm4gXCJpdFwiIGFzIHRoZSBmaXJzdCBsYW5ndWFnZSBjb2RlIGFuZCBcIml0LWNoXCIgYXMgdGhlIHNlY29uZC5cbiAqIFRoZSBzZWNvbmQgb25lIGlzIHJlcXVpcmVkIGZvciBlc3JpLmludGwuc2V0TG9jYWxlKCkgdG8gZ2V0IHRoZSBjb3JyZWN0IGZvcm1hdHRpbmcuXG4gKlxuICogSWYgYSB0YWdOYW1lIGlzIHByb3ZpZGVkIGl0IHdpbGwgb3ZlcndpdGUgdGhlIGVsZW1lbnQncyB0YWdOYW1lXG4gKlxuICogIEByZXR1cm4gWyBzdHJpbmdzLCBmaXJzdCBsYW5ndWFnZSBjb2RlLCBzZWNvbmQgbGFuZ3VhZ2UgY29kZV1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyhlbGVtZW50LCB0YWdOYW1lKSB7XG4gIGNvbnN0IGNvbXBvbmVudE5hbWUgPSB0YWdOYW1lIHx8IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCBjb21wb25lbnRMYW5ndWFnZSA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KTtcbiAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2VJbnRsID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KTtcbiAgbGV0IHN0cmluZ3M7XG4gIHRyeSB7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBjb21wb25lbnRMYW5ndWFnZSk7XG4gIH1cbiAgY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLndhcm4oYG5vIGxvY2FsZSBmb3IgJHtjb21wb25lbnROYW1lfSAoJHtjb21wb25lbnRMYW5ndWFnZX0pIGxvYWRpbmcgZGVmYXVsdCBsb2NhbGUgZW4uYCk7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBcImVuXCIpO1xuICB9XG4gIHJldHVybiBbc3RyaW5ncywgY29tcG9uZW50TGFuZ3VhZ2UsIGNvbXBvbmVudExhbmd1YWdlSW50bF07XG59XG5cbmV4cG9ydCB7IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZSBhcyBhLCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIGFzIGcgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==