"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-new-ite-78f5cf"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js":
/*!**************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addItemState),
/* harmony export */   b: () => (/* binding */ addItemUrlState),
/* harmony export */   c: () => (/* binding */ addItemRequestState),
/* harmony export */   d: () => (/* binding */ addItemStore)
/* harmony export */ });
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const addItemStore = (0,_index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__.c)({
  typeKeywords: [],
  customParameters: [],
  analyzedLocationTypes: [],
  allowStoredAuth: true,
  isSecured: null,
  checkAuth: false
});
// Entire add item state object
const addItemState = addItemStore.state;
// Subsets of add item state
const addItemRequestState = addItemStore.state;
const addItemUrlState = addItemStore.state;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-data-store-select.entry.js":
/*!******************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-data-store-select.entry.js ***!
  \******************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_data_store_select: () => (/* binding */ ArcgisNewItemPagesDataStoreSelect)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _data_store_e8b5ce2f_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./data-store-e8b5ce2f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/data-store-e8b5ce2f.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */











const arcgisNewItemPagesDataStoreSelectCss = ".tile-select-group{margin-top:1.25rem}.tile-select{margin-bottom:0.125rem}.dynamic-header{display:block;margin-bottom:1.5rem;margin-top:1.5rem}";

const ArcgisNewItemPagesDataStoreSelect = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.options = {
      folder: {
        page: "dataStoreSelectFolder",
        enabled: true
      },
      database: {
        page: "dataStoreSelectDatabaseType",
        enabled: true
      },
      cloud: {
        page: "dataStoreSelectCloud",
        enabled: true
      },
      bdfs: {
        page: "dataStoreSelectBdfs",
        enabled: false
      }
    };
    this.cloudOptions = ["amazon", "azure"];
    this.databaseOptions = [
      "bigQuery",
      "snowflake"
    ];
    this.selected = "folder";
    this.pipelineCloudSelection = "amazon";
    this.pipelineDatabaseSelection = "bigQuery";
    this.serverList = [];
  }
  async componentWillLoad() {
    const portal = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal;
    const user = portal.portalUser;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_3__.a.newItemMode = "dataStore";
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_4__.u.i18n.dataStoreSelect;
    this.isPortal = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal;
    if (this.isPortal) {
      this.selected = "folder";
    }
    else {
      this.selected = "database";
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_3__.a.typeKeywords = ["Data Store connection"];
    }
    this.tileStrings = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_4__.u.i18n.dataStoreSelectDatabase.pipelineProviders;
    this.serverList = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.l)(user, portal);
    this.filterServers();
  }
  filterServers() {
    if (!_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal) {
      // Online -- only cloud stores are currently supported
      this.options.folder.enabled = false;
      this.options.database.enabled = true;
      this.options.cloud.enabled = true;
      this.options.bdfs.enabled = false;
      return;
    }
    // Enterprise
    // get the hosting server so we know what the server admin endpoint is
    const hostingServer = this.serverList.filter(function (server) {
      return server.serverRole.toUpperCase() === "HOSTING_SERVER";
    });
    // set hosting server or show error
    if (hostingServer.length) {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_3__.a.hostingServer = hostingServer[0];
    }
    // Filter the GeoAnalytics servers to decide if "Big Data File Share" option should be available
    const geoAnalyticsServer = this.serverList.filter(function (server) {
      return server.serverFunction.toUpperCase().indexOf("GEOANALYTICS") > -1;
    });
    // Get the length of GeoAnalytics servers array
    const bdfsEnabled = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.config.bdfsEnabled;
    this.options.bdfs.enabled = !!(geoAnalyticsServer === null || geoAnalyticsServer === void 0 ? void 0 : geoAnalyticsServer.length) && bdfsEnabled;
    // Filter the Knowledge servers to decide if "NoSQL option should be available
    const knowledgeServer = this.serverList.filter(function (server) {
      return server.serverFunction.toUpperCase().indexOf("KNOWLEDGE") > -1;
    });
    // Get the length of Knowledge servers array
    const noSqlEnabled = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.config.noSQLEnabled;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_3__.a.noSqlEnabled =
      !!(knowledgeServer === null || knowledgeServer === void 0 ? void 0 : knowledgeServer.length) && noSqlEnabled && !(0,_data_store_e8b5ce2f_js__WEBPACK_IMPORTED_MODULE_5__.i)();
  }
  handleNext() {
    let nextPage;
    const selected = this.selected;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_3__.a.addDataStoreType = selected;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_3__.a.dataStoreSelectServerList = this.serverList;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_3__.a.type = "Data Store";
    if (this.isPortal) {
      nextPage = this.options[selected].page;
    }
    else {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_3__.a.newItemMode = "dataStore";
      if (this.selected === "cloud") {
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_3__.a.addDataStoreType = "cloud";
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_3__.a.provider = this.pipelineCloudSelection;
        nextPage = "dataStoreSelectCloudCredentials";
      }
      else {
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_3__.a.addDataStoreType = "database";
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_3__.a.databaseProvider = this.pipelineDatabaseSelection;
        nextPage = "dataStoreDatabaseCredentials";
      }
    }
    this.newItemUpdatePage.emit(nextPage);
  }
  render() {
    const { i18n, options, cloudOptions, databaseOptions, tileStrings } = this;
    let subOptions = this.selected === "cloud" ? cloudOptions : databaseOptions;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: i18n.heading }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", { layout: "vertical", class: "tile-select-group" }, Object.keys(options).map((key) => {
      let databaseDescription;
      if (this.isPortal) {
        databaseDescription = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_3__.a.noSqlEnabled
          ? i18n.options.database.descriptionNoSql
          : i18n.options.database.description;
      }
      else {
        databaseDescription = i18n.databaseDescriptionForOnline;
      }
      return (options[key].enabled && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { key: key, class: "tile-select", checked: this.selected === key, heading: i18n.options[key].title, description: key === "database" ? databaseDescription : i18n.options[key].description, name: "data-store-selection", "input-enabled": true, width: "full", type: "radio", value: key, onCalciteTileSelectChange: (e) => {
          this.selected = e.target.value;
        } })));
    })), !this.isPortal && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "dynamic-select" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { class: "dynamic-header", header: this.selected === "cloud"
        ? i18n.subOptionsCloudDescription
        : i18n.subOptionsDatabaseDescription }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", { layout: "vertical" }, subOptions.map((key) => {
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { key: key, "input-enabled": true, checked: subOptions[0] === key, width: "full", type: "radio", value: key, heading: tileStrings[key].title, description: tileStrings[key].description, onCalciteTileSelectChange: (e) => {
          if (this.selected === "cloud") {
            this.pipelineCloudSelection = e.target.value;
          }
          else {
            this.pipelineDatabaseSelection = e.target.value;
          }
        } }));
    }))))));
  }
};
ArcgisNewItemPagesDataStoreSelect.style = arcgisNewItemPagesDataStoreSelectCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js":
/*!********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js ***!
  \********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ uiStore),
/* harmony export */   u: () => (/* binding */ uiStoreState)
/* harmony export */ });
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const uiStore = (0,_index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__.c)({
  nextText: "next",
  workflow: "content",
  scale: "m",
  disableScroll: false,
  featureFlags: { tileLayer3dTiles: false }
});
const uiStoreState = uiStore.state;




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLW5ldy1pdGUtNzhmNWNmLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDdUQ7O0FBRXZELHFCQUFxQixxREFBVztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFZ0c7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNwQmhHO0FBQ0E7QUFDQTtBQUNBO0FBQ2lGO0FBQ2pCO0FBQ1I7QUFDRztBQUNOO0FBQzBCO0FBQzVDO0FBQ0Q7QUFDQTtBQUNMOztBQUU3QixpRUFBaUUsbUJBQW1CLGFBQWEsdUJBQXVCLGdCQUFnQixjQUFjLHFCQUFxQixrQkFBa0I7O0FBRTdMO0FBQ0E7QUFDQSxJQUFJLHFEQUFnQjtBQUNwQiw2QkFBNkIscURBQVc7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixrREFBVztBQUM5QjtBQUNBLElBQUksb0RBQVk7QUFDaEIsZ0JBQWdCLDhDQUFZO0FBQzVCLG9CQUFvQixrREFBVztBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSxvREFBWTtBQUNsQjtBQUNBLHVCQUF1Qiw4Q0FBWTtBQUNuQyw0QkFBNEIsc0RBQW1CO0FBQy9DO0FBQ0E7QUFDQTtBQUNBLFNBQVMsa0RBQVc7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsTUFBTSxvREFBWTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLHdCQUF3QixrREFBVztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLHlCQUF5QixrREFBVztBQUNwQyxJQUFJLG9EQUFZO0FBQ2hCLHVIQUF1SCwwREFBOEI7QUFDcko7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLG9EQUFZO0FBQ2hCLElBQUksb0RBQVk7QUFDaEIsSUFBSSxvREFBWTtBQUNoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sb0RBQVk7QUFDbEI7QUFDQSxRQUFRLG9EQUFZO0FBQ3BCLFFBQVEsb0RBQVk7QUFDcEI7QUFDQTtBQUNBO0FBQ0EsUUFBUSxvREFBWTtBQUNwQixRQUFRLG9EQUFZO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksNERBQTREO0FBQ3hFO0FBQ0EsWUFBWSxxREFBQyxjQUFjLHFEQUFDLGtDQUFrQyxzQkFBc0IsR0FBRyxxREFBQyxnQ0FBZ0MsZ0RBQWdEO0FBQ3hLO0FBQ0E7QUFDQSw4QkFBOEIsb0RBQVk7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLHFEQUFDLDBCQUEwQjtBQUNsRTtBQUNBLFdBQVc7QUFDWCxLQUFLLHVCQUF1QixxREFBQyxVQUFVLHlCQUF5QixFQUFFLHFEQUFDLGtDQUFrQztBQUNyRztBQUNBLDhDQUE4QyxHQUFHLHFEQUFDLGdDQUFnQyxvQkFBb0I7QUFDdEcsY0FBYyxxREFBQywwQkFBMEI7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRXdGOzs7Ozs7Ozs7Ozs7Ozs7OztBQzVKeEY7QUFDQTtBQUNBO0FBQ0E7QUFDdUQ7O0FBRXZELGdCQUFnQixxREFBVztBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQixDQUFDO0FBQ0Q7O0FBRTJDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYWRkLWl0ZW0tOTdkNTc3YTkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtc2VsZWN0LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3VpLWVjZjg2YmJhLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVTdG9yZSB9IGZyb20gJy4vaW5kZXgtODFkNTQ4YjcuanMnO1xuXG5jb25zdCBhZGRJdGVtU3RvcmUgPSBjcmVhdGVTdG9yZSh7XG4gIHR5cGVLZXl3b3JkczogW10sXG4gIGN1c3RvbVBhcmFtZXRlcnM6IFtdLFxuICBhbmFseXplZExvY2F0aW9uVHlwZXM6IFtdLFxuICBhbGxvd1N0b3JlZEF1dGg6IHRydWUsXG4gIGlzU2VjdXJlZDogbnVsbCxcbiAgY2hlY2tBdXRoOiBmYWxzZVxufSk7XG4vLyBFbnRpcmUgYWRkIGl0ZW0gc3RhdGUgb2JqZWN0XG5jb25zdCBhZGRJdGVtU3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG4vLyBTdWJzZXRzIG9mIGFkZCBpdGVtIHN0YXRlXG5jb25zdCBhZGRJdGVtUmVxdWVzdFN0YXRlID0gYWRkSXRlbVN0b3JlLnN0YXRlO1xuY29uc3QgYWRkSXRlbVVybFN0YXRlID0gYWRkSXRlbVN0b3JlLnN0YXRlO1xuXG5leHBvcnQgeyBhZGRJdGVtU3RhdGUgYXMgYSwgYWRkSXRlbVVybFN0YXRlIGFzIGIsIGFkZEl0ZW1SZXF1ZXN0U3RhdGUgYXMgYywgYWRkSXRlbVN0b3JlIGFzIGQgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoIH0gZnJvbSAnLi9pbmRleC05MmViYjM5Ni5qcyc7XG5pbXBvcnQgeyBsIGFzIGdldEZlZGVyYXRlZFNlcnZlcnMgfSBmcm9tICcuL3BvcnRhbC03OWNhYWVmZi5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbmZpZ1N0YXRlIH0gZnJvbSAnLi9jb25maWctZWI1ZjdkYzIuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRJdGVtU3RhdGUgfSBmcm9tICcuL2FkZC1pdGVtLTk3ZDU3N2E5LmpzJztcbmltcG9ydCB7IHUgYXMgdWlTdG9yZVN0YXRlIH0gZnJvbSAnLi91aS1lY2Y4NmJiYS5qcyc7XG5pbXBvcnQgeyBpIGFzIGlzQXJjR0lTRW50ZXJwcmlzZU9uS3ViZXJuZXRlcyB9IGZyb20gJy4vZGF0YS1zdG9yZS1lOGI1Y2UyZi5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYWFmMzBiZDYuanMnO1xuaW1wb3J0ICcuL3ByaXZpbGVnZXMtY2NkNWYzN2QuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtYzgyZjVhYjkuanMnO1xuaW1wb3J0ICcuL2luZGV4LTgxZDU0OGI3LmpzJztcblxuY29uc3QgYXJjZ2lzTmV3SXRlbVBhZ2VzRGF0YVN0b3JlU2VsZWN0Q3NzID0gXCIudGlsZS1zZWxlY3QtZ3JvdXB7bWFyZ2luLXRvcDoxLjI1cmVtfS50aWxlLXNlbGVjdHttYXJnaW4tYm90dG9tOjAuMTI1cmVtfS5keW5hbWljLWhlYWRlcntkaXNwbGF5OmJsb2NrO21hcmdpbi1ib3R0b206MS41cmVtO21hcmdpbi10b3A6MS41cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNEYXRhU3RvcmVTZWxlY3QgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1VcGRhdGVQYWdlXCIsIDcpO1xuICAgIHRoaXMub3B0aW9ucyA9IHtcbiAgICAgIGZvbGRlcjoge1xuICAgICAgICBwYWdlOiBcImRhdGFTdG9yZVNlbGVjdEZvbGRlclwiLFxuICAgICAgICBlbmFibGVkOiB0cnVlXG4gICAgICB9LFxuICAgICAgZGF0YWJhc2U6IHtcbiAgICAgICAgcGFnZTogXCJkYXRhU3RvcmVTZWxlY3REYXRhYmFzZVR5cGVcIixcbiAgICAgICAgZW5hYmxlZDogdHJ1ZVxuICAgICAgfSxcbiAgICAgIGNsb3VkOiB7XG4gICAgICAgIHBhZ2U6IFwiZGF0YVN0b3JlU2VsZWN0Q2xvdWRcIixcbiAgICAgICAgZW5hYmxlZDogdHJ1ZVxuICAgICAgfSxcbiAgICAgIGJkZnM6IHtcbiAgICAgICAgcGFnZTogXCJkYXRhU3RvcmVTZWxlY3RCZGZzXCIsXG4gICAgICAgIGVuYWJsZWQ6IGZhbHNlXG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLmNsb3VkT3B0aW9ucyA9IFtcImFtYXpvblwiLCBcImF6dXJlXCJdO1xuICAgIHRoaXMuZGF0YWJhc2VPcHRpb25zID0gW1xuICAgICAgXCJiaWdRdWVyeVwiLFxuICAgICAgXCJzbm93Zmxha2VcIlxuICAgIF07XG4gICAgdGhpcy5zZWxlY3RlZCA9IFwiZm9sZGVyXCI7XG4gICAgdGhpcy5waXBlbGluZUNsb3VkU2VsZWN0aW9uID0gXCJhbWF6b25cIjtcbiAgICB0aGlzLnBpcGVsaW5lRGF0YWJhc2VTZWxlY3Rpb24gPSBcImJpZ1F1ZXJ5XCI7XG4gICAgdGhpcy5zZXJ2ZXJMaXN0ID0gW107XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgY29uc3QgcG9ydGFsID0gY29uZmlnU3RhdGUucG9ydGFsO1xuICAgIGNvbnN0IHVzZXIgPSBwb3J0YWwucG9ydGFsVXNlcjtcbiAgICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPSBcImRhdGFTdG9yZVwiO1xuICAgIHRoaXMuaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuLmRhdGFTdG9yZVNlbGVjdDtcbiAgICB0aGlzLmlzUG9ydGFsID0gY29uZmlnU3RhdGUucG9ydGFsLmlzUG9ydGFsO1xuICAgIGlmICh0aGlzLmlzUG9ydGFsKSB7XG4gICAgICB0aGlzLnNlbGVjdGVkID0gXCJmb2xkZXJcIjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLnNlbGVjdGVkID0gXCJkYXRhYmFzZVwiO1xuICAgICAgYWRkSXRlbVN0YXRlLnR5cGVLZXl3b3JkcyA9IFtcIkRhdGEgU3RvcmUgY29ubmVjdGlvblwiXTtcbiAgICB9XG4gICAgdGhpcy50aWxlU3RyaW5ncyA9IHVpU3RvcmVTdGF0ZS5pMThuLmRhdGFTdG9yZVNlbGVjdERhdGFiYXNlLnBpcGVsaW5lUHJvdmlkZXJzO1xuICAgIHRoaXMuc2VydmVyTGlzdCA9IGF3YWl0IGdldEZlZGVyYXRlZFNlcnZlcnModXNlciwgcG9ydGFsKTtcbiAgICB0aGlzLmZpbHRlclNlcnZlcnMoKTtcbiAgfVxuICBmaWx0ZXJTZXJ2ZXJzKCkge1xuICAgIGlmICghY29uZmlnU3RhdGUucG9ydGFsLmlzUG9ydGFsKSB7XG4gICAgICAvLyBPbmxpbmUgLS0gb25seSBjbG91ZCBzdG9yZXMgYXJlIGN1cnJlbnRseSBzdXBwb3J0ZWRcbiAgICAgIHRoaXMub3B0aW9ucy5mb2xkZXIuZW5hYmxlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5vcHRpb25zLmRhdGFiYXNlLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgdGhpcy5vcHRpb25zLmNsb3VkLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgdGhpcy5vcHRpb25zLmJkZnMuZW5hYmxlZCA9IGZhbHNlO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBFbnRlcnByaXNlXG4gICAgLy8gZ2V0IHRoZSBob3N0aW5nIHNlcnZlciBzbyB3ZSBrbm93IHdoYXQgdGhlIHNlcnZlciBhZG1pbiBlbmRwb2ludCBpc1xuICAgIGNvbnN0IGhvc3RpbmdTZXJ2ZXIgPSB0aGlzLnNlcnZlckxpc3QuZmlsdGVyKGZ1bmN0aW9uIChzZXJ2ZXIpIHtcbiAgICAgIHJldHVybiBzZXJ2ZXIuc2VydmVyUm9sZS50b1VwcGVyQ2FzZSgpID09PSBcIkhPU1RJTkdfU0VSVkVSXCI7XG4gICAgfSk7XG4gICAgLy8gc2V0IGhvc3Rpbmcgc2VydmVyIG9yIHNob3cgZXJyb3JcbiAgICBpZiAoaG9zdGluZ1NlcnZlci5sZW5ndGgpIHtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5ob3N0aW5nU2VydmVyID0gaG9zdGluZ1NlcnZlclswXTtcbiAgICB9XG4gICAgLy8gRmlsdGVyIHRoZSBHZW9BbmFseXRpY3Mgc2VydmVycyB0byBkZWNpZGUgaWYgXCJCaWcgRGF0YSBGaWxlIFNoYXJlXCIgb3B0aW9uIHNob3VsZCBiZSBhdmFpbGFibGVcbiAgICBjb25zdCBnZW9BbmFseXRpY3NTZXJ2ZXIgPSB0aGlzLnNlcnZlckxpc3QuZmlsdGVyKGZ1bmN0aW9uIChzZXJ2ZXIpIHtcbiAgICAgIHJldHVybiBzZXJ2ZXIuc2VydmVyRnVuY3Rpb24udG9VcHBlckNhc2UoKS5pbmRleE9mKFwiR0VPQU5BTFlUSUNTXCIpID4gLTE7XG4gICAgfSk7XG4gICAgLy8gR2V0IHRoZSBsZW5ndGggb2YgR2VvQW5hbHl0aWNzIHNlcnZlcnMgYXJyYXlcbiAgICBjb25zdCBiZGZzRW5hYmxlZCA9IGNvbmZpZ1N0YXRlLmNvbmZpZy5iZGZzRW5hYmxlZDtcbiAgICB0aGlzLm9wdGlvbnMuYmRmcy5lbmFibGVkID0gISEoZ2VvQW5hbHl0aWNzU2VydmVyID09PSBudWxsIHx8IGdlb0FuYWx5dGljc1NlcnZlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ2VvQW5hbHl0aWNzU2VydmVyLmxlbmd0aCkgJiYgYmRmc0VuYWJsZWQ7XG4gICAgLy8gRmlsdGVyIHRoZSBLbm93bGVkZ2Ugc2VydmVycyB0byBkZWNpZGUgaWYgXCJOb1NRTCBvcHRpb24gc2hvdWxkIGJlIGF2YWlsYWJsZVxuICAgIGNvbnN0IGtub3dsZWRnZVNlcnZlciA9IHRoaXMuc2VydmVyTGlzdC5maWx0ZXIoZnVuY3Rpb24gKHNlcnZlcikge1xuICAgICAgcmV0dXJuIHNlcnZlci5zZXJ2ZXJGdW5jdGlvbi50b1VwcGVyQ2FzZSgpLmluZGV4T2YoXCJLTk9XTEVER0VcIikgPiAtMTtcbiAgICB9KTtcbiAgICAvLyBHZXQgdGhlIGxlbmd0aCBvZiBLbm93bGVkZ2Ugc2VydmVycyBhcnJheVxuICAgIGNvbnN0IG5vU3FsRW5hYmxlZCA9IGNvbmZpZ1N0YXRlLmNvbmZpZy5ub1NRTEVuYWJsZWQ7XG4gICAgYWRkSXRlbVN0YXRlLm5vU3FsRW5hYmxlZCA9XG4gICAgICAhIShrbm93bGVkZ2VTZXJ2ZXIgPT09IG51bGwgfHwga25vd2xlZGdlU2VydmVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBrbm93bGVkZ2VTZXJ2ZXIubGVuZ3RoKSAmJiBub1NxbEVuYWJsZWQgJiYgIWlzQXJjR0lTRW50ZXJwcmlzZU9uS3ViZXJuZXRlcygpO1xuICB9XG4gIGhhbmRsZU5leHQoKSB7XG4gICAgbGV0IG5leHRQYWdlO1xuICAgIGNvbnN0IHNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZDtcbiAgICBhZGRJdGVtU3RhdGUuYWRkRGF0YVN0b3JlVHlwZSA9IHNlbGVjdGVkO1xuICAgIGFkZEl0ZW1TdGF0ZS5kYXRhU3RvcmVTZWxlY3RTZXJ2ZXJMaXN0ID0gdGhpcy5zZXJ2ZXJMaXN0O1xuICAgIGFkZEl0ZW1TdGF0ZS50eXBlID0gXCJEYXRhIFN0b3JlXCI7XG4gICAgaWYgKHRoaXMuaXNQb3J0YWwpIHtcbiAgICAgIG5leHRQYWdlID0gdGhpcy5vcHRpb25zW3NlbGVjdGVkXS5wYWdlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwiZGF0YVN0b3JlXCI7XG4gICAgICBpZiAodGhpcy5zZWxlY3RlZCA9PT0gXCJjbG91ZFwiKSB7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5hZGREYXRhU3RvcmVUeXBlID0gXCJjbG91ZFwiO1xuICAgICAgICBhZGRJdGVtU3RhdGUucHJvdmlkZXIgPSB0aGlzLnBpcGVsaW5lQ2xvdWRTZWxlY3Rpb247XG4gICAgICAgIG5leHRQYWdlID0gXCJkYXRhU3RvcmVTZWxlY3RDbG91ZENyZWRlbnRpYWxzXCI7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgYWRkSXRlbVN0YXRlLmFkZERhdGFTdG9yZVR5cGUgPSBcImRhdGFiYXNlXCI7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5kYXRhYmFzZVByb3ZpZGVyID0gdGhpcy5waXBlbGluZURhdGFiYXNlU2VsZWN0aW9uO1xuICAgICAgICBuZXh0UGFnZSA9IFwiZGF0YVN0b3JlRGF0YWJhc2VDcmVkZW50aWFsc1wiO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQobmV4dFBhZ2UpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGkxOG4sIG9wdGlvbnMsIGNsb3VkT3B0aW9ucywgZGF0YWJhc2VPcHRpb25zLCB0aWxlU3RyaW5ncyB9ID0gdGhpcztcbiAgICBsZXQgc3ViT3B0aW9ucyA9IHRoaXMuc2VsZWN0ZWQgPT09IFwiY2xvdWRcIiA/IGNsb3VkT3B0aW9ucyA6IGRhdGFiYXNlT3B0aW9ucztcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgbnVsbCwgaChcImFyY2dpcy1uZXctaXRlbS1kZXNjcmlwdGlvblwiLCB7IGhlYWRlcjogaTE4bi5oZWFkaW5nIH0pLCBoKFwiY2FsY2l0ZS10aWxlLXNlbGVjdC1ncm91cFwiLCB7IGxheW91dDogXCJ2ZXJ0aWNhbFwiLCBjbGFzczogXCJ0aWxlLXNlbGVjdC1ncm91cFwiIH0sIE9iamVjdC5rZXlzKG9wdGlvbnMpLm1hcCgoa2V5KSA9PiB7XG4gICAgICBsZXQgZGF0YWJhc2VEZXNjcmlwdGlvbjtcbiAgICAgIGlmICh0aGlzLmlzUG9ydGFsKSB7XG4gICAgICAgIGRhdGFiYXNlRGVzY3JpcHRpb24gPSBhZGRJdGVtU3RhdGUubm9TcWxFbmFibGVkXG4gICAgICAgICAgPyBpMThuLm9wdGlvbnMuZGF0YWJhc2UuZGVzY3JpcHRpb25Ob1NxbFxuICAgICAgICAgIDogaTE4bi5vcHRpb25zLmRhdGFiYXNlLmRlc2NyaXB0aW9uO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGRhdGFiYXNlRGVzY3JpcHRpb24gPSBpMThuLmRhdGFiYXNlRGVzY3JpcHRpb25Gb3JPbmxpbmU7XG4gICAgICB9XG4gICAgICByZXR1cm4gKG9wdGlvbnNba2V5XS5lbmFibGVkICYmIChoKFwiY2FsY2l0ZS10aWxlLXNlbGVjdFwiLCB7IGtleToga2V5LCBjbGFzczogXCJ0aWxlLXNlbGVjdFwiLCBjaGVja2VkOiB0aGlzLnNlbGVjdGVkID09PSBrZXksIGhlYWRpbmc6IGkxOG4ub3B0aW9uc1trZXldLnRpdGxlLCBkZXNjcmlwdGlvbjoga2V5ID09PSBcImRhdGFiYXNlXCIgPyBkYXRhYmFzZURlc2NyaXB0aW9uIDogaTE4bi5vcHRpb25zW2tleV0uZGVzY3JpcHRpb24sIG5hbWU6IFwiZGF0YS1zdG9yZS1zZWxlY3Rpb25cIiwgXCJpbnB1dC1lbmFibGVkXCI6IHRydWUsIHdpZHRoOiBcImZ1bGxcIiwgdHlwZTogXCJyYWRpb1wiLCB2YWx1ZToga2V5LCBvbkNhbGNpdGVUaWxlU2VsZWN0Q2hhbmdlOiAoZSkgPT4ge1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBlLnRhcmdldC52YWx1ZTtcbiAgICAgICAgfSB9KSkpO1xuICAgIH0pKSwgIXRoaXMuaXNQb3J0YWwgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJkeW5hbWljLXNlbGVjdFwiIH0sIGgoXCJhcmNnaXMtbmV3LWl0ZW0tZGVzY3JpcHRpb25cIiwgeyBjbGFzczogXCJkeW5hbWljLWhlYWRlclwiLCBoZWFkZXI6IHRoaXMuc2VsZWN0ZWQgPT09IFwiY2xvdWRcIlxuICAgICAgICA/IGkxOG4uc3ViT3B0aW9uc0Nsb3VkRGVzY3JpcHRpb25cbiAgICAgICAgOiBpMThuLnN1Yk9wdGlvbnNEYXRhYmFzZURlc2NyaXB0aW9uIH0pLCBoKFwiY2FsY2l0ZS10aWxlLXNlbGVjdC1ncm91cFwiLCB7IGxheW91dDogXCJ2ZXJ0aWNhbFwiIH0sIHN1Yk9wdGlvbnMubWFwKChrZXkpID0+IHtcbiAgICAgIHJldHVybiAoaChcImNhbGNpdGUtdGlsZS1zZWxlY3RcIiwgeyBrZXk6IGtleSwgXCJpbnB1dC1lbmFibGVkXCI6IHRydWUsIGNoZWNrZWQ6IHN1Yk9wdGlvbnNbMF0gPT09IGtleSwgd2lkdGg6IFwiZnVsbFwiLCB0eXBlOiBcInJhZGlvXCIsIHZhbHVlOiBrZXksIGhlYWRpbmc6IHRpbGVTdHJpbmdzW2tleV0udGl0bGUsIGRlc2NyaXB0aW9uOiB0aWxlU3RyaW5nc1trZXldLmRlc2NyaXB0aW9uLCBvbkNhbGNpdGVUaWxlU2VsZWN0Q2hhbmdlOiAoZSkgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkID09PSBcImNsb3VkXCIpIHtcbiAgICAgICAgICAgIHRoaXMucGlwZWxpbmVDbG91ZFNlbGVjdGlvbiA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucGlwZWxpbmVEYXRhYmFzZVNlbGVjdGlvbiA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSB9KSk7XG4gICAgfSkpKSkpKTtcbiAgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc0RhdGFTdG9yZVNlbGVjdC5zdHlsZSA9IGFyY2dpc05ld0l0ZW1QYWdlc0RhdGFTdG9yZVNlbGVjdENzcztcblxuZXhwb3J0IHsgQXJjZ2lzTmV3SXRlbVBhZ2VzRGF0YVN0b3JlU2VsZWN0IGFzIGFyY2dpc19uZXdfaXRlbV9wYWdlc19kYXRhX3N0b3JlX3NlbGVjdCB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC04MWQ1NDhiNy5qcyc7XG5cbmNvbnN0IHVpU3RvcmUgPSBjcmVhdGVTdG9yZSh7XG4gIG5leHRUZXh0OiBcIm5leHRcIixcbiAgd29ya2Zsb3c6IFwiY29udGVudFwiLFxuICBzY2FsZTogXCJtXCIsXG4gIGRpc2FibGVTY3JvbGw6IGZhbHNlLFxuICBmZWF0dXJlRmxhZ3M6IHsgdGlsZUxheWVyM2RUaWxlczogZmFsc2UgfVxufSk7XG5jb25zdCB1aVN0b3JlU3RhdGUgPSB1aVN0b3JlLnN0YXRlO1xuXG5leHBvcnQgeyB1aVN0b3JlIGFzIGEsIHVpU3RvcmVTdGF0ZSBhcyB1IH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=