"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_server-98f534"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js":
/*!**************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addItemState),
/* harmony export */   b: () => (/* binding */ addItemUrlState),
/* harmony export */   c: () => (/* binding */ addItemRequestState),
/* harmony export */   d: () => (/* binding */ addItemStore)
/* harmony export */ });
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const addItemStore = (0,_index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__.c)({
  typeKeywords: [],
  customParameters: [],
  analyzedLocationTypes: [],
  allowStoredAuth: true,
  isSecured: null,
  checkAuth: false
});
// Entire add item state object
const addItemState = addItemStore.state;
// Subsets of add item state
const addItemRequestState = addItemStore.state;
const addItemUrlState = addItemStore.state;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-9f648bee.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-9f648bee.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ formatFileName),
/* harmony export */   f: () => (/* binding */ formatTags),
/* harmony export */   s: () => (/* binding */ streamPromises)
/* harmony export */ });
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const formatFileName = (title) => (title === null || title === void 0 ? void 0 : title.replace(/(\s+|:)/g, "_")) || "";
const formatTags = (tags) => {
  const cleanTags = (tagObj) => {
    return tagObj
      .split(",")
      .map((tag) => tag.trim())
      .filter((tag) => tag);
  };
  if (!tags) {
    return [];
  }
  else if (typeof tags === "string") {
    return (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_0__.b)(cleanTags(tags));
  }
  else {
    return (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_0__.b)(tags.flatMap((tag) => {
      return [...cleanTags(tag)];
    }));
  }
};
const resolveOnFirstPromise = async (promiseList) => {
  return new Promise((resolve, reject) => {
    for (let i = 0; i < promiseList.length; i++) {
      promiseList[i]
        .then((result) => {
        const newArr = [...promiseList];
        newArr.splice(i, 1);
        resolve({ remainingPromises: newArr, result });
      })
        .catch(reject);
    }
  });
};
/**
 * Similar to Promise.all but will resolve on the first promise that resolves then continuously swap out the resolved promise with the next promise in the list
 * @param getNextPromise A function that returns the next promise to resolve
 */
async function streamPromises(getNextPromise, options) {
  var _a, _b;
  const results = [];
  const { getBatchSize, onPromiseCompleted, onPromiseThrow, shouldContinue } = options !== null && options !== void 0 ? options : {};
  let remainingPromises = [];
  for (let i = 0; i < ((_a = getBatchSize === null || getBatchSize === void 0 ? void 0 : getBatchSize()) !== null && _a !== void 0 ? _a : 1); i++) {
    try {
      const nextElement = getNextPromise();
      nextElement && remainingPromises.push(nextElement);
    }
    catch (e) {
      onPromiseThrow === null || onPromiseThrow === void 0 ? void 0 : onPromiseThrow(e);
    }
  }
  let lastResult = null;
  while (remainingPromises.length > 0 && (!shouldContinue || shouldContinue(lastResult))) {
    try {
      const { remainingPromises: _remainingPromises, result } = await resolveOnFirstPromise(remainingPromises);
      remainingPromises = _remainingPromises;
      lastResult = result;
      !!result && results.push(result);
      onPromiseCompleted === null || onPromiseCompleted === void 0 ? void 0 : onPromiseCompleted(result);
      // Update batch size after the new result is bubbled up
      const batchSize = (_b = getBatchSize === null || getBatchSize === void 0 ? void 0 : getBatchSize()) !== null && _b !== void 0 ? _b : 1;
      while (remainingPromises.length < batchSize) {
        const nextElement = getNextPromise();
        nextElement && remainingPromises.push(nextElement);
        if (nextElement == null) {
          break;
        }
      }
    }
    catch (e) {
      onPromiseThrow === null || onPromiseThrow === void 0 ? void 0 : onPromiseThrow(e);
    }
  }
  return results;
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js":
/*!*********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js ***!
  \*********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ itemPropertiesStore),
/* harmony export */   i: () => (/* binding */ itemPropertiesState)
/* harmony export */ });
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const itemPropertiesStore = (0,_index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__.c)({
  title: "",
  snippet: "",
  tags: [],
  categories: []
});
const itemPropertiesState = itemPropertiesStore.state;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js":
/*!*****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js ***!
  \*****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getItem),
/* harmony export */   b: () => (/* binding */ getRelatedItems),
/* harmony export */   c: () => (/* binding */ sendAddItemRequest),
/* harmony export */   d: () => (/* binding */ deleteItem),
/* harmony export */   e: () => (/* binding */ updateItem),
/* harmony export */   f: () => (/* binding */ formatItemProperties),
/* harmony export */   g: () => (/* binding */ getItemUrl),
/* harmony export */   h: () => (/* binding */ searchForExistingItemUrlByName),
/* harmony export */   i: () => (/* binding */ addThumbnailToItem),
/* harmony export */   j: () => (/* binding */ getAddItemParameters),
/* harmony export */   k: () => (/* binding */ createForm),
/* harmony export */   l: () => (/* binding */ commitItem),
/* harmony export */   m: () => (/* binding */ moveItem),
/* harmony export */   n: () => (/* binding */ getAddItemUrl),
/* harmony export */   o: () => (/* binding */ cancelItem),
/* harmony export */   p: () => (/* binding */ getItemData),
/* harmony export */   s: () => (/* binding */ searchExistingItem),
/* harmony export */   u: () => (/* binding */ updateCategories)
/* harmony export */ });
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./item-properties-e6412a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./functional-9f648bee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-9f648bee.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */









function formatItemProperties({ title, snippet, tags }) {
  return {
    title,
    snippet,
    tags: (0,_functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_6__.f)(tags).join(",")
  };
}
const getAddItemParameters = (itemPropertiesProps, addItemProps) => {
  var _a;
  const { file, type, extension, dataUrl, properties, typeKeywords: extraTypeKeywords } = addItemProps;
  const formattedItemProperties = formatItemProperties(itemPropertiesProps);
  const typeKeywords = [
    ...(_a = _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_7__.a[type]) === null || _a === void 0 ? void 0 : _a.typeKeywords,
    ...(extraTypeKeywords ? [extraTypeKeywords] : []),
    extension
  ].join(", ");
  const baseRequestState = Object.assign({ type, extension }, (properties ? { properties: JSON.stringify(properties) } : {}));
  // We can't just encode URL since url from Drive have Bearer in the encoder will break that
  // https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/41617
  const additionalRequestState = file
    ? { file }
    : { dataUrl: dataUrl.includes(`httpHeaders={"Authorization"`) ? dataUrl : encodeURI(dataUrl) };
  return Object.assign(Object.assign(Object.assign(Object.assign({}, baseRequestState), additionalRequestState), formattedItemProperties), { typeKeywords });
};
const createForm = (formatItemProps, addItemProps) => {
  const formProperties = getAddItemParameters(formatItemProps, addItemProps);
  const addAsUniqueFile = !!addItemProps.addAsUniqueFile;
  const form = new FormData();
  form.append("f", "json");
  form.append("async", "true");
  Object.keys(formProperties).forEach((property) => {
    if (addAsUniqueFile && property === "file") {
      const fileName = addItemProps.fileName;
      form.append(property, formProperties[property], fileName);
    }
    else {
      form.append(property, formProperties[property]);
    }
  });
  return form;
};
const getAddItemUrl = (user, folder) => {
  const folderUrl = (folder === null || folder === void 0 ? void 0 : folder.id) && (folder === null || folder === void 0 ? void 0 : folder.id) !== (folder === null || folder === void 0 ? void 0 : folder.username) ? `/${folder.id}` : "";
  return `${user.userContentUrl}${folderUrl}/addItem`;
};

const getItemUrl = (itemId, portal) => `${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}content/items/${itemId}`;
const getItem = async (itemId, portal) => {
  try {
    const url = getItemUrl(itemId, portal);
    return { result: await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(url) };
  }
  catch (error) {
    console.warn("error getting item", error);
    return { error: { code: "unhandledError" } };
  }
};
const addThumbnailToItem = async (itemId, thumbnailInfo) => {
  const formData = new FormData();
  switch (thumbnailInfo.type) {
    case "base64":
      formData.append("data", thumbnailInfo.data);
      break;
    case "url":
      formData.append("url", thumbnailInfo.url);
      break;
    case "file":
      formData.append("file", thumbnailInfo.file);
      break;
  }
  formData.append("f", "json");
  formData.append("token", (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.h)(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal));
  return await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.e)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)()}content/users/${_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user.username}/items/${itemId}/updateThumbnail`, formData, {}, "post");
};
async function moveItem(itemId, folder) {
  const user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
  const url = `${user.userContentUrl}/moveItems`;
  return await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { items: itemId, folder }, {}, "post");
}
async function deleteItem(itemId, { permanentDelete = false } = {}) {
  const user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
  const url = `${user.userContentUrl}/items/${itemId}/delete`;
  return await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { permanentDelete }, {}, "post");
}
async function getRelatedItems(itemId, relationshipType, direction) {
  const directionParam = direction ? `&direction=${direction}` : "";
  const url = `${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)()}content/items/${itemId}/relatedItems?relationshipType=${relationshipType}${directionParam}`;
  return await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(url);
}
async function updateItem(itemId, updateObj, portalUser) {
  var _a;
  const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
  const userContentUrl = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "append" ? _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_4__.a.existingItem.itemOwner.userContentUrl : user.userContentUrl; //For R02 Patch // ! Use fetchUser if itemOwner is not available
  const url = `${userContentUrl}/items/${itemId}/update`;
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, updateObj, {}, "post");
}
const getItemData = (itemId, portal) => {
  const url = `${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}content/items/${itemId}/data`;
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(url);
};
async function updateCategories(portal, itemIds, categories) {
  const url = `${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/content/updateItems`;
  const items = JSON.stringify(itemIds.map((id) => {
    return {
      [id]: { categories }
    };
  }));
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { items }, {}, "post");
}
const commitItem = async (itemId, addItemProps) => {
  const user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
  const url = `${user.userContentUrl}/items/${itemId}/commit`;
  const form = createForm(_item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i, addItemProps);
  form.delete("file");
  const response = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.e)(url, form, {}, "post");
  return response;
};
const cancelItem = async (itemId) => {
  const user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
  const url = `${user.userContentUrl}/items/${itemId}/cancel`;
  const response = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, {}, {}, "post");
  return response;
};
/** Send processed item to the server */
const sendAddItemRequest = async (item) => {
  const url = getAddItemUrl(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user, _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.folder);
  const formattedItemProperties = formatItemProperties(_item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i);
  const isUrlRequestParameters = (item) => item.url && !!item.serviceInfo;
  const requestItem = Object.assign({}, item);
  // Remove redundant properties
  delete requestItem.initialFolders;
  delete requestItem.initialTitle;
  delete requestItem.newItemMode;
  delete requestItem.serviceInfo;
  delete requestItem.allowStoredAuth;
  delete requestItem.isSecured;
  delete requestItem.checkAuth;
  delete requestItem.agsType;
  delete requestItem.developerCredentialsType;
  delete requestItem.applicationEnvironment;
  delete requestItem.apiKeyReferrerUrls;
  delete requestItem.developerCredentialsRedirectUrls;
  delete requestItem.developerPrivileges;
  return await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, Object.assign(Object.assign(Object.assign(Object.assign({}, requestItem), (isUrlRequestParameters(item) ? { serviceInfo: JSON.stringify(item.serviceInfo) } : {})), { typeKeywords: JSON.stringify(item.typeKeywords) }), formattedItemProperties), {}, "post");
};
async function searchExistingItem(title, type, folder, extension, user, portal) {
  user !== null && user !== void 0 ? user : (user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
  portal !== null && portal !== void 0 ? portal : (portal = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
  const folderId = !folder || folder.id === user.username ? "root" : folder.id;
  const basename = title.replace(`.${extension}`, "");
  // TODO: refine this existing item search so it doesn't return a false positive when the same item is found
  // in the case of feature collections, they have a type of Feature Layer,
  // so it will match itself as you're also publishing a feature layer. (#36658)
  // for now we'll just skip this validation in this case
  // Additionally, non-published Excel files are already created and just need to be updated
  // so the existing item found here is the item that needs to be updated
  if (extension === "featurecollection" || type === "Microsoft Excel") {
    return null;
  }
  const queryList = [
    `title: "${basename}"`,
    `type: "${type}"`,
    `owner: "${user.username}"`,
    `ownerfolder: "${folderId}"`
  ];
  const searchResults = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}search`, {
    filter: queryList.join(" AND "),
    num: 1
  });
  return (searchResults === null || searchResults === void 0 ? void 0 : searchResults.total) > 0
    ? {
      num: searchResults.num,
      itemURLList: searchResults.results.map((item) => (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_2__.m)(item.id, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.config.baseUrl))
    }
    : null;
}
async function searchForExistingItemUrlByName(name, itemType) {
  const nameToCheck = (0,_functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_6__.a)(name);
  const { user, config, portal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
  const { folder } = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i;
  const folderId = !folder || folder.id === user.username ? "root" : folder.id;
  const queryList = [`owner: "${user.username}"`, `ownerfolder: "${folderId}"`];
  if (itemType) {
    queryList.push(`type: "${itemType}"`);
  }
  const MAX_QUERY_ITEM = 100;
  const MAX_RETRY = 10;
  let resultItem;
  let curStart = 1;
  for (let retry = 0; retry < MAX_RETRY && !resultItem && curStart > -1; retry++) {
    const { nextStart, results } = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)()}search`, {
      [portal.isPortal ? "q" : "filter"]: queryList.join(" AND "),
      num: MAX_QUERY_ITEM,
      start: curStart
    });
    resultItem = results.find((item) => item.name === nameToCheck);
    curStart = nextStart;
  }
  return resultItem ? (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_2__.m)(resultItem.id, config.baseUrl) : null;
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fc2VydmVyLTk4ZjUzNC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ3VEOztBQUV2RCxxQkFBcUIscURBQVc7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRWdHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNwQmhHO0FBQ0E7QUFDQTtBQUNBO0FBQ3VEOztBQUV2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLDBEQUFNO0FBQ2pCO0FBQ0E7QUFDQSxXQUFXLDBEQUFNO0FBQ2pCO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHdCQUF3QjtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixtQ0FBbUM7QUFDckQsT0FBTztBQUNQO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsbUVBQW1FO0FBQzdFO0FBQ0Esa0JBQWtCLDRIQUE0SDtBQUM5STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxnREFBZ0Q7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFcUU7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDbEZyRTtBQUNBO0FBQ0E7QUFDQTtBQUN1RDs7QUFFdkQsNEJBQTRCLHFEQUFXO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNE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K0I7QUFDbFI7QUFDQTtBQUNBLG9EQUFvRCxrREFBVztBQUMvRCw0REFBNEQsa0RBQVc7QUFDdkU7QUFDQSxxQ0FBcUMsVUFBVTtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsU0FBUztBQUN4QixjQUFjLEtBQUs7QUFDbkIsZUFBZSxjQUFjO0FBQzdCLHFCQUFxQixTQUFTO0FBQzlCO0FBQ0EsOEJBQThCLHNEQUFPLElBQUksc0RBQWMsU0FBUztBQUNoRTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLHVEQUF1RCwwREFBaUIsVUFBVSxrREFBVztBQUM3RjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQiwwREFBYztBQUNwQyxVQUFVLHVCQUF1QixFQUFFLGtEQUFXO0FBQzlDLFVBQVUsU0FBUyxFQUFFLDJEQUFtQjtBQUN4QztBQUNBLGdDQUFnQyxjQUFjLHFCQUFxQixTQUFTO0FBQzVFO0FBQ0EsNkJBQTZCLFNBQVM7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixtREFBbUQ7QUFDekUsWUFBWSxxQkFBcUIsUUFBUSxzREFBTyxJQUFJLHNEQUFjLEdBQUc7QUFDckU7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQiwwREFBaUI7QUFDdkM7O0FBRXNZIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYWRkLWl0ZW0tOTdkNTc3YTkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vZnVuY3Rpb25hbC05ZjY0OGJlZS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9pdGVtLXByb3BlcnRpZXMtZTY0MTJhOWEuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vc2VydmVyLWl0ZW0tZjEyMTUzZTYuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC04MWQ1NDhiNy5qcyc7XG5cbmNvbnN0IGFkZEl0ZW1TdG9yZSA9IGNyZWF0ZVN0b3JlKHtcbiAgdHlwZUtleXdvcmRzOiBbXSxcbiAgY3VzdG9tUGFyYW1ldGVyczogW10sXG4gIGFuYWx5emVkTG9jYXRpb25UeXBlczogW10sXG4gIGFsbG93U3RvcmVkQXV0aDogdHJ1ZSxcbiAgaXNTZWN1cmVkOiBudWxsLFxuICBjaGVja0F1dGg6IGZhbHNlXG59KTtcbi8vIEVudGlyZSBhZGQgaXRlbSBzdGF0ZSBvYmplY3RcbmNvbnN0IGFkZEl0ZW1TdGF0ZSA9IGFkZEl0ZW1TdG9yZS5zdGF0ZTtcbi8vIFN1YnNldHMgb2YgYWRkIGl0ZW0gc3RhdGVcbmNvbnN0IGFkZEl0ZW1SZXF1ZXN0U3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5jb25zdCBhZGRJdGVtVXJsU3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5cbmV4cG9ydCB7IGFkZEl0ZW1TdGF0ZSBhcyBhLCBhZGRJdGVtVXJsU3RhdGUgYXMgYiwgYWRkSXRlbVJlcXVlc3RTdGF0ZSBhcyBjLCBhZGRJdGVtU3RvcmUgYXMgZCB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBiIGFzIHVuaXF1ZSB9IGZyb20gJy4vZnVuY3Rpb25hbC1jODJmNWFiOS5qcyc7XG5cbmNvbnN0IGZvcm1hdEZpbGVOYW1lID0gKHRpdGxlKSA9PiAodGl0bGUgPT09IG51bGwgfHwgdGl0bGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRpdGxlLnJlcGxhY2UoLyhcXHMrfDopL2csIFwiX1wiKSkgfHwgXCJcIjtcbmNvbnN0IGZvcm1hdFRhZ3MgPSAodGFncykgPT4ge1xuICBjb25zdCBjbGVhblRhZ3MgPSAodGFnT2JqKSA9PiB7XG4gICAgcmV0dXJuIHRhZ09ialxuICAgICAgLnNwbGl0KFwiLFwiKVxuICAgICAgLm1hcCgodGFnKSA9PiB0YWcudHJpbSgpKVxuICAgICAgLmZpbHRlcigodGFnKSA9PiB0YWcpO1xuICB9O1xuICBpZiAoIXRhZ3MpIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgZWxzZSBpZiAodHlwZW9mIHRhZ3MgPT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gdW5pcXVlKGNsZWFuVGFncyh0YWdzKSk7XG4gIH1cbiAgZWxzZSB7XG4gICAgcmV0dXJuIHVuaXF1ZSh0YWdzLmZsYXRNYXAoKHRhZykgPT4ge1xuICAgICAgcmV0dXJuIFsuLi5jbGVhblRhZ3ModGFnKV07XG4gICAgfSkpO1xuICB9XG59O1xuY29uc3QgcmVzb2x2ZU9uRmlyc3RQcm9taXNlID0gYXN5bmMgKHByb21pc2VMaXN0KSA9PiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcm9taXNlTGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgcHJvbWlzZUxpc3RbaV1cbiAgICAgICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICBjb25zdCBuZXdBcnIgPSBbLi4ucHJvbWlzZUxpc3RdO1xuICAgICAgICBuZXdBcnIuc3BsaWNlKGksIDEpO1xuICAgICAgICByZXNvbHZlKHsgcmVtYWluaW5nUHJvbWlzZXM6IG5ld0FyciwgcmVzdWx0IH0pO1xuICAgICAgfSlcbiAgICAgICAgLmNhdGNoKHJlamVjdCk7XG4gICAgfVxuICB9KTtcbn07XG4vKipcbiAqIFNpbWlsYXIgdG8gUHJvbWlzZS5hbGwgYnV0IHdpbGwgcmVzb2x2ZSBvbiB0aGUgZmlyc3QgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRoZW4gY29udGludW91c2x5IHN3YXAgb3V0IHRoZSByZXNvbHZlZCBwcm9taXNlIHdpdGggdGhlIG5leHQgcHJvbWlzZSBpbiB0aGUgbGlzdFxuICogQHBhcmFtIGdldE5leHRQcm9taXNlIEEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBuZXh0IHByb21pc2UgdG8gcmVzb2x2ZVxuICovXG5hc3luYyBmdW5jdGlvbiBzdHJlYW1Qcm9taXNlcyhnZXROZXh0UHJvbWlzZSwgb3B0aW9ucykge1xuICB2YXIgX2EsIF9iO1xuICBjb25zdCByZXN1bHRzID0gW107XG4gIGNvbnN0IHsgZ2V0QmF0Y2hTaXplLCBvblByb21pc2VDb21wbGV0ZWQsIG9uUHJvbWlzZVRocm93LCBzaG91bGRDb250aW51ZSB9ID0gb3B0aW9ucyAhPT0gbnVsbCAmJiBvcHRpb25zICE9PSB2b2lkIDAgPyBvcHRpb25zIDoge307XG4gIGxldCByZW1haW5pbmdQcm9taXNlcyA9IFtdO1xuICBmb3IgKGxldCBpID0gMDsgaSA8ICgoX2EgPSBnZXRCYXRjaFNpemUgPT09IG51bGwgfHwgZ2V0QmF0Y2hTaXplID09PSB2b2lkIDAgPyB2b2lkIDAgOiBnZXRCYXRjaFNpemUoKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMSk7IGkrKykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBuZXh0RWxlbWVudCA9IGdldE5leHRQcm9taXNlKCk7XG4gICAgICBuZXh0RWxlbWVudCAmJiByZW1haW5pbmdQcm9taXNlcy5wdXNoKG5leHRFbGVtZW50KTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgIG9uUHJvbWlzZVRocm93ID09PSBudWxsIHx8IG9uUHJvbWlzZVRocm93ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvblByb21pc2VUaHJvdyhlKTtcbiAgICB9XG4gIH1cbiAgbGV0IGxhc3RSZXN1bHQgPSBudWxsO1xuICB3aGlsZSAocmVtYWluaW5nUHJvbWlzZXMubGVuZ3RoID4gMCAmJiAoIXNob3VsZENvbnRpbnVlIHx8IHNob3VsZENvbnRpbnVlKGxhc3RSZXN1bHQpKSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IHJlbWFpbmluZ1Byb21pc2VzOiBfcmVtYWluaW5nUHJvbWlzZXMsIHJlc3VsdCB9ID0gYXdhaXQgcmVzb2x2ZU9uRmlyc3RQcm9taXNlKHJlbWFpbmluZ1Byb21pc2VzKTtcbiAgICAgIHJlbWFpbmluZ1Byb21pc2VzID0gX3JlbWFpbmluZ1Byb21pc2VzO1xuICAgICAgbGFzdFJlc3VsdCA9IHJlc3VsdDtcbiAgICAgICEhcmVzdWx0ICYmIHJlc3VsdHMucHVzaChyZXN1bHQpO1xuICAgICAgb25Qcm9taXNlQ29tcGxldGVkID09PSBudWxsIHx8IG9uUHJvbWlzZUNvbXBsZXRlZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogb25Qcm9taXNlQ29tcGxldGVkKHJlc3VsdCk7XG4gICAgICAvLyBVcGRhdGUgYmF0Y2ggc2l6ZSBhZnRlciB0aGUgbmV3IHJlc3VsdCBpcyBidWJibGVkIHVwXG4gICAgICBjb25zdCBiYXRjaFNpemUgPSAoX2IgPSBnZXRCYXRjaFNpemUgPT09IG51bGwgfHwgZ2V0QmF0Y2hTaXplID09PSB2b2lkIDAgPyB2b2lkIDAgOiBnZXRCYXRjaFNpemUoKSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogMTtcbiAgICAgIHdoaWxlIChyZW1haW5pbmdQcm9taXNlcy5sZW5ndGggPCBiYXRjaFNpemUpIHtcbiAgICAgICAgY29uc3QgbmV4dEVsZW1lbnQgPSBnZXROZXh0UHJvbWlzZSgpO1xuICAgICAgICBuZXh0RWxlbWVudCAmJiByZW1haW5pbmdQcm9taXNlcy5wdXNoKG5leHRFbGVtZW50KTtcbiAgICAgICAgaWYgKG5leHRFbGVtZW50ID09IG51bGwpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgb25Qcm9taXNlVGhyb3cgPT09IG51bGwgfHwgb25Qcm9taXNlVGhyb3cgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9uUHJvbWlzZVRocm93KGUpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0cztcbn1cblxuZXhwb3J0IHsgZm9ybWF0RmlsZU5hbWUgYXMgYSwgZm9ybWF0VGFncyBhcyBmLCBzdHJlYW1Qcm9taXNlcyBhcyBzIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGMgYXMgY3JlYXRlU3RvcmUgfSBmcm9tICcuL2luZGV4LTgxZDU0OGI3LmpzJztcblxuY29uc3QgaXRlbVByb3BlcnRpZXNTdG9yZSA9IGNyZWF0ZVN0b3JlKHtcbiAgdGl0bGU6IFwiXCIsXG4gIHNuaXBwZXQ6IFwiXCIsXG4gIHRhZ3M6IFtdLFxuICBjYXRlZ29yaWVzOiBbXVxufSk7XG5jb25zdCBpdGVtUHJvcGVydGllc1N0YXRlID0gaXRlbVByb3BlcnRpZXNTdG9yZS5zdGF0ZTtcblxuZXhwb3J0IHsgaXRlbVByb3BlcnRpZXNTdG9yZSBhcyBhLCBpdGVtUHJvcGVydGllc1N0YXRlIGFzIGkgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgciBhcyByZXF1ZXN0LCBnIGFzIGdldFJlc3RCYXNlVXJsLCBlIGFzIGZvcm1SZXF1ZXN0LCBoIGFzIGdldFRva2VuIH0gZnJvbSAnLi9wb3J0YWwtNzljYWFlZmYuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLWViNWY3ZGMyLmpzJztcbmltcG9ydCB7IG0gYXMgZ2V0SXRlbUhvbWVBcHBVcmwgfSBmcm9tICcuL3ByaXZpbGVnZXMtY2NkNWYzN2QuanMnO1xuaW1wb3J0IHsgaSBhcyBpdGVtUHJvcGVydGllc1N0YXRlIH0gZnJvbSAnLi9pdGVtLXByb3BlcnRpZXMtZTY0MTJhOWEuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRJdGVtU3RhdGUgfSBmcm9tICcuL2FkZC1pdGVtLTk3ZDU3N2E5LmpzJztcbmltcG9ydCB7IHUgYXMgdWlTdG9yZVN0YXRlIH0gZnJvbSAnLi91aS1lY2Y4NmJiYS5qcyc7XG5pbXBvcnQgeyBmIGFzIGZvcm1hdFRhZ3MsIGEgYXMgZm9ybWF0RmlsZU5hbWUgfSBmcm9tICcuL2Z1bmN0aW9uYWwtOWY2NDhiZWUuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRDcmVhdGVJdGVtVHlwZXMgfSBmcm9tICcuL2l0ZW0tdHlwZXMtYjRmZTg2YWQuanMnO1xuXG5mdW5jdGlvbiBmb3JtYXRJdGVtUHJvcGVydGllcyh7IHRpdGxlLCBzbmlwcGV0LCB0YWdzIH0pIHtcbiAgcmV0dXJuIHtcbiAgICB0aXRsZSxcbiAgICBzbmlwcGV0LFxuICAgIHRhZ3M6IGZvcm1hdFRhZ3ModGFncykuam9pbihcIixcIilcbiAgfTtcbn1cbmNvbnN0IGdldEFkZEl0ZW1QYXJhbWV0ZXJzID0gKGl0ZW1Qcm9wZXJ0aWVzUHJvcHMsIGFkZEl0ZW1Qcm9wcykgPT4ge1xuICB2YXIgX2E7XG4gIGNvbnN0IHsgZmlsZSwgdHlwZSwgZXh0ZW5zaW9uLCBkYXRhVXJsLCBwcm9wZXJ0aWVzLCB0eXBlS2V5d29yZHM6IGV4dHJhVHlwZUtleXdvcmRzIH0gPSBhZGRJdGVtUHJvcHM7XG4gIGNvbnN0IGZvcm1hdHRlZEl0ZW1Qcm9wZXJ0aWVzID0gZm9ybWF0SXRlbVByb3BlcnRpZXMoaXRlbVByb3BlcnRpZXNQcm9wcyk7XG4gIGNvbnN0IHR5cGVLZXl3b3JkcyA9IFtcbiAgICAuLi4oX2EgPSBhZGRDcmVhdGVJdGVtVHlwZXNbdHlwZV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlS2V5d29yZHMsXG4gICAgLi4uKGV4dHJhVHlwZUtleXdvcmRzID8gW2V4dHJhVHlwZUtleXdvcmRzXSA6IFtdKSxcbiAgICBleHRlbnNpb25cbiAgXS5qb2luKFwiLCBcIik7XG4gIGNvbnN0IGJhc2VSZXF1ZXN0U3RhdGUgPSBPYmplY3QuYXNzaWduKHsgdHlwZSwgZXh0ZW5zaW9uIH0sIChwcm9wZXJ0aWVzID8geyBwcm9wZXJ0aWVzOiBKU09OLnN0cmluZ2lmeShwcm9wZXJ0aWVzKSB9IDoge30pKTtcbiAgLy8gV2UgY2FuJ3QganVzdCBlbmNvZGUgVVJMIHNpbmNlIHVybCBmcm9tIERyaXZlIGhhdmUgQmVhcmVyIGluIHRoZSBlbmNvZGVyIHdpbGwgYnJlYWsgdGhhdFxuICAvLyBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcC9pc3N1ZXMvNDE2MTdcbiAgY29uc3QgYWRkaXRpb25hbFJlcXVlc3RTdGF0ZSA9IGZpbGVcbiAgICA/IHsgZmlsZSB9XG4gICAgOiB7IGRhdGFVcmw6IGRhdGFVcmwuaW5jbHVkZXMoYGh0dHBIZWFkZXJzPXtcIkF1dGhvcml6YXRpb25cImApID8gZGF0YVVybCA6IGVuY29kZVVSSShkYXRhVXJsKSB9O1xuICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgYmFzZVJlcXVlc3RTdGF0ZSksIGFkZGl0aW9uYWxSZXF1ZXN0U3RhdGUpLCBmb3JtYXR0ZWRJdGVtUHJvcGVydGllcyksIHsgdHlwZUtleXdvcmRzIH0pO1xufTtcbmNvbnN0IGNyZWF0ZUZvcm0gPSAoZm9ybWF0SXRlbVByb3BzLCBhZGRJdGVtUHJvcHMpID0+IHtcbiAgY29uc3QgZm9ybVByb3BlcnRpZXMgPSBnZXRBZGRJdGVtUGFyYW1ldGVycyhmb3JtYXRJdGVtUHJvcHMsIGFkZEl0ZW1Qcm9wcyk7XG4gIGNvbnN0IGFkZEFzVW5pcXVlRmlsZSA9ICEhYWRkSXRlbVByb3BzLmFkZEFzVW5pcXVlRmlsZTtcbiAgY29uc3QgZm9ybSA9IG5ldyBGb3JtRGF0YSgpO1xuICBmb3JtLmFwcGVuZChcImZcIiwgXCJqc29uXCIpO1xuICBmb3JtLmFwcGVuZChcImFzeW5jXCIsIFwidHJ1ZVwiKTtcbiAgT2JqZWN0LmtleXMoZm9ybVByb3BlcnRpZXMpLmZvckVhY2goKHByb3BlcnR5KSA9PiB7XG4gICAgaWYgKGFkZEFzVW5pcXVlRmlsZSAmJiBwcm9wZXJ0eSA9PT0gXCJmaWxlXCIpIHtcbiAgICAgIGNvbnN0IGZpbGVOYW1lID0gYWRkSXRlbVByb3BzLmZpbGVOYW1lO1xuICAgICAgZm9ybS5hcHBlbmQocHJvcGVydHksIGZvcm1Qcm9wZXJ0aWVzW3Byb3BlcnR5XSwgZmlsZU5hbWUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGZvcm0uYXBwZW5kKHByb3BlcnR5LCBmb3JtUHJvcGVydGllc1twcm9wZXJ0eV0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBmb3JtO1xufTtcbmNvbnN0IGdldEFkZEl0ZW1VcmwgPSAodXNlciwgZm9sZGVyKSA9PiB7XG4gIGNvbnN0IGZvbGRlclVybCA9IChmb2xkZXIgPT09IG51bGwgfHwgZm9sZGVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmb2xkZXIuaWQpICYmIChmb2xkZXIgPT09IG51bGwgfHwgZm9sZGVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmb2xkZXIuaWQpICE9PSAoZm9sZGVyID09PSBudWxsIHx8IGZvbGRlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZm9sZGVyLnVzZXJuYW1lKSA/IGAvJHtmb2xkZXIuaWR9YCA6IFwiXCI7XG4gIHJldHVybiBgJHt1c2VyLnVzZXJDb250ZW50VXJsfSR7Zm9sZGVyVXJsfS9hZGRJdGVtYDtcbn07XG5cbmNvbnN0IGdldEl0ZW1VcmwgPSAoaXRlbUlkLCBwb3J0YWwpID0+IGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9Y29udGVudC9pdGVtcy8ke2l0ZW1JZH1gO1xuY29uc3QgZ2V0SXRlbSA9IGFzeW5jIChpdGVtSWQsIHBvcnRhbCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVybCA9IGdldEl0ZW1VcmwoaXRlbUlkLCBwb3J0YWwpO1xuICAgIHJldHVybiB7IHJlc3VsdDogYXdhaXQgcmVxdWVzdCh1cmwpIH07XG4gIH1cbiAgY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS53YXJuKFwiZXJyb3IgZ2V0dGluZyBpdGVtXCIsIGVycm9yKTtcbiAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICB9XG59O1xuY29uc3QgYWRkVGh1bWJuYWlsVG9JdGVtID0gYXN5bmMgKGl0ZW1JZCwgdGh1bWJuYWlsSW5mbykgPT4ge1xuICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICBzd2l0Y2ggKHRodW1ibmFpbEluZm8udHlwZSkge1xuICAgIGNhc2UgXCJiYXNlNjRcIjpcbiAgICAgIGZvcm1EYXRhLmFwcGVuZChcImRhdGFcIiwgdGh1bWJuYWlsSW5mby5kYXRhKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgXCJ1cmxcIjpcbiAgICAgIGZvcm1EYXRhLmFwcGVuZChcInVybFwiLCB0aHVtYm5haWxJbmZvLnVybCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIFwiZmlsZVwiOlxuICAgICAgZm9ybURhdGEuYXBwZW5kKFwiZmlsZVwiLCB0aHVtYm5haWxJbmZvLmZpbGUpO1xuICAgICAgYnJlYWs7XG4gIH1cbiAgZm9ybURhdGEuYXBwZW5kKFwiZlwiLCBcImpzb25cIik7XG4gIGZvcm1EYXRhLmFwcGVuZChcInRva2VuXCIsIGdldFRva2VuKGNvbmZpZ1N0YXRlLnBvcnRhbCkpO1xuICByZXR1cm4gYXdhaXQgZm9ybVJlcXVlc3QoYCR7Z2V0UmVzdEJhc2VVcmwoKX1jb250ZW50L3VzZXJzLyR7Y29uZmlnU3RhdGUudXNlci51c2VybmFtZX0vaXRlbXMvJHtpdGVtSWR9L3VwZGF0ZVRodW1ibmFpbGAsIGZvcm1EYXRhLCB7fSwgXCJwb3N0XCIpO1xufTtcbmFzeW5jIGZ1bmN0aW9uIG1vdmVJdGVtKGl0ZW1JZCwgZm9sZGVyKSB7XG4gIGNvbnN0IHVzZXIgPSBjb25maWdTdGF0ZS51c2VyO1xuICBjb25zdCB1cmwgPSBgJHt1c2VyLnVzZXJDb250ZW50VXJsfS9tb3ZlSXRlbXNgO1xuICByZXR1cm4gYXdhaXQgcmVxdWVzdCh1cmwsIHsgaXRlbXM6IGl0ZW1JZCwgZm9sZGVyIH0sIHt9LCBcInBvc3RcIik7XG59XG5hc3luYyBmdW5jdGlvbiBkZWxldGVJdGVtKGl0ZW1JZCwgeyBwZXJtYW5lbnREZWxldGUgPSBmYWxzZSB9ID0ge30pIHtcbiAgY29uc3QgdXNlciA9IGNvbmZpZ1N0YXRlLnVzZXI7XG4gIGNvbnN0IHVybCA9IGAke3VzZXIudXNlckNvbnRlbnRVcmx9L2l0ZW1zLyR7aXRlbUlkfS9kZWxldGVgO1xuICByZXR1cm4gYXdhaXQgcmVxdWVzdCh1cmwsIHsgcGVybWFuZW50RGVsZXRlIH0sIHt9LCBcInBvc3RcIik7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRSZWxhdGVkSXRlbXMoaXRlbUlkLCByZWxhdGlvbnNoaXBUeXBlLCBkaXJlY3Rpb24pIHtcbiAgY29uc3QgZGlyZWN0aW9uUGFyYW0gPSBkaXJlY3Rpb24gPyBgJmRpcmVjdGlvbj0ke2RpcmVjdGlvbn1gIDogXCJcIjtcbiAgY29uc3QgdXJsID0gYCR7Z2V0UmVzdEJhc2VVcmwoKX1jb250ZW50L2l0ZW1zLyR7aXRlbUlkfS9yZWxhdGVkSXRlbXM/cmVsYXRpb25zaGlwVHlwZT0ke3JlbGF0aW9uc2hpcFR5cGV9JHtkaXJlY3Rpb25QYXJhbX1gO1xuICByZXR1cm4gYXdhaXQgcmVxdWVzdCh1cmwpO1xufVxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlSXRlbShpdGVtSWQsIHVwZGF0ZU9iaiwgcG9ydGFsVXNlcikge1xuICB2YXIgX2E7XG4gIGNvbnN0IHVzZXIgPSAoX2EgPSBwb3J0YWxVc2VyICE9PSBudWxsICYmIHBvcnRhbFVzZXIgIT09IHZvaWQgMCA/IHBvcnRhbFVzZXIgOiBjb25maWdTdGF0ZS51c2VyKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBjb25maWdTdGF0ZS5wb3J0YWwudXNlcjtcbiAgY29uc3QgdXNlckNvbnRlbnRVcmwgPSB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwiYXBwZW5kXCIgPyBhZGRJdGVtU3RhdGUuZXhpc3RpbmdJdGVtLml0ZW1Pd25lci51c2VyQ29udGVudFVybCA6IHVzZXIudXNlckNvbnRlbnRVcmw7IC8vRm9yIFIwMiBQYXRjaCAvLyAhIFVzZSBmZXRjaFVzZXIgaWYgaXRlbU93bmVyIGlzIG5vdCBhdmFpbGFibGVcbiAgY29uc3QgdXJsID0gYCR7dXNlckNvbnRlbnRVcmx9L2l0ZW1zLyR7aXRlbUlkfS91cGRhdGVgO1xuICByZXR1cm4gcmVxdWVzdCh1cmwsIHVwZGF0ZU9iaiwge30sIFwicG9zdFwiKTtcbn1cbmNvbnN0IGdldEl0ZW1EYXRhID0gKGl0ZW1JZCwgcG9ydGFsKSA9PiB7XG4gIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9Y29udGVudC9pdGVtcy8ke2l0ZW1JZH0vZGF0YWA7XG4gIHJldHVybiByZXF1ZXN0KHVybCk7XG59O1xuYXN5bmMgZnVuY3Rpb24gdXBkYXRlQ2F0ZWdvcmllcyhwb3J0YWwsIGl0ZW1JZHMsIGNhdGVnb3JpZXMpIHtcbiAgY29uc3QgdXJsID0gYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX0vY29udGVudC91cGRhdGVJdGVtc2A7XG4gIGNvbnN0IGl0ZW1zID0gSlNPTi5zdHJpbmdpZnkoaXRlbUlkcy5tYXAoKGlkKSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIFtpZF06IHsgY2F0ZWdvcmllcyB9XG4gICAgfTtcbiAgfSkpO1xuICByZXR1cm4gcmVxdWVzdCh1cmwsIHsgaXRlbXMgfSwge30sIFwicG9zdFwiKTtcbn1cbmNvbnN0IGNvbW1pdEl0ZW0gPSBhc3luYyAoaXRlbUlkLCBhZGRJdGVtUHJvcHMpID0+IHtcbiAgY29uc3QgdXNlciA9IGNvbmZpZ1N0YXRlLnVzZXI7XG4gIGNvbnN0IHVybCA9IGAke3VzZXIudXNlckNvbnRlbnRVcmx9L2l0ZW1zLyR7aXRlbUlkfS9jb21taXRgO1xuICBjb25zdCBmb3JtID0gY3JlYXRlRm9ybShpdGVtUHJvcGVydGllc1N0YXRlLCBhZGRJdGVtUHJvcHMpO1xuICBmb3JtLmRlbGV0ZShcImZpbGVcIik7XG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZm9ybVJlcXVlc3QodXJsLCBmb3JtLCB7fSwgXCJwb3N0XCIpO1xuICByZXR1cm4gcmVzcG9uc2U7XG59O1xuY29uc3QgY2FuY2VsSXRlbSA9IGFzeW5jIChpdGVtSWQpID0+IHtcbiAgY29uc3QgdXNlciA9IGNvbmZpZ1N0YXRlLnVzZXI7XG4gIGNvbnN0IHVybCA9IGAke3VzZXIudXNlckNvbnRlbnRVcmx9L2l0ZW1zLyR7aXRlbUlkfS9jYW5jZWxgO1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsLCB7fSwge30sIFwicG9zdFwiKTtcbiAgcmV0dXJuIHJlc3BvbnNlO1xufTtcbi8qKiBTZW5kIHByb2Nlc3NlZCBpdGVtIHRvIHRoZSBzZXJ2ZXIgKi9cbmNvbnN0IHNlbmRBZGRJdGVtUmVxdWVzdCA9IGFzeW5jIChpdGVtKSA9PiB7XG4gIGNvbnN0IHVybCA9IGdldEFkZEl0ZW1VcmwoY29uZmlnU3RhdGUudXNlciwgaXRlbVByb3BlcnRpZXNTdGF0ZS5mb2xkZXIpO1xuICBjb25zdCBmb3JtYXR0ZWRJdGVtUHJvcGVydGllcyA9IGZvcm1hdEl0ZW1Qcm9wZXJ0aWVzKGl0ZW1Qcm9wZXJ0aWVzU3RhdGUpO1xuICBjb25zdCBpc1VybFJlcXVlc3RQYXJhbWV0ZXJzID0gKGl0ZW0pID0+IGl0ZW0udXJsICYmICEhaXRlbS5zZXJ2aWNlSW5mbztcbiAgY29uc3QgcmVxdWVzdEl0ZW0gPSBPYmplY3QuYXNzaWduKHt9LCBpdGVtKTtcbiAgLy8gUmVtb3ZlIHJlZHVuZGFudCBwcm9wZXJ0aWVzXG4gIGRlbGV0ZSByZXF1ZXN0SXRlbS5pbml0aWFsRm9sZGVycztcbiAgZGVsZXRlIHJlcXVlc3RJdGVtLmluaXRpYWxUaXRsZTtcbiAgZGVsZXRlIHJlcXVlc3RJdGVtLm5ld0l0ZW1Nb2RlO1xuICBkZWxldGUgcmVxdWVzdEl0ZW0uc2VydmljZUluZm87XG4gIGRlbGV0ZSByZXF1ZXN0SXRlbS5hbGxvd1N0b3JlZEF1dGg7XG4gIGRlbGV0ZSByZXF1ZXN0SXRlbS5pc1NlY3VyZWQ7XG4gIGRlbGV0ZSByZXF1ZXN0SXRlbS5jaGVja0F1dGg7XG4gIGRlbGV0ZSByZXF1ZXN0SXRlbS5hZ3NUeXBlO1xuICBkZWxldGUgcmVxdWVzdEl0ZW0uZGV2ZWxvcGVyQ3JlZGVudGlhbHNUeXBlO1xuICBkZWxldGUgcmVxdWVzdEl0ZW0uYXBwbGljYXRpb25FbnZpcm9ubWVudDtcbiAgZGVsZXRlIHJlcXVlc3RJdGVtLmFwaUtleVJlZmVycmVyVXJscztcbiAgZGVsZXRlIHJlcXVlc3RJdGVtLmRldmVsb3BlckNyZWRlbnRpYWxzUmVkaXJlY3RVcmxzO1xuICBkZWxldGUgcmVxdWVzdEl0ZW0uZGV2ZWxvcGVyUHJpdmlsZWdlcztcbiAgcmV0dXJuIGF3YWl0IHJlcXVlc3QodXJsLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCByZXF1ZXN0SXRlbSksIChpc1VybFJlcXVlc3RQYXJhbWV0ZXJzKGl0ZW0pID8geyBzZXJ2aWNlSW5mbzogSlNPTi5zdHJpbmdpZnkoaXRlbS5zZXJ2aWNlSW5mbykgfSA6IHt9KSksIHsgdHlwZUtleXdvcmRzOiBKU09OLnN0cmluZ2lmeShpdGVtLnR5cGVLZXl3b3JkcykgfSksIGZvcm1hdHRlZEl0ZW1Qcm9wZXJ0aWVzKSwge30sIFwicG9zdFwiKTtcbn07XG5hc3luYyBmdW5jdGlvbiBzZWFyY2hFeGlzdGluZ0l0ZW0odGl0bGUsIHR5cGUsIGZvbGRlciwgZXh0ZW5zaW9uLCB1c2VyLCBwb3J0YWwpIHtcbiAgdXNlciAhPT0gbnVsbCAmJiB1c2VyICE9PSB2b2lkIDAgPyB1c2VyIDogKHVzZXIgPSBjb25maWdTdGF0ZS51c2VyKTtcbiAgcG9ydGFsICE9PSBudWxsICYmIHBvcnRhbCAhPT0gdm9pZCAwID8gcG9ydGFsIDogKHBvcnRhbCA9IGNvbmZpZ1N0YXRlLnBvcnRhbCk7XG4gIGNvbnN0IGZvbGRlcklkID0gIWZvbGRlciB8fCBmb2xkZXIuaWQgPT09IHVzZXIudXNlcm5hbWUgPyBcInJvb3RcIiA6IGZvbGRlci5pZDtcbiAgY29uc3QgYmFzZW5hbWUgPSB0aXRsZS5yZXBsYWNlKGAuJHtleHRlbnNpb259YCwgXCJcIik7XG4gIC8vIFRPRE86IHJlZmluZSB0aGlzIGV4aXN0aW5nIGl0ZW0gc2VhcmNoIHNvIGl0IGRvZXNuJ3QgcmV0dXJuIGEgZmFsc2UgcG9zaXRpdmUgd2hlbiB0aGUgc2FtZSBpdGVtIGlzIGZvdW5kXG4gIC8vIGluIHRoZSBjYXNlIG9mIGZlYXR1cmUgY29sbGVjdGlvbnMsIHRoZXkgaGF2ZSBhIHR5cGUgb2YgRmVhdHVyZSBMYXllcixcbiAgLy8gc28gaXQgd2lsbCBtYXRjaCBpdHNlbGYgYXMgeW91J3JlIGFsc28gcHVibGlzaGluZyBhIGZlYXR1cmUgbGF5ZXIuICgjMzY2NTgpXG4gIC8vIGZvciBub3cgd2UnbGwganVzdCBza2lwIHRoaXMgdmFsaWRhdGlvbiBpbiB0aGlzIGNhc2VcbiAgLy8gQWRkaXRpb25hbGx5LCBub24tcHVibGlzaGVkIEV4Y2VsIGZpbGVzIGFyZSBhbHJlYWR5IGNyZWF0ZWQgYW5kIGp1c3QgbmVlZCB0byBiZSB1cGRhdGVkXG4gIC8vIHNvIHRoZSBleGlzdGluZyBpdGVtIGZvdW5kIGhlcmUgaXMgdGhlIGl0ZW0gdGhhdCBuZWVkcyB0byBiZSB1cGRhdGVkXG4gIGlmIChleHRlbnNpb24gPT09IFwiZmVhdHVyZWNvbGxlY3Rpb25cIiB8fCB0eXBlID09PSBcIk1pY3Jvc29mdCBFeGNlbFwiKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgY29uc3QgcXVlcnlMaXN0ID0gW1xuICAgIGB0aXRsZTogXCIke2Jhc2VuYW1lfVwiYCxcbiAgICBgdHlwZTogXCIke3R5cGV9XCJgLFxuICAgIGBvd25lcjogXCIke3VzZXIudXNlcm5hbWV9XCJgLFxuICAgIGBvd25lcmZvbGRlcjogXCIke2ZvbGRlcklkfVwiYFxuICBdO1xuICBjb25zdCBzZWFyY2hSZXN1bHRzID0gYXdhaXQgcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfXNlYXJjaGAsIHtcbiAgICBmaWx0ZXI6IHF1ZXJ5TGlzdC5qb2luKFwiIEFORCBcIiksXG4gICAgbnVtOiAxXG4gIH0pO1xuICByZXR1cm4gKHNlYXJjaFJlc3VsdHMgPT09IG51bGwgfHwgc2VhcmNoUmVzdWx0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VhcmNoUmVzdWx0cy50b3RhbCkgPiAwXG4gICAgPyB7XG4gICAgICBudW06IHNlYXJjaFJlc3VsdHMubnVtLFxuICAgICAgaXRlbVVSTExpc3Q6IHNlYXJjaFJlc3VsdHMucmVzdWx0cy5tYXAoKGl0ZW0pID0+IGdldEl0ZW1Ib21lQXBwVXJsKGl0ZW0uaWQsIGNvbmZpZ1N0YXRlLmNvbmZpZy5iYXNlVXJsKSlcbiAgICB9XG4gICAgOiBudWxsO1xufVxuYXN5bmMgZnVuY3Rpb24gc2VhcmNoRm9yRXhpc3RpbmdJdGVtVXJsQnlOYW1lKG5hbWUsIGl0ZW1UeXBlKSB7XG4gIGNvbnN0IG5hbWVUb0NoZWNrID0gZm9ybWF0RmlsZU5hbWUobmFtZSk7XG4gIGNvbnN0IHsgdXNlciwgY29uZmlnLCBwb3J0YWwgfSA9IGNvbmZpZ1N0YXRlO1xuICBjb25zdCB7IGZvbGRlciB9ID0gaXRlbVByb3BlcnRpZXNTdGF0ZTtcbiAgY29uc3QgZm9sZGVySWQgPSAhZm9sZGVyIHx8IGZvbGRlci5pZCA9PT0gdXNlci51c2VybmFtZSA/IFwicm9vdFwiIDogZm9sZGVyLmlkO1xuICBjb25zdCBxdWVyeUxpc3QgPSBbYG93bmVyOiBcIiR7dXNlci51c2VybmFtZX1cImAsIGBvd25lcmZvbGRlcjogXCIke2ZvbGRlcklkfVwiYF07XG4gIGlmIChpdGVtVHlwZSkge1xuICAgIHF1ZXJ5TGlzdC5wdXNoKGB0eXBlOiBcIiR7aXRlbVR5cGV9XCJgKTtcbiAgfVxuICBjb25zdCBNQVhfUVVFUllfSVRFTSA9IDEwMDtcbiAgY29uc3QgTUFYX1JFVFJZID0gMTA7XG4gIGxldCByZXN1bHRJdGVtO1xuICBsZXQgY3VyU3RhcnQgPSAxO1xuICBmb3IgKGxldCByZXRyeSA9IDA7IHJldHJ5IDwgTUFYX1JFVFJZICYmICFyZXN1bHRJdGVtICYmIGN1clN0YXJ0ID4gLTE7IHJldHJ5KyspIHtcbiAgICBjb25zdCB7IG5leHRTdGFydCwgcmVzdWx0cyB9ID0gYXdhaXQgcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybCgpfXNlYXJjaGAsIHtcbiAgICAgIFtwb3J0YWwuaXNQb3J0YWwgPyBcInFcIiA6IFwiZmlsdGVyXCJdOiBxdWVyeUxpc3Quam9pbihcIiBBTkQgXCIpLFxuICAgICAgbnVtOiBNQVhfUVVFUllfSVRFTSxcbiAgICAgIHN0YXJ0OiBjdXJTdGFydFxuICAgIH0pO1xuICAgIHJlc3VsdEl0ZW0gPSByZXN1bHRzLmZpbmQoKGl0ZW0pID0+IGl0ZW0ubmFtZSA9PT0gbmFtZVRvQ2hlY2spO1xuICAgIGN1clN0YXJ0ID0gbmV4dFN0YXJ0O1xuICB9XG4gIHJldHVybiByZXN1bHRJdGVtID8gZ2V0SXRlbUhvbWVBcHBVcmwocmVzdWx0SXRlbS5pZCwgY29uZmlnLmJhc2VVcmwpIDogbnVsbDtcbn1cblxuZXhwb3J0IHsgZ2V0SXRlbSBhcyBhLCBnZXRSZWxhdGVkSXRlbXMgYXMgYiwgc2VuZEFkZEl0ZW1SZXF1ZXN0IGFzIGMsIGRlbGV0ZUl0ZW0gYXMgZCwgdXBkYXRlSXRlbSBhcyBlLCBmb3JtYXRJdGVtUHJvcGVydGllcyBhcyBmLCBnZXRJdGVtVXJsIGFzIGcsIHNlYXJjaEZvckV4aXN0aW5nSXRlbVVybEJ5TmFtZSBhcyBoLCBhZGRUaHVtYm5haWxUb0l0ZW0gYXMgaSwgZ2V0QWRkSXRlbVBhcmFtZXRlcnMgYXMgaiwgY3JlYXRlRm9ybSBhcyBrLCBjb21taXRJdGVtIGFzIGwsIG1vdmVJdGVtIGFzIG0sIGdldEFkZEl0ZW1VcmwgYXMgbiwgY2FuY2VsSXRlbSBhcyBvLCBnZXRJdGVtRGF0YSBhcyBwLCBzZWFyY2hFeGlzdGluZ0l0ZW0gYXMgcywgdXBkYXRlQ2F0ZWdvcmllcyBhcyB1IH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=