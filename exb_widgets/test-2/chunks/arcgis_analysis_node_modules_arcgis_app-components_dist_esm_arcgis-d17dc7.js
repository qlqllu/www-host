"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-d17dc7"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item_19.entry.js":
/*!*********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item_19.entry.js ***!
  \*********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item: () => (/* binding */ ArcgisNewItem),
/* harmony export */   arcgis_new_item_create_layers_list: () => (/* binding */ ArcgisNewItemCreateLayersList),
/* harmony export */   arcgis_new_item_csv_field: () => (/* binding */ ArcgisNewItemCsvField),
/* harmony export */   arcgis_new_item_custom_parameter: () => (/* binding */ ArcgisNewItemCustomParameter),
/* harmony export */   arcgis_new_item_custom_parameters: () => (/* binding */ ArcgisNewItemCustomParameters),
/* harmony export */   arcgis_new_item_input_readonly: () => (/* binding */ ArcgisNewItemInputReadonly),
/* harmony export */   arcgis_new_item_layer_search: () => (/* binding */ ArcgisNewItemLayerSearch),
/* harmony export */   arcgis_new_item_pages_application: () => (/* binding */ ArcgisNewItemPagesApplication),
/* harmony export */   arcgis_new_item_pages_auth: () => (/* binding */ ArcgisNewItemPagesAuth),
/* harmony export */   arcgis_new_item_pages_bulk_layer_select: () => (/* binding */ ArcgisNewItemPagesBulkLayerSelect),
/* harmony export */   arcgis_new_item_pages_cloud: () => (/* binding */ ArcgisNewItemPagesCloud),
/* harmony export */   arcgis_new_item_pages_file_fields: () => (/* binding */ ArcgisNewItemPagesFileFields),
/* harmony export */   arcgis_new_item_pages_item_properties: () => (/* binding */ ArcgisNewItemPagesItemProperties),
/* harmony export */   arcgis_new_item_pages_publish_select: () => (/* binding */ ArcgisNewItemPagesPublishSelect),
/* harmony export */   arcgis_new_item_pages_single_layer_select: () => (/* binding */ ArcgisNewItemPagesSingleLayerSelect),
/* harmony export */   arcgis_new_item_pages_url_type: () => (/* binding */ ArcgisNewItemPagesUrlType),
/* harmony export */   arcgis_new_item_pages_zip_select: () => (/* binding */ ArcgisNewItemPagesZipSelect),
/* harmony export */   arcgis_new_item_timezone_dropdown: () => (/* binding */ ArcgisNewItemTimezoneDropdown),
/* harmony export */   arcgis_new_item_url: () => (/* binding */ ArcgisNewItemUrl)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./user-e3dedc4a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js");
/* harmony import */ var _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./item-properties-e6412a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/* harmony import */ var _tile_layer_90a6b901_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./tile-layer-90a6b901.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-90a6b901.js");
/* harmony import */ var _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./feature-layer-38cdae87.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-38cdae87.js");
/* harmony import */ var _tile_layer_f8be7028_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./tile-layer-f8be7028.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-f8be7028.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _utils_86ac6961_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./utils-86ac6961.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-86ac6961.js");
/* harmony import */ var _file_f36193e9_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./file-f36193e9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-f36193e9.js");
/* harmony import */ var _server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./server-item-f12153e6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js");
/* harmony import */ var _item_types_054054c6_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./item-types-054054c6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-054054c6.js");
/* harmony import */ var _privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./privileges-35590eb4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-35590eb4.js");
/* harmony import */ var _tile_layer_bd7e56c2_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./tile-layer-bd7e56c2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-bd7e56c2.js");
/* harmony import */ var _subscription_09185996_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./subscription-09185996.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/subscription-09185996.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./geocode-7eb7c0df.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-7eb7c0df.js");
/* harmony import */ var _guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./guid-4f4176ba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js");
/* harmony import */ var _url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./url-f3b82cc7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-f3b82cc7.js");
/* harmony import */ var _index_eb224d3c_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./index-eb224d3c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-eb224d3c.js");
/* harmony import */ var _data_store_f509564d_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./data-store-f509564d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/data-store-f509564d.js");
/* harmony import */ var _image_collection_a67002cc_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./image-collection-a67002cc.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/image-collection-a67002cc.js");
/* harmony import */ var _publish_item_82ffa7f8_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./publish-item-82ffa7f8.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/publish-item-82ffa7f8.js");
/* harmony import */ var _i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./i18n-6685247f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/i18n-6685247f.js");
/* harmony import */ var _feature_layer_d0f64b81_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./feature-layer-d0f64b81.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-d0f64b81.js");
/* harmony import */ var _analyze_a3711367_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./analyze-a3711367.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/analyze-a3711367.js");
/* harmony import */ var _ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./ags-68d4ae20.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-68d4ae20.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _feature_layer_d33ea114_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./feature-layer-d33ea114.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-d33ea114.js");
/* harmony import */ var _thumbnail_0b7adfcd_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./thumbnail-0b7adfcd.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-0b7adfcd.js");
/* harmony import */ var _query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./query-4f7b7e4d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-4f7b7e4d.js");
/* harmony import */ var _api_f7934cd7_js__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./api-f7934cd7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-f7934cd7.js");
/* harmony import */ var _item_d9d70416_js__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./item-d9d70416.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-d9d70416.js");
/* harmony import */ var _feature_layer_69305a85_js__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./feature-layer-69305a85.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-69305a85.js");
/* harmony import */ var _functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./functional-9f648bee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-9f648bee.js");
/* harmony import */ var _store_3210b604_js__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ./store-3210b604.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-3210b604.js");
/* harmony import */ var _storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ./storage-d7f5822e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js");
/* harmony import */ var _data_store_e8b5ce2f_js__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ./data-store-e8b5ce2f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/data-store-e8b5ce2f.js");
/* harmony import */ var _basic_ee9c674c_js__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ./basic-ee9c674c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/basic-ee9c674c.js");
/* harmony import */ var _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ./commonEnums-f98a323c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-f98a323c.js");
/* harmony import */ var _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ./append-58a7e7ab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-58a7e7ab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


















































// TODO: remove newItemMode === "url" once the business logic for feature collection is ready
const canSkipPublishSelectToNextPage = ({ directMode, newItemMode, itemType, cloud, isMultipageExcel, fromExistingItem, canPublishItemType }) => {
  if (fromExistingItem && !isMultipageExcel) {
    return true;
  }
  if (directMode) {
    // #2728 for CSV --- #2731 for GeoJSON
    if ((cloud && !isMultipageExcel) ||
      ((!isMultipageExcel || newItemMode === "url") &&
        (!canPublishItemType || (itemType !== "GeoJson" && itemType !== "CSV")))) {
      return true;
    }
  }
  return false;
};

const initializeWithExistingItem = async (item, options) => {
  var _a;
  const { existingItemType, portal, existingItemPublishType } = options;
  _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.initialFolder =
    (_a = (await (0,_user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_5__.d)(item.folderId, item.itemOwner))) !== null && _a !== void 0 ? _a : (0,_user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_5__.e)(item.itemOwner);
  let type = item.type;
  // After publish, somehow the new item will have GeoJSON instead of GeoJson
  if (type === "GeoJSON") {
    type = "GeoJson";
  }
  _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title = item.title;
  _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.categories = item.categories;
  const curTag = item.tags;
  if (Array.isArray(curTag)) {
    _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.tags = curTag || [];
  }
  else {
    _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.tags = (curTag !== null && curTag !== void 0 ? curTag : "").split(",");
  }
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id = item.id;
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type = type;
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.fileName = item.name;
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.existingItem = item;
  // TODO: determine if this is true
  // Enable publishing causes this bug https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/40133
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.enablePublishing = existingItemType !== "tileLayer";
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = existingItemType;
  switch (existingItemType) {
    case "file":
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.extension = _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_8__.a[type].fileExt[0];
      break;
    case "tileLayer":
      const { id, url, title } = item;
      const [{ layers, tables, serviceInfo }] = await Promise.all([
        (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.g)(url, (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.g)(portal), true)
      ]);
      const { result: updatedItemData } = await (0,_tile_layer_f8be7028_js__WEBPACK_IMPORTED_MODULE_11__.f)({
        itemId: id,
        itemUrl: url,
        publishType: existingItemPublishType === "vectorTiles" ? "vector" : "raster",
        portal,
        fullLayers: layers
      });
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.sourceTitle = title;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileLayerPublishType = existingItemPublishType;
      if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileLayerPublishType === "3dTiles") {
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tilesLayer3dTilesLayerType = _tile_layer_90a6b901_js__WEBPACK_IMPORTED_MODULE_9__.D;
        break;
      }
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileLayerData = updatedItemData;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileAutoCreation = true;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileLayerBasemapType = "standard";
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileLayerBasemapUrl = "";
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileLayerFromFeatureLayer = true;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileLayerLayers = layers;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileLayerTables = tables;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileLayerServiceInfo = serviceInfo;
      break;
  }
};

/** mapping of next page detail to element tag name */
const pages = {
  application: "arcgis-new-item-pages-application",
  auth: "arcgis-new-item-pages-auth",
  bulkLayerSelect: "arcgis-new-item-pages-bulk-layer-select",
  cloud: "arcgis-new-item-pages-cloud",
  csvLocationFields: "arcgis-new-item-pages-csv-location-fields",
  dataUpload: "arcgis-new-item-pages-data-upload",
  dataStoreBrowser: "arcgis-new-item-pages-data-store-browser",
  dataStoreList: "arcgis-new-item-pages-data-store-list",
  dataStoreSelect: "arcgis-new-item-pages-data-store-select",
  dataStoreSelectFolder: "arcgis-new-item-pages-data-store-select-folder",
  dataStoreSelectDatabase: "arcgis-new-item-pages-data-store-select-database",
  dataStoreSelectDatabaseType: "arcgis-new-item-pages-data-store-select-database-type",
  dataStoreSelectBdfs: "arcgis-new-item-pages-data-store-select-bdfs",
  dataStoreSelectBdfsCloud: "arcgis-new-item-pages-data-store-select-bdfs-cloud",
  dataStoreSelectBdfsFileshare: "arcgis-new-item-pages-data-store-select-bdfs-fileshare",
  dataStoreSelectBdfsHdfs: "arcgis-new-item-pages-data-store-select-bdfs-hdfs",
  dataStoreSelectBdfsHive: "arcgis-new-item-pages-data-store-select-bdfs-hive",
  dataStoreSelectCloud: "arcgis-new-item-pages-data-store-select-cloud",
  dataStoreSelectCloudCredentials: "arcgis-new-item-pages-data-store-select-cloud-credentials",
  dataStoreDatabaseCredentials: "arcgis-new-item-pages-data-store-database-credentials",
  dataStoreSelectNoSql: "arcgis-new-item-pages-data-store-select-nosql",
  dataStoreSelectNoSqlCredentials: "arcgis-new-item-pages-data-store-select-nosql-credentials",
  dataStoreSelectArangoCredentials: "arcgis-new-item-pages-data-store-select-arango-credentials",
  dataStoreSelectServerList: "arcgis-new-item-pages-data-store-select-server-list",
  developerCredentialsSelect: "arcgis-new-item-pages-developer-credentials-select",
  featureLayerFromExisting: "arcgis-new-item-pages-feature-layer-from-existing",
  featureLayerFromScratch: "arcgis-new-item-pages-feature-layer-from-scratch",
  featureLayerFromTemplate: "arcgis-new-item-pages-feature-layer-from-template",
  featureLayerFromURL: "arcgis-new-item-pages-feature-layer-from-url",
  featureLayerPreference: "arcgis-new-item-pages-feature-layer-preference",
  appendSelect: "arcgis-new-item-pages-append-select",
  appendUpload: "arcgis-new-item-pages-append-upload",
  appendSelectUpdate: "arcgis-new-item-pages-append-select-update",
  appendMatchFields: "arcgis-new-item-pages-append-match-fields",
  appendKeyPairSelect: "arcgis-new-item-pages-append-key-pair-select",
  appendSelectLayer: "arcgis-new-item-pages-append-select-layer",
  appendOverwrite: "arcgis-new-item-pages-append-overwrite",
  appendFinish: "arcgis-new-item-pages-append-job",
  featureLayerSelect: "arcgis-new-item-pages-feature-layer-select",
  featureLayerSummary: "arcgis-new-item-pages-feature-layer-summary",
  fileField: "arcgis-new-item-pages-file-fields",
  hybridImageSelect: "arcgis-new-item-pages-hybrid-image-select",
  itemProperties: "arcgis-new-item-pages-item-properties",
  layerUpload: "arcgis-new-item-pages-layer-upload",
  locatorSelect: "arcgis-new-item-pages-locator-select",
  publishSelect: "arcgis-new-item-pages-publish-select",
  sceneLayerSelect: "arcgis-new-item-pages-scene-layer-select",
  serverList: "arcgis-new-item-pages-server-list",
  serviceScope: "arcgis-new-item-pages-service-scope",
  singleLayerSelect: "arcgis-new-item-pages-single-layer-select",
  tileLayerFromExisting: "arcgis-new-item-pages-tile-layer-from-existing",
  tileLayerFromUrl: "arcgis-new-item-pages-tile-layer-from-url",
  tileLayerSelect: "arcgis-new-item-pages-tile-layer-select",
  tileLayerSettings: "arcgis-new-item-pages-tile-layer-settings",
  urlTypeSelect: "arcgis-new-item-pages-url-type",
  zipSelect: "arcgis-new-item-pages-zip-select",
  default: "arcgis-new-item-pages-home"
};

const handleInitWithFile = (file) => {
  const { title, fileName, extension } = (0,_file_f36193e9_js__WEBPACK_IMPORTED_MODULE_14__.s)(file);
  _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title = title;
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.file = file;
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.fileName = fileName;
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = "file";
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.extension = extension;
  return extension;
};
const analyzeItemForNextStep = (extension) => {
  const possibleItemTypes = (0,_item_types_054054c6_js__WEBPACK_IMPORTED_MODULE_16__.f)(extension);
  const itemType = possibleItemTypes[0];
  const { type, nextStep } = itemType;
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type = type;
  return { nextStep, type };
};
const handleDeleteItem = async (itemId, fromExistingItem) => {
  try {
    itemId && !fromExistingItem && (await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.d)(itemId, { permanentDelete: true }));
  }
  catch (_a) {
    // if no existing item was found, assume it's not there, safe to proceed. (WebGIS/arcgis-portal-app#40040)
    return;
  }
};

const TELEMETRY_ID = "new item";
const TELEMETRY_PAGE_NAME = "my content";
function logAddNewItemStart() {
  const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
  telemetry === null || telemetry === void 0 ? void 0 : telemetry.startWorkflow("new item upload", {
    eventType: "workflow",
    category: "new item upload",
    details: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type,
    pageName: TELEMETRY_PAGE_NAME
  });
}
function logSuccessfulItemCreation() {
  const { type, applicationType, customParameters, selectedLayerIdTracker } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
  const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
  const telemetryDetails = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.telemetryDetails;
  telemetry === null || telemetry === void 0 ? void 0 : telemetry.endWorkflow("new item upload", {
    details: type,
    pageName: TELEMETRY_PAGE_NAME
  });
  // Set up telemetry payload based on the path the user took
  const payload = {
    eventType: "other",
    pageName: TELEMETRY_PAGE_NAME,
    category: TELEMETRY_ID,
    label: TELEMETRY_ID,
    details: telemetryDetails
  };
  if (telemetryDetails === "url") {
    payload.attribute = type;
    if ((customParameters === null || customParameters === void 0 ? void 0 : customParameters.length) > 0) {
      payload.action = "customParams";
    }
    if (type === "WMS") {
      payload.count = selectedLayerIdTracker === null || selectedLayerIdTracker === void 0 ? void 0 : selectedLayerIdTracker.count;
    }
  }
  else if (applicationType) {
    payload.attribute = applicationType;
  }
  telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
}
const logInitWithFile = () => {
  const { telemetry } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
  const payload = {
    eventType: "other",
    pageName: "my content",
    category: "content page drag drop",
    label: "content"
  };
  telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
  _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.telemetryDetails = "drag drop";
};
function logItemPropertiesChanges() {
  var _a, _b;
  const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
  const { title, folder, categories, tags, snippet } = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i;
  const { initialTitle, initialFolders } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
  const homeFolder = !folder || folder.title === folder.id;
  const existingFolder = !!initialFolders.map((folder) => folder.id).find((id) => id === folder.id);
  // Log changes the user has made to default item properties
  const payload = {
    eventType: "other",
    pageName: TELEMETRY_PAGE_NAME,
    category: "new item item info",
    label: title === initialTitle ? "default title" : "title changed",
    action: (snippet === null || snippet === void 0 ? void 0 : snippet.length) > 0 ? "summary" : "no summary",
    count: (_a = tags === null || tags === void 0 ? void 0 : tags.length) !== null && _a !== void 0 ? _a : 0,
    number: (_b = categories === null || categories === void 0 ? void 0 : categories.length) !== null && _b !== void 0 ? _b : 0
  };
  // Check if the user added to a folder they created within item properties
  if (!existingFolder) {
    payload.details = "new folder";
  }
  else {
    payload.details = homeFolder ? "root folder" : "custom folder";
  }
  telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
}

const arcgisNewItemCss = ".stage{padding-bottom:1.5rem;padding-left:1px;padding-right:1px;box-sizing:border-box;width:100%;opacity:1;display:block;height:calc(100% - 2rem);transition:all 200ms ease-in-out}@media screen and (min-width: 1080px){.stage{height:min(700px, 60vh)}}.stage--fullscreen{height:100%;overflow:auto;padding-bottom:0}.stage--disable-scroll{overflow:hidden;height:33vh}.stage-anim{transform:translate3d(0, 0, 0)}.stage-anim--leaving{position:absolute;width:calc(100% - 4rem)}.stage-anim--left{opacity:0;transform:translate3d(-24px, 0, 0)}.stage-anim--right{opacity:0;transform:translate3d(24px, 0, 0)}.header{display:flex;align-items:center;position:relative}.header>.icon{border-style:none;margin-left:0.5rem;margin-right:0.5rem;padding:0;display:flex;background-color:transparent}@media screen and (max-width: 480px){.stage{padding-bottom:6rem}}.header__title{font-size:1.125rem;margin:0;padding:0;font-weight:500}.content{height:100%}.onboarding{--arcgis-information-min-width:0}.onboarding__scroll{overflow:auto;max-height:min(700px, 60vh)}.onboarding__section{padding-bottom:1rem;padding-top:0.5rem;width:255px}.onboarding__title{color:var(--calcite-ui-text-1);font-size:0.875rem;padding-top:0;margin:0;font-weight:600}.onboarding__description{margin-top:0.5rem;margin-bottom:0.75rem;font-size:0.75rem;color:var(--calcite-ui-text-1)}.modal{--calcite-modal-width:1080px;--calcite-modal-height:min(922px, 75vh)}.modal--grey{--calcite-modal-content-padding:0;--calcite-modal-content-background:var(--calcite-ui-background)}";

const ANIMATION_DURATION = 200;
const ArcgisNewItem = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.workflowCancel = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowCancel", 7);
    this.workflowComplete = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
    this.showBackButton = false;
    this.workflowCompleted = false;
    this.closeDialog = () => {
      const { id, existingItem } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
      const fromExistingItem = !!existingItem && _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow !== "append"; //don't want to delete HFL item before new file is uploaded.
      !this.workflowCompleted && this.handleCancel(id, fromExistingItem);
      this.workflowCompleted = false;
      (0,_utils_86ac6961_js__WEBPACK_IMPORTED_MODULE_13__.r)();
      this.pageHistory = ["home"];
      // Reset to make sure if the modal is opened again, it will be in the default state
      //  and any nextText change will trigger the `onChange properly
      _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.nextText = "next";
      // https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/43280
      // maintain item id on setting page register cancel
      // R2 TODO: improve store cleanup/reinitialization
      if (this.workflow === "register") {
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id = id;
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.existingItem = existingItem;
      }
    };
    this.handleCancel = async (itemId, fromExistingItem) => {
      let cancelPayload;
      const { overwritePayload } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
      if (overwritePayload) {
        cancelPayload = overwritePayload;
      }
      else {
        await _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.s.unsubscribeAll();
        await handleDeleteItem(itemId, fromExistingItem);
      }
      this.workflowCancel.emit(cancelPayload);
      const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
      (telemetry === null || telemetry === void 0 ? void 0 : telemetry.getWorkflow("new item upload")) &&
        (telemetry === null || telemetry === void 0 ? void 0 : telemetry.cancelWorkflow("new item upload", {
          details: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type
        }));
    };
    this.user = undefined;
    this.portal = undefined;
    this.api = undefined;
    this.config = undefined;
    this.telemetry = undefined;
    this.file = undefined;
    this.firstStep = undefined;
    this.initialFolder = undefined;
    this.isActive = true;
    this.layerId = undefined;
    this.layer = undefined;
    this.existingItem = undefined;
    this.existingItemType = undefined;
    this.existingItemPublishType = undefined;
    this.workflow = undefined;
    this.allowedItemTypes = undefined;
    this.allowedModes = [..._item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_8__.A];
    this.allowPublish = true;
    this.pageHistory = ["home"];
    this.initialPage = "default";
    this.navEnabled = true;
    this.transition = undefined;
    this.targetHeight = undefined;
    this.outerHeight = undefined;
    this.primaryButtonText = undefined;
    this.noPadding = undefined;
    this.isLoading = false;
    this.loadingText = undefined;
    this.disableCloseButton = false;
    this.headerIconRef = undefined;
  }
  disableNavButtons(event) {
    this.navEnabled = event.detail;
  }
  disableCloseButtons(event) {
    //disables "Cancel" and "x" buttons on modal
    if (this.isDisableClosePage(this.pageHistory[this.pageHistory.length - 1])) {
      this.disableCloseButton = event.detail;
    }
  }
  handleRedirect({ detail }) {
    const payload = {
      response: { success: true, id: null, folder: null },
      type: detail.type
    };
    if (detail.url) {
      payload.url = detail.url;
      payload.customParameters = detail.customParameters;
      payload.layers = detail.layers;
    }
    this.workflowComplete.emit(payload);
    this.isActive = false;
  }
  handleWorkflowComplete() {
    this.workflowCompleted = true;
    if (_ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map") {
      this.isLoading = true;
      this.loadingText = this.i18n.creatingLayer;
    }
    else {
      this.isActive = false;
    }
  }
  async goToNextPage(event) {
    var _a, _b, _c;
    // Reset in case we forget to set it
    _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.nextText = "next";
    this.transition = "forward";
    this.pageHistory = [...this.pageHistory, event.detail];
    this.targetHeight = null;
    this.outerHeight = this.contentSlot.offsetHeight;
    this.cleanPageHistory();
    const oldPage = this.currentScreen;
    const newPage = pages[event.detail];
    const oldPageHeight = this.el.querySelector(oldPage).clientHeight;
    const contentContainer = (_a = this.modalRef) === null || _a === void 0 ? void 0 : _a.shadowRoot.querySelector(".content");
    if (contentContainer) {
      contentContainer.style.overflow = "hidden";
    }
    await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
    const newPageHeight = (_b = this.el.querySelector(newPage)) === null || _b === void 0 ? void 0 : _b.clientHeight;
    if (newPageHeight) {
      this.targetHeight = oldPageHeight;
      this.outerHeight = null;
      await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
      this.targetHeight = newPageHeight;
    }
    await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
    this.targetHeight = null;
    this.transition = null;
    await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
    if (contentContainer) {
      contentContainer.style.overflowY = "auto";
    }
    const transitionCompleteEvent = new CustomEvent("arcgisTransitionComplete");
    (_c = this.currentPageEl) === null || _c === void 0 ? void 0 : _c.dispatchEvent(transitionCompleteEvent);
    this.focusFirstElement();
  }
  async goToPreviousPage() {
    var _a, _b, _c;
    // Reset in case we forget to
    _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.nextText = "next";
    const { pageHistory } = this;
    this.transition = "back";
    this.targetHeight = null;
    this.outerHeight = this.contentSlot.offsetHeight;
    const oldPage = pages[pageHistory[pageHistory.length - 1]] || pages.default;
    const newPage = pages[pageHistory[pageHistory.length - 2]] || pages.default;
    const oldPageHeight = this.el.querySelector(oldPage).clientHeight;
    const contentContainer = (_a = this.modalRef) === null || _a === void 0 ? void 0 : _a.shadowRoot.querySelector(".content");
    if (contentContainer) {
      contentContainer.style.overflow = "hidden";
    }
    await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
    const newPageHeight = (_b = this.el.querySelector(newPage)) === null || _b === void 0 ? void 0 : _b.clientHeight;
    if (newPageHeight) {
      this.targetHeight = oldPageHeight;
      this.outerHeight = null;
      await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
      this.targetHeight = newPageHeight;
    }
    await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
    this.targetHeight = null;
    this.transition = null;
    this.pageHistory = this.pageHistory.length === 1 ? this.pageHistory.slice(0, 1) : this.pageHistory.slice(0, -1);
    await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
    if (contentContainer) {
      contentContainer.style.overflowY = "auto";
    }
    const transitionCompleteEvent = new CustomEvent("arcgisTransitionComplete");
    (_c = this.currentPageEl) === null || _c === void 0 ? void 0 : _c.dispatchEvent(transitionCompleteEvent);
    this.focusFirstElement();
  }
  updateActive(active) {
    if (active && this.firstStep) {
      this.pageHistory = [this.firstStep];
    }
  }
  updateFirstStep(page) {
    this.pageHistory = [page];
  }
  initializeWithFile() {
    const { user, portal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
    const { file } = this;
    if (file) {
      const extension = handleInitWithFile(file);
      if (extension === "zip") {
        this.pageHistory = ["home", "zipSelect"];
        return;
      }
      const { nextStep, type } = analyzeItemForNextStep(extension);
      this.postprocessAddFromFile(type);
      // there is no reason to show publishSelect screen for users that can't publish
      if (!(0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.a)(user, type, portal) && nextStep === "publishSelect") {
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.enablePublishing = false;
        this.pageHistory = ["home", "itemProperties"];
      }
      else {
        this.pageHistory = ["home", nextStep];
      }
      logInitWithFile();
    }
  }
  postprocessAddFromFile(type) {
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileLayerPublishType = type === "3DTiles Package" ? "3dTiles" : undefined;
  }
  updateInitialFolder(folder) {
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.initialFolder = folder;
  }
  focusFirstElement() {
    var _a;
    const curPage = this.currentPageEl;
    if (curPage && !curPage.managedFocus) {
      (_a = this.modalRef) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
  }
  removePageFromHistory(page) {
    const { pageHistory } = this;
    if (pageHistory.length > 1 && pageHistory.includes(page) && pageHistory.at(-1) !== page) {
      pageHistory.splice(pageHistory.indexOf(page), 1);
    }
  }
  cleanPageHistory() {
    const { newItemMode, type, excelLayers, existingItem, cloudProviderResource } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const prevPage = this.pageHistory[this.pageHistory.length - 2];
    const isMultipageExcel = type === "Microsoft Excel" && (excelLayers === null || excelLayers === void 0 ? void 0 : excelLayers.length) > 1;
    const directMode = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map";
    if (canSkipPublishSelectToNextPage({
      directMode,
      isMultipageExcel,
      newItemMode,
      itemType: type,
      cloud: !!cloudProviderResource,
      // #38481: After a CSV/Json has been analyzed for publish, remove publishSelect from history
      // Excel files with multiple sheets should still have access
      fromExistingItem: !!existingItem,
      canPublishItemType: (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.a)(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user, type, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal)
    }) &&
      prevPage === "publishSelect") {
      this.removePageFromHistory("publishSelect");
    }
  }
  async initializeWithExistingItem() {
    const item = this.existingItem;
    const existingItemType = this.existingItemType;
    this.isLoading = true;
    await initializeWithExistingItem(item, {
      existingItemType,
      portal: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal,
      existingItemPublishType: this.existingItemPublishType
    });
    this.isLoading = false;
    const type = item.type;
    if (this.workflow === "append") {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.layerId = this === null || this === void 0 ? void 0 : this.layerId;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.sublayer = this === null || this === void 0 ? void 0 : this.layer;
      _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow = "append";
      this.initialPage = "appendSelect";
      this.pageHistory = [this.initialPage];
    }
    else if (this.workflow === "update") {
      this.pageHistory = ["dataUpload"];
    }
    else if (["CSV", "Microsoft Excel"].includes(type)) {
      this.pageHistory = ["publishSelect"];
    }
    else if (existingItemType === "tileLayer") {
      this.pageHistory = ["tileLayerSettings"];
    }
    else if (this.workflow === "register") {
      // TODO: rework this once Steven publish his dubstep diagram
      this.pageHistory = ["developerCredentialsSelect"];
    }
    else {
      this.pageHistory = ["itemProperties"];
    }
  }
  triggerPageTransition(eventType) {
    var _a;
    const event = new CustomEvent(eventType, { cancelable: true });
    const eventNotCancelled = (_a = this.currentPageEl) === null || _a === void 0 ? void 0 : _a.dispatchEvent(event);
    if (eventNotCancelled && eventType === "arcgisNewItemPagePrev") {
      this.goToPreviousPage();
    }
  }
  /** Update the component in the modal's slot when a state change is detected */
  displayPage() {
    if (!this.isActive) {
      // No point of rendering elements on the screen if modal is not active
      return;
    }
    const { transition, pageHistory, initialPage } = this;
    const forward = transition === "forward";
    const back = transition === "back";
    const next = back ? pageHistory[pageHistory.length - 2] : pageHistory[pageHistory.length - 1];
    // TODO: strictly type this
    const NextScreen = `${pages[next] || pages[initialPage]}`;
    const CurrentScreen = this.currentScreen;
    if (CurrentScreen && pageHistory.length > 1 && transition) {
      return [
        (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(CurrentScreen, { class: {
            stage: true,
            "stage--fullscreen": this.isFullScreenPage(CurrentScreen),
            "stage-anim": true,
            "stage-anim--leaving": true,
            "stage-anim--left": forward,
            "stage-anim--right": back
          } }),
        (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(NextScreen, { class: {
            stage: true,
            "stage--fullscreen": this.isFullScreenPage(NextScreen),
            "stage-anim": true,
            "stage-anim--left": back,
            "stage-anim--right": forward
          }, style: { height: `${this.targetHeight}px` }, ref: (el) => {
            var _a;
            this.currentPageEl = el;
            (_a = this.modalRef) === null || _a === void 0 ? void 0 : _a.updateFocusTrapElements();
          } })
      ];
    }
    else {
      this.currentScreen = NextScreen;
    }
    const style = this.targetHeight ? { height: `${this.targetHeight}px` } : {};
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(NextScreen, { class: {
        stage: true,
        "stage--fullscreen": this.isFullScreenPage(NextScreen)
      }, style: style, ref: (el) => {
        this.currentPageEl = el;
      } }));
  }
  disconnectedCallback() {
    this.closeDialog();
  }
  /** Initialize the itemPropertiesStore with data from props on load */
  async componentWillLoad() {
    var _a, _b, _c;
    const { file, portal, api, user, config, telemetry, existingItem, firstStep, workflow, initialFolder } = this;
    const locale = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_4__.g)(this.el);
    this.i18n = locale[0];
    _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n = locale[0];
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.lang = locale[1];
    this.primaryButtonText = this.i18n.next;
    _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow = workflow;
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal = portal;
    if (!!user) {
      const { error, result: _isPortalBackedBySDS } = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.f)(() => (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.i)(portal, user), "isPortalBackedBySDS", portal.id);
      if (!error) {
        _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isBackedBySDS = _isPortalBackedBySDS;
      }
    }
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.api = api;
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.config = config;
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes = this.allowedItemTypes;
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes = this.allowedModes;
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowPublish = this.allowPublish;
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry = telemetry;
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.config.helpBase = (_a = config === null || config === void 0 ? void 0 : config.helpBase) !== null && _a !== void 0 ? _a : portal.helpBase;
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.initialFolder = initialFolder;
    if (!((_b = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.config) === null || _b === void 0 ? void 0 : _b.helpMap)) {
      const helpResponse = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.r)(`${config.restBaseUrl}/portals/helpmap?culture=${_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.lang}`);
      _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.config.helpMap = helpResponse === null || helpResponse === void 0 ? void 0 : helpResponse.helpMap.m;
    }
    if (user) {
      _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user = user;
      _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.userLicensedItems =
        (_c = user.userLicensedItems) !== null && _c !== void 0 ? _c : (await (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.f)(portal));
    }
    if (file) {
      this.initializeWithFile();
    }
    if (existingItem) {
      this.initializeWithExistingItem();
    }
    if (firstStep) {
      this.pageHistory = [this.firstStep];
    }
    _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.a.onChange("disableScroll", () => {
      _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.disableScroll
        ? this.contentSlot.classList.add("stage--disable-scroll")
        : this.contentSlot.classList.remove("stage--disable-scroll");
    });
    _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.a.onChange("nextText", () => {
      const { i18n } = this;
      let nextText = i18n.next;
      switch (_ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.nextText) {
        case "addToMap":
          nextText = i18n.common.addToMap;
          break;
        case "createAndAddToMap":
          nextText = i18n.common.createAndAddToMap;
          break;
        case "useAsBaseMap":
          nextText = i18n.urlType.useAsBaseMap;
          break;
        case "updateAppend":
          nextText = i18n.common.updateAndComplete;
          break;
        case "addAndComplete":
          nextText = i18n.common.addAndComplete;
          break;
        case "proceed":
          nextText = i18n.common.proceed;
          break;
        case "register":
          nextText = i18n.common.register;
          break;
        case "save":
          nextText = i18n.save;
          break;
        case "createConnection":
          nextText = i18n.common.createConnection;
          break;
        case "signInAndOverwrite":
          nextText = i18n.common.signInAndOverwrite;
          break;
        case "overwriteAndComplete":
          nextText = i18n.common.overwriteAndComplete;
          break;
      }
      this.primaryButtonText = nextText;
    });
  }
  componentWillRender() {
    this.showBackButton = this.pageHistory.length > 1;
  }
  componentDidLoad() {
    this.modalRef.setFocus();
  }
  componentDidRender() {
    var _a, _b;
    const shadowRoot = (_a = this.modalRef) === null || _a === void 0 ? void 0 : _a.shadowRoot;
    // Help the tooltip to be on top of the footer
    if (shadowRoot) {
      const modalHeader = shadowRoot.querySelector(".header");
      if (modalHeader) {
        modalHeader.style.zIndex = "3";
      }
      const modalFooter = shadowRoot.querySelector(".footer");
      const modalContent = shadowRoot.querySelector(".content");
      const modal = shadowRoot.querySelector(".modal");
      const hideFooter = this.currentScreen === pages.default;
      const isHome = this.currentScreen === pages[this.initialPage];
      if (modalFooter && modalContent) {
        modalFooter.style.position = "absolute";
        modalFooter.style.bottom = "0";
        modalFooter.style.visibility = hideFooter ? "hidden" : "visible";
        modal.style.position = "relative";
        if (isHome) {
          modalContent.style.paddingBottom = "65px";
          modal.style.paddingBottom = "0";
        }
        else {
          modalContent.style.paddingBottom = "0";
          modal.style.paddingBottom = "65px";
        }
      }
    }
    this.noPadding = this.isFullScreenPage(this.currentScreen);
    (_b = this.modalRef) === null || _b === void 0 ? void 0 : _b.updateFocusTrapElements();
  }
  isFullScreenPage(page) {
    return [
      "arcgis-new-item-pages-feature-layer-from-template",
      "arcgis-new-item-pages-feature-layer-from-existing",
      "arcgis-new-item-pages-tile-layer-from-store",
      "arcgis-new-item-pages-data-store-list",
      "arcgis-new-item-pages-data-store-browser",
      "arcgis-new-item-pages-tile-layer-from-existing",
      "arcgis-new-item-pages-append-select-layer"
    ].includes(page);
  }
  isDisableClosePage(page) {
    const pageToHideCloseButton = [
      "appendSelectUpdate",
      "csvLocationFields",
      "appendMatchFields"
    ];
    return pageToHideCloseButton.includes(page);
  }
  getHeaderTitle() {
    const { i18n, pageHistory } = this;
    const { newItemMode, existingItem } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    if (_ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map") {
      return i18n.addLayer;
    }
    if (_ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "register" && existingItem) {
      return i18n.common.register;
    }
    if (newItemMode === "rasterFunctionTemplate") {
      return i18n.createRasterFunctionTemplate;
    }
    const curPage = (pageHistory[pageHistory.length - 1] || "").toLowerCase();
    switch (true) {
      case curPage.includes("featurelayer"):
        return i18n.createFeatureLayer;
      case curPage.includes("tilelayer"):
        return i18n.createTileLayer;
      case _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "update" && (existingItem === null || existingItem === void 0 ? void 0 : existingItem.type) === "Vector Tile Service":
        return i18n.update;
      case _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "append" || _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "update":
        return i18n.appendSelect.updateData;
      case newItemMode === "sceneLayer":
        return i18n.createSceneLayer;
      case newItemMode === "tileLayer":
        return i18n.createTileLayer;
      case newItemMode === "dataStore":
        return i18n.addDataStore;
      default:
        return i18n.newItem;
    }
  }
  renderOnboardingSection({ title, content, background, path }) {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "onboarding__section" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "onboarding__title" }, title), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "onboarding__description" }, content), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("svg", { width: "255", height: "64", viewBox: "0 0 255 64", fill: "none", xmlns: "http://www.w3.org/2000/svg" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { width: "255", height: "64", fill: background, "fill-opacity": "0.1" }), path)));
  }
  renderOnboarding() {
    if (_ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map") {
      return null;
    }
    const { i18n } = this;
    const onboardingContent = [
      {
        title: i18n.onboard.addDocumentTitle,
        content: i18n.onboard.addDocumentContent,
        background: "#007ac2",
        show: true,
        path: ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { d: "M132.257 45.5566L146.318 31.4926L140 25.1736L141.368 21.5716L126.485 15.9196L122.666 12.0996H109.1V42.8996H113.611L116.756 44.0946L125.246 52.5646L129.054 48.7656L130.787 49.4246L132.043 46.1186H132.044L132.257 45.5566ZM145.187 31.4926L132.95 43.7296L139.686 25.9946L145.187 31.4926ZM122.9 13.4656L130.534 21.0996H122.9V13.4656ZM109.9 12.8996H122.334L122.434 12.9996H122.1V21.8996H131V21.5646L131.1 21.6656V42.0996H109.9V12.8996ZM125.246 51.4336L118.586 44.7896L128.233 48.4546L125.246 51.4336ZM130.324 48.3936L115.864 42.8996H131.9V21.3336L127.865 17.2976L140.335 22.0346L131.643 44.9216L130.324 48.3936Z", fill: "#3985B2" }))
      },
      {
        title: i18n.onboard.publishLayerTitle,
        content: this.portal.isPortal
          ? i18n.onboard.publishLayerEnterprise
          : i18n.onboard.publishLayerContent,
        show: (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.b)(this.user, this.portal),
        background: "#35AC46",
        path: ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { d: "M141.105 16.2537L140.876 16.1767C140.564 16.0727 133.164 13.6597 126.852 16.1857C120.814 18.5977 113.449 16.2007 113.376 16.1757L112.931 16.0287L107.808 47.2817L108.071 47.4137C110.922 48.6327 114.002 49.2205 117.101 49.1367C120.513 49.1139 123.898 48.5398 127.126 47.4367C138.069 43.7867 145.497 47.3767 145.571 47.4147L146.271 47.7627L141.105 16.2537ZM126.874 46.6767C117.087 49.9387 110.114 47.4137 108.694 46.8167L113.571 17.0727C115.303 17.5747 121.639 19.1327 127.148 16.9277C132.588 14.7537 139.104 16.4837 140.396 16.8657L145.236 46.3987C143.116 45.5657 136.336 43.5227 126.874 46.6767ZM137.68 18.4287C134.067 17.7098 130.328 17.9712 126.85 19.1857C125.996 19.5212 125.112 19.7751 124.21 19.9437L124.198 19.9467C121.662 20.3744 119.07 20.3616 116.538 19.9087L116.141 19.8427L112.111 44.4287L112.478 44.5117C114.342 44.9239 116.247 45.1288 118.156 45.1227C121.549 45.1021 124.915 44.5328 128.126 43.4367C131.17 42.4017 134.358 41.8503 137.573 41.8027H137.583C138.825 41.7881 140.066 41.8603 141.297 42.0187L141.832 42.0887L137.961 18.4767L137.68 18.4287ZM140.363 38.0717L137.891 40.5437C137.8 39.7207 137.658 38.9042 137.467 38.0987L139.959 35.6067L140.363 38.0717ZM139.799 34.6347L137.233 37.2007C137.023 36.4878 136.761 35.7916 136.448 35.1177L139.396 32.1687L139.799 34.6347ZM139.236 31.1977L136.061 34.3727C135.732 33.7679 135.335 33.2031 134.876 32.6897L138.832 28.7337L139.236 31.1977ZM138.672 27.7617L134.302 32.1317C133.848 31.7219 133.356 31.355 132.834 31.0357C132.858 30.9203 132.873 30.8033 132.88 30.6857L138.268 25.2967L138.672 27.7617ZM138.109 24.3247L132.747 29.6867C132.627 29.3574 132.437 29.0584 132.189 28.8106C131.941 28.5629 131.642 28.3724 131.313 28.2527L137.705 21.8607L138.109 24.3247ZM130.5 28.9007C130.817 28.9007 131.126 28.9945 131.389 29.1703C131.652 29.3461 131.857 29.596 131.978 29.8884C132.099 30.1807 132.131 30.5024 132.069 30.8128C132.008 31.1232 131.855 31.4083 131.631 31.632C131.408 31.8558 131.123 32.0082 130.812 32.0699C130.502 32.1317 130.18 32.1 129.888 31.9789C129.595 31.8578 129.346 31.6527 129.17 31.3896C128.994 31.1265 128.9 30.8171 128.9 30.5007C128.901 30.0765 129.069 29.6698 129.369 29.3699C129.669 29.0699 130.076 28.9012 130.5 28.9007ZM137.547 20.8877L130.316 28.1187C129.991 28.1436 129.675 28.2349 129.386 28.3869C129.098 28.539 128.844 28.7485 128.64 29.0027C128.195 28.7707 127.773 28.4971 127.38 28.1857L130.972 24.5947C131.336 24.8317 131.771 24.9365 132.203 24.8913C132.635 24.8461 133.039 24.6538 133.346 24.3465C133.653 24.0393 133.846 23.6357 133.891 23.2036C133.936 22.7714 133.831 22.3368 133.594 21.9727L136.502 19.0647C136.762 19.0987 137.022 19.1317 137.265 19.1707L137.547 20.8877ZM133.1 23.0007C133.1 23.2182 133.036 23.4309 132.915 23.6118C132.794 23.7927 132.622 23.9337 132.421 24.0169C132.22 24.1002 131.999 24.122 131.786 24.0795C131.572 24.0371 131.376 23.9323 131.222 23.7785C131.068 23.6246 130.964 23.4286 130.921 23.2153C130.879 23.0019 130.901 22.7807 130.984 22.5797C131.067 22.3787 131.208 22.2069 131.389 22.0861C131.57 21.9652 131.783 21.9007 132 21.9007C132.292 21.9009 132.571 22.0169 132.778 22.2231C132.984 22.4294 133.1 22.709 133.1 23.0007ZM135.481 18.9527L133.028 21.4067C132.664 21.1696 132.229 21.0649 131.797 21.11C131.365 21.1552 130.962 21.3476 130.654 21.6548C130.347 21.9621 130.155 22.3656 130.109 22.7978C130.064 23.2299 130.169 23.6645 130.406 24.0287L126.785 27.6507C126.533 27.3913 126.302 27.1113 126.096 26.8137C125.913 26.5372 125.757 26.2439 125.629 25.9377L132.706 18.8617C133.632 18.8364 134.559 18.8668 135.481 18.9527ZM127.893 19.6737C129.063 19.2898 130.273 19.0422 131.499 18.9357L125.323 25.1117C125.089 24.3363 124.924 23.5419 124.829 22.7377L127.893 19.6737ZM126.166 20.2687L124.726 21.7087C124.7 21.3618 124.684 21.0144 124.676 20.6667C125.193 20.5567 125.686 20.4207 126.166 20.2687ZM127.874 42.6767C123.113 44.3665 117.987 44.7579 113.024 43.8107L116.802 20.7607C119.145 21.1389 121.532 21.1571 123.88 20.8147C123.919 22.2727 124.157 25.4197 125.439 27.2687C126.163 28.2967 127.127 29.1318 128.248 29.7007C128.153 29.9568 128.103 30.2275 128.1 30.5007C128.099 31.0201 128.267 31.5258 128.579 31.9414C128.89 32.357 129.329 32.6601 129.827 32.8049C130.326 32.9497 130.859 32.9284 131.344 32.7442C131.83 32.56 132.243 32.2229 132.52 31.7837C133.084 32.1296 133.609 32.5368 134.084 32.9977C134.694 33.6027 136.674 35.9357 137.146 41.0097C133.99 41.1015 130.865 41.6633 127.874 42.6767ZM138.549 41.0177L140.523 39.0437L140.87 41.1607C140.099 41.0796 139.325 41.0319 138.55 41.0177H138.549ZM119 25.1007C118.624 25.1007 118.257 25.2121 117.945 25.4209C117.632 25.6297 117.389 25.9264 117.245 26.2736C117.101 26.6207 117.063 27.0028 117.137 27.3713C117.21 27.7399 117.391 28.0785 117.657 28.3442C117.922 28.6099 118.261 28.7908 118.629 28.8642C118.998 28.9375 119.38 28.8998 119.727 28.756C120.074 28.6122 120.371 28.3687 120.58 28.0563C120.789 27.7438 120.9 27.3765 120.9 27.0007C120.9 26.4969 120.699 26.014 120.343 25.6577C119.987 25.3015 119.504 25.1012 119 25.1007ZM119 28.1007C118.783 28.1007 118.57 28.0362 118.389 27.9153C118.208 27.7944 118.067 27.6226 117.984 27.4216C117.901 27.2206 117.879 26.9994 117.921 26.7861C117.964 26.5727 118.068 26.3767 118.222 26.2229C118.376 26.069 118.572 25.9642 118.786 25.9218C118.999 25.8794 119.22 25.9011 119.421 25.9844C119.622 26.0677 119.794 26.2086 119.915 26.3895C120.036 26.5704 120.1 26.7831 120.1 27.0007C120.1 27.2923 119.984 27.572 119.778 27.7782C119.571 27.9844 119.292 28.1004 119 28.1007ZM119.5 33.1007C119.223 33.1007 118.953 33.1828 118.722 33.3366C118.492 33.4904 118.313 33.7091 118.207 33.9649C118.101 34.2207 118.073 34.5022 118.127 34.7738C118.181 35.0454 118.314 35.2948 118.51 35.4906C118.706 35.6864 118.955 35.8197 119.227 35.8738C119.499 35.9278 119.78 35.9001 120.036 35.7941C120.292 35.6881 120.51 35.5087 120.664 35.2785C120.818 35.0482 120.9 34.7776 120.9 34.5007C120.9 34.1295 120.752 33.7737 120.489 33.5113C120.227 33.2489 119.871 33.1012 119.5 33.1007ZM119.5 35.1007C119.381 35.1007 119.265 35.0655 119.167 34.9995C119.068 34.9336 118.991 34.8399 118.946 34.7303C118.9 34.6206 118.888 34.5 118.912 34.3836C118.935 34.2672 118.992 34.1603 119.076 34.0764C119.16 33.9925 119.267 33.9353 119.383 33.9122C119.499 33.889 119.62 33.9009 119.73 33.9463C119.839 33.9918 119.933 34.0687 119.999 34.1673C120.065 34.266 120.1 34.382 120.1 34.5007C120.1 34.6598 120.037 34.8124 119.924 34.9249C119.812 35.0375 119.659 35.1007 119.5 35.1007ZM128 36.1007C127.624 36.1007 127.257 36.2121 126.945 36.4209C126.632 36.6297 126.389 36.9264 126.245 37.2736C126.101 37.6207 126.063 38.0028 126.137 38.3713C126.21 38.7399 126.391 39.0784 126.657 39.3442C126.922 39.6099 127.261 39.7908 127.629 39.8642C127.998 39.9375 128.38 39.8998 128.727 39.756C129.074 39.6122 129.371 39.3687 129.58 39.0563C129.789 38.7438 129.9 38.3765 129.9 38.0007C129.9 37.4969 129.699 37.014 129.343 36.6577C128.987 36.3015 128.504 36.1012 128 36.1007ZM128 39.1007C127.783 39.1007 127.57 39.0362 127.389 38.9153C127.208 38.7944 127.067 38.6226 126.984 38.4216C126.901 38.2206 126.879 37.9994 126.921 37.7861C126.964 37.5727 127.068 37.3767 127.222 37.2229C127.376 37.069 127.572 36.9642 127.786 36.9218C127.999 36.8794 128.22 36.9011 128.421 36.9844C128.622 37.0677 128.794 37.2086 128.915 37.3895C129.036 37.5704 129.1 37.7831 129.1 38.0007C129.1 38.2923 128.984 38.572 128.778 38.7782C128.571 38.9844 128.292 39.1004 128 39.1007Z", fill: "#35AC46" }))
      },
      {
        title: i18n.onboard.linkLayerTitle,
        content: i18n.onboard.linkLayerContent,
        background: "#EDD317",
        show: true,
        path: ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { d: "M145.887 31.4506C145.802 26.7994 143.986 22.347 140.792 18.9642C137.599 15.5814 133.258 13.5116 128.62 13.1596C128.253 13.1256 127.881 13.1016 127.5 13.1016C127.119 13.1016 126.747 13.1256 126.38 13.1596C121.741 13.5116 117.4 15.5816 114.207 18.9646C111.014 22.3475 109.197 26.8002 109.113 31.4516C109.113 31.4866 109.119 31.5186 109.122 31.5536C109.118 31.7036 109.1 31.8496 109.1 32.0006C109.063 36.377 110.556 40.6289 113.32 44.0221C116.084 47.4152 119.946 49.7367 124.24 50.5856C124.405 50.6186 124.577 50.6376 124.745 50.6656C125.079 50.7166 125.411 50.7756 125.752 50.8096C126.914 50.9309 128.086 50.9309 129.248 50.8096C129.588 50.7766 129.921 50.7166 130.255 50.6646C130.423 50.6376 130.595 50.6186 130.76 50.5856C135.053 49.7367 138.916 47.4152 141.68 44.0221C144.444 40.6289 145.937 36.377 145.9 32.0006C145.9 31.8506 145.882 31.7036 145.878 31.5536C145.881 31.5186 145.887 31.4866 145.887 31.4516V31.4506ZM142.534 41.3626L142.278 41.6666C141.704 42.2504 141.008 42.7004 140.24 42.9846C141.445 40.2196 142.049 37.2304 142.013 34.2146C143.102 33.9263 144.133 33.4509 145.06 32.8096C144.935 35.8251 144.067 38.7631 142.534 41.3626ZM112.722 41.6666L112.471 41.3586C110.936 38.7609 110.067 35.8242 109.941 32.8096C110.867 33.4508 111.898 33.9262 112.987 34.2146C112.951 37.2304 113.555 40.2196 114.76 42.9846C113.992 42.7003 113.296 42.2503 112.722 41.6666ZM112.298 22.9226C113.015 23.4313 113.838 23.773 114.705 23.9226C113.624 26.9623 113.044 30.1577 112.989 33.3836C111.124 32.8016 110.014 32.1466 109.923 31.5326C109.993 28.5107 110.809 25.553 112.298 22.9226ZM120.476 16.5126C121.232 16.9679 122.064 17.2811 122.933 17.4366C122.079 19.5294 121.455 21.7089 121.072 23.9366C119.301 23.8294 117.537 23.6203 115.79 23.3106C116.782 20.7007 118.39 18.3687 120.476 16.5126ZM139.216 23.3246C137.466 23.6264 135.701 23.8314 133.929 23.9386C133.546 21.7102 132.921 19.53 132.067 17.4366C132.935 17.2811 133.768 16.9679 134.524 16.5126C136.614 18.3723 138.223 20.7092 139.216 23.3246ZM145.076 31.5326C144.986 32.1466 143.876 32.8026 142.011 33.3836C141.955 30.1581 141.376 26.963 140.295 23.9236C141.162 23.774 141.984 23.4323 142.702 22.9236C144.191 25.5537 145.006 28.5111 145.077 31.5326H145.076ZM141.214 33.6156C139.159 34.1446 137.067 34.52 134.956 34.7386C134.919 31.3844 134.623 28.0381 134.071 24.7296C135.896 24.6268 137.713 24.4145 139.512 24.0936C140.608 27.15 141.183 30.3687 141.214 33.6156ZM127.9 17.8756C129.023 17.8623 130.143 17.7674 131.253 17.5916C132.117 19.6458 132.747 21.7906 133.133 23.9856C131.584 24.0756 129.843 24.1306 127.9 24.1376V17.8756ZM127.9 17.0756V13.9366C129.033 14.1396 130.038 15.1966 130.893 16.8406C129.901 16.9847 128.902 17.0626 127.9 17.0736V17.0756ZM127.1 17.0756C126.098 17.0642 125.098 16.9861 124.107 16.8416C124.962 15.1986 125.967 14.1406 127.1 13.9376V17.0756ZM127.1 17.8756V24.1376C125.354 24.1342 123.609 24.0832 121.867 23.9846C122.252 21.7899 122.883 19.6455 123.747 17.5916C124.856 17.7671 125.977 17.8617 127.1 17.8746V17.8756ZM127.1 24.9396V35.1446C125.011 35.1351 122.923 35.0289 120.844 34.8266C120.863 31.459 121.156 28.0986 121.721 24.7786C123.961 24.9056 126.001 24.9346 127.1 24.9386V24.9396ZM127.1 35.9446V45.0376C125.405 45.0269 123.711 44.9231 122.028 44.7266C121.214 41.7646 120.815 38.7041 120.842 35.6326C122.869 35.8276 124.999 35.9326 127.1 35.9446ZM127.1 45.8376V50.0786C124.722 49.8876 123.235 48.0046 122.313 45.5586C123.903 45.7328 125.5 45.8263 127.1 45.8386V45.8376ZM127.9 45.8376C129.499 45.826 131.097 45.7332 132.687 45.5596C131.765 48.0046 130.277 49.8876 127.9 50.0796V45.8376ZM127.9 45.0376V35.9446C129.989 35.9339 132.077 35.8298 134.158 35.6326C134.184 38.7038 133.785 41.7639 132.972 44.7256C131.288 44.9222 129.595 45.0264 127.9 45.0376ZM127.9 35.1446V24.9406C128.999 24.9356 131.038 24.9066 133.279 24.7796C133.843 28.0996 134.136 31.46 134.156 34.8276C132.076 35.0299 129.989 35.136 127.9 35.1456V35.1446ZM131.723 16.6946C131.288 15.7612 130.693 14.911 129.966 14.1826C131.376 14.5183 132.704 15.1368 133.869 16.0006C133.189 16.3317 132.467 16.5659 131.723 16.6966V16.6946ZM123.277 16.6946C122.532 16.5647 121.81 16.3311 121.13 16.0006C122.294 15.1371 123.622 14.519 125.033 14.1836C124.305 14.9123 123.71 15.7628 123.276 16.6966L123.277 16.6946ZM120.929 24.7296C120.376 28.0384 120.08 31.3851 120.044 34.7396C117.933 34.5206 115.841 34.1449 113.786 33.6156C113.817 30.3687 114.392 27.15 115.488 24.0936C117.287 24.4144 119.103 24.6268 120.928 24.7296H120.929ZM113.794 34.4516C115.847 34.9692 117.936 35.3348 120.044 35.5456C119.99 38.6014 120.352 41.6504 121.121 44.6086C119.354 44.3753 117.613 43.9809 115.918 43.4306C114.523 40.6428 113.796 37.5688 113.794 34.4516ZM121.396 45.4446C121.888 47.1149 122.847 48.6098 124.16 49.7536C122.593 49.435 121.108 48.8006 119.794 47.889C118.48 46.9775 117.366 45.8079 116.52 44.4516C118.118 44.9041 119.748 45.2361 121.396 45.4446ZM133.604 45.4446C135.251 45.2364 136.881 44.9048 138.479 44.4526C137.632 45.8085 136.518 46.9778 135.204 47.889C133.891 48.8002 132.405 49.4343 130.839 49.7526C132.152 48.6096 133.111 47.1153 133.604 45.4456V45.4446ZM133.88 44.6086C134.648 41.6504 135.01 38.6014 134.956 35.5456C137.063 35.3348 139.152 34.9692 141.206 34.4516C141.204 37.5688 140.476 40.6428 139.082 43.4306C137.387 43.9809 135.646 44.3752 133.88 44.6086ZM142.282 22.2126C142.282 22.4826 141.512 22.8366 140.005 23.1666C138.972 20.4017 137.288 17.9262 135.096 15.9496C135.134 15.8849 135.167 15.8165 135.192 15.7456C138.101 17.2143 140.552 19.4506 142.282 22.2126ZM134.462 15.3836C134.46 15.4004 134.456 15.4171 134.452 15.4336C134.386 15.3836 134.317 15.3376 134.25 15.2896C134.321 15.3196 134.392 15.3526 134.463 15.3836H134.462ZM120.548 15.4336C120.543 15.4192 120.54 15.4045 120.538 15.3896C120.608 15.3586 120.678 15.3196 120.75 15.2896C120.683 15.3376 120.614 15.3846 120.548 15.4346V15.4336ZM119.808 15.7456C119.833 15.8165 119.865 15.8849 119.904 15.9496C117.716 17.9213 116.035 20.39 115.002 23.1476C113.568 22.8216 112.815 22.4676 112.742 22.1716C114.47 19.428 116.913 17.2066 119.808 15.7456ZM113.885 43.4536C114.341 43.6791 114.81 43.8784 115.289 44.0506C115.781 44.9374 116.369 45.7674 117.043 46.5256C115.868 45.6351 114.807 44.6033 113.885 43.4536ZM137.957 46.5256C138.63 45.7674 139.219 44.9374 139.711 44.0506C140.19 43.8784 140.659 43.6791 141.115 43.4536C140.192 44.6034 139.132 45.6351 137.957 46.5256Z", fill: "#D9BC00" }))
      }
    ]
      .filter((section) => section.show)
      .map(this.renderOnboardingSection);
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-information", { label: i18n.onboard.tooltipLabel, placement: "bottom-start", heading: i18n.onboard.title, headingLevel: 3, class: "onboarding", overlayPositioning: "fixed", paddedContent: true }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "onboarding__scroll" }, onboardingContent)));
  }
  render() {
    const { i18n, noPadding, isLoading, loadingText, isActive, disableCloseButton } = this;
    const contentStyle = this.outerHeight ? { height: `${this.outerHeight}px` } : {};
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { ref: (ele) => (this.modalRef = ele), open: isActive, onCalciteModalClose: this.closeDialog, outsideCloseDisabled: true, escapeDisabled: true, class: {
        modal: true,
        "modal--grey": noPadding
      }, closeButtonDisabled: disableCloseButton }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header", class: "header" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { id: "modal-title", class: "header__title" }, this.getHeaderTitle()), this.pageHistory[this.pageHistory.length - 1] === "home" &&
      isActive &&
      this.renderOnboarding()), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", style: contentStyle, ref: (el) => (this.contentSlot = el), class: "content" }, isLoading && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "stage" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { active: isLoading, text: loadingText !== null && loadingText !== void 0 ? loadingText : i18n.loadingData }))), !isLoading && this.displayPage()), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "back" }, this.showBackButton && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", kind: "neutral", "data-id": "backButton", onClick: () => {
        if (this.navEnabled) {
          this.triggerPageTransition("arcgisNewItemPagePrev");
        }
      }, width: "full", disabled: !this.navEnabled }, i18n.back))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "outline-fill", "data-id": "cancelButton", onClick: () => {
        if (!disableCloseButton) {
          this.isActive = false;
        }
      }, width: "full", disabled: disableCloseButton }, i18n.cancel), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", appearance: "solid", "data-id": "nextButton", onClick: () => {
        this.triggerPageTransition("arcgisNewItemPageNext");
      }, width: "full", disabled: !this.navEnabled }, this.primaryButtonText)));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "isActive": ["updateActive"],
    "firstStep": ["updateFirstStep"],
    "file": ["initializeWithFile"],
    "initialFolder": ["updateInitialFolder"]
  }; }
};
ArcgisNewItem.style = arcgisNewItemCss;

const handleCreateLayerListTelemetry = (label) => {
  const { telemetry } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
  const payload = {
    eventType: "new item click",
    pageName: "my content",
    category: "new item",
    label
  };
  telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
  _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.telemetryDetails = label;
};
const handleApplicationClick = () => {
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = "application";
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.file = null;
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type = "Web Mapping Application";
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.typeKeywords = ["JavaScript", "Online Map", "Ready To Use"];
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.thumbnailURL = "https://static.arcgis.com/images/desktopapp.png";
};
const handleFeatureLayerClick = async () => {
  var _a;
  (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry) === null || _a === void 0 ? void 0 : _a.startWorkflow("create feature layer", {
    category: "create feature layer",
    pageName: "my content"
  });
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = "create";
};

const arcgisNewItemCreateLayersListCss = ".title{font-weight:400;font-size:1rem;color:var(--calcite-ui-text-1);padding:0;margin:0;margin-top:2rem}.list{margin:0;padding:0;padding-bottom:0.75rem;display:flex;flex-wrap:wrap}.list-item{margin:0;padding:0;display:flex;justify-items:start;list-style-type:none;flex:1 1 380px}.card{margin-top:1.25rem;padding:0;display:flex;border:1px solid transparent;-webkit-margin-end:2rem;margin-inline-end:2rem;max-width:440px;align-items:stretch;background-color:white;transition:all 150ms ease-in-out;outline-offset:0px;outline-color:transparent;font-family:inherit;text-align:initial;cursor:pointer}.card:hover{border-color:#aaa}.card:focus{outline:none;border-color:var(--calcite-ui-brand)}.card:hover .card__icon,.card:focus .card__icon{background-color:#eef7fd}.card:hover .card__arrow,.card:focus .card__arrow{opacity:1;transform:translate3d(0, 0, 0)}.card__arrow{vertical-align:-6px;opacity:0;transform:translate3d(-20px, 0, 0);transition:all 150ms ease-in-out}.card__icon{flex:0 0 auto;display:flex;justify-content:center;align-items:center;width:87px;min-height:87px;color:#000000;background-color:var(--calcite-ui-background);transition:all 150ms ease-in-out}.card__content{padding-left:0.75rem;padding-right:0.75rem;padding-top:0.5rem;padding-bottom:0.5rem}.card__title{font-size:1rem;line-height:1.25rem;margin:0;padding:0;font-weight:400;color:#323232}.card__subtitle{font-size:0.875rem;line-height:1.25rem;font-weight:400;margin:0;margin-top:0.5rem;padding:0;color:#646464}";

const ArcgisNewItemCreateLayersList = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.handleRedirect = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "handleRedirect", 7);
    this.i18n = undefined;
    this.options = undefined;
    this.isLoading = false;
  }
  async componentWillLoad() {
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.createLayersList;
    const { user, portal, userLicensedItems } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
    this.isLoading = true;
    const { result: subscriptionInfo } = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.f)(() => (0,_subscription_09185996_js__WEBPACK_IMPORTED_MODULE_19__.g)(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal), "subscriptionType", _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user.id);
    _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.subscriptionInfo = subscriptionInfo;
    this.isLoading = false;
    // TODO: filter options based on user's permissions
    this.options = [
      {
        heading: this.i18n.featureLayerHeading,
        icon: "featureLayer",
        description: this.i18n.featureLayerDescription,
        show: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("featureLayer") && (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.b)(user, portal),
        handler: this.onFeatureLayerClick
      },
      {
        heading: this.i18n.urlHeading,
        icon: "web",
        description: this.i18n.urlDescription,
        show: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("url"),
        handler: this.onURLClick
      },
      {
        heading: this.i18n.developerCredentialsHeading,
        icon: "key",
        description: this.i18n["developerCredentialsNoAPIDescription"],
        show: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("developerCredentials") &&
          (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.d)(user),
        handler: this.onDeveloperCredentialsClick
      },
      {
        heading: this.i18n.applicationHeading,
        icon: "apps",
        description: this.i18n.applicationDescription,
        show: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("application"),
        handler: this.onApplicationClick
      },
      {
        heading: this.i18n.imageLayerHeading,
        icon: "imageLayer",
        description: this.i18n.imageLayerDescription,
        show: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("imageryLayer") &&
          (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.e)(user, portal, userLicensedItems),
        handler: this.onImageryLayerClick
      },
      {
        heading: this.i18n.tileLayerHeading,
        icon: "tileLayer",
        description: this.i18n.tileLayerDescription,
        show: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("tileLayer") && (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.g)(user, portal),
        handler: this.onTileLayerClick
      },
      {
        heading: this.i18n.sceneLayerHeading,
        icon: "layerGraphics",
        description: this.i18n.sceneLayerDescription,
        handler: this.onSceneLayerClick,
        show: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("sceneLayer") && (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.h)(user)
      },
      {
        heading: this.i18n.locatorHeading,
        icon: "locator",
        description: this.i18n[(0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.i)(user, portal) ? "locatorDescription" : "locatorOnlyDescription"],
        show: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("locator") && (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.j)(user),
        handler: this.onLocatorClick
      },
      {
        heading: this.i18n.dataStoreHeading,
        icon: "data",
        description: this.i18n.dataStoreDescription,
        show: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("dataStore") && (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.k)(user, portal),
        handler: this.onDataStoreClick /* For Enterprise */
      },
      {
        heading: this.i18n.dataStoreHeading,
        icon: "data",
        description: this.i18n.dataStoreConnectionDescription,
        show: false,
        handler: this.onDataStoreConnectionClick /* Placeholder for Online implementation */
      },
      {
        heading: this.i18n.rasterFunctionTemplateHeading,
        icon: "new-raster-function-template",
        description: this.i18n.rasterFunctionTemplateDescription,
        show: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("rasterFunctionTemplate") &&
          (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.l)(user) &&
          !(0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__.n)(user),
        handler: this.onRasterFunctionTemplateClick
      }
    ];
  }
  onFeatureLayerClick() {
    handleCreateLayerListTelemetry("feature layer");
    handleFeatureLayerClick();
    this.newItemUpdatePage.emit("featureLayerSelect");
  }
  onTileLayerClick() {
    handleCreateLayerListTelemetry("tile layer");
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = "tileLayer";
    (0,_tile_layer_bd7e56c2_js__WEBPACK_IMPORTED_MODULE_18__.l)();
    this.newItemUpdatePage.emit("tileLayerSelect");
  }
  onSceneLayerClick() {
    handleCreateLayerListTelemetry("scene layer");
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = "sceneLayer";
    // TODO: add telemetry
    // logTileLayerStart();
    if (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal) {
      this.newItemUpdatePage.emit("sceneLayerSelect");
    }
    else {
      // We only have 1 option in AGOL so just skip the select screen directly
      this.newItemUpdatePage.emit("layerUpload");
    }
  }
  onImageryLayerClick() {
    handleCreateLayerListTelemetry("imagery layer");
    this.handleRedirect.emit({ type: "Imagery Layer" });
  }
  onURLClick() {
    handleCreateLayerListTelemetry("url");
    this.newItemUpdatePage.emit("urlTypeSelect");
  }
  onDataStoreClick() {
    const useNewWorkflow = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.config.addDatastoreComponentEnabled;
    handleCreateLayerListTelemetry("data store");
    if (!useNewWorkflow) {
      // Previous handler for redirecting to the dojo-based workflow
      this.handleRedirect.emit({ type: "Data Store" });
    }
    else {
      // Migrated UI for adding data stores https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2429
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = "dataStore";
      this.newItemUpdatePage.emit("dataStoreSelect");
    }
  }
  onDataStoreConnectionClick() {
    //keeping this separate from onDataStoreClick when this opens up to new item for Online
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = "dataStore";
    this.newItemUpdatePage.emit("dataStoreSelect");
  }
  onApplicationClick() {
    handleCreateLayerListTelemetry("an app");
    handleApplicationClick();
    this.newItemUpdatePage.emit("application");
  }
  async onLocatorClick() {
    handleCreateLayerListTelemetry("locator");
    this.newItemUpdatePage.emit("locatorSelect");
  }
  onDeveloperCredentialsClick() {
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = "developerCredentials";
    handleCreateLayerListTelemetry("dev cred");
    this.newItemUpdatePage.emit("developerCredentialsSelect");
  }
  onRasterFunctionTemplateClick() {
    handleCreateLayerListTelemetry("raster function template");
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type = "Raster function template";
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = "rasterFunctionTemplate";
    this.newItemUpdatePage.emit("itemProperties");
  }
  renderOptions() {
    return this.options.map((option) => option.show && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("li", { class: "list-item" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { class: "card", onClick: option.handler.bind(this) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card__icon" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: option.icon, scale: "l" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card__content" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "card__title" }, option.heading, " ", (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { class: "card__arrow", icon: "arrow-right", "flip-rtl": true })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "card__subtitle" }, option.description))))));
  }
  render() {
    const { isLoading, i18n } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("nav", { "aria-labelledby": "layers-list-heading" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { active: isLoading, text: i18n.getSubscriptionInfo }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("ul", { class: "list" }, this.renderOptions())));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemCreateLayersList.style = arcgisNewItemCreateLayersListCss;

const arcgisNewItemCsvFieldCss = ".cell{box-sizing:border-box;width:33.333333%}.cell label{margin-top:0.75rem !important}.row{display:flex;justify-content:space-between;align-items:center;grid-gap:0.25rem;gap:0.25rem;padding:0.25rem;border-top:1px solid #eaeaea}.deselected{opacity:var(--calcite-ui-opacity-disabled)}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.label{--calcite-label-margin-bottom:0;position:relative}.field-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}";

const ArcgisNewItemCsvField = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.fieldChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "fieldChange", 7);
    this.handleTypeChange = (ev) => {
      const value = ev.target.selectedOption.value;
      this.fieldChange.emit({
        name: this.field.name,
        key: "type",
        value,
        modified: value !== this.initialField.type
      });
    };
    this.checked = true;
    this.defaultChecked = true;
    this.field = undefined;
    this.fieldTypes = undefined;
    this.detectedType = undefined;
    this.canHideFields = undefined;
    this.displayNameLabel = undefined;
    this.typeLabel = undefined;
  }
  componentWillLoad() {
    this.checked = this.defaultChecked;
    this.allowedFieldTypes = (0,_geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_21__.g)(this.detectedType);
    // Telemetry: Capture default state of the field
    this.initialField = Object.assign({}, this.field);
  }
  render() {
    const { field, canHideFields } = this;
    const deselected = !field.selected;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "row", role: "row" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "cell", layout: "inline", role: "cell" }, canHideFields && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { onCalciteCheckboxChange: (ev) => this.fieldChange.emit({
        name: field.name,
        key: "selected",
        value: ev.target.checked
      }), checked: field.selected })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: { "field-name": true, deselected } }, field.name)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "cell label", role: "cell" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { disabled: deselected, onCalciteInputInput: (event) => {
        const value = event.target.value;
        this.fieldChange.emit({
          name: field.name,
          key: "alias",
          value,
          modified: value !== this.initialField.alias
        });
      }, value: field.alias || field.name }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "screen-readers-only" }, this.displayNameLabel)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: this.typeLabel, class: "cell", role: "cell", "aria-sort": "none", disabled: deselected, onCalciteSelectChange: this.handleTypeChange }, Object.keys(this.fieldTypes)
      .filter((fieldType) => this.allowedFieldTypes.includes(fieldType))
      .map((type) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { selected: field.type === type, value: type, key: field.name }, this.fieldTypes[type]))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemCsvField.style = arcgisNewItemCsvFieldCss;

const arcgisNewItemCustomParameterCss = ".container{margin-bottom:0.5rem;border:1px solid;border-color:var(--calcite-ui-border-1);padding:16px;max-width:100%}.content-container{display:flex}.inputs{display:flex;flex-direction:column;width:100%}@media (min-width: 864px){.inputs{flex-direction:row}}.inputs calcite-label{flex:1 1 0%}@media (min-width: 864px){.inputs calcite-label:first-child{-webkit-margin-end:12px;margin-inline-end:12px}}.delete-container{display:flex;justify-content:flex-end;align-items:center;position:relative;-webkit-margin-start:1.5rem;margin-inline-start:1.5rem;margin-top:10px}.delete-btn{cursor:pointer;border-style:none;background:transparent;height:-moz-fit-content;height:fit-content;padding:6px}.delete-btn:focus{outline:5px auto;outline-color:var(--calcite-ui-brand-hover)}.checkbox{display:flex;align-items:center}calcite-checkbox{-webkit-margin-end:5px;margin-inline-end:5px}.delete-btn-popover{white-space:nowrap;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem}";

const ArcgisNewItemCustomParameter = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.removeCustomParameter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "removeCustomParameter", 7);
    this.updateCustomParameter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "updateCustomParameter", 7);
    this.itemType = undefined;
    this.index = undefined;
    this.customParameter = undefined;
    this.i18n = undefined;
    this.showAppend = false;
    this.deleteButtonRef = undefined;
    this.deleteTooltipOpen = false;
  }
  async componentDidLoad() {
    this.setFocus();
    await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.t)(500);
    const openTooltip = () => {
      this.deleteTooltipOpen = true;
    };
    const closeTooltip = () => {
      this.deleteTooltipOpen = false;
    };
    this.deleteButtonRef.onfocus = openTooltip;
    this.deleteButtonRef.onblur = closeTooltip;
    this.deleteButtonRef.onmouseover = openTooltip;
    this.deleteButtonRef.onmouseout = closeTooltip;
  }
  componentWillLoad() {
    this.handleItemTypeChange();
  }
  async setFocus(delay = 0) {
    await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.t)(delay);
    this.mainInputRef.setFocus();
  }
  handleItemTypeChange() {
    this.showAppend = ["WMS", "WMTS"].some((type) => type === this.itemType);
  }
  handleInputChange(event, type) {
    const node = event.target;
    const updatedParameter = type === "parameter"
      ? Object.assign(Object.assign({}, this.customParameter), { parameter: node.value }) : Object.assign(Object.assign({}, this.customParameter), { value: node.value });
    this.updateCustomParameter.emit({ index: this.index, customParameter: updatedParameter });
  }
  handleCheckboxChange(event) {
    const updatedParameter = Object.assign(Object.assign({}, this.customParameter), { append: event.target.checked ? "layer" : "all" });
    this.updateCustomParameter.emit({ index: this.index, customParameter: updatedParameter });
  }
  render() {
    var _a, _b;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "content-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "inputs" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.i18n.parameter, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { placeholder: this.i18n.addParameter, value: (_a = this.customParameter) === null || _a === void 0 ? void 0 : _a.parameter, onCalciteInputInput: (ev) => this.handleInputChange(ev, "parameter"), ref: (ele) => (this.mainInputRef = ele) })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.i18n.value, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { placeholder: this.i18n.addValue, value: (_b = this.customParameter) === null || _b === void 0 ? void 0 : _b.value, onCalciteInputInput: (ev) => this.handleInputChange(ev, "value") }))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "delete-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { class: "delete-btn", "aria-label": this.i18n.remove, onClick: () => this.removeCustomParameter.emit(this.index), ref: (ele) => (this.deleteButtonRef = ele) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "trash", scale: "s" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { label: this.i18n.remove, pointerDisabled: true, referenceElement: this.deleteButtonRef, open: this.deleteTooltipOpen }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "delete-btn-popover" }, this.i18n.remove)))), this.showAppend && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("label", { class: "checkbox" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { checked: this.customParameter.append === "layer", onCalciteCheckboxChange: (ev) => this.handleCheckboxChange(ev), onClick: (ev) => ev.preventDefault() }), this.i18n.append))));
  }
  static get watchers() { return {
    "itemType": ["handleItemTypeChange"]
  }; }
};
ArcgisNewItemCustomParameter.style = arcgisNewItemCustomParameterCss;

const arcgisNewItemCustomParametersCss = ":host{font-family:Avenir Next, Avenir, Helvetica Neue, sans-serif;font-size:0.875rem;margin-bottom:14px}.label{font-weight:500;font-size:0.875rem;color:var(--calcite-ui-text-1);line-height:16px;margin-bottom:8px}.sub-header{font-size:0.875rem;color:var(--calcite-ui-text-3);display:flex;margin-top:0px;line-height:18px}.help-text{max-width:20rem;display:block}.add{font-weight:500;font-size:0.875rem;cursor:pointer;display:flex;justify-content:center;align-items:center;font-family:Avenir Next, Avenir, Helvetica Neue, sans-serif;margin-bottom:0.5rem;transition-duration:200ms;color:var(--calcite-ui-text-link);border:none;box-shadow:none;background:transparent;padding:10px;-webkit-padding-start:0;padding-inline-start:0;line-height:16px}.add:focus,.add:focus-visible{outline:5px auto;outline-color:#00619b}.add:hover{color:#00619b}.add-icon{color:var(--calcite-ui-text-link);-webkit-margin-end:0.625rem;margin-inline-end:0.625rem}";

const ArcgisNewItemCustomParameters = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.customParameterRefList = [];
    this.itemType = undefined;
    this.customParameters = undefined;
    this.i18n = undefined;
  }
  removeCustomParameter(event) {
    const itemIndex = event.detail;
    const { url } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    if (url) {
      const newUrl = (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.r)(url, this.customParameters[itemIndex]);
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.url = newUrl;
    }
    const { customParameters } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    this.customParameters = customParameters.filter((_, index) => index !== itemIndex);
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.customParameters = [...this.customParameters];
    if (this.customParameters.length <= 0) {
      this.newCustomParameterRef.focus();
    }
    else {
      this.customParameterRefList[Math.max(0, itemIndex - 1)].setFocus();
    }
  }
  updateCustomParameterHandler(event) {
    const { customParameters } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const { index, customParameter } = event.detail;
    this.customParameters = customParameters.map((entry, idx) => {
      if (idx === index) {
        entry = customParameter;
      }
      return entry;
    });
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.customParameters = [...this.customParameters];
  }
  async componentWillLoad() {
    const { customParameters } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.customParameters;
    this.customParameters = customParameters;
  }
  createNewCustomParameter() {
    const { customParameters } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    this.customParameters = [...customParameters, { parameter: "", value: "", append: "all" }];
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.customParameters = this.customParameters;
  }
  render() {
    var _a;
    const { i18n, itemType } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "label" }, i18n.customParameters), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "sub-header" }, i18n.description, " ", (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-information", { label: i18n.customParameters, placement: "bottom", offsetSkidding: 6, overlayPositioning: "fixed", headingLevel: 3, paddedContent: true }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "help-text" }, i18n.helpText))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { class: "add", type: "submit", onClick: () => this.createNewCustomParameter(), ref: (ele) => (this.newCustomParameterRef = ele) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { class: "add-icon", icon: "plus", scale: "s" }), i18n.newCustomParameter), (_a = this.customParameters) === null || _a === void 0 ? void 0 :
      _a.map((customParameter, index) => {
        return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-custom-parameter", { class: "custom-parameter", itemType: itemType, customParameter: customParameter, index: index, i18n: i18n, ref: (ele) => (this.customParameterRefList[index] = ele) }));
      })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemCustomParameters.style = arcgisNewItemCustomParametersCss;

const arcgisNewItemInputReadonlyCss = ":host{--arcgis-label-font-weight:400}.label{margin-top:0;margin-bottom:0;font-weight:var(--arcgis-label-font-weight)}.label--bold{--arcgis-label-font-weight:500}";

const ArcgisNewItemInputReadonly = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.scale = "m";
    this.label = undefined;
    this.path = undefined;
    this.i18n = undefined;
    this.labelType = "bold";
  }
  async componentWillLoad() {
    var _a, _b;
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.inputReadonly;
    const { newItemMode: itemType, fileName, originalFileName, url, provider, databaseProvider, addDataStoreType } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const strings = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.itemProperties;
    switch (itemType) {
      case "file":
        this.label = (_a = this.label) !== null && _a !== void 0 ? _a : this.i18n.file;
        this.path = originalFileName !== null && originalFileName !== void 0 ? originalFileName : fileName;
        break;
      case "url":
        this.label = this.i18n.url;
        this.path = url;
        break;
      case "dataStore":
        this.label = this.i18n.dataStore;
        this.path =
          addDataStoreType === "cloud" ? strings[provider] : (_b = strings[databaseProvider]) !== null && _b !== void 0 ? _b : null;
    }
  }
  render() {
    var _a;
    const { labelType, path, label, scale } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.scale) !== null && _a !== void 0 ? _a : scale }, _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.addAppendSelectOption !== "overwrite" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: `label label--${labelType}` }, label)), path && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-field" }, path)));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemInputReadonly.style = arcgisNewItemInputReadonlyCss;

const arcgisNewItemLayerSearchCss = ".screen-reader{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.search-container{width:100%}";

const ArcgisNewItemLayerSearch = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.searchUpdate = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "searchUpdate", 7);
    this.handleSearchInput = (event) => {
      const input = event.target.value || "";
      if (input !== this.searchInput) {
        this.searchInput = input;
        this.searchUpdate.emit(input);
      }
    };
    this.handleKeyup = (event) => {
      if ((event.key === "Escape" || event.key === "Esc") && this.searchInput) {
        event.stopPropagation();
        this.searchInput = "";
      }
    };
    this.searchInput = "";
    this.controls = undefined;
    this.searchLabel = undefined;
    this.i18n = undefined;
  }
  async componentWillLoad() {
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.layerSearch;
  }
  async focusMainInput() {
    this.mainInputRef.setFocus();
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "search-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("label", { class: "screen-reader", htmlFor: "search" }, this.i18n.search), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { placeholder: `${this.i18n.search} ${this.searchLabel}`, icon: "search", type: "search", id: "search", clearable: true, "aria-controls": this.controls, value: this.searchInput, onKeyUp: this.handleKeyup, ref: (el) => (this.mainInputRef = el), onCalciteInputInput: this.handleSearchInput })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemLayerSearch.style = arcgisNewItemLayerSearchCss;

const arcgisNewItemPagesApplicationCss = ".flex-container{display:flex;justify-content:space-between}.leader{margin-top:2rem}.two-up{width:calc(50% - 2rem)}calcite-label{color:var(--calcite-ui-text-1)}.label{font-weight:500;font-size:0.875rem;margin-bottom:0;margin-top:0;line-height:18px}.file{font-size:0.875rem;color:var(--calcite-ui-text-1);margin:0;margin-bottom:2rem;padding:0}";

const ArcgisNewItemPagesApplication = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.submenus = {
      desktop: {
        title: "Platform",
        file: true
      },
      mobile: { title: "SDK" },
      web: { title: "API" }
    };
    this.url = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.url;
    this.urlInputMessage = undefined;
    this.fileInputMessage = undefined;
    this.manifestInputMessage = undefined;
    this.manifestUrl = undefined;
    this.i18n = undefined;
    this.i18nURL = undefined;
  }
  validateFile(file) {
    const { title, fileName, extension } = (0,_file_f36193e9_js__WEBPACK_IMPORTED_MODULE_14__.s)(file);
    if (extension !== "zip") {
      this.fileInputMessage = this.i18n.selectZip;
      return false;
    }
    else {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.file = file;
      _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title = title;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.fileName = fileName;
      this.fileInputMessage = null;
      return true;
    }
  }
  async navigateToNextPage() {
    const { url, i18n, i18nURL, manifestUrl } = this;
    const { file, applicationType } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    let manifest;
    if (url && (0,_url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_23__.i)(url, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal)) {
      this.urlInputMessage = i18nURL.httpWarning;
      return;
    }
    if (applicationType === "desktop") {
      if (!file) {
        this.fileInputMessage = i18n.fileRequired;
        return;
      }
      if (!this.validateFile(file)) {
        return;
      }
    }
    if ((applicationType === "mobile" || applicationType === "web") && !url) {
      this.urlInputMessage = i18n.enterUrl;
      return;
    }
    if (applicationType === "appExtension" || applicationType === "experienceBuilderWidget") {
      if (!manifestUrl) {
        this.manifestInputMessage = i18n.enterManifestUrl;
        return;
      }
      const { error, result } = await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.f)(this.manifestUrl);
      if (error) {
        this.manifestInputMessage = this.i18n[error.code];
        return;
      }
      manifest = result;
    }
    // some apis need to be sent to the server differently than they are shown in the dropdown
    const types = {
      web: {
        type: "Web Mapping Application",
        typeKeywords: ["Web Map", "Map", "Online Map", "Mapping Site"],
        thumbnailUrl: "https://static.arcgis.com/images/webapp.png",
        url
      },
      desktop: {
        type: "Desktop Application",
        typeKeywords: ["Desktop Application"],
        url
      },
      mobile: {
        type: "Mobile Application",
        typeKeywords: ["ArcGIS Mobile Map", "Mobile Application"],
        thumbnailUrl: "https://static.arcgis.com/images/mobileapp.png",
        url
      },
      appExtension: {
        type: "AppBuilder Extension",
        typeKeywords: [
          "Widget",
          "App Builder",
          "widget",
          (manifest === null || manifest === void 0 ? void 0 : manifest.platform) === "HTML3D" ? "HTML3D" : "HTML"
        ],
        url: manifestUrl,
        accessInformation: (manifest === null || manifest === void 0 ? void 0 : manifest.author) || "",
        text: manifest ? JSON.stringify(manifest) : ""
      },
      experienceBuilderWidget: {
        type: "Experience Builder Widget",
        url: manifestUrl,
        accessInformation: (manifest === null || manifest === void 0 ? void 0 : manifest.author) || "",
        text: manifest ? JSON.stringify(manifest) : ""
      },
      otherApplication: {
        type: "Application",
        typeKeywords: ["Application"]
      }
    };
    let title = "";
    if (url) {
      title = (0,_url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_23__.u)(url) || "";
    }
    else if (file) {
      title = (0,_file_f36193e9_js__WEBPACK_IMPORTED_MODULE_14__.s)(file).title;
    }
    else if (manifest) {
      title = manifest.name || "application extension";
    }
    const typeDetails = types[applicationType];
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = "application";
    _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title = title;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.name = `${title}_${(0,_guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_22__.g)()}`;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type = typeDetails.type;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.typeKeywords = typeDetails.typeKeywords;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.url = typeDetails.url;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.accessInformation = typeDetails.accessInformation;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.text = typeDetails.text;
    this.newItemUpdatePage.emit("itemProperties");
  }
  async componentWillLoad() {
    const { application, url } = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n;
    this.i18n = application;
    this.i18nURL = url;
    const { file, applicationType } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    if (file) {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.applicationType = "desktop";
    }
    else if (!applicationType) {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.applicationType = "web";
    }
  }
  render() {
    const { i18n } = this;
    const { applicationType, applicationFile, file } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const menu = this.submenus[applicationType];
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, !applicationFile && applicationType === "desktop" && file && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "label" }, i18n.File), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "file" }, file.name))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("form", { novalidate: true, onSubmit: (e) => {
        e.preventDefault();
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label" }, i18n.applicationType)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", { layout: "vertical" }, [
      "web",
      "desktop",
      "mobile",
      ...(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal && (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__.e)(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user)
        ? ["appExtension", "experienceBuilderWidget"]
        : []),
      "otherApplication"
    ].map((value) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { checked: applicationType === value, width: "full", "input-enabled": true, "input-alignment": "start", value: value, name: i18n[value], heading: i18n[value], onCalciteTileSelectChange: (e) => {
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.applicationType = e.target.value;
        this.urlInputMessage = null;
        this.fileInputMessage = null;
      } })))), menu && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "leader" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label" }, i18n.URL), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "text", value: this.url, required: applicationType === "web" || applicationType === "mobile", status: this.urlInputMessage ? "invalid" : "idle", onCalciteInputInput: (e) => {
        this.url = e.target.value;
        this.urlInputMessage = null;
      }, onFocusout: (e) => {
        var _a;
        if (e.target.value && ((_a = this.url) === null || _a === void 0 ? void 0 : _a.indexOf("http")) < 0) {
          // TODO: specify e.target
          this.url = `https://${this.url}`;
        }
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { icon: true, hidden: !this.urlInputMessage, status: "invalid" }, this.urlInputMessage)), menu.file && (applicationFile || !file) && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "leader" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label" }, i18n.File), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "file", required: true, status: this.fileInputMessage ? "invalid" : "idle", onCalciteInputInput: (e) => {
        const file = e.target.shadowRoot.querySelector("input").files[0];
        this.validateFile(file);
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.applicationFile = file;
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { icon: true, hidden: !this.fileInputMessage, status: "invalid" }, this.fileInputMessage)))))), ["appExtension", "experienceBuilderWidget"].includes(applicationType) && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "leader" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label" }, i18n.manifestUrl), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "text", required: true, status: this.manifestInputMessage ? "invalid" : "idle", onCalciteInputInput: (e) => {
        this.manifestUrl = e.target.value;
        this.manifestInputMessage = null;
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { icon: true, hidden: !this.manifestInputMessage, status: "invalid" }, this.manifestInputMessage)))))));
  }
  get element() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesApplication.style = arcgisNewItemPagesApplicationCss;

const ArcgisNewItemPagesAuth = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.newItemToggleNavigationEnabled = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
    this.handlePasswordChange = (event) => {
      this.updateValidationResponse(true);
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.password = event.target.value;
    };
    this.handleUsernameChange = (event) => {
      this.updateValidationResponse(true);
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.username = event.target.value;
    };
    this.isLoading = false;
    this.validationResponse = { valid: true };
  }
  async navigateToNextPage() {
    if (!_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.username || !_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.password) {
      this.validationResponse = { valid: false, message: this.i18n.requiresCredentials };
      return;
    }
    this.isLoading = true;
    try {
      // TODO: Get store updates some other way, or add a separate return object to the big add url tunnel
      const response = await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.a)(Object.assign({}, _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a));
      const { title, tags, snippet, description, serviceInfo, serviceUsername, servicePassword, spatialReference, proxyUrl, extent, thumbnailToken } = response;
      _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title = title || _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title;
      _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.tags = tags;
      _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.snippet = snippet;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.description = description;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.serviceInfo = serviceInfo;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.serviceUsername = serviceUsername;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.servicePassword = servicePassword;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.spatialReference = spatialReference;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.thumbnailToken = thumbnailToken;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.proxyUrl = proxyUrl;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.extent = extent;
      this.isLoading = false;
      if ((0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.i)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.url, serviceInfo)) {
        this.newItemUpdatePage.emit("hybridImageSelect");
        return;
      }
      this.newItemUpdatePage.emit("itemProperties");
    }
    catch (error) {
      console.error(error);
      this.validationResponse = { valid: false, message: this.i18n.invalid };
      this.isLoading = false;
    }
  }
  handleLoadChange(_oldValue, newValue) {
    this.newItemToggleNavigationEnabled.emit(newValue);
  }
  async componentWillLoad() {
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.auth;
    this.urlTypei18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.urlType;
    // Clean up old serviceInfo if returning from item properties
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.serviceInfo = null;
  }
  updateValidationResponse(valid) {
    if (!this.validationResponse.valid) {
      this.validationResponse = { valid };
    }
  }
  render() {
    const { i18n, urlTypei18n, validationResponse, isLoading } = this;
    const { valid, message } = validationResponse;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: "indeterminate", value: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.uploadProgress, active: isLoading, text: urlTypei18n.getServiceInfo }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { for: "username" }, i18n.enterUsername, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { onCalciteInputInput: this.handleUsernameChange, id: "username", placeholder: i18n.enterUsername, value: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.username, status: valid ? "idle" : "invalid" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { for: "password" }, i18n.enterPassword, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "password", onCalciteInputInput: this.handlePasswordChange, id: "password", placeholder: i18n.enterPassword, value: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.password, status: valid ? "idle" : "invalid", required: true }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { icon: !valid, hidden: valid, status: valid ? "idle" : "invalid" }, message))));
  }
  get element() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "isLoading": ["handleLoadChange"]
  }; }
};

var TreeSelectionMode;
(function (TreeSelectionMode) {
  TreeSelectionMode["Single"] = "single";
  TreeSelectionMode["Multi"] = "multi";
  TreeSelectionMode["Children"] = "children";
  TreeSelectionMode["MultiChildren"] = "multi-children";
  TreeSelectionMode["Ancestors"] = "ancestors";
})(TreeSelectionMode || (TreeSelectionMode = {}));

const arcgisNewItemPagesBulkLayerSelectCss = ".outer-container{display:flex;flex-direction:column}.layer-select-tree{width:100%;overflow-y:auto}.layer-notice{margin-bottom:1.5rem}.select-item-message{font-weight:500;font-size:0.875rem;margin-bottom:0.25rem}.layer-not-found-message{font-weight:500;font-size:0.875rem;color:var(--calcite-ui-text-2);text-align:center;width:100%;margin-top:1.5rem}.select-all{margin-top:5px;margin-left:5px}";

const SOFT_CAP = 1000;
const MAX_LAYER_LIMIT = 10000;
const ArcgisNewItemPagesBulkLayerSelect = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.workflowComplete = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
    /** Keep a reference to all the tree-items currently in view, by id */
    this.inView = {};
    this.searchUpdateHandler = (event) => {
      const input = event.detail;
      this.searchInput = input;
      const lowerCaseInput = input.toLowerCase();
      function getFilteredLayers(layers) {
        const matches = [];
        layers.forEach((layer) => {
          if (layer.title
            .toLowerCase()
            // TODO: fix the root cause of this weird character
            .replace(/[\u202F\u00A0]/g, " ")
            .includes(lowerCaseInput) ||
            !input) {
            matches.push(Object.assign({}, layer));
          }
          else {
            const subLayers = getFilteredLayers(layer.subLayers);
            if (subLayers.length) {
              matches.push(Object.assign({}, layer, { subLayers, expanded: true }));
            }
          }
        });
        return matches;
      }
      this.filteredLayers = this.getDisplayLayers(getFilteredLayers(this.layers));
    };
    this.handleLayerSelect = (event) => {
      const node = event.target;
      const inViewSelectedList = node.selectedItems.map((treeItem) => treeItem.getAttribute("id"));
      // Filter out any item that's in view, then spread the current selected tree back in
      const outOfViewSelectedList = Object.keys(this.selectedLayerIdTracker.idMap).filter((layerId) => !this.inView[layerId]);
      const newSelectedLayerCount = inViewSelectedList.length + outOfViewSelectedList.length;
      const newSelectedIdMap = {};
      inViewSelectedList.forEach((layerId) => (newSelectedIdMap[layerId] = true));
      outOfViewSelectedList.forEach((layerId) => (newSelectedIdMap[layerId] = true));
      const newTracker = {
        count: newSelectedLayerCount,
        idMap: newSelectedIdMap
      };
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedLayerIdTracker = newTracker;
      this.selectedLayerIdTracker = newTracker;
      this.noLayersSelected = this.noLayersSelected ? newSelectedLayerCount <= 0 : false;
    };
    this.getDisplayLayers = (layers = this.layers, displayLayers = []) => {
      let acc = 0;
      for (const layer of layers) {
        if (acc >= SOFT_CAP) {
          this.usePro = true;
          const selected = this.isLayerSelected(layer);
          if (selected || this.containsSelected(layer)) {
            displayLayers.push(layer);
          }
        }
        else {
          acc++;
          if (layer.subLayers.length > 0) {
            const subLayerCount = this.countSublayers(layer);
            if (subLayerCount >= MAX_LAYER_LIMIT) {
              // we should not display any sublayers if there are a total of > 10,000
              displayLayers.push(Object.assign(Object.assign({}, layer), { subLayers: [] }));
            }
            else {
              acc += subLayerCount;
              displayLayers.push(layer);
            }
          }
          else {
            displayLayers.push(layer);
          }
        }
      }
      displayLayers.sort((layer1, layer2) => (layer1.title > layer2.title ? 1 : -1));
      return displayLayers;
    };
    this.countSublayers = (layer) => {
      // Exit if no sublayers found
      if (layer.subLayers.length <= 0) {
        return 0;
      }
      // Otherwise, accumulate the sublayers, then count its sublayers
      let numSubLayer = layer.subLayers.length;
      layer.subLayers.forEach((sublayer) => {
        numSubLayer += this.countSublayers(sublayer);
      });
      return numSubLayer;
    };
    this.renderTree = (layer) => {
      var _a;
      const id = layer.id;
      const expanded = layer.expanded || false;
      const selected = this.isLayerSelected(layer);
      const containsSelected = this.containsSelected(layer);
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { key: id, id: id, selected: selected || layer.visible, expanded: (containsSelected && !selected) || expanded, ref: () => (this.inView[id] = true) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, layer.title), ((_a = layer.subLayers) === null || _a === void 0 ? void 0 : _a.length) ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: TreeSelectionMode.Ancestors, slot: "children" }, layer.subLayers.map(this.renderTree))) : null));
    };
    this.managedFocus = true;
    this.layers = [];
    this.filteredLayers = [];
    this.searchInput = "";
    this.selectedLayerIdTracker = {
      // Transform selectedLayerMap into array to get the length would kill off performance
      count: 0,
      idMap: {}
    };
    this.usePro = undefined;
    this.noLayersSelected = false;
    this.allLayersSelected = undefined;
  }
  async componentWillLoad() {
    var _a, _b;
    const i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n;
    this.i18n = i18n.bulkLayerSelect;
    if (this.isAddToMapTerminalPage()) {
      _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.nextText = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.addAsBasemap ? "useAsBaseMap" : "addToMap";
    }
    const { layers, selectedLayerIdTracker } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    this.layers = !!layers && ((_a = layers[0]) === null || _a === void 0 ? void 0 : _a.id) ? layers : this.addIds(layers);
    this.filteredLayers = this.getDisplayLayers();
    this.selectedLayerIdTracker = {
      count: (_b = selectedLayerIdTracker === null || selectedLayerIdTracker === void 0 ? void 0 : selectedLayerIdTracker.count) !== null && _b !== void 0 ? _b : 0,
      idMap: selectedLayerIdTracker ? Object.assign({}, selectedLayerIdTracker.idMap) : {}
    };
  }
  onTransitionComplete() {
    var _a;
    (_a = this.layerSearchRef) === null || _a === void 0 ? void 0 : _a.focusMainInput();
  }
  handleNext() {
    if (this.selectedLayerIdTracker.count === 0) {
      this.noLayersSelected = true;
    }
    else {
      // Set only the selected layers as final output
      const layers = this.setVisibility(this.layers)
        .filter((layer) => layer.visible)
        .map((layer) => {
        const { name, title, queryable, subLayers } = layer;
        return { name, title, queryable, subLayers };
      });
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.layers = layers;
      // Done if direct add
      if (this.isAddToMapTerminalPage()) {
        this.workflowComplete.emit({
          type: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type,
          url: encodeURI(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.url),
          customParameters: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.customParameters,
          layers,
          addAsBasemap: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.addAsBasemap
        });
      }
      else {
        this.newItemUpdatePage.emit("itemProperties");
      }
    }
  }
  isAddToMapTerminalPage() {
    return _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map";
  }
  isLayerSelected(layer) {
    return !!this.selectedLayerIdTracker.idMap[layer.id];
  }
  /** remove ID and set visibility prior to commiting to store */
  setVisibility(layers) {
    return layers.map((layer) => {
      layer.visible = this.isLayerSelected(layer);
      if (layer.subLayers) {
        layer.subLayers = this.setVisibility(layer.subLayers);
      }
      return layer;
    });
  }
  /** Add unique ids to each layer if not previously set */
  addIds(layers) {
    return layers.map((layer) => {
      if (layer.subLayers) {
        layer.subLayers = this.addIds(layer.subLayers);
      }
      layer.id = (0,_guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_22__.g)();
      // Set visible to false by default
      layer.visible = false;
      return layer;
    });
  }
  containsSelected(layer) {
    var _a;
    return (_a = layer.subLayers) === null || _a === void 0 ? void 0 : _a.some((subLayer) => {
      const selected = this.isLayerSelected(layer);
      if (subLayer.subLayers) {
        const containsDeepSelected = this.containsSelected(subLayer);
        return selected || containsDeepSelected;
      }
      return selected;
    });
  }
  handleSelectAll() {
    const newSelectedLayerIdMap = {};
    let newSelectedLayerCount = 0;
    const selectAll = (layers) => {
      layers.forEach((layer) => {
        if (!newSelectedLayerIdMap[layer.id]) {
          newSelectedLayerCount += 1;
        }
        newSelectedLayerIdMap[layer.id] = true;
        if (layer.subLayers) {
          selectAll(layer.subLayers);
        }
      });
    };
    if (!this.allLayersSelected) {
      selectAll(this.layers);
      this.allLayersSelected = true;
    }
    const newTracker = {
      count: newSelectedLayerCount,
      idMap: newSelectedLayerIdMap
    };
    this.selectedLayerIdTracker = newTracker;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedLayerIdTracker = newTracker;
  }
  checkSelectionStatus(layers) {
    return layers.every((layer) => {
      const selected = this.isLayerSelected(layer);
      if (layer.subLayers) {
        const containsSelected = this.checkSelectionStatus(layer.subLayers);
        return selected && containsSelected;
      }
      else {
        return selected;
      }
    });
  }
  render() {
    this.inView = {};
    const { i18n, usePro, searchUpdateHandler, handleLayerSelect, renderTree, handleSelectAll, filteredLayers, noLayersSelected } = this;
    this.allLayersSelected = this.checkSelectionStatus(this.filteredLayers);
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "outer-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { class: "layer-notice", icon: "information", open: usePro, width: "full" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { slot: "message" }, i18n.usePro)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", { class: "select-item-message" }, i18n.selectLayers), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-layer-search", { onSearchUpdate: searchUpdateHandler, controls: "layer-select-tree", searchLabel: i18n.layers, ref: (ele) => (this.layerSearchRef = ele) }), filteredLayers.length === 0 ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", { class: "layer-not-found-message" }, i18n.noLayersFound)) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "layer-select-tree" }, this.searchInput.length >= 1 ? null : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "transparent", class: "select-all", onClick: handleSelectAll.bind(this) }, this.allLayersSelected ? this.i18n.deselectAll : i18n.selectAll)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { onCalciteTreeSelect: handleLayerSelect, selectionMode: TreeSelectionMode.Ancestors }, filteredLayers.map(renderTree)))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { active: noLayersSelected, heading: i18n.errorTitle, description: i18n.noLayersSelected })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesBulkLayerSelect.style = arcgisNewItemPagesBulkLayerSelectCss;

const arcgisNewItemPagesCloudCss = ".screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.table{display:flex;flex-direction:column;border-style:none;margin:0;min-height:35rem}.table__body{margin:0;padding:0;outline:2px solid transparent;outline-offset:2px;border-style:none;flex:1 1 0%}.table__body--center{display:flex;align-items:center;justify-items:center}.input{width:100%;margin-bottom:1rem;display:block}.select{min-width:10rem;-webkit-margin-start:0.5rem;margin-inline-start:0.5rem}.files{padding:0;list-style-type:none;margin:0 -0.5rem}.files__item{position:relative;width:100%}.files__item:before{display:block;position:absolute;bottom:0;content:\"\";right:0.5rem;left:0.5rem;border-top:1px solid var(--calcite-ui-border-3);transition:all 150ms ease-in-out;z-index:2}.files__item:hover:before,.files__item:focus-within:before{border-top-color:#009AF2}.files__item--active:before{border-top-color:transparent}.file{padding-top:0.75rem;padding-bottom:0.75rem;padding-left:0.5rem;padding-right:0.5rem;margin:0;display:flex;color:var(--calcite-ui-text-2);font-size:0.875rem;width:100%;box-sizing:border-box;border-radius:0;cursor:pointer;font-weight:400;align-items:center;background-color:white;transition:all 150ms ease-in-out;outline:1px solid transparent;outline-offset:-1px;font-family:inherit;border:none;text-align:initial}.files__item--active .file{background-color:rgba(0, 121, 193, 0.04);outline-color:#009AF2}.file__icon{color:var(--calcite-ui-brand);flex:0}.file__title{font-weight:500;padding-left:0.75rem;padding-right:0.75rem;font-size:0.875rem;flex:1 1 0%}.file__type{width:30%;flex:0 1 auto}.file__size{text-align:inline-end;width:6rem;flex:0 1 auto}.no-results{text-align:center;width:100%;display:block}.next{display:block;margin:0}.error{position:absolute;bottom:1rem;right:1rem;inset-inline-end:1rem;z-index:2}";

const ArcgisNewItemPagesCloud = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.updateFilter = () => {
      this.searching = true;
      const option = this.select.querySelector("calcite-option[selected]");
      this.filter = option.value;
      this.search();
    };
    this.debouncedInput = (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.d)(async (e) => {
      this.searching = true;
      this.searchTerm = e.target.value;
      this.search();
    }, 400);
    this.managedFocus = true;
    this.loading = true;
    this.loadingText = "";
    this.searching = undefined;
    this.files = [];
    this.moreResults = undefined;
    this.searchTerm = "";
    this.filter = "csv";
    this.selected = undefined;
    this.error = undefined;
    this.i18n = undefined;
  }
  async componentWillLoad() {
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.cloud;
    const current = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.cloudProvider;
    this.loadingText = this.i18n[current];
    this.provider = (0,_index_eb224d3c_js__WEBPACK_IMPORTED_MODULE_24__.g)(current);
  }
  async componentDidLoad() {
    var _a;
    try {
      await this.provider.connect();
      await this.search();
      await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.t)(200);
      (_a = this.mainInputRef) === null || _a === void 0 ? void 0 : _a.setFocus();
      if (_ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map" && !_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.existingItem) {
        // Sometimes when we go back, an item has already been created so we need to clean it up
        // For now, it only happens in MV
        // No need to await this, can be done in the background
        this.removeExistingFile();
      }
    }
    catch (error) {
      this.parseError(error);
    }
    this.loading = false;
  }
  async navigateToNextPage() {
    if (this.selected) {
      const { title, fileName, extension } = (0,_file_f36193e9_js__WEBPACK_IMPORTED_MODULE_14__.a)(this.selected.name);
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.dataUrl = this.selected.downloadUrl;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.fileName = fileName;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.extension = extension;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = "file";
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.cloudProviderResource = {
        cloudProvider: (0,_index_eb224d3c_js__WEBPACK_IMPORTED_MODULE_24__.a)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.cloudProvider),
        id: this.selected.id,
        mimeType: this.selected.mimeType,
        cloudDriveFileName: this.selected.name,
        cloudFileType: this.filter
      };
      // In case the user goes back to the file select page
      //  and select a different file
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedFields = undefined;
      _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title = title;
      const possibleItemTypes = (0,_item_types_054054c6_js__WEBPACK_IMPORTED_MODULE_16__.f)(extension);
      if (this.selected.mimeType === "googlesheets") {
        await this.removeExistingFile();
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type = "Microsoft Excel";
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.extension = "xls";
        const nextStep = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowPublish === false ? "itemProperties" : "publishSelect";
        this.newItemUpdatePage.emit(nextStep);
      }
      else if (possibleItemTypes.length === 1) {
        await this.removeExistingFile();
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type = possibleItemTypes[0].type;
        const nextItemStep = possibleItemTypes[0].nextStep;
        const nextStep = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowPublish === false && nextItemStep === "publishSelect"
          ? "itemProperties"
          : nextItemStep;
        this.newItemUpdatePage.emit(nextStep);
      }
      else if (extension === "zip") {
        this.newItemUpdatePage.emit("zipSelect");
      }
    }
    else {
      this.error = {
        title: this.i18n.errorTitle,
        message: this.i18n.errorMessage
      };
    }
  }
  async removeExistingFile() {
    const id = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id;
    if (id) {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id = null;
      await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.d)(id, { permanentDelete: true });
    }
  }
  async search(next) {
    this.moreResults = false;
    this.error = null;
    const result = await this.provider.search({
      searchText: this.searchTerm,
      dropdownFilter: this.filter,
      next
    });
    if (next) {
      this.files = [...this.files, ...result.files];
    }
    else {
      this.files = [...result.files];
    }
    this.moreResults = result.next;
    this.selected = null;
    this.searching = false;
  }
  getFilterOptions() {
    const provider = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.cloudProvider;
    const filters = ["csv", "excel", "zip", "geojson"];
    if (provider === "google drive") {
      filters.push("googlesheets");
    }
    return filters;
  }
  renderFiles() {
    const { files, selected, i18n, moreResults } = this;
    if (!(files === null || files === void 0 ? void 0 : files.length)) {
      return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "no-results" }, i18n.noResults);
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, !this.error && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("ul", { class: "files" }, files.map((file) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("li", { class: {
        files__item: true,
        "files__item--active": file.id === (selected === null || selected === void 0 ? void 0 : selected.id)
      }, key: file.id }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("label", { class: "file", htmlFor: `input-${file.id}` }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: _index_eb224d3c_js__WEBPACK_IMPORTED_MODULE_24__.c[file.mimeType] || "file-text", scale: "s", class: "file__icon" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("input", { type: "radio", id: `input-${file.id}`, name: "file", value: file.id, checked: (selected === null || selected === void 0 ? void 0 : selected.id) === file.id, onChange: () => {
        this.selected = file;
        this.error = null;
      }, class: "screen-readers-only" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "file__title" }, file.name), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "file__type", "aria-hidden": "true" }, _index_eb224d3c_js__WEBPACK_IMPORTED_MODULE_24__.b[file.mimeType] || i18n.file), file.size && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "file__size", "aria-hidden": "true" }, (0,_file_f36193e9_js__WEBPACK_IMPORTED_MODULE_14__.f)(file.size))))))))), moreResults && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { "icon-start": "plus", class: "next", appearance: "transparent", onClick: () => this.search(true) }, i18n.viewMore))));
  }
  parseError(e) {
    if (e === "popupBlocked") {
      this.error = this.i18n.error.popup;
    }
    else {
      this.error = this.i18n.error.generic;
    }
  }
  render() {
    const { loading, loadingText, files, i18n, filter, searching, error } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, loading && !files.length ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { active: true, text: loadingText, type: "indeterminate" })) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "table" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "search", icon: "search", class: "input", onCalciteInputInput: this.debouncedInput, label: i18n.searchFiles, ref: (ele) => (this.mainInputRef = ele) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: i18n.filterFileType, ref: (el) => (this.select = el), onCalciteSelectChange: this.updateFilter, slot: "action", class: "select" }, this.getFilterOptions().map((value) => {
      var _a;
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { selected: filter === value, value: value, label: (_a = i18n.fileType[value]) !== null && _a !== void 0 ? _a : _index_eb224d3c_js__WEBPACK_IMPORTED_MODULE_24__.b[value] }));
    }))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("fieldset", { class: {
        table__body: true,
        "table__body--center": searching || !files.length
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("legend", { class: "screen-readers-only" }, i18n.selectAFile), this.searching ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "loader" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { active: true, text: i18n.loadingFiles }))) : (this.renderFiles())))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: error === null || error === void 0 ? void 0 : error.title, description: error === null || error === void 0 ? void 0 : error.message, active: !!error, onAlertDismiss: () => {
        this.error = null;
      } })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesCloud.style = arcgisNewItemPagesCloudCss;

const arcgisNewItemPagesFileFieldsCss = ".fields-container{display:flex;flex-direction:column;height:100%}.field-table{margin-bottom:1.5rem;display:flex;flex-direction:column;min-height:15rem}.search-container{display:flex;width:100%}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.field-search{-webkit-margin-end:8px;margin-inline-end:8px;width:75%}.field-select{width:25%}.fields-scroll-container{overflow-y:auto;flex:1 1 auto;transform:translateZ(0)}.header-row{display:flex;align-content:flex-start;justify-content:center;color:var(--calcite-ui-text-1);font-size:0.875rem;grid-gap:0.25rem;gap:0.25rem;padding:0.25rem}.header-cell{width:100%}.hide{display:none}.chip-container{margin-top:1rem;margin-bottom:1rem}.chip{font-weight:700}.clear-selection{border-style:none;cursor:pointer;padding:0;border-width:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:0.75rem;font-weight:500;color:var(--calcite-ui-text-2);margin-left:0.75rem;margin-right:0.75rem;font-family:Avenir Next, Avenir, Helvetica Neue, sans-serif;background:transparent}.clear-selection:hover{text-decoration:underline;cursor:pointer}.not-visible{visibility:hidden;height:0}.description{margin-bottom:1rem}";

const ArcgisNewItemPagesFileFields = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.workflowComplete = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
    // Telemetry: gather info about which fields have received user input
    this.fieldsSearched = false;
    this.fieldsModified = {};
    this.addDirectToMap = false;
    this.handleTimezoneChange = (event) => {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.timezone = event.detail;
    };
    this.updateModifiedFields = (detail) => {
      const { name, key, modified } = detail;
      // If no existing entry, create one with the corresponding property's modified flag set, update otherwise
      if (!this.fieldsModified[name]) {
        this.fieldsModified[name] = {
          type: key === "type" && modified ? 1 : 0,
          alias: key === "alias" && modified ? 1 : 0
        };
      }
      else {
        this.fieldsModified[name][key] = modified ? 1 : 0;
      }
    };
    this.handleFieldTypeFilter = (ev) => {
      this.selectedFieldTypeFilter = ev.target.selectedOption.value;
    };
    this.handleSearchChange = (ev) => {
      // Telemetry: Flag if the user attempted to search
      this.fieldsSearched = true;
      this.searchTerm = ev.target.value;
    };
    this.getFilteredFields = () => {
      this.filteredFields = this.fields.reduce((filteredFields, field) => {
        if ((!this.searchTerm ||
          field.name.toLowerCase().indexOf(this.searchTerm.toLowerCase()) > -1 ||
          field.alias.toLowerCase().indexOf(this.searchTerm.toLowerCase()) > -1) &&
          (this.selectedFieldTypeFilter === "default" ||
            this.selectedFieldTypeFilter === field.type)) {
          filteredFields[field.name] = field;
        }
        return filteredFields;
      }, {});
    };
    this.handleSelectAllToggle = () => {
      this.fields = this.fields.map((field) => {
        if (!!this.filteredFields[field.name]) {
          return Object.assign(Object.assign({}, field), { selected: !this.allSelected });
        }
        return field;
      });
    };
    this.clearSelection = () => {
      this.fields = this.fields.map((field) => (Object.assign(Object.assign({}, field), { selected: false })));
    };
    // Telemetry: Log changes user made to fields
    this.logCSVFieldChanges = (fields) => {
      // TODO: Refactor fields count to use mapreduce
      const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
      const modifiedFieldsCount = { type: 0, alias: 0 };
      const totalFieldsCount = this.fields.length;
      const selectedFieldsCount = Object.keys(fields).length;
      for (const field in this.fieldsModified) {
        modifiedFieldsCount.type += this.fieldsModified[field].type;
        modifiedFieldsCount.alias += this.fieldsModified[field].alias;
      }
      const payload = {
        eventType: "other",
        pageName: "my content",
        category: "new item csv time zone and fields",
        details: this.fieldsSearched ? "fields searched" : "no fields searched",
        label: this.initialTimezone === _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.timezone ? "default timezone" : "timezone changed",
        count: totalFieldsCount,
        number: totalFieldsCount - selectedFieldsCount,
        size: modifiedFieldsCount.alias,
        position: modifiedFieldsCount.type
      };
      telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
    };
    this.selectedFieldTypeFilter = "default";
    this.fields = undefined;
    this.filteredFields = undefined;
    this.searchTerm = undefined;
    this.i18n = undefined;
    this.allSelected = undefined;
  }
  handleNext() {
    const fields = this.fields.reduce((fieldMap, field) => {
      var _a, _b;
      if (field.selected) {
        delete field.selected;
        // #4336 - if user changed to string, add a larger length to avoid publish errors
        if (field.type === "esriFieldTypeString" && ((_b = (_a = this.fieldsModified) === null || _a === void 0 ? void 0 : _a[field.name]) === null || _b === void 0 ? void 0 : _b.type)) {
          field.length = 4000;
        }
        fieldMap[field.name] = field;
      }
      return fieldMap;
    }, {});
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedFields = fields;
    this.logCSVFieldChanges(fields);
    if (this.isAddToMapTerminalPage()) {
      // TODO: merge this with the same thing in `csv-location-fields`
      this.workflowComplete.emit({
        type: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type,
        url: encodeURI(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.url),
        customParameters: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.customParameters,
        results: {
          analyzeResults: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.analyzeResults,
          fields: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedFields
        }
      });
    }
    else if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type === "GeoJson") {
      this.newItemUpdatePage.emit("itemProperties");
    }
    else {
      this.newItemUpdatePage.emit("csvLocationFields");
    }
  }
  fieldsChanged() {
    this.getFilteredFields();
  }
  isAddToMapTerminalPage() {
    const { newItemMode, type } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    return _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map" && newItemMode === "url" && type !== "CSV";
  }
  async componentWillLoad() {
    const i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n;
    this.i18n = i18n.csvFields;
    if (this.isAddToMapTerminalPage()) {
      _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.nextText = "addToMap";
    }
    const { backupLayerFields } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const fields = (0,_geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_21__.a)().fields;
    const lookupMap = {};
    fields.forEach((field) => (lookupMap[field.name] = true));
    this.fields = backupLayerFields.map((field) => {
      var _a, _b;
      return (Object.assign(Object.assign({}, ((_b = (_a = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedFields) === null || _a === void 0 ? void 0 : _a[field.name]) !== null && _b !== void 0 ? _b : field)), { selected: !!lookupMap[field.name] }));
    });
    this.getFilteredFields();
    this.initialTimezone = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.timezone;
    this.addDirectToMap = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map" && !_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.enablePublishing;
  }
  async componentDidLoad() {
    var _a;
    // https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/43341
    if (this.scrollContainer && ((_a = navigator === null || navigator === void 0 ? void 0 : navigator.vendor) === null || _a === void 0 ? void 0 : _a.includes("Apple"))) {
      this.scrollContainer.style.overflow = "hidden";
      await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.t)(100);
      this.scrollContainer.style.overflow = "auto";
    }
  }
  updateField(event) {
    const { name, key, value } = event.detail;
    this.fields = this.fields.map((field) => {
      if (field.name === name) {
        field[key] = value;
        // Telemetry: Track if the incoming key is different than the default value
        this.updateModifiedFields(event.detail);
      }
      return field;
    });
  }
  render() {
    const { i18n, addDirectToMap } = this;
    this.allSelected = Object.keys(this.filteredFields).every((name) => this.filteredFields[name].selected);
    const canHideFields = !addDirectToMap && _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow !== "append";
    const numberSelected = this.fields.filter((field) => field.selected).length;
    const hasDate = this.fields.some((field) => field.type === "esriFieldTypeDate");
    const timezone = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.timezone;
    const rowHeaders = [i18n.fieldName, i18n.displayName, i18n.type];
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", { class: "fields-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { class: "description", header: i18n.fieldTitle, content: i18n[!_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.enablePublishing ? "fieldNoHostedDescription" : "fieldDescription"] }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "search-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "field-search" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { onCalciteInputInput: this.handleSearchChange, type: "search", placeholder: i18n.searchFields }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "screen-readers-only" }, i18n.searchFields)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: i18n.fieldType, onCalciteSelectChange: this.handleFieldTypeFilter, class: "field-select", width: "half" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { selected: this.selectedFieldTypeFilter === "default", value: "default" }, i18n.allTypes), Object.keys(i18n.fieldTypes).map((type) => {
      const fieldType = i18n.fieldTypes[type];
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { selected: this.selectedFieldTypeFilter === type, value: type }, fieldType));
    }))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "field-table", role: "table" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: `chip-container ${numberSelected === 0 || canHideFields ? "" : "not-visible"}` }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-chip", { class: "chip", value: numberSelected }, numberSelected, " ", i18n.selected), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { onClick: this.clearSelection, class: "clear-selection" }, i18n.clearSelection)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: `header-row ${Object.keys(this.filteredFields).length === 0 ? "hide" : ""}`, role: "row" }, rowHeaders.map((column, index) => {
      if (index === 0 && canHideFields) {
        return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline", class: "header-cell", role: "columnheader", "aria-sort": "none" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { checked: this.allSelected, onCalciteCheckboxChange: this.handleSelectAllToggle }), column));
      }
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "header-cell", role: "columnheader", "aria-sort": "none" }, column));
    })), Object.keys(this.filteredFields).length > 0 ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "fields-scroll-container", ref: (el) => {
        this.scrollContainer = el;
      } }, Object.keys(this.filteredFields).map((key) => {
      var _a, _b;
      const field = this.filteredFields[key];
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-csv-field", { detectedType: (_b = (_a = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a === null || _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a === void 0 ? void 0 : _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.backupLayerFields) === null || _a === void 0 ? void 0 : _a.find((backupField) => backupField.name === field.name)) === null || _b === void 0 ? void 0 : _b.type, onFieldChange: this.updateField.bind(this), field: field, fieldTypes: i18n.fieldTypes, defaultChecked: field.selected, canHideFields: canHideFields, displayNameLabel: i18n.displayNameLabel.replace("${name}", field.name), typeLabel: i18n.typeLabel.replace("${name}", field.name) }));
    }))) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { icon: true, status: "valid" }, i18n.noFields))), hasDate && !addDirectToMap && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-timezone-dropdown", { onTimezoneChange: this.handleTimezoneChange, defaultTimezone: timezone }))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "fields": ["fieldsChanged"],
    "selectedFieldTypeFilter": ["fieldsChanged"],
    "searchTerm": ["fieldsChanged"]
  }; }
};
ArcgisNewItemPagesFileFields.style = arcgisNewItemPagesFileFieldsCss;

const arcgisNewItemPagesItemPropertiesCss = ".layer-description.sc-arcgis-new-item-pages-item-properties{display:block;margin-bottom:0.75rem}.locator__heading.sc-arcgis-new-item-pages-item-properties{font-weight:500;font-size:0.875rem;color:var(--calcite-ui-text-1);line-height:18px;margin-bottom:2px}.locator__description.sc-arcgis-new-item-pages-item-properties{font-size:0.875rem;color:var(--calcite-ui-text-1);margin:0;margin-bottom:1rem;padding:0}.medium.sc-arcgis-new-item-pages-item-properties{--arcgis-label-font-weight:500}.info-container.sc-arcgis-new-item-pages-item-properties{margin-bottom:1.5rem}";

var __asyncValues = ( false) || function (o) {
  if (!Symbol.asyncIterator)
    throw new TypeError("Symbol.asyncIterator is not defined.");
  var m = o[Symbol.asyncIterator], i;
  return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i);
  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }
  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function (v) { resolve({ value: v, done: d }); }, reject); }
};
const MAX_TITLE_LENGTH = 250;
const ArcgisNewItemPagesItemProperties = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.workflowCancel = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowCancel", 7);
    this.workflowComplete = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
    this.newItemToggleNavigationEnabled = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
    this.workflowCancelled = false;
    this.handleRequest = async () => {
      var _a, _b, _c;
      // Don't send request if an error is reported
      if (!(await this.validate())) {
        return;
      }
      const { newItemMode, existingItem, type } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
      const { categories } = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i;
      const { portal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
      let addResponse;
      let publishResponse;
      let emptyLayerCreated = newItemMode === "featureLayer";
      const title = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title;
      if ((title === null || title === void 0 ? void 0 : title.length) > MAX_TITLE_LENGTH) {
        _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title = title.substring(0, MAX_TITLE_LENGTH);
      }
      try {
        // Telemetry: Begin upload tracking workflow
        // TODO: Check if same telemetry events should be used in existing item publish workflows too
        logAddNewItemStart();
        ({ addResponse, publishResponse } =
          existingItem && newItemMode === "file"
            ? await this.publishExistingItem()
            : await this.handleAddItem());
        const responseIds = [addResponse === null || addResponse === void 0 ? void 0 : addResponse.id, publishResponse === null || publishResponse === void 0 ? void 0 : publishResponse.id].filter((id) => id);
        categories && (await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.u)(portal, responseIds, categories));
        if (type === "KML") {
          const { config, portal, api } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
          await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.p)((_a = addResponse.id) !== null && _a !== void 0 ? _a : _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id, portal, config.restBaseUrl, config, api);
        }
        if (!this.workflowCancelled) {
          // Telemetry: Only log telemetry after successful upload
          logItemPropertiesChanges();
          logSuccessfulItemCreation();
          !!_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.addTileLayerOption && (0,_tile_layer_bd7e56c2_js__WEBPACK_IMPORTED_MODULE_18__.a)();
          _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry && (await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.t)(750));
          let emitPayload;
          if (this.isAddToMapTerminalPage()) {
            if (newItemMode === "url") {
              const payload = Object.assign(Object.assign({ url: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.url, customParameters: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.customParameters, type: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type, addAsBasemap: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.addAsBasemap }, (publishResponse
                ? { id: publishResponse.id, serviceUrl: publishResponse.serviceUrl }
                : {})), (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.storeAuth ? { id: addResponse.id } : {}));
              emitPayload = payload;
            }
            else {
              let payload;
              if (publishResponse) {
                payload = {
                  type: publishResponse.serviceType,
                  id: publishResponse.id,
                  jobId: publishResponse.jobId,
                  serviceUrl: publishResponse.serviceUrl,
                  results: {
                    sourceItemInfo: {
                      id: (_b = addResponse === null || addResponse === void 0 ? void 0 : addResponse.id) !== null && _b !== void 0 ? _b : existingItem === null || existingItem === void 0 ? void 0 : existingItem.id,
                      type: (_c = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type) !== null && _c !== void 0 ? _c : existingItem === null || existingItem === void 0 ? void 0 : existingItem.type
                    }
                  }
                };
              }
              else {
                payload = Object.assign({ type: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type, id: addResponse.id }, (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.analyzeResults && _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedFields
                  ? {
                    results: {
                      analyzeResults: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.analyzeResults,
                      fields: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedFields
                    }
                  }
                  : {}));
              }
              emitPayload = payload;
            }
          }
          else {
            emitPayload = Object.assign({
              // `publishResponse` doesn't for some flows so use this id instead
              id: addResponse === null || addResponse === void 0 ? void 0 : addResponse.id, item: Object.assign({}, _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a), response: addResponse, emptyLayerCreated,
              newItemMode
            }, publishResponse);
          }
          this.workflowComplete.emit(emitPayload);
        }
        else {
          (publishResponse === null || publishResponse === void 0 ? void 0 : publishResponse.id) && (await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.d)(publishResponse.id, { permanentDelete: true }));
          addResponse.id && (await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.d)(addResponse.id, { permanentDelete: true }));
          this.workflowCancel.emit();
        }
        (0,_utils_86ac6961_js__WEBPACK_IMPORTED_MODULE_13__.r)();
      }
      catch (error) {
        if (newItemMode === "featureLayer") {
          // TODO: refactor this once we refactor the error system in item properties
          (0,_feature_layer_d0f64b81_js__WEBPACK_IMPORTED_MODULE_29__.f)(JSON.stringify(error));
        }
        console.error(error);
        this.error = error;
        this.showLoader(false);
      }
    };
    this.preprocessAddItem = () => {
      if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileLayerPublishType === "3dTiles") {
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.typeKeywords = [
          ..._add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.typeKeywords.filter((typeKeyword) => !_tile_layer_90a6b901_js__WEBPACK_IMPORTED_MODULE_9__.t.includes(typeKeyword)),
          _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tilesLayer3dTilesLayerType
        ];
      }
    };
    this.itemType = undefined;
    this.error = undefined;
    this.loading = false;
    this.loaderType = "indeterminate";
    this.loaderMessage = undefined;
    this.i18n = undefined;
  }
  async validate() {
    var _a, _b;
    if (!(await this.itemPropertiesFolderRef.saveActiveFolder())) {
      return false;
    }
    const titleError = await ((_a = this.titleRef) === null || _a === void 0 ? void 0 : _a.validateTitle());
    if (titleError) {
      // Title component uses a brief inline error - map the main error handler to the detailed message
      this.error =
        titleError.code === "titleInUseService" ? { code: "serviceNameExists" } : titleError;
      this.titleRef.focusMainInput();
      return false;
    }
    const summaryError = await ((_b = this.summaryRef) === null || _b === void 0 ? void 0 : _b.getErrorMessage());
    if (summaryError) {
      this.error = summaryError;
      return false;
    }
    return true;
  }
  async navigateToNextPage() {
    this.handleRequest();
  }
  async handleError() {
    const { error } = this;
    const errorMessage = typeof error === "string" ? error : error === null || error === void 0 ? void 0 : error.message;
    // 39963: Publishing fails if the service name is taken, but the created item persists
    // Remove the newly created item so the title can be changed without throwing the
    // "file already exists" error on retry
    if ((errorMessage === null || errorMessage === void 0 ? void 0 : errorMessage.includes("Service name")) && !_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.existingItem) {
      await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.d)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id, { permanentDelete: true });
    }
  }
  isAddToMapTerminalPage() {
    return _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map";
  }
  // Item was already created and only needs an update if it's a large CSV added to MV without publishing
  shouldUpdatePreviouslyCreatedItem() {
    const { type, enablePublishing, file } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const mvFlow = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map";
    return (mvFlow &&
      type === "CSV" &&
      !enablePublishing &&
      !!file &&
      file.size > _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.M);
  }
  async componentWillLoad() {
    const addCreateI18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n;
    const i18n = addCreateI18n.itemProperties;
    this.i18n = i18n;
    const { newItemMode } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    if (this.isAddToMapTerminalPage()) {
      _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.nextText = "createAndAddToMap";
    }
    else {
      _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.nextText = newItemMode === "dataStore" ? "createConnection" : "save";
    }
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.initialFolders = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.folders;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.initialTitle = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title;
    const { enablePublishing, fileName, type, storeAuth } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    if (_ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map") {
      this.descriptionInfo = {
        title: !!fileName
          ? (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(i18n.howWillAdd, fileName, "fileName")
          : i18n.howWillAddService,
        content: storeAuth
          ? i18n.howWillAddSecuredServiceDescription
          : enablePublishing
            ? i18n.howWillAddHostedDescription
            : (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(i18n.howWillAddDescription, type === "GeoJson" ? "GeoJSON" : type, "fileType")
      };
    }
  }
  async handleAddItem() {
    const { file, fileName, newItemMode, type, enablePublishing, serviceInfo, typeKeywords, tags, extent, selectedServiceInfoLayersNames, addFeatureLayerType } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    let addResponse;
    let publishResponse;
    this.preprocessAddItem();
    switch (newItemMode) {
      case "file":
        this.showLoader(true, {
          loaderType: (file === null || file === void 0 ? void 0 : file.size) > _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.M ? "determinate" : "indeterminate",
          loaderMessage: (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(this.i18n["uploading"], fileName, "fileType") // TODO: Type in string should be "fileName", not "fileType"
        });
        if (this.shouldUpdatePreviouslyCreatedItem()) {
          ({ addResponse } = await this.handleFileUpdate());
        }
        else {
          ({ addResponse, publishResponse } = await this.handleFileUpload());
        }
        // Workflow was cancelled if no file found in store
        if (!_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.file && !_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.dataUrl) {
          this.workflowCancelled = true;
        }
        break;
      case "url":
        this.showLoader(true, {
          loaderType: "indeterminate",
          loaderMessage: (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(this.i18n["adding"], _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.url, "fileType")
        });
        if ((type === "CSV" || type === "GeoJson") && enablePublishing) {
          ({ addResponse, publishResponse } = await this.handleFileUpload());
        }
        else {
          addResponse = await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.h)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.config, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.api);
        }
        break;
      case "featureLayer":
        this.showLoader(true, {
          loaderType: "indeterminate",
          loaderMessage: (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(this.i18n["creating"], "feature layer", "fileType")
        });
        addResponse = await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.c)({
          serviceInfo,
          typeKeywords,
          tags,
          extent,
          selectedServiceInfoLayersNames,
          addFeatureLayerType
        });
        (0,_feature_layer_d0f64b81_js__WEBPACK_IMPORTED_MODULE_29__.a)();
        break;
      case "tileLayer":
      case "sceneLayer":
        this.showLoader(true, {
          loaderType: "indeterminate",
          loaderMessage: (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(this.i18n["publishing"], newItemMode === "sceneLayer" ? "scene service" : "tile layer", "fileType")
        });
        ({ addResponse, publishResponse } = await this.addTileLayer());
        break;
      case "rasterFunctionTemplate":
        this.showLoader(true, {
          loaderType: (file === null || file === void 0 ? void 0 : file.size) > _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.M ? "determinate" : "indeterminate",
          loaderMessage: (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(this.i18n["uploading"], fileName, "fileType")
        });
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.file = new File([""], `${_item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title}.rft.json`);
        ({ addResponse, publishResponse } = await this.handleFileUpload());
        break;
      case "application":
        this.showLoader(true, {
          loaderType: (file === null || file === void 0 ? void 0 : file.size) > _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.M ? "determinate" : "indeterminate",
          loaderMessage: (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(this.i18n["adding"], _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type, "fileType")
        });
        addResponse = await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.b)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.config.restBaseUrl, type === "Application"
          ? { redirect_uris: ["urn:ietf:wg:oauth:2.0:oob"], appType: "multiple" }
          : undefined);
        break;
      case "dataStore":
        const { addDataStoreType, provider } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
        this.showLoader(true, {
          loaderType: "indeterminate",
          loaderMessage: (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(this.i18n["addDataStore"], this.i18n[addDataStoreType === "cloud" ? provider : addDataStoreType], "fileType")
        });
        addResponse = await (0,_data_store_f509564d_js__WEBPACK_IMPORTED_MODULE_25__.a)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a, _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title, _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.tags, _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.categories, _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.snippet);
        break;
      case "developerCredentials":
        this.showLoader(true, {
          loaderType: "indeterminate",
          loaderMessage: (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(this.i18n["creating"], _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type, "fileType")
        });
        addResponse = await this.addDeveloperCredentialApplication();
        break;
      case "create":
      default:
        this.showLoader(true, {
          loaderType: "indeterminate",
          loaderMessage: (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(this.i18n["creating"], _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type, "fileType")
        });
        addResponse = await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.c)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a);
        break;
    }
    return { addResponse, publishResponse };
  }
  async publishExistingItem() {
    const { id, type } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    let addResponse = { success: true, id, folder: null };
    const publishResponse = type === "Image Collection"
      ? await this.publishImageCollection(addResponse)
      : await this.publishService(id);
    await (0,_publish_item_82ffa7f8_js__WEBPACK_IMPORTED_MODULE_27__.a)(publishResponse);
    // https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/41501
    const typesToUpdateTitle = [
      "Shapefile",
      "File Geodatabase",
      "CSV",
      "Microsoft Excel",
      "GeoJson",
      "GeoPackage",
      "Feature Collection"
    ];
    if (typesToUpdateTitle.includes(type)) {
      ({ addResponse } = await this.handleFileUpdate(publishResponse.id));
    }
    return { addResponse, publishResponse };
  }
  async handleFileUpload() {
    var _a;
    const { type, enablePublishing, cloudProviderResource, geoJSONResource, csvResource } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    let addResponse;
    let publishResponse;
    const isNotCSVOrExcel = type !== "CSV" && type !== "Microsoft Excel";
    if (enablePublishing) {
      if (type === "Image Collection") {
        addResponse = await this.addFile();
        publishResponse = await this.publishImageCollection(addResponse);
      }
      else {
        // For CSV and XLXS from cloud and large csv, we already add item
        if (!isNotCSVOrExcel && (cloudProviderResource || _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id)) {
          // We need to make change to the original item title before publishing
          //  because publish always use the item title as the service name
          await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.e)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id, (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.f)({
            title: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title,
            tags: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.tags,
            snippet: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.snippet
          }));
          ({ addResponse, publishResponse } = await this.publishExistingItem());
        }
        else {
          addResponse = await this.addFile({ title: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title });
          _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id = addResponse.id;
          publishResponse = await this.publishService(addResponse.id);
        }
        await (0,_publish_item_82ffa7f8_js__WEBPACK_IMPORTED_MODULE_27__.a)(publishResponse);
      }
      this.updateFolder(publishResponse);
      if (cloudProviderResource || geoJSONResource || csvResource) {
        if ((cloudProviderResource === null || cloudProviderResource === void 0 ? void 0 : cloudProviderResource.mimeType) === "zip") {
          cloudProviderResource.zipItemType = type;
        }
        try {
          await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.d)((_a = cloudProviderResource !== null && cloudProviderResource !== void 0 ? cloudProviderResource : geoJSONResource) !== null && _a !== void 0 ? _a : csvResource, publishResponse.id);
        }
        catch (_b) {
          // no-op
        }
      }
    }
    else {
      if (cloudProviderResource && !isNotCSVOrExcel && _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id) {
        // Already add, just need to update the title
        addResponse = await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.e)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id, (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.f)({
          title: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title,
          tags: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.tags,
          snippet: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.snippet
        }));
      }
      else {
        addResponse = await this.addFile({ title: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title });
      }
    }
    return { addResponse, publishResponse };
  }
  async handleFileUpdate(id) {
    this.updateLoader("indeterminate", this.i18n.uploading.replace("${type}", _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.fileName));
    const addResponse = await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.e)(id !== null && id !== void 0 ? id : _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id, (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.f)({
      title: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title,
      tags: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.tags,
      snippet: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.snippet
    }));
    this.updateFolder(addResponse);
    return { addResponse };
  }
  async addDeveloperCredentialApplication() {
    const { developerCredentialsRedirectUrls, applicationEnvironment, developerCredentialsType, apiKeyReferrerUrls, developerPrivileges } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    return (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.b)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a, (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.g)(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal), developerCredentialsType === "oauth"
      ? { appType: applicationEnvironment, redirect_uris: developerCredentialsRedirectUrls }
      : {
        appType: "apikey",
        redirect_uris: developerCredentialsRedirectUrls,
        httpReferrers: apiKeyReferrerUrls,
        privileges: developerPrivileges
      });
  }
  async addFile(props) {
    const response = await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.e)(props);
    this.updateLoader("indeterminate", this.i18n.checkingStatus);
    await (0,_publish_item_82ffa7f8_js__WEBPACK_IMPORTED_MODULE_27__.c)(response);
    return response;
  }
  async updateFolder(publishResponse) {
    const { id, file, cloudProviderResource } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const folder = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.folder;
    // Multipart and pre-added items need to be moved after creation
    if ((file === null || file === void 0 ? void 0 : file.size) > _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.M || cloudProviderResource) {
      const moveIds = [];
      id && moveIds.push(id);
      (publishResponse === null || publishResponse === void 0 ? void 0 : publishResponse.id) && moveIds.push(publishResponse === null || publishResponse === void 0 ? void 0 : publishResponse.id);
      folder.id !== folder.username && (await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.m)(moveIds.join(","), folder.id));
    }
  }
  async publishService(itemId) {
    var _a, _b, _c, _d, _e, _f, _g, _h;
    this.showLoader(true, {
      loaderType: "indeterminate",
      loaderMessage: this.i18n.publishingService
    });
    const { result: publishResponse } = await (0,_publish_item_82ffa7f8_js__WEBPACK_IMPORTED_MODULE_27__.p)({
      itemId,
      user: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user,
      extension: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.extension,
      type: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type,
      title: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title
    });
    if (!((_a = publishResponse.services) === null || _a === void 0 ? void 0 : _a.length) || !((_c = (_b = publishResponse.services) === null || _b === void 0 ? void 0 : _b[0]) === null || _c === void 0 ? void 0 : _c.success) === false) {
      throw this.i18n.errorPublishing;
    }
    else if ((_e = (_d = publishResponse.services[0]) === null || _d === void 0 ? void 0 : _d.error) === null || _e === void 0 ? void 0 : _e.message) {
      throw (_g = (_f = publishResponse.services[0]) === null || _f === void 0 ? void 0 : _f.error) === null || _g === void 0 ? void 0 : _g.message;
    }
    const service = (_h = publishResponse.services) === null || _h === void 0 ? void 0 : _h[0];
    return {
      id: service === null || service === void 0 ? void 0 : service.serviceItemId,
      jobId: service === null || service === void 0 ? void 0 : service.jobId,
      serviceType: service === null || service === void 0 ? void 0 : service.type,
      serviceUrl: service === null || service === void 0 ? void 0 : service.serviceurl
    };
  }
  async publishImageCollection(addItemResponse) {
    var _a, e_1, _b, _c;
    const { config, user, portal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
    this.showLoader(true, {
      loaderType: "indeterminate",
      loaderMessage: this.i18n.publishingService
    });
    const imageCollectionGenerator = (0,_image_collection_a67002cc_js__WEBPACK_IMPORTED_MODULE_26__.c)(addItemResponse, _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title, { config, user, portal });
    try {
      for (var _d = true, imageCollectionGenerator_1 = __asyncValues(imageCollectionGenerator), imageCollectionGenerator_1_1; imageCollectionGenerator_1_1 = await imageCollectionGenerator_1.next(), _a = imageCollectionGenerator_1_1.done, !_a;) {
        _c = imageCollectionGenerator_1_1.value;
        _d = false;
        try {
          const status = _c;
          if (typeof status === "string") {
            this.updateLoader("indeterminate", this.i18n[status]);
          }
          else {
            return {
              id: status.serviceItemId,
              jobId: null,
              serviceType: status.type,
              serviceUrl: status.serviceurl
            };
          }
        }
        finally {
          _d = true;
        }
      }
    }
    catch (e_1_1) {
      e_1 = { error: e_1_1 };
    }
    finally {
      try {
        if (!_d && !_a && (_b = imageCollectionGenerator_1.return))
          await _b.call(imageCollectionGenerator_1);
      }
      finally {
        if (e_1)
          throw e_1.error;
      }
    }
  }
  async addTileLayer() {
    const { dataset, dataStoreId, serverId } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const { folder, categories } = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i;
    let publishResponse;
    if (dataset) {
      const { result, error } = await (0,_data_store_f509564d_js__WEBPACK_IMPORTED_MODULE_25__.p)({
        type: dataset.type,
        serviceName: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title,
        pathInCachedStore: dataset.path,
        cacheStoreId: dataStoreId,
        serverId,
        folder,
        description: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.snippet,
        tags: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.tags
      }, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal);
      if (error) {
        throw error;
      }
      if (result) {
        publishResponse = {
          id: result.serviceItemId,
          serviceType: result.type,
          serviceUrl: result.serviceUrl
        };
      }
    }
    else {
      if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileLayerPublishType !== "3dTiles") {
        // TODO: finish the 3D Tiles publish workflow
        const { tileLayerPublishContent, tileLayerPublishType, tileLayerData } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
        const { title, tags, snippet } = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i;
        publishResponse = await (0,_tile_layer_f8be7028_js__WEBPACK_IMPORTED_MODULE_11__.p)(tileLayerPublishContent, {
          user: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user,
          publishType: tileLayerPublishType,
          folder,
          title,
          tags,
          categories,
          snippet
        }, tileLayerData);
      }
    }
    const addResponse = { success: true, id: publishResponse.id, folder: null };
    return { addResponse, publishResponse };
  }
  showLoader(show, update) {
    if (update) {
      this.updateLoader(update.loaderType, update.loaderMessage);
    }
    if (show) {
      this.newItemToggleNavigationEnabled.emit(false);
      this.loading = true;
    }
    else {
      this.newItemToggleNavigationEnabled.emit(true);
      this.loading = false;
    }
  }
  updateLoader(loaderType, loaderMessage) {
    this.loaderType = loaderType;
    this.loaderMessage = loaderMessage;
  }
  parseError() {
    var _a, _b, _c, _d, _e, _f;
    const { i18n, error } = this;
    if (typeof error !== "string" && (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.j)(error)) {
      const code = error.code;
      let linkInfo;
      if (code === "itemExists" || code === "fileExists") {
        linkInfo = {
          link: error.itemUrl,
          text: i18n.alreadyExists.linkText
        };
      }
      let title = i18n.errorTitle;
      let description = error.translatedMessage;
      if (!description && code === "fileExists") {
        title = i18n.alreadyExists.title;
        description = (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(i18n.alreadyExists.description, this.fileName, "fileName");
      }
      if (code === "failToPublishFromDataStore") {
        const { newItemMode } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
        const baseI18n = i18n.failDatastorePublish;
        title = baseI18n.title;
        description = (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(baseI18n.description, newItemMode === "sceneLayer" || newItemMode === "tileLayer" ? baseI18n[newItemMode] : "", "fileType");
      }
      if (code === "serviceNameExists") {
        ({ title, description } = i18n.serviceNameExists);
      }
      return { title, description, linkInfo };
    }
    if ((0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.k)(error)) {
      const errorDetail = error.details[0];
      if (errorDetail === null || errorDetail === void 0 ? void 0 : errorDetail.includes("must be uploaded directly to an ArcGIS Server site")) {
        const errorInfo = i18n.arcgisServerUpload;
        return { title: errorInfo.title, description: errorInfo.description };
      }
      else if (errorDetail.includes("spatial reference must be either a geographic or projected coordinate system")) {
        const errorInfo = i18n.invalidSpatialRef;
        return { title: errorInfo.title, description: errorInfo.description };
      }
    }
    const errorMessage = (typeof error === "string" ? error : error === null || error === void 0 ? void 0 : error.message) ||
      (error === null || error === void 0 ? void 0 : error.statusMessage) ||
      i18n.errorDescription;
    if (!errorMessage) {
      return { title: i18n.errorTitle, description: i18n.errorDescription };
    }
    const { fileName, file } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const lowercaseErrorMessage = errorMessage.toLowerCase();
    switch (true) {
      case (_a = lowercaseErrorMessage.includes) === null || _a === void 0 ? void 0 : _a.call(lowercaseErrorMessage, "already exists"):
        if (lowercaseErrorMessage.includes("file") || lowercaseErrorMessage.includes("item")) {
          return {
            title: i18n.alreadyExists.title,
            description: i18n.alreadyExists.description.replace("${fileName}", fileName || (file === null || file === void 0 ? void 0 : file.name))
          };
        }
        if (errorMessage.includes("Service name")) {
          return i18n.serviceNameExists;
        }
        break;
      case (_b = errorMessage.includes) === null || _b === void 0 ? void 0 : _b.call(errorMessage, "GeoJson doesn't have 'type'"):
        return i18n.invalidGeoJSON;
      case (_c = errorMessage.includes) === null || _c === void 0 ? void 0 : _c.call(errorMessage, "GeoJson file is not a valid json"):
        return i18n.invalidJSON;
      case (_d = errorMessage.includes) === null || _d === void 0 ? void 0 : _d.call(errorMessage, "Invalid Shapefile"):
        return {
          title: i18n.invalidShapefile.title,
          description: i18n.invalidShapefile.description
        };
      case (_e = errorMessage.includes) === null || _e === void 0 ? void 0 : _e.call(errorMessage, "Invalid File Geodatabase"):
        return i18n.invalidGeodatabase;
      case (_f = errorMessage.includes) === null || _f === void 0 ? void 0 : _f.call(errorMessage, "error publishing"):
        return { title: i18n.errorTitle, description: i18n.errorPublishing };
    }
    return {
      title: i18n.errorTitle,
      description: i18n.errorDescription
    };
  }
  render() {
    const { descriptionInfo, loading } = this;
    const { title, description, linkInfo } = this.parseError();
    const { newItemMode, type, enablePublishing } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const { user } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
    const isPublishedServiceDefinition = type === "Service Definition" && enablePublishing;
    const mvFlow = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map";
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: { "overflow-hidden": loading } }, mvFlow && newItemMode === "url" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "info-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-input-readonly", null))), descriptionInfo && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "info-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { class: "layer-description", header: descriptionInfo.title, content: descriptionInfo.content, scale: "s", contentScale: "m" }))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: this.loaderType, value: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.uploadProgress, active: this.loading, text: this.loaderMessage }), ["file", "url", "dataStore"].includes(newItemMode) && !mvFlow && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "info-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-input-readonly", null))), type === "Geocoding Service" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h5", { class: "locator__heading" }, this.i18n.item), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "locator__description" }, _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.createLayersList[newItemMode === "url" ? "locatorHeading" : "locatorViewHeading"]))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-properties", null, !isPublishedServiceDefinition && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-title-input", { class: "medium", currentFolder: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.folder, type: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type, enablePublishing: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.enablePublishing, update: this.shouldUpdatePreviouslyCreatedItem(), ref: (ele) => (this.titleRef = ele), onArcgisTitleInputChange: () => {
        this.error = null;
      } })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-folder-picker", { class: "medium", ref: (ele) => (this.itemPropertiesFolderRef = ele), onArcgisFolderPickerLoad: ({ detail }) => {
        var _a;
        (_a = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.initialFolders) !== null && _a !== void 0 ? _a : (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.initialFolders = detail);
      } }), !(0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__.n)(user) && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-categories-picker", { class: "medium" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-tags-picker", { class: "medium" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-summary-input", { class: "medium", ref: (ele) => (this.summaryRef = ele) }), type === "Notebook" && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-notebook-runtime-select", { class: "medium" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: title, description: description, active: !!this.error, link: { href: linkInfo === null || linkInfo === void 0 ? void 0 : linkInfo.link, title: linkInfo === null || linkInfo === void 0 ? void 0 : linkInfo.text }, onAlertDismiss: () => (this.error = null) })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "error": ["handleError"]
  }; }
};
ArcgisNewItemPagesItemProperties.style = arcgisNewItemPagesItemPropertiesCss;

const arcgisNewItemPagesPublishSelectCss = ".label{font-weight:500;font-size:0.875rem;color:var(--calcite-ui-text-1);margin-bottom:1rem;padding-top:1rem;display:block;line-height:18px}.label--leader{margin-top:0.75rem;margin-bottom:0.5rem;font-weight:400}.fieldset{margin:0;padding:0;border-style:none}.constrain{max-width:360px}.notice--tip{margin-top:1.5rem}";

const ArcgisNewItemPagesPublishSelect = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.newItemPrevPage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemPrevPage", 7);
    this.newItemToggleNavigationEnabled = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
    this.workflowComplete = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
    this.canSkipPublishSelect = false;
    this.updateSelectedSheet = async ({ currentTarget }) => {
      // TODO: calcite-select currently sets selectedOption to the innerHTML of the first element instead of its value
      const selected = parseInt(currentTarget.selectedOption.value);
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedSheet = isNaN(selected) ? 0 : selected;
      this.newItemToggleNavigationEnabled.emit(false);
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedFields = null;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.analyzeResults = null;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.backupLayerFields = null;
      // For cloud, we also upload the file already at the beginning
      const success = await this.analyze(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.existingItem || _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.cloudProviderResource ? "item" : "file");
      if (!success) {
        // TODO: should we revert the change?
        return;
      }
      this.newItemToggleNavigationEnabled.emit(true);
    };
    this.deleteCurItem = async () => {
      try {
        if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id) {
          this.isDeletingOldFile = true;
          await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.d)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id, { permanentDelete: true });
          _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id = null;
          this.isDeletingOldFile = false;
        }
      }
      catch (error) {
        console.warn("Delete item failed", error);
      }
    };
    this.selected = "hosted";
    this.loading = undefined;
    this.isDeletingOldFile = undefined;
    this.loaderType = "indeterminate";
    this.alertContent = undefined;
    this.tip = undefined;
    this.loaderMessage = undefined;
    this.publishSelectOption = null;
    this.i18n = undefined;
    this.itemInfoI18N = undefined;
    this.duplicateItemUrl = null;
  }
  async handleNext() {
    if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileLayerPublishType === "3dTiles") {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tilesLayer3dTilesLayerType = this.publishSelectOption.tilesLayer3dTilesLayerType;
    }
    const { customParameters, url, type, newItemMode, file } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const isHosted = this.selected === "hosted";
    const mvFlow = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map";
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.enablePublishing = isHosted;
    if (this.isAddToMapTerminalPage()) {
      this.workflowComplete.emit({
        type,
        url: encodeURI(url),
        customParameters
      });
      return;
    }
    if (newItemMode === "url" && type === "CSV" && mvFlow) {
      // Right now we only support this for csv
      const success = await this.analyze("url");
      if (!success) {
        return;
      }
    }
    else {
      if (this.duplicateItemUrl && isHosted) {
        this.handleError({ code: "itemExists", itemUrl: this.duplicateItemUrl });
        return;
      }
      const simpleHostedTypes = [
        "Json",
        "Tile Package",
        "Vector Tile Package",
        "Service Definition",
        "Scene Package",
        "GeoPackage",
        "3DTiles Package",
        // arcgis-portal-app#40929 and arcgis-portal-app#38119
        "GeoJson"
      ];
      const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
      const payload = {
        eventType: "other",
        pageName: "my content",
        category: "new item add csv file"
      };
      if (simpleHostedTypes.indexOf(type) > -1 ||
        // We still want to analyze even if it's add direct
        (!isHosted && !mvFlow)) {
        if (type === "CSV") {
          // Log telemetry for non-hosted csv
          payload.details = "csv only";
          telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
        }
        this.newItemUpdatePage.emit("itemProperties");
        return;
      }
      if (type === "CSV") {
        const success = await this.analyze(!!_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.cloudProviderResource ? "cloud" : file ? "file" : "url");
        if (!success) {
          return;
        }
      }
      // On successful upload, log hosted csv telemetry
      payload.details = "csv and hosted feature layer";
      telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
    }
    this.newItemUpdatePage.emit("fileField");
  }
  async handlePrev(event) {
    event.preventDefault();
    await this.deleteCurItem();
    const { type } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    if (type === "CSV" || type === "Microsoft Excel") {
      // In case the user goes back to the file select page
      //  and select a different file
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedFields = undefined;
    }
    this.newItemPrevPage.emit();
  }
  determineHint(file) {
    if (!(0,_item_types_054054c6_js__WEBPACK_IMPORTED_MODULE_16__.i)(file.size)) {
      return;
    }
    const { i18n } = this;
    const { user, portal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
    const linkText = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.common.learnMore;
    let title;
    let link; // TODO: set link url once we have the help id
    let color = "brand";
    if (!user || (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__.n)(user)) {
      title = i18n.bigGeoJsonHintPublicAccount;
      color = "danger";
    }
    else if (!(0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.a)(user, "GeoJson", portal)) {
      title = i18n.bigGeoJsonHintNoPrivilege;
    }
    else {
      title = i18n.bigGeoJsonHint;
    }
    this.alertContent = { title, linkText, link, color };
  }
  shouldDisableNonHosted() {
    const { file, type } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    return (_ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map" && type === "GeoJson" && file && (0,_item_types_054054c6_js__WEBPACK_IMPORTED_MODULE_16__.i)(file.size));
  }
  updateLoader(loaderType, loaderMessage) {
    this.loaderType = loaderType;
    this.loaderMessage = loaderMessage;
  }
  async connectedCallback() {
    var _a, _b, _c;
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.publishSelect;
    this.itemInfoI18N = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.itemTypeInfo;
    const { type, id, existingItem, newItemMode, cloudProviderResource, file, tileLayerPublishType } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const { user, portal, config: { helpMap, helpBase } } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
    if (user) {
      const { error: backedBySDSError, result: _isPortalBackedBySDS } = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.f)(() => (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.i)(portal, user), "isPortalBackedBySDS", portal.id);
      if (!backedBySDSError) {
        _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isBackedBySDS = _isPortalBackedBySDS;
      }
    }
    const mvFlow = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map";
    const isExcel = type === "Microsoft Excel";
    if (existingItem) {
      const success = await this.analyze("item");
      if (!success) {
        return;
      }
      if (type === "CSV" ||
        (isExcel && ((_a = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.analyzeResults.publishParameters.layers) === null || _a === void 0 ? void 0 : _a.length) === 1)) {
        this.newItemUpdatePage.emit("fileField");
        return;
      }
    }
    // Analyze to get Excel sheet info
    if (isExcel && !(0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__.n)(user) && !existingItem) {
      if (!id) {
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedSheet = 0;
        await this.analyze(cloudProviderResource ? "cloud" : "file");
      }
      else {
        await this.analyze("item");
      }
    }
    if (mvFlow) {
      this.selected =
        (newItemMode === "url" || !(0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.a)(user, type, portal)) &&
          !this.shouldDisableNonHosted()
          ? "non-hosted"
          : "hosted";
      if (this.isAddToMapTerminalPage()) {
        _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.nextText = "addToMap";
      }
    }
    // Add to MV: Manage upload here when adding file directly
    this.canSkipPublishSelect = canSkipPublishSelectToNextPage({
      directMode: mvFlow,
      isMultipageExcel: isExcel && ((_b = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.excelLayers) === null || _b === void 0 ? void 0 : _b.length) > 1,
      newItemMode,
      cloud: !!cloudProviderResource,
      fromExistingItem: !!existingItem,
      itemType: type,
      canPublishItemType: (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.a)(user, type, portal)
    });
    if (this.canSkipPublishSelect) {
      if (newItemMode === "url") {
        // Only adding from URL can be added directly
        //  since from-file flows relies on the published item id
        this.selected = "non-hosted";
      }
      this.handleNext();
    }
    if (!(0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__.o)(portal) || !user) {
      this.selected = "non-hosted";
    }
    if (type === "Scene Package" && !(0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.h)(user)) {
      this.selected = "non-hosted";
      this.handleNext();
    }
    if (type === "GeoJson" && _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map") {
      if (!!file) {
        this.determineHint(file);
      }
      else if (!!_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.url) {
        this.tip = {
          title: this.i18n.largeGeoJsonConditionDescription,
          linkText: _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.common.learnMore,
          link: `${helpBase}${helpMap["120003923"]}`
        };
      }
    }
    if (tileLayerPublishType === "3dTiles") {
      this.publishSelectOption = {
        tileLayerPublishType,
        tilesLayer3dTilesLayerType: (_c = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tilesLayer3dTilesLayerType) !== null && _c !== void 0 ? _c : _tile_layer_90a6b901_js__WEBPACK_IMPORTED_MODULE_9__.D
      };
    }
  }
  isAddToMapTerminalPage() {
    const { selected } = this;
    const { newItemMode, type } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    return (_ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map" &&
      newItemMode === "url" &&
      type === "GeoJson" &&
      selected === "non-hosted");
  }
  async analyze(analyzeType, forceCreateItem = false) {
    var _a;
    const { fileName, file, url, dataUrl, id: itemid, extension, type } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const { portal, user, config, lang } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
    this.updateLoader("indeterminate", this.i18n.analyze.replace("${fileName}", fileName.length > 0 ? fileName : url));
    this.loading = true;
    const fromCloud = analyzeType === "cloud";
    let error = null;
    if (fromCloud || (type === "CSV" && file && (0,_item_types_054054c6_js__WEBPACK_IMPORTED_MODULE_16__.a)(file.size)) || forceCreateItem) {
      const existingItemUrl = await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_15__.h)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.fileName, (_a = (0,_item_types_054054c6_js__WEBPACK_IMPORTED_MODULE_16__.f)(extension)[0]) === null || _a === void 0 ? void 0 : _a.type);
      if (existingItemUrl) {
        this.handleError({ code: "itemExists", itemUrl: existingItemUrl });
        this.loading = false;
        return false;
      }
      // ! This is a work around since analyze doesn't work with sourceUrl for cloud items yet
      // Also analyze will timeout for big csv https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2875
      if (!_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id) {
        const newName = (0,_guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_22__.g)();
        if ((file === null || file === void 0 ? void 0 : file.size) > _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.M) {
          this.updateLoader("determinate", this.i18n.uploading.replace("${item}", fileName));
        }
        const addResponse = await (fromCloud ? _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.l : _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.e)({
          title: newName,
          filename: newName
        });
        this.updateLoader("indeterminate", this.i18n.analyze.replace("${fileName}", fileName.length > 0 ? fileName : url));
        try {
          await (0,_publish_item_82ffa7f8_js__WEBPACK_IMPORTED_MODULE_27__.c)(addResponse);
        }
        catch (e) {
          this.handleError({ code: "unhandledError" });
          this.loading = false;
          return false;
        }
        const itemid = addResponse.id;
        ({ error } = await (0,_analyze_a3711367_js__WEBPACK_IMPORTED_MODULE_30__.a)({
          analyzeArgs: { type: "item", itemid },
          configArgs: { portal, user, config, lang },
          itemArgs: { itemType: type },
          initialize: true
        }));
        // We don't delete in case the user go back and forth
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.id = itemid;
      }
    }
    else {
      ({ error } = await (0,_analyze_a3711367_js__WEBPACK_IMPORTED_MODULE_30__.a)({
        analyzeArgs: analyzeType === "url"
          ? { type: "url", sourceUrl: url !== null && url !== void 0 ? url : dataUrl }
          : analyzeType === "file"
            ? { type: "file", file }
            : { type: "item", itemid },
        configArgs: { portal, user, config, lang },
        itemArgs: { itemType: type },
        initialize: true
      }));
      if ((error === null || error === void 0 ? void 0 : error.code) === "timeout") {
        // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2875
        return this.analyze(analyzeType, true);
      }
    }
    this.loading = false;
    if (error) {
      this.handleError(error);
    }
    return !error;
  }
  handleError(error) {
    const { i18n } = this;
    this.duplicateItemUrl = null;
    this.alertContent = null;
    switch (error.code) {
      case "itemExists":
        this.duplicateItemUrl = error.itemUrl;
        const fileName = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.fileName;
        this.alertContent = {
          title: i18n.error.alreadyExists.title,
          description: i18n.error.alreadyExists.desciption.replace("${fileName}", fileName),
          link: error.itemUrl,
          linkText: i18n.error.alreadyExists.linkText
        };
        break;
      case "emptyFile":
        this.alertContent = { title: i18n.error.title, description: i18n.error.emptyFile };
        break;
      case "duplicateFieldNames":
        this.alertContent = i18n.error.duplicateFields;
        break;
      default:
        this.alertContent = i18n.error;
        break;
    }
  }
  getDisplayType(type, extension) {
    var _a, _b, _c;
    let i18nKey = type;
    if (((_a = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.cloudProviderResource) === null || _a === void 0 ? void 0 : _a.mimeType) === "googlesheets") {
      i18nKey = "Google Sheets";
    }
    else if (extension === "json") {
      i18nKey = "JSON";
    }
    return (_c = (_b = this.itemInfoI18N.lowercaseDisplayName[i18nKey]) !== null && _b !== void 0 ? _b : i18nKey) !== null && _c !== void 0 ? _c : "";
  }
  getOptionText(radio, displayName) {
    const isHosted = radio === "hosted";
    const { i18n, itemInfoI18N } = this;
    const { dataUrl, fileName, type } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const mvFlow = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map";
    if (mvFlow) {
      return isHosted
        ? { title: i18n.hostedMVTitle, description: i18n.hostedMVDescription }
        : {
          title: dataUrl ? i18n.addDirectlyUrlTitle : i18n.addDirectlyTitle,
          description: dataUrl ? i18n.addDirectlyUrlDescription : i18n.addDirectlyDescription
        };
    }
    if (displayName === "GeoJSON" && !!dataUrl) {
      return i18n.geoJSONFromURL[isHosted ? "hosted" : "nonHosted"];
    }
    const title = (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(isHosted
      ? i18n.hostedTitle[mvFlow && type === "CSV" ? "CSVNoTable" : displayName] ||
        i18n.hostedTitle[type]
      : itemInfoI18N.nonHostedTitle, fileName, "fileName");
    const description = (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(isHosted
      ? // TODO: fix casing in the "tile package" and "vector tile package" hosted description keys in the i18n file after string freeze is lifted
        // WebGIS/arcgis-portal-app#39867
        i18n.hostedDescription[displayName] ||
          i18n.hostedDescription[displayName.toLowerCase()] ||
          i18n.hostedDescription[type] ||
          i18n.hostedDescription[type.toLowerCase()]
      : itemInfoI18N.nonHostedDescription, displayName, "fileType");
    return { title, description };
  }
  renderOption(radio, displayName) {
    const { title, description } = this.getOptionText(radio, displayName);
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { checked: radio === this.selected, onCalciteTileSelectChange: (e) => {
        this.selected = e.target.value;
        _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.nextText = this.isAddToMapTerminalPage() ? "addToMap" : "next";
      }, description: description, heading: title, name: description, "input-enabled": true, "input-alignment": "start", type: "radio", value: radio, width: "full", id: `${radio}-input-option`, disabled: radio === "non-hosted" && this.shouldDisableNonHosted() }));
  }
  renderSheetSelect() {
    var _a;
    const { excelLayers } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    if (!excelLayers || excelLayers.length === 1) {
      return null;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label label--leader" }, this.i18n.publishThisSheet), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "", onCalciteSelectChange: this.updateSelectedSheet.bind(this), value: (_a = String(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedSheet)) !== null && _a !== void 0 ? _a : "0", class: "constrain" }, excelLayers.map((layer, i) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: i, selected: i === _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedSheet }, layer.name))))));
  }
  render3dTilesSelect() {
    const { i18n, publishSelectOption } = this;
    if ((publishSelectOption === null || publishSelectOption === void 0 ? void 0 : publishSelectOption.tileLayerPublishType) !== "3dTiles") {
      return null;
    }
    const { tilesLayer3dTilesLayerType } = publishSelectOption;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label label--leader" }, i18n["3dTiles"].layerType), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "", onCalciteSelectChange: ({ currentTarget }) => {
        const selected = currentTarget.selectedOption
          .value;
        publishSelectOption.tilesLayer3dTilesLayerType = selected;
      }, value: publishSelectOption.tilesLayer3dTilesLayerType, class: "constrain" }, _tile_layer_90a6b901_js__WEBPACK_IMPORTED_MODULE_9__.t.map((layerType) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: layerType, selected: layerType === tilesLayer3dTilesLayerType }, layerType === "3DObject" ? "3D Objects" : "Integrated Mesh"))))));
  }
  render() {
    const { extension, type, existingItem } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const { portal, user } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
    const displayName = this.getDisplayType(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type, extension);
    const { loaderType, itemInfoI18N, loading, loaderMessage, selected, alertContent, isDeletingOldFile, tip, canSkipPublishSelect } = this;
    const mvFlow = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map";
    // Add to MV: hide hosted select if item is being added directly
    const canPublishGeoJson = type === "GeoJson" && (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.a)(user, "GeoJson", portal);
    // CSV has X Y
    const canPublishCSV = type === "CSV" && (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.a)(user, "CSV", portal);
    const showPublishOptions = !existingItem && (!mvFlow || (!canSkipPublishSelect && (canPublishGeoJson || canPublishCSV)));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: loaderType, value: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.uploadProgress, active: loading, text: loaderMessage }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: "indeterminate", active: isDeletingOldFile }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-input-readonly", null), showPublishOptions && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("fieldset", { class: "fieldset" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("legend", { class: "label" }, itemInfoI18N.howToAdd), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", { layout: "vertical" }, ["hosted", "non-hosted"]
      .filter((option) => (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__.o)(portal) || option !== "hosted")
      .map((radio) => this.renderOption(radio, displayName))))), type === "Microsoft Excel" &&
      selected === "hosted" &&
      _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow !== "append" &&
      this.renderSheetSelect(), this.render3dTilesSelect(), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { open: !!tip, class: "notice--tip", icon: true, scale: "s" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, tip === null || tip === void 0 ? void 0 : tip.title), (tip === null || tip === void 0 ? void 0 : tip.description) && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, tip === null || tip === void 0 ? void 0 : tip.description), (tip === null || tip === void 0 ? void 0 : tip.link) && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { slot: "link", href: tip === null || tip === void 0 ? void 0 : tip.link, target: "_blank" }, tip === null || tip === void 0 ? void 0 : tip.linkText))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: alertContent === null || alertContent === void 0 ? void 0 : alertContent.title, description: alertContent === null || alertContent === void 0 ? void 0 : alertContent.description, link: { href: alertContent === null || alertContent === void 0 ? void 0 : alertContent.link, title: alertContent === null || alertContent === void 0 ? void 0 : alertContent.linkText }, active: !!alertContent, onAlertDismiss: () => (this.alertContent = null), scale: "s" })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesPublishSelect.style = arcgisNewItemPagesPublishSelectCss;

const arcgisNewItemPagesSingleLayerSelectCss = ".outer-container{display:flex;flex-direction:column}.layer-container{overflow:auto;overflow-x:hidden;box-sizing:border-box;display:flex;max-height:212px;height:30vh;border:1px solid var(--calcite-ui-border-1);border-top:0;width:100%}calcite-radio-button-group{width:100%}.layer-item{padding:12px 12px 0}.layer-notice{margin-bottom:1.5rem}.layer-input-message{font-weight:400;color:var(--calcite-ui-text-3);font-size:0.875rem}.layer-not-found-message{font-weight:500;font-size:0.875rem;color:var(--calcite-ui-text-2);text-align:center;width:100%;margin-top:1.5rem}.selected{background-color:rgba(0, 121, 193, 0.05)}.select-container{display:flex;justify-content:space-between;margin-top:1.5rem}.select-item{width:45%}.select-item-message{font-weight:500;font-size:0.875rem;margin-bottom:0.25rem}";

const ArcgisNewItemPagesSingleLayerSelect = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.workflowComplete = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
    // TODO: Keep serviceInfo unmodified - can be hard to follow what came back from the response vs what was added/changed after
    this.selectWMTSLayer = (selectedLayer) => {
      var _a;
      const { serviceInfo } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
      serviceInfo.selectedLayer = selectedLayer;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.serviceInfo = serviceInfo;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedLayer = selectedLayer;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileMatrices =
        _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.api === 4
          ? selectedLayer.tileMatrixSets.toArray()
          : selectedLayer.tileMatrixSetInfos;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedTileInfo = (_a = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.tileMatrices) === null || _a === void 0 ? void 0 : _a[0];
      _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title = selectedLayer.title;
    };
    this.selectWFSLayer = async (layer) => {
      const { serviceInfo, maxFeatures } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
      const { name, extent, title } = layer;
      const wfsLayerOptions = {
        layerName: name,
        mode: "snapshot",
        title: title || name,
        fullExtent: extent,
        maxFeatures: maxFeatures || 3000
      };
      if (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.api === 3) {
        // when calling select layer from `WFSLayer` this will actually update serviceInfo, so we need to setServiceInfo everytime after we call selectLayer here.
        await serviceInfo.selectLayer(wfsLayerOptions, () => {
          serviceInfo.selectedLayer = wfsLayerOptions;
          const isComplex = serviceInfo.geometryType === "esriGeometryComplex";
          serviceInfo.isComplex = isComplex;
          const url = serviceInfo.url.trim();
          _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.isComplex = isComplex;
          _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.serviceInfo = serviceInfo;
          _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedLayer = wfsLayerOptions;
          _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.url = url;
          _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title = wfsLayerOptions.title;
        });
      }
      else {
        serviceInfo.layerName = name;
        serviceInfo.maxFeatures = wfsLayerOptions.maxFeatures;
        // Previously we call `serviceInfo.selectLayer` in v3 and these are the callback
        serviceInfo.selectedLayer = wfsLayerOptions;
        const isComplex = serviceInfo.geometryType === "esriGeometryComplex";
        serviceInfo.isComplex = isComplex;
        const url = serviceInfo.url.trim();
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.isComplex = isComplex;
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.serviceInfo = serviceInfo;
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedLayer = wfsLayerOptions;
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.url = url;
        _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title = serviceInfo.title;
      }
    };
    this.handleSearchUpdate = (event) => {
      const layers = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.layers.filter((layer) => !event.detail || layer.title.toLowerCase().indexOf(event.detail) > -1);
      this.filteredLayers = layers;
    };
    this.handleTileChange = () => {
      const name = this.getSelectOption(this.tileSelectRef);
      const selectedTileInfo = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.tileMatrices.find((tileInfo) => tileInfo[_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.api === 4 ? "id" : "tileMatrixSet"] === name);
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedTileInfo = selectedTileInfo;
    };
    this.handleMaxFeatureChange = (event) => {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.maxFeatures = parseInt(event.target.value);
    };
    this.handleGeometryChange = () => {
      this.selectedGeometry = this.getSelectOption(this.geometrySelectRef);
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.geometryType = this.selectedGeometry;
    };
    this.renderSelectMenus = () => {
      const { type, maxFeatures, tileMatrices, isComplex } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b;
      const { i18n, handleGeometryChange, handleMaxFeatureChange, handleTileChange } = this;
      if (type === "WFS") {
        return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "select-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "select-item" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", { class: "select-item-message" }, i18n.maxFeature), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { onCalciteInputInput: handleMaxFeatureChange, value: `${maxFeatures}`, "number-button-type": "vertical", min: 0,
          // width="auto" // TODO: No direct conversion - maybe style it from the outside
          type: "number" })), isComplex && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "select-item" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", { class: "select-item-message" }, i18n.featureType), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "", class: "select-geometry", onCalciteSelectChange: handleGeometryChange, ref: (el) => (this.geometrySelectRef = el) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { selected: this.selectedGeometry === "default", disabled: true, value: "default", label: i18n.selectGeometry }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "esriGeometryPoint", label: i18n.points }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "esriGeometryPolyline", label: i18n.lines }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "esriGeometryPolygon", label: i18n.polygons }))))));
      }
      else if ((tileMatrices === null || tileMatrices === void 0 ? void 0 : tileMatrices.length) > 1) {
        return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "select-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "select-item" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", { class: "select-item-message" }, i18n.selectTile), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "", onCalciteSelectChange: handleTileChange, ref: (el) => (this.tileSelectRef = el) }, tileMatrices.map((tile) => {
          const value = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.api === 3 ? tile.tileMatrixSet : tile.id;
          return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: value, label: value });
        })))));
      }
    };
    this.managedFocus = true;
    this.selectedLayer = undefined;
    this.selectedGeometry = "default";
    this.filteredLayers = undefined;
    this.errorMessage = "";
    this.i18n = undefined;
  }
  onTransitionComplete() {
    var _a;
    (_a = this.layerSearchRef) === null || _a === void 0 ? void 0 : _a.focusMainInput();
  }
  async handleNext() {
    const { isComplex } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b;
    if (isComplex && this.selectedGeometry === "default") {
      this.errorMessage = this.i18n.selectGeometryError;
      this.geometrySelectRef.setFocus();
      return;
    }
    const { type } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    if (type === "WFS") {
      await this.selectWFSLayer(this.selectedLayer);
    }
    if (this.isAddToMapTerminalPage()) {
      this.workflowComplete.emit({
        type: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type,
        url: encodeURI(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.url),
        customParameters: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.customParameters,
        layers: [this.selectedLayer],
        addAsBasemap: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.addAsBasemap
      });
    }
    else {
      this.newItemUpdatePage.emit("itemProperties");
    }
  }
  async handleLayerChange(name) {
    if (!name) {
      return;
    }
    // TODO: return new layer from select____Layer, write to store here
    if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.type === "WMTS") {
      const selectedLayer = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.layers.find((layer) => (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.api === 3 ? layer.identifier : layer.id) === name);
      this.selectedLayer = selectedLayer;
      this.selectWMTSLayer(selectedLayer);
    }
    else if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.type === "WFS") {
      const selectedLayer = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.layers.find((layer) => layer.name === name);
      await this.selectWFSLayer(selectedLayer);
      this.selectedLayer = selectedLayer;
      this.selectedGeometry = "default";
    }
    else {
      const selectedLayer = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.layers.find((layer) => layer.title === name);
      this.selectedLayer = selectedLayer;
      // trouble with the typing here
      (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.m)(selectedLayer);
    }
  }
  isAddToMapTerminalPage() {
    return _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map";
  }
  async componentWillLoad() {
    const i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n;
    this.i18n = i18n.singleLayerSelect;
    if (this.isAddToMapTerminalPage()) {
      _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.nextText = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.addAsBasemap ? "useAsBaseMap" : "addToMap";
    }
    if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.type === "WFS") {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.maxFeatures = 3000;
      await this.selectWFSLayer(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.serviceInfo.layers[0]);
    }
    if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.type === "WMTS") {
      this.selectWMTSLayer(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.serviceInfo.layers[0]);
    }
    this.filteredLayers = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.layers;
    const isOGCFeature = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.type === "OGCFeatureServer";
    const layerValue = isOGCFeature
      ? "title"
      : _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.type === "WFS"
        ? "layerName"
        : "identifier";
    this.selectedLayer =
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.layers.find((layer) => { var _a; return layer[isOGCFeature ? "title" : " name"] === ((_a = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.selectedLayer) === null || _a === void 0 ? void 0 : _a[layerValue]); }) || _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.layers[0];
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.selectedLayer = this.selectedLayer;
  }
  getSelectOption(select) {
    const option = select === null || select === void 0 ? void 0 : select.querySelector("calcite-option[selected]");
    return option === null || option === void 0 ? void 0 : option.value;
  }
  render() {
    var _a;
    const { renderSelectMenus, i18n, selectedLayer } = this;
    const isWMTS = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.type === "WMTS";
    const isOGCFeature = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.b.type === "OGCFeatureServer";
    const layerValue = isOGCFeature
      ? "title"
      : isWMTS
        ? _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.api === 3
          ? "identifier"
          : "id"
        : "name";
    const LIMIT_AMOUNT = 1000;
    const usePro = this.filteredLayers.length >= LIMIT_AMOUNT;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "outer-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { class: "layer-notice", icon: "information", open: usePro, width: "full" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { slot: "message" }, i18n.usePro)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", { class: "select-item-message" }, i18n.selectLayer), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-layer-search", { searchLabel: "layers", onSearchUpdate: this.handleSearchUpdate, ref: (ele) => (this.layerSearchRef = ele) }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "layer-container" }, this.filteredLayers.length === 0 ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", { class: "layer-not-found-message" }, i18n.noLayersFound)) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button-group", { name: "layer-select", role: "radiogroup", layout: "vertical", onCalciteRadioButtonGroupChange: (event) => this.handleLayerChange(event.target.selectedItem.value) }, (_a = this.filteredLayers) === null || _a === void 0 ? void 0 : _a.slice(0, LIMIT_AMOUNT).map((layer) => {
      const value = layer[layerValue];
      const label = layer.title;
      let isSelected = false;
      // for some OGC Servers, the title may be duplicated in the data set so you have to also check the id as well (for what I was testing - the id couldnt be used as a value because it had special characters and couldnt be used as a selector in `querySelector`)
      if (value === selectedLayer[layerValue]) {
        if (isOGCFeature) {
          isSelected = layer.id === selectedLayer.id;
        }
        else {
          isSelected = true;
        }
      }
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline", for: value, class: {
          "layer-item": true,
          selected: isSelected
        } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button", { class: "radio", checked: isSelected, id: value, name: value, value: value }), label || value));
    }))))), renderSelectMenus(), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { active: !!this.errorMessage, description: this.errorMessage, onAlertDismiss: () => (this.errorMessage = "") })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesSingleLayerSelect.style = arcgisNewItemPagesSingleLayerSelectCss;

/**
 * Custom Paramters can be used for any OGC or AGS service. For WMS,
 * WFS and WMTS they will be added to the constructor from the JSAPI when
 * creating the layer, for everything else it will be added temporarily
 * to the URL when retreiving service info.
 * For all urls with custom paramters, it will be added to the items
 *  metadata using the text attribute.
 */
async function handleCustomParameterUpdate(serviceInfo, type, _customParameters) {
  const { customParameters, customLayerParameters } = (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.n)(_customParameters);
  switch (type) {
    case "WMS":
    case "WMTS":
      await (serviceInfo === null || serviceInfo === void 0 ? void 0 : serviceInfo.setCustomParameters(customParameters || {}, customLayerParameters || {}));
      break;
    case "WFS":
      await (serviceInfo === null || serviceInfo === void 0 ? void 0 : serviceInfo.setCustomParameters(customParameters || {}));
      break;
  }
}

const isKeyAllowedInUrlLocalState = (key) => [
  "url",
  "type",
  "newItemMode",
  "serviceInfo",
  "isSecured",
  "allowStoredAuth",
  "storeAuth",
  "hybridImageServiceSetting",
  "addAsBasemap",
  "dataUrl",
  "fileName",
  "geoJSONResource",
  "title",
  "tags",
  "snippet"
].includes(key);

const arcgisNewItemPagesUrlTypeCss = ".label{font-weight:500;font-size:0.875rem;color:var(--calcite-ui-text-1);margin-bottom:1rem;padding-top:1rem;display:block;line-height:18px}.fieldset{margin:0;margin-bottom:1.5rem;padding:0;border-style:none}.info-header{font-weight:500;font-size:0.875rem;color:var(--calcite-ui-text-1);margin:0;margin-bottom:0.5rem;padding:0}.info-header--leader{margin-top:1rem}.info-description{font-weight:400;font-size:0.75rem;color:var(--calcite-ui-text-1);margin:0;padding:0}.custom-param-container{margin-bottom:1.5rem}:host{overflow-x:hidden}";

const ArcgisNewItemPagesUrlType = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.newItemToggleNavigationEnabled = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
    this.workflowComplete = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
    var _a;
    this.addDirectToMap = false;
    this.urlOptions = [
      { value: "AGS", icon: "server", show: true },
      { value: "Document Link", icon: "file-code", show: !(0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__.n)(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user) },
      { value: "GeoJson", icon: "brackets-curly", show: true },
      { value: "KML", icon: "layer-kml", show: true },
      { value: "OGCFeatureServer", icon: "feature-layer", show: true },
      { value: "WFS", icon: "feature-layer", show: true },
      { value: "WMS", icon: "layer-map", show: true },
      { value: "WMTS", icon: "tile-layer", show: true },
      { value: "GeoRSS", icon: "file-text", show: _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map" },
      {
        value: "CSV",
        icon: "file-csv",
        show: _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map" || !((_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) === null || _a === void 0 ? void 0 : _a.isPortal)
      },
      { value: "Tile Layer", icon: "tile-layer", show: _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map" }
    ];
    this.setServiceInfoState = (properties) => {
      Object.keys(properties).forEach((key) => {
        const value = properties[key];
        if (isKeyAllowedInUrlLocalState(key)) {
          // TODO: Remove any cast once incoming properties are trimmed down to urlData
          this.urlData[key] = value;
        }
        else {
          // TODO: Decide if all possible service info properties (thumbnail, extent, layers, etc.) should be part of urlData
          // If not, consider holding this as a temporary local object until the rest of the store assignments
          // @ts-ignore
          _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a[key] = value;
        }
      });
    };
    this.isAddToMapTerminalPage = () => {
      var _a;
      const { selectedOption, urlData: { url, serviceInfo }, addDirectToMap } = this;
      return (addDirectToMap &&
        (((0,_ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_31__.i)(this.urlData.type) && !this.urlData.storeAuth && serviceInfo) ||
          (0,_url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_23__.s)(selectedOption)) &&
        !(0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.i)(url, serviceInfo) &&
        (!["WMS", "WFS", "WMTS", "CSV", "GeoJson", "OGCFeatureServer"].includes(selectedOption) ||
          (0,_ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_31__.i)(this.urlData.type) ||
          (selectedOption === "GeoJson" && !_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user) ||
          (((_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) === null || _a === void 0 ? void 0 : _a.isPortal) && ["CSV", "GeoJson"].includes(selectedOption))));
    };
    this.determineNextText = () => {
      const { urlData, isAddToMapTerminalPage, showAddToMap } = this;
      _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.nextText = "next";
      if (isAddToMapTerminalPage()) {
        _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.nextText = "addToMap";
        if (showAddToMap() && urlData.addAsBasemap) {
          _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.nextText = "useAsBaseMap";
        }
      }
    };
    this.showAddToMap = () => {
      const { urlData, addDirectToMap } = this;
      const { url = "", serviceInfo } = urlData;
      const addToMapType = [
        "Tile Layer",
        "WMS",
        "WMTS",
        "Vector Tile Service",
        "Image Service",
        "Map Service"
      ];
      return (addDirectToMap &&
        (addToMapType.includes(urlData.type) || (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.i)(url, serviceInfo)));
    };
    this.handleAuthSwitchChange = (event) => {
      this.urlData.storeAuth = event.detail;
    };
    this.handleLoaderUpdate = (event) => {
      this.loading = event.detail;
    };
    this.resetError = () => {
      this.error = false;
      this.errorMessage = "";
    };
    this.open = false;
    this.selectedOption = null;
    this.previousSelectedOption = null;
    this.i18n = undefined;
    this.error = false;
    this.errorMessage = undefined;
    this.loading = false;
    this.loaderText = undefined;
    this.urlData = {};
  }
  async handleNext() {
    var _a, _b;
    const { urlData, selectedOption, itemUrlRef, i18n, selectRef } = this;
    const { customParameters } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const urlErrorMessage = await (itemUrlRef === null || itemUrlRef === void 0 ? void 0 : itemUrlRef.validateInput());
    if (urlErrorMessage) {
      // We already show error inline
      itemUrlRef.focusMainInput();
      return;
    }
    // Cancel next if url is not yet analyzed
    if (this.loading) {
      return;
    }
    if (!selectedOption) {
      selectRef.setFocus();
      this.errorMessage = i18n.undetected;
      this.error = true;
      return;
    }
    this.loading = true;
    const success = await this.handlePageTransition();
    this.loading = false;
    if (success) {
      if ((0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.i)(urlData.url, (_a = this.urlData) === null || _a === void 0 ? void 0 : _a.serviceInfo)) {
        this.assignStoreState();
        this.newItemUpdatePage.emit(this.urlData.storeAuth ? "auth" : "hybridImageSelect");
        return;
      }
      if (this.isAddToMapTerminalPage()) {
        this.loading = true;
        // Only redirect if no more actions are needed
        this.workflowComplete.emit({
          type: urlData.type,
          url: encodeURI(urlData.url),
          customParameters,
          addAsBasemap: (_b = this.urlData.addAsBasemap) !== null && _b !== void 0 ? _b : false
        });
        this.loading = false;
      }
      this.setNextPage();
      this.assignStoreState();
      this.newItemUpdatePage.emit(this.nextPage);
    }
    else {
      this.itemUrlRef.focusMainInput();
      this.error = true;
    }
  }
  assignStoreState() {
    const { url, type, allowStoredAuth, storeAuth, title, tags, snippet, serviceInfo, isSecured, addAsBasemap } = this.urlData;
    const selectedOption = this.selectedOption;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.url = url;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.storeAuth = storeAuth;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type = type;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.allowStoredAuth = allowStoredAuth;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = "url";
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.serviceInfo = serviceInfo;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.isSecured = isSecured;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.addAsBasemap = addAsBasemap !== null && addAsBasemap !== void 0 ? addAsBasemap : false;
    const parts = url.split("/");
    const fileName = parts[parts.length - 1];
    if (selectedOption === "GeoJson" && url) {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.dataUrl = url;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.title = fileName.replace(_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__.q, "").replace(_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__.s, "");
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.fileName = fileName;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.extension = "json";
      if (_ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow !== "map") {
        _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = "file";
      }
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.geoJSONResource = {
        fileName,
        url,
        mimeType: "geojson"
      };
    }
    if (selectedOption === "CSV") {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type = "CSV";
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.dataUrl = url;
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.fileName = (0,_url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_23__.u)(url);
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.extension = "csv";
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.csvResource = {
        fileName,
        url,
        mimeType: "csv"
      };
    }
    title && (_item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title = title.replace(_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__.s, ""));
    tags && (_item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.tags = tags);
    snippet && (_item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.snippet = snippet);
  }
  async componentWillLoad() {
    var _a;
    const { type, url, serviceInfo, isSecured, allowStoredAuth, storeAuth, addAsBasemap, title } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    this.urlData = {
      url,
      type,
      allowStoredAuth,
      storeAuth,
      serviceInfo,
      isSecured,
      addAsBasemap,
      title
    };
    this.changeOption((_a = type) !== null && _a !== void 0 ? _a : null);
    this.addDirectToMap = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map";
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.urlType;
    this.loaderText = this.i18n.getServiceInfo;
    if (!!_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes) {
      this.urlOptions = this.urlOptions.filter((option) => {
        var _a, _b;
        return option.value === "AGS"
          ? (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes) === null || _a === void 0 ? void 0 : _a.some((type) => (0,_ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_31__.i)(type))
          : (_b = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes) === null || _b === void 0 ? void 0 : _b.includes(option.value);
      });
      this.allowedItemTypes = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes.filter((itemType) => !_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal || _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow === "map" || "CSV" !== itemType);
    }
    this.options = this.urlOptions
      .filter(({ show }) => show)
      .map(({ value, icon }) => {
      const entry = typeof value !== "string" ? "AGS" : value;
      return {
        optionTitle: this.i18n[entry].title,
        value: entry,
        description: this.i18n[entry].description,
        icon
      };
    });
    // Since we re-assign store state on next anyway,
    // these should be safe to be reset to avoid dangling data
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.dataUrl = null;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.fileName = null;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.geoJSONResource = null;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.csvResource = null;
  }
  async getServiceInfo(checkAuth) {
    var _a;
    const { url, type, storeAuth } = this.urlData;
    const { error, result } = await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_10__.o)({
      url,
      customParameters: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.customParameters,
      type,
      checkAuth,
      storeAuth
    });
    if (error || !result) {
      this.error = true;
      if ((error === null || error === void 0 ? void 0 : error.message) === "does not point to a GIS server") {
        this.errorMessage = this.i18n.serviceNotGIS;
      }
      else if ((_a = error === null || error === void 0 ? void 0 : error.message) === null || _a === void 0 ? void 0 : _a.includes("doesn't support GeoJSON output")) {
        this.errorMessage = this.i18n.unsupportedWFSGeoJSONOutputFormat;
      }
      else {
        switch (error === null || error === void 0 ? void 0 : error.code) {
          case "serviceNotExist":
            this.errorMessage = this.i18n.serviceNotExist;
            break;
          case "unauthorized":
            this.errorMessage = "Unauthorized"; // TODO: Get proper error messaging, then localize
            break;
          case "unsupportedWFSVersion":
            this.errorMessage = this.i18n.unsupportedWFSVersion;
            break;
          case "invalidWMTS":
            this.errorMessage = this.i18n.invalidWMTS;
            break;
          case "invalidSpatialRef":
            this.errorMessage = this.i18n.invalidSpatialRef;
            break;
          case "emptyFeatureLayer":
            this.errorMessage = this.i18n.emptyFeatureLayer;
            break;
          default:
            this.errorMessage = this.i18n[error === null || error === void 0 ? void 0 : error.code] || this.i18n.serviceNotExist;
        }
      }
      return;
    }
    return result;
  }
  handleLoadChange(_oldValue, newValue) {
    this.newItemToggleNavigationEnabled.emit(newValue);
  }
  changeOption(type) {
    this.previousSelectedOption = this.selectedOption;
    this.selectedOption = (0,_ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_31__.i)(type) ? "AGS" : type;
    this.urlData.type = type;
    // Log telemetry event if option is manually changed to a different type
    if (this.previousSelectedOption !== this.selectedOption) {
      this.logChangeOptionEvent();
    }
    this.determineNextText();
  }
  async detectType(url) {
    if (url) {
      const { isPortal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal;
      const { result: type } = (0,_url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_23__.g)(url, isPortal);
      return type;
    }
    return this.urlData.type;
  }
  async handleNewUrl(args) {
    const { url } = args;
    this.loading = true;
    this.resetError();
    if (this.urlData.url !== url) {
      this.resetUrlData();
      this.resetServiceInfo();
      const detectedType = await this.detectType(url);
      this.urlData.url = url;
      this.urlData.type = detectedType;
      if ((0,_ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_31__.i)(detectedType)) {
        const serviceInfo = await this.getServiceInfo(false);
        serviceInfo && this.setServiceInfoState(serviceInfo);
      }
      this.changeOption(detectedType);
    }
    this.loading = false;
  }
  resetUrlData() {
    const { urlData } = this;
    urlData.url = null;
    urlData.type = null;
    urlData.isSecured = null;
    urlData.storeAuth = null;
    urlData.allowStoredAuth = null;
    urlData.serviceInfo = null;
    urlData.title = null;
    urlData.tags = null;
    urlData.snippet = null;
  }
  // Prevent stale service info from persisting on url change
  resetServiceInfo() {
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.agsType = null;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.description = null;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.extent = null;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.thumbnailToken = null;
  }
  async handlePageTransition() {
    const { urlData } = this;
    // TODO: refactor this once we remove the side-effect from `custom-parameters`
    const { customParameters } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    if (this.selectedOption === "Document Link") {
      return true;
    }
    const checkAuth = !!urlData.isSecured;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.checkAuth = checkAuth;
    // ! For AGS case, `getServiceInfo` is already called once.
    // TODO: So refactor once we can get the sign in popup to show up easier
    const serviceInfo = await this.getServiceInfo(checkAuth);
    serviceInfo && this.setServiceInfoState(serviceInfo);
    if (customParameters.length > 0 && _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.api === 3) {
      // `serviceInfo.customParameters` is already set after we fetch service info
      //  and setCustomParameters doesn't exist for v4
      await handleCustomParameterUpdate(urlData.serviceInfo, urlData.type, customParameters);
    }
    return !!serviceInfo;
  }
  /**
   * Telemetry handling for when an option is manually changed
   */
  logChangeOptionEvent() {
    const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
    const payload = {
      eventType: "other",
      pageName: "my content",
      category: "new item url type change",
      details: this.urlData.url,
      label: `${this.previousSelectedOption}, ${this.selectedOption}`
    };
    telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
  }
  setNextPage() {
    const { selectedOption, addDirectToMap } = this;
    let nextPage;
    if ((0,_ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_31__.i)(this.urlData.type)) {
      nextPage = this.urlData.storeAuth ? "auth" : "itemProperties";
    }
    else {
      switch (selectedOption) {
        case "WMS":
          nextPage = "bulkLayerSelect";
          break;
        case "WFS":
        case "WMTS":
          nextPage = "singleLayerSelect";
          break;
        case "CSV":
        case "GeoJson":
          nextPage = "publishSelect";
          break;
        case "Tile Layer":
          nextPage = "tileLayerFromUrl";
          break;
        // TODO: move this back once we finalize spec https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/45714
        case "OGCFeatureServer":
          if (addDirectToMap) {
            nextPage = "singleLayerSelect";
            break;
          }
        default:
          nextPage = "itemProperties";
      }
    }
    this.nextPage = nextPage;
  }
  render() {
    var _a;
    const { i18n, selectedOption, urlData, determineNextText, addDirectToMap } = this;
    const { url = "", isSecured, addAsBasemap, allowStoredAuth } = urlData;
    const { config: { helpMap, helpBase }, user } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
    const agsItemTypes = (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.b)(Object.values(_ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_31__.a));
    const showCustomParametersType = [
      "WMS",
      "WFS",
      "WMTS",
      "OGCFeatureServer",
      ...agsItemTypes
    ];
    const showCustomParameters = showCustomParametersType.includes(urlData.type);
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { active: this.loading, text: i18n.getServiceInfo }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { active: this.error, description: this.errorMessage, onAlertDismiss: () => {
        this.error = false;
        this.errorMessage = "";
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-url", { url: url, onNewItemUrlChange: (event) => this.handleNewUrl(event.detail), supportedServices: (_a = this.allowedItemTypes) !== null && _a !== void 0 ? _a : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes, onUrlLoaderUpdate: this.handleLoaderUpdate, ref: (ele) => (this.itemUrlRef = ele) }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-select", { ref: (ele) => (this.selectRef = ele), emptyText: i18n.undetected, selectedOption: selectedOption, options: this.options, label: i18n.label, onArcgisOptionChange: (event) => this.changeOption(event.detail) }), showCustomParameters && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "custom-param-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-custom-parameters", { itemType: urlData.type }))), !!user && isSecured && allowStoredAuth && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-switch-card", { onSwitchChange: this.handleAuthSwitchChange, header: i18n[addDirectToMap ? "storeAuthMV" : "storeAuth"], headerLink: { text: i18n.learnMore, href: `${helpBase}${helpMap["120000597"]}` }, defaultChecked: this.urlData.storeAuth })), this.showAddToMap() && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-switch-card", { header: i18n.useAsBaseMap, defaultChecked: addAsBasemap, onSwitchChange: (toggled) => {
        const addAsBasemap = toggled.detail;
        urlData.addAsBasemap = addAsBasemap;
        determineNextText();
      } }))));
  }
  get element() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "loading": ["handleLoadChange"]
  }; }
};
ArcgisNewItemPagesUrlType.style = arcgisNewItemPagesUrlTypeCss;

// Map zip file options to their telemetry detail counterparts
var ZipFileTelemetry;
(function (ZipFileTelemetry) {
  ZipFileTelemetry["Shapefile"] = "shapefile";
  ZipFileTelemetry["File Geodatabase"] = "fgdb";
  ZipFileTelemetry["Photos with Locations"] = "geotagged photos";
  ZipFileTelemetry["Deep Learning Package"] = "deep learning package";
  ZipFileTelemetry["Map Template"] = "map template";
  ZipFileTelemetry["CAD Drawing"] = "cad";
  ZipFileTelemetry["CSV Collection"] = "csv collection";
  ZipFileTelemetry["KML Collection"] = "kml collection";
  ZipFileTelemetry["Desktop Application Template"] = "desktop app template";
  ZipFileTelemetry["Geoprocessing Sample"] = "geoprocessing sample";
  ZipFileTelemetry["Code Sample"] = "code sample";
  ZipFileTelemetry["ArcPad Package"] = "arcpad package";
  ZipFileTelemetry["AppBuilder Widget Package"] = "wab custom widget";
  ZipFileTelemetry["Image Collection"] = "image collection";
  ZipFileTelemetry["iWork Pages"] = "iwork pages";
  ZipFileTelemetry["iWork Numbers"] = "iwork numbers";
  ZipFileTelemetry["iWork Keynote"] = "iwork keynote";
  ZipFileTelemetry["GML"] = "gml";
  ZipFileTelemetry["Application"] = "application";
})(ZipFileTelemetry || (ZipFileTelemetry = {}));

const codeSampleLanguages = [
  "C",
  "C#",
  "C++",
  "Java",
  "Perl",
  "PHP",
  "Python",
  "Ruby",
  "SQL",
  "VB",
  "WPF",
  "Other"
];

const arcgisNewItemPagesZipSelectCss = ":host{padding-bottom:2rem;min-height:460px}.file{font-size:0.875rem;color:var(--calcite-ui-text-1);margin:0;padding:0}.label{font-weight:500;font-size:0.875rem;color:var(--calcite-ui-text-1);margin-bottom:0.75rem;margin-top:0;line-height:18px}.label--top{display:block;margin-top:1.5rem}.trailer-0{margin-bottom:0}";

const ArcgisNewItemPagesZipSelect = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.itemTypes = [];
    this.updateHostedStatus = (e) => {
      this.publish = e.target.value;
    };
    this.handleChange = (event) => {
      this.selected = event.detail;
    };
    this.selected = "Shapefile";
    this.publish = "hosted";
    this.language = "C";
    this.pad = "project";
    this.i18n = undefined;
    this.itemInfoI18N = undefined;
  }
  handleNext() {
    const selected = this.selected === "Photos with Locations" ? "Image Collection" : this.selected;
    if (this.selected === "Application") {
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = "application";
      this.newItemUpdatePage.emit("application");
      return;
    }
    const { type, typeKeywords, thumbnailURL } = _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_8__.a[selected];
    if (this.selected === "ArcPad Package") {
      typeKeywords.push(this.pad === "project" ? "ArcPad Project" : "ArcPad Template");
    }
    if (this.selected === "Code Sample") {
      typeKeywords.push(this.language);
    }
    if (this.selected === "Photos with Locations") {
      typeKeywords.push("Photo locations");
    }
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.newItemMode = "file";
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.type = type;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.typeKeywords = typeKeywords;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.thumbnailURL = thumbnailURL;
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.enablePublishing =
      this.publish === "hosted" && this.canPublishZipType() && _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowPublish;
    this.newItemUpdatePage.emit("itemProperties");
  }
  async componentWillLoad() {
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.zipSelect;
    this.itemInfoI18N = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.itemTypeInfo;
    const { portal, user } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
    if (!(0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__.o)(portal)) {
      this.publish = "not-hosted";
    }
    const _isPublicUser = (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__.n)(user);
    const isEnterprise = portal.isPortal;
    this.itemTypes = [
      { value: "Shapefile", icon: "file-zip", publishable: true },
      { value: "File Geodatabase", icon: "data", publishable: true },
      { value: "Photos with Locations", icon: "images", publishable: true, hide: isEnterprise },
      { value: "Deep Learning Package", icon: "deep-learning" },
      { value: "Map Template", icon: "file-zip" },
      { value: "CAD Drawing", icon: "file-cad" },
      { value: "CSV Collection", icon: "file-csv" },
      { value: "KML Collection", icon: "layer-kml" },
      { value: "Desktop Application Template", icon: "file-zip" },
      { value: "Geoprocessing Sample", icon: "hammer" },
      { value: "Code Sample", icon: "file-code" },
      { value: "ArcPad Package", icon: "cube" },
      { value: "AppBuilder Widget Package", icon: "app-gear", hide: _isPublicUser },
      { value: "Image Collection", icon: "collection", hide: _isPublicUser },
      { value: "GML", icon: "code", hide: _isPublicUser },
      { value: "Application", icon: "apps", hide: _isPublicUser }
    ];
    // Add to MV: Trim down selectable list to defined allowedItemTypes, otherwise accept all
    if (!!_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes) {
      this.itemTypes = this.itemTypes.filter((item) => _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes.includes(item.value));
    }
  }
  replaceTypeAndName(str, fileName) {
    const nameRegEx = new RegExp(/\$\{fileName\}/g);
    const typeRegEx = new RegExp(/\$\{type\}/g);
    return str.replace(typeRegEx, this.selected).replace(nameRegEx, fileName);
  }
  canPublishZipType() {
    const { user, portal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
    const selectedItemType = this.itemTypes.find((itemType) => itemType.value === this.selected);
    return selectedItemType.publishable && (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_17__.a)(user, selectedItemType.value, portal);
  }
  renderPublish() {
    const { i18n, itemInfoI18N } = this;
    const { portal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
    const fileType = itemInfoI18N.lowercaseDisplayName[this.selected];
    let options = ["hosted", "not-hosted"];
    options = options.filter((option) => option !== "hosted" || (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__.o)(portal));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "trailer-0" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label label--top" }, (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(itemInfoI18N.howToAdd, fileType, "fileType"))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", { layout: "vertical" }, options.map((value) => {
      const heading = (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(value === "hosted" ? i18n[value].heading : itemInfoI18N.nonHostedTitle, _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a.fileName, "fileName");
      const description = (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(value === "hosted" ? i18n[value].description : itemInfoI18N.nonHostedDescription, fileType, "fileType");
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { checked: this.publish === value, width: "full", "input-enabled": true, "input-alignment": "start", name: "publish", value: value, onCalciteTileSelectChange: this.updateHostedStatus, heading: heading, description: description }));
    }))));
  }
  renderLanguages() {
    const languages = codeSampleLanguages.map((value) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: value, selected: this.language === value }, value === "Other" ? this.i18n.other : value)));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { key: "language-label" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label label--top" }, this.i18n.language), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: this.i18n.language, width: "half", ref: (el) => {
        this.languageSelect = el;
      }, onCalciteSelectChange: () => (this.language = this.languageSelect.selectedOption.value) }, languages)));
  }
  renderPad() {
    const padOptions = ["project", "template"].map((value) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: value, selected: this.pad === value }, this.i18n.ArcPad[value])));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { key: "pad-label" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label label--top" }, this.i18n.type), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "", width: "half", ref: (el) => {
        this.padSelect = el;
      }, onCalciteSelectChange: () => (this.pad = this.padSelect.selectedOption.value) }, padOptions)));
  }
  render() {
    const { fileName } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_7__.a;
    const options = this.itemTypes
      .filter((item) => !item.hide)
      .map(({ value, icon }) => ({
      optionTitle: this.i18n[value].title,
      value,
      description: this.i18n[value].description,
      icon
    }));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "label" }, this.i18n.file), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "file" }, fileName), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-select", { class: "label--top", selectedOption: this.selected, options: options, label: this.i18n.itemType, onArcgisOptionChange: (e) => {
        // Log which type of zip file was selected
        const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
        const payload = {
          eventType: "other",
          pageName: "my content",
          category: "new item zip item type",
          label: ZipFileTelemetry[e.detail]
        };
        telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
        this.selected = e.detail;
      } }), this.canPublishZipType() &&
      _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.workflow !== "map" &&
      _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.allowPublish &&
      this.renderPublish(), this.selected === "Code Sample" && this.renderLanguages(), this.selected === "ArcPad Package" && this.renderPad()));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesZipSelect.style = arcgisNewItemPagesZipSelectCss;

const timeZoneIds = {
  0: "Dateline Standard Time",
  200: "Hawaiian Standard Time",
  300: "Alaskan Standard Time",
  400: "Pacific Standard Time",
  410: "Pacific Standard Time (Mexico)",
  520: "US Mountain Standard Time",
  510: "Mountain Standard Time (Mexico)",
  500: "Mountain Standard Time",
  610: "Central America Standard Time",
  620: "Central Standard Time",
  630: "Central Standard Time (Mexico)",
  600: "Canada Central Standard Time",
  710: "SA Pacific Standard Time",
  700: "Eastern Standard Time",
  720: "US Eastern Standard Time",
  730: "Venezuela Standard Time",
  850: "Paraguay Standard Time",
  800: "Atlantic Standard Time",
  810: "Central Brazilian Standard Time",
  830: "SA Western Standard Time",
  820: "Pacific SA Standard Time",
  900: "Newfoundland Standard Time",
  910: "E. South America Standard Time",
  950: "Argentina Standard Time",
  940: "SA Eastern Standard Time",
  920: "Greenland Standard Time",
  930: "Montevideo Standard Time",
  1010: "UTC-02",
  1000: "Mid-Atlantic Standard Time",
  1100: "Azores Standard Time",
  1110: "Cape Verde Standard Time",
  1220: "Morocco Standard Time",
  1230: "UTC",
  1200: "GMT Standard Time",
  1210: "Greenwich Standard Time",
  1340: "W. Europe Standard Time",
  1300: "Central Europe Standard Time",
  1320: "Romance Standard Time",
  1310: "Central European Standard Time",
  1330: "W. Central Africa Standard Time",
  1350: "Namibia Standard Time",
  1430: "GTB Standard Time",
  1460: "Middle East Standard Time",
  1410: "Egypt Standard Time",
  1480: "Syria Standard Time",
  1400: "E. Europe Standard Time",
  1470: "South Africa Standard Time",
  1420: "FLE Standard Time",
  1490: "Turkey Standard Time",
  1440: "Israel Standard Time",
  1450: "Jordan Standard Time",
  1510: "Arabic Standard Time",
  1530: "Kaliningrad Standard Time",
  1500: "Arab Standard Time",
  1520: "E. Africa Standard Time",
  1535: "Iran Standard Time",
  1600: "Arabian Standard Time",
  1610: "Azerbaijan Standard Time",
  1540: "Russian Standard Time",
  1650: "Mauritius Standard Time",
  1640: "Georgian Standard Time",
  1620: "Caucasus Standard Time",
  1660: "Afghanistan Standard Time",
  1710: "West Asia Standard Time",
  1715: "Pakistan Standard Time",
  1720: "India Standard Time",
  1730: "Sri Lanka Standard Time",
  1740: "Nepal Standard Time",
  1800: "Central Asia Standard Time",
  1810: "Bangladesh Standard Time",
  1755: "Ekaterinburg Standard Time",
  1820: "Myanmar Standard Time",
  1900: "SE Asia Standard Time",
  1830: "N. Central Asia Standard Time",
  2000: "China Standard Time",
  1910: "North Asia Standard Time",
  2020: "Singapore Standard Time",
  2040: "W. Australia Standard Time",
  2030: "Taipei Standard Time",
  2050: "Ulaanbaatar Standard Time",
  2060: "North Asia East Standard Time",
  2110: "Tokyo Standard Time",
  2100: "Korea Standard Time",
  2140: "Cen. Australia Standard Time",
  2130: "AUS Central Standard Time",
  2210: "E. Australia Standard Time",
  2200: "AUS Eastern Standard Time",
  2240: "West Pacific Standard Time",
  2220: "Tasmania Standard Time",
  2150: "Yakutsk Standard Time",
  2300: "Central Pacific Standard Time",
  2250: "Vladivostok Standard Time",
  2410: "New Zealand Standard Time",
  2430: "UTC+12",
  2400: "Fiji Standard Time",
  2310: "Magadan Standard Time",
  2500: "Tonga Standard Time",
  120: "Samoa Standard Time"
};

const arcgisNewItemTimezoneDropdownCss = ".label{font-weight:500;font-size:0.875rem;color:var(--calcite-ui-text-1);line-height:18px;margin-bottom:6px}.has-subtitle{font-size:1rem;margin-bottom:0}.sub-label{font-size:0.75rem}:host{margin-bottom:1.5rem}";

const ArcgisNewItemTimezoneDropdown = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.timezoneChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "timezoneChange", 7);
    this.selected = "1230";
    this.subTitle = undefined;
    this.defaultTimezone = undefined;
    this.i18n = undefined;
  }
  async componentWillLoad() {
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n.timezoneDropdown;
    const { defaultTimezone } = this;
    if (defaultTimezone) {
      for (const id in timeZoneIds) {
        if (defaultTimezone === timeZoneIds[id]) {
          this.selected = id;
          break;
        }
      }
    }
  }
  render() {
    const { i18n, selected, timezoneChange, subTitle } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label" }, !subTitle && i18n.title), !subTitle && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "sub-label" }, i18n.subTitle), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { onCalciteSelectChange: (event) => {
        const value = event.target.selectedOption.value;
        const id = timeZoneIds[value] || value;
        timezoneChange.emit(id);
      }, width: "half", label: "timezone-select", selectedOption: selected }, Object.keys(i18n.timezones).map((code) => {
      const timezone = i18n.timezones[code];
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { selected: code === selected, value: code }, timezone));
    })), subTitle && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "sub-label" }, subTitle)));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemTimezoneDropdown.style = arcgisNewItemTimezoneDropdownCss;

const arcgisNewItemUrlCss = ".url-field{margin-bottom:1rem}.help-text{margin-top:0.25rem;margin-bottom:0.5rem;font-size:0.875rem}";

const ArcgisNewItemUrl = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.urlInputAddAction = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "urlInputAddAction", 7);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.newItemUrlChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUrlChange", 7);
    this.urlLoaderUpdate = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "urlLoaderUpdate", 7);
    this.debouncedInput = (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_3__.d)(() => {
      this.urlInputAddHandler();
    }, 2000);
    this.inputTitle = "";
    this.inputMessage = "";
    this.headerScale = "s";
    this.supportedServices = undefined;
    this.url = undefined;
    this.placeholder = "https://";
    this.required = true;
    this.inputMessageActive = false;
    this.inputStatus = undefined;
    this.isLoading = false;
    this.i18n = undefined;
  }
  async componentWillLoad() {
    var _a;
    const i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_12__.u.i18n;
    this.i18n = i18n.url;
    if (((_a = this.supportedServices) === null || _a === void 0 ? void 0 : _a.length) > 0) {
      this.supportedServiceString = this.supportedServices
        .filter((type) => (0,_item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_8__.i)(type))
        .map((type) => {
        var _a, _b;
        const option = (0,_ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_31__.i)(type) ? "AGS" : type;
        return ((_b = (_a = i18n.itemTypeInfo.mvText[option]) !== null && _a !== void 0 ? _a : i18n.itemTypeInfo.lowercaseDisplayName[option]) !== null && _b !== void 0 ? _b : type);
      })
        .join(", ");
      this.helpText = (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(i18n.common.supportLayerTypes, this.supportedServiceString, "typeList");
    }
    // Initialize state
    this.inputStatus = "idle";
    this.inputMessageActive = this.inputMessage.length > 0;
    if (!this.inputTitle) {
      this.inputTitle = this.i18n.url;
    }
  }
  async focusMainInput() {
    this.mainInputRef.setFocus();
  }
  async validateInput() {
    const { url, required } = this;
    this.resetValidation();
    this.debouncedInput.invoke();
    if (!url && !required) {
      this.urlLoaderUpdate.emit(false);
      return;
    }
    if (!url) {
      this.urlLoaderUpdate.emit(false);
      return this.setError("invalidUrl");
    }
    if ((0,_url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_23__.i)(url, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal)) {
      this.urlLoaderUpdate.emit(false);
      return this.setError("httpWarning");
    }
  }
  resetValidation() {
    this.inputStatus = "idle";
    this.inputMessageActive = false;
  }
  async urlInputAddHandler() {
    if (!this.url) {
      return;
    }
    this.urlLoaderUpdate.emit(true);
    const { isPortal, allSSL } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal;
    this.url = (0,_url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_23__.f)(this.url, allSSL);
    const { result: type, error } = (0,_url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_23__.g)(this.url, isPortal);
    if (type !== "KML") {
      // KML has a separate name field
      _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_6__.i.title = (0,_url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_23__.u)(this.url).replace(_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_20__.s, "");
    }
    this.urlLoaderUpdate.emit(false);
    if (error) {
      this.setError(error.code);
    }
    else {
      this.newItemUrlChange.emit({
        type,
        url: this.url
      });
    }
  }
  setError(code) {
    var _a;
    const supportedServiceString = this.supportedServiceString;
    const inputMessage = (code === "invalidUrl" && supportedServiceString
      ? (0,_i18n_6685247f_js__WEBPACK_IMPORTED_MODULE_28__.r)(this.i18n.invalidUrlWithType, supportedServiceString, "typeList")
      : (_a = this.i18n) === null || _a === void 0 ? void 0 : _a[code]) || this.i18n.errorMessage;
    this.inputStatus = "invalid";
    this.inputMessage = inputMessage;
    this.inputMessageActive = true;
    return inputMessage;
  }
  render() {
    const { url, helpText, placeholder, required, headerScale } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: this.inputTitle, headerScale: headerScale }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { id: "item-properties-url", placeholder: placeholder, value: url, required: required, ref: (ele) => (this.mainInputRef = ele), status: this.inputStatus, type: "url", onInput: (e) => {
        this.resetValidation();
        // ignore paste, it's handled separately
        if (e.inputType === "insertFromPaste")
          return;
        this.url = e.target.value;
        this.debouncedInput();
      }, onKeyDown: (e) => {
        if (e.key === "Enter") {
          this.url = this.mainInputRef.value;
          this.debouncedInput.invoke();
        }
      }, onPaste: (e) => {
        this.url = e.clipboardData.getData("text");
        this.debouncedInput.invoke();
      } }), this.inputMessageActive ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { icon: this.inputStatus === "invalid", status: this.inputStatus }, this.inputMessage)) : helpText ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "help-text" }, helpText)) : null));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemUrl.style = arcgisNewItemUrlCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-d0f64b81.js":
/*!*******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-d0f64b81.js ***!
  \*******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ featureServiceEndTelemetry),
/* harmony export */   b: () => (/* binding */ filterChangeTelemetry),
/* harmony export */   c: () => (/* binding */ featureLayerTypeTelemetry),
/* harmony export */   e: () => (/* binding */ enableLayerPreferenceTelemetry),
/* harmony export */   f: () => (/* binding */ featureLayerErrorTelemetry),
/* harmony export */   i: () => (/* binding */ itemExpandedTelemetry)
/* harmony export */ });
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



const TELEMETRY_ID = "create feature layer";
const TELEMETRY_PAGE_NAME = "my content";
const addFeatureLayerTypeToTelemetry = (type) => {
  switch (type) {
    case "build":
      return "blank";
    case "existing":
      return "fs";
    case "template":
      return "template";
    case "link":
      return "url";
  }
};
const enableLayerPreferenceTelemetry = (type) => {
  const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry;
  telemetry === null || telemetry === void 0 ? void 0 : telemetry.stepWorkflow(TELEMETRY_ID, `enable ${type === "captureGPS" ? "gps" : type === "enableZDefaults" ? "z" : "m"}`, {
    category: TELEMETRY_ID,
    attribute: addFeatureLayerTypeToTelemetry(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.addFeatureLayerType),
    pageName: TELEMETRY_PAGE_NAME
  });
};
const itemExpandedTelemetry = (type) => {
  const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry;
  telemetry === null || telemetry === void 0 ? void 0 : telemetry.stepWorkflow(TELEMETRY_ID, `expand ${type} details`, {
    category: TELEMETRY_ID,
    attribute: addFeatureLayerTypeToTelemetry(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.addFeatureLayerType),
    pageName: TELEMETRY_PAGE_NAME
  });
};
const filterChangeTelemetry = () => {
  const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry;
  telemetry === null || telemetry === void 0 ? void 0 : telemetry.stepWorkflow(TELEMETRY_ID, "filter", {
    category: TELEMETRY_ID,
    attribute: addFeatureLayerTypeToTelemetry(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.addFeatureLayerType),
    pageName: TELEMETRY_PAGE_NAME
  });
};
const featureLayerTypeTelemetry = (type) => {
  const telemetryType = addFeatureLayerTypeToTelemetry(type);
  const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry;
  telemetry === null || telemetry === void 0 ? void 0 : telemetry.stepWorkflow(TELEMETRY_ID, "from option", {
    category: TELEMETRY_ID,
    attribute: telemetryType,
    pageName: TELEMETRY_PAGE_NAME
  });
};
const featureServiceEndTelemetry = () => {
  const { addFeatureLayerType, serviceInfo } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a;
  const featureLayerServiceInfo = serviceInfo;
  const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry;
  telemetry === null || telemetry === void 0 ? void 0 : telemetry.endWorkflow(TELEMETRY_ID, {
    category: TELEMETRY_ID,
    attribute: addFeatureLayerTypeToTelemetry(addFeatureLayerType),
    pageName: TELEMETRY_PAGE_NAME,
    count: featureLayerServiceInfo.layers.length,
    number: featureLayerServiceInfo.tables.length
  });
};
const featureLayerErrorTelemetry = (errString) => {
  var _a;
  (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry) === null || _a === void 0 ? void 0 : _a.logError({
    category: TELEMETRY_ID,
    error: errString
  });
};




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/i18n-6685247f.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/i18n-6685247f.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   r: () => (/* binding */ replaceI18NString)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
const regexLookupMap = {
  fileName: /\$\{fileName\}/g,
  fileType: /\$\{type\}/g,
  typeList: /\$\{typeList\}/g,
  missingFields: /\$\{\missingFields\}/g
};
const replaceI18NString = (str, replacementString, type) => {
  const typeRegEx = new RegExp(regexLookupMap[type]);
  return str === null || str === void 0 ? void 0 : str.replace(typeRegEx, replacementString);
};




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/image-collection-a67002cc.js":
/*!**********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/image-collection-a67002cc.js ***!
  \**********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ createImageCollection)
/* harmony export */ });
/* harmony import */ var _guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./guid-4f4176ba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js");
/* harmony import */ var _server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./server-item-f12153e6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js");
/* harmony import */ var _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./feature-layer-38cdae87.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-38cdae87.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */





var __await = ( false) || function (v) { return this instanceof __await ? (this.v = v, this) : new __await(v); };
var __asyncGenerator = ( false) || function (thisArg, _arguments, generator) {
  if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
  var g = generator.apply(thisArg, _arguments || []), i, q = [];
  return i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i;
  function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }
  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }
  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }
  function fulfill(value) { resume("next", value); }
  function reject(value) { resume("throw", value); }
  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }
};
/**
 * Given an item, create a new service
 */
function createImageCollection(response, title, configOptions) {
  return __asyncGenerator(this, arguments, function* createImageCollection_1() {
    const { config, portal, user } = configOptions;
    const { item } = yield __await(fetchItem(response, user));
    const template = yield __await((0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_2__.u)(portal));
    yield yield __await("publishingService");
    const isNotInRootFolder = item.ownerFolder && item.ownerFolder !== "/" && item.ownerFolder !== "root";
    const tempTitle = `${title}---${(0,_guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_0__.g)()}`;
    const { createServiceResponse, addToDefinitionResponse } = yield __await((0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_2__.v)(Object.assign({ name: isNotInRootFolder ? tempTitle : title, layers: (template === null || template === void 0 ? void 0 : template.layers) || [], tables: (template === null || template === void 0 ? void 0 : template.tables) || [] }, template), { config, user }));
    if (isNotInRootFolder) {
      yield __await((0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_1__.m)(createServiceResponse.itemId, item.ownerFolder));
      yield __await((0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_1__.e)(createServiceResponse.itemId, { title }));
    }
    yield yield __await("appendingPhotos");
    const { statusUrl } = yield __await(appendPhotos(createServiceResponse, addToDefinitionResponse, item));
    yield __await(addRelationship(createServiceResponse, item, user));
    yield yield __await("checkingStatus");
    yield __await((0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_3__.p)(statusUrl));
    yield yield __await(createServiceResponse);
  });
}
function fetchItem(item, user) {
  const url = `${user.userContentUrl}/items/${item.id}`;
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_3__.r)(url);
}
function appendPhotos(createServiceResponse, addToDefinitionResponse, item) {
  var _a;
  const layer = addToDefinitionResponse.layers[0];
  const url = `${createServiceResponse.encodedServiceURL}/${(_a = layer.id) !== null && _a !== void 0 ? _a : 0}/append`;
  const content = {
    appendItemId: item.id,
    appendUploadFormat: "imageCollection",
    appendAttachmentsInfo: JSON.stringify({ ignoreAttachmentsWithoutLocation: true }),
    upsert: false,
    useGlobalIds: false,
    rollbackOnFailure: true
  };
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_3__.r)(url, content, {}, "post");
}
function addRelationship(createServiceResponse, item, user) {
  const url = `${user.userContentUrl}/addRelationship`;
  const content = {
    relationshipType: "Service2Data",
    destinationItemId: item.id,
    originItemId: createServiceResponse.itemId
  };
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_3__.r)(url, content, {}, "post");
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-054054c6.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-054054c6.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isLargeCSV),
/* harmony export */   f: () => (/* binding */ findPossibleItemTypesByExtension),
/* harmony export */   i: () => (/* binding */ isLargeGeoJSON),
/* harmony export */   m: () => (/* binding */ mapItemTypesToFileExtensions)
/* harmony export */ });
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



function findPossibleItemTypesByExtension(extension, validationTypes) {
  // Search item types extensions for the one imported
  let itemTypes;
  if (validationTypes) {
    itemTypes = validationTypes.map((value) => {
      return value.type;
    });
  }
  else {
    itemTypes = Object.keys(_item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__.a);
  }
  let possibleItemTypes = [];
  itemTypes.forEach((type) => {
    var _a;
    if (((_a = _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__.a[type].fileExt) === null || _a === void 0 ? void 0 : _a.indexOf(extension)) >= 0) {
      possibleItemTypes.push(_item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__.a[type]);
    }
  });
  return possibleItemTypes;
}
function mapItemTypesToFileExtensions(types) {
  if (!types) {
    return null;
  }
  return (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_0__.b)(types.flatMap((type) => { var _a; return (_a = _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__.a[type]) === null || _a === void 0 ? void 0 : _a.fileExt; }).filter((valid) => !!valid));
}
const isLargeGeoJSON = (sizeInBytes) => {
  const sizeInMB = sizeInBytes / 1024 / 1024;
  // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2553#issuecomment-3645404
  return sizeInMB > 50; // 50MB
};
const isLargeCSV = (sizeInBytes) => {
  const sizeInMB = sizeInBytes / 1024 / 1024;
  // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2875#issuecomment-3748913
  return sizeInMB > 20; // 20MB
};




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



const languageMap = new Map([
  ["ar", "ar"],
  ["bg", "bg"],
  ["bs", "bs"],
  ["ca", "ca"],
  ["cs", "cs"],
  ["da", "da"],
  ["de", "de"],
  ["el", "el"],
  ["en", "en"],
  ["es", "es"],
  ["et", "et"],
  ["fi", "fi"],
  ["fr", "fr"],
  ["he", "he"],
  ["hr", "hr"],
  ["hu", "hu"],
  ["id", "id"],
  ["it", "it"],
  ["ja", "ja"],
  ["ko", "ko"],
  ["lt", "lt"],
  ["lv", "lv"],
  ["nb", "nb"],
  ["nl", "nl"],
  ["pl", "pl"],
  ["pt-br", "pt-BR"],
  ["pt-pt", "pt-PT"],
  ["ro", "ro"],
  ["ru", "ru"],
  ["sk", "sk"],
  ["sl", "sl"],
  ["sr", "sr"],
  ["sv", "sv"],
  ["th", "th"],
  ["tr", "tr"],
  ["uk", "uk"],
  ["vi", "vi"],
  ["zh-cn", "zh-CN"],
  ["zh-hk", "zh-HK"],
  ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
  return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
  const closestWithProp = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
  return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
  rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
  const { api, type, places } = options || {};
  if (api === 4) {
    const [intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
    const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
      places,
      style: type,
      digitSeparator: true
    });
    return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
  }
  const [dojoNumber] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
  return dojoNumber.format(number, {
    type,
    places,
    pattern: options === null || options === void 0 ? void 0 : options.pattern
  });
}
const cache = {};
function formatDate(date) {
  const lang = document.documentElement.lang;
  const dayShortMonthYear = {
    year: "numeric",
    month: "short",
    day: "numeric"
  };
  if (!cache[lang]) {
    cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
  }
  return cache[lang].format(date);
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
  var _a, _b, _c;
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    // "ru-RU" maps to "ru" use case
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
    }
    else {
      return "en";
    }
  }
}
function getComponentClosestLanguageIntl(element) {
  var _a, _b, _c;
  // it's OK if we don't have the 4 letter language file for it
  // 4 letter language code needed for formatting numbers
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      // we support the 2 letter coded language
      // e.g. it-CH vs it
      return lang;
    }
    else {
      return "en";
    }
  }
}
function fetchLocaleStringsForComponent(componentName, locale) {
  return new Promise((resolve, reject) => {
    fetch((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
      if (result.ok)
        resolve(result.json());
      else
        reject();
    }, () => reject());
  });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
  const id = `${componentName}${locale}`;
  if (!stringCache[id]) {
    stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
  }
  return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
  const componentName = tagName || element.tagName.toLowerCase();
  const componentLanguage = getComponentClosestLanguage(element);
  const componentLanguageIntl = getComponentClosestLanguageIntl(element);
  let strings;
  try {
    strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
  }
  catch (e) {
    console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
    strings = await fetchLocaleStringsFromCache(componentName, "en");
  }
  return [strings, componentLanguage, componentLanguageIntl];
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/subscription-09185996.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/subscription-09185996.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getSubscriptionInfo)
/* harmony export */ });
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const getSubscriptionInfo = async (portal) => {
  try {
    const subscriptionInfo = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}portals/self/subscriptionInfo`);
    return { result: subscriptionInfo };
  }
  catch (error) {
    console.error(error);
    return { error: { code: "unhandledError" } };
  }
};




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-bd7e56c2.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-bd7e56c2.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ logTileLayerFinish),
/* harmony export */   b: () => (/* binding */ logTileLayerFromOption),
/* harmony export */   l: () => (/* binding */ logTileLayerStart)
/* harmony export */ });
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



const TELEMETRY_ID = "create tile layer";
const TELEMETRY_PAGE_NAME = "my content";
const mapTileLayerOptionToTelemetry = (type) => {
  switch (type) {
    case "store":
      return "data store";
    case "existing":
      return "fs";
    case "upload":
      return "upload";
  }
};
const mapTileLayerTypeToTelemetry = (type) => {
  switch (type) {
    case "tiles":
      return "raster";
    case "vectorTiles":
      return "vector";
  }
};
const logTileLayerStart = () => {
  var _a;
  (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry) === null || _a === void 0 ? void 0 : _a.startWorkflow(TELEMETRY_ID, {
    category: "create tile layer",
    pageName: "my content"
  });
};
const logTileLayerFromOption = () => {
  const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry;
  telemetry === null || telemetry === void 0 ? void 0 : telemetry.stepWorkflow(TELEMETRY_ID, "from option", {
    category: TELEMETRY_ID,
    attribute: mapTileLayerOptionToTelemetry(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.addTileLayerOption),
    details: mapTileLayerTypeToTelemetry(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.tileLayerPublishType),
    pageName: TELEMETRY_PAGE_NAME
  });
};
const logTileLayerFinish = () => {
  const telemetry = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry;
  telemetry === null || telemetry === void 0 ? void 0 : telemetry.endWorkflow(TELEMETRY_ID, {
    category: TELEMETRY_ID,
    attribute: mapTileLayerOptionToTelemetry(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.addTileLayerOption),
    details: mapTileLayerTypeToTelemetry(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.tileLayerPublishType),
    pageName: TELEMETRY_PAGE_NAME
  });
};




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-86ac6961.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-86ac6961.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ resetStoreOnHome),
/* harmony export */   r: () => (/* binding */ resetAddItemStores)
/* harmony export */ });
/* harmony import */ var _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./item-properties-e6412a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




function resetAddItemStores() {
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.d.reset();
  _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_0__.a.reset();
}
const resetStoreOnHome = () => {
  if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.existingItem || _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_2__.u.workflow === "register") {
    return;
  }
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.d.reset();
  const folder = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_0__.i.folder;
  _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_0__.a.reset();
  _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_0__.i.folder = folder;
};




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWQxN2RjNy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzZHO0FBQ007QUFDM0Q7QUFDNEI7QUFDZDtBQUNlO0FBQ1o7QUFDUTtBQUMyQjtBQUNhO0FBQ2daO0FBQ25hO0FBQ25DO0FBQ0w7QUFDMEM7QUFDb0c7QUFDckY7QUFDK007QUFDM087QUFDckI7QUFDK0U7QUFDeEQ7QUFDOUM7QUFDd0U7QUFDTTtBQUNyQztBQUNaO0FBQ21DO0FBQ25EO0FBQ21EO0FBQzFEO0FBQ2E7QUFDL0I7QUFDTjtBQUNGO0FBQ1M7QUFDQztBQUNKO0FBQ0o7QUFDRjtBQUNDO0FBQ1M7QUFDSDtBQUNMO0FBQ0U7QUFDRztBQUNMO0FBQ007QUFDTDs7QUFFOUI7QUFDQSwwQ0FBMEMsa0dBQWtHO0FBQzVJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxVQUFVLG9EQUFvRDtBQUM5RCxFQUFFLGtEQUFXO0FBQ2IsaUJBQWlCLG9EQUFlLG1FQUFtRSxvREFBb0I7QUFDdkg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUUsMkRBQW1CO0FBQ3JCLEVBQUUsMkRBQW1CO0FBQ3JCO0FBQ0E7QUFDQSxJQUFJLDJEQUFtQjtBQUN2QjtBQUNBO0FBQ0EsSUFBSSwyREFBbUI7QUFDdkI7QUFDQSxFQUFFLG9EQUFZO0FBQ2QsRUFBRSxvREFBWTtBQUNkLEVBQUUsb0RBQVk7QUFDZCxFQUFFLG9EQUFZO0FBQ2Q7QUFDQTtBQUNBLEVBQUUsb0RBQVk7QUFDZCxFQUFFLG9EQUFZO0FBQ2Q7QUFD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R0FBRyxrQkFBa0I7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7O0FBRTRFOzs7Ozs7Ozs7Ozs7Ozs7O0FDOUY1RTtBQUNBO0FBQ0E7QUFDQTtBQUN5RTs7QUFFekU7QUFDQTtBQUNBLG1DQUFtQyxzREFBTyxJQUFJLHNEQUFjLFNBQVM7QUFDckUsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWEsU0FBUztBQUN0QjtBQUNBOztBQUVvQzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ2pCcEM7QUFDQTtBQUNBO0FBQ0E7QUFDd0Q7QUFDRzs7QUFFM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLGtEQUFXO0FBQ25CO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLG9CQUFvQixrREFBVztBQUMvQjtBQUNBO0FBQ0EsNkNBQTZDLG9EQUFZO0FBQ3pELHlDQUF5QyxvREFBWTtBQUNyRDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0Esb0JBQW9CLGtEQUFXO0FBQy9CO0FBQ0E7QUFDQSw2Q0FBNkMsb0RBQVk7QUFDekQseUNBQXlDLG9EQUFZO0FBQ3JEO0FBQ0EsR0FBRztBQUNIOztBQUV3Rjs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3JEeEY7QUFDQTtBQUNBO0FBQ0E7QUFDbUc7QUFDckI7QUFDekI7O0FBRXJEO0FBQ0EsRUFBRSxvREFBWTtBQUNkLEVBQUUsMkRBQW1CO0FBQ3JCO0FBQ0E7QUFDQSxNQUFNLG9EQUFZLGlCQUFpQiw4Q0FBWTtBQUMvQztBQUNBO0FBQ0EsRUFBRSxvREFBWTtBQUNkLGlCQUFpQiwyREFBbUI7QUFDcEMsRUFBRSwyREFBbUI7QUFDckIsRUFBRSwyREFBbUI7QUFDckI7O0FBRTBEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLW5ldy1pdGVtXzE5LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2ZlYXR1cmUtbGF5ZXItZDBmNjRiODEuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vaTE4bi02Njg1MjQ3Zi5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9pbWFnZS1jb2xsZWN0aW9uLWE2NzAwMmNjLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2l0ZW0tdHlwZXMtMDU0MDU0YzYuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xvY2FsZS0xM2UwMGE3NS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9zdWJzY3JpcHRpb24tMDkxODU5OTYuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vdGlsZS1sYXllci1iZDdlNTZjMi5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS91dGlscy04NmFjNjk2MS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgZCBhcyBnZXRFbGVtZW50LCBIIGFzIEhvc3QgfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0UmVzdEJhc2VVcmwsIGYgYXMgZnJvbUNhY2hlLCByIGFzIHJlcXVlc3QsIGkgYXMgaXNQb3J0YWxCYWNrZWRCeVNEUyB9IGZyb20gJy4vcG9ydGFsLTc5Y2FhZWZmLmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy1lYjVmN2RjMi5qcyc7XG5pbXBvcnQgeyB0IGFzIHRpbWVvdXQsIGQgYXMgZGVib3VuY2UsIGIgYXMgdW5pcXVlIH0gZnJvbSAnLi9mdW5jdGlvbmFsLWM4MmY1YWI5LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyB9IGZyb20gJy4vbG9jYWxlLTEzZTAwYTc1LmpzJztcbmltcG9ydCB7IGQgYXMgZ2V0Rm9sZGVyRnJvbUlkLCBlIGFzIGdldEhvbWVGb2xkZXJGb3JVc2VyIH0gZnJvbSAnLi91c2VyLWUzZGVkYzRhLmpzJztcbmltcG9ydCB7IGkgYXMgaXRlbVByb3BlcnRpZXNTdGF0ZSB9IGZyb20gJy4vaXRlbS1wcm9wZXJ0aWVzLWU2NDEyYTlhLmpzJztcbmltcG9ydCB7IGEgYXMgYWRkSXRlbVN0YXRlLCBiIGFzIGFkZEl0ZW1VcmxTdGF0ZSB9IGZyb20gJy4vYWRkLWl0ZW0tOTdkNTc3YTkuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRDcmVhdGVJdGVtVHlwZXMsIEEgYXMgQUxMX05FV19JVEVNX01PREVTLCBpIGFzIGlzVXJsVHlwZSB9IGZyb20gJy4vaXRlbS10eXBlcy1iNGZlODZhZC5qcyc7XG5pbXBvcnQgeyBEIGFzIERFRkFVTFRfVElMRV9MQVlFUl8zRF9USUxFU19MQVlFUl9UWVBFLCB0IGFzIHRpbGVzTGF5ZXIzZFRpbGVzTGF5ZXJUeXBlcyB9IGZyb20gJy4vdGlsZS1sYXllci05MGE2YjkwMS5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldFNlcnZpY2VBbmRMYXllckluZm8sIHMgYXMgc3Vic2NyaXB0aW9uU3RhdGUsIHIgYXMgcmVtb3ZlUGFyYW1ldGVyLCBmIGFzIGZldGNoQXBwbGljYXRpb25NYW5pZmVzdCwgYSBhcyBhZGRTZWN1cmVBR1NVcmwsIGkgYXMgaXNIeWJyaWRJbWFnZVNlcnZpY2UsIHAgYXMgcHJvY2Vzc1Bvc3RBZGRLTUwsIE0gYXMgTVVMVElfUEFSVF9VUExPQURfTUlOSU1VTV9TSVpFLCBiIGFzIGFkZEFwcGxpY2F0aW9uLCBjIGFzIGFkZEZlYXR1cmVMYXllciwgaCBhcyBoYW5kbGVBZGRVcmwsIGQgYXMgYWRkQ2xvdWRQcm92aWRlclJlc291cmNlLCBlIGFzIGFkZEZpbGUsIGogYXMgaXNBcHBDb21wb25lbnRFcnJvciwgayBhcyBpc0JhY2tlbmRFcnJvciwgbCBhcyBhZGRGaWxlRnJvbURhdGFVcmwsIG0gYXMgc2VsZWN0T0dDRmVhdHVyZUxheWVyLCBuIGFzIGZvcm1hdEN1c3RvbVBhcmFtZXRlcnMsIG8gYXMgZ2V0VXJsU2VydmljZUluZm8gfSBmcm9tICcuL2ZlYXR1cmUtbGF5ZXItMzhjZGFlODcuanMnO1xuaW1wb3J0IHsgZiBhcyBmb3JtVXBkYXRlSXRlbURhdGFGb3JUaWxlTGF5ZXIsIHAgYXMgcHVibGlzaFRpbGVMYXllciB9IGZyb20gJy4vdGlsZS1sYXllci1mOGJlNzAyOC5qcyc7XG5pbXBvcnQgeyB1IGFzIHVpU3RvcmVTdGF0ZSwgYSBhcyB1aVN0b3JlIH0gZnJvbSAnLi91aS1lY2Y4NmJiYS5qcyc7XG5pbXBvcnQgeyByIGFzIHJlc2V0QWRkSXRlbVN0b3JlcyB9IGZyb20gJy4vdXRpbHMtODZhYzY5NjEuanMnO1xuaW1wb3J0IHsgcyBhcyBzYW5pdGl6ZUZpbGVJbnB1dCwgYSBhcyBzYW5pdGl6ZUZpbGVOYW1lLCBmIGFzIGZvcm1hdEZpbGVTaXplIH0gZnJvbSAnLi9maWxlLWYzNjE5M2U5LmpzJztcbmltcG9ydCB7IGQgYXMgZGVsZXRlSXRlbSwgdSBhcyB1cGRhdGVDYXRlZ29yaWVzLCBjIGFzIHNlbmRBZGRJdGVtUmVxdWVzdCwgZSBhcyB1cGRhdGVJdGVtLCBmIGFzIGZvcm1hdEl0ZW1Qcm9wZXJ0aWVzLCBtIGFzIG1vdmVJdGVtLCBoIGFzIHNlYXJjaEZvckV4aXN0aW5nSXRlbVVybEJ5TmFtZSB9IGZyb20gJy4vc2VydmVyLWl0ZW0tZjEyMTUzZTYuanMnO1xuaW1wb3J0IHsgZiBhcyBmaW5kUG9zc2libGVJdGVtVHlwZXNCeUV4dGVuc2lvbiwgaSBhcyBpc0xhcmdlR2VvSlNPTiwgYSBhcyBpc0xhcmdlQ1NWIH0gZnJvbSAnLi9pdGVtLXR5cGVzLTA1NDA1NGM2LmpzJztcbmltcG9ydCB7IGEgYXMgY2FuUHVibGlzaFR5cGUsIGYgYXMgZmV0Y2hVc2VyTGljZW5zZWRJdGVtcywgYiBhcyBjYW5QdWJsaXNoRmVhdHVyZXMsIGQgYXMgY2FuQ3JlYXRlRGV2ZWxvcGVyQ3JlZGVudGlhbHMsIGUgYXMgY2FuUHVibGlzaEltYWdlQ29sbGVjdGlvbiwgZyBhcyBjYW5QdWJsaXNoVGlsZXMsIGggYXMgY2FuUHVibGlzaFNjZW5lcywgaSBhcyBjYW5DcmVhdGVMb2NhdG9yVmlldywgaiBhcyBjYW5DcmVhdGVMb2NhdG9yLCBrIGFzIGNhbkNyZWF0ZURhdGFTdG9yZSwgbCBhcyBjYW5DcmVhdGVJdGVtcyB9IGZyb20gJy4vcHJpdmlsZWdlcy0zNTU5MGViNC5qcyc7XG5pbXBvcnQgeyBsIGFzIGxvZ1RpbGVMYXllclN0YXJ0LCBhIGFzIGxvZ1RpbGVMYXllckZpbmlzaCB9IGZyb20gJy4vdGlsZS1sYXllci1iZDdlNTZjMi5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldFN1YnNjcmlwdGlvbkluZm8gfSBmcm9tICcuL3N1YnNjcmlwdGlvbi0wOTE4NTk5Ni5qcyc7XG5pbXBvcnQgeyBuIGFzIGlzUHVibGljVXNlciwgZSBhcyBpc09yZ0FkbWluLCBvIGFzIGlzSG9zdGVkUG9ydGFsLCBxIGFzIGdlb0pzb25SZWdFeHAsIHMgYXMgc3BlY2lhbENoYXJhY3RlcnNSZWdFeHAgfSBmcm9tICcuL3ByaXZpbGVnZXMtY2NkNWYzN2QuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRBbGxvd2VkRmllbGRUeXBlcywgYSBhcyBnZXRBbmFseXplZExheWVySW5mbyB9IGZyb20gJy4vZ2VvY29kZS03ZWI3YzBkZi5qcyc7XG5pbXBvcnQgeyBnIGFzIGd1aWQgfSBmcm9tICcuL2d1aWQtNGY0MTc2YmEuanMnO1xuaW1wb3J0IHsgaSBhcyBpc0h0dHAsIHUgYXMgdXJsVG9UaXRsZSwgcyBhcyBzdXBwb3J0c0RpcmVjdCwgZyBhcyBnZXRVcmxUeXBlLCBmIGFzIGZvcm1hdFVybCB9IGZyb20gJy4vdXJsLWYzYjgyY2M3LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0UHJvdmlkZXIsIGEgYXMgZ2V0UmVzb3VyY2VJZGVudGlmaWVyLCBjIGFzIGNsb3VkRmlsZUljb25zLCBiIGFzIGNsb3VkRmlsZU5hbWVzIH0gZnJvbSAnLi9pbmRleC1lYjIyNGQzYy5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZERhdGFTdG9yZSwgcCBhcyBwdWJsaXNoRnJvbURhdGFTdG9yZSB9IGZyb20gJy4vZGF0YS1zdG9yZS1mNTA5NTY0ZC5qcyc7XG5pbXBvcnQgeyBjIGFzIGNyZWF0ZUltYWdlQ29sbGVjdGlvbiB9IGZyb20gJy4vaW1hZ2UtY29sbGVjdGlvbi1hNjcwMDJjYy5qcyc7XG5pbXBvcnQgeyBhIGFzIGFwcGVuZFR5cGVLZXl3b3JkcywgYyBhcyBjaGVja0pvYlN0YXR1cywgcCBhcyBwdWJsaXNoU2VydmljZSB9IGZyb20gJy4vcHVibGlzaC1pdGVtLTgyZmZhN2Y4LmpzJztcbmltcG9ydCB7IHIgYXMgcmVwbGFjZUkxOE5TdHJpbmcgfSBmcm9tICcuL2kxOG4tNjY4NTI0N2YuanMnO1xuaW1wb3J0IHsgZiBhcyBmZWF0dXJlTGF5ZXJFcnJvclRlbGVtZXRyeSwgYSBhcyBmZWF0dXJlU2VydmljZUVuZFRlbGVtZXRyeSB9IGZyb20gJy4vZmVhdHVyZS1sYXllci1kMGY2NGI4MS5qcyc7XG5pbXBvcnQgeyBhIGFzIGFuYWx5emUgfSBmcm9tICcuL2FuYWx5emUtYTM3MTEzNjcuanMnO1xuaW1wb3J0IHsgaSBhcyBpc0FHUywgYSBhcyBhZ3NTZXJ2ZXJNYXAgfSBmcm9tICcuL2Fncy02OGQ0YWUyMC5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYWFmMzBiZDYuanMnO1xuaW1wb3J0ICcuL2luZGV4LTgxZDU0OGI3LmpzJztcbmltcG9ydCAnLi9kb20tMTNmNWIwMGMuanMnO1xuaW1wb3J0ICcuL2xhbmd1YWdlVXRpbC0yMjI1OGM5MC5qcyc7XG5pbXBvcnQgJy4vZmVhdHVyZS1sYXllci1kMzNlYTExNC5qcyc7XG5pbXBvcnQgJy4vdGh1bWJuYWlsLTBiN2FkZmNkLmpzJztcbmltcG9ydCAnLi9xdWVyeS00ZjdiN2U0ZC5qcyc7XG5pbXBvcnQgJy4vYXBpLWY3OTM0Y2Q3LmpzJztcbmltcG9ydCAnLi9pdGVtLWQ5ZDcwNDE2LmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTY5MzA1YTg1LmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTlmNjQ4YmVlLmpzJztcbmltcG9ydCAnLi9zdG9yZS0zMjEwYjYwNC5qcyc7XG5pbXBvcnQgJy4vc3RvcmFnZS1kN2Y1ODIyZS5qcyc7XG5pbXBvcnQgJy4vZGF0YS1zdG9yZS1lOGI1Y2UyZi5qcyc7XG5pbXBvcnQgJy4vYmFzaWMtZWU5YzY3NGMuanMnO1xuaW1wb3J0ICcuL2NvbW1vbkVudW1zLWY5OGEzMjNjLmpzJztcbmltcG9ydCAnLi9hcHBlbmQtNThhN2U3YWIuanMnO1xuXG4vLyBUT0RPOiByZW1vdmUgbmV3SXRlbU1vZGUgPT09IFwidXJsXCIgb25jZSB0aGUgYnVzaW5lc3MgbG9naWMgZm9yIGZlYXR1cmUgY29sbGVjdGlvbiBpcyByZWFkeVxuY29uc3QgY2FuU2tpcFB1Ymxpc2hTZWxlY3RUb05leHRQYWdlID0gKHsgZGlyZWN0TW9kZSwgbmV3SXRlbU1vZGUsIGl0ZW1UeXBlLCBjbG91ZCwgaXNNdWx0aXBhZ2VFeGNlbCwgZnJvbUV4aXN0aW5nSXRlbSwgY2FuUHVibGlzaEl0ZW1UeXBlIH0pID0+IHtcbiAgaWYgKGZyb21FeGlzdGluZ0l0ZW0gJiYgIWlzTXVsdGlwYWdlRXhjZWwpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAoZGlyZWN0TW9kZSkge1xuICAgIC8vICMyNzI4IGZvciBDU1YgLS0tICMyNzMxIGZvciBHZW9KU09OXG4gICAgaWYgKChjbG91ZCAmJiAhaXNNdWx0aXBhZ2VFeGNlbCkgfHxcbiAgICAgICgoIWlzTXVsdGlwYWdlRXhjZWwgfHwgbmV3SXRlbU1vZGUgPT09IFwidXJsXCIpICYmXG4gICAgICAgICghY2FuUHVibGlzaEl0ZW1UeXBlIHx8IChpdGVtVHlwZSAhPT0gXCJHZW9Kc29uXCIgJiYgaXRlbVR5cGUgIT09IFwiQ1NWXCIpKSkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5jb25zdCBpbml0aWFsaXplV2l0aEV4aXN0aW5nSXRlbSA9IGFzeW5jIChpdGVtLCBvcHRpb25zKSA9PiB7XG4gIHZhciBfYTtcbiAgY29uc3QgeyBleGlzdGluZ0l0ZW1UeXBlLCBwb3J0YWwsIGV4aXN0aW5nSXRlbVB1Ymxpc2hUeXBlIH0gPSBvcHRpb25zO1xuICBjb25maWdTdGF0ZS5pbml0aWFsRm9sZGVyID1cbiAgICAoX2EgPSAoYXdhaXQgZ2V0Rm9sZGVyRnJvbUlkKGl0ZW0uZm9sZGVySWQsIGl0ZW0uaXRlbU93bmVyKSkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGdldEhvbWVGb2xkZXJGb3JVc2VyKGl0ZW0uaXRlbU93bmVyKTtcbiAgbGV0IHR5cGUgPSBpdGVtLnR5cGU7XG4gIC8vIEFmdGVyIHB1Ymxpc2gsIHNvbWVob3cgdGhlIG5ldyBpdGVtIHdpbGwgaGF2ZSBHZW9KU09OIGluc3RlYWQgb2YgR2VvSnNvblxuICBpZiAodHlwZSA9PT0gXCJHZW9KU09OXCIpIHtcbiAgICB0eXBlID0gXCJHZW9Kc29uXCI7XG4gIH1cbiAgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSA9IGl0ZW0udGl0bGU7XG4gIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuY2F0ZWdvcmllcyA9IGl0ZW0uY2F0ZWdvcmllcztcbiAgY29uc3QgY3VyVGFnID0gaXRlbS50YWdzO1xuICBpZiAoQXJyYXkuaXNBcnJheShjdXJUYWcpKSB7XG4gICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50YWdzID0gY3VyVGFnIHx8IFtdO1xuICB9XG4gIGVsc2Uge1xuICAgIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGFncyA9IChjdXJUYWcgIT09IG51bGwgJiYgY3VyVGFnICE9PSB2b2lkIDAgPyBjdXJUYWcgOiBcIlwiKS5zcGxpdChcIixcIik7XG4gIH1cbiAgYWRkSXRlbVN0YXRlLmlkID0gaXRlbS5pZDtcbiAgYWRkSXRlbVN0YXRlLnR5cGUgPSB0eXBlO1xuICBhZGRJdGVtU3RhdGUuZmlsZU5hbWUgPSBpdGVtLm5hbWU7XG4gIGFkZEl0ZW1TdGF0ZS5leGlzdGluZ0l0ZW0gPSBpdGVtO1xuICAvLyBUT0RPOiBkZXRlcm1pbmUgaWYgdGhpcyBpcyB0cnVlXG4gIC8vIEVuYWJsZSBwdWJsaXNoaW5nIGNhdXNlcyB0aGlzIGJ1ZyBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcC9pc3N1ZXMvNDAxMzNcbiAgYWRkSXRlbVN0YXRlLmVuYWJsZVB1Ymxpc2hpbmcgPSBleGlzdGluZ0l0ZW1UeXBlICE9PSBcInRpbGVMYXllclwiO1xuICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPSBleGlzdGluZ0l0ZW1UeXBlO1xuICBzd2l0Y2ggKGV4aXN0aW5nSXRlbVR5cGUpIHtcbiAgICBjYXNlIFwiZmlsZVwiOlxuICAgICAgYWRkSXRlbVN0YXRlLmV4dGVuc2lvbiA9IGFkZENyZWF0ZUl0ZW1UeXBlc1t0eXBlXS5maWxlRXh0WzBdO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBcInRpbGVMYXllclwiOlxuICAgICAgY29uc3QgeyBpZCwgdXJsLCB0aXRsZSB9ID0gaXRlbTtcbiAgICAgIGNvbnN0IFt7IGxheWVycywgdGFibGVzLCBzZXJ2aWNlSW5mbyB9XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgZ2V0U2VydmljZUFuZExheWVySW5mbyh1cmwsIGdldFJlc3RCYXNlVXJsKHBvcnRhbCksIHRydWUpXG4gICAgICBdKTtcbiAgICAgIGNvbnN0IHsgcmVzdWx0OiB1cGRhdGVkSXRlbURhdGEgfSA9IGF3YWl0IGZvcm1VcGRhdGVJdGVtRGF0YUZvclRpbGVMYXllcih7XG4gICAgICAgIGl0ZW1JZDogaWQsXG4gICAgICAgIGl0ZW1Vcmw6IHVybCxcbiAgICAgICAgcHVibGlzaFR5cGU6IGV4aXN0aW5nSXRlbVB1Ymxpc2hUeXBlID09PSBcInZlY3RvclRpbGVzXCIgPyBcInZlY3RvclwiIDogXCJyYXN0ZXJcIixcbiAgICAgICAgcG9ydGFsLFxuICAgICAgICBmdWxsTGF5ZXJzOiBsYXllcnNcbiAgICAgIH0pO1xuICAgICAgYWRkSXRlbVN0YXRlLnNvdXJjZVRpdGxlID0gdGl0bGU7XG4gICAgICBhZGRJdGVtU3RhdGUudGlsZUxheWVyUHVibGlzaFR5cGUgPSBleGlzdGluZ0l0ZW1QdWJsaXNoVHlwZTtcbiAgICAgIGlmIChhZGRJdGVtU3RhdGUudGlsZUxheWVyUHVibGlzaFR5cGUgPT09IFwiM2RUaWxlc1wiKSB7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS50aWxlc0xheWVyM2RUaWxlc0xheWVyVHlwZSA9IERFRkFVTFRfVElMRV9MQVlFUl8zRF9USUxFU19MQVlFUl9UWVBFO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGFkZEl0ZW1TdGF0ZS50aWxlTGF5ZXJEYXRhID0gdXBkYXRlZEl0ZW1EYXRhO1xuICAgICAgYWRkSXRlbVN0YXRlLnRpbGVBdXRvQ3JlYXRpb24gPSB0cnVlO1xuICAgICAgYWRkSXRlbVN0YXRlLnRpbGVMYXllckJhc2VtYXBUeXBlID0gXCJzdGFuZGFyZFwiO1xuICAgICAgYWRkSXRlbVN0YXRlLnRpbGVMYXllckJhc2VtYXBVcmwgPSBcIlwiO1xuICAgICAgYWRkSXRlbVN0YXRlLnRpbGVMYXllckZyb21GZWF0dXJlTGF5ZXIgPSB0cnVlO1xuICAgICAgYWRkSXRlbVN0YXRlLnRpbGVMYXllckxheWVycyA9IGxheWVycztcbiAgICAgIGFkZEl0ZW1TdGF0ZS50aWxlTGF5ZXJUYWJsZXMgPSB0YWJsZXM7XG4gICAgICBhZGRJdGVtU3RhdGUudGlsZUxheWVyU2VydmljZUluZm8gPSBzZXJ2aWNlSW5mbztcbiAgICAgIGJyZWFrO1xuICB9XG59O1xuXG4vKiogbWFwcGluZyBvZiBuZXh0IHBhZ2UgZGV0YWlsIHRvIGVsZW1lbnQgdGFnIG5hbWUgKi9cbmNvbnN0IHBhZ2VzID0ge1xuICBhcHBsaWNhdGlvbjogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtYXBwbGljYXRpb25cIixcbiAgYXV0aDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtYXV0aFwiLFxuICBidWxrTGF5ZXJTZWxlY3Q6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWJ1bGstbGF5ZXItc2VsZWN0XCIsXG4gIGNsb3VkOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1jbG91ZFwiLFxuICBjc3ZMb2NhdGlvbkZpZWxkczogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtY3N2LWxvY2F0aW9uLWZpZWxkc1wiLFxuICBkYXRhVXBsb2FkOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1kYXRhLXVwbG9hZFwiLFxuICBkYXRhU3RvcmVCcm93c2VyOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1kYXRhLXN0b3JlLWJyb3dzZXJcIixcbiAgZGF0YVN0b3JlTGlzdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZGF0YS1zdG9yZS1saXN0XCIsXG4gIGRhdGFTdG9yZVNlbGVjdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZGF0YS1zdG9yZS1zZWxlY3RcIixcbiAgZGF0YVN0b3JlU2VsZWN0Rm9sZGVyOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1kYXRhLXN0b3JlLXNlbGVjdC1mb2xkZXJcIixcbiAgZGF0YVN0b3JlU2VsZWN0RGF0YWJhc2U6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtc2VsZWN0LWRhdGFiYXNlXCIsXG4gIGRhdGFTdG9yZVNlbGVjdERhdGFiYXNlVHlwZTogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZGF0YS1zdG9yZS1zZWxlY3QtZGF0YWJhc2UtdHlwZVwiLFxuICBkYXRhU3RvcmVTZWxlY3RCZGZzOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1kYXRhLXN0b3JlLXNlbGVjdC1iZGZzXCIsXG4gIGRhdGFTdG9yZVNlbGVjdEJkZnNDbG91ZDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZGF0YS1zdG9yZS1zZWxlY3QtYmRmcy1jbG91ZFwiLFxuICBkYXRhU3RvcmVTZWxlY3RCZGZzRmlsZXNoYXJlOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1kYXRhLXN0b3JlLXNlbGVjdC1iZGZzLWZpbGVzaGFyZVwiLFxuICBkYXRhU3RvcmVTZWxlY3RCZGZzSGRmczogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZGF0YS1zdG9yZS1zZWxlY3QtYmRmcy1oZGZzXCIsXG4gIGRhdGFTdG9yZVNlbGVjdEJkZnNIaXZlOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1kYXRhLXN0b3JlLXNlbGVjdC1iZGZzLWhpdmVcIixcbiAgZGF0YVN0b3JlU2VsZWN0Q2xvdWQ6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtc2VsZWN0LWNsb3VkXCIsXG4gIGRhdGFTdG9yZVNlbGVjdENsb3VkQ3JlZGVudGlhbHM6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtc2VsZWN0LWNsb3VkLWNyZWRlbnRpYWxzXCIsXG4gIGRhdGFTdG9yZURhdGFiYXNlQ3JlZGVudGlhbHM6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtZGF0YWJhc2UtY3JlZGVudGlhbHNcIixcbiAgZGF0YVN0b3JlU2VsZWN0Tm9TcWw6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtc2VsZWN0LW5vc3FsXCIsXG4gIGRhdGFTdG9yZVNlbGVjdE5vU3FsQ3JlZGVudGlhbHM6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtc2VsZWN0LW5vc3FsLWNyZWRlbnRpYWxzXCIsXG4gIGRhdGFTdG9yZVNlbGVjdEFyYW5nb0NyZWRlbnRpYWxzOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1kYXRhLXN0b3JlLXNlbGVjdC1hcmFuZ28tY3JlZGVudGlhbHNcIixcbiAgZGF0YVN0b3JlU2VsZWN0U2VydmVyTGlzdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZGF0YS1zdG9yZS1zZWxlY3Qtc2VydmVyLWxpc3RcIixcbiAgZGV2ZWxvcGVyQ3JlZGVudGlhbHNTZWxlY3Q6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRldmVsb3Blci1jcmVkZW50aWFscy1zZWxlY3RcIixcbiAgZmVhdHVyZUxheWVyRnJvbUV4aXN0aW5nOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1mZWF0dXJlLWxheWVyLWZyb20tZXhpc3RpbmdcIixcbiAgZmVhdHVyZUxheWVyRnJvbVNjcmF0Y2g6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWZlYXR1cmUtbGF5ZXItZnJvbS1zY3JhdGNoXCIsXG4gIGZlYXR1cmVMYXllckZyb21UZW1wbGF0ZTogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZmVhdHVyZS1sYXllci1mcm9tLXRlbXBsYXRlXCIsXG4gIGZlYXR1cmVMYXllckZyb21VUkw6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWZlYXR1cmUtbGF5ZXItZnJvbS11cmxcIixcbiAgZmVhdHVyZUxheWVyUHJlZmVyZW5jZTogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZmVhdHVyZS1sYXllci1wcmVmZXJlbmNlXCIsXG4gIGFwcGVuZFNlbGVjdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtYXBwZW5kLXNlbGVjdFwiLFxuICBhcHBlbmRVcGxvYWQ6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWFwcGVuZC11cGxvYWRcIixcbiAgYXBwZW5kU2VsZWN0VXBkYXRlOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1hcHBlbmQtc2VsZWN0LXVwZGF0ZVwiLFxuICBhcHBlbmRNYXRjaEZpZWxkczogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtYXBwZW5kLW1hdGNoLWZpZWxkc1wiLFxuICBhcHBlbmRLZXlQYWlyU2VsZWN0OiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1hcHBlbmQta2V5LXBhaXItc2VsZWN0XCIsXG4gIGFwcGVuZFNlbGVjdExheWVyOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1hcHBlbmQtc2VsZWN0LWxheWVyXCIsXG4gIGFwcGVuZE92ZXJ3cml0ZTogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtYXBwZW5kLW92ZXJ3cml0ZVwiLFxuICBhcHBlbmRGaW5pc2g6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWFwcGVuZC1qb2JcIixcbiAgZmVhdHVyZUxheWVyU2VsZWN0OiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1mZWF0dXJlLWxheWVyLXNlbGVjdFwiLFxuICBmZWF0dXJlTGF5ZXJTdW1tYXJ5OiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1mZWF0dXJlLWxheWVyLXN1bW1hcnlcIixcbiAgZmlsZUZpZWxkOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1maWxlLWZpZWxkc1wiLFxuICBoeWJyaWRJbWFnZVNlbGVjdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtaHlicmlkLWltYWdlLXNlbGVjdFwiLFxuICBpdGVtUHJvcGVydGllczogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtaXRlbS1wcm9wZXJ0aWVzXCIsXG4gIGxheWVyVXBsb2FkOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1sYXllci11cGxvYWRcIixcbiAgbG9jYXRvclNlbGVjdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtbG9jYXRvci1zZWxlY3RcIixcbiAgcHVibGlzaFNlbGVjdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtcHVibGlzaC1zZWxlY3RcIixcbiAgc2NlbmVMYXllclNlbGVjdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtc2NlbmUtbGF5ZXItc2VsZWN0XCIsXG4gIHNlcnZlckxpc3Q6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLXNlcnZlci1saXN0XCIsXG4gIHNlcnZpY2VTY29wZTogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtc2VydmljZS1zY29wZVwiLFxuICBzaW5nbGVMYXllclNlbGVjdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtc2luZ2xlLWxheWVyLXNlbGVjdFwiLFxuICB0aWxlTGF5ZXJGcm9tRXhpc3Rpbmc6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLXRpbGUtbGF5ZXItZnJvbS1leGlzdGluZ1wiLFxuICB0aWxlTGF5ZXJGcm9tVXJsOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy10aWxlLWxheWVyLWZyb20tdXJsXCIsXG4gIHRpbGVMYXllclNlbGVjdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtdGlsZS1sYXllci1zZWxlY3RcIixcbiAgdGlsZUxheWVyU2V0dGluZ3M6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLXRpbGUtbGF5ZXItc2V0dGluZ3NcIixcbiAgdXJsVHlwZVNlbGVjdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtdXJsLXR5cGVcIixcbiAgemlwU2VsZWN0OiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy16aXAtc2VsZWN0XCIsXG4gIGRlZmF1bHQ6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWhvbWVcIlxufTtcblxuY29uc3QgaGFuZGxlSW5pdFdpdGhGaWxlID0gKGZpbGUpID0+IHtcbiAgY29uc3QgeyB0aXRsZSwgZmlsZU5hbWUsIGV4dGVuc2lvbiB9ID0gc2FuaXRpemVGaWxlSW5wdXQoZmlsZSk7XG4gIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUgPSB0aXRsZTtcbiAgYWRkSXRlbVN0YXRlLmZpbGUgPSBmaWxlO1xuICBhZGRJdGVtU3RhdGUuZmlsZU5hbWUgPSBmaWxlTmFtZTtcbiAgYWRkSXRlbVN0YXRlLm5ld0l0ZW1Nb2RlID0gXCJmaWxlXCI7XG4gIGFkZEl0ZW1TdGF0ZS5leHRlbnNpb24gPSBleHRlbnNpb247XG4gIHJldHVybiBleHRlbnNpb247XG59O1xuY29uc3QgYW5hbHl6ZUl0ZW1Gb3JOZXh0U3RlcCA9IChleHRlbnNpb24pID0+IHtcbiAgY29uc3QgcG9zc2libGVJdGVtVHlwZXMgPSBmaW5kUG9zc2libGVJdGVtVHlwZXNCeUV4dGVuc2lvbihleHRlbnNpb24pO1xuICBjb25zdCBpdGVtVHlwZSA9IHBvc3NpYmxlSXRlbVR5cGVzWzBdO1xuICBjb25zdCB7IHR5cGUsIG5leHRTdGVwIH0gPSBpdGVtVHlwZTtcbiAgYWRkSXRlbVN0YXRlLnR5cGUgPSB0eXBlO1xuICByZXR1cm4geyBuZXh0U3RlcCwgdHlwZSB9O1xufTtcbmNvbnN0IGhhbmRsZURlbGV0ZUl0ZW0gPSBhc3luYyAoaXRlbUlkLCBmcm9tRXhpc3RpbmdJdGVtKSA9PiB7XG4gIHRyeSB7XG4gICAgaXRlbUlkICYmICFmcm9tRXhpc3RpbmdJdGVtICYmIChhd2FpdCBkZWxldGVJdGVtKGl0ZW1JZCwgeyBwZXJtYW5lbnREZWxldGU6IHRydWUgfSkpO1xuICB9XG4gIGNhdGNoIChfYSkge1xuICAgIC8vIGlmIG5vIGV4aXN0aW5nIGl0ZW0gd2FzIGZvdW5kLCBhc3N1bWUgaXQncyBub3QgdGhlcmUsIHNhZmUgdG8gcHJvY2VlZC4gKFdlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcCM0MDA0MClcbiAgICByZXR1cm47XG4gIH1cbn07XG5cbmNvbnN0IFRFTEVNRVRSWV9JRCA9IFwibmV3IGl0ZW1cIjtcbmNvbnN0IFRFTEVNRVRSWV9QQUdFX05BTUUgPSBcIm15IGNvbnRlbnRcIjtcbmZ1bmN0aW9uIGxvZ0FkZE5ld0l0ZW1TdGFydCgpIHtcbiAgY29uc3QgdGVsZW1ldHJ5ID0gY29uZmlnU3RhdGUudGVsZW1ldHJ5O1xuICB0ZWxlbWV0cnkgPT09IG51bGwgfHwgdGVsZW1ldHJ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlbWV0cnkuc3RhcnRXb3JrZmxvdyhcIm5ldyBpdGVtIHVwbG9hZFwiLCB7XG4gICAgZXZlbnRUeXBlOiBcIndvcmtmbG93XCIsXG4gICAgY2F0ZWdvcnk6IFwibmV3IGl0ZW0gdXBsb2FkXCIsXG4gICAgZGV0YWlsczogYWRkSXRlbVN0YXRlLnR5cGUsXG4gICAgcGFnZU5hbWU6IFRFTEVNRVRSWV9QQUdFX05BTUVcbiAgfSk7XG59XG5mdW5jdGlvbiBsb2dTdWNjZXNzZnVsSXRlbUNyZWF0aW9uKCkge1xuICBjb25zdCB7IHR5cGUsIGFwcGxpY2F0aW9uVHlwZSwgY3VzdG9tUGFyYW1ldGVycywgc2VsZWN0ZWRMYXllcklkVHJhY2tlciB9ID0gYWRkSXRlbVN0YXRlO1xuICBjb25zdCB0ZWxlbWV0cnkgPSBjb25maWdTdGF0ZS50ZWxlbWV0cnk7XG4gIGNvbnN0IHRlbGVtZXRyeURldGFpbHMgPSB1aVN0b3JlU3RhdGUudGVsZW1ldHJ5RGV0YWlscztcbiAgdGVsZW1ldHJ5ID09PSBudWxsIHx8IHRlbGVtZXRyeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVsZW1ldHJ5LmVuZFdvcmtmbG93KFwibmV3IGl0ZW0gdXBsb2FkXCIsIHtcbiAgICBkZXRhaWxzOiB0eXBlLFxuICAgIHBhZ2VOYW1lOiBURUxFTUVUUllfUEFHRV9OQU1FXG4gIH0pO1xuICAvLyBTZXQgdXAgdGVsZW1ldHJ5IHBheWxvYWQgYmFzZWQgb24gdGhlIHBhdGggdGhlIHVzZXIgdG9va1xuICBjb25zdCBwYXlsb2FkID0ge1xuICAgIGV2ZW50VHlwZTogXCJvdGhlclwiLFxuICAgIHBhZ2VOYW1lOiBURUxFTUVUUllfUEFHRV9OQU1FLFxuICAgIGNhdGVnb3J5OiBURUxFTUVUUllfSUQsXG4gICAgbGFiZWw6IFRFTEVNRVRSWV9JRCxcbiAgICBkZXRhaWxzOiB0ZWxlbWV0cnlEZXRhaWxzXG4gIH07XG4gIGlmICh0ZWxlbWV0cnlEZXRhaWxzID09PSBcInVybFwiKSB7XG4gICAgcGF5bG9hZC5hdHRyaWJ1dGUgPSB0eXBlO1xuICAgIGlmICgoY3VzdG9tUGFyYW1ldGVycyA9PT0gbnVsbCB8fCBjdXN0b21QYXJhbWV0ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjdXN0b21QYXJhbWV0ZXJzLmxlbmd0aCkgPiAwKSB7XG4gICAgICBwYXlsb2FkLmFjdGlvbiA9IFwiY3VzdG9tUGFyYW1zXCI7XG4gICAgfVxuICAgIGlmICh0eXBlID09PSBcIldNU1wiKSB7XG4gICAgICBwYXlsb2FkLmNvdW50ID0gc2VsZWN0ZWRMYXllcklkVHJhY2tlciA9PT0gbnVsbCB8fCBzZWxlY3RlZExheWVySWRUcmFja2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZExheWVySWRUcmFja2VyLmNvdW50O1xuICAgIH1cbiAgfVxuICBlbHNlIGlmIChhcHBsaWNhdGlvblR5cGUpIHtcbiAgICBwYXlsb2FkLmF0dHJpYnV0ZSA9IGFwcGxpY2F0aW9uVHlwZTtcbiAgfVxuICB0ZWxlbWV0cnkgPT09IG51bGwgfHwgdGVsZW1ldHJ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlbWV0cnkubG9nRXZlbnQocGF5bG9hZCk7XG59XG5jb25zdCBsb2dJbml0V2l0aEZpbGUgPSAoKSA9PiB7XG4gIGNvbnN0IHsgdGVsZW1ldHJ5IH0gPSBjb25maWdTdGF0ZTtcbiAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICBldmVudFR5cGU6IFwib3RoZXJcIixcbiAgICBwYWdlTmFtZTogXCJteSBjb250ZW50XCIsXG4gICAgY2F0ZWdvcnk6IFwiY29udGVudCBwYWdlIGRyYWcgZHJvcFwiLFxuICAgIGxhYmVsOiBcImNvbnRlbnRcIlxuICB9O1xuICB0ZWxlbWV0cnkgPT09IG51bGwgfHwgdGVsZW1ldHJ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlbWV0cnkubG9nRXZlbnQocGF5bG9hZCk7XG4gIHVpU3RvcmVTdGF0ZS50ZWxlbWV0cnlEZXRhaWxzID0gXCJkcmFnIGRyb3BcIjtcbn07XG5mdW5jdGlvbiBsb2dJdGVtUHJvcGVydGllc0NoYW5nZXMoKSB7XG4gIHZhciBfYSwgX2I7XG4gIGNvbnN0IHRlbGVtZXRyeSA9IGNvbmZpZ1N0YXRlLnRlbGVtZXRyeTtcbiAgY29uc3QgeyB0aXRsZSwgZm9sZGVyLCBjYXRlZ29yaWVzLCB0YWdzLCBzbmlwcGV0IH0gPSBpdGVtUHJvcGVydGllc1N0YXRlO1xuICBjb25zdCB7IGluaXRpYWxUaXRsZSwgaW5pdGlhbEZvbGRlcnMgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgY29uc3QgaG9tZUZvbGRlciA9ICFmb2xkZXIgfHwgZm9sZGVyLnRpdGxlID09PSBmb2xkZXIuaWQ7XG4gIGNvbnN0IGV4aXN0aW5nRm9sZGVyID0gISFpbml0aWFsRm9sZGVycy5tYXAoKGZvbGRlcikgPT4gZm9sZGVyLmlkKS5maW5kKChpZCkgPT4gaWQgPT09IGZvbGRlci5pZCk7XG4gIC8vIExvZyBjaGFuZ2VzIHRoZSB1c2VyIGhhcyBtYWRlIHRvIGRlZmF1bHQgaXRlbSBwcm9wZXJ0aWVzXG4gIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgZXZlbnRUeXBlOiBcIm90aGVyXCIsXG4gICAgcGFnZU5hbWU6IFRFTEVNRVRSWV9QQUdFX05BTUUsXG4gICAgY2F0ZWdvcnk6IFwibmV3IGl0ZW0gaXRlbSBpbmZvXCIsXG4gICAgbGFiZWw6IHRpdGxlID09PSBpbml0aWFsVGl0bGUgPyBcImRlZmF1bHQgdGl0bGVcIiA6IFwidGl0bGUgY2hhbmdlZFwiLFxuICAgIGFjdGlvbjogKHNuaXBwZXQgPT09IG51bGwgfHwgc25pcHBldCA9PT0gdm9pZCAwID8gdm9pZCAwIDogc25pcHBldC5sZW5ndGgpID4gMCA/IFwic3VtbWFyeVwiIDogXCJubyBzdW1tYXJ5XCIsXG4gICAgY291bnQ6IChfYSA9IHRhZ3MgPT09IG51bGwgfHwgdGFncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGFncy5sZW5ndGgpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDAsXG4gICAgbnVtYmVyOiAoX2IgPSBjYXRlZ29yaWVzID09PSBudWxsIHx8IGNhdGVnb3JpZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNhdGVnb3JpZXMubGVuZ3RoKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAwXG4gIH07XG4gIC8vIENoZWNrIGlmIHRoZSB1c2VyIGFkZGVkIHRvIGEgZm9sZGVyIHRoZXkgY3JlYXRlZCB3aXRoaW4gaXRlbSBwcm9wZXJ0aWVzXG4gIGlmICghZXhpc3RpbmdGb2xkZXIpIHtcbiAgICBwYXlsb2FkLmRldGFpbHMgPSBcIm5ldyBmb2xkZXJcIjtcbiAgfVxuICBlbHNlIHtcbiAgICBwYXlsb2FkLmRldGFpbHMgPSBob21lRm9sZGVyID8gXCJyb290IGZvbGRlclwiIDogXCJjdXN0b20gZm9sZGVyXCI7XG4gIH1cbiAgdGVsZW1ldHJ5ID09PSBudWxsIHx8IHRlbGVtZXRyeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVsZW1ldHJ5LmxvZ0V2ZW50KHBheWxvYWQpO1xufVxuXG5jb25zdCBhcmNnaXNOZXdJdGVtQ3NzID0gXCIuc3RhZ2V7cGFkZGluZy1ib3R0b206MS41cmVtO3BhZGRpbmctbGVmdDoxcHg7cGFkZGluZy1yaWdodDoxcHg7Ym94LXNpemluZzpib3JkZXItYm94O3dpZHRoOjEwMCU7b3BhY2l0eToxO2Rpc3BsYXk6YmxvY2s7aGVpZ2h0OmNhbGMoMTAwJSAtIDJyZW0pO3RyYW5zaXRpb246YWxsIDIwMG1zIGVhc2UtaW4tb3V0fUBtZWRpYSBzY3JlZW4gYW5kIChtaW4td2lkdGg6IDEwODBweCl7LnN0YWdle2hlaWdodDptaW4oNzAwcHgsIDYwdmgpfX0uc3RhZ2UtLWZ1bGxzY3JlZW57aGVpZ2h0OjEwMCU7b3ZlcmZsb3c6YXV0bztwYWRkaW5nLWJvdHRvbTowfS5zdGFnZS0tZGlzYWJsZS1zY3JvbGx7b3ZlcmZsb3c6aGlkZGVuO2hlaWdodDozM3ZofS5zdGFnZS1hbmlte3RyYW5zZm9ybTp0cmFuc2xhdGUzZCgwLCAwLCAwKX0uc3RhZ2UtYW5pbS0tbGVhdmluZ3twb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDpjYWxjKDEwMCUgLSA0cmVtKX0uc3RhZ2UtYW5pbS0tbGVmdHtvcGFjaXR5OjA7dHJhbnNmb3JtOnRyYW5zbGF0ZTNkKC0yNHB4LCAwLCAwKX0uc3RhZ2UtYW5pbS0tcmlnaHR7b3BhY2l0eTowO3RyYW5zZm9ybTp0cmFuc2xhdGUzZCgyNHB4LCAwLCAwKX0uaGVhZGVye2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7cG9zaXRpb246cmVsYXRpdmV9LmhlYWRlcj4uaWNvbntib3JkZXItc3R5bGU6bm9uZTttYXJnaW4tbGVmdDowLjVyZW07bWFyZ2luLXJpZ2h0OjAuNXJlbTtwYWRkaW5nOjA7ZGlzcGxheTpmbGV4O2JhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnR9QG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNDgwcHgpey5zdGFnZXtwYWRkaW5nLWJvdHRvbTo2cmVtfX0uaGVhZGVyX190aXRsZXtmb250LXNpemU6MS4xMjVyZW07bWFyZ2luOjA7cGFkZGluZzowO2ZvbnQtd2VpZ2h0OjUwMH0uY29udGVudHtoZWlnaHQ6MTAwJX0ub25ib2FyZGluZ3stLWFyY2dpcy1pbmZvcm1hdGlvbi1taW4td2lkdGg6MH0ub25ib2FyZGluZ19fc2Nyb2xse292ZXJmbG93OmF1dG87bWF4LWhlaWdodDptaW4oNzAwcHgsIDYwdmgpfS5vbmJvYXJkaW5nX19zZWN0aW9ue3BhZGRpbmctYm90dG9tOjFyZW07cGFkZGluZy10b3A6MC41cmVtO3dpZHRoOjI1NXB4fS5vbmJvYXJkaW5nX190aXRsZXtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMSk7Zm9udC1zaXplOjAuODc1cmVtO3BhZGRpbmctdG9wOjA7bWFyZ2luOjA7Zm9udC13ZWlnaHQ6NjAwfS5vbmJvYXJkaW5nX19kZXNjcmlwdGlvbnttYXJnaW4tdG9wOjAuNXJlbTttYXJnaW4tYm90dG9tOjAuNzVyZW07Zm9udC1zaXplOjAuNzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpfS5tb2RhbHstLWNhbGNpdGUtbW9kYWwtd2lkdGg6MTA4MHB4Oy0tY2FsY2l0ZS1tb2RhbC1oZWlnaHQ6bWluKDkyMnB4LCA3NXZoKX0ubW9kYWwtLWdyZXl7LS1jYWxjaXRlLW1vZGFsLWNvbnRlbnQtcGFkZGluZzowOy0tY2FsY2l0ZS1tb2RhbC1jb250ZW50LWJhY2tncm91bmQ6dmFyKC0tY2FsY2l0ZS11aS1iYWNrZ3JvdW5kKX1cIjtcblxuY29uc3QgQU5JTUFUSU9OX0RVUkFUSU9OID0gMjAwO1xuY29uc3QgQXJjZ2lzTmV3SXRlbSA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy53b3JrZmxvd0NhbmNlbCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwid29ya2Zsb3dDYW5jZWxcIiwgNyk7XG4gICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJ3b3JrZmxvd0NvbXBsZXRlXCIsIDcpO1xuICAgIHRoaXMuc2hvd0JhY2tCdXR0b24gPSBmYWxzZTtcbiAgICB0aGlzLndvcmtmbG93Q29tcGxldGVkID0gZmFsc2U7XG4gICAgdGhpcy5jbG9zZURpYWxvZyA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHsgaWQsIGV4aXN0aW5nSXRlbSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgY29uc3QgZnJvbUV4aXN0aW5nSXRlbSA9ICEhZXhpc3RpbmdJdGVtICYmIHVpU3RvcmVTdGF0ZS53b3JrZmxvdyAhPT0gXCJhcHBlbmRcIjsgLy9kb24ndCB3YW50IHRvIGRlbGV0ZSBIRkwgaXRlbSBiZWZvcmUgbmV3IGZpbGUgaXMgdXBsb2FkZWQuXG4gICAgICAhdGhpcy53b3JrZmxvd0NvbXBsZXRlZCAmJiB0aGlzLmhhbmRsZUNhbmNlbChpZCwgZnJvbUV4aXN0aW5nSXRlbSk7XG4gICAgICB0aGlzLndvcmtmbG93Q29tcGxldGVkID0gZmFsc2U7XG4gICAgICByZXNldEFkZEl0ZW1TdG9yZXMoKTtcbiAgICAgIHRoaXMucGFnZUhpc3RvcnkgPSBbXCJob21lXCJdO1xuICAgICAgLy8gUmVzZXQgdG8gbWFrZSBzdXJlIGlmIHRoZSBtb2RhbCBpcyBvcGVuZWQgYWdhaW4sIGl0IHdpbGwgYmUgaW4gdGhlIGRlZmF1bHQgc3RhdGVcbiAgICAgIC8vICBhbmQgYW55IG5leHRUZXh0IGNoYW5nZSB3aWxsIHRyaWdnZXIgdGhlIGBvbkNoYW5nZSBwcm9wZXJseVxuICAgICAgdWlTdG9yZVN0YXRlLm5leHRUZXh0ID0gXCJuZXh0XCI7XG4gICAgICAvLyBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcC9pc3N1ZXMvNDMyODBcbiAgICAgIC8vIG1haW50YWluIGl0ZW0gaWQgb24gc2V0dGluZyBwYWdlIHJlZ2lzdGVyIGNhbmNlbFxuICAgICAgLy8gUjIgVE9ETzogaW1wcm92ZSBzdG9yZSBjbGVhbnVwL3JlaW5pdGlhbGl6YXRpb25cbiAgICAgIGlmICh0aGlzLndvcmtmbG93ID09PSBcInJlZ2lzdGVyXCIpIHtcbiAgICAgICAgYWRkSXRlbVN0YXRlLmlkID0gaWQ7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5leGlzdGluZ0l0ZW0gPSBleGlzdGluZ0l0ZW07XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZUNhbmNlbCA9IGFzeW5jIChpdGVtSWQsIGZyb21FeGlzdGluZ0l0ZW0pID0+IHtcbiAgICAgIGxldCBjYW5jZWxQYXlsb2FkO1xuICAgICAgY29uc3QgeyBvdmVyd3JpdGVQYXlsb2FkIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICBpZiAob3ZlcndyaXRlUGF5bG9hZCkge1xuICAgICAgICBjYW5jZWxQYXlsb2FkID0gb3ZlcndyaXRlUGF5bG9hZDtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBhd2FpdCBzdWJzY3JpcHRpb25TdGF0ZS51bnN1YnNjcmliZUFsbCgpO1xuICAgICAgICBhd2FpdCBoYW5kbGVEZWxldGVJdGVtKGl0ZW1JZCwgZnJvbUV4aXN0aW5nSXRlbSk7XG4gICAgICB9XG4gICAgICB0aGlzLndvcmtmbG93Q2FuY2VsLmVtaXQoY2FuY2VsUGF5bG9hZCk7XG4gICAgICBjb25zdCB0ZWxlbWV0cnkgPSBjb25maWdTdGF0ZS50ZWxlbWV0cnk7XG4gICAgICAodGVsZW1ldHJ5ID09PSBudWxsIHx8IHRlbGVtZXRyeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVsZW1ldHJ5LmdldFdvcmtmbG93KFwibmV3IGl0ZW0gdXBsb2FkXCIpKSAmJlxuICAgICAgICAodGVsZW1ldHJ5ID09PSBudWxsIHx8IHRlbGVtZXRyeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVsZW1ldHJ5LmNhbmNlbFdvcmtmbG93KFwibmV3IGl0ZW0gdXBsb2FkXCIsIHtcbiAgICAgICAgICBkZXRhaWxzOiBhZGRJdGVtU3RhdGUudHlwZVxuICAgICAgICB9KSk7XG4gICAgfTtcbiAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5hcGkgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jb25maWcgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy50ZWxlbWV0cnkgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5maWxlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZmlyc3RTdGVwID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaW5pdGlhbEZvbGRlciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICB0aGlzLmxheWVySWQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sYXllciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmV4aXN0aW5nSXRlbSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmV4aXN0aW5nSXRlbVR5cGUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5leGlzdGluZ0l0ZW1QdWJsaXNoVHlwZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLndvcmtmbG93ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuYWxsb3dlZEl0ZW1UeXBlcyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmFsbG93ZWRNb2RlcyA9IFsuLi5BTExfTkVXX0lURU1fTU9ERVNdO1xuICAgIHRoaXMuYWxsb3dQdWJsaXNoID0gdHJ1ZTtcbiAgICB0aGlzLnBhZ2VIaXN0b3J5ID0gW1wiaG9tZVwiXTtcbiAgICB0aGlzLmluaXRpYWxQYWdlID0gXCJkZWZhdWx0XCI7XG4gICAgdGhpcy5uYXZFbmFibGVkID0gdHJ1ZTtcbiAgICB0aGlzLnRyYW5zaXRpb24gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy50YXJnZXRIZWlnaHQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5vdXRlckhlaWdodCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnByaW1hcnlCdXR0b25UZXh0ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubm9QYWRkaW5nID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgdGhpcy5sb2FkaW5nVGV4dCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmRpc2FibGVDbG9zZUJ1dHRvbiA9IGZhbHNlO1xuICAgIHRoaXMuaGVhZGVySWNvblJlZiA9IHVuZGVmaW5lZDtcbiAgfVxuICBkaXNhYmxlTmF2QnV0dG9ucyhldmVudCkge1xuICAgIHRoaXMubmF2RW5hYmxlZCA9IGV2ZW50LmRldGFpbDtcbiAgfVxuICBkaXNhYmxlQ2xvc2VCdXR0b25zKGV2ZW50KSB7XG4gICAgLy9kaXNhYmxlcyBcIkNhbmNlbFwiIGFuZCBcInhcIiBidXR0b25zIG9uIG1vZGFsXG4gICAgaWYgKHRoaXMuaXNEaXNhYmxlQ2xvc2VQYWdlKHRoaXMucGFnZUhpc3RvcnlbdGhpcy5wYWdlSGlzdG9yeS5sZW5ndGggLSAxXSkpIHtcbiAgICAgIHRoaXMuZGlzYWJsZUNsb3NlQnV0dG9uID0gZXZlbnQuZGV0YWlsO1xuICAgIH1cbiAgfVxuICBoYW5kbGVSZWRpcmVjdCh7IGRldGFpbCB9KSB7XG4gICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgIHJlc3BvbnNlOiB7IHN1Y2Nlc3M6IHRydWUsIGlkOiBudWxsLCBmb2xkZXI6IG51bGwgfSxcbiAgICAgIHR5cGU6IGRldGFpbC50eXBlXG4gICAgfTtcbiAgICBpZiAoZGV0YWlsLnVybCkge1xuICAgICAgcGF5bG9hZC51cmwgPSBkZXRhaWwudXJsO1xuICAgICAgcGF5bG9hZC5jdXN0b21QYXJhbWV0ZXJzID0gZGV0YWlsLmN1c3RvbVBhcmFtZXRlcnM7XG4gICAgICBwYXlsb2FkLmxheWVycyA9IGRldGFpbC5sYXllcnM7XG4gICAgfVxuICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZS5lbWl0KHBheWxvYWQpO1xuICAgIHRoaXMuaXNBY3RpdmUgPSBmYWxzZTtcbiAgfVxuICBoYW5kbGVXb3JrZmxvd0NvbXBsZXRlKCkge1xuICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZWQgPSB0cnVlO1xuICAgIGlmICh1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCIpIHtcbiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICAgIHRoaXMubG9hZGluZ1RleHQgPSB0aGlzLmkxOG4uY3JlYXRpbmdMYXllcjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7XG4gICAgfVxuICB9XG4gIGFzeW5jIGdvVG9OZXh0UGFnZShldmVudCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIC8vIFJlc2V0IGluIGNhc2Ugd2UgZm9yZ2V0IHRvIHNldCBpdFxuICAgIHVpU3RvcmVTdGF0ZS5uZXh0VGV4dCA9IFwibmV4dFwiO1xuICAgIHRoaXMudHJhbnNpdGlvbiA9IFwiZm9yd2FyZFwiO1xuICAgIHRoaXMucGFnZUhpc3RvcnkgPSBbLi4udGhpcy5wYWdlSGlzdG9yeSwgZXZlbnQuZGV0YWlsXTtcbiAgICB0aGlzLnRhcmdldEhlaWdodCA9IG51bGw7XG4gICAgdGhpcy5vdXRlckhlaWdodCA9IHRoaXMuY29udGVudFNsb3Qub2Zmc2V0SGVpZ2h0O1xuICAgIHRoaXMuY2xlYW5QYWdlSGlzdG9yeSgpO1xuICAgIGNvbnN0IG9sZFBhZ2UgPSB0aGlzLmN1cnJlbnRTY3JlZW47XG4gICAgY29uc3QgbmV3UGFnZSA9IHBhZ2VzW2V2ZW50LmRldGFpbF07XG4gICAgY29uc3Qgb2xkUGFnZUhlaWdodCA9IHRoaXMuZWwucXVlcnlTZWxlY3RvcihvbGRQYWdlKS5jbGllbnRIZWlnaHQ7XG4gICAgY29uc3QgY29udGVudENvbnRhaW5lciA9IChfYSA9IHRoaXMubW9kYWxSZWYpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoXCIuY29udGVudFwiKTtcbiAgICBpZiAoY29udGVudENvbnRhaW5lcikge1xuICAgICAgY29udGVudENvbnRhaW5lci5zdHlsZS5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XG4gICAgfVxuICAgIGF3YWl0IHRpbWVvdXQoQU5JTUFUSU9OX0RVUkFUSU9OKTtcbiAgICBjb25zdCBuZXdQYWdlSGVpZ2h0ID0gKF9iID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yKG5ld1BhZ2UpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuY2xpZW50SGVpZ2h0O1xuICAgIGlmIChuZXdQYWdlSGVpZ2h0KSB7XG4gICAgICB0aGlzLnRhcmdldEhlaWdodCA9IG9sZFBhZ2VIZWlnaHQ7XG4gICAgICB0aGlzLm91dGVySGVpZ2h0ID0gbnVsbDtcbiAgICAgIGF3YWl0IHRpbWVvdXQoQU5JTUFUSU9OX0RVUkFUSU9OKTtcbiAgICAgIHRoaXMudGFyZ2V0SGVpZ2h0ID0gbmV3UGFnZUhlaWdodDtcbiAgICB9XG4gICAgYXdhaXQgdGltZW91dChBTklNQVRJT05fRFVSQVRJT04pO1xuICAgIHRoaXMudGFyZ2V0SGVpZ2h0ID0gbnVsbDtcbiAgICB0aGlzLnRyYW5zaXRpb24gPSBudWxsO1xuICAgIGF3YWl0IHRpbWVvdXQoQU5JTUFUSU9OX0RVUkFUSU9OKTtcbiAgICBpZiAoY29udGVudENvbnRhaW5lcikge1xuICAgICAgY29udGVudENvbnRhaW5lci5zdHlsZS5vdmVyZmxvd1kgPSBcImF1dG9cIjtcbiAgICB9XG4gICAgY29uc3QgdHJhbnNpdGlvbkNvbXBsZXRlRXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoXCJhcmNnaXNUcmFuc2l0aW9uQ29tcGxldGVcIik7XG4gICAgKF9jID0gdGhpcy5jdXJyZW50UGFnZUVsKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZGlzcGF0Y2hFdmVudCh0cmFuc2l0aW9uQ29tcGxldGVFdmVudCk7XG4gICAgdGhpcy5mb2N1c0ZpcnN0RWxlbWVudCgpO1xuICB9XG4gIGFzeW5jIGdvVG9QcmV2aW91c1BhZ2UoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgLy8gUmVzZXQgaW4gY2FzZSB3ZSBmb3JnZXQgdG9cbiAgICB1aVN0b3JlU3RhdGUubmV4dFRleHQgPSBcIm5leHRcIjtcbiAgICBjb25zdCB7IHBhZ2VIaXN0b3J5IH0gPSB0aGlzO1xuICAgIHRoaXMudHJhbnNpdGlvbiA9IFwiYmFja1wiO1xuICAgIHRoaXMudGFyZ2V0SGVpZ2h0ID0gbnVsbDtcbiAgICB0aGlzLm91dGVySGVpZ2h0ID0gdGhpcy5jb250ZW50U2xvdC5vZmZzZXRIZWlnaHQ7XG4gICAgY29uc3Qgb2xkUGFnZSA9IHBhZ2VzW3BhZ2VIaXN0b3J5W3BhZ2VIaXN0b3J5Lmxlbmd0aCAtIDFdXSB8fCBwYWdlcy5kZWZhdWx0O1xuICAgIGNvbnN0IG5ld1BhZ2UgPSBwYWdlc1twYWdlSGlzdG9yeVtwYWdlSGlzdG9yeS5sZW5ndGggLSAyXV0gfHwgcGFnZXMuZGVmYXVsdDtcbiAgICBjb25zdCBvbGRQYWdlSGVpZ2h0ID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yKG9sZFBhZ2UpLmNsaWVudEhlaWdodDtcbiAgICBjb25zdCBjb250ZW50Q29udGFpbmVyID0gKF9hID0gdGhpcy5tb2RhbFJlZikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihcIi5jb250ZW50XCIpO1xuICAgIGlmIChjb250ZW50Q29udGFpbmVyKSB7XG4gICAgICBjb250ZW50Q29udGFpbmVyLnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcbiAgICB9XG4gICAgYXdhaXQgdGltZW91dChBTklNQVRJT05fRFVSQVRJT04pO1xuICAgIGNvbnN0IG5ld1BhZ2VIZWlnaHQgPSAoX2IgPSB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IobmV3UGFnZSkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jbGllbnRIZWlnaHQ7XG4gICAgaWYgKG5ld1BhZ2VIZWlnaHQpIHtcbiAgICAgIHRoaXMudGFyZ2V0SGVpZ2h0ID0gb2xkUGFnZUhlaWdodDtcbiAgICAgIHRoaXMub3V0ZXJIZWlnaHQgPSBudWxsO1xuICAgICAgYXdhaXQgdGltZW91dChBTklNQVRJT05fRFVSQVRJT04pO1xuICAgICAgdGhpcy50YXJnZXRIZWlnaHQgPSBuZXdQYWdlSGVpZ2h0O1xuICAgIH1cbiAgICBhd2FpdCB0aW1lb3V0KEFOSU1BVElPTl9EVVJBVElPTik7XG4gICAgdGhpcy50YXJnZXRIZWlnaHQgPSBudWxsO1xuICAgIHRoaXMudHJhbnNpdGlvbiA9IG51bGw7XG4gICAgdGhpcy5wYWdlSGlzdG9yeSA9IHRoaXMucGFnZUhpc3RvcnkubGVuZ3RoID09PSAxID8gdGhpcy5wYWdlSGlzdG9yeS5zbGljZSgwLCAxKSA6IHRoaXMucGFnZUhpc3Rvcnkuc2xpY2UoMCwgLTEpO1xuICAgIGF3YWl0IHRpbWVvdXQoQU5JTUFUSU9OX0RVUkFUSU9OKTtcbiAgICBpZiAoY29udGVudENvbnRhaW5lcikge1xuICAgICAgY29udGVudENvbnRhaW5lci5zdHlsZS5vdmVyZmxvd1kgPSBcImF1dG9cIjtcbiAgICB9XG4gICAgY29uc3QgdHJhbnNpdGlvbkNvbXBsZXRlRXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoXCJhcmNnaXNUcmFuc2l0aW9uQ29tcGxldGVcIik7XG4gICAgKF9jID0gdGhpcy5jdXJyZW50UGFnZUVsKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZGlzcGF0Y2hFdmVudCh0cmFuc2l0aW9uQ29tcGxldGVFdmVudCk7XG4gICAgdGhpcy5mb2N1c0ZpcnN0RWxlbWVudCgpO1xuICB9XG4gIHVwZGF0ZUFjdGl2ZShhY3RpdmUpIHtcbiAgICBpZiAoYWN0aXZlICYmIHRoaXMuZmlyc3RTdGVwKSB7XG4gICAgICB0aGlzLnBhZ2VIaXN0b3J5ID0gW3RoaXMuZmlyc3RTdGVwXTtcbiAgICB9XG4gIH1cbiAgdXBkYXRlRmlyc3RTdGVwKHBhZ2UpIHtcbiAgICB0aGlzLnBhZ2VIaXN0b3J5ID0gW3BhZ2VdO1xuICB9XG4gIGluaXRpYWxpemVXaXRoRmlsZSgpIHtcbiAgICBjb25zdCB7IHVzZXIsIHBvcnRhbCB9ID0gY29uZmlnU3RhdGU7XG4gICAgY29uc3QgeyBmaWxlIH0gPSB0aGlzO1xuICAgIGlmIChmaWxlKSB7XG4gICAgICBjb25zdCBleHRlbnNpb24gPSBoYW5kbGVJbml0V2l0aEZpbGUoZmlsZSk7XG4gICAgICBpZiAoZXh0ZW5zaW9uID09PSBcInppcFwiKSB7XG4gICAgICAgIHRoaXMucGFnZUhpc3RvcnkgPSBbXCJob21lXCIsIFwiemlwU2VsZWN0XCJdO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCB7IG5leHRTdGVwLCB0eXBlIH0gPSBhbmFseXplSXRlbUZvck5leHRTdGVwKGV4dGVuc2lvbik7XG4gICAgICB0aGlzLnBvc3Rwcm9jZXNzQWRkRnJvbUZpbGUodHlwZSk7XG4gICAgICAvLyB0aGVyZSBpcyBubyByZWFzb24gdG8gc2hvdyBwdWJsaXNoU2VsZWN0IHNjcmVlbiBmb3IgdXNlcnMgdGhhdCBjYW4ndCBwdWJsaXNoXG4gICAgICBpZiAoIWNhblB1Ymxpc2hUeXBlKHVzZXIsIHR5cGUsIHBvcnRhbCkgJiYgbmV4dFN0ZXAgPT09IFwicHVibGlzaFNlbGVjdFwiKSB7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5lbmFibGVQdWJsaXNoaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMucGFnZUhpc3RvcnkgPSBbXCJob21lXCIsIFwiaXRlbVByb3BlcnRpZXNcIl07XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5wYWdlSGlzdG9yeSA9IFtcImhvbWVcIiwgbmV4dFN0ZXBdO1xuICAgICAgfVxuICAgICAgbG9nSW5pdFdpdGhGaWxlKCk7XG4gICAgfVxuICB9XG4gIHBvc3Rwcm9jZXNzQWRkRnJvbUZpbGUodHlwZSkge1xuICAgIGFkZEl0ZW1TdGF0ZS50aWxlTGF5ZXJQdWJsaXNoVHlwZSA9IHR5cGUgPT09IFwiM0RUaWxlcyBQYWNrYWdlXCIgPyBcIjNkVGlsZXNcIiA6IHVuZGVmaW5lZDtcbiAgfVxuICB1cGRhdGVJbml0aWFsRm9sZGVyKGZvbGRlcikge1xuICAgIGNvbmZpZ1N0YXRlLmluaXRpYWxGb2xkZXIgPSBmb2xkZXI7XG4gIH1cbiAgZm9jdXNGaXJzdEVsZW1lbnQoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IGN1clBhZ2UgPSB0aGlzLmN1cnJlbnRQYWdlRWw7XG4gICAgaWYgKGN1clBhZ2UgJiYgIWN1clBhZ2UubWFuYWdlZEZvY3VzKSB7XG4gICAgICAoX2EgPSB0aGlzLm1vZGFsUmVmKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICB9XG4gIH1cbiAgcmVtb3ZlUGFnZUZyb21IaXN0b3J5KHBhZ2UpIHtcbiAgICBjb25zdCB7IHBhZ2VIaXN0b3J5IH0gPSB0aGlzO1xuICAgIGlmIChwYWdlSGlzdG9yeS5sZW5ndGggPiAxICYmIHBhZ2VIaXN0b3J5LmluY2x1ZGVzKHBhZ2UpICYmIHBhZ2VIaXN0b3J5LmF0KC0xKSAhPT0gcGFnZSkge1xuICAgICAgcGFnZUhpc3Rvcnkuc3BsaWNlKHBhZ2VIaXN0b3J5LmluZGV4T2YocGFnZSksIDEpO1xuICAgIH1cbiAgfVxuICBjbGVhblBhZ2VIaXN0b3J5KCkge1xuICAgIGNvbnN0IHsgbmV3SXRlbU1vZGUsIHR5cGUsIGV4Y2VsTGF5ZXJzLCBleGlzdGluZ0l0ZW0sIGNsb3VkUHJvdmlkZXJSZXNvdXJjZSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIGNvbnN0IHByZXZQYWdlID0gdGhpcy5wYWdlSGlzdG9yeVt0aGlzLnBhZ2VIaXN0b3J5Lmxlbmd0aCAtIDJdO1xuICAgIGNvbnN0IGlzTXVsdGlwYWdlRXhjZWwgPSB0eXBlID09PSBcIk1pY3Jvc29mdCBFeGNlbFwiICYmIChleGNlbExheWVycyA9PT0gbnVsbCB8fCBleGNlbExheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXhjZWxMYXllcnMubGVuZ3RoKSA+IDE7XG4gICAgY29uc3QgZGlyZWN0TW9kZSA9IHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIjtcbiAgICBpZiAoY2FuU2tpcFB1Ymxpc2hTZWxlY3RUb05leHRQYWdlKHtcbiAgICAgIGRpcmVjdE1vZGUsXG4gICAgICBpc011bHRpcGFnZUV4Y2VsLFxuICAgICAgbmV3SXRlbU1vZGUsXG4gICAgICBpdGVtVHlwZTogdHlwZSxcbiAgICAgIGNsb3VkOiAhIWNsb3VkUHJvdmlkZXJSZXNvdXJjZSxcbiAgICAgIC8vICMzODQ4MTogQWZ0ZXIgYSBDU1YvSnNvbiBoYXMgYmVlbiBhbmFseXplZCBmb3IgcHVibGlzaCwgcmVtb3ZlIHB1Ymxpc2hTZWxlY3QgZnJvbSBoaXN0b3J5XG4gICAgICAvLyBFeGNlbCBmaWxlcyB3aXRoIG11bHRpcGxlIHNoZWV0cyBzaG91bGQgc3RpbGwgaGF2ZSBhY2Nlc3NcbiAgICAgIGZyb21FeGlzdGluZ0l0ZW06ICEhZXhpc3RpbmdJdGVtLFxuICAgICAgY2FuUHVibGlzaEl0ZW1UeXBlOiBjYW5QdWJsaXNoVHlwZShjb25maWdTdGF0ZS51c2VyLCB0eXBlLCBjb25maWdTdGF0ZS5wb3J0YWwpXG4gICAgfSkgJiZcbiAgICAgIHByZXZQYWdlID09PSBcInB1Ymxpc2hTZWxlY3RcIikge1xuICAgICAgdGhpcy5yZW1vdmVQYWdlRnJvbUhpc3RvcnkoXCJwdWJsaXNoU2VsZWN0XCIpO1xuICAgIH1cbiAgfVxuICBhc3luYyBpbml0aWFsaXplV2l0aEV4aXN0aW5nSXRlbSgpIHtcbiAgICBjb25zdCBpdGVtID0gdGhpcy5leGlzdGluZ0l0ZW07XG4gICAgY29uc3QgZXhpc3RpbmdJdGVtVHlwZSA9IHRoaXMuZXhpc3RpbmdJdGVtVHlwZTtcbiAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgYXdhaXQgaW5pdGlhbGl6ZVdpdGhFeGlzdGluZ0l0ZW0oaXRlbSwge1xuICAgICAgZXhpc3RpbmdJdGVtVHlwZSxcbiAgICAgIHBvcnRhbDogY29uZmlnU3RhdGUucG9ydGFsLFxuICAgICAgZXhpc3RpbmdJdGVtUHVibGlzaFR5cGU6IHRoaXMuZXhpc3RpbmdJdGVtUHVibGlzaFR5cGVcbiAgICB9KTtcbiAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgIGNvbnN0IHR5cGUgPSBpdGVtLnR5cGU7XG4gICAgaWYgKHRoaXMud29ya2Zsb3cgPT09IFwiYXBwZW5kXCIpIHtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5sYXllcklkID0gdGhpcyA9PT0gbnVsbCB8fCB0aGlzID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0aGlzLmxheWVySWQ7XG4gICAgICBhZGRJdGVtU3RhdGUuc3VibGF5ZXIgPSB0aGlzID09PSBudWxsIHx8IHRoaXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRoaXMubGF5ZXI7XG4gICAgICB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPSBcImFwcGVuZFwiO1xuICAgICAgdGhpcy5pbml0aWFsUGFnZSA9IFwiYXBwZW5kU2VsZWN0XCI7XG4gICAgICB0aGlzLnBhZ2VIaXN0b3J5ID0gW3RoaXMuaW5pdGlhbFBhZ2VdO1xuICAgIH1cbiAgICBlbHNlIGlmICh0aGlzLndvcmtmbG93ID09PSBcInVwZGF0ZVwiKSB7XG4gICAgICB0aGlzLnBhZ2VIaXN0b3J5ID0gW1wiZGF0YVVwbG9hZFwiXTtcbiAgICB9XG4gICAgZWxzZSBpZiAoW1wiQ1NWXCIsIFwiTWljcm9zb2Z0IEV4Y2VsXCJdLmluY2x1ZGVzKHR5cGUpKSB7XG4gICAgICB0aGlzLnBhZ2VIaXN0b3J5ID0gW1wicHVibGlzaFNlbGVjdFwiXTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZXhpc3RpbmdJdGVtVHlwZSA9PT0gXCJ0aWxlTGF5ZXJcIikge1xuICAgICAgdGhpcy5wYWdlSGlzdG9yeSA9IFtcInRpbGVMYXllclNldHRpbmdzXCJdO1xuICAgIH1cbiAgICBlbHNlIGlmICh0aGlzLndvcmtmbG93ID09PSBcInJlZ2lzdGVyXCIpIHtcbiAgICAgIC8vIFRPRE86IHJld29yayB0aGlzIG9uY2UgU3RldmVuIHB1Ymxpc2ggaGlzIGR1YnN0ZXAgZGlhZ3JhbVxuICAgICAgdGhpcy5wYWdlSGlzdG9yeSA9IFtcImRldmVsb3BlckNyZWRlbnRpYWxzU2VsZWN0XCJdO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMucGFnZUhpc3RvcnkgPSBbXCJpdGVtUHJvcGVydGllc1wiXTtcbiAgICB9XG4gIH1cbiAgdHJpZ2dlclBhZ2VUcmFuc2l0aW9uKGV2ZW50VHlwZSkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBldmVudCA9IG5ldyBDdXN0b21FdmVudChldmVudFR5cGUsIHsgY2FuY2VsYWJsZTogdHJ1ZSB9KTtcbiAgICBjb25zdCBldmVudE5vdENhbmNlbGxlZCA9IChfYSA9IHRoaXMuY3VycmVudFBhZ2VFbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuICAgIGlmIChldmVudE5vdENhbmNlbGxlZCAmJiBldmVudFR5cGUgPT09IFwiYXJjZ2lzTmV3SXRlbVBhZ2VQcmV2XCIpIHtcbiAgICAgIHRoaXMuZ29Ub1ByZXZpb3VzUGFnZSgpO1xuICAgIH1cbiAgfVxuICAvKiogVXBkYXRlIHRoZSBjb21wb25lbnQgaW4gdGhlIG1vZGFsJ3Mgc2xvdCB3aGVuIGEgc3RhdGUgY2hhbmdlIGlzIGRldGVjdGVkICovXG4gIGRpc3BsYXlQYWdlKCkge1xuICAgIGlmICghdGhpcy5pc0FjdGl2ZSkge1xuICAgICAgLy8gTm8gcG9pbnQgb2YgcmVuZGVyaW5nIGVsZW1lbnRzIG9uIHRoZSBzY3JlZW4gaWYgbW9kYWwgaXMgbm90IGFjdGl2ZVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB7IHRyYW5zaXRpb24sIHBhZ2VIaXN0b3J5LCBpbml0aWFsUGFnZSB9ID0gdGhpcztcbiAgICBjb25zdCBmb3J3YXJkID0gdHJhbnNpdGlvbiA9PT0gXCJmb3J3YXJkXCI7XG4gICAgY29uc3QgYmFjayA9IHRyYW5zaXRpb24gPT09IFwiYmFja1wiO1xuICAgIGNvbnN0IG5leHQgPSBiYWNrID8gcGFnZUhpc3RvcnlbcGFnZUhpc3RvcnkubGVuZ3RoIC0gMl0gOiBwYWdlSGlzdG9yeVtwYWdlSGlzdG9yeS5sZW5ndGggLSAxXTtcbiAgICAvLyBUT0RPOiBzdHJpY3RseSB0eXBlIHRoaXNcbiAgICBjb25zdCBOZXh0U2NyZWVuID0gYCR7cGFnZXNbbmV4dF0gfHwgcGFnZXNbaW5pdGlhbFBhZ2VdfWA7XG4gICAgY29uc3QgQ3VycmVudFNjcmVlbiA9IHRoaXMuY3VycmVudFNjcmVlbjtcbiAgICBpZiAoQ3VycmVudFNjcmVlbiAmJiBwYWdlSGlzdG9yeS5sZW5ndGggPiAxICYmIHRyYW5zaXRpb24pIHtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIGgoQ3VycmVudFNjcmVlbiwgeyBjbGFzczoge1xuICAgICAgICAgICAgc3RhZ2U6IHRydWUsXG4gICAgICAgICAgICBcInN0YWdlLS1mdWxsc2NyZWVuXCI6IHRoaXMuaXNGdWxsU2NyZWVuUGFnZShDdXJyZW50U2NyZWVuKSxcbiAgICAgICAgICAgIFwic3RhZ2UtYW5pbVwiOiB0cnVlLFxuICAgICAgICAgICAgXCJzdGFnZS1hbmltLS1sZWF2aW5nXCI6IHRydWUsXG4gICAgICAgICAgICBcInN0YWdlLWFuaW0tLWxlZnRcIjogZm9yd2FyZCxcbiAgICAgICAgICAgIFwic3RhZ2UtYW5pbS0tcmlnaHRcIjogYmFja1xuICAgICAgICAgIH0gfSksXG4gICAgICAgIGgoTmV4dFNjcmVlbiwgeyBjbGFzczoge1xuICAgICAgICAgICAgc3RhZ2U6IHRydWUsXG4gICAgICAgICAgICBcInN0YWdlLS1mdWxsc2NyZWVuXCI6IHRoaXMuaXNGdWxsU2NyZWVuUGFnZShOZXh0U2NyZWVuKSxcbiAgICAgICAgICAgIFwic3RhZ2UtYW5pbVwiOiB0cnVlLFxuICAgICAgICAgICAgXCJzdGFnZS1hbmltLS1sZWZ0XCI6IGJhY2ssXG4gICAgICAgICAgICBcInN0YWdlLWFuaW0tLXJpZ2h0XCI6IGZvcndhcmRcbiAgICAgICAgICB9LCBzdHlsZTogeyBoZWlnaHQ6IGAke3RoaXMudGFyZ2V0SGVpZ2h0fXB4YCB9LCByZWY6IChlbCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZUVsID0gZWw7XG4gICAgICAgICAgICAoX2EgPSB0aGlzLm1vZGFsUmVmKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudXBkYXRlRm9jdXNUcmFwRWxlbWVudHMoKTtcbiAgICAgICAgICB9IH0pXG4gICAgICBdO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuY3VycmVudFNjcmVlbiA9IE5leHRTY3JlZW47XG4gICAgfVxuICAgIGNvbnN0IHN0eWxlID0gdGhpcy50YXJnZXRIZWlnaHQgPyB7IGhlaWdodDogYCR7dGhpcy50YXJnZXRIZWlnaHR9cHhgIH0gOiB7fTtcbiAgICByZXR1cm4gKGgoTmV4dFNjcmVlbiwgeyBjbGFzczoge1xuICAgICAgICBzdGFnZTogdHJ1ZSxcbiAgICAgICAgXCJzdGFnZS0tZnVsbHNjcmVlblwiOiB0aGlzLmlzRnVsbFNjcmVlblBhZ2UoTmV4dFNjcmVlbilcbiAgICAgIH0sIHN0eWxlOiBzdHlsZSwgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgdGhpcy5jdXJyZW50UGFnZUVsID0gZWw7XG4gICAgICB9IH0pKTtcbiAgfVxuICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICB0aGlzLmNsb3NlRGlhbG9nKCk7XG4gIH1cbiAgLyoqIEluaXRpYWxpemUgdGhlIGl0ZW1Qcm9wZXJ0aWVzU3RvcmUgd2l0aCBkYXRhIGZyb20gcHJvcHMgb24gbG9hZCAqL1xuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBjb25zdCB7IGZpbGUsIHBvcnRhbCwgYXBpLCB1c2VyLCBjb25maWcsIHRlbGVtZXRyeSwgZXhpc3RpbmdJdGVtLCBmaXJzdFN0ZXAsIHdvcmtmbG93LCBpbml0aWFsRm9sZGVyIH0gPSB0aGlzO1xuICAgIGNvbnN0IGxvY2FsZSA9IGF3YWl0IGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3ModGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gbG9jYWxlWzBdO1xuICAgIHVpU3RvcmVTdGF0ZS5pMThuID0gbG9jYWxlWzBdO1xuICAgIGNvbmZpZ1N0YXRlLmxhbmcgPSBsb2NhbGVbMV07XG4gICAgdGhpcy5wcmltYXJ5QnV0dG9uVGV4dCA9IHRoaXMuaTE4bi5uZXh0O1xuICAgIHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9IHdvcmtmbG93O1xuICAgIGNvbmZpZ1N0YXRlLnBvcnRhbCA9IHBvcnRhbDtcbiAgICBpZiAoISF1c2VyKSB7XG4gICAgICBjb25zdCB7IGVycm9yLCByZXN1bHQ6IF9pc1BvcnRhbEJhY2tlZEJ5U0RTIH0gPSBhd2FpdCBmcm9tQ2FjaGUoKCkgPT4gaXNQb3J0YWxCYWNrZWRCeVNEUyhwb3J0YWwsIHVzZXIpLCBcImlzUG9ydGFsQmFja2VkQnlTRFNcIiwgcG9ydGFsLmlkKTtcbiAgICAgIGlmICghZXJyb3IpIHtcbiAgICAgICAgY29uZmlnU3RhdGUucG9ydGFsLmlzQmFja2VkQnlTRFMgPSBfaXNQb3J0YWxCYWNrZWRCeVNEUztcbiAgICAgIH1cbiAgICB9XG4gICAgY29uZmlnU3RhdGUuYXBpID0gYXBpO1xuICAgIGNvbmZpZ1N0YXRlLmNvbmZpZyA9IGNvbmZpZztcbiAgICBjb25maWdTdGF0ZS5hbGxvd2VkSXRlbVR5cGVzID0gdGhpcy5hbGxvd2VkSXRlbVR5cGVzO1xuICAgIGNvbmZpZ1N0YXRlLmFsbG93ZWRNb2RlcyA9IHRoaXMuYWxsb3dlZE1vZGVzO1xuICAgIGNvbmZpZ1N0YXRlLmFsbG93UHVibGlzaCA9IHRoaXMuYWxsb3dQdWJsaXNoO1xuICAgIGNvbmZpZ1N0YXRlLnRlbGVtZXRyeSA9IHRlbGVtZXRyeTtcbiAgICBjb25maWdTdGF0ZS5jb25maWcuaGVscEJhc2UgPSAoX2EgPSBjb25maWcgPT09IG51bGwgfHwgY29uZmlnID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWcuaGVscEJhc2UpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHBvcnRhbC5oZWxwQmFzZTtcbiAgICBjb25maWdTdGF0ZS5pbml0aWFsRm9sZGVyID0gaW5pdGlhbEZvbGRlcjtcbiAgICBpZiAoISgoX2IgPSBjb25maWdTdGF0ZS5jb25maWcpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5oZWxwTWFwKSkge1xuICAgICAgY29uc3QgaGVscFJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChgJHtjb25maWcucmVzdEJhc2VVcmx9L3BvcnRhbHMvaGVscG1hcD9jdWx0dXJlPSR7Y29uZmlnU3RhdGUubGFuZ31gKTtcbiAgICAgIGNvbmZpZ1N0YXRlLmNvbmZpZy5oZWxwTWFwID0gaGVscFJlc3BvbnNlID09PSBudWxsIHx8IGhlbHBSZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaGVscFJlc3BvbnNlLmhlbHBNYXAubTtcbiAgICB9XG4gICAgaWYgKHVzZXIpIHtcbiAgICAgIGNvbmZpZ1N0YXRlLnVzZXIgPSB1c2VyO1xuICAgICAgY29uZmlnU3RhdGUudXNlckxpY2Vuc2VkSXRlbXMgPVxuICAgICAgICAoX2MgPSB1c2VyLnVzZXJMaWNlbnNlZEl0ZW1zKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiAoYXdhaXQgZmV0Y2hVc2VyTGljZW5zZWRJdGVtcyhwb3J0YWwpKTtcbiAgICB9XG4gICAgaWYgKGZpbGUpIHtcbiAgICAgIHRoaXMuaW5pdGlhbGl6ZVdpdGhGaWxlKCk7XG4gICAgfVxuICAgIGlmIChleGlzdGluZ0l0ZW0pIHtcbiAgICAgIHRoaXMuaW5pdGlhbGl6ZVdpdGhFeGlzdGluZ0l0ZW0oKTtcbiAgICB9XG4gICAgaWYgKGZpcnN0U3RlcCkge1xuICAgICAgdGhpcy5wYWdlSGlzdG9yeSA9IFt0aGlzLmZpcnN0U3RlcF07XG4gICAgfVxuICAgIHVpU3RvcmUub25DaGFuZ2UoXCJkaXNhYmxlU2Nyb2xsXCIsICgpID0+IHtcbiAgICAgIHVpU3RvcmVTdGF0ZS5kaXNhYmxlU2Nyb2xsXG4gICAgICAgID8gdGhpcy5jb250ZW50U2xvdC5jbGFzc0xpc3QuYWRkKFwic3RhZ2UtLWRpc2FibGUtc2Nyb2xsXCIpXG4gICAgICAgIDogdGhpcy5jb250ZW50U2xvdC5jbGFzc0xpc3QucmVtb3ZlKFwic3RhZ2UtLWRpc2FibGUtc2Nyb2xsXCIpO1xuICAgIH0pO1xuICAgIHVpU3RvcmUub25DaGFuZ2UoXCJuZXh0VGV4dFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCB7IGkxOG4gfSA9IHRoaXM7XG4gICAgICBsZXQgbmV4dFRleHQgPSBpMThuLm5leHQ7XG4gICAgICBzd2l0Y2ggKHVpU3RvcmVTdGF0ZS5uZXh0VGV4dCkge1xuICAgICAgICBjYXNlIFwiYWRkVG9NYXBcIjpcbiAgICAgICAgICBuZXh0VGV4dCA9IGkxOG4uY29tbW9uLmFkZFRvTWFwO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY3JlYXRlQW5kQWRkVG9NYXBcIjpcbiAgICAgICAgICBuZXh0VGV4dCA9IGkxOG4uY29tbW9uLmNyZWF0ZUFuZEFkZFRvTWFwO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwidXNlQXNCYXNlTWFwXCI6XG4gICAgICAgICAgbmV4dFRleHQgPSBpMThuLnVybFR5cGUudXNlQXNCYXNlTWFwO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwidXBkYXRlQXBwZW5kXCI6XG4gICAgICAgICAgbmV4dFRleHQgPSBpMThuLmNvbW1vbi51cGRhdGVBbmRDb21wbGV0ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImFkZEFuZENvbXBsZXRlXCI6XG4gICAgICAgICAgbmV4dFRleHQgPSBpMThuLmNvbW1vbi5hZGRBbmRDb21wbGV0ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInByb2NlZWRcIjpcbiAgICAgICAgICBuZXh0VGV4dCA9IGkxOG4uY29tbW9uLnByb2NlZWQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyZWdpc3RlclwiOlxuICAgICAgICAgIG5leHRUZXh0ID0gaTE4bi5jb21tb24ucmVnaXN0ZXI7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJzYXZlXCI6XG4gICAgICAgICAgbmV4dFRleHQgPSBpMThuLnNhdmU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjcmVhdGVDb25uZWN0aW9uXCI6XG4gICAgICAgICAgbmV4dFRleHQgPSBpMThuLmNvbW1vbi5jcmVhdGVDb25uZWN0aW9uO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwic2lnbkluQW5kT3ZlcndyaXRlXCI6XG4gICAgICAgICAgbmV4dFRleHQgPSBpMThuLmNvbW1vbi5zaWduSW5BbmRPdmVyd3JpdGU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJvdmVyd3JpdGVBbmRDb21wbGV0ZVwiOlxuICAgICAgICAgIG5leHRUZXh0ID0gaTE4bi5jb21tb24ub3ZlcndyaXRlQW5kQ29tcGxldGU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICB0aGlzLnByaW1hcnlCdXR0b25UZXh0ID0gbmV4dFRleHQ7XG4gICAgfSk7XG4gIH1cbiAgY29tcG9uZW50V2lsbFJlbmRlcigpIHtcbiAgICB0aGlzLnNob3dCYWNrQnV0dG9uID0gdGhpcy5wYWdlSGlzdG9yeS5sZW5ndGggPiAxO1xuICB9XG4gIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgdGhpcy5tb2RhbFJlZi5zZXRGb2N1cygpO1xuICB9XG4gIGNvbXBvbmVudERpZFJlbmRlcigpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IHNoYWRvd1Jvb3QgPSAoX2EgPSB0aGlzLm1vZGFsUmVmKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2hhZG93Um9vdDtcbiAgICAvLyBIZWxwIHRoZSB0b29sdGlwIHRvIGJlIG9uIHRvcCBvZiB0aGUgZm9vdGVyXG4gICAgaWYgKHNoYWRvd1Jvb3QpIHtcbiAgICAgIGNvbnN0IG1vZGFsSGVhZGVyID0gc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKFwiLmhlYWRlclwiKTtcbiAgICAgIGlmIChtb2RhbEhlYWRlcikge1xuICAgICAgICBtb2RhbEhlYWRlci5zdHlsZS56SW5kZXggPSBcIjNcIjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG1vZGFsRm9vdGVyID0gc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKFwiLmZvb3RlclwiKTtcbiAgICAgIGNvbnN0IG1vZGFsQ29udGVudCA9IHNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihcIi5jb250ZW50XCIpO1xuICAgICAgY29uc3QgbW9kYWwgPSBzaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxcIik7XG4gICAgICBjb25zdCBoaWRlRm9vdGVyID0gdGhpcy5jdXJyZW50U2NyZWVuID09PSBwYWdlcy5kZWZhdWx0O1xuICAgICAgY29uc3QgaXNIb21lID0gdGhpcy5jdXJyZW50U2NyZWVuID09PSBwYWdlc1t0aGlzLmluaXRpYWxQYWdlXTtcbiAgICAgIGlmIChtb2RhbEZvb3RlciAmJiBtb2RhbENvbnRlbnQpIHtcbiAgICAgICAgbW9kYWxGb290ZXIuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgICAgIG1vZGFsRm9vdGVyLnN0eWxlLmJvdHRvbSA9IFwiMFwiO1xuICAgICAgICBtb2RhbEZvb3Rlci5zdHlsZS52aXNpYmlsaXR5ID0gaGlkZUZvb3RlciA/IFwiaGlkZGVuXCIgOiBcInZpc2libGVcIjtcbiAgICAgICAgbW9kYWwuc3R5bGUucG9zaXRpb24gPSBcInJlbGF0aXZlXCI7XG4gICAgICAgIGlmIChpc0hvbWUpIHtcbiAgICAgICAgICBtb2RhbENvbnRlbnQuc3R5bGUucGFkZGluZ0JvdHRvbSA9IFwiNjVweFwiO1xuICAgICAgICAgIG1vZGFsLnN0eWxlLnBhZGRpbmdCb3R0b20gPSBcIjBcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBtb2RhbENvbnRlbnQuc3R5bGUucGFkZGluZ0JvdHRvbSA9IFwiMFwiO1xuICAgICAgICAgIG1vZGFsLnN0eWxlLnBhZGRpbmdCb3R0b20gPSBcIjY1cHhcIjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLm5vUGFkZGluZyA9IHRoaXMuaXNGdWxsU2NyZWVuUGFnZSh0aGlzLmN1cnJlbnRTY3JlZW4pO1xuICAgIChfYiA9IHRoaXMubW9kYWxSZWYpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi51cGRhdGVGb2N1c1RyYXBFbGVtZW50cygpO1xuICB9XG4gIGlzRnVsbFNjcmVlblBhZ2UocGFnZSkge1xuICAgIHJldHVybiBbXG4gICAgICBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1mZWF0dXJlLWxheWVyLWZyb20tdGVtcGxhdGVcIixcbiAgICAgIFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWZlYXR1cmUtbGF5ZXItZnJvbS1leGlzdGluZ1wiLFxuICAgICAgXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtdGlsZS1sYXllci1mcm9tLXN0b3JlXCIsXG4gICAgICBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1kYXRhLXN0b3JlLWxpc3RcIixcbiAgICAgIFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtYnJvd3NlclwiLFxuICAgICAgXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtdGlsZS1sYXllci1mcm9tLWV4aXN0aW5nXCIsXG4gICAgICBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1hcHBlbmQtc2VsZWN0LWxheWVyXCJcbiAgICBdLmluY2x1ZGVzKHBhZ2UpO1xuICB9XG4gIGlzRGlzYWJsZUNsb3NlUGFnZShwYWdlKSB7XG4gICAgY29uc3QgcGFnZVRvSGlkZUNsb3NlQnV0dG9uID0gW1xuICAgICAgXCJhcHBlbmRTZWxlY3RVcGRhdGVcIixcbiAgICAgIFwiY3N2TG9jYXRpb25GaWVsZHNcIixcbiAgICAgIFwiYXBwZW5kTWF0Y2hGaWVsZHNcIlxuICAgIF07XG4gICAgcmV0dXJuIHBhZ2VUb0hpZGVDbG9zZUJ1dHRvbi5pbmNsdWRlcyhwYWdlKTtcbiAgfVxuICBnZXRIZWFkZXJUaXRsZSgpIHtcbiAgICBjb25zdCB7IGkxOG4sIHBhZ2VIaXN0b3J5IH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgbmV3SXRlbU1vZGUsIGV4aXN0aW5nSXRlbSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIGlmICh1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCIpIHtcbiAgICAgIHJldHVybiBpMThuLmFkZExheWVyO1xuICAgIH1cbiAgICBpZiAodWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcInJlZ2lzdGVyXCIgJiYgZXhpc3RpbmdJdGVtKSB7XG4gICAgICByZXR1cm4gaTE4bi5jb21tb24ucmVnaXN0ZXI7XG4gICAgfVxuICAgIGlmIChuZXdJdGVtTW9kZSA9PT0gXCJyYXN0ZXJGdW5jdGlvblRlbXBsYXRlXCIpIHtcbiAgICAgIHJldHVybiBpMThuLmNyZWF0ZVJhc3RlckZ1bmN0aW9uVGVtcGxhdGU7XG4gICAgfVxuICAgIGNvbnN0IGN1clBhZ2UgPSAocGFnZUhpc3RvcnlbcGFnZUhpc3RvcnkubGVuZ3RoIC0gMV0gfHwgXCJcIikudG9Mb3dlckNhc2UoKTtcbiAgICBzd2l0Y2ggKHRydWUpIHtcbiAgICAgIGNhc2UgY3VyUGFnZS5pbmNsdWRlcyhcImZlYXR1cmVsYXllclwiKTpcbiAgICAgICAgcmV0dXJuIGkxOG4uY3JlYXRlRmVhdHVyZUxheWVyO1xuICAgICAgY2FzZSBjdXJQYWdlLmluY2x1ZGVzKFwidGlsZWxheWVyXCIpOlxuICAgICAgICByZXR1cm4gaTE4bi5jcmVhdGVUaWxlTGF5ZXI7XG4gICAgICBjYXNlIHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJ1cGRhdGVcIiAmJiAoZXhpc3RpbmdJdGVtID09PSBudWxsIHx8IGV4aXN0aW5nSXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXhpc3RpbmdJdGVtLnR5cGUpID09PSBcIlZlY3RvciBUaWxlIFNlcnZpY2VcIjpcbiAgICAgICAgcmV0dXJuIGkxOG4udXBkYXRlO1xuICAgICAgY2FzZSB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwiYXBwZW5kXCIgfHwgdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcInVwZGF0ZVwiOlxuICAgICAgICByZXR1cm4gaTE4bi5hcHBlbmRTZWxlY3QudXBkYXRlRGF0YTtcbiAgICAgIGNhc2UgbmV3SXRlbU1vZGUgPT09IFwic2NlbmVMYXllclwiOlxuICAgICAgICByZXR1cm4gaTE4bi5jcmVhdGVTY2VuZUxheWVyO1xuICAgICAgY2FzZSBuZXdJdGVtTW9kZSA9PT0gXCJ0aWxlTGF5ZXJcIjpcbiAgICAgICAgcmV0dXJuIGkxOG4uY3JlYXRlVGlsZUxheWVyO1xuICAgICAgY2FzZSBuZXdJdGVtTW9kZSA9PT0gXCJkYXRhU3RvcmVcIjpcbiAgICAgICAgcmV0dXJuIGkxOG4uYWRkRGF0YVN0b3JlO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGkxOG4ubmV3SXRlbTtcbiAgICB9XG4gIH1cbiAgcmVuZGVyT25ib2FyZGluZ1NlY3Rpb24oeyB0aXRsZSwgY29udGVudCwgYmFja2dyb3VuZCwgcGF0aCB9KSB7XG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwib25ib2FyZGluZ19fc2VjdGlvblwiIH0sIGgoXCJoNFwiLCB7IGNsYXNzOiBcIm9uYm9hcmRpbmdfX3RpdGxlXCIgfSwgdGl0bGUpLCBoKFwicFwiLCB7IGNsYXNzOiBcIm9uYm9hcmRpbmdfX2Rlc2NyaXB0aW9uXCIgfSwgY29udGVudCksIGgoXCJzdmdcIiwgeyB3aWR0aDogXCIyNTVcIiwgaGVpZ2h0OiBcIjY0XCIsIHZpZXdCb3g6IFwiMCAwIDI1NSA2NFwiLCBmaWxsOiBcIm5vbmVcIiwgeG1sbnM6IFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB9LCBoKFwicmVjdFwiLCB7IHdpZHRoOiBcIjI1NVwiLCBoZWlnaHQ6IFwiNjRcIiwgZmlsbDogYmFja2dyb3VuZCwgXCJmaWxsLW9wYWNpdHlcIjogXCIwLjFcIiB9KSwgcGF0aCkpKTtcbiAgfVxuICByZW5kZXJPbmJvYXJkaW5nKCkge1xuICAgIGlmICh1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCIpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCB7IGkxOG4gfSA9IHRoaXM7XG4gICAgY29uc3Qgb25ib2FyZGluZ0NvbnRlbnQgPSBbXG4gICAgICB7XG4gICAgICAgIHRpdGxlOiBpMThuLm9uYm9hcmQuYWRkRG9jdW1lbnRUaXRsZSxcbiAgICAgICAgY29udGVudDogaTE4bi5vbmJvYXJkLmFkZERvY3VtZW50Q29udGVudCxcbiAgICAgICAgYmFja2dyb3VuZDogXCIjMDA3YWMyXCIsXG4gICAgICAgIHNob3c6IHRydWUsXG4gICAgICAgIHBhdGg6IChoKFwicGF0aFwiLCB7IGQ6IFwiTTEzMi4yNTcgNDUuNTU2NkwxNDYuMzE4IDMxLjQ5MjZMMTQwIDI1LjE3MzZMMTQxLjM2OCAyMS41NzE2TDEyNi40ODUgMTUuOTE5NkwxMjIuNjY2IDEyLjA5OTZIMTA5LjFWNDIuODk5NkgxMTMuNjExTDExNi43NTYgNDQuMDk0NkwxMjUuMjQ2IDUyLjU2NDZMMTI5LjA1NCA0OC43NjU2TDEzMC43ODcgNDkuNDI0NkwxMzIuMDQzIDQ2LjExODZIMTMyLjA0NEwxMzIuMjU3IDQ1LjU1NjZaTTE0NS4xODcgMzEuNDkyNkwxMzIuOTUgNDMuNzI5NkwxMzkuNjg2IDI1Ljk5NDZMMTQ1LjE4NyAzMS40OTI2Wk0xMjIuOSAxMy40NjU2TDEzMC41MzQgMjEuMDk5NkgxMjIuOVYxMy40NjU2Wk0xMDkuOSAxMi44OTk2SDEyMi4zMzRMMTIyLjQzNCAxMi45OTk2SDEyMi4xVjIxLjg5OTZIMTMxVjIxLjU2NDZMMTMxLjEgMjEuNjY1NlY0Mi4wOTk2SDEwOS45VjEyLjg5OTZaTTEyNS4yNDYgNTEuNDMzNkwxMTguNTg2IDQ0Ljc4OTZMMTI4LjIzMyA0OC40NTQ2TDEyNS4yNDYgNTEuNDMzNlpNMTMwLjMyNCA0OC4zOTM2TDExNS44NjQgNDIuODk5NkgxMzEuOVYyMS4zMzM2TDEyNy44NjUgMTcuMjk3NkwxNDAuMzM1IDIyLjAzNDZMMTMxLjY0MyA0NC45MjE2TDEzMC4zMjQgNDguMzkzNlpcIiwgZmlsbDogXCIjMzk4NUIyXCIgfSkpXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0aXRsZTogaTE4bi5vbmJvYXJkLnB1Ymxpc2hMYXllclRpdGxlLFxuICAgICAgICBjb250ZW50OiB0aGlzLnBvcnRhbC5pc1BvcnRhbFxuICAgICAgICAgID8gaTE4bi5vbmJvYXJkLnB1Ymxpc2hMYXllckVudGVycHJpc2VcbiAgICAgICAgICA6IGkxOG4ub25ib2FyZC5wdWJsaXNoTGF5ZXJDb250ZW50LFxuICAgICAgICBzaG93OiBjYW5QdWJsaXNoRmVhdHVyZXModGhpcy51c2VyLCB0aGlzLnBvcnRhbCksXG4gICAgICAgIGJhY2tncm91bmQ6IFwiIzM1QUM0NlwiLFxuICAgICAgICBwYXRoOiAoaChcInBhdGhcIiwgeyBkOiBcIk0xNDEuMTA1IDE2LjI1MzdMMTQwLjg3NiAxNi4xNzY3QzE0MC41NjQgMTYuMDcyNyAxMzMuMTY0IDEzLjY1OTcgMTI2Ljg1MiAxNi4xODU3QzEyMC44MTQgMTguNTk3NyAxMTMuNDQ5IDE2LjIwMDcgMTEzLjM3NiAxNi4xNzU3TDExMi45MzEgMTYuMDI4N0wxMDcuODA4IDQ3LjI4MTdMMTA4LjA3MSA0Ny40MTM3QzExMC45MjIgNDguNjMyNyAxMTQuMDAyIDQ5LjIyMDUgMTE3LjEwMSA0OS4xMzY3QzEyMC41MTMgNDkuMTEzOSAxMjMuODk4IDQ4LjUzOTggMTI3LjEyNiA0Ny40MzY3QzEzOC4wNjkgNDMuNzg2NyAxNDUuNDk3IDQ3LjM3NjcgMTQ1LjU3MSA0Ny40MTQ3TDE0Ni4yNzEgNDcuNzYyN0wxNDEuMTA1IDE2LjI1MzdaTTEyNi44NzQgNDYuNjc2N0MxMTcuMDg3IDQ5LjkzODcgMTEwLjExNCA0Ny40MTM3IDEwOC42OTQgNDYuODE2N0wxMTMuNTcxIDE3LjA3MjdDMTE1LjMwMyAxNy41NzQ3IDEyMS42MzkgMTkuMTMyNyAxMjcuMTQ4IDE2LjkyNzdDMTMyLjU4OCAxNC43NTM3IDEzOS4xMDQgMTYuNDgzNyAxNDAuMzk2IDE2Ljg2NTdMMTQ1LjIzNiA0Ni4zOTg3QzE0My4xMTYgNDUuNTY1NyAxMzYuMzM2IDQzLjUyMjcgMTI2Ljg3NCA0Ni42NzY3Wk0xMzcuNjggMTguNDI4N0MxMzQuMDY3IDE3LjcwOTggMTMwLjMyOCAxNy45NzEyIDEyNi44NSAxOS4xODU3QzEyNS45OTYgMTkuNTIxMiAxMjUuMTEyIDE5Ljc3NTEgMTI0LjIxIDE5Ljk0MzdMMTI0LjE5OCAxOS45NDY3QzEyMS42NjIgMjAuMzc0NCAxMTkuMDcgMjAuMzYxNiAxMTYuNTM4IDE5LjkwODdMMTE2LjE0MSAxOS44NDI3TDExMi4xMTEgNDQuNDI4N0wxMTIuNDc4IDQ0LjUxMTdDMTE0LjM0MiA0NC45MjM5IDExNi4yNDcgNDUuMTI4OCAxMTguMTU2IDQ1LjEyMjdDMTIxLjU0OSA0NS4xMDIxIDEyNC45MTUgNDQuNTMyOCAxMjguMTI2IDQzLjQzNjdDMTMxLjE3IDQyLjQwMTcgMTM0LjM1OCA0MS44NTAzIDEzNy41NzMgNDEuODAyN0gxMzcuNTgzQzEzOC44MjUgNDEuNzg4MSAxNDAuMDY2IDQxLjg2MDMgMTQxLjI5NyA0Mi4wMTg3TDE0MS44MzIgNDIuMDg4N0wxMzcuOTYxIDE4LjQ3NjdMMTM3LjY4IDE4LjQyODdaTTE0MC4zNjMgMzguMDcxN0wxMzcuODkxIDQwLjU0MzdDMTM3LjggMzkuNzIwNyAxMzcuNjU4IDM4LjkwNDIgMTM3LjQ2NyAzOC4wOTg3TDEzOS45NTkgMzUuNjA2N0wxNDAuMzYzIDM4LjA3MTdaTTEzOS43OTkgMzQuNjM0N0wxMzcuMjMzIDM3LjIwMDdDMTM3LjAyMyAzNi40ODc4IDEzNi43NjEgMzUuNzkxNiAxMzYuNDQ4IDM1LjExNzdMMTM5LjM5NiAzMi4xNjg3TDEzOS43OTkgMzQuNjM0N1pNMTM5LjIzNiAzMS4xOTc3TDEzNi4wNjEgMzQuMzcyN0MxMzUuNzMyIDMzLjc2NzkgMTM1LjMzNSAzMy4yMDMxIDEzNC44NzYgMzIuNjg5N0wxMzguODMyIDI4LjczMzdMMTM5LjIzNiAzMS4xOTc3Wk0xMzguNjcyIDI3Ljc2MTdMMTM0LjMwMiAzMi4xMzE3QzEzMy44NDggMzEuNzIxOSAxMzMuMzU2IDMxLjM1NSAxMzIuODM0IDMxLjAzNTdDMTMyLjg1OCAzMC45MjAzIDEzMi44NzMgMzAuODAzMyAxMzIuODggMzAuNjg1N0wxMzguMjY4IDI1LjI5NjdMMTM4LjY3MiAyNy43NjE3Wk0xMzguMTA5IDI0LjMyNDdMMTMyLjc0NyAyOS42ODY3QzEzMi42MjcgMjkuMzU3NCAxMzIuNDM3IDI5LjA1ODQgMTMyLjE4OSAyOC44MTA2QzEzMS45NDEgMjguNTYyOSAxMzEuNjQyIDI4LjM3MjQgMTMxLjMxMyAyOC4yNTI3TDEzNy43MDUgMjEuODYwN0wxMzguMTA5IDI0LjMyNDdaTTEzMC41IDI4LjkwMDdDMTMwLjgxNyAyOC45MDA3IDEzMS4xMjYgMjguOTk0NSAxMzEuMzg5IDI5LjE3MDNDMTMxLjY1MiAyOS4zNDYxIDEzMS44NTcgMjkuNTk2IDEzMS45NzggMjkuODg4NEMxMzIuMDk5IDMwLjE4MDcgMTMyLjEzMSAzMC41MDI0IDEzMi4wNjkgMzAuODEyOEMxMzIuMDA4IDMxLjEyMzIgMTMxLjg1NSAzMS40MDgzIDEzMS42MzEgMzEuNjMyQzEzMS40MDggMzEuODU1OCAxMzEuMTIzIDMyLjAwODIgMTMwLjgxMiAzMi4wNjk5QzEzMC41MDIgMzIuMTMxNyAxMzAuMTggMzIuMSAxMjkuODg4IDMxLjk3ODlDMTI5LjU5NSAzMS44NTc4IDEyOS4zNDYgMzEuNjUyNyAxMjkuMTcgMzEuMzg5NkMxMjguOTk0IDMxLjEyNjUgMTI4LjkgMzAuODE3MSAxMjguOSAzMC41MDA3QzEyOC45MDEgMzAuMDc2NSAxMjkuMDY5IDI5LjY2OTggMTI5LjM2OSAyOS4zNjk5QzEyOS42NjkgMjkuMDY5OSAxMzAuMDc2IDI4LjkwMTIgMTMwLjUgMjguOTAwN1pNMTM3LjU0NyAyMC44ODc3TDEzMC4zMTYgMjguMTE4N0MxMjkuOTkxIDI4LjE0MzYgMTI5LjY3NSAyOC4yMzQ5IDEyOS4zODYgMjguMzg2OUMxMjkuMDk4IDI4LjUzOSAxMjguODQ0IDI4Ljc0ODUgMTI4LjY0IDI5LjAwMjdDMTI4LjE5NSAyOC43NzA3IDEyNy43NzMgMjguNDk3MSAxMjcuMzggMjguMTg1N0wxMzAuOTcyIDI0LjU5NDdDMTMxLjMzNiAyNC44MzE3IDEzMS43NzEgMjQuOTM2NSAxMzIuMjAzIDI0Ljg5MTNDMTMyLjYzNSAyNC44NDYxIDEzMy4wMzkgMjQuNjUzOCAxMzMuMzQ2IDI0LjM0NjVDMTMzLjY1MyAyNC4wMzkzIDEzMy44NDYgMjMuNjM1NyAxMzMuODkxIDIzLjIwMzZDMTMzLjkzNiAyMi43NzE0IDEzMy44MzEgMjIuMzM2OCAxMzMuNTk0IDIxLjk3MjdMMTM2LjUwMiAxOS4wNjQ3QzEzNi43NjIgMTkuMDk4NyAxMzcuMDIyIDE5LjEzMTcgMTM3LjI2NSAxOS4xNzA3TDEzNy41NDcgMjAuODg3N1pNMTMzLjEgMjMuMDAwN0MxMzMuMSAyMy4yMTgyIDEzMy4wMzYgMjMuNDMwOSAxMzIuOTE1IDIzLjYxMThDMTMyLjc5NCAyMy43OTI3IDEzMi42MjIgMjMuOTMzNyAxMzIuNDIxIDI0LjAxNjlDMTMyLjIyIDI0LjEwMDIgMTMxLjk5OSAyNC4xMjIgMTMxLjc4NiAyNC4wNzk1QzEzMS41NzIgMjQuMDM3MSAxMzEuMzc2IDIzLjkzMjMgMTMxLjIyMiAyMy43Nzg1QzEzMS4wNjggMjMuNjI0NiAxMzAuOTY0IDIzLjQyODYgMTMwLjkyMSAyMy4yMTUzQzEzMC44NzkgMjMuMDAxOSAxMzAuOTAxIDIyLjc4MDcgMTMwLjk4NCAyMi41Nzk3QzEzMS4wNjcgMjIuMzc4NyAxMzEuMjA4IDIyLjIwNjkgMTMxLjM4OSAyMi4wODYxQzEzMS41NyAyMS45NjUyIDEzMS43ODMgMjEuOTAwNyAxMzIgMjEuOTAwN0MxMzIuMjkyIDIxLjkwMDkgMTMyLjU3MSAyMi4wMTY5IDEzMi43NzggMjIuMjIzMUMxMzIuOTg0IDIyLjQyOTQgMTMzLjEgMjIuNzA5IDEzMy4xIDIzLjAwMDdaTTEzNS40ODEgMTguOTUyN0wxMzMuMDI4IDIxLjQwNjdDMTMyLjY2NCAyMS4xNjk2IDEzMi4yMjkgMjEuMDY0OSAxMzEuNzk3IDIxLjExQzEzMS4zNjUgMjEuMTU1MiAxMzAuOTYyIDIxLjM0NzYgMTMwLjY1NCAyMS42NTQ4QzEzMC4zNDcgMjEuOTYyMSAxMzAuMTU1IDIyLjM2NTYgMTMwLjEwOSAyMi43OTc4QzEzMC4wNjQgMjMuMjI5OSAxMzAuMTY5IDIzLjY2NDUgMTMwLjQwNiAyNC4wMjg3TDEyNi43ODUgMjcuNjUwN0MxMjYuNTMzIDI3LjM5MTMgMTI2LjMwMiAyNy4xMTEzIDEyNi4wOTYgMjYuODEzN0MxMjUuOTEzIDI2LjUzNzIgMTI1Ljc1NyAyNi4yNDM5IDEyNS42MjkgMjUuOTM3N0wxMzIuNzA2IDE4Ljg2MTdDMTMzLjYzMiAxOC44MzY0IDEzNC41NTkgMTguODY2OCAxMzUuNDgxIDE4Ljk1MjdaTTEyNy44OTMgMTkuNjczN0MxMjkuMDYzIDE5LjI4OTggMTMwLjI3MyAxOS4wNDIyIDEzMS40OTkgMTguOTM1N0wxMjUuMzIzIDI1LjExMTdDMTI1LjA4OSAyNC4zMzYzIDEyNC45MjQgMjMuNTQxOSAxMjQuODI5IDIyLjczNzdMMTI3Ljg5MyAxOS42NzM3Wk0xMjYuMTY2IDIwLjI2ODdMMTI0LjcyNiAyMS43MDg3QzEyNC43IDIxLjM2MTggMTI0LjY4NCAyMS4wMTQ0IDEyNC42NzYgMjAuNjY2N0MxMjUuMTkzIDIwLjU1NjcgMTI1LjY4NiAyMC40MjA3IDEyNi4xNjYgMjAuMjY4N1pNMTI3Ljg3NCA0Mi42NzY3QzEyMy4xMTMgNDQuMzY2NSAxMTcuOTg3IDQ0Ljc1NzkgMTEzLjAyNCA0My44MTA3TDExNi44MDIgMjAuNzYwN0MxMTkuMTQ1IDIxLjEzODkgMTIxLjUzMiAyMS4xNTcxIDEyMy44OCAyMC44MTQ3QzEyMy45MTkgMjIuMjcyNyAxMjQuMTU3IDI1LjQxOTcgMTI1LjQzOSAyNy4yNjg3QzEyNi4xNjMgMjguMjk2NyAxMjcuMTI3IDI5LjEzMTggMTI4LjI0OCAyOS43MDA3QzEyOC4xNTMgMjkuOTU2OCAxMjguMTAzIDMwLjIyNzUgMTI4LjEgMzAuNTAwN0MxMjguMDk5IDMxLjAyMDEgMTI4LjI2NyAzMS41MjU4IDEyOC41NzkgMzEuOTQxNEMxMjguODkgMzIuMzU3IDEyOS4zMjkgMzIuNjYwMSAxMjkuODI3IDMyLjgwNDlDMTMwLjMyNiAzMi45NDk3IDEzMC44NTkgMzIuOTI4NCAxMzEuMzQ0IDMyLjc0NDJDMTMxLjgzIDMyLjU2IDEzMi4yNDMgMzIuMjIyOSAxMzIuNTIgMzEuNzgzN0MxMzMuMDg0IDMyLjEyOTYgMTMzLjYwOSAzMi41MzY4IDEzNC4wODQgMzIuOTk3N0MxMzQuNjk0IDMzLjYwMjcgMTM2LjY3NCAzNS45MzU3IDEzNy4xNDYgNDEuMDA5N0MxMzMuOTkgNDEuMTAxNSAxMzAuODY1IDQxLjY2MzMgMTI3Ljg3NCA0Mi42NzY3Wk0xMzguNTQ5IDQxLjAxNzdMMTQwLjUyMyAzOS4wNDM3TDE0MC44NyA0MS4xNjA3QzE0MC4wOTkgNDEuMDc5NiAxMzkuMzI1IDQxLjAzMTkgMTM4LjU1IDQxLjAxNzdIMTM4LjU0OVpNMTE5IDI1LjEwMDdDMTE4LjYyNCAyNS4xMDA3IDExOC4yNTcgMjUuMjEyMSAxMTcuOTQ1IDI1LjQyMDlDMTE3LjYzMiAyNS42Mjk3IDExNy4zODkgMjUuOTI2NCAxMTcuMjQ1IDI2LjI3MzZDMTE3LjEwMSAyNi42MjA3IDExNy4wNjMgMjcuMDAyOCAxMTcuMTM3IDI3LjM3MTNDMTE3LjIxIDI3LjczOTkgMTE3LjM5MSAyOC4wNzg1IDExNy42NTcgMjguMzQ0MkMxMTcuOTIyIDI4LjYwOTkgMTE4LjI2MSAyOC43OTA4IDExOC42MjkgMjguODY0MkMxMTguOTk4IDI4LjkzNzUgMTE5LjM4IDI4Ljg5OTggMTE5LjcyNyAyOC43NTZDMTIwLjA3NCAyOC42MTIyIDEyMC4zNzEgMjguMzY4NyAxMjAuNTggMjguMDU2M0MxMjAuNzg5IDI3Ljc0MzggMTIwLjkgMjcuMzc2NSAxMjAuOSAyNy4wMDA3QzEyMC45IDI2LjQ5NjkgMTIwLjY5OSAyNi4wMTQgMTIwLjM0MyAyNS42NTc3QzExOS45ODcgMjUuMzAxNSAxMTkuNTA0IDI1LjEwMTIgMTE5IDI1LjEwMDdaTTExOSAyOC4xMDA3QzExOC43ODMgMjguMTAwNyAxMTguNTcgMjguMDM2MiAxMTguMzg5IDI3LjkxNTNDMTE4LjIwOCAyNy43OTQ0IDExOC4wNjcgMjcuNjIyNiAxMTcuOTg0IDI3LjQyMTZDMTE3LjkwMSAyNy4yMjA2IDExNy44NzkgMjYuOTk5NCAxMTcuOTIxIDI2Ljc4NjFDMTE3Ljk2NCAyNi41NzI3IDExOC4wNjggMjYuMzc2NyAxMTguMjIyIDI2LjIyMjlDMTE4LjM3NiAyNi4wNjkgMTE4LjU3MiAyNS45NjQyIDExOC43ODYgMjUuOTIxOEMxMTguOTk5IDI1Ljg3OTQgMTE5LjIyIDI1LjkwMTEgMTE5LjQyMSAyNS45ODQ0QzExOS42MjIgMjYuMDY3NyAxMTkuNzk0IDI2LjIwODYgMTE5LjkxNSAyNi4zODk1QzEyMC4wMzYgMjYuNTcwNCAxMjAuMSAyNi43ODMxIDEyMC4xIDI3LjAwMDdDMTIwLjEgMjcuMjkyMyAxMTkuOTg0IDI3LjU3MiAxMTkuNzc4IDI3Ljc3ODJDMTE5LjU3MSAyNy45ODQ0IDExOS4yOTIgMjguMTAwNCAxMTkgMjguMTAwN1pNMTE5LjUgMzMuMTAwN0MxMTkuMjIzIDMzLjEwMDcgMTE4Ljk1MyAzMy4xODI4IDExOC43MjIgMzMuMzM2NkMxMTguNDkyIDMzLjQ5MDQgMTE4LjMxMyAzMy43MDkxIDExOC4yMDcgMzMuOTY0OUMxMTguMTAxIDM0LjIyMDcgMTE4LjA3MyAzNC41MDIyIDExOC4xMjcgMzQuNzczOEMxMTguMTgxIDM1LjA0NTQgMTE4LjMxNCAzNS4yOTQ4IDExOC41MSAzNS40OTA2QzExOC43MDYgMzUuNjg2NCAxMTguOTU1IDM1LjgxOTcgMTE5LjIyNyAzNS44NzM4QzExOS40OTkgMzUuOTI3OCAxMTkuNzggMzUuOTAwMSAxMjAuMDM2IDM1Ljc5NDFDMTIwLjI5MiAzNS42ODgxIDEyMC41MSAzNS41MDg3IDEyMC42NjQgMzUuMjc4NUMxMjAuODE4IDM1LjA0ODIgMTIwLjkgMzQuNzc3NiAxMjAuOSAzNC41MDA3QzEyMC45IDM0LjEyOTUgMTIwLjc1MiAzMy43NzM3IDEyMC40ODkgMzMuNTExM0MxMjAuMjI3IDMzLjI0ODkgMTE5Ljg3MSAzMy4xMDEyIDExOS41IDMzLjEwMDdaTTExOS41IDM1LjEwMDdDMTE5LjM4MSAzNS4xMDA3IDExOS4yNjUgMzUuMDY1NSAxMTkuMTY3IDM0Ljk5OTVDMTE5LjA2OCAzNC45MzM2IDExOC45OTEgMzQuODM5OSAxMTguOTQ2IDM0LjczMDNDMTE4LjkgMzQuNjIwNiAxMTguODg4IDM0LjUgMTE4LjkxMiAzNC4zODM2QzExOC45MzUgMzQuMjY3MiAxMTguOTkyIDM0LjE2MDMgMTE5LjA3NiAzNC4wNzY0QzExOS4xNiAzMy45OTI1IDExOS4yNjcgMzMuOTM1MyAxMTkuMzgzIDMzLjkxMjJDMTE5LjQ5OSAzMy44ODkgMTE5LjYyIDMzLjkwMDkgMTE5LjczIDMzLjk0NjNDMTE5LjgzOSAzMy45OTE4IDExOS45MzMgMzQuMDY4NyAxMTkuOTk5IDM0LjE2NzNDMTIwLjA2NSAzNC4yNjYgMTIwLjEgMzQuMzgyIDEyMC4xIDM0LjUwMDdDMTIwLjEgMzQuNjU5OCAxMjAuMDM3IDM0LjgxMjQgMTE5LjkyNCAzNC45MjQ5QzExOS44MTIgMzUuMDM3NSAxMTkuNjU5IDM1LjEwMDcgMTE5LjUgMzUuMTAwN1pNMTI4IDM2LjEwMDdDMTI3LjYyNCAzNi4xMDA3IDEyNy4yNTcgMzYuMjEyMSAxMjYuOTQ1IDM2LjQyMDlDMTI2LjYzMiAzNi42Mjk3IDEyNi4zODkgMzYuOTI2NCAxMjYuMjQ1IDM3LjI3MzZDMTI2LjEwMSAzNy42MjA3IDEyNi4wNjMgMzguMDAyOCAxMjYuMTM3IDM4LjM3MTNDMTI2LjIxIDM4LjczOTkgMTI2LjM5MSAzOS4wNzg0IDEyNi42NTcgMzkuMzQ0MkMxMjYuOTIyIDM5LjYwOTkgMTI3LjI2MSAzOS43OTA4IDEyNy42MjkgMzkuODY0MkMxMjcuOTk4IDM5LjkzNzUgMTI4LjM4IDM5Ljg5OTggMTI4LjcyNyAzOS43NTZDMTI5LjA3NCAzOS42MTIyIDEyOS4zNzEgMzkuMzY4NyAxMjkuNTggMzkuMDU2M0MxMjkuNzg5IDM4Ljc0MzggMTI5LjkgMzguMzc2NSAxMjkuOSAzOC4wMDA3QzEyOS45IDM3LjQ5NjkgMTI5LjY5OSAzNy4wMTQgMTI5LjM0MyAzNi42NTc3QzEyOC45ODcgMzYuMzAxNSAxMjguNTA0IDM2LjEwMTIgMTI4IDM2LjEwMDdaTTEyOCAzOS4xMDA3QzEyNy43ODMgMzkuMTAwNyAxMjcuNTcgMzkuMDM2MiAxMjcuMzg5IDM4LjkxNTNDMTI3LjIwOCAzOC43OTQ0IDEyNy4wNjcgMzguNjIyNiAxMjYuOTg0IDM4LjQyMTZDMTI2LjkwMSAzOC4yMjA2IDEyNi44NzkgMzcuOTk5NCAxMjYuOTIxIDM3Ljc4NjFDMTI2Ljk2NCAzNy41NzI3IDEyNy4wNjggMzcuMzc2NyAxMjcuMjIyIDM3LjIyMjlDMTI3LjM3NiAzNy4wNjkgMTI3LjU3MiAzNi45NjQyIDEyNy43ODYgMzYuOTIxOEMxMjcuOTk5IDM2Ljg3OTQgMTI4LjIyIDM2LjkwMTEgMTI4LjQyMSAzNi45ODQ0QzEyOC42MjIgMzcuMDY3NyAxMjguNzk0IDM3LjIwODYgMTI4LjkxNSAzNy4zODk1QzEyOS4wMzYgMzcuNTcwNCAxMjkuMSAzNy43ODMxIDEyOS4xIDM4LjAwMDdDMTI5LjEgMzguMjkyMyAxMjguOTg0IDM4LjU3MiAxMjguNzc4IDM4Ljc3ODJDMTI4LjU3MSAzOC45ODQ0IDEyOC4yOTIgMzkuMTAwNCAxMjggMzkuMTAwN1pcIiwgZmlsbDogXCIjMzVBQzQ2XCIgfSkpXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0aXRsZTogaTE4bi5vbmJvYXJkLmxpbmtMYXllclRpdGxlLFxuICAgICAgICBjb250ZW50OiBpMThuLm9uYm9hcmQubGlua0xheWVyQ29udGVudCxcbiAgICAgICAgYmFja2dyb3VuZDogXCIjRUREMzE3XCIsXG4gICAgICAgIHNob3c6IHRydWUsXG4gICAgICAgIHBhdGg6IChoKFwicGF0aFwiLCB7IGQ6IFwiTTE0NS44ODcgMzEuNDUwNkMxNDUuODAyIDI2Ljc5OTQgMTQzLjk4NiAyMi4zNDcgMTQwLjc5MiAxOC45NjQyQzEzNy41OTkgMTUuNTgxNCAxMzMuMjU4IDEzLjUxMTYgMTI4LjYyIDEzLjE1OTZDMTI4LjI1MyAxMy4xMjU2IDEyNy44ODEgMTMuMTAxNiAxMjcuNSAxMy4xMDE2QzEyNy4xMTkgMTMuMTAxNiAxMjYuNzQ3IDEzLjEyNTYgMTI2LjM4IDEzLjE1OTZDMTIxLjc0MSAxMy41MTE2IDExNy40IDE1LjU4MTYgMTE0LjIwNyAxOC45NjQ2QzExMS4wMTQgMjIuMzQ3NSAxMDkuMTk3IDI2LjgwMDIgMTA5LjExMyAzMS40NTE2QzEwOS4xMTMgMzEuNDg2NiAxMDkuMTE5IDMxLjUxODYgMTA5LjEyMiAzMS41NTM2QzEwOS4xMTggMzEuNzAzNiAxMDkuMSAzMS44NDk2IDEwOS4xIDMyLjAwMDZDMTA5LjA2MyAzNi4zNzcgMTEwLjU1NiA0MC42Mjg5IDExMy4zMiA0NC4wMjIxQzExNi4wODQgNDcuNDE1MiAxMTkuOTQ2IDQ5LjczNjcgMTI0LjI0IDUwLjU4NTZDMTI0LjQwNSA1MC42MTg2IDEyNC41NzcgNTAuNjM3NiAxMjQuNzQ1IDUwLjY2NTZDMTI1LjA3OSA1MC43MTY2IDEyNS40MTEgNTAuNzc1NiAxMjUuNzUyIDUwLjgwOTZDMTI2LjkxNCA1MC45MzA5IDEyOC4wODYgNTAuOTMwOSAxMjkuMjQ4IDUwLjgwOTZDMTI5LjU4OCA1MC43NzY2IDEyOS45MjEgNTAuNzE2NiAxMzAuMjU1IDUwLjY2NDZDMTMwLjQyMyA1MC42Mzc2IDEzMC41OTUgNTAuNjE4NiAxMzAuNzYgNTAuNTg1NkMxMzUuMDUzIDQ5LjczNjcgMTM4LjkxNiA0Ny40MTUyIDE0MS42OCA0NC4wMjIxQzE0NC40NDQgNDAuNjI4OSAxNDUuOTM3IDM2LjM3NyAxNDUuOSAzMi4wMDA2QzE0NS45IDMxLjg1MDYgMTQ1Ljg4MiAzMS43MDM2IDE0NS44NzggMzEuNTUzNkMxNDUuODgxIDMxLjUxODYgMTQ1Ljg4NyAzMS40ODY2IDE0NS44ODcgMzEuNDUxNlYzMS40NTA2Wk0xNDIuNTM0IDQxLjM2MjZMMTQyLjI3OCA0MS42NjY2QzE0MS43MDQgNDIuMjUwNCAxNDEuMDA4IDQyLjcwMDQgMTQwLjI0IDQyLjk4NDZDMTQxLjQ0NSA0MC4yMTk2IDE0Mi4wNDkgMzcuMjMwNCAxNDIuMDEzIDM0LjIxNDZDMTQzLjEwMiAzMy45MjYzIDE0NC4xMzMgMzMuNDUwOSAxNDUuMDYgMzIuODA5NkMxNDQuOTM1IDM1LjgyNTEgMTQ0LjA2NyAzOC43NjMxIDE0Mi41MzQgNDEuMzYyNlpNMTEyLjcyMiA0MS42NjY2TDExMi40NzEgNDEuMzU4NkMxMTAuOTM2IDM4Ljc2MDkgMTEwLjA2NyAzNS44MjQyIDEwOS45NDEgMzIuODA5NkMxMTAuODY3IDMzLjQ1MDggMTExLjg5OCAzMy45MjYyIDExMi45ODcgMzQuMjE0NkMxMTIuOTUxIDM3LjIzMDQgMTEzLjU1NSA0MC4yMTk2IDExNC43NiA0Mi45ODQ2QzExMy45OTIgNDIuNzAwMyAxMTMuMjk2IDQyLjI1MDMgMTEyLjcyMiA0MS42NjY2Wk0xMTIuMjk4IDIyLjkyMjZDMTEzLjAxNSAyMy40MzEzIDExMy44MzggMjMuNzczIDExNC43MDUgMjMuOTIyNkMxMTMuNjI0IDI2Ljk2MjMgMTEzLjA0NCAzMC4xNTc3IDExMi45ODkgMzMuMzgzNkMxMTEuMTI0IDMyLjgwMTYgMTEwLjAxNCAzMi4xNDY2IDEwOS45MjMgMzEuNTMyNkMxMDkuOTkzIDI4LjUxMDcgMTEwLjgwOSAyNS41NTMgMTEyLjI5OCAyMi45MjI2Wk0xMjAuNDc2IDE2LjUxMjZDMTIxLjIzMiAxNi45Njc5IDEyMi4wNjQgMTcuMjgxMSAxMjIuOTMzIDE3LjQzNjZDMTIyLjA3OSAxOS41Mjk0IDEyMS40NTUgMjEuNzA4OSAxMjEuMDcyIDIzLjkzNjZDMTE5LjMwMSAyMy44Mjk0IDExNy41MzcgMjMuNjIwMyAxMTUuNzkgMjMuMzEwNkMxMTYuNzgyIDIwLjcwMDcgMTE4LjM5IDE4LjM2ODcgMTIwLjQ3NiAxNi41MTI2Wk0xMzkuMjE2IDIzLjMyNDZDMTM3LjQ2NiAyMy42MjY0IDEzNS43MDEgMjMuODMxNCAxMzMuOTI5IDIzLjkzODZDMTMzLjU0NiAyMS43MTAyIDEzMi45MjEgMTkuNTMgMTMyLjA2NyAxNy40MzY2QzEzMi45MzUgMTcuMjgxMSAxMzMuNzY4IDE2Ljk2NzkgMTM0LjUyNCAxNi41MTI2QzEzNi42MTQgMTguMzcyMyAxMzguMjIzIDIwLjcwOTIgMTM5LjIxNiAyMy4zMjQ2Wk0xNDUuMDc2IDMxLjUzMjZDMTQ0Ljk4NiAzMi4xNDY2IDE0My44NzYgMzIuODAyNiAxNDIuMDExIDMzLjM4MzZDMTQxLjk1NSAzMC4xNTgxIDE0MS4zNzYgMjYuOTYzIDE0MC4yOTUgMjMuOTIzNkMxNDEuMTYyIDIzLjc3NCAxNDEuOTg0IDIzLjQzMjMgMTQyLjcwMiAyMi45MjM2QzE0NC4xOTEgMjUuNTUzNyAxNDUuMDA2IDI4LjUxMTEgMTQ1LjA3NyAzMS41MzI2SDE0NS4wNzZaTTE0MS4yMTQgMzMuNjE1NkMxMzkuMTU5IDM0LjE0NDYgMTM3LjA2NyAzNC41MiAxMzQuOTU2IDM0LjczODZDMTM0LjkxOSAzMS4zODQ0IDEzNC42MjMgMjguMDM4MSAxMzQuMDcxIDI0LjcyOTZDMTM1Ljg5NiAyNC42MjY4IDEzNy43MTMgMjQuNDE0NSAxMzkuNTEyIDI0LjA5MzZDMTQwLjYwOCAyNy4xNSAxNDEuMTgzIDMwLjM2ODcgMTQxLjIxNCAzMy42MTU2Wk0xMjcuOSAxNy44NzU2QzEyOS4wMjMgMTcuODYyMyAxMzAuMTQzIDE3Ljc2NzQgMTMxLjI1MyAxNy41OTE2QzEzMi4xMTcgMTkuNjQ1OCAxMzIuNzQ3IDIxLjc5MDYgMTMzLjEzMyAyMy45ODU2QzEzMS41ODQgMjQuMDc1NiAxMjkuODQzIDI0LjEzMDYgMTI3LjkgMjQuMTM3NlYxNy44NzU2Wk0xMjcuOSAxNy4wNzU2VjEzLjkzNjZDMTI5LjAzMyAxNC4xMzk2IDEzMC4wMzggMTUuMTk2NiAxMzAuODkzIDE2Ljg0MDZDMTI5LjkwMSAxNi45ODQ3IDEyOC45MDIgMTcuMDYyNiAxMjcuOSAxNy4wNzM2VjE3LjA3NTZaTTEyNy4xIDE3LjA3NTZDMTI2LjA5OCAxNy4wNjQyIDEyNS4wOTggMTYuOTg2MSAxMjQuMTA3IDE2Ljg0MTZDMTI0Ljk2MiAxNS4xOTg2IDEyNS45NjcgMTQuMTQwNiAxMjcuMSAxMy45Mzc2VjE3LjA3NTZaTTEyNy4xIDE3Ljg3NTZWMjQuMTM3NkMxMjUuMzU0IDI0LjEzNDIgMTIzLjYwOSAyNC4wODMyIDEyMS44NjcgMjMuOTg0NkMxMjIuMjUyIDIxLjc4OTkgMTIyLjg4MyAxOS42NDU1IDEyMy43NDcgMTcuNTkxNkMxMjQuODU2IDE3Ljc2NzEgMTI1Ljk3NyAxNy44NjE3IDEyNy4xIDE3Ljg3NDZWMTcuODc1NlpNMTI3LjEgMjQuOTM5NlYzNS4xNDQ2QzEyNS4wMTEgMzUuMTM1MSAxMjIuOTIzIDM1LjAyODkgMTIwLjg0NCAzNC44MjY2QzEyMC44NjMgMzEuNDU5IDEyMS4xNTYgMjguMDk4NiAxMjEuNzIxIDI0Ljc3ODZDMTIzLjk2MSAyNC45MDU2IDEyNi4wMDEgMjQuOTM0NiAxMjcuMSAyNC45Mzg2VjI0LjkzOTZaTTEyNy4xIDM1Ljk0NDZWNDUuMDM3NkMxMjUuNDA1IDQ1LjAyNjkgMTIzLjcxMSA0NC45MjMxIDEyMi4wMjggNDQuNzI2NkMxMjEuMjE0IDQxLjc2NDYgMTIwLjgxNSAzOC43MDQxIDEyMC44NDIgMzUuNjMyNkMxMjIuODY5IDM1LjgyNzYgMTI0Ljk5OSAzNS45MzI2IDEyNy4xIDM1Ljk0NDZaTTEyNy4xIDQ1LjgzNzZWNTAuMDc4NkMxMjQuNzIyIDQ5Ljg4NzYgMTIzLjIzNSA0OC4wMDQ2IDEyMi4zMTMgNDUuNTU4NkMxMjMuOTAzIDQ1LjczMjggMTI1LjUgNDUuODI2MyAxMjcuMSA0NS44Mzg2VjQ1LjgzNzZaTTEyNy45IDQ1LjgzNzZDMTI5LjQ5OSA0NS44MjYgMTMxLjA5NyA0NS43MzMyIDEzMi42ODcgNDUuNTU5NkMxMzEuNzY1IDQ4LjAwNDYgMTMwLjI3NyA0OS44ODc2IDEyNy45IDUwLjA3OTZWNDUuODM3NlpNMTI3LjkgNDUuMDM3NlYzNS45NDQ2QzEyOS45ODkgMzUuOTMzOSAxMzIuMDc3IDM1LjgyOTggMTM0LjE1OCAzNS42MzI2QzEzNC4xODQgMzguNzAzOCAxMzMuNzg1IDQxLjc2MzkgMTMyLjk3MiA0NC43MjU2QzEzMS4yODggNDQuOTIyMiAxMjkuNTk1IDQ1LjAyNjQgMTI3LjkgNDUuMDM3NlpNMTI3LjkgMzUuMTQ0NlYyNC45NDA2QzEyOC45OTkgMjQuOTM1NiAxMzEuMDM4IDI0LjkwNjYgMTMzLjI3OSAyNC43Nzk2QzEzMy44NDMgMjguMDk5NiAxMzQuMTM2IDMxLjQ2IDEzNC4xNTYgMzQuODI3NkMxMzIuMDc2IDM1LjAyOTkgMTI5Ljk4OSAzNS4xMzYgMTI3LjkgMzUuMTQ1NlYzNS4xNDQ2Wk0xMzEuNzIzIDE2LjY5NDZDMTMxLjI4OCAxNS43NjEyIDEzMC42OTMgMTQuOTExIDEyOS45NjYgMTQuMTgyNkMxMzEuMzc2IDE0LjUxODMgMTMyLjcwNCAxNS4xMzY4IDEzMy44NjkgMTYuMDAwNkMxMzMuMTg5IDE2LjMzMTcgMTMyLjQ2NyAxNi41NjU5IDEzMS43MjMgMTYuNjk2NlYxNi42OTQ2Wk0xMjMuMjc3IDE2LjY5NDZDMTIyLjUzMiAxNi41NjQ3IDEyMS44MSAxNi4zMzExIDEyMS4xMyAxNi4wMDA2QzEyMi4yOTQgMTUuMTM3MSAxMjMuNjIyIDE0LjUxOSAxMjUuMDMzIDE0LjE4MzZDMTI0LjMwNSAxNC45MTIzIDEyMy43MSAxNS43NjI4IDEyMy4yNzYgMTYuNjk2NkwxMjMuMjc3IDE2LjY5NDZaTTEyMC45MjkgMjQuNzI5NkMxMjAuMzc2IDI4LjAzODQgMTIwLjA4IDMxLjM4NTEgMTIwLjA0NCAzNC43Mzk2QzExNy45MzMgMzQuNTIwNiAxMTUuODQxIDM0LjE0NDkgMTEzLjc4NiAzMy42MTU2QzExMy44MTcgMzAuMzY4NyAxMTQuMzkyIDI3LjE1IDExNS40ODggMjQuMDkzNkMxMTcuMjg3IDI0LjQxNDQgMTE5LjEwMyAyNC42MjY4IDEyMC45MjggMjQuNzI5NkgxMjAuOTI5Wk0xMTMuNzk0IDM0LjQ1MTZDMTE1Ljg0NyAzNC45NjkyIDExNy45MzYgMzUuMzM0OCAxMjAuMDQ0IDM1LjU0NTZDMTE5Ljk5IDM4LjYwMTQgMTIwLjM1MiA0MS42NTA0IDEyMS4xMjEgNDQuNjA4NkMxMTkuMzU0IDQ0LjM3NTMgMTE3LjYxMyA0My45ODA5IDExNS45MTggNDMuNDMwNkMxMTQuNTIzIDQwLjY0MjggMTEzLjc5NiAzNy41Njg4IDExMy43OTQgMzQuNDUxNlpNMTIxLjM5NiA0NS40NDQ2QzEyMS44ODggNDcuMTE0OSAxMjIuODQ3IDQ4LjYwOTggMTI0LjE2IDQ5Ljc1MzZDMTIyLjU5MyA0OS40MzUgMTIxLjEwOCA0OC44MDA2IDExOS43OTQgNDcuODg5QzExOC40OCA0Ni45Nzc1IDExNy4zNjYgNDUuODA3OSAxMTYuNTIgNDQuNDUxNkMxMTguMTE4IDQ0LjkwNDEgMTE5Ljc0OCA0NS4yMzYxIDEyMS4zOTYgNDUuNDQ0NlpNMTMzLjYwNCA0NS40NDQ2QzEzNS4yNTEgNDUuMjM2NCAxMzYuODgxIDQ0LjkwNDggMTM4LjQ3OSA0NC40NTI2QzEzNy42MzIgNDUuODA4NSAxMzYuNTE4IDQ2Ljk3NzggMTM1LjIwNCA0Ny44ODlDMTMzLjg5MSA0OC44MDAyIDEzMi40MDUgNDkuNDM0MyAxMzAuODM5IDQ5Ljc1MjZDMTMyLjE1MiA0OC42MDk2IDEzMy4xMTEgNDcuMTE1MyAxMzMuNjA0IDQ1LjQ0NTZWNDUuNDQ0NlpNMTMzLjg4IDQ0LjYwODZDMTM0LjY0OCA0MS42NTA0IDEzNS4wMSAzOC42MDE0IDEzNC45NTYgMzUuNTQ1NkMxMzcuMDYzIDM1LjMzNDggMTM5LjE1MiAzNC45NjkyIDE0MS4yMDYgMzQuNDUxNkMxNDEuMjA0IDM3LjU2ODggMTQwLjQ3NiA0MC42NDI4IDEzOS4wODIgNDMuNDMwNkMxMzcuMzg3IDQzLjk4MDkgMTM1LjY0NiA0NC4zNzUyIDEzMy44OCA0NC42MDg2Wk0xNDIuMjgyIDIyLjIxMjZDMTQyLjI4MiAyMi40ODI2IDE0MS41MTIgMjIuODM2NiAxNDAuMDA1IDIzLjE2NjZDMTM4Ljk3MiAyMC40MDE3IDEzNy4yODggMTcuOTI2MiAxMzUuMDk2IDE1Ljk0OTZDMTM1LjEzNCAxNS44ODQ5IDEzNS4xNjcgMTUuODE2NSAxMzUuMTkyIDE1Ljc0NTZDMTM4LjEwMSAxNy4yMTQzIDE0MC41NTIgMTkuNDUwNiAxNDIuMjgyIDIyLjIxMjZaTTEzNC40NjIgMTUuMzgzNkMxMzQuNDYgMTUuNDAwNCAxMzQuNDU2IDE1LjQxNzEgMTM0LjQ1MiAxNS40MzM2QzEzNC4zODYgMTUuMzgzNiAxMzQuMzE3IDE1LjMzNzYgMTM0LjI1IDE1LjI4OTZDMTM0LjMyMSAxNS4zMTk2IDEzNC4zOTIgMTUuMzUyNiAxMzQuNDYzIDE1LjM4MzZIMTM0LjQ2MlpNMTIwLjU0OCAxNS40MzM2QzEyMC41NDMgMTUuNDE5MiAxMjAuNTQgMTUuNDA0NSAxMjAuNTM4IDE1LjM4OTZDMTIwLjYwOCAxNS4zNTg2IDEyMC42NzggMTUuMzE5NiAxMjAuNzUgMTUuMjg5NkMxMjAuNjgzIDE1LjMzNzYgMTIwLjYxNCAxNS4zODQ2IDEyMC41NDggMTUuNDM0NlYxNS40MzM2Wk0xMTkuODA4IDE1Ljc0NTZDMTE5LjgzMyAxNS44MTY1IDExOS44NjUgMTUuODg0OSAxMTkuOTA0IDE1Ljk0OTZDMTE3LjcxNiAxNy45MjEzIDExNi4wMzUgMjAuMzkgMTE1LjAwMiAyMy4xNDc2QzExMy41NjggMjIuODIxNiAxMTIuODE1IDIyLjQ2NzYgMTEyLjc0MiAyMi4xNzE2QzExNC40NyAxOS40MjggMTE2LjkxMyAxNy4yMDY2IDExOS44MDggMTUuNzQ1NlpNMTEzLjg4NSA0My40NTM2QzExNC4zNDEgNDMuNjc5MSAxMTQuODEgNDMuODc4NCAxMTUuMjg5IDQ0LjA1MDZDMTE1Ljc4MSA0NC45Mzc0IDExNi4zNjkgNDUuNzY3NCAxMTcuMDQzIDQ2LjUyNTZDMTE1Ljg2OCA0NS42MzUxIDExNC44MDcgNDQuNjAzMyAxMTMuODg1IDQzLjQ1MzZaTTEzNy45NTcgNDYuNTI1NkMxMzguNjMgNDUuNzY3NCAxMzkuMjE5IDQ0LjkzNzQgMTM5LjcxMSA0NC4wNTA2QzE0MC4xOSA0My44Nzg0IDE0MC42NTkgNDMuNjc5MSAxNDEuMTE1IDQzLjQ1MzZDMTQwLjE5MiA0NC42MDM0IDEzOS4xMzIgNDUuNjM1MSAxMzcuOTU3IDQ2LjUyNTZaXCIsIGZpbGw6IFwiI0Q5QkMwMFwiIH0pKVxuICAgICAgfVxuICAgIF1cbiAgICAgIC5maWx0ZXIoKHNlY3Rpb24pID0+IHNlY3Rpb24uc2hvdylcbiAgICAgIC5tYXAodGhpcy5yZW5kZXJPbmJvYXJkaW5nU2VjdGlvbik7XG4gICAgcmV0dXJuIChoKFwiYXJjZ2lzLWluZm9ybWF0aW9uXCIsIHsgbGFiZWw6IGkxOG4ub25ib2FyZC50b29sdGlwTGFiZWwsIHBsYWNlbWVudDogXCJib3R0b20tc3RhcnRcIiwgaGVhZGluZzogaTE4bi5vbmJvYXJkLnRpdGxlLCBoZWFkaW5nTGV2ZWw6IDMsIGNsYXNzOiBcIm9uYm9hcmRpbmdcIiwgb3ZlcmxheVBvc2l0aW9uaW5nOiBcImZpeGVkXCIsIHBhZGRlZENvbnRlbnQ6IHRydWUgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcIm9uYm9hcmRpbmdfX3Njcm9sbFwiIH0sIG9uYm9hcmRpbmdDb250ZW50KSkpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGkxOG4sIG5vUGFkZGluZywgaXNMb2FkaW5nLCBsb2FkaW5nVGV4dCwgaXNBY3RpdmUsIGRpc2FibGVDbG9zZUJ1dHRvbiB9ID0gdGhpcztcbiAgICBjb25zdCBjb250ZW50U3R5bGUgPSB0aGlzLm91dGVySGVpZ2h0ID8geyBoZWlnaHQ6IGAke3RoaXMub3V0ZXJIZWlnaHR9cHhgIH0gOiB7fTtcbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLW1vZGFsXCIsIHsgcmVmOiAoZWxlKSA9PiAodGhpcy5tb2RhbFJlZiA9IGVsZSksIG9wZW46IGlzQWN0aXZlLCBvbkNhbGNpdGVNb2RhbENsb3NlOiB0aGlzLmNsb3NlRGlhbG9nLCBvdXRzaWRlQ2xvc2VEaXNhYmxlZDogdHJ1ZSwgZXNjYXBlRGlzYWJsZWQ6IHRydWUsIGNsYXNzOiB7XG4gICAgICAgIG1vZGFsOiB0cnVlLFxuICAgICAgICBcIm1vZGFsLS1ncmV5XCI6IG5vUGFkZGluZ1xuICAgICAgfSwgY2xvc2VCdXR0b25EaXNhYmxlZDogZGlzYWJsZUNsb3NlQnV0dG9uIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcImhlYWRlclwiLCBjbGFzczogXCJoZWFkZXJcIiB9LCBoKFwiaDNcIiwgeyBpZDogXCJtb2RhbC10aXRsZVwiLCBjbGFzczogXCJoZWFkZXJfX3RpdGxlXCIgfSwgdGhpcy5nZXRIZWFkZXJUaXRsZSgpKSwgdGhpcy5wYWdlSGlzdG9yeVt0aGlzLnBhZ2VIaXN0b3J5Lmxlbmd0aCAtIDFdID09PSBcImhvbWVcIiAmJlxuICAgICAgaXNBY3RpdmUgJiZcbiAgICAgIHRoaXMucmVuZGVyT25ib2FyZGluZygpKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiY29udGVudFwiLCBzdHlsZTogY29udGVudFN0eWxlLCByZWY6IChlbCkgPT4gKHRoaXMuY29udGVudFNsb3QgPSBlbCksIGNsYXNzOiBcImNvbnRlbnRcIiB9LCBpc0xvYWRpbmcgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJzdGFnZVwiIH0sIGgoXCJhcmNnaXMtbmV3LWl0ZW0tbG9hZGVyXCIsIHsgYWN0aXZlOiBpc0xvYWRpbmcsIHRleHQ6IGxvYWRpbmdUZXh0ICE9PSBudWxsICYmIGxvYWRpbmdUZXh0ICE9PSB2b2lkIDAgPyBsb2FkaW5nVGV4dCA6IGkxOG4ubG9hZGluZ0RhdGEgfSkpKSwgIWlzTG9hZGluZyAmJiB0aGlzLmRpc3BsYXlQYWdlKCkpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJiYWNrXCIgfSwgdGhpcy5zaG93QmFja0J1dHRvbiAmJiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwga2luZDogXCJuZXV0cmFsXCIsIFwiZGF0YS1pZFwiOiBcImJhY2tCdXR0b25cIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5uYXZFbmFibGVkKSB7XG4gICAgICAgICAgdGhpcy50cmlnZ2VyUGFnZVRyYW5zaXRpb24oXCJhcmNnaXNOZXdJdGVtUGFnZVByZXZcIik7XG4gICAgICAgIH1cbiAgICAgIH0sIHdpZHRoOiBcImZ1bGxcIiwgZGlzYWJsZWQ6ICF0aGlzLm5hdkVuYWJsZWQgfSwgaTE4bi5iYWNrKSkpLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcInNlY29uZGFyeVwiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBcImRhdGEtaWRcIjogXCJjYW5jZWxCdXR0b25cIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICBpZiAoIWRpc2FibGVDbG9zZUJ1dHRvbikge1xuICAgICAgICAgIHRoaXMuaXNBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSwgd2lkdGg6IFwiZnVsbFwiLCBkaXNhYmxlZDogZGlzYWJsZUNsb3NlQnV0dG9uIH0sIGkxOG4uY2FuY2VsKSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJwcmltYXJ5XCIsIGFwcGVhcmFuY2U6IFwic29saWRcIiwgXCJkYXRhLWlkXCI6IFwibmV4dEJ1dHRvblwiLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgIHRoaXMudHJpZ2dlclBhZ2VUcmFuc2l0aW9uKFwiYXJjZ2lzTmV3SXRlbVBhZ2VOZXh0XCIpO1xuICAgICAgfSwgd2lkdGg6IFwiZnVsbFwiLCBkaXNhYmxlZDogIXRoaXMubmF2RW5hYmxlZCB9LCB0aGlzLnByaW1hcnlCdXR0b25UZXh0KSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICBcImlzQWN0aXZlXCI6IFtcInVwZGF0ZUFjdGl2ZVwiXSxcbiAgICBcImZpcnN0U3RlcFwiOiBbXCJ1cGRhdGVGaXJzdFN0ZXBcIl0sXG4gICAgXCJmaWxlXCI6IFtcImluaXRpYWxpemVXaXRoRmlsZVwiXSxcbiAgICBcImluaXRpYWxGb2xkZXJcIjogW1widXBkYXRlSW5pdGlhbEZvbGRlclwiXVxuICB9OyB9XG59O1xuQXJjZ2lzTmV3SXRlbS5zdHlsZSA9IGFyY2dpc05ld0l0ZW1Dc3M7XG5cbmNvbnN0IGhhbmRsZUNyZWF0ZUxheWVyTGlzdFRlbGVtZXRyeSA9IChsYWJlbCkgPT4ge1xuICBjb25zdCB7IHRlbGVtZXRyeSB9ID0gY29uZmlnU3RhdGU7XG4gIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgZXZlbnRUeXBlOiBcIm5ldyBpdGVtIGNsaWNrXCIsXG4gICAgcGFnZU5hbWU6IFwibXkgY29udGVudFwiLFxuICAgIGNhdGVnb3J5OiBcIm5ldyBpdGVtXCIsXG4gICAgbGFiZWxcbiAgfTtcbiAgdGVsZW1ldHJ5ID09PSBudWxsIHx8IHRlbGVtZXRyeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVsZW1ldHJ5LmxvZ0V2ZW50KHBheWxvYWQpO1xuICB1aVN0b3JlU3RhdGUudGVsZW1ldHJ5RGV0YWlscyA9IGxhYmVsO1xufTtcbmNvbnN0IGhhbmRsZUFwcGxpY2F0aW9uQ2xpY2sgPSAoKSA9PiB7XG4gIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwiYXBwbGljYXRpb25cIjtcbiAgYWRkSXRlbVN0YXRlLmZpbGUgPSBudWxsO1xuICBhZGRJdGVtU3RhdGUudHlwZSA9IFwiV2ViIE1hcHBpbmcgQXBwbGljYXRpb25cIjtcbiAgYWRkSXRlbVN0YXRlLnR5cGVLZXl3b3JkcyA9IFtcIkphdmFTY3JpcHRcIiwgXCJPbmxpbmUgTWFwXCIsIFwiUmVhZHkgVG8gVXNlXCJdO1xuICBhZGRJdGVtU3RhdGUudGh1bWJuYWlsVVJMID0gXCJodHRwczovL3N0YXRpYy5hcmNnaXMuY29tL2ltYWdlcy9kZXNrdG9wYXBwLnBuZ1wiO1xufTtcbmNvbnN0IGhhbmRsZUZlYXR1cmVMYXllckNsaWNrID0gYXN5bmMgKCkgPT4ge1xuICB2YXIgX2E7XG4gIChfYSA9IGNvbmZpZ1N0YXRlLnRlbGVtZXRyeSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXJ0V29ya2Zsb3coXCJjcmVhdGUgZmVhdHVyZSBsYXllclwiLCB7XG4gICAgY2F0ZWdvcnk6IFwiY3JlYXRlIGZlYXR1cmUgbGF5ZXJcIixcbiAgICBwYWdlTmFtZTogXCJteSBjb250ZW50XCJcbiAgfSk7XG4gIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwiY3JlYXRlXCI7XG59O1xuXG5jb25zdCBhcmNnaXNOZXdJdGVtQ3JlYXRlTGF5ZXJzTGlzdENzcyA9IFwiLnRpdGxle2ZvbnQtd2VpZ2h0OjQwMDtmb250LXNpemU6MXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMSk7cGFkZGluZzowO21hcmdpbjowO21hcmdpbi10b3A6MnJlbX0ubGlzdHttYXJnaW46MDtwYWRkaW5nOjA7cGFkZGluZy1ib3R0b206MC43NXJlbTtkaXNwbGF5OmZsZXg7ZmxleC13cmFwOndyYXB9Lmxpc3QtaXRlbXttYXJnaW46MDtwYWRkaW5nOjA7ZGlzcGxheTpmbGV4O2p1c3RpZnktaXRlbXM6c3RhcnQ7bGlzdC1zdHlsZS10eXBlOm5vbmU7ZmxleDoxIDEgMzgwcHh9LmNhcmR7bWFyZ2luLXRvcDoxLjI1cmVtO3BhZGRpbmc6MDtkaXNwbGF5OmZsZXg7Ym9yZGVyOjFweCBzb2xpZCB0cmFuc3BhcmVudDstd2Via2l0LW1hcmdpbi1lbmQ6MnJlbTttYXJnaW4taW5saW5lLWVuZDoycmVtO21heC13aWR0aDo0NDBweDthbGlnbi1pdGVtczpzdHJldGNoO2JhY2tncm91bmQtY29sb3I6d2hpdGU7dHJhbnNpdGlvbjphbGwgMTUwbXMgZWFzZS1pbi1vdXQ7b3V0bGluZS1vZmZzZXQ6MHB4O291dGxpbmUtY29sb3I6dHJhbnNwYXJlbnQ7Zm9udC1mYW1pbHk6aW5oZXJpdDt0ZXh0LWFsaWduOmluaXRpYWw7Y3Vyc29yOnBvaW50ZXJ9LmNhcmQ6aG92ZXJ7Ym9yZGVyLWNvbG9yOiNhYWF9LmNhcmQ6Zm9jdXN7b3V0bGluZTpub25lO2JvcmRlci1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWJyYW5kKX0uY2FyZDpob3ZlciAuY2FyZF9faWNvbiwuY2FyZDpmb2N1cyAuY2FyZF9faWNvbntiYWNrZ3JvdW5kLWNvbG9yOiNlZWY3ZmR9LmNhcmQ6aG92ZXIgLmNhcmRfX2Fycm93LC5jYXJkOmZvY3VzIC5jYXJkX19hcnJvd3tvcGFjaXR5OjE7dHJhbnNmb3JtOnRyYW5zbGF0ZTNkKDAsIDAsIDApfS5jYXJkX19hcnJvd3t2ZXJ0aWNhbC1hbGlnbjotNnB4O29wYWNpdHk6MDt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoLTIwcHgsIDAsIDApO3RyYW5zaXRpb246YWxsIDE1MG1zIGVhc2UtaW4tb3V0fS5jYXJkX19pY29ue2ZsZXg6MCAwIGF1dG87ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO3dpZHRoOjg3cHg7bWluLWhlaWdodDo4N3B4O2NvbG9yOiMwMDAwMDA7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWJhY2tncm91bmQpO3RyYW5zaXRpb246YWxsIDE1MG1zIGVhc2UtaW4tb3V0fS5jYXJkX19jb250ZW50e3BhZGRpbmctbGVmdDowLjc1cmVtO3BhZGRpbmctcmlnaHQ6MC43NXJlbTtwYWRkaW5nLXRvcDowLjVyZW07cGFkZGluZy1ib3R0b206MC41cmVtfS5jYXJkX190aXRsZXtmb250LXNpemU6MXJlbTtsaW5lLWhlaWdodDoxLjI1cmVtO21hcmdpbjowO3BhZGRpbmc6MDtmb250LXdlaWdodDo0MDA7Y29sb3I6IzMyMzIzMn0uY2FyZF9fc3VidGl0bGV7Zm9udC1zaXplOjAuODc1cmVtO2xpbmUtaGVpZ2h0OjEuMjVyZW07Zm9udC13ZWlnaHQ6NDAwO21hcmdpbjowO21hcmdpbi10b3A6MC41cmVtO3BhZGRpbmc6MDtjb2xvcjojNjQ2NDY0fVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtQ3JlYXRlTGF5ZXJzTGlzdCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVVwZGF0ZVBhZ2VcIiwgNyk7XG4gICAgdGhpcy5oYW5kbGVSZWRpcmVjdCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiaGFuZGxlUmVkaXJlY3RcIiwgNyk7XG4gICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgIHRoaXMub3B0aW9ucyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuLmNyZWF0ZUxheWVyc0xpc3Q7XG4gICAgY29uc3QgeyB1c2VyLCBwb3J0YWwsIHVzZXJMaWNlbnNlZEl0ZW1zIH0gPSBjb25maWdTdGF0ZTtcbiAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgY29uc3QgeyByZXN1bHQ6IHN1YnNjcmlwdGlvbkluZm8gfSA9IGF3YWl0IGZyb21DYWNoZSgoKSA9PiBnZXRTdWJzY3JpcHRpb25JbmZvKGNvbmZpZ1N0YXRlLnBvcnRhbCksIFwic3Vic2NyaXB0aW9uVHlwZVwiLCBjb25maWdTdGF0ZS51c2VyLmlkKTtcbiAgICBjb25maWdTdGF0ZS5zdWJzY3JpcHRpb25JbmZvID0gc3Vic2NyaXB0aW9uSW5mbztcbiAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgIC8vIFRPRE86IGZpbHRlciBvcHRpb25zIGJhc2VkIG9uIHVzZXIncyBwZXJtaXNzaW9uc1xuICAgIHRoaXMub3B0aW9ucyA9IFtcbiAgICAgIHtcbiAgICAgICAgaGVhZGluZzogdGhpcy5pMThuLmZlYXR1cmVMYXllckhlYWRpbmcsXG4gICAgICAgIGljb246IFwiZmVhdHVyZUxheWVyXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmkxOG4uZmVhdHVyZUxheWVyRGVzY3JpcHRpb24sXG4gICAgICAgIHNob3c6IGNvbmZpZ1N0YXRlLmFsbG93ZWRNb2Rlcy5pbmNsdWRlcyhcImZlYXR1cmVMYXllclwiKSAmJiBjYW5QdWJsaXNoRmVhdHVyZXModXNlciwgcG9ydGFsKSxcbiAgICAgICAgaGFuZGxlcjogdGhpcy5vbkZlYXR1cmVMYXllckNsaWNrXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBoZWFkaW5nOiB0aGlzLmkxOG4udXJsSGVhZGluZyxcbiAgICAgICAgaWNvbjogXCJ3ZWJcIixcbiAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuaTE4bi51cmxEZXNjcmlwdGlvbixcbiAgICAgICAgc2hvdzogY29uZmlnU3RhdGUuYWxsb3dlZE1vZGVzLmluY2x1ZGVzKFwidXJsXCIpLFxuICAgICAgICBoYW5kbGVyOiB0aGlzLm9uVVJMQ2xpY2tcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGhlYWRpbmc6IHRoaXMuaTE4bi5kZXZlbG9wZXJDcmVkZW50aWFsc0hlYWRpbmcsXG4gICAgICAgIGljb246IFwia2V5XCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmkxOG5bXCJkZXZlbG9wZXJDcmVkZW50aWFsc05vQVBJRGVzY3JpcHRpb25cIl0sXG4gICAgICAgIHNob3c6IGNvbmZpZ1N0YXRlLmFsbG93ZWRNb2Rlcy5pbmNsdWRlcyhcImRldmVsb3BlckNyZWRlbnRpYWxzXCIpICYmXG4gICAgICAgICAgY2FuQ3JlYXRlRGV2ZWxvcGVyQ3JlZGVudGlhbHModXNlciksXG4gICAgICAgIGhhbmRsZXI6IHRoaXMub25EZXZlbG9wZXJDcmVkZW50aWFsc0NsaWNrXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBoZWFkaW5nOiB0aGlzLmkxOG4uYXBwbGljYXRpb25IZWFkaW5nLFxuICAgICAgICBpY29uOiBcImFwcHNcIixcbiAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuaTE4bi5hcHBsaWNhdGlvbkRlc2NyaXB0aW9uLFxuICAgICAgICBzaG93OiBjb25maWdTdGF0ZS5hbGxvd2VkTW9kZXMuaW5jbHVkZXMoXCJhcHBsaWNhdGlvblwiKSxcbiAgICAgICAgaGFuZGxlcjogdGhpcy5vbkFwcGxpY2F0aW9uQ2xpY2tcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGhlYWRpbmc6IHRoaXMuaTE4bi5pbWFnZUxheWVySGVhZGluZyxcbiAgICAgICAgaWNvbjogXCJpbWFnZUxheWVyXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmkxOG4uaW1hZ2VMYXllckRlc2NyaXB0aW9uLFxuICAgICAgICBzaG93OiBjb25maWdTdGF0ZS5hbGxvd2VkTW9kZXMuaW5jbHVkZXMoXCJpbWFnZXJ5TGF5ZXJcIikgJiZcbiAgICAgICAgICBjYW5QdWJsaXNoSW1hZ2VDb2xsZWN0aW9uKHVzZXIsIHBvcnRhbCwgdXNlckxpY2Vuc2VkSXRlbXMpLFxuICAgICAgICBoYW5kbGVyOiB0aGlzLm9uSW1hZ2VyeUxheWVyQ2xpY2tcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGhlYWRpbmc6IHRoaXMuaTE4bi50aWxlTGF5ZXJIZWFkaW5nLFxuICAgICAgICBpY29uOiBcInRpbGVMYXllclwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5pMThuLnRpbGVMYXllckRlc2NyaXB0aW9uLFxuICAgICAgICBzaG93OiBjb25maWdTdGF0ZS5hbGxvd2VkTW9kZXMuaW5jbHVkZXMoXCJ0aWxlTGF5ZXJcIikgJiYgY2FuUHVibGlzaFRpbGVzKHVzZXIsIHBvcnRhbCksXG4gICAgICAgIGhhbmRsZXI6IHRoaXMub25UaWxlTGF5ZXJDbGlja1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgaGVhZGluZzogdGhpcy5pMThuLnNjZW5lTGF5ZXJIZWFkaW5nLFxuICAgICAgICBpY29uOiBcImxheWVyR3JhcGhpY3NcIixcbiAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuaTE4bi5zY2VuZUxheWVyRGVzY3JpcHRpb24sXG4gICAgICAgIGhhbmRsZXI6IHRoaXMub25TY2VuZUxheWVyQ2xpY2ssXG4gICAgICAgIHNob3c6IGNvbmZpZ1N0YXRlLmFsbG93ZWRNb2Rlcy5pbmNsdWRlcyhcInNjZW5lTGF5ZXJcIikgJiYgY2FuUHVibGlzaFNjZW5lcyh1c2VyKVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgaGVhZGluZzogdGhpcy5pMThuLmxvY2F0b3JIZWFkaW5nLFxuICAgICAgICBpY29uOiBcImxvY2F0b3JcIixcbiAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuaTE4bltjYW5DcmVhdGVMb2NhdG9yVmlldyh1c2VyLCBwb3J0YWwpID8gXCJsb2NhdG9yRGVzY3JpcHRpb25cIiA6IFwibG9jYXRvck9ubHlEZXNjcmlwdGlvblwiXSxcbiAgICAgICAgc2hvdzogY29uZmlnU3RhdGUuYWxsb3dlZE1vZGVzLmluY2x1ZGVzKFwibG9jYXRvclwiKSAmJiBjYW5DcmVhdGVMb2NhdG9yKHVzZXIpLFxuICAgICAgICBoYW5kbGVyOiB0aGlzLm9uTG9jYXRvckNsaWNrXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBoZWFkaW5nOiB0aGlzLmkxOG4uZGF0YVN0b3JlSGVhZGluZyxcbiAgICAgICAgaWNvbjogXCJkYXRhXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmkxOG4uZGF0YVN0b3JlRGVzY3JpcHRpb24sXG4gICAgICAgIHNob3c6IGNvbmZpZ1N0YXRlLmFsbG93ZWRNb2Rlcy5pbmNsdWRlcyhcImRhdGFTdG9yZVwiKSAmJiBjYW5DcmVhdGVEYXRhU3RvcmUodXNlciwgcG9ydGFsKSxcbiAgICAgICAgaGFuZGxlcjogdGhpcy5vbkRhdGFTdG9yZUNsaWNrIC8qIEZvciBFbnRlcnByaXNlICovXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBoZWFkaW5nOiB0aGlzLmkxOG4uZGF0YVN0b3JlSGVhZGluZyxcbiAgICAgICAgaWNvbjogXCJkYXRhXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmkxOG4uZGF0YVN0b3JlQ29ubmVjdGlvbkRlc2NyaXB0aW9uLFxuICAgICAgICBzaG93OiBmYWxzZSxcbiAgICAgICAgaGFuZGxlcjogdGhpcy5vbkRhdGFTdG9yZUNvbm5lY3Rpb25DbGljayAvKiBQbGFjZWhvbGRlciBmb3IgT25saW5lIGltcGxlbWVudGF0aW9uICovXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBoZWFkaW5nOiB0aGlzLmkxOG4ucmFzdGVyRnVuY3Rpb25UZW1wbGF0ZUhlYWRpbmcsXG4gICAgICAgIGljb246IFwibmV3LXJhc3Rlci1mdW5jdGlvbi10ZW1wbGF0ZVwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5pMThuLnJhc3RlckZ1bmN0aW9uVGVtcGxhdGVEZXNjcmlwdGlvbixcbiAgICAgICAgc2hvdzogY29uZmlnU3RhdGUuYWxsb3dlZE1vZGVzLmluY2x1ZGVzKFwicmFzdGVyRnVuY3Rpb25UZW1wbGF0ZVwiKSAmJlxuICAgICAgICAgIGNhbkNyZWF0ZUl0ZW1zKHVzZXIpICYmXG4gICAgICAgICAgIWlzUHVibGljVXNlcih1c2VyKSxcbiAgICAgICAgaGFuZGxlcjogdGhpcy5vblJhc3RlckZ1bmN0aW9uVGVtcGxhdGVDbGlja1xuICAgICAgfVxuICAgIF07XG4gIH1cbiAgb25GZWF0dXJlTGF5ZXJDbGljaygpIHtcbiAgICBoYW5kbGVDcmVhdGVMYXllckxpc3RUZWxlbWV0cnkoXCJmZWF0dXJlIGxheWVyXCIpO1xuICAgIGhhbmRsZUZlYXR1cmVMYXllckNsaWNrKCk7XG4gICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiZmVhdHVyZUxheWVyU2VsZWN0XCIpO1xuICB9XG4gIG9uVGlsZUxheWVyQ2xpY2soKSB7XG4gICAgaGFuZGxlQ3JlYXRlTGF5ZXJMaXN0VGVsZW1ldHJ5KFwidGlsZSBsYXllclwiKTtcbiAgICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPSBcInRpbGVMYXllclwiO1xuICAgIGxvZ1RpbGVMYXllclN0YXJ0KCk7XG4gICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwidGlsZUxheWVyU2VsZWN0XCIpO1xuICB9XG4gIG9uU2NlbmVMYXllckNsaWNrKCkge1xuICAgIGhhbmRsZUNyZWF0ZUxheWVyTGlzdFRlbGVtZXRyeShcInNjZW5lIGxheWVyXCIpO1xuICAgIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwic2NlbmVMYXllclwiO1xuICAgIC8vIFRPRE86IGFkZCB0ZWxlbWV0cnlcbiAgICAvLyBsb2dUaWxlTGF5ZXJTdGFydCgpO1xuICAgIGlmIChjb25maWdTdGF0ZS5wb3J0YWwuaXNQb3J0YWwpIHtcbiAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcInNjZW5lTGF5ZXJTZWxlY3RcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgLy8gV2Ugb25seSBoYXZlIDEgb3B0aW9uIGluIEFHT0wgc28ganVzdCBza2lwIHRoZSBzZWxlY3Qgc2NyZWVuIGRpcmVjdGx5XG4gICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJsYXllclVwbG9hZFwiKTtcbiAgICB9XG4gIH1cbiAgb25JbWFnZXJ5TGF5ZXJDbGljaygpIHtcbiAgICBoYW5kbGVDcmVhdGVMYXllckxpc3RUZWxlbWV0cnkoXCJpbWFnZXJ5IGxheWVyXCIpO1xuICAgIHRoaXMuaGFuZGxlUmVkaXJlY3QuZW1pdCh7IHR5cGU6IFwiSW1hZ2VyeSBMYXllclwiIH0pO1xuICB9XG4gIG9uVVJMQ2xpY2soKSB7XG4gICAgaGFuZGxlQ3JlYXRlTGF5ZXJMaXN0VGVsZW1ldHJ5KFwidXJsXCIpO1xuICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcInVybFR5cGVTZWxlY3RcIik7XG4gIH1cbiAgb25EYXRhU3RvcmVDbGljaygpIHtcbiAgICBjb25zdCB1c2VOZXdXb3JrZmxvdyA9IGNvbmZpZ1N0YXRlLmNvbmZpZy5hZGREYXRhc3RvcmVDb21wb25lbnRFbmFibGVkO1xuICAgIGhhbmRsZUNyZWF0ZUxheWVyTGlzdFRlbGVtZXRyeShcImRhdGEgc3RvcmVcIik7XG4gICAgaWYgKCF1c2VOZXdXb3JrZmxvdykge1xuICAgICAgLy8gUHJldmlvdXMgaGFuZGxlciBmb3IgcmVkaXJlY3RpbmcgdG8gdGhlIGRvam8tYmFzZWQgd29ya2Zsb3dcbiAgICAgIHRoaXMuaGFuZGxlUmVkaXJlY3QuZW1pdCh7IHR5cGU6IFwiRGF0YSBTdG9yZVwiIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIC8vIE1pZ3JhdGVkIFVJIGZvciBhZGRpbmcgZGF0YSBzdG9yZXMgaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWFwcC1jb21wb25lbnRzL2lzc3Vlcy8yNDI5XG4gICAgICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPSBcImRhdGFTdG9yZVwiO1xuICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiZGF0YVN0b3JlU2VsZWN0XCIpO1xuICAgIH1cbiAgfVxuICBvbkRhdGFTdG9yZUNvbm5lY3Rpb25DbGljaygpIHtcbiAgICAvL2tlZXBpbmcgdGhpcyBzZXBhcmF0ZSBmcm9tIG9uRGF0YVN0b3JlQ2xpY2sgd2hlbiB0aGlzIG9wZW5zIHVwIHRvIG5ldyBpdGVtIGZvciBPbmxpbmVcbiAgICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPSBcImRhdGFTdG9yZVwiO1xuICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcImRhdGFTdG9yZVNlbGVjdFwiKTtcbiAgfVxuICBvbkFwcGxpY2F0aW9uQ2xpY2soKSB7XG4gICAgaGFuZGxlQ3JlYXRlTGF5ZXJMaXN0VGVsZW1ldHJ5KFwiYW4gYXBwXCIpO1xuICAgIGhhbmRsZUFwcGxpY2F0aW9uQ2xpY2soKTtcbiAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJhcHBsaWNhdGlvblwiKTtcbiAgfVxuICBhc3luYyBvbkxvY2F0b3JDbGljaygpIHtcbiAgICBoYW5kbGVDcmVhdGVMYXllckxpc3RUZWxlbWV0cnkoXCJsb2NhdG9yXCIpO1xuICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcImxvY2F0b3JTZWxlY3RcIik7XG4gIH1cbiAgb25EZXZlbG9wZXJDcmVkZW50aWFsc0NsaWNrKCkge1xuICAgIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwiZGV2ZWxvcGVyQ3JlZGVudGlhbHNcIjtcbiAgICBoYW5kbGVDcmVhdGVMYXllckxpc3RUZWxlbWV0cnkoXCJkZXYgY3JlZFwiKTtcbiAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJkZXZlbG9wZXJDcmVkZW50aWFsc1NlbGVjdFwiKTtcbiAgfVxuICBvblJhc3RlckZ1bmN0aW9uVGVtcGxhdGVDbGljaygpIHtcbiAgICBoYW5kbGVDcmVhdGVMYXllckxpc3RUZWxlbWV0cnkoXCJyYXN0ZXIgZnVuY3Rpb24gdGVtcGxhdGVcIik7XG4gICAgYWRkSXRlbVN0YXRlLnR5cGUgPSBcIlJhc3RlciBmdW5jdGlvbiB0ZW1wbGF0ZVwiO1xuICAgIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwicmFzdGVyRnVuY3Rpb25UZW1wbGF0ZVwiO1xuICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcIml0ZW1Qcm9wZXJ0aWVzXCIpO1xuICB9XG4gIHJlbmRlck9wdGlvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5tYXAoKG9wdGlvbikgPT4gb3B0aW9uLnNob3cgJiYgKGgoXCJsaVwiLCB7IGNsYXNzOiBcImxpc3QtaXRlbVwiIH0sIGgoXCJidXR0b25cIiwgeyBjbGFzczogXCJjYXJkXCIsIG9uQ2xpY2s6IG9wdGlvbi5oYW5kbGVyLmJpbmQodGhpcykgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNhcmRfX2ljb25cIiB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgaWNvbjogb3B0aW9uLmljb24sIHNjYWxlOiBcImxcIiB9KSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjYXJkX19jb250ZW50XCIgfSwgaChcImg0XCIsIHsgY2xhc3M6IFwiY2FyZF9fdGl0bGVcIiB9LCBvcHRpb24uaGVhZGluZywgXCIgXCIsIGgoXCJjYWxjaXRlLWljb25cIiwgeyBjbGFzczogXCJjYXJkX19hcnJvd1wiLCBpY29uOiBcImFycm93LXJpZ2h0XCIsIFwiZmxpcC1ydGxcIjogdHJ1ZSB9KSksIGgoXCJoNFwiLCB7IGNsYXNzOiBcImNhcmRfX3N1YnRpdGxlXCIgfSwgb3B0aW9uLmRlc2NyaXB0aW9uKSkpKSkpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGlzTG9hZGluZywgaTE4biB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoXCJuYXZcIiwgeyBcImFyaWEtbGFiZWxsZWRieVwiOiBcImxheWVycy1saXN0LWhlYWRpbmdcIiB9LCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWxvYWRlclwiLCB7IGFjdGl2ZTogaXNMb2FkaW5nLCB0ZXh0OiBpMThuLmdldFN1YnNjcmlwdGlvbkluZm8gfSksIGgoXCJ1bFwiLCB7IGNsYXNzOiBcImxpc3RcIiB9LCB0aGlzLnJlbmRlck9wdGlvbnMoKSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzTmV3SXRlbUNyZWF0ZUxheWVyc0xpc3Quc3R5bGUgPSBhcmNnaXNOZXdJdGVtQ3JlYXRlTGF5ZXJzTGlzdENzcztcblxuY29uc3QgYXJjZ2lzTmV3SXRlbUNzdkZpZWxkQ3NzID0gXCIuY2VsbHtib3gtc2l6aW5nOmJvcmRlci1ib3g7d2lkdGg6MzMuMzMzMzMzJX0uY2VsbCBsYWJlbHttYXJnaW4tdG9wOjAuNzVyZW0gIWltcG9ydGFudH0ucm93e2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpjZW50ZXI7Z3JpZC1nYXA6MC4yNXJlbTtnYXA6MC4yNXJlbTtwYWRkaW5nOjAuMjVyZW07Ym9yZGVyLXRvcDoxcHggc29saWQgI2VhZWFlYX0uZGVzZWxlY3RlZHtvcGFjaXR5OnZhcigtLWNhbGNpdGUtdWktb3BhY2l0eS1kaXNhYmxlZCl9LnNjcmVlbi1yZWFkZXJzLW9ubHl7cG9zaXRpb246YWJzb2x1dGU7d2lkdGg6MXB4O2hlaWdodDoxcHg7cGFkZGluZzowO21hcmdpbjotMXB4O292ZXJmbG93OmhpZGRlbjtjbGlwOnJlY3QoMCwgMCwgMCwgMCk7d2hpdGUtc3BhY2U6bm93cmFwO2JvcmRlci13aWR0aDowfS5sYWJlbHstLWNhbGNpdGUtbGFiZWwtbWFyZ2luLWJvdHRvbTowO3Bvc2l0aW9uOnJlbGF0aXZlfS5maWVsZC1uYW1le292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzO3doaXRlLXNwYWNlOm5vd3JhcH1cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbUNzdkZpZWxkID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmZpZWxkQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJmaWVsZENoYW5nZVwiLCA3KTtcbiAgICB0aGlzLmhhbmRsZVR5cGVDaGFuZ2UgPSAoZXYpID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gZXYudGFyZ2V0LnNlbGVjdGVkT3B0aW9uLnZhbHVlO1xuICAgICAgdGhpcy5maWVsZENoYW5nZS5lbWl0KHtcbiAgICAgICAgbmFtZTogdGhpcy5maWVsZC5uYW1lLFxuICAgICAgICBrZXk6IFwidHlwZVwiLFxuICAgICAgICB2YWx1ZSxcbiAgICAgICAgbW9kaWZpZWQ6IHZhbHVlICE9PSB0aGlzLmluaXRpYWxGaWVsZC50eXBlXG4gICAgICB9KTtcbiAgICB9O1xuICAgIHRoaXMuY2hlY2tlZCA9IHRydWU7XG4gICAgdGhpcy5kZWZhdWx0Q2hlY2tlZCA9IHRydWU7XG4gICAgdGhpcy5maWVsZCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmZpZWxkVHlwZXMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5kZXRlY3RlZFR5cGUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jYW5IaWRlRmllbGRzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZGlzcGxheU5hbWVMYWJlbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnR5cGVMYWJlbCA9IHVuZGVmaW5lZDtcbiAgfVxuICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLmNoZWNrZWQgPSB0aGlzLmRlZmF1bHRDaGVja2VkO1xuICAgIHRoaXMuYWxsb3dlZEZpZWxkVHlwZXMgPSBnZXRBbGxvd2VkRmllbGRUeXBlcyh0aGlzLmRldGVjdGVkVHlwZSk7XG4gICAgLy8gVGVsZW1ldHJ5OiBDYXB0dXJlIGRlZmF1bHQgc3RhdGUgb2YgdGhlIGZpZWxkXG4gICAgdGhpcy5pbml0aWFsRmllbGQgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmZpZWxkKTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBmaWVsZCwgY2FuSGlkZUZpZWxkcyB9ID0gdGhpcztcbiAgICBjb25zdCBkZXNlbGVjdGVkID0gIWZpZWxkLnNlbGVjdGVkO1xuICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInJvd1wiLCByb2xlOiBcInJvd1wiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgY2xhc3M6IFwiY2VsbFwiLCBsYXlvdXQ6IFwiaW5saW5lXCIsIHJvbGU6IFwiY2VsbFwiIH0sIGNhbkhpZGVGaWVsZHMgJiYgKGgoXCJjYWxjaXRlLWNoZWNrYm94XCIsIHsgb25DYWxjaXRlQ2hlY2tib3hDaGFuZ2U6IChldikgPT4gdGhpcy5maWVsZENoYW5nZS5lbWl0KHtcbiAgICAgICAgbmFtZTogZmllbGQubmFtZSxcbiAgICAgICAga2V5OiBcInNlbGVjdGVkXCIsXG4gICAgICAgIHZhbHVlOiBldi50YXJnZXQuY2hlY2tlZFxuICAgICAgfSksIGNoZWNrZWQ6IGZpZWxkLnNlbGVjdGVkIH0pKSwgaChcInNwYW5cIiwgeyBjbGFzczogeyBcImZpZWxkLW5hbWVcIjogdHJ1ZSwgZGVzZWxlY3RlZCB9IH0sIGZpZWxkLm5hbWUpKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJjZWxsIGxhYmVsXCIsIHJvbGU6IFwiY2VsbFwiIH0sIGgoXCJjYWxjaXRlLWlucHV0XCIsIHsgZGlzYWJsZWQ6IGRlc2VsZWN0ZWQsIG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IChldmVudCkgPT4ge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICAgICAgdGhpcy5maWVsZENoYW5nZS5lbWl0KHtcbiAgICAgICAgICBuYW1lOiBmaWVsZC5uYW1lLFxuICAgICAgICAgIGtleTogXCJhbGlhc1wiLFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIG1vZGlmaWVkOiB2YWx1ZSAhPT0gdGhpcy5pbml0aWFsRmllbGQuYWxpYXNcbiAgICAgICAgfSk7XG4gICAgICB9LCB2YWx1ZTogZmllbGQuYWxpYXMgfHwgZmllbGQubmFtZSB9KSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJzY3JlZW4tcmVhZGVycy1vbmx5XCIgfSwgdGhpcy5kaXNwbGF5TmFtZUxhYmVsKSksIGgoXCJjYWxjaXRlLXNlbGVjdFwiLCB7IGxhYmVsOiB0aGlzLnR5cGVMYWJlbCwgY2xhc3M6IFwiY2VsbFwiLCByb2xlOiBcImNlbGxcIiwgXCJhcmlhLXNvcnRcIjogXCJub25lXCIsIGRpc2FibGVkOiBkZXNlbGVjdGVkLCBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6IHRoaXMuaGFuZGxlVHlwZUNoYW5nZSB9LCBPYmplY3Qua2V5cyh0aGlzLmZpZWxkVHlwZXMpXG4gICAgICAuZmlsdGVyKChmaWVsZFR5cGUpID0+IHRoaXMuYWxsb3dlZEZpZWxkVHlwZXMuaW5jbHVkZXMoZmllbGRUeXBlKSlcbiAgICAgIC5tYXAoKHR5cGUpID0+IChoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyBzZWxlY3RlZDogZmllbGQudHlwZSA9PT0gdHlwZSwgdmFsdWU6IHR5cGUsIGtleTogZmllbGQubmFtZSB9LCB0aGlzLmZpZWxkVHlwZXNbdHlwZV0pKSkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1Dc3ZGaWVsZC5zdHlsZSA9IGFyY2dpc05ld0l0ZW1Dc3ZGaWVsZENzcztcblxuY29uc3QgYXJjZ2lzTmV3SXRlbUN1c3RvbVBhcmFtZXRlckNzcyA9IFwiLmNvbnRhaW5lcnttYXJnaW4tYm90dG9tOjAuNXJlbTtib3JkZXI6MXB4IHNvbGlkO2JvcmRlci1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWJvcmRlci0xKTtwYWRkaW5nOjE2cHg7bWF4LXdpZHRoOjEwMCV9LmNvbnRlbnQtY29udGFpbmVye2Rpc3BsYXk6ZmxleH0uaW5wdXRze2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47d2lkdGg6MTAwJX1AbWVkaWEgKG1pbi13aWR0aDogODY0cHgpey5pbnB1dHN7ZmxleC1kaXJlY3Rpb246cm93fX0uaW5wdXRzIGNhbGNpdGUtbGFiZWx7ZmxleDoxIDEgMCV9QG1lZGlhIChtaW4td2lkdGg6IDg2NHB4KXsuaW5wdXRzIGNhbGNpdGUtbGFiZWw6Zmlyc3QtY2hpbGR7LXdlYmtpdC1tYXJnaW4tZW5kOjEycHg7bWFyZ2luLWlubGluZS1lbmQ6MTJweH19LmRlbGV0ZS1jb250YWluZXJ7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpmbGV4LWVuZDthbGlnbi1pdGVtczpjZW50ZXI7cG9zaXRpb246cmVsYXRpdmU7LXdlYmtpdC1tYXJnaW4tc3RhcnQ6MS41cmVtO21hcmdpbi1pbmxpbmUtc3RhcnQ6MS41cmVtO21hcmdpbi10b3A6MTBweH0uZGVsZXRlLWJ0bntjdXJzb3I6cG9pbnRlcjtib3JkZXItc3R5bGU6bm9uZTtiYWNrZ3JvdW5kOnRyYW5zcGFyZW50O2hlaWdodDotbW96LWZpdC1jb250ZW50O2hlaWdodDpmaXQtY29udGVudDtwYWRkaW5nOjZweH0uZGVsZXRlLWJ0bjpmb2N1c3tvdXRsaW5lOjVweCBhdXRvO291dGxpbmUtY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1icmFuZC1ob3Zlcil9LmNoZWNrYm94e2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXJ9Y2FsY2l0ZS1jaGVja2JveHstd2Via2l0LW1hcmdpbi1lbmQ6NXB4O21hcmdpbi1pbmxpbmUtZW5kOjVweH0uZGVsZXRlLWJ0bi1wb3BvdmVye3doaXRlLXNwYWNlOm5vd3JhcDtwYWRkaW5nLWxlZnQ6MC41cmVtO3BhZGRpbmctcmlnaHQ6MC41cmVtO3BhZGRpbmctdG9wOjAuMjVyZW07cGFkZGluZy1ib3R0b206MC4yNXJlbX1cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbUN1c3RvbVBhcmFtZXRlciA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5yZW1vdmVDdXN0b21QYXJhbWV0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcInJlbW92ZUN1c3RvbVBhcmFtZXRlclwiLCA3KTtcbiAgICB0aGlzLnVwZGF0ZUN1c3RvbVBhcmFtZXRlciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwidXBkYXRlQ3VzdG9tUGFyYW1ldGVyXCIsIDcpO1xuICAgIHRoaXMuaXRlbVR5cGUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pbmRleCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmN1c3RvbVBhcmFtZXRlciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmkxOG4gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zaG93QXBwZW5kID0gZmFsc2U7XG4gICAgdGhpcy5kZWxldGVCdXR0b25SZWYgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5kZWxldGVUb29sdGlwT3BlbiA9IGZhbHNlO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgdGhpcy5zZXRGb2N1cygpO1xuICAgIGF3YWl0IHRpbWVvdXQoNTAwKTtcbiAgICBjb25zdCBvcGVuVG9vbHRpcCA9ICgpID0+IHtcbiAgICAgIHRoaXMuZGVsZXRlVG9vbHRpcE9wZW4gPSB0cnVlO1xuICAgIH07XG4gICAgY29uc3QgY2xvc2VUb29sdGlwID0gKCkgPT4ge1xuICAgICAgdGhpcy5kZWxldGVUb29sdGlwT3BlbiA9IGZhbHNlO1xuICAgIH07XG4gICAgdGhpcy5kZWxldGVCdXR0b25SZWYub25mb2N1cyA9IG9wZW5Ub29sdGlwO1xuICAgIHRoaXMuZGVsZXRlQnV0dG9uUmVmLm9uYmx1ciA9IGNsb3NlVG9vbHRpcDtcbiAgICB0aGlzLmRlbGV0ZUJ1dHRvblJlZi5vbm1vdXNlb3ZlciA9IG9wZW5Ub29sdGlwO1xuICAgIHRoaXMuZGVsZXRlQnV0dG9uUmVmLm9ubW91c2VvdXQgPSBjbG9zZVRvb2x0aXA7XG4gIH1cbiAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5oYW5kbGVJdGVtVHlwZUNoYW5nZSgpO1xuICB9XG4gIGFzeW5jIHNldEZvY3VzKGRlbGF5ID0gMCkge1xuICAgIGF3YWl0IHRpbWVvdXQoZGVsYXkpO1xuICAgIHRoaXMubWFpbklucHV0UmVmLnNldEZvY3VzKCk7XG4gIH1cbiAgaGFuZGxlSXRlbVR5cGVDaGFuZ2UoKSB7XG4gICAgdGhpcy5zaG93QXBwZW5kID0gW1wiV01TXCIsIFwiV01UU1wiXS5zb21lKCh0eXBlKSA9PiB0eXBlID09PSB0aGlzLml0ZW1UeXBlKTtcbiAgfVxuICBoYW5kbGVJbnB1dENoYW5nZShldmVudCwgdHlwZSkge1xuICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgY29uc3QgdXBkYXRlZFBhcmFtZXRlciA9IHR5cGUgPT09IFwicGFyYW1ldGVyXCJcbiAgICAgID8gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLmN1c3RvbVBhcmFtZXRlciksIHsgcGFyYW1ldGVyOiBub2RlLnZhbHVlIH0pIDogT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLmN1c3RvbVBhcmFtZXRlciksIHsgdmFsdWU6IG5vZGUudmFsdWUgfSk7XG4gICAgdGhpcy51cGRhdGVDdXN0b21QYXJhbWV0ZXIuZW1pdCh7IGluZGV4OiB0aGlzLmluZGV4LCBjdXN0b21QYXJhbWV0ZXI6IHVwZGF0ZWRQYXJhbWV0ZXIgfSk7XG4gIH1cbiAgaGFuZGxlQ2hlY2tib3hDaGFuZ2UoZXZlbnQpIHtcbiAgICBjb25zdCB1cGRhdGVkUGFyYW1ldGVyID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLmN1c3RvbVBhcmFtZXRlciksIHsgYXBwZW5kOiBldmVudC50YXJnZXQuY2hlY2tlZCA/IFwibGF5ZXJcIiA6IFwiYWxsXCIgfSk7XG4gICAgdGhpcy51cGRhdGVDdXN0b21QYXJhbWV0ZXIuZW1pdCh7IGluZGV4OiB0aGlzLmluZGV4LCBjdXN0b21QYXJhbWV0ZXI6IHVwZGF0ZWRQYXJhbWV0ZXIgfSk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29udGFpbmVyXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbnRlbnQtY29udGFpbmVyXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImlucHV0c1wiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuaTE4bi5wYXJhbWV0ZXIsIGgoXCJjYWxjaXRlLWlucHV0XCIsIHsgcGxhY2Vob2xkZXI6IHRoaXMuaTE4bi5hZGRQYXJhbWV0ZXIsIHZhbHVlOiAoX2EgPSB0aGlzLmN1c3RvbVBhcmFtZXRlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnBhcmFtZXRlciwgb25DYWxjaXRlSW5wdXRJbnB1dDogKGV2KSA9PiB0aGlzLmhhbmRsZUlucHV0Q2hhbmdlKGV2LCBcInBhcmFtZXRlclwiKSwgcmVmOiAoZWxlKSA9PiAodGhpcy5tYWluSW5wdXRSZWYgPSBlbGUpIH0pKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgdGhpcy5pMThuLnZhbHVlLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHBsYWNlaG9sZGVyOiB0aGlzLmkxOG4uYWRkVmFsdWUsIHZhbHVlOiAoX2IgPSB0aGlzLmN1c3RvbVBhcmFtZXRlcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnZhbHVlLCBvbkNhbGNpdGVJbnB1dElucHV0OiAoZXYpID0+IHRoaXMuaGFuZGxlSW5wdXRDaGFuZ2UoZXYsIFwidmFsdWVcIikgfSkpKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImRlbGV0ZS1jb250YWluZXJcIiB9LCBoKFwiYnV0dG9uXCIsIHsgY2xhc3M6IFwiZGVsZXRlLWJ0blwiLCBcImFyaWEtbGFiZWxcIjogdGhpcy5pMThuLnJlbW92ZSwgb25DbGljazogKCkgPT4gdGhpcy5yZW1vdmVDdXN0b21QYXJhbWV0ZXIuZW1pdCh0aGlzLmluZGV4KSwgcmVmOiAoZWxlKSA9PiAodGhpcy5kZWxldGVCdXR0b25SZWYgPSBlbGUpIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBpY29uOiBcInRyYXNoXCIsIHNjYWxlOiBcInNcIiB9KSksIGgoXCJjYWxjaXRlLXBvcG92ZXJcIiwgeyBsYWJlbDogdGhpcy5pMThuLnJlbW92ZSwgcG9pbnRlckRpc2FibGVkOiB0cnVlLCByZWZlcmVuY2VFbGVtZW50OiB0aGlzLmRlbGV0ZUJ1dHRvblJlZiwgb3BlbjogdGhpcy5kZWxldGVUb29sdGlwT3BlbiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZGVsZXRlLWJ0bi1wb3BvdmVyXCIgfSwgdGhpcy5pMThuLnJlbW92ZSkpKSksIHRoaXMuc2hvd0FwcGVuZCAmJiAoaChcImxhYmVsXCIsIHsgY2xhc3M6IFwiY2hlY2tib3hcIiB9LCBoKFwiY2FsY2l0ZS1jaGVja2JveFwiLCB7IGNoZWNrZWQ6IHRoaXMuY3VzdG9tUGFyYW1ldGVyLmFwcGVuZCA9PT0gXCJsYXllclwiLCBvbkNhbGNpdGVDaGVja2JveENoYW5nZTogKGV2KSA9PiB0aGlzLmhhbmRsZUNoZWNrYm94Q2hhbmdlKGV2KSwgb25DbGljazogKGV2KSA9PiBldi5wcmV2ZW50RGVmYXVsdCgpIH0pLCB0aGlzLmkxOG4uYXBwZW5kKSkpKTtcbiAgfVxuICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgIFwiaXRlbVR5cGVcIjogW1wiaGFuZGxlSXRlbVR5cGVDaGFuZ2VcIl1cbiAgfTsgfVxufTtcbkFyY2dpc05ld0l0ZW1DdXN0b21QYXJhbWV0ZXIuc3R5bGUgPSBhcmNnaXNOZXdJdGVtQ3VzdG9tUGFyYW1ldGVyQ3NzO1xuXG5jb25zdCBhcmNnaXNOZXdJdGVtQ3VzdG9tUGFyYW1ldGVyc0NzcyA9IFwiOmhvc3R7Zm9udC1mYW1pbHk6QXZlbmlyIE5leHQsIEF2ZW5pciwgSGVsdmV0aWNhIE5ldWUsIHNhbnMtc2VyaWY7Zm9udC1zaXplOjAuODc1cmVtO21hcmdpbi1ib3R0b206MTRweH0ubGFiZWx7Zm9udC13ZWlnaHQ6NTAwO2ZvbnQtc2l6ZTowLjg3NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMSk7bGluZS1oZWlnaHQ6MTZweDttYXJnaW4tYm90dG9tOjhweH0uc3ViLWhlYWRlcntmb250LXNpemU6MC44NzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTMpO2Rpc3BsYXk6ZmxleDttYXJnaW4tdG9wOjBweDtsaW5lLWhlaWdodDoxOHB4fS5oZWxwLXRleHR7bWF4LXdpZHRoOjIwcmVtO2Rpc3BsYXk6YmxvY2t9LmFkZHtmb250LXdlaWdodDo1MDA7Zm9udC1zaXplOjAuODc1cmVtO2N1cnNvcjpwb2ludGVyO2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2FsaWduLWl0ZW1zOmNlbnRlcjtmb250LWZhbWlseTpBdmVuaXIgTmV4dCwgQXZlbmlyLCBIZWx2ZXRpY2EgTmV1ZSwgc2Fucy1zZXJpZjttYXJnaW4tYm90dG9tOjAuNXJlbTt0cmFuc2l0aW9uLWR1cmF0aW9uOjIwMG1zO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC1saW5rKTtib3JkZXI6bm9uZTtib3gtc2hhZG93Om5vbmU7YmFja2dyb3VuZDp0cmFuc3BhcmVudDtwYWRkaW5nOjEwcHg7LXdlYmtpdC1wYWRkaW5nLXN0YXJ0OjA7cGFkZGluZy1pbmxpbmUtc3RhcnQ6MDtsaW5lLWhlaWdodDoxNnB4fS5hZGQ6Zm9jdXMsLmFkZDpmb2N1cy12aXNpYmxle291dGxpbmU6NXB4IGF1dG87b3V0bGluZS1jb2xvcjojMDA2MTlifS5hZGQ6aG92ZXJ7Y29sb3I6IzAwNjE5Yn0uYWRkLWljb257Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LWxpbmspOy13ZWJraXQtbWFyZ2luLWVuZDowLjYyNXJlbTttYXJnaW4taW5saW5lLWVuZDowLjYyNXJlbX1cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbUN1c3RvbVBhcmFtZXRlcnMgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuY3VzdG9tUGFyYW1ldGVyUmVmTGlzdCA9IFtdO1xuICAgIHRoaXMuaXRlbVR5cGUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jdXN0b21QYXJhbWV0ZXJzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgfVxuICByZW1vdmVDdXN0b21QYXJhbWV0ZXIoZXZlbnQpIHtcbiAgICBjb25zdCBpdGVtSW5kZXggPSBldmVudC5kZXRhaWw7XG4gICAgY29uc3QgeyB1cmwgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBpZiAodXJsKSB7XG4gICAgICBjb25zdCBuZXdVcmwgPSByZW1vdmVQYXJhbWV0ZXIodXJsLCB0aGlzLmN1c3RvbVBhcmFtZXRlcnNbaXRlbUluZGV4XSk7XG4gICAgICBhZGRJdGVtU3RhdGUudXJsID0gbmV3VXJsO1xuICAgIH1cbiAgICBjb25zdCB7IGN1c3RvbVBhcmFtZXRlcnMgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICB0aGlzLmN1c3RvbVBhcmFtZXRlcnMgPSBjdXN0b21QYXJhbWV0ZXJzLmZpbHRlcigoXywgaW5kZXgpID0+IGluZGV4ICE9PSBpdGVtSW5kZXgpO1xuICAgIGFkZEl0ZW1TdGF0ZS5jdXN0b21QYXJhbWV0ZXJzID0gWy4uLnRoaXMuY3VzdG9tUGFyYW1ldGVyc107XG4gICAgaWYgKHRoaXMuY3VzdG9tUGFyYW1ldGVycy5sZW5ndGggPD0gMCkge1xuICAgICAgdGhpcy5uZXdDdXN0b21QYXJhbWV0ZXJSZWYuZm9jdXMoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmN1c3RvbVBhcmFtZXRlclJlZkxpc3RbTWF0aC5tYXgoMCwgaXRlbUluZGV4IC0gMSldLnNldEZvY3VzKCk7XG4gICAgfVxuICB9XG4gIHVwZGF0ZUN1c3RvbVBhcmFtZXRlckhhbmRsZXIoZXZlbnQpIHtcbiAgICBjb25zdCB7IGN1c3RvbVBhcmFtZXRlcnMgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBjb25zdCB7IGluZGV4LCBjdXN0b21QYXJhbWV0ZXIgfSA9IGV2ZW50LmRldGFpbDtcbiAgICB0aGlzLmN1c3RvbVBhcmFtZXRlcnMgPSBjdXN0b21QYXJhbWV0ZXJzLm1hcCgoZW50cnksIGlkeCkgPT4ge1xuICAgICAgaWYgKGlkeCA9PT0gaW5kZXgpIHtcbiAgICAgICAgZW50cnkgPSBjdXN0b21QYXJhbWV0ZXI7XG4gICAgICB9XG4gICAgICByZXR1cm4gZW50cnk7XG4gICAgfSk7XG4gICAgYWRkSXRlbVN0YXRlLmN1c3RvbVBhcmFtZXRlcnMgPSBbLi4udGhpcy5jdXN0b21QYXJhbWV0ZXJzXTtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICBjb25zdCB7IGN1c3RvbVBhcmFtZXRlcnMgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICB0aGlzLmkxOG4gPSB1aVN0b3JlU3RhdGUuaTE4bi5jdXN0b21QYXJhbWV0ZXJzO1xuICAgIHRoaXMuY3VzdG9tUGFyYW1ldGVycyA9IGN1c3RvbVBhcmFtZXRlcnM7XG4gIH1cbiAgY3JlYXRlTmV3Q3VzdG9tUGFyYW1ldGVyKCkge1xuICAgIGNvbnN0IHsgY3VzdG9tUGFyYW1ldGVycyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIHRoaXMuY3VzdG9tUGFyYW1ldGVycyA9IFsuLi5jdXN0b21QYXJhbWV0ZXJzLCB7IHBhcmFtZXRlcjogXCJcIiwgdmFsdWU6IFwiXCIsIGFwcGVuZDogXCJhbGxcIiB9XTtcbiAgICBhZGRJdGVtU3RhdGUuY3VzdG9tUGFyYW1ldGVycyA9IHRoaXMuY3VzdG9tUGFyYW1ldGVycztcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgaTE4biwgaXRlbVR5cGUgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgY2xhc3M6IFwibGFiZWxcIiB9LCBpMThuLmN1c3RvbVBhcmFtZXRlcnMpLCBoKFwicFwiLCB7IGNsYXNzOiBcInN1Yi1oZWFkZXJcIiB9LCBpMThuLmRlc2NyaXB0aW9uLCBcIiBcIiwgaChcImFyY2dpcy1pbmZvcm1hdGlvblwiLCB7IGxhYmVsOiBpMThuLmN1c3RvbVBhcmFtZXRlcnMsIHBsYWNlbWVudDogXCJib3R0b21cIiwgb2Zmc2V0U2tpZGRpbmc6IDYsIG92ZXJsYXlQb3NpdGlvbmluZzogXCJmaXhlZFwiLCBoZWFkaW5nTGV2ZWw6IDMsIHBhZGRlZENvbnRlbnQ6IHRydWUgfSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJoZWxwLXRleHRcIiB9LCBpMThuLmhlbHBUZXh0KSkpLCBoKFwiYnV0dG9uXCIsIHsgY2xhc3M6IFwiYWRkXCIsIHR5cGU6IFwic3VibWl0XCIsIG9uQ2xpY2s6ICgpID0+IHRoaXMuY3JlYXRlTmV3Q3VzdG9tUGFyYW1ldGVyKCksIHJlZjogKGVsZSkgPT4gKHRoaXMubmV3Q3VzdG9tUGFyYW1ldGVyUmVmID0gZWxlKSB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgY2xhc3M6IFwiYWRkLWljb25cIiwgaWNvbjogXCJwbHVzXCIsIHNjYWxlOiBcInNcIiB9KSwgaTE4bi5uZXdDdXN0b21QYXJhbWV0ZXIpLCAoX2EgPSB0aGlzLmN1c3RvbVBhcmFtZXRlcnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOlxuICAgICAgX2EubWFwKChjdXN0b21QYXJhbWV0ZXIsIGluZGV4KSA9PiB7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1uZXctaXRlbS1jdXN0b20tcGFyYW1ldGVyXCIsIHsgY2xhc3M6IFwiY3VzdG9tLXBhcmFtZXRlclwiLCBpdGVtVHlwZTogaXRlbVR5cGUsIGN1c3RvbVBhcmFtZXRlcjogY3VzdG9tUGFyYW1ldGVyLCBpbmRleDogaW5kZXgsIGkxOG46IGkxOG4sIHJlZjogKGVsZSkgPT4gKHRoaXMuY3VzdG9tUGFyYW1ldGVyUmVmTGlzdFtpbmRleF0gPSBlbGUpIH0pKTtcbiAgICAgIH0pKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1DdXN0b21QYXJhbWV0ZXJzLnN0eWxlID0gYXJjZ2lzTmV3SXRlbUN1c3RvbVBhcmFtZXRlcnNDc3M7XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1JbnB1dFJlYWRvbmx5Q3NzID0gXCI6aG9zdHstLWFyY2dpcy1sYWJlbC1mb250LXdlaWdodDo0MDB9LmxhYmVse21hcmdpbi10b3A6MDttYXJnaW4tYm90dG9tOjA7Zm9udC13ZWlnaHQ6dmFyKC0tYXJjZ2lzLWxhYmVsLWZvbnQtd2VpZ2h0KX0ubGFiZWwtLWJvbGR7LS1hcmNnaXMtbGFiZWwtZm9udC13ZWlnaHQ6NTAwfVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtSW5wdXRSZWFkb25seSA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5zY2FsZSA9IFwibVwiO1xuICAgIHRoaXMubGFiZWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wYXRoID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxhYmVsVHlwZSA9IFwiYm9sZFwiO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgdGhpcy5pMThuID0gdWlTdG9yZVN0YXRlLmkxOG4uaW5wdXRSZWFkb25seTtcbiAgICBjb25zdCB7IG5ld0l0ZW1Nb2RlOiBpdGVtVHlwZSwgZmlsZU5hbWUsIG9yaWdpbmFsRmlsZU5hbWUsIHVybCwgcHJvdmlkZXIsIGRhdGFiYXNlUHJvdmlkZXIsIGFkZERhdGFTdG9yZVR5cGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBjb25zdCBzdHJpbmdzID0gdWlTdG9yZVN0YXRlLmkxOG4uaXRlbVByb3BlcnRpZXM7XG4gICAgc3dpdGNoIChpdGVtVHlwZSkge1xuICAgICAgY2FzZSBcImZpbGVcIjpcbiAgICAgICAgdGhpcy5sYWJlbCA9IChfYSA9IHRoaXMubGFiZWwpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHRoaXMuaTE4bi5maWxlO1xuICAgICAgICB0aGlzLnBhdGggPSBvcmlnaW5hbEZpbGVOYW1lICE9PSBudWxsICYmIG9yaWdpbmFsRmlsZU5hbWUgIT09IHZvaWQgMCA/IG9yaWdpbmFsRmlsZU5hbWUgOiBmaWxlTmFtZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwidXJsXCI6XG4gICAgICAgIHRoaXMubGFiZWwgPSB0aGlzLmkxOG4udXJsO1xuICAgICAgICB0aGlzLnBhdGggPSB1cmw7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImRhdGFTdG9yZVwiOlxuICAgICAgICB0aGlzLmxhYmVsID0gdGhpcy5pMThuLmRhdGFTdG9yZTtcbiAgICAgICAgdGhpcy5wYXRoID1cbiAgICAgICAgICBhZGREYXRhU3RvcmVUeXBlID09PSBcImNsb3VkXCIgPyBzdHJpbmdzW3Byb3ZpZGVyXSA6IChfYiA9IHN0cmluZ3NbZGF0YWJhc2VQcm92aWRlcl0pICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IG51bGw7XG4gICAgfVxuICB9XG4gIHJlbmRlcigpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyBsYWJlbFR5cGUsIHBhdGgsIGxhYmVsLCBzY2FsZSB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgc2NhbGU6IChfYSA9IGNvbmZpZ1N0YXRlLnNjYWxlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBzY2FsZSB9LCBhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0T3B0aW9uICE9PSBcIm92ZXJ3cml0ZVwiICYmIChoKFwic3BhblwiLCB7IGNsYXNzOiBgbGFiZWwgbGFiZWwtLSR7bGFiZWxUeXBlfWAgfSwgbGFiZWwpKSwgcGF0aCAmJiBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaXRlbS1maWVsZFwiIH0sIHBhdGgpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1JbnB1dFJlYWRvbmx5LnN0eWxlID0gYXJjZ2lzTmV3SXRlbUlucHV0UmVhZG9ubHlDc3M7XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1MYXllclNlYXJjaENzcyA9IFwiLnNjcmVlbi1yZWFkZXJ7cG9zaXRpb246YWJzb2x1dGU7d2lkdGg6MXB4O2hlaWdodDoxcHg7cGFkZGluZzowO21hcmdpbjotMXB4O292ZXJmbG93OmhpZGRlbjtjbGlwOnJlY3QoMCwgMCwgMCwgMCk7d2hpdGUtc3BhY2U6bm93cmFwO2JvcmRlci13aWR0aDowfS5zZWFyY2gtY29udGFpbmVye3dpZHRoOjEwMCV9XCI7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1MYXllclNlYXJjaCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5zZWFyY2hVcGRhdGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcInNlYXJjaFVwZGF0ZVwiLCA3KTtcbiAgICB0aGlzLmhhbmRsZVNlYXJjaElucHV0ID0gKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCBpbnB1dCA9IGV2ZW50LnRhcmdldC52YWx1ZSB8fCBcIlwiO1xuICAgICAgaWYgKGlucHV0ICE9PSB0aGlzLnNlYXJjaElucHV0KSB7XG4gICAgICAgIHRoaXMuc2VhcmNoSW5wdXQgPSBpbnB1dDtcbiAgICAgICAgdGhpcy5zZWFyY2hVcGRhdGUuZW1pdChpbnB1dCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZUtleXVwID0gKGV2ZW50KSA9PiB7XG4gICAgICBpZiAoKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIiB8fCBldmVudC5rZXkgPT09IFwiRXNjXCIpICYmIHRoaXMuc2VhcmNoSW5wdXQpIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuc2VhcmNoSW5wdXQgPSBcIlwiO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5zZWFyY2hJbnB1dCA9IFwiXCI7XG4gICAgdGhpcy5jb250cm9scyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNlYXJjaExhYmVsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLmkxOG4gPSB1aVN0b3JlU3RhdGUuaTE4bi5sYXllclNlYXJjaDtcbiAgfVxuICBhc3luYyBmb2N1c01haW5JbnB1dCgpIHtcbiAgICB0aGlzLm1haW5JbnB1dFJlZi5zZXRGb2N1cygpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJzZWFyY2gtY29udGFpbmVyXCIgfSwgaChcImxhYmVsXCIsIHsgY2xhc3M6IFwic2NyZWVuLXJlYWRlclwiLCBodG1sRm9yOiBcInNlYXJjaFwiIH0sIHRoaXMuaTE4bi5zZWFyY2gpLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHBsYWNlaG9sZGVyOiBgJHt0aGlzLmkxOG4uc2VhcmNofSAke3RoaXMuc2VhcmNoTGFiZWx9YCwgaWNvbjogXCJzZWFyY2hcIiwgdHlwZTogXCJzZWFyY2hcIiwgaWQ6IFwic2VhcmNoXCIsIGNsZWFyYWJsZTogdHJ1ZSwgXCJhcmlhLWNvbnRyb2xzXCI6IHRoaXMuY29udHJvbHMsIHZhbHVlOiB0aGlzLnNlYXJjaElucHV0LCBvbktleVVwOiB0aGlzLmhhbmRsZUtleXVwLCByZWY6IChlbCkgPT4gKHRoaXMubWFpbklucHV0UmVmID0gZWwpLCBvbkNhbGNpdGVJbnB1dElucHV0OiB0aGlzLmhhbmRsZVNlYXJjaElucHV0IH0pKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1MYXllclNlYXJjaC5zdHlsZSA9IGFyY2dpc05ld0l0ZW1MYXllclNlYXJjaENzcztcblxuY29uc3QgYXJjZ2lzTmV3SXRlbVBhZ2VzQXBwbGljYXRpb25Dc3MgPSBcIi5mbGV4LWNvbnRhaW5lcntkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW59LmxlYWRlcnttYXJnaW4tdG9wOjJyZW19LnR3by11cHt3aWR0aDpjYWxjKDUwJSAtIDJyZW0pfWNhbGNpdGUtbGFiZWx7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpfS5sYWJlbHtmb250LXdlaWdodDo1MDA7Zm9udC1zaXplOjAuODc1cmVtO21hcmdpbi1ib3R0b206MDttYXJnaW4tdG9wOjA7bGluZS1oZWlnaHQ6MThweH0uZmlsZXtmb250LXNpemU6MC44NzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpO21hcmdpbjowO21hcmdpbi1ib3R0b206MnJlbTtwYWRkaW5nOjB9XCI7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1QYWdlc0FwcGxpY2F0aW9uID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVXBkYXRlUGFnZVwiLCA3KTtcbiAgICB0aGlzLnN1Ym1lbnVzID0ge1xuICAgICAgZGVza3RvcDoge1xuICAgICAgICB0aXRsZTogXCJQbGF0Zm9ybVwiLFxuICAgICAgICBmaWxlOiB0cnVlXG4gICAgICB9LFxuICAgICAgbW9iaWxlOiB7IHRpdGxlOiBcIlNES1wiIH0sXG4gICAgICB3ZWI6IHsgdGl0bGU6IFwiQVBJXCIgfVxuICAgIH07XG4gICAgdGhpcy51cmwgPSBhZGRJdGVtU3RhdGUudXJsO1xuICAgIHRoaXMudXJsSW5wdXRNZXNzYWdlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZmlsZUlucHV0TWVzc2FnZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm1hbmlmZXN0SW5wdXRNZXNzYWdlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubWFuaWZlc3RVcmwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaTE4blVSTCA9IHVuZGVmaW5lZDtcbiAgfVxuICB2YWxpZGF0ZUZpbGUoZmlsZSkge1xuICAgIGNvbnN0IHsgdGl0bGUsIGZpbGVOYW1lLCBleHRlbnNpb24gfSA9IHNhbml0aXplRmlsZUlucHV0KGZpbGUpO1xuICAgIGlmIChleHRlbnNpb24gIT09IFwiemlwXCIpIHtcbiAgICAgIHRoaXMuZmlsZUlucHV0TWVzc2FnZSA9IHRoaXMuaTE4bi5zZWxlY3RaaXA7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgYWRkSXRlbVN0YXRlLmZpbGUgPSBmaWxlO1xuICAgICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSA9IHRpdGxlO1xuICAgICAgYWRkSXRlbVN0YXRlLmZpbGVOYW1lID0gZmlsZU5hbWU7XG4gICAgICB0aGlzLmZpbGVJbnB1dE1lc3NhZ2UgPSBudWxsO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG4gIGFzeW5jIG5hdmlnYXRlVG9OZXh0UGFnZSgpIHtcbiAgICBjb25zdCB7IHVybCwgaTE4biwgaTE4blVSTCwgbWFuaWZlc3RVcmwgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBmaWxlLCBhcHBsaWNhdGlvblR5cGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBsZXQgbWFuaWZlc3Q7XG4gICAgaWYgKHVybCAmJiBpc0h0dHAodXJsLCBjb25maWdTdGF0ZS5wb3J0YWwuaXNQb3J0YWwpKSB7XG4gICAgICB0aGlzLnVybElucHV0TWVzc2FnZSA9IGkxOG5VUkwuaHR0cFdhcm5pbmc7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChhcHBsaWNhdGlvblR5cGUgPT09IFwiZGVza3RvcFwiKSB7XG4gICAgICBpZiAoIWZpbGUpIHtcbiAgICAgICAgdGhpcy5maWxlSW5wdXRNZXNzYWdlID0gaTE4bi5maWxlUmVxdWlyZWQ7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy52YWxpZGF0ZUZpbGUoZmlsZSkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoKGFwcGxpY2F0aW9uVHlwZSA9PT0gXCJtb2JpbGVcIiB8fCBhcHBsaWNhdGlvblR5cGUgPT09IFwid2ViXCIpICYmICF1cmwpIHtcbiAgICAgIHRoaXMudXJsSW5wdXRNZXNzYWdlID0gaTE4bi5lbnRlclVybDtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGFwcGxpY2F0aW9uVHlwZSA9PT0gXCJhcHBFeHRlbnNpb25cIiB8fCBhcHBsaWNhdGlvblR5cGUgPT09IFwiZXhwZXJpZW5jZUJ1aWxkZXJXaWRnZXRcIikge1xuICAgICAgaWYgKCFtYW5pZmVzdFVybCkge1xuICAgICAgICB0aGlzLm1hbmlmZXN0SW5wdXRNZXNzYWdlID0gaTE4bi5lbnRlck1hbmlmZXN0VXJsO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCB7IGVycm9yLCByZXN1bHQgfSA9IGF3YWl0IGZldGNoQXBwbGljYXRpb25NYW5pZmVzdCh0aGlzLm1hbmlmZXN0VXJsKTtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICB0aGlzLm1hbmlmZXN0SW5wdXRNZXNzYWdlID0gdGhpcy5pMThuW2Vycm9yLmNvZGVdO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBtYW5pZmVzdCA9IHJlc3VsdDtcbiAgICB9XG4gICAgLy8gc29tZSBhcGlzIG5lZWQgdG8gYmUgc2VudCB0byB0aGUgc2VydmVyIGRpZmZlcmVudGx5IHRoYW4gdGhleSBhcmUgc2hvd24gaW4gdGhlIGRyb3Bkb3duXG4gICAgY29uc3QgdHlwZXMgPSB7XG4gICAgICB3ZWI6IHtcbiAgICAgICAgdHlwZTogXCJXZWIgTWFwcGluZyBBcHBsaWNhdGlvblwiLFxuICAgICAgICB0eXBlS2V5d29yZHM6IFtcIldlYiBNYXBcIiwgXCJNYXBcIiwgXCJPbmxpbmUgTWFwXCIsIFwiTWFwcGluZyBTaXRlXCJdLFxuICAgICAgICB0aHVtYm5haWxVcmw6IFwiaHR0cHM6Ly9zdGF0aWMuYXJjZ2lzLmNvbS9pbWFnZXMvd2ViYXBwLnBuZ1wiLFxuICAgICAgICB1cmxcbiAgICAgIH0sXG4gICAgICBkZXNrdG9wOiB7XG4gICAgICAgIHR5cGU6IFwiRGVza3RvcCBBcHBsaWNhdGlvblwiLFxuICAgICAgICB0eXBlS2V5d29yZHM6IFtcIkRlc2t0b3AgQXBwbGljYXRpb25cIl0sXG4gICAgICAgIHVybFxuICAgICAgfSxcbiAgICAgIG1vYmlsZToge1xuICAgICAgICB0eXBlOiBcIk1vYmlsZSBBcHBsaWNhdGlvblwiLFxuICAgICAgICB0eXBlS2V5d29yZHM6IFtcIkFyY0dJUyBNb2JpbGUgTWFwXCIsIFwiTW9iaWxlIEFwcGxpY2F0aW9uXCJdLFxuICAgICAgICB0aHVtYm5haWxVcmw6IFwiaHR0cHM6Ly9zdGF0aWMuYXJjZ2lzLmNvbS9pbWFnZXMvbW9iaWxlYXBwLnBuZ1wiLFxuICAgICAgICB1cmxcbiAgICAgIH0sXG4gICAgICBhcHBFeHRlbnNpb246IHtcbiAgICAgICAgdHlwZTogXCJBcHBCdWlsZGVyIEV4dGVuc2lvblwiLFxuICAgICAgICB0eXBlS2V5d29yZHM6IFtcbiAgICAgICAgICBcIldpZGdldFwiLFxuICAgICAgICAgIFwiQXBwIEJ1aWxkZXJcIixcbiAgICAgICAgICBcIndpZGdldFwiLFxuICAgICAgICAgIChtYW5pZmVzdCA9PT0gbnVsbCB8fCBtYW5pZmVzdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWFuaWZlc3QucGxhdGZvcm0pID09PSBcIkhUTUwzRFwiID8gXCJIVE1MM0RcIiA6IFwiSFRNTFwiXG4gICAgICAgIF0sXG4gICAgICAgIHVybDogbWFuaWZlc3RVcmwsXG4gICAgICAgIGFjY2Vzc0luZm9ybWF0aW9uOiAobWFuaWZlc3QgPT09IG51bGwgfHwgbWFuaWZlc3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hbmlmZXN0LmF1dGhvcikgfHwgXCJcIixcbiAgICAgICAgdGV4dDogbWFuaWZlc3QgPyBKU09OLnN0cmluZ2lmeShtYW5pZmVzdCkgOiBcIlwiXG4gICAgICB9LFxuICAgICAgZXhwZXJpZW5jZUJ1aWxkZXJXaWRnZXQ6IHtcbiAgICAgICAgdHlwZTogXCJFeHBlcmllbmNlIEJ1aWxkZXIgV2lkZ2V0XCIsXG4gICAgICAgIHVybDogbWFuaWZlc3RVcmwsXG4gICAgICAgIGFjY2Vzc0luZm9ybWF0aW9uOiAobWFuaWZlc3QgPT09IG51bGwgfHwgbWFuaWZlc3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hbmlmZXN0LmF1dGhvcikgfHwgXCJcIixcbiAgICAgICAgdGV4dDogbWFuaWZlc3QgPyBKU09OLnN0cmluZ2lmeShtYW5pZmVzdCkgOiBcIlwiXG4gICAgICB9LFxuICAgICAgb3RoZXJBcHBsaWNhdGlvbjoge1xuICAgICAgICB0eXBlOiBcIkFwcGxpY2F0aW9uXCIsXG4gICAgICAgIHR5cGVLZXl3b3JkczogW1wiQXBwbGljYXRpb25cIl1cbiAgICAgIH1cbiAgICB9O1xuICAgIGxldCB0aXRsZSA9IFwiXCI7XG4gICAgaWYgKHVybCkge1xuICAgICAgdGl0bGUgPSB1cmxUb1RpdGxlKHVybCkgfHwgXCJcIjtcbiAgICB9XG4gICAgZWxzZSBpZiAoZmlsZSkge1xuICAgICAgdGl0bGUgPSBzYW5pdGl6ZUZpbGVJbnB1dChmaWxlKS50aXRsZTtcbiAgICB9XG4gICAgZWxzZSBpZiAobWFuaWZlc3QpIHtcbiAgICAgIHRpdGxlID0gbWFuaWZlc3QubmFtZSB8fCBcImFwcGxpY2F0aW9uIGV4dGVuc2lvblwiO1xuICAgIH1cbiAgICBjb25zdCB0eXBlRGV0YWlscyA9IHR5cGVzW2FwcGxpY2F0aW9uVHlwZV07XG4gICAgYWRkSXRlbVN0YXRlLm5ld0l0ZW1Nb2RlID0gXCJhcHBsaWNhdGlvblwiO1xuICAgIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUgPSB0aXRsZTtcbiAgICBhZGRJdGVtU3RhdGUubmFtZSA9IGAke3RpdGxlfV8ke2d1aWQoKX1gO1xuICAgIGFkZEl0ZW1TdGF0ZS50eXBlID0gdHlwZURldGFpbHMudHlwZTtcbiAgICBhZGRJdGVtU3RhdGUudHlwZUtleXdvcmRzID0gdHlwZURldGFpbHMudHlwZUtleXdvcmRzO1xuICAgIGFkZEl0ZW1TdGF0ZS51cmwgPSB0eXBlRGV0YWlscy51cmw7XG4gICAgYWRkSXRlbVN0YXRlLmFjY2Vzc0luZm9ybWF0aW9uID0gdHlwZURldGFpbHMuYWNjZXNzSW5mb3JtYXRpb247XG4gICAgYWRkSXRlbVN0YXRlLnRleHQgPSB0eXBlRGV0YWlscy50ZXh0O1xuICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcIml0ZW1Qcm9wZXJ0aWVzXCIpO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIGNvbnN0IHsgYXBwbGljYXRpb24sIHVybCB9ID0gdWlTdG9yZVN0YXRlLmkxOG47XG4gICAgdGhpcy5pMThuID0gYXBwbGljYXRpb247XG4gICAgdGhpcy5pMThuVVJMID0gdXJsO1xuICAgIGNvbnN0IHsgZmlsZSwgYXBwbGljYXRpb25UeXBlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgaWYgKGZpbGUpIHtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5hcHBsaWNhdGlvblR5cGUgPSBcImRlc2t0b3BcIjtcbiAgICB9XG4gICAgZWxzZSBpZiAoIWFwcGxpY2F0aW9uVHlwZSkge1xuICAgICAgYWRkSXRlbVN0YXRlLmFwcGxpY2F0aW9uVHlwZSA9IFwid2ViXCI7XG4gICAgfVxuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGkxOG4gfSA9IHRoaXM7XG4gICAgY29uc3QgeyBhcHBsaWNhdGlvblR5cGUsIGFwcGxpY2F0aW9uRmlsZSwgZmlsZSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIGNvbnN0IG1lbnUgPSB0aGlzLnN1Ym1lbnVzW2FwcGxpY2F0aW9uVHlwZV07XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsICFhcHBsaWNhdGlvbkZpbGUgJiYgYXBwbGljYXRpb25UeXBlID09PSBcImRlc2t0b3BcIiAmJiBmaWxlICYmIChoKFwiZGl2XCIsIG51bGwsIGgoXCJoNFwiLCB7IGNsYXNzOiBcImxhYmVsXCIgfSwgaTE4bi5GaWxlKSwgaChcInBcIiwgeyBjbGFzczogXCJmaWxlXCIgfSwgZmlsZS5uYW1lKSkpLCBoKFwiZm9ybVwiLCB7IG5vdmFsaWRhdGU6IHRydWUsIG9uU3VibWl0OiAoZSkgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9IH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwibGFiZWxcIiB9LCBpMThuLmFwcGxpY2F0aW9uVHlwZSkpLCBoKFwiY2FsY2l0ZS10aWxlLXNlbGVjdC1ncm91cFwiLCB7IGxheW91dDogXCJ2ZXJ0aWNhbFwiIH0sIFtcbiAgICAgIFwid2ViXCIsXG4gICAgICBcImRlc2t0b3BcIixcbiAgICAgIFwibW9iaWxlXCIsXG4gICAgICAuLi4oY29uZmlnU3RhdGUucG9ydGFsLmlzUG9ydGFsICYmIGlzT3JnQWRtaW4oY29uZmlnU3RhdGUudXNlcilcbiAgICAgICAgPyBbXCJhcHBFeHRlbnNpb25cIiwgXCJleHBlcmllbmNlQnVpbGRlcldpZGdldFwiXVxuICAgICAgICA6IFtdKSxcbiAgICAgIFwib3RoZXJBcHBsaWNhdGlvblwiXG4gICAgXS5tYXAoKHZhbHVlKSA9PiAoaChcImNhbGNpdGUtdGlsZS1zZWxlY3RcIiwgeyBjaGVja2VkOiBhcHBsaWNhdGlvblR5cGUgPT09IHZhbHVlLCB3aWR0aDogXCJmdWxsXCIsIFwiaW5wdXQtZW5hYmxlZFwiOiB0cnVlLCBcImlucHV0LWFsaWdubWVudFwiOiBcInN0YXJ0XCIsIHZhbHVlOiB2YWx1ZSwgbmFtZTogaTE4blt2YWx1ZV0sIGhlYWRpbmc6IGkxOG5bdmFsdWVdLCBvbkNhbGNpdGVUaWxlU2VsZWN0Q2hhbmdlOiAoZSkgPT4ge1xuICAgICAgICBhZGRJdGVtU3RhdGUuYXBwbGljYXRpb25UeXBlID0gZS50YXJnZXQudmFsdWU7XG4gICAgICAgIHRoaXMudXJsSW5wdXRNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgdGhpcy5maWxlSW5wdXRNZXNzYWdlID0gbnVsbDtcbiAgICAgIH0gfSkpKSksIG1lbnUgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJsZWFkZXJcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImxhYmVsXCIgfSwgaTE4bi5VUkwpLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHR5cGU6IFwidGV4dFwiLCB2YWx1ZTogdGhpcy51cmwsIHJlcXVpcmVkOiBhcHBsaWNhdGlvblR5cGUgPT09IFwid2ViXCIgfHwgYXBwbGljYXRpb25UeXBlID09PSBcIm1vYmlsZVwiLCBzdGF0dXM6IHRoaXMudXJsSW5wdXRNZXNzYWdlID8gXCJpbnZhbGlkXCIgOiBcImlkbGVcIiwgb25DYWxjaXRlSW5wdXRJbnB1dDogKGUpID0+IHtcbiAgICAgICAgdGhpcy51cmwgPSBlLnRhcmdldC52YWx1ZTtcbiAgICAgICAgdGhpcy51cmxJbnB1dE1lc3NhZ2UgPSBudWxsO1xuICAgICAgfSwgb25Gb2N1c291dDogKGUpID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAoZS50YXJnZXQudmFsdWUgJiYgKChfYSA9IHRoaXMudXJsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5kZXhPZihcImh0dHBcIikpIDwgMCkge1xuICAgICAgICAgIC8vIFRPRE86IHNwZWNpZnkgZS50YXJnZXRcbiAgICAgICAgICB0aGlzLnVybCA9IGBodHRwczovLyR7dGhpcy51cmx9YDtcbiAgICAgICAgfVxuICAgICAgfSB9KSwgaChcImNhbGNpdGUtaW5wdXQtbWVzc2FnZVwiLCB7IGljb246IHRydWUsIGhpZGRlbjogIXRoaXMudXJsSW5wdXRNZXNzYWdlLCBzdGF0dXM6IFwiaW52YWxpZFwiIH0sIHRoaXMudXJsSW5wdXRNZXNzYWdlKSksIG1lbnUuZmlsZSAmJiAoYXBwbGljYXRpb25GaWxlIHx8ICFmaWxlKSAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImxlYWRlclwiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwibGFiZWxcIiB9LCBpMThuLkZpbGUpLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHR5cGU6IFwiZmlsZVwiLCByZXF1aXJlZDogdHJ1ZSwgc3RhdHVzOiB0aGlzLmZpbGVJbnB1dE1lc3NhZ2UgPyBcImludmFsaWRcIiA6IFwiaWRsZVwiLCBvbkNhbGNpdGVJbnB1dElucHV0OiAoZSkgPT4ge1xuICAgICAgICBjb25zdCBmaWxlID0gZS50YXJnZXQuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRcIikuZmlsZXNbMF07XG4gICAgICAgIHRoaXMudmFsaWRhdGVGaWxlKGZpbGUpO1xuICAgICAgICBhZGRJdGVtU3RhdGUuYXBwbGljYXRpb25GaWxlID0gZmlsZTtcbiAgICAgIH0gfSksIGgoXCJjYWxjaXRlLWlucHV0LW1lc3NhZ2VcIiwgeyBpY29uOiB0cnVlLCBoaWRkZW46ICF0aGlzLmZpbGVJbnB1dE1lc3NhZ2UsIHN0YXR1czogXCJpbnZhbGlkXCIgfSwgdGhpcy5maWxlSW5wdXRNZXNzYWdlKSkpKSkpLCBbXCJhcHBFeHRlbnNpb25cIiwgXCJleHBlcmllbmNlQnVpbGRlcldpZGdldFwiXS5pbmNsdWRlcyhhcHBsaWNhdGlvblR5cGUpICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwibGVhZGVyXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgaChcInNwYW5cIiwgeyBjbGFzczogXCJsYWJlbFwiIH0sIGkxOG4ubWFuaWZlc3RVcmwpLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHR5cGU6IFwidGV4dFwiLCByZXF1aXJlZDogdHJ1ZSwgc3RhdHVzOiB0aGlzLm1hbmlmZXN0SW5wdXRNZXNzYWdlID8gXCJpbnZhbGlkXCIgOiBcImlkbGVcIiwgb25DYWxjaXRlSW5wdXRJbnB1dDogKGUpID0+IHtcbiAgICAgICAgdGhpcy5tYW5pZmVzdFVybCA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICB0aGlzLm1hbmlmZXN0SW5wdXRNZXNzYWdlID0gbnVsbDtcbiAgICAgIH0gfSksIGgoXCJjYWxjaXRlLWlucHV0LW1lc3NhZ2VcIiwgeyBpY29uOiB0cnVlLCBoaWRkZW46ICF0aGlzLm1hbmlmZXN0SW5wdXRNZXNzYWdlLCBzdGF0dXM6IFwiaW52YWxpZFwiIH0sIHRoaXMubWFuaWZlc3RJbnB1dE1lc3NhZ2UpKSkpKSkpO1xuICB9XG4gIGdldCBlbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc0FwcGxpY2F0aW9uLnN0eWxlID0gYXJjZ2lzTmV3SXRlbVBhZ2VzQXBwbGljYXRpb25Dc3M7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1QYWdlc0F1dGggPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1VcGRhdGVQYWdlXCIsIDcpO1xuICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWRcIiwgNyk7XG4gICAgdGhpcy5oYW5kbGVQYXNzd29yZENoYW5nZSA9IChldmVudCkgPT4ge1xuICAgICAgdGhpcy51cGRhdGVWYWxpZGF0aW9uUmVzcG9uc2UodHJ1ZSk7XG4gICAgICBhZGRJdGVtU3RhdGUucGFzc3dvcmQgPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZVVzZXJuYW1lQ2hhbmdlID0gKGV2ZW50KSA9PiB7XG4gICAgICB0aGlzLnVwZGF0ZVZhbGlkYXRpb25SZXNwb25zZSh0cnVlKTtcbiAgICAgIGFkZEl0ZW1TdGF0ZS51c2VybmFtZSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICB9O1xuICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgdGhpcy52YWxpZGF0aW9uUmVzcG9uc2UgPSB7IHZhbGlkOiB0cnVlIH07XG4gIH1cbiAgYXN5bmMgbmF2aWdhdGVUb05leHRQYWdlKCkge1xuICAgIGlmICghYWRkSXRlbVN0YXRlLnVzZXJuYW1lIHx8ICFhZGRJdGVtU3RhdGUucGFzc3dvcmQpIHtcbiAgICAgIHRoaXMudmFsaWRhdGlvblJlc3BvbnNlID0geyB2YWxpZDogZmFsc2UsIG1lc3NhZ2U6IHRoaXMuaTE4bi5yZXF1aXJlc0NyZWRlbnRpYWxzIH07XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICB0cnkge1xuICAgICAgLy8gVE9ETzogR2V0IHN0b3JlIHVwZGF0ZXMgc29tZSBvdGhlciB3YXksIG9yIGFkZCBhIHNlcGFyYXRlIHJldHVybiBvYmplY3QgdG8gdGhlIGJpZyBhZGQgdXJsIHR1bm5lbFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhZGRTZWN1cmVBR1NVcmwoT2JqZWN0LmFzc2lnbih7fSwgYWRkSXRlbVN0YXRlKSk7XG4gICAgICBjb25zdCB7IHRpdGxlLCB0YWdzLCBzbmlwcGV0LCBkZXNjcmlwdGlvbiwgc2VydmljZUluZm8sIHNlcnZpY2VVc2VybmFtZSwgc2VydmljZVBhc3N3b3JkLCBzcGF0aWFsUmVmZXJlbmNlLCBwcm94eVVybCwgZXh0ZW50LCB0aHVtYm5haWxUb2tlbiB9ID0gcmVzcG9uc2U7XG4gICAgICBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlID0gdGl0bGUgfHwgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZTtcbiAgICAgIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGFncyA9IHRhZ3M7XG4gICAgICBpdGVtUHJvcGVydGllc1N0YXRlLnNuaXBwZXQgPSBzbmlwcGV0O1xuICAgICAgYWRkSXRlbVN0YXRlLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICBhZGRJdGVtU3RhdGUuc2VydmljZUluZm8gPSBzZXJ2aWNlSW5mbztcbiAgICAgIGFkZEl0ZW1TdGF0ZS5zZXJ2aWNlVXNlcm5hbWUgPSBzZXJ2aWNlVXNlcm5hbWU7XG4gICAgICBhZGRJdGVtU3RhdGUuc2VydmljZVBhc3N3b3JkID0gc2VydmljZVBhc3N3b3JkO1xuICAgICAgYWRkSXRlbVN0YXRlLnNwYXRpYWxSZWZlcmVuY2UgPSBzcGF0aWFsUmVmZXJlbmNlO1xuICAgICAgYWRkSXRlbVN0YXRlLnRodW1ibmFpbFRva2VuID0gdGh1bWJuYWlsVG9rZW47XG4gICAgICBhZGRJdGVtU3RhdGUucHJveHlVcmwgPSBwcm94eVVybDtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5leHRlbnQgPSBleHRlbnQ7XG4gICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgaWYgKGlzSHlicmlkSW1hZ2VTZXJ2aWNlKGFkZEl0ZW1TdGF0ZS51cmwsIHNlcnZpY2VJbmZvKSkge1xuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJoeWJyaWRJbWFnZVNlbGVjdFwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiaXRlbVByb3BlcnRpZXNcIik7XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICB0aGlzLnZhbGlkYXRpb25SZXNwb25zZSA9IHsgdmFsaWQ6IGZhbHNlLCBtZXNzYWdlOiB0aGlzLmkxOG4uaW52YWxpZCB9O1xuICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICB9XG4gIH1cbiAgaGFuZGxlTG9hZENoYW5nZShfb2xkVmFsdWUsIG5ld1ZhbHVlKSB7XG4gICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdChuZXdWYWx1ZSk7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5pMThuID0gdWlTdG9yZVN0YXRlLmkxOG4uYXV0aDtcbiAgICB0aGlzLnVybFR5cGVpMThuID0gdWlTdG9yZVN0YXRlLmkxOG4udXJsVHlwZTtcbiAgICAvLyBDbGVhbiB1cCBvbGQgc2VydmljZUluZm8gaWYgcmV0dXJuaW5nIGZyb20gaXRlbSBwcm9wZXJ0aWVzXG4gICAgYWRkSXRlbVN0YXRlLnNlcnZpY2VJbmZvID0gbnVsbDtcbiAgfVxuICB1cGRhdGVWYWxpZGF0aW9uUmVzcG9uc2UodmFsaWQpIHtcbiAgICBpZiAoIXRoaXMudmFsaWRhdGlvblJlc3BvbnNlLnZhbGlkKSB7XG4gICAgICB0aGlzLnZhbGlkYXRpb25SZXNwb25zZSA9IHsgdmFsaWQgfTtcbiAgICB9XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgaTE4biwgdXJsVHlwZWkxOG4sIHZhbGlkYXRpb25SZXNwb25zZSwgaXNMb2FkaW5nIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgdmFsaWQsIG1lc3NhZ2UgfSA9IHZhbGlkYXRpb25SZXNwb25zZTtcbiAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImFyY2dpcy1uZXctaXRlbS1sb2FkZXJcIiwgeyB0eXBlOiBcImluZGV0ZXJtaW5hdGVcIiwgdmFsdWU6IGFkZEl0ZW1TdGF0ZS51cGxvYWRQcm9ncmVzcywgYWN0aXZlOiBpc0xvYWRpbmcsIHRleHQ6IHVybFR5cGVpMThuLmdldFNlcnZpY2VJbmZvIH0pLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGZvcjogXCJ1c2VybmFtZVwiIH0sIGkxOG4uZW50ZXJVc2VybmFtZSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyBvbkNhbGNpdGVJbnB1dElucHV0OiB0aGlzLmhhbmRsZVVzZXJuYW1lQ2hhbmdlLCBpZDogXCJ1c2VybmFtZVwiLCBwbGFjZWhvbGRlcjogaTE4bi5lbnRlclVzZXJuYW1lLCB2YWx1ZTogYWRkSXRlbVN0YXRlLnVzZXJuYW1lLCBzdGF0dXM6IHZhbGlkID8gXCJpZGxlXCIgOiBcImludmFsaWRcIiB9KSksIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgZm9yOiBcInBhc3N3b3JkXCIgfSwgaTE4bi5lbnRlclBhc3N3b3JkLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHR5cGU6IFwicGFzc3dvcmRcIiwgb25DYWxjaXRlSW5wdXRJbnB1dDogdGhpcy5oYW5kbGVQYXNzd29yZENoYW5nZSwgaWQ6IFwicGFzc3dvcmRcIiwgcGxhY2Vob2xkZXI6IGkxOG4uZW50ZXJQYXNzd29yZCwgdmFsdWU6IGFkZEl0ZW1TdGF0ZS5wYXNzd29yZCwgc3RhdHVzOiB2YWxpZCA/IFwiaWRsZVwiIDogXCJpbnZhbGlkXCIsIHJlcXVpcmVkOiB0cnVlIH0pLCBoKFwiY2FsY2l0ZS1pbnB1dC1tZXNzYWdlXCIsIHsgaWNvbjogIXZhbGlkLCBoaWRkZW46IHZhbGlkLCBzdGF0dXM6IHZhbGlkID8gXCJpZGxlXCIgOiBcImludmFsaWRcIiB9LCBtZXNzYWdlKSkpKTtcbiAgfVxuICBnZXQgZWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICBcImlzTG9hZGluZ1wiOiBbXCJoYW5kbGVMb2FkQ2hhbmdlXCJdXG4gIH07IH1cbn07XG5cbnZhciBUcmVlU2VsZWN0aW9uTW9kZTtcbihmdW5jdGlvbiAoVHJlZVNlbGVjdGlvbk1vZGUpIHtcbiAgVHJlZVNlbGVjdGlvbk1vZGVbXCJTaW5nbGVcIl0gPSBcInNpbmdsZVwiO1xuICBUcmVlU2VsZWN0aW9uTW9kZVtcIk11bHRpXCJdID0gXCJtdWx0aVwiO1xuICBUcmVlU2VsZWN0aW9uTW9kZVtcIkNoaWxkcmVuXCJdID0gXCJjaGlsZHJlblwiO1xuICBUcmVlU2VsZWN0aW9uTW9kZVtcIk11bHRpQ2hpbGRyZW5cIl0gPSBcIm11bHRpLWNoaWxkcmVuXCI7XG4gIFRyZWVTZWxlY3Rpb25Nb2RlW1wiQW5jZXN0b3JzXCJdID0gXCJhbmNlc3RvcnNcIjtcbn0pKFRyZWVTZWxlY3Rpb25Nb2RlIHx8IChUcmVlU2VsZWN0aW9uTW9kZSA9IHt9KSk7XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1QYWdlc0J1bGtMYXllclNlbGVjdENzcyA9IFwiLm91dGVyLWNvbnRhaW5lcntkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1ufS5sYXllci1zZWxlY3QtdHJlZXt3aWR0aDoxMDAlO292ZXJmbG93LXk6YXV0b30ubGF5ZXItbm90aWNle21hcmdpbi1ib3R0b206MS41cmVtfS5zZWxlY3QtaXRlbS1tZXNzYWdle2ZvbnQtd2VpZ2h0OjUwMDtmb250LXNpemU6MC44NzVyZW07bWFyZ2luLWJvdHRvbTowLjI1cmVtfS5sYXllci1ub3QtZm91bmQtbWVzc2FnZXtmb250LXdlaWdodDo1MDA7Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0yKTt0ZXh0LWFsaWduOmNlbnRlcjt3aWR0aDoxMDAlO21hcmdpbi10b3A6MS41cmVtfS5zZWxlY3QtYWxse21hcmdpbi10b3A6NXB4O21hcmdpbi1sZWZ0OjVweH1cIjtcblxuY29uc3QgU09GVF9DQVAgPSAxMDAwO1xuY29uc3QgTUFYX0xBWUVSX0xJTUlUID0gMTAwMDA7XG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNCdWxrTGF5ZXJTZWxlY3QgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1VcGRhdGVQYWdlXCIsIDcpO1xuICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwid29ya2Zsb3dDb21wbGV0ZVwiLCA3KTtcbiAgICAvKiogS2VlcCBhIHJlZmVyZW5jZSB0byBhbGwgdGhlIHRyZWUtaXRlbXMgY3VycmVudGx5IGluIHZpZXcsIGJ5IGlkICovXG4gICAgdGhpcy5pblZpZXcgPSB7fTtcbiAgICB0aGlzLnNlYXJjaFVwZGF0ZUhhbmRsZXIgPSAoZXZlbnQpID0+IHtcbiAgICAgIGNvbnN0IGlucHV0ID0gZXZlbnQuZGV0YWlsO1xuICAgICAgdGhpcy5zZWFyY2hJbnB1dCA9IGlucHV0O1xuICAgICAgY29uc3QgbG93ZXJDYXNlSW5wdXQgPSBpbnB1dC50b0xvd2VyQ2FzZSgpO1xuICAgICAgZnVuY3Rpb24gZ2V0RmlsdGVyZWRMYXllcnMobGF5ZXJzKSB7XG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBbXTtcbiAgICAgICAgbGF5ZXJzLmZvckVhY2goKGxheWVyKSA9PiB7XG4gICAgICAgICAgaWYgKGxheWVyLnRpdGxlXG4gICAgICAgICAgICAudG9Mb3dlckNhc2UoKVxuICAgICAgICAgICAgLy8gVE9ETzogZml4IHRoZSByb290IGNhdXNlIG9mIHRoaXMgd2VpcmQgY2hhcmFjdGVyXG4gICAgICAgICAgICAucmVwbGFjZSgvW1xcdTIwMkZcXHUwMEEwXS9nLCBcIiBcIilcbiAgICAgICAgICAgIC5pbmNsdWRlcyhsb3dlckNhc2VJbnB1dCkgfHxcbiAgICAgICAgICAgICFpbnB1dCkge1xuICAgICAgICAgICAgbWF0Y2hlcy5wdXNoKE9iamVjdC5hc3NpZ24oe30sIGxheWVyKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgc3ViTGF5ZXJzID0gZ2V0RmlsdGVyZWRMYXllcnMobGF5ZXIuc3ViTGF5ZXJzKTtcbiAgICAgICAgICAgIGlmIChzdWJMYXllcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIG1hdGNoZXMucHVzaChPYmplY3QuYXNzaWduKHt9LCBsYXllciwgeyBzdWJMYXllcnMsIGV4cGFuZGVkOiB0cnVlIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbWF0Y2hlcztcbiAgICAgIH1cbiAgICAgIHRoaXMuZmlsdGVyZWRMYXllcnMgPSB0aGlzLmdldERpc3BsYXlMYXllcnMoZ2V0RmlsdGVyZWRMYXllcnModGhpcy5sYXllcnMpKTtcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlTGF5ZXJTZWxlY3QgPSAoZXZlbnQpID0+IHtcbiAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICBjb25zdCBpblZpZXdTZWxlY3RlZExpc3QgPSBub2RlLnNlbGVjdGVkSXRlbXMubWFwKCh0cmVlSXRlbSkgPT4gdHJlZUl0ZW0uZ2V0QXR0cmlidXRlKFwiaWRcIikpO1xuICAgICAgLy8gRmlsdGVyIG91dCBhbnkgaXRlbSB0aGF0J3MgaW4gdmlldywgdGhlbiBzcHJlYWQgdGhlIGN1cnJlbnQgc2VsZWN0ZWQgdHJlZSBiYWNrIGluXG4gICAgICBjb25zdCBvdXRPZlZpZXdTZWxlY3RlZExpc3QgPSBPYmplY3Qua2V5cyh0aGlzLnNlbGVjdGVkTGF5ZXJJZFRyYWNrZXIuaWRNYXApLmZpbHRlcigobGF5ZXJJZCkgPT4gIXRoaXMuaW5WaWV3W2xheWVySWRdKTtcbiAgICAgIGNvbnN0IG5ld1NlbGVjdGVkTGF5ZXJDb3VudCA9IGluVmlld1NlbGVjdGVkTGlzdC5sZW5ndGggKyBvdXRPZlZpZXdTZWxlY3RlZExpc3QubGVuZ3RoO1xuICAgICAgY29uc3QgbmV3U2VsZWN0ZWRJZE1hcCA9IHt9O1xuICAgICAgaW5WaWV3U2VsZWN0ZWRMaXN0LmZvckVhY2goKGxheWVySWQpID0+IChuZXdTZWxlY3RlZElkTWFwW2xheWVySWRdID0gdHJ1ZSkpO1xuICAgICAgb3V0T2ZWaWV3U2VsZWN0ZWRMaXN0LmZvckVhY2goKGxheWVySWQpID0+IChuZXdTZWxlY3RlZElkTWFwW2xheWVySWRdID0gdHJ1ZSkpO1xuICAgICAgY29uc3QgbmV3VHJhY2tlciA9IHtcbiAgICAgICAgY291bnQ6IG5ld1NlbGVjdGVkTGF5ZXJDb3VudCxcbiAgICAgICAgaWRNYXA6IG5ld1NlbGVjdGVkSWRNYXBcbiAgICAgIH07XG4gICAgICBhZGRJdGVtU3RhdGUuc2VsZWN0ZWRMYXllcklkVHJhY2tlciA9IG5ld1RyYWNrZXI7XG4gICAgICB0aGlzLnNlbGVjdGVkTGF5ZXJJZFRyYWNrZXIgPSBuZXdUcmFja2VyO1xuICAgICAgdGhpcy5ub0xheWVyc1NlbGVjdGVkID0gdGhpcy5ub0xheWVyc1NlbGVjdGVkID8gbmV3U2VsZWN0ZWRMYXllckNvdW50IDw9IDAgOiBmYWxzZTtcbiAgICB9O1xuICAgIHRoaXMuZ2V0RGlzcGxheUxheWVycyA9IChsYXllcnMgPSB0aGlzLmxheWVycywgZGlzcGxheUxheWVycyA9IFtdKSA9PiB7XG4gICAgICBsZXQgYWNjID0gMDtcbiAgICAgIGZvciAoY29uc3QgbGF5ZXIgb2YgbGF5ZXJzKSB7XG4gICAgICAgIGlmIChhY2MgPj0gU09GVF9DQVApIHtcbiAgICAgICAgICB0aGlzLnVzZVBybyA9IHRydWU7XG4gICAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSB0aGlzLmlzTGF5ZXJTZWxlY3RlZChsYXllcik7XG4gICAgICAgICAgaWYgKHNlbGVjdGVkIHx8IHRoaXMuY29udGFpbnNTZWxlY3RlZChsYXllcikpIHtcbiAgICAgICAgICAgIGRpc3BsYXlMYXllcnMucHVzaChsYXllcik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGFjYysrO1xuICAgICAgICAgIGlmIChsYXllci5zdWJMYXllcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3Qgc3ViTGF5ZXJDb3VudCA9IHRoaXMuY291bnRTdWJsYXllcnMobGF5ZXIpO1xuICAgICAgICAgICAgaWYgKHN1YkxheWVyQ291bnQgPj0gTUFYX0xBWUVSX0xJTUlUKSB7XG4gICAgICAgICAgICAgIC8vIHdlIHNob3VsZCBub3QgZGlzcGxheSBhbnkgc3VibGF5ZXJzIGlmIHRoZXJlIGFyZSBhIHRvdGFsIG9mID4gMTAsMDAwXG4gICAgICAgICAgICAgIGRpc3BsYXlMYXllcnMucHVzaChPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGxheWVyKSwgeyBzdWJMYXllcnM6IFtdIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBhY2MgKz0gc3ViTGF5ZXJDb3VudDtcbiAgICAgICAgICAgICAgZGlzcGxheUxheWVycy5wdXNoKGxheWVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkaXNwbGF5TGF5ZXJzLnB1c2gobGF5ZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZGlzcGxheUxheWVycy5zb3J0KChsYXllcjEsIGxheWVyMikgPT4gKGxheWVyMS50aXRsZSA+IGxheWVyMi50aXRsZSA/IDEgOiAtMSkpO1xuICAgICAgcmV0dXJuIGRpc3BsYXlMYXllcnM7XG4gICAgfTtcbiAgICB0aGlzLmNvdW50U3VibGF5ZXJzID0gKGxheWVyKSA9PiB7XG4gICAgICAvLyBFeGl0IGlmIG5vIHN1YmxheWVycyBmb3VuZFxuICAgICAgaWYgKGxheWVyLnN1YkxheWVycy5sZW5ndGggPD0gMCkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICAgIC8vIE90aGVyd2lzZSwgYWNjdW11bGF0ZSB0aGUgc3VibGF5ZXJzLCB0aGVuIGNvdW50IGl0cyBzdWJsYXllcnNcbiAgICAgIGxldCBudW1TdWJMYXllciA9IGxheWVyLnN1YkxheWVycy5sZW5ndGg7XG4gICAgICBsYXllci5zdWJMYXllcnMuZm9yRWFjaCgoc3VibGF5ZXIpID0+IHtcbiAgICAgICAgbnVtU3ViTGF5ZXIgKz0gdGhpcy5jb3VudFN1YmxheWVycyhzdWJsYXllcik7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBudW1TdWJMYXllcjtcbiAgICB9O1xuICAgIHRoaXMucmVuZGVyVHJlZSA9IChsYXllcikgPT4ge1xuICAgICAgdmFyIF9hO1xuICAgICAgY29uc3QgaWQgPSBsYXllci5pZDtcbiAgICAgIGNvbnN0IGV4cGFuZGVkID0gbGF5ZXIuZXhwYW5kZWQgfHwgZmFsc2U7XG4gICAgICBjb25zdCBzZWxlY3RlZCA9IHRoaXMuaXNMYXllclNlbGVjdGVkKGxheWVyKTtcbiAgICAgIGNvbnN0IGNvbnRhaW5zU2VsZWN0ZWQgPSB0aGlzLmNvbnRhaW5zU2VsZWN0ZWQobGF5ZXIpO1xuICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS10cmVlLWl0ZW1cIiwgeyBrZXk6IGlkLCBpZDogaWQsIHNlbGVjdGVkOiBzZWxlY3RlZCB8fCBsYXllci52aXNpYmxlLCBleHBhbmRlZDogKGNvbnRhaW5zU2VsZWN0ZWQgJiYgIXNlbGVjdGVkKSB8fCBleHBhbmRlZCwgcmVmOiAoKSA9PiAodGhpcy5pblZpZXdbaWRdID0gdHJ1ZSkgfSwgaChcInNwYW5cIiwgbnVsbCwgbGF5ZXIudGl0bGUpLCAoKF9hID0gbGF5ZXIuc3ViTGF5ZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSA/IChoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2VsZWN0aW9uTW9kZTogVHJlZVNlbGVjdGlvbk1vZGUuQW5jZXN0b3JzLCBzbG90OiBcImNoaWxkcmVuXCIgfSwgbGF5ZXIuc3ViTGF5ZXJzLm1hcCh0aGlzLnJlbmRlclRyZWUpKSkgOiBudWxsKSk7XG4gICAgfTtcbiAgICB0aGlzLm1hbmFnZWRGb2N1cyA9IHRydWU7XG4gICAgdGhpcy5sYXllcnMgPSBbXTtcbiAgICB0aGlzLmZpbHRlcmVkTGF5ZXJzID0gW107XG4gICAgdGhpcy5zZWFyY2hJbnB1dCA9IFwiXCI7XG4gICAgdGhpcy5zZWxlY3RlZExheWVySWRUcmFja2VyID0ge1xuICAgICAgLy8gVHJhbnNmb3JtIHNlbGVjdGVkTGF5ZXJNYXAgaW50byBhcnJheSB0byBnZXQgdGhlIGxlbmd0aCB3b3VsZCBraWxsIG9mZiBwZXJmb3JtYW5jZVxuICAgICAgY291bnQ6IDAsXG4gICAgICBpZE1hcDoge31cbiAgICB9O1xuICAgIHRoaXMudXNlUHJvID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubm9MYXllcnNTZWxlY3RlZCA9IGZhbHNlO1xuICAgIHRoaXMuYWxsTGF5ZXJzU2VsZWN0ZWQgPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCBpMThuID0gdWlTdG9yZVN0YXRlLmkxOG47XG4gICAgdGhpcy5pMThuID0gaTE4bi5idWxrTGF5ZXJTZWxlY3Q7XG4gICAgaWYgKHRoaXMuaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpKSB7XG4gICAgICB1aVN0b3JlU3RhdGUubmV4dFRleHQgPSBhZGRJdGVtU3RhdGUuYWRkQXNCYXNlbWFwID8gXCJ1c2VBc0Jhc2VNYXBcIiA6IFwiYWRkVG9NYXBcIjtcbiAgICB9XG4gICAgY29uc3QgeyBsYXllcnMsIHNlbGVjdGVkTGF5ZXJJZFRyYWNrZXIgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICB0aGlzLmxheWVycyA9ICEhbGF5ZXJzICYmICgoX2EgPSBsYXllcnNbMF0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pZCkgPyBsYXllcnMgOiB0aGlzLmFkZElkcyhsYXllcnMpO1xuICAgIHRoaXMuZmlsdGVyZWRMYXllcnMgPSB0aGlzLmdldERpc3BsYXlMYXllcnMoKTtcbiAgICB0aGlzLnNlbGVjdGVkTGF5ZXJJZFRyYWNrZXIgPSB7XG4gICAgICBjb3VudDogKF9iID0gc2VsZWN0ZWRMYXllcklkVHJhY2tlciA9PT0gbnVsbCB8fCBzZWxlY3RlZExheWVySWRUcmFja2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZExheWVySWRUcmFja2VyLmNvdW50KSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAwLFxuICAgICAgaWRNYXA6IHNlbGVjdGVkTGF5ZXJJZFRyYWNrZXIgPyBPYmplY3QuYXNzaWduKHt9LCBzZWxlY3RlZExheWVySWRUcmFja2VyLmlkTWFwKSA6IHt9XG4gICAgfTtcbiAgfVxuICBvblRyYW5zaXRpb25Db21wbGV0ZSgpIHtcbiAgICB2YXIgX2E7XG4gICAgKF9hID0gdGhpcy5sYXllclNlYXJjaFJlZikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvY3VzTWFpbklucHV0KCk7XG4gIH1cbiAgaGFuZGxlTmV4dCgpIHtcbiAgICBpZiAodGhpcy5zZWxlY3RlZExheWVySWRUcmFja2VyLmNvdW50ID09PSAwKSB7XG4gICAgICB0aGlzLm5vTGF5ZXJzU2VsZWN0ZWQgPSB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIC8vIFNldCBvbmx5IHRoZSBzZWxlY3RlZCBsYXllcnMgYXMgZmluYWwgb3V0cHV0XG4gICAgICBjb25zdCBsYXllcnMgPSB0aGlzLnNldFZpc2liaWxpdHkodGhpcy5sYXllcnMpXG4gICAgICAgIC5maWx0ZXIoKGxheWVyKSA9PiBsYXllci52aXNpYmxlKVxuICAgICAgICAubWFwKChsYXllcikgPT4ge1xuICAgICAgICBjb25zdCB7IG5hbWUsIHRpdGxlLCBxdWVyeWFibGUsIHN1YkxheWVycyB9ID0gbGF5ZXI7XG4gICAgICAgIHJldHVybiB7IG5hbWUsIHRpdGxlLCBxdWVyeWFibGUsIHN1YkxheWVycyB9O1xuICAgICAgfSk7XG4gICAgICBhZGRJdGVtU3RhdGUubGF5ZXJzID0gbGF5ZXJzO1xuICAgICAgLy8gRG9uZSBpZiBkaXJlY3QgYWRkXG4gICAgICBpZiAodGhpcy5pc0FkZFRvTWFwVGVybWluYWxQYWdlKCkpIHtcbiAgICAgICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlLmVtaXQoe1xuICAgICAgICAgIHR5cGU6IGFkZEl0ZW1TdGF0ZS50eXBlLFxuICAgICAgICAgIHVybDogZW5jb2RlVVJJKGFkZEl0ZW1TdGF0ZS51cmwpLFxuICAgICAgICAgIGN1c3RvbVBhcmFtZXRlcnM6IGFkZEl0ZW1TdGF0ZS5jdXN0b21QYXJhbWV0ZXJzLFxuICAgICAgICAgIGxheWVycyxcbiAgICAgICAgICBhZGRBc0Jhc2VtYXA6IGFkZEl0ZW1TdGF0ZS5hZGRBc0Jhc2VtYXBcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiaXRlbVByb3BlcnRpZXNcIik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGlzQWRkVG9NYXBUZXJtaW5hbFBhZ2UoKSB7XG4gICAgcmV0dXJuIHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIjtcbiAgfVxuICBpc0xheWVyU2VsZWN0ZWQobGF5ZXIpIHtcbiAgICByZXR1cm4gISF0aGlzLnNlbGVjdGVkTGF5ZXJJZFRyYWNrZXIuaWRNYXBbbGF5ZXIuaWRdO1xuICB9XG4gIC8qKiByZW1vdmUgSUQgYW5kIHNldCB2aXNpYmlsaXR5IHByaW9yIHRvIGNvbW1pdGluZyB0byBzdG9yZSAqL1xuICBzZXRWaXNpYmlsaXR5KGxheWVycykge1xuICAgIHJldHVybiBsYXllcnMubWFwKChsYXllcikgPT4ge1xuICAgICAgbGF5ZXIudmlzaWJsZSA9IHRoaXMuaXNMYXllclNlbGVjdGVkKGxheWVyKTtcbiAgICAgIGlmIChsYXllci5zdWJMYXllcnMpIHtcbiAgICAgICAgbGF5ZXIuc3ViTGF5ZXJzID0gdGhpcy5zZXRWaXNpYmlsaXR5KGxheWVyLnN1YkxheWVycyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbGF5ZXI7XG4gICAgfSk7XG4gIH1cbiAgLyoqIEFkZCB1bmlxdWUgaWRzIHRvIGVhY2ggbGF5ZXIgaWYgbm90IHByZXZpb3VzbHkgc2V0ICovXG4gIGFkZElkcyhsYXllcnMpIHtcbiAgICByZXR1cm4gbGF5ZXJzLm1hcCgobGF5ZXIpID0+IHtcbiAgICAgIGlmIChsYXllci5zdWJMYXllcnMpIHtcbiAgICAgICAgbGF5ZXIuc3ViTGF5ZXJzID0gdGhpcy5hZGRJZHMobGF5ZXIuc3ViTGF5ZXJzKTtcbiAgICAgIH1cbiAgICAgIGxheWVyLmlkID0gZ3VpZCgpO1xuICAgICAgLy8gU2V0IHZpc2libGUgdG8gZmFsc2UgYnkgZGVmYXVsdFxuICAgICAgbGF5ZXIudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgcmV0dXJuIGxheWVyO1xuICAgIH0pO1xuICB9XG4gIGNvbnRhaW5zU2VsZWN0ZWQobGF5ZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIChfYSA9IGxheWVyLnN1YkxheWVycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNvbWUoKHN1YkxheWVyKSA9PiB7XG4gICAgICBjb25zdCBzZWxlY3RlZCA9IHRoaXMuaXNMYXllclNlbGVjdGVkKGxheWVyKTtcbiAgICAgIGlmIChzdWJMYXllci5zdWJMYXllcnMpIHtcbiAgICAgICAgY29uc3QgY29udGFpbnNEZWVwU2VsZWN0ZWQgPSB0aGlzLmNvbnRhaW5zU2VsZWN0ZWQoc3ViTGF5ZXIpO1xuICAgICAgICByZXR1cm4gc2VsZWN0ZWQgfHwgY29udGFpbnNEZWVwU2VsZWN0ZWQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gc2VsZWN0ZWQ7XG4gICAgfSk7XG4gIH1cbiAgaGFuZGxlU2VsZWN0QWxsKCkge1xuICAgIGNvbnN0IG5ld1NlbGVjdGVkTGF5ZXJJZE1hcCA9IHt9O1xuICAgIGxldCBuZXdTZWxlY3RlZExheWVyQ291bnQgPSAwO1xuICAgIGNvbnN0IHNlbGVjdEFsbCA9IChsYXllcnMpID0+IHtcbiAgICAgIGxheWVycy5mb3JFYWNoKChsYXllcikgPT4ge1xuICAgICAgICBpZiAoIW5ld1NlbGVjdGVkTGF5ZXJJZE1hcFtsYXllci5pZF0pIHtcbiAgICAgICAgICBuZXdTZWxlY3RlZExheWVyQ291bnQgKz0gMTtcbiAgICAgICAgfVxuICAgICAgICBuZXdTZWxlY3RlZExheWVySWRNYXBbbGF5ZXIuaWRdID0gdHJ1ZTtcbiAgICAgICAgaWYgKGxheWVyLnN1YkxheWVycykge1xuICAgICAgICAgIHNlbGVjdEFsbChsYXllci5zdWJMYXllcnMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIGlmICghdGhpcy5hbGxMYXllcnNTZWxlY3RlZCkge1xuICAgICAgc2VsZWN0QWxsKHRoaXMubGF5ZXJzKTtcbiAgICAgIHRoaXMuYWxsTGF5ZXJzU2VsZWN0ZWQgPSB0cnVlO1xuICAgIH1cbiAgICBjb25zdCBuZXdUcmFja2VyID0ge1xuICAgICAgY291bnQ6IG5ld1NlbGVjdGVkTGF5ZXJDb3VudCxcbiAgICAgIGlkTWFwOiBuZXdTZWxlY3RlZExheWVySWRNYXBcbiAgICB9O1xuICAgIHRoaXMuc2VsZWN0ZWRMYXllcklkVHJhY2tlciA9IG5ld1RyYWNrZXI7XG4gICAgYWRkSXRlbVN0YXRlLnNlbGVjdGVkTGF5ZXJJZFRyYWNrZXIgPSBuZXdUcmFja2VyO1xuICB9XG4gIGNoZWNrU2VsZWN0aW9uU3RhdHVzKGxheWVycykge1xuICAgIHJldHVybiBsYXllcnMuZXZlcnkoKGxheWVyKSA9PiB7XG4gICAgICBjb25zdCBzZWxlY3RlZCA9IHRoaXMuaXNMYXllclNlbGVjdGVkKGxheWVyKTtcbiAgICAgIGlmIChsYXllci5zdWJMYXllcnMpIHtcbiAgICAgICAgY29uc3QgY29udGFpbnNTZWxlY3RlZCA9IHRoaXMuY2hlY2tTZWxlY3Rpb25TdGF0dXMobGF5ZXIuc3ViTGF5ZXJzKTtcbiAgICAgICAgcmV0dXJuIHNlbGVjdGVkICYmIGNvbnRhaW5zU2VsZWN0ZWQ7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHNlbGVjdGVkO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICB0aGlzLmluVmlldyA9IHt9O1xuICAgIGNvbnN0IHsgaTE4biwgdXNlUHJvLCBzZWFyY2hVcGRhdGVIYW5kbGVyLCBoYW5kbGVMYXllclNlbGVjdCwgcmVuZGVyVHJlZSwgaGFuZGxlU2VsZWN0QWxsLCBmaWx0ZXJlZExheWVycywgbm9MYXllcnNTZWxlY3RlZCB9ID0gdGhpcztcbiAgICB0aGlzLmFsbExheWVyc1NlbGVjdGVkID0gdGhpcy5jaGVja1NlbGVjdGlvblN0YXR1cyh0aGlzLmZpbHRlcmVkTGF5ZXJzKTtcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJvdXRlci1jb250YWluZXJcIiB9LCBoKFwiY2FsY2l0ZS1ub3RpY2VcIiwgeyBjbGFzczogXCJsYXllci1ub3RpY2VcIiwgaWNvbjogXCJpbmZvcm1hdGlvblwiLCBvcGVuOiB1c2VQcm8sIHdpZHRoOiBcImZ1bGxcIiB9LCBoKFwicFwiLCB7IHNsb3Q6IFwibWVzc2FnZVwiIH0sIGkxOG4udXNlUHJvKSksIGgoXCJzdHJvbmdcIiwgeyBjbGFzczogXCJzZWxlY3QtaXRlbS1tZXNzYWdlXCIgfSwgaTE4bi5zZWxlY3RMYXllcnMpLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWxheWVyLXNlYXJjaFwiLCB7IG9uU2VhcmNoVXBkYXRlOiBzZWFyY2hVcGRhdGVIYW5kbGVyLCBjb250cm9sczogXCJsYXllci1zZWxlY3QtdHJlZVwiLCBzZWFyY2hMYWJlbDogaTE4bi5sYXllcnMsIHJlZjogKGVsZSkgPT4gKHRoaXMubGF5ZXJTZWFyY2hSZWYgPSBlbGUpIH0pLCBmaWx0ZXJlZExheWVycy5sZW5ndGggPT09IDAgPyAoaChcInN0cm9uZ1wiLCB7IGNsYXNzOiBcImxheWVyLW5vdC1mb3VuZC1tZXNzYWdlXCIgfSwgaTE4bi5ub0xheWVyc0ZvdW5kKSkgOiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImxheWVyLXNlbGVjdC10cmVlXCIgfSwgdGhpcy5zZWFyY2hJbnB1dC5sZW5ndGggPj0gMSA/IG51bGwgOiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBjbGFzczogXCJzZWxlY3QtYWxsXCIsIG9uQ2xpY2s6IGhhbmRsZVNlbGVjdEFsbC5iaW5kKHRoaXMpIH0sIHRoaXMuYWxsTGF5ZXJzU2VsZWN0ZWQgPyB0aGlzLmkxOG4uZGVzZWxlY3RBbGwgOiBpMThuLnNlbGVjdEFsbCkpLCBoKFwiY2FsY2l0ZS10cmVlXCIsIHsgb25DYWxjaXRlVHJlZVNlbGVjdDogaGFuZGxlTGF5ZXJTZWxlY3QsIHNlbGVjdGlvbk1vZGU6IFRyZWVTZWxlY3Rpb25Nb2RlLkFuY2VzdG9ycyB9LCBmaWx0ZXJlZExheWVycy5tYXAocmVuZGVyVHJlZSkpKSksIGgoXCJhcmNnaXMtbmV3LWl0ZW0tYWxlcnRcIiwgeyBhY3RpdmU6IG5vTGF5ZXJzU2VsZWN0ZWQsIGhlYWRpbmc6IGkxOG4uZXJyb3JUaXRsZSwgZGVzY3JpcHRpb246IGkxOG4ubm9MYXllcnNTZWxlY3RlZCB9KSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNOZXdJdGVtUGFnZXNCdWxrTGF5ZXJTZWxlY3Quc3R5bGUgPSBhcmNnaXNOZXdJdGVtUGFnZXNCdWxrTGF5ZXJTZWxlY3RDc3M7XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1QYWdlc0Nsb3VkQ3NzID0gXCIuc2NyZWVuLXJlYWRlcnMtb25seXtwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDoxcHg7aGVpZ2h0OjFweDtwYWRkaW5nOjA7bWFyZ2luOi0xcHg7b3ZlcmZsb3c6aGlkZGVuO2NsaXA6cmVjdCgwLCAwLCAwLCAwKTt3aGl0ZS1zcGFjZTpub3dyYXA7Ym9yZGVyLXdpZHRoOjB9LnRhYmxle2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47Ym9yZGVyLXN0eWxlOm5vbmU7bWFyZ2luOjA7bWluLWhlaWdodDozNXJlbX0udGFibGVfX2JvZHl7bWFyZ2luOjA7cGFkZGluZzowO291dGxpbmU6MnB4IHNvbGlkIHRyYW5zcGFyZW50O291dGxpbmUtb2Zmc2V0OjJweDtib3JkZXItc3R5bGU6bm9uZTtmbGV4OjEgMSAwJX0udGFibGVfX2JvZHktLWNlbnRlcntkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktaXRlbXM6Y2VudGVyfS5pbnB1dHt3aWR0aDoxMDAlO21hcmdpbi1ib3R0b206MXJlbTtkaXNwbGF5OmJsb2NrfS5zZWxlY3R7bWluLXdpZHRoOjEwcmVtOy13ZWJraXQtbWFyZ2luLXN0YXJ0OjAuNXJlbTttYXJnaW4taW5saW5lLXN0YXJ0OjAuNXJlbX0uZmlsZXN7cGFkZGluZzowO2xpc3Qtc3R5bGUtdHlwZTpub25lO21hcmdpbjowIC0wLjVyZW19LmZpbGVzX19pdGVte3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjEwMCV9LmZpbGVzX19pdGVtOmJlZm9yZXtkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOmFic29sdXRlO2JvdHRvbTowO2NvbnRlbnQ6XFxcIlxcXCI7cmlnaHQ6MC41cmVtO2xlZnQ6MC41cmVtO2JvcmRlci10b3A6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktYm9yZGVyLTMpO3RyYW5zaXRpb246YWxsIDE1MG1zIGVhc2UtaW4tb3V0O3otaW5kZXg6Mn0uZmlsZXNfX2l0ZW06aG92ZXI6YmVmb3JlLC5maWxlc19faXRlbTpmb2N1cy13aXRoaW46YmVmb3Jle2JvcmRlci10b3AtY29sb3I6IzAwOUFGMn0uZmlsZXNfX2l0ZW0tLWFjdGl2ZTpiZWZvcmV7Ym9yZGVyLXRvcC1jb2xvcjp0cmFuc3BhcmVudH0uZmlsZXtwYWRkaW5nLXRvcDowLjc1cmVtO3BhZGRpbmctYm90dG9tOjAuNzVyZW07cGFkZGluZy1sZWZ0OjAuNXJlbTtwYWRkaW5nLXJpZ2h0OjAuNXJlbTttYXJnaW46MDtkaXNwbGF5OmZsZXg7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTIpO2ZvbnQtc2l6ZTowLjg3NXJlbTt3aWR0aDoxMDAlO2JveC1zaXppbmc6Ym9yZGVyLWJveDtib3JkZXItcmFkaXVzOjA7Y3Vyc29yOnBvaW50ZXI7Zm9udC13ZWlnaHQ6NDAwO2FsaWduLWl0ZW1zOmNlbnRlcjtiYWNrZ3JvdW5kLWNvbG9yOndoaXRlO3RyYW5zaXRpb246YWxsIDE1MG1zIGVhc2UtaW4tb3V0O291dGxpbmU6MXB4IHNvbGlkIHRyYW5zcGFyZW50O291dGxpbmUtb2Zmc2V0Oi0xcHg7Zm9udC1mYW1pbHk6aW5oZXJpdDtib3JkZXI6bm9uZTt0ZXh0LWFsaWduOmluaXRpYWx9LmZpbGVzX19pdGVtLS1hY3RpdmUgLmZpbGV7YmFja2dyb3VuZC1jb2xvcjpyZ2JhKDAsIDEyMSwgMTkzLCAwLjA0KTtvdXRsaW5lLWNvbG9yOiMwMDlBRjJ9LmZpbGVfX2ljb257Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS1icmFuZCk7ZmxleDowfS5maWxlX190aXRsZXtmb250LXdlaWdodDo1MDA7cGFkZGluZy1sZWZ0OjAuNzVyZW07cGFkZGluZy1yaWdodDowLjc1cmVtO2ZvbnQtc2l6ZTowLjg3NXJlbTtmbGV4OjEgMSAwJX0uZmlsZV9fdHlwZXt3aWR0aDozMCU7ZmxleDowIDEgYXV0b30uZmlsZV9fc2l6ZXt0ZXh0LWFsaWduOmlubGluZS1lbmQ7d2lkdGg6NnJlbTtmbGV4OjAgMSBhdXRvfS5uby1yZXN1bHRze3RleHQtYWxpZ246Y2VudGVyO3dpZHRoOjEwMCU7ZGlzcGxheTpibG9ja30ubmV4dHtkaXNwbGF5OmJsb2NrO21hcmdpbjowfS5lcnJvcntwb3NpdGlvbjphYnNvbHV0ZTtib3R0b206MXJlbTtyaWdodDoxcmVtO2luc2V0LWlubGluZS1lbmQ6MXJlbTt6LWluZGV4OjJ9XCI7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1QYWdlc0Nsb3VkID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVXBkYXRlUGFnZVwiLCA3KTtcbiAgICB0aGlzLnVwZGF0ZUZpbHRlciA9ICgpID0+IHtcbiAgICAgIHRoaXMuc2VhcmNoaW5nID0gdHJ1ZTtcbiAgICAgIGNvbnN0IG9wdGlvbiA9IHRoaXMuc2VsZWN0LnF1ZXJ5U2VsZWN0b3IoXCJjYWxjaXRlLW9wdGlvbltzZWxlY3RlZF1cIik7XG4gICAgICB0aGlzLmZpbHRlciA9IG9wdGlvbi52YWx1ZTtcbiAgICAgIHRoaXMuc2VhcmNoKCk7XG4gICAgfTtcbiAgICB0aGlzLmRlYm91bmNlZElucHV0ID0gZGVib3VuY2UoYXN5bmMgKGUpID0+IHtcbiAgICAgIHRoaXMuc2VhcmNoaW5nID0gdHJ1ZTtcbiAgICAgIHRoaXMuc2VhcmNoVGVybSA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgdGhpcy5zZWFyY2goKTtcbiAgICB9LCA0MDApO1xuICAgIHRoaXMubWFuYWdlZEZvY3VzID0gdHJ1ZTtcbiAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgIHRoaXMubG9hZGluZ1RleHQgPSBcIlwiO1xuICAgIHRoaXMuc2VhcmNoaW5nID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZmlsZXMgPSBbXTtcbiAgICB0aGlzLm1vcmVSZXN1bHRzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2VhcmNoVGVybSA9IFwiXCI7XG4gICAgdGhpcy5maWx0ZXIgPSBcImNzdlwiO1xuICAgIHRoaXMuc2VsZWN0ZWQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5lcnJvciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmkxOG4gPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5pMThuID0gdWlTdG9yZVN0YXRlLmkxOG4uY2xvdWQ7XG4gICAgY29uc3QgY3VycmVudCA9IGFkZEl0ZW1TdGF0ZS5jbG91ZFByb3ZpZGVyO1xuICAgIHRoaXMubG9hZGluZ1RleHQgPSB0aGlzLmkxOG5bY3VycmVudF07XG4gICAgdGhpcy5wcm92aWRlciA9IGdldFByb3ZpZGVyKGN1cnJlbnQpO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgdmFyIF9hO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnByb3ZpZGVyLmNvbm5lY3QoKTtcbiAgICAgIGF3YWl0IHRoaXMuc2VhcmNoKCk7XG4gICAgICBhd2FpdCB0aW1lb3V0KDIwMCk7XG4gICAgICAoX2EgPSB0aGlzLm1haW5JbnB1dFJlZikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgICBpZiAodWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiICYmICFhZGRJdGVtU3RhdGUuZXhpc3RpbmdJdGVtKSB7XG4gICAgICAgIC8vIFNvbWV0aW1lcyB3aGVuIHdlIGdvIGJhY2ssIGFuIGl0ZW0gaGFzIGFscmVhZHkgYmVlbiBjcmVhdGVkIHNvIHdlIG5lZWQgdG8gY2xlYW4gaXQgdXBcbiAgICAgICAgLy8gRm9yIG5vdywgaXQgb25seSBoYXBwZW5zIGluIE1WXG4gICAgICAgIC8vIE5vIG5lZWQgdG8gYXdhaXQgdGhpcywgY2FuIGJlIGRvbmUgaW4gdGhlIGJhY2tncm91bmRcbiAgICAgICAgdGhpcy5yZW1vdmVFeGlzdGluZ0ZpbGUoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLnBhcnNlRXJyb3IoZXJyb3IpO1xuICAgIH1cbiAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgfVxuICBhc3luYyBuYXZpZ2F0ZVRvTmV4dFBhZ2UoKSB7XG4gICAgaWYgKHRoaXMuc2VsZWN0ZWQpIHtcbiAgICAgIGNvbnN0IHsgdGl0bGUsIGZpbGVOYW1lLCBleHRlbnNpb24gfSA9IHNhbml0aXplRmlsZU5hbWUodGhpcy5zZWxlY3RlZC5uYW1lKTtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5kYXRhVXJsID0gdGhpcy5zZWxlY3RlZC5kb3dubG9hZFVybDtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5maWxlTmFtZSA9IGZpbGVOYW1lO1xuICAgICAgYWRkSXRlbVN0YXRlLmV4dGVuc2lvbiA9IGV4dGVuc2lvbjtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwiZmlsZVwiO1xuICAgICAgYWRkSXRlbVN0YXRlLmNsb3VkUHJvdmlkZXJSZXNvdXJjZSA9IHtcbiAgICAgICAgY2xvdWRQcm92aWRlcjogZ2V0UmVzb3VyY2VJZGVudGlmaWVyKGFkZEl0ZW1TdGF0ZS5jbG91ZFByb3ZpZGVyKSxcbiAgICAgICAgaWQ6IHRoaXMuc2VsZWN0ZWQuaWQsXG4gICAgICAgIG1pbWVUeXBlOiB0aGlzLnNlbGVjdGVkLm1pbWVUeXBlLFxuICAgICAgICBjbG91ZERyaXZlRmlsZU5hbWU6IHRoaXMuc2VsZWN0ZWQubmFtZSxcbiAgICAgICAgY2xvdWRGaWxlVHlwZTogdGhpcy5maWx0ZXJcbiAgICAgIH07XG4gICAgICAvLyBJbiBjYXNlIHRoZSB1c2VyIGdvZXMgYmFjayB0byB0aGUgZmlsZSBzZWxlY3QgcGFnZVxuICAgICAgLy8gIGFuZCBzZWxlY3QgYSBkaWZmZXJlbnQgZmlsZVxuICAgICAgYWRkSXRlbVN0YXRlLnNlbGVjdGVkRmllbGRzID0gdW5kZWZpbmVkO1xuICAgICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSA9IHRpdGxlO1xuICAgICAgY29uc3QgcG9zc2libGVJdGVtVHlwZXMgPSBmaW5kUG9zc2libGVJdGVtVHlwZXNCeUV4dGVuc2lvbihleHRlbnNpb24pO1xuICAgICAgaWYgKHRoaXMuc2VsZWN0ZWQubWltZVR5cGUgPT09IFwiZ29vZ2xlc2hlZXRzXCIpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5yZW1vdmVFeGlzdGluZ0ZpbGUoKTtcbiAgICAgICAgYWRkSXRlbVN0YXRlLnR5cGUgPSBcIk1pY3Jvc29mdCBFeGNlbFwiO1xuICAgICAgICBhZGRJdGVtU3RhdGUuZXh0ZW5zaW9uID0gXCJ4bHNcIjtcbiAgICAgICAgY29uc3QgbmV4dFN0ZXAgPSBjb25maWdTdGF0ZS5hbGxvd1B1Ymxpc2ggPT09IGZhbHNlID8gXCJpdGVtUHJvcGVydGllc1wiIDogXCJwdWJsaXNoU2VsZWN0XCI7XG4gICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChuZXh0U3RlcCk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChwb3NzaWJsZUl0ZW1UeXBlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5yZW1vdmVFeGlzdGluZ0ZpbGUoKTtcbiAgICAgICAgYWRkSXRlbVN0YXRlLnR5cGUgPSBwb3NzaWJsZUl0ZW1UeXBlc1swXS50eXBlO1xuICAgICAgICBjb25zdCBuZXh0SXRlbVN0ZXAgPSBwb3NzaWJsZUl0ZW1UeXBlc1swXS5uZXh0U3RlcDtcbiAgICAgICAgY29uc3QgbmV4dFN0ZXAgPSBjb25maWdTdGF0ZS5hbGxvd1B1Ymxpc2ggPT09IGZhbHNlICYmIG5leHRJdGVtU3RlcCA9PT0gXCJwdWJsaXNoU2VsZWN0XCJcbiAgICAgICAgICA/IFwiaXRlbVByb3BlcnRpZXNcIlxuICAgICAgICAgIDogbmV4dEl0ZW1TdGVwO1xuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQobmV4dFN0ZXApO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoZXh0ZW5zaW9uID09PSBcInppcFwiKSB7XG4gICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcInppcFNlbGVjdFwiKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmVycm9yID0ge1xuICAgICAgICB0aXRsZTogdGhpcy5pMThuLmVycm9yVGl0bGUsXG4gICAgICAgIG1lc3NhZ2U6IHRoaXMuaTE4bi5lcnJvck1lc3NhZ2VcbiAgICAgIH07XG4gICAgfVxuICB9XG4gIGFzeW5jIHJlbW92ZUV4aXN0aW5nRmlsZSgpIHtcbiAgICBjb25zdCBpZCA9IGFkZEl0ZW1TdGF0ZS5pZDtcbiAgICBpZiAoaWQpIHtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5pZCA9IG51bGw7XG4gICAgICBhd2FpdCBkZWxldGVJdGVtKGlkLCB7IHBlcm1hbmVudERlbGV0ZTogdHJ1ZSB9KTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgc2VhcmNoKG5leHQpIHtcbiAgICB0aGlzLm1vcmVSZXN1bHRzID0gZmFsc2U7XG4gICAgdGhpcy5lcnJvciA9IG51bGw7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wcm92aWRlci5zZWFyY2goe1xuICAgICAgc2VhcmNoVGV4dDogdGhpcy5zZWFyY2hUZXJtLFxuICAgICAgZHJvcGRvd25GaWx0ZXI6IHRoaXMuZmlsdGVyLFxuICAgICAgbmV4dFxuICAgIH0pO1xuICAgIGlmIChuZXh0KSB7XG4gICAgICB0aGlzLmZpbGVzID0gWy4uLnRoaXMuZmlsZXMsIC4uLnJlc3VsdC5maWxlc107XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5maWxlcyA9IFsuLi5yZXN1bHQuZmlsZXNdO1xuICAgIH1cbiAgICB0aGlzLm1vcmVSZXN1bHRzID0gcmVzdWx0Lm5leHQ7XG4gICAgdGhpcy5zZWxlY3RlZCA9IG51bGw7XG4gICAgdGhpcy5zZWFyY2hpbmcgPSBmYWxzZTtcbiAgfVxuICBnZXRGaWx0ZXJPcHRpb25zKCkge1xuICAgIGNvbnN0IHByb3ZpZGVyID0gYWRkSXRlbVN0YXRlLmNsb3VkUHJvdmlkZXI7XG4gICAgY29uc3QgZmlsdGVycyA9IFtcImNzdlwiLCBcImV4Y2VsXCIsIFwiemlwXCIsIFwiZ2VvanNvblwiXTtcbiAgICBpZiAocHJvdmlkZXIgPT09IFwiZ29vZ2xlIGRyaXZlXCIpIHtcbiAgICAgIGZpbHRlcnMucHVzaChcImdvb2dsZXNoZWV0c1wiKTtcbiAgICB9XG4gICAgcmV0dXJuIGZpbHRlcnM7XG4gIH1cbiAgcmVuZGVyRmlsZXMoKSB7XG4gICAgY29uc3QgeyBmaWxlcywgc2VsZWN0ZWQsIGkxOG4sIG1vcmVSZXN1bHRzIH0gPSB0aGlzO1xuICAgIGlmICghKGZpbGVzID09PSBudWxsIHx8IGZpbGVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWxlcy5sZW5ndGgpKSB7XG4gICAgICByZXR1cm4gaChcImRpdlwiLCB7IGNsYXNzOiBcIm5vLXJlc3VsdHNcIiB9LCBpMThuLm5vUmVzdWx0cyk7XG4gICAgfVxuICAgIHJldHVybiAoaChcImRpdlwiLCBudWxsLCAhdGhpcy5lcnJvciAmJiAoaChcInVsXCIsIHsgY2xhc3M6IFwiZmlsZXNcIiB9LCBmaWxlcy5tYXAoKGZpbGUpID0+IChoKFwibGlcIiwgeyBjbGFzczoge1xuICAgICAgICBmaWxlc19faXRlbTogdHJ1ZSxcbiAgICAgICAgXCJmaWxlc19faXRlbS0tYWN0aXZlXCI6IGZpbGUuaWQgPT09IChzZWxlY3RlZCA9PT0gbnVsbCB8fCBzZWxlY3RlZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0ZWQuaWQpXG4gICAgICB9LCBrZXk6IGZpbGUuaWQgfSwgaChcImxhYmVsXCIsIHsgY2xhc3M6IFwiZmlsZVwiLCBodG1sRm9yOiBgaW5wdXQtJHtmaWxlLmlkfWAgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IGljb246IGNsb3VkRmlsZUljb25zW2ZpbGUubWltZVR5cGVdIHx8IFwiZmlsZS10ZXh0XCIsIHNjYWxlOiBcInNcIiwgY2xhc3M6IFwiZmlsZV9faWNvblwiIH0pLCBoKFwiaW5wdXRcIiwgeyB0eXBlOiBcInJhZGlvXCIsIGlkOiBgaW5wdXQtJHtmaWxlLmlkfWAsIG5hbWU6IFwiZmlsZVwiLCB2YWx1ZTogZmlsZS5pZCwgY2hlY2tlZDogKHNlbGVjdGVkID09PSBudWxsIHx8IHNlbGVjdGVkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZC5pZCkgPT09IGZpbGUuaWQsIG9uQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBmaWxlO1xuICAgICAgICB0aGlzLmVycm9yID0gbnVsbDtcbiAgICAgIH0sIGNsYXNzOiBcInNjcmVlbi1yZWFkZXJzLW9ubHlcIiB9KSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJmaWxlX190aXRsZVwiIH0sIGZpbGUubmFtZSksIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwiZmlsZV9fdHlwZVwiLCBcImFyaWEtaGlkZGVuXCI6IFwidHJ1ZVwiIH0sIGNsb3VkRmlsZU5hbWVzW2ZpbGUubWltZVR5cGVdIHx8IGkxOG4uZmlsZSksIGZpbGUuc2l6ZSAmJiAoaChcInNwYW5cIiwgeyBjbGFzczogXCJmaWxlX19zaXplXCIsIFwiYXJpYS1oaWRkZW5cIjogXCJ0cnVlXCIgfSwgZm9ybWF0RmlsZVNpemUoZmlsZS5zaXplKSkpKSkpKSkpLCBtb3JlUmVzdWx0cyAmJiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgXCJpY29uLXN0YXJ0XCI6IFwicGx1c1wiLCBjbGFzczogXCJuZXh0XCIsIGFwcGVhcmFuY2U6IFwidHJhbnNwYXJlbnRcIiwgb25DbGljazogKCkgPT4gdGhpcy5zZWFyY2godHJ1ZSkgfSwgaTE4bi52aWV3TW9yZSkpKSk7XG4gIH1cbiAgcGFyc2VFcnJvcihlKSB7XG4gICAgaWYgKGUgPT09IFwicG9wdXBCbG9ja2VkXCIpIHtcbiAgICAgIHRoaXMuZXJyb3IgPSB0aGlzLmkxOG4uZXJyb3IucG9wdXA7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5lcnJvciA9IHRoaXMuaTE4bi5lcnJvci5nZW5lcmljO1xuICAgIH1cbiAgfVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBsb2FkaW5nLCBsb2FkaW5nVGV4dCwgZmlsZXMsIGkxOG4sIGZpbHRlciwgc2VhcmNoaW5nLCBlcnJvciB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgbG9hZGluZyAmJiAhZmlsZXMubGVuZ3RoID8gKGgoXCJhcmNnaXMtbmV3LWl0ZW0tbG9hZGVyXCIsIHsgYWN0aXZlOiB0cnVlLCB0ZXh0OiBsb2FkaW5nVGV4dCwgdHlwZTogXCJpbmRldGVybWluYXRlXCIgfSkpIDogKGgoXCJkaXZcIiwgeyBjbGFzczogXCJ0YWJsZVwiIH0sIGgoXCJjYWxjaXRlLWlucHV0XCIsIHsgdHlwZTogXCJzZWFyY2hcIiwgaWNvbjogXCJzZWFyY2hcIiwgY2xhc3M6IFwiaW5wdXRcIiwgb25DYWxjaXRlSW5wdXRJbnB1dDogdGhpcy5kZWJvdW5jZWRJbnB1dCwgbGFiZWw6IGkxOG4uc2VhcmNoRmlsZXMsIHJlZjogKGVsZSkgPT4gKHRoaXMubWFpbklucHV0UmVmID0gZWxlKSB9LCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBsYWJlbDogaTE4bi5maWx0ZXJGaWxlVHlwZSwgcmVmOiAoZWwpID0+ICh0aGlzLnNlbGVjdCA9IGVsKSwgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiB0aGlzLnVwZGF0ZUZpbHRlciwgc2xvdDogXCJhY3Rpb25cIiwgY2xhc3M6IFwic2VsZWN0XCIgfSwgdGhpcy5nZXRGaWx0ZXJPcHRpb25zKCkubWFwKCh2YWx1ZSkgPT4ge1xuICAgICAgdmFyIF9hO1xuICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyBzZWxlY3RlZDogZmlsdGVyID09PSB2YWx1ZSwgdmFsdWU6IHZhbHVlLCBsYWJlbDogKF9hID0gaTE4bi5maWxlVHlwZVt2YWx1ZV0pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGNsb3VkRmlsZU5hbWVzW3ZhbHVlXSB9KSk7XG4gICAgfSkpKSwgaChcImZpZWxkc2V0XCIsIHsgY2xhc3M6IHtcbiAgICAgICAgdGFibGVfX2JvZHk6IHRydWUsXG4gICAgICAgIFwidGFibGVfX2JvZHktLWNlbnRlclwiOiBzZWFyY2hpbmcgfHwgIWZpbGVzLmxlbmd0aFxuICAgICAgfSB9LCBoKFwibGVnZW5kXCIsIHsgY2xhc3M6IFwic2NyZWVuLXJlYWRlcnMtb25seVwiIH0sIGkxOG4uc2VsZWN0QUZpbGUpLCB0aGlzLnNlYXJjaGluZyA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwibG9hZGVyXCIgfSwgaChcImFyY2dpcy1uZXctaXRlbS1sb2FkZXJcIiwgeyBhY3RpdmU6IHRydWUsIHRleHQ6IGkxOG4ubG9hZGluZ0ZpbGVzIH0pKSkgOiAodGhpcy5yZW5kZXJGaWxlcygpKSkpKSwgaChcImFyY2dpcy1uZXctaXRlbS1hbGVydFwiLCB7IGhlYWRpbmc6IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci50aXRsZSwgZGVzY3JpcHRpb246IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5tZXNzYWdlLCBhY3RpdmU6ICEhZXJyb3IsIG9uQWxlcnREaXNtaXNzOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuZXJyb3IgPSBudWxsO1xuICAgICAgfSB9KSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNOZXdJdGVtUGFnZXNDbG91ZC5zdHlsZSA9IGFyY2dpc05ld0l0ZW1QYWdlc0Nsb3VkQ3NzO1xuXG5jb25zdCBhcmNnaXNOZXdJdGVtUGFnZXNGaWxlRmllbGRzQ3NzID0gXCIuZmllbGRzLWNvbnRhaW5lcntkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2hlaWdodDoxMDAlfS5maWVsZC10YWJsZXttYXJnaW4tYm90dG9tOjEuNXJlbTtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO21pbi1oZWlnaHQ6MTVyZW19LnNlYXJjaC1jb250YWluZXJ7ZGlzcGxheTpmbGV4O3dpZHRoOjEwMCV9LnNjcmVlbi1yZWFkZXJzLW9ubHl7cG9zaXRpb246YWJzb2x1dGU7d2lkdGg6MXB4O2hlaWdodDoxcHg7cGFkZGluZzowO21hcmdpbjotMXB4O292ZXJmbG93OmhpZGRlbjtjbGlwOnJlY3QoMCwgMCwgMCwgMCk7d2hpdGUtc3BhY2U6bm93cmFwO2JvcmRlci13aWR0aDowfS5maWVsZC1zZWFyY2h7LXdlYmtpdC1tYXJnaW4tZW5kOjhweDttYXJnaW4taW5saW5lLWVuZDo4cHg7d2lkdGg6NzUlfS5maWVsZC1zZWxlY3R7d2lkdGg6MjUlfS5maWVsZHMtc2Nyb2xsLWNvbnRhaW5lcntvdmVyZmxvdy15OmF1dG87ZmxleDoxIDEgYXV0bzt0cmFuc2Zvcm06dHJhbnNsYXRlWigwKX0uaGVhZGVyLXJvd3tkaXNwbGF5OmZsZXg7YWxpZ24tY29udGVudDpmbGV4LXN0YXJ0O2p1c3RpZnktY29udGVudDpjZW50ZXI7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpO2ZvbnQtc2l6ZTowLjg3NXJlbTtncmlkLWdhcDowLjI1cmVtO2dhcDowLjI1cmVtO3BhZGRpbmc6MC4yNXJlbX0uaGVhZGVyLWNlbGx7d2lkdGg6MTAwJX0uaGlkZXtkaXNwbGF5Om5vbmV9LmNoaXAtY29udGFpbmVye21hcmdpbi10b3A6MXJlbTttYXJnaW4tYm90dG9tOjFyZW19LmNoaXB7Zm9udC13ZWlnaHQ6NzAwfS5jbGVhci1zZWxlY3Rpb257Ym9yZGVyLXN0eWxlOm5vbmU7Y3Vyc29yOnBvaW50ZXI7cGFkZGluZzowO2JvcmRlci13aWR0aDowOy13ZWJraXQtYXBwZWFyYW5jZTpub25lOy1tb3otYXBwZWFyYW5jZTpub25lO2FwcGVhcmFuY2U6bm9uZTtmb250LXNpemU6MC43NXJlbTtmb250LXdlaWdodDo1MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTIpO21hcmdpbi1sZWZ0OjAuNzVyZW07bWFyZ2luLXJpZ2h0OjAuNzVyZW07Zm9udC1mYW1pbHk6QXZlbmlyIE5leHQsIEF2ZW5pciwgSGVsdmV0aWNhIE5ldWUsIHNhbnMtc2VyaWY7YmFja2dyb3VuZDp0cmFuc3BhcmVudH0uY2xlYXItc2VsZWN0aW9uOmhvdmVye3RleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmU7Y3Vyc29yOnBvaW50ZXJ9Lm5vdC12aXNpYmxle3Zpc2liaWxpdHk6aGlkZGVuO2hlaWdodDowfS5kZXNjcmlwdGlvbnttYXJnaW4tYm90dG9tOjFyZW19XCI7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1QYWdlc0ZpbGVGaWVsZHMgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1VcGRhdGVQYWdlXCIsIDcpO1xuICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwid29ya2Zsb3dDb21wbGV0ZVwiLCA3KTtcbiAgICAvLyBUZWxlbWV0cnk6IGdhdGhlciBpbmZvIGFib3V0IHdoaWNoIGZpZWxkcyBoYXZlIHJlY2VpdmVkIHVzZXIgaW5wdXRcbiAgICB0aGlzLmZpZWxkc1NlYXJjaGVkID0gZmFsc2U7XG4gICAgdGhpcy5maWVsZHNNb2RpZmllZCA9IHt9O1xuICAgIHRoaXMuYWRkRGlyZWN0VG9NYXAgPSBmYWxzZTtcbiAgICB0aGlzLmhhbmRsZVRpbWV6b25lQ2hhbmdlID0gKGV2ZW50KSA9PiB7XG4gICAgICBhZGRJdGVtU3RhdGUudGltZXpvbmUgPSBldmVudC5kZXRhaWw7XG4gICAgfTtcbiAgICB0aGlzLnVwZGF0ZU1vZGlmaWVkRmllbGRzID0gKGRldGFpbCkgPT4ge1xuICAgICAgY29uc3QgeyBuYW1lLCBrZXksIG1vZGlmaWVkIH0gPSBkZXRhaWw7XG4gICAgICAvLyBJZiBubyBleGlzdGluZyBlbnRyeSwgY3JlYXRlIG9uZSB3aXRoIHRoZSBjb3JyZXNwb25kaW5nIHByb3BlcnR5J3MgbW9kaWZpZWQgZmxhZyBzZXQsIHVwZGF0ZSBvdGhlcndpc2VcbiAgICAgIGlmICghdGhpcy5maWVsZHNNb2RpZmllZFtuYW1lXSkge1xuICAgICAgICB0aGlzLmZpZWxkc01vZGlmaWVkW25hbWVdID0ge1xuICAgICAgICAgIHR5cGU6IGtleSA9PT0gXCJ0eXBlXCIgJiYgbW9kaWZpZWQgPyAxIDogMCxcbiAgICAgICAgICBhbGlhczoga2V5ID09PSBcImFsaWFzXCIgJiYgbW9kaWZpZWQgPyAxIDogMFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuZmllbGRzTW9kaWZpZWRbbmFtZV1ba2V5XSA9IG1vZGlmaWVkID8gMSA6IDA7XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZUZpZWxkVHlwZUZpbHRlciA9IChldikgPT4ge1xuICAgICAgdGhpcy5zZWxlY3RlZEZpZWxkVHlwZUZpbHRlciA9IGV2LnRhcmdldC5zZWxlY3RlZE9wdGlvbi52YWx1ZTtcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlU2VhcmNoQ2hhbmdlID0gKGV2KSA9PiB7XG4gICAgICAvLyBUZWxlbWV0cnk6IEZsYWcgaWYgdGhlIHVzZXIgYXR0ZW1wdGVkIHRvIHNlYXJjaFxuICAgICAgdGhpcy5maWVsZHNTZWFyY2hlZCA9IHRydWU7XG4gICAgICB0aGlzLnNlYXJjaFRlcm0gPSBldi50YXJnZXQudmFsdWU7XG4gICAgfTtcbiAgICB0aGlzLmdldEZpbHRlcmVkRmllbGRzID0gKCkgPT4ge1xuICAgICAgdGhpcy5maWx0ZXJlZEZpZWxkcyA9IHRoaXMuZmllbGRzLnJlZHVjZSgoZmlsdGVyZWRGaWVsZHMsIGZpZWxkKSA9PiB7XG4gICAgICAgIGlmICgoIXRoaXMuc2VhcmNoVGVybSB8fFxuICAgICAgICAgIGZpZWxkLm5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKHRoaXMuc2VhcmNoVGVybS50b0xvd2VyQ2FzZSgpKSA+IC0xIHx8XG4gICAgICAgICAgZmllbGQuYWxpYXMudG9Mb3dlckNhc2UoKS5pbmRleE9mKHRoaXMuc2VhcmNoVGVybS50b0xvd2VyQ2FzZSgpKSA+IC0xKSAmJlxuICAgICAgICAgICh0aGlzLnNlbGVjdGVkRmllbGRUeXBlRmlsdGVyID09PSBcImRlZmF1bHRcIiB8fFxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEZpZWxkVHlwZUZpbHRlciA9PT0gZmllbGQudHlwZSkpIHtcbiAgICAgICAgICBmaWx0ZXJlZEZpZWxkc1tmaWVsZC5uYW1lXSA9IGZpZWxkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaWx0ZXJlZEZpZWxkcztcbiAgICAgIH0sIHt9KTtcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlU2VsZWN0QWxsVG9nZ2xlID0gKCkgPT4ge1xuICAgICAgdGhpcy5maWVsZHMgPSB0aGlzLmZpZWxkcy5tYXAoKGZpZWxkKSA9PiB7XG4gICAgICAgIGlmICghIXRoaXMuZmlsdGVyZWRGaWVsZHNbZmllbGQubmFtZV0pIHtcbiAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBmaWVsZCksIHsgc2VsZWN0ZWQ6ICF0aGlzLmFsbFNlbGVjdGVkIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdGhpcy5jbGVhclNlbGVjdGlvbiA9ICgpID0+IHtcbiAgICAgIHRoaXMuZmllbGRzID0gdGhpcy5maWVsZHMubWFwKChmaWVsZCkgPT4gKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZmllbGQpLCB7IHNlbGVjdGVkOiBmYWxzZSB9KSkpO1xuICAgIH07XG4gICAgLy8gVGVsZW1ldHJ5OiBMb2cgY2hhbmdlcyB1c2VyIG1hZGUgdG8gZmllbGRzXG4gICAgdGhpcy5sb2dDU1ZGaWVsZENoYW5nZXMgPSAoZmllbGRzKSA9PiB7XG4gICAgICAvLyBUT0RPOiBSZWZhY3RvciBmaWVsZHMgY291bnQgdG8gdXNlIG1hcHJlZHVjZVxuICAgICAgY29uc3QgdGVsZW1ldHJ5ID0gY29uZmlnU3RhdGUudGVsZW1ldHJ5O1xuICAgICAgY29uc3QgbW9kaWZpZWRGaWVsZHNDb3VudCA9IHsgdHlwZTogMCwgYWxpYXM6IDAgfTtcbiAgICAgIGNvbnN0IHRvdGFsRmllbGRzQ291bnQgPSB0aGlzLmZpZWxkcy5sZW5ndGg7XG4gICAgICBjb25zdCBzZWxlY3RlZEZpZWxkc0NvdW50ID0gT2JqZWN0LmtleXMoZmllbGRzKS5sZW5ndGg7XG4gICAgICBmb3IgKGNvbnN0IGZpZWxkIGluIHRoaXMuZmllbGRzTW9kaWZpZWQpIHtcbiAgICAgICAgbW9kaWZpZWRGaWVsZHNDb3VudC50eXBlICs9IHRoaXMuZmllbGRzTW9kaWZpZWRbZmllbGRdLnR5cGU7XG4gICAgICAgIG1vZGlmaWVkRmllbGRzQ291bnQuYWxpYXMgKz0gdGhpcy5maWVsZHNNb2RpZmllZFtmaWVsZF0uYWxpYXM7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICBldmVudFR5cGU6IFwib3RoZXJcIixcbiAgICAgICAgcGFnZU5hbWU6IFwibXkgY29udGVudFwiLFxuICAgICAgICBjYXRlZ29yeTogXCJuZXcgaXRlbSBjc3YgdGltZSB6b25lIGFuZCBmaWVsZHNcIixcbiAgICAgICAgZGV0YWlsczogdGhpcy5maWVsZHNTZWFyY2hlZCA/IFwiZmllbGRzIHNlYXJjaGVkXCIgOiBcIm5vIGZpZWxkcyBzZWFyY2hlZFwiLFxuICAgICAgICBsYWJlbDogdGhpcy5pbml0aWFsVGltZXpvbmUgPT09IGFkZEl0ZW1TdGF0ZS50aW1lem9uZSA/IFwiZGVmYXVsdCB0aW1lem9uZVwiIDogXCJ0aW1lem9uZSBjaGFuZ2VkXCIsXG4gICAgICAgIGNvdW50OiB0b3RhbEZpZWxkc0NvdW50LFxuICAgICAgICBudW1iZXI6IHRvdGFsRmllbGRzQ291bnQgLSBzZWxlY3RlZEZpZWxkc0NvdW50LFxuICAgICAgICBzaXplOiBtb2RpZmllZEZpZWxkc0NvdW50LmFsaWFzLFxuICAgICAgICBwb3NpdGlvbjogbW9kaWZpZWRGaWVsZHNDb3VudC50eXBlXG4gICAgICB9O1xuICAgICAgdGVsZW1ldHJ5ID09PSBudWxsIHx8IHRlbGVtZXRyeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVsZW1ldHJ5LmxvZ0V2ZW50KHBheWxvYWQpO1xuICAgIH07XG4gICAgdGhpcy5zZWxlY3RlZEZpZWxkVHlwZUZpbHRlciA9IFwiZGVmYXVsdFwiO1xuICAgIHRoaXMuZmllbGRzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZmlsdGVyZWRGaWVsZHMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zZWFyY2hUZXJtID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmFsbFNlbGVjdGVkID0gdW5kZWZpbmVkO1xuICB9XG4gIGhhbmRsZU5leHQoKSB7XG4gICAgY29uc3QgZmllbGRzID0gdGhpcy5maWVsZHMucmVkdWNlKChmaWVsZE1hcCwgZmllbGQpID0+IHtcbiAgICAgIHZhciBfYSwgX2I7XG4gICAgICBpZiAoZmllbGQuc2VsZWN0ZWQpIHtcbiAgICAgICAgZGVsZXRlIGZpZWxkLnNlbGVjdGVkO1xuICAgICAgICAvLyAjNDMzNiAtIGlmIHVzZXIgY2hhbmdlZCB0byBzdHJpbmcsIGFkZCBhIGxhcmdlciBsZW5ndGggdG8gYXZvaWQgcHVibGlzaCBlcnJvcnNcbiAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09IFwiZXNyaUZpZWxkVHlwZVN0cmluZ1wiICYmICgoX2IgPSAoX2EgPSB0aGlzLmZpZWxkc01vZGlmaWVkKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbZmllbGQubmFtZV0pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50eXBlKSkge1xuICAgICAgICAgIGZpZWxkLmxlbmd0aCA9IDQwMDA7XG4gICAgICAgIH1cbiAgICAgICAgZmllbGRNYXBbZmllbGQubmFtZV0gPSBmaWVsZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmaWVsZE1hcDtcbiAgICB9LCB7fSk7XG4gICAgYWRkSXRlbVN0YXRlLnNlbGVjdGVkRmllbGRzID0gZmllbGRzO1xuICAgIHRoaXMubG9nQ1NWRmllbGRDaGFuZ2VzKGZpZWxkcyk7XG4gICAgaWYgKHRoaXMuaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpKSB7XG4gICAgICAvLyBUT0RPOiBtZXJnZSB0aGlzIHdpdGggdGhlIHNhbWUgdGhpbmcgaW4gYGNzdi1sb2NhdGlvbi1maWVsZHNgXG4gICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUuZW1pdCh7XG4gICAgICAgIHR5cGU6IGFkZEl0ZW1TdGF0ZS50eXBlLFxuICAgICAgICB1cmw6IGVuY29kZVVSSShhZGRJdGVtU3RhdGUudXJsKSxcbiAgICAgICAgY3VzdG9tUGFyYW1ldGVyczogYWRkSXRlbVN0YXRlLmN1c3RvbVBhcmFtZXRlcnMsXG4gICAgICAgIHJlc3VsdHM6IHtcbiAgICAgICAgICBhbmFseXplUmVzdWx0czogYWRkSXRlbVN0YXRlLmFuYWx5emVSZXN1bHRzLFxuICAgICAgICAgIGZpZWxkczogYWRkSXRlbVN0YXRlLnNlbGVjdGVkRmllbGRzXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIGlmIChhZGRJdGVtU3RhdGUudHlwZSA9PT0gXCJHZW9Kc29uXCIpIHtcbiAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcIml0ZW1Qcm9wZXJ0aWVzXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcImNzdkxvY2F0aW9uRmllbGRzXCIpO1xuICAgIH1cbiAgfVxuICBmaWVsZHNDaGFuZ2VkKCkge1xuICAgIHRoaXMuZ2V0RmlsdGVyZWRGaWVsZHMoKTtcbiAgfVxuICBpc0FkZFRvTWFwVGVybWluYWxQYWdlKCkge1xuICAgIGNvbnN0IHsgbmV3SXRlbU1vZGUsIHR5cGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICByZXR1cm4gdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiICYmIG5ld0l0ZW1Nb2RlID09PSBcInVybFwiICYmIHR5cGUgIT09IFwiQ1NWXCI7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgY29uc3QgaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuO1xuICAgIHRoaXMuaTE4biA9IGkxOG4uY3N2RmllbGRzO1xuICAgIGlmICh0aGlzLmlzQWRkVG9NYXBUZXJtaW5hbFBhZ2UoKSkge1xuICAgICAgdWlTdG9yZVN0YXRlLm5leHRUZXh0ID0gXCJhZGRUb01hcFwiO1xuICAgIH1cbiAgICBjb25zdCB7IGJhY2t1cExheWVyRmllbGRzIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgY29uc3QgZmllbGRzID0gZ2V0QW5hbHl6ZWRMYXllckluZm8oKS5maWVsZHM7XG4gICAgY29uc3QgbG9va3VwTWFwID0ge307XG4gICAgZmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiAobG9va3VwTWFwW2ZpZWxkLm5hbWVdID0gdHJ1ZSkpO1xuICAgIHRoaXMuZmllbGRzID0gYmFja3VwTGF5ZXJGaWVsZHMubWFwKChmaWVsZCkgPT4ge1xuICAgICAgdmFyIF9hLCBfYjtcbiAgICAgIHJldHVybiAoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCAoKF9iID0gKF9hID0gYWRkSXRlbVN0YXRlLnNlbGVjdGVkRmllbGRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbZmllbGQubmFtZV0pICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IGZpZWxkKSksIHsgc2VsZWN0ZWQ6ICEhbG9va3VwTWFwW2ZpZWxkLm5hbWVdIH0pKTtcbiAgICB9KTtcbiAgICB0aGlzLmdldEZpbHRlcmVkRmllbGRzKCk7XG4gICAgdGhpcy5pbml0aWFsVGltZXpvbmUgPSBhZGRJdGVtU3RhdGUudGltZXpvbmU7XG4gICAgdGhpcy5hZGREaXJlY3RUb01hcCA9IHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIiAmJiAhYWRkSXRlbVN0YXRlLmVuYWJsZVB1Ymxpc2hpbmc7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICB2YXIgX2E7XG4gICAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAvaXNzdWVzLzQzMzQxXG4gICAgaWYgKHRoaXMuc2Nyb2xsQ29udGFpbmVyICYmICgoX2EgPSBuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IudmVuZG9yKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5jbHVkZXMoXCJBcHBsZVwiKSkpIHtcbiAgICAgIHRoaXMuc2Nyb2xsQ29udGFpbmVyLnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcbiAgICAgIGF3YWl0IHRpbWVvdXQoMTAwKTtcbiAgICAgIHRoaXMuc2Nyb2xsQ29udGFpbmVyLnN0eWxlLm92ZXJmbG93ID0gXCJhdXRvXCI7XG4gICAgfVxuICB9XG4gIHVwZGF0ZUZpZWxkKGV2ZW50KSB7XG4gICAgY29uc3QgeyBuYW1lLCBrZXksIHZhbHVlIH0gPSBldmVudC5kZXRhaWw7XG4gICAgdGhpcy5maWVsZHMgPSB0aGlzLmZpZWxkcy5tYXAoKGZpZWxkKSA9PiB7XG4gICAgICBpZiAoZmllbGQubmFtZSA9PT0gbmFtZSkge1xuICAgICAgICBmaWVsZFtrZXldID0gdmFsdWU7XG4gICAgICAgIC8vIFRlbGVtZXRyeTogVHJhY2sgaWYgdGhlIGluY29taW5nIGtleSBpcyBkaWZmZXJlbnQgdGhhbiB0aGUgZGVmYXVsdCB2YWx1ZVxuICAgICAgICB0aGlzLnVwZGF0ZU1vZGlmaWVkRmllbGRzKGV2ZW50LmRldGFpbCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmllbGQ7XG4gICAgfSk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgaTE4biwgYWRkRGlyZWN0VG9NYXAgfSA9IHRoaXM7XG4gICAgdGhpcy5hbGxTZWxlY3RlZCA9IE9iamVjdC5rZXlzKHRoaXMuZmlsdGVyZWRGaWVsZHMpLmV2ZXJ5KChuYW1lKSA9PiB0aGlzLmZpbHRlcmVkRmllbGRzW25hbWVdLnNlbGVjdGVkKTtcbiAgICBjb25zdCBjYW5IaWRlRmllbGRzID0gIWFkZERpcmVjdFRvTWFwICYmIHVpU3RvcmVTdGF0ZS53b3JrZmxvdyAhPT0gXCJhcHBlbmRcIjtcbiAgICBjb25zdCBudW1iZXJTZWxlY3RlZCA9IHRoaXMuZmllbGRzLmZpbHRlcigoZmllbGQpID0+IGZpZWxkLnNlbGVjdGVkKS5sZW5ndGg7XG4gICAgY29uc3QgaGFzRGF0ZSA9IHRoaXMuZmllbGRzLnNvbWUoKGZpZWxkKSA9PiBmaWVsZC50eXBlID09PSBcImVzcmlGaWVsZFR5cGVEYXRlXCIpO1xuICAgIGNvbnN0IHRpbWV6b25lID0gYWRkSXRlbVN0YXRlLnRpbWV6b25lO1xuICAgIGNvbnN0IHJvd0hlYWRlcnMgPSBbaTE4bi5maWVsZE5hbWUsIGkxOG4uZGlzcGxheU5hbWUsIGkxOG4udHlwZV07XG4gICAgcmV0dXJuIChoKFwic2VjdGlvblwiLCB7IGNsYXNzOiBcImZpZWxkcy1jb250YWluZXJcIiB9LCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWRlc2NyaXB0aW9uXCIsIHsgY2xhc3M6IFwiZGVzY3JpcHRpb25cIiwgaGVhZGVyOiBpMThuLmZpZWxkVGl0bGUsIGNvbnRlbnQ6IGkxOG5bIWFkZEl0ZW1TdGF0ZS5lbmFibGVQdWJsaXNoaW5nID8gXCJmaWVsZE5vSG9zdGVkRGVzY3JpcHRpb25cIiA6IFwiZmllbGREZXNjcmlwdGlvblwiXSB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNlYXJjaC1jb250YWluZXJcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcImZpZWxkLXNlYXJjaFwiIH0sIGgoXCJjYWxjaXRlLWlucHV0XCIsIHsgb25DYWxjaXRlSW5wdXRJbnB1dDogdGhpcy5oYW5kbGVTZWFyY2hDaGFuZ2UsIHR5cGU6IFwic2VhcmNoXCIsIHBsYWNlaG9sZGVyOiBpMThuLnNlYXJjaEZpZWxkcyB9KSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJzY3JlZW4tcmVhZGVycy1vbmx5XCIgfSwgaTE4bi5zZWFyY2hGaWVsZHMpKSwgaChcImNhbGNpdGUtc2VsZWN0XCIsIHsgbGFiZWw6IGkxOG4uZmllbGRUeXBlLCBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6IHRoaXMuaGFuZGxlRmllbGRUeXBlRmlsdGVyLCBjbGFzczogXCJmaWVsZC1zZWxlY3RcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHNlbGVjdGVkOiB0aGlzLnNlbGVjdGVkRmllbGRUeXBlRmlsdGVyID09PSBcImRlZmF1bHRcIiwgdmFsdWU6IFwiZGVmYXVsdFwiIH0sIGkxOG4uYWxsVHlwZXMpLCBPYmplY3Qua2V5cyhpMThuLmZpZWxkVHlwZXMpLm1hcCgodHlwZSkgPT4ge1xuICAgICAgY29uc3QgZmllbGRUeXBlID0gaTE4bi5maWVsZFR5cGVzW3R5cGVdO1xuICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyBzZWxlY3RlZDogdGhpcy5zZWxlY3RlZEZpZWxkVHlwZUZpbHRlciA9PT0gdHlwZSwgdmFsdWU6IHR5cGUgfSwgZmllbGRUeXBlKSk7XG4gICAgfSkpKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImZpZWxkLXRhYmxlXCIsIHJvbGU6IFwidGFibGVcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IGBjaGlwLWNvbnRhaW5lciAke251bWJlclNlbGVjdGVkID09PSAwIHx8IGNhbkhpZGVGaWVsZHMgPyBcIlwiIDogXCJub3QtdmlzaWJsZVwifWAgfSwgaChcImNhbGNpdGUtY2hpcFwiLCB7IGNsYXNzOiBcImNoaXBcIiwgdmFsdWU6IG51bWJlclNlbGVjdGVkIH0sIG51bWJlclNlbGVjdGVkLCBcIiBcIiwgaTE4bi5zZWxlY3RlZCksIGgoXCJidXR0b25cIiwgeyBvbkNsaWNrOiB0aGlzLmNsZWFyU2VsZWN0aW9uLCBjbGFzczogXCJjbGVhci1zZWxlY3Rpb25cIiB9LCBpMThuLmNsZWFyU2VsZWN0aW9uKSksIGgoXCJkaXZcIiwgeyBjbGFzczogYGhlYWRlci1yb3cgJHtPYmplY3Qua2V5cyh0aGlzLmZpbHRlcmVkRmllbGRzKS5sZW5ndGggPT09IDAgPyBcImhpZGVcIiA6IFwiXCJ9YCwgcm9sZTogXCJyb3dcIiB9LCByb3dIZWFkZXJzLm1hcCgoY29sdW1uLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKGluZGV4ID09PSAwICYmIGNhbkhpZGVGaWVsZHMpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGxheW91dDogXCJpbmxpbmVcIiwgY2xhc3M6IFwiaGVhZGVyLWNlbGxcIiwgcm9sZTogXCJjb2x1bW5oZWFkZXJcIiwgXCJhcmlhLXNvcnRcIjogXCJub25lXCIgfSwgaChcImNhbGNpdGUtY2hlY2tib3hcIiwgeyBjaGVja2VkOiB0aGlzLmFsbFNlbGVjdGVkLCBvbkNhbGNpdGVDaGVja2JveENoYW5nZTogdGhpcy5oYW5kbGVTZWxlY3RBbGxUb2dnbGUgfSksIGNvbHVtbikpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIChoKFwic3BhblwiLCB7IGNsYXNzOiBcImhlYWRlci1jZWxsXCIsIHJvbGU6IFwiY29sdW1uaGVhZGVyXCIsIFwiYXJpYS1zb3J0XCI6IFwibm9uZVwiIH0sIGNvbHVtbikpO1xuICAgIH0pKSwgT2JqZWN0LmtleXModGhpcy5maWx0ZXJlZEZpZWxkcykubGVuZ3RoID4gMCA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZmllbGRzLXNjcm9sbC1jb250YWluZXJcIiwgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgdGhpcy5zY3JvbGxDb250YWluZXIgPSBlbDtcbiAgICAgIH0gfSwgT2JqZWN0LmtleXModGhpcy5maWx0ZXJlZEZpZWxkcykubWFwKChrZXkpID0+IHtcbiAgICAgIHZhciBfYSwgX2I7XG4gICAgICBjb25zdCBmaWVsZCA9IHRoaXMuZmlsdGVyZWRGaWVsZHNba2V5XTtcbiAgICAgIHJldHVybiAoaChcImFyY2dpcy1uZXctaXRlbS1jc3YtZmllbGRcIiwgeyBkZXRlY3RlZFR5cGU6IChfYiA9IChfYSA9IGFkZEl0ZW1TdGF0ZSA9PT0gbnVsbCB8fCBhZGRJdGVtU3RhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFkZEl0ZW1TdGF0ZS5iYWNrdXBMYXllckZpZWxkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbmQoKGJhY2t1cEZpZWxkKSA9PiBiYWNrdXBGaWVsZC5uYW1lID09PSBmaWVsZC5uYW1lKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnR5cGUsIG9uRmllbGRDaGFuZ2U6IHRoaXMudXBkYXRlRmllbGQuYmluZCh0aGlzKSwgZmllbGQ6IGZpZWxkLCBmaWVsZFR5cGVzOiBpMThuLmZpZWxkVHlwZXMsIGRlZmF1bHRDaGVja2VkOiBmaWVsZC5zZWxlY3RlZCwgY2FuSGlkZUZpZWxkczogY2FuSGlkZUZpZWxkcywgZGlzcGxheU5hbWVMYWJlbDogaTE4bi5kaXNwbGF5TmFtZUxhYmVsLnJlcGxhY2UoXCIke25hbWV9XCIsIGZpZWxkLm5hbWUpLCB0eXBlTGFiZWw6IGkxOG4udHlwZUxhYmVsLnJlcGxhY2UoXCIke25hbWV9XCIsIGZpZWxkLm5hbWUpIH0pKTtcbiAgICB9KSkpIDogKGgoXCJjYWxjaXRlLWlucHV0LW1lc3NhZ2VcIiwgeyBpY29uOiB0cnVlLCBzdGF0dXM6IFwidmFsaWRcIiB9LCBpMThuLm5vRmllbGRzKSkpLCBoYXNEYXRlICYmICFhZGREaXJlY3RUb01hcCAmJiAoaChcImFyY2dpcy1uZXctaXRlbS10aW1lem9uZS1kcm9wZG93blwiLCB7IG9uVGltZXpvbmVDaGFuZ2U6IHRoaXMuaGFuZGxlVGltZXpvbmVDaGFuZ2UsIGRlZmF1bHRUaW1lem9uZTogdGltZXpvbmUgfSkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgIFwiZmllbGRzXCI6IFtcImZpZWxkc0NoYW5nZWRcIl0sXG4gICAgXCJzZWxlY3RlZEZpZWxkVHlwZUZpbHRlclwiOiBbXCJmaWVsZHNDaGFuZ2VkXCJdLFxuICAgIFwic2VhcmNoVGVybVwiOiBbXCJmaWVsZHNDaGFuZ2VkXCJdXG4gIH07IH1cbn07XG5BcmNnaXNOZXdJdGVtUGFnZXNGaWxlRmllbGRzLnN0eWxlID0gYXJjZ2lzTmV3SXRlbVBhZ2VzRmlsZUZpZWxkc0NzcztcblxuY29uc3QgYXJjZ2lzTmV3SXRlbVBhZ2VzSXRlbVByb3BlcnRpZXNDc3MgPSBcIi5sYXllci1kZXNjcmlwdGlvbi5zYy1hcmNnaXMtbmV3LWl0ZW0tcGFnZXMtaXRlbS1wcm9wZXJ0aWVze2Rpc3BsYXk6YmxvY2s7bWFyZ2luLWJvdHRvbTowLjc1cmVtfS5sb2NhdG9yX19oZWFkaW5nLnNjLWFyY2dpcy1uZXctaXRlbS1wYWdlcy1pdGVtLXByb3BlcnRpZXN7Zm9udC13ZWlnaHQ6NTAwO2ZvbnQtc2l6ZTowLjg3NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMSk7bGluZS1oZWlnaHQ6MThweDttYXJnaW4tYm90dG9tOjJweH0ubG9jYXRvcl9fZGVzY3JpcHRpb24uc2MtYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWl0ZW0tcHJvcGVydGllc3tmb250LXNpemU6MC44NzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpO21hcmdpbjowO21hcmdpbi1ib3R0b206MXJlbTtwYWRkaW5nOjB9Lm1lZGl1bS5zYy1hcmNnaXMtbmV3LWl0ZW0tcGFnZXMtaXRlbS1wcm9wZXJ0aWVzey0tYXJjZ2lzLWxhYmVsLWZvbnQtd2VpZ2h0OjUwMH0uaW5mby1jb250YWluZXIuc2MtYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWl0ZW0tcHJvcGVydGllc3ttYXJnaW4tYm90dG9tOjEuNXJlbX1cIjtcblxudmFyIF9fYXN5bmNWYWx1ZXMgPSAodW5kZWZpbmVkICYmIHVuZGVmaW5lZC5fX2FzeW5jVmFsdWVzKSB8fCBmdW5jdGlvbiAobykge1xuICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XG4gIHZhciBtID0gb1tTeW1ib2wuYXN5bmNJdGVyYXRvcl0sIGk7XG4gIHJldHVybiBtID8gbS5jYWxsKG8pIDogKG8gPSB0eXBlb2YgX192YWx1ZXMgPT09IFwiZnVuY3Rpb25cIiA/IF9fdmFsdWVzKG8pIDogb1tTeW1ib2wuaXRlcmF0b3JdKCksIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiKSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpKTtcbiAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxuICBmdW5jdGlvbiBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCBkLCB2KSB7IFByb21pc2UucmVzb2x2ZSh2KS50aGVuKGZ1bmN0aW9uICh2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxufTtcbmNvbnN0IE1BWF9USVRMRV9MRU5HVEggPSAyNTA7XG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNJdGVtUHJvcGVydGllcyA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy53b3JrZmxvd0NhbmNlbCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwid29ya2Zsb3dDYW5jZWxcIiwgNyk7XG4gICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJ3b3JrZmxvd0NvbXBsZXRlXCIsIDcpO1xuICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWRcIiwgNyk7XG4gICAgdGhpcy53b3JrZmxvd0NhbmNlbGxlZCA9IGZhbHNlO1xuICAgIHRoaXMuaGFuZGxlUmVxdWVzdCA9IGFzeW5jICgpID0+IHtcbiAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgLy8gRG9uJ3Qgc2VuZCByZXF1ZXN0IGlmIGFuIGVycm9yIGlzIHJlcG9ydGVkXG4gICAgICBpZiAoIShhd2FpdCB0aGlzLnZhbGlkYXRlKCkpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgbmV3SXRlbU1vZGUsIGV4aXN0aW5nSXRlbSwgdHlwZSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgY29uc3QgeyBjYXRlZ29yaWVzIH0gPSBpdGVtUHJvcGVydGllc1N0YXRlO1xuICAgICAgY29uc3QgeyBwb3J0YWwgfSA9IGNvbmZpZ1N0YXRlO1xuICAgICAgbGV0IGFkZFJlc3BvbnNlO1xuICAgICAgbGV0IHB1Ymxpc2hSZXNwb25zZTtcbiAgICAgIGxldCBlbXB0eUxheWVyQ3JlYXRlZCA9IG5ld0l0ZW1Nb2RlID09PSBcImZlYXR1cmVMYXllclwiO1xuICAgICAgY29uc3QgdGl0bGUgPSBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlO1xuICAgICAgaWYgKCh0aXRsZSA9PT0gbnVsbCB8fCB0aXRsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGl0bGUubGVuZ3RoKSA+IE1BWF9USVRMRV9MRU5HVEgpIHtcbiAgICAgICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSA9IHRpdGxlLnN1YnN0cmluZygwLCBNQVhfVElUTEVfTEVOR1RIKTtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIFRlbGVtZXRyeTogQmVnaW4gdXBsb2FkIHRyYWNraW5nIHdvcmtmbG93XG4gICAgICAgIC8vIFRPRE86IENoZWNrIGlmIHNhbWUgdGVsZW1ldHJ5IGV2ZW50cyBzaG91bGQgYmUgdXNlZCBpbiBleGlzdGluZyBpdGVtIHB1Ymxpc2ggd29ya2Zsb3dzIHRvb1xuICAgICAgICBsb2dBZGROZXdJdGVtU3RhcnQoKTtcbiAgICAgICAgKHsgYWRkUmVzcG9uc2UsIHB1Ymxpc2hSZXNwb25zZSB9ID1cbiAgICAgICAgICBleGlzdGluZ0l0ZW0gJiYgbmV3SXRlbU1vZGUgPT09IFwiZmlsZVwiXG4gICAgICAgICAgICA/IGF3YWl0IHRoaXMucHVibGlzaEV4aXN0aW5nSXRlbSgpXG4gICAgICAgICAgICA6IGF3YWl0IHRoaXMuaGFuZGxlQWRkSXRlbSgpKTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2VJZHMgPSBbYWRkUmVzcG9uc2UgPT09IG51bGwgfHwgYWRkUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFkZFJlc3BvbnNlLmlkLCBwdWJsaXNoUmVzcG9uc2UgPT09IG51bGwgfHwgcHVibGlzaFJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwdWJsaXNoUmVzcG9uc2UuaWRdLmZpbHRlcigoaWQpID0+IGlkKTtcbiAgICAgICAgY2F0ZWdvcmllcyAmJiAoYXdhaXQgdXBkYXRlQ2F0ZWdvcmllcyhwb3J0YWwsIHJlc3BvbnNlSWRzLCBjYXRlZ29yaWVzKSk7XG4gICAgICAgIGlmICh0eXBlID09PSBcIktNTFwiKSB7XG4gICAgICAgICAgY29uc3QgeyBjb25maWcsIHBvcnRhbCwgYXBpIH0gPSBjb25maWdTdGF0ZTtcbiAgICAgICAgICBhd2FpdCBwcm9jZXNzUG9zdEFkZEtNTCgoX2EgPSBhZGRSZXNwb25zZS5pZCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogYWRkSXRlbVN0YXRlLmlkLCBwb3J0YWwsIGNvbmZpZy5yZXN0QmFzZVVybCwgY29uZmlnLCBhcGkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy53b3JrZmxvd0NhbmNlbGxlZCkge1xuICAgICAgICAgIC8vIFRlbGVtZXRyeTogT25seSBsb2cgdGVsZW1ldHJ5IGFmdGVyIHN1Y2Nlc3NmdWwgdXBsb2FkXG4gICAgICAgICAgbG9nSXRlbVByb3BlcnRpZXNDaGFuZ2VzKCk7XG4gICAgICAgICAgbG9nU3VjY2Vzc2Z1bEl0ZW1DcmVhdGlvbigpO1xuICAgICAgICAgICEhYWRkSXRlbVN0YXRlLmFkZFRpbGVMYXllck9wdGlvbiAmJiBsb2dUaWxlTGF5ZXJGaW5pc2goKTtcbiAgICAgICAgICBjb25maWdTdGF0ZS50ZWxlbWV0cnkgJiYgKGF3YWl0IHRpbWVvdXQoNzUwKSk7XG4gICAgICAgICAgbGV0IGVtaXRQYXlsb2FkO1xuICAgICAgICAgIGlmICh0aGlzLmlzQWRkVG9NYXBUZXJtaW5hbFBhZ2UoKSkge1xuICAgICAgICAgICAgaWYgKG5ld0l0ZW1Nb2RlID09PSBcInVybFwiKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oeyB1cmw6IGFkZEl0ZW1TdGF0ZS51cmwsIGN1c3RvbVBhcmFtZXRlcnM6IGFkZEl0ZW1TdGF0ZS5jdXN0b21QYXJhbWV0ZXJzLCB0eXBlOiBhZGRJdGVtU3RhdGUudHlwZSwgYWRkQXNCYXNlbWFwOiBhZGRJdGVtU3RhdGUuYWRkQXNCYXNlbWFwIH0sIChwdWJsaXNoUmVzcG9uc2VcbiAgICAgICAgICAgICAgICA/IHsgaWQ6IHB1Ymxpc2hSZXNwb25zZS5pZCwgc2VydmljZVVybDogcHVibGlzaFJlc3BvbnNlLnNlcnZpY2VVcmwgfVxuICAgICAgICAgICAgICAgIDoge30pKSwgKGFkZEl0ZW1TdGF0ZS5zdG9yZUF1dGggPyB7IGlkOiBhZGRSZXNwb25zZS5pZCB9IDoge30pKTtcbiAgICAgICAgICAgICAgZW1pdFBheWxvYWQgPSBwYXlsb2FkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIGxldCBwYXlsb2FkO1xuICAgICAgICAgICAgICBpZiAocHVibGlzaFJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IHB1Ymxpc2hSZXNwb25zZS5zZXJ2aWNlVHlwZSxcbiAgICAgICAgICAgICAgICAgIGlkOiBwdWJsaXNoUmVzcG9uc2UuaWQsXG4gICAgICAgICAgICAgICAgICBqb2JJZDogcHVibGlzaFJlc3BvbnNlLmpvYklkLFxuICAgICAgICAgICAgICAgICAgc2VydmljZVVybDogcHVibGlzaFJlc3BvbnNlLnNlcnZpY2VVcmwsXG4gICAgICAgICAgICAgICAgICByZXN1bHRzOiB7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZUl0ZW1JbmZvOiB7XG4gICAgICAgICAgICAgICAgICAgICAgaWQ6IChfYiA9IGFkZFJlc3BvbnNlID09PSBudWxsIHx8IGFkZFJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhZGRSZXNwb25zZS5pZCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogZXhpc3RpbmdJdGVtID09PSBudWxsIHx8IGV4aXN0aW5nSXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXhpc3RpbmdJdGVtLmlkLFxuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IChfYyA9IGFkZEl0ZW1TdGF0ZS50eXBlKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiBleGlzdGluZ0l0ZW0gPT09IG51bGwgfHwgZXhpc3RpbmdJdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBleGlzdGluZ0l0ZW0udHlwZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBwYXlsb2FkID0gT2JqZWN0LmFzc2lnbih7IHR5cGU6IGFkZEl0ZW1TdGF0ZS50eXBlLCBpZDogYWRkUmVzcG9uc2UuaWQgfSwgKGFkZEl0ZW1TdGF0ZS5hbmFseXplUmVzdWx0cyAmJiBhZGRJdGVtU3RhdGUuc2VsZWN0ZWRGaWVsZHNcbiAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgYW5hbHl6ZVJlc3VsdHM6IGFkZEl0ZW1TdGF0ZS5hbmFseXplUmVzdWx0cyxcbiAgICAgICAgICAgICAgICAgICAgICBmaWVsZHM6IGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZEZpZWxkc1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICA6IHt9KSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZW1pdFBheWxvYWQgPSBwYXlsb2FkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGVtaXRQYXlsb2FkID0gT2JqZWN0LmFzc2lnbih7XG4gICAgICAgICAgICAgIC8vIGBwdWJsaXNoUmVzcG9uc2VgIGRvZXNuJ3QgZm9yIHNvbWUgZmxvd3Mgc28gdXNlIHRoaXMgaWQgaW5zdGVhZFxuICAgICAgICAgICAgICBpZDogYWRkUmVzcG9uc2UgPT09IG51bGwgfHwgYWRkUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFkZFJlc3BvbnNlLmlkLCBpdGVtOiBPYmplY3QuYXNzaWduKHt9LCBhZGRJdGVtU3RhdGUpLCByZXNwb25zZTogYWRkUmVzcG9uc2UsIGVtcHR5TGF5ZXJDcmVhdGVkLFxuICAgICAgICAgICAgICBuZXdJdGVtTW9kZVxuICAgICAgICAgICAgfSwgcHVibGlzaFJlc3BvbnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlLmVtaXQoZW1pdFBheWxvYWQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIChwdWJsaXNoUmVzcG9uc2UgPT09IG51bGwgfHwgcHVibGlzaFJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwdWJsaXNoUmVzcG9uc2UuaWQpICYmIChhd2FpdCBkZWxldGVJdGVtKHB1Ymxpc2hSZXNwb25zZS5pZCwgeyBwZXJtYW5lbnREZWxldGU6IHRydWUgfSkpO1xuICAgICAgICAgIGFkZFJlc3BvbnNlLmlkICYmIChhd2FpdCBkZWxldGVJdGVtKGFkZFJlc3BvbnNlLmlkLCB7IHBlcm1hbmVudERlbGV0ZTogdHJ1ZSB9KSk7XG4gICAgICAgICAgdGhpcy53b3JrZmxvd0NhbmNlbC5lbWl0KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmVzZXRBZGRJdGVtU3RvcmVzKCk7XG4gICAgICB9XG4gICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgaWYgKG5ld0l0ZW1Nb2RlID09PSBcImZlYXR1cmVMYXllclwiKSB7XG4gICAgICAgICAgLy8gVE9ETzogcmVmYWN0b3IgdGhpcyBvbmNlIHdlIHJlZmFjdG9yIHRoZSBlcnJvciBzeXN0ZW0gaW4gaXRlbSBwcm9wZXJ0aWVzXG4gICAgICAgICAgZmVhdHVyZUxheWVyRXJyb3JUZWxlbWV0cnkoSlNPTi5zdHJpbmdpZnkoZXJyb3IpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgdGhpcy5lcnJvciA9IGVycm9yO1xuICAgICAgICB0aGlzLnNob3dMb2FkZXIoZmFsc2UpO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5wcmVwcm9jZXNzQWRkSXRlbSA9ICgpID0+IHtcbiAgICAgIGlmIChhZGRJdGVtU3RhdGUudGlsZUxheWVyUHVibGlzaFR5cGUgPT09IFwiM2RUaWxlc1wiKSB7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS50eXBlS2V5d29yZHMgPSBbXG4gICAgICAgICAgLi4uYWRkSXRlbVN0YXRlLnR5cGVLZXl3b3Jkcy5maWx0ZXIoKHR5cGVLZXl3b3JkKSA9PiAhdGlsZXNMYXllcjNkVGlsZXNMYXllclR5cGVzLmluY2x1ZGVzKHR5cGVLZXl3b3JkKSksXG4gICAgICAgICAgYWRkSXRlbVN0YXRlLnRpbGVzTGF5ZXIzZFRpbGVzTGF5ZXJUeXBlXG4gICAgICAgIF07XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLml0ZW1UeXBlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZXJyb3IgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgdGhpcy5sb2FkZXJUeXBlID0gXCJpbmRldGVybWluYXRlXCI7XG4gICAgdGhpcy5sb2FkZXJNZXNzYWdlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgfVxuICBhc3luYyB2YWxpZGF0ZSgpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGlmICghKGF3YWl0IHRoaXMuaXRlbVByb3BlcnRpZXNGb2xkZXJSZWYuc2F2ZUFjdGl2ZUZvbGRlcigpKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCB0aXRsZUVycm9yID0gYXdhaXQgKChfYSA9IHRoaXMudGl0bGVSZWYpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS52YWxpZGF0ZVRpdGxlKCkpO1xuICAgIGlmICh0aXRsZUVycm9yKSB7XG4gICAgICAvLyBUaXRsZSBjb21wb25lbnQgdXNlcyBhIGJyaWVmIGlubGluZSBlcnJvciAtIG1hcCB0aGUgbWFpbiBlcnJvciBoYW5kbGVyIHRvIHRoZSBkZXRhaWxlZCBtZXNzYWdlXG4gICAgICB0aGlzLmVycm9yID1cbiAgICAgICAgdGl0bGVFcnJvci5jb2RlID09PSBcInRpdGxlSW5Vc2VTZXJ2aWNlXCIgPyB7IGNvZGU6IFwic2VydmljZU5hbWVFeGlzdHNcIiB9IDogdGl0bGVFcnJvcjtcbiAgICAgIHRoaXMudGl0bGVSZWYuZm9jdXNNYWluSW5wdXQoKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3Qgc3VtbWFyeUVycm9yID0gYXdhaXQgKChfYiA9IHRoaXMuc3VtbWFyeVJlZikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmdldEVycm9yTWVzc2FnZSgpKTtcbiAgICBpZiAoc3VtbWFyeUVycm9yKSB7XG4gICAgICB0aGlzLmVycm9yID0gc3VtbWFyeUVycm9yO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBhc3luYyBuYXZpZ2F0ZVRvTmV4dFBhZ2UoKSB7XG4gICAgdGhpcy5oYW5kbGVSZXF1ZXN0KCk7XG4gIH1cbiAgYXN5bmMgaGFuZGxlRXJyb3IoKSB7XG4gICAgY29uc3QgeyBlcnJvciB9ID0gdGhpcztcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSB0eXBlb2YgZXJyb3IgPT09IFwic3RyaW5nXCIgPyBlcnJvciA6IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5tZXNzYWdlO1xuICAgIC8vIDM5OTYzOiBQdWJsaXNoaW5nIGZhaWxzIGlmIHRoZSBzZXJ2aWNlIG5hbWUgaXMgdGFrZW4sIGJ1dCB0aGUgY3JlYXRlZCBpdGVtIHBlcnNpc3RzXG4gICAgLy8gUmVtb3ZlIHRoZSBuZXdseSBjcmVhdGVkIGl0ZW0gc28gdGhlIHRpdGxlIGNhbiBiZSBjaGFuZ2VkIHdpdGhvdXQgdGhyb3dpbmcgdGhlXG4gICAgLy8gXCJmaWxlIGFscmVhZHkgZXhpc3RzXCIgZXJyb3Igb24gcmV0cnlcbiAgICBpZiAoKGVycm9yTWVzc2FnZSA9PT0gbnVsbCB8fCBlcnJvck1lc3NhZ2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yTWVzc2FnZS5pbmNsdWRlcyhcIlNlcnZpY2UgbmFtZVwiKSkgJiYgIWFkZEl0ZW1TdGF0ZS5leGlzdGluZ0l0ZW0pIHtcbiAgICAgIGF3YWl0IGRlbGV0ZUl0ZW0oYWRkSXRlbVN0YXRlLmlkLCB7IHBlcm1hbmVudERlbGV0ZTogdHJ1ZSB9KTtcbiAgICB9XG4gIH1cbiAgaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpIHtcbiAgICByZXR1cm4gdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiO1xuICB9XG4gIC8vIEl0ZW0gd2FzIGFscmVhZHkgY3JlYXRlZCBhbmQgb25seSBuZWVkcyBhbiB1cGRhdGUgaWYgaXQncyBhIGxhcmdlIENTViBhZGRlZCB0byBNViB3aXRob3V0IHB1Ymxpc2hpbmdcbiAgc2hvdWxkVXBkYXRlUHJldmlvdXNseUNyZWF0ZWRJdGVtKCkge1xuICAgIGNvbnN0IHsgdHlwZSwgZW5hYmxlUHVibGlzaGluZywgZmlsZSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIGNvbnN0IG12RmxvdyA9IHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIjtcbiAgICByZXR1cm4gKG12RmxvdyAmJlxuICAgICAgdHlwZSA9PT0gXCJDU1ZcIiAmJlxuICAgICAgIWVuYWJsZVB1Ymxpc2hpbmcgJiZcbiAgICAgICEhZmlsZSAmJlxuICAgICAgZmlsZS5zaXplID4gTVVMVElfUEFSVF9VUExPQURfTUlOSU1VTV9TSVpFKTtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICBjb25zdCBhZGRDcmVhdGVJMThuID0gdWlTdG9yZVN0YXRlLmkxOG47XG4gICAgY29uc3QgaTE4biA9IGFkZENyZWF0ZUkxOG4uaXRlbVByb3BlcnRpZXM7XG4gICAgdGhpcy5pMThuID0gaTE4bjtcbiAgICBjb25zdCB7IG5ld0l0ZW1Nb2RlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgaWYgKHRoaXMuaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpKSB7XG4gICAgICB1aVN0b3JlU3RhdGUubmV4dFRleHQgPSBcImNyZWF0ZUFuZEFkZFRvTWFwXCI7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdWlTdG9yZVN0YXRlLm5leHRUZXh0ID0gbmV3SXRlbU1vZGUgPT09IFwiZGF0YVN0b3JlXCIgPyBcImNyZWF0ZUNvbm5lY3Rpb25cIiA6IFwic2F2ZVwiO1xuICAgIH1cbiAgICBhZGRJdGVtU3RhdGUuaW5pdGlhbEZvbGRlcnMgPSBjb25maWdTdGF0ZS5mb2xkZXJzO1xuICAgIGFkZEl0ZW1TdGF0ZS5pbml0aWFsVGl0bGUgPSBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlO1xuICAgIGNvbnN0IHsgZW5hYmxlUHVibGlzaGluZywgZmlsZU5hbWUsIHR5cGUsIHN0b3JlQXV0aCB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIGlmICh1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCIpIHtcbiAgICAgIHRoaXMuZGVzY3JpcHRpb25JbmZvID0ge1xuICAgICAgICB0aXRsZTogISFmaWxlTmFtZVxuICAgICAgICAgID8gcmVwbGFjZUkxOE5TdHJpbmcoaTE4bi5ob3dXaWxsQWRkLCBmaWxlTmFtZSwgXCJmaWxlTmFtZVwiKVxuICAgICAgICAgIDogaTE4bi5ob3dXaWxsQWRkU2VydmljZSxcbiAgICAgICAgY29udGVudDogc3RvcmVBdXRoXG4gICAgICAgICAgPyBpMThuLmhvd1dpbGxBZGRTZWN1cmVkU2VydmljZURlc2NyaXB0aW9uXG4gICAgICAgICAgOiBlbmFibGVQdWJsaXNoaW5nXG4gICAgICAgICAgICA/IGkxOG4uaG93V2lsbEFkZEhvc3RlZERlc2NyaXB0aW9uXG4gICAgICAgICAgICA6IHJlcGxhY2VJMThOU3RyaW5nKGkxOG4uaG93V2lsbEFkZERlc2NyaXB0aW9uLCB0eXBlID09PSBcIkdlb0pzb25cIiA/IFwiR2VvSlNPTlwiIDogdHlwZSwgXCJmaWxlVHlwZVwiKVxuICAgICAgfTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgaGFuZGxlQWRkSXRlbSgpIHtcbiAgICBjb25zdCB7IGZpbGUsIGZpbGVOYW1lLCBuZXdJdGVtTW9kZSwgdHlwZSwgZW5hYmxlUHVibGlzaGluZywgc2VydmljZUluZm8sIHR5cGVLZXl3b3JkcywgdGFncywgZXh0ZW50LCBzZWxlY3RlZFNlcnZpY2VJbmZvTGF5ZXJzTmFtZXMsIGFkZEZlYXR1cmVMYXllclR5cGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBsZXQgYWRkUmVzcG9uc2U7XG4gICAgbGV0IHB1Ymxpc2hSZXNwb25zZTtcbiAgICB0aGlzLnByZXByb2Nlc3NBZGRJdGVtKCk7XG4gICAgc3dpdGNoIChuZXdJdGVtTW9kZSkge1xuICAgICAgY2FzZSBcImZpbGVcIjpcbiAgICAgICAgdGhpcy5zaG93TG9hZGVyKHRydWUsIHtcbiAgICAgICAgICBsb2FkZXJUeXBlOiAoZmlsZSA9PT0gbnVsbCB8fCBmaWxlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWxlLnNpemUpID4gTVVMVElfUEFSVF9VUExPQURfTUlOSU1VTV9TSVpFID8gXCJkZXRlcm1pbmF0ZVwiIDogXCJpbmRldGVybWluYXRlXCIsXG4gICAgICAgICAgbG9hZGVyTWVzc2FnZTogcmVwbGFjZUkxOE5TdHJpbmcodGhpcy5pMThuW1widXBsb2FkaW5nXCJdLCBmaWxlTmFtZSwgXCJmaWxlVHlwZVwiKSAvLyBUT0RPOiBUeXBlIGluIHN0cmluZyBzaG91bGQgYmUgXCJmaWxlTmFtZVwiLCBub3QgXCJmaWxlVHlwZVwiXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodGhpcy5zaG91bGRVcGRhdGVQcmV2aW91c2x5Q3JlYXRlZEl0ZW0oKSkge1xuICAgICAgICAgICh7IGFkZFJlc3BvbnNlIH0gPSBhd2FpdCB0aGlzLmhhbmRsZUZpbGVVcGRhdGUoKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgKHsgYWRkUmVzcG9uc2UsIHB1Ymxpc2hSZXNwb25zZSB9ID0gYXdhaXQgdGhpcy5oYW5kbGVGaWxlVXBsb2FkKCkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFdvcmtmbG93IHdhcyBjYW5jZWxsZWQgaWYgbm8gZmlsZSBmb3VuZCBpbiBzdG9yZVxuICAgICAgICBpZiAoIWFkZEl0ZW1TdGF0ZS5maWxlICYmICFhZGRJdGVtU3RhdGUuZGF0YVVybCkge1xuICAgICAgICAgIHRoaXMud29ya2Zsb3dDYW5jZWxsZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInVybFwiOlxuICAgICAgICB0aGlzLnNob3dMb2FkZXIodHJ1ZSwge1xuICAgICAgICAgIGxvYWRlclR5cGU6IFwiaW5kZXRlcm1pbmF0ZVwiLFxuICAgICAgICAgIGxvYWRlck1lc3NhZ2U6IHJlcGxhY2VJMThOU3RyaW5nKHRoaXMuaTE4bltcImFkZGluZ1wiXSwgYWRkSXRlbVN0YXRlLnVybCwgXCJmaWxlVHlwZVwiKVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCh0eXBlID09PSBcIkNTVlwiIHx8IHR5cGUgPT09IFwiR2VvSnNvblwiKSAmJiBlbmFibGVQdWJsaXNoaW5nKSB7XG4gICAgICAgICAgKHsgYWRkUmVzcG9uc2UsIHB1Ymxpc2hSZXNwb25zZSB9ID0gYXdhaXQgdGhpcy5oYW5kbGVGaWxlVXBsb2FkKCkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGFkZFJlc3BvbnNlID0gYXdhaXQgaGFuZGxlQWRkVXJsKGFkZEl0ZW1TdGF0ZSwgY29uZmlnU3RhdGUuY29uZmlnLCBjb25maWdTdGF0ZS5hcGkpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImZlYXR1cmVMYXllclwiOlxuICAgICAgICB0aGlzLnNob3dMb2FkZXIodHJ1ZSwge1xuICAgICAgICAgIGxvYWRlclR5cGU6IFwiaW5kZXRlcm1pbmF0ZVwiLFxuICAgICAgICAgIGxvYWRlck1lc3NhZ2U6IHJlcGxhY2VJMThOU3RyaW5nKHRoaXMuaTE4bltcImNyZWF0aW5nXCJdLCBcImZlYXR1cmUgbGF5ZXJcIiwgXCJmaWxlVHlwZVwiKVxuICAgICAgICB9KTtcbiAgICAgICAgYWRkUmVzcG9uc2UgPSBhd2FpdCBhZGRGZWF0dXJlTGF5ZXIoe1xuICAgICAgICAgIHNlcnZpY2VJbmZvLFxuICAgICAgICAgIHR5cGVLZXl3b3JkcyxcbiAgICAgICAgICB0YWdzLFxuICAgICAgICAgIGV4dGVudCxcbiAgICAgICAgICBzZWxlY3RlZFNlcnZpY2VJbmZvTGF5ZXJzTmFtZXMsXG4gICAgICAgICAgYWRkRmVhdHVyZUxheWVyVHlwZVxuICAgICAgICB9KTtcbiAgICAgICAgZmVhdHVyZVNlcnZpY2VFbmRUZWxlbWV0cnkoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwidGlsZUxheWVyXCI6XG4gICAgICBjYXNlIFwic2NlbmVMYXllclwiOlxuICAgICAgICB0aGlzLnNob3dMb2FkZXIodHJ1ZSwge1xuICAgICAgICAgIGxvYWRlclR5cGU6IFwiaW5kZXRlcm1pbmF0ZVwiLFxuICAgICAgICAgIGxvYWRlck1lc3NhZ2U6IHJlcGxhY2VJMThOU3RyaW5nKHRoaXMuaTE4bltcInB1Ymxpc2hpbmdcIl0sIG5ld0l0ZW1Nb2RlID09PSBcInNjZW5lTGF5ZXJcIiA/IFwic2NlbmUgc2VydmljZVwiIDogXCJ0aWxlIGxheWVyXCIsIFwiZmlsZVR5cGVcIilcbiAgICAgICAgfSk7XG4gICAgICAgICh7IGFkZFJlc3BvbnNlLCBwdWJsaXNoUmVzcG9uc2UgfSA9IGF3YWl0IHRoaXMuYWRkVGlsZUxheWVyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJyYXN0ZXJGdW5jdGlvblRlbXBsYXRlXCI6XG4gICAgICAgIHRoaXMuc2hvd0xvYWRlcih0cnVlLCB7XG4gICAgICAgICAgbG9hZGVyVHlwZTogKGZpbGUgPT09IG51bGwgfHwgZmlsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlsZS5zaXplKSA+IE1VTFRJX1BBUlRfVVBMT0FEX01JTklNVU1fU0laRSA/IFwiZGV0ZXJtaW5hdGVcIiA6IFwiaW5kZXRlcm1pbmF0ZVwiLFxuICAgICAgICAgIGxvYWRlck1lc3NhZ2U6IHJlcGxhY2VJMThOU3RyaW5nKHRoaXMuaTE4bltcInVwbG9hZGluZ1wiXSwgZmlsZU5hbWUsIFwiZmlsZVR5cGVcIilcbiAgICAgICAgfSk7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5maWxlID0gbmV3IEZpbGUoW1wiXCJdLCBgJHtpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlfS5yZnQuanNvbmApO1xuICAgICAgICAoeyBhZGRSZXNwb25zZSwgcHVibGlzaFJlc3BvbnNlIH0gPSBhd2FpdCB0aGlzLmhhbmRsZUZpbGVVcGxvYWQoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImFwcGxpY2F0aW9uXCI6XG4gICAgICAgIHRoaXMuc2hvd0xvYWRlcih0cnVlLCB7XG4gICAgICAgICAgbG9hZGVyVHlwZTogKGZpbGUgPT09IG51bGwgfHwgZmlsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlsZS5zaXplKSA+IE1VTFRJX1BBUlRfVVBMT0FEX01JTklNVU1fU0laRSA/IFwiZGV0ZXJtaW5hdGVcIiA6IFwiaW5kZXRlcm1pbmF0ZVwiLFxuICAgICAgICAgIGxvYWRlck1lc3NhZ2U6IHJlcGxhY2VJMThOU3RyaW5nKHRoaXMuaTE4bltcImFkZGluZ1wiXSwgYWRkSXRlbVN0YXRlLnR5cGUsIFwiZmlsZVR5cGVcIilcbiAgICAgICAgfSk7XG4gICAgICAgIGFkZFJlc3BvbnNlID0gYXdhaXQgYWRkQXBwbGljYXRpb24oYWRkSXRlbVN0YXRlLCBjb25maWdTdGF0ZS5jb25maWcucmVzdEJhc2VVcmwsIHR5cGUgPT09IFwiQXBwbGljYXRpb25cIlxuICAgICAgICAgID8geyByZWRpcmVjdF91cmlzOiBbXCJ1cm46aWV0Zjp3ZzpvYXV0aDoyLjA6b29iXCJdLCBhcHBUeXBlOiBcIm11bHRpcGxlXCIgfVxuICAgICAgICAgIDogdW5kZWZpbmVkKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiZGF0YVN0b3JlXCI6XG4gICAgICAgIGNvbnN0IHsgYWRkRGF0YVN0b3JlVHlwZSwgcHJvdmlkZXIgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgdGhpcy5zaG93TG9hZGVyKHRydWUsIHtcbiAgICAgICAgICBsb2FkZXJUeXBlOiBcImluZGV0ZXJtaW5hdGVcIixcbiAgICAgICAgICBsb2FkZXJNZXNzYWdlOiByZXBsYWNlSTE4TlN0cmluZyh0aGlzLmkxOG5bXCJhZGREYXRhU3RvcmVcIl0sIHRoaXMuaTE4blthZGREYXRhU3RvcmVUeXBlID09PSBcImNsb3VkXCIgPyBwcm92aWRlciA6IGFkZERhdGFTdG9yZVR5cGVdLCBcImZpbGVUeXBlXCIpXG4gICAgICAgIH0pO1xuICAgICAgICBhZGRSZXNwb25zZSA9IGF3YWl0IGFkZERhdGFTdG9yZShhZGRJdGVtU3RhdGUsIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUsIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGFncywgaXRlbVByb3BlcnRpZXNTdGF0ZS5jYXRlZ29yaWVzLCBpdGVtUHJvcGVydGllc1N0YXRlLnNuaXBwZXQpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJkZXZlbG9wZXJDcmVkZW50aWFsc1wiOlxuICAgICAgICB0aGlzLnNob3dMb2FkZXIodHJ1ZSwge1xuICAgICAgICAgIGxvYWRlclR5cGU6IFwiaW5kZXRlcm1pbmF0ZVwiLFxuICAgICAgICAgIGxvYWRlck1lc3NhZ2U6IHJlcGxhY2VJMThOU3RyaW5nKHRoaXMuaTE4bltcImNyZWF0aW5nXCJdLCBhZGRJdGVtU3RhdGUudHlwZSwgXCJmaWxlVHlwZVwiKVxuICAgICAgICB9KTtcbiAgICAgICAgYWRkUmVzcG9uc2UgPSBhd2FpdCB0aGlzLmFkZERldmVsb3BlckNyZWRlbnRpYWxBcHBsaWNhdGlvbigpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJjcmVhdGVcIjpcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRoaXMuc2hvd0xvYWRlcih0cnVlLCB7XG4gICAgICAgICAgbG9hZGVyVHlwZTogXCJpbmRldGVybWluYXRlXCIsXG4gICAgICAgICAgbG9hZGVyTWVzc2FnZTogcmVwbGFjZUkxOE5TdHJpbmcodGhpcy5pMThuW1wiY3JlYXRpbmdcIl0sIGFkZEl0ZW1TdGF0ZS50eXBlLCBcImZpbGVUeXBlXCIpXG4gICAgICAgIH0pO1xuICAgICAgICBhZGRSZXNwb25zZSA9IGF3YWl0IHNlbmRBZGRJdGVtUmVxdWVzdChhZGRJdGVtU3RhdGUpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIHsgYWRkUmVzcG9uc2UsIHB1Ymxpc2hSZXNwb25zZSB9O1xuICB9XG4gIGFzeW5jIHB1Ymxpc2hFeGlzdGluZ0l0ZW0oKSB7XG4gICAgY29uc3QgeyBpZCwgdHlwZSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIGxldCBhZGRSZXNwb25zZSA9IHsgc3VjY2VzczogdHJ1ZSwgaWQsIGZvbGRlcjogbnVsbCB9O1xuICAgIGNvbnN0IHB1Ymxpc2hSZXNwb25zZSA9IHR5cGUgPT09IFwiSW1hZ2UgQ29sbGVjdGlvblwiXG4gICAgICA/IGF3YWl0IHRoaXMucHVibGlzaEltYWdlQ29sbGVjdGlvbihhZGRSZXNwb25zZSlcbiAgICAgIDogYXdhaXQgdGhpcy5wdWJsaXNoU2VydmljZShpZCk7XG4gICAgYXdhaXQgYXBwZW5kVHlwZUtleXdvcmRzKHB1Ymxpc2hSZXNwb25zZSk7XG4gICAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAvaXNzdWVzLzQxNTAxXG4gICAgY29uc3QgdHlwZXNUb1VwZGF0ZVRpdGxlID0gW1xuICAgICAgXCJTaGFwZWZpbGVcIixcbiAgICAgIFwiRmlsZSBHZW9kYXRhYmFzZVwiLFxuICAgICAgXCJDU1ZcIixcbiAgICAgIFwiTWljcm9zb2Z0IEV4Y2VsXCIsXG4gICAgICBcIkdlb0pzb25cIixcbiAgICAgIFwiR2VvUGFja2FnZVwiLFxuICAgICAgXCJGZWF0dXJlIENvbGxlY3Rpb25cIlxuICAgIF07XG4gICAgaWYgKHR5cGVzVG9VcGRhdGVUaXRsZS5pbmNsdWRlcyh0eXBlKSkge1xuICAgICAgKHsgYWRkUmVzcG9uc2UgfSA9IGF3YWl0IHRoaXMuaGFuZGxlRmlsZVVwZGF0ZShwdWJsaXNoUmVzcG9uc2UuaWQpKTtcbiAgICB9XG4gICAgcmV0dXJuIHsgYWRkUmVzcG9uc2UsIHB1Ymxpc2hSZXNwb25zZSB9O1xuICB9XG4gIGFzeW5jIGhhbmRsZUZpbGVVcGxvYWQoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgdHlwZSwgZW5hYmxlUHVibGlzaGluZywgY2xvdWRQcm92aWRlclJlc291cmNlLCBnZW9KU09OUmVzb3VyY2UsIGNzdlJlc291cmNlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgbGV0IGFkZFJlc3BvbnNlO1xuICAgIGxldCBwdWJsaXNoUmVzcG9uc2U7XG4gICAgY29uc3QgaXNOb3RDU1ZPckV4Y2VsID0gdHlwZSAhPT0gXCJDU1ZcIiAmJiB0eXBlICE9PSBcIk1pY3Jvc29mdCBFeGNlbFwiO1xuICAgIGlmIChlbmFibGVQdWJsaXNoaW5nKSB7XG4gICAgICBpZiAodHlwZSA9PT0gXCJJbWFnZSBDb2xsZWN0aW9uXCIpIHtcbiAgICAgICAgYWRkUmVzcG9uc2UgPSBhd2FpdCB0aGlzLmFkZEZpbGUoKTtcbiAgICAgICAgcHVibGlzaFJlc3BvbnNlID0gYXdhaXQgdGhpcy5wdWJsaXNoSW1hZ2VDb2xsZWN0aW9uKGFkZFJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAvLyBGb3IgQ1NWIGFuZCBYTFhTIGZyb20gY2xvdWQgYW5kIGxhcmdlIGNzdiwgd2UgYWxyZWFkeSBhZGQgaXRlbVxuICAgICAgICBpZiAoIWlzTm90Q1NWT3JFeGNlbCAmJiAoY2xvdWRQcm92aWRlclJlc291cmNlIHx8IGFkZEl0ZW1TdGF0ZS5pZCkpIHtcbiAgICAgICAgICAvLyBXZSBuZWVkIHRvIG1ha2UgY2hhbmdlIHRvIHRoZSBvcmlnaW5hbCBpdGVtIHRpdGxlIGJlZm9yZSBwdWJsaXNoaW5nXG4gICAgICAgICAgLy8gIGJlY2F1c2UgcHVibGlzaCBhbHdheXMgdXNlIHRoZSBpdGVtIHRpdGxlIGFzIHRoZSBzZXJ2aWNlIG5hbWVcbiAgICAgICAgICBhd2FpdCB1cGRhdGVJdGVtKGFkZEl0ZW1TdGF0ZS5pZCwgZm9ybWF0SXRlbVByb3BlcnRpZXMoe1xuICAgICAgICAgICAgdGl0bGU6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUsXG4gICAgICAgICAgICB0YWdzOiBpdGVtUHJvcGVydGllc1N0YXRlLnRhZ3MsXG4gICAgICAgICAgICBzbmlwcGV0OiBpdGVtUHJvcGVydGllc1N0YXRlLnNuaXBwZXRcbiAgICAgICAgICB9KSk7XG4gICAgICAgICAgKHsgYWRkUmVzcG9uc2UsIHB1Ymxpc2hSZXNwb25zZSB9ID0gYXdhaXQgdGhpcy5wdWJsaXNoRXhpc3RpbmdJdGVtKCkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGFkZFJlc3BvbnNlID0gYXdhaXQgdGhpcy5hZGRGaWxlKHsgdGl0bGU6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUgfSk7XG4gICAgICAgICAgYWRkSXRlbVN0YXRlLmlkID0gYWRkUmVzcG9uc2UuaWQ7XG4gICAgICAgICAgcHVibGlzaFJlc3BvbnNlID0gYXdhaXQgdGhpcy5wdWJsaXNoU2VydmljZShhZGRSZXNwb25zZS5pZCk7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgYXBwZW5kVHlwZUtleXdvcmRzKHB1Ymxpc2hSZXNwb25zZSk7XG4gICAgICB9XG4gICAgICB0aGlzLnVwZGF0ZUZvbGRlcihwdWJsaXNoUmVzcG9uc2UpO1xuICAgICAgaWYgKGNsb3VkUHJvdmlkZXJSZXNvdXJjZSB8fCBnZW9KU09OUmVzb3VyY2UgfHwgY3N2UmVzb3VyY2UpIHtcbiAgICAgICAgaWYgKChjbG91ZFByb3ZpZGVyUmVzb3VyY2UgPT09IG51bGwgfHwgY2xvdWRQcm92aWRlclJlc291cmNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG91ZFByb3ZpZGVyUmVzb3VyY2UubWltZVR5cGUpID09PSBcInppcFwiKSB7XG4gICAgICAgICAgY2xvdWRQcm92aWRlclJlc291cmNlLnppcEl0ZW1UeXBlID0gdHlwZTtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IGFkZENsb3VkUHJvdmlkZXJSZXNvdXJjZSgoX2EgPSBjbG91ZFByb3ZpZGVyUmVzb3VyY2UgIT09IG51bGwgJiYgY2xvdWRQcm92aWRlclJlc291cmNlICE9PSB2b2lkIDAgPyBjbG91ZFByb3ZpZGVyUmVzb3VyY2UgOiBnZW9KU09OUmVzb3VyY2UpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGNzdlJlc291cmNlLCBwdWJsaXNoUmVzcG9uc2UuaWQpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChfYikge1xuICAgICAgICAgIC8vIG5vLW9wXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBpZiAoY2xvdWRQcm92aWRlclJlc291cmNlICYmICFpc05vdENTVk9yRXhjZWwgJiYgYWRkSXRlbVN0YXRlLmlkKSB7XG4gICAgICAgIC8vIEFscmVhZHkgYWRkLCBqdXN0IG5lZWQgdG8gdXBkYXRlIHRoZSB0aXRsZVxuICAgICAgICBhZGRSZXNwb25zZSA9IGF3YWl0IHVwZGF0ZUl0ZW0oYWRkSXRlbVN0YXRlLmlkLCBmb3JtYXRJdGVtUHJvcGVydGllcyh7XG4gICAgICAgICAgdGl0bGU6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUsXG4gICAgICAgICAgdGFnczogaXRlbVByb3BlcnRpZXNTdGF0ZS50YWdzLFxuICAgICAgICAgIHNuaXBwZXQ6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuc25pcHBldFxuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgYWRkUmVzcG9uc2UgPSBhd2FpdCB0aGlzLmFkZEZpbGUoeyB0aXRsZTogaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHsgYWRkUmVzcG9uc2UsIHB1Ymxpc2hSZXNwb25zZSB9O1xuICB9XG4gIGFzeW5jIGhhbmRsZUZpbGVVcGRhdGUoaWQpIHtcbiAgICB0aGlzLnVwZGF0ZUxvYWRlcihcImluZGV0ZXJtaW5hdGVcIiwgdGhpcy5pMThuLnVwbG9hZGluZy5yZXBsYWNlKFwiJHt0eXBlfVwiLCBhZGRJdGVtU3RhdGUuZmlsZU5hbWUpKTtcbiAgICBjb25zdCBhZGRSZXNwb25zZSA9IGF3YWl0IHVwZGF0ZUl0ZW0oaWQgIT09IG51bGwgJiYgaWQgIT09IHZvaWQgMCA/IGlkIDogYWRkSXRlbVN0YXRlLmlkLCBmb3JtYXRJdGVtUHJvcGVydGllcyh7XG4gICAgICB0aXRsZTogaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSxcbiAgICAgIHRhZ3M6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGFncyxcbiAgICAgIHNuaXBwZXQ6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuc25pcHBldFxuICAgIH0pKTtcbiAgICB0aGlzLnVwZGF0ZUZvbGRlcihhZGRSZXNwb25zZSk7XG4gICAgcmV0dXJuIHsgYWRkUmVzcG9uc2UgfTtcbiAgfVxuICBhc3luYyBhZGREZXZlbG9wZXJDcmVkZW50aWFsQXBwbGljYXRpb24oKSB7XG4gICAgY29uc3QgeyBkZXZlbG9wZXJDcmVkZW50aWFsc1JlZGlyZWN0VXJscywgYXBwbGljYXRpb25FbnZpcm9ubWVudCwgZGV2ZWxvcGVyQ3JlZGVudGlhbHNUeXBlLCBhcGlLZXlSZWZlcnJlclVybHMsIGRldmVsb3BlclByaXZpbGVnZXMgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICByZXR1cm4gYWRkQXBwbGljYXRpb24oYWRkSXRlbVN0YXRlLCBnZXRSZXN0QmFzZVVybChjb25maWdTdGF0ZS5wb3J0YWwpLCBkZXZlbG9wZXJDcmVkZW50aWFsc1R5cGUgPT09IFwib2F1dGhcIlxuICAgICAgPyB7IGFwcFR5cGU6IGFwcGxpY2F0aW9uRW52aXJvbm1lbnQsIHJlZGlyZWN0X3VyaXM6IGRldmVsb3BlckNyZWRlbnRpYWxzUmVkaXJlY3RVcmxzIH1cbiAgICAgIDoge1xuICAgICAgICBhcHBUeXBlOiBcImFwaWtleVwiLFxuICAgICAgICByZWRpcmVjdF91cmlzOiBkZXZlbG9wZXJDcmVkZW50aWFsc1JlZGlyZWN0VXJscyxcbiAgICAgICAgaHR0cFJlZmVycmVyczogYXBpS2V5UmVmZXJyZXJVcmxzLFxuICAgICAgICBwcml2aWxlZ2VzOiBkZXZlbG9wZXJQcml2aWxlZ2VzXG4gICAgICB9KTtcbiAgfVxuICBhc3luYyBhZGRGaWxlKHByb3BzKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhZGRGaWxlKHByb3BzKTtcbiAgICB0aGlzLnVwZGF0ZUxvYWRlcihcImluZGV0ZXJtaW5hdGVcIiwgdGhpcy5pMThuLmNoZWNraW5nU3RhdHVzKTtcbiAgICBhd2FpdCBjaGVja0pvYlN0YXR1cyhyZXNwb25zZSk7XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9XG4gIGFzeW5jIHVwZGF0ZUZvbGRlcihwdWJsaXNoUmVzcG9uc2UpIHtcbiAgICBjb25zdCB7IGlkLCBmaWxlLCBjbG91ZFByb3ZpZGVyUmVzb3VyY2UgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBjb25zdCBmb2xkZXIgPSBpdGVtUHJvcGVydGllc1N0YXRlLmZvbGRlcjtcbiAgICAvLyBNdWx0aXBhcnQgYW5kIHByZS1hZGRlZCBpdGVtcyBuZWVkIHRvIGJlIG1vdmVkIGFmdGVyIGNyZWF0aW9uXG4gICAgaWYgKChmaWxlID09PSBudWxsIHx8IGZpbGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpbGUuc2l6ZSkgPiBNVUxUSV9QQVJUX1VQTE9BRF9NSU5JTVVNX1NJWkUgfHwgY2xvdWRQcm92aWRlclJlc291cmNlKSB7XG4gICAgICBjb25zdCBtb3ZlSWRzID0gW107XG4gICAgICBpZCAmJiBtb3ZlSWRzLnB1c2goaWQpO1xuICAgICAgKHB1Ymxpc2hSZXNwb25zZSA9PT0gbnVsbCB8fCBwdWJsaXNoUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hSZXNwb25zZS5pZCkgJiYgbW92ZUlkcy5wdXNoKHB1Ymxpc2hSZXNwb25zZSA9PT0gbnVsbCB8fCBwdWJsaXNoUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hSZXNwb25zZS5pZCk7XG4gICAgICBmb2xkZXIuaWQgIT09IGZvbGRlci51c2VybmFtZSAmJiAoYXdhaXQgbW92ZUl0ZW0obW92ZUlkcy5qb2luKFwiLFwiKSwgZm9sZGVyLmlkKSk7XG4gICAgfVxuICB9XG4gIGFzeW5jIHB1Ymxpc2hTZXJ2aWNlKGl0ZW1JZCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mLCBfZywgX2g7XG4gICAgdGhpcy5zaG93TG9hZGVyKHRydWUsIHtcbiAgICAgIGxvYWRlclR5cGU6IFwiaW5kZXRlcm1pbmF0ZVwiLFxuICAgICAgbG9hZGVyTWVzc2FnZTogdGhpcy5pMThuLnB1Ymxpc2hpbmdTZXJ2aWNlXG4gICAgfSk7XG4gICAgY29uc3QgeyByZXN1bHQ6IHB1Ymxpc2hSZXNwb25zZSB9ID0gYXdhaXQgcHVibGlzaFNlcnZpY2Uoe1xuICAgICAgaXRlbUlkLFxuICAgICAgdXNlcjogY29uZmlnU3RhdGUudXNlcixcbiAgICAgIGV4dGVuc2lvbjogYWRkSXRlbVN0YXRlLmV4dGVuc2lvbixcbiAgICAgIHR5cGU6IGFkZEl0ZW1TdGF0ZS50eXBlLFxuICAgICAgdGl0bGU6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGVcbiAgICB9KTtcbiAgICBpZiAoISgoX2EgPSBwdWJsaXNoUmVzcG9uc2Uuc2VydmljZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpIHx8ICEoKF9jID0gKF9iID0gcHVibGlzaFJlc3BvbnNlLnNlcnZpY2VzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2JbMF0pID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5zdWNjZXNzKSA9PT0gZmFsc2UpIHtcbiAgICAgIHRocm93IHRoaXMuaTE4bi5lcnJvclB1Ymxpc2hpbmc7XG4gICAgfVxuICAgIGVsc2UgaWYgKChfZSA9IChfZCA9IHB1Ymxpc2hSZXNwb25zZS5zZXJ2aWNlc1swXSkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmVycm9yKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UubWVzc2FnZSkge1xuICAgICAgdGhyb3cgKF9nID0gKF9mID0gcHVibGlzaFJlc3BvbnNlLnNlcnZpY2VzWzBdKSA9PT0gbnVsbCB8fCBfZiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2YuZXJyb3IpID09PSBudWxsIHx8IF9nID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZy5tZXNzYWdlO1xuICAgIH1cbiAgICBjb25zdCBzZXJ2aWNlID0gKF9oID0gcHVibGlzaFJlc3BvbnNlLnNlcnZpY2VzKSA9PT0gbnVsbCB8fCBfaCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2hbMF07XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBzZXJ2aWNlID09PSBudWxsIHx8IHNlcnZpY2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlcnZpY2Uuc2VydmljZUl0ZW1JZCxcbiAgICAgIGpvYklkOiBzZXJ2aWNlID09PSBudWxsIHx8IHNlcnZpY2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlcnZpY2Uuam9iSWQsXG4gICAgICBzZXJ2aWNlVHlwZTogc2VydmljZSA9PT0gbnVsbCB8fCBzZXJ2aWNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXJ2aWNlLnR5cGUsXG4gICAgICBzZXJ2aWNlVXJsOiBzZXJ2aWNlID09PSBudWxsIHx8IHNlcnZpY2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlcnZpY2Uuc2VydmljZXVybFxuICAgIH07XG4gIH1cbiAgYXN5bmMgcHVibGlzaEltYWdlQ29sbGVjdGlvbihhZGRJdGVtUmVzcG9uc2UpIHtcbiAgICB2YXIgX2EsIGVfMSwgX2IsIF9jO1xuICAgIGNvbnN0IHsgY29uZmlnLCB1c2VyLCBwb3J0YWwgfSA9IGNvbmZpZ1N0YXRlO1xuICAgIHRoaXMuc2hvd0xvYWRlcih0cnVlLCB7XG4gICAgICBsb2FkZXJUeXBlOiBcImluZGV0ZXJtaW5hdGVcIixcbiAgICAgIGxvYWRlck1lc3NhZ2U6IHRoaXMuaTE4bi5wdWJsaXNoaW5nU2VydmljZVxuICAgIH0pO1xuICAgIGNvbnN0IGltYWdlQ29sbGVjdGlvbkdlbmVyYXRvciA9IGNyZWF0ZUltYWdlQ29sbGVjdGlvbihhZGRJdGVtUmVzcG9uc2UsIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUsIHsgY29uZmlnLCB1c2VyLCBwb3J0YWwgfSk7XG4gICAgdHJ5IHtcbiAgICAgIGZvciAodmFyIF9kID0gdHJ1ZSwgaW1hZ2VDb2xsZWN0aW9uR2VuZXJhdG9yXzEgPSBfX2FzeW5jVmFsdWVzKGltYWdlQ29sbGVjdGlvbkdlbmVyYXRvciksIGltYWdlQ29sbGVjdGlvbkdlbmVyYXRvcl8xXzE7IGltYWdlQ29sbGVjdGlvbkdlbmVyYXRvcl8xXzEgPSBhd2FpdCBpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3JfMS5uZXh0KCksIF9hID0gaW1hZ2VDb2xsZWN0aW9uR2VuZXJhdG9yXzFfMS5kb25lLCAhX2E7KSB7XG4gICAgICAgIF9jID0gaW1hZ2VDb2xsZWN0aW9uR2VuZXJhdG9yXzFfMS52YWx1ZTtcbiAgICAgICAgX2QgPSBmYWxzZTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBzdGF0dXMgPSBfYztcbiAgICAgICAgICBpZiAodHlwZW9mIHN0YXR1cyA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVMb2FkZXIoXCJpbmRldGVybWluYXRlXCIsIHRoaXMuaTE4bltzdGF0dXNdKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBpZDogc3RhdHVzLnNlcnZpY2VJdGVtSWQsXG4gICAgICAgICAgICAgIGpvYklkOiBudWxsLFxuICAgICAgICAgICAgICBzZXJ2aWNlVHlwZTogc3RhdHVzLnR5cGUsXG4gICAgICAgICAgICAgIHNlcnZpY2VVcmw6IHN0YXR1cy5zZXJ2aWNldXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICBfZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGVfMV8xKSB7XG4gICAgICBlXzEgPSB7IGVycm9yOiBlXzFfMSB9O1xuICAgIH1cbiAgICBmaW5hbGx5IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICghX2QgJiYgIV9hICYmIChfYiA9IGltYWdlQ29sbGVjdGlvbkdlbmVyYXRvcl8xLnJldHVybikpXG4gICAgICAgICAgYXdhaXQgX2IuY2FsbChpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3JfMSk7XG4gICAgICB9XG4gICAgICBmaW5hbGx5IHtcbiAgICAgICAgaWYgKGVfMSlcbiAgICAgICAgICB0aHJvdyBlXzEuZXJyb3I7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGFzeW5jIGFkZFRpbGVMYXllcigpIHtcbiAgICBjb25zdCB7IGRhdGFzZXQsIGRhdGFTdG9yZUlkLCBzZXJ2ZXJJZCB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIGNvbnN0IHsgZm9sZGVyLCBjYXRlZ29yaWVzIH0gPSBpdGVtUHJvcGVydGllc1N0YXRlO1xuICAgIGxldCBwdWJsaXNoUmVzcG9uc2U7XG4gICAgaWYgKGRhdGFzZXQpIHtcbiAgICAgIGNvbnN0IHsgcmVzdWx0LCBlcnJvciB9ID0gYXdhaXQgcHVibGlzaEZyb21EYXRhU3RvcmUoe1xuICAgICAgICB0eXBlOiBkYXRhc2V0LnR5cGUsXG4gICAgICAgIHNlcnZpY2VOYW1lOiBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlLFxuICAgICAgICBwYXRoSW5DYWNoZWRTdG9yZTogZGF0YXNldC5wYXRoLFxuICAgICAgICBjYWNoZVN0b3JlSWQ6IGRhdGFTdG9yZUlkLFxuICAgICAgICBzZXJ2ZXJJZCxcbiAgICAgICAgZm9sZGVyLFxuICAgICAgICBkZXNjcmlwdGlvbjogaXRlbVByb3BlcnRpZXNTdGF0ZS5zbmlwcGV0LFxuICAgICAgICB0YWdzOiBpdGVtUHJvcGVydGllc1N0YXRlLnRhZ3NcbiAgICAgIH0sIGNvbmZpZ1N0YXRlLnBvcnRhbCk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgIHB1Ymxpc2hSZXNwb25zZSA9IHtcbiAgICAgICAgICBpZDogcmVzdWx0LnNlcnZpY2VJdGVtSWQsXG4gICAgICAgICAgc2VydmljZVR5cGU6IHJlc3VsdC50eXBlLFxuICAgICAgICAgIHNlcnZpY2VVcmw6IHJlc3VsdC5zZXJ2aWNlVXJsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgaWYgKGFkZEl0ZW1TdGF0ZS50aWxlTGF5ZXJQdWJsaXNoVHlwZSAhPT0gXCIzZFRpbGVzXCIpIHtcbiAgICAgICAgLy8gVE9ETzogZmluaXNoIHRoZSAzRCBUaWxlcyBwdWJsaXNoIHdvcmtmbG93XG4gICAgICAgIGNvbnN0IHsgdGlsZUxheWVyUHVibGlzaENvbnRlbnQsIHRpbGVMYXllclB1Ymxpc2hUeXBlLCB0aWxlTGF5ZXJEYXRhIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGNvbnN0IHsgdGl0bGUsIHRhZ3MsIHNuaXBwZXQgfSA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGU7XG4gICAgICAgIHB1Ymxpc2hSZXNwb25zZSA9IGF3YWl0IHB1Ymxpc2hUaWxlTGF5ZXIodGlsZUxheWVyUHVibGlzaENvbnRlbnQsIHtcbiAgICAgICAgICB1c2VyOiBjb25maWdTdGF0ZS51c2VyLFxuICAgICAgICAgIHB1Ymxpc2hUeXBlOiB0aWxlTGF5ZXJQdWJsaXNoVHlwZSxcbiAgICAgICAgICBmb2xkZXIsXG4gICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgdGFncyxcbiAgICAgICAgICBjYXRlZ29yaWVzLFxuICAgICAgICAgIHNuaXBwZXRcbiAgICAgICAgfSwgdGlsZUxheWVyRGF0YSk7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGFkZFJlc3BvbnNlID0geyBzdWNjZXNzOiB0cnVlLCBpZDogcHVibGlzaFJlc3BvbnNlLmlkLCBmb2xkZXI6IG51bGwgfTtcbiAgICByZXR1cm4geyBhZGRSZXNwb25zZSwgcHVibGlzaFJlc3BvbnNlIH07XG4gIH1cbiAgc2hvd0xvYWRlcihzaG93LCB1cGRhdGUpIHtcbiAgICBpZiAodXBkYXRlKSB7XG4gICAgICB0aGlzLnVwZGF0ZUxvYWRlcih1cGRhdGUubG9hZGVyVHlwZSwgdXBkYXRlLmxvYWRlck1lc3NhZ2UpO1xuICAgIH1cbiAgICBpZiAoc2hvdykge1xuICAgICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdChmYWxzZSk7XG4gICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkLmVtaXQodHJ1ZSk7XG4gICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICB9XG4gIH1cbiAgdXBkYXRlTG9hZGVyKGxvYWRlclR5cGUsIGxvYWRlck1lc3NhZ2UpIHtcbiAgICB0aGlzLmxvYWRlclR5cGUgPSBsb2FkZXJUeXBlO1xuICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IGxvYWRlck1lc3NhZ2U7XG4gIH1cbiAgcGFyc2VFcnJvcigpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZjtcbiAgICBjb25zdCB7IGkxOG4sIGVycm9yIH0gPSB0aGlzO1xuICAgIGlmICh0eXBlb2YgZXJyb3IgIT09IFwic3RyaW5nXCIgJiYgaXNBcHBDb21wb25lbnRFcnJvcihlcnJvcikpIHtcbiAgICAgIGNvbnN0IGNvZGUgPSBlcnJvci5jb2RlO1xuICAgICAgbGV0IGxpbmtJbmZvO1xuICAgICAgaWYgKGNvZGUgPT09IFwiaXRlbUV4aXN0c1wiIHx8IGNvZGUgPT09IFwiZmlsZUV4aXN0c1wiKSB7XG4gICAgICAgIGxpbmtJbmZvID0ge1xuICAgICAgICAgIGxpbms6IGVycm9yLml0ZW1VcmwsXG4gICAgICAgICAgdGV4dDogaTE4bi5hbHJlYWR5RXhpc3RzLmxpbmtUZXh0XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBsZXQgdGl0bGUgPSBpMThuLmVycm9yVGl0bGU7XG4gICAgICBsZXQgZGVzY3JpcHRpb24gPSBlcnJvci50cmFuc2xhdGVkTWVzc2FnZTtcbiAgICAgIGlmICghZGVzY3JpcHRpb24gJiYgY29kZSA9PT0gXCJmaWxlRXhpc3RzXCIpIHtcbiAgICAgICAgdGl0bGUgPSBpMThuLmFscmVhZHlFeGlzdHMudGl0bGU7XG4gICAgICAgIGRlc2NyaXB0aW9uID0gcmVwbGFjZUkxOE5TdHJpbmcoaTE4bi5hbHJlYWR5RXhpc3RzLmRlc2NyaXB0aW9uLCB0aGlzLmZpbGVOYW1lLCBcImZpbGVOYW1lXCIpO1xuICAgICAgfVxuICAgICAgaWYgKGNvZGUgPT09IFwiZmFpbFRvUHVibGlzaEZyb21EYXRhU3RvcmVcIikge1xuICAgICAgICBjb25zdCB7IG5ld0l0ZW1Nb2RlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGNvbnN0IGJhc2VJMThuID0gaTE4bi5mYWlsRGF0YXN0b3JlUHVibGlzaDtcbiAgICAgICAgdGl0bGUgPSBiYXNlSTE4bi50aXRsZTtcbiAgICAgICAgZGVzY3JpcHRpb24gPSByZXBsYWNlSTE4TlN0cmluZyhiYXNlSTE4bi5kZXNjcmlwdGlvbiwgbmV3SXRlbU1vZGUgPT09IFwic2NlbmVMYXllclwiIHx8IG5ld0l0ZW1Nb2RlID09PSBcInRpbGVMYXllclwiID8gYmFzZUkxOG5bbmV3SXRlbU1vZGVdIDogXCJcIiwgXCJmaWxlVHlwZVwiKTtcbiAgICAgIH1cbiAgICAgIGlmIChjb2RlID09PSBcInNlcnZpY2VOYW1lRXhpc3RzXCIpIHtcbiAgICAgICAgKHsgdGl0bGUsIGRlc2NyaXB0aW9uIH0gPSBpMThuLnNlcnZpY2VOYW1lRXhpc3RzKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHRpdGxlLCBkZXNjcmlwdGlvbiwgbGlua0luZm8gfTtcbiAgICB9XG4gICAgaWYgKGlzQmFja2VuZEVycm9yKGVycm9yKSkge1xuICAgICAgY29uc3QgZXJyb3JEZXRhaWwgPSBlcnJvci5kZXRhaWxzWzBdO1xuICAgICAgaWYgKGVycm9yRGV0YWlsID09PSBudWxsIHx8IGVycm9yRGV0YWlsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvckRldGFpbC5pbmNsdWRlcyhcIm11c3QgYmUgdXBsb2FkZWQgZGlyZWN0bHkgdG8gYW4gQXJjR0lTIFNlcnZlciBzaXRlXCIpKSB7XG4gICAgICAgIGNvbnN0IGVycm9ySW5mbyA9IGkxOG4uYXJjZ2lzU2VydmVyVXBsb2FkO1xuICAgICAgICByZXR1cm4geyB0aXRsZTogZXJyb3JJbmZvLnRpdGxlLCBkZXNjcmlwdGlvbjogZXJyb3JJbmZvLmRlc2NyaXB0aW9uIH07XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChlcnJvckRldGFpbC5pbmNsdWRlcyhcInNwYXRpYWwgcmVmZXJlbmNlIG11c3QgYmUgZWl0aGVyIGEgZ2VvZ3JhcGhpYyBvciBwcm9qZWN0ZWQgY29vcmRpbmF0ZSBzeXN0ZW1cIikpIHtcbiAgICAgICAgY29uc3QgZXJyb3JJbmZvID0gaTE4bi5pbnZhbGlkU3BhdGlhbFJlZjtcbiAgICAgICAgcmV0dXJuIHsgdGl0bGU6IGVycm9ySW5mby50aXRsZSwgZGVzY3JpcHRpb246IGVycm9ySW5mby5kZXNjcmlwdGlvbiB9O1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSAodHlwZW9mIGVycm9yID09PSBcInN0cmluZ1wiID8gZXJyb3IgOiBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IubWVzc2FnZSkgfHxcbiAgICAgIChlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3Iuc3RhdHVzTWVzc2FnZSkgfHxcbiAgICAgIGkxOG4uZXJyb3JEZXNjcmlwdGlvbjtcbiAgICBpZiAoIWVycm9yTWVzc2FnZSkge1xuICAgICAgcmV0dXJuIHsgdGl0bGU6IGkxOG4uZXJyb3JUaXRsZSwgZGVzY3JpcHRpb246IGkxOG4uZXJyb3JEZXNjcmlwdGlvbiB9O1xuICAgIH1cbiAgICBjb25zdCB7IGZpbGVOYW1lLCBmaWxlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgY29uc3QgbG93ZXJjYXNlRXJyb3JNZXNzYWdlID0gZXJyb3JNZXNzYWdlLnRvTG93ZXJDYXNlKCk7XG4gICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICBjYXNlIChfYSA9IGxvd2VyY2FzZUVycm9yTWVzc2FnZS5pbmNsdWRlcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNhbGwobG93ZXJjYXNlRXJyb3JNZXNzYWdlLCBcImFscmVhZHkgZXhpc3RzXCIpOlxuICAgICAgICBpZiAobG93ZXJjYXNlRXJyb3JNZXNzYWdlLmluY2x1ZGVzKFwiZmlsZVwiKSB8fCBsb3dlcmNhc2VFcnJvck1lc3NhZ2UuaW5jbHVkZXMoXCJpdGVtXCIpKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRpdGxlOiBpMThuLmFscmVhZHlFeGlzdHMudGl0bGUsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogaTE4bi5hbHJlYWR5RXhpc3RzLmRlc2NyaXB0aW9uLnJlcGxhY2UoXCIke2ZpbGVOYW1lfVwiLCBmaWxlTmFtZSB8fCAoZmlsZSA9PT0gbnVsbCB8fCBmaWxlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWxlLm5hbWUpKVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVycm9yTWVzc2FnZS5pbmNsdWRlcyhcIlNlcnZpY2UgbmFtZVwiKSkge1xuICAgICAgICAgIHJldHVybiBpMThuLnNlcnZpY2VOYW1lRXhpc3RzO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAoX2IgPSBlcnJvck1lc3NhZ2UuaW5jbHVkZXMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jYWxsKGVycm9yTWVzc2FnZSwgXCJHZW9Kc29uIGRvZXNuJ3QgaGF2ZSAndHlwZSdcIik6XG4gICAgICAgIHJldHVybiBpMThuLmludmFsaWRHZW9KU09OO1xuICAgICAgY2FzZSAoX2MgPSBlcnJvck1lc3NhZ2UuaW5jbHVkZXMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5jYWxsKGVycm9yTWVzc2FnZSwgXCJHZW9Kc29uIGZpbGUgaXMgbm90IGEgdmFsaWQganNvblwiKTpcbiAgICAgICAgcmV0dXJuIGkxOG4uaW52YWxpZEpTT047XG4gICAgICBjYXNlIChfZCA9IGVycm9yTWVzc2FnZS5pbmNsdWRlcykgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmNhbGwoZXJyb3JNZXNzYWdlLCBcIkludmFsaWQgU2hhcGVmaWxlXCIpOlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRpdGxlOiBpMThuLmludmFsaWRTaGFwZWZpbGUudGl0bGUsXG4gICAgICAgICAgZGVzY3JpcHRpb246IGkxOG4uaW52YWxpZFNoYXBlZmlsZS5kZXNjcmlwdGlvblxuICAgICAgICB9O1xuICAgICAgY2FzZSAoX2UgPSBlcnJvck1lc3NhZ2UuaW5jbHVkZXMpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5jYWxsKGVycm9yTWVzc2FnZSwgXCJJbnZhbGlkIEZpbGUgR2VvZGF0YWJhc2VcIik6XG4gICAgICAgIHJldHVybiBpMThuLmludmFsaWRHZW9kYXRhYmFzZTtcbiAgICAgIGNhc2UgKF9mID0gZXJyb3JNZXNzYWdlLmluY2x1ZGVzKSA9PT0gbnVsbCB8fCBfZiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2YuY2FsbChlcnJvck1lc3NhZ2UsIFwiZXJyb3IgcHVibGlzaGluZ1wiKTpcbiAgICAgICAgcmV0dXJuIHsgdGl0bGU6IGkxOG4uZXJyb3JUaXRsZSwgZGVzY3JpcHRpb246IGkxOG4uZXJyb3JQdWJsaXNoaW5nIH07XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICB0aXRsZTogaTE4bi5lcnJvclRpdGxlLFxuICAgICAgZGVzY3JpcHRpb246IGkxOG4uZXJyb3JEZXNjcmlwdGlvblxuICAgIH07XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgZGVzY3JpcHRpb25JbmZvLCBsb2FkaW5nIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgdGl0bGUsIGRlc2NyaXB0aW9uLCBsaW5rSW5mbyB9ID0gdGhpcy5wYXJzZUVycm9yKCk7XG4gICAgY29uc3QgeyBuZXdJdGVtTW9kZSwgdHlwZSwgZW5hYmxlUHVibGlzaGluZyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIGNvbnN0IHsgdXNlciB9ID0gY29uZmlnU3RhdGU7XG4gICAgY29uc3QgaXNQdWJsaXNoZWRTZXJ2aWNlRGVmaW5pdGlvbiA9IHR5cGUgPT09IFwiU2VydmljZSBEZWZpbml0aW9uXCIgJiYgZW5hYmxlUHVibGlzaGluZztcbiAgICBjb25zdCBtdkZsb3cgPSB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCI7XG4gICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IHsgXCJvdmVyZmxvdy1oaWRkZW5cIjogbG9hZGluZyB9IH0sIG12RmxvdyAmJiBuZXdJdGVtTW9kZSA9PT0gXCJ1cmxcIiAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImluZm8tY29udGFpbmVyXCIgfSwgaChcImFyY2dpcy1uZXctaXRlbS1pbnB1dC1yZWFkb25seVwiLCBudWxsKSkpLCBkZXNjcmlwdGlvbkluZm8gJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJpbmZvLWNvbnRhaW5lclwiIH0sIGgoXCJhcmNnaXMtbmV3LWl0ZW0tZGVzY3JpcHRpb25cIiwgeyBjbGFzczogXCJsYXllci1kZXNjcmlwdGlvblwiLCBoZWFkZXI6IGRlc2NyaXB0aW9uSW5mby50aXRsZSwgY29udGVudDogZGVzY3JpcHRpb25JbmZvLmNvbnRlbnQsIHNjYWxlOiBcInNcIiwgY29udGVudFNjYWxlOiBcIm1cIiB9KSkpLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWxvYWRlclwiLCB7IHR5cGU6IHRoaXMubG9hZGVyVHlwZSwgdmFsdWU6IGFkZEl0ZW1TdGF0ZS51cGxvYWRQcm9ncmVzcywgYWN0aXZlOiB0aGlzLmxvYWRpbmcsIHRleHQ6IHRoaXMubG9hZGVyTWVzc2FnZSB9KSwgW1wiZmlsZVwiLCBcInVybFwiLCBcImRhdGFTdG9yZVwiXS5pbmNsdWRlcyhuZXdJdGVtTW9kZSkgJiYgIW12RmxvdyAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImluZm8tY29udGFpbmVyXCIgfSwgaChcImFyY2dpcy1uZXctaXRlbS1pbnB1dC1yZWFkb25seVwiLCBudWxsKSkpLCB0eXBlID09PSBcIkdlb2NvZGluZyBTZXJ2aWNlXCIgJiYgKGgoXCJkaXZcIiwgbnVsbCwgaChcImg1XCIsIHsgY2xhc3M6IFwibG9jYXRvcl9faGVhZGluZ1wiIH0sIHRoaXMuaTE4bi5pdGVtKSwgaChcInBcIiwgeyBjbGFzczogXCJsb2NhdG9yX19kZXNjcmlwdGlvblwiIH0sIHVpU3RvcmVTdGF0ZS5pMThuLmNyZWF0ZUxheWVyc0xpc3RbbmV3SXRlbU1vZGUgPT09IFwidXJsXCIgPyBcImxvY2F0b3JIZWFkaW5nXCIgOiBcImxvY2F0b3JWaWV3SGVhZGluZ1wiXSkpKSwgaChcImFyY2dpcy1pdGVtLXByb3BlcnRpZXNcIiwgbnVsbCwgIWlzUHVibGlzaGVkU2VydmljZURlZmluaXRpb24gJiYgKGgoXCJhcmNnaXMtdGl0bGUtaW5wdXRcIiwgeyBjbGFzczogXCJtZWRpdW1cIiwgY3VycmVudEZvbGRlcjogaXRlbVByb3BlcnRpZXNTdGF0ZS5mb2xkZXIsIHR5cGU6IGFkZEl0ZW1TdGF0ZS50eXBlLCBlbmFibGVQdWJsaXNoaW5nOiBhZGRJdGVtU3RhdGUuZW5hYmxlUHVibGlzaGluZywgdXBkYXRlOiB0aGlzLnNob3VsZFVwZGF0ZVByZXZpb3VzbHlDcmVhdGVkSXRlbSgpLCByZWY6IChlbGUpID0+ICh0aGlzLnRpdGxlUmVmID0gZWxlKSwgb25BcmNnaXNUaXRsZUlucHV0Q2hhbmdlOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuZXJyb3IgPSBudWxsO1xuICAgICAgfSB9KSksIGgoXCJhcmNnaXMtZm9sZGVyLXBpY2tlclwiLCB7IGNsYXNzOiBcIm1lZGl1bVwiLCByZWY6IChlbGUpID0+ICh0aGlzLml0ZW1Qcm9wZXJ0aWVzRm9sZGVyUmVmID0gZWxlKSwgb25BcmNnaXNGb2xkZXJQaWNrZXJMb2FkOiAoeyBkZXRhaWwgfSkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IGFkZEl0ZW1TdGF0ZS5pbml0aWFsRm9sZGVycykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGFkZEl0ZW1TdGF0ZS5pbml0aWFsRm9sZGVycyA9IGRldGFpbCk7XG4gICAgICB9IH0pLCAhaXNQdWJsaWNVc2VyKHVzZXIpICYmIGgoXCJhcmNnaXMtY2F0ZWdvcmllcy1waWNrZXJcIiwgeyBjbGFzczogXCJtZWRpdW1cIiB9KSwgaChcImFyY2dpcy10YWdzLXBpY2tlclwiLCB7IGNsYXNzOiBcIm1lZGl1bVwiIH0pLCBoKFwiYXJjZ2lzLXN1bW1hcnktaW5wdXRcIiwgeyBjbGFzczogXCJtZWRpdW1cIiwgcmVmOiAoZWxlKSA9PiAodGhpcy5zdW1tYXJ5UmVmID0gZWxlKSB9KSwgdHlwZSA9PT0gXCJOb3RlYm9va1wiICYmIGgoXCJhcmNnaXMtbm90ZWJvb2stcnVudGltZS1zZWxlY3RcIiwgeyBjbGFzczogXCJtZWRpdW1cIiB9KSksIGgoXCJhcmNnaXMtbmV3LWl0ZW0tYWxlcnRcIiwgeyBoZWFkaW5nOiB0aXRsZSwgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLCBhY3RpdmU6ICEhdGhpcy5lcnJvciwgbGluazogeyBocmVmOiBsaW5rSW5mbyA9PT0gbnVsbCB8fCBsaW5rSW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGlua0luZm8ubGluaywgdGl0bGU6IGxpbmtJbmZvID09PSBudWxsIHx8IGxpbmtJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsaW5rSW5mby50ZXh0IH0sIG9uQWxlcnREaXNtaXNzOiAoKSA9PiAodGhpcy5lcnJvciA9IG51bGwpIH0pKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgIFwiZXJyb3JcIjogW1wiaGFuZGxlRXJyb3JcIl1cbiAgfTsgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc0l0ZW1Qcm9wZXJ0aWVzLnN0eWxlID0gYXJjZ2lzTmV3SXRlbVBhZ2VzSXRlbVByb3BlcnRpZXNDc3M7XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1QYWdlc1B1Ymxpc2hTZWxlY3RDc3MgPSBcIi5sYWJlbHtmb250LXdlaWdodDo1MDA7Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0xKTttYXJnaW4tYm90dG9tOjFyZW07cGFkZGluZy10b3A6MXJlbTtkaXNwbGF5OmJsb2NrO2xpbmUtaGVpZ2h0OjE4cHh9LmxhYmVsLS1sZWFkZXJ7bWFyZ2luLXRvcDowLjc1cmVtO21hcmdpbi1ib3R0b206MC41cmVtO2ZvbnQtd2VpZ2h0OjQwMH0uZmllbGRzZXR7bWFyZ2luOjA7cGFkZGluZzowO2JvcmRlci1zdHlsZTpub25lfS5jb25zdHJhaW57bWF4LXdpZHRoOjM2MHB4fS5ub3RpY2UtLXRpcHttYXJnaW4tdG9wOjEuNXJlbX1cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbVBhZ2VzUHVibGlzaFNlbGVjdCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVVwZGF0ZVBhZ2VcIiwgNyk7XG4gICAgdGhpcy5uZXdJdGVtUHJldlBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1QcmV2UGFnZVwiLCA3KTtcbiAgICB0aGlzLm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkXCIsIDcpO1xuICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwid29ya2Zsb3dDb21wbGV0ZVwiLCA3KTtcbiAgICB0aGlzLmNhblNraXBQdWJsaXNoU2VsZWN0ID0gZmFsc2U7XG4gICAgdGhpcy51cGRhdGVTZWxlY3RlZFNoZWV0ID0gYXN5bmMgKHsgY3VycmVudFRhcmdldCB9KSA9PiB7XG4gICAgICAvLyBUT0RPOiBjYWxjaXRlLXNlbGVjdCBjdXJyZW50bHkgc2V0cyBzZWxlY3RlZE9wdGlvbiB0byB0aGUgaW5uZXJIVE1MIG9mIHRoZSBmaXJzdCBlbGVtZW50IGluc3RlYWQgb2YgaXRzIHZhbHVlXG4gICAgICBjb25zdCBzZWxlY3RlZCA9IHBhcnNlSW50KGN1cnJlbnRUYXJnZXQuc2VsZWN0ZWRPcHRpb24udmFsdWUpO1xuICAgICAgYWRkSXRlbVN0YXRlLnNlbGVjdGVkU2hlZXQgPSBpc05hTihzZWxlY3RlZCkgPyAwIDogc2VsZWN0ZWQ7XG4gICAgICB0aGlzLm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZC5lbWl0KGZhbHNlKTtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZEZpZWxkcyA9IG51bGw7XG4gICAgICBhZGRJdGVtU3RhdGUuYW5hbHl6ZVJlc3VsdHMgPSBudWxsO1xuICAgICAgYWRkSXRlbVN0YXRlLmJhY2t1cExheWVyRmllbGRzID0gbnVsbDtcbiAgICAgIC8vIEZvciBjbG91ZCwgd2UgYWxzbyB1cGxvYWQgdGhlIGZpbGUgYWxyZWFkeSBhdCB0aGUgYmVnaW5uaW5nXG4gICAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgdGhpcy5hbmFseXplKGFkZEl0ZW1TdGF0ZS5leGlzdGluZ0l0ZW0gfHwgYWRkSXRlbVN0YXRlLmNsb3VkUHJvdmlkZXJSZXNvdXJjZSA/IFwiaXRlbVwiIDogXCJmaWxlXCIpO1xuICAgICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICAgIC8vIFRPRE86IHNob3VsZCB3ZSByZXZlcnQgdGhlIGNoYW5nZT9cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdCh0cnVlKTtcbiAgICB9O1xuICAgIHRoaXMuZGVsZXRlQ3VySXRlbSA9IGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmIChhZGRJdGVtU3RhdGUuaWQpIHtcbiAgICAgICAgICB0aGlzLmlzRGVsZXRpbmdPbGRGaWxlID0gdHJ1ZTtcbiAgICAgICAgICBhd2FpdCBkZWxldGVJdGVtKGFkZEl0ZW1TdGF0ZS5pZCwgeyBwZXJtYW5lbnREZWxldGU6IHRydWUgfSk7XG4gICAgICAgICAgYWRkSXRlbVN0YXRlLmlkID0gbnVsbDtcbiAgICAgICAgICB0aGlzLmlzRGVsZXRpbmdPbGRGaWxlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJEZWxldGUgaXRlbSBmYWlsZWRcIiwgZXJyb3IpO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5zZWxlY3RlZCA9IFwiaG9zdGVkXCI7XG4gICAgdGhpcy5sb2FkaW5nID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaXNEZWxldGluZ09sZEZpbGUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sb2FkZXJUeXBlID0gXCJpbmRldGVybWluYXRlXCI7XG4gICAgdGhpcy5hbGVydENvbnRlbnQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy50aXAgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sb2FkZXJNZXNzYWdlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucHVibGlzaFNlbGVjdE9wdGlvbiA9IG51bGw7XG4gICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaXRlbUluZm9JMThOID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZHVwbGljYXRlSXRlbVVybCA9IG51bGw7XG4gIH1cbiAgYXN5bmMgaGFuZGxlTmV4dCgpIHtcbiAgICBpZiAoYWRkSXRlbVN0YXRlLnRpbGVMYXllclB1Ymxpc2hUeXBlID09PSBcIjNkVGlsZXNcIikge1xuICAgICAgYWRkSXRlbVN0YXRlLnRpbGVzTGF5ZXIzZFRpbGVzTGF5ZXJUeXBlID0gdGhpcy5wdWJsaXNoU2VsZWN0T3B0aW9uLnRpbGVzTGF5ZXIzZFRpbGVzTGF5ZXJUeXBlO1xuICAgIH1cbiAgICBjb25zdCB7IGN1c3RvbVBhcmFtZXRlcnMsIHVybCwgdHlwZSwgbmV3SXRlbU1vZGUsIGZpbGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBjb25zdCBpc0hvc3RlZCA9IHRoaXMuc2VsZWN0ZWQgPT09IFwiaG9zdGVkXCI7XG4gICAgY29uc3QgbXZGbG93ID0gdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiO1xuICAgIGFkZEl0ZW1TdGF0ZS5lbmFibGVQdWJsaXNoaW5nID0gaXNIb3N0ZWQ7XG4gICAgaWYgKHRoaXMuaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpKSB7XG4gICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUuZW1pdCh7XG4gICAgICAgIHR5cGUsXG4gICAgICAgIHVybDogZW5jb2RlVVJJKHVybCksXG4gICAgICAgIGN1c3RvbVBhcmFtZXRlcnNcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAobmV3SXRlbU1vZGUgPT09IFwidXJsXCIgJiYgdHlwZSA9PT0gXCJDU1ZcIiAmJiBtdkZsb3cpIHtcbiAgICAgIC8vIFJpZ2h0IG5vdyB3ZSBvbmx5IHN1cHBvcnQgdGhpcyBmb3IgY3N2XG4gICAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgdGhpcy5hbmFseXplKFwidXJsXCIpO1xuICAgICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBpZiAodGhpcy5kdXBsaWNhdGVJdGVtVXJsICYmIGlzSG9zdGVkKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoeyBjb2RlOiBcIml0ZW1FeGlzdHNcIiwgaXRlbVVybDogdGhpcy5kdXBsaWNhdGVJdGVtVXJsIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBzaW1wbGVIb3N0ZWRUeXBlcyA9IFtcbiAgICAgICAgXCJKc29uXCIsXG4gICAgICAgIFwiVGlsZSBQYWNrYWdlXCIsXG4gICAgICAgIFwiVmVjdG9yIFRpbGUgUGFja2FnZVwiLFxuICAgICAgICBcIlNlcnZpY2UgRGVmaW5pdGlvblwiLFxuICAgICAgICBcIlNjZW5lIFBhY2thZ2VcIixcbiAgICAgICAgXCJHZW9QYWNrYWdlXCIsXG4gICAgICAgIFwiM0RUaWxlcyBQYWNrYWdlXCIsXG4gICAgICAgIC8vIGFyY2dpcy1wb3J0YWwtYXBwIzQwOTI5IGFuZCBhcmNnaXMtcG9ydGFsLWFwcCMzODExOVxuICAgICAgICBcIkdlb0pzb25cIlxuICAgICAgXTtcbiAgICAgIGNvbnN0IHRlbGVtZXRyeSA9IGNvbmZpZ1N0YXRlLnRlbGVtZXRyeTtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgIGV2ZW50VHlwZTogXCJvdGhlclwiLFxuICAgICAgICBwYWdlTmFtZTogXCJteSBjb250ZW50XCIsXG4gICAgICAgIGNhdGVnb3J5OiBcIm5ldyBpdGVtIGFkZCBjc3YgZmlsZVwiXG4gICAgICB9O1xuICAgICAgaWYgKHNpbXBsZUhvc3RlZFR5cGVzLmluZGV4T2YodHlwZSkgPiAtMSB8fFxuICAgICAgICAvLyBXZSBzdGlsbCB3YW50IHRvIGFuYWx5emUgZXZlbiBpZiBpdCdzIGFkZCBkaXJlY3RcbiAgICAgICAgKCFpc0hvc3RlZCAmJiAhbXZGbG93KSkge1xuICAgICAgICBpZiAodHlwZSA9PT0gXCJDU1ZcIikge1xuICAgICAgICAgIC8vIExvZyB0ZWxlbWV0cnkgZm9yIG5vbi1ob3N0ZWQgY3N2XG4gICAgICAgICAgcGF5bG9hZC5kZXRhaWxzID0gXCJjc3Ygb25seVwiO1xuICAgICAgICAgIHRlbGVtZXRyeSA9PT0gbnVsbCB8fCB0ZWxlbWV0cnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbGVtZXRyeS5sb2dFdmVudChwYXlsb2FkKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJpdGVtUHJvcGVydGllc1wiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGUgPT09IFwiQ1NWXCIpIHtcbiAgICAgICAgY29uc3Qgc3VjY2VzcyA9IGF3YWl0IHRoaXMuYW5hbHl6ZSghIWFkZEl0ZW1TdGF0ZS5jbG91ZFByb3ZpZGVyUmVzb3VyY2UgPyBcImNsb3VkXCIgOiBmaWxlID8gXCJmaWxlXCIgOiBcInVybFwiKTtcbiAgICAgICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBPbiBzdWNjZXNzZnVsIHVwbG9hZCwgbG9nIGhvc3RlZCBjc3YgdGVsZW1ldHJ5XG4gICAgICBwYXlsb2FkLmRldGFpbHMgPSBcImNzdiBhbmQgaG9zdGVkIGZlYXR1cmUgbGF5ZXJcIjtcbiAgICAgIHRlbGVtZXRyeSA9PT0gbnVsbCB8fCB0ZWxlbWV0cnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbGVtZXRyeS5sb2dFdmVudChwYXlsb2FkKTtcbiAgICB9XG4gICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiZmlsZUZpZWxkXCIpO1xuICB9XG4gIGFzeW5jIGhhbmRsZVByZXYoZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGF3YWl0IHRoaXMuZGVsZXRlQ3VySXRlbSgpO1xuICAgIGNvbnN0IHsgdHlwZSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIGlmICh0eXBlID09PSBcIkNTVlwiIHx8IHR5cGUgPT09IFwiTWljcm9zb2Z0IEV4Y2VsXCIpIHtcbiAgICAgIC8vIEluIGNhc2UgdGhlIHVzZXIgZ29lcyBiYWNrIHRvIHRoZSBmaWxlIHNlbGVjdCBwYWdlXG4gICAgICAvLyAgYW5kIHNlbGVjdCBhIGRpZmZlcmVudCBmaWxlXG4gICAgICBhZGRJdGVtU3RhdGUuc2VsZWN0ZWRGaWVsZHMgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHRoaXMubmV3SXRlbVByZXZQYWdlLmVtaXQoKTtcbiAgfVxuICBkZXRlcm1pbmVIaW50KGZpbGUpIHtcbiAgICBpZiAoIWlzTGFyZ2VHZW9KU09OKGZpbGUuc2l6ZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgeyBpMThuIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgdXNlciwgcG9ydGFsIH0gPSBjb25maWdTdGF0ZTtcbiAgICBjb25zdCBsaW5rVGV4dCA9IHVpU3RvcmVTdGF0ZS5pMThuLmNvbW1vbi5sZWFybk1vcmU7XG4gICAgbGV0IHRpdGxlO1xuICAgIGxldCBsaW5rOyAvLyBUT0RPOiBzZXQgbGluayB1cmwgb25jZSB3ZSBoYXZlIHRoZSBoZWxwIGlkXG4gICAgbGV0IGNvbG9yID0gXCJicmFuZFwiO1xuICAgIGlmICghdXNlciB8fCBpc1B1YmxpY1VzZXIodXNlcikpIHtcbiAgICAgIHRpdGxlID0gaTE4bi5iaWdHZW9Kc29uSGludFB1YmxpY0FjY291bnQ7XG4gICAgICBjb2xvciA9IFwiZGFuZ2VyXCI7XG4gICAgfVxuICAgIGVsc2UgaWYgKCFjYW5QdWJsaXNoVHlwZSh1c2VyLCBcIkdlb0pzb25cIiwgcG9ydGFsKSkge1xuICAgICAgdGl0bGUgPSBpMThuLmJpZ0dlb0pzb25IaW50Tm9Qcml2aWxlZ2U7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGl0bGUgPSBpMThuLmJpZ0dlb0pzb25IaW50O1xuICAgIH1cbiAgICB0aGlzLmFsZXJ0Q29udGVudCA9IHsgdGl0bGUsIGxpbmtUZXh0LCBsaW5rLCBjb2xvciB9O1xuICB9XG4gIHNob3VsZERpc2FibGVOb25Ib3N0ZWQoKSB7XG4gICAgY29uc3QgeyBmaWxlLCB0eXBlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgcmV0dXJuICh1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCIgJiYgdHlwZSA9PT0gXCJHZW9Kc29uXCIgJiYgZmlsZSAmJiBpc0xhcmdlR2VvSlNPTihmaWxlLnNpemUpKTtcbiAgfVxuICB1cGRhdGVMb2FkZXIobG9hZGVyVHlwZSwgbG9hZGVyTWVzc2FnZSkge1xuICAgIHRoaXMubG9hZGVyVHlwZSA9IGxvYWRlclR5cGU7XG4gICAgdGhpcy5sb2FkZXJNZXNzYWdlID0gbG9hZGVyTWVzc2FnZTtcbiAgfVxuICBhc3luYyBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICB0aGlzLmkxOG4gPSB1aVN0b3JlU3RhdGUuaTE4bi5wdWJsaXNoU2VsZWN0O1xuICAgIHRoaXMuaXRlbUluZm9JMThOID0gdWlTdG9yZVN0YXRlLmkxOG4uaXRlbVR5cGVJbmZvO1xuICAgIGNvbnN0IHsgdHlwZSwgaWQsIGV4aXN0aW5nSXRlbSwgbmV3SXRlbU1vZGUsIGNsb3VkUHJvdmlkZXJSZXNvdXJjZSwgZmlsZSwgdGlsZUxheWVyUHVibGlzaFR5cGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBjb25zdCB7IHVzZXIsIHBvcnRhbCwgY29uZmlnOiB7IGhlbHBNYXAsIGhlbHBCYXNlIH0gfSA9IGNvbmZpZ1N0YXRlO1xuICAgIGlmICh1c2VyKSB7XG4gICAgICBjb25zdCB7IGVycm9yOiBiYWNrZWRCeVNEU0Vycm9yLCByZXN1bHQ6IF9pc1BvcnRhbEJhY2tlZEJ5U0RTIH0gPSBhd2FpdCBmcm9tQ2FjaGUoKCkgPT4gaXNQb3J0YWxCYWNrZWRCeVNEUyhwb3J0YWwsIHVzZXIpLCBcImlzUG9ydGFsQmFja2VkQnlTRFNcIiwgcG9ydGFsLmlkKTtcbiAgICAgIGlmICghYmFja2VkQnlTRFNFcnJvcikge1xuICAgICAgICBjb25maWdTdGF0ZS5wb3J0YWwuaXNCYWNrZWRCeVNEUyA9IF9pc1BvcnRhbEJhY2tlZEJ5U0RTO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBtdkZsb3cgPSB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCI7XG4gICAgY29uc3QgaXNFeGNlbCA9IHR5cGUgPT09IFwiTWljcm9zb2Z0IEV4Y2VsXCI7XG4gICAgaWYgKGV4aXN0aW5nSXRlbSkge1xuICAgICAgY29uc3Qgc3VjY2VzcyA9IGF3YWl0IHRoaXMuYW5hbHl6ZShcIml0ZW1cIik7XG4gICAgICBpZiAoIXN1Y2Nlc3MpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGUgPT09IFwiQ1NWXCIgfHxcbiAgICAgICAgKGlzRXhjZWwgJiYgKChfYSA9IGFkZEl0ZW1TdGF0ZS5hbmFseXplUmVzdWx0cy5wdWJsaXNoUGFyYW1ldGVycy5sYXllcnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpID09PSAxKSkge1xuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJmaWxlRmllbGRcIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gQW5hbHl6ZSB0byBnZXQgRXhjZWwgc2hlZXQgaW5mb1xuICAgIGlmIChpc0V4Y2VsICYmICFpc1B1YmxpY1VzZXIodXNlcikgJiYgIWV4aXN0aW5nSXRlbSkge1xuICAgICAgaWYgKCFpZCkge1xuICAgICAgICBhZGRJdGVtU3RhdGUuc2VsZWN0ZWRTaGVldCA9IDA7XG4gICAgICAgIGF3YWl0IHRoaXMuYW5hbHl6ZShjbG91ZFByb3ZpZGVyUmVzb3VyY2UgPyBcImNsb3VkXCIgOiBcImZpbGVcIik7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgYXdhaXQgdGhpcy5hbmFseXplKFwiaXRlbVwiKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKG12Rmxvdykge1xuICAgICAgdGhpcy5zZWxlY3RlZCA9XG4gICAgICAgIChuZXdJdGVtTW9kZSA9PT0gXCJ1cmxcIiB8fCAhY2FuUHVibGlzaFR5cGUodXNlciwgdHlwZSwgcG9ydGFsKSkgJiZcbiAgICAgICAgICAhdGhpcy5zaG91bGREaXNhYmxlTm9uSG9zdGVkKClcbiAgICAgICAgICA/IFwibm9uLWhvc3RlZFwiXG4gICAgICAgICAgOiBcImhvc3RlZFwiO1xuICAgICAgaWYgKHRoaXMuaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpKSB7XG4gICAgICAgIHVpU3RvcmVTdGF0ZS5uZXh0VGV4dCA9IFwiYWRkVG9NYXBcIjtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gQWRkIHRvIE1WOiBNYW5hZ2UgdXBsb2FkIGhlcmUgd2hlbiBhZGRpbmcgZmlsZSBkaXJlY3RseVxuICAgIHRoaXMuY2FuU2tpcFB1Ymxpc2hTZWxlY3QgPSBjYW5Ta2lwUHVibGlzaFNlbGVjdFRvTmV4dFBhZ2Uoe1xuICAgICAgZGlyZWN0TW9kZTogbXZGbG93LFxuICAgICAgaXNNdWx0aXBhZ2VFeGNlbDogaXNFeGNlbCAmJiAoKF9iID0gYWRkSXRlbVN0YXRlLmV4Y2VsTGF5ZXJzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoKSA+IDEsXG4gICAgICBuZXdJdGVtTW9kZSxcbiAgICAgIGNsb3VkOiAhIWNsb3VkUHJvdmlkZXJSZXNvdXJjZSxcbiAgICAgIGZyb21FeGlzdGluZ0l0ZW06ICEhZXhpc3RpbmdJdGVtLFxuICAgICAgaXRlbVR5cGU6IHR5cGUsXG4gICAgICBjYW5QdWJsaXNoSXRlbVR5cGU6IGNhblB1Ymxpc2hUeXBlKHVzZXIsIHR5cGUsIHBvcnRhbClcbiAgICB9KTtcbiAgICBpZiAodGhpcy5jYW5Ta2lwUHVibGlzaFNlbGVjdCkge1xuICAgICAgaWYgKG5ld0l0ZW1Nb2RlID09PSBcInVybFwiKSB7XG4gICAgICAgIC8vIE9ubHkgYWRkaW5nIGZyb20gVVJMIGNhbiBiZSBhZGRlZCBkaXJlY3RseVxuICAgICAgICAvLyAgc2luY2UgZnJvbS1maWxlIGZsb3dzIHJlbGllcyBvbiB0aGUgcHVibGlzaGVkIGl0ZW0gaWRcbiAgICAgICAgdGhpcy5zZWxlY3RlZCA9IFwibm9uLWhvc3RlZFwiO1xuICAgICAgfVxuICAgICAgdGhpcy5oYW5kbGVOZXh0KCk7XG4gICAgfVxuICAgIGlmICghaXNIb3N0ZWRQb3J0YWwocG9ydGFsKSB8fCAhdXNlcikge1xuICAgICAgdGhpcy5zZWxlY3RlZCA9IFwibm9uLWhvc3RlZFwiO1xuICAgIH1cbiAgICBpZiAodHlwZSA9PT0gXCJTY2VuZSBQYWNrYWdlXCIgJiYgIWNhblB1Ymxpc2hTY2VuZXModXNlcikpIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWQgPSBcIm5vbi1ob3N0ZWRcIjtcbiAgICAgIHRoaXMuaGFuZGxlTmV4dCgpO1xuICAgIH1cbiAgICBpZiAodHlwZSA9PT0gXCJHZW9Kc29uXCIgJiYgdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiKSB7XG4gICAgICBpZiAoISFmaWxlKSB7XG4gICAgICAgIHRoaXMuZGV0ZXJtaW5lSGludChmaWxlKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKCEhYWRkSXRlbVN0YXRlLnVybCkge1xuICAgICAgICB0aGlzLnRpcCA9IHtcbiAgICAgICAgICB0aXRsZTogdGhpcy5pMThuLmxhcmdlR2VvSnNvbkNvbmRpdGlvbkRlc2NyaXB0aW9uLFxuICAgICAgICAgIGxpbmtUZXh0OiB1aVN0b3JlU3RhdGUuaTE4bi5jb21tb24ubGVhcm5Nb3JlLFxuICAgICAgICAgIGxpbms6IGAke2hlbHBCYXNlfSR7aGVscE1hcFtcIjEyMDAwMzkyM1wiXX1gXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0aWxlTGF5ZXJQdWJsaXNoVHlwZSA9PT0gXCIzZFRpbGVzXCIpIHtcbiAgICAgIHRoaXMucHVibGlzaFNlbGVjdE9wdGlvbiA9IHtcbiAgICAgICAgdGlsZUxheWVyUHVibGlzaFR5cGUsXG4gICAgICAgIHRpbGVzTGF5ZXIzZFRpbGVzTGF5ZXJUeXBlOiAoX2MgPSBhZGRJdGVtU3RhdGUudGlsZXNMYXllcjNkVGlsZXNMYXllclR5cGUpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IERFRkFVTFRfVElMRV9MQVlFUl8zRF9USUxFU19MQVlFUl9UWVBFXG4gICAgICB9O1xuICAgIH1cbiAgfVxuICBpc0FkZFRvTWFwVGVybWluYWxQYWdlKCkge1xuICAgIGNvbnN0IHsgc2VsZWN0ZWQgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBuZXdJdGVtTW9kZSwgdHlwZSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIHJldHVybiAodWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiICYmXG4gICAgICBuZXdJdGVtTW9kZSA9PT0gXCJ1cmxcIiAmJlxuICAgICAgdHlwZSA9PT0gXCJHZW9Kc29uXCIgJiZcbiAgICAgIHNlbGVjdGVkID09PSBcIm5vbi1ob3N0ZWRcIik7XG4gIH1cbiAgYXN5bmMgYW5hbHl6ZShhbmFseXplVHlwZSwgZm9yY2VDcmVhdGVJdGVtID0gZmFsc2UpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyBmaWxlTmFtZSwgZmlsZSwgdXJsLCBkYXRhVXJsLCBpZDogaXRlbWlkLCBleHRlbnNpb24sIHR5cGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBjb25zdCB7IHBvcnRhbCwgdXNlciwgY29uZmlnLCBsYW5nIH0gPSBjb25maWdTdGF0ZTtcbiAgICB0aGlzLnVwZGF0ZUxvYWRlcihcImluZGV0ZXJtaW5hdGVcIiwgdGhpcy5pMThuLmFuYWx5emUucmVwbGFjZShcIiR7ZmlsZU5hbWV9XCIsIGZpbGVOYW1lLmxlbmd0aCA+IDAgPyBmaWxlTmFtZSA6IHVybCkpO1xuICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgY29uc3QgZnJvbUNsb3VkID0gYW5hbHl6ZVR5cGUgPT09IFwiY2xvdWRcIjtcbiAgICBsZXQgZXJyb3IgPSBudWxsO1xuICAgIGlmIChmcm9tQ2xvdWQgfHwgKHR5cGUgPT09IFwiQ1NWXCIgJiYgZmlsZSAmJiBpc0xhcmdlQ1NWKGZpbGUuc2l6ZSkpIHx8IGZvcmNlQ3JlYXRlSXRlbSkge1xuICAgICAgY29uc3QgZXhpc3RpbmdJdGVtVXJsID0gYXdhaXQgc2VhcmNoRm9yRXhpc3RpbmdJdGVtVXJsQnlOYW1lKGFkZEl0ZW1TdGF0ZS5maWxlTmFtZSwgKF9hID0gZmluZFBvc3NpYmxlSXRlbVR5cGVzQnlFeHRlbnNpb24oZXh0ZW5zaW9uKVswXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnR5cGUpO1xuICAgICAgaWYgKGV4aXN0aW5nSXRlbVVybCkge1xuICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHsgY29kZTogXCJpdGVtRXhpc3RzXCIsIGl0ZW1Vcmw6IGV4aXN0aW5nSXRlbVVybCB9KTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIC8vICEgVGhpcyBpcyBhIHdvcmsgYXJvdW5kIHNpbmNlIGFuYWx5emUgZG9lc24ndCB3b3JrIHdpdGggc291cmNlVXJsIGZvciBjbG91ZCBpdGVtcyB5ZXRcbiAgICAgIC8vIEFsc28gYW5hbHl6ZSB3aWxsIHRpbWVvdXQgZm9yIGJpZyBjc3YgaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWFwcC1jb21wb25lbnRzL2lzc3Vlcy8yODc1XG4gICAgICBpZiAoIWFkZEl0ZW1TdGF0ZS5pZCkge1xuICAgICAgICBjb25zdCBuZXdOYW1lID0gZ3VpZCgpO1xuICAgICAgICBpZiAoKGZpbGUgPT09IG51bGwgfHwgZmlsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlsZS5zaXplKSA+IE1VTFRJX1BBUlRfVVBMT0FEX01JTklNVU1fU0laRSkge1xuICAgICAgICAgIHRoaXMudXBkYXRlTG9hZGVyKFwiZGV0ZXJtaW5hdGVcIiwgdGhpcy5pMThuLnVwbG9hZGluZy5yZXBsYWNlKFwiJHtpdGVtfVwiLCBmaWxlTmFtZSkpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFkZFJlc3BvbnNlID0gYXdhaXQgKGZyb21DbG91ZCA/IGFkZEZpbGVGcm9tRGF0YVVybCA6IGFkZEZpbGUpKHtcbiAgICAgICAgICB0aXRsZTogbmV3TmFtZSxcbiAgICAgICAgICBmaWxlbmFtZTogbmV3TmFtZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy51cGRhdGVMb2FkZXIoXCJpbmRldGVybWluYXRlXCIsIHRoaXMuaTE4bi5hbmFseXplLnJlcGxhY2UoXCIke2ZpbGVOYW1lfVwiLCBmaWxlTmFtZS5sZW5ndGggPiAwID8gZmlsZU5hbWUgOiB1cmwpKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCBjaGVja0pvYlN0YXR1cyhhZGRSZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHsgY29kZTogXCJ1bmhhbmRsZWRFcnJvclwiIH0pO1xuICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpdGVtaWQgPSBhZGRSZXNwb25zZS5pZDtcbiAgICAgICAgKHsgZXJyb3IgfSA9IGF3YWl0IGFuYWx5emUoe1xuICAgICAgICAgIGFuYWx5emVBcmdzOiB7IHR5cGU6IFwiaXRlbVwiLCBpdGVtaWQgfSxcbiAgICAgICAgICBjb25maWdBcmdzOiB7IHBvcnRhbCwgdXNlciwgY29uZmlnLCBsYW5nIH0sXG4gICAgICAgICAgaXRlbUFyZ3M6IHsgaXRlbVR5cGU6IHR5cGUgfSxcbiAgICAgICAgICBpbml0aWFsaXplOiB0cnVlXG4gICAgICAgIH0pKTtcbiAgICAgICAgLy8gV2UgZG9uJ3QgZGVsZXRlIGluIGNhc2UgdGhlIHVzZXIgZ28gYmFjayBhbmQgZm9ydGhcbiAgICAgICAgYWRkSXRlbVN0YXRlLmlkID0gaXRlbWlkO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICh7IGVycm9yIH0gPSBhd2FpdCBhbmFseXplKHtcbiAgICAgICAgYW5hbHl6ZUFyZ3M6IGFuYWx5emVUeXBlID09PSBcInVybFwiXG4gICAgICAgICAgPyB7IHR5cGU6IFwidXJsXCIsIHNvdXJjZVVybDogdXJsICE9PSBudWxsICYmIHVybCAhPT0gdm9pZCAwID8gdXJsIDogZGF0YVVybCB9XG4gICAgICAgICAgOiBhbmFseXplVHlwZSA9PT0gXCJmaWxlXCJcbiAgICAgICAgICAgID8geyB0eXBlOiBcImZpbGVcIiwgZmlsZSB9XG4gICAgICAgICAgICA6IHsgdHlwZTogXCJpdGVtXCIsIGl0ZW1pZCB9LFxuICAgICAgICBjb25maWdBcmdzOiB7IHBvcnRhbCwgdXNlciwgY29uZmlnLCBsYW5nIH0sXG4gICAgICAgIGl0ZW1BcmdzOiB7IGl0ZW1UeXBlOiB0eXBlIH0sXG4gICAgICAgIGluaXRpYWxpemU6IHRydWVcbiAgICAgIH0pKTtcbiAgICAgIGlmICgoZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmNvZGUpID09PSBcInRpbWVvdXRcIikge1xuICAgICAgICAvLyBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtYXBwLWNvbXBvbmVudHMvaXNzdWVzLzI4NzVcbiAgICAgICAgcmV0dXJuIHRoaXMuYW5hbHl6ZShhbmFseXplVHlwZSwgdHJ1ZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgIGlmIChlcnJvcikge1xuICAgICAgdGhpcy5oYW5kbGVFcnJvcihlcnJvcik7XG4gICAgfVxuICAgIHJldHVybiAhZXJyb3I7XG4gIH1cbiAgaGFuZGxlRXJyb3IoZXJyb3IpIHtcbiAgICBjb25zdCB7IGkxOG4gfSA9IHRoaXM7XG4gICAgdGhpcy5kdXBsaWNhdGVJdGVtVXJsID0gbnVsbDtcbiAgICB0aGlzLmFsZXJ0Q29udGVudCA9IG51bGw7XG4gICAgc3dpdGNoIChlcnJvci5jb2RlKSB7XG4gICAgICBjYXNlIFwiaXRlbUV4aXN0c1wiOlxuICAgICAgICB0aGlzLmR1cGxpY2F0ZUl0ZW1VcmwgPSBlcnJvci5pdGVtVXJsO1xuICAgICAgICBjb25zdCBmaWxlTmFtZSA9IGFkZEl0ZW1TdGF0ZS5maWxlTmFtZTtcbiAgICAgICAgdGhpcy5hbGVydENvbnRlbnQgPSB7XG4gICAgICAgICAgdGl0bGU6IGkxOG4uZXJyb3IuYWxyZWFkeUV4aXN0cy50aXRsZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogaTE4bi5lcnJvci5hbHJlYWR5RXhpc3RzLmRlc2NpcHRpb24ucmVwbGFjZShcIiR7ZmlsZU5hbWV9XCIsIGZpbGVOYW1lKSxcbiAgICAgICAgICBsaW5rOiBlcnJvci5pdGVtVXJsLFxuICAgICAgICAgIGxpbmtUZXh0OiBpMThuLmVycm9yLmFscmVhZHlFeGlzdHMubGlua1RleHRcbiAgICAgICAgfTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiZW1wdHlGaWxlXCI6XG4gICAgICAgIHRoaXMuYWxlcnRDb250ZW50ID0geyB0aXRsZTogaTE4bi5lcnJvci50aXRsZSwgZGVzY3JpcHRpb246IGkxOG4uZXJyb3IuZW1wdHlGaWxlIH07XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImR1cGxpY2F0ZUZpZWxkTmFtZXNcIjpcbiAgICAgICAgdGhpcy5hbGVydENvbnRlbnQgPSBpMThuLmVycm9yLmR1cGxpY2F0ZUZpZWxkcztcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aGlzLmFsZXJ0Q29udGVudCA9IGkxOG4uZXJyb3I7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICBnZXREaXNwbGF5VHlwZSh0eXBlLCBleHRlbnNpb24pIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBsZXQgaTE4bktleSA9IHR5cGU7XG4gICAgaWYgKCgoX2EgPSBhZGRJdGVtU3RhdGUuY2xvdWRQcm92aWRlclJlc291cmNlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWltZVR5cGUpID09PSBcImdvb2dsZXNoZWV0c1wiKSB7XG4gICAgICBpMThuS2V5ID0gXCJHb29nbGUgU2hlZXRzXCI7XG4gICAgfVxuICAgIGVsc2UgaWYgKGV4dGVuc2lvbiA9PT0gXCJqc29uXCIpIHtcbiAgICAgIGkxOG5LZXkgPSBcIkpTT05cIjtcbiAgICB9XG4gICAgcmV0dXJuIChfYyA9IChfYiA9IHRoaXMuaXRlbUluZm9JMThOLmxvd2VyY2FzZURpc3BsYXlOYW1lW2kxOG5LZXldKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBpMThuS2V5KSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiBcIlwiO1xuICB9XG4gIGdldE9wdGlvblRleHQocmFkaW8sIGRpc3BsYXlOYW1lKSB7XG4gICAgY29uc3QgaXNIb3N0ZWQgPSByYWRpbyA9PT0gXCJob3N0ZWRcIjtcbiAgICBjb25zdCB7IGkxOG4sIGl0ZW1JbmZvSTE4TiB9ID0gdGhpcztcbiAgICBjb25zdCB7IGRhdGFVcmwsIGZpbGVOYW1lLCB0eXBlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgY29uc3QgbXZGbG93ID0gdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiO1xuICAgIGlmIChtdkZsb3cpIHtcbiAgICAgIHJldHVybiBpc0hvc3RlZFxuICAgICAgICA/IHsgdGl0bGU6IGkxOG4uaG9zdGVkTVZUaXRsZSwgZGVzY3JpcHRpb246IGkxOG4uaG9zdGVkTVZEZXNjcmlwdGlvbiB9XG4gICAgICAgIDoge1xuICAgICAgICAgIHRpdGxlOiBkYXRhVXJsID8gaTE4bi5hZGREaXJlY3RseVVybFRpdGxlIDogaTE4bi5hZGREaXJlY3RseVRpdGxlLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBkYXRhVXJsID8gaTE4bi5hZGREaXJlY3RseVVybERlc2NyaXB0aW9uIDogaTE4bi5hZGREaXJlY3RseURlc2NyaXB0aW9uXG4gICAgICAgIH07XG4gICAgfVxuICAgIGlmIChkaXNwbGF5TmFtZSA9PT0gXCJHZW9KU09OXCIgJiYgISFkYXRhVXJsKSB7XG4gICAgICByZXR1cm4gaTE4bi5nZW9KU09ORnJvbVVSTFtpc0hvc3RlZCA/IFwiaG9zdGVkXCIgOiBcIm5vbkhvc3RlZFwiXTtcbiAgICB9XG4gICAgY29uc3QgdGl0bGUgPSByZXBsYWNlSTE4TlN0cmluZyhpc0hvc3RlZFxuICAgICAgPyBpMThuLmhvc3RlZFRpdGxlW212RmxvdyAmJiB0eXBlID09PSBcIkNTVlwiID8gXCJDU1ZOb1RhYmxlXCIgOiBkaXNwbGF5TmFtZV0gfHxcbiAgICAgICAgaTE4bi5ob3N0ZWRUaXRsZVt0eXBlXVxuICAgICAgOiBpdGVtSW5mb0kxOE4ubm9uSG9zdGVkVGl0bGUsIGZpbGVOYW1lLCBcImZpbGVOYW1lXCIpO1xuICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gcmVwbGFjZUkxOE5TdHJpbmcoaXNIb3N0ZWRcbiAgICAgID8gLy8gVE9ETzogZml4IGNhc2luZyBpbiB0aGUgXCJ0aWxlIHBhY2thZ2VcIiBhbmQgXCJ2ZWN0b3IgdGlsZSBwYWNrYWdlXCIgaG9zdGVkIGRlc2NyaXB0aW9uIGtleXMgaW4gdGhlIGkxOG4gZmlsZSBhZnRlciBzdHJpbmcgZnJlZXplIGlzIGxpZnRlZFxuICAgICAgICAvLyBXZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAjMzk4NjdcbiAgICAgICAgaTE4bi5ob3N0ZWREZXNjcmlwdGlvbltkaXNwbGF5TmFtZV0gfHxcbiAgICAgICAgICBpMThuLmhvc3RlZERlc2NyaXB0aW9uW2Rpc3BsYXlOYW1lLnRvTG93ZXJDYXNlKCldIHx8XG4gICAgICAgICAgaTE4bi5ob3N0ZWREZXNjcmlwdGlvblt0eXBlXSB8fFxuICAgICAgICAgIGkxOG4uaG9zdGVkRGVzY3JpcHRpb25bdHlwZS50b0xvd2VyQ2FzZSgpXVxuICAgICAgOiBpdGVtSW5mb0kxOE4ubm9uSG9zdGVkRGVzY3JpcHRpb24sIGRpc3BsYXlOYW1lLCBcImZpbGVUeXBlXCIpO1xuICAgIHJldHVybiB7IHRpdGxlLCBkZXNjcmlwdGlvbiB9O1xuICB9XG4gIHJlbmRlck9wdGlvbihyYWRpbywgZGlzcGxheU5hbWUpIHtcbiAgICBjb25zdCB7IHRpdGxlLCBkZXNjcmlwdGlvbiB9ID0gdGhpcy5nZXRPcHRpb25UZXh0KHJhZGlvLCBkaXNwbGF5TmFtZSk7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS10aWxlLXNlbGVjdFwiLCB7IGNoZWNrZWQ6IHJhZGlvID09PSB0aGlzLnNlbGVjdGVkLCBvbkNhbGNpdGVUaWxlU2VsZWN0Q2hhbmdlOiAoZSkgPT4ge1xuICAgICAgICB0aGlzLnNlbGVjdGVkID0gZS50YXJnZXQudmFsdWU7XG4gICAgICAgIHVpU3RvcmVTdGF0ZS5uZXh0VGV4dCA9IHRoaXMuaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpID8gXCJhZGRUb01hcFwiIDogXCJuZXh0XCI7XG4gICAgICB9LCBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24sIGhlYWRpbmc6IHRpdGxlLCBuYW1lOiBkZXNjcmlwdGlvbiwgXCJpbnB1dC1lbmFibGVkXCI6IHRydWUsIFwiaW5wdXQtYWxpZ25tZW50XCI6IFwic3RhcnRcIiwgdHlwZTogXCJyYWRpb1wiLCB2YWx1ZTogcmFkaW8sIHdpZHRoOiBcImZ1bGxcIiwgaWQ6IGAke3JhZGlvfS1pbnB1dC1vcHRpb25gLCBkaXNhYmxlZDogcmFkaW8gPT09IFwibm9uLWhvc3RlZFwiICYmIHRoaXMuc2hvdWxkRGlzYWJsZU5vbkhvc3RlZCgpIH0pKTtcbiAgfVxuICByZW5kZXJTaGVldFNlbGVjdCgpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyBleGNlbExheWVycyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIGlmICghZXhjZWxMYXllcnMgfHwgZXhjZWxMYXllcnMubGVuZ3RoID09PSAxKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImxhYmVsIGxhYmVsLS1sZWFkZXJcIiB9LCB0aGlzLmkxOG4ucHVibGlzaFRoaXNTaGVldCksIGgoXCJjYWxjaXRlLXNlbGVjdFwiLCB7IGxhYmVsOiBcIlwiLCBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6IHRoaXMudXBkYXRlU2VsZWN0ZWRTaGVldC5iaW5kKHRoaXMpLCB2YWx1ZTogKF9hID0gU3RyaW5nKGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZFNoZWV0KSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCIwXCIsIGNsYXNzOiBcImNvbnN0cmFpblwiIH0sIGV4Y2VsTGF5ZXJzLm1hcCgobGF5ZXIsIGkpID0+IChoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyB2YWx1ZTogaSwgc2VsZWN0ZWQ6IGkgPT09IGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZFNoZWV0IH0sIGxheWVyLm5hbWUpKSkpKSk7XG4gIH1cbiAgcmVuZGVyM2RUaWxlc1NlbGVjdCgpIHtcbiAgICBjb25zdCB7IGkxOG4sIHB1Ymxpc2hTZWxlY3RPcHRpb24gfSA9IHRoaXM7XG4gICAgaWYgKChwdWJsaXNoU2VsZWN0T3B0aW9uID09PSBudWxsIHx8IHB1Ymxpc2hTZWxlY3RPcHRpb24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hTZWxlY3RPcHRpb24udGlsZUxheWVyUHVibGlzaFR5cGUpICE9PSBcIjNkVGlsZXNcIikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHsgdGlsZXNMYXllcjNkVGlsZXNMYXllclR5cGUgfSA9IHB1Ymxpc2hTZWxlY3RPcHRpb247XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImxhYmVsIGxhYmVsLS1sZWFkZXJcIiB9LCBpMThuW1wiM2RUaWxlc1wiXS5sYXllclR5cGUpLCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBsYWJlbDogXCJcIiwgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiAoeyBjdXJyZW50VGFyZ2V0IH0pID0+IHtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBjdXJyZW50VGFyZ2V0LnNlbGVjdGVkT3B0aW9uXG4gICAgICAgICAgLnZhbHVlO1xuICAgICAgICBwdWJsaXNoU2VsZWN0T3B0aW9uLnRpbGVzTGF5ZXIzZFRpbGVzTGF5ZXJUeXBlID0gc2VsZWN0ZWQ7XG4gICAgICB9LCB2YWx1ZTogcHVibGlzaFNlbGVjdE9wdGlvbi50aWxlc0xheWVyM2RUaWxlc0xheWVyVHlwZSwgY2xhc3M6IFwiY29uc3RyYWluXCIgfSwgdGlsZXNMYXllcjNkVGlsZXNMYXllclR5cGVzLm1hcCgobGF5ZXJUeXBlKSA9PiAoaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IGxheWVyVHlwZSwgc2VsZWN0ZWQ6IGxheWVyVHlwZSA9PT0gdGlsZXNMYXllcjNkVGlsZXNMYXllclR5cGUgfSwgbGF5ZXJUeXBlID09PSBcIjNET2JqZWN0XCIgPyBcIjNEIE9iamVjdHNcIiA6IFwiSW50ZWdyYXRlZCBNZXNoXCIpKSkpKSk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgZXh0ZW5zaW9uLCB0eXBlLCBleGlzdGluZ0l0ZW0gfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBjb25zdCB7IHBvcnRhbCwgdXNlciB9ID0gY29uZmlnU3RhdGU7XG4gICAgY29uc3QgZGlzcGxheU5hbWUgPSB0aGlzLmdldERpc3BsYXlUeXBlKGFkZEl0ZW1TdGF0ZS50eXBlLCBleHRlbnNpb24pO1xuICAgIGNvbnN0IHsgbG9hZGVyVHlwZSwgaXRlbUluZm9JMThOLCBsb2FkaW5nLCBsb2FkZXJNZXNzYWdlLCBzZWxlY3RlZCwgYWxlcnRDb250ZW50LCBpc0RlbGV0aW5nT2xkRmlsZSwgdGlwLCBjYW5Ta2lwUHVibGlzaFNlbGVjdCB9ID0gdGhpcztcbiAgICBjb25zdCBtdkZsb3cgPSB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCI7XG4gICAgLy8gQWRkIHRvIE1WOiBoaWRlIGhvc3RlZCBzZWxlY3QgaWYgaXRlbSBpcyBiZWluZyBhZGRlZCBkaXJlY3RseVxuICAgIGNvbnN0IGNhblB1Ymxpc2hHZW9Kc29uID0gdHlwZSA9PT0gXCJHZW9Kc29uXCIgJiYgY2FuUHVibGlzaFR5cGUodXNlciwgXCJHZW9Kc29uXCIsIHBvcnRhbCk7XG4gICAgLy8gQ1NWIGhhcyBYIFlcbiAgICBjb25zdCBjYW5QdWJsaXNoQ1NWID0gdHlwZSA9PT0gXCJDU1ZcIiAmJiBjYW5QdWJsaXNoVHlwZSh1c2VyLCBcIkNTVlwiLCBwb3J0YWwpO1xuICAgIGNvbnN0IHNob3dQdWJsaXNoT3B0aW9ucyA9ICFleGlzdGluZ0l0ZW0gJiYgKCFtdkZsb3cgfHwgKCFjYW5Ta2lwUHVibGlzaFNlbGVjdCAmJiAoY2FuUHVibGlzaEdlb0pzb24gfHwgY2FuUHVibGlzaENTVikpKTtcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgbnVsbCwgaChcImFyY2dpcy1uZXctaXRlbS1sb2FkZXJcIiwgeyB0eXBlOiBsb2FkZXJUeXBlLCB2YWx1ZTogYWRkSXRlbVN0YXRlLnVwbG9hZFByb2dyZXNzLCBhY3RpdmU6IGxvYWRpbmcsIHRleHQ6IGxvYWRlck1lc3NhZ2UgfSksIGgoXCJhcmNnaXMtbmV3LWl0ZW0tbG9hZGVyXCIsIHsgdHlwZTogXCJpbmRldGVybWluYXRlXCIsIGFjdGl2ZTogaXNEZWxldGluZ09sZEZpbGUgfSksIGgoXCJhcmNnaXMtbmV3LWl0ZW0taW5wdXQtcmVhZG9ubHlcIiwgbnVsbCksIHNob3dQdWJsaXNoT3B0aW9ucyAmJiAoaChcImZpZWxkc2V0XCIsIHsgY2xhc3M6IFwiZmllbGRzZXRcIiB9LCBoKFwibGVnZW5kXCIsIHsgY2xhc3M6IFwibGFiZWxcIiB9LCBpdGVtSW5mb0kxOE4uaG93VG9BZGQpLCBoKFwiY2FsY2l0ZS10aWxlLXNlbGVjdC1ncm91cFwiLCB7IGxheW91dDogXCJ2ZXJ0aWNhbFwiIH0sIFtcImhvc3RlZFwiLCBcIm5vbi1ob3N0ZWRcIl1cbiAgICAgIC5maWx0ZXIoKG9wdGlvbikgPT4gaXNIb3N0ZWRQb3J0YWwocG9ydGFsKSB8fCBvcHRpb24gIT09IFwiaG9zdGVkXCIpXG4gICAgICAubWFwKChyYWRpbykgPT4gdGhpcy5yZW5kZXJPcHRpb24ocmFkaW8sIGRpc3BsYXlOYW1lKSkpKSksIHR5cGUgPT09IFwiTWljcm9zb2Z0IEV4Y2VsXCIgJiZcbiAgICAgIHNlbGVjdGVkID09PSBcImhvc3RlZFwiICYmXG4gICAgICB1aVN0b3JlU3RhdGUud29ya2Zsb3cgIT09IFwiYXBwZW5kXCIgJiZcbiAgICAgIHRoaXMucmVuZGVyU2hlZXRTZWxlY3QoKSwgdGhpcy5yZW5kZXIzZFRpbGVzU2VsZWN0KCksIGgoXCJjYWxjaXRlLW5vdGljZVwiLCB7IG9wZW46ICEhdGlwLCBjbGFzczogXCJub3RpY2UtLXRpcFwiLCBpY29uOiB0cnVlLCBzY2FsZTogXCJzXCIgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwidGl0bGVcIiB9LCB0aXAgPT09IG51bGwgfHwgdGlwID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0aXAudGl0bGUpLCAodGlwID09PSBudWxsIHx8IHRpcCA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGlwLmRlc2NyaXB0aW9uKSAmJiBoKFwiZGl2XCIsIHsgc2xvdDogXCJtZXNzYWdlXCIgfSwgdGlwID09PSBudWxsIHx8IHRpcCA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGlwLmRlc2NyaXB0aW9uKSwgKHRpcCA9PT0gbnVsbCB8fCB0aXAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRpcC5saW5rKSAmJiAoaChcImNhbGNpdGUtbGlua1wiLCB7IHNsb3Q6IFwibGlua1wiLCBocmVmOiB0aXAgPT09IG51bGwgfHwgdGlwID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0aXAubGluaywgdGFyZ2V0OiBcIl9ibGFua1wiIH0sIHRpcCA9PT0gbnVsbCB8fCB0aXAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRpcC5saW5rVGV4dCkpKSwgaChcImFyY2dpcy1uZXctaXRlbS1hbGVydFwiLCB7IGhlYWRpbmc6IGFsZXJ0Q29udGVudCA9PT0gbnVsbCB8fCBhbGVydENvbnRlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFsZXJ0Q29udGVudC50aXRsZSwgZGVzY3JpcHRpb246IGFsZXJ0Q29udGVudCA9PT0gbnVsbCB8fCBhbGVydENvbnRlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFsZXJ0Q29udGVudC5kZXNjcmlwdGlvbiwgbGluazogeyBocmVmOiBhbGVydENvbnRlbnQgPT09IG51bGwgfHwgYWxlcnRDb250ZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhbGVydENvbnRlbnQubGluaywgdGl0bGU6IGFsZXJ0Q29udGVudCA9PT0gbnVsbCB8fCBhbGVydENvbnRlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFsZXJ0Q29udGVudC5saW5rVGV4dCB9LCBhY3RpdmU6ICEhYWxlcnRDb250ZW50LCBvbkFsZXJ0RGlzbWlzczogKCkgPT4gKHRoaXMuYWxlcnRDb250ZW50ID0gbnVsbCksIHNjYWxlOiBcInNcIiB9KSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNOZXdJdGVtUGFnZXNQdWJsaXNoU2VsZWN0LnN0eWxlID0gYXJjZ2lzTmV3SXRlbVBhZ2VzUHVibGlzaFNlbGVjdENzcztcblxuY29uc3QgYXJjZ2lzTmV3SXRlbVBhZ2VzU2luZ2xlTGF5ZXJTZWxlY3RDc3MgPSBcIi5vdXRlci1jb250YWluZXJ7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbn0ubGF5ZXItY29udGFpbmVye292ZXJmbG93OmF1dG87b3ZlcmZsb3cteDpoaWRkZW47Ym94LXNpemluZzpib3JkZXItYm94O2Rpc3BsYXk6ZmxleDttYXgtaGVpZ2h0OjIxMnB4O2hlaWdodDozMHZoO2JvcmRlcjoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1ib3JkZXItMSk7Ym9yZGVyLXRvcDowO3dpZHRoOjEwMCV9Y2FsY2l0ZS1yYWRpby1idXR0b24tZ3JvdXB7d2lkdGg6MTAwJX0ubGF5ZXItaXRlbXtwYWRkaW5nOjEycHggMTJweCAwfS5sYXllci1ub3RpY2V7bWFyZ2luLWJvdHRvbToxLjVyZW19LmxheWVyLWlucHV0LW1lc3NhZ2V7Zm9udC13ZWlnaHQ6NDAwO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0zKTtmb250LXNpemU6MC44NzVyZW19LmxheWVyLW5vdC1mb3VuZC1tZXNzYWdle2ZvbnQtd2VpZ2h0OjUwMDtmb250LXNpemU6MC44NzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTIpO3RleHQtYWxpZ246Y2VudGVyO3dpZHRoOjEwMCU7bWFyZ2luLXRvcDoxLjVyZW19LnNlbGVjdGVke2JhY2tncm91bmQtY29sb3I6cmdiYSgwLCAxMjEsIDE5MywgMC4wNSl9LnNlbGVjdC1jb250YWluZXJ7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO21hcmdpbi10b3A6MS41cmVtfS5zZWxlY3QtaXRlbXt3aWR0aDo0NSV9LnNlbGVjdC1pdGVtLW1lc3NhZ2V7Zm9udC13ZWlnaHQ6NTAwO2ZvbnQtc2l6ZTowLjg3NXJlbTttYXJnaW4tYm90dG9tOjAuMjVyZW19XCI7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1QYWdlc1NpbmdsZUxheWVyU2VsZWN0ID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVXBkYXRlUGFnZVwiLCA3KTtcbiAgICB0aGlzLndvcmtmbG93Q29tcGxldGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcIndvcmtmbG93Q29tcGxldGVcIiwgNyk7XG4gICAgLy8gVE9ETzogS2VlcCBzZXJ2aWNlSW5mbyB1bm1vZGlmaWVkIC0gY2FuIGJlIGhhcmQgdG8gZm9sbG93IHdoYXQgY2FtZSBiYWNrIGZyb20gdGhlIHJlc3BvbnNlIHZzIHdoYXQgd2FzIGFkZGVkL2NoYW5nZWQgYWZ0ZXJcbiAgICB0aGlzLnNlbGVjdFdNVFNMYXllciA9IChzZWxlY3RlZExheWVyKSA9PiB7XG4gICAgICB2YXIgX2E7XG4gICAgICBjb25zdCB7IHNlcnZpY2VJbmZvIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICBzZXJ2aWNlSW5mby5zZWxlY3RlZExheWVyID0gc2VsZWN0ZWRMYXllcjtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5zZXJ2aWNlSW5mbyA9IHNlcnZpY2VJbmZvO1xuICAgICAgYWRkSXRlbVN0YXRlLnNlbGVjdGVkTGF5ZXIgPSBzZWxlY3RlZExheWVyO1xuICAgICAgYWRkSXRlbVN0YXRlLnRpbGVNYXRyaWNlcyA9XG4gICAgICAgIGNvbmZpZ1N0YXRlLmFwaSA9PT0gNFxuICAgICAgICAgID8gc2VsZWN0ZWRMYXllci50aWxlTWF0cml4U2V0cy50b0FycmF5KClcbiAgICAgICAgICA6IHNlbGVjdGVkTGF5ZXIudGlsZU1hdHJpeFNldEluZm9zO1xuICAgICAgYWRkSXRlbVN0YXRlLnNlbGVjdGVkVGlsZUluZm8gPSAoX2EgPSBhZGRJdGVtU3RhdGUudGlsZU1hdHJpY2VzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF07XG4gICAgICBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlID0gc2VsZWN0ZWRMYXllci50aXRsZTtcbiAgICB9O1xuICAgIHRoaXMuc2VsZWN0V0ZTTGF5ZXIgPSBhc3luYyAobGF5ZXIpID0+IHtcbiAgICAgIGNvbnN0IHsgc2VydmljZUluZm8sIG1heEZlYXR1cmVzIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICBjb25zdCB7IG5hbWUsIGV4dGVudCwgdGl0bGUgfSA9IGxheWVyO1xuICAgICAgY29uc3Qgd2ZzTGF5ZXJPcHRpb25zID0ge1xuICAgICAgICBsYXllck5hbWU6IG5hbWUsXG4gICAgICAgIG1vZGU6IFwic25hcHNob3RcIixcbiAgICAgICAgdGl0bGU6IHRpdGxlIHx8IG5hbWUsXG4gICAgICAgIGZ1bGxFeHRlbnQ6IGV4dGVudCxcbiAgICAgICAgbWF4RmVhdHVyZXM6IG1heEZlYXR1cmVzIHx8IDMwMDBcbiAgICAgIH07XG4gICAgICBpZiAoY29uZmlnU3RhdGUuYXBpID09PSAzKSB7XG4gICAgICAgIC8vIHdoZW4gY2FsbGluZyBzZWxlY3QgbGF5ZXIgZnJvbSBgV0ZTTGF5ZXJgIHRoaXMgd2lsbCBhY3R1YWxseSB1cGRhdGUgc2VydmljZUluZm8sIHNvIHdlIG5lZWQgdG8gc2V0U2VydmljZUluZm8gZXZlcnl0aW1lIGFmdGVyIHdlIGNhbGwgc2VsZWN0TGF5ZXIgaGVyZS5cbiAgICAgICAgYXdhaXQgc2VydmljZUluZm8uc2VsZWN0TGF5ZXIod2ZzTGF5ZXJPcHRpb25zLCAoKSA9PiB7XG4gICAgICAgICAgc2VydmljZUluZm8uc2VsZWN0ZWRMYXllciA9IHdmc0xheWVyT3B0aW9ucztcbiAgICAgICAgICBjb25zdCBpc0NvbXBsZXggPSBzZXJ2aWNlSW5mby5nZW9tZXRyeVR5cGUgPT09IFwiZXNyaUdlb21ldHJ5Q29tcGxleFwiO1xuICAgICAgICAgIHNlcnZpY2VJbmZvLmlzQ29tcGxleCA9IGlzQ29tcGxleDtcbiAgICAgICAgICBjb25zdCB1cmwgPSBzZXJ2aWNlSW5mby51cmwudHJpbSgpO1xuICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5pc0NvbXBsZXggPSBpc0NvbXBsZXg7XG4gICAgICAgICAgYWRkSXRlbVN0YXRlLnNlcnZpY2VJbmZvID0gc2VydmljZUluZm87XG4gICAgICAgICAgYWRkSXRlbVN0YXRlLnNlbGVjdGVkTGF5ZXIgPSB3ZnNMYXllck9wdGlvbnM7XG4gICAgICAgICAgYWRkSXRlbVN0YXRlLnVybCA9IHVybDtcbiAgICAgICAgICBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlID0gd2ZzTGF5ZXJPcHRpb25zLnRpdGxlO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBzZXJ2aWNlSW5mby5sYXllck5hbWUgPSBuYW1lO1xuICAgICAgICBzZXJ2aWNlSW5mby5tYXhGZWF0dXJlcyA9IHdmc0xheWVyT3B0aW9ucy5tYXhGZWF0dXJlcztcbiAgICAgICAgLy8gUHJldmlvdXNseSB3ZSBjYWxsIGBzZXJ2aWNlSW5mby5zZWxlY3RMYXllcmAgaW4gdjMgYW5kIHRoZXNlIGFyZSB0aGUgY2FsbGJhY2tcbiAgICAgICAgc2VydmljZUluZm8uc2VsZWN0ZWRMYXllciA9IHdmc0xheWVyT3B0aW9ucztcbiAgICAgICAgY29uc3QgaXNDb21wbGV4ID0gc2VydmljZUluZm8uZ2VvbWV0cnlUeXBlID09PSBcImVzcmlHZW9tZXRyeUNvbXBsZXhcIjtcbiAgICAgICAgc2VydmljZUluZm8uaXNDb21wbGV4ID0gaXNDb21wbGV4O1xuICAgICAgICBjb25zdCB1cmwgPSBzZXJ2aWNlSW5mby51cmwudHJpbSgpO1xuICAgICAgICBhZGRJdGVtU3RhdGUuaXNDb21wbGV4ID0gaXNDb21wbGV4O1xuICAgICAgICBhZGRJdGVtU3RhdGUuc2VydmljZUluZm8gPSBzZXJ2aWNlSW5mbztcbiAgICAgICAgYWRkSXRlbVN0YXRlLnNlbGVjdGVkTGF5ZXIgPSB3ZnNMYXllck9wdGlvbnM7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS51cmwgPSB1cmw7XG4gICAgICAgIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUgPSBzZXJ2aWNlSW5mby50aXRsZTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlU2VhcmNoVXBkYXRlID0gKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCBsYXllcnMgPSBhZGRJdGVtVXJsU3RhdGUubGF5ZXJzLmZpbHRlcigobGF5ZXIpID0+ICFldmVudC5kZXRhaWwgfHwgbGF5ZXIudGl0bGUudG9Mb3dlckNhc2UoKS5pbmRleE9mKGV2ZW50LmRldGFpbCkgPiAtMSk7XG4gICAgICB0aGlzLmZpbHRlcmVkTGF5ZXJzID0gbGF5ZXJzO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVUaWxlQ2hhbmdlID0gKCkgPT4ge1xuICAgICAgY29uc3QgbmFtZSA9IHRoaXMuZ2V0U2VsZWN0T3B0aW9uKHRoaXMudGlsZVNlbGVjdFJlZik7XG4gICAgICBjb25zdCBzZWxlY3RlZFRpbGVJbmZvID0gYWRkSXRlbVVybFN0YXRlLnRpbGVNYXRyaWNlcy5maW5kKCh0aWxlSW5mbykgPT4gdGlsZUluZm9bY29uZmlnU3RhdGUuYXBpID09PSA0ID8gXCJpZFwiIDogXCJ0aWxlTWF0cml4U2V0XCJdID09PSBuYW1lKTtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZFRpbGVJbmZvID0gc2VsZWN0ZWRUaWxlSW5mbztcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlTWF4RmVhdHVyZUNoYW5nZSA9IChldmVudCkgPT4ge1xuICAgICAgYWRkSXRlbVN0YXRlLm1heEZlYXR1cmVzID0gcGFyc2VJbnQoZXZlbnQudGFyZ2V0LnZhbHVlKTtcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlR2VvbWV0cnlDaGFuZ2UgPSAoKSA9PiB7XG4gICAgICB0aGlzLnNlbGVjdGVkR2VvbWV0cnkgPSB0aGlzLmdldFNlbGVjdE9wdGlvbih0aGlzLmdlb21ldHJ5U2VsZWN0UmVmKTtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5nZW9tZXRyeVR5cGUgPSB0aGlzLnNlbGVjdGVkR2VvbWV0cnk7XG4gICAgfTtcbiAgICB0aGlzLnJlbmRlclNlbGVjdE1lbnVzID0gKCkgPT4ge1xuICAgICAgY29uc3QgeyB0eXBlLCBtYXhGZWF0dXJlcywgdGlsZU1hdHJpY2VzLCBpc0NvbXBsZXggfSA9IGFkZEl0ZW1VcmxTdGF0ZTtcbiAgICAgIGNvbnN0IHsgaTE4biwgaGFuZGxlR2VvbWV0cnlDaGFuZ2UsIGhhbmRsZU1heEZlYXR1cmVDaGFuZ2UsIGhhbmRsZVRpbGVDaGFuZ2UgfSA9IHRoaXM7XG4gICAgICBpZiAodHlwZSA9PT0gXCJXRlNcIikge1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJzZWxlY3QtY29udGFpbmVyXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJzZWxlY3QtaXRlbVwiIH0sIGgoXCJzdHJvbmdcIiwgeyBjbGFzczogXCJzZWxlY3QtaXRlbS1tZXNzYWdlXCIgfSwgaTE4bi5tYXhGZWF0dXJlKSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyBvbkNhbGNpdGVJbnB1dElucHV0OiBoYW5kbGVNYXhGZWF0dXJlQ2hhbmdlLCB2YWx1ZTogYCR7bWF4RmVhdHVyZXN9YCwgXCJudW1iZXItYnV0dG9uLXR5cGVcIjogXCJ2ZXJ0aWNhbFwiLCBtaW46IDAsXG4gICAgICAgICAgLy8gd2lkdGg9XCJhdXRvXCIgLy8gVE9ETzogTm8gZGlyZWN0IGNvbnZlcnNpb24gLSBtYXliZSBzdHlsZSBpdCBmcm9tIHRoZSBvdXRzaWRlXG4gICAgICAgICAgdHlwZTogXCJudW1iZXJcIiB9KSksIGlzQ29tcGxleCAmJiAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJzZWxlY3QtaXRlbVwiIH0sIGgoXCJzdHJvbmdcIiwgeyBjbGFzczogXCJzZWxlY3QtaXRlbS1tZXNzYWdlXCIgfSwgaTE4bi5mZWF0dXJlVHlwZSksIGgoXCJjYWxjaXRlLXNlbGVjdFwiLCB7IGxhYmVsOiBcIlwiLCBjbGFzczogXCJzZWxlY3QtZ2VvbWV0cnlcIiwgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiBoYW5kbGVHZW9tZXRyeUNoYW5nZSwgcmVmOiAoZWwpID0+ICh0aGlzLmdlb21ldHJ5U2VsZWN0UmVmID0gZWwpIH0sIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHNlbGVjdGVkOiB0aGlzLnNlbGVjdGVkR2VvbWV0cnkgPT09IFwiZGVmYXVsdFwiLCBkaXNhYmxlZDogdHJ1ZSwgdmFsdWU6IFwiZGVmYXVsdFwiLCBsYWJlbDogaTE4bi5zZWxlY3RHZW9tZXRyeSB9KSwgaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IFwiZXNyaUdlb21ldHJ5UG9pbnRcIiwgbGFiZWw6IGkxOG4ucG9pbnRzIH0pLCBoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyB2YWx1ZTogXCJlc3JpR2VvbWV0cnlQb2x5bGluZVwiLCBsYWJlbDogaTE4bi5saW5lcyB9KSwgaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IFwiZXNyaUdlb21ldHJ5UG9seWdvblwiLCBsYWJlbDogaTE4bi5wb2x5Z29ucyB9KSkpKSkpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoKHRpbGVNYXRyaWNlcyA9PT0gbnVsbCB8fCB0aWxlTWF0cmljZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRpbGVNYXRyaWNlcy5sZW5ndGgpID4gMSkge1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJzZWxlY3QtY29udGFpbmVyXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJzZWxlY3QtaXRlbVwiIH0sIGgoXCJzdHJvbmdcIiwgeyBjbGFzczogXCJzZWxlY3QtaXRlbS1tZXNzYWdlXCIgfSwgaTE4bi5zZWxlY3RUaWxlKSwgaChcImNhbGNpdGUtc2VsZWN0XCIsIHsgbGFiZWw6IFwiXCIsIG9uQ2FsY2l0ZVNlbGVjdENoYW5nZTogaGFuZGxlVGlsZUNoYW5nZSwgcmVmOiAoZWwpID0+ICh0aGlzLnRpbGVTZWxlY3RSZWYgPSBlbCkgfSwgdGlsZU1hdHJpY2VzLm1hcCgodGlsZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHZhbHVlID0gY29uZmlnU3RhdGUuYXBpID09PSAzID8gdGlsZS50aWxlTWF0cml4U2V0IDogdGlsZS5pZDtcbiAgICAgICAgICByZXR1cm4gaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IHZhbHVlLCBsYWJlbDogdmFsdWUgfSk7XG4gICAgICAgIH0pKSkpKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMubWFuYWdlZEZvY3VzID0gdHJ1ZTtcbiAgICB0aGlzLnNlbGVjdGVkTGF5ZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zZWxlY3RlZEdlb21ldHJ5ID0gXCJkZWZhdWx0XCI7XG4gICAgdGhpcy5maWx0ZXJlZExheWVycyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmVycm9yTWVzc2FnZSA9IFwiXCI7XG4gICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICB9XG4gIG9uVHJhbnNpdGlvbkNvbXBsZXRlKCkge1xuICAgIHZhciBfYTtcbiAgICAoX2EgPSB0aGlzLmxheWVyU2VhcmNoUmVmKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9jdXNNYWluSW5wdXQoKTtcbiAgfVxuICBhc3luYyBoYW5kbGVOZXh0KCkge1xuICAgIGNvbnN0IHsgaXNDb21wbGV4IH0gPSBhZGRJdGVtVXJsU3RhdGU7XG4gICAgaWYgKGlzQ29tcGxleCAmJiB0aGlzLnNlbGVjdGVkR2VvbWV0cnkgPT09IFwiZGVmYXVsdFwiKSB7XG4gICAgICB0aGlzLmVycm9yTWVzc2FnZSA9IHRoaXMuaTE4bi5zZWxlY3RHZW9tZXRyeUVycm9yO1xuICAgICAgdGhpcy5nZW9tZXRyeVNlbGVjdFJlZi5zZXRGb2N1cygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB7IHR5cGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBpZiAodHlwZSA9PT0gXCJXRlNcIikge1xuICAgICAgYXdhaXQgdGhpcy5zZWxlY3RXRlNMYXllcih0aGlzLnNlbGVjdGVkTGF5ZXIpO1xuICAgIH1cbiAgICBpZiAodGhpcy5pc0FkZFRvTWFwVGVybWluYWxQYWdlKCkpIHtcbiAgICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZS5lbWl0KHtcbiAgICAgICAgdHlwZTogYWRkSXRlbVN0YXRlLnR5cGUsXG4gICAgICAgIHVybDogZW5jb2RlVVJJKGFkZEl0ZW1TdGF0ZS51cmwpLFxuICAgICAgICBjdXN0b21QYXJhbWV0ZXJzOiBhZGRJdGVtU3RhdGUuY3VzdG9tUGFyYW1ldGVycyxcbiAgICAgICAgbGF5ZXJzOiBbdGhpcy5zZWxlY3RlZExheWVyXSxcbiAgICAgICAgYWRkQXNCYXNlbWFwOiBhZGRJdGVtU3RhdGUuYWRkQXNCYXNlbWFwXG4gICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJpdGVtUHJvcGVydGllc1wiKTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgaGFuZGxlTGF5ZXJDaGFuZ2UobmFtZSkge1xuICAgIGlmICghbmFtZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBUT0RPOiByZXR1cm4gbmV3IGxheWVyIGZyb20gc2VsZWN0X19fX0xheWVyLCB3cml0ZSB0byBzdG9yZSBoZXJlXG4gICAgaWYgKGFkZEl0ZW1VcmxTdGF0ZS50eXBlID09PSBcIldNVFNcIikge1xuICAgICAgY29uc3Qgc2VsZWN0ZWRMYXllciA9IGFkZEl0ZW1VcmxTdGF0ZS5sYXllcnMuZmluZCgobGF5ZXIpID0+IChjb25maWdTdGF0ZS5hcGkgPT09IDMgPyBsYXllci5pZGVudGlmaWVyIDogbGF5ZXIuaWQpID09PSBuYW1lKTtcbiAgICAgIHRoaXMuc2VsZWN0ZWRMYXllciA9IHNlbGVjdGVkTGF5ZXI7XG4gICAgICB0aGlzLnNlbGVjdFdNVFNMYXllcihzZWxlY3RlZExheWVyKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoYWRkSXRlbVVybFN0YXRlLnR5cGUgPT09IFwiV0ZTXCIpIHtcbiAgICAgIGNvbnN0IHNlbGVjdGVkTGF5ZXIgPSBhZGRJdGVtVXJsU3RhdGUubGF5ZXJzLmZpbmQoKGxheWVyKSA9PiBsYXllci5uYW1lID09PSBuYW1lKTtcbiAgICAgIGF3YWl0IHRoaXMuc2VsZWN0V0ZTTGF5ZXIoc2VsZWN0ZWRMYXllcik7XG4gICAgICB0aGlzLnNlbGVjdGVkTGF5ZXIgPSBzZWxlY3RlZExheWVyO1xuICAgICAgdGhpcy5zZWxlY3RlZEdlb21ldHJ5ID0gXCJkZWZhdWx0XCI7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgY29uc3Qgc2VsZWN0ZWRMYXllciA9IGFkZEl0ZW1VcmxTdGF0ZS5sYXllcnMuZmluZCgobGF5ZXIpID0+IGxheWVyLnRpdGxlID09PSBuYW1lKTtcbiAgICAgIHRoaXMuc2VsZWN0ZWRMYXllciA9IHNlbGVjdGVkTGF5ZXI7XG4gICAgICAvLyB0cm91YmxlIHdpdGggdGhlIHR5cGluZyBoZXJlXG4gICAgICBzZWxlY3RPR0NGZWF0dXJlTGF5ZXIoc2VsZWN0ZWRMYXllcik7XG4gICAgfVxuICB9XG4gIGlzQWRkVG9NYXBUZXJtaW5hbFBhZ2UoKSB7XG4gICAgcmV0dXJuIHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIjtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICBjb25zdCBpMThuID0gdWlTdG9yZVN0YXRlLmkxOG47XG4gICAgdGhpcy5pMThuID0gaTE4bi5zaW5nbGVMYXllclNlbGVjdDtcbiAgICBpZiAodGhpcy5pc0FkZFRvTWFwVGVybWluYWxQYWdlKCkpIHtcbiAgICAgIHVpU3RvcmVTdGF0ZS5uZXh0VGV4dCA9IGFkZEl0ZW1TdGF0ZS5hZGRBc0Jhc2VtYXAgPyBcInVzZUFzQmFzZU1hcFwiIDogXCJhZGRUb01hcFwiO1xuICAgIH1cbiAgICBpZiAoYWRkSXRlbVVybFN0YXRlLnR5cGUgPT09IFwiV0ZTXCIpIHtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5tYXhGZWF0dXJlcyA9IDMwMDA7XG4gICAgICBhd2FpdCB0aGlzLnNlbGVjdFdGU0xheWVyKGFkZEl0ZW1TdGF0ZS5zZXJ2aWNlSW5mby5sYXllcnNbMF0pO1xuICAgIH1cbiAgICBpZiAoYWRkSXRlbVVybFN0YXRlLnR5cGUgPT09IFwiV01UU1wiKSB7XG4gICAgICB0aGlzLnNlbGVjdFdNVFNMYXllcihhZGRJdGVtU3RhdGUuc2VydmljZUluZm8ubGF5ZXJzWzBdKTtcbiAgICB9XG4gICAgdGhpcy5maWx0ZXJlZExheWVycyA9IGFkZEl0ZW1VcmxTdGF0ZS5sYXllcnM7XG4gICAgY29uc3QgaXNPR0NGZWF0dXJlID0gYWRkSXRlbVVybFN0YXRlLnR5cGUgPT09IFwiT0dDRmVhdHVyZVNlcnZlclwiO1xuICAgIGNvbnN0IGxheWVyVmFsdWUgPSBpc09HQ0ZlYXR1cmVcbiAgICAgID8gXCJ0aXRsZVwiXG4gICAgICA6IGFkZEl0ZW1VcmxTdGF0ZS50eXBlID09PSBcIldGU1wiXG4gICAgICAgID8gXCJsYXllck5hbWVcIlxuICAgICAgICA6IFwiaWRlbnRpZmllclwiO1xuICAgIHRoaXMuc2VsZWN0ZWRMYXllciA9XG4gICAgICBhZGRJdGVtVXJsU3RhdGUubGF5ZXJzLmZpbmQoKGxheWVyKSA9PiB7IHZhciBfYTsgcmV0dXJuIGxheWVyW2lzT0dDRmVhdHVyZSA/IFwidGl0bGVcIiA6IFwiIG5hbWVcIl0gPT09ICgoX2EgPSBhZGRJdGVtVXJsU3RhdGUuc2VsZWN0ZWRMYXllcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW2xheWVyVmFsdWVdKTsgfSkgfHwgYWRkSXRlbVVybFN0YXRlLmxheWVyc1swXTtcbiAgICBhZGRJdGVtU3RhdGUuc2VsZWN0ZWRMYXllciA9IHRoaXMuc2VsZWN0ZWRMYXllcjtcbiAgfVxuICBnZXRTZWxlY3RPcHRpb24oc2VsZWN0KSB7XG4gICAgY29uc3Qgb3B0aW9uID0gc2VsZWN0ID09PSBudWxsIHx8IHNlbGVjdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0LnF1ZXJ5U2VsZWN0b3IoXCJjYWxjaXRlLW9wdGlvbltzZWxlY3RlZF1cIik7XG4gICAgcmV0dXJuIG9wdGlvbiA9PT0gbnVsbCB8fCBvcHRpb24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbi52YWx1ZTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgcmVuZGVyU2VsZWN0TWVudXMsIGkxOG4sIHNlbGVjdGVkTGF5ZXIgfSA9IHRoaXM7XG4gICAgY29uc3QgaXNXTVRTID0gYWRkSXRlbVVybFN0YXRlLnR5cGUgPT09IFwiV01UU1wiO1xuICAgIGNvbnN0IGlzT0dDRmVhdHVyZSA9IGFkZEl0ZW1VcmxTdGF0ZS50eXBlID09PSBcIk9HQ0ZlYXR1cmVTZXJ2ZXJcIjtcbiAgICBjb25zdCBsYXllclZhbHVlID0gaXNPR0NGZWF0dXJlXG4gICAgICA/IFwidGl0bGVcIlxuICAgICAgOiBpc1dNVFNcbiAgICAgICAgPyBjb25maWdTdGF0ZS5hcGkgPT09IDNcbiAgICAgICAgICA/IFwiaWRlbnRpZmllclwiXG4gICAgICAgICAgOiBcImlkXCJcbiAgICAgICAgOiBcIm5hbWVcIjtcbiAgICBjb25zdCBMSU1JVF9BTU9VTlQgPSAxMDAwO1xuICAgIGNvbnN0IHVzZVBybyA9IHRoaXMuZmlsdGVyZWRMYXllcnMubGVuZ3RoID49IExJTUlUX0FNT1VOVDtcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJvdXRlci1jb250YWluZXJcIiB9LCBoKFwiY2FsY2l0ZS1ub3RpY2VcIiwgeyBjbGFzczogXCJsYXllci1ub3RpY2VcIiwgaWNvbjogXCJpbmZvcm1hdGlvblwiLCBvcGVuOiB1c2VQcm8sIHdpZHRoOiBcImZ1bGxcIiB9LCBoKFwicFwiLCB7IHNsb3Q6IFwibWVzc2FnZVwiIH0sIGkxOG4udXNlUHJvKSksIGgoXCJzdHJvbmdcIiwgeyBjbGFzczogXCJzZWxlY3QtaXRlbS1tZXNzYWdlXCIgfSwgaTE4bi5zZWxlY3RMYXllciksIGgoXCJkaXZcIiwgbnVsbCwgaChcImFyY2dpcy1uZXctaXRlbS1sYXllci1zZWFyY2hcIiwgeyBzZWFyY2hMYWJlbDogXCJsYXllcnNcIiwgb25TZWFyY2hVcGRhdGU6IHRoaXMuaGFuZGxlU2VhcmNoVXBkYXRlLCByZWY6IChlbGUpID0+ICh0aGlzLmxheWVyU2VhcmNoUmVmID0gZWxlKSB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImxheWVyLWNvbnRhaW5lclwiIH0sIHRoaXMuZmlsdGVyZWRMYXllcnMubGVuZ3RoID09PSAwID8gKGgoXCJzdHJvbmdcIiwgeyBjbGFzczogXCJsYXllci1ub3QtZm91bmQtbWVzc2FnZVwiIH0sIGkxOG4ubm9MYXllcnNGb3VuZCkpIDogKGgoXCJjYWxjaXRlLXJhZGlvLWJ1dHRvbi1ncm91cFwiLCB7IG5hbWU6IFwibGF5ZXItc2VsZWN0XCIsIHJvbGU6IFwicmFkaW9ncm91cFwiLCBsYXlvdXQ6IFwidmVydGljYWxcIiwgb25DYWxjaXRlUmFkaW9CdXR0b25Hcm91cENoYW5nZTogKGV2ZW50KSA9PiB0aGlzLmhhbmRsZUxheWVyQ2hhbmdlKGV2ZW50LnRhcmdldC5zZWxlY3RlZEl0ZW0udmFsdWUpIH0sIChfYSA9IHRoaXMuZmlsdGVyZWRMYXllcnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zbGljZSgwLCBMSU1JVF9BTU9VTlQpLm1hcCgobGF5ZXIpID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gbGF5ZXJbbGF5ZXJWYWx1ZV07XG4gICAgICBjb25zdCBsYWJlbCA9IGxheWVyLnRpdGxlO1xuICAgICAgbGV0IGlzU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgIC8vIGZvciBzb21lIE9HQyBTZXJ2ZXJzLCB0aGUgdGl0bGUgbWF5IGJlIGR1cGxpY2F0ZWQgaW4gdGhlIGRhdGEgc2V0IHNvIHlvdSBoYXZlIHRvIGFsc28gY2hlY2sgdGhlIGlkIGFzIHdlbGwgKGZvciB3aGF0IEkgd2FzIHRlc3RpbmcgLSB0aGUgaWQgY291bGRudCBiZSB1c2VkIGFzIGEgdmFsdWUgYmVjYXVzZSBpdCBoYWQgc3BlY2lhbCBjaGFyYWN0ZXJzIGFuZCBjb3VsZG50IGJlIHVzZWQgYXMgYSBzZWxlY3RvciBpbiBgcXVlcnlTZWxlY3RvcmApXG4gICAgICBpZiAodmFsdWUgPT09IHNlbGVjdGVkTGF5ZXJbbGF5ZXJWYWx1ZV0pIHtcbiAgICAgICAgaWYgKGlzT0dDRmVhdHVyZSkge1xuICAgICAgICAgIGlzU2VsZWN0ZWQgPSBsYXllci5pZCA9PT0gc2VsZWN0ZWRMYXllci5pZDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBpc1NlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGxheW91dDogXCJpbmxpbmVcIiwgZm9yOiB2YWx1ZSwgY2xhc3M6IHtcbiAgICAgICAgICBcImxheWVyLWl0ZW1cIjogdHJ1ZSxcbiAgICAgICAgICBzZWxlY3RlZDogaXNTZWxlY3RlZFxuICAgICAgICB9IH0sIGgoXCJjYWxjaXRlLXJhZGlvLWJ1dHRvblwiLCB7IGNsYXNzOiBcInJhZGlvXCIsIGNoZWNrZWQ6IGlzU2VsZWN0ZWQsIGlkOiB2YWx1ZSwgbmFtZTogdmFsdWUsIHZhbHVlOiB2YWx1ZSB9KSwgbGFiZWwgfHwgdmFsdWUpKTtcbiAgICB9KSkpKSksIHJlbmRlclNlbGVjdE1lbnVzKCksIGgoXCJhcmNnaXMtbmV3LWl0ZW0tYWxlcnRcIiwgeyBhY3RpdmU6ICEhdGhpcy5lcnJvck1lc3NhZ2UsIGRlc2NyaXB0aW9uOiB0aGlzLmVycm9yTWVzc2FnZSwgb25BbGVydERpc21pc3M6ICgpID0+ICh0aGlzLmVycm9yTWVzc2FnZSA9IFwiXCIpIH0pKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc1NpbmdsZUxheWVyU2VsZWN0LnN0eWxlID0gYXJjZ2lzTmV3SXRlbVBhZ2VzU2luZ2xlTGF5ZXJTZWxlY3RDc3M7XG5cbi8qKlxuICogQ3VzdG9tIFBhcmFtdGVycyBjYW4gYmUgdXNlZCBmb3IgYW55IE9HQyBvciBBR1Mgc2VydmljZS4gRm9yIFdNUyxcbiAqIFdGUyBhbmQgV01UUyB0aGV5IHdpbGwgYmUgYWRkZWQgdG8gdGhlIGNvbnN0cnVjdG9yIGZyb20gdGhlIEpTQVBJIHdoZW5cbiAqIGNyZWF0aW5nIHRoZSBsYXllciwgZm9yIGV2ZXJ5dGhpbmcgZWxzZSBpdCB3aWxsIGJlIGFkZGVkIHRlbXBvcmFyaWx5XG4gKiB0byB0aGUgVVJMIHdoZW4gcmV0cmVpdmluZyBzZXJ2aWNlIGluZm8uXG4gKiBGb3IgYWxsIHVybHMgd2l0aCBjdXN0b20gcGFyYW10ZXJzLCBpdCB3aWxsIGJlIGFkZGVkIHRvIHRoZSBpdGVtc1xuICogIG1ldGFkYXRhIHVzaW5nIHRoZSB0ZXh0IGF0dHJpYnV0ZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gaGFuZGxlQ3VzdG9tUGFyYW1ldGVyVXBkYXRlKHNlcnZpY2VJbmZvLCB0eXBlLCBfY3VzdG9tUGFyYW1ldGVycykge1xuICBjb25zdCB7IGN1c3RvbVBhcmFtZXRlcnMsIGN1c3RvbUxheWVyUGFyYW1ldGVycyB9ID0gZm9ybWF0Q3VzdG9tUGFyYW1ldGVycyhfY3VzdG9tUGFyYW1ldGVycyk7XG4gIHN3aXRjaCAodHlwZSkge1xuICAgIGNhc2UgXCJXTVNcIjpcbiAgICBjYXNlIFwiV01UU1wiOlxuICAgICAgYXdhaXQgKHNlcnZpY2VJbmZvID09PSBudWxsIHx8IHNlcnZpY2VJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXJ2aWNlSW5mby5zZXRDdXN0b21QYXJhbWV0ZXJzKGN1c3RvbVBhcmFtZXRlcnMgfHwge30sIGN1c3RvbUxheWVyUGFyYW1ldGVycyB8fCB7fSkpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBcIldGU1wiOlxuICAgICAgYXdhaXQgKHNlcnZpY2VJbmZvID09PSBudWxsIHx8IHNlcnZpY2VJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXJ2aWNlSW5mby5zZXRDdXN0b21QYXJhbWV0ZXJzKGN1c3RvbVBhcmFtZXRlcnMgfHwge30pKTtcbiAgICAgIGJyZWFrO1xuICB9XG59XG5cbmNvbnN0IGlzS2V5QWxsb3dlZEluVXJsTG9jYWxTdGF0ZSA9IChrZXkpID0+IFtcbiAgXCJ1cmxcIixcbiAgXCJ0eXBlXCIsXG4gIFwibmV3SXRlbU1vZGVcIixcbiAgXCJzZXJ2aWNlSW5mb1wiLFxuICBcImlzU2VjdXJlZFwiLFxuICBcImFsbG93U3RvcmVkQXV0aFwiLFxuICBcInN0b3JlQXV0aFwiLFxuICBcImh5YnJpZEltYWdlU2VydmljZVNldHRpbmdcIixcbiAgXCJhZGRBc0Jhc2VtYXBcIixcbiAgXCJkYXRhVXJsXCIsXG4gIFwiZmlsZU5hbWVcIixcbiAgXCJnZW9KU09OUmVzb3VyY2VcIixcbiAgXCJ0aXRsZVwiLFxuICBcInRhZ3NcIixcbiAgXCJzbmlwcGV0XCJcbl0uaW5jbHVkZXMoa2V5KTtcblxuY29uc3QgYXJjZ2lzTmV3SXRlbVBhZ2VzVXJsVHlwZUNzcyA9IFwiLmxhYmVse2ZvbnQtd2VpZ2h0OjUwMDtmb250LXNpemU6MC44NzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpO21hcmdpbi1ib3R0b206MXJlbTtwYWRkaW5nLXRvcDoxcmVtO2Rpc3BsYXk6YmxvY2s7bGluZS1oZWlnaHQ6MThweH0uZmllbGRzZXR7bWFyZ2luOjA7bWFyZ2luLWJvdHRvbToxLjVyZW07cGFkZGluZzowO2JvcmRlci1zdHlsZTpub25lfS5pbmZvLWhlYWRlcntmb250LXdlaWdodDo1MDA7Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0xKTttYXJnaW46MDttYXJnaW4tYm90dG9tOjAuNXJlbTtwYWRkaW5nOjB9LmluZm8taGVhZGVyLS1sZWFkZXJ7bWFyZ2luLXRvcDoxcmVtfS5pbmZvLWRlc2NyaXB0aW9ue2ZvbnQtd2VpZ2h0OjQwMDtmb250LXNpemU6MC43NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMSk7bWFyZ2luOjA7cGFkZGluZzowfS5jdXN0b20tcGFyYW0tY29udGFpbmVye21hcmdpbi1ib3R0b206MS41cmVtfTpob3N0e292ZXJmbG93LXg6aGlkZGVufVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNVcmxUeXBlID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVXBkYXRlUGFnZVwiLCA3KTtcbiAgICB0aGlzLm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkXCIsIDcpO1xuICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwid29ya2Zsb3dDb21wbGV0ZVwiLCA3KTtcbiAgICB2YXIgX2E7XG4gICAgdGhpcy5hZGREaXJlY3RUb01hcCA9IGZhbHNlO1xuICAgIHRoaXMudXJsT3B0aW9ucyA9IFtcbiAgICAgIHsgdmFsdWU6IFwiQUdTXCIsIGljb246IFwic2VydmVyXCIsIHNob3c6IHRydWUgfSxcbiAgICAgIHsgdmFsdWU6IFwiRG9jdW1lbnQgTGlua1wiLCBpY29uOiBcImZpbGUtY29kZVwiLCBzaG93OiAhaXNQdWJsaWNVc2VyKGNvbmZpZ1N0YXRlLnVzZXIpIH0sXG4gICAgICB7IHZhbHVlOiBcIkdlb0pzb25cIiwgaWNvbjogXCJicmFja2V0cy1jdXJseVwiLCBzaG93OiB0cnVlIH0sXG4gICAgICB7IHZhbHVlOiBcIktNTFwiLCBpY29uOiBcImxheWVyLWttbFwiLCBzaG93OiB0cnVlIH0sXG4gICAgICB7IHZhbHVlOiBcIk9HQ0ZlYXR1cmVTZXJ2ZXJcIiwgaWNvbjogXCJmZWF0dXJlLWxheWVyXCIsIHNob3c6IHRydWUgfSxcbiAgICAgIHsgdmFsdWU6IFwiV0ZTXCIsIGljb246IFwiZmVhdHVyZS1sYXllclwiLCBzaG93OiB0cnVlIH0sXG4gICAgICB7IHZhbHVlOiBcIldNU1wiLCBpY29uOiBcImxheWVyLW1hcFwiLCBzaG93OiB0cnVlIH0sXG4gICAgICB7IHZhbHVlOiBcIldNVFNcIiwgaWNvbjogXCJ0aWxlLWxheWVyXCIsIHNob3c6IHRydWUgfSxcbiAgICAgIHsgdmFsdWU6IFwiR2VvUlNTXCIsIGljb246IFwiZmlsZS10ZXh0XCIsIHNob3c6IHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIiB9LFxuICAgICAge1xuICAgICAgICB2YWx1ZTogXCJDU1ZcIixcbiAgICAgICAgaWNvbjogXCJmaWxlLWNzdlwiLFxuICAgICAgICBzaG93OiB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCIgfHwgISgoX2EgPSBjb25maWdTdGF0ZS5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1BvcnRhbClcbiAgICAgIH0sXG4gICAgICB7IHZhbHVlOiBcIlRpbGUgTGF5ZXJcIiwgaWNvbjogXCJ0aWxlLWxheWVyXCIsIHNob3c6IHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIiB9XG4gICAgXTtcbiAgICB0aGlzLnNldFNlcnZpY2VJbmZvU3RhdGUgPSAocHJvcGVydGllcykgPT4ge1xuICAgICAgT2JqZWN0LmtleXMocHJvcGVydGllcykuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gcHJvcGVydGllc1trZXldO1xuICAgICAgICBpZiAoaXNLZXlBbGxvd2VkSW5VcmxMb2NhbFN0YXRlKGtleSkpIHtcbiAgICAgICAgICAvLyBUT0RPOiBSZW1vdmUgYW55IGNhc3Qgb25jZSBpbmNvbWluZyBwcm9wZXJ0aWVzIGFyZSB0cmltbWVkIGRvd24gdG8gdXJsRGF0YVxuICAgICAgICAgIHRoaXMudXJsRGF0YVtrZXldID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgLy8gVE9ETzogRGVjaWRlIGlmIGFsbCBwb3NzaWJsZSBzZXJ2aWNlIGluZm8gcHJvcGVydGllcyAodGh1bWJuYWlsLCBleHRlbnQsIGxheWVycywgZXRjLikgc2hvdWxkIGJlIHBhcnQgb2YgdXJsRGF0YVxuICAgICAgICAgIC8vIElmIG5vdCwgY29uc2lkZXIgaG9sZGluZyB0aGlzIGFzIGEgdGVtcG9yYXJ5IGxvY2FsIG9iamVjdCB1bnRpbCB0aGUgcmVzdCBvZiB0aGUgc3RvcmUgYXNzaWdubWVudHNcbiAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgYWRkSXRlbVN0YXRlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB0aGlzLmlzQWRkVG9NYXBUZXJtaW5hbFBhZ2UgPSAoKSA9PiB7XG4gICAgICB2YXIgX2E7XG4gICAgICBjb25zdCB7IHNlbGVjdGVkT3B0aW9uLCB1cmxEYXRhOiB7IHVybCwgc2VydmljZUluZm8gfSwgYWRkRGlyZWN0VG9NYXAgfSA9IHRoaXM7XG4gICAgICByZXR1cm4gKGFkZERpcmVjdFRvTWFwICYmXG4gICAgICAgICgoaXNBR1ModGhpcy51cmxEYXRhLnR5cGUpICYmICF0aGlzLnVybERhdGEuc3RvcmVBdXRoICYmIHNlcnZpY2VJbmZvKSB8fFxuICAgICAgICAgIHN1cHBvcnRzRGlyZWN0KHNlbGVjdGVkT3B0aW9uKSkgJiZcbiAgICAgICAgIWlzSHlicmlkSW1hZ2VTZXJ2aWNlKHVybCwgc2VydmljZUluZm8pICYmXG4gICAgICAgICghW1wiV01TXCIsIFwiV0ZTXCIsIFwiV01UU1wiLCBcIkNTVlwiLCBcIkdlb0pzb25cIiwgXCJPR0NGZWF0dXJlU2VydmVyXCJdLmluY2x1ZGVzKHNlbGVjdGVkT3B0aW9uKSB8fFxuICAgICAgICAgIGlzQUdTKHRoaXMudXJsRGF0YS50eXBlKSB8fFxuICAgICAgICAgIChzZWxlY3RlZE9wdGlvbiA9PT0gXCJHZW9Kc29uXCIgJiYgIWNvbmZpZ1N0YXRlLnVzZXIpIHx8XG4gICAgICAgICAgKCgoX2EgPSBjb25maWdTdGF0ZS5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1BvcnRhbCkgJiYgW1wiQ1NWXCIsIFwiR2VvSnNvblwiXS5pbmNsdWRlcyhzZWxlY3RlZE9wdGlvbikpKSk7XG4gICAgfTtcbiAgICB0aGlzLmRldGVybWluZU5leHRUZXh0ID0gKCkgPT4ge1xuICAgICAgY29uc3QgeyB1cmxEYXRhLCBpc0FkZFRvTWFwVGVybWluYWxQYWdlLCBzaG93QWRkVG9NYXAgfSA9IHRoaXM7XG4gICAgICB1aVN0b3JlU3RhdGUubmV4dFRleHQgPSBcIm5leHRcIjtcbiAgICAgIGlmIChpc0FkZFRvTWFwVGVybWluYWxQYWdlKCkpIHtcbiAgICAgICAgdWlTdG9yZVN0YXRlLm5leHRUZXh0ID0gXCJhZGRUb01hcFwiO1xuICAgICAgICBpZiAoc2hvd0FkZFRvTWFwKCkgJiYgdXJsRGF0YS5hZGRBc0Jhc2VtYXApIHtcbiAgICAgICAgICB1aVN0b3JlU3RhdGUubmV4dFRleHQgPSBcInVzZUFzQmFzZU1hcFwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLnNob3dBZGRUb01hcCA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHsgdXJsRGF0YSwgYWRkRGlyZWN0VG9NYXAgfSA9IHRoaXM7XG4gICAgICBjb25zdCB7IHVybCA9IFwiXCIsIHNlcnZpY2VJbmZvIH0gPSB1cmxEYXRhO1xuICAgICAgY29uc3QgYWRkVG9NYXBUeXBlID0gW1xuICAgICAgICBcIlRpbGUgTGF5ZXJcIixcbiAgICAgICAgXCJXTVNcIixcbiAgICAgICAgXCJXTVRTXCIsXG4gICAgICAgIFwiVmVjdG9yIFRpbGUgU2VydmljZVwiLFxuICAgICAgICBcIkltYWdlIFNlcnZpY2VcIixcbiAgICAgICAgXCJNYXAgU2VydmljZVwiXG4gICAgICBdO1xuICAgICAgcmV0dXJuIChhZGREaXJlY3RUb01hcCAmJlxuICAgICAgICAoYWRkVG9NYXBUeXBlLmluY2x1ZGVzKHVybERhdGEudHlwZSkgfHwgaXNIeWJyaWRJbWFnZVNlcnZpY2UodXJsLCBzZXJ2aWNlSW5mbykpKTtcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlQXV0aFN3aXRjaENoYW5nZSA9IChldmVudCkgPT4ge1xuICAgICAgdGhpcy51cmxEYXRhLnN0b3JlQXV0aCA9IGV2ZW50LmRldGFpbDtcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlTG9hZGVyVXBkYXRlID0gKGV2ZW50KSA9PiB7XG4gICAgICB0aGlzLmxvYWRpbmcgPSBldmVudC5kZXRhaWw7XG4gICAgfTtcbiAgICB0aGlzLnJlc2V0RXJyb3IgPSAoKSA9PiB7XG4gICAgICB0aGlzLmVycm9yID0gZmFsc2U7XG4gICAgICB0aGlzLmVycm9yTWVzc2FnZSA9IFwiXCI7XG4gICAgfTtcbiAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgICB0aGlzLnNlbGVjdGVkT3B0aW9uID0gbnVsbDtcbiAgICB0aGlzLnByZXZpb3VzU2VsZWN0ZWRPcHRpb24gPSBudWxsO1xuICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmVycm9yID0gZmFsc2U7XG4gICAgdGhpcy5lcnJvck1lc3NhZ2UgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgdGhpcy5sb2FkZXJUZXh0ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudXJsRGF0YSA9IHt9O1xuICB9XG4gIGFzeW5jIGhhbmRsZU5leHQoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCB7IHVybERhdGEsIHNlbGVjdGVkT3B0aW9uLCBpdGVtVXJsUmVmLCBpMThuLCBzZWxlY3RSZWYgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBjdXN0b21QYXJhbWV0ZXJzIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgY29uc3QgdXJsRXJyb3JNZXNzYWdlID0gYXdhaXQgKGl0ZW1VcmxSZWYgPT09IG51bGwgfHwgaXRlbVVybFJlZiA9PT0gdm9pZCAwID8gdm9pZCAwIDogaXRlbVVybFJlZi52YWxpZGF0ZUlucHV0KCkpO1xuICAgIGlmICh1cmxFcnJvck1lc3NhZ2UpIHtcbiAgICAgIC8vIFdlIGFscmVhZHkgc2hvdyBlcnJvciBpbmxpbmVcbiAgICAgIGl0ZW1VcmxSZWYuZm9jdXNNYWluSW5wdXQoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gQ2FuY2VsIG5leHQgaWYgdXJsIGlzIG5vdCB5ZXQgYW5hbHl6ZWRcbiAgICBpZiAodGhpcy5sb2FkaW5nKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghc2VsZWN0ZWRPcHRpb24pIHtcbiAgICAgIHNlbGVjdFJlZi5zZXRGb2N1cygpO1xuICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBpMThuLnVuZGV0ZWN0ZWQ7XG4gICAgICB0aGlzLmVycm9yID0gdHJ1ZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgdGhpcy5oYW5kbGVQYWdlVHJhbnNpdGlvbigpO1xuICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICBpZiAoaXNIeWJyaWRJbWFnZVNlcnZpY2UodXJsRGF0YS51cmwsIChfYSA9IHRoaXMudXJsRGF0YSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNlcnZpY2VJbmZvKSkge1xuICAgICAgICB0aGlzLmFzc2lnblN0b3JlU3RhdGUoKTtcbiAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KHRoaXMudXJsRGF0YS5zdG9yZUF1dGggPyBcImF1dGhcIiA6IFwiaHlicmlkSW1hZ2VTZWxlY3RcIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmlzQWRkVG9NYXBUZXJtaW5hbFBhZ2UoKSkge1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAvLyBPbmx5IHJlZGlyZWN0IGlmIG5vIG1vcmUgYWN0aW9ucyBhcmUgbmVlZGVkXG4gICAgICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZS5lbWl0KHtcbiAgICAgICAgICB0eXBlOiB1cmxEYXRhLnR5cGUsXG4gICAgICAgICAgdXJsOiBlbmNvZGVVUkkodXJsRGF0YS51cmwpLFxuICAgICAgICAgIGN1c3RvbVBhcmFtZXRlcnMsXG4gICAgICAgICAgYWRkQXNCYXNlbWFwOiAoX2IgPSB0aGlzLnVybERhdGEuYWRkQXNCYXNlbWFwKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICB9XG4gICAgICB0aGlzLnNldE5leHRQYWdlKCk7XG4gICAgICB0aGlzLmFzc2lnblN0b3JlU3RhdGUoKTtcbiAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdCh0aGlzLm5leHRQYWdlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLml0ZW1VcmxSZWYuZm9jdXNNYWluSW5wdXQoKTtcbiAgICAgIHRoaXMuZXJyb3IgPSB0cnVlO1xuICAgIH1cbiAgfVxuICBhc3NpZ25TdG9yZVN0YXRlKCkge1xuICAgIGNvbnN0IHsgdXJsLCB0eXBlLCBhbGxvd1N0b3JlZEF1dGgsIHN0b3JlQXV0aCwgdGl0bGUsIHRhZ3MsIHNuaXBwZXQsIHNlcnZpY2VJbmZvLCBpc1NlY3VyZWQsIGFkZEFzQmFzZW1hcCB9ID0gdGhpcy51cmxEYXRhO1xuICAgIGNvbnN0IHNlbGVjdGVkT3B0aW9uID0gdGhpcy5zZWxlY3RlZE9wdGlvbjtcbiAgICBhZGRJdGVtU3RhdGUudXJsID0gdXJsO1xuICAgIGFkZEl0ZW1TdGF0ZS5zdG9yZUF1dGggPSBzdG9yZUF1dGg7XG4gICAgYWRkSXRlbVN0YXRlLnR5cGUgPSB0eXBlO1xuICAgIGFkZEl0ZW1TdGF0ZS5hbGxvd1N0b3JlZEF1dGggPSBhbGxvd1N0b3JlZEF1dGg7XG4gICAgYWRkSXRlbVN0YXRlLm5ld0l0ZW1Nb2RlID0gXCJ1cmxcIjtcbiAgICBhZGRJdGVtU3RhdGUuc2VydmljZUluZm8gPSBzZXJ2aWNlSW5mbztcbiAgICBhZGRJdGVtU3RhdGUuaXNTZWN1cmVkID0gaXNTZWN1cmVkO1xuICAgIGFkZEl0ZW1TdGF0ZS5hZGRBc0Jhc2VtYXAgPSBhZGRBc0Jhc2VtYXAgIT09IG51bGwgJiYgYWRkQXNCYXNlbWFwICE9PSB2b2lkIDAgPyBhZGRBc0Jhc2VtYXAgOiBmYWxzZTtcbiAgICBjb25zdCBwYXJ0cyA9IHVybC5zcGxpdChcIi9cIik7XG4gICAgY29uc3QgZmlsZU5hbWUgPSBwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXTtcbiAgICBpZiAoc2VsZWN0ZWRPcHRpb24gPT09IFwiR2VvSnNvblwiICYmIHVybCkge1xuICAgICAgYWRkSXRlbVN0YXRlLmRhdGFVcmwgPSB1cmw7XG4gICAgICBhZGRJdGVtU3RhdGUudGl0bGUgPSBmaWxlTmFtZS5yZXBsYWNlKGdlb0pzb25SZWdFeHAsIFwiXCIpLnJlcGxhY2Uoc3BlY2lhbENoYXJhY3RlcnNSZWdFeHAsIFwiXCIpO1xuICAgICAgYWRkSXRlbVN0YXRlLmZpbGVOYW1lID0gZmlsZU5hbWU7XG4gICAgICBhZGRJdGVtU3RhdGUuZXh0ZW5zaW9uID0gXCJqc29uXCI7XG4gICAgICBpZiAodWlTdG9yZVN0YXRlLndvcmtmbG93ICE9PSBcIm1hcFwiKSB7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwiZmlsZVwiO1xuICAgICAgfVxuICAgICAgYWRkSXRlbVN0YXRlLmdlb0pTT05SZXNvdXJjZSA9IHtcbiAgICAgICAgZmlsZU5hbWUsXG4gICAgICAgIHVybCxcbiAgICAgICAgbWltZVR5cGU6IFwiZ2VvanNvblwiXG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAoc2VsZWN0ZWRPcHRpb24gPT09IFwiQ1NWXCIpIHtcbiAgICAgIGFkZEl0ZW1TdGF0ZS50eXBlID0gXCJDU1ZcIjtcbiAgICAgIGFkZEl0ZW1TdGF0ZS5kYXRhVXJsID0gdXJsO1xuICAgICAgYWRkSXRlbVN0YXRlLmZpbGVOYW1lID0gdXJsVG9UaXRsZSh1cmwpO1xuICAgICAgYWRkSXRlbVN0YXRlLmV4dGVuc2lvbiA9IFwiY3N2XCI7XG4gICAgICBhZGRJdGVtU3RhdGUuY3N2UmVzb3VyY2UgPSB7XG4gICAgICAgIGZpbGVOYW1lLFxuICAgICAgICB1cmwsXG4gICAgICAgIG1pbWVUeXBlOiBcImNzdlwiXG4gICAgICB9O1xuICAgIH1cbiAgICB0aXRsZSAmJiAoaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSA9IHRpdGxlLnJlcGxhY2Uoc3BlY2lhbENoYXJhY3RlcnNSZWdFeHAsIFwiXCIpKTtcbiAgICB0YWdzICYmIChpdGVtUHJvcGVydGllc1N0YXRlLnRhZ3MgPSB0YWdzKTtcbiAgICBzbmlwcGV0ICYmIChpdGVtUHJvcGVydGllc1N0YXRlLnNuaXBwZXQgPSBzbmlwcGV0KTtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyB0eXBlLCB1cmwsIHNlcnZpY2VJbmZvLCBpc1NlY3VyZWQsIGFsbG93U3RvcmVkQXV0aCwgc3RvcmVBdXRoLCBhZGRBc0Jhc2VtYXAsIHRpdGxlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgdGhpcy51cmxEYXRhID0ge1xuICAgICAgdXJsLFxuICAgICAgdHlwZSxcbiAgICAgIGFsbG93U3RvcmVkQXV0aCxcbiAgICAgIHN0b3JlQXV0aCxcbiAgICAgIHNlcnZpY2VJbmZvLFxuICAgICAgaXNTZWN1cmVkLFxuICAgICAgYWRkQXNCYXNlbWFwLFxuICAgICAgdGl0bGVcbiAgICB9O1xuICAgIHRoaXMuY2hhbmdlT3B0aW9uKChfYSA9IHR5cGUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IG51bGwpO1xuICAgIHRoaXMuYWRkRGlyZWN0VG9NYXAgPSB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCI7XG4gICAgdGhpcy5pMThuID0gdWlTdG9yZVN0YXRlLmkxOG4udXJsVHlwZTtcbiAgICB0aGlzLmxvYWRlclRleHQgPSB0aGlzLmkxOG4uZ2V0U2VydmljZUluZm87XG4gICAgaWYgKCEhY29uZmlnU3RhdGUuYWxsb3dlZEl0ZW1UeXBlcykge1xuICAgICAgdGhpcy51cmxPcHRpb25zID0gdGhpcy51cmxPcHRpb25zLmZpbHRlcigob3B0aW9uKSA9PiB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIHJldHVybiBvcHRpb24udmFsdWUgPT09IFwiQUdTXCJcbiAgICAgICAgICA/IChfYSA9IGNvbmZpZ1N0YXRlLmFsbG93ZWRJdGVtVHlwZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zb21lKCh0eXBlKSA9PiBpc0FHUyh0eXBlKSlcbiAgICAgICAgICA6IChfYiA9IGNvbmZpZ1N0YXRlLmFsbG93ZWRJdGVtVHlwZXMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5pbmNsdWRlcyhvcHRpb24udmFsdWUpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmFsbG93ZWRJdGVtVHlwZXMgPSBjb25maWdTdGF0ZS5hbGxvd2VkSXRlbVR5cGVzLmZpbHRlcigoaXRlbVR5cGUpID0+ICFjb25maWdTdGF0ZS5wb3J0YWwuaXNQb3J0YWwgfHwgdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiIHx8IFwiQ1NWXCIgIT09IGl0ZW1UeXBlKTtcbiAgICB9XG4gICAgdGhpcy5vcHRpb25zID0gdGhpcy51cmxPcHRpb25zXG4gICAgICAuZmlsdGVyKCh7IHNob3cgfSkgPT4gc2hvdylcbiAgICAgIC5tYXAoKHsgdmFsdWUsIGljb24gfSkgPT4ge1xuICAgICAgY29uc3QgZW50cnkgPSB0eXBlb2YgdmFsdWUgIT09IFwic3RyaW5nXCIgPyBcIkFHU1wiIDogdmFsdWU7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBvcHRpb25UaXRsZTogdGhpcy5pMThuW2VudHJ5XS50aXRsZSxcbiAgICAgICAgdmFsdWU6IGVudHJ5LFxuICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5pMThuW2VudHJ5XS5kZXNjcmlwdGlvbixcbiAgICAgICAgaWNvblxuICAgICAgfTtcbiAgICB9KTtcbiAgICAvLyBTaW5jZSB3ZSByZS1hc3NpZ24gc3RvcmUgc3RhdGUgb24gbmV4dCBhbnl3YXksXG4gICAgLy8gdGhlc2Ugc2hvdWxkIGJlIHNhZmUgdG8gYmUgcmVzZXQgdG8gYXZvaWQgZGFuZ2xpbmcgZGF0YVxuICAgIGFkZEl0ZW1TdGF0ZS5kYXRhVXJsID0gbnVsbDtcbiAgICBhZGRJdGVtU3RhdGUuZmlsZU5hbWUgPSBudWxsO1xuICAgIGFkZEl0ZW1TdGF0ZS5nZW9KU09OUmVzb3VyY2UgPSBudWxsO1xuICAgIGFkZEl0ZW1TdGF0ZS5jc3ZSZXNvdXJjZSA9IG51bGw7XG4gIH1cbiAgYXN5bmMgZ2V0U2VydmljZUluZm8oY2hlY2tBdXRoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgdXJsLCB0eXBlLCBzdG9yZUF1dGggfSA9IHRoaXMudXJsRGF0YTtcbiAgICBjb25zdCB7IGVycm9yLCByZXN1bHQgfSA9IGF3YWl0IGdldFVybFNlcnZpY2VJbmZvKHtcbiAgICAgIHVybCxcbiAgICAgIGN1c3RvbVBhcmFtZXRlcnM6IGFkZEl0ZW1TdGF0ZS5jdXN0b21QYXJhbWV0ZXJzLFxuICAgICAgdHlwZSxcbiAgICAgIGNoZWNrQXV0aCxcbiAgICAgIHN0b3JlQXV0aFxuICAgIH0pO1xuICAgIGlmIChlcnJvciB8fCAhcmVzdWx0KSB7XG4gICAgICB0aGlzLmVycm9yID0gdHJ1ZTtcbiAgICAgIGlmICgoZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLm1lc3NhZ2UpID09PSBcImRvZXMgbm90IHBvaW50IHRvIGEgR0lTIHNlcnZlclwiKSB7XG4gICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gdGhpcy5pMThuLnNlcnZpY2VOb3RHSVM7XG4gICAgICB9XG4gICAgICBlbHNlIGlmICgoX2EgPSBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IubWVzc2FnZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluY2x1ZGVzKFwiZG9lc24ndCBzdXBwb3J0IEdlb0pTT04gb3V0cHV0XCIpKSB7XG4gICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gdGhpcy5pMThuLnVuc3VwcG9ydGVkV0ZTR2VvSlNPTk91dHB1dEZvcm1hdDtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBzd2l0Y2ggKGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5jb2RlKSB7XG4gICAgICAgICAgY2FzZSBcInNlcnZpY2VOb3RFeGlzdFwiOlxuICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSB0aGlzLmkxOG4uc2VydmljZU5vdEV4aXN0O1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcInVuYXV0aG9yaXplZFwiOlxuICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBcIlVuYXV0aG9yaXplZFwiOyAvLyBUT0RPOiBHZXQgcHJvcGVyIGVycm9yIG1lc3NhZ2luZywgdGhlbiBsb2NhbGl6ZVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcInVuc3VwcG9ydGVkV0ZTVmVyc2lvblwiOlxuICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSB0aGlzLmkxOG4udW5zdXBwb3J0ZWRXRlNWZXJzaW9uO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcImludmFsaWRXTVRTXCI6XG4gICAgICAgICAgICB0aGlzLmVycm9yTWVzc2FnZSA9IHRoaXMuaTE4bi5pbnZhbGlkV01UUztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJpbnZhbGlkU3BhdGlhbFJlZlwiOlxuICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSB0aGlzLmkxOG4uaW52YWxpZFNwYXRpYWxSZWY7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiZW1wdHlGZWF0dXJlTGF5ZXJcIjpcbiAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gdGhpcy5pMThuLmVtcHR5RmVhdHVyZUxheWVyO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gdGhpcy5pMThuW2Vycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5jb2RlXSB8fCB0aGlzLmkxOG4uc2VydmljZU5vdEV4aXN0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbiAgaGFuZGxlTG9hZENoYW5nZShfb2xkVmFsdWUsIG5ld1ZhbHVlKSB7XG4gICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdChuZXdWYWx1ZSk7XG4gIH1cbiAgY2hhbmdlT3B0aW9uKHR5cGUpIHtcbiAgICB0aGlzLnByZXZpb3VzU2VsZWN0ZWRPcHRpb24gPSB0aGlzLnNlbGVjdGVkT3B0aW9uO1xuICAgIHRoaXMuc2VsZWN0ZWRPcHRpb24gPSBpc0FHUyh0eXBlKSA/IFwiQUdTXCIgOiB0eXBlO1xuICAgIHRoaXMudXJsRGF0YS50eXBlID0gdHlwZTtcbiAgICAvLyBMb2cgdGVsZW1ldHJ5IGV2ZW50IGlmIG9wdGlvbiBpcyBtYW51YWxseSBjaGFuZ2VkIHRvIGEgZGlmZmVyZW50IHR5cGVcbiAgICBpZiAodGhpcy5wcmV2aW91c1NlbGVjdGVkT3B0aW9uICE9PSB0aGlzLnNlbGVjdGVkT3B0aW9uKSB7XG4gICAgICB0aGlzLmxvZ0NoYW5nZU9wdGlvbkV2ZW50KCk7XG4gICAgfVxuICAgIHRoaXMuZGV0ZXJtaW5lTmV4dFRleHQoKTtcbiAgfVxuICBhc3luYyBkZXRlY3RUeXBlKHVybCkge1xuICAgIGlmICh1cmwpIHtcbiAgICAgIGNvbnN0IHsgaXNQb3J0YWwgfSA9IGNvbmZpZ1N0YXRlLnBvcnRhbDtcbiAgICAgIGNvbnN0IHsgcmVzdWx0OiB0eXBlIH0gPSBnZXRVcmxUeXBlKHVybCwgaXNQb3J0YWwpO1xuICAgICAgcmV0dXJuIHR5cGU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnVybERhdGEudHlwZTtcbiAgfVxuICBhc3luYyBoYW5kbGVOZXdVcmwoYXJncykge1xuICAgIGNvbnN0IHsgdXJsIH0gPSBhcmdzO1xuICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgdGhpcy5yZXNldEVycm9yKCk7XG4gICAgaWYgKHRoaXMudXJsRGF0YS51cmwgIT09IHVybCkge1xuICAgICAgdGhpcy5yZXNldFVybERhdGEoKTtcbiAgICAgIHRoaXMucmVzZXRTZXJ2aWNlSW5mbygpO1xuICAgICAgY29uc3QgZGV0ZWN0ZWRUeXBlID0gYXdhaXQgdGhpcy5kZXRlY3RUeXBlKHVybCk7XG4gICAgICB0aGlzLnVybERhdGEudXJsID0gdXJsO1xuICAgICAgdGhpcy51cmxEYXRhLnR5cGUgPSBkZXRlY3RlZFR5cGU7XG4gICAgICBpZiAoaXNBR1MoZGV0ZWN0ZWRUeXBlKSkge1xuICAgICAgICBjb25zdCBzZXJ2aWNlSW5mbyA9IGF3YWl0IHRoaXMuZ2V0U2VydmljZUluZm8oZmFsc2UpO1xuICAgICAgICBzZXJ2aWNlSW5mbyAmJiB0aGlzLnNldFNlcnZpY2VJbmZvU3RhdGUoc2VydmljZUluZm8pO1xuICAgICAgfVxuICAgICAgdGhpcy5jaGFuZ2VPcHRpb24oZGV0ZWN0ZWRUeXBlKTtcbiAgICB9XG4gICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gIH1cbiAgcmVzZXRVcmxEYXRhKCkge1xuICAgIGNvbnN0IHsgdXJsRGF0YSB9ID0gdGhpcztcbiAgICB1cmxEYXRhLnVybCA9IG51bGw7XG4gICAgdXJsRGF0YS50eXBlID0gbnVsbDtcbiAgICB1cmxEYXRhLmlzU2VjdXJlZCA9IG51bGw7XG4gICAgdXJsRGF0YS5zdG9yZUF1dGggPSBudWxsO1xuICAgIHVybERhdGEuYWxsb3dTdG9yZWRBdXRoID0gbnVsbDtcbiAgICB1cmxEYXRhLnNlcnZpY2VJbmZvID0gbnVsbDtcbiAgICB1cmxEYXRhLnRpdGxlID0gbnVsbDtcbiAgICB1cmxEYXRhLnRhZ3MgPSBudWxsO1xuICAgIHVybERhdGEuc25pcHBldCA9IG51bGw7XG4gIH1cbiAgLy8gUHJldmVudCBzdGFsZSBzZXJ2aWNlIGluZm8gZnJvbSBwZXJzaXN0aW5nIG9uIHVybCBjaGFuZ2VcbiAgcmVzZXRTZXJ2aWNlSW5mbygpIHtcbiAgICBhZGRJdGVtU3RhdGUuYWdzVHlwZSA9IG51bGw7XG4gICAgYWRkSXRlbVN0YXRlLmRlc2NyaXB0aW9uID0gbnVsbDtcbiAgICBhZGRJdGVtU3RhdGUuZXh0ZW50ID0gbnVsbDtcbiAgICBhZGRJdGVtU3RhdGUudGh1bWJuYWlsVG9rZW4gPSBudWxsO1xuICB9XG4gIGFzeW5jIGhhbmRsZVBhZ2VUcmFuc2l0aW9uKCkge1xuICAgIGNvbnN0IHsgdXJsRGF0YSB9ID0gdGhpcztcbiAgICAvLyBUT0RPOiByZWZhY3RvciB0aGlzIG9uY2Ugd2UgcmVtb3ZlIHRoZSBzaWRlLWVmZmVjdCBmcm9tIGBjdXN0b20tcGFyYW1ldGVyc2BcbiAgICBjb25zdCB7IGN1c3RvbVBhcmFtZXRlcnMgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBpZiAodGhpcy5zZWxlY3RlZE9wdGlvbiA9PT0gXCJEb2N1bWVudCBMaW5rXCIpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjb25zdCBjaGVja0F1dGggPSAhIXVybERhdGEuaXNTZWN1cmVkO1xuICAgIGFkZEl0ZW1TdGF0ZS5jaGVja0F1dGggPSBjaGVja0F1dGg7XG4gICAgLy8gISBGb3IgQUdTIGNhc2UsIGBnZXRTZXJ2aWNlSW5mb2AgaXMgYWxyZWFkeSBjYWxsZWQgb25jZS5cbiAgICAvLyBUT0RPOiBTbyByZWZhY3RvciBvbmNlIHdlIGNhbiBnZXQgdGhlIHNpZ24gaW4gcG9wdXAgdG8gc2hvdyB1cCBlYXNpZXJcbiAgICBjb25zdCBzZXJ2aWNlSW5mbyA9IGF3YWl0IHRoaXMuZ2V0U2VydmljZUluZm8oY2hlY2tBdXRoKTtcbiAgICBzZXJ2aWNlSW5mbyAmJiB0aGlzLnNldFNlcnZpY2VJbmZvU3RhdGUoc2VydmljZUluZm8pO1xuICAgIGlmIChjdXN0b21QYXJhbWV0ZXJzLmxlbmd0aCA+IDAgJiYgY29uZmlnU3RhdGUuYXBpID09PSAzKSB7XG4gICAgICAvLyBgc2VydmljZUluZm8uY3VzdG9tUGFyYW1ldGVyc2AgaXMgYWxyZWFkeSBzZXQgYWZ0ZXIgd2UgZmV0Y2ggc2VydmljZSBpbmZvXG4gICAgICAvLyAgYW5kIHNldEN1c3RvbVBhcmFtZXRlcnMgZG9lc24ndCBleGlzdCBmb3IgdjRcbiAgICAgIGF3YWl0IGhhbmRsZUN1c3RvbVBhcmFtZXRlclVwZGF0ZSh1cmxEYXRhLnNlcnZpY2VJbmZvLCB1cmxEYXRhLnR5cGUsIGN1c3RvbVBhcmFtZXRlcnMpO1xuICAgIH1cbiAgICByZXR1cm4gISFzZXJ2aWNlSW5mbztcbiAgfVxuICAvKipcbiAgICogVGVsZW1ldHJ5IGhhbmRsaW5nIGZvciB3aGVuIGFuIG9wdGlvbiBpcyBtYW51YWxseSBjaGFuZ2VkXG4gICAqL1xuICBsb2dDaGFuZ2VPcHRpb25FdmVudCgpIHtcbiAgICBjb25zdCB0ZWxlbWV0cnkgPSBjb25maWdTdGF0ZS50ZWxlbWV0cnk7XG4gICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgIGV2ZW50VHlwZTogXCJvdGhlclwiLFxuICAgICAgcGFnZU5hbWU6IFwibXkgY29udGVudFwiLFxuICAgICAgY2F0ZWdvcnk6IFwibmV3IGl0ZW0gdXJsIHR5cGUgY2hhbmdlXCIsXG4gICAgICBkZXRhaWxzOiB0aGlzLnVybERhdGEudXJsLFxuICAgICAgbGFiZWw6IGAke3RoaXMucHJldmlvdXNTZWxlY3RlZE9wdGlvbn0sICR7dGhpcy5zZWxlY3RlZE9wdGlvbn1gXG4gICAgfTtcbiAgICB0ZWxlbWV0cnkgPT09IG51bGwgfHwgdGVsZW1ldHJ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlbWV0cnkubG9nRXZlbnQocGF5bG9hZCk7XG4gIH1cbiAgc2V0TmV4dFBhZ2UoKSB7XG4gICAgY29uc3QgeyBzZWxlY3RlZE9wdGlvbiwgYWRkRGlyZWN0VG9NYXAgfSA9IHRoaXM7XG4gICAgbGV0IG5leHRQYWdlO1xuICAgIGlmIChpc0FHUyh0aGlzLnVybERhdGEudHlwZSkpIHtcbiAgICAgIG5leHRQYWdlID0gdGhpcy51cmxEYXRhLnN0b3JlQXV0aCA/IFwiYXV0aFwiIDogXCJpdGVtUHJvcGVydGllc1wiO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHN3aXRjaCAoc2VsZWN0ZWRPcHRpb24pIHtcbiAgICAgICAgY2FzZSBcIldNU1wiOlxuICAgICAgICAgIG5leHRQYWdlID0gXCJidWxrTGF5ZXJTZWxlY3RcIjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIldGU1wiOlxuICAgICAgICBjYXNlIFwiV01UU1wiOlxuICAgICAgICAgIG5leHRQYWdlID0gXCJzaW5nbGVMYXllclNlbGVjdFwiO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiQ1NWXCI6XG4gICAgICAgIGNhc2UgXCJHZW9Kc29uXCI6XG4gICAgICAgICAgbmV4dFBhZ2UgPSBcInB1Ymxpc2hTZWxlY3RcIjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIlRpbGUgTGF5ZXJcIjpcbiAgICAgICAgICBuZXh0UGFnZSA9IFwidGlsZUxheWVyRnJvbVVybFwiO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICAvLyBUT0RPOiBtb3ZlIHRoaXMgYmFjayBvbmNlIHdlIGZpbmFsaXplIHNwZWMgaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAvaXNzdWVzLzQ1NzE0XG4gICAgICAgIGNhc2UgXCJPR0NGZWF0dXJlU2VydmVyXCI6XG4gICAgICAgICAgaWYgKGFkZERpcmVjdFRvTWFwKSB7XG4gICAgICAgICAgICBuZXh0UGFnZSA9IFwic2luZ2xlTGF5ZXJTZWxlY3RcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBuZXh0UGFnZSA9IFwiaXRlbVByb3BlcnRpZXNcIjtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5uZXh0UGFnZSA9IG5leHRQYWdlO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyBpMThuLCBzZWxlY3RlZE9wdGlvbiwgdXJsRGF0YSwgZGV0ZXJtaW5lTmV4dFRleHQsIGFkZERpcmVjdFRvTWFwIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgdXJsID0gXCJcIiwgaXNTZWN1cmVkLCBhZGRBc0Jhc2VtYXAsIGFsbG93U3RvcmVkQXV0aCB9ID0gdXJsRGF0YTtcbiAgICBjb25zdCB7IGNvbmZpZzogeyBoZWxwTWFwLCBoZWxwQmFzZSB9LCB1c2VyIH0gPSBjb25maWdTdGF0ZTtcbiAgICBjb25zdCBhZ3NJdGVtVHlwZXMgPSB1bmlxdWUoT2JqZWN0LnZhbHVlcyhhZ3NTZXJ2ZXJNYXApKTtcbiAgICBjb25zdCBzaG93Q3VzdG9tUGFyYW1ldGVyc1R5cGUgPSBbXG4gICAgICBcIldNU1wiLFxuICAgICAgXCJXRlNcIixcbiAgICAgIFwiV01UU1wiLFxuICAgICAgXCJPR0NGZWF0dXJlU2VydmVyXCIsXG4gICAgICAuLi5hZ3NJdGVtVHlwZXNcbiAgICBdO1xuICAgIGNvbnN0IHNob3dDdXN0b21QYXJhbWV0ZXJzID0gc2hvd0N1c3RvbVBhcmFtZXRlcnNUeXBlLmluY2x1ZGVzKHVybERhdGEudHlwZSk7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJhcmNnaXMtbmV3LWl0ZW0tbG9hZGVyXCIsIHsgYWN0aXZlOiB0aGlzLmxvYWRpbmcsIHRleHQ6IGkxOG4uZ2V0U2VydmljZUluZm8gfSksIGgoXCJhcmNnaXMtbmV3LWl0ZW0tYWxlcnRcIiwgeyBhY3RpdmU6IHRoaXMuZXJyb3IsIGRlc2NyaXB0aW9uOiB0aGlzLmVycm9yTWVzc2FnZSwgb25BbGVydERpc21pc3M6ICgpID0+IHtcbiAgICAgICAgdGhpcy5lcnJvciA9IGZhbHNlO1xuICAgICAgICB0aGlzLmVycm9yTWVzc2FnZSA9IFwiXCI7XG4gICAgICB9IH0pLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLXVybFwiLCB7IHVybDogdXJsLCBvbk5ld0l0ZW1VcmxDaGFuZ2U6IChldmVudCkgPT4gdGhpcy5oYW5kbGVOZXdVcmwoZXZlbnQuZGV0YWlsKSwgc3VwcG9ydGVkU2VydmljZXM6IChfYSA9IHRoaXMuYWxsb3dlZEl0ZW1UeXBlcykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUuYWxsb3dlZEl0ZW1UeXBlcywgb25VcmxMb2FkZXJVcGRhdGU6IHRoaXMuaGFuZGxlTG9hZGVyVXBkYXRlLCByZWY6IChlbGUpID0+ICh0aGlzLml0ZW1VcmxSZWYgPSBlbGUpIH0pLCBoKFwiYXJjZ2lzLXNlbGVjdFwiLCB7IHJlZjogKGVsZSkgPT4gKHRoaXMuc2VsZWN0UmVmID0gZWxlKSwgZW1wdHlUZXh0OiBpMThuLnVuZGV0ZWN0ZWQsIHNlbGVjdGVkT3B0aW9uOiBzZWxlY3RlZE9wdGlvbiwgb3B0aW9uczogdGhpcy5vcHRpb25zLCBsYWJlbDogaTE4bi5sYWJlbCwgb25BcmNnaXNPcHRpb25DaGFuZ2U6IChldmVudCkgPT4gdGhpcy5jaGFuZ2VPcHRpb24oZXZlbnQuZGV0YWlsKSB9KSwgc2hvd0N1c3RvbVBhcmFtZXRlcnMgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJjdXN0b20tcGFyYW0tY29udGFpbmVyXCIgfSwgaChcImFyY2dpcy1uZXctaXRlbS1jdXN0b20tcGFyYW1ldGVyc1wiLCB7IGl0ZW1UeXBlOiB1cmxEYXRhLnR5cGUgfSkpKSwgISF1c2VyICYmIGlzU2VjdXJlZCAmJiBhbGxvd1N0b3JlZEF1dGggJiYgKGgoXCJhcmNnaXMtbmV3LWl0ZW0tc3dpdGNoLWNhcmRcIiwgeyBvblN3aXRjaENoYW5nZTogdGhpcy5oYW5kbGVBdXRoU3dpdGNoQ2hhbmdlLCBoZWFkZXI6IGkxOG5bYWRkRGlyZWN0VG9NYXAgPyBcInN0b3JlQXV0aE1WXCIgOiBcInN0b3JlQXV0aFwiXSwgaGVhZGVyTGluazogeyB0ZXh0OiBpMThuLmxlYXJuTW9yZSwgaHJlZjogYCR7aGVscEJhc2V9JHtoZWxwTWFwW1wiMTIwMDAwNTk3XCJdfWAgfSwgZGVmYXVsdENoZWNrZWQ6IHRoaXMudXJsRGF0YS5zdG9yZUF1dGggfSkpLCB0aGlzLnNob3dBZGRUb01hcCgpICYmIChoKFwiYXJjZ2lzLW5ldy1pdGVtLXN3aXRjaC1jYXJkXCIsIHsgaGVhZGVyOiBpMThuLnVzZUFzQmFzZU1hcCwgZGVmYXVsdENoZWNrZWQ6IGFkZEFzQmFzZW1hcCwgb25Td2l0Y2hDaGFuZ2U6ICh0b2dnbGVkKSA9PiB7XG4gICAgICAgIGNvbnN0IGFkZEFzQmFzZW1hcCA9IHRvZ2dsZWQuZGV0YWlsO1xuICAgICAgICB1cmxEYXRhLmFkZEFzQmFzZW1hcCA9IGFkZEFzQmFzZW1hcDtcbiAgICAgICAgZGV0ZXJtaW5lTmV4dFRleHQoKTtcbiAgICAgIH0gfSkpKSk7XG4gIH1cbiAgZ2V0IGVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgXCJsb2FkaW5nXCI6IFtcImhhbmRsZUxvYWRDaGFuZ2VcIl1cbiAgfTsgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc1VybFR5cGUuc3R5bGUgPSBhcmNnaXNOZXdJdGVtUGFnZXNVcmxUeXBlQ3NzO1xuXG4vLyBNYXAgemlwIGZpbGUgb3B0aW9ucyB0byB0aGVpciB0ZWxlbWV0cnkgZGV0YWlsIGNvdW50ZXJwYXJ0c1xudmFyIFppcEZpbGVUZWxlbWV0cnk7XG4oZnVuY3Rpb24gKFppcEZpbGVUZWxlbWV0cnkpIHtcbiAgWmlwRmlsZVRlbGVtZXRyeVtcIlNoYXBlZmlsZVwiXSA9IFwic2hhcGVmaWxlXCI7XG4gIFppcEZpbGVUZWxlbWV0cnlbXCJGaWxlIEdlb2RhdGFiYXNlXCJdID0gXCJmZ2RiXCI7XG4gIFppcEZpbGVUZWxlbWV0cnlbXCJQaG90b3Mgd2l0aCBMb2NhdGlvbnNcIl0gPSBcImdlb3RhZ2dlZCBwaG90b3NcIjtcbiAgWmlwRmlsZVRlbGVtZXRyeVtcIkRlZXAgTGVhcm5pbmcgUGFja2FnZVwiXSA9IFwiZGVlcCBsZWFybmluZyBwYWNrYWdlXCI7XG4gIFppcEZpbGVUZWxlbWV0cnlbXCJNYXAgVGVtcGxhdGVcIl0gPSBcIm1hcCB0ZW1wbGF0ZVwiO1xuICBaaXBGaWxlVGVsZW1ldHJ5W1wiQ0FEIERyYXdpbmdcIl0gPSBcImNhZFwiO1xuICBaaXBGaWxlVGVsZW1ldHJ5W1wiQ1NWIENvbGxlY3Rpb25cIl0gPSBcImNzdiBjb2xsZWN0aW9uXCI7XG4gIFppcEZpbGVUZWxlbWV0cnlbXCJLTUwgQ29sbGVjdGlvblwiXSA9IFwia21sIGNvbGxlY3Rpb25cIjtcbiAgWmlwRmlsZVRlbGVtZXRyeVtcIkRlc2t0b3AgQXBwbGljYXRpb24gVGVtcGxhdGVcIl0gPSBcImRlc2t0b3AgYXBwIHRlbXBsYXRlXCI7XG4gIFppcEZpbGVUZWxlbWV0cnlbXCJHZW9wcm9jZXNzaW5nIFNhbXBsZVwiXSA9IFwiZ2VvcHJvY2Vzc2luZyBzYW1wbGVcIjtcbiAgWmlwRmlsZVRlbGVtZXRyeVtcIkNvZGUgU2FtcGxlXCJdID0gXCJjb2RlIHNhbXBsZVwiO1xuICBaaXBGaWxlVGVsZW1ldHJ5W1wiQXJjUGFkIFBhY2thZ2VcIl0gPSBcImFyY3BhZCBwYWNrYWdlXCI7XG4gIFppcEZpbGVUZWxlbWV0cnlbXCJBcHBCdWlsZGVyIFdpZGdldCBQYWNrYWdlXCJdID0gXCJ3YWIgY3VzdG9tIHdpZGdldFwiO1xuICBaaXBGaWxlVGVsZW1ldHJ5W1wiSW1hZ2UgQ29sbGVjdGlvblwiXSA9IFwiaW1hZ2UgY29sbGVjdGlvblwiO1xuICBaaXBGaWxlVGVsZW1ldHJ5W1wiaVdvcmsgUGFnZXNcIl0gPSBcIml3b3JrIHBhZ2VzXCI7XG4gIFppcEZpbGVUZWxlbWV0cnlbXCJpV29yayBOdW1iZXJzXCJdID0gXCJpd29yayBudW1iZXJzXCI7XG4gIFppcEZpbGVUZWxlbWV0cnlbXCJpV29yayBLZXlub3RlXCJdID0gXCJpd29yayBrZXlub3RlXCI7XG4gIFppcEZpbGVUZWxlbWV0cnlbXCJHTUxcIl0gPSBcImdtbFwiO1xuICBaaXBGaWxlVGVsZW1ldHJ5W1wiQXBwbGljYXRpb25cIl0gPSBcImFwcGxpY2F0aW9uXCI7XG59KShaaXBGaWxlVGVsZW1ldHJ5IHx8IChaaXBGaWxlVGVsZW1ldHJ5ID0ge30pKTtcblxuY29uc3QgY29kZVNhbXBsZUxhbmd1YWdlcyA9IFtcbiAgXCJDXCIsXG4gIFwiQyNcIixcbiAgXCJDKytcIixcbiAgXCJKYXZhXCIsXG4gIFwiUGVybFwiLFxuICBcIlBIUFwiLFxuICBcIlB5dGhvblwiLFxuICBcIlJ1YnlcIixcbiAgXCJTUUxcIixcbiAgXCJWQlwiLFxuICBcIldQRlwiLFxuICBcIk90aGVyXCJcbl07XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1QYWdlc1ppcFNlbGVjdENzcyA9IFwiOmhvc3R7cGFkZGluZy1ib3R0b206MnJlbTttaW4taGVpZ2h0OjQ2MHB4fS5maWxle2ZvbnQtc2l6ZTowLjg3NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMSk7bWFyZ2luOjA7cGFkZGluZzowfS5sYWJlbHtmb250LXdlaWdodDo1MDA7Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0xKTttYXJnaW4tYm90dG9tOjAuNzVyZW07bWFyZ2luLXRvcDowO2xpbmUtaGVpZ2h0OjE4cHh9LmxhYmVsLS10b3B7ZGlzcGxheTpibG9jazttYXJnaW4tdG9wOjEuNXJlbX0udHJhaWxlci0we21hcmdpbi1ib3R0b206MH1cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbVBhZ2VzWmlwU2VsZWN0ID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVXBkYXRlUGFnZVwiLCA3KTtcbiAgICB0aGlzLml0ZW1UeXBlcyA9IFtdO1xuICAgIHRoaXMudXBkYXRlSG9zdGVkU3RhdHVzID0gKGUpID0+IHtcbiAgICAgIHRoaXMucHVibGlzaCA9IGUudGFyZ2V0LnZhbHVlO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVDaGFuZ2UgPSAoZXZlbnQpID0+IHtcbiAgICAgIHRoaXMuc2VsZWN0ZWQgPSBldmVudC5kZXRhaWw7XG4gICAgfTtcbiAgICB0aGlzLnNlbGVjdGVkID0gXCJTaGFwZWZpbGVcIjtcbiAgICB0aGlzLnB1Ymxpc2ggPSBcImhvc3RlZFwiO1xuICAgIHRoaXMubGFuZ3VhZ2UgPSBcIkNcIjtcbiAgICB0aGlzLnBhZCA9IFwicHJvamVjdFwiO1xuICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLml0ZW1JbmZvSTE4TiA9IHVuZGVmaW5lZDtcbiAgfVxuICBoYW5kbGVOZXh0KCkge1xuICAgIGNvbnN0IHNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZCA9PT0gXCJQaG90b3Mgd2l0aCBMb2NhdGlvbnNcIiA/IFwiSW1hZ2UgQ29sbGVjdGlvblwiIDogdGhpcy5zZWxlY3RlZDtcbiAgICBpZiAodGhpcy5zZWxlY3RlZCA9PT0gXCJBcHBsaWNhdGlvblwiKSB7XG4gICAgICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPSBcImFwcGxpY2F0aW9uXCI7XG4gICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJhcHBsaWNhdGlvblwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgeyB0eXBlLCB0eXBlS2V5d29yZHMsIHRodW1ibmFpbFVSTCB9ID0gYWRkQ3JlYXRlSXRlbVR5cGVzW3NlbGVjdGVkXTtcbiAgICBpZiAodGhpcy5zZWxlY3RlZCA9PT0gXCJBcmNQYWQgUGFja2FnZVwiKSB7XG4gICAgICB0eXBlS2V5d29yZHMucHVzaCh0aGlzLnBhZCA9PT0gXCJwcm9qZWN0XCIgPyBcIkFyY1BhZCBQcm9qZWN0XCIgOiBcIkFyY1BhZCBUZW1wbGF0ZVwiKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuc2VsZWN0ZWQgPT09IFwiQ29kZSBTYW1wbGVcIikge1xuICAgICAgdHlwZUtleXdvcmRzLnB1c2godGhpcy5sYW5ndWFnZSk7XG4gICAgfVxuICAgIGlmICh0aGlzLnNlbGVjdGVkID09PSBcIlBob3RvcyB3aXRoIExvY2F0aW9uc1wiKSB7XG4gICAgICB0eXBlS2V5d29yZHMucHVzaChcIlBob3RvIGxvY2F0aW9uc1wiKTtcbiAgICB9XG4gICAgYWRkSXRlbVN0YXRlLm5ld0l0ZW1Nb2RlID0gXCJmaWxlXCI7XG4gICAgYWRkSXRlbVN0YXRlLnR5cGUgPSB0eXBlO1xuICAgIGFkZEl0ZW1TdGF0ZS50eXBlS2V5d29yZHMgPSB0eXBlS2V5d29yZHM7XG4gICAgYWRkSXRlbVN0YXRlLnRodW1ibmFpbFVSTCA9IHRodW1ibmFpbFVSTDtcbiAgICBhZGRJdGVtU3RhdGUuZW5hYmxlUHVibGlzaGluZyA9XG4gICAgICB0aGlzLnB1Ymxpc2ggPT09IFwiaG9zdGVkXCIgJiYgdGhpcy5jYW5QdWJsaXNoWmlwVHlwZSgpICYmIGNvbmZpZ1N0YXRlLmFsbG93UHVibGlzaDtcbiAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJpdGVtUHJvcGVydGllc1wiKTtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLmkxOG4gPSB1aVN0b3JlU3RhdGUuaTE4bi56aXBTZWxlY3Q7XG4gICAgdGhpcy5pdGVtSW5mb0kxOE4gPSB1aVN0b3JlU3RhdGUuaTE4bi5pdGVtVHlwZUluZm87XG4gICAgY29uc3QgeyBwb3J0YWwsIHVzZXIgfSA9IGNvbmZpZ1N0YXRlO1xuICAgIGlmICghaXNIb3N0ZWRQb3J0YWwocG9ydGFsKSkge1xuICAgICAgdGhpcy5wdWJsaXNoID0gXCJub3QtaG9zdGVkXCI7XG4gICAgfVxuICAgIGNvbnN0IF9pc1B1YmxpY1VzZXIgPSBpc1B1YmxpY1VzZXIodXNlcik7XG4gICAgY29uc3QgaXNFbnRlcnByaXNlID0gcG9ydGFsLmlzUG9ydGFsO1xuICAgIHRoaXMuaXRlbVR5cGVzID0gW1xuICAgICAgeyB2YWx1ZTogXCJTaGFwZWZpbGVcIiwgaWNvbjogXCJmaWxlLXppcFwiLCBwdWJsaXNoYWJsZTogdHJ1ZSB9LFxuICAgICAgeyB2YWx1ZTogXCJGaWxlIEdlb2RhdGFiYXNlXCIsIGljb246IFwiZGF0YVwiLCBwdWJsaXNoYWJsZTogdHJ1ZSB9LFxuICAgICAgeyB2YWx1ZTogXCJQaG90b3Mgd2l0aCBMb2NhdGlvbnNcIiwgaWNvbjogXCJpbWFnZXNcIiwgcHVibGlzaGFibGU6IHRydWUsIGhpZGU6IGlzRW50ZXJwcmlzZSB9LFxuICAgICAgeyB2YWx1ZTogXCJEZWVwIExlYXJuaW5nIFBhY2thZ2VcIiwgaWNvbjogXCJkZWVwLWxlYXJuaW5nXCIgfSxcbiAgICAgIHsgdmFsdWU6IFwiTWFwIFRlbXBsYXRlXCIsIGljb246IFwiZmlsZS16aXBcIiB9LFxuICAgICAgeyB2YWx1ZTogXCJDQUQgRHJhd2luZ1wiLCBpY29uOiBcImZpbGUtY2FkXCIgfSxcbiAgICAgIHsgdmFsdWU6IFwiQ1NWIENvbGxlY3Rpb25cIiwgaWNvbjogXCJmaWxlLWNzdlwiIH0sXG4gICAgICB7IHZhbHVlOiBcIktNTCBDb2xsZWN0aW9uXCIsIGljb246IFwibGF5ZXIta21sXCIgfSxcbiAgICAgIHsgdmFsdWU6IFwiRGVza3RvcCBBcHBsaWNhdGlvbiBUZW1wbGF0ZVwiLCBpY29uOiBcImZpbGUtemlwXCIgfSxcbiAgICAgIHsgdmFsdWU6IFwiR2VvcHJvY2Vzc2luZyBTYW1wbGVcIiwgaWNvbjogXCJoYW1tZXJcIiB9LFxuICAgICAgeyB2YWx1ZTogXCJDb2RlIFNhbXBsZVwiLCBpY29uOiBcImZpbGUtY29kZVwiIH0sXG4gICAgICB7IHZhbHVlOiBcIkFyY1BhZCBQYWNrYWdlXCIsIGljb246IFwiY3ViZVwiIH0sXG4gICAgICB7IHZhbHVlOiBcIkFwcEJ1aWxkZXIgV2lkZ2V0IFBhY2thZ2VcIiwgaWNvbjogXCJhcHAtZ2VhclwiLCBoaWRlOiBfaXNQdWJsaWNVc2VyIH0sXG4gICAgICB7IHZhbHVlOiBcIkltYWdlIENvbGxlY3Rpb25cIiwgaWNvbjogXCJjb2xsZWN0aW9uXCIsIGhpZGU6IF9pc1B1YmxpY1VzZXIgfSxcbiAgICAgIHsgdmFsdWU6IFwiR01MXCIsIGljb246IFwiY29kZVwiLCBoaWRlOiBfaXNQdWJsaWNVc2VyIH0sXG4gICAgICB7IHZhbHVlOiBcIkFwcGxpY2F0aW9uXCIsIGljb246IFwiYXBwc1wiLCBoaWRlOiBfaXNQdWJsaWNVc2VyIH1cbiAgICBdO1xuICAgIC8vIEFkZCB0byBNVjogVHJpbSBkb3duIHNlbGVjdGFibGUgbGlzdCB0byBkZWZpbmVkIGFsbG93ZWRJdGVtVHlwZXMsIG90aGVyd2lzZSBhY2NlcHQgYWxsXG4gICAgaWYgKCEhY29uZmlnU3RhdGUuYWxsb3dlZEl0ZW1UeXBlcykge1xuICAgICAgdGhpcy5pdGVtVHlwZXMgPSB0aGlzLml0ZW1UeXBlcy5maWx0ZXIoKGl0ZW0pID0+IGNvbmZpZ1N0YXRlLmFsbG93ZWRJdGVtVHlwZXMuaW5jbHVkZXMoaXRlbS52YWx1ZSkpO1xuICAgIH1cbiAgfVxuICByZXBsYWNlVHlwZUFuZE5hbWUoc3RyLCBmaWxlTmFtZSkge1xuICAgIGNvbnN0IG5hbWVSZWdFeCA9IG5ldyBSZWdFeHAoL1xcJFxce2ZpbGVOYW1lXFx9L2cpO1xuICAgIGNvbnN0IHR5cGVSZWdFeCA9IG5ldyBSZWdFeHAoL1xcJFxce3R5cGVcXH0vZyk7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKHR5cGVSZWdFeCwgdGhpcy5zZWxlY3RlZCkucmVwbGFjZShuYW1lUmVnRXgsIGZpbGVOYW1lKTtcbiAgfVxuICBjYW5QdWJsaXNoWmlwVHlwZSgpIHtcbiAgICBjb25zdCB7IHVzZXIsIHBvcnRhbCB9ID0gY29uZmlnU3RhdGU7XG4gICAgY29uc3Qgc2VsZWN0ZWRJdGVtVHlwZSA9IHRoaXMuaXRlbVR5cGVzLmZpbmQoKGl0ZW1UeXBlKSA9PiBpdGVtVHlwZS52YWx1ZSA9PT0gdGhpcy5zZWxlY3RlZCk7XG4gICAgcmV0dXJuIHNlbGVjdGVkSXRlbVR5cGUucHVibGlzaGFibGUgJiYgY2FuUHVibGlzaFR5cGUodXNlciwgc2VsZWN0ZWRJdGVtVHlwZS52YWx1ZSwgcG9ydGFsKTtcbiAgfVxuICByZW5kZXJQdWJsaXNoKCkge1xuICAgIGNvbnN0IHsgaTE4biwgaXRlbUluZm9JMThOIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgcG9ydGFsIH0gPSBjb25maWdTdGF0ZTtcbiAgICBjb25zdCBmaWxlVHlwZSA9IGl0ZW1JbmZvSTE4Ti5sb3dlcmNhc2VEaXNwbGF5TmFtZVt0aGlzLnNlbGVjdGVkXTtcbiAgICBsZXQgb3B0aW9ucyA9IFtcImhvc3RlZFwiLCBcIm5vdC1ob3N0ZWRcIl07XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMuZmlsdGVyKChvcHRpb24pID0+IG9wdGlvbiAhPT0gXCJob3N0ZWRcIiB8fCBpc0hvc3RlZFBvcnRhbChwb3J0YWwpKTtcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgbnVsbCwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJ0cmFpbGVyLTBcIiB9LCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImxhYmVsIGxhYmVsLS10b3BcIiB9LCByZXBsYWNlSTE4TlN0cmluZyhpdGVtSW5mb0kxOE4uaG93VG9BZGQsIGZpbGVUeXBlLCBcImZpbGVUeXBlXCIpKSksIGgoXCJjYWxjaXRlLXRpbGUtc2VsZWN0LWdyb3VwXCIsIHsgbGF5b3V0OiBcInZlcnRpY2FsXCIgfSwgb3B0aW9ucy5tYXAoKHZhbHVlKSA9PiB7XG4gICAgICBjb25zdCBoZWFkaW5nID0gcmVwbGFjZUkxOE5TdHJpbmcodmFsdWUgPT09IFwiaG9zdGVkXCIgPyBpMThuW3ZhbHVlXS5oZWFkaW5nIDogaXRlbUluZm9JMThOLm5vbkhvc3RlZFRpdGxlLCBhZGRJdGVtU3RhdGUuZmlsZU5hbWUsIFwiZmlsZU5hbWVcIik7XG4gICAgICBjb25zdCBkZXNjcmlwdGlvbiA9IHJlcGxhY2VJMThOU3RyaW5nKHZhbHVlID09PSBcImhvc3RlZFwiID8gaTE4blt2YWx1ZV0uZGVzY3JpcHRpb24gOiBpdGVtSW5mb0kxOE4ubm9uSG9zdGVkRGVzY3JpcHRpb24sIGZpbGVUeXBlLCBcImZpbGVUeXBlXCIpO1xuICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS10aWxlLXNlbGVjdFwiLCB7IGNoZWNrZWQ6IHRoaXMucHVibGlzaCA9PT0gdmFsdWUsIHdpZHRoOiBcImZ1bGxcIiwgXCJpbnB1dC1lbmFibGVkXCI6IHRydWUsIFwiaW5wdXQtYWxpZ25tZW50XCI6IFwic3RhcnRcIiwgbmFtZTogXCJwdWJsaXNoXCIsIHZhbHVlOiB2YWx1ZSwgb25DYWxjaXRlVGlsZVNlbGVjdENoYW5nZTogdGhpcy51cGRhdGVIb3N0ZWRTdGF0dXMsIGhlYWRpbmc6IGhlYWRpbmcsIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiB9KSk7XG4gICAgfSkpKSk7XG4gIH1cbiAgcmVuZGVyTGFuZ3VhZ2VzKCkge1xuICAgIGNvbnN0IGxhbmd1YWdlcyA9IGNvZGVTYW1wbGVMYW5ndWFnZXMubWFwKCh2YWx1ZSkgPT4gKGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiB2YWx1ZSwgc2VsZWN0ZWQ6IHRoaXMubGFuZ3VhZ2UgPT09IHZhbHVlIH0sIHZhbHVlID09PSBcIk90aGVyXCIgPyB0aGlzLmkxOG4ub3RoZXIgOiB2YWx1ZSkpKTtcbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsga2V5OiBcImxhbmd1YWdlLWxhYmVsXCIgfSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJsYWJlbCBsYWJlbC0tdG9wXCIgfSwgdGhpcy5pMThuLmxhbmd1YWdlKSwgaChcImNhbGNpdGUtc2VsZWN0XCIsIHsgbGFiZWw6IHRoaXMuaTE4bi5sYW5ndWFnZSwgd2lkdGg6IFwiaGFsZlwiLCByZWY6IChlbCkgPT4ge1xuICAgICAgICB0aGlzLmxhbmd1YWdlU2VsZWN0ID0gZWw7XG4gICAgICB9LCBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6ICgpID0+ICh0aGlzLmxhbmd1YWdlID0gdGhpcy5sYW5ndWFnZVNlbGVjdC5zZWxlY3RlZE9wdGlvbi52YWx1ZSkgfSwgbGFuZ3VhZ2VzKSkpO1xuICB9XG4gIHJlbmRlclBhZCgpIHtcbiAgICBjb25zdCBwYWRPcHRpb25zID0gW1wicHJvamVjdFwiLCBcInRlbXBsYXRlXCJdLm1hcCgodmFsdWUpID0+IChoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyB2YWx1ZTogdmFsdWUsIHNlbGVjdGVkOiB0aGlzLnBhZCA9PT0gdmFsdWUgfSwgdGhpcy5pMThuLkFyY1BhZFt2YWx1ZV0pKSk7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGtleTogXCJwYWQtbGFiZWxcIiB9LCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImxhYmVsIGxhYmVsLS10b3BcIiB9LCB0aGlzLmkxOG4udHlwZSksIGgoXCJjYWxjaXRlLXNlbGVjdFwiLCB7IGxhYmVsOiBcIlwiLCB3aWR0aDogXCJoYWxmXCIsIHJlZjogKGVsKSA9PiB7XG4gICAgICAgIHRoaXMucGFkU2VsZWN0ID0gZWw7XG4gICAgICB9LCBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6ICgpID0+ICh0aGlzLnBhZCA9IHRoaXMucGFkU2VsZWN0LnNlbGVjdGVkT3B0aW9uLnZhbHVlKSB9LCBwYWRPcHRpb25zKSkpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGZpbGVOYW1lIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuaXRlbVR5cGVzXG4gICAgICAuZmlsdGVyKChpdGVtKSA9PiAhaXRlbS5oaWRlKVxuICAgICAgLm1hcCgoeyB2YWx1ZSwgaWNvbiB9KSA9PiAoe1xuICAgICAgb3B0aW9uVGl0bGU6IHRoaXMuaTE4blt2YWx1ZV0udGl0bGUsXG4gICAgICB2YWx1ZSxcbiAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmkxOG5bdmFsdWVdLmRlc2NyaXB0aW9uLFxuICAgICAgaWNvblxuICAgIH0pKTtcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgbnVsbCwgaChcImg0XCIsIHsgY2xhc3M6IFwibGFiZWxcIiB9LCB0aGlzLmkxOG4uZmlsZSksIGgoXCJwXCIsIHsgY2xhc3M6IFwiZmlsZVwiIH0sIGZpbGVOYW1lKSwgaChcImFyY2dpcy1zZWxlY3RcIiwgeyBjbGFzczogXCJsYWJlbC0tdG9wXCIsIHNlbGVjdGVkT3B0aW9uOiB0aGlzLnNlbGVjdGVkLCBvcHRpb25zOiBvcHRpb25zLCBsYWJlbDogdGhpcy5pMThuLml0ZW1UeXBlLCBvbkFyY2dpc09wdGlvbkNoYW5nZTogKGUpID0+IHtcbiAgICAgICAgLy8gTG9nIHdoaWNoIHR5cGUgb2YgemlwIGZpbGUgd2FzIHNlbGVjdGVkXG4gICAgICAgIGNvbnN0IHRlbGVtZXRyeSA9IGNvbmZpZ1N0YXRlLnRlbGVtZXRyeTtcbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICBldmVudFR5cGU6IFwib3RoZXJcIixcbiAgICAgICAgICBwYWdlTmFtZTogXCJteSBjb250ZW50XCIsXG4gICAgICAgICAgY2F0ZWdvcnk6IFwibmV3IGl0ZW0gemlwIGl0ZW0gdHlwZVwiLFxuICAgICAgICAgIGxhYmVsOiBaaXBGaWxlVGVsZW1ldHJ5W2UuZGV0YWlsXVxuICAgICAgICB9O1xuICAgICAgICB0ZWxlbWV0cnkgPT09IG51bGwgfHwgdGVsZW1ldHJ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlbWV0cnkubG9nRXZlbnQocGF5bG9hZCk7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBlLmRldGFpbDtcbiAgICAgIH0gfSksIHRoaXMuY2FuUHVibGlzaFppcFR5cGUoKSAmJlxuICAgICAgdWlTdG9yZVN0YXRlLndvcmtmbG93ICE9PSBcIm1hcFwiICYmXG4gICAgICBjb25maWdTdGF0ZS5hbGxvd1B1Ymxpc2ggJiZcbiAgICAgIHRoaXMucmVuZGVyUHVibGlzaCgpLCB0aGlzLnNlbGVjdGVkID09PSBcIkNvZGUgU2FtcGxlXCIgJiYgdGhpcy5yZW5kZXJMYW5ndWFnZXMoKSwgdGhpcy5zZWxlY3RlZCA9PT0gXCJBcmNQYWQgUGFja2FnZVwiICYmIHRoaXMucmVuZGVyUGFkKCkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzTmV3SXRlbVBhZ2VzWmlwU2VsZWN0LnN0eWxlID0gYXJjZ2lzTmV3SXRlbVBhZ2VzWmlwU2VsZWN0Q3NzO1xuXG5jb25zdCB0aW1lWm9uZUlkcyA9IHtcbiAgMDogXCJEYXRlbGluZSBTdGFuZGFyZCBUaW1lXCIsXG4gIDIwMDogXCJIYXdhaWlhbiBTdGFuZGFyZCBUaW1lXCIsXG4gIDMwMDogXCJBbGFza2FuIFN0YW5kYXJkIFRpbWVcIixcbiAgNDAwOiBcIlBhY2lmaWMgU3RhbmRhcmQgVGltZVwiLFxuICA0MTA6IFwiUGFjaWZpYyBTdGFuZGFyZCBUaW1lIChNZXhpY28pXCIsXG4gIDUyMDogXCJVUyBNb3VudGFpbiBTdGFuZGFyZCBUaW1lXCIsXG4gIDUxMDogXCJNb3VudGFpbiBTdGFuZGFyZCBUaW1lIChNZXhpY28pXCIsXG4gIDUwMDogXCJNb3VudGFpbiBTdGFuZGFyZCBUaW1lXCIsXG4gIDYxMDogXCJDZW50cmFsIEFtZXJpY2EgU3RhbmRhcmQgVGltZVwiLFxuICA2MjA6IFwiQ2VudHJhbCBTdGFuZGFyZCBUaW1lXCIsXG4gIDYzMDogXCJDZW50cmFsIFN0YW5kYXJkIFRpbWUgKE1leGljbylcIixcbiAgNjAwOiBcIkNhbmFkYSBDZW50cmFsIFN0YW5kYXJkIFRpbWVcIixcbiAgNzEwOiBcIlNBIFBhY2lmaWMgU3RhbmRhcmQgVGltZVwiLFxuICA3MDA6IFwiRWFzdGVybiBTdGFuZGFyZCBUaW1lXCIsXG4gIDcyMDogXCJVUyBFYXN0ZXJuIFN0YW5kYXJkIFRpbWVcIixcbiAgNzMwOiBcIlZlbmV6dWVsYSBTdGFuZGFyZCBUaW1lXCIsXG4gIDg1MDogXCJQYXJhZ3VheSBTdGFuZGFyZCBUaW1lXCIsXG4gIDgwMDogXCJBdGxhbnRpYyBTdGFuZGFyZCBUaW1lXCIsXG4gIDgxMDogXCJDZW50cmFsIEJyYXppbGlhbiBTdGFuZGFyZCBUaW1lXCIsXG4gIDgzMDogXCJTQSBXZXN0ZXJuIFN0YW5kYXJkIFRpbWVcIixcbiAgODIwOiBcIlBhY2lmaWMgU0EgU3RhbmRhcmQgVGltZVwiLFxuICA5MDA6IFwiTmV3Zm91bmRsYW5kIFN0YW5kYXJkIFRpbWVcIixcbiAgOTEwOiBcIkUuIFNvdXRoIEFtZXJpY2EgU3RhbmRhcmQgVGltZVwiLFxuICA5NTA6IFwiQXJnZW50aW5hIFN0YW5kYXJkIFRpbWVcIixcbiAgOTQwOiBcIlNBIEVhc3Rlcm4gU3RhbmRhcmQgVGltZVwiLFxuICA5MjA6IFwiR3JlZW5sYW5kIFN0YW5kYXJkIFRpbWVcIixcbiAgOTMwOiBcIk1vbnRldmlkZW8gU3RhbmRhcmQgVGltZVwiLFxuICAxMDEwOiBcIlVUQy0wMlwiLFxuICAxMDAwOiBcIk1pZC1BdGxhbnRpYyBTdGFuZGFyZCBUaW1lXCIsXG4gIDExMDA6IFwiQXpvcmVzIFN0YW5kYXJkIFRpbWVcIixcbiAgMTExMDogXCJDYXBlIFZlcmRlIFN0YW5kYXJkIFRpbWVcIixcbiAgMTIyMDogXCJNb3JvY2NvIFN0YW5kYXJkIFRpbWVcIixcbiAgMTIzMDogXCJVVENcIixcbiAgMTIwMDogXCJHTVQgU3RhbmRhcmQgVGltZVwiLFxuICAxMjEwOiBcIkdyZWVud2ljaCBTdGFuZGFyZCBUaW1lXCIsXG4gIDEzNDA6IFwiVy4gRXVyb3BlIFN0YW5kYXJkIFRpbWVcIixcbiAgMTMwMDogXCJDZW50cmFsIEV1cm9wZSBTdGFuZGFyZCBUaW1lXCIsXG4gIDEzMjA6IFwiUm9tYW5jZSBTdGFuZGFyZCBUaW1lXCIsXG4gIDEzMTA6IFwiQ2VudHJhbCBFdXJvcGVhbiBTdGFuZGFyZCBUaW1lXCIsXG4gIDEzMzA6IFwiVy4gQ2VudHJhbCBBZnJpY2EgU3RhbmRhcmQgVGltZVwiLFxuICAxMzUwOiBcIk5hbWliaWEgU3RhbmRhcmQgVGltZVwiLFxuICAxNDMwOiBcIkdUQiBTdGFuZGFyZCBUaW1lXCIsXG4gIDE0NjA6IFwiTWlkZGxlIEVhc3QgU3RhbmRhcmQgVGltZVwiLFxuICAxNDEwOiBcIkVneXB0IFN0YW5kYXJkIFRpbWVcIixcbiAgMTQ4MDogXCJTeXJpYSBTdGFuZGFyZCBUaW1lXCIsXG4gIDE0MDA6IFwiRS4gRXVyb3BlIFN0YW5kYXJkIFRpbWVcIixcbiAgMTQ3MDogXCJTb3V0aCBBZnJpY2EgU3RhbmRhcmQgVGltZVwiLFxuICAxNDIwOiBcIkZMRSBTdGFuZGFyZCBUaW1lXCIsXG4gIDE0OTA6IFwiVHVya2V5IFN0YW5kYXJkIFRpbWVcIixcbiAgMTQ0MDogXCJJc3JhZWwgU3RhbmRhcmQgVGltZVwiLFxuICAxNDUwOiBcIkpvcmRhbiBTdGFuZGFyZCBUaW1lXCIsXG4gIDE1MTA6IFwiQXJhYmljIFN0YW5kYXJkIFRpbWVcIixcbiAgMTUzMDogXCJLYWxpbmluZ3JhZCBTdGFuZGFyZCBUaW1lXCIsXG4gIDE1MDA6IFwiQXJhYiBTdGFuZGFyZCBUaW1lXCIsXG4gIDE1MjA6IFwiRS4gQWZyaWNhIFN0YW5kYXJkIFRpbWVcIixcbiAgMTUzNTogXCJJcmFuIFN0YW5kYXJkIFRpbWVcIixcbiAgMTYwMDogXCJBcmFiaWFuIFN0YW5kYXJkIFRpbWVcIixcbiAgMTYxMDogXCJBemVyYmFpamFuIFN0YW5kYXJkIFRpbWVcIixcbiAgMTU0MDogXCJSdXNzaWFuIFN0YW5kYXJkIFRpbWVcIixcbiAgMTY1MDogXCJNYXVyaXRpdXMgU3RhbmRhcmQgVGltZVwiLFxuICAxNjQwOiBcIkdlb3JnaWFuIFN0YW5kYXJkIFRpbWVcIixcbiAgMTYyMDogXCJDYXVjYXN1cyBTdGFuZGFyZCBUaW1lXCIsXG4gIDE2NjA6IFwiQWZnaGFuaXN0YW4gU3RhbmRhcmQgVGltZVwiLFxuICAxNzEwOiBcIldlc3QgQXNpYSBTdGFuZGFyZCBUaW1lXCIsXG4gIDE3MTU6IFwiUGFraXN0YW4gU3RhbmRhcmQgVGltZVwiLFxuICAxNzIwOiBcIkluZGlhIFN0YW5kYXJkIFRpbWVcIixcbiAgMTczMDogXCJTcmkgTGFua2EgU3RhbmRhcmQgVGltZVwiLFxuICAxNzQwOiBcIk5lcGFsIFN0YW5kYXJkIFRpbWVcIixcbiAgMTgwMDogXCJDZW50cmFsIEFzaWEgU3RhbmRhcmQgVGltZVwiLFxuICAxODEwOiBcIkJhbmdsYWRlc2ggU3RhbmRhcmQgVGltZVwiLFxuICAxNzU1OiBcIkVrYXRlcmluYnVyZyBTdGFuZGFyZCBUaW1lXCIsXG4gIDE4MjA6IFwiTXlhbm1hciBTdGFuZGFyZCBUaW1lXCIsXG4gIDE5MDA6IFwiU0UgQXNpYSBTdGFuZGFyZCBUaW1lXCIsXG4gIDE4MzA6IFwiTi4gQ2VudHJhbCBBc2lhIFN0YW5kYXJkIFRpbWVcIixcbiAgMjAwMDogXCJDaGluYSBTdGFuZGFyZCBUaW1lXCIsXG4gIDE5MTA6IFwiTm9ydGggQXNpYSBTdGFuZGFyZCBUaW1lXCIsXG4gIDIwMjA6IFwiU2luZ2Fwb3JlIFN0YW5kYXJkIFRpbWVcIixcbiAgMjA0MDogXCJXLiBBdXN0cmFsaWEgU3RhbmRhcmQgVGltZVwiLFxuICAyMDMwOiBcIlRhaXBlaSBTdGFuZGFyZCBUaW1lXCIsXG4gIDIwNTA6IFwiVWxhYW5iYWF0YXIgU3RhbmRhcmQgVGltZVwiLFxuICAyMDYwOiBcIk5vcnRoIEFzaWEgRWFzdCBTdGFuZGFyZCBUaW1lXCIsXG4gIDIxMTA6IFwiVG9reW8gU3RhbmRhcmQgVGltZVwiLFxuICAyMTAwOiBcIktvcmVhIFN0YW5kYXJkIFRpbWVcIixcbiAgMjE0MDogXCJDZW4uIEF1c3RyYWxpYSBTdGFuZGFyZCBUaW1lXCIsXG4gIDIxMzA6IFwiQVVTIENlbnRyYWwgU3RhbmRhcmQgVGltZVwiLFxuICAyMjEwOiBcIkUuIEF1c3RyYWxpYSBTdGFuZGFyZCBUaW1lXCIsXG4gIDIyMDA6IFwiQVVTIEVhc3Rlcm4gU3RhbmRhcmQgVGltZVwiLFxuICAyMjQwOiBcIldlc3QgUGFjaWZpYyBTdGFuZGFyZCBUaW1lXCIsXG4gIDIyMjA6IFwiVGFzbWFuaWEgU3RhbmRhcmQgVGltZVwiLFxuICAyMTUwOiBcIllha3V0c2sgU3RhbmRhcmQgVGltZVwiLFxuICAyMzAwOiBcIkNlbnRyYWwgUGFjaWZpYyBTdGFuZGFyZCBUaW1lXCIsXG4gIDIyNTA6IFwiVmxhZGl2b3N0b2sgU3RhbmRhcmQgVGltZVwiLFxuICAyNDEwOiBcIk5ldyBaZWFsYW5kIFN0YW5kYXJkIFRpbWVcIixcbiAgMjQzMDogXCJVVEMrMTJcIixcbiAgMjQwMDogXCJGaWppIFN0YW5kYXJkIFRpbWVcIixcbiAgMjMxMDogXCJNYWdhZGFuIFN0YW5kYXJkIFRpbWVcIixcbiAgMjUwMDogXCJUb25nYSBTdGFuZGFyZCBUaW1lXCIsXG4gIDEyMDogXCJTYW1vYSBTdGFuZGFyZCBUaW1lXCJcbn07XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1UaW1lem9uZURyb3Bkb3duQ3NzID0gXCIubGFiZWx7Zm9udC13ZWlnaHQ6NTAwO2ZvbnQtc2l6ZTowLjg3NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMSk7bGluZS1oZWlnaHQ6MThweDttYXJnaW4tYm90dG9tOjZweH0uaGFzLXN1YnRpdGxle2ZvbnQtc2l6ZToxcmVtO21hcmdpbi1ib3R0b206MH0uc3ViLWxhYmVse2ZvbnQtc2l6ZTowLjc1cmVtfTpob3N0e21hcmdpbi1ib3R0b206MS41cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtVGltZXpvbmVEcm9wZG93biA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy50aW1lem9uZUNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwidGltZXpvbmVDaGFuZ2VcIiwgNyk7XG4gICAgdGhpcy5zZWxlY3RlZCA9IFwiMTIzMFwiO1xuICAgIHRoaXMuc3ViVGl0bGUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5kZWZhdWx0VGltZXpvbmUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuLnRpbWV6b25lRHJvcGRvd247XG4gICAgY29uc3QgeyBkZWZhdWx0VGltZXpvbmUgfSA9IHRoaXM7XG4gICAgaWYgKGRlZmF1bHRUaW1lem9uZSkge1xuICAgICAgZm9yIChjb25zdCBpZCBpbiB0aW1lWm9uZUlkcykge1xuICAgICAgICBpZiAoZGVmYXVsdFRpbWV6b25lID09PSB0aW1lWm9uZUlkc1tpZF0pIHtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gaWQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgaTE4biwgc2VsZWN0ZWQsIHRpbWV6b25lQ2hhbmdlLCBzdWJUaXRsZSB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwibGFiZWxcIiB9LCAhc3ViVGl0bGUgJiYgaTE4bi50aXRsZSksICFzdWJUaXRsZSAmJiBoKFwic3BhblwiLCB7IGNsYXNzOiBcInN1Yi1sYWJlbFwiIH0sIGkxOG4uc3ViVGl0bGUpLCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGV2ZW50LnRhcmdldC5zZWxlY3RlZE9wdGlvbi52YWx1ZTtcbiAgICAgICAgY29uc3QgaWQgPSB0aW1lWm9uZUlkc1t2YWx1ZV0gfHwgdmFsdWU7XG4gICAgICAgIHRpbWV6b25lQ2hhbmdlLmVtaXQoaWQpO1xuICAgICAgfSwgd2lkdGg6IFwiaGFsZlwiLCBsYWJlbDogXCJ0aW1lem9uZS1zZWxlY3RcIiwgc2VsZWN0ZWRPcHRpb246IHNlbGVjdGVkIH0sIE9iamVjdC5rZXlzKGkxOG4udGltZXpvbmVzKS5tYXAoKGNvZGUpID0+IHtcbiAgICAgIGNvbnN0IHRpbWV6b25lID0gaTE4bi50aW1lem9uZXNbY29kZV07XG4gICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHNlbGVjdGVkOiBjb2RlID09PSBzZWxlY3RlZCwgdmFsdWU6IGNvZGUgfSwgdGltZXpvbmUpKTtcbiAgICB9KSksIHN1YlRpdGxlICYmIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwic3ViLWxhYmVsXCIgfSwgc3ViVGl0bGUpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1UaW1lem9uZURyb3Bkb3duLnN0eWxlID0gYXJjZ2lzTmV3SXRlbVRpbWV6b25lRHJvcGRvd25Dc3M7XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1VcmxDc3MgPSBcIi51cmwtZmllbGR7bWFyZ2luLWJvdHRvbToxcmVtfS5oZWxwLXRleHR7bWFyZ2luLXRvcDowLjI1cmVtO21hcmdpbi1ib3R0b206MC41cmVtO2ZvbnQtc2l6ZTowLjg3NXJlbX1cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbVVybCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy51cmxJbnB1dEFkZEFjdGlvbiA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwidXJsSW5wdXRBZGRBY3Rpb25cIiwgNyk7XG4gICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVVwZGF0ZVBhZ2VcIiwgNyk7XG4gICAgdGhpcy5uZXdJdGVtVXJsQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVXJsQ2hhbmdlXCIsIDcpO1xuICAgIHRoaXMudXJsTG9hZGVyVXBkYXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJ1cmxMb2FkZXJVcGRhdGVcIiwgNyk7XG4gICAgdGhpcy5kZWJvdW5jZWRJbnB1dCA9IGRlYm91bmNlKCgpID0+IHtcbiAgICAgIHRoaXMudXJsSW5wdXRBZGRIYW5kbGVyKCk7XG4gICAgfSwgMjAwMCk7XG4gICAgdGhpcy5pbnB1dFRpdGxlID0gXCJcIjtcbiAgICB0aGlzLmlucHV0TWVzc2FnZSA9IFwiXCI7XG4gICAgdGhpcy5oZWFkZXJTY2FsZSA9IFwic1wiO1xuICAgIHRoaXMuc3VwcG9ydGVkU2VydmljZXMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy51cmwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wbGFjZWhvbGRlciA9IFwiaHR0cHM6Ly9cIjtcbiAgICB0aGlzLnJlcXVpcmVkID0gdHJ1ZTtcbiAgICB0aGlzLmlucHV0TWVzc2FnZUFjdGl2ZSA9IGZhbHNlO1xuICAgIHRoaXMuaW5wdXRTdGF0dXMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmkxOG4gPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IGkxOG4gPSB1aVN0b3JlU3RhdGUuaTE4bjtcbiAgICB0aGlzLmkxOG4gPSBpMThuLnVybDtcbiAgICBpZiAoKChfYSA9IHRoaXMuc3VwcG9ydGVkU2VydmljZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpID4gMCkge1xuICAgICAgdGhpcy5zdXBwb3J0ZWRTZXJ2aWNlU3RyaW5nID0gdGhpcy5zdXBwb3J0ZWRTZXJ2aWNlc1xuICAgICAgICAuZmlsdGVyKCh0eXBlKSA9PiBpc1VybFR5cGUodHlwZSkpXG4gICAgICAgIC5tYXAoKHR5cGUpID0+IHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3Qgb3B0aW9uID0gaXNBR1ModHlwZSkgPyBcIkFHU1wiIDogdHlwZTtcbiAgICAgICAgcmV0dXJuICgoX2IgPSAoX2EgPSBpMThuLml0ZW1UeXBlSW5mby5tdlRleHRbb3B0aW9uXSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogaTE4bi5pdGVtVHlwZUluZm8ubG93ZXJjYXNlRGlzcGxheU5hbWVbb3B0aW9uXSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogdHlwZSk7XG4gICAgICB9KVxuICAgICAgICAuam9pbihcIiwgXCIpO1xuICAgICAgdGhpcy5oZWxwVGV4dCA9IHJlcGxhY2VJMThOU3RyaW5nKGkxOG4uY29tbW9uLnN1cHBvcnRMYXllclR5cGVzLCB0aGlzLnN1cHBvcnRlZFNlcnZpY2VTdHJpbmcsIFwidHlwZUxpc3RcIik7XG4gICAgfVxuICAgIC8vIEluaXRpYWxpemUgc3RhdGVcbiAgICB0aGlzLmlucHV0U3RhdHVzID0gXCJpZGxlXCI7XG4gICAgdGhpcy5pbnB1dE1lc3NhZ2VBY3RpdmUgPSB0aGlzLmlucHV0TWVzc2FnZS5sZW5ndGggPiAwO1xuICAgIGlmICghdGhpcy5pbnB1dFRpdGxlKSB7XG4gICAgICB0aGlzLmlucHV0VGl0bGUgPSB0aGlzLmkxOG4udXJsO1xuICAgIH1cbiAgfVxuICBhc3luYyBmb2N1c01haW5JbnB1dCgpIHtcbiAgICB0aGlzLm1haW5JbnB1dFJlZi5zZXRGb2N1cygpO1xuICB9XG4gIGFzeW5jIHZhbGlkYXRlSW5wdXQoKSB7XG4gICAgY29uc3QgeyB1cmwsIHJlcXVpcmVkIH0gPSB0aGlzO1xuICAgIHRoaXMucmVzZXRWYWxpZGF0aW9uKCk7XG4gICAgdGhpcy5kZWJvdW5jZWRJbnB1dC5pbnZva2UoKTtcbiAgICBpZiAoIXVybCAmJiAhcmVxdWlyZWQpIHtcbiAgICAgIHRoaXMudXJsTG9hZGVyVXBkYXRlLmVtaXQoZmFsc2UpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIXVybCkge1xuICAgICAgdGhpcy51cmxMb2FkZXJVcGRhdGUuZW1pdChmYWxzZSk7XG4gICAgICByZXR1cm4gdGhpcy5zZXRFcnJvcihcImludmFsaWRVcmxcIik7XG4gICAgfVxuICAgIGlmIChpc0h0dHAodXJsLCBjb25maWdTdGF0ZS5wb3J0YWwuaXNQb3J0YWwpKSB7XG4gICAgICB0aGlzLnVybExvYWRlclVwZGF0ZS5lbWl0KGZhbHNlKTtcbiAgICAgIHJldHVybiB0aGlzLnNldEVycm9yKFwiaHR0cFdhcm5pbmdcIik7XG4gICAgfVxuICB9XG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLmlucHV0U3RhdHVzID0gXCJpZGxlXCI7XG4gICAgdGhpcy5pbnB1dE1lc3NhZ2VBY3RpdmUgPSBmYWxzZTtcbiAgfVxuICBhc3luYyB1cmxJbnB1dEFkZEhhbmRsZXIoKSB7XG4gICAgaWYgKCF0aGlzLnVybCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnVybExvYWRlclVwZGF0ZS5lbWl0KHRydWUpO1xuICAgIGNvbnN0IHsgaXNQb3J0YWwsIGFsbFNTTCB9ID0gY29uZmlnU3RhdGUucG9ydGFsO1xuICAgIHRoaXMudXJsID0gZm9ybWF0VXJsKHRoaXMudXJsLCBhbGxTU0wpO1xuICAgIGNvbnN0IHsgcmVzdWx0OiB0eXBlLCBlcnJvciB9ID0gZ2V0VXJsVHlwZSh0aGlzLnVybCwgaXNQb3J0YWwpO1xuICAgIGlmICh0eXBlICE9PSBcIktNTFwiKSB7XG4gICAgICAvLyBLTUwgaGFzIGEgc2VwYXJhdGUgbmFtZSBmaWVsZFxuICAgICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSA9IHVybFRvVGl0bGUodGhpcy51cmwpLnJlcGxhY2Uoc3BlY2lhbENoYXJhY3RlcnNSZWdFeHAsIFwiXCIpO1xuICAgIH1cbiAgICB0aGlzLnVybExvYWRlclVwZGF0ZS5lbWl0KGZhbHNlKTtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHRoaXMuc2V0RXJyb3IoZXJyb3IuY29kZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5uZXdJdGVtVXJsQ2hhbmdlLmVtaXQoe1xuICAgICAgICB0eXBlLFxuICAgICAgICB1cmw6IHRoaXMudXJsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgc2V0RXJyb3IoY29kZSkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBzdXBwb3J0ZWRTZXJ2aWNlU3RyaW5nID0gdGhpcy5zdXBwb3J0ZWRTZXJ2aWNlU3RyaW5nO1xuICAgIGNvbnN0IGlucHV0TWVzc2FnZSA9IChjb2RlID09PSBcImludmFsaWRVcmxcIiAmJiBzdXBwb3J0ZWRTZXJ2aWNlU3RyaW5nXG4gICAgICA/IHJlcGxhY2VJMThOU3RyaW5nKHRoaXMuaTE4bi5pbnZhbGlkVXJsV2l0aFR5cGUsIHN1cHBvcnRlZFNlcnZpY2VTdHJpbmcsIFwidHlwZUxpc3RcIilcbiAgICAgIDogKF9hID0gdGhpcy5pMThuKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbY29kZV0pIHx8IHRoaXMuaTE4bi5lcnJvck1lc3NhZ2U7XG4gICAgdGhpcy5pbnB1dFN0YXR1cyA9IFwiaW52YWxpZFwiO1xuICAgIHRoaXMuaW5wdXRNZXNzYWdlID0gaW5wdXRNZXNzYWdlO1xuICAgIHRoaXMuaW5wdXRNZXNzYWdlQWN0aXZlID0gdHJ1ZTtcbiAgICByZXR1cm4gaW5wdXRNZXNzYWdlO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IHVybCwgaGVscFRleHQsIHBsYWNlaG9sZGVyLCByZXF1aXJlZCwgaGVhZGVyU2NhbGUgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWRlc2NyaXB0aW9uXCIsIHsgaGVhZGVyOiB0aGlzLmlucHV0VGl0bGUsIGhlYWRlclNjYWxlOiBoZWFkZXJTY2FsZSB9KSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyBpZDogXCJpdGVtLXByb3BlcnRpZXMtdXJsXCIsIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlciwgdmFsdWU6IHVybCwgcmVxdWlyZWQ6IHJlcXVpcmVkLCByZWY6IChlbGUpID0+ICh0aGlzLm1haW5JbnB1dFJlZiA9IGVsZSksIHN0YXR1czogdGhpcy5pbnB1dFN0YXR1cywgdHlwZTogXCJ1cmxcIiwgb25JbnB1dDogKGUpID0+IHtcbiAgICAgICAgdGhpcy5yZXNldFZhbGlkYXRpb24oKTtcbiAgICAgICAgLy8gaWdub3JlIHBhc3RlLCBpdCdzIGhhbmRsZWQgc2VwYXJhdGVseVxuICAgICAgICBpZiAoZS5pbnB1dFR5cGUgPT09IFwiaW5zZXJ0RnJvbVBhc3RlXCIpXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLnVybCA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICB0aGlzLmRlYm91bmNlZElucHV0KCk7XG4gICAgICB9LCBvbktleURvd246IChlKSA9PiB7XG4gICAgICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgdGhpcy51cmwgPSB0aGlzLm1haW5JbnB1dFJlZi52YWx1ZTtcbiAgICAgICAgICB0aGlzLmRlYm91bmNlZElucHV0Lmludm9rZSgpO1xuICAgICAgICB9XG4gICAgICB9LCBvblBhc3RlOiAoZSkgPT4ge1xuICAgICAgICB0aGlzLnVybCA9IGUuY2xpcGJvYXJkRGF0YS5nZXREYXRhKFwidGV4dFwiKTtcbiAgICAgICAgdGhpcy5kZWJvdW5jZWRJbnB1dC5pbnZva2UoKTtcbiAgICAgIH0gfSksIHRoaXMuaW5wdXRNZXNzYWdlQWN0aXZlID8gKGgoXCJjYWxjaXRlLWlucHV0LW1lc3NhZ2VcIiwgeyBpY29uOiB0aGlzLmlucHV0U3RhdHVzID09PSBcImludmFsaWRcIiwgc3RhdHVzOiB0aGlzLmlucHV0U3RhdHVzIH0sIHRoaXMuaW5wdXRNZXNzYWdlKSkgOiBoZWxwVGV4dCA/IChoKFwicFwiLCB7IGNsYXNzOiBcImhlbHAtdGV4dFwiIH0sIGhlbHBUZXh0KSkgOiBudWxsKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1Vcmwuc3R5bGUgPSBhcmNnaXNOZXdJdGVtVXJsQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNOZXdJdGVtIGFzIGFyY2dpc19uZXdfaXRlbSwgQXJjZ2lzTmV3SXRlbUNyZWF0ZUxheWVyc0xpc3QgYXMgYXJjZ2lzX25ld19pdGVtX2NyZWF0ZV9sYXllcnNfbGlzdCwgQXJjZ2lzTmV3SXRlbUNzdkZpZWxkIGFzIGFyY2dpc19uZXdfaXRlbV9jc3ZfZmllbGQsIEFyY2dpc05ld0l0ZW1DdXN0b21QYXJhbWV0ZXIgYXMgYXJjZ2lzX25ld19pdGVtX2N1c3RvbV9wYXJhbWV0ZXIsIEFyY2dpc05ld0l0ZW1DdXN0b21QYXJhbWV0ZXJzIGFzIGFyY2dpc19uZXdfaXRlbV9jdXN0b21fcGFyYW1ldGVycywgQXJjZ2lzTmV3SXRlbUlucHV0UmVhZG9ubHkgYXMgYXJjZ2lzX25ld19pdGVtX2lucHV0X3JlYWRvbmx5LCBBcmNnaXNOZXdJdGVtTGF5ZXJTZWFyY2ggYXMgYXJjZ2lzX25ld19pdGVtX2xheWVyX3NlYXJjaCwgQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwbGljYXRpb24gYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX2FwcGxpY2F0aW9uLCBBcmNnaXNOZXdJdGVtUGFnZXNBdXRoIGFzIGFyY2dpc19uZXdfaXRlbV9wYWdlc19hdXRoLCBBcmNnaXNOZXdJdGVtUGFnZXNCdWxrTGF5ZXJTZWxlY3QgYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX2J1bGtfbGF5ZXJfc2VsZWN0LCBBcmNnaXNOZXdJdGVtUGFnZXNDbG91ZCBhcyBhcmNnaXNfbmV3X2l0ZW1fcGFnZXNfY2xvdWQsIEFyY2dpc05ld0l0ZW1QYWdlc0ZpbGVGaWVsZHMgYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX2ZpbGVfZmllbGRzLCBBcmNnaXNOZXdJdGVtUGFnZXNJdGVtUHJvcGVydGllcyBhcyBhcmNnaXNfbmV3X2l0ZW1fcGFnZXNfaXRlbV9wcm9wZXJ0aWVzLCBBcmNnaXNOZXdJdGVtUGFnZXNQdWJsaXNoU2VsZWN0IGFzIGFyY2dpc19uZXdfaXRlbV9wYWdlc19wdWJsaXNoX3NlbGVjdCwgQXJjZ2lzTmV3SXRlbVBhZ2VzU2luZ2xlTGF5ZXJTZWxlY3QgYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX3NpbmdsZV9sYXllcl9zZWxlY3QsIEFyY2dpc05ld0l0ZW1QYWdlc1VybFR5cGUgYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX3VybF90eXBlLCBBcmNnaXNOZXdJdGVtUGFnZXNaaXBTZWxlY3QgYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX3ppcF9zZWxlY3QsIEFyY2dpc05ld0l0ZW1UaW1lem9uZURyb3Bkb3duIGFzIGFyY2dpc19uZXdfaXRlbV90aW1lem9uZV9kcm9wZG93biwgQXJjZ2lzTmV3SXRlbVVybCBhcyBhcmNnaXNfbmV3X2l0ZW1fdXJsIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy1lYjVmN2RjMi5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZEl0ZW1TdGF0ZSB9IGZyb20gJy4vYWRkLWl0ZW0tOTdkNTc3YTkuanMnO1xuXG5jb25zdCBURUxFTUVUUllfSUQgPSBcImNyZWF0ZSBmZWF0dXJlIGxheWVyXCI7XG5jb25zdCBURUxFTUVUUllfUEFHRV9OQU1FID0gXCJteSBjb250ZW50XCI7XG5jb25zdCBhZGRGZWF0dXJlTGF5ZXJUeXBlVG9UZWxlbWV0cnkgPSAodHlwZSkgPT4ge1xuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlIFwiYnVpbGRcIjpcbiAgICAgIHJldHVybiBcImJsYW5rXCI7XG4gICAgY2FzZSBcImV4aXN0aW5nXCI6XG4gICAgICByZXR1cm4gXCJmc1wiO1xuICAgIGNhc2UgXCJ0ZW1wbGF0ZVwiOlxuICAgICAgcmV0dXJuIFwidGVtcGxhdGVcIjtcbiAgICBjYXNlIFwibGlua1wiOlxuICAgICAgcmV0dXJuIFwidXJsXCI7XG4gIH1cbn07XG5jb25zdCBlbmFibGVMYXllclByZWZlcmVuY2VUZWxlbWV0cnkgPSAodHlwZSkgPT4ge1xuICBjb25zdCB0ZWxlbWV0cnkgPSBjb25maWdTdGF0ZS50ZWxlbWV0cnk7XG4gIHRlbGVtZXRyeSA9PT0gbnVsbCB8fCB0ZWxlbWV0cnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbGVtZXRyeS5zdGVwV29ya2Zsb3coVEVMRU1FVFJZX0lELCBgZW5hYmxlICR7dHlwZSA9PT0gXCJjYXB0dXJlR1BTXCIgPyBcImdwc1wiIDogdHlwZSA9PT0gXCJlbmFibGVaRGVmYXVsdHNcIiA/IFwielwiIDogXCJtXCJ9YCwge1xuICAgIGNhdGVnb3J5OiBURUxFTUVUUllfSUQsXG4gICAgYXR0cmlidXRlOiBhZGRGZWF0dXJlTGF5ZXJUeXBlVG9UZWxlbWV0cnkoYWRkSXRlbVN0YXRlLmFkZEZlYXR1cmVMYXllclR5cGUpLFxuICAgIHBhZ2VOYW1lOiBURUxFTUVUUllfUEFHRV9OQU1FXG4gIH0pO1xufTtcbmNvbnN0IGl0ZW1FeHBhbmRlZFRlbGVtZXRyeSA9ICh0eXBlKSA9PiB7XG4gIGNvbnN0IHRlbGVtZXRyeSA9IGNvbmZpZ1N0YXRlLnRlbGVtZXRyeTtcbiAgdGVsZW1ldHJ5ID09PSBudWxsIHx8IHRlbGVtZXRyeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVsZW1ldHJ5LnN0ZXBXb3JrZmxvdyhURUxFTUVUUllfSUQsIGBleHBhbmQgJHt0eXBlfSBkZXRhaWxzYCwge1xuICAgIGNhdGVnb3J5OiBURUxFTUVUUllfSUQsXG4gICAgYXR0cmlidXRlOiBhZGRGZWF0dXJlTGF5ZXJUeXBlVG9UZWxlbWV0cnkoYWRkSXRlbVN0YXRlLmFkZEZlYXR1cmVMYXllclR5cGUpLFxuICAgIHBhZ2VOYW1lOiBURUxFTUVUUllfUEFHRV9OQU1FXG4gIH0pO1xufTtcbmNvbnN0IGZpbHRlckNoYW5nZVRlbGVtZXRyeSA9ICgpID0+IHtcbiAgY29uc3QgdGVsZW1ldHJ5ID0gY29uZmlnU3RhdGUudGVsZW1ldHJ5O1xuICB0ZWxlbWV0cnkgPT09IG51bGwgfHwgdGVsZW1ldHJ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlbWV0cnkuc3RlcFdvcmtmbG93KFRFTEVNRVRSWV9JRCwgXCJmaWx0ZXJcIiwge1xuICAgIGNhdGVnb3J5OiBURUxFTUVUUllfSUQsXG4gICAgYXR0cmlidXRlOiBhZGRGZWF0dXJlTGF5ZXJUeXBlVG9UZWxlbWV0cnkoYWRkSXRlbVN0YXRlLmFkZEZlYXR1cmVMYXllclR5cGUpLFxuICAgIHBhZ2VOYW1lOiBURUxFTUVUUllfUEFHRV9OQU1FXG4gIH0pO1xufTtcbmNvbnN0IGZlYXR1cmVMYXllclR5cGVUZWxlbWV0cnkgPSAodHlwZSkgPT4ge1xuICBjb25zdCB0ZWxlbWV0cnlUeXBlID0gYWRkRmVhdHVyZUxheWVyVHlwZVRvVGVsZW1ldHJ5KHR5cGUpO1xuICBjb25zdCB0ZWxlbWV0cnkgPSBjb25maWdTdGF0ZS50ZWxlbWV0cnk7XG4gIHRlbGVtZXRyeSA9PT0gbnVsbCB8fCB0ZWxlbWV0cnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbGVtZXRyeS5zdGVwV29ya2Zsb3coVEVMRU1FVFJZX0lELCBcImZyb20gb3B0aW9uXCIsIHtcbiAgICBjYXRlZ29yeTogVEVMRU1FVFJZX0lELFxuICAgIGF0dHJpYnV0ZTogdGVsZW1ldHJ5VHlwZSxcbiAgICBwYWdlTmFtZTogVEVMRU1FVFJZX1BBR0VfTkFNRVxuICB9KTtcbn07XG5jb25zdCBmZWF0dXJlU2VydmljZUVuZFRlbGVtZXRyeSA9ICgpID0+IHtcbiAgY29uc3QgeyBhZGRGZWF0dXJlTGF5ZXJUeXBlLCBzZXJ2aWNlSW5mbyB9ID0gYWRkSXRlbVN0YXRlO1xuICBjb25zdCBmZWF0dXJlTGF5ZXJTZXJ2aWNlSW5mbyA9IHNlcnZpY2VJbmZvO1xuICBjb25zdCB0ZWxlbWV0cnkgPSBjb25maWdTdGF0ZS50ZWxlbWV0cnk7XG4gIHRlbGVtZXRyeSA9PT0gbnVsbCB8fCB0ZWxlbWV0cnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbGVtZXRyeS5lbmRXb3JrZmxvdyhURUxFTUVUUllfSUQsIHtcbiAgICBjYXRlZ29yeTogVEVMRU1FVFJZX0lELFxuICAgIGF0dHJpYnV0ZTogYWRkRmVhdHVyZUxheWVyVHlwZVRvVGVsZW1ldHJ5KGFkZEZlYXR1cmVMYXllclR5cGUpLFxuICAgIHBhZ2VOYW1lOiBURUxFTUVUUllfUEFHRV9OQU1FLFxuICAgIGNvdW50OiBmZWF0dXJlTGF5ZXJTZXJ2aWNlSW5mby5sYXllcnMubGVuZ3RoLFxuICAgIG51bWJlcjogZmVhdHVyZUxheWVyU2VydmljZUluZm8udGFibGVzLmxlbmd0aFxuICB9KTtcbn07XG5jb25zdCBmZWF0dXJlTGF5ZXJFcnJvclRlbGVtZXRyeSA9IChlcnJTdHJpbmcpID0+IHtcbiAgdmFyIF9hO1xuICAoX2EgPSBjb25maWdTdGF0ZS50ZWxlbWV0cnkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sb2dFcnJvcih7XG4gICAgY2F0ZWdvcnk6IFRFTEVNRVRSWV9JRCxcbiAgICBlcnJvcjogZXJyU3RyaW5nXG4gIH0pO1xufTtcblxuZXhwb3J0IHsgZmVhdHVyZVNlcnZpY2VFbmRUZWxlbWV0cnkgYXMgYSwgZmlsdGVyQ2hhbmdlVGVsZW1ldHJ5IGFzIGIsIGZlYXR1cmVMYXllclR5cGVUZWxlbWV0cnkgYXMgYywgZW5hYmxlTGF5ZXJQcmVmZXJlbmNlVGVsZW1ldHJ5IGFzIGUsIGZlYXR1cmVMYXllckVycm9yVGVsZW1ldHJ5IGFzIGYsIGl0ZW1FeHBhbmRlZFRlbGVtZXRyeSBhcyBpIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmNvbnN0IHJlZ2V4TG9va3VwTWFwID0ge1xuICBmaWxlTmFtZTogL1xcJFxce2ZpbGVOYW1lXFx9L2csXG4gIGZpbGVUeXBlOiAvXFwkXFx7dHlwZVxcfS9nLFxuICB0eXBlTGlzdDogL1xcJFxce3R5cGVMaXN0XFx9L2csXG4gIG1pc3NpbmdGaWVsZHM6IC9cXCRcXHtcXG1pc3NpbmdGaWVsZHNcXH0vZ1xufTtcbmNvbnN0IHJlcGxhY2VJMThOU3RyaW5nID0gKHN0ciwgcmVwbGFjZW1lbnRTdHJpbmcsIHR5cGUpID0+IHtcbiAgY29uc3QgdHlwZVJlZ0V4ID0gbmV3IFJlZ0V4cChyZWdleExvb2t1cE1hcFt0eXBlXSk7XG4gIHJldHVybiBzdHIgPT09IG51bGwgfHwgc3RyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzdHIucmVwbGFjZSh0eXBlUmVnRXgsIHJlcGxhY2VtZW50U3RyaW5nKTtcbn07XG5cbmV4cG9ydCB7IHJlcGxhY2VJMThOU3RyaW5nIGFzIHIgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgZyBhcyBndWlkIH0gZnJvbSAnLi9ndWlkLTRmNDE3NmJhLmpzJztcbmltcG9ydCB7IG0gYXMgbW92ZUl0ZW0sIGUgYXMgdXBkYXRlSXRlbSB9IGZyb20gJy4vc2VydmVyLWl0ZW0tZjEyMTUzZTYuanMnO1xuaW1wb3J0IHsgdSBhcyBmaW5kVGVtcGxhdGVTZXJ2aWNlSW5mbywgdiBhcyBjcmVhdGVTZXJ2aWNlIH0gZnJvbSAnLi9mZWF0dXJlLWxheWVyLTM4Y2RhZTg3LmpzJztcbmltcG9ydCB7IHIgYXMgcmVxdWVzdCwgcCBhcyBwb2xsRm9yU3RhdHVzIH0gZnJvbSAnLi9wb3J0YWwtNzljYWFlZmYuanMnO1xuXG52YXIgX19hd2FpdCA9ICh1bmRlZmluZWQgJiYgdW5kZWZpbmVkLl9fYXdhaXQpIHx8IGZ1bmN0aW9uICh2KSB7IHJldHVybiB0aGlzIGluc3RhbmNlb2YgX19hd2FpdCA/ICh0aGlzLnYgPSB2LCB0aGlzKSA6IG5ldyBfX2F3YWl0KHYpOyB9O1xudmFyIF9fYXN5bmNHZW5lcmF0b3IgPSAodW5kZWZpbmVkICYmIHVuZGVmaW5lZC5fX2FzeW5jR2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgZ2VuZXJhdG9yKSB7XG4gIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XG4gIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XG4gIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaTtcbiAgZnVuY3Rpb24gdmVyYihuKSB7IGlmIChnW25dKSBpW25dID0gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChhLCBiKSB7IHEucHVzaChbbiwgdiwgYSwgYl0pID4gMSB8fCByZXN1bWUobiwgdik7IH0pOyB9OyB9XG4gIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cbiAgZnVuY3Rpb24gc3RlcChyKSB7IHIudmFsdWUgaW5zdGFuY2VvZiBfX2F3YWl0ID8gUHJvbWlzZS5yZXNvbHZlKHIudmFsdWUudikudGhlbihmdWxmaWxsLCByZWplY3QpIDogc2V0dGxlKHFbMF1bMl0sIHIpOyB9XG4gIGZ1bmN0aW9uIGZ1bGZpbGwodmFsdWUpIHsgcmVzdW1lKFwibmV4dFwiLCB2YWx1ZSk7IH1cbiAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxuICBmdW5jdGlvbiBzZXR0bGUoZiwgdikgeyBpZiAoZih2KSwgcS5zaGlmdCgpLCBxLmxlbmd0aCkgcmVzdW1lKHFbMF1bMF0sIHFbMF1bMV0pOyB9XG59O1xuLyoqXG4gKiBHaXZlbiBhbiBpdGVtLCBjcmVhdGUgYSBuZXcgc2VydmljZVxuICovXG5mdW5jdGlvbiBjcmVhdGVJbWFnZUNvbGxlY3Rpb24ocmVzcG9uc2UsIHRpdGxlLCBjb25maWdPcHRpb25zKSB7XG4gIHJldHVybiBfX2FzeW5jR2VuZXJhdG9yKHRoaXMsIGFyZ3VtZW50cywgZnVuY3Rpb24qIGNyZWF0ZUltYWdlQ29sbGVjdGlvbl8xKCkge1xuICAgIGNvbnN0IHsgY29uZmlnLCBwb3J0YWwsIHVzZXIgfSA9IGNvbmZpZ09wdGlvbnM7XG4gICAgY29uc3QgeyBpdGVtIH0gPSB5aWVsZCBfX2F3YWl0KGZldGNoSXRlbShyZXNwb25zZSwgdXNlcikpO1xuICAgIGNvbnN0IHRlbXBsYXRlID0geWllbGQgX19hd2FpdChmaW5kVGVtcGxhdGVTZXJ2aWNlSW5mbyhwb3J0YWwpKTtcbiAgICB5aWVsZCB5aWVsZCBfX2F3YWl0KFwicHVibGlzaGluZ1NlcnZpY2VcIik7XG4gICAgY29uc3QgaXNOb3RJblJvb3RGb2xkZXIgPSBpdGVtLm93bmVyRm9sZGVyICYmIGl0ZW0ub3duZXJGb2xkZXIgIT09IFwiL1wiICYmIGl0ZW0ub3duZXJGb2xkZXIgIT09IFwicm9vdFwiO1xuICAgIGNvbnN0IHRlbXBUaXRsZSA9IGAke3RpdGxlfS0tLSR7Z3VpZCgpfWA7XG4gICAgY29uc3QgeyBjcmVhdGVTZXJ2aWNlUmVzcG9uc2UsIGFkZFRvRGVmaW5pdGlvblJlc3BvbnNlIH0gPSB5aWVsZCBfX2F3YWl0KGNyZWF0ZVNlcnZpY2UoT2JqZWN0LmFzc2lnbih7IG5hbWU6IGlzTm90SW5Sb290Rm9sZGVyID8gdGVtcFRpdGxlIDogdGl0bGUsIGxheWVyczogKHRlbXBsYXRlID09PSBudWxsIHx8IHRlbXBsYXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZW1wbGF0ZS5sYXllcnMpIHx8IFtdLCB0YWJsZXM6ICh0ZW1wbGF0ZSA9PT0gbnVsbCB8fCB0ZW1wbGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVtcGxhdGUudGFibGVzKSB8fCBbXSB9LCB0ZW1wbGF0ZSksIHsgY29uZmlnLCB1c2VyIH0pKTtcbiAgICBpZiAoaXNOb3RJblJvb3RGb2xkZXIpIHtcbiAgICAgIHlpZWxkIF9fYXdhaXQobW92ZUl0ZW0oY3JlYXRlU2VydmljZVJlc3BvbnNlLml0ZW1JZCwgaXRlbS5vd25lckZvbGRlcikpO1xuICAgICAgeWllbGQgX19hd2FpdCh1cGRhdGVJdGVtKGNyZWF0ZVNlcnZpY2VSZXNwb25zZS5pdGVtSWQsIHsgdGl0bGUgfSkpO1xuICAgIH1cbiAgICB5aWVsZCB5aWVsZCBfX2F3YWl0KFwiYXBwZW5kaW5nUGhvdG9zXCIpO1xuICAgIGNvbnN0IHsgc3RhdHVzVXJsIH0gPSB5aWVsZCBfX2F3YWl0KGFwcGVuZFBob3RvcyhjcmVhdGVTZXJ2aWNlUmVzcG9uc2UsIGFkZFRvRGVmaW5pdGlvblJlc3BvbnNlLCBpdGVtKSk7XG4gICAgeWllbGQgX19hd2FpdChhZGRSZWxhdGlvbnNoaXAoY3JlYXRlU2VydmljZVJlc3BvbnNlLCBpdGVtLCB1c2VyKSk7XG4gICAgeWllbGQgeWllbGQgX19hd2FpdChcImNoZWNraW5nU3RhdHVzXCIpO1xuICAgIHlpZWxkIF9fYXdhaXQocG9sbEZvclN0YXR1cyhzdGF0dXNVcmwpKTtcbiAgICB5aWVsZCB5aWVsZCBfX2F3YWl0KGNyZWF0ZVNlcnZpY2VSZXNwb25zZSk7XG4gIH0pO1xufVxuZnVuY3Rpb24gZmV0Y2hJdGVtKGl0ZW0sIHVzZXIpIHtcbiAgY29uc3QgdXJsID0gYCR7dXNlci51c2VyQ29udGVudFVybH0vaXRlbXMvJHtpdGVtLmlkfWA7XG4gIHJldHVybiByZXF1ZXN0KHVybCk7XG59XG5mdW5jdGlvbiBhcHBlbmRQaG90b3MoY3JlYXRlU2VydmljZVJlc3BvbnNlLCBhZGRUb0RlZmluaXRpb25SZXNwb25zZSwgaXRlbSkge1xuICB2YXIgX2E7XG4gIGNvbnN0IGxheWVyID0gYWRkVG9EZWZpbml0aW9uUmVzcG9uc2UubGF5ZXJzWzBdO1xuICBjb25zdCB1cmwgPSBgJHtjcmVhdGVTZXJ2aWNlUmVzcG9uc2UuZW5jb2RlZFNlcnZpY2VVUkx9LyR7KF9hID0gbGF5ZXIuaWQpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDB9L2FwcGVuZGA7XG4gIGNvbnN0IGNvbnRlbnQgPSB7XG4gICAgYXBwZW5kSXRlbUlkOiBpdGVtLmlkLFxuICAgIGFwcGVuZFVwbG9hZEZvcm1hdDogXCJpbWFnZUNvbGxlY3Rpb25cIixcbiAgICBhcHBlbmRBdHRhY2htZW50c0luZm86IEpTT04uc3RyaW5naWZ5KHsgaWdub3JlQXR0YWNobWVudHNXaXRob3V0TG9jYXRpb246IHRydWUgfSksXG4gICAgdXBzZXJ0OiBmYWxzZSxcbiAgICB1c2VHbG9iYWxJZHM6IGZhbHNlLFxuICAgIHJvbGxiYWNrT25GYWlsdXJlOiB0cnVlXG4gIH07XG4gIHJldHVybiByZXF1ZXN0KHVybCwgY29udGVudCwge30sIFwicG9zdFwiKTtcbn1cbmZ1bmN0aW9uIGFkZFJlbGF0aW9uc2hpcChjcmVhdGVTZXJ2aWNlUmVzcG9uc2UsIGl0ZW0sIHVzZXIpIHtcbiAgY29uc3QgdXJsID0gYCR7dXNlci51c2VyQ29udGVudFVybH0vYWRkUmVsYXRpb25zaGlwYDtcbiAgY29uc3QgY29udGVudCA9IHtcbiAgICByZWxhdGlvbnNoaXBUeXBlOiBcIlNlcnZpY2UyRGF0YVwiLFxuICAgIGRlc3RpbmF0aW9uSXRlbUlkOiBpdGVtLmlkLFxuICAgIG9yaWdpbkl0ZW1JZDogY3JlYXRlU2VydmljZVJlc3BvbnNlLml0ZW1JZFxuICB9O1xuICByZXR1cm4gcmVxdWVzdCh1cmwsIGNvbnRlbnQsIHt9LCBcInBvc3RcIik7XG59XG5cbmV4cG9ydCB7IGNyZWF0ZUltYWdlQ29sbGVjdGlvbiBhcyBjIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGIgYXMgdW5pcXVlIH0gZnJvbSAnLi9mdW5jdGlvbmFsLWM4MmY1YWI5LmpzJztcbmltcG9ydCB7IGEgYXMgYWRkQ3JlYXRlSXRlbVR5cGVzIH0gZnJvbSAnLi9pdGVtLXR5cGVzLWI0ZmU4NmFkLmpzJztcblxuZnVuY3Rpb24gZmluZFBvc3NpYmxlSXRlbVR5cGVzQnlFeHRlbnNpb24oZXh0ZW5zaW9uLCB2YWxpZGF0aW9uVHlwZXMpIHtcbiAgLy8gU2VhcmNoIGl0ZW0gdHlwZXMgZXh0ZW5zaW9ucyBmb3IgdGhlIG9uZSBpbXBvcnRlZFxuICBsZXQgaXRlbVR5cGVzO1xuICBpZiAodmFsaWRhdGlvblR5cGVzKSB7XG4gICAgaXRlbVR5cGVzID0gdmFsaWRhdGlvblR5cGVzLm1hcCgodmFsdWUpID0+IHtcbiAgICAgIHJldHVybiB2YWx1ZS50eXBlO1xuICAgIH0pO1xuICB9XG4gIGVsc2Uge1xuICAgIGl0ZW1UeXBlcyA9IE9iamVjdC5rZXlzKGFkZENyZWF0ZUl0ZW1UeXBlcyk7XG4gIH1cbiAgbGV0IHBvc3NpYmxlSXRlbVR5cGVzID0gW107XG4gIGl0ZW1UeXBlcy5mb3JFYWNoKCh0eXBlKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGlmICgoKF9hID0gYWRkQ3JlYXRlSXRlbVR5cGVzW3R5cGVdLmZpbGVFeHQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmRleE9mKGV4dGVuc2lvbikpID49IDApIHtcbiAgICAgIHBvc3NpYmxlSXRlbVR5cGVzLnB1c2goYWRkQ3JlYXRlSXRlbVR5cGVzW3R5cGVdKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gcG9zc2libGVJdGVtVHlwZXM7XG59XG5mdW5jdGlvbiBtYXBJdGVtVHlwZXNUb0ZpbGVFeHRlbnNpb25zKHR5cGVzKSB7XG4gIGlmICghdHlwZXMpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICByZXR1cm4gdW5pcXVlKHR5cGVzLmZsYXRNYXAoKHR5cGUpID0+IHsgdmFyIF9hOyByZXR1cm4gKF9hID0gYWRkQ3JlYXRlSXRlbVR5cGVzW3R5cGVdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmlsZUV4dDsgfSkuZmlsdGVyKCh2YWxpZCkgPT4gISF2YWxpZCkpO1xufVxuY29uc3QgaXNMYXJnZUdlb0pTT04gPSAoc2l6ZUluQnl0ZXMpID0+IHtcbiAgY29uc3Qgc2l6ZUluTUIgPSBzaXplSW5CeXRlcyAvIDEwMjQgLyAxMDI0O1xuICAvLyBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtYXBwLWNvbXBvbmVudHMvaXNzdWVzLzI1NTMjaXNzdWVjb21tZW50LTM2NDU0MDRcbiAgcmV0dXJuIHNpemVJbk1CID4gNTA7IC8vIDUwTUJcbn07XG5jb25zdCBpc0xhcmdlQ1NWID0gKHNpemVJbkJ5dGVzKSA9PiB7XG4gIGNvbnN0IHNpemVJbk1CID0gc2l6ZUluQnl0ZXMgLyAxMDI0IC8gMTAyNDtcbiAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWFwcC1jb21wb25lbnRzL2lzc3Vlcy8yODc1I2lzc3VlY29tbWVudC0zNzQ4OTEzXG4gIHJldHVybiBzaXplSW5NQiA+IDIwOyAvLyAyME1CXG59O1xuXG5leHBvcnQgeyBpc0xhcmdlQ1NWIGFzIGEsIGZpbmRQb3NzaWJsZUl0ZW1UeXBlc0J5RXh0ZW5zaW9uIGFzIGYsIGlzTGFyZ2VHZW9KU09OIGFzIGksIG1hcEl0ZW1UeXBlc1RvRmlsZUV4dGVuc2lvbnMgYXMgbSB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1hYWYzMGJkNi5qcyc7XG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTEzZjViMDBjLmpzJztcblxuY29uc3QgbGFuZ3VhZ2VNYXAgPSBuZXcgTWFwKFtcbiAgW1wiYXJcIiwgXCJhclwiXSxcbiAgW1wiYmdcIiwgXCJiZ1wiXSxcbiAgW1wiYnNcIiwgXCJic1wiXSxcbiAgW1wiY2FcIiwgXCJjYVwiXSxcbiAgW1wiY3NcIiwgXCJjc1wiXSxcbiAgW1wiZGFcIiwgXCJkYVwiXSxcbiAgW1wiZGVcIiwgXCJkZVwiXSxcbiAgW1wiZWxcIiwgXCJlbFwiXSxcbiAgW1wiZW5cIiwgXCJlblwiXSxcbiAgW1wiZXNcIiwgXCJlc1wiXSxcbiAgW1wiZXRcIiwgXCJldFwiXSxcbiAgW1wiZmlcIiwgXCJmaVwiXSxcbiAgW1wiZnJcIiwgXCJmclwiXSxcbiAgW1wiaGVcIiwgXCJoZVwiXSxcbiAgW1wiaHJcIiwgXCJoclwiXSxcbiAgW1wiaHVcIiwgXCJodVwiXSxcbiAgW1wiaWRcIiwgXCJpZFwiXSxcbiAgW1wiaXRcIiwgXCJpdFwiXSxcbiAgW1wiamFcIiwgXCJqYVwiXSxcbiAgW1wia29cIiwgXCJrb1wiXSxcbiAgW1wibHRcIiwgXCJsdFwiXSxcbiAgW1wibHZcIiwgXCJsdlwiXSxcbiAgW1wibmJcIiwgXCJuYlwiXSxcbiAgW1wibmxcIiwgXCJubFwiXSxcbiAgW1wicGxcIiwgXCJwbFwiXSxcbiAgW1wicHQtYnJcIiwgXCJwdC1CUlwiXSxcbiAgW1wicHQtcHRcIiwgXCJwdC1QVFwiXSxcbiAgW1wicm9cIiwgXCJyb1wiXSxcbiAgW1wicnVcIiwgXCJydVwiXSxcbiAgW1wic2tcIiwgXCJza1wiXSxcbiAgW1wic2xcIiwgXCJzbFwiXSxcbiAgW1wic3JcIiwgXCJzclwiXSxcbiAgW1wic3ZcIiwgXCJzdlwiXSxcbiAgW1widGhcIiwgXCJ0aFwiXSxcbiAgW1widHJcIiwgXCJ0clwiXSxcbiAgW1widWtcIiwgXCJ1a1wiXSxcbiAgW1widmlcIiwgXCJ2aVwiXSxcbiAgW1wiemgtY25cIiwgXCJ6aC1DTlwiXSxcbiAgW1wiemgtaGtcIiwgXCJ6aC1IS1wiXSxcbiAgW1wiemgtdHdcIiwgXCJ6aC1UV1wiXVxuXSk7XG4vLyBydGxcbmZ1bmN0aW9uIGdldEVsZW1lbnREaXIoZWwpIHtcbiAgcmV0dXJuIGdldEVsZW1lbnRQcm9wKGVsLCBcImRpclwiLCBcImx0clwiKTtcbn1cbmZ1bmN0aW9uIGdldEVsZW1lbnRQcm9wKGVsLCBwcm9wLCB2YWx1ZSkge1xuICBjb25zdCBjbG9zZXN0V2l0aFByb3AgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWwsIGBbJHtwcm9wfV1gKTtcbiAgcmV0dXJuIGNsb3Nlc3RXaXRoUHJvcCA/IGNsb3Nlc3RXaXRoUHJvcC5nZXRBdHRyaWJ1dGUocHJvcCkgOiB2YWx1ZTtcbn1cbi8vIGNzc1xuY29uc3QgQ1NTX1VUSUxJVFkgPSB7XG4gIHJ0bDogXCJhcmNnaXMtLXJ0bFwiXG59O1xuYXN5bmMgZnVuY3Rpb24gZm9ybWF0TnVtYmVyKG51bWJlciwgb3B0aW9ucykge1xuICBjb25zdCB7IGFwaSwgdHlwZSwgcGxhY2VzIH0gPSBvcHRpb25zIHx8IHt9O1xuICBpZiAoYXBpID09PSA0KSB7XG4gICAgY29uc3QgW2ludGxdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9pbnRsXCJdKTtcbiAgICBjb25zdCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyA9IGludGwuY29udmVydE51bWJlckZvcm1hdFRvSW50bE9wdGlvbnMoe1xuICAgICAgcGxhY2VzLFxuICAgICAgc3R5bGU6IHR5cGUsXG4gICAgICBkaWdpdFNlcGFyYXRvcjogdHJ1ZVxuICAgIH0pO1xuICAgIHJldHVybiBpbnRsLmZvcm1hdE51bWJlcihudW1iZXIsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMpLCB7IHN0eWxlOiB0eXBlIH0pKTtcbiAgfVxuICBjb25zdCBbZG9qb051bWJlcl0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJkb2pvL251bWJlclwiXSk7XG4gIHJldHVybiBkb2pvTnVtYmVyLmZvcm1hdChudW1iZXIsIHtcbiAgICB0eXBlLFxuICAgIHBsYWNlcyxcbiAgICBwYXR0ZXJuOiBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMucGF0dGVyblxuICB9KTtcbn1cbmNvbnN0IGNhY2hlID0ge307XG5mdW5jdGlvbiBmb3JtYXREYXRlKGRhdGUpIHtcbiAgY29uc3QgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nO1xuICBjb25zdCBkYXlTaG9ydE1vbnRoWWVhciA9IHtcbiAgICB5ZWFyOiBcIm51bWVyaWNcIixcbiAgICBtb250aDogXCJzaG9ydFwiLFxuICAgIGRheTogXCJudW1lcmljXCJcbiAgfTtcbiAgaWYgKCFjYWNoZVtsYW5nXSkge1xuICAgIGNhY2hlW2xhbmddID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmxhbmcsIGRheVNob3J0TW9udGhZZWFyKTtcbiAgfVxuICByZXR1cm4gY2FjaGVbbGFuZ10uZm9ybWF0KGRhdGUpO1xufVxuXG5leHBvcnQgeyBDU1NfVVRJTElUWSBhcyBDLCBmb3JtYXREYXRlIGFzIGEsIGZvcm1hdE51bWJlciBhcyBmLCBnZXRFbGVtZW50RGlyIGFzIGcsIGxhbmd1YWdlTWFwIGFzIGwgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgeyBsIGFzIGxhbmd1YWdlTWFwIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtMjIyNThjOTAuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRBc3NldFBhdGggfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcblxuLy8gaHR0cHM6Ly9tZWRpdW0uY29tL3N0ZW5jaWwtdHJpY2tzL2ltcGxlbWVudGluZy1pbnRlcm5hdGlvbmFsaXNhdGlvbi1pMThuLXdpdGgtc3RlbmNpbC01ZTY1NTk1NTQxMTdcbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KSB7XG4gIHZhciBfYSwgX2IsIF9jO1xuICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICB9XG4gIGVsc2Uge1xuICAgIC8vIFwicnUtUlVcIiBtYXBzIHRvIFwicnVcIiB1c2UgY2FzZVxuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZy5zbGljZSgwLCAyKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCkge1xuICB2YXIgX2EsIF9iLCBfYztcbiAgLy8gaXQncyBPSyBpZiB3ZSBkb24ndCBoYXZlIHRoZSA0IGxldHRlciBsYW5ndWFnZSBmaWxlIGZvciBpdFxuICAvLyA0IGxldHRlciBsYW5ndWFnZSBjb2RlIG5lZWRlZCBmb3IgZm9ybWF0dGluZyBudW1iZXJzXG4gIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgLy8gd2Ugc3VwcG9ydCB0aGUgMiBsZXR0ZXIgY29kZWQgbGFuZ3VhZ2VcbiAgICAgIC8vIGUuZy4gaXQtQ0ggdnMgaXRcbiAgICAgIHJldHVybiBsYW5nO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBcImVuXCI7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgZmV0Y2goZ2V0QXNzZXRQYXRoKGAuLi9hcmNnaXMtYXBwLWFzc2V0cy9pMThuLyR7Y29tcG9uZW50TmFtZX0uaTE4bi4ke2xvY2FsZX0uanNvbmApKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgIGlmIChyZXN1bHQub2spXG4gICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XG4gICAgICBlbHNlXG4gICAgICAgIHJlamVjdCgpO1xuICAgIH0sICgpID0+IHJlamVjdCgpKTtcbiAgfSk7XG59XG5jb25zdCBzdHJpbmdDYWNoZSA9IHt9O1xuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICBjb25zdCBpZCA9IGAke2NvbXBvbmVudE5hbWV9JHtsb2NhbGV9YDtcbiAgaWYgKCFzdHJpbmdDYWNoZVtpZF0pIHtcbiAgICBzdHJpbmdDYWNoZVtpZF0gPSBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKTtcbiAgfVxuICByZXR1cm4gc3RyaW5nQ2FjaGVbaWRdO1xufVxuLyoqXG4gKiBHZXQgc3RyaW5ncyBhbmQgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGlzIG1ldGhvZCByZXR1cm5zIDIgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGUgZmlyc3Qgb25lIHJldHVybnMgYSBjb2RlIHRoYXQncyBhbHNvIHN1cHBvcnRlZCBhcyBhIGxhbmd1YWdlIGZpbGUuXG4gKiBUaGUgc2Vjb25kIG9uZSByZXR1cm5zIGEgY29kZSB3aGVyZSB0aGVyZSBpcyBzdXBwb3J0IGZvciB0aGUgZmlyc3QgMiBsZXR0ZXJzIG9mIHRoZSBjb2RlIGFzIHBhcnQgb2YgYSBsYW5ndWFnZSBmaWxlLFxuICogYnV0IHdpbGwgcmV0dXJuIHRoZSBvcmlnaW5hbCA0IGxldHRlciBjb2RlIGZyb20gdGhlIHBhZ2UuXG4gKiBFLmcuIEZvciBcIml0LWNoXCIgaXQgd2lsbCByZXR1cm4gXCJpdFwiIGFzIHRoZSBmaXJzdCBsYW5ndWFnZSBjb2RlIGFuZCBcIml0LWNoXCIgYXMgdGhlIHNlY29uZC5cbiAqIFRoZSBzZWNvbmQgb25lIGlzIHJlcXVpcmVkIGZvciBlc3JpLmludGwuc2V0TG9jYWxlKCkgdG8gZ2V0IHRoZSBjb3JyZWN0IGZvcm1hdHRpbmcuXG4gKlxuICogSWYgYSB0YWdOYW1lIGlzIHByb3ZpZGVkIGl0IHdpbGwgb3ZlcndpdGUgdGhlIGVsZW1lbnQncyB0YWdOYW1lXG4gKlxuICogIEByZXR1cm4gWyBzdHJpbmdzLCBmaXJzdCBsYW5ndWFnZSBjb2RlLCBzZWNvbmQgbGFuZ3VhZ2UgY29kZV1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyhlbGVtZW50LCB0YWdOYW1lKSB7XG4gIGNvbnN0IGNvbXBvbmVudE5hbWUgPSB0YWdOYW1lIHx8IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCBjb21wb25lbnRMYW5ndWFnZSA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KTtcbiAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2VJbnRsID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KTtcbiAgbGV0IHN0cmluZ3M7XG4gIHRyeSB7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBjb21wb25lbnRMYW5ndWFnZSk7XG4gIH1cbiAgY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLndhcm4oYG5vIGxvY2FsZSBmb3IgJHtjb21wb25lbnROYW1lfSAoJHtjb21wb25lbnRMYW5ndWFnZX0pIGxvYWRpbmcgZGVmYXVsdCBsb2NhbGUgZW4uYCk7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBcImVuXCIpO1xuICB9XG4gIHJldHVybiBbc3RyaW5ncywgY29tcG9uZW50TGFuZ3VhZ2UsIGNvbXBvbmVudExhbmd1YWdlSW50bF07XG59XG5cbmV4cG9ydCB7IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZSBhcyBhLCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIGFzIGcgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgciBhcyByZXF1ZXN0LCBnIGFzIGdldFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9wb3J0YWwtNzljYWFlZmYuanMnO1xuXG5jb25zdCBnZXRTdWJzY3JpcHRpb25JbmZvID0gYXN5bmMgKHBvcnRhbCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHN1YnNjcmlwdGlvbkluZm8gPSBhd2FpdCByZXF1ZXN0KGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9cG9ydGFscy9zZWxmL3N1YnNjcmlwdGlvbkluZm9gKTtcbiAgICByZXR1cm4geyByZXN1bHQ6IHN1YnNjcmlwdGlvbkluZm8gfTtcbiAgfVxuICBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICB9XG59O1xuXG5leHBvcnQgeyBnZXRTdWJzY3JpcHRpb25JbmZvIGFzIGcgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLWViNWY3ZGMyLmpzJztcbmltcG9ydCB7IGEgYXMgYWRkSXRlbVN0YXRlIH0gZnJvbSAnLi9hZGQtaXRlbS05N2Q1NzdhOS5qcyc7XG5cbmNvbnN0IFRFTEVNRVRSWV9JRCA9IFwiY3JlYXRlIHRpbGUgbGF5ZXJcIjtcbmNvbnN0IFRFTEVNRVRSWV9QQUdFX05BTUUgPSBcIm15IGNvbnRlbnRcIjtcbmNvbnN0IG1hcFRpbGVMYXllck9wdGlvblRvVGVsZW1ldHJ5ID0gKHR5cGUpID0+IHtcbiAgc3dpdGNoICh0eXBlKSB7XG4gICAgY2FzZSBcInN0b3JlXCI6XG4gICAgICByZXR1cm4gXCJkYXRhIHN0b3JlXCI7XG4gICAgY2FzZSBcImV4aXN0aW5nXCI6XG4gICAgICByZXR1cm4gXCJmc1wiO1xuICAgIGNhc2UgXCJ1cGxvYWRcIjpcbiAgICAgIHJldHVybiBcInVwbG9hZFwiO1xuICB9XG59O1xuY29uc3QgbWFwVGlsZUxheWVyVHlwZVRvVGVsZW1ldHJ5ID0gKHR5cGUpID0+IHtcbiAgc3dpdGNoICh0eXBlKSB7XG4gICAgY2FzZSBcInRpbGVzXCI6XG4gICAgICByZXR1cm4gXCJyYXN0ZXJcIjtcbiAgICBjYXNlIFwidmVjdG9yVGlsZXNcIjpcbiAgICAgIHJldHVybiBcInZlY3RvclwiO1xuICB9XG59O1xuY29uc3QgbG9nVGlsZUxheWVyU3RhcnQgPSAoKSA9PiB7XG4gIHZhciBfYTtcbiAgKF9hID0gY29uZmlnU3RhdGUudGVsZW1ldHJ5KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhcnRXb3JrZmxvdyhURUxFTUVUUllfSUQsIHtcbiAgICBjYXRlZ29yeTogXCJjcmVhdGUgdGlsZSBsYXllclwiLFxuICAgIHBhZ2VOYW1lOiBcIm15IGNvbnRlbnRcIlxuICB9KTtcbn07XG5jb25zdCBsb2dUaWxlTGF5ZXJGcm9tT3B0aW9uID0gKCkgPT4ge1xuICBjb25zdCB0ZWxlbWV0cnkgPSBjb25maWdTdGF0ZS50ZWxlbWV0cnk7XG4gIHRlbGVtZXRyeSA9PT0gbnVsbCB8fCB0ZWxlbWV0cnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbGVtZXRyeS5zdGVwV29ya2Zsb3coVEVMRU1FVFJZX0lELCBcImZyb20gb3B0aW9uXCIsIHtcbiAgICBjYXRlZ29yeTogVEVMRU1FVFJZX0lELFxuICAgIGF0dHJpYnV0ZTogbWFwVGlsZUxheWVyT3B0aW9uVG9UZWxlbWV0cnkoYWRkSXRlbVN0YXRlLmFkZFRpbGVMYXllck9wdGlvbiksXG4gICAgZGV0YWlsczogbWFwVGlsZUxheWVyVHlwZVRvVGVsZW1ldHJ5KGFkZEl0ZW1TdGF0ZS50aWxlTGF5ZXJQdWJsaXNoVHlwZSksXG4gICAgcGFnZU5hbWU6IFRFTEVNRVRSWV9QQUdFX05BTUVcbiAgfSk7XG59O1xuY29uc3QgbG9nVGlsZUxheWVyRmluaXNoID0gKCkgPT4ge1xuICBjb25zdCB0ZWxlbWV0cnkgPSBjb25maWdTdGF0ZS50ZWxlbWV0cnk7XG4gIHRlbGVtZXRyeSA9PT0gbnVsbCB8fCB0ZWxlbWV0cnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbGVtZXRyeS5lbmRXb3JrZmxvdyhURUxFTUVUUllfSUQsIHtcbiAgICBjYXRlZ29yeTogVEVMRU1FVFJZX0lELFxuICAgIGF0dHJpYnV0ZTogbWFwVGlsZUxheWVyT3B0aW9uVG9UZWxlbWV0cnkoYWRkSXRlbVN0YXRlLmFkZFRpbGVMYXllck9wdGlvbiksXG4gICAgZGV0YWlsczogbWFwVGlsZUxheWVyVHlwZVRvVGVsZW1ldHJ5KGFkZEl0ZW1TdGF0ZS50aWxlTGF5ZXJQdWJsaXNoVHlwZSksXG4gICAgcGFnZU5hbWU6IFRFTEVNRVRSWV9QQUdFX05BTUVcbiAgfSk7XG59O1xuXG5leHBvcnQgeyBsb2dUaWxlTGF5ZXJGaW5pc2ggYXMgYSwgbG9nVGlsZUxheWVyRnJvbU9wdGlvbiBhcyBiLCBsb2dUaWxlTGF5ZXJTdGFydCBhcyBsIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGEgYXMgaXRlbVByb3BlcnRpZXNTdG9yZSwgaSBhcyBpdGVtUHJvcGVydGllc1N0YXRlIH0gZnJvbSAnLi9pdGVtLXByb3BlcnRpZXMtZTY0MTJhOWEuanMnO1xuaW1wb3J0IHsgZCBhcyBhZGRJdGVtU3RvcmUsIGEgYXMgYWRkSXRlbVN0YXRlIH0gZnJvbSAnLi9hZGQtaXRlbS05N2Q1NzdhOS5qcyc7XG5pbXBvcnQgeyB1IGFzIHVpU3RvcmVTdGF0ZSB9IGZyb20gJy4vdWktZWNmODZiYmEuanMnO1xuXG5mdW5jdGlvbiByZXNldEFkZEl0ZW1TdG9yZXMoKSB7XG4gIGFkZEl0ZW1TdG9yZS5yZXNldCgpO1xuICBpdGVtUHJvcGVydGllc1N0b3JlLnJlc2V0KCk7XG59XG5jb25zdCByZXNldFN0b3JlT25Ib21lID0gKCkgPT4ge1xuICBpZiAoYWRkSXRlbVN0YXRlLmV4aXN0aW5nSXRlbSB8fCB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwicmVnaXN0ZXJcIikge1xuICAgIHJldHVybjtcbiAgfVxuICBhZGRJdGVtU3RvcmUucmVzZXQoKTtcbiAgY29uc3QgZm9sZGVyID0gaXRlbVByb3BlcnRpZXNTdGF0ZS5mb2xkZXI7XG4gIGl0ZW1Qcm9wZXJ0aWVzU3RvcmUucmVzZXQoKTtcbiAgaXRlbVByb3BlcnRpZXNTdGF0ZS5mb2xkZXIgPSBmb2xkZXI7XG59O1xuXG5leHBvcnQgeyByZXNldFN0b3JlT25Ib21lIGFzIGEsIHJlc2V0QWRkSXRlbVN0b3JlcyBhcyByIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=