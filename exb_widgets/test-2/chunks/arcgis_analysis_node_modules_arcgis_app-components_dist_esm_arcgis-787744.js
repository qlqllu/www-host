"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-787744"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-image-collection-explorer.entry.js":
/*!***********************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-image-collection-explorer.entry.js ***!
  \***********************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_image_collection_explorer: () => (/* binding */ ArcgisImageCollectionExplorer)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./layer-ee0d645e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/layer-ee0d645e.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */








const arcgisImageCollectionExplorerCss = ":host{display:flex;flex:1 1 auto;overflow:hidden}.switch-button-wrapper{padding:0.5rem 0}.apply-button-wrapper{display:flex;justify-content:center}.image-item-preview-wrapper{width:100%;height:300px}.image-item-card-list{width:100%;padding:0;overflow-y:auto;list-style:none}.image-item-card-content-wrapper{display:flex;gap:1rem}.image-item-card-content-wrapper>img{height:70px;width:70px}.image-collection-item-card-list-header{display:flex;justify-content:space-between;align-items:center}.image-item-count-chip{display:inline-block;padding:0.375rem;border-radius:9999px;background-color:var(--calcite-ui-foreground-3)}.image-item-count-chip.selected{background-color:var(--calcite-ui-brand);color:var(--calcite-ui-text-inverse)}.image-item-card:hover{border:1px solid var(--calcite-ui-info)}.image-item-inspect-button-group{text-align:start}.image-item-select-wrapper{display:flex;align-items:center;padding:0 2rem}.image-item-select-block{padding:10px;padding-bottom:0}.image-item-card-displayed-field-list{list-style-type:none;padding:0;margin:0;word-break:break-word}.aoi-select-button{border:1px solid var(--calcite-ui-border-input)}.aoi-select-opt-wrapper{display:flex;flex-direction:column}.image-item-info-table-wrapper{display:block;overflow-x:auto}.dropdown-container{display:flex;justify-content:space-between;gap:1rem}";

const ArcgisImageCollectionExplorer = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisImageItemExplorerDismissedChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisImageItemExplorerDismissedChange", 7);
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    this.handleCloseClick = () => {
      this.arcgisImageItemExplorerDismissedChange.emit();
    };
    this.handleActiveTabChange = (activeTab) => {
      this.activeTab = activeTab;
    };
    this.handleImageItemQueryApplied = async () => {
      var _a, _b, _c, _d;
      this.isShowingFilteredImageItemResultsPane = true;
      const { view, layer, selectedAOI, activeQueryField, isOverviewsIncluded, selectedQueryFieldValues } = this;
      this.isQueryingImageItems = true;
      this.clearImageItemSelection();
      this.imageItemCardDisplayedFieldNames = [];
      const layerQuery = (0,_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.b)(layer, activeQueryField, selectedQueryFieldValues, selectedAOI, isOverviewsIncluded, view.extent);
      let imageItemCount;
      let imageItems;
      try {
        if (selectedAOI === _layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.A.Visible) {
          imageItems = await (0,_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.g)(layer, view, layerQuery);
          imageItemCount = (_b = (_a = imageItems === null || imageItems === void 0 ? void 0 : imageItems.features) === null || _a === void 0 ? void 0 : _a.length) !== null && _b !== void 0 ? _b : 0;
        }
        else {
          imageItemCount = await (0,_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.a)(layer, layerQuery);
          imageItems = await (0,_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.c)(layer, layerQuery);
        }
        this.totalImageItemCount = imageItemCount;
      }
      catch (_e) {
        this.totalImageItemCount = 0;
        this.imageItems = null;
        // throw out error
      }
      finally {
        this.isQueryingImageItems = false;
      }
      if (!Array.isArray(imageItems === null || imageItems === void 0 ? void 0 : imageItems.features)) {
        this.imageItems = null;
        this.inspectImageItemObjectId = null;
        return;
      }
      const objectIdFieldName = layer.objectIdField;
      const firstImageItemObjectId = ((_c = this.selectedImageItemObjectIds) === null || _c === void 0 ? void 0 : _c.length) > 0
        ? this.selectedImageItemObjectIds[0]
        : (_d = imageItems.features[0]) === null || _d === void 0 ? void 0 : _d.attributes[objectIdFieldName];
      this.imageItems = imageItems;
      this.inspectImageItemObjectId = firstImageItemObjectId;
      this.handleDisplayedFieldsInImageItemCardChange(activeQueryField.name);
      this.refreshImageItemInfo(firstImageItemObjectId);
    };
    this.handleSelectedImageItemChange = (selectedImageItemObjectId) => {
      this.inspectImageItemObjectId = selectedImageItemObjectId;
      this.refreshImageItemInfo(selectedImageItemObjectId);
    };
    this.handleSelectNextImageItem = () => {
      const { selectedImageItemObjectIds, inspectImageItemObjectId, imageItems, layer } = this;
      const objectIdFieldName = layer.objectIdField;
      const inspectImageItemObjectIds = selectedImageItemObjectIds.length > 0
        ? selectedImageItemObjectIds
        : imageItems.features.map((f) => f.attributes[objectIdFieldName]);
      const currentObjectIdIndex = inspectImageItemObjectIds.findIndex((oid) => oid === inspectImageItemObjectId);
      const newObjectIdIndex = currentObjectIdIndex + 1 === inspectImageItemObjectIds.length ? 0 : currentObjectIdIndex + 1;
      const newImageItemObjectId = inspectImageItemObjectIds[newObjectIdIndex];
      this.inspectImageItemObjectId = newImageItemObjectId;
      this.refreshImageItemInfo(newImageItemObjectId);
    };
    this.handleSelectPrevImageItem = () => {
      const { selectedImageItemObjectIds, inspectImageItemObjectId, imageItems, layer } = this;
      const objectIdFieldName = layer.objectIdField;
      const inspectRasterItemObjectIds = selectedImageItemObjectIds.length > 0
        ? selectedImageItemObjectIds
        : imageItems.features.map((f) => f.attributes[objectIdFieldName]);
      const currentObjectIdIndex = inspectRasterItemObjectIds.findIndex((oid) => oid === inspectImageItemObjectId);
      const newObjectIdIndex = currentObjectIdIndex - 1 < 0
        ? inspectRasterItemObjectIds.length - 1
        : currentObjectIdIndex - 1;
      const newRasterItemObjectId = inspectRasterItemObjectIds[newObjectIdIndex];
      this.inspectImageItemObjectId = newRasterItemObjectId;
      this.refreshImageItemInfo(newRasterItemObjectId);
    };
    this.refreshImageItemInfo = async (imageItemObjectId) => {
      const { layer } = this;
      const imageItemInfo = await layer.getCatalogItemRasterInfo(imageItemObjectId);
      this.imageItemInfo = imageItemInfo;
    };
    this.handleDisplayedFieldsInImageItemCardChange = (fieldName) => {
      const { imageItemCardDisplayedFieldNames, layer, activeQueryField } = this;
      let newDisplayFieldNames = [];
      if (!imageItemCardDisplayedFieldNames.includes(fieldName)) {
        newDisplayFieldNames = [...imageItemCardDisplayedFieldNames, fieldName];
      }
      const defaultDisplayFields = (0,_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.d)(layer, activeQueryField);
      defaultDisplayFields.forEach((field) => {
        if (!newDisplayFieldNames.includes(field.name)) {
          newDisplayFieldNames.push(field.name);
        }
      });
      this.imageItemCardDisplayedFieldNames = newDisplayFieldNames;
    };
    this.handleOpenConfigResultsModal = () => {
      const { isShowingConfigResultsModal } = this;
      this.isShowingConfigResultsModal = !isShowingConfigResultsModal;
    };
    this.handleImageItemCardMouseOver = async (imageItemGeometry) => {
      const { view, imageItemExtentGraphic, imageItemExtentGraphicLayer, modules } = this;
      const { Color, Graphic, GraphicsLayer, SimpleFillSymbol } = modules;
      if (!imageItemExtentGraphicLayer) {
        const graphicsLayer = new GraphicsLayer();
        view.map.add(graphicsLayer);
        this.imageItemExtentGraphicLayer = graphicsLayer;
      }
      if (this.imageItemExtentGraphic) {
        this.imageItemExtentGraphicLayer.removeAll();
        imageItemExtentGraphic.geometry = imageItemGeometry;
        this.imageItemExtentGraphicLayer.add(imageItemExtentGraphic);
      }
      else {
        const symbol = new SimpleFillSymbol({
          outline: {
            color: new Color([214, 137, 16]),
            width: 2
          },
          color: new Color([249, 231, 159, 0.5])
        });
        const imageItemExtGraphic = new Graphic({ geometry: imageItemGeometry, symbol });
        this.imageItemExtentGraphic = imageItemExtGraphic;
        this.imageItemExtentGraphicLayer.add(imageItemExtGraphic);
      }
    };
    this.handleImageItemCardMouseOut = () => {
      var _a;
      this.imageItemExtentGraphic = null;
      (_a = this.imageItemExtentGraphicLayer) === null || _a === void 0 ? void 0 : _a.removeAll();
    };
    this.getLayerAttributeValues = async (fieldName) => {
      var _a, _b;
      const { layer, view, selectedAOI, fetchAbortController } = this;
      if (fetchAbortController) {
        fetchAbortController.abort();
      }
      let uniqueVals = [];
      try {
        this.fetchAbortController = new AbortController();
        this.isQueryingFieldValues = true;
        this.fieldValuesForInput = [];
        this.selectedQueryFieldValues = [];
        const [minValue, maxValue] = await (0,_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.e)(layer, fieldName, selectedAOI, view.extent, (_a = this.fetchAbortController) === null || _a === void 0 ? void 0 : _a.signal);
        this.fieldMinMaxValuesForInput = [minValue, maxValue];
        uniqueVals = await (0,_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.f)(layer, fieldName, selectedAOI, view.extent, (_b = this.fetchAbortController) === null || _b === void 0 ? void 0 : _b.signal);
        this.isQueryingFieldValues = false;
      }
      catch (err) {
        // `abort error` indicates there is another ongoing request
        this.isQueryingFieldValues = (0,_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.i)(err) ? true : false;
      }
      this.fieldValuesForInput = uniqueVals;
    };
    this.clearImageItemSelection = () => {
      this.selectedImageItemObjectIds = [];
    };
    this.showTooltip = (props) => {
      this.dismissTooltip();
      this.tooltipEl = document.createElement("calcite-tooltip");
      this.tooltipEl.placement = "auto";
      this.tooltipEl.referenceElement = props.referenceElement;
      this.tooltipEl.overlayPositioning = "fixed";
      this.tooltipEl.innerHTML = props.innerHTML;
      this.tooltipEl.open = true;
      this.hostElement.parentElement.appendChild(this.tooltipEl);
    };
    this.dismissTooltip = () => {
      var _a;
      if ((_a = this.tooltipEl) === null || _a === void 0 ? void 0 : _a.parentNode) {
        this.tooltipEl.parentNode.removeChild(this.tooltipEl);
        this.tooltipEl = undefined;
      }
    };
    this.jsapiUrl = undefined;
    this.portal = undefined;
    this.layer = undefined;
    this.view = undefined;
    this.activeTab = _layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.N.Select;
    this.activeQueryField = undefined;
    this.selectedAOI = _layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.A.Visible;
    this.totalImageItemCount = 0;
    this.imageItems = undefined;
    this.selectedImageItemObjectIds = [];
    this.inspectImageItemObjectId = undefined;
    this.imageItemInfo = undefined;
    this.imageItemCardDisplayedFieldNames = [];
    this.isShowingFilteredImageItemResultsPane = false;
    this.isShowingConfigResultsModal = false;
    this.isShowingThumbnails = false;
    this.isOverviewsIncluded = false;
    this.isQueryingImageItems = false;
    this.isQueryingFieldValues = false;
    this.selectedQueryFieldValues = [];
    this.fieldValuesForInput = [];
    this.fieldMinMaxValuesForInput = [];
    this.isRangeValueModeSelected = true;
  }
  handleConfigCardResultsModalClosed() {
    this.isShowingConfigResultsModal = false;
  }
  handleConfigCardResultsModalSaved(e) {
    const { selectedFieldNames, isShowingThumbnails } = e.detail;
    this.isShowingThumbnails = isShowingThumbnails;
    this.imageItemCardDisplayedFieldNames = selectedFieldNames;
  }
  //--------------------------------------------------------------------------
  //
  //  public calls
  //
  //--------------------------------------------------------------------------
  async setFocus() {
    var _a;
    (_a = this.refCloseButtonNode) === null || _a === void 0 ? void 0 : _a.setFocus();
  }
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  async componentWillLoad() {
    var _a;
    [this.strings] = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement);
    const [Color, IdentityManager, Graphic, GraphicsLayer, SimpleFillSymbol] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_3__.l)([
      "esri/Color",
      "esri/identity/IdentityManager",
      "esri/Graphic",
      "esri/layers/GraphicsLayer",
      "esri/symbols/SimpleFillSymbol"
    ]);
    this.modules = {
      Color,
      IdentityManager,
      Graphic,
      GraphicsLayer,
      SimpleFillSymbol
    };
    const supportedLayerFields = (0,_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.h)((_a = this.layer) === null || _a === void 0 ? void 0 : _a.fields);
    const defaultField = (0,_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.j)(supportedLayerFields);
    const selectedField = this.activeQueryField || defaultField;
    this.activeQueryField = selectedField;
    this.getLayerAttributeValues(selectedField.name);
  }
  // --------------------------------------------------------------------------
  //
  //  Render methods
  //
  // --------------------------------------------------------------------------
  render() {
    const { activeTab, strings, inspectImageItemObjectId, imageItemInfo, imageItemCardDisplayedFieldNames, isShowingFilteredImageItemResultsPane, isShowingThumbnails, layer } = this;
    const rtl = (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement) === "rtl";
    const loading = !(layer === null || layer === void 0 ? void 0 : layer.loaded);
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { loading: loading, heading: strings.imageCollectionExplorer, class: {
        panel: true,
        [_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_2__.C.rtl]: rtl
      } }, this.renderClose(), this.renderActionGroup(), activeTab === _layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.N.Select && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.renderSelectInput(), isShowingFilteredImageItemResultsPane && this.renderSelectResults(), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-config-image-item-card-results-modal", { open: this.isShowingConfigResultsModal, fields: layer.fields, preSelectedFieldNames: imageItemCardDisplayedFieldNames, isShowingThumbnails: isShowingThumbnails }))), activeTab === _layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.N.Inspect &&
      (inspectImageItemObjectId && inspectImageItemObjectId > 0 ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.renderImageItemSelectDropdown(), this.renderImageItemPreviewView(), imageItemInfo && this.renderImageItemInfoTables())) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, strings.noSelectedItemToInspectCoachMessage))))));
  }
  renderClose() {
    const { strings } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { text: strings.close, icon: "x", slot: "header-actions-end", onClick: this.handleCloseClick, ref: (node) => (this.refCloseButtonNode = node) }));
  }
  renderActionGroup() {
    const { strings, activeTab } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action-group", { layout: "grid", scale: "l", columns: 2 }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { "data-label": _layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.N.Select, active: activeTab === _layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.N.Select, text: strings.select, textEnabled: true, alignment: "center", onClick: () => this.handleActiveTabChange(_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.N.Select) }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { "data-label": _layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.N.Inspect, active: activeTab === _layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.N.Inspect, text: strings.inspect, textEnabled: true, alignment: "center", onClick: () => this.handleActiveTabChange(_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.N.Inspect) })));
  }
  renderSelectInput() {
    const { strings } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { collapsible: true, heading: strings.filters, open: true }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.renderAOISelectDropdown(), this.renderAttributeSelectDropdown(), this.renderAttributeInputField(), this.renderIncludeOverviewSwitchButton(), this.renderApplyButton())));
  }
  renderAOISelectDropdown() {
    const { strings, selectedAOI } = this;
    const aoiOptions = [
      { name: _layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.A.Visible, label: strings.visible, description: strings.visibleDesc },
      {
        name: _layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.A.DisplayExtent,
        label: strings.displayExtent,
        description: strings.displayExtentDesc
      },
      { name: _layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.A.All, label: strings.all, description: strings.allDesc }
    ];
    const selectedAOIOpt = aoiOptions.find((opt) => opt.name === selectedAOI);
    const aoiDropdownItems = aoiOptions.map((opt) => {
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { "data-value": opt.name, selected: opt.name === selectedAOIOpt.name }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", null, opt.label), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, opt.description)));
    });
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.areaOfInterest, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown", { width: "m", placement: "bottom", onCalciteDropdownSelect: (event) => {
        var _a, _b;
        const dropdown = event.currentTarget;
        const selectedAOIOpt = (_b = (_a = dropdown === null || dropdown === void 0 ? void 0 : dropdown.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.getAttribute("data-value");
        this.selectedAOI = selectedAOIOpt;
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: "aoi-select-button", slot: "trigger", alignment: "space-between", "icon-end": "chevron-down", appearance: "transparent", kind: "neutral", width: "full" }, selectedAOIOpt.label), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", null, aoiDropdownItems))));
  }
  renderAttributeSelectDropdown() {
    const { strings, activeQueryField, layer } = this;
    const supportedLayerFields = (0,_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.h)(layer === null || layer === void 0 ? void 0 : layer.fields);
    const layerAttributeOptions = supportedLayerFields.map((field) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: field.name, label: field.alias, selected: field.name === activeQueryField.name })));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.attribute, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: strings.attribute, onCalciteSelectChange: (event) => {
        const selectedFieldName = event.currentTarget
          .selectedOption.value;
        this.activeQueryField = supportedLayerFields.find((f) => f.name === selectedFieldName);
        this.getLayerAttributeValues(selectedFieldName);
      } }, layerAttributeOptions)));
  }
  renderAttributeInputField() {
    const { activeQueryField } = this;
    const fieldType = activeQueryField.type;
    if ((0,_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.k)(fieldType) || fieldType === "date") {
      return this.renderAttributeSliderInput();
    }
    return this.renderAttributeDropdownInput();
  }
  renderSliderSelectedVals() {
    const { selectedQueryFieldValues, fieldMinMaxValuesForInput, activeQueryField } = this;
    const rangeVals = selectedQueryFieldValues.length > 0 ? selectedQueryFieldValues : fieldMinMaxValuesForInput;
    let startVal;
    let endVal;
    if (rangeVals.length === 2) {
      [startVal, endVal] = rangeVals;
      if (activeQueryField.type === "date") {
        startVal = (0,_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.l)(startVal);
        endVal = (0,_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.l)(endVal);
      }
      return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, `${startVal} - ${endVal}`);
    }
    if (rangeVals.length === 1) {
      [startVal] = rangeVals;
      if (activeQueryField.type === "date") {
        startVal = (0,_layer_ee0d645e_js__WEBPACK_IMPORTED_MODULE_4__.l)(startVal);
      }
      return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, `${startVal}`);
    }
    return null;
  }
  renderAttributeSliderInput() {
    var _a;
    const { strings, fieldMinMaxValuesForInput, isRangeValueModeSelected } = this;
    const validMinMaxVals = fieldMinMaxValuesForInput.filter((val) => typeof val === "number");
    const isShowingSlider = validMinMaxVals.length === 2 && validMinMaxVals[0] !== validMinMaxVals[1];
    const isShowingDropdown = validMinMaxVals.length === 2 && validMinMaxVals[0] === validMinMaxVals[1];
    if (isShowingDropdown) {
      const [value] = validMinMaxVals;
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: strings.select, onCalciteSelectChange: (event) => {
          const selectedOptValue = event.currentTarget
            .selectedOption.value;
          this.selectedQueryFieldValues = [selectedOptValue];
        } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: value.toString(), label: value.toString(), selected: ((_a = this.selectedQueryFieldValues) === null || _a === void 0 ? void 0 : _a.length) > 0 &&
          value.toString() === this.selectedQueryFieldValues[0].toString() })));
    }
    if (isShowingSlider) {
      const minVal = validMinMaxVals[0];
      const maxVal = validMinMaxVals[1];
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.renderRangeModeSwitchButton(), this.renderSliderSelectedVals(), isRangeValueModeSelected ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-slider", { minValue: minVal, maxValue: maxVal, min: minVal, max: maxVal, snap: true, precise: true, onCalciteSliderChange: (event) => {
          const slider = event.target;
          if (Array.isArray(slider.value)) {
            this.selectedQueryFieldValues = [slider.value[0], slider.value[1]];
          }
          else {
            this.selectedQueryFieldValues = [slider.value];
          }
        } })) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-slider", { value: validMinMaxVals[1], min: validMinMaxVals[0], max: validMinMaxVals[1], snap: true, precise: true, onCalciteSliderChange: (event) => {
          const slider = event.target;
          if (Array.isArray(slider.value)) {
            this.selectedQueryFieldValues = [slider.value[0], slider.value[1]];
          }
          else {
            this.selectedQueryFieldValues = [slider.value];
          }
        } }))));
    }
  }
  renderAttributeDropdownInput() {
    const { strings, fieldValuesForInput, isQueryingFieldValues } = this;
    const fieldValueOptions = fieldValuesForInput.map((val) => {
      var _a;
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: val.toString(), label: val.toString(), selected: ((_a = this.selectedQueryFieldValues) === null || _a === void 0 ? void 0 : _a.length) > 0 &&
          val.toString() === this.selectedQueryFieldValues[0].toString() }));
    });
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: strings.select, disabled: isQueryingFieldValues, width: "full", onCalciteSelectChange: (event) => {
        let selectedVal = event.currentTarget.selectedOption.value;
        this.selectedQueryFieldValues = [selectedVal];
      } }, fieldValueOptions));
  }
  renderRangeModeSwitchButton() {
    const { strings, isRangeValueModeSelected, fieldMinMaxValuesForInput } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "switch-button-wrapper" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline", scale: "m", style: { width: "100%" } }, strings.rangeMode, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { icon: "information", scale: "s", text: strings.rangeMode, ref: (node) => (this.rangeModeHelpIconActionEl = node), onMouseOver: () => this.showTooltip({
        referenceElement: this.rangeModeHelpIconActionEl,
        innerHTML: strings.rangeModelHelpMessage
      }), onMouseOut: () => this.dismissTooltip(), onClick: (event) => {
        event.stopPropagation();
      }, id: "rangeMode" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { style: { marginInlineStart: "auto" } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { checked: isRangeValueModeSelected, scale: "m", onCalciteSwitchChange: (event) => {
        const checked = event.target.checked;
        this.isRangeValueModeSelected = checked;
        const validMinMaxVals = fieldMinMaxValuesForInput.filter((val) => typeof val === "number");
        this.selectedQueryFieldValues = checked
          ? [validMinMaxVals[0], validMinMaxVals[1]]
          : [validMinMaxVals[0]];
      } })))));
  }
  renderIncludeOverviewSwitchButton() {
    const { strings, isOverviewsIncluded } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "include-overviews-switch-button-wrapper" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline", scale: "m", style: { width: "100%" } }, strings.includeOverviews, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { icon: "information", scale: "s", text: strings.includeOverviewsHelpMessage, ref: (node) => (this.isIncludeOverviewsHelpIconActionEl = node), onMouseOver: () => this.showTooltip({
        referenceElement: this.isIncludeOverviewsHelpIconActionEl,
        innerHTML: strings.includeOverviewsHelpMessage
      }), onMouseOut: () => this.dismissTooltip(), onClick: (event) => {
        event.stopPropagation();
      }, id: "includeOverviews" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { style: { marginInlineStart: "auto" } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { checked: isOverviewsIncluded, scale: "m", onCalciteSwitchChange: (event) => {
        const checked = event.target.checked;
        this.isOverviewsIncluded = checked;
      } })))));
  }
  renderApplyButton() {
    const { strings, isQueryingFieldValues, isQueryingImageItems } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "apply-button-wrapper" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { label: strings.apply, onClick: this.handleImageItemQueryApplied, appearance: "solid", width: "half", disabled: isQueryingFieldValues || isQueryingImageItems }, strings.apply)));
  }
  renderSelectResults() {
    const { strings, isQueryingImageItems, totalImageItemCount, imageItems } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { collapsible: true, open: true, heading: strings.results }, isQueryingImageItems ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: strings.loading, scale: "m" })) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, !(totalImageItemCount > 0) && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, strings.emptyList), totalImageItemCount > 0 ? this.renderImageItemListButtonGroup() : null, imageItems ? this.renderImageItemCardList() : null))));
  }
  renderSelectedImageItemCount() {
    const { strings, totalImageItemCount, selectedImageItemObjectIds } = this;
    const selectedImageItemCount = selectedImageItemObjectIds.length;
    const selectedAndTotalImageCountStr = strings.selectedAndTotalImageItemCountInfo
      .replace("${totalCount}", totalImageItemCount.toString())
      .replace("${selectedCount}", selectedImageItemCount.toString());
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: `image-item-count-chip ${selectedImageItemCount > 0 ? "selected" : ""}` }, selectedAndTotalImageCountStr, selectedImageItemCount > 0 && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "solid", kind: "brand", "icon-start": "x", scale: "s", onClick: () => this.clearImageItemSelection() }))));
  }
  renderImageItemListButtonGroup() {
    const { strings, selectedImageItemObjectIds } = this;
    const hasImageSelected = selectedImageItemObjectIds.length > 0;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "image-collection-item-card-list-header" }, this.renderSelectedImageItemCount(), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { style: { display: "flex" } }, hasImageSelected && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { "aria-label": strings.lockItems, appearance: "transparent", "icon-start": "lock", kind: "neutral", scale: "s" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { "aria-label": strings.unlockItems, appearance: "transparent", "icon-start": "unlock", kind: "neutral", scale: "s" }))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { "aria-label": strings.configureResults, appearance: "transparent", "icon-start": "sliders-horizontal", kind: "neutral", scale: "s", onClick: this.handleOpenConfigResultsModal }))));
  }
  renderImageItemCardList() {
    const { imageItems, selectedImageItemObjectIds, layer, isShowingThumbnails } = this;
    if (!(imageItems === null || imageItems === void 0 ? void 0 : imageItems.features)) {
      return null;
    }
    const objectIdFieldName = layer.objectIdField;
    const imageItemCards = imageItems.features.map((feature) => {
      const itemObjectId = feature.attributes[objectIdFieldName];
      const isItemSelected = this.selectedImageItemObjectIds.includes(itemObjectId);
      const imageItemGeometry = feature.geometry;
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("li", { onMouseOver: () => this.handleImageItemCardMouseOver(imageItemGeometry), onMouseOut: () => this.handleImageItemCardMouseOut() }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-card", { class: "image-item-card", selectable: true, selected: isItemSelected, onCalciteCardSelect: () => {
          const newSelectedItemOIds = isItemSelected
            ? selectedImageItemObjectIds.filter((oid) => oid !== itemObjectId)
            : [...selectedImageItemObjectIds, itemObjectId];
          this.selectedImageItemObjectIds = newSelectedItemOIds.sort();
        } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "image-item-card-content-wrapper" }, isShowingThumbnails ? this.renderPreviewThumbnail(itemObjectId) : null, this.renderFeatureAttributesInImageItemCard(feature)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "footer-start" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "footer-end" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { kind: "neutral", "icon-start": "add-layer", appearance: "transparent" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { kind: "neutral", "icon-start": "lock", appearance: "transparent" })))));
    });
    return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("ul", { class: "image-item-card-list" }, imageItemCards);
  }
  renderImageItemSelectDropdown() {
    var _a;
    const { strings, layer, imageItems, inspectImageItemObjectId, selectedImageItemObjectIds } = this;
    const objectIdFieldName = layer.objectIdField;
    const imageItemFeatures = selectedImageItemObjectIds.length > 0
      ? imageItems === null || imageItems === void 0 ? void 0 : imageItems.features.filter((f) => selectedImageItemObjectIds.includes(f.attributes[objectIdFieldName])).map((f) => f.attributes)
      : (_a = imageItems === null || imageItems === void 0 ? void 0 : imageItems.features.map((f) => f.attributes)) !== null && _a !== void 0 ? _a : [];
    const imageItemOptions = imageItemFeatures.map((f) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: f[objectIdFieldName].toString(), label: `${f[objectIdFieldName]}: ${f.Name}`, selected: f[objectIdFieldName] === inspectImageItemObjectId })));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "image-item-select-block" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.selectedImages, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "image-item-select-wrapper" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "chevron-left", onClick: this.handleSelectPrevImageItem }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { width: "full", label: strings.selectedImages, onCalciteSelectChange: (event) => {
        const selectedImageItemObjectId = event.currentTarget
          .selectedOption.value;
        this.handleSelectedImageItemChange(Number(selectedImageItemObjectId));
      } }, imageItemOptions), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "chevron-right", onClick: this.handleSelectNextImageItem })))));
  }
  renderImageItemPreviewView() {
    const { strings, layer, jsapiUrl, inspectImageItemObjectId } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { collapsible: true, open: true, heading: strings.preview }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "image-item-preview-wrapper" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-image-item-preview", { jsapiUrl: jsapiUrl, previewLayerUrl: layer.url, previewImageItemObjectId: inspectImageItemObjectId }))));
  }
  renderImageItemInfoTables() {
    const { imageItemInfo } = this;
    const { extent, statistics } = imageItemInfo || {};
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, imageItemInfo ? this.renderImageItemInspectButtonGroup() : null, imageItemInfo ? this.renderImageItemRasterInformationTable() : null, imageItemInfo ? this.renderImageItemRasterMetadataTable() : null, extent ? this.renderImageItemExtentInfoTable() : null, imageItemInfo ? this.renderImageItemSpatialReferenceTable() : null, statistics ? this.renderImageItemStatisticsInfoTable() : null));
  }
  renderImageItemRasterInformationTable() {
    const { strings, imageItemInfo } = this;
    const tableColumns = [
      { accessor: "property", header: strings.property },
      { accessor: "value", header: strings.value }
    ];
    const { bandCount, height, width, pixelType, pixelSize, dataType, colormap } = imageItemInfo;
    const rasterInfoData = [
      { property: strings.columns, value: width },
      { property: strings.rows, value: height },
      { property: strings.bandNumber, value: bandCount },
      { property: strings.cellSizeX, value: pixelSize === null || pixelSize === void 0 ? void 0 : pixelSize.x },
      { property: strings.cellSizeY, value: pixelSize === null || pixelSize === void 0 ? void 0 : pixelSize.y },
      { property: strings.sourceType, value: dataType },
      { property: strings.pixelType, value: pixelType },
      { property: strings.pixelDepth, value: bandCount },
      { property: strings.colormap, value: colormap }
    ].filter((info) => !!info.value);
    const hasRasterInfoData = rasterInfoData.length > 0;
    return (hasRasterInfoData && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { collapsible: true, open: true, heading: strings.rasterInformation }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "image-item-info-table-wrapper" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-image-item-info-table", { columns: tableColumns, data: rasterInfoData })))));
  }
  renderImageItemRasterMetadataTable() {
    const { strings, imageItemInfo } = this;
    const tableColumns = [
      { accessor: "property", header: strings.property },
      { accessor: "value", header: strings.value }
    ];
    const { SensorName, ProductName, CloudCover, AcquisitionDate, SunAzimuth, SunElevation, ELLIPSOID } = imageItemInfo.keyProperties || {};
    const formattedDate = AcquisitionDate
      ? `${new Date(AcquisitionDate).toLocaleDateString()} ${new Date(AcquisitionDate).toLocaleTimeString()}`
      : null;
    const rasterMetaData = [
      { property: strings.sensorName, value: SensorName },
      { property: strings.productName, value: ProductName },
      { property: strings.acquisitionDate, value: formattedDate },
      { property: strings.cloudCover, value: CloudCover },
      { property: strings.sunAzimuth, value: SunAzimuth },
      { property: strings.sunElevation, value: SunElevation },
      { property: strings.spheroid, value: ELLIPSOID }
    ].filter((info) => !!info.value);
    const hasRasterMetaData = rasterMetaData.length > 0;
    return (hasRasterMetaData && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { collapsible: true, open: true, heading: strings.rasterMetadata }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "image-item-info-table-wrapper" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-image-item-info-table", { columns: tableColumns, data: rasterMetaData })))));
  }
  renderImageItemExtentInfoTable() {
    const { strings, imageItemInfo } = this;
    const tableColumns = [
      { accessor: "property", header: strings.property },
      { accessor: "value", header: strings.value }
    ];
    const { extent } = imageItemInfo;
    const { xmin, xmax, ymin, ymax } = extent;
    const rasterExtentData = [
      { property: strings.top, value: ymax },
      { property: strings.bottom, value: ymin },
      { property: strings.left, value: xmin },
      { property: strings.right, value: xmax }
    ].filter((info) => !!info.value);
    const hasRasterExtentData = rasterExtentData.length > 0;
    return (hasRasterExtentData && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { collapsible: true, open: true, heading: strings.extent }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-image-item-info-table", { columns: tableColumns, data: rasterExtentData }))));
  }
  renderImageItemStatisticsInfoTable() {
    const { strings, imageItemInfo } = this;
    const tableColumns = [
      { accessor: "bandName", header: strings.bandName },
      { accessor: "min", header: strings.min },
      { accessor: "max", header: strings.max },
      { accessor: "avg", header: strings.mean },
      { accessor: "stddev", header: strings.std }
    ];
    const { bandInfos, statistics } = imageItemInfo;
    const bandStatsData = bandInfos.map((bandInfo, index) => {
      const bandStats = statistics[index];
      return Object.assign({ bandName: bandInfo.name }, bandStats);
    });
    const hasBandStatsData = bandStatsData.length > 0;
    return (hasBandStatsData && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { collapsible: true, open: true, heading: strings.statistics }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "image-item-info-table-wrapper" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-image-item-info-table", { columns: tableColumns, data: bandStatsData })))));
  }
  renderImageItemSpatialReferenceTable() {
    const { strings, imageItemInfo } = this;
    const tableColumns = [
      { accessor: "property", header: strings.property },
      { accessor: "value", header: strings.value }
    ];
    const { keyProperties, spatialReference } = imageItemInfo;
    const spatialReferenceData = [
      { property: strings.projectedCoordinateSystem, value: "" },
      { property: strings.projection, value: "" },
      { property: strings.wkid, value: spatialReference === null || spatialReference === void 0 ? void 0 : spatialReference.wkid },
      { property: strings.datum, value: keyProperties === null || keyProperties === void 0 ? void 0 : keyProperties.DATUM },
      { property: strings.spheroid, value: keyProperties === null || keyProperties === void 0 ? void 0 : keyProperties.ELLIPSOID }
    ].filter((info) => !!info.value);
    const hasValidSpatialReferenceData = spatialReferenceData.length > 0;
    return (hasValidSpatialReferenceData && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { collapsible: true, open: true, heading: strings.spatialReference }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "image-item-info-table-wrapper" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-image-item-info-table", { columns: tableColumns, data: spatialReferenceData })))));
  }
  renderImageItemInspectButtonGroup() {
    const { strings } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "image-item-inspect-button-group" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { "aria-label": strings.addLayer, appearance: "transparent", "icon-start": "add-layer", kind: "neutral", scale: "s" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { "aria-label": strings.zoomToItem, appearance: "transparent", "icon-start": "layer-zoom-to", kind: "neutral", scale: "s" })));
  }
  renderPreviewThumbnail(imageItemObjectId) {
    const { layer, modules } = this;
    const { IdentityManager } = modules;
    const layerCredential = IdentityManager.findCredential(layer.url);
    const { token } = layerCredential || {};
    const thumbnailImgSrcStr = `${layer.url}/${imageItemObjectId}/thumbnail${token ? `?token=${token}` : ""}`;
    return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("img", { slot: "thumbnail", src: thumbnailImgSrcStr });
  }
  renderFeatureAttributesInImageItemCard(feature) {
    const { imageItemCardDisplayedFieldNames } = this;
    const displayedAttributesList = imageItemCardDisplayedFieldNames.map((field) => {
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("li", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", null, field), `: ${feature.attributes[field]}`));
    });
    return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("ul", { class: "image-item-card-displayed-field-list" }, displayedAttributesList);
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisImageCollectionExplorer.style = arcgisImageCollectionExplorerCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



const languageMap = new Map([
  ["ar", "ar"],
  ["bg", "bg"],
  ["bs", "bs"],
  ["ca", "ca"],
  ["cs", "cs"],
  ["da", "da"],
  ["de", "de"],
  ["el", "el"],
  ["en", "en"],
  ["es", "es"],
  ["et", "et"],
  ["fi", "fi"],
  ["fr", "fr"],
  ["he", "he"],
  ["hr", "hr"],
  ["hu", "hu"],
  ["id", "id"],
  ["it", "it"],
  ["ja", "ja"],
  ["ko", "ko"],
  ["lt", "lt"],
  ["lv", "lv"],
  ["nb", "nb"],
  ["nl", "nl"],
  ["pl", "pl"],
  ["pt-br", "pt-BR"],
  ["pt-pt", "pt-PT"],
  ["ro", "ro"],
  ["ru", "ru"],
  ["sk", "sk"],
  ["sl", "sl"],
  ["sr", "sr"],
  ["sv", "sv"],
  ["th", "th"],
  ["tr", "tr"],
  ["uk", "uk"],
  ["vi", "vi"],
  ["zh-cn", "zh-CN"],
  ["zh-hk", "zh-HK"],
  ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
  return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
  const closestWithProp = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
  return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
  rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
  const { api, type, places } = options || {};
  if (api === 4) {
    const [intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
    const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
      places,
      style: type,
      digitSeparator: true
    });
    return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
  }
  const [dojoNumber] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
  return dojoNumber.format(number, {
    type,
    places,
    pattern: options === null || options === void 0 ? void 0 : options.pattern
  });
}
const cache = {};
function formatDate(date) {
  const lang = document.documentElement.lang;
  const dayShortMonthYear = {
    year: "numeric",
    month: "short",
    day: "numeric"
  };
  if (!cache[lang]) {
    cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
  }
  return cache[lang].format(date);
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
  var _a, _b, _c;
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    // "ru-RU" maps to "ru" use case
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
    }
    else {
      return "en";
    }
  }
}
function getComponentClosestLanguageIntl(element) {
  var _a, _b, _c;
  // it's OK if we don't have the 4 letter language file for it
  // 4 letter language code needed for formatting numbers
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      // we support the 2 letter coded language
      // e.g. it-CH vs it
      return lang;
    }
    else {
      return "en";
    }
  }
}
function fetchLocaleStringsForComponent(componentName, locale) {
  return new Promise((resolve, reject) => {
    fetch((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
      if (result.ok)
        resolve(result.json());
      else
        reject();
    }, () => reject());
  });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
  const id = `${componentName}${locale}`;
  if (!stringCache[id]) {
    stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
  }
  return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
  const componentName = tagName || element.tagName.toLowerCase();
  const componentLanguage = getComponentClosestLanguage(element);
  const componentLanguageIntl = getComponentClosestLanguageIntl(element);
  let strings;
  try {
    strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
  }
  catch (e) {
    console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
    strings = await fetchLocaleStringsFromCache(componentName, "en");
  }
  return [strings, componentLanguage, componentLanguageIntl];
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTc4Nzc0NC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzZHO0FBQ3ZDO0FBQ1k7QUFDckI7QUFDcVg7QUFDdlo7QUFDTzs7QUFFbEMsZ0RBQWdELGFBQWEsY0FBYyxnQkFBZ0IsdUJBQXVCLGlCQUFpQixzQkFBc0IsYUFBYSx1QkFBdUIsNEJBQTRCLFdBQVcsYUFBYSxzQkFBc0IsV0FBVyxVQUFVLGdCQUFnQixnQkFBZ0IsaUNBQWlDLGFBQWEsU0FBUyxxQ0FBcUMsWUFBWSxXQUFXLHdDQUF3QyxhQUFhLDhCQUE4QixtQkFBbUIsdUJBQXVCLHFCQUFxQixpQkFBaUIscUJBQXFCLGdEQUFnRCxnQ0FBZ0MseUNBQXlDLHFDQUFxQyx1QkFBdUIsd0NBQXdDLGlDQUFpQyxpQkFBaUIsMkJBQTJCLGFBQWEsbUJBQW1CLGVBQWUseUJBQXlCLGFBQWEsaUJBQWlCLHNDQUFzQyxxQkFBcUIsVUFBVSxTQUFTLHNCQUFzQixtQkFBbUIsZ0RBQWdELHdCQUF3QixhQUFhLHNCQUFzQiwrQkFBK0IsY0FBYyxnQkFBZ0Isb0JBQW9CLGFBQWEsOEJBQThCLFNBQVM7O0FBRTkxQztBQUNBO0FBQ0EsSUFBSSxxREFBZ0I7QUFDcEIsa0RBQWtELHFEQUFXO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLDRGQUE0RjtBQUMxRztBQUNBO0FBQ0E7QUFDQSx5QkFBeUIscURBQWU7QUFDeEM7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLGlEQUFHO0FBQy9CLDZCQUE2QixxREFBNEI7QUFDekQ7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLHFEQUFpQjtBQUNsRCw2QkFBNkIscURBQXFCO0FBQ2xEO0FB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O0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFc0c7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUM3RnRHO0FBQ0E7QUFDQTtBQUNBO0FBQzJFO0FBQ2I7QUFDTjs7QUFFeEQ7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLG1EQUFpQztBQUNoRTtBQUNBO0FBQ0EsTUFBTSx3REFBVztBQUNqQixXQUFXLHdEQUFXO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBLFFBQVEsd0RBQVc7QUFDbkIsYUFBYSx3REFBVztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixtREFBaUM7QUFDaEU7QUFDQTtBQUNBLE1BQU0sd0RBQVc7QUFDakIsV0FBVyx3REFBVztBQUN0QjtBQUNBO0FBQ0EsUUFBUSx3REFBVztBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxxREFBWSw4QkFBOEIsY0FBYyxRQUFRLE9BQU87QUFDakY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixjQUFjLEVBQUUsT0FBTztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsZUFBZSxHQUFHLGtCQUFrQjtBQUN0RTtBQUNBO0FBQ0E7QUFDQTs7QUFFNEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtaW1hZ2UtY29sbGVjdGlvbi1leHBsb3Jlci5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sYW5ndWFnZVV0aWwtMjIyNThjOTAuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbG9jYWxlLTEzZTAwYTc1LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtOTJlYmIzOTYuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIH0gZnJvbSAnLi9sb2NhbGUtMTNlMDBhNzUuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRFbGVtZW50RGlyLCBDIGFzIENTU19VVElMSVRZIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtMjIyNThjOTAuanMnO1xuaW1wb3J0IHsgbCBhcyBsb2FkTW9kdWxlcyB9IGZyb20gJy4vbG9hZE1vZHVsZXMtYWFmMzBiZDYuanMnO1xuaW1wb3J0IHsgYiBhcyBidWlsZExheWVyUXVlcnksIEEgYXMgQU9JLCBnIGFzIGdldEZpbHRlcmVkVmlzaWJsZUltYWdlSXRlbXMsIGEgYXMgZ2V0SW1hZ2VJdGVtQ291bnQsIGMgYXMgZ2V0RmlsdGVyZWRJbWFnZUl0ZW1zLCBkIGFzIGdldERlZmF1bHRJbWFnZUl0ZW1DYXJkRGlzcGxheWVkRmllbGRzLCBlIGFzIGdldE1pbkFuZE1heFZhbHVlc0ZvckxheWVyRmllbGQsIGYgYXMgZ2V0VW5pcXVlVmFsdWVzRm9yTGF5ZXJGaWVsZCwgaSBhcyBpc0Fib3J0ZWRFcnJvciwgTiBhcyBOYXZpZ2F0aW9uVGFiLCBoIGFzIGdldFN1cHBvcnRlZExheWVyRmllbGRzLCBqIGFzIGdldERlZmF1bHRTZWxlY3RlZExheWVyRmllbGQsIGsgYXMgaXNOdW1lcmljRmllbGRUeXBlLCBsIGFzIGdldEZvcm1hdHRlZERhdGVTdHJpbmcgfSBmcm9tICcuL2xheWVyLWVlMGQ2NDVlLmpzJztcbmltcG9ydCAnLi9kb20tMTNmNWIwMGMuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtYzgyZjVhYjkuanMnO1xuXG5jb25zdCBhcmNnaXNJbWFnZUNvbGxlY3Rpb25FeHBsb3JlckNzcyA9IFwiOmhvc3R7ZGlzcGxheTpmbGV4O2ZsZXg6MSAxIGF1dG87b3ZlcmZsb3c6aGlkZGVufS5zd2l0Y2gtYnV0dG9uLXdyYXBwZXJ7cGFkZGluZzowLjVyZW0gMH0uYXBwbHktYnV0dG9uLXdyYXBwZXJ7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXJ9LmltYWdlLWl0ZW0tcHJldmlldy13cmFwcGVye3dpZHRoOjEwMCU7aGVpZ2h0OjMwMHB4fS5pbWFnZS1pdGVtLWNhcmQtbGlzdHt3aWR0aDoxMDAlO3BhZGRpbmc6MDtvdmVyZmxvdy15OmF1dG87bGlzdC1zdHlsZTpub25lfS5pbWFnZS1pdGVtLWNhcmQtY29udGVudC13cmFwcGVye2Rpc3BsYXk6ZmxleDtnYXA6MXJlbX0uaW1hZ2UtaXRlbS1jYXJkLWNvbnRlbnQtd3JhcHBlcj5pbWd7aGVpZ2h0OjcwcHg7d2lkdGg6NzBweH0uaW1hZ2UtY29sbGVjdGlvbi1pdGVtLWNhcmQtbGlzdC1oZWFkZXJ7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmNlbnRlcn0uaW1hZ2UtaXRlbS1jb3VudC1jaGlwe2Rpc3BsYXk6aW5saW5lLWJsb2NrO3BhZGRpbmc6MC4zNzVyZW07Ym9yZGVyLXJhZGl1czo5OTk5cHg7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMyl9LmltYWdlLWl0ZW0tY291bnQtY2hpcC5zZWxlY3RlZHtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktYnJhbmQpO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC1pbnZlcnNlKX0uaW1hZ2UtaXRlbS1jYXJkOmhvdmVye2JvcmRlcjoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1pbmZvKX0uaW1hZ2UtaXRlbS1pbnNwZWN0LWJ1dHRvbi1ncm91cHt0ZXh0LWFsaWduOnN0YXJ0fS5pbWFnZS1pdGVtLXNlbGVjdC13cmFwcGVye2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7cGFkZGluZzowIDJyZW19LmltYWdlLWl0ZW0tc2VsZWN0LWJsb2Nre3BhZGRpbmc6MTBweDtwYWRkaW5nLWJvdHRvbTowfS5pbWFnZS1pdGVtLWNhcmQtZGlzcGxheWVkLWZpZWxkLWxpc3R7bGlzdC1zdHlsZS10eXBlOm5vbmU7cGFkZGluZzowO21hcmdpbjowO3dvcmQtYnJlYWs6YnJlYWstd29yZH0uYW9pLXNlbGVjdC1idXR0b257Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLXVpLWJvcmRlci1pbnB1dCl9LmFvaS1zZWxlY3Qtb3B0LXdyYXBwZXJ7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbn0uaW1hZ2UtaXRlbS1pbmZvLXRhYmxlLXdyYXBwZXJ7ZGlzcGxheTpibG9jaztvdmVyZmxvdy14OmF1dG99LmRyb3Bkb3duLWNvbnRhaW5lcntkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47Z2FwOjFyZW19XCI7XG5cbmNvbnN0IEFyY2dpc0ltYWdlQ29sbGVjdGlvbkV4cGxvcmVyID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc0ltYWdlSXRlbUV4cGxvcmVyRGlzbWlzc2VkQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJbWFnZUl0ZW1FeHBsb3JlckRpc21pc3NlZENoYW5nZVwiLCA3KTtcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICB0aGlzLmhhbmRsZUNsb3NlQ2xpY2sgPSAoKSA9PiB7XG4gICAgICB0aGlzLmFyY2dpc0ltYWdlSXRlbUV4cGxvcmVyRGlzbWlzc2VkQ2hhbmdlLmVtaXQoKTtcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlQWN0aXZlVGFiQ2hhbmdlID0gKGFjdGl2ZVRhYikgPT4ge1xuICAgICAgdGhpcy5hY3RpdmVUYWIgPSBhY3RpdmVUYWI7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZUltYWdlSXRlbVF1ZXJ5QXBwbGllZCA9IGFzeW5jICgpID0+IHtcbiAgICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICAgIHRoaXMuaXNTaG93aW5nRmlsdGVyZWRJbWFnZUl0ZW1SZXN1bHRzUGFuZSA9IHRydWU7XG4gICAgICBjb25zdCB7IHZpZXcsIGxheWVyLCBzZWxlY3RlZEFPSSwgYWN0aXZlUXVlcnlGaWVsZCwgaXNPdmVydmlld3NJbmNsdWRlZCwgc2VsZWN0ZWRRdWVyeUZpZWxkVmFsdWVzIH0gPSB0aGlzO1xuICAgICAgdGhpcy5pc1F1ZXJ5aW5nSW1hZ2VJdGVtcyA9IHRydWU7XG4gICAgICB0aGlzLmNsZWFySW1hZ2VJdGVtU2VsZWN0aW9uKCk7XG4gICAgICB0aGlzLmltYWdlSXRlbUNhcmREaXNwbGF5ZWRGaWVsZE5hbWVzID0gW107XG4gICAgICBjb25zdCBsYXllclF1ZXJ5ID0gYnVpbGRMYXllclF1ZXJ5KGxheWVyLCBhY3RpdmVRdWVyeUZpZWxkLCBzZWxlY3RlZFF1ZXJ5RmllbGRWYWx1ZXMsIHNlbGVjdGVkQU9JLCBpc092ZXJ2aWV3c0luY2x1ZGVkLCB2aWV3LmV4dGVudCk7XG4gICAgICBsZXQgaW1hZ2VJdGVtQ291bnQ7XG4gICAgICBsZXQgaW1hZ2VJdGVtcztcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmIChzZWxlY3RlZEFPSSA9PT0gQU9JLlZpc2libGUpIHtcbiAgICAgICAgICBpbWFnZUl0ZW1zID0gYXdhaXQgZ2V0RmlsdGVyZWRWaXNpYmxlSW1hZ2VJdGVtcyhsYXllciwgdmlldywgbGF5ZXJRdWVyeSk7XG4gICAgICAgICAgaW1hZ2VJdGVtQ291bnQgPSAoX2IgPSAoX2EgPSBpbWFnZUl0ZW1zID09PSBudWxsIHx8IGltYWdlSXRlbXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGltYWdlSXRlbXMuZmVhdHVyZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IDA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgaW1hZ2VJdGVtQ291bnQgPSBhd2FpdCBnZXRJbWFnZUl0ZW1Db3VudChsYXllciwgbGF5ZXJRdWVyeSk7XG4gICAgICAgICAgaW1hZ2VJdGVtcyA9IGF3YWl0IGdldEZpbHRlcmVkSW1hZ2VJdGVtcyhsYXllciwgbGF5ZXJRdWVyeSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50b3RhbEltYWdlSXRlbUNvdW50ID0gaW1hZ2VJdGVtQ291bnQ7XG4gICAgICB9XG4gICAgICBjYXRjaCAoX2UpIHtcbiAgICAgICAgdGhpcy50b3RhbEltYWdlSXRlbUNvdW50ID0gMDtcbiAgICAgICAgdGhpcy5pbWFnZUl0ZW1zID0gbnVsbDtcbiAgICAgICAgLy8gdGhyb3cgb3V0IGVycm9yXG4gICAgICB9XG4gICAgICBmaW5hbGx5IHtcbiAgICAgICAgdGhpcy5pc1F1ZXJ5aW5nSW1hZ2VJdGVtcyA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGltYWdlSXRlbXMgPT09IG51bGwgfHwgaW1hZ2VJdGVtcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogaW1hZ2VJdGVtcy5mZWF0dXJlcykpIHtcbiAgICAgICAgdGhpcy5pbWFnZUl0ZW1zID0gbnVsbDtcbiAgICAgICAgdGhpcy5pbnNwZWN0SW1hZ2VJdGVtT2JqZWN0SWQgPSBudWxsO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBvYmplY3RJZEZpZWxkTmFtZSA9IGxheWVyLm9iamVjdElkRmllbGQ7XG4gICAgICBjb25zdCBmaXJzdEltYWdlSXRlbU9iamVjdElkID0gKChfYyA9IHRoaXMuc2VsZWN0ZWRJbWFnZUl0ZW1PYmplY3RJZHMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5sZW5ndGgpID4gMFxuICAgICAgICA/IHRoaXMuc2VsZWN0ZWRJbWFnZUl0ZW1PYmplY3RJZHNbMF1cbiAgICAgICAgOiAoX2QgPSBpbWFnZUl0ZW1zLmZlYXR1cmVzWzBdKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QuYXR0cmlidXRlc1tvYmplY3RJZEZpZWxkTmFtZV07XG4gICAgICB0aGlzLmltYWdlSXRlbXMgPSBpbWFnZUl0ZW1zO1xuICAgICAgdGhpcy5pbnNwZWN0SW1hZ2VJdGVtT2JqZWN0SWQgPSBmaXJzdEltYWdlSXRlbU9iamVjdElkO1xuICAgICAgdGhpcy5oYW5kbGVEaXNwbGF5ZWRGaWVsZHNJbkltYWdlSXRlbUNhcmRDaGFuZ2UoYWN0aXZlUXVlcnlGaWVsZC5uYW1lKTtcbiAgICAgIHRoaXMucmVmcmVzaEltYWdlSXRlbUluZm8oZmlyc3RJbWFnZUl0ZW1PYmplY3RJZCk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZVNlbGVjdGVkSW1hZ2VJdGVtQ2hhbmdlID0gKHNlbGVjdGVkSW1hZ2VJdGVtT2JqZWN0SWQpID0+IHtcbiAgICAgIHRoaXMuaW5zcGVjdEltYWdlSXRlbU9iamVjdElkID0gc2VsZWN0ZWRJbWFnZUl0ZW1PYmplY3RJZDtcbiAgICAgIHRoaXMucmVmcmVzaEltYWdlSXRlbUluZm8oc2VsZWN0ZWRJbWFnZUl0ZW1PYmplY3RJZCk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZVNlbGVjdE5leHRJbWFnZUl0ZW0gPSAoKSA9PiB7XG4gICAgICBjb25zdCB7IHNlbGVjdGVkSW1hZ2VJdGVtT2JqZWN0SWRzLCBpbnNwZWN0SW1hZ2VJdGVtT2JqZWN0SWQsIGltYWdlSXRlbXMsIGxheWVyIH0gPSB0aGlzO1xuICAgICAgY29uc3Qgb2JqZWN0SWRGaWVsZE5hbWUgPSBsYXllci5vYmplY3RJZEZpZWxkO1xuICAgICAgY29uc3QgaW5zcGVjdEltYWdlSXRlbU9iamVjdElkcyA9IHNlbGVjdGVkSW1hZ2VJdGVtT2JqZWN0SWRzLmxlbmd0aCA+IDBcbiAgICAgICAgPyBzZWxlY3RlZEltYWdlSXRlbU9iamVjdElkc1xuICAgICAgICA6IGltYWdlSXRlbXMuZmVhdHVyZXMubWFwKChmKSA9PiBmLmF0dHJpYnV0ZXNbb2JqZWN0SWRGaWVsZE5hbWVdKTtcbiAgICAgIGNvbnN0IGN1cnJlbnRPYmplY3RJZEluZGV4ID0gaW5zcGVjdEltYWdlSXRlbU9iamVjdElkcy5maW5kSW5kZXgoKG9pZCkgPT4gb2lkID09PSBpbnNwZWN0SW1hZ2VJdGVtT2JqZWN0SWQpO1xuICAgICAgY29uc3QgbmV3T2JqZWN0SWRJbmRleCA9IGN1cnJlbnRPYmplY3RJZEluZGV4ICsgMSA9PT0gaW5zcGVjdEltYWdlSXRlbU9iamVjdElkcy5sZW5ndGggPyAwIDogY3VycmVudE9iamVjdElkSW5kZXggKyAxO1xuICAgICAgY29uc3QgbmV3SW1hZ2VJdGVtT2JqZWN0SWQgPSBpbnNwZWN0SW1hZ2VJdGVtT2JqZWN0SWRzW25ld09iamVjdElkSW5kZXhdO1xuICAgICAgdGhpcy5pbnNwZWN0SW1hZ2VJdGVtT2JqZWN0SWQgPSBuZXdJbWFnZUl0ZW1PYmplY3RJZDtcbiAgICAgIHRoaXMucmVmcmVzaEltYWdlSXRlbUluZm8obmV3SW1hZ2VJdGVtT2JqZWN0SWQpO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVTZWxlY3RQcmV2SW1hZ2VJdGVtID0gKCkgPT4ge1xuICAgICAgY29uc3QgeyBzZWxlY3RlZEltYWdlSXRlbU9iamVjdElkcywgaW5zcGVjdEltYWdlSXRlbU9iamVjdElkLCBpbWFnZUl0ZW1zLCBsYXllciB9ID0gdGhpcztcbiAgICAgIGNvbnN0IG9iamVjdElkRmllbGROYW1lID0gbGF5ZXIub2JqZWN0SWRGaWVsZDtcbiAgICAgIGNvbnN0IGluc3BlY3RSYXN0ZXJJdGVtT2JqZWN0SWRzID0gc2VsZWN0ZWRJbWFnZUl0ZW1PYmplY3RJZHMubGVuZ3RoID4gMFxuICAgICAgICA/IHNlbGVjdGVkSW1hZ2VJdGVtT2JqZWN0SWRzXG4gICAgICAgIDogaW1hZ2VJdGVtcy5mZWF0dXJlcy5tYXAoKGYpID0+IGYuYXR0cmlidXRlc1tvYmplY3RJZEZpZWxkTmFtZV0pO1xuICAgICAgY29uc3QgY3VycmVudE9iamVjdElkSW5kZXggPSBpbnNwZWN0UmFzdGVySXRlbU9iamVjdElkcy5maW5kSW5kZXgoKG9pZCkgPT4gb2lkID09PSBpbnNwZWN0SW1hZ2VJdGVtT2JqZWN0SWQpO1xuICAgICAgY29uc3QgbmV3T2JqZWN0SWRJbmRleCA9IGN1cnJlbnRPYmplY3RJZEluZGV4IC0gMSA8IDBcbiAgICAgICAgPyBpbnNwZWN0UmFzdGVySXRlbU9iamVjdElkcy5sZW5ndGggLSAxXG4gICAgICAgIDogY3VycmVudE9iamVjdElkSW5kZXggLSAxO1xuICAgICAgY29uc3QgbmV3UmFzdGVySXRlbU9iamVjdElkID0gaW5zcGVjdFJhc3Rlckl0ZW1PYmplY3RJZHNbbmV3T2JqZWN0SWRJbmRleF07XG4gICAgICB0aGlzLmluc3BlY3RJbWFnZUl0ZW1PYmplY3RJZCA9IG5ld1Jhc3Rlckl0ZW1PYmplY3RJZDtcbiAgICAgIHRoaXMucmVmcmVzaEltYWdlSXRlbUluZm8obmV3UmFzdGVySXRlbU9iamVjdElkKTtcbiAgICB9O1xuICAgIHRoaXMucmVmcmVzaEltYWdlSXRlbUluZm8gPSBhc3luYyAoaW1hZ2VJdGVtT2JqZWN0SWQpID0+IHtcbiAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHRoaXM7XG4gICAgICBjb25zdCBpbWFnZUl0ZW1JbmZvID0gYXdhaXQgbGF5ZXIuZ2V0Q2F0YWxvZ0l0ZW1SYXN0ZXJJbmZvKGltYWdlSXRlbU9iamVjdElkKTtcbiAgICAgIHRoaXMuaW1hZ2VJdGVtSW5mbyA9IGltYWdlSXRlbUluZm87XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZURpc3BsYXllZEZpZWxkc0luSW1hZ2VJdGVtQ2FyZENoYW5nZSA9IChmaWVsZE5hbWUpID0+IHtcbiAgICAgIGNvbnN0IHsgaW1hZ2VJdGVtQ2FyZERpc3BsYXllZEZpZWxkTmFtZXMsIGxheWVyLCBhY3RpdmVRdWVyeUZpZWxkIH0gPSB0aGlzO1xuICAgICAgbGV0IG5ld0Rpc3BsYXlGaWVsZE5hbWVzID0gW107XG4gICAgICBpZiAoIWltYWdlSXRlbUNhcmREaXNwbGF5ZWRGaWVsZE5hbWVzLmluY2x1ZGVzKGZpZWxkTmFtZSkpIHtcbiAgICAgICAgbmV3RGlzcGxheUZpZWxkTmFtZXMgPSBbLi4uaW1hZ2VJdGVtQ2FyZERpc3BsYXllZEZpZWxkTmFtZXMsIGZpZWxkTmFtZV07XG4gICAgICB9XG4gICAgICBjb25zdCBkZWZhdWx0RGlzcGxheUZpZWxkcyA9IGdldERlZmF1bHRJbWFnZUl0ZW1DYXJkRGlzcGxheWVkRmllbGRzKGxheWVyLCBhY3RpdmVRdWVyeUZpZWxkKTtcbiAgICAgIGRlZmF1bHREaXNwbGF5RmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICAgIGlmICghbmV3RGlzcGxheUZpZWxkTmFtZXMuaW5jbHVkZXMoZmllbGQubmFtZSkpIHtcbiAgICAgICAgICBuZXdEaXNwbGF5RmllbGROYW1lcy5wdXNoKGZpZWxkLm5hbWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHRoaXMuaW1hZ2VJdGVtQ2FyZERpc3BsYXllZEZpZWxkTmFtZXMgPSBuZXdEaXNwbGF5RmllbGROYW1lcztcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlT3BlbkNvbmZpZ1Jlc3VsdHNNb2RhbCA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHsgaXNTaG93aW5nQ29uZmlnUmVzdWx0c01vZGFsIH0gPSB0aGlzO1xuICAgICAgdGhpcy5pc1Nob3dpbmdDb25maWdSZXN1bHRzTW9kYWwgPSAhaXNTaG93aW5nQ29uZmlnUmVzdWx0c01vZGFsO1xuICAgIH07XG4gICAgdGhpcy5oYW5kbGVJbWFnZUl0ZW1DYXJkTW91c2VPdmVyID0gYXN5bmMgKGltYWdlSXRlbUdlb21ldHJ5KSA9PiB7XG4gICAgICBjb25zdCB7IHZpZXcsIGltYWdlSXRlbUV4dGVudEdyYXBoaWMsIGltYWdlSXRlbUV4dGVudEdyYXBoaWNMYXllciwgbW9kdWxlcyB9ID0gdGhpcztcbiAgICAgIGNvbnN0IHsgQ29sb3IsIEdyYXBoaWMsIEdyYXBoaWNzTGF5ZXIsIFNpbXBsZUZpbGxTeW1ib2wgfSA9IG1vZHVsZXM7XG4gICAgICBpZiAoIWltYWdlSXRlbUV4dGVudEdyYXBoaWNMYXllcikge1xuICAgICAgICBjb25zdCBncmFwaGljc0xheWVyID0gbmV3IEdyYXBoaWNzTGF5ZXIoKTtcbiAgICAgICAgdmlldy5tYXAuYWRkKGdyYXBoaWNzTGF5ZXIpO1xuICAgICAgICB0aGlzLmltYWdlSXRlbUV4dGVudEdyYXBoaWNMYXllciA9IGdyYXBoaWNzTGF5ZXI7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5pbWFnZUl0ZW1FeHRlbnRHcmFwaGljKSB7XG4gICAgICAgIHRoaXMuaW1hZ2VJdGVtRXh0ZW50R3JhcGhpY0xheWVyLnJlbW92ZUFsbCgpO1xuICAgICAgICBpbWFnZUl0ZW1FeHRlbnRHcmFwaGljLmdlb21ldHJ5ID0gaW1hZ2VJdGVtR2VvbWV0cnk7XG4gICAgICAgIHRoaXMuaW1hZ2VJdGVtRXh0ZW50R3JhcGhpY0xheWVyLmFkZChpbWFnZUl0ZW1FeHRlbnRHcmFwaGljKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBjb25zdCBzeW1ib2wgPSBuZXcgU2ltcGxlRmlsbFN5bWJvbCh7XG4gICAgICAgICAgb3V0bGluZToge1xuICAgICAgICAgICAgY29sb3I6IG5ldyBDb2xvcihbMjE0LCAxMzcsIDE2XSksXG4gICAgICAgICAgICB3aWR0aDogMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgY29sb3I6IG5ldyBDb2xvcihbMjQ5LCAyMzEsIDE1OSwgMC41XSlcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGltYWdlSXRlbUV4dEdyYXBoaWMgPSBuZXcgR3JhcGhpYyh7IGdlb21ldHJ5OiBpbWFnZUl0ZW1HZW9tZXRyeSwgc3ltYm9sIH0pO1xuICAgICAgICB0aGlzLmltYWdlSXRlbUV4dGVudEdyYXBoaWMgPSBpbWFnZUl0ZW1FeHRHcmFwaGljO1xuICAgICAgICB0aGlzLmltYWdlSXRlbUV4dGVudEdyYXBoaWNMYXllci5hZGQoaW1hZ2VJdGVtRXh0R3JhcGhpYyk7XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZUltYWdlSXRlbUNhcmRNb3VzZU91dCA9ICgpID0+IHtcbiAgICAgIHZhciBfYTtcbiAgICAgIHRoaXMuaW1hZ2VJdGVtRXh0ZW50R3JhcGhpYyA9IG51bGw7XG4gICAgICAoX2EgPSB0aGlzLmltYWdlSXRlbUV4dGVudEdyYXBoaWNMYXllcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlbW92ZUFsbCgpO1xuICAgIH07XG4gICAgdGhpcy5nZXRMYXllckF0dHJpYnV0ZVZhbHVlcyA9IGFzeW5jIChmaWVsZE5hbWUpID0+IHtcbiAgICAgIHZhciBfYSwgX2I7XG4gICAgICBjb25zdCB7IGxheWVyLCB2aWV3LCBzZWxlY3RlZEFPSSwgZmV0Y2hBYm9ydENvbnRyb2xsZXIgfSA9IHRoaXM7XG4gICAgICBpZiAoZmV0Y2hBYm9ydENvbnRyb2xsZXIpIHtcbiAgICAgICAgZmV0Y2hBYm9ydENvbnRyb2xsZXIuYWJvcnQoKTtcbiAgICAgIH1cbiAgICAgIGxldCB1bmlxdWVWYWxzID0gW107XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLmZldGNoQWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgICAgICB0aGlzLmlzUXVlcnlpbmdGaWVsZFZhbHVlcyA9IHRydWU7XG4gICAgICAgIHRoaXMuZmllbGRWYWx1ZXNGb3JJbnB1dCA9IFtdO1xuICAgICAgICB0aGlzLnNlbGVjdGVkUXVlcnlGaWVsZFZhbHVlcyA9IFtdO1xuICAgICAgICBjb25zdCBbbWluVmFsdWUsIG1heFZhbHVlXSA9IGF3YWl0IGdldE1pbkFuZE1heFZhbHVlc0ZvckxheWVyRmllbGQobGF5ZXIsIGZpZWxkTmFtZSwgc2VsZWN0ZWRBT0ksIHZpZXcuZXh0ZW50LCAoX2EgPSB0aGlzLmZldGNoQWJvcnRDb250cm9sbGVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2lnbmFsKTtcbiAgICAgICAgdGhpcy5maWVsZE1pbk1heFZhbHVlc0ZvcklucHV0ID0gW21pblZhbHVlLCBtYXhWYWx1ZV07XG4gICAgICAgIHVuaXF1ZVZhbHMgPSBhd2FpdCBnZXRVbmlxdWVWYWx1ZXNGb3JMYXllckZpZWxkKGxheWVyLCBmaWVsZE5hbWUsIHNlbGVjdGVkQU9JLCB2aWV3LmV4dGVudCwgKF9iID0gdGhpcy5mZXRjaEFib3J0Q29udHJvbGxlcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnNpZ25hbCk7XG4gICAgICAgIHRoaXMuaXNRdWVyeWluZ0ZpZWxkVmFsdWVzID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgIC8vIGBhYm9ydCBlcnJvcmAgaW5kaWNhdGVzIHRoZXJlIGlzIGFub3RoZXIgb25nb2luZyByZXF1ZXN0XG4gICAgICAgIHRoaXMuaXNRdWVyeWluZ0ZpZWxkVmFsdWVzID0gaXNBYm9ydGVkRXJyb3IoZXJyKSA/IHRydWUgOiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZmllbGRWYWx1ZXNGb3JJbnB1dCA9IHVuaXF1ZVZhbHM7XG4gICAgfTtcbiAgICB0aGlzLmNsZWFySW1hZ2VJdGVtU2VsZWN0aW9uID0gKCkgPT4ge1xuICAgICAgdGhpcy5zZWxlY3RlZEltYWdlSXRlbU9iamVjdElkcyA9IFtdO1xuICAgIH07XG4gICAgdGhpcy5zaG93VG9vbHRpcCA9IChwcm9wcykgPT4ge1xuICAgICAgdGhpcy5kaXNtaXNzVG9vbHRpcCgpO1xuICAgICAgdGhpcy50b29sdGlwRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FsY2l0ZS10b29sdGlwXCIpO1xuICAgICAgdGhpcy50b29sdGlwRWwucGxhY2VtZW50ID0gXCJhdXRvXCI7XG4gICAgICB0aGlzLnRvb2x0aXBFbC5yZWZlcmVuY2VFbGVtZW50ID0gcHJvcHMucmVmZXJlbmNlRWxlbWVudDtcbiAgICAgIHRoaXMudG9vbHRpcEVsLm92ZXJsYXlQb3NpdGlvbmluZyA9IFwiZml4ZWRcIjtcbiAgICAgIHRoaXMudG9vbHRpcEVsLmlubmVySFRNTCA9IHByb3BzLmlubmVySFRNTDtcbiAgICAgIHRoaXMudG9vbHRpcEVsLm9wZW4gPSB0cnVlO1xuICAgICAgdGhpcy5ob3N0RWxlbWVudC5wYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMudG9vbHRpcEVsKTtcbiAgICB9O1xuICAgIHRoaXMuZGlzbWlzc1Rvb2x0aXAgPSAoKSA9PiB7XG4gICAgICB2YXIgX2E7XG4gICAgICBpZiAoKF9hID0gdGhpcy50b29sdGlwRWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5wYXJlbnROb2RlKSB7XG4gICAgICAgIHRoaXMudG9vbHRpcEVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy50b29sdGlwRWwpO1xuICAgICAgICB0aGlzLnRvb2x0aXBFbCA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuanNhcGlVcmwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sYXllciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnZpZXcgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5hY3RpdmVUYWIgPSBOYXZpZ2F0aW9uVGFiLlNlbGVjdDtcbiAgICB0aGlzLmFjdGl2ZVF1ZXJ5RmllbGQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zZWxlY3RlZEFPSSA9IEFPSS5WaXNpYmxlO1xuICAgIHRoaXMudG90YWxJbWFnZUl0ZW1Db3VudCA9IDA7XG4gICAgdGhpcy5pbWFnZUl0ZW1zID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2VsZWN0ZWRJbWFnZUl0ZW1PYmplY3RJZHMgPSBbXTtcbiAgICB0aGlzLmluc3BlY3RJbWFnZUl0ZW1PYmplY3RJZCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmltYWdlSXRlbUluZm8gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pbWFnZUl0ZW1DYXJkRGlzcGxheWVkRmllbGROYW1lcyA9IFtdO1xuICAgIHRoaXMuaXNTaG93aW5nRmlsdGVyZWRJbWFnZUl0ZW1SZXN1bHRzUGFuZSA9IGZhbHNlO1xuICAgIHRoaXMuaXNTaG93aW5nQ29uZmlnUmVzdWx0c01vZGFsID0gZmFsc2U7XG4gICAgdGhpcy5pc1Nob3dpbmdUaHVtYm5haWxzID0gZmFsc2U7XG4gICAgdGhpcy5pc092ZXJ2aWV3c0luY2x1ZGVkID0gZmFsc2U7XG4gICAgdGhpcy5pc1F1ZXJ5aW5nSW1hZ2VJdGVtcyA9IGZhbHNlO1xuICAgIHRoaXMuaXNRdWVyeWluZ0ZpZWxkVmFsdWVzID0gZmFsc2U7XG4gICAgdGhpcy5zZWxlY3RlZFF1ZXJ5RmllbGRWYWx1ZXMgPSBbXTtcbiAgICB0aGlzLmZpZWxkVmFsdWVzRm9ySW5wdXQgPSBbXTtcbiAgICB0aGlzLmZpZWxkTWluTWF4VmFsdWVzRm9ySW5wdXQgPSBbXTtcbiAgICB0aGlzLmlzUmFuZ2VWYWx1ZU1vZGVTZWxlY3RlZCA9IHRydWU7XG4gIH1cbiAgaGFuZGxlQ29uZmlnQ2FyZFJlc3VsdHNNb2RhbENsb3NlZCgpIHtcbiAgICB0aGlzLmlzU2hvd2luZ0NvbmZpZ1Jlc3VsdHNNb2RhbCA9IGZhbHNlO1xuICB9XG4gIGhhbmRsZUNvbmZpZ0NhcmRSZXN1bHRzTW9kYWxTYXZlZChlKSB7XG4gICAgY29uc3QgeyBzZWxlY3RlZEZpZWxkTmFtZXMsIGlzU2hvd2luZ1RodW1ibmFpbHMgfSA9IGUuZGV0YWlsO1xuICAgIHRoaXMuaXNTaG93aW5nVGh1bWJuYWlscyA9IGlzU2hvd2luZ1RodW1ibmFpbHM7XG4gICAgdGhpcy5pbWFnZUl0ZW1DYXJkRGlzcGxheWVkRmllbGROYW1lcyA9IHNlbGVjdGVkRmllbGROYW1lcztcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBwdWJsaWMgY2FsbHNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICB2YXIgX2E7XG4gICAgKF9hID0gdGhpcy5yZWZDbG9zZUJ1dHRvbk5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICB9XG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIExpZmVjeWNsZVxuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHZhciBfYTtcbiAgICBbdGhpcy5zdHJpbmdzXSA9IGF3YWl0IGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3ModGhpcy5ob3N0RWxlbWVudCk7XG4gICAgY29uc3QgW0NvbG9yLCBJZGVudGl0eU1hbmFnZXIsIEdyYXBoaWMsIEdyYXBoaWNzTGF5ZXIsIFNpbXBsZUZpbGxTeW1ib2xdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1xuICAgICAgXCJlc3JpL0NvbG9yXCIsXG4gICAgICBcImVzcmkvaWRlbnRpdHkvSWRlbnRpdHlNYW5hZ2VyXCIsXG4gICAgICBcImVzcmkvR3JhcGhpY1wiLFxuICAgICAgXCJlc3JpL2xheWVycy9HcmFwaGljc0xheWVyXCIsXG4gICAgICBcImVzcmkvc3ltYm9scy9TaW1wbGVGaWxsU3ltYm9sXCJcbiAgICBdKTtcbiAgICB0aGlzLm1vZHVsZXMgPSB7XG4gICAgICBDb2xvcixcbiAgICAgIElkZW50aXR5TWFuYWdlcixcbiAgICAgIEdyYXBoaWMsXG4gICAgICBHcmFwaGljc0xheWVyLFxuICAgICAgU2ltcGxlRmlsbFN5bWJvbFxuICAgIH07XG4gICAgY29uc3Qgc3VwcG9ydGVkTGF5ZXJGaWVsZHMgPSBnZXRTdXBwb3J0ZWRMYXllckZpZWxkcygoX2EgPSB0aGlzLmxheWVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmllbGRzKTtcbiAgICBjb25zdCBkZWZhdWx0RmllbGQgPSBnZXREZWZhdWx0U2VsZWN0ZWRMYXllckZpZWxkKHN1cHBvcnRlZExheWVyRmllbGRzKTtcbiAgICBjb25zdCBzZWxlY3RlZEZpZWxkID0gdGhpcy5hY3RpdmVRdWVyeUZpZWxkIHx8IGRlZmF1bHRGaWVsZDtcbiAgICB0aGlzLmFjdGl2ZVF1ZXJ5RmllbGQgPSBzZWxlY3RlZEZpZWxkO1xuICAgIHRoaXMuZ2V0TGF5ZXJBdHRyaWJ1dGVWYWx1ZXMoc2VsZWN0ZWRGaWVsZC5uYW1lKTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUmVuZGVyIG1ldGhvZHNcbiAgLy9cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgYWN0aXZlVGFiLCBzdHJpbmdzLCBpbnNwZWN0SW1hZ2VJdGVtT2JqZWN0SWQsIGltYWdlSXRlbUluZm8sIGltYWdlSXRlbUNhcmREaXNwbGF5ZWRGaWVsZE5hbWVzLCBpc1Nob3dpbmdGaWx0ZXJlZEltYWdlSXRlbVJlc3VsdHNQYW5lLCBpc1Nob3dpbmdUaHVtYm5haWxzLCBsYXllciB9ID0gdGhpcztcbiAgICBjb25zdCBydGwgPSBnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpID09PSBcInJ0bFwiO1xuICAgIGNvbnN0IGxvYWRpbmcgPSAhKGxheWVyID09PSBudWxsIHx8IGxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllci5sb2FkZWQpO1xuICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiBcImNhbGNpdGUtbWF0Y2gtaGVpZ2h0XCIgfSwgaChcImNhbGNpdGUtcGFuZWxcIiwgeyBsb2FkaW5nOiBsb2FkaW5nLCBoZWFkaW5nOiBzdHJpbmdzLmltYWdlQ29sbGVjdGlvbkV4cGxvcmVyLCBjbGFzczoge1xuICAgICAgICBwYW5lbDogdHJ1ZSxcbiAgICAgICAgW0NTU19VVElMSVRZLnJ0bF06IHJ0bFxuICAgICAgfSB9LCB0aGlzLnJlbmRlckNsb3NlKCksIHRoaXMucmVuZGVyQWN0aW9uR3JvdXAoKSwgYWN0aXZlVGFiID09PSBOYXZpZ2F0aW9uVGFiLlNlbGVjdCAmJiAoaChcImRpdlwiLCBudWxsLCB0aGlzLnJlbmRlclNlbGVjdElucHV0KCksIGlzU2hvd2luZ0ZpbHRlcmVkSW1hZ2VJdGVtUmVzdWx0c1BhbmUgJiYgdGhpcy5yZW5kZXJTZWxlY3RSZXN1bHRzKCksIGgoXCJhcmNnaXMtY29uZmlnLWltYWdlLWl0ZW0tY2FyZC1yZXN1bHRzLW1vZGFsXCIsIHsgb3BlbjogdGhpcy5pc1Nob3dpbmdDb25maWdSZXN1bHRzTW9kYWwsIGZpZWxkczogbGF5ZXIuZmllbGRzLCBwcmVTZWxlY3RlZEZpZWxkTmFtZXM6IGltYWdlSXRlbUNhcmREaXNwbGF5ZWRGaWVsZE5hbWVzLCBpc1Nob3dpbmdUaHVtYm5haWxzOiBpc1Nob3dpbmdUaHVtYm5haWxzIH0pKSksIGFjdGl2ZVRhYiA9PT0gTmF2aWdhdGlvblRhYi5JbnNwZWN0ICYmXG4gICAgICAoaW5zcGVjdEltYWdlSXRlbU9iamVjdElkICYmIGluc3BlY3RJbWFnZUl0ZW1PYmplY3RJZCA+IDAgPyAoaChcImRpdlwiLCBudWxsLCB0aGlzLnJlbmRlckltYWdlSXRlbVNlbGVjdERyb3Bkb3duKCksIHRoaXMucmVuZGVySW1hZ2VJdGVtUHJldmlld1ZpZXcoKSwgaW1hZ2VJdGVtSW5mbyAmJiB0aGlzLnJlbmRlckltYWdlSXRlbUluZm9UYWJsZXMoKSkpIDogKGgoXCJkaXZcIiwgbnVsbCwgc3RyaW5ncy5ub1NlbGVjdGVkSXRlbVRvSW5zcGVjdENvYWNoTWVzc2FnZSkpKSkpKTtcbiAgfVxuICByZW5kZXJDbG9zZSgpIHtcbiAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyB0ZXh0OiBzdHJpbmdzLmNsb3NlLCBpY29uOiBcInhcIiwgc2xvdDogXCJoZWFkZXItYWN0aW9ucy1lbmRcIiwgb25DbGljazogdGhpcy5oYW5kbGVDbG9zZUNsaWNrLCByZWY6IChub2RlKSA9PiAodGhpcy5yZWZDbG9zZUJ1dHRvbk5vZGUgPSBub2RlKSB9KSk7XG4gIH1cbiAgcmVuZGVyQWN0aW9uR3JvdXAoKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzLCBhY3RpdmVUYWIgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1hY3Rpb24tZ3JvdXBcIiwgeyBsYXlvdXQ6IFwiZ3JpZFwiLCBzY2FsZTogXCJsXCIsIGNvbHVtbnM6IDIgfSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgXCJkYXRhLWxhYmVsXCI6IE5hdmlnYXRpb25UYWIuU2VsZWN0LCBhY3RpdmU6IGFjdGl2ZVRhYiA9PT0gTmF2aWdhdGlvblRhYi5TZWxlY3QsIHRleHQ6IHN0cmluZ3Muc2VsZWN0LCB0ZXh0RW5hYmxlZDogdHJ1ZSwgYWxpZ25tZW50OiBcImNlbnRlclwiLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmhhbmRsZUFjdGl2ZVRhYkNoYW5nZShOYXZpZ2F0aW9uVGFiLlNlbGVjdCkgfSksIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IFwiZGF0YS1sYWJlbFwiOiBOYXZpZ2F0aW9uVGFiLkluc3BlY3QsIGFjdGl2ZTogYWN0aXZlVGFiID09PSBOYXZpZ2F0aW9uVGFiLkluc3BlY3QsIHRleHQ6IHN0cmluZ3MuaW5zcGVjdCwgdGV4dEVuYWJsZWQ6IHRydWUsIGFsaWdubWVudDogXCJjZW50ZXJcIiwgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVBY3RpdmVUYWJDaGFuZ2UoTmF2aWdhdGlvblRhYi5JbnNwZWN0KSB9KSkpO1xuICB9XG4gIHJlbmRlclNlbGVjdElucHV0KCkge1xuICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgY29sbGFwc2libGU6IHRydWUsIGhlYWRpbmc6IHN0cmluZ3MuZmlsdGVycywgb3BlbjogdHJ1ZSB9LCBoKFwiZGl2XCIsIG51bGwsIHRoaXMucmVuZGVyQU9JU2VsZWN0RHJvcGRvd24oKSwgdGhpcy5yZW5kZXJBdHRyaWJ1dGVTZWxlY3REcm9wZG93bigpLCB0aGlzLnJlbmRlckF0dHJpYnV0ZUlucHV0RmllbGQoKSwgdGhpcy5yZW5kZXJJbmNsdWRlT3ZlcnZpZXdTd2l0Y2hCdXR0b24oKSwgdGhpcy5yZW5kZXJBcHBseUJ1dHRvbigpKSkpO1xuICB9XG4gIHJlbmRlckFPSVNlbGVjdERyb3Bkb3duKCkge1xuICAgIGNvbnN0IHsgc3RyaW5ncywgc2VsZWN0ZWRBT0kgfSA9IHRoaXM7XG4gICAgY29uc3QgYW9pT3B0aW9ucyA9IFtcbiAgICAgIHsgbmFtZTogQU9JLlZpc2libGUsIGxhYmVsOiBzdHJpbmdzLnZpc2libGUsIGRlc2NyaXB0aW9uOiBzdHJpbmdzLnZpc2libGVEZXNjIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6IEFPSS5EaXNwbGF5RXh0ZW50LFxuICAgICAgICBsYWJlbDogc3RyaW5ncy5kaXNwbGF5RXh0ZW50LFxuICAgICAgICBkZXNjcmlwdGlvbjogc3RyaW5ncy5kaXNwbGF5RXh0ZW50RGVzY1xuICAgICAgfSxcbiAgICAgIHsgbmFtZTogQU9JLkFsbCwgbGFiZWw6IHN0cmluZ3MuYWxsLCBkZXNjcmlwdGlvbjogc3RyaW5ncy5hbGxEZXNjIH1cbiAgICBdO1xuICAgIGNvbnN0IHNlbGVjdGVkQU9JT3B0ID0gYW9pT3B0aW9ucy5maW5kKChvcHQpID0+IG9wdC5uYW1lID09PSBzZWxlY3RlZEFPSSk7XG4gICAgY29uc3QgYW9pRHJvcGRvd25JdGVtcyA9IGFvaU9wdGlvbnMubWFwKChvcHQpID0+IHtcbiAgICAgIHJldHVybiAoaChcImNhbGNpdGUtZHJvcGRvd24taXRlbVwiLCB7IFwiZGF0YS12YWx1ZVwiOiBvcHQubmFtZSwgc2VsZWN0ZWQ6IG9wdC5uYW1lID09PSBzZWxlY3RlZEFPSU9wdC5uYW1lIH0sIGgoXCJzdHJvbmdcIiwgbnVsbCwgb3B0LmxhYmVsKSwgaChcImRpdlwiLCBudWxsLCBvcHQuZGVzY3JpcHRpb24pKSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLmFyZWFPZkludGVyZXN0LCBoKFwiY2FsY2l0ZS1kcm9wZG93blwiLCB7IHdpZHRoOiBcIm1cIiwgcGxhY2VtZW50OiBcImJvdHRvbVwiLCBvbkNhbGNpdGVEcm9wZG93blNlbGVjdDogKGV2ZW50KSA9PiB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IGRyb3Bkb3duID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRBT0lPcHQgPSAoX2IgPSAoX2EgPSBkcm9wZG93biA9PT0gbnVsbCB8fCBkcm9wZG93biA9PT0gdm9pZCAwID8gdm9pZCAwIDogZHJvcGRvd24uc2VsZWN0ZWRJdGVtcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZ2V0QXR0cmlidXRlKFwiZGF0YS12YWx1ZVwiKTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEFPSSA9IHNlbGVjdGVkQU9JT3B0O1xuICAgICAgfSB9LCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBjbGFzczogXCJhb2ktc2VsZWN0LWJ1dHRvblwiLCBzbG90OiBcInRyaWdnZXJcIiwgYWxpZ25tZW50OiBcInNwYWNlLWJldHdlZW5cIiwgXCJpY29uLWVuZFwiOiBcImNoZXZyb24tZG93blwiLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIGtpbmQ6IFwibmV1dHJhbFwiLCB3aWR0aDogXCJmdWxsXCIgfSwgc2VsZWN0ZWRBT0lPcHQubGFiZWwpLCBoKFwiY2FsY2l0ZS1kcm9wZG93bi1ncm91cFwiLCBudWxsLCBhb2lEcm9wZG93bkl0ZW1zKSkpKTtcbiAgfVxuICByZW5kZXJBdHRyaWJ1dGVTZWxlY3REcm9wZG93bigpIHtcbiAgICBjb25zdCB7IHN0cmluZ3MsIGFjdGl2ZVF1ZXJ5RmllbGQsIGxheWVyIH0gPSB0aGlzO1xuICAgIGNvbnN0IHN1cHBvcnRlZExheWVyRmllbGRzID0gZ2V0U3VwcG9ydGVkTGF5ZXJGaWVsZHMobGF5ZXIgPT09IG51bGwgfHwgbGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxheWVyLmZpZWxkcyk7XG4gICAgY29uc3QgbGF5ZXJBdHRyaWJ1dGVPcHRpb25zID0gc3VwcG9ydGVkTGF5ZXJGaWVsZHMubWFwKChmaWVsZCkgPT4gKGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBmaWVsZC5uYW1lLCBsYWJlbDogZmllbGQuYWxpYXMsIHNlbGVjdGVkOiBmaWVsZC5uYW1lID09PSBhY3RpdmVRdWVyeUZpZWxkLm5hbWUgfSkpKTtcbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MuYXR0cmlidXRlLCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBsYWJlbDogc3RyaW5ncy5hdHRyaWJ1dGUsIG9uQ2FsY2l0ZVNlbGVjdENoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkRmllbGROYW1lID0gZXZlbnQuY3VycmVudFRhcmdldFxuICAgICAgICAgIC5zZWxlY3RlZE9wdGlvbi52YWx1ZTtcbiAgICAgICAgdGhpcy5hY3RpdmVRdWVyeUZpZWxkID0gc3VwcG9ydGVkTGF5ZXJGaWVsZHMuZmluZCgoZikgPT4gZi5uYW1lID09PSBzZWxlY3RlZEZpZWxkTmFtZSk7XG4gICAgICAgIHRoaXMuZ2V0TGF5ZXJBdHRyaWJ1dGVWYWx1ZXMoc2VsZWN0ZWRGaWVsZE5hbWUpO1xuICAgICAgfSB9LCBsYXllckF0dHJpYnV0ZU9wdGlvbnMpKSk7XG4gIH1cbiAgcmVuZGVyQXR0cmlidXRlSW5wdXRGaWVsZCgpIHtcbiAgICBjb25zdCB7IGFjdGl2ZVF1ZXJ5RmllbGQgfSA9IHRoaXM7XG4gICAgY29uc3QgZmllbGRUeXBlID0gYWN0aXZlUXVlcnlGaWVsZC50eXBlO1xuICAgIGlmIChpc051bWVyaWNGaWVsZFR5cGUoZmllbGRUeXBlKSB8fCBmaWVsZFR5cGUgPT09IFwiZGF0ZVwiKSB7XG4gICAgICByZXR1cm4gdGhpcy5yZW5kZXJBdHRyaWJ1dGVTbGlkZXJJbnB1dCgpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5yZW5kZXJBdHRyaWJ1dGVEcm9wZG93bklucHV0KCk7XG4gIH1cbiAgcmVuZGVyU2xpZGVyU2VsZWN0ZWRWYWxzKCkge1xuICAgIGNvbnN0IHsgc2VsZWN0ZWRRdWVyeUZpZWxkVmFsdWVzLCBmaWVsZE1pbk1heFZhbHVlc0ZvcklucHV0LCBhY3RpdmVRdWVyeUZpZWxkIH0gPSB0aGlzO1xuICAgIGNvbnN0IHJhbmdlVmFscyA9IHNlbGVjdGVkUXVlcnlGaWVsZFZhbHVlcy5sZW5ndGggPiAwID8gc2VsZWN0ZWRRdWVyeUZpZWxkVmFsdWVzIDogZmllbGRNaW5NYXhWYWx1ZXNGb3JJbnB1dDtcbiAgICBsZXQgc3RhcnRWYWw7XG4gICAgbGV0IGVuZFZhbDtcbiAgICBpZiAocmFuZ2VWYWxzLmxlbmd0aCA9PT0gMikge1xuICAgICAgW3N0YXJ0VmFsLCBlbmRWYWxdID0gcmFuZ2VWYWxzO1xuICAgICAgaWYgKGFjdGl2ZVF1ZXJ5RmllbGQudHlwZSA9PT0gXCJkYXRlXCIpIHtcbiAgICAgICAgc3RhcnRWYWwgPSBnZXRGb3JtYXR0ZWREYXRlU3RyaW5nKHN0YXJ0VmFsKTtcbiAgICAgICAgZW5kVmFsID0gZ2V0Rm9ybWF0dGVkRGF0ZVN0cmluZyhlbmRWYWwpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGgoXCJkaXZcIiwgbnVsbCwgYCR7c3RhcnRWYWx9IC0gJHtlbmRWYWx9YCk7XG4gICAgfVxuICAgIGlmIChyYW5nZVZhbHMubGVuZ3RoID09PSAxKSB7XG4gICAgICBbc3RhcnRWYWxdID0gcmFuZ2VWYWxzO1xuICAgICAgaWYgKGFjdGl2ZVF1ZXJ5RmllbGQudHlwZSA9PT0gXCJkYXRlXCIpIHtcbiAgICAgICAgc3RhcnRWYWwgPSBnZXRGb3JtYXR0ZWREYXRlU3RyaW5nKHN0YXJ0VmFsKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBoKFwiZGl2XCIsIG51bGwsIGAke3N0YXJ0VmFsfWApO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICByZW5kZXJBdHRyaWJ1dGVTbGlkZXJJbnB1dCgpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyBzdHJpbmdzLCBmaWVsZE1pbk1heFZhbHVlc0ZvcklucHV0LCBpc1JhbmdlVmFsdWVNb2RlU2VsZWN0ZWQgfSA9IHRoaXM7XG4gICAgY29uc3QgdmFsaWRNaW5NYXhWYWxzID0gZmllbGRNaW5NYXhWYWx1ZXNGb3JJbnB1dC5maWx0ZXIoKHZhbCkgPT4gdHlwZW9mIHZhbCA9PT0gXCJudW1iZXJcIik7XG4gICAgY29uc3QgaXNTaG93aW5nU2xpZGVyID0gdmFsaWRNaW5NYXhWYWxzLmxlbmd0aCA9PT0gMiAmJiB2YWxpZE1pbk1heFZhbHNbMF0gIT09IHZhbGlkTWluTWF4VmFsc1sxXTtcbiAgICBjb25zdCBpc1Nob3dpbmdEcm9wZG93biA9IHZhbGlkTWluTWF4VmFscy5sZW5ndGggPT09IDIgJiYgdmFsaWRNaW5NYXhWYWxzWzBdID09PSB2YWxpZE1pbk1heFZhbHNbMV07XG4gICAgaWYgKGlzU2hvd2luZ0Ryb3Bkb3duKSB7XG4gICAgICBjb25zdCBbdmFsdWVdID0gdmFsaWRNaW5NYXhWYWxzO1xuICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBsYWJlbDogc3RyaW5ncy5zZWxlY3QsIG9uQ2FsY2l0ZVNlbGVjdENoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgY29uc3Qgc2VsZWN0ZWRPcHRWYWx1ZSA9IGV2ZW50LmN1cnJlbnRUYXJnZXRcbiAgICAgICAgICAgIC5zZWxlY3RlZE9wdGlvbi52YWx1ZTtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkUXVlcnlGaWVsZFZhbHVlcyA9IFtzZWxlY3RlZE9wdFZhbHVlXTtcbiAgICAgICAgfSB9LCBoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyB2YWx1ZTogdmFsdWUudG9TdHJpbmcoKSwgbGFiZWw6IHZhbHVlLnRvU3RyaW5nKCksIHNlbGVjdGVkOiAoKF9hID0gdGhpcy5zZWxlY3RlZFF1ZXJ5RmllbGRWYWx1ZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpID4gMCAmJlxuICAgICAgICAgIHZhbHVlLnRvU3RyaW5nKCkgPT09IHRoaXMuc2VsZWN0ZWRRdWVyeUZpZWxkVmFsdWVzWzBdLnRvU3RyaW5nKCkgfSkpKTtcbiAgICB9XG4gICAgaWYgKGlzU2hvd2luZ1NsaWRlcikge1xuICAgICAgY29uc3QgbWluVmFsID0gdmFsaWRNaW5NYXhWYWxzWzBdO1xuICAgICAgY29uc3QgbWF4VmFsID0gdmFsaWRNaW5NYXhWYWxzWzFdO1xuICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIG51bGwsIHRoaXMucmVuZGVyUmFuZ2VNb2RlU3dpdGNoQnV0dG9uKCksIHRoaXMucmVuZGVyU2xpZGVyU2VsZWN0ZWRWYWxzKCksIGlzUmFuZ2VWYWx1ZU1vZGVTZWxlY3RlZCA/IChoKFwiY2FsY2l0ZS1zbGlkZXJcIiwgeyBtaW5WYWx1ZTogbWluVmFsLCBtYXhWYWx1ZTogbWF4VmFsLCBtaW46IG1pblZhbCwgbWF4OiBtYXhWYWwsIHNuYXA6IHRydWUsIHByZWNpc2U6IHRydWUsIG9uQ2FsY2l0ZVNsaWRlckNoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgY29uc3Qgc2xpZGVyID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHNsaWRlci52YWx1ZSkpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRRdWVyeUZpZWxkVmFsdWVzID0gW3NsaWRlci52YWx1ZVswXSwgc2xpZGVyLnZhbHVlWzFdXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkUXVlcnlGaWVsZFZhbHVlcyA9IFtzbGlkZXIudmFsdWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSB9KSkgOiAoaChcImNhbGNpdGUtc2xpZGVyXCIsIHsgdmFsdWU6IHZhbGlkTWluTWF4VmFsc1sxXSwgbWluOiB2YWxpZE1pbk1heFZhbHNbMF0sIG1heDogdmFsaWRNaW5NYXhWYWxzWzFdLCBzbmFwOiB0cnVlLCBwcmVjaXNlOiB0cnVlLCBvbkNhbGNpdGVTbGlkZXJDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHNsaWRlciA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShzbGlkZXIudmFsdWUpKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkUXVlcnlGaWVsZFZhbHVlcyA9IFtzbGlkZXIudmFsdWVbMF0sIHNsaWRlci52YWx1ZVsxXV07XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFF1ZXJ5RmllbGRWYWx1ZXMgPSBbc2xpZGVyLnZhbHVlXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gfSkpKSk7XG4gICAgfVxuICB9XG4gIHJlbmRlckF0dHJpYnV0ZURyb3Bkb3duSW5wdXQoKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzLCBmaWVsZFZhbHVlc0ZvcklucHV0LCBpc1F1ZXJ5aW5nRmllbGRWYWx1ZXMgfSA9IHRoaXM7XG4gICAgY29uc3QgZmllbGRWYWx1ZU9wdGlvbnMgPSBmaWVsZFZhbHVlc0ZvcklucHV0Lm1hcCgodmFsKSA9PiB7XG4gICAgICB2YXIgX2E7XG4gICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiB2YWwudG9TdHJpbmcoKSwgbGFiZWw6IHZhbC50b1N0cmluZygpLCBzZWxlY3RlZDogKChfYSA9IHRoaXMuc2VsZWN0ZWRRdWVyeUZpZWxkVmFsdWVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSA+IDAgJiZcbiAgICAgICAgICB2YWwudG9TdHJpbmcoKSA9PT0gdGhpcy5zZWxlY3RlZFF1ZXJ5RmllbGRWYWx1ZXNbMF0udG9TdHJpbmcoKSB9KSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBsYWJlbDogc3RyaW5ncy5zZWxlY3QsIGRpc2FibGVkOiBpc1F1ZXJ5aW5nRmllbGRWYWx1ZXMsIHdpZHRoOiBcImZ1bGxcIiwgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgbGV0IHNlbGVjdGVkVmFsID0gZXZlbnQuY3VycmVudFRhcmdldC5zZWxlY3RlZE9wdGlvbi52YWx1ZTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZFF1ZXJ5RmllbGRWYWx1ZXMgPSBbc2VsZWN0ZWRWYWxdO1xuICAgICAgfSB9LCBmaWVsZFZhbHVlT3B0aW9ucykpO1xuICB9XG4gIHJlbmRlclJhbmdlTW9kZVN3aXRjaEJ1dHRvbigpIHtcbiAgICBjb25zdCB7IHN0cmluZ3MsIGlzUmFuZ2VWYWx1ZU1vZGVTZWxlY3RlZCwgZmllbGRNaW5NYXhWYWx1ZXNGb3JJbnB1dCB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJzd2l0Y2gtYnV0dG9uLXdyYXBwZXJcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGxheW91dDogXCJpbmxpbmVcIiwgc2NhbGU6IFwibVwiLCBzdHlsZTogeyB3aWR0aDogXCIxMDAlXCIgfSB9LCBzdHJpbmdzLnJhbmdlTW9kZSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgaWNvbjogXCJpbmZvcm1hdGlvblwiLCBzY2FsZTogXCJzXCIsIHRleHQ6IHN0cmluZ3MucmFuZ2VNb2RlLCByZWY6IChub2RlKSA9PiAodGhpcy5yYW5nZU1vZGVIZWxwSWNvbkFjdGlvbkVsID0gbm9kZSksIG9uTW91c2VPdmVyOiAoKSA9PiB0aGlzLnNob3dUb29sdGlwKHtcbiAgICAgICAgcmVmZXJlbmNlRWxlbWVudDogdGhpcy5yYW5nZU1vZGVIZWxwSWNvbkFjdGlvbkVsLFxuICAgICAgICBpbm5lckhUTUw6IHN0cmluZ3MucmFuZ2VNb2RlbEhlbHBNZXNzYWdlXG4gICAgICB9KSwgb25Nb3VzZU91dDogKCkgPT4gdGhpcy5kaXNtaXNzVG9vbHRpcCgpLCBvbkNsaWNrOiAoZXZlbnQpID0+IHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB9LCBpZDogXCJyYW5nZU1vZGVcIiB9KSwgaChcImRpdlwiLCB7IHN0eWxlOiB7IG1hcmdpbklubGluZVN0YXJ0OiBcImF1dG9cIiB9IH0sIGgoXCJjYWxjaXRlLXN3aXRjaFwiLCB7IGNoZWNrZWQ6IGlzUmFuZ2VWYWx1ZU1vZGVTZWxlY3RlZCwgc2NhbGU6IFwibVwiLCBvbkNhbGNpdGVTd2l0Y2hDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICBjb25zdCBjaGVja2VkID0gZXZlbnQudGFyZ2V0LmNoZWNrZWQ7XG4gICAgICAgIHRoaXMuaXNSYW5nZVZhbHVlTW9kZVNlbGVjdGVkID0gY2hlY2tlZDtcbiAgICAgICAgY29uc3QgdmFsaWRNaW5NYXhWYWxzID0gZmllbGRNaW5NYXhWYWx1ZXNGb3JJbnB1dC5maWx0ZXIoKHZhbCkgPT4gdHlwZW9mIHZhbCA9PT0gXCJudW1iZXJcIik7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRRdWVyeUZpZWxkVmFsdWVzID0gY2hlY2tlZFxuICAgICAgICAgID8gW3ZhbGlkTWluTWF4VmFsc1swXSwgdmFsaWRNaW5NYXhWYWxzWzFdXVxuICAgICAgICAgIDogW3ZhbGlkTWluTWF4VmFsc1swXV07XG4gICAgICB9IH0pKSkpKTtcbiAgfVxuICByZW5kZXJJbmNsdWRlT3ZlcnZpZXdTd2l0Y2hCdXR0b24oKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzLCBpc092ZXJ2aWV3c0luY2x1ZGVkIH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImluY2x1ZGUtb3ZlcnZpZXdzLXN3aXRjaC1idXR0b24td3JhcHBlclwiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgbGF5b3V0OiBcImlubGluZVwiLCBzY2FsZTogXCJtXCIsIHN0eWxlOiB7IHdpZHRoOiBcIjEwMCVcIiB9IH0sIHN0cmluZ3MuaW5jbHVkZU92ZXJ2aWV3cywgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgaWNvbjogXCJpbmZvcm1hdGlvblwiLCBzY2FsZTogXCJzXCIsIHRleHQ6IHN0cmluZ3MuaW5jbHVkZU92ZXJ2aWV3c0hlbHBNZXNzYWdlLCByZWY6IChub2RlKSA9PiAodGhpcy5pc0luY2x1ZGVPdmVydmlld3NIZWxwSWNvbkFjdGlvbkVsID0gbm9kZSksIG9uTW91c2VPdmVyOiAoKSA9PiB0aGlzLnNob3dUb29sdGlwKHtcbiAgICAgICAgcmVmZXJlbmNlRWxlbWVudDogdGhpcy5pc0luY2x1ZGVPdmVydmlld3NIZWxwSWNvbkFjdGlvbkVsLFxuICAgICAgICBpbm5lckhUTUw6IHN0cmluZ3MuaW5jbHVkZU92ZXJ2aWV3c0hlbHBNZXNzYWdlXG4gICAgICB9KSwgb25Nb3VzZU91dDogKCkgPT4gdGhpcy5kaXNtaXNzVG9vbHRpcCgpLCBvbkNsaWNrOiAoZXZlbnQpID0+IHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB9LCBpZDogXCJpbmNsdWRlT3ZlcnZpZXdzXCIgfSksIGgoXCJkaXZcIiwgeyBzdHlsZTogeyBtYXJnaW5JbmxpbmVTdGFydDogXCJhdXRvXCIgfSB9LCBoKFwiY2FsY2l0ZS1zd2l0Y2hcIiwgeyBjaGVja2VkOiBpc092ZXJ2aWV3c0luY2x1ZGVkLCBzY2FsZTogXCJtXCIsIG9uQ2FsY2l0ZVN3aXRjaENoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IGNoZWNrZWQgPSBldmVudC50YXJnZXQuY2hlY2tlZDtcbiAgICAgICAgdGhpcy5pc092ZXJ2aWV3c0luY2x1ZGVkID0gY2hlY2tlZDtcbiAgICAgIH0gfSkpKSkpO1xuICB9XG4gIHJlbmRlckFwcGx5QnV0dG9uKCkge1xuICAgIGNvbnN0IHsgc3RyaW5ncywgaXNRdWVyeWluZ0ZpZWxkVmFsdWVzLCBpc1F1ZXJ5aW5nSW1hZ2VJdGVtcyB9ID0gdGhpcztcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJhcHBseS1idXR0b24td3JhcHBlclwiIH0sIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGxhYmVsOiBzdHJpbmdzLmFwcGx5LCBvbkNsaWNrOiB0aGlzLmhhbmRsZUltYWdlSXRlbVF1ZXJ5QXBwbGllZCwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCB3aWR0aDogXCJoYWxmXCIsIGRpc2FibGVkOiBpc1F1ZXJ5aW5nRmllbGRWYWx1ZXMgfHwgaXNRdWVyeWluZ0ltYWdlSXRlbXMgfSwgc3RyaW5ncy5hcHBseSkpKTtcbiAgfVxuICByZW5kZXJTZWxlY3RSZXN1bHRzKCkge1xuICAgIGNvbnN0IHsgc3RyaW5ncywgaXNRdWVyeWluZ0ltYWdlSXRlbXMsIHRvdGFsSW1hZ2VJdGVtQ291bnQsIGltYWdlSXRlbXMgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1ibG9ja1wiLCB7IGNvbGxhcHNpYmxlOiB0cnVlLCBvcGVuOiB0cnVlLCBoZWFkaW5nOiBzdHJpbmdzLnJlc3VsdHMgfSwgaXNRdWVyeWluZ0ltYWdlSXRlbXMgPyAoaChcImNhbGNpdGUtbG9hZGVyXCIsIHsgbGFiZWw6IHN0cmluZ3MubG9hZGluZywgc2NhbGU6IFwibVwiIH0pKSA6IChoKFwiZGl2XCIsIG51bGwsICEodG90YWxJbWFnZUl0ZW1Db3VudCA+IDApICYmIGgoXCJkaXZcIiwgbnVsbCwgc3RyaW5ncy5lbXB0eUxpc3QpLCB0b3RhbEltYWdlSXRlbUNvdW50ID4gMCA/IHRoaXMucmVuZGVySW1hZ2VJdGVtTGlzdEJ1dHRvbkdyb3VwKCkgOiBudWxsLCBpbWFnZUl0ZW1zID8gdGhpcy5yZW5kZXJJbWFnZUl0ZW1DYXJkTGlzdCgpIDogbnVsbCkpKSk7XG4gIH1cbiAgcmVuZGVyU2VsZWN0ZWRJbWFnZUl0ZW1Db3VudCgpIHtcbiAgICBjb25zdCB7IHN0cmluZ3MsIHRvdGFsSW1hZ2VJdGVtQ291bnQsIHNlbGVjdGVkSW1hZ2VJdGVtT2JqZWN0SWRzIH0gPSB0aGlzO1xuICAgIGNvbnN0IHNlbGVjdGVkSW1hZ2VJdGVtQ291bnQgPSBzZWxlY3RlZEltYWdlSXRlbU9iamVjdElkcy5sZW5ndGg7XG4gICAgY29uc3Qgc2VsZWN0ZWRBbmRUb3RhbEltYWdlQ291bnRTdHIgPSBzdHJpbmdzLnNlbGVjdGVkQW5kVG90YWxJbWFnZUl0ZW1Db3VudEluZm9cbiAgICAgIC5yZXBsYWNlKFwiJHt0b3RhbENvdW50fVwiLCB0b3RhbEltYWdlSXRlbUNvdW50LnRvU3RyaW5nKCkpXG4gICAgICAucmVwbGFjZShcIiR7c2VsZWN0ZWRDb3VudH1cIiwgc2VsZWN0ZWRJbWFnZUl0ZW1Db3VudC50b1N0cmluZygpKTtcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogYGltYWdlLWl0ZW0tY291bnQtY2hpcCAke3NlbGVjdGVkSW1hZ2VJdGVtQ291bnQgPiAwID8gXCJzZWxlY3RlZFwiIDogXCJcIn1gIH0sIHNlbGVjdGVkQW5kVG90YWxJbWFnZUNvdW50U3RyLCBzZWxlY3RlZEltYWdlSXRlbUNvdW50ID4gMCAmJiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCBraW5kOiBcImJyYW5kXCIsIFwiaWNvbi1zdGFydFwiOiBcInhcIiwgc2NhbGU6IFwic1wiLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmNsZWFySW1hZ2VJdGVtU2VsZWN0aW9uKCkgfSkpKSk7XG4gIH1cbiAgcmVuZGVySW1hZ2VJdGVtTGlzdEJ1dHRvbkdyb3VwKCkge1xuICAgIGNvbnN0IHsgc3RyaW5ncywgc2VsZWN0ZWRJbWFnZUl0ZW1PYmplY3RJZHMgfSA9IHRoaXM7XG4gICAgY29uc3QgaGFzSW1hZ2VTZWxlY3RlZCA9IHNlbGVjdGVkSW1hZ2VJdGVtT2JqZWN0SWRzLmxlbmd0aCA+IDA7XG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaW1hZ2UtY29sbGVjdGlvbi1pdGVtLWNhcmQtbGlzdC1oZWFkZXJcIiB9LCB0aGlzLnJlbmRlclNlbGVjdGVkSW1hZ2VJdGVtQ291bnQoKSwgaChcImRpdlwiLCB7IHN0eWxlOiB7IGRpc3BsYXk6IFwiZmxleFwiIH0gfSwgaGFzSW1hZ2VTZWxlY3RlZCAmJiAoaChcImRpdlwiLCBudWxsLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBcImFyaWEtbGFiZWxcIjogc3RyaW5ncy5sb2NrSXRlbXMsIGFwcGVhcmFuY2U6IFwidHJhbnNwYXJlbnRcIiwgXCJpY29uLXN0YXJ0XCI6IFwibG9ja1wiLCBraW5kOiBcIm5ldXRyYWxcIiwgc2NhbGU6IFwic1wiIH0pLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBcImFyaWEtbGFiZWxcIjogc3RyaW5ncy51bmxvY2tJdGVtcywgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBcImljb24tc3RhcnRcIjogXCJ1bmxvY2tcIiwga2luZDogXCJuZXV0cmFsXCIsIHNjYWxlOiBcInNcIiB9KSkpLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBcImFyaWEtbGFiZWxcIjogc3RyaW5ncy5jb25maWd1cmVSZXN1bHRzLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIFwiaWNvbi1zdGFydFwiOiBcInNsaWRlcnMtaG9yaXpvbnRhbFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgc2NhbGU6IFwic1wiLCBvbkNsaWNrOiB0aGlzLmhhbmRsZU9wZW5Db25maWdSZXN1bHRzTW9kYWwgfSkpKSk7XG4gIH1cbiAgcmVuZGVySW1hZ2VJdGVtQ2FyZExpc3QoKSB7XG4gICAgY29uc3QgeyBpbWFnZUl0ZW1zLCBzZWxlY3RlZEltYWdlSXRlbU9iamVjdElkcywgbGF5ZXIsIGlzU2hvd2luZ1RodW1ibmFpbHMgfSA9IHRoaXM7XG4gICAgaWYgKCEoaW1hZ2VJdGVtcyA9PT0gbnVsbCB8fCBpbWFnZUl0ZW1zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpbWFnZUl0ZW1zLmZlYXR1cmVzKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IG9iamVjdElkRmllbGROYW1lID0gbGF5ZXIub2JqZWN0SWRGaWVsZDtcbiAgICBjb25zdCBpbWFnZUl0ZW1DYXJkcyA9IGltYWdlSXRlbXMuZmVhdHVyZXMubWFwKChmZWF0dXJlKSA9PiB7XG4gICAgICBjb25zdCBpdGVtT2JqZWN0SWQgPSBmZWF0dXJlLmF0dHJpYnV0ZXNbb2JqZWN0SWRGaWVsZE5hbWVdO1xuICAgICAgY29uc3QgaXNJdGVtU2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGVkSW1hZ2VJdGVtT2JqZWN0SWRzLmluY2x1ZGVzKGl0ZW1PYmplY3RJZCk7XG4gICAgICBjb25zdCBpbWFnZUl0ZW1HZW9tZXRyeSA9IGZlYXR1cmUuZ2VvbWV0cnk7XG4gICAgICByZXR1cm4gKGgoXCJsaVwiLCB7IG9uTW91c2VPdmVyOiAoKSA9PiB0aGlzLmhhbmRsZUltYWdlSXRlbUNhcmRNb3VzZU92ZXIoaW1hZ2VJdGVtR2VvbWV0cnkpLCBvbk1vdXNlT3V0OiAoKSA9PiB0aGlzLmhhbmRsZUltYWdlSXRlbUNhcmRNb3VzZU91dCgpIH0sIGgoXCJjYWxjaXRlLWNhcmRcIiwgeyBjbGFzczogXCJpbWFnZS1pdGVtLWNhcmRcIiwgc2VsZWN0YWJsZTogdHJ1ZSwgc2VsZWN0ZWQ6IGlzSXRlbVNlbGVjdGVkLCBvbkNhbGNpdGVDYXJkU2VsZWN0OiAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgbmV3U2VsZWN0ZWRJdGVtT0lkcyA9IGlzSXRlbVNlbGVjdGVkXG4gICAgICAgICAgICA/IHNlbGVjdGVkSW1hZ2VJdGVtT2JqZWN0SWRzLmZpbHRlcigob2lkKSA9PiBvaWQgIT09IGl0ZW1PYmplY3RJZClcbiAgICAgICAgICAgIDogWy4uLnNlbGVjdGVkSW1hZ2VJdGVtT2JqZWN0SWRzLCBpdGVtT2JqZWN0SWRdO1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbWFnZUl0ZW1PYmplY3RJZHMgPSBuZXdTZWxlY3RlZEl0ZW1PSWRzLnNvcnQoKTtcbiAgICAgICAgfSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaW1hZ2UtaXRlbS1jYXJkLWNvbnRlbnQtd3JhcHBlclwiIH0sIGlzU2hvd2luZ1RodW1ibmFpbHMgPyB0aGlzLnJlbmRlclByZXZpZXdUaHVtYm5haWwoaXRlbU9iamVjdElkKSA6IG51bGwsIHRoaXMucmVuZGVyRmVhdHVyZUF0dHJpYnV0ZXNJbkltYWdlSXRlbUNhcmQoZmVhdHVyZSkpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJmb290ZXItc3RhcnRcIiB9KSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiZm9vdGVyLWVuZFwiIH0sIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGtpbmQ6IFwibmV1dHJhbFwiLCBcImljb24tc3RhcnRcIjogXCJhZGQtbGF5ZXJcIiwgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiIH0pLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBraW5kOiBcIm5ldXRyYWxcIiwgXCJpY29uLXN0YXJ0XCI6IFwibG9ja1wiLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIgfSkpKSkpO1xuICAgIH0pO1xuICAgIHJldHVybiBoKFwidWxcIiwgeyBjbGFzczogXCJpbWFnZS1pdGVtLWNhcmQtbGlzdFwiIH0sIGltYWdlSXRlbUNhcmRzKTtcbiAgfVxuICByZW5kZXJJbWFnZUl0ZW1TZWxlY3REcm9wZG93bigpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyBzdHJpbmdzLCBsYXllciwgaW1hZ2VJdGVtcywgaW5zcGVjdEltYWdlSXRlbU9iamVjdElkLCBzZWxlY3RlZEltYWdlSXRlbU9iamVjdElkcyB9ID0gdGhpcztcbiAgICBjb25zdCBvYmplY3RJZEZpZWxkTmFtZSA9IGxheWVyLm9iamVjdElkRmllbGQ7XG4gICAgY29uc3QgaW1hZ2VJdGVtRmVhdHVyZXMgPSBzZWxlY3RlZEltYWdlSXRlbU9iamVjdElkcy5sZW5ndGggPiAwXG4gICAgICA/IGltYWdlSXRlbXMgPT09IG51bGwgfHwgaW1hZ2VJdGVtcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogaW1hZ2VJdGVtcy5mZWF0dXJlcy5maWx0ZXIoKGYpID0+IHNlbGVjdGVkSW1hZ2VJdGVtT2JqZWN0SWRzLmluY2x1ZGVzKGYuYXR0cmlidXRlc1tvYmplY3RJZEZpZWxkTmFtZV0pKS5tYXAoKGYpID0+IGYuYXR0cmlidXRlcylcbiAgICAgIDogKF9hID0gaW1hZ2VJdGVtcyA9PT0gbnVsbCB8fCBpbWFnZUl0ZW1zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpbWFnZUl0ZW1zLmZlYXR1cmVzLm1hcCgoZikgPT4gZi5hdHRyaWJ1dGVzKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogW107XG4gICAgY29uc3QgaW1hZ2VJdGVtT3B0aW9ucyA9IGltYWdlSXRlbUZlYXR1cmVzLm1hcCgoZikgPT4gKGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBmW29iamVjdElkRmllbGROYW1lXS50b1N0cmluZygpLCBsYWJlbDogYCR7ZltvYmplY3RJZEZpZWxkTmFtZV19OiAke2YuTmFtZX1gLCBzZWxlY3RlZDogZltvYmplY3RJZEZpZWxkTmFtZV0gPT09IGluc3BlY3RJbWFnZUl0ZW1PYmplY3RJZCB9KSkpO1xuICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImltYWdlLWl0ZW0tc2VsZWN0LWJsb2NrXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5zZWxlY3RlZEltYWdlcywgaChcImRpdlwiLCB7IGNsYXNzOiBcImltYWdlLWl0ZW0tc2VsZWN0LXdyYXBwZXJcIiB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBpY29uOiBcImNoZXZyb24tbGVmdFwiLCBvbkNsaWNrOiB0aGlzLmhhbmRsZVNlbGVjdFByZXZJbWFnZUl0ZW0gfSksIGgoXCJjYWxjaXRlLXNlbGVjdFwiLCB7IHdpZHRoOiBcImZ1bGxcIiwgbGFiZWw6IHN0cmluZ3Muc2VsZWN0ZWRJbWFnZXMsIG9uQ2FsY2l0ZVNlbGVjdENoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkSW1hZ2VJdGVtT2JqZWN0SWQgPSBldmVudC5jdXJyZW50VGFyZ2V0XG4gICAgICAgICAgLnNlbGVjdGVkT3B0aW9uLnZhbHVlO1xuICAgICAgICB0aGlzLmhhbmRsZVNlbGVjdGVkSW1hZ2VJdGVtQ2hhbmdlKE51bWJlcihzZWxlY3RlZEltYWdlSXRlbU9iamVjdElkKSk7XG4gICAgICB9IH0sIGltYWdlSXRlbU9wdGlvbnMpLCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBpY29uOiBcImNoZXZyb24tcmlnaHRcIiwgb25DbGljazogdGhpcy5oYW5kbGVTZWxlY3ROZXh0SW1hZ2VJdGVtIH0pKSkpKTtcbiAgfVxuICByZW5kZXJJbWFnZUl0ZW1QcmV2aWV3VmlldygpIHtcbiAgICBjb25zdCB7IHN0cmluZ3MsIGxheWVyLCBqc2FwaVVybCwgaW5zcGVjdEltYWdlSXRlbU9iamVjdElkIH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtYmxvY2tcIiwgeyBjb2xsYXBzaWJsZTogdHJ1ZSwgb3BlbjogdHJ1ZSwgaGVhZGluZzogc3RyaW5ncy5wcmV2aWV3IH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJpbWFnZS1pdGVtLXByZXZpZXctd3JhcHBlclwiIH0sIGgoXCJhcmNnaXMtaW1hZ2UtaXRlbS1wcmV2aWV3XCIsIHsganNhcGlVcmw6IGpzYXBpVXJsLCBwcmV2aWV3TGF5ZXJVcmw6IGxheWVyLnVybCwgcHJldmlld0ltYWdlSXRlbU9iamVjdElkOiBpbnNwZWN0SW1hZ2VJdGVtT2JqZWN0SWQgfSkpKSk7XG4gIH1cbiAgcmVuZGVySW1hZ2VJdGVtSW5mb1RhYmxlcygpIHtcbiAgICBjb25zdCB7IGltYWdlSXRlbUluZm8gfSA9IHRoaXM7XG4gICAgY29uc3QgeyBleHRlbnQsIHN0YXRpc3RpY3MgfSA9IGltYWdlSXRlbUluZm8gfHwge307XG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIG51bGwsIGltYWdlSXRlbUluZm8gPyB0aGlzLnJlbmRlckltYWdlSXRlbUluc3BlY3RCdXR0b25Hcm91cCgpIDogbnVsbCwgaW1hZ2VJdGVtSW5mbyA/IHRoaXMucmVuZGVySW1hZ2VJdGVtUmFzdGVySW5mb3JtYXRpb25UYWJsZSgpIDogbnVsbCwgaW1hZ2VJdGVtSW5mbyA/IHRoaXMucmVuZGVySW1hZ2VJdGVtUmFzdGVyTWV0YWRhdGFUYWJsZSgpIDogbnVsbCwgZXh0ZW50ID8gdGhpcy5yZW5kZXJJbWFnZUl0ZW1FeHRlbnRJbmZvVGFibGUoKSA6IG51bGwsIGltYWdlSXRlbUluZm8gPyB0aGlzLnJlbmRlckltYWdlSXRlbVNwYXRpYWxSZWZlcmVuY2VUYWJsZSgpIDogbnVsbCwgc3RhdGlzdGljcyA/IHRoaXMucmVuZGVySW1hZ2VJdGVtU3RhdGlzdGljc0luZm9UYWJsZSgpIDogbnVsbCkpO1xuICB9XG4gIHJlbmRlckltYWdlSXRlbVJhc3RlckluZm9ybWF0aW9uVGFibGUoKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzLCBpbWFnZUl0ZW1JbmZvIH0gPSB0aGlzO1xuICAgIGNvbnN0IHRhYmxlQ29sdW1ucyA9IFtcbiAgICAgIHsgYWNjZXNzb3I6IFwicHJvcGVydHlcIiwgaGVhZGVyOiBzdHJpbmdzLnByb3BlcnR5IH0sXG4gICAgICB7IGFjY2Vzc29yOiBcInZhbHVlXCIsIGhlYWRlcjogc3RyaW5ncy52YWx1ZSB9XG4gICAgXTtcbiAgICBjb25zdCB7IGJhbmRDb3VudCwgaGVpZ2h0LCB3aWR0aCwgcGl4ZWxUeXBlLCBwaXhlbFNpemUsIGRhdGFUeXBlLCBjb2xvcm1hcCB9ID0gaW1hZ2VJdGVtSW5mbztcbiAgICBjb25zdCByYXN0ZXJJbmZvRGF0YSA9IFtcbiAgICAgIHsgcHJvcGVydHk6IHN0cmluZ3MuY29sdW1ucywgdmFsdWU6IHdpZHRoIH0sXG4gICAgICB7IHByb3BlcnR5OiBzdHJpbmdzLnJvd3MsIHZhbHVlOiBoZWlnaHQgfSxcbiAgICAgIHsgcHJvcGVydHk6IHN0cmluZ3MuYmFuZE51bWJlciwgdmFsdWU6IGJhbmRDb3VudCB9LFxuICAgICAgeyBwcm9wZXJ0eTogc3RyaW5ncy5jZWxsU2l6ZVgsIHZhbHVlOiBwaXhlbFNpemUgPT09IG51bGwgfHwgcGl4ZWxTaXplID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwaXhlbFNpemUueCB9LFxuICAgICAgeyBwcm9wZXJ0eTogc3RyaW5ncy5jZWxsU2l6ZVksIHZhbHVlOiBwaXhlbFNpemUgPT09IG51bGwgfHwgcGl4ZWxTaXplID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwaXhlbFNpemUueSB9LFxuICAgICAgeyBwcm9wZXJ0eTogc3RyaW5ncy5zb3VyY2VUeXBlLCB2YWx1ZTogZGF0YVR5cGUgfSxcbiAgICAgIHsgcHJvcGVydHk6IHN0cmluZ3MucGl4ZWxUeXBlLCB2YWx1ZTogcGl4ZWxUeXBlIH0sXG4gICAgICB7IHByb3BlcnR5OiBzdHJpbmdzLnBpeGVsRGVwdGgsIHZhbHVlOiBiYW5kQ291bnQgfSxcbiAgICAgIHsgcHJvcGVydHk6IHN0cmluZ3MuY29sb3JtYXAsIHZhbHVlOiBjb2xvcm1hcCB9XG4gICAgXS5maWx0ZXIoKGluZm8pID0+ICEhaW5mby52YWx1ZSk7XG4gICAgY29uc3QgaGFzUmFzdGVySW5mb0RhdGEgPSByYXN0ZXJJbmZvRGF0YS5sZW5ndGggPiAwO1xuICAgIHJldHVybiAoaGFzUmFzdGVySW5mb0RhdGEgJiYgKGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgY29sbGFwc2libGU6IHRydWUsIG9wZW46IHRydWUsIGhlYWRpbmc6IHN0cmluZ3MucmFzdGVySW5mb3JtYXRpb24gfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImltYWdlLWl0ZW0taW5mby10YWJsZS13cmFwcGVyXCIgfSwgaChcImFyY2dpcy1pbWFnZS1pdGVtLWluZm8tdGFibGVcIiwgeyBjb2x1bW5zOiB0YWJsZUNvbHVtbnMsIGRhdGE6IHJhc3RlckluZm9EYXRhIH0pKSkpKTtcbiAgfVxuICByZW5kZXJJbWFnZUl0ZW1SYXN0ZXJNZXRhZGF0YVRhYmxlKCkge1xuICAgIGNvbnN0IHsgc3RyaW5ncywgaW1hZ2VJdGVtSW5mbyB9ID0gdGhpcztcbiAgICBjb25zdCB0YWJsZUNvbHVtbnMgPSBbXG4gICAgICB7IGFjY2Vzc29yOiBcInByb3BlcnR5XCIsIGhlYWRlcjogc3RyaW5ncy5wcm9wZXJ0eSB9LFxuICAgICAgeyBhY2Nlc3NvcjogXCJ2YWx1ZVwiLCBoZWFkZXI6IHN0cmluZ3MudmFsdWUgfVxuICAgIF07XG4gICAgY29uc3QgeyBTZW5zb3JOYW1lLCBQcm9kdWN0TmFtZSwgQ2xvdWRDb3ZlciwgQWNxdWlzaXRpb25EYXRlLCBTdW5BemltdXRoLCBTdW5FbGV2YXRpb24sIEVMTElQU09JRCB9ID0gaW1hZ2VJdGVtSW5mby5rZXlQcm9wZXJ0aWVzIHx8IHt9O1xuICAgIGNvbnN0IGZvcm1hdHRlZERhdGUgPSBBY3F1aXNpdGlvbkRhdGVcbiAgICAgID8gYCR7bmV3IERhdGUoQWNxdWlzaXRpb25EYXRlKS50b0xvY2FsZURhdGVTdHJpbmcoKX0gJHtuZXcgRGF0ZShBY3F1aXNpdGlvbkRhdGUpLnRvTG9jYWxlVGltZVN0cmluZygpfWBcbiAgICAgIDogbnVsbDtcbiAgICBjb25zdCByYXN0ZXJNZXRhRGF0YSA9IFtcbiAgICAgIHsgcHJvcGVydHk6IHN0cmluZ3Muc2Vuc29yTmFtZSwgdmFsdWU6IFNlbnNvck5hbWUgfSxcbiAgICAgIHsgcHJvcGVydHk6IHN0cmluZ3MucHJvZHVjdE5hbWUsIHZhbHVlOiBQcm9kdWN0TmFtZSB9LFxuICAgICAgeyBwcm9wZXJ0eTogc3RyaW5ncy5hY3F1aXNpdGlvbkRhdGUsIHZhbHVlOiBmb3JtYXR0ZWREYXRlIH0sXG4gICAgICB7IHByb3BlcnR5OiBzdHJpbmdzLmNsb3VkQ292ZXIsIHZhbHVlOiBDbG91ZENvdmVyIH0sXG4gICAgICB7IHByb3BlcnR5OiBzdHJpbmdzLnN1bkF6aW11dGgsIHZhbHVlOiBTdW5BemltdXRoIH0sXG4gICAgICB7IHByb3BlcnR5OiBzdHJpbmdzLnN1bkVsZXZhdGlvbiwgdmFsdWU6IFN1bkVsZXZhdGlvbiB9LFxuICAgICAgeyBwcm9wZXJ0eTogc3RyaW5ncy5zcGhlcm9pZCwgdmFsdWU6IEVMTElQU09JRCB9XG4gICAgXS5maWx0ZXIoKGluZm8pID0+ICEhaW5mby52YWx1ZSk7XG4gICAgY29uc3QgaGFzUmFzdGVyTWV0YURhdGEgPSByYXN0ZXJNZXRhRGF0YS5sZW5ndGggPiAwO1xuICAgIHJldHVybiAoaGFzUmFzdGVyTWV0YURhdGEgJiYgKGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgY29sbGFwc2libGU6IHRydWUsIG9wZW46IHRydWUsIGhlYWRpbmc6IHN0cmluZ3MucmFzdGVyTWV0YWRhdGEgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImltYWdlLWl0ZW0taW5mby10YWJsZS13cmFwcGVyXCIgfSwgaChcImFyY2dpcy1pbWFnZS1pdGVtLWluZm8tdGFibGVcIiwgeyBjb2x1bW5zOiB0YWJsZUNvbHVtbnMsIGRhdGE6IHJhc3Rlck1ldGFEYXRhIH0pKSkpKTtcbiAgfVxuICByZW5kZXJJbWFnZUl0ZW1FeHRlbnRJbmZvVGFibGUoKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzLCBpbWFnZUl0ZW1JbmZvIH0gPSB0aGlzO1xuICAgIGNvbnN0IHRhYmxlQ29sdW1ucyA9IFtcbiAgICAgIHsgYWNjZXNzb3I6IFwicHJvcGVydHlcIiwgaGVhZGVyOiBzdHJpbmdzLnByb3BlcnR5IH0sXG4gICAgICB7IGFjY2Vzc29yOiBcInZhbHVlXCIsIGhlYWRlcjogc3RyaW5ncy52YWx1ZSB9XG4gICAgXTtcbiAgICBjb25zdCB7IGV4dGVudCB9ID0gaW1hZ2VJdGVtSW5mbztcbiAgICBjb25zdCB7IHhtaW4sIHhtYXgsIHltaW4sIHltYXggfSA9IGV4dGVudDtcbiAgICBjb25zdCByYXN0ZXJFeHRlbnREYXRhID0gW1xuICAgICAgeyBwcm9wZXJ0eTogc3RyaW5ncy50b3AsIHZhbHVlOiB5bWF4IH0sXG4gICAgICB7IHByb3BlcnR5OiBzdHJpbmdzLmJvdHRvbSwgdmFsdWU6IHltaW4gfSxcbiAgICAgIHsgcHJvcGVydHk6IHN0cmluZ3MubGVmdCwgdmFsdWU6IHhtaW4gfSxcbiAgICAgIHsgcHJvcGVydHk6IHN0cmluZ3MucmlnaHQsIHZhbHVlOiB4bWF4IH1cbiAgICBdLmZpbHRlcigoaW5mbykgPT4gISFpbmZvLnZhbHVlKTtcbiAgICBjb25zdCBoYXNSYXN0ZXJFeHRlbnREYXRhID0gcmFzdGVyRXh0ZW50RGF0YS5sZW5ndGggPiAwO1xuICAgIHJldHVybiAoaGFzUmFzdGVyRXh0ZW50RGF0YSAmJiAoaChcImNhbGNpdGUtYmxvY2tcIiwgeyBjb2xsYXBzaWJsZTogdHJ1ZSwgb3BlbjogdHJ1ZSwgaGVhZGluZzogc3RyaW5ncy5leHRlbnQgfSwgaChcImFyY2dpcy1pbWFnZS1pdGVtLWluZm8tdGFibGVcIiwgeyBjb2x1bW5zOiB0YWJsZUNvbHVtbnMsIGRhdGE6IHJhc3RlckV4dGVudERhdGEgfSkpKSk7XG4gIH1cbiAgcmVuZGVySW1hZ2VJdGVtU3RhdGlzdGljc0luZm9UYWJsZSgpIHtcbiAgICBjb25zdCB7IHN0cmluZ3MsIGltYWdlSXRlbUluZm8gfSA9IHRoaXM7XG4gICAgY29uc3QgdGFibGVDb2x1bW5zID0gW1xuICAgICAgeyBhY2Nlc3NvcjogXCJiYW5kTmFtZVwiLCBoZWFkZXI6IHN0cmluZ3MuYmFuZE5hbWUgfSxcbiAgICAgIHsgYWNjZXNzb3I6IFwibWluXCIsIGhlYWRlcjogc3RyaW5ncy5taW4gfSxcbiAgICAgIHsgYWNjZXNzb3I6IFwibWF4XCIsIGhlYWRlcjogc3RyaW5ncy5tYXggfSxcbiAgICAgIHsgYWNjZXNzb3I6IFwiYXZnXCIsIGhlYWRlcjogc3RyaW5ncy5tZWFuIH0sXG4gICAgICB7IGFjY2Vzc29yOiBcInN0ZGRldlwiLCBoZWFkZXI6IHN0cmluZ3Muc3RkIH1cbiAgICBdO1xuICAgIGNvbnN0IHsgYmFuZEluZm9zLCBzdGF0aXN0aWNzIH0gPSBpbWFnZUl0ZW1JbmZvO1xuICAgIGNvbnN0IGJhbmRTdGF0c0RhdGEgPSBiYW5kSW5mb3MubWFwKChiYW5kSW5mbywgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IGJhbmRTdGF0cyA9IHN0YXRpc3RpY3NbaW5kZXhdO1xuICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oeyBiYW5kTmFtZTogYmFuZEluZm8ubmFtZSB9LCBiYW5kU3RhdHMpO1xuICAgIH0pO1xuICAgIGNvbnN0IGhhc0JhbmRTdGF0c0RhdGEgPSBiYW5kU3RhdHNEYXRhLmxlbmd0aCA+IDA7XG4gICAgcmV0dXJuIChoYXNCYW5kU3RhdHNEYXRhICYmIChoKFwiY2FsY2l0ZS1ibG9ja1wiLCB7IGNvbGxhcHNpYmxlOiB0cnVlLCBvcGVuOiB0cnVlLCBoZWFkaW5nOiBzdHJpbmdzLnN0YXRpc3RpY3MgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImltYWdlLWl0ZW0taW5mby10YWJsZS13cmFwcGVyXCIgfSwgaChcImFyY2dpcy1pbWFnZS1pdGVtLWluZm8tdGFibGVcIiwgeyBjb2x1bW5zOiB0YWJsZUNvbHVtbnMsIGRhdGE6IGJhbmRTdGF0c0RhdGEgfSkpKSkpO1xuICB9XG4gIHJlbmRlckltYWdlSXRlbVNwYXRpYWxSZWZlcmVuY2VUYWJsZSgpIHtcbiAgICBjb25zdCB7IHN0cmluZ3MsIGltYWdlSXRlbUluZm8gfSA9IHRoaXM7XG4gICAgY29uc3QgdGFibGVDb2x1bW5zID0gW1xuICAgICAgeyBhY2Nlc3NvcjogXCJwcm9wZXJ0eVwiLCBoZWFkZXI6IHN0cmluZ3MucHJvcGVydHkgfSxcbiAgICAgIHsgYWNjZXNzb3I6IFwidmFsdWVcIiwgaGVhZGVyOiBzdHJpbmdzLnZhbHVlIH1cbiAgICBdO1xuICAgIGNvbnN0IHsga2V5UHJvcGVydGllcywgc3BhdGlhbFJlZmVyZW5jZSB9ID0gaW1hZ2VJdGVtSW5mbztcbiAgICBjb25zdCBzcGF0aWFsUmVmZXJlbmNlRGF0YSA9IFtcbiAgICAgIHsgcHJvcGVydHk6IHN0cmluZ3MucHJvamVjdGVkQ29vcmRpbmF0ZVN5c3RlbSwgdmFsdWU6IFwiXCIgfSxcbiAgICAgIHsgcHJvcGVydHk6IHN0cmluZ3MucHJvamVjdGlvbiwgdmFsdWU6IFwiXCIgfSxcbiAgICAgIHsgcHJvcGVydHk6IHN0cmluZ3Mud2tpZCwgdmFsdWU6IHNwYXRpYWxSZWZlcmVuY2UgPT09IG51bGwgfHwgc3BhdGlhbFJlZmVyZW5jZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3BhdGlhbFJlZmVyZW5jZS53a2lkIH0sXG4gICAgICB7IHByb3BlcnR5OiBzdHJpbmdzLmRhdHVtLCB2YWx1ZToga2V5UHJvcGVydGllcyA9PT0gbnVsbCB8fCBrZXlQcm9wZXJ0aWVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBrZXlQcm9wZXJ0aWVzLkRBVFVNIH0sXG4gICAgICB7IHByb3BlcnR5OiBzdHJpbmdzLnNwaGVyb2lkLCB2YWx1ZToga2V5UHJvcGVydGllcyA9PT0gbnVsbCB8fCBrZXlQcm9wZXJ0aWVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBrZXlQcm9wZXJ0aWVzLkVMTElQU09JRCB9XG4gICAgXS5maWx0ZXIoKGluZm8pID0+ICEhaW5mby52YWx1ZSk7XG4gICAgY29uc3QgaGFzVmFsaWRTcGF0aWFsUmVmZXJlbmNlRGF0YSA9IHNwYXRpYWxSZWZlcmVuY2VEYXRhLmxlbmd0aCA+IDA7XG4gICAgcmV0dXJuIChoYXNWYWxpZFNwYXRpYWxSZWZlcmVuY2VEYXRhICYmIChoKFwiY2FsY2l0ZS1ibG9ja1wiLCB7IGNvbGxhcHNpYmxlOiB0cnVlLCBvcGVuOiB0cnVlLCBoZWFkaW5nOiBzdHJpbmdzLnNwYXRpYWxSZWZlcmVuY2UgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImltYWdlLWl0ZW0taW5mby10YWJsZS13cmFwcGVyXCIgfSwgaChcImFyY2dpcy1pbWFnZS1pdGVtLWluZm8tdGFibGVcIiwgeyBjb2x1bW5zOiB0YWJsZUNvbHVtbnMsIGRhdGE6IHNwYXRpYWxSZWZlcmVuY2VEYXRhIH0pKSkpKTtcbiAgfVxuICByZW5kZXJJbWFnZUl0ZW1JbnNwZWN0QnV0dG9uR3JvdXAoKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzIH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImltYWdlLWl0ZW0taW5zcGVjdC1idXR0b24tZ3JvdXBcIiB9LCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBcImFyaWEtbGFiZWxcIjogc3RyaW5ncy5hZGRMYXllciwgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBcImljb24tc3RhcnRcIjogXCJhZGQtbGF5ZXJcIiwga2luZDogXCJuZXV0cmFsXCIsIHNjYWxlOiBcInNcIiB9KSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgXCJhcmlhLWxhYmVsXCI6IHN0cmluZ3Muem9vbVRvSXRlbSwgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBcImljb24tc3RhcnRcIjogXCJsYXllci16b29tLXRvXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBzY2FsZTogXCJzXCIgfSkpKTtcbiAgfVxuICByZW5kZXJQcmV2aWV3VGh1bWJuYWlsKGltYWdlSXRlbU9iamVjdElkKSB7XG4gICAgY29uc3QgeyBsYXllciwgbW9kdWxlcyB9ID0gdGhpcztcbiAgICBjb25zdCB7IElkZW50aXR5TWFuYWdlciB9ID0gbW9kdWxlcztcbiAgICBjb25zdCBsYXllckNyZWRlbnRpYWwgPSBJZGVudGl0eU1hbmFnZXIuZmluZENyZWRlbnRpYWwobGF5ZXIudXJsKTtcbiAgICBjb25zdCB7IHRva2VuIH0gPSBsYXllckNyZWRlbnRpYWwgfHwge307XG4gICAgY29uc3QgdGh1bWJuYWlsSW1nU3JjU3RyID0gYCR7bGF5ZXIudXJsfS8ke2ltYWdlSXRlbU9iamVjdElkfS90aHVtYm5haWwke3Rva2VuID8gYD90b2tlbj0ke3Rva2VufWAgOiBcIlwifWA7XG4gICAgcmV0dXJuIGgoXCJpbWdcIiwgeyBzbG90OiBcInRodW1ibmFpbFwiLCBzcmM6IHRodW1ibmFpbEltZ1NyY1N0ciB9KTtcbiAgfVxuICByZW5kZXJGZWF0dXJlQXR0cmlidXRlc0luSW1hZ2VJdGVtQ2FyZChmZWF0dXJlKSB7XG4gICAgY29uc3QgeyBpbWFnZUl0ZW1DYXJkRGlzcGxheWVkRmllbGROYW1lcyB9ID0gdGhpcztcbiAgICBjb25zdCBkaXNwbGF5ZWRBdHRyaWJ1dGVzTGlzdCA9IGltYWdlSXRlbUNhcmREaXNwbGF5ZWRGaWVsZE5hbWVzLm1hcCgoZmllbGQpID0+IHtcbiAgICAgIHJldHVybiAoaChcImxpXCIsIG51bGwsIGgoXCJzdHJvbmdcIiwgbnVsbCwgZmllbGQpLCBgOiAke2ZlYXR1cmUuYXR0cmlidXRlc1tmaWVsZF19YCkpO1xuICAgIH0pO1xuICAgIHJldHVybiBoKFwidWxcIiwgeyBjbGFzczogXCJpbWFnZS1pdGVtLWNhcmQtZGlzcGxheWVkLWZpZWxkLWxpc3RcIiB9LCBkaXNwbGF5ZWRBdHRyaWJ1dGVzTGlzdCk7XG4gIH1cbiAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0ltYWdlQ29sbGVjdGlvbkV4cGxvcmVyLnN0eWxlID0gYXJjZ2lzSW1hZ2VDb2xsZWN0aW9uRXhwbG9yZXJDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc0ltYWdlQ29sbGVjdGlvbkV4cGxvcmVyIGFzIGFyY2dpc19pbWFnZV9jb2xsZWN0aW9uX2V4cGxvcmVyIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGwgYXMgbG9hZE1vZHVsZXMgfSBmcm9tICcuL2xvYWRNb2R1bGVzLWFhZjMwYmQ2LmpzJztcbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tMTNmNWIwMGMuanMnO1xuXG5jb25zdCBsYW5ndWFnZU1hcCA9IG5ldyBNYXAoW1xuICBbXCJhclwiLCBcImFyXCJdLFxuICBbXCJiZ1wiLCBcImJnXCJdLFxuICBbXCJic1wiLCBcImJzXCJdLFxuICBbXCJjYVwiLCBcImNhXCJdLFxuICBbXCJjc1wiLCBcImNzXCJdLFxuICBbXCJkYVwiLCBcImRhXCJdLFxuICBbXCJkZVwiLCBcImRlXCJdLFxuICBbXCJlbFwiLCBcImVsXCJdLFxuICBbXCJlblwiLCBcImVuXCJdLFxuICBbXCJlc1wiLCBcImVzXCJdLFxuICBbXCJldFwiLCBcImV0XCJdLFxuICBbXCJmaVwiLCBcImZpXCJdLFxuICBbXCJmclwiLCBcImZyXCJdLFxuICBbXCJoZVwiLCBcImhlXCJdLFxuICBbXCJoclwiLCBcImhyXCJdLFxuICBbXCJodVwiLCBcImh1XCJdLFxuICBbXCJpZFwiLCBcImlkXCJdLFxuICBbXCJpdFwiLCBcIml0XCJdLFxuICBbXCJqYVwiLCBcImphXCJdLFxuICBbXCJrb1wiLCBcImtvXCJdLFxuICBbXCJsdFwiLCBcImx0XCJdLFxuICBbXCJsdlwiLCBcImx2XCJdLFxuICBbXCJuYlwiLCBcIm5iXCJdLFxuICBbXCJubFwiLCBcIm5sXCJdLFxuICBbXCJwbFwiLCBcInBsXCJdLFxuICBbXCJwdC1iclwiLCBcInB0LUJSXCJdLFxuICBbXCJwdC1wdFwiLCBcInB0LVBUXCJdLFxuICBbXCJyb1wiLCBcInJvXCJdLFxuICBbXCJydVwiLCBcInJ1XCJdLFxuICBbXCJza1wiLCBcInNrXCJdLFxuICBbXCJzbFwiLCBcInNsXCJdLFxuICBbXCJzclwiLCBcInNyXCJdLFxuICBbXCJzdlwiLCBcInN2XCJdLFxuICBbXCJ0aFwiLCBcInRoXCJdLFxuICBbXCJ0clwiLCBcInRyXCJdLFxuICBbXCJ1a1wiLCBcInVrXCJdLFxuICBbXCJ2aVwiLCBcInZpXCJdLFxuICBbXCJ6aC1jblwiLCBcInpoLUNOXCJdLFxuICBbXCJ6aC1oa1wiLCBcInpoLUhLXCJdLFxuICBbXCJ6aC10d1wiLCBcInpoLVRXXCJdXG5dKTtcbi8vIHJ0bFxuZnVuY3Rpb24gZ2V0RWxlbWVudERpcihlbCkge1xuICByZXR1cm4gZ2V0RWxlbWVudFByb3AoZWwsIFwiZGlyXCIsIFwibHRyXCIpO1xufVxuZnVuY3Rpb24gZ2V0RWxlbWVudFByb3AoZWwsIHByb3AsIHZhbHVlKSB7XG4gIGNvbnN0IGNsb3Nlc3RXaXRoUHJvcCA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbCwgYFske3Byb3B9XWApO1xuICByZXR1cm4gY2xvc2VzdFdpdGhQcm9wID8gY2xvc2VzdFdpdGhQcm9wLmdldEF0dHJpYnV0ZShwcm9wKSA6IHZhbHVlO1xufVxuLy8gY3NzXG5jb25zdCBDU1NfVVRJTElUWSA9IHtcbiAgcnRsOiBcImFyY2dpcy0tcnRsXCJcbn07XG5hc3luYyBmdW5jdGlvbiBmb3JtYXROdW1iZXIobnVtYmVyLCBvcHRpb25zKSB7XG4gIGNvbnN0IHsgYXBpLCB0eXBlLCBwbGFjZXMgfSA9IG9wdGlvbnMgfHwge307XG4gIGlmIChhcGkgPT09IDQpIHtcbiAgICBjb25zdCBbaW50bF0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL2ludGxcIl0pO1xuICAgIGNvbnN0IG51bWJlckZvcm1hdEludGxPcHRpb25zID0gaW50bC5jb252ZXJ0TnVtYmVyRm9ybWF0VG9JbnRsT3B0aW9ucyh7XG4gICAgICBwbGFjZXMsXG4gICAgICBzdHlsZTogdHlwZSxcbiAgICAgIGRpZ2l0U2VwYXJhdG9yOiB0cnVlXG4gICAgfSk7XG4gICAgcmV0dXJuIGludGwuZm9ybWF0TnVtYmVyKG51bWJlciwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyksIHsgc3R5bGU6IHR5cGUgfSkpO1xuICB9XG4gIGNvbnN0IFtkb2pvTnVtYmVyXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImRvam8vbnVtYmVyXCJdKTtcbiAgcmV0dXJuIGRvam9OdW1iZXIuZm9ybWF0KG51bWJlciwge1xuICAgIHR5cGUsXG4gICAgcGxhY2VzLFxuICAgIHBhdHRlcm46IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5wYXR0ZXJuXG4gIH0pO1xufVxuY29uc3QgY2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZSkge1xuICBjb25zdCBsYW5nID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lmxhbmc7XG4gIGNvbnN0IGRheVNob3J0TW9udGhZZWFyID0ge1xuICAgIHllYXI6IFwibnVtZXJpY1wiLFxuICAgIG1vbnRoOiBcInNob3J0XCIsXG4gICAgZGF5OiBcIm51bWVyaWNcIlxuICB9O1xuICBpZiAoIWNhY2hlW2xhbmddKSB7XG4gICAgY2FjaGVbbGFuZ10gPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZywgZGF5U2hvcnRNb250aFllYXIpO1xuICB9XG4gIHJldHVybiBjYWNoZVtsYW5nXS5mb3JtYXQoZGF0ZSk7XG59XG5cbmV4cG9ydCB7IENTU19VVElMSVRZIGFzIEMsIGZvcm1hdERhdGUgYXMgYSwgZm9ybWF0TnVtYmVyIGFzIGYsIGdldEVsZW1lbnREaXIgYXMgZywgbGFuZ3VhZ2VNYXAgYXMgbCB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTEzZjViMDBjLmpzJztcbmltcG9ydCB7IGwgYXMgbGFuZ3VhZ2VNYXAgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC0yMjI1OGM5MC5qcyc7XG5pbXBvcnQgeyBhIGFzIGdldEFzc2V0UGF0aCB9IGZyb20gJy4vaW5kZXgtOTJlYmIzOTYuanMnO1xuXG4vLyBodHRwczovL21lZGl1bS5jb20vc3RlbmNpbC10cmlja3MvaW1wbGVtZW50aW5nLWludGVybmF0aW9uYWxpc2F0aW9uLWkxOG4td2l0aC1zdGVuY2lsLTVlNjU1OTU1NDExN1xuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpIHtcbiAgdmFyIF9hLCBfYiwgX2M7XG4gIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gIH1cbiAgZWxzZSB7XG4gICAgLy8gXCJydS1SVVwiIG1hcHMgdG8gXCJydVwiIHVzZSBjYXNlXG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nLnNsaWNlKDAsIDIpKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXR1cm4gXCJlblwiO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KSB7XG4gIHZhciBfYSwgX2IsIF9jO1xuICAvLyBpdCdzIE9LIGlmIHdlIGRvbid0IGhhdmUgdGhlIDQgbGV0dGVyIGxhbmd1YWdlIGZpbGUgZm9yIGl0XG4gIC8vIDQgbGV0dGVyIGxhbmd1YWdlIGNvZGUgbmVlZGVkIGZvciBmb3JtYXR0aW5nIG51bWJlcnNcbiAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gIC8vIGxhbmd1YWdlIHNldCBieSB0aGUgY2FsbGluZyBhcHBsaWNhdGlvbiBvciBicm93c2VyLiBkZWZhdWx0cyB0byBlbmdsaXNoLlxuICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgfVxuICBlbHNlIHtcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAvLyB3ZSBzdXBwb3J0IHRoZSAyIGxldHRlciBjb2RlZCBsYW5ndWFnZVxuICAgICAgLy8gZS5nLiBpdC1DSCB2cyBpdFxuICAgICAgcmV0dXJuIGxhbmc7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGZldGNoTG9jYWxlU3RyaW5nc0ZvckNvbXBvbmVudChjb21wb25lbnROYW1lLCBsb2NhbGUpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBmZXRjaChnZXRBc3NldFBhdGgoYC4uL2FyY2dpcy1hcHAtYXNzZXRzL2kxOG4vJHtjb21wb25lbnROYW1lfS5pMThuLiR7bG9jYWxlfS5qc29uYCkpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgaWYgKHJlc3VsdC5vaylcbiAgICAgICAgcmVzb2x2ZShyZXN1bHQuanNvbigpKTtcbiAgICAgIGVsc2VcbiAgICAgICAgcmVqZWN0KCk7XG4gICAgfSwgKCkgPT4gcmVqZWN0KCkpO1xuICB9KTtcbn1cbmNvbnN0IHN0cmluZ0NhY2hlID0ge307XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gIGNvbnN0IGlkID0gYCR7Y29tcG9uZW50TmFtZX0ke2xvY2FsZX1gO1xuICBpZiAoIXN0cmluZ0NhY2hlW2lkXSkge1xuICAgIHN0cmluZ0NhY2hlW2lkXSA9IGZldGNoTG9jYWxlU3RyaW5nc0ZvckNvbXBvbmVudChjb21wb25lbnROYW1lLCBsb2NhbGUpO1xuICB9XG4gIHJldHVybiBzdHJpbmdDYWNoZVtpZF07XG59XG4vKipcbiAqIEdldCBzdHJpbmdzIGFuZCBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoaXMgbWV0aG9kIHJldHVybnMgMiBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoZSBmaXJzdCBvbmUgcmV0dXJucyBhIGNvZGUgdGhhdCdzIGFsc28gc3VwcG9ydGVkIGFzIGEgbGFuZ3VhZ2UgZmlsZS5cbiAqIFRoZSBzZWNvbmQgb25lIHJldHVybnMgYSBjb2RlIHdoZXJlIHRoZXJlIGlzIHN1cHBvcnQgZm9yIHRoZSBmaXJzdCAyIGxldHRlcnMgb2YgdGhlIGNvZGUgYXMgcGFydCBvZiBhIGxhbmd1YWdlIGZpbGUsXG4gKiBidXQgd2lsbCByZXR1cm4gdGhlIG9yaWdpbmFsIDQgbGV0dGVyIGNvZGUgZnJvbSB0aGUgcGFnZS5cbiAqIEUuZy4gRm9yIFwiaXQtY2hcIiBpdCB3aWxsIHJldHVybiBcIml0XCIgYXMgdGhlIGZpcnN0IGxhbmd1YWdlIGNvZGUgYW5kIFwiaXQtY2hcIiBhcyB0aGUgc2Vjb25kLlxuICogVGhlIHNlY29uZCBvbmUgaXMgcmVxdWlyZWQgZm9yIGVzcmkuaW50bC5zZXRMb2NhbGUoKSB0byBnZXQgdGhlIGNvcnJlY3QgZm9ybWF0dGluZy5cbiAqXG4gKiBJZiBhIHRhZ05hbWUgaXMgcHJvdmlkZWQgaXQgd2lsbCBvdmVyd2l0ZSB0aGUgZWxlbWVudCdzIHRhZ05hbWVcbiAqXG4gKiAgQHJldHVybiBbIHN0cmluZ3MsIGZpcnN0IGxhbmd1YWdlIGNvZGUsIHNlY29uZCBsYW5ndWFnZSBjb2RlXVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKGVsZW1lbnQsIHRhZ05hbWUpIHtcbiAgY29uc3QgY29tcG9uZW50TmFtZSA9IHRhZ05hbWUgfHwgZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpO1xuICBjb25zdCBjb21wb25lbnRMYW5ndWFnZUludGwgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpO1xuICBsZXQgc3RyaW5ncztcbiAgdHJ5IHtcbiAgICBzdHJpbmdzID0gYXdhaXQgZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGNvbXBvbmVudExhbmd1YWdlKTtcbiAgfVxuICBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUud2Fybihgbm8gbG9jYWxlIGZvciAke2NvbXBvbmVudE5hbWV9ICgke2NvbXBvbmVudExhbmd1YWdlfSkgbG9hZGluZyBkZWZhdWx0IGxvY2FsZSBlbi5gKTtcbiAgICBzdHJpbmdzID0gYXdhaXQgZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIFwiZW5cIik7XG4gIH1cbiAgcmV0dXJuIFtzdHJpbmdzLCBjb21wb25lbnRMYW5ndWFnZSwgY29tcG9uZW50TGFuZ3VhZ2VJbnRsXTtcbn1cblxuZXhwb3J0IHsgZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlIGFzIGEsIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgYXMgZyB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9