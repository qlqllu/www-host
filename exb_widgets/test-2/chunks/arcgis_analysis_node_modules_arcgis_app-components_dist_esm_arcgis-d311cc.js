"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-d311cc"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-symbol-order.entry.js":
/*!**********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-symbol-order.entry.js ***!
  \**********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_symbol_order: () => (/* binding */ ArcgisSymbolOrder)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */






const CSS = {
  container: "container",
  section: "section",
  title: "title",
  missing: "missing"
};

var SortDirectionIcon;
(function (SortDirectionIcon) {
  SortDirectionIcon["Ascending"] = "sort-ascending-arrow";
  SortDirectionIcon["Descending"] = "sort-descending-arrow";
})(SortDirectionIcon || (SortDirectionIcon = {}));
var SortDirectionTooltip;
(function (SortDirectionTooltip) {
  SortDirectionTooltip["AscendingDate"] = "sortLeastRecent";
  SortDirectionTooltip["AscendingNumber"] = "smallToLarge";
  SortDirectionTooltip["DescendingDate"] = "sortMostRecent";
  SortDirectionTooltip["DescendingNumber"] = "largeToSmall";
})(SortDirectionTooltip || (SortDirectionTooltip = {}));

const arcgisSymbolOrderCss = "article{display:flex;align-items:center;flex-direction:row;grid-gap:0.5rem;gap:0.5rem}article calcite-action{margin-top:0.7em}article calcite-label{width:100%}.infoPopover{width:340px;font-size:12px}.information{margin:0 0 1em 0}";

const ArcgisSymbolOrder = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisSymbolOrderChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSymbolOrderChange", 7);
    this.fieldPickListChanges = (event) => {
      var _a, _b;
      event.stopPropagation();
      const fieldName = (_b = (_a = event.detail) === null || _a === void 0 ? void 0 : _a.selectedFields) === null || _b === void 0 ? void 0 : _b[0];
      if (fieldName && fieldName !== this.selectedField.name) {
        this.selectedField =
          fieldName !== this.getRendererFieldName()
            ? this.toPickListFieldInfo(this.findField(fieldName))
            : this.getRendererFieldInfo();
      }
      this.onHideFieldPickList();
    };
    this.view = undefined;
    this.layer = undefined;
    this.open = true;
    this.disabled = false;
    this.fieldTypes = [
      "integer",
      "small-integer",
      "big-integer",
      "single",
      "double",
      "long",
      "date"
    ];
    this.objectIdFieldName = "oid";
    this.ascending = false;
    this.selectedField = undefined;
  }
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  async componentWillLoad() {
    var _a;
    const [strings] = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement);
    this.strings = strings;
    const { view, layer, pickListFields } = this;
    this.props = {
      view,
      layer
    };
    const fields = pickListFields || this.createPickListFields();
    if (!this.isRendererOrder()) {
      const { orderBy } = layer;
      const orderByInfo = (orderBy === null || orderBy === void 0 ? void 0 : orderBy.length) ? orderBy[0] : orderBy;
      this.ascending = (orderByInfo === null || orderByInfo === void 0 ? void 0 : orderByInfo.mode) === "ascending";
      const orderByField = (this.orderByField =
        (orderByInfo === null || orderByInfo === void 0 ? void 0 : orderByInfo.field) || ((_a = this.findOIDField(fields)) === null || _a === void 0 ? void 0 : _a.name) || fields[0]);
      this.selectedField = this.toPickListFieldInfo(this.findField(orderByField));
    }
    else {
      this.selectedField = this.getRendererFieldInfo();
    }
  }
  async componentDidLoad() {
    // once component is visible make other calls
    const [intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/intl"]);
    this.intl = intl;
    this.intl.setLocale(document.documentElement.lang);
  }
  disconnectedCallback() {
    this.destroyFieldsPickList();
  }
  //--------------------------------------------------------------------------
  //
  //  Public Methods
  //
  //--------------------------------------------------------------------------
  /**
   * Cleans up component, closes popovers
   */
  async done() {
    this.disableContainer(false);
    this.destroyFieldsPickList();
  }
  // --------------------------------------------------------------------------
  //
  //  Render Methods
  //
  //--------------------------------------------------------------------------
  render() {
    const { strings, open, disabled } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: CSS.container, heading: strings.heading, collapsible: true, disabled: disabled, open: open && !disabled }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "information" }, strings.orderByTooltip), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("article", null, this.renderFieldSelectionButton(), this.renderSortOrderAction())), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { "reference-element": "sort-action", placement: "bottom-start", label: "", ref: (node) => (this.tooltipNode = node) }, this.getSortDirectionTooltip())));
  }
  renderFieldSelectionButton() {
    const { selectedField, strings } = this;
    const fields = this.createPickListFields();
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: "s" }, strings.orderBy, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { key: "selected-field-button", appearance: "outline-fill", kind: "neutral", width: "full", alignment: "icon-end-space-between", scale: "s", disabled: fields.length <= 1, iconEnd: "chevron-down", onClick: (e) => this.onShowFieldPickList(e), ref: (node) => (this.fieldSelectionNode = node) }, (selectedField === null || selectedField === void 0 ? void 0 : selectedField.alias) || fields[0].alias)));
  }
  renderSortOrderAction() {
    const { selectedField } = this;
    const disabled = selectedField.type === "oid" || selectedField.type === "renderer";
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { scale: "s", id: "sort-action", appearance: "transparent", alignment: "start", icon: this.getSortDirectionIcon(), onClick: (e) => this.onToggleSortDirection(e), onMouseOver: () => this.onShowTooltip(true), onMouseOut: () => this.onShowTooltip(false), text: "", disabled: disabled })));
  }
  // --------------------------------------------------------------------------
  //
  //  Event Handlers
  //
  //---------------------------------------------------------------------------
  onChange() {
    const value = this.getValue();
    const isOrderByClasses = value === "renderer";
    this.layer.orderBy = !isOrderByClasses ? value : undefined;
    this.layer.renderer.orderByClassesEnabled = isOrderByClasses || undefined;
    this.arcgisSymbolOrderChange.emit();
  }
  async onShowFieldPickList(e) {
    e.stopPropagation();
    this.disableContainer(true);
    this.createFieldPickList();
  }
  async onHideFieldPickList() {
    this.disableContainer(false);
    this.destroyFieldsPickList();
    await this.fieldSelectionNode.setFocus();
    this.onChange();
  }
  onToggleSortDirection(e) {
    e.stopPropagation();
    this.ascending = !this.ascending;
    this.onChange();
  }
  onShowTooltip(open) {
    this.tooltipNode.open = open;
  }
  // --------------------------------------------------------------------------
  //
  //  Private methods
  //
  // --------------------------------------------------------------------------
  createFieldPickList() {
    const { layer, pickListFields, view, strings } = this;
    const fields = pickListFields || this.createPickListFields();
    const refElement = this.fieldSelectionNode;
    const popoverProps = this.createPopoverProps(refElement);
    const selectedField = this.selectedField || (this.isRendererOrder() ? this.getRendererFieldInfo() : fields[0]);
    const fieldPickList = (this.fieldPickList =
      document.createElement("arcgis-field-pick-list"));
    fieldPickList.heading = strings.orderBy;
    fieldPickList.multiple = false;
    fieldPickList.showFieldInfo = false;
    fieldPickList.showFieldName = true;
    fieldPickList.mapView = view;
    fieldPickList.layer = layer;
    fieldPickList.fields = fields;
    fieldPickList.selectedFields = [selectedField.name];
    fieldPickList.popoverProps = popoverProps;
    fieldPickList.addEventListener("arcgisFieldPickListDismissed", this.fieldPickListChanges);
    document.body.appendChild(fieldPickList);
    return fieldPickList;
  }
  destroyFieldsPickList() {
    if (this.fieldPickList) {
      document.body.removeChild(this.fieldPickList);
      this.fieldPickList = null;
    }
  }
  createPopoverProps(refElement) {
    return {
      placement: "bottom-end",
      offsetDistance: 5,
      offsetSkidding: 0,
      pointerDisabled: true,
      popoverWidth: this.getPopoverWidth(),
      refElement: refElement
    };
  }
  createPickListFields() {
    let { pickListFields } = this;
    if (!pickListFields) {
      const { layer, fieldTypes } = this;
      const { fields } = layer;
      pickListFields = this.pickListFields = fields
        .filter((field) => fieldTypes.indexOf(field === null || field === void 0 ? void 0 : field.type) > -1)
        .map((field) => this.toPickListFieldInfo(field));
      // Add oidField to the list
      const objectIdFieldInfo = this.toPickListFieldInfo(this.getOIDField());
      pickListFields.unshift(objectIdFieldInfo);
      // Add sortByStyles to the beginning of the the list
      if (this.hasTypesOrPredominanceRenderer()) {
        const sortRendererFieldInfo = this.getRendererFieldInfo();
        pickListFields.unshift(sortRendererFieldInfo);
      }
    }
    return pickListFields;
  }
  toPickListFieldInfo(field) {
    return {
      name: field.name,
      alias: this.getFieldAlias(field),
      type: field.type
    };
  }
  getPopoverWidth() {
    var _a;
    const buffer = 30;
    const nodeWidth = (_a = this.hostElement) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect().width;
    return nodeWidth + buffer || 280;
  }
  getFieldAlias(field) {
    const { strings } = this;
    if (field.type === "oid") {
      return strings.defaultDataOrder;
    }
    else {
      const fieldInfo = this.findFieldInfoFromPopup(field);
      return (fieldInfo === null || fieldInfo === void 0 ? void 0 : fieldInfo.label) || field.alias || field.name;
    }
  }
  findFieldInfoFromPopup(field) {
    const { popupTemplate } = this.layer;
    const fieldInfos = popupTemplate === null || popupTemplate === void 0 ? void 0 : popupTemplate.fieldInfos;
    return (fieldInfos || []).find((fieldInfo) => fieldInfo.fieldName === field.name);
  }
  getOIDField() {
    const { layer } = this;
    const { fields } = layer;
    return fields.find((field) => field.name === layer.objectIdField || field.type === "oid");
  }
  findOIDField(fieldInfos) {
    const { layer } = this;
    return fieldInfos.find((field) => field.name === layer.objectIdField || field.type === "oid");
  }
  findField(name) {
    const { layer } = this;
    const { fields } = layer;
    const field = fields.find((field) => field.name === name);
    return field || fields[0];
  }
  getSortDirectionIcon() {
    return this.ascending ? SortDirectionIcon.Ascending : SortDirectionIcon.Descending;
  }
  getSortDirectionTooltip() {
    const { ascending, selectedField, strings } = this;
    const selectedFeldType = selectedField === null || selectedField === void 0 ? void 0 : selectedField.type;
    let stringKey = "sortLeastRecent";
    if (selectedFeldType === "date") {
      stringKey = ascending
        ? SortDirectionTooltip.AscendingDate
        : SortDirectionTooltip.DescendingDate;
    }
    else {
      stringKey = ascending
        ? SortDirectionTooltip.AscendingNumber
        : SortDirectionTooltip.DescendingNumber;
    }
    return strings[stringKey];
  }
  hasTypesOrPredominanceRenderer() {
    var _a, _b;
    const { layer } = this;
    const { renderer } = layer;
    return ((renderer === null || renderer === void 0 ? void 0 : renderer.type) === "unique-value" &&
      (!((_a = renderer === null || renderer === void 0 ? void 0 : renderer.authoringInfo) === null || _a === void 0 ? void 0 : _a.type) || ((_b = renderer === null || renderer === void 0 ? void 0 : renderer.authoringInfo) === null || _b === void 0 ? void 0 : _b.type) === "predominance"));
  }
  isRendererOrder() {
    const { layer } = this;
    const renderer = layer.renderer;
    return this.hasTypesOrPredominanceRenderer() && (renderer === null || renderer === void 0 ? void 0 : renderer.orderByClassesEnabled) === true;
  }
  getRendererFieldName() {
    const { layer } = this;
    const renderer = layer.renderer;
    return ((this.hasTypesOrPredominanceRenderer() &&
      (renderer.field || renderer.valueExpressionTitle)) ||
      null);
  }
  getRendererFieldInfo() {
    return {
      name: this.getRendererFieldName(),
      alias: this.strings.styleOrder,
      type: "renderer"
    };
  }
  disableContainer(disable) {
    const container = this.hostElement.closest("calcite-flow-item");
    if (container) {
      container.disabled = disable;
    }
  }
  getValue() {
    const { selectedField } = this;
    if (selectedField.type === "oid") {
      return null;
    }
    else if (selectedField.type === "renderer") {
      return "renderer";
    }
    else {
      return [
        {
          order: this.ascending ? "ascending" : "descending",
          field: this.selectedField.name
        }
      ];
    }
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSymbolOrder.style = arcgisSymbolOrderCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



const languageMap = new Map([
  ["ar", "ar"],
  ["bg", "bg"],
  ["bs", "bs"],
  ["ca", "ca"],
  ["cs", "cs"],
  ["da", "da"],
  ["de", "de"],
  ["el", "el"],
  ["en", "en"],
  ["es", "es"],
  ["et", "et"],
  ["fi", "fi"],
  ["fr", "fr"],
  ["he", "he"],
  ["hr", "hr"],
  ["hu", "hu"],
  ["id", "id"],
  ["it", "it"],
  ["ja", "ja"],
  ["ko", "ko"],
  ["lt", "lt"],
  ["lv", "lv"],
  ["nb", "nb"],
  ["nl", "nl"],
  ["pl", "pl"],
  ["pt-br", "pt-BR"],
  ["pt-pt", "pt-PT"],
  ["ro", "ro"],
  ["ru", "ru"],
  ["sk", "sk"],
  ["sl", "sl"],
  ["sr", "sr"],
  ["sv", "sv"],
  ["th", "th"],
  ["tr", "tr"],
  ["uk", "uk"],
  ["vi", "vi"],
  ["zh-cn", "zh-CN"],
  ["zh-hk", "zh-HK"],
  ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
  return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
  const closestWithProp = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
  return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
  rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
  const { api, type, places } = options || {};
  if (api === 4) {
    const [intl] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
    const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
      places,
      style: type,
      digitSeparator: true
    });
    return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
  }
  const [dojoNumber] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
  return dojoNumber.format(number, {
    type,
    places,
    pattern: options === null || options === void 0 ? void 0 : options.pattern
  });
}
const cache = {};
function formatDate(date) {
  const lang = document.documentElement.lang;
  const dayShortMonthYear = {
    year: "numeric",
    month: "short",
    day: "numeric"
  };
  if (!cache[lang]) {
    cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
  }
  return cache[lang].format(date);
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
  var _a, _b, _c;
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    // "ru-RU" maps to "ru" use case
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
    }
    else {
      return "en";
    }
  }
}
function getComponentClosestLanguageIntl(element) {
  var _a, _b, _c;
  // it's OK if we don't have the 4 letter language file for it
  // 4 letter language code needed for formatting numbers
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      // we support the 2 letter coded language
      // e.g. it-CH vs it
      return lang;
    }
    else {
      return "en";
    }
  }
}
function fetchLocaleStringsForComponent(componentName, locale) {
  return new Promise((resolve, reject) => {
    fetch((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
      if (result.ok)
        resolve(result.json());
      else
        reject();
    }, () => reject());
  });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
  const id = `${componentName}${locale}`;
  if (!stringCache[id]) {
    stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
  }
  return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
  const componentName = tagName || element.tagName.toLowerCase();
  const componentLanguage = getComponentClosestLanguage(element);
  const componentLanguageIntl = getComponentClosestLanguageIntl(element);
  let strings;
  try {
    strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
  }
  catch (e) {
    console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
    strings = await fetchLocaleStringsFromCache(componentName, "en");
  }
  return [strings, componentLanguage, componentLanguageIntl];
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWQzMTFjYy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUM2RztBQUN2QztBQUNUO0FBQ2xDO0FBQ1M7O0FBRXBDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsOENBQThDO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsb0RBQW9EOztBQUVyRCxzQ0FBc0MsYUFBYSxtQkFBbUIsbUJBQW1CLGdCQUFnQixXQUFXLHVCQUF1QixpQkFBaUIsc0JBQXNCLFdBQVcsYUFBYSxZQUFZLGVBQWUsYUFBYSxpQkFBaUI7O0FBRW5RO0FBQ0E7QUFDQSxJQUFJLHFEQUFnQjtBQUNwQixtQ0FBbUMscURBQVc7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLHNEQUF5QjtBQUNyRDtBQUNBLFlBQVksOEJBQThCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsVUFBVTtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsMkRBQVc7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxlQUFlLEdBQUcsa0JBQWtCO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBOztBQUU0RSIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1zeW1ib2wtb3JkZXIuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xvY2FsZS0xM2UwMGE3NS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyB9IGZyb20gJy4vbG9jYWxlLTEzZTAwYTc1LmpzJztcbmltcG9ydCB7IGwgYXMgbG9hZE1vZHVsZXMgfSBmcm9tICcuL2xvYWRNb2R1bGVzLWFhZjMwYmQ2LmpzJztcbmltcG9ydCAnLi9kb20tMTNmNWIwMGMuanMnO1xuaW1wb3J0ICcuL2xhbmd1YWdlVXRpbC0yMjI1OGM5MC5qcyc7XG5cbmNvbnN0IENTUyA9IHtcbiAgY29udGFpbmVyOiBcImNvbnRhaW5lclwiLFxuICBzZWN0aW9uOiBcInNlY3Rpb25cIixcbiAgdGl0bGU6IFwidGl0bGVcIixcbiAgbWlzc2luZzogXCJtaXNzaW5nXCJcbn07XG5cbnZhciBTb3J0RGlyZWN0aW9uSWNvbjtcbihmdW5jdGlvbiAoU29ydERpcmVjdGlvbkljb24pIHtcbiAgU29ydERpcmVjdGlvbkljb25bXCJBc2NlbmRpbmdcIl0gPSBcInNvcnQtYXNjZW5kaW5nLWFycm93XCI7XG4gIFNvcnREaXJlY3Rpb25JY29uW1wiRGVzY2VuZGluZ1wiXSA9IFwic29ydC1kZXNjZW5kaW5nLWFycm93XCI7XG59KShTb3J0RGlyZWN0aW9uSWNvbiB8fCAoU29ydERpcmVjdGlvbkljb24gPSB7fSkpO1xudmFyIFNvcnREaXJlY3Rpb25Ub29sdGlwO1xuKGZ1bmN0aW9uIChTb3J0RGlyZWN0aW9uVG9vbHRpcCkge1xuICBTb3J0RGlyZWN0aW9uVG9vbHRpcFtcIkFzY2VuZGluZ0RhdGVcIl0gPSBcInNvcnRMZWFzdFJlY2VudFwiO1xuICBTb3J0RGlyZWN0aW9uVG9vbHRpcFtcIkFzY2VuZGluZ051bWJlclwiXSA9IFwic21hbGxUb0xhcmdlXCI7XG4gIFNvcnREaXJlY3Rpb25Ub29sdGlwW1wiRGVzY2VuZGluZ0RhdGVcIl0gPSBcInNvcnRNb3N0UmVjZW50XCI7XG4gIFNvcnREaXJlY3Rpb25Ub29sdGlwW1wiRGVzY2VuZGluZ051bWJlclwiXSA9IFwibGFyZ2VUb1NtYWxsXCI7XG59KShTb3J0RGlyZWN0aW9uVG9vbHRpcCB8fCAoU29ydERpcmVjdGlvblRvb2x0aXAgPSB7fSkpO1xuXG5jb25zdCBhcmNnaXNTeW1ib2xPcmRlckNzcyA9IFwiYXJ0aWNsZXtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2ZsZXgtZGlyZWN0aW9uOnJvdztncmlkLWdhcDowLjVyZW07Z2FwOjAuNXJlbX1hcnRpY2xlIGNhbGNpdGUtYWN0aW9ue21hcmdpbi10b3A6MC43ZW19YXJ0aWNsZSBjYWxjaXRlLWxhYmVse3dpZHRoOjEwMCV9LmluZm9Qb3BvdmVye3dpZHRoOjM0MHB4O2ZvbnQtc2l6ZToxMnB4fS5pbmZvcm1hdGlvbnttYXJnaW46MCAwIDFlbSAwfVwiO1xuXG5jb25zdCBBcmNnaXNTeW1ib2xPcmRlciA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNTeW1ib2xPcmRlckNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU3ltYm9sT3JkZXJDaGFuZ2VcIiwgNyk7XG4gICAgdGhpcy5maWVsZFBpY2tMaXN0Q2hhbmdlcyA9IChldmVudCkgPT4ge1xuICAgICAgdmFyIF9hLCBfYjtcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgY29uc3QgZmllbGROYW1lID0gKF9iID0gKF9hID0gZXZlbnQuZGV0YWlsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2VsZWN0ZWRGaWVsZHMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYlswXTtcbiAgICAgIGlmIChmaWVsZE5hbWUgJiYgZmllbGROYW1lICE9PSB0aGlzLnNlbGVjdGVkRmllbGQubmFtZSkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkRmllbGQgPVxuICAgICAgICAgIGZpZWxkTmFtZSAhPT0gdGhpcy5nZXRSZW5kZXJlckZpZWxkTmFtZSgpXG4gICAgICAgICAgICA/IHRoaXMudG9QaWNrTGlzdEZpZWxkSW5mbyh0aGlzLmZpbmRGaWVsZChmaWVsZE5hbWUpKVxuICAgICAgICAgICAgOiB0aGlzLmdldFJlbmRlcmVyRmllbGRJbmZvKCk7XG4gICAgICB9XG4gICAgICB0aGlzLm9uSGlkZUZpZWxkUGlja0xpc3QoKTtcbiAgICB9O1xuICAgIHRoaXMudmlldyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxheWVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMub3BlbiA9IHRydWU7XG4gICAgdGhpcy5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIHRoaXMuZmllbGRUeXBlcyA9IFtcbiAgICAgIFwiaW50ZWdlclwiLFxuICAgICAgXCJzbWFsbC1pbnRlZ2VyXCIsXG4gICAgICBcImJpZy1pbnRlZ2VyXCIsXG4gICAgICBcInNpbmdsZVwiLFxuICAgICAgXCJkb3VibGVcIixcbiAgICAgIFwibG9uZ1wiLFxuICAgICAgXCJkYXRlXCJcbiAgICBdO1xuICAgIHRoaXMub2JqZWN0SWRGaWVsZE5hbWUgPSBcIm9pZFwiO1xuICAgIHRoaXMuYXNjZW5kaW5nID0gZmFsc2U7XG4gICAgdGhpcy5zZWxlY3RlZEZpZWxkID0gdW5kZWZpbmVkO1xuICB9XG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIExpZmVjeWNsZVxuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBbc3RyaW5nc10gPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgIHRoaXMuc3RyaW5ncyA9IHN0cmluZ3M7XG4gICAgY29uc3QgeyB2aWV3LCBsYXllciwgcGlja0xpc3RGaWVsZHMgfSA9IHRoaXM7XG4gICAgdGhpcy5wcm9wcyA9IHtcbiAgICAgIHZpZXcsXG4gICAgICBsYXllclxuICAgIH07XG4gICAgY29uc3QgZmllbGRzID0gcGlja0xpc3RGaWVsZHMgfHwgdGhpcy5jcmVhdGVQaWNrTGlzdEZpZWxkcygpO1xuICAgIGlmICghdGhpcy5pc1JlbmRlcmVyT3JkZXIoKSkge1xuICAgICAgY29uc3QgeyBvcmRlckJ5IH0gPSBsYXllcjtcbiAgICAgIGNvbnN0IG9yZGVyQnlJbmZvID0gKG9yZGVyQnkgPT09IG51bGwgfHwgb3JkZXJCeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3JkZXJCeS5sZW5ndGgpID8gb3JkZXJCeVswXSA6IG9yZGVyQnk7XG4gICAgICB0aGlzLmFzY2VuZGluZyA9IChvcmRlckJ5SW5mbyA9PT0gbnVsbCB8fCBvcmRlckJ5SW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3JkZXJCeUluZm8ubW9kZSkgPT09IFwiYXNjZW5kaW5nXCI7XG4gICAgICBjb25zdCBvcmRlckJ5RmllbGQgPSAodGhpcy5vcmRlckJ5RmllbGQgPVxuICAgICAgICAob3JkZXJCeUluZm8gPT09IG51bGwgfHwgb3JkZXJCeUluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9yZGVyQnlJbmZvLmZpZWxkKSB8fCAoKF9hID0gdGhpcy5maW5kT0lERmllbGQoZmllbGRzKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm5hbWUpIHx8IGZpZWxkc1swXSk7XG4gICAgICB0aGlzLnNlbGVjdGVkRmllbGQgPSB0aGlzLnRvUGlja0xpc3RGaWVsZEluZm8odGhpcy5maW5kRmllbGQob3JkZXJCeUZpZWxkKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5zZWxlY3RlZEZpZWxkID0gdGhpcy5nZXRSZW5kZXJlckZpZWxkSW5mbygpO1xuICAgIH1cbiAgfVxuICBhc3luYyBjb21wb25lbnREaWRMb2FkKCkge1xuICAgIC8vIG9uY2UgY29tcG9uZW50IGlzIHZpc2libGUgbWFrZSBvdGhlciBjYWxsc1xuICAgIGNvbnN0IFtpbnRsXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvaW50bFwiXSk7XG4gICAgdGhpcy5pbnRsID0gaW50bDtcbiAgICB0aGlzLmludGwuc2V0TG9jYWxlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nKTtcbiAgfVxuICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICB0aGlzLmRlc3Ryb3lGaWVsZHNQaWNrTGlzdCgpO1xuICB9XG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIFB1YmxpYyBNZXRob2RzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIENsZWFucyB1cCBjb21wb25lbnQsIGNsb3NlcyBwb3BvdmVyc1xuICAgKi9cbiAgYXN5bmMgZG9uZSgpIHtcbiAgICB0aGlzLmRpc2FibGVDb250YWluZXIoZmFsc2UpO1xuICAgIHRoaXMuZGVzdHJveUZpZWxkc1BpY2tMaXN0KCk7XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIFJlbmRlciBNZXRob2RzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgc3RyaW5ncywgb3BlbiwgZGlzYWJsZWQgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgY2xhc3M6IENTUy5jb250YWluZXIsIGhlYWRpbmc6IHN0cmluZ3MuaGVhZGluZywgY29sbGFwc2libGU6IHRydWUsIGRpc2FibGVkOiBkaXNhYmxlZCwgb3Blbjogb3BlbiAmJiAhZGlzYWJsZWQgfSwgaChcInBcIiwgeyBjbGFzczogXCJpbmZvcm1hdGlvblwiIH0sIHN0cmluZ3Mub3JkZXJCeVRvb2x0aXApLCBoKFwiYXJ0aWNsZVwiLCBudWxsLCB0aGlzLnJlbmRlckZpZWxkU2VsZWN0aW9uQnV0dG9uKCksIHRoaXMucmVuZGVyU29ydE9yZGVyQWN0aW9uKCkpKSwgaChcImNhbGNpdGUtdG9vbHRpcFwiLCB7IFwicmVmZXJlbmNlLWVsZW1lbnRcIjogXCJzb3J0LWFjdGlvblwiLCBwbGFjZW1lbnQ6IFwiYm90dG9tLXN0YXJ0XCIsIGxhYmVsOiBcIlwiLCByZWY6IChub2RlKSA9PiAodGhpcy50b29sdGlwTm9kZSA9IG5vZGUpIH0sIHRoaXMuZ2V0U29ydERpcmVjdGlvblRvb2x0aXAoKSkpKTtcbiAgfVxuICByZW5kZXJGaWVsZFNlbGVjdGlvbkJ1dHRvbigpIHtcbiAgICBjb25zdCB7IHNlbGVjdGVkRmllbGQsIHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgY29uc3QgZmllbGRzID0gdGhpcy5jcmVhdGVQaWNrTGlzdEZpZWxkcygpO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyBzY2FsZTogXCJzXCIgfSwgc3RyaW5ncy5vcmRlckJ5LCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBrZXk6IFwic2VsZWN0ZWQtZmllbGQtYnV0dG9uXCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCB3aWR0aDogXCJmdWxsXCIsIGFsaWdubWVudDogXCJpY29uLWVuZC1zcGFjZS1iZXR3ZWVuXCIsIHNjYWxlOiBcInNcIiwgZGlzYWJsZWQ6IGZpZWxkcy5sZW5ndGggPD0gMSwgaWNvbkVuZDogXCJjaGV2cm9uLWRvd25cIiwgb25DbGljazogKGUpID0+IHRoaXMub25TaG93RmllbGRQaWNrTGlzdChlKSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZmllbGRTZWxlY3Rpb25Ob2RlID0gbm9kZSkgfSwgKHNlbGVjdGVkRmllbGQgPT09IG51bGwgfHwgc2VsZWN0ZWRGaWVsZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0ZWRGaWVsZC5hbGlhcykgfHwgZmllbGRzWzBdLmFsaWFzKSkpO1xuICB9XG4gIHJlbmRlclNvcnRPcmRlckFjdGlvbigpIHtcbiAgICBjb25zdCB7IHNlbGVjdGVkRmllbGQgfSA9IHRoaXM7XG4gICAgY29uc3QgZGlzYWJsZWQgPSBzZWxlY3RlZEZpZWxkLnR5cGUgPT09IFwib2lkXCIgfHwgc2VsZWN0ZWRGaWVsZC50eXBlID09PSBcInJlbmRlcmVyXCI7XG4gICAgcmV0dXJuIChoKFwic2VjdGlvblwiLCBudWxsLCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBzY2FsZTogXCJzXCIsIGlkOiBcInNvcnQtYWN0aW9uXCIsIGFwcGVhcmFuY2U6IFwidHJhbnNwYXJlbnRcIiwgYWxpZ25tZW50OiBcInN0YXJ0XCIsIGljb246IHRoaXMuZ2V0U29ydERpcmVjdGlvbkljb24oKSwgb25DbGljazogKGUpID0+IHRoaXMub25Ub2dnbGVTb3J0RGlyZWN0aW9uKGUpLCBvbk1vdXNlT3ZlcjogKCkgPT4gdGhpcy5vblNob3dUb29sdGlwKHRydWUpLCBvbk1vdXNlT3V0OiAoKSA9PiB0aGlzLm9uU2hvd1Rvb2x0aXAoZmFsc2UpLCB0ZXh0OiBcIlwiLCBkaXNhYmxlZDogZGlzYWJsZWQgfSkpKTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgRXZlbnQgSGFuZGxlcnNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgb25DaGFuZ2UoKSB7XG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7XG4gICAgY29uc3QgaXNPcmRlckJ5Q2xhc3NlcyA9IHZhbHVlID09PSBcInJlbmRlcmVyXCI7XG4gICAgdGhpcy5sYXllci5vcmRlckJ5ID0gIWlzT3JkZXJCeUNsYXNzZXMgPyB2YWx1ZSA6IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxheWVyLnJlbmRlcmVyLm9yZGVyQnlDbGFzc2VzRW5hYmxlZCA9IGlzT3JkZXJCeUNsYXNzZXMgfHwgdW5kZWZpbmVkO1xuICAgIHRoaXMuYXJjZ2lzU3ltYm9sT3JkZXJDaGFuZ2UuZW1pdCgpO1xuICB9XG4gIGFzeW5jIG9uU2hvd0ZpZWxkUGlja0xpc3QoZSkge1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5kaXNhYmxlQ29udGFpbmVyKHRydWUpO1xuICAgIHRoaXMuY3JlYXRlRmllbGRQaWNrTGlzdCgpO1xuICB9XG4gIGFzeW5jIG9uSGlkZUZpZWxkUGlja0xpc3QoKSB7XG4gICAgdGhpcy5kaXNhYmxlQ29udGFpbmVyKGZhbHNlKTtcbiAgICB0aGlzLmRlc3Ryb3lGaWVsZHNQaWNrTGlzdCgpO1xuICAgIGF3YWl0IHRoaXMuZmllbGRTZWxlY3Rpb25Ob2RlLnNldEZvY3VzKCk7XG4gICAgdGhpcy5vbkNoYW5nZSgpO1xuICB9XG4gIG9uVG9nZ2xlU29ydERpcmVjdGlvbihlKSB7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLmFzY2VuZGluZyA9ICF0aGlzLmFzY2VuZGluZztcbiAgICB0aGlzLm9uQ2hhbmdlKCk7XG4gIH1cbiAgb25TaG93VG9vbHRpcChvcGVuKSB7XG4gICAgdGhpcy50b29sdGlwTm9kZS5vcGVuID0gb3BlbjtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gIC8vXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGNyZWF0ZUZpZWxkUGlja0xpc3QoKSB7XG4gICAgY29uc3QgeyBsYXllciwgcGlja0xpc3RGaWVsZHMsIHZpZXcsIHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgY29uc3QgZmllbGRzID0gcGlja0xpc3RGaWVsZHMgfHwgdGhpcy5jcmVhdGVQaWNrTGlzdEZpZWxkcygpO1xuICAgIGNvbnN0IHJlZkVsZW1lbnQgPSB0aGlzLmZpZWxkU2VsZWN0aW9uTm9kZTtcbiAgICBjb25zdCBwb3BvdmVyUHJvcHMgPSB0aGlzLmNyZWF0ZVBvcG92ZXJQcm9wcyhyZWZFbGVtZW50KTtcbiAgICBjb25zdCBzZWxlY3RlZEZpZWxkID0gdGhpcy5zZWxlY3RlZEZpZWxkIHx8ICh0aGlzLmlzUmVuZGVyZXJPcmRlcigpID8gdGhpcy5nZXRSZW5kZXJlckZpZWxkSW5mbygpIDogZmllbGRzWzBdKTtcbiAgICBjb25zdCBmaWVsZFBpY2tMaXN0ID0gKHRoaXMuZmllbGRQaWNrTGlzdCA9XG4gICAgICBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLWZpZWxkLXBpY2stbGlzdFwiKSk7XG4gICAgZmllbGRQaWNrTGlzdC5oZWFkaW5nID0gc3RyaW5ncy5vcmRlckJ5O1xuICAgIGZpZWxkUGlja0xpc3QubXVsdGlwbGUgPSBmYWxzZTtcbiAgICBmaWVsZFBpY2tMaXN0LnNob3dGaWVsZEluZm8gPSBmYWxzZTtcbiAgICBmaWVsZFBpY2tMaXN0LnNob3dGaWVsZE5hbWUgPSB0cnVlO1xuICAgIGZpZWxkUGlja0xpc3QubWFwVmlldyA9IHZpZXc7XG4gICAgZmllbGRQaWNrTGlzdC5sYXllciA9IGxheWVyO1xuICAgIGZpZWxkUGlja0xpc3QuZmllbGRzID0gZmllbGRzO1xuICAgIGZpZWxkUGlja0xpc3Quc2VsZWN0ZWRGaWVsZHMgPSBbc2VsZWN0ZWRGaWVsZC5uYW1lXTtcbiAgICBmaWVsZFBpY2tMaXN0LnBvcG92ZXJQcm9wcyA9IHBvcG92ZXJQcm9wcztcbiAgICBmaWVsZFBpY2tMaXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNGaWVsZFBpY2tMaXN0RGlzbWlzc2VkXCIsIHRoaXMuZmllbGRQaWNrTGlzdENoYW5nZXMpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZmllbGRQaWNrTGlzdCk7XG4gICAgcmV0dXJuIGZpZWxkUGlja0xpc3Q7XG4gIH1cbiAgZGVzdHJveUZpZWxkc1BpY2tMaXN0KCkge1xuICAgIGlmICh0aGlzLmZpZWxkUGlja0xpc3QpIHtcbiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5maWVsZFBpY2tMaXN0KTtcbiAgICAgIHRoaXMuZmllbGRQaWNrTGlzdCA9IG51bGw7XG4gICAgfVxuICB9XG4gIGNyZWF0ZVBvcG92ZXJQcm9wcyhyZWZFbGVtZW50KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBsYWNlbWVudDogXCJib3R0b20tZW5kXCIsXG4gICAgICBvZmZzZXREaXN0YW5jZTogNSxcbiAgICAgIG9mZnNldFNraWRkaW5nOiAwLFxuICAgICAgcG9pbnRlckRpc2FibGVkOiB0cnVlLFxuICAgICAgcG9wb3ZlcldpZHRoOiB0aGlzLmdldFBvcG92ZXJXaWR0aCgpLFxuICAgICAgcmVmRWxlbWVudDogcmVmRWxlbWVudFxuICAgIH07XG4gIH1cbiAgY3JlYXRlUGlja0xpc3RGaWVsZHMoKSB7XG4gICAgbGV0IHsgcGlja0xpc3RGaWVsZHMgfSA9IHRoaXM7XG4gICAgaWYgKCFwaWNrTGlzdEZpZWxkcykge1xuICAgICAgY29uc3QgeyBsYXllciwgZmllbGRUeXBlcyB9ID0gdGhpcztcbiAgICAgIGNvbnN0IHsgZmllbGRzIH0gPSBsYXllcjtcbiAgICAgIHBpY2tMaXN0RmllbGRzID0gdGhpcy5waWNrTGlzdEZpZWxkcyA9IGZpZWxkc1xuICAgICAgICAuZmlsdGVyKChmaWVsZCkgPT4gZmllbGRUeXBlcy5pbmRleE9mKGZpZWxkID09PSBudWxsIHx8IGZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZC50eXBlKSA+IC0xKVxuICAgICAgICAubWFwKChmaWVsZCkgPT4gdGhpcy50b1BpY2tMaXN0RmllbGRJbmZvKGZpZWxkKSk7XG4gICAgICAvLyBBZGQgb2lkRmllbGQgdG8gdGhlIGxpc3RcbiAgICAgIGNvbnN0IG9iamVjdElkRmllbGRJbmZvID0gdGhpcy50b1BpY2tMaXN0RmllbGRJbmZvKHRoaXMuZ2V0T0lERmllbGQoKSk7XG4gICAgICBwaWNrTGlzdEZpZWxkcy51bnNoaWZ0KG9iamVjdElkRmllbGRJbmZvKTtcbiAgICAgIC8vIEFkZCBzb3J0QnlTdHlsZXMgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgdGhlIGxpc3RcbiAgICAgIGlmICh0aGlzLmhhc1R5cGVzT3JQcmVkb21pbmFuY2VSZW5kZXJlcigpKSB7XG4gICAgICAgIGNvbnN0IHNvcnRSZW5kZXJlckZpZWxkSW5mbyA9IHRoaXMuZ2V0UmVuZGVyZXJGaWVsZEluZm8oKTtcbiAgICAgICAgcGlja0xpc3RGaWVsZHMudW5zaGlmdChzb3J0UmVuZGVyZXJGaWVsZEluZm8pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcGlja0xpc3RGaWVsZHM7XG4gIH1cbiAgdG9QaWNrTGlzdEZpZWxkSW5mbyhmaWVsZCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBmaWVsZC5uYW1lLFxuICAgICAgYWxpYXM6IHRoaXMuZ2V0RmllbGRBbGlhcyhmaWVsZCksXG4gICAgICB0eXBlOiBmaWVsZC50eXBlXG4gICAgfTtcbiAgfVxuICBnZXRQb3BvdmVyV2lkdGgoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IGJ1ZmZlciA9IDMwO1xuICAgIGNvbnN0IG5vZGVXaWR0aCA9IChfYSA9IHRoaXMuaG9zdEVsZW1lbnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgICByZXR1cm4gbm9kZVdpZHRoICsgYnVmZmVyIHx8IDI4MDtcbiAgfVxuICBnZXRGaWVsZEFsaWFzKGZpZWxkKSB7XG4gICAgY29uc3QgeyBzdHJpbmdzIH0gPSB0aGlzO1xuICAgIGlmIChmaWVsZC50eXBlID09PSBcIm9pZFwiKSB7XG4gICAgICByZXR1cm4gc3RyaW5ncy5kZWZhdWx0RGF0YU9yZGVyO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IHRoaXMuZmluZEZpZWxkSW5mb0Zyb21Qb3B1cChmaWVsZCk7XG4gICAgICByZXR1cm4gKGZpZWxkSW5mbyA9PT0gbnVsbCB8fCBmaWVsZEluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkSW5mby5sYWJlbCkgfHwgZmllbGQuYWxpYXMgfHwgZmllbGQubmFtZTtcbiAgICB9XG4gIH1cbiAgZmluZEZpZWxkSW5mb0Zyb21Qb3B1cChmaWVsZCkge1xuICAgIGNvbnN0IHsgcG9wdXBUZW1wbGF0ZSB9ID0gdGhpcy5sYXllcjtcbiAgICBjb25zdCBmaWVsZEluZm9zID0gcG9wdXBUZW1wbGF0ZSA9PT0gbnVsbCB8fCBwb3B1cFRlbXBsYXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3B1cFRlbXBsYXRlLmZpZWxkSW5mb3M7XG4gICAgcmV0dXJuIChmaWVsZEluZm9zIHx8IFtdKS5maW5kKChmaWVsZEluZm8pID0+IGZpZWxkSW5mby5maWVsZE5hbWUgPT09IGZpZWxkLm5hbWUpO1xuICB9XG4gIGdldE9JREZpZWxkKCkge1xuICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBmaWVsZHMgfSA9IGxheWVyO1xuICAgIHJldHVybiBmaWVsZHMuZmluZCgoZmllbGQpID0+IGZpZWxkLm5hbWUgPT09IGxheWVyLm9iamVjdElkRmllbGQgfHwgZmllbGQudHlwZSA9PT0gXCJvaWRcIik7XG4gIH1cbiAgZmluZE9JREZpZWxkKGZpZWxkSW5mb3MpIHtcbiAgICBjb25zdCB7IGxheWVyIH0gPSB0aGlzO1xuICAgIHJldHVybiBmaWVsZEluZm9zLmZpbmQoKGZpZWxkKSA9PiBmaWVsZC5uYW1lID09PSBsYXllci5vYmplY3RJZEZpZWxkIHx8IGZpZWxkLnR5cGUgPT09IFwib2lkXCIpO1xuICB9XG4gIGZpbmRGaWVsZChuYW1lKSB7XG4gICAgY29uc3QgeyBsYXllciB9ID0gdGhpcztcbiAgICBjb25zdCB7IGZpZWxkcyB9ID0gbGF5ZXI7XG4gICAgY29uc3QgZmllbGQgPSBmaWVsZHMuZmluZCgoZmllbGQpID0+IGZpZWxkLm5hbWUgPT09IG5hbWUpO1xuICAgIHJldHVybiBmaWVsZCB8fCBmaWVsZHNbMF07XG4gIH1cbiAgZ2V0U29ydERpcmVjdGlvbkljb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuYXNjZW5kaW5nID8gU29ydERpcmVjdGlvbkljb24uQXNjZW5kaW5nIDogU29ydERpcmVjdGlvbkljb24uRGVzY2VuZGluZztcbiAgfVxuICBnZXRTb3J0RGlyZWN0aW9uVG9vbHRpcCgpIHtcbiAgICBjb25zdCB7IGFzY2VuZGluZywgc2VsZWN0ZWRGaWVsZCwgc3RyaW5ncyB9ID0gdGhpcztcbiAgICBjb25zdCBzZWxlY3RlZEZlbGRUeXBlID0gc2VsZWN0ZWRGaWVsZCA9PT0gbnVsbCB8fCBzZWxlY3RlZEZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZEZpZWxkLnR5cGU7XG4gICAgbGV0IHN0cmluZ0tleSA9IFwic29ydExlYXN0UmVjZW50XCI7XG4gICAgaWYgKHNlbGVjdGVkRmVsZFR5cGUgPT09IFwiZGF0ZVwiKSB7XG4gICAgICBzdHJpbmdLZXkgPSBhc2NlbmRpbmdcbiAgICAgICAgPyBTb3J0RGlyZWN0aW9uVG9vbHRpcC5Bc2NlbmRpbmdEYXRlXG4gICAgICAgIDogU29ydERpcmVjdGlvblRvb2x0aXAuRGVzY2VuZGluZ0RhdGU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgc3RyaW5nS2V5ID0gYXNjZW5kaW5nXG4gICAgICAgID8gU29ydERpcmVjdGlvblRvb2x0aXAuQXNjZW5kaW5nTnVtYmVyXG4gICAgICAgIDogU29ydERpcmVjdGlvblRvb2x0aXAuRGVzY2VuZGluZ051bWJlcjtcbiAgICB9XG4gICAgcmV0dXJuIHN0cmluZ3Nbc3RyaW5nS2V5XTtcbiAgfVxuICBoYXNUeXBlc09yUHJlZG9taW5hbmNlUmVuZGVyZXIoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCB7IGxheWVyIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgcmVuZGVyZXIgfSA9IGxheWVyO1xuICAgIHJldHVybiAoKHJlbmRlcmVyID09PSBudWxsIHx8IHJlbmRlcmVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZW5kZXJlci50eXBlKSA9PT0gXCJ1bmlxdWUtdmFsdWVcIiAmJlxuICAgICAgKCEoKF9hID0gcmVuZGVyZXIgPT09IG51bGwgfHwgcmVuZGVyZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlbmRlcmVyLmF1dGhvcmluZ0luZm8pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSB8fCAoKF9iID0gcmVuZGVyZXIgPT09IG51bGwgfHwgcmVuZGVyZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlbmRlcmVyLmF1dGhvcmluZ0luZm8pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50eXBlKSA9PT0gXCJwcmVkb21pbmFuY2VcIikpO1xuICB9XG4gIGlzUmVuZGVyZXJPcmRlcigpIHtcbiAgICBjb25zdCB7IGxheWVyIH0gPSB0aGlzO1xuICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgcmV0dXJuIHRoaXMuaGFzVHlwZXNPclByZWRvbWluYW5jZVJlbmRlcmVyKCkgJiYgKHJlbmRlcmVyID09PSBudWxsIHx8IHJlbmRlcmVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZW5kZXJlci5vcmRlckJ5Q2xhc3Nlc0VuYWJsZWQpID09PSB0cnVlO1xuICB9XG4gIGdldFJlbmRlcmVyRmllbGROYW1lKCkge1xuICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHRoaXM7XG4gICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICByZXR1cm4gKCh0aGlzLmhhc1R5cGVzT3JQcmVkb21pbmFuY2VSZW5kZXJlcigpICYmXG4gICAgICAocmVuZGVyZXIuZmllbGQgfHwgcmVuZGVyZXIudmFsdWVFeHByZXNzaW9uVGl0bGUpKSB8fFxuICAgICAgbnVsbCk7XG4gIH1cbiAgZ2V0UmVuZGVyZXJGaWVsZEluZm8oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHRoaXMuZ2V0UmVuZGVyZXJGaWVsZE5hbWUoKSxcbiAgICAgIGFsaWFzOiB0aGlzLnN0cmluZ3Muc3R5bGVPcmRlcixcbiAgICAgIHR5cGU6IFwicmVuZGVyZXJcIlxuICAgIH07XG4gIH1cbiAgZGlzYWJsZUNvbnRhaW5lcihkaXNhYmxlKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5ob3N0RWxlbWVudC5jbG9zZXN0KFwiY2FsY2l0ZS1mbG93LWl0ZW1cIik7XG4gICAgaWYgKGNvbnRhaW5lcikge1xuICAgICAgY29udGFpbmVyLmRpc2FibGVkID0gZGlzYWJsZTtcbiAgICB9XG4gIH1cbiAgZ2V0VmFsdWUoKSB7XG4gICAgY29uc3QgeyBzZWxlY3RlZEZpZWxkIH0gPSB0aGlzO1xuICAgIGlmIChzZWxlY3RlZEZpZWxkLnR5cGUgPT09IFwib2lkXCIpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBlbHNlIGlmIChzZWxlY3RlZEZpZWxkLnR5cGUgPT09IFwicmVuZGVyZXJcIikge1xuICAgICAgcmV0dXJuIFwicmVuZGVyZXJcIjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICB7XG4gICAgICAgICAgb3JkZXI6IHRoaXMuYXNjZW5kaW5nID8gXCJhc2NlbmRpbmdcIiA6IFwiZGVzY2VuZGluZ1wiLFxuICAgICAgICAgIGZpZWxkOiB0aGlzLnNlbGVjdGVkRmllbGQubmFtZVxuICAgICAgICB9XG4gICAgICBdO1xuICAgIH1cbiAgfVxuICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU3ltYm9sT3JkZXIuc3R5bGUgPSBhcmNnaXNTeW1ib2xPcmRlckNzcztcblxuZXhwb3J0IHsgQXJjZ2lzU3ltYm9sT3JkZXIgYXMgYXJjZ2lzX3N5bWJvbF9vcmRlciB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1hYWYzMGJkNi5qcyc7XG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTEzZjViMDBjLmpzJztcblxuY29uc3QgbGFuZ3VhZ2VNYXAgPSBuZXcgTWFwKFtcbiAgW1wiYXJcIiwgXCJhclwiXSxcbiAgW1wiYmdcIiwgXCJiZ1wiXSxcbiAgW1wiYnNcIiwgXCJic1wiXSxcbiAgW1wiY2FcIiwgXCJjYVwiXSxcbiAgW1wiY3NcIiwgXCJjc1wiXSxcbiAgW1wiZGFcIiwgXCJkYVwiXSxcbiAgW1wiZGVcIiwgXCJkZVwiXSxcbiAgW1wiZWxcIiwgXCJlbFwiXSxcbiAgW1wiZW5cIiwgXCJlblwiXSxcbiAgW1wiZXNcIiwgXCJlc1wiXSxcbiAgW1wiZXRcIiwgXCJldFwiXSxcbiAgW1wiZmlcIiwgXCJmaVwiXSxcbiAgW1wiZnJcIiwgXCJmclwiXSxcbiAgW1wiaGVcIiwgXCJoZVwiXSxcbiAgW1wiaHJcIiwgXCJoclwiXSxcbiAgW1wiaHVcIiwgXCJodVwiXSxcbiAgW1wiaWRcIiwgXCJpZFwiXSxcbiAgW1wiaXRcIiwgXCJpdFwiXSxcbiAgW1wiamFcIiwgXCJqYVwiXSxcbiAgW1wia29cIiwgXCJrb1wiXSxcbiAgW1wibHRcIiwgXCJsdFwiXSxcbiAgW1wibHZcIiwgXCJsdlwiXSxcbiAgW1wibmJcIiwgXCJuYlwiXSxcbiAgW1wibmxcIiwgXCJubFwiXSxcbiAgW1wicGxcIiwgXCJwbFwiXSxcbiAgW1wicHQtYnJcIiwgXCJwdC1CUlwiXSxcbiAgW1wicHQtcHRcIiwgXCJwdC1QVFwiXSxcbiAgW1wicm9cIiwgXCJyb1wiXSxcbiAgW1wicnVcIiwgXCJydVwiXSxcbiAgW1wic2tcIiwgXCJza1wiXSxcbiAgW1wic2xcIiwgXCJzbFwiXSxcbiAgW1wic3JcIiwgXCJzclwiXSxcbiAgW1wic3ZcIiwgXCJzdlwiXSxcbiAgW1widGhcIiwgXCJ0aFwiXSxcbiAgW1widHJcIiwgXCJ0clwiXSxcbiAgW1widWtcIiwgXCJ1a1wiXSxcbiAgW1widmlcIiwgXCJ2aVwiXSxcbiAgW1wiemgtY25cIiwgXCJ6aC1DTlwiXSxcbiAgW1wiemgtaGtcIiwgXCJ6aC1IS1wiXSxcbiAgW1wiemgtdHdcIiwgXCJ6aC1UV1wiXVxuXSk7XG4vLyBydGxcbmZ1bmN0aW9uIGdldEVsZW1lbnREaXIoZWwpIHtcbiAgcmV0dXJuIGdldEVsZW1lbnRQcm9wKGVsLCBcImRpclwiLCBcImx0clwiKTtcbn1cbmZ1bmN0aW9uIGdldEVsZW1lbnRQcm9wKGVsLCBwcm9wLCB2YWx1ZSkge1xuICBjb25zdCBjbG9zZXN0V2l0aFByb3AgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWwsIGBbJHtwcm9wfV1gKTtcbiAgcmV0dXJuIGNsb3Nlc3RXaXRoUHJvcCA/IGNsb3Nlc3RXaXRoUHJvcC5nZXRBdHRyaWJ1dGUocHJvcCkgOiB2YWx1ZTtcbn1cbi8vIGNzc1xuY29uc3QgQ1NTX1VUSUxJVFkgPSB7XG4gIHJ0bDogXCJhcmNnaXMtLXJ0bFwiXG59O1xuYXN5bmMgZnVuY3Rpb24gZm9ybWF0TnVtYmVyKG51bWJlciwgb3B0aW9ucykge1xuICBjb25zdCB7IGFwaSwgdHlwZSwgcGxhY2VzIH0gPSBvcHRpb25zIHx8IHt9O1xuICBpZiAoYXBpID09PSA0KSB7XG4gICAgY29uc3QgW2ludGxdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9pbnRsXCJdKTtcbiAgICBjb25zdCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyA9IGludGwuY29udmVydE51bWJlckZvcm1hdFRvSW50bE9wdGlvbnMoe1xuICAgICAgcGxhY2VzLFxuICAgICAgc3R5bGU6IHR5cGUsXG4gICAgICBkaWdpdFNlcGFyYXRvcjogdHJ1ZVxuICAgIH0pO1xuICAgIHJldHVybiBpbnRsLmZvcm1hdE51bWJlcihudW1iZXIsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMpLCB7IHN0eWxlOiB0eXBlIH0pKTtcbiAgfVxuICBjb25zdCBbZG9qb051bWJlcl0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJkb2pvL251bWJlclwiXSk7XG4gIHJldHVybiBkb2pvTnVtYmVyLmZvcm1hdChudW1iZXIsIHtcbiAgICB0eXBlLFxuICAgIHBsYWNlcyxcbiAgICBwYXR0ZXJuOiBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMucGF0dGVyblxuICB9KTtcbn1cbmNvbnN0IGNhY2hlID0ge307XG5mdW5jdGlvbiBmb3JtYXREYXRlKGRhdGUpIHtcbiAgY29uc3QgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nO1xuICBjb25zdCBkYXlTaG9ydE1vbnRoWWVhciA9IHtcbiAgICB5ZWFyOiBcIm51bWVyaWNcIixcbiAgICBtb250aDogXCJzaG9ydFwiLFxuICAgIGRheTogXCJudW1lcmljXCJcbiAgfTtcbiAgaWYgKCFjYWNoZVtsYW5nXSkge1xuICAgIGNhY2hlW2xhbmddID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmxhbmcsIGRheVNob3J0TW9udGhZZWFyKTtcbiAgfVxuICByZXR1cm4gY2FjaGVbbGFuZ10uZm9ybWF0KGRhdGUpO1xufVxuXG5leHBvcnQgeyBDU1NfVVRJTElUWSBhcyBDLCBmb3JtYXREYXRlIGFzIGEsIGZvcm1hdE51bWJlciBhcyBmLCBnZXRFbGVtZW50RGlyIGFzIGcsIGxhbmd1YWdlTWFwIGFzIGwgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgeyBsIGFzIGxhbmd1YWdlTWFwIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtMjIyNThjOTAuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRBc3NldFBhdGggfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcblxuLy8gaHR0cHM6Ly9tZWRpdW0uY29tL3N0ZW5jaWwtdHJpY2tzL2ltcGxlbWVudGluZy1pbnRlcm5hdGlvbmFsaXNhdGlvbi1pMThuLXdpdGgtc3RlbmNpbC01ZTY1NTk1NTQxMTdcbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KSB7XG4gIHZhciBfYSwgX2IsIF9jO1xuICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICB9XG4gIGVsc2Uge1xuICAgIC8vIFwicnUtUlVcIiBtYXBzIHRvIFwicnVcIiB1c2UgY2FzZVxuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZy5zbGljZSgwLCAyKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCkge1xuICB2YXIgX2EsIF9iLCBfYztcbiAgLy8gaXQncyBPSyBpZiB3ZSBkb24ndCBoYXZlIHRoZSA0IGxldHRlciBsYW5ndWFnZSBmaWxlIGZvciBpdFxuICAvLyA0IGxldHRlciBsYW5ndWFnZSBjb2RlIG5lZWRlZCBmb3IgZm9ybWF0dGluZyBudW1iZXJzXG4gIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgLy8gd2Ugc3VwcG9ydCB0aGUgMiBsZXR0ZXIgY29kZWQgbGFuZ3VhZ2VcbiAgICAgIC8vIGUuZy4gaXQtQ0ggdnMgaXRcbiAgICAgIHJldHVybiBsYW5nO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBcImVuXCI7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgZmV0Y2goZ2V0QXNzZXRQYXRoKGAuLi9hcmNnaXMtYXBwLWFzc2V0cy9pMThuLyR7Y29tcG9uZW50TmFtZX0uaTE4bi4ke2xvY2FsZX0uanNvbmApKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgIGlmIChyZXN1bHQub2spXG4gICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XG4gICAgICBlbHNlXG4gICAgICAgIHJlamVjdCgpO1xuICAgIH0sICgpID0+IHJlamVjdCgpKTtcbiAgfSk7XG59XG5jb25zdCBzdHJpbmdDYWNoZSA9IHt9O1xuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICBjb25zdCBpZCA9IGAke2NvbXBvbmVudE5hbWV9JHtsb2NhbGV9YDtcbiAgaWYgKCFzdHJpbmdDYWNoZVtpZF0pIHtcbiAgICBzdHJpbmdDYWNoZVtpZF0gPSBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKTtcbiAgfVxuICByZXR1cm4gc3RyaW5nQ2FjaGVbaWRdO1xufVxuLyoqXG4gKiBHZXQgc3RyaW5ncyBhbmQgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGlzIG1ldGhvZCByZXR1cm5zIDIgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGUgZmlyc3Qgb25lIHJldHVybnMgYSBjb2RlIHRoYXQncyBhbHNvIHN1cHBvcnRlZCBhcyBhIGxhbmd1YWdlIGZpbGUuXG4gKiBUaGUgc2Vjb25kIG9uZSByZXR1cm5zIGEgY29kZSB3aGVyZSB0aGVyZSBpcyBzdXBwb3J0IGZvciB0aGUgZmlyc3QgMiBsZXR0ZXJzIG9mIHRoZSBjb2RlIGFzIHBhcnQgb2YgYSBsYW5ndWFnZSBmaWxlLFxuICogYnV0IHdpbGwgcmV0dXJuIHRoZSBvcmlnaW5hbCA0IGxldHRlciBjb2RlIGZyb20gdGhlIHBhZ2UuXG4gKiBFLmcuIEZvciBcIml0LWNoXCIgaXQgd2lsbCByZXR1cm4gXCJpdFwiIGFzIHRoZSBmaXJzdCBsYW5ndWFnZSBjb2RlIGFuZCBcIml0LWNoXCIgYXMgdGhlIHNlY29uZC5cbiAqIFRoZSBzZWNvbmQgb25lIGlzIHJlcXVpcmVkIGZvciBlc3JpLmludGwuc2V0TG9jYWxlKCkgdG8gZ2V0IHRoZSBjb3JyZWN0IGZvcm1hdHRpbmcuXG4gKlxuICogSWYgYSB0YWdOYW1lIGlzIHByb3ZpZGVkIGl0IHdpbGwgb3ZlcndpdGUgdGhlIGVsZW1lbnQncyB0YWdOYW1lXG4gKlxuICogIEByZXR1cm4gWyBzdHJpbmdzLCBmaXJzdCBsYW5ndWFnZSBjb2RlLCBzZWNvbmQgbGFuZ3VhZ2UgY29kZV1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyhlbGVtZW50LCB0YWdOYW1lKSB7XG4gIGNvbnN0IGNvbXBvbmVudE5hbWUgPSB0YWdOYW1lIHx8IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCBjb21wb25lbnRMYW5ndWFnZSA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KTtcbiAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2VJbnRsID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KTtcbiAgbGV0IHN0cmluZ3M7XG4gIHRyeSB7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBjb21wb25lbnRMYW5ndWFnZSk7XG4gIH1cbiAgY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLndhcm4oYG5vIGxvY2FsZSBmb3IgJHtjb21wb25lbnROYW1lfSAoJHtjb21wb25lbnRMYW5ndWFnZX0pIGxvYWRpbmcgZGVmYXVsdCBsb2NhbGUgZW4uYCk7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBcImVuXCIpO1xuICB9XG4gIHJldHVybiBbc3RyaW5ncywgY29tcG9uZW50TGFuZ3VhZ2UsIGNvbXBvbmVudExhbmd1YWdlSW50bF07XG59XG5cbmV4cG9ydCB7IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZSBhcyBhLCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIGFzIGcgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==