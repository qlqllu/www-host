"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-90abf8"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-publish-item-pages-item-properties.entry.js":
/*!********************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-publish-item-pages-item-properties.entry.js ***!
  \********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_publish_item_pages_item_properties: () => (/* binding */ ArcgisPublishItemPagesItemProperties)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./user-e3dedc4a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./item-properties-e6412a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js");
/* harmony import */ var _image_collection_a67002cc_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./image-collection-a67002cc.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/image-collection-a67002cc.js");
/* harmony import */ var _publish_item_82ffa7f8_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./publish-item-82ffa7f8.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/publish-item-82ffa7f8.js");
/* harmony import */ var _server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./server-item-f12153e6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js");
/* harmony import */ var _utils_86ac6961_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./utils-86ac6961.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-86ac6961.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/* harmony import */ var _store_3210b604_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./store-3210b604.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-3210b604.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _store_2d217af2_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./store-2d217af2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-2d217af2.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./guid-4f4176ba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js");
/* harmony import */ var _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./feature-layer-38cdae87.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-38cdae87.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _feature_layer_d33ea114_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./feature-layer-d33ea114.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-d33ea114.js");
/* harmony import */ var _thumbnail_0b7adfcd_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./thumbnail-0b7adfcd.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-0b7adfcd.js");
/* harmony import */ var _query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./query-4f7b7e4d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-4f7b7e4d.js");
/* harmony import */ var _api_f7934cd7_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./api-f7934cd7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-f7934cd7.js");
/* harmony import */ var _item_d9d70416_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./item-d9d70416.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-d9d70416.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _feature_layer_69305a85_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./feature-layer-69305a85.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-69305a85.js");
/* harmony import */ var _functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./functional-9f648bee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-9f648bee.js");
/* harmony import */ var _ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./ags-68d4ae20.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-68d4ae20.js");
/* harmony import */ var _url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./url-f3b82cc7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-f3b82cc7.js");
/* harmony import */ var _storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./storage-d7f5822e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js");
/* harmony import */ var _file_f36193e9_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./file-f36193e9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-f36193e9.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _tile_layer_90a6b901_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./tile-layer-90a6b901.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-90a6b901.js");
/* harmony import */ var _geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./geocode-7eb7c0df.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-7eb7c0df.js");
/* harmony import */ var _privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./privileges-35590eb4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-35590eb4.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




































const arcgisPublishItemPagesItemPropertiesCss = ".layer-description.sc-arcgis-publish-item-pages-item-properties{display:block;margin-bottom:0.75rem}.locator__heading.sc-arcgis-publish-item-pages-item-properties{font-weight:500;font-size:0.875rem;color:var(--calcite-ui-text-1);line-height:18px;margin-bottom:2px}.locator__description.sc-arcgis-publish-item-pages-item-properties{font-size:0.875rem;color:var(--calcite-ui-text-1);margin:0;margin-bottom:1rem;padding:0}.medium.sc-arcgis-publish-item-pages-item-properties{--arcgis-label-font-weight:500}.info-container.sc-arcgis-publish-item-pages-item-properties{margin-bottom:1.5rem}";

var __asyncValues = ( false) || function (o) {
  if (!Symbol.asyncIterator)
    throw new TypeError("Symbol.asyncIterator is not defined.");
  var m = o[Symbol.asyncIterator], i;
  return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i);
  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }
  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function (v) { resolve({ value: v, done: d }); }, reject); }
};
const MAX_TITLE_LENGTH = 250;
const ArcgisPublishItemPagesItemProperties = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.workflowCancel = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowCancel", 7);
    this.workflowComplete = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
    this.newItemToggleNavigationEnabled = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
    this.arcgisWorkflowUpdateError = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisWorkflowUpdateError", 7);
    this.workflowCancelled = false;
    this.handleRequest = async () => {
      const { categories, title } = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i;
      // Don't send request if an error is reported
      if (!(await this.validate())) {
        this.arcgisWorkflowUpdateError.emit(this.errorMessage);
        return;
      }
      if ((title === null || title === void 0 ? void 0 : title.length) > MAX_TITLE_LENGTH) {
        this.titleRef.title = title.substring(0, MAX_TITLE_LENGTH);
      }
      try {
        // TODO: Repair telemetry
        // Telemetry: Begin upload tracking workflow
        // logAddNewItemStart();
        const { publishResponse } = await this.publishItem();
        categories && (await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_6__.u)(this.portal, [publishResponse.id], categories));
        if (!this.workflowCancelled) {
          // Telemetry: Only log telemetry after successful upload
          // logItemPropertiesChanges();
          // logSuccessfulItemCreation();
          // configState.telemetry && (await timeout(750));
          const emitPayload = Object.assign({}, publishResponse);
          // Current publish dialog expects this as the payload:
          // const { id, response, jobId, serviceType, item, newItemMode } = e.detail;
          // TODO: Remove new-item specific properties
          this.workflowComplete.emit(emitPayload);
        }
        else {
          (publishResponse === null || publishResponse === void 0 ? void 0 : publishResponse.id) && (await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_6__.d)(publishResponse.id));
          this.workflowCancel.emit();
        }
        (0,_utils_86ac6961_js__WEBPACK_IMPORTED_MODULE_7__.r)();
      }
      catch (error) {
        console.error(error);
        this.errorMessage = this.parseError(error.code);
        this.arcgisWorkflowUpdateError.emit(this.errorMessage);
        this.showLoader(false);
      }
    };
    this.item = undefined;
    this.portal = undefined;
    this.user = undefined;
    this.errorMessage = undefined;
    this.loading = false;
    this.loaderType = "indeterminate";
    this.loaderMessage = undefined;
  }
  /**
   * Checks each field, short-circuiting on the first one to fail. Populates this.errorMessage internally
   */
  async validate() {
    var _a, _b, _c;
    const titleError = await ((_a = this.titleRef) === null || _a === void 0 ? void 0 : _a.validateTitle());
    if (titleError) {
      this.errorMessage = {
        title: _store_2d217af2_js__WEBPACK_IMPORTED_MODULE_11__.p.i18n.error.title,
        description: titleError.translatedMessage
      };
      this.titleRef.focusMainInput();
      return false;
    }
    // TODO: connect folder component to error structure
    // Also, updating the new title in a folder picker doesn't emit an itemProperties change event,
    // so the error doesn't clear unless the folder is actually changed
    const folderResponse = await ((_b = this.itemPropertiesFolderRef) === null || _b === void 0 ? void 0 : _b.saveActiveFolder());
    if (!!folderResponse) {
      if (typeof folderResponse === "boolean" && !folderResponse) {
        return false;
      }
      else if (typeof folderResponse === "string") {
        this.errorMessage = {
          title: _store_2d217af2_js__WEBPACK_IMPORTED_MODULE_11__.p.i18n.error.title,
          description: folderResponse
        };
        return false;
      }
    }
    const summaryError = await ((_c = this.summaryRef) === null || _c === void 0 ? void 0 : _c.getErrorMessage());
    if (summaryError) {
      this.errorMessage = {
        title: _store_2d217af2_js__WEBPACK_IMPORTED_MODULE_11__.p.i18n.error.title,
        description: summaryError.translatedMessage
      };
      return false;
    }
    return true;
  }
  async navigateToNextPage() {
    this.handleRequest();
  }
  async componentWillLoad() {
    var _a, _b;
    // Grab common workflow state
    _store_2d217af2_js__WEBPACK_IMPORTED_MODULE_11__.p.i18n = _store_2d217af2_js__WEBPACK_IMPORTED_MODULE_11__.p.i18n;
    // Grab publishItem workflow state
    (_a = this.portal) !== null && _a !== void 0 ? _a : (this.portal = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.portal);
    (_b = this.user) !== null && _b !== void 0 ? _b : (this.user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c.user);
    if (!this.item) {
      console.error("No item found");
      // TODO: create error message
      this.arcgisWorkflowUpdateError.emit(this.errorMessage);
      return;
    }
    // TODO: check if this should grab the item owner instead of current user
    this.folder = await (0,_user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_1__.d)(this.item.ownerFolder, this.user);
  }
  async publishItem() {
    const { id, type } = this.item;
    const addResponse = { success: true, id, folder: null };
    const publishResponse = type === "Image Collection"
      ? await this.publishImageCollection(addResponse)
      : await this.publishService(id);
    await (0,_publish_item_82ffa7f8_js__WEBPACK_IMPORTED_MODULE_5__.a)(publishResponse, this.user);
    return { addResponse, publishResponse };
  }
  async publishService(id) {
    var _a;
    const { type } = this.item;
    const extension = _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_8__.a[type].fileExt[0];
    this.showLoader(true, {
      loaderType: "indeterminate",
      loaderMessage: _store_2d217af2_js__WEBPACK_IMPORTED_MODULE_11__.p.i18n.publishingService
    });
    const { result: publishResponse, error } = await (0,_publish_item_82ffa7f8_js__WEBPACK_IMPORTED_MODULE_5__.p)({
      itemId: id,
      user: this.user,
      title: _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.title,
      extension,
      type
    });
    if (error) {
      console.error("there was an error", error);
    }
    else {
      const service = (_a = publishResponse.services) === null || _a === void 0 ? void 0 : _a[0];
      return {
        success: true,
        id: service === null || service === void 0 ? void 0 : service.serviceItemId,
        jobId: service === null || service === void 0 ? void 0 : service.jobId,
        serviceType: service === null || service === void 0 ? void 0 : service.type,
        serviceUrl: service === null || service === void 0 ? void 0 : service.serviceurl
      };
    }
  }
  async publishImageCollection(addItemResponse) {
    var _a, e_1, _b, _c;
    const { config, user, portal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
    this.showLoader(true, {
      loaderType: "indeterminate",
      loaderMessage: _store_2d217af2_js__WEBPACK_IMPORTED_MODULE_11__.p.i18n.publishingService
    });
    const imageCollectionGenerator = (0,_image_collection_a67002cc_js__WEBPACK_IMPORTED_MODULE_4__.c)(addItemResponse, _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_3__.i.title, { config, user, portal });
    try {
      for (var _d = true, imageCollectionGenerator_1 = __asyncValues(imageCollectionGenerator), imageCollectionGenerator_1_1; imageCollectionGenerator_1_1 = await imageCollectionGenerator_1.next(), _a = imageCollectionGenerator_1_1.done, !_a;) {
        _c = imageCollectionGenerator_1_1.value;
        _d = false;
        try {
          const status = _c;
          if (typeof status === "string") {
            this.updateLoader("indeterminate", _store_2d217af2_js__WEBPACK_IMPORTED_MODULE_11__.p.i18n[status]);
          }
          else {
            return {
              success: true,
              id: status.serviceItemId,
              jobId: null,
              serviceType: status.type,
              serviceUrl: status.serviceurl
            };
          }
        }
        finally {
          _d = true;
        }
      }
    }
    catch (e_1_1) {
      e_1 = { error: e_1_1 };
    }
    finally {
      try {
        if (!_d && !_a && (_b = imageCollectionGenerator_1.return))
          await _b.call(imageCollectionGenerator_1);
      }
      finally {
        if (e_1)
          throw e_1.error;
      }
    }
  }
  showLoader(show, update) {
    if (update) {
      this.updateLoader(update.loaderType, update.loaderMessage);
    }
    if (show) {
      this.newItemToggleNavigationEnabled.emit(false);
      this.loading = true;
    }
    else {
      this.newItemToggleNavigationEnabled.emit(true);
      this.loading = false;
    }
  }
  updateLoader(loaderType, loaderMessage) {
    this.loaderType = loaderType;
    this.loaderMessage = loaderMessage;
  }
  parseError(code) {
    var _a, _b, _c, _d;
    const { i18n } = _store_2d217af2_js__WEBPACK_IMPORTED_MODULE_11__.p;
    return {
      title: (_b = (_a = i18n.error[code]) === null || _a === void 0 ? void 0 : _a.title) !== null && _b !== void 0 ? _b : "no error code title",
      description: (_d = (_c = i18n.error[code]) === null || _c === void 0 ? void 0 : _c.description) !== null && _d !== void 0 ? _d : "no error code description"
    };
  }
  render() {
    if (!this.item) {
      return;
    }
    const { type } = this.item;
    const { user } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_2__.c;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: this.loaderType, value: _store_3210b604_js__WEBPACK_IMPORTED_MODULE_9__.w.uploadProgress, active: this.loading, text: this.loaderMessage }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-properties", {
      // Clear errors on any modification
      onArcgisItemPropertiesChange: () => this.arcgisWorkflowUpdateError.emit(null)
    }, type !== "Service Definition" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-title-input", { itemTitle: this.item.title, class: "medium", currentFolder: this.item.ownerFolder, type: type, enablePublishing: true, ref: (ele) => {
        this.titleRef = ele;
      } })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-folder-picker", { class: "medium", ref: (ele) => (this.itemPropertiesFolderRef = ele), folder: this.folder }), !(0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_10__.n)(user) && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-categories-picker", { class: "medium" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-tags-picker", { class: "medium" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-summary-input", { class: "medium", ref: (ele) => (this.summaryRef = ele) }))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisPublishItemPagesItemProperties.style = arcgisPublishItemPagesItemPropertiesCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/image-collection-a67002cc.js":
/*!**********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/image-collection-a67002cc.js ***!
  \**********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ createImageCollection)
/* harmony export */ });
/* harmony import */ var _guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./guid-4f4176ba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js");
/* harmony import */ var _server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./server-item-f12153e6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js");
/* harmony import */ var _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./feature-layer-38cdae87.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-38cdae87.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */





var __await = ( false) || function (v) { return this instanceof __await ? (this.v = v, this) : new __await(v); };
var __asyncGenerator = ( false) || function (thisArg, _arguments, generator) {
  if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
  var g = generator.apply(thisArg, _arguments || []), i, q = [];
  return i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i;
  function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }
  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }
  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }
  function fulfill(value) { resume("next", value); }
  function reject(value) { resume("throw", value); }
  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }
};
/**
 * Given an item, create a new service
 */
function createImageCollection(response, title, configOptions) {
  return __asyncGenerator(this, arguments, function* createImageCollection_1() {
    const { config, portal, user } = configOptions;
    const { item } = yield __await(fetchItem(response, user));
    const template = yield __await((0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_2__.u)(portal));
    yield yield __await("publishingService");
    const isNotInRootFolder = item.ownerFolder && item.ownerFolder !== "/" && item.ownerFolder !== "root";
    const tempTitle = `${title}---${(0,_guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_0__.g)()}`;
    const { createServiceResponse, addToDefinitionResponse } = yield __await((0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_2__.v)(Object.assign({ name: isNotInRootFolder ? tempTitle : title, layers: (template === null || template === void 0 ? void 0 : template.layers) || [], tables: (template === null || template === void 0 ? void 0 : template.tables) || [] }, template), { config, user }));
    if (isNotInRootFolder) {
      yield __await((0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_1__.m)(createServiceResponse.itemId, item.ownerFolder));
      yield __await((0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_1__.e)(createServiceResponse.itemId, { title }));
    }
    yield yield __await("appendingPhotos");
    const { statusUrl } = yield __await(appendPhotos(createServiceResponse, addToDefinitionResponse, item));
    yield __await(addRelationship(createServiceResponse, item, user));
    yield yield __await("checkingStatus");
    yield __await((0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_3__.p)(statusUrl));
    yield yield __await(createServiceResponse);
  });
}
function fetchItem(item, user) {
  const url = `${user.userContentUrl}/items/${item.id}`;
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_3__.r)(url);
}
function appendPhotos(createServiceResponse, addToDefinitionResponse, item) {
  var _a;
  const layer = addToDefinitionResponse.layers[0];
  const url = `${createServiceResponse.encodedServiceURL}/${(_a = layer.id) !== null && _a !== void 0 ? _a : 0}/append`;
  const content = {
    appendItemId: item.id,
    appendUploadFormat: "imageCollection",
    appendAttachmentsInfo: JSON.stringify({ ignoreAttachmentsWithoutLocation: true }),
    upsert: false,
    useGlobalIds: false,
    rollbackOnFailure: true
  };
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_3__.r)(url, content, {}, "post");
}
function addRelationship(createServiceResponse, item, user) {
  const url = `${user.userContentUrl}/addRelationship`;
  const content = {
    relationshipType: "Service2Data",
    destinationItemId: item.id,
    originItemId: createServiceResponse.itemId
  };
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_3__.r)(url, content, {}, "post");
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-2d217af2.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-2d217af2.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   p: () => (/* binding */ publishItemState)
/* harmony export */ });
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const publishItemStore = (0,_index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__.c)({
  sourceItem: null,
  i18n: null
});
const publishItemState = publishItemStore.state;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-86ac6961.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-86ac6961.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ resetStoreOnHome),
/* harmony export */   r: () => (/* binding */ resetAddItemStores)
/* harmony export */ });
/* harmony import */ var _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./item-properties-e6412a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




function resetAddItemStores() {
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.d.reset();
  _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_0__.a.reset();
}
const resetStoreOnHome = () => {
  if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.existingItem || _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_2__.u.workflow === "register") {
    return;
  }
  _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.d.reset();
  const folder = _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_0__.i.folder;
  _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_0__.a.reset();
  _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_0__.i.folder = folder;
};




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTkwYWJmOC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUM2RztBQUNuRDtBQUNGO0FBQ2lCO0FBQ0c7QUFDYztBQUNQO0FBQ3JCO0FBQ0s7QUFDVjtBQUNJO0FBQ0Q7QUFDOUI7QUFDSztBQUNEO0FBQ0w7QUFDRDtBQUNTO0FBQ0w7QUFDSztBQUNKO0FBQ0o7QUFDRjtBQUNDO0FBQ0Q7QUFDVTtBQUNIO0FBQ1A7QUFDQTtBQUNJO0FBQ0g7QUFDRjtBQUNRO0FBQ0g7QUFDRzs7QUFFbEMsaUhBQWlILGNBQWMsc0JBQXNCLCtEQUErRCxnQkFBZ0IsbUJBQW1CLCtCQUErQixpQkFBaUIsa0JBQWtCLG1FQUFtRSxtQkFBbUIsK0JBQStCLFNBQVMsbUJBQW1CLFVBQVUscURBQXFELCtCQUErQiw2REFBNkQscUJBQXFCOztBQUUxbkIscUJBQXFCLE1BQW9DO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBLHlHQUF5Ryx1RkFBdUYsY0FBYztBQUM5TSxxQkFBcUIsOEJBQThCLGdEQUFnRCx3REFBd0Q7QUFDM0osMkNBQTJDLHVDQUF1QyxVQUFVLG1CQUFtQixJQUFJO0FBQ25IO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxxREFBZ0I7QUFDcEIsMEJBQTBCLHFEQUFXO0FBQ3JDLDRCQUE0QixxREFBVztBQUN2QywwQ0FBMEMscURBQVc7QUFDckQscUNBQXFDLHFEQUFXO0FBQ2hEO0FBQ0E7QUFDQSxjQUFjLG9CQUFvQixFQUFFLDJEQUFtQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isa0JBQWtCO0FBQ2xDLDZCQUE2QiwyREFBZ0I7QUFDN0M7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QztBQUNEOztBQUVpQzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ1pqQztBQUNBO0FBQ0E7QUFDQTtBQUNtRztBQUNyQjtBQUN6Qjs7QUFFckQ7QUFDQSxFQUFFLG9EQUFZO0FBQ2QsRUFBRSwyREFBbUI7QUFDckI7QUFDQTtBQUNBLE1BQU0sb0RBQVksaUJBQWlCLDhDQUFZO0FBQy9DO0FBQ0E7QUFDQSxFQUFFLG9EQUFZO0FBQ2QsaUJBQWlCLDJEQUFtQjtBQUNwQyxFQUFFLDJEQUFtQjtBQUNyQixFQUFFLDJEQUFtQjtBQUNyQjs7QUFFMEQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtcHVibGlzaC1pdGVtLXBhZ2VzLWl0ZW0tcHJvcGVydGllcy5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9pbWFnZS1jb2xsZWN0aW9uLWE2NzAwMmNjLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3N0b3JlLTJkMjE3YWYyLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3V0aWxzLTg2YWM2OTYxLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtOTJlYmIzOTYuanMnO1xuaW1wb3J0IHsgZCBhcyBnZXRGb2xkZXJGcm9tSWQgfSBmcm9tICcuL3VzZXItZTNkZWRjNGEuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLWViNWY3ZGMyLmpzJztcbmltcG9ydCB7IGkgYXMgaXRlbVByb3BlcnRpZXNTdGF0ZSB9IGZyb20gJy4vaXRlbS1wcm9wZXJ0aWVzLWU2NDEyYTlhLmpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlSW1hZ2VDb2xsZWN0aW9uIH0gZnJvbSAnLi9pbWFnZS1jb2xsZWN0aW9uLWE2NzAwMmNjLmpzJztcbmltcG9ydCB7IGEgYXMgYXBwZW5kVHlwZUtleXdvcmRzLCBwIGFzIHB1Ymxpc2hTZXJ2aWNlIH0gZnJvbSAnLi9wdWJsaXNoLWl0ZW0tODJmZmE3ZjguanMnO1xuaW1wb3J0IHsgdSBhcyB1cGRhdGVDYXRlZ29yaWVzLCBkIGFzIGRlbGV0ZUl0ZW0gfSBmcm9tICcuL3NlcnZlci1pdGVtLWYxMjE1M2U2LmpzJztcbmltcG9ydCB7IHIgYXMgcmVzZXRBZGRJdGVtU3RvcmVzIH0gZnJvbSAnLi91dGlscy04NmFjNjk2MS5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZENyZWF0ZUl0ZW1UeXBlcyB9IGZyb20gJy4vaXRlbS10eXBlcy1iNGZlODZhZC5qcyc7XG5pbXBvcnQgeyB3IGFzIHdvcmtmbG93U3RhdGUgfSBmcm9tICcuL3N0b3JlLTMyMTBiNjA0LmpzJztcbmltcG9ydCB7IG4gYXMgaXNQdWJsaWNVc2VyIH0gZnJvbSAnLi9wcml2aWxlZ2VzLWNjZDVmMzdkLmpzJztcbmltcG9ydCB7IHAgYXMgcHVibGlzaEl0ZW1TdGF0ZSB9IGZyb20gJy4vc3RvcmUtMmQyMTdhZjIuanMnO1xuaW1wb3J0ICcuL3BvcnRhbC03OWNhYWVmZi5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYWFmMzBiZDYuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtYzgyZjVhYjkuanMnO1xuaW1wb3J0ICcuL2luZGV4LTgxZDU0OGI3LmpzJztcbmltcG9ydCAnLi9ndWlkLTRmNDE3NmJhLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTM4Y2RhZTg3LmpzJztcbmltcG9ydCAnLi9hZGQtaXRlbS05N2Q1NzdhOS5qcyc7XG5pbXBvcnQgJy4vZmVhdHVyZS1sYXllci1kMzNlYTExNC5qcyc7XG5pbXBvcnQgJy4vdGh1bWJuYWlsLTBiN2FkZmNkLmpzJztcbmltcG9ydCAnLi9xdWVyeS00ZjdiN2U0ZC5qcyc7XG5pbXBvcnQgJy4vYXBpLWY3OTM0Y2Q3LmpzJztcbmltcG9ydCAnLi9pdGVtLWQ5ZDcwNDE2LmpzJztcbmltcG9ydCAnLi9kb20tMTNmNWIwMGMuanMnO1xuaW1wb3J0ICcuL2ZlYXR1cmUtbGF5ZXItNjkzMDVhODUuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtOWY2NDhiZWUuanMnO1xuaW1wb3J0ICcuL2Fncy02OGQ0YWUyMC5qcyc7XG5pbXBvcnQgJy4vdXJsLWYzYjgyY2M3LmpzJztcbmltcG9ydCAnLi9zdG9yYWdlLWQ3ZjU4MjJlLmpzJztcbmltcG9ydCAnLi9maWxlLWYzNjE5M2U5LmpzJztcbmltcG9ydCAnLi91aS1lY2Y4NmJiYS5qcyc7XG5pbXBvcnQgJy4vdGlsZS1sYXllci05MGE2YjkwMS5qcyc7XG5pbXBvcnQgJy4vZ2VvY29kZS03ZWI3YzBkZi5qcyc7XG5pbXBvcnQgJy4vcHJpdmlsZWdlcy0zNTU5MGViNC5qcyc7XG5cbmNvbnN0IGFyY2dpc1B1Ymxpc2hJdGVtUGFnZXNJdGVtUHJvcGVydGllc0NzcyA9IFwiLmxheWVyLWRlc2NyaXB0aW9uLnNjLWFyY2dpcy1wdWJsaXNoLWl0ZW0tcGFnZXMtaXRlbS1wcm9wZXJ0aWVze2Rpc3BsYXk6YmxvY2s7bWFyZ2luLWJvdHRvbTowLjc1cmVtfS5sb2NhdG9yX19oZWFkaW5nLnNjLWFyY2dpcy1wdWJsaXNoLWl0ZW0tcGFnZXMtaXRlbS1wcm9wZXJ0aWVze2ZvbnQtd2VpZ2h0OjUwMDtmb250LXNpemU6MC44NzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpO2xpbmUtaGVpZ2h0OjE4cHg7bWFyZ2luLWJvdHRvbToycHh9LmxvY2F0b3JfX2Rlc2NyaXB0aW9uLnNjLWFyY2dpcy1wdWJsaXNoLWl0ZW0tcGFnZXMtaXRlbS1wcm9wZXJ0aWVze2ZvbnQtc2l6ZTowLjg3NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMSk7bWFyZ2luOjA7bWFyZ2luLWJvdHRvbToxcmVtO3BhZGRpbmc6MH0ubWVkaXVtLnNjLWFyY2dpcy1wdWJsaXNoLWl0ZW0tcGFnZXMtaXRlbS1wcm9wZXJ0aWVzey0tYXJjZ2lzLWxhYmVsLWZvbnQtd2VpZ2h0OjUwMH0uaW5mby1jb250YWluZXIuc2MtYXJjZ2lzLXB1Ymxpc2gtaXRlbS1wYWdlcy1pdGVtLXByb3BlcnRpZXN7bWFyZ2luLWJvdHRvbToxLjVyZW19XCI7XG5cbnZhciBfX2FzeW5jVmFsdWVzID0gKHVuZGVmaW5lZCAmJiB1bmRlZmluZWQuX19hc3luY1ZhbHVlcykgfHwgZnVuY3Rpb24gKG8pIHtcbiAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcilcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xuICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xuICByZXR1cm4gbSA/IG0uY2FsbChvKSA6IChvID0gdHlwZW9mIF9fdmFsdWVzID09PSBcImZ1bmN0aW9uXCIgPyBfX3ZhbHVlcyhvKSA6IG9bU3ltYm9sLml0ZXJhdG9yXSgpLCBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaSk7XG4gIGZ1bmN0aW9uIHZlcmIobikgeyBpW25dID0gb1tuXSAmJiBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgeyB2ID0gb1tuXSh2KSwgc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgdi5kb25lLCB2LnZhbHVlKTsgfSk7IH07IH1cbiAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbiAodikgeyByZXNvbHZlKHsgdmFsdWU6IHYsIGRvbmU6IGQgfSk7IH0sIHJlamVjdCk7IH1cbn07XG5jb25zdCBNQVhfVElUTEVfTEVOR1RIID0gMjUwO1xuY29uc3QgQXJjZ2lzUHVibGlzaEl0ZW1QYWdlc0l0ZW1Qcm9wZXJ0aWVzID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLndvcmtmbG93Q2FuY2VsID0gY3JlYXRlRXZlbnQodGhpcywgXCJ3b3JrZmxvd0NhbmNlbFwiLCA3KTtcbiAgICB0aGlzLndvcmtmbG93Q29tcGxldGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcIndvcmtmbG93Q29tcGxldGVcIiwgNyk7XG4gICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZFwiLCA3KTtcbiAgICB0aGlzLmFyY2dpc1dvcmtmbG93VXBkYXRlRXJyb3IgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1dvcmtmbG93VXBkYXRlRXJyb3JcIiwgNyk7XG4gICAgdGhpcy53b3JrZmxvd0NhbmNlbGxlZCA9IGZhbHNlO1xuICAgIHRoaXMuaGFuZGxlUmVxdWVzdCA9IGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHsgY2F0ZWdvcmllcywgdGl0bGUgfSA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGU7XG4gICAgICAvLyBEb24ndCBzZW5kIHJlcXVlc3QgaWYgYW4gZXJyb3IgaXMgcmVwb3J0ZWRcbiAgICAgIGlmICghKGF3YWl0IHRoaXMudmFsaWRhdGUoKSkpIHtcbiAgICAgICAgdGhpcy5hcmNnaXNXb3JrZmxvd1VwZGF0ZUVycm9yLmVtaXQodGhpcy5lcnJvck1lc3NhZ2UpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoKHRpdGxlID09PSBudWxsIHx8IHRpdGxlID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0aXRsZS5sZW5ndGgpID4gTUFYX1RJVExFX0xFTkdUSCkge1xuICAgICAgICB0aGlzLnRpdGxlUmVmLnRpdGxlID0gdGl0bGUuc3Vic3RyaW5nKDAsIE1BWF9USVRMRV9MRU5HVEgpO1xuICAgICAgfVxuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gVE9ETzogUmVwYWlyIHRlbGVtZXRyeVxuICAgICAgICAvLyBUZWxlbWV0cnk6IEJlZ2luIHVwbG9hZCB0cmFja2luZyB3b3JrZmxvd1xuICAgICAgICAvLyBsb2dBZGROZXdJdGVtU3RhcnQoKTtcbiAgICAgICAgY29uc3QgeyBwdWJsaXNoUmVzcG9uc2UgfSA9IGF3YWl0IHRoaXMucHVibGlzaEl0ZW0oKTtcbiAgICAgICAgY2F0ZWdvcmllcyAmJiAoYXdhaXQgdXBkYXRlQ2F0ZWdvcmllcyh0aGlzLnBvcnRhbCwgW3B1Ymxpc2hSZXNwb25zZS5pZF0sIGNhdGVnb3JpZXMpKTtcbiAgICAgICAgaWYgKCF0aGlzLndvcmtmbG93Q2FuY2VsbGVkKSB7XG4gICAgICAgICAgLy8gVGVsZW1ldHJ5OiBPbmx5IGxvZyB0ZWxlbWV0cnkgYWZ0ZXIgc3VjY2Vzc2Z1bCB1cGxvYWRcbiAgICAgICAgICAvLyBsb2dJdGVtUHJvcGVydGllc0NoYW5nZXMoKTtcbiAgICAgICAgICAvLyBsb2dTdWNjZXNzZnVsSXRlbUNyZWF0aW9uKCk7XG4gICAgICAgICAgLy8gY29uZmlnU3RhdGUudGVsZW1ldHJ5ICYmIChhd2FpdCB0aW1lb3V0KDc1MCkpO1xuICAgICAgICAgIGNvbnN0IGVtaXRQYXlsb2FkID0gT2JqZWN0LmFzc2lnbih7fSwgcHVibGlzaFJlc3BvbnNlKTtcbiAgICAgICAgICAvLyBDdXJyZW50IHB1Ymxpc2ggZGlhbG9nIGV4cGVjdHMgdGhpcyBhcyB0aGUgcGF5bG9hZDpcbiAgICAgICAgICAvLyBjb25zdCB7IGlkLCByZXNwb25zZSwgam9iSWQsIHNlcnZpY2VUeXBlLCBpdGVtLCBuZXdJdGVtTW9kZSB9ID0gZS5kZXRhaWw7XG4gICAgICAgICAgLy8gVE9ETzogUmVtb3ZlIG5ldy1pdGVtIHNwZWNpZmljIHByb3BlcnRpZXNcbiAgICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUuZW1pdChlbWl0UGF5bG9hZCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgKHB1Ymxpc2hSZXNwb25zZSA9PT0gbnVsbCB8fCBwdWJsaXNoUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hSZXNwb25zZS5pZCkgJiYgKGF3YWl0IGRlbGV0ZUl0ZW0ocHVibGlzaFJlc3BvbnNlLmlkKSk7XG4gICAgICAgICAgdGhpcy53b3JrZmxvd0NhbmNlbC5lbWl0KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmVzZXRBZGRJdGVtU3RvcmVzKCk7XG4gICAgICB9XG4gICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gdGhpcy5wYXJzZUVycm9yKGVycm9yLmNvZGUpO1xuICAgICAgICB0aGlzLmFyY2dpc1dvcmtmbG93VXBkYXRlRXJyb3IuZW1pdCh0aGlzLmVycm9yTWVzc2FnZSk7XG4gICAgICAgIHRoaXMuc2hvd0xvYWRlcihmYWxzZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLml0ZW0gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy51c2VyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgIHRoaXMubG9hZGVyVHlwZSA9IFwiaW5kZXRlcm1pbmF0ZVwiO1xuICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IHVuZGVmaW5lZDtcbiAgfVxuICAvKipcbiAgICogQ2hlY2tzIGVhY2ggZmllbGQsIHNob3J0LWNpcmN1aXRpbmcgb24gdGhlIGZpcnN0IG9uZSB0byBmYWlsLiBQb3B1bGF0ZXMgdGhpcy5lcnJvck1lc3NhZ2UgaW50ZXJuYWxseVxuICAgKi9cbiAgYXN5bmMgdmFsaWRhdGUoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgY29uc3QgdGl0bGVFcnJvciA9IGF3YWl0ICgoX2EgPSB0aGlzLnRpdGxlUmVmKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudmFsaWRhdGVUaXRsZSgpKTtcbiAgICBpZiAodGl0bGVFcnJvcikge1xuICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSB7XG4gICAgICAgIHRpdGxlOiBwdWJsaXNoSXRlbVN0YXRlLmkxOG4uZXJyb3IudGl0bGUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiB0aXRsZUVycm9yLnRyYW5zbGF0ZWRNZXNzYWdlXG4gICAgICB9O1xuICAgICAgdGhpcy50aXRsZVJlZi5mb2N1c01haW5JbnB1dCgpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBUT0RPOiBjb25uZWN0IGZvbGRlciBjb21wb25lbnQgdG8gZXJyb3Igc3RydWN0dXJlXG4gICAgLy8gQWxzbywgdXBkYXRpbmcgdGhlIG5ldyB0aXRsZSBpbiBhIGZvbGRlciBwaWNrZXIgZG9lc24ndCBlbWl0IGFuIGl0ZW1Qcm9wZXJ0aWVzIGNoYW5nZSBldmVudCxcbiAgICAvLyBzbyB0aGUgZXJyb3IgZG9lc24ndCBjbGVhciB1bmxlc3MgdGhlIGZvbGRlciBpcyBhY3R1YWxseSBjaGFuZ2VkXG4gICAgY29uc3QgZm9sZGVyUmVzcG9uc2UgPSBhd2FpdCAoKF9iID0gdGhpcy5pdGVtUHJvcGVydGllc0ZvbGRlclJlZikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnNhdmVBY3RpdmVGb2xkZXIoKSk7XG4gICAgaWYgKCEhZm9sZGVyUmVzcG9uc2UpIHtcbiAgICAgIGlmICh0eXBlb2YgZm9sZGVyUmVzcG9uc2UgPT09IFwiYm9vbGVhblwiICYmICFmb2xkZXJSZXNwb25zZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBlbHNlIGlmICh0eXBlb2YgZm9sZGVyUmVzcG9uc2UgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSB7XG4gICAgICAgICAgdGl0bGU6IHB1Ymxpc2hJdGVtU3RhdGUuaTE4bi5lcnJvci50aXRsZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogZm9sZGVyUmVzcG9uc2VcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBzdW1tYXJ5RXJyb3IgPSBhd2FpdCAoKF9jID0gdGhpcy5zdW1tYXJ5UmVmKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZ2V0RXJyb3JNZXNzYWdlKCkpO1xuICAgIGlmIChzdW1tYXJ5RXJyb3IpIHtcbiAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0ge1xuICAgICAgICB0aXRsZTogcHVibGlzaEl0ZW1TdGF0ZS5pMThuLmVycm9yLnRpdGxlLFxuICAgICAgICBkZXNjcmlwdGlvbjogc3VtbWFyeUVycm9yLnRyYW5zbGF0ZWRNZXNzYWdlXG4gICAgICB9O1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBhc3luYyBuYXZpZ2F0ZVRvTmV4dFBhZ2UoKSB7XG4gICAgdGhpcy5oYW5kbGVSZXF1ZXN0KCk7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICAvLyBHcmFiIGNvbW1vbiB3b3JrZmxvdyBzdGF0ZVxuICAgIHB1Ymxpc2hJdGVtU3RhdGUuaTE4biA9IHB1Ymxpc2hJdGVtU3RhdGUuaTE4bjtcbiAgICAvLyBHcmFiIHB1Ymxpc2hJdGVtIHdvcmtmbG93IHN0YXRlXG4gICAgKF9hID0gdGhpcy5wb3J0YWwpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6ICh0aGlzLnBvcnRhbCA9IGNvbmZpZ1N0YXRlLnBvcnRhbCk7XG4gICAgKF9iID0gdGhpcy51c2VyKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAodGhpcy51c2VyID0gY29uZmlnU3RhdGUudXNlcik7XG4gICAgaWYgKCF0aGlzLml0ZW0pIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJObyBpdGVtIGZvdW5kXCIpO1xuICAgICAgLy8gVE9ETzogY3JlYXRlIGVycm9yIG1lc3NhZ2VcbiAgICAgIHRoaXMuYXJjZ2lzV29ya2Zsb3dVcGRhdGVFcnJvci5lbWl0KHRoaXMuZXJyb3JNZXNzYWdlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gVE9ETzogY2hlY2sgaWYgdGhpcyBzaG91bGQgZ3JhYiB0aGUgaXRlbSBvd25lciBpbnN0ZWFkIG9mIGN1cnJlbnQgdXNlclxuICAgIHRoaXMuZm9sZGVyID0gYXdhaXQgZ2V0Rm9sZGVyRnJvbUlkKHRoaXMuaXRlbS5vd25lckZvbGRlciwgdGhpcy51c2VyKTtcbiAgfVxuICBhc3luYyBwdWJsaXNoSXRlbSgpIHtcbiAgICBjb25zdCB7IGlkLCB0eXBlIH0gPSB0aGlzLml0ZW07XG4gICAgY29uc3QgYWRkUmVzcG9uc2UgPSB7IHN1Y2Nlc3M6IHRydWUsIGlkLCBmb2xkZXI6IG51bGwgfTtcbiAgICBjb25zdCBwdWJsaXNoUmVzcG9uc2UgPSB0eXBlID09PSBcIkltYWdlIENvbGxlY3Rpb25cIlxuICAgICAgPyBhd2FpdCB0aGlzLnB1Ymxpc2hJbWFnZUNvbGxlY3Rpb24oYWRkUmVzcG9uc2UpXG4gICAgICA6IGF3YWl0IHRoaXMucHVibGlzaFNlcnZpY2UoaWQpO1xuICAgIGF3YWl0IGFwcGVuZFR5cGVLZXl3b3JkcyhwdWJsaXNoUmVzcG9uc2UsIHRoaXMudXNlcik7XG4gICAgcmV0dXJuIHsgYWRkUmVzcG9uc2UsIHB1Ymxpc2hSZXNwb25zZSB9O1xuICB9XG4gIGFzeW5jIHB1Ymxpc2hTZXJ2aWNlKGlkKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgdHlwZSB9ID0gdGhpcy5pdGVtO1xuICAgIGNvbnN0IGV4dGVuc2lvbiA9IGFkZENyZWF0ZUl0ZW1UeXBlc1t0eXBlXS5maWxlRXh0WzBdO1xuICAgIHRoaXMuc2hvd0xvYWRlcih0cnVlLCB7XG4gICAgICBsb2FkZXJUeXBlOiBcImluZGV0ZXJtaW5hdGVcIixcbiAgICAgIGxvYWRlck1lc3NhZ2U6IHB1Ymxpc2hJdGVtU3RhdGUuaTE4bi5wdWJsaXNoaW5nU2VydmljZVxuICAgIH0pO1xuICAgIGNvbnN0IHsgcmVzdWx0OiBwdWJsaXNoUmVzcG9uc2UsIGVycm9yIH0gPSBhd2FpdCBwdWJsaXNoU2VydmljZSh7XG4gICAgICBpdGVtSWQ6IGlkLFxuICAgICAgdXNlcjogdGhpcy51c2VyLFxuICAgICAgdGl0bGU6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUsXG4gICAgICBleHRlbnNpb24sXG4gICAgICB0eXBlXG4gICAgfSk7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwidGhlcmUgd2FzIGFuIGVycm9yXCIsIGVycm9yKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBjb25zdCBzZXJ2aWNlID0gKF9hID0gcHVibGlzaFJlc3BvbnNlLnNlcnZpY2VzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBpZDogc2VydmljZSA9PT0gbnVsbCB8fCBzZXJ2aWNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXJ2aWNlLnNlcnZpY2VJdGVtSWQsXG4gICAgICAgIGpvYklkOiBzZXJ2aWNlID09PSBudWxsIHx8IHNlcnZpY2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlcnZpY2Uuam9iSWQsXG4gICAgICAgIHNlcnZpY2VUeXBlOiBzZXJ2aWNlID09PSBudWxsIHx8IHNlcnZpY2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlcnZpY2UudHlwZSxcbiAgICAgICAgc2VydmljZVVybDogc2VydmljZSA9PT0gbnVsbCB8fCBzZXJ2aWNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXJ2aWNlLnNlcnZpY2V1cmxcbiAgICAgIH07XG4gICAgfVxuICB9XG4gIGFzeW5jIHB1Ymxpc2hJbWFnZUNvbGxlY3Rpb24oYWRkSXRlbVJlc3BvbnNlKSB7XG4gICAgdmFyIF9hLCBlXzEsIF9iLCBfYztcbiAgICBjb25zdCB7IGNvbmZpZywgdXNlciwgcG9ydGFsIH0gPSBjb25maWdTdGF0ZTtcbiAgICB0aGlzLnNob3dMb2FkZXIodHJ1ZSwge1xuICAgICAgbG9hZGVyVHlwZTogXCJpbmRldGVybWluYXRlXCIsXG4gICAgICBsb2FkZXJNZXNzYWdlOiBwdWJsaXNoSXRlbVN0YXRlLmkxOG4ucHVibGlzaGluZ1NlcnZpY2VcbiAgICB9KTtcbiAgICBjb25zdCBpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3IgPSBjcmVhdGVJbWFnZUNvbGxlY3Rpb24oYWRkSXRlbVJlc3BvbnNlLCBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlLCB7IGNvbmZpZywgdXNlciwgcG9ydGFsIH0pO1xuICAgIHRyeSB7XG4gICAgICBmb3IgKHZhciBfZCA9IHRydWUsIGltYWdlQ29sbGVjdGlvbkdlbmVyYXRvcl8xID0gX19hc3luY1ZhbHVlcyhpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3IpLCBpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3JfMV8xOyBpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3JfMV8xID0gYXdhaXQgaW1hZ2VDb2xsZWN0aW9uR2VuZXJhdG9yXzEubmV4dCgpLCBfYSA9IGltYWdlQ29sbGVjdGlvbkdlbmVyYXRvcl8xXzEuZG9uZSwgIV9hOykge1xuICAgICAgICBfYyA9IGltYWdlQ29sbGVjdGlvbkdlbmVyYXRvcl8xXzEudmFsdWU7XG4gICAgICAgIF9kID0gZmFsc2U7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3Qgc3RhdHVzID0gX2M7XG4gICAgICAgICAgaWYgKHR5cGVvZiBzdGF0dXMgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlTG9hZGVyKFwiaW5kZXRlcm1pbmF0ZVwiLCBwdWJsaXNoSXRlbVN0YXRlLmkxOG5bc3RhdHVzXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgaWQ6IHN0YXR1cy5zZXJ2aWNlSXRlbUlkLFxuICAgICAgICAgICAgICBqb2JJZDogbnVsbCxcbiAgICAgICAgICAgICAgc2VydmljZVR5cGU6IHN0YXR1cy50eXBlLFxuICAgICAgICAgICAgICBzZXJ2aWNlVXJsOiBzdGF0dXMuc2VydmljZXVybFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgX2QgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlXzFfMSkge1xuICAgICAgZV8xID0geyBlcnJvcjogZV8xXzEgfTtcbiAgICB9XG4gICAgZmluYWxseSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoIV9kICYmICFfYSAmJiAoX2IgPSBpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3JfMS5yZXR1cm4pKVxuICAgICAgICAgIGF3YWl0IF9iLmNhbGwoaW1hZ2VDb2xsZWN0aW9uR2VuZXJhdG9yXzEpO1xuICAgICAgfVxuICAgICAgZmluYWxseSB7XG4gICAgICAgIGlmIChlXzEpXG4gICAgICAgICAgdGhyb3cgZV8xLmVycm9yO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBzaG93TG9hZGVyKHNob3csIHVwZGF0ZSkge1xuICAgIGlmICh1cGRhdGUpIHtcbiAgICAgIHRoaXMudXBkYXRlTG9hZGVyKHVwZGF0ZS5sb2FkZXJUeXBlLCB1cGRhdGUubG9hZGVyTWVzc2FnZSk7XG4gICAgfVxuICAgIGlmIChzaG93KSB7XG4gICAgICB0aGlzLm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZC5lbWl0KGZhbHNlKTtcbiAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdCh0cnVlKTtcbiAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgIH1cbiAgfVxuICB1cGRhdGVMb2FkZXIobG9hZGVyVHlwZSwgbG9hZGVyTWVzc2FnZSkge1xuICAgIHRoaXMubG9hZGVyVHlwZSA9IGxvYWRlclR5cGU7XG4gICAgdGhpcy5sb2FkZXJNZXNzYWdlID0gbG9hZGVyTWVzc2FnZTtcbiAgfVxuICBwYXJzZUVycm9yKGNvZGUpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgY29uc3QgeyBpMThuIH0gPSBwdWJsaXNoSXRlbVN0YXRlO1xuICAgIHJldHVybiB7XG4gICAgICB0aXRsZTogKF9iID0gKF9hID0gaTE4bi5lcnJvcltjb2RlXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRpdGxlKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBcIm5vIGVycm9yIGNvZGUgdGl0bGVcIixcbiAgICAgIGRlc2NyaXB0aW9uOiAoX2QgPSAoX2MgPSBpMThuLmVycm9yW2NvZGVdKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZGVzY3JpcHRpb24pICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IFwibm8gZXJyb3IgY29kZSBkZXNjcmlwdGlvblwiXG4gICAgfTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgaWYgKCF0aGlzLml0ZW0pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgeyB0eXBlIH0gPSB0aGlzLml0ZW07XG4gICAgY29uc3QgeyB1c2VyIH0gPSBjb25maWdTdGF0ZTtcbiAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImFyY2dpcy1uZXctaXRlbS1sb2FkZXJcIiwgeyB0eXBlOiB0aGlzLmxvYWRlclR5cGUsIHZhbHVlOiB3b3JrZmxvd1N0YXRlLnVwbG9hZFByb2dyZXNzLCBhY3RpdmU6IHRoaXMubG9hZGluZywgdGV4dDogdGhpcy5sb2FkZXJNZXNzYWdlIH0pLCBoKFwiYXJjZ2lzLWl0ZW0tcHJvcGVydGllc1wiLCB7XG4gICAgICAvLyBDbGVhciBlcnJvcnMgb24gYW55IG1vZGlmaWNhdGlvblxuICAgICAgb25BcmNnaXNJdGVtUHJvcGVydGllc0NoYW5nZTogKCkgPT4gdGhpcy5hcmNnaXNXb3JrZmxvd1VwZGF0ZUVycm9yLmVtaXQobnVsbClcbiAgICB9LCB0eXBlICE9PSBcIlNlcnZpY2UgRGVmaW5pdGlvblwiICYmIChoKFwiYXJjZ2lzLXRpdGxlLWlucHV0XCIsIHsgaXRlbVRpdGxlOiB0aGlzLml0ZW0udGl0bGUsIGNsYXNzOiBcIm1lZGl1bVwiLCBjdXJyZW50Rm9sZGVyOiB0aGlzLml0ZW0ub3duZXJGb2xkZXIsIHR5cGU6IHR5cGUsIGVuYWJsZVB1Ymxpc2hpbmc6IHRydWUsIHJlZjogKGVsZSkgPT4ge1xuICAgICAgICB0aGlzLnRpdGxlUmVmID0gZWxlO1xuICAgICAgfSB9KSksIGgoXCJhcmNnaXMtZm9sZGVyLXBpY2tlclwiLCB7IGNsYXNzOiBcIm1lZGl1bVwiLCByZWY6IChlbGUpID0+ICh0aGlzLml0ZW1Qcm9wZXJ0aWVzRm9sZGVyUmVmID0gZWxlKSwgZm9sZGVyOiB0aGlzLmZvbGRlciB9KSwgIWlzUHVibGljVXNlcih1c2VyKSAmJiBoKFwiYXJjZ2lzLWNhdGVnb3JpZXMtcGlja2VyXCIsIHsgY2xhc3M6IFwibWVkaXVtXCIgfSksIGgoXCJhcmNnaXMtdGFncy1waWNrZXJcIiwgeyBjbGFzczogXCJtZWRpdW1cIiB9KSwgaChcImFyY2dpcy1zdW1tYXJ5LWlucHV0XCIsIHsgY2xhc3M6IFwibWVkaXVtXCIsIHJlZjogKGVsZSkgPT4gKHRoaXMuc3VtbWFyeVJlZiA9IGVsZSkgfSkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc1B1Ymxpc2hJdGVtUGFnZXNJdGVtUHJvcGVydGllcy5zdHlsZSA9IGFyY2dpc1B1Ymxpc2hJdGVtUGFnZXNJdGVtUHJvcGVydGllc0NzcztcblxuZXhwb3J0IHsgQXJjZ2lzUHVibGlzaEl0ZW1QYWdlc0l0ZW1Qcm9wZXJ0aWVzIGFzIGFyY2dpc19wdWJsaXNoX2l0ZW1fcGFnZXNfaXRlbV9wcm9wZXJ0aWVzIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGcgYXMgZ3VpZCB9IGZyb20gJy4vZ3VpZC00ZjQxNzZiYS5qcyc7XG5pbXBvcnQgeyBtIGFzIG1vdmVJdGVtLCBlIGFzIHVwZGF0ZUl0ZW0gfSBmcm9tICcuL3NlcnZlci1pdGVtLWYxMjE1M2U2LmpzJztcbmltcG9ydCB7IHUgYXMgZmluZFRlbXBsYXRlU2VydmljZUluZm8sIHYgYXMgY3JlYXRlU2VydmljZSB9IGZyb20gJy4vZmVhdHVyZS1sYXllci0zOGNkYWU4Ny5qcyc7XG5pbXBvcnQgeyByIGFzIHJlcXVlc3QsIHAgYXMgcG9sbEZvclN0YXR1cyB9IGZyb20gJy4vcG9ydGFsLTc5Y2FhZWZmLmpzJztcblxudmFyIF9fYXdhaXQgPSAodW5kZWZpbmVkICYmIHVuZGVmaW5lZC5fX2F3YWl0KSB8fCBmdW5jdGlvbiAodikgeyByZXR1cm4gdGhpcyBpbnN0YW5jZW9mIF9fYXdhaXQgPyAodGhpcy52ID0gdiwgdGhpcykgOiBuZXcgX19hd2FpdCh2KTsgfTtcbnZhciBfX2FzeW5jR2VuZXJhdG9yID0gKHVuZGVmaW5lZCAmJiB1bmRlZmluZWQuX19hc3luY0dlbmVyYXRvcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xuICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xuICB2YXIgZyA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSwgaSwgcSA9IFtdO1xuICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XG4gIGZ1bmN0aW9uIHZlcmIobikgeyBpZiAoZ1tuXSkgaVtuXSA9IGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAoYSwgYikgeyBxLnB1c2goW24sIHYsIGEsIGJdKSA+IDEgfHwgcmVzdW1lKG4sIHYpOyB9KTsgfTsgfVxuICBmdW5jdGlvbiByZXN1bWUobiwgdikgeyB0cnkgeyBzdGVwKGdbbl0odikpOyB9IGNhdGNoIChlKSB7IHNldHRsZShxWzBdWzNdLCBlKTsgfSB9XG4gIGZ1bmN0aW9uIHN0ZXAocikgeyByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsgfVxuICBmdW5jdGlvbiBmdWxmaWxsKHZhbHVlKSB7IHJlc3VtZShcIm5leHRcIiwgdmFsdWUpOyB9XG4gIGZ1bmN0aW9uIHJlamVjdCh2YWx1ZSkgeyByZXN1bWUoXCJ0aHJvd1wiLCB2YWx1ZSk7IH1cbiAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsgfVxufTtcbi8qKlxuICogR2l2ZW4gYW4gaXRlbSwgY3JlYXRlIGEgbmV3IHNlcnZpY2VcbiAqL1xuZnVuY3Rpb24gY3JlYXRlSW1hZ2VDb2xsZWN0aW9uKHJlc3BvbnNlLCB0aXRsZSwgY29uZmlnT3B0aW9ucykge1xuICByZXR1cm4gX19hc3luY0dlbmVyYXRvcih0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uKiBjcmVhdGVJbWFnZUNvbGxlY3Rpb25fMSgpIHtcbiAgICBjb25zdCB7IGNvbmZpZywgcG9ydGFsLCB1c2VyIH0gPSBjb25maWdPcHRpb25zO1xuICAgIGNvbnN0IHsgaXRlbSB9ID0geWllbGQgX19hd2FpdChmZXRjaEl0ZW0ocmVzcG9uc2UsIHVzZXIpKTtcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IHlpZWxkIF9fYXdhaXQoZmluZFRlbXBsYXRlU2VydmljZUluZm8ocG9ydGFsKSk7XG4gICAgeWllbGQgeWllbGQgX19hd2FpdChcInB1Ymxpc2hpbmdTZXJ2aWNlXCIpO1xuICAgIGNvbnN0IGlzTm90SW5Sb290Rm9sZGVyID0gaXRlbS5vd25lckZvbGRlciAmJiBpdGVtLm93bmVyRm9sZGVyICE9PSBcIi9cIiAmJiBpdGVtLm93bmVyRm9sZGVyICE9PSBcInJvb3RcIjtcbiAgICBjb25zdCB0ZW1wVGl0bGUgPSBgJHt0aXRsZX0tLS0ke2d1aWQoKX1gO1xuICAgIGNvbnN0IHsgY3JlYXRlU2VydmljZVJlc3BvbnNlLCBhZGRUb0RlZmluaXRpb25SZXNwb25zZSB9ID0geWllbGQgX19hd2FpdChjcmVhdGVTZXJ2aWNlKE9iamVjdC5hc3NpZ24oeyBuYW1lOiBpc05vdEluUm9vdEZvbGRlciA/IHRlbXBUaXRsZSA6IHRpdGxlLCBsYXllcnM6ICh0ZW1wbGF0ZSA9PT0gbnVsbCB8fCB0ZW1wbGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVtcGxhdGUubGF5ZXJzKSB8fCBbXSwgdGFibGVzOiAodGVtcGxhdGUgPT09IG51bGwgfHwgdGVtcGxhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbXBsYXRlLnRhYmxlcykgfHwgW10gfSwgdGVtcGxhdGUpLCB7IGNvbmZpZywgdXNlciB9KSk7XG4gICAgaWYgKGlzTm90SW5Sb290Rm9sZGVyKSB7XG4gICAgICB5aWVsZCBfX2F3YWl0KG1vdmVJdGVtKGNyZWF0ZVNlcnZpY2VSZXNwb25zZS5pdGVtSWQsIGl0ZW0ub3duZXJGb2xkZXIpKTtcbiAgICAgIHlpZWxkIF9fYXdhaXQodXBkYXRlSXRlbShjcmVhdGVTZXJ2aWNlUmVzcG9uc2UuaXRlbUlkLCB7IHRpdGxlIH0pKTtcbiAgICB9XG4gICAgeWllbGQgeWllbGQgX19hd2FpdChcImFwcGVuZGluZ1Bob3Rvc1wiKTtcbiAgICBjb25zdCB7IHN0YXR1c1VybCB9ID0geWllbGQgX19hd2FpdChhcHBlbmRQaG90b3MoY3JlYXRlU2VydmljZVJlc3BvbnNlLCBhZGRUb0RlZmluaXRpb25SZXNwb25zZSwgaXRlbSkpO1xuICAgIHlpZWxkIF9fYXdhaXQoYWRkUmVsYXRpb25zaGlwKGNyZWF0ZVNlcnZpY2VSZXNwb25zZSwgaXRlbSwgdXNlcikpO1xuICAgIHlpZWxkIHlpZWxkIF9fYXdhaXQoXCJjaGVja2luZ1N0YXR1c1wiKTtcbiAgICB5aWVsZCBfX2F3YWl0KHBvbGxGb3JTdGF0dXMoc3RhdHVzVXJsKSk7XG4gICAgeWllbGQgeWllbGQgX19hd2FpdChjcmVhdGVTZXJ2aWNlUmVzcG9uc2UpO1xuICB9KTtcbn1cbmZ1bmN0aW9uIGZldGNoSXRlbShpdGVtLCB1c2VyKSB7XG4gIGNvbnN0IHVybCA9IGAke3VzZXIudXNlckNvbnRlbnRVcmx9L2l0ZW1zLyR7aXRlbS5pZH1gO1xuICByZXR1cm4gcmVxdWVzdCh1cmwpO1xufVxuZnVuY3Rpb24gYXBwZW5kUGhvdG9zKGNyZWF0ZVNlcnZpY2VSZXNwb25zZSwgYWRkVG9EZWZpbml0aW9uUmVzcG9uc2UsIGl0ZW0pIHtcbiAgdmFyIF9hO1xuICBjb25zdCBsYXllciA9IGFkZFRvRGVmaW5pdGlvblJlc3BvbnNlLmxheWVyc1swXTtcbiAgY29uc3QgdXJsID0gYCR7Y3JlYXRlU2VydmljZVJlc3BvbnNlLmVuY29kZWRTZXJ2aWNlVVJMfS8keyhfYSA9IGxheWVyLmlkKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAwfS9hcHBlbmRgO1xuICBjb25zdCBjb250ZW50ID0ge1xuICAgIGFwcGVuZEl0ZW1JZDogaXRlbS5pZCxcbiAgICBhcHBlbmRVcGxvYWRGb3JtYXQ6IFwiaW1hZ2VDb2xsZWN0aW9uXCIsXG4gICAgYXBwZW5kQXR0YWNobWVudHNJbmZvOiBKU09OLnN0cmluZ2lmeSh7IGlnbm9yZUF0dGFjaG1lbnRzV2l0aG91dExvY2F0aW9uOiB0cnVlIH0pLFxuICAgIHVwc2VydDogZmFsc2UsXG4gICAgdXNlR2xvYmFsSWRzOiBmYWxzZSxcbiAgICByb2xsYmFja09uRmFpbHVyZTogdHJ1ZVxuICB9O1xuICByZXR1cm4gcmVxdWVzdCh1cmwsIGNvbnRlbnQsIHt9LCBcInBvc3RcIik7XG59XG5mdW5jdGlvbiBhZGRSZWxhdGlvbnNoaXAoY3JlYXRlU2VydmljZVJlc3BvbnNlLCBpdGVtLCB1c2VyKSB7XG4gIGNvbnN0IHVybCA9IGAke3VzZXIudXNlckNvbnRlbnRVcmx9L2FkZFJlbGF0aW9uc2hpcGA7XG4gIGNvbnN0IGNvbnRlbnQgPSB7XG4gICAgcmVsYXRpb25zaGlwVHlwZTogXCJTZXJ2aWNlMkRhdGFcIixcbiAgICBkZXN0aW5hdGlvbkl0ZW1JZDogaXRlbS5pZCxcbiAgICBvcmlnaW5JdGVtSWQ6IGNyZWF0ZVNlcnZpY2VSZXNwb25zZS5pdGVtSWRcbiAgfTtcbiAgcmV0dXJuIHJlcXVlc3QodXJsLCBjb250ZW50LCB7fSwgXCJwb3N0XCIpO1xufVxuXG5leHBvcnQgeyBjcmVhdGVJbWFnZUNvbGxlY3Rpb24gYXMgYyB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC04MWQ1NDhiNy5qcyc7XG5cbmNvbnN0IHB1Ymxpc2hJdGVtU3RvcmUgPSBjcmVhdGVTdG9yZSh7XG4gIHNvdXJjZUl0ZW06IG51bGwsXG4gIGkxOG46IG51bGxcbn0pO1xuY29uc3QgcHVibGlzaEl0ZW1TdGF0ZSA9IHB1Ymxpc2hJdGVtU3RvcmUuc3RhdGU7XG5cbmV4cG9ydCB7IHB1Ymxpc2hJdGVtU3RhdGUgYXMgcCB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBhIGFzIGl0ZW1Qcm9wZXJ0aWVzU3RvcmUsIGkgYXMgaXRlbVByb3BlcnRpZXNTdGF0ZSB9IGZyb20gJy4vaXRlbS1wcm9wZXJ0aWVzLWU2NDEyYTlhLmpzJztcbmltcG9ydCB7IGQgYXMgYWRkSXRlbVN0b3JlLCBhIGFzIGFkZEl0ZW1TdGF0ZSB9IGZyb20gJy4vYWRkLWl0ZW0tOTdkNTc3YTkuanMnO1xuaW1wb3J0IHsgdSBhcyB1aVN0b3JlU3RhdGUgfSBmcm9tICcuL3VpLWVjZjg2YmJhLmpzJztcblxuZnVuY3Rpb24gcmVzZXRBZGRJdGVtU3RvcmVzKCkge1xuICBhZGRJdGVtU3RvcmUucmVzZXQoKTtcbiAgaXRlbVByb3BlcnRpZXNTdG9yZS5yZXNldCgpO1xufVxuY29uc3QgcmVzZXRTdG9yZU9uSG9tZSA9ICgpID0+IHtcbiAgaWYgKGFkZEl0ZW1TdGF0ZS5leGlzdGluZ0l0ZW0gfHwgdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcInJlZ2lzdGVyXCIpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgYWRkSXRlbVN0b3JlLnJlc2V0KCk7XG4gIGNvbnN0IGZvbGRlciA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuZm9sZGVyO1xuICBpdGVtUHJvcGVydGllc1N0b3JlLnJlc2V0KCk7XG4gIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuZm9sZGVyID0gZm9sZGVyO1xufTtcblxuZXhwb3J0IHsgcmVzZXRTdG9yZU9uSG9tZSBhcyBhLCByZXNldEFkZEl0ZW1TdG9yZXMgYXMgciB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9