"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-group-t-68763e"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-group-thumbnail.entry.js":
/*!*************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-group-thumbnail.entry.js ***!
  \*************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_group_thumbnail: () => (/* binding */ ArcgisGroupThumbnail)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */









/**
 * The following utilities come from calcite components
 * If there is a good way to import ts utils from CC, this should be deleted.
 */
const shortHandHex = /^#[0-9A-F]{3}$/i;
const longhandHex = /^#[0-9A-F]{6}$/i;
function isValidHex(hex) {
  return isShorthandHex(hex) || isLonghandHex(hex);
}
function isShorthandHex(hex) {
  return hex && hex.length === 4 && shortHandHex.test(hex);
}
function isLonghandHex(hex) {
  return hex && hex.length === 7 && longhandHex.test(hex);
}
function hexToRGB(hex) {
  if (!isValidHex(hex)) {
    return null;
  }
  hex = hex.replace("#", "");
  if (hex.length === 3) {
    const [first, second, third] = hex.split("");
    const r = parseInt(`${first}${first}`, 16);
    const g = parseInt(`${second}${second}`, 16);
    const b = parseInt(`${third}${third}`, 16);
    return { r, g, b };
  }
  const r = parseInt(hex.slice(0, 2), 16);
  const g = parseInt(hex.slice(2, 4), 16);
  const b = parseInt(hex.slice(4, 6), 16);
  return { r, g, b };
}
/**
 * Convert a string to a valid hex by hashing its contents
 * and using the hash as a seed for three distinct color values
 *
 * @param str
 */
function stringToHex(str) {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    hash = str.charCodeAt(i) + ((hash << 5) - hash);
  }
  let hex = "#";
  for (let j = 0; j < 3; j++) {
    const value = (hash >> (j * 8)) & 0xff;
    hex += ("00" + value.toString(16)).substr(-2);
  }
  return hex;
}
/**
 * Find the hue of a color given the separate RGB color channels
 *
 * @param rgb
 */
function rgbToHue(rgb) {
  let { r, g, b } = rgb;
  r /= 255;
  g /= 255;
  b /= 255;
  const max = Math.max(r, g, b);
  const min = Math.min(r, g, b);
  const delta = max - min;
  if (max === min) {
    return 0;
  }
  let hue = (max + min) / 2;
  switch (max) {
    case r:
      hue = (g - b) / delta + (g < b ? 6 : 0);
      break;
    case g:
      hue = (b - r) / delta + 2;
      break;
    case b:
      hue = (r - g) / delta + 4;
      break;
  }
  return Math.round(hue * 60);
}
/**
 * For a hex color, find the hue
 *
 * @param hex {string} - form of "#------"
 */
function hexToHue(hex) {
  return rgbToHue(hexToRGB(hex));
}

const arcgisGroupThumbnailCss = ":host{display:inline-block}:host([scale=s]){font-size:0.625rem;height:1.5rem;width:1.5rem}:host([scale=m]){font-size:0.75rem;height:2rem;width:2rem}:host([scale=l]){font-size:1rem;height:2.75rem;width:2.75rem}:host([scale=xl]){font-size:1.25rem;height:4rem;width:4rem}.icon{display:flex;color:var(--calcite-ui-text-3)}.background{display:flex;height:100%;width:100%;align-items:center;justify-content:center;position:relative}.initials{color:var(--calcite-ui-text-2);font-weight:700;text-transform:uppercase;position:absolute}.thumbnail{height:100%;width:100%}.tooltip-text{margin:0;padding:0;font-size:0.75rem;color:var(--calcite-ui-text-2)}calcite-tooltip{pointer-events:none}";

const ArcgisGroupThumbnail = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.openTooltip = () => {
      if (this.tooltipElement) {
        this.tooltipElement.open = true;
      }
    };
    this.closeTooltip = () => {
      if (this.tooltipElement) {
        this.tooltipElement.open = false;
      }
    };
    this.group = undefined;
    this.portal = undefined;
    this.tooltip = undefined;
    this.scale = "m";
    this.error = false;
  }
  //--------------------------------------------------------------------------
  //
  //  Private Methods
  //
  //--------------------------------------------------------------------------
  render() {
    const { group, error, openTooltip, closeTooltip } = this;
    if ((group === null || group === void 0 ? void 0 : group.thumbnail) && !error) {
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("img", { alt: "", class: "thumbnail", onError: () => (this.error = true), ref: (el) => (this.thumbnailElement = el), src: this.getThumbnailURI(), onMouseLeave: closeTooltip, onMouseEnter: openTooltip, onFocusout: closeTooltip, onFocusin: openTooltip }), this.renderTooltip()));
    }
    const initials = this.generateInitials();
    const backgroundColor = this.generateFillColor();
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "background", ref: (el) => (this.thumbnailElement = el), style: { backgroundColor }, onMouseLeave: closeTooltip, onMouseEnter: openTooltip, onFocusout: closeTooltip, onFocusin: openTooltip }, initials ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { "aria-hidden": "true", class: "initials" }, initials)) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { class: "icon", icon: "users", scale: this.scale === "xl" ? "l" : this.scale }))), this.renderTooltip()));
  }
  renderTooltip() {
    if (!this.tooltip) {
      return null;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { ref: (el) => {
        el.referenceElement = this.thumbnailElement;
        this.tooltipElement = el;
      }, closeOnClick: true, label: this.group.title, placement: "bottom-start", offsetDistance: 6, offsetSkidding: 0, class: "tooltip" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "tooltip-text" }, this.group.title)));
  }
  getThumbnailURI() {
    const { group } = this;
    if (!(group === null || group === void 0 ? void 0 : group.thumbnail)) {
      return null;
    }
    // if user begins with a protocol, assume it's already fully qualified
    if (group.thumbnail.startsWith("http")) {
      return group.thumbnail;
    }
    const token = (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.h)(this.portal);
    const tokenParam = token ? `?token=${token}` : "";
    return `${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.portal)}community/groups/${group.id}/info/${group.thumbnail}${tokenParam}`;
  }
  generateFillColor() {
    const { group: { title, id }, el } = this;
    const theme = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_2__.g)(el);
    const idHex = `#${id === null || id === void 0 ? void 0 : id.substr(id.length - 6)}`;
    const hex = id && isValidHex(idHex) ? idHex : stringToHex(title);
    // if there is not unique information, or an invalid hex is produced, return a default
    if ((!id && !title) || !isValidHex(hex)) {
      return `var(--calcite-ui-foreground-2)`;
    }
    const hue = hexToHue(hex);
    const l = theme === "dark" ? 20 : 90;
    return `hsl(${hue}, 60%, ${l}%)`;
  }
  generateInitials() {
    var _a, _b;
    const initial = (_b = (_a = this.group) === null || _a === void 0 ? void 0 : _a.title) === null || _b === void 0 ? void 0 : _b.trim().charAt(0);
    if (initial === null || initial === void 0 ? void 0 : initial.match(/^\w+$/)) {
      return initial;
    }
    return false;
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisGroupThumbnail.style = arcgisGroupThumbnailCss;




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWdyb3VwLXQtNjg3NjNlLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzJGO0FBQ2pCO0FBQ3BCO0FBQ25CO0FBQ0w7QUFDRDtBQUNLO0FBQ0E7O0FBRWxDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLEVBQUU7QUFDbkMsZ0NBQWdDLEVBQUU7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsTUFBTSxFQUFFLE1BQU07QUFDeEMsMEJBQTBCLE9BQU8sRUFBRSxPQUFPO0FBQzFDLDBCQUEwQixNQUFNLEVBQUUsTUFBTTtBQUN4QyxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGdCQUFnQjtBQUNsQztBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsT0FBTztBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxVQUFVO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdUNBQXVDLHFCQUFxQixpQkFBaUIsbUJBQW1CLGNBQWMsYUFBYSxpQkFBaUIsa0JBQWtCLFlBQVksV0FBVyxpQkFBaUIsZUFBZSxlQUFlLGNBQWMsa0JBQWtCLGtCQUFrQixZQUFZLFdBQVcsTUFBTSxhQUFhLCtCQUErQixZQUFZLGFBQWEsWUFBWSxXQUFXLG1CQUFtQix1QkFBdUIsa0JBQWtCLFVBQVUsK0JBQStCLGdCQUFnQix5QkFBeUIsa0JBQWtCLFdBQVcsWUFBWSxXQUFXLGNBQWMsU0FBUyxVQUFVLGtCQUFrQiwrQkFBK0IsZ0JBQWdCLG9CQUFvQjs7QUFFdnNCO0FBQ0E7QUFDQSxJQUFJLHFEQUFnQjtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksMENBQTBDO0FBQ3REO0FBQ0EsY0FBYyxxREFBQyxDQUFDLGlEQUFJLFFBQVEscURBQUMsVUFBVSxrUEFBa1A7QUFDelI7QUFDQTtBQUNBO0FBQ0EsWUFBWSxxREFBQyxDQUFDLGlEQUFJLFFBQVEscURBQUMsV0FBVyx5RUFBeUUsaUJBQWlCLDJHQUEyRyxjQUFjLHFEQUFDLFdBQVcsMENBQTBDLGdCQUFnQixxREFBQyxtQkFBbUIsNkVBQTZFO0FBQ2hhO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHFEQUFDLHNCQUFzQjtBQUNuQztBQUNBO0FBQ0EsT0FBTyxrSUFBa0ksRUFBRSxxREFBQyxRQUFRLHVCQUF1QjtBQUMzSztBQUNBO0FBQ0EsWUFBWSxRQUFRO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLHNEQUFRO0FBQzFCLHlDQUF5QyxNQUFNO0FBQy9DLGNBQWMsc0RBQWMsY0FBYyxtQkFBbUIsU0FBUyxRQUFRLGdCQUFnQixFQUFFLFdBQVc7QUFDM0c7QUFDQTtBQUNBLFlBQVksU0FBUyxXQUFXLE9BQU87QUFDdkMsa0JBQWtCLG1EQUFZO0FBQzlCLHNCQUFzQixpRUFBaUU7QUFDdkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsSUFBSSxTQUFTLEVBQUU7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxPQUFPLHFEQUFVO0FBQzlCO0FBQ0E7O0FBRTBEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLWdyb3VwLXRodW1ibmFpbC5lbnRyeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgaCwgSCBhcyBIb3N0LCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0UmVzdEJhc2VVcmwsIGggYXMgZ2V0VG9rZW4gfSBmcm9tICcuL3BvcnRhbC03OWNhYWVmZi5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldFRoZW1lTmFtZSB9IGZyb20gJy4vZG9tLTEzZjViMDBjLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1hYWYzMGJkNi5qcyc7XG5pbXBvcnQgJy4vY29uZmlnLWViNWY3ZGMyLmpzJztcbmltcG9ydCAnLi9pbmRleC04MWQ1NDhiNy5qcyc7XG5pbXBvcnQgJy4vcHJpdmlsZWdlcy1jY2Q1ZjM3ZC5qcyc7XG5pbXBvcnQgJy4vZnVuY3Rpb25hbC1jODJmNWFiOS5qcyc7XG5cbi8qKlxuICogVGhlIGZvbGxvd2luZyB1dGlsaXRpZXMgY29tZSBmcm9tIGNhbGNpdGUgY29tcG9uZW50c1xuICogSWYgdGhlcmUgaXMgYSBnb29kIHdheSB0byBpbXBvcnQgdHMgdXRpbHMgZnJvbSBDQywgdGhpcyBzaG91bGQgYmUgZGVsZXRlZC5cbiAqL1xuY29uc3Qgc2hvcnRIYW5kSGV4ID0gL14jWzAtOUEtRl17M30kL2k7XG5jb25zdCBsb25naGFuZEhleCA9IC9eI1swLTlBLUZdezZ9JC9pO1xuZnVuY3Rpb24gaXNWYWxpZEhleChoZXgpIHtcbiAgcmV0dXJuIGlzU2hvcnRoYW5kSGV4KGhleCkgfHwgaXNMb25naGFuZEhleChoZXgpO1xufVxuZnVuY3Rpb24gaXNTaG9ydGhhbmRIZXgoaGV4KSB7XG4gIHJldHVybiBoZXggJiYgaGV4Lmxlbmd0aCA9PT0gNCAmJiBzaG9ydEhhbmRIZXgudGVzdChoZXgpO1xufVxuZnVuY3Rpb24gaXNMb25naGFuZEhleChoZXgpIHtcbiAgcmV0dXJuIGhleCAmJiBoZXgubGVuZ3RoID09PSA3ICYmIGxvbmdoYW5kSGV4LnRlc3QoaGV4KTtcbn1cbmZ1bmN0aW9uIGhleFRvUkdCKGhleCkge1xuICBpZiAoIWlzVmFsaWRIZXgoaGV4KSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGhleCA9IGhleC5yZXBsYWNlKFwiI1wiLCBcIlwiKTtcbiAgaWYgKGhleC5sZW5ndGggPT09IDMpIHtcbiAgICBjb25zdCBbZmlyc3QsIHNlY29uZCwgdGhpcmRdID0gaGV4LnNwbGl0KFwiXCIpO1xuICAgIGNvbnN0IHIgPSBwYXJzZUludChgJHtmaXJzdH0ke2ZpcnN0fWAsIDE2KTtcbiAgICBjb25zdCBnID0gcGFyc2VJbnQoYCR7c2Vjb25kfSR7c2Vjb25kfWAsIDE2KTtcbiAgICBjb25zdCBiID0gcGFyc2VJbnQoYCR7dGhpcmR9JHt0aGlyZH1gLCAxNik7XG4gICAgcmV0dXJuIHsgciwgZywgYiB9O1xuICB9XG4gIGNvbnN0IHIgPSBwYXJzZUludChoZXguc2xpY2UoMCwgMiksIDE2KTtcbiAgY29uc3QgZyA9IHBhcnNlSW50KGhleC5zbGljZSgyLCA0KSwgMTYpO1xuICBjb25zdCBiID0gcGFyc2VJbnQoaGV4LnNsaWNlKDQsIDYpLCAxNik7XG4gIHJldHVybiB7IHIsIGcsIGIgfTtcbn1cbi8qKlxuICogQ29udmVydCBhIHN0cmluZyB0byBhIHZhbGlkIGhleCBieSBoYXNoaW5nIGl0cyBjb250ZW50c1xuICogYW5kIHVzaW5nIHRoZSBoYXNoIGFzIGEgc2VlZCBmb3IgdGhyZWUgZGlzdGluY3QgY29sb3IgdmFsdWVzXG4gKlxuICogQHBhcmFtIHN0clxuICovXG5mdW5jdGlvbiBzdHJpbmdUb0hleChzdHIpIHtcbiAgbGV0IGhhc2ggPSAwO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgIGhhc2ggPSBzdHIuY2hhckNvZGVBdChpKSArICgoaGFzaCA8PCA1KSAtIGhhc2gpO1xuICB9XG4gIGxldCBoZXggPSBcIiNcIjtcbiAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHtcbiAgICBjb25zdCB2YWx1ZSA9IChoYXNoID4+IChqICogOCkpICYgMHhmZjtcbiAgICBoZXggKz0gKFwiMDBcIiArIHZhbHVlLnRvU3RyaW5nKDE2KSkuc3Vic3RyKC0yKTtcbiAgfVxuICByZXR1cm4gaGV4O1xufVxuLyoqXG4gKiBGaW5kIHRoZSBodWUgb2YgYSBjb2xvciBnaXZlbiB0aGUgc2VwYXJhdGUgUkdCIGNvbG9yIGNoYW5uZWxzXG4gKlxuICogQHBhcmFtIHJnYlxuICovXG5mdW5jdGlvbiByZ2JUb0h1ZShyZ2IpIHtcbiAgbGV0IHsgciwgZywgYiB9ID0gcmdiO1xuICByIC89IDI1NTtcbiAgZyAvPSAyNTU7XG4gIGIgLz0gMjU1O1xuICBjb25zdCBtYXggPSBNYXRoLm1heChyLCBnLCBiKTtcbiAgY29uc3QgbWluID0gTWF0aC5taW4ociwgZywgYik7XG4gIGNvbnN0IGRlbHRhID0gbWF4IC0gbWluO1xuICBpZiAobWF4ID09PSBtaW4pIHtcbiAgICByZXR1cm4gMDtcbiAgfVxuICBsZXQgaHVlID0gKG1heCArIG1pbikgLyAyO1xuICBzd2l0Y2ggKG1heCkge1xuICAgIGNhc2UgcjpcbiAgICAgIGh1ZSA9IChnIC0gYikgLyBkZWx0YSArIChnIDwgYiA/IDYgOiAwKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgZzpcbiAgICAgIGh1ZSA9IChiIC0gcikgLyBkZWx0YSArIDI7XG4gICAgICBicmVhaztcbiAgICBjYXNlIGI6XG4gICAgICBodWUgPSAociAtIGcpIC8gZGVsdGEgKyA0O1xuICAgICAgYnJlYWs7XG4gIH1cbiAgcmV0dXJuIE1hdGgucm91bmQoaHVlICogNjApO1xufVxuLyoqXG4gKiBGb3IgYSBoZXggY29sb3IsIGZpbmQgdGhlIGh1ZVxuICpcbiAqIEBwYXJhbSBoZXgge3N0cmluZ30gLSBmb3JtIG9mIFwiIy0tLS0tLVwiXG4gKi9cbmZ1bmN0aW9uIGhleFRvSHVlKGhleCkge1xuICByZXR1cm4gcmdiVG9IdWUoaGV4VG9SR0IoaGV4KSk7XG59XG5cbmNvbnN0IGFyY2dpc0dyb3VwVGh1bWJuYWlsQ3NzID0gXCI6aG9zdHtkaXNwbGF5OmlubGluZS1ibG9ja306aG9zdChbc2NhbGU9c10pe2ZvbnQtc2l6ZTowLjYyNXJlbTtoZWlnaHQ6MS41cmVtO3dpZHRoOjEuNXJlbX06aG9zdChbc2NhbGU9bV0pe2ZvbnQtc2l6ZTowLjc1cmVtO2hlaWdodDoycmVtO3dpZHRoOjJyZW19Omhvc3QoW3NjYWxlPWxdKXtmb250LXNpemU6MXJlbTtoZWlnaHQ6Mi43NXJlbTt3aWR0aDoyLjc1cmVtfTpob3N0KFtzY2FsZT14bF0pe2ZvbnQtc2l6ZToxLjI1cmVtO2hlaWdodDo0cmVtO3dpZHRoOjRyZW19Lmljb257ZGlzcGxheTpmbGV4O2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0zKX0uYmFja2dyb3VuZHtkaXNwbGF5OmZsZXg7aGVpZ2h0OjEwMCU7d2lkdGg6MTAwJTthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcjtwb3NpdGlvbjpyZWxhdGl2ZX0uaW5pdGlhbHN7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTIpO2ZvbnQtd2VpZ2h0OjcwMDt0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7cG9zaXRpb246YWJzb2x1dGV9LnRodW1ibmFpbHtoZWlnaHQ6MTAwJTt3aWR0aDoxMDAlfS50b29sdGlwLXRleHR7bWFyZ2luOjA7cGFkZGluZzowO2ZvbnQtc2l6ZTowLjc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0yKX1jYWxjaXRlLXRvb2x0aXB7cG9pbnRlci1ldmVudHM6bm9uZX1cIjtcblxuY29uc3QgQXJjZ2lzR3JvdXBUaHVtYm5haWwgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMub3BlblRvb2x0aXAgPSAoKSA9PiB7XG4gICAgICBpZiAodGhpcy50b29sdGlwRWxlbWVudCkge1xuICAgICAgICB0aGlzLnRvb2x0aXBFbGVtZW50Lm9wZW4gPSB0cnVlO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5jbG9zZVRvb2x0aXAgPSAoKSA9PiB7XG4gICAgICBpZiAodGhpcy50b29sdGlwRWxlbWVudCkge1xuICAgICAgICB0aGlzLnRvb2x0aXBFbGVtZW50Lm9wZW4gPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuZ3JvdXAgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy50b29sdGlwID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2NhbGUgPSBcIm1cIjtcbiAgICB0aGlzLmVycm9yID0gZmFsc2U7XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUHJpdmF0ZSBNZXRob2RzXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgZ3JvdXAsIGVycm9yLCBvcGVuVG9vbHRpcCwgY2xvc2VUb29sdGlwIH0gPSB0aGlzO1xuICAgIGlmICgoZ3JvdXAgPT09IG51bGwgfHwgZ3JvdXAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGdyb3VwLnRodW1ibmFpbCkgJiYgIWVycm9yKSB7XG4gICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImltZ1wiLCB7IGFsdDogXCJcIiwgY2xhc3M6IFwidGh1bWJuYWlsXCIsIG9uRXJyb3I6ICgpID0+ICh0aGlzLmVycm9yID0gdHJ1ZSksIHJlZjogKGVsKSA9PiAodGhpcy50aHVtYm5haWxFbGVtZW50ID0gZWwpLCBzcmM6IHRoaXMuZ2V0VGh1bWJuYWlsVVJJKCksIG9uTW91c2VMZWF2ZTogY2xvc2VUb29sdGlwLCBvbk1vdXNlRW50ZXI6IG9wZW5Ub29sdGlwLCBvbkZvY3Vzb3V0OiBjbG9zZVRvb2x0aXAsIG9uRm9jdXNpbjogb3BlblRvb2x0aXAgfSksIHRoaXMucmVuZGVyVG9vbHRpcCgpKSk7XG4gICAgfVxuICAgIGNvbnN0IGluaXRpYWxzID0gdGhpcy5nZW5lcmF0ZUluaXRpYWxzKCk7XG4gICAgY29uc3QgYmFja2dyb3VuZENvbG9yID0gdGhpcy5nZW5lcmF0ZUZpbGxDb2xvcigpO1xuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImJhY2tncm91bmRcIiwgcmVmOiAoZWwpID0+ICh0aGlzLnRodW1ibmFpbEVsZW1lbnQgPSBlbCksIHN0eWxlOiB7IGJhY2tncm91bmRDb2xvciB9LCBvbk1vdXNlTGVhdmU6IGNsb3NlVG9vbHRpcCwgb25Nb3VzZUVudGVyOiBvcGVuVG9vbHRpcCwgb25Gb2N1c291dDogY2xvc2VUb29sdGlwLCBvbkZvY3VzaW46IG9wZW5Ub29sdGlwIH0sIGluaXRpYWxzID8gKGgoXCJzcGFuXCIsIHsgXCJhcmlhLWhpZGRlblwiOiBcInRydWVcIiwgY2xhc3M6IFwiaW5pdGlhbHNcIiB9LCBpbml0aWFscykpIDogKGgoXCJjYWxjaXRlLWljb25cIiwgeyBjbGFzczogXCJpY29uXCIsIGljb246IFwidXNlcnNcIiwgc2NhbGU6IHRoaXMuc2NhbGUgPT09IFwieGxcIiA/IFwibFwiIDogdGhpcy5zY2FsZSB9KSkpLCB0aGlzLnJlbmRlclRvb2x0aXAoKSkpO1xuICB9XG4gIHJlbmRlclRvb2x0aXAoKSB7XG4gICAgaWYgKCF0aGlzLnRvb2x0aXApIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gKGgoXCJjYWxjaXRlLXRvb2x0aXBcIiwgeyByZWY6IChlbCkgPT4ge1xuICAgICAgICBlbC5yZWZlcmVuY2VFbGVtZW50ID0gdGhpcy50aHVtYm5haWxFbGVtZW50O1xuICAgICAgICB0aGlzLnRvb2x0aXBFbGVtZW50ID0gZWw7XG4gICAgICB9LCBjbG9zZU9uQ2xpY2s6IHRydWUsIGxhYmVsOiB0aGlzLmdyb3VwLnRpdGxlLCBwbGFjZW1lbnQ6IFwiYm90dG9tLXN0YXJ0XCIsIG9mZnNldERpc3RhbmNlOiA2LCBvZmZzZXRTa2lkZGluZzogMCwgY2xhc3M6IFwidG9vbHRpcFwiIH0sIGgoXCJwXCIsIHsgY2xhc3M6IFwidG9vbHRpcC10ZXh0XCIgfSwgdGhpcy5ncm91cC50aXRsZSkpKTtcbiAgfVxuICBnZXRUaHVtYm5haWxVUkkoKSB7XG4gICAgY29uc3QgeyBncm91cCB9ID0gdGhpcztcbiAgICBpZiAoIShncm91cCA9PT0gbnVsbCB8fCBncm91cCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3JvdXAudGh1bWJuYWlsKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8vIGlmIHVzZXIgYmVnaW5zIHdpdGggYSBwcm90b2NvbCwgYXNzdW1lIGl0J3MgYWxyZWFkeSBmdWxseSBxdWFsaWZpZWRcbiAgICBpZiAoZ3JvdXAudGh1bWJuYWlsLnN0YXJ0c1dpdGgoXCJodHRwXCIpKSB7XG4gICAgICByZXR1cm4gZ3JvdXAudGh1bWJuYWlsO1xuICAgIH1cbiAgICBjb25zdCB0b2tlbiA9IGdldFRva2VuKHRoaXMucG9ydGFsKTtcbiAgICBjb25zdCB0b2tlblBhcmFtID0gdG9rZW4gPyBgP3Rva2VuPSR7dG9rZW59YCA6IFwiXCI7XG4gICAgcmV0dXJuIGAke2dldFJlc3RCYXNlVXJsKHRoaXMucG9ydGFsKX1jb21tdW5pdHkvZ3JvdXBzLyR7Z3JvdXAuaWR9L2luZm8vJHtncm91cC50aHVtYm5haWx9JHt0b2tlblBhcmFtfWA7XG4gIH1cbiAgZ2VuZXJhdGVGaWxsQ29sb3IoKSB7XG4gICAgY29uc3QgeyBncm91cDogeyB0aXRsZSwgaWQgfSwgZWwgfSA9IHRoaXM7XG4gICAgY29uc3QgdGhlbWUgPSBnZXRUaGVtZU5hbWUoZWwpO1xuICAgIGNvbnN0IGlkSGV4ID0gYCMke2lkID09PSBudWxsIHx8IGlkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpZC5zdWJzdHIoaWQubGVuZ3RoIC0gNil9YDtcbiAgICBjb25zdCBoZXggPSBpZCAmJiBpc1ZhbGlkSGV4KGlkSGV4KSA/IGlkSGV4IDogc3RyaW5nVG9IZXgodGl0bGUpO1xuICAgIC8vIGlmIHRoZXJlIGlzIG5vdCB1bmlxdWUgaW5mb3JtYXRpb24sIG9yIGFuIGludmFsaWQgaGV4IGlzIHByb2R1Y2VkLCByZXR1cm4gYSBkZWZhdWx0XG4gICAgaWYgKCghaWQgJiYgIXRpdGxlKSB8fCAhaXNWYWxpZEhleChoZXgpKSB7XG4gICAgICByZXR1cm4gYHZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0yKWA7XG4gICAgfVxuICAgIGNvbnN0IGh1ZSA9IGhleFRvSHVlKGhleCk7XG4gICAgY29uc3QgbCA9IHRoZW1lID09PSBcImRhcmtcIiA/IDIwIDogOTA7XG4gICAgcmV0dXJuIGBoc2woJHtodWV9LCA2MCUsICR7bH0lKWA7XG4gIH1cbiAgZ2VuZXJhdGVJbml0aWFscygpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IGluaXRpYWwgPSAoX2IgPSAoX2EgPSB0aGlzLmdyb3VwKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGl0bGUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50cmltKCkuY2hhckF0KDApO1xuICAgIGlmIChpbml0aWFsID09PSBudWxsIHx8IGluaXRpYWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGluaXRpYWwubWF0Y2goL15cXHcrJC8pKSB7XG4gICAgICByZXR1cm4gaW5pdGlhbDtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNHcm91cFRodW1ibmFpbC5zdHlsZSA9IGFyY2dpc0dyb3VwVGh1bWJuYWlsQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNHcm91cFRodW1ibmFpbCBhcyBhcmNnaXNfZ3JvdXBfdGh1bWJuYWlsIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=