"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-927c7f"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-label_3.entry.js":
/*!*****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-label_3.entry.js ***!
  \*****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_label: () => (/* binding */ ArcgisLabel),
/* harmony export */   arcgis_label_content: () => (/* binding */ ArcgisLabelContent),
/* harmony export */   arcgis_label_content_style: () => (/* binding */ ArcgisLabelContentStyle)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./guid-4f4176ba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js");
/* harmony import */ var _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./commonEnums-f98a323c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-f98a323c.js");
/* harmony import */ var _commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./commonFunctions-5262b094.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-5262b094.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./labelStore-a0cf76c4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/labelStore-a0cf76c4.js");
/* harmony import */ var _fontUtil_1aa3a32c_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./fontUtil-1aa3a32c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/fontUtil-1aa3a32c.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */












const CSS$1 = {
  enableLabel: "enable-label",
  enableLabelLabel: "enable-label-label",
  labelSwitch: "label-switch",
  componentDiv: "component-ul"
};

const arcgisLabelCss = ".enable-label{background-color:var(--arcgis-app-background);display:flex;padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-cap-spacing-half) var(--arcgis-app-cap-spacing-quarter);border-bottom:solid 1px var(--arcgis-app-border)}.enable-label-label{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.label-switch{margin:0;flex:0 0 0%;justify-self:flex-end}.component-ul{margin:0 0 var(--arcgis-app-cap-spacing);padding:0}";

const ArcgisLabel = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.labelUpdated = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "labelUpdated", 7);
    this.arcgisLabelDismissedChange = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisLabelDismissedChange", 7);
    this.internalLabelUpdated = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "internalLabelUpdated", 7);
    this.closeLabelPopovers = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeLabelPopovers", 7);
    this.arcgisFilterDone = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisFilterDone", 7);
    this.labelReRender = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "labelReRender", 7);
    // rendor methods
    this.labelComponent = (uniqueGuid, labelClass, blockOpen) => {
      var _a;
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { key: uniqueGuid, id: uniqueGuid }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-label-content", { guid: uniqueGuid, labelClass: labelClass, blockOpen: blockOpen, calciteFlowItem: ((_a = this.calciteFlowProps) === null || _a === void 0 ? void 0 : _a.calciteFlowItem) ||
          this.hostElement.shadowRoot.getElementById("labelFlowItem_Id") })));
    };
    this.mapView = undefined;
    this.layer = undefined;
    this.portal = undefined;
    this.config = undefined;
    this.layerDisplayType = _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.feature;
    this.dismissible = false;
    this.hideLayerTitle = false;
    this.calciteFlowProps = null;
    this.labelComponents = [];
    this.reRender = undefined;
  }
  // lifecycle methods
  async componentWillLoad() {
    [this.strings, this.currentLanguage] = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement);
    this.layerGeometryType = await (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_5__.h)(this.layer);
    this.serviceType = (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_5__.c)(this.layer);
    _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.layer = this.layer;
    _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.mapView = this.mapView;
    _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.portal = this.portal;
    _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.config = this.config;
    _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.strings = this.strings;
    _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.currentLanguage = this.currentLanguage;
    _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.layerGeometryType = this.layerGeometryType;
    _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.serviceType = this.serviceType;
    _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.layerDisplayType = this.layerDisplayType;
    this.labelingInfo =
      this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.feature
        ? this.layer.labelingInfo
        : this.layer.featureReduction.labelingInfo;
    // temp
    if (this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.feature) {
      this.layer.labelsVisible = this.layer.labelsVisible || false;
    }
    else if (this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster) {
      this.layer.featureReduction.labelsVisible =
        this.layer.featureReduction.labelsVisible ||
          false;
    }
    // add for existing
    if (Array.isArray(this.labelingInfo)) {
      this.labelingInfo.forEach((labelClass) => {
        this.addLabelClass(labelClass, this.labelingInfo.length === 1 ? true : false);
      });
    }
  }
  componentDidLoad() {
    var _a;
    this.sortableComponents = this.hostElement.shadowRoot.getElementById("SortableComponents_Id");
    this.calciteFab =
      ((_a = this.calciteFlowProps) === null || _a === void 0 ? void 0 : _a.calciteFab) ||
        this.hostElement.shadowRoot.getElementById("addComponentBtn_Id");
    this.enableDisableLabel(this.getLabelEnabledProp());
    this.calciteFab.onclick = async (event) => {
      event.stopPropagation();
      this.closeLabelPopovers.emit();
      const labelClass = await this.getLabelClass();
      if (this.labelingInfo) {
        this.labelingInfo.push(labelClass);
      }
      else {
        this.labelingInfo = [labelClass];
      }
      this.addLabelClass(labelClass, true);
      this.focusLastLabelClass();
    };
    if (this.flowItemNode) {
      requestAnimationFrame(() => this.flowItemNode.setFocus());
    }
  }
  componentDidUpdate() {
    this.internalLabelUpdated.emit();
  }
  // Events
  mainPopupReRenderHandler(event) {
    event.stopPropagation();
    this.reRender = this.reRender ? false : true;
  }
  deleteComponentHandler(event) {
    event.stopPropagation();
    this.closeLabelPopovers.emit();
    // each div has id. Find id, and splice by index
    const allComponents = this.sortableComponents.getElementsByTagName("div");
    for (let x = 0; x < allComponents.length; x++) {
      if (allComponents[x].id === event.detail) {
        this.labelingInfo.splice(x, 1);
        this.labelComponents.splice(x, 1);
        break;
      }
    }
    this.labelReRender.emit();
    this.calciteFab.setFocus();
  }
  duplicateComponentHandler(event) {
    event.stopPropagation();
    this.closeLabelPopovers.emit();
    // each div has id. Find id, and clone
    const allComponents = this.sortableComponents.getElementsByTagName("div");
    for (let x = 0; x < allComponents.length; x++) {
      if (allComponents[x].id === event.detail) {
        const tempLabelClass = this.labelingInfo[x].clone();
        this.labelingInfo.push(tempLabelClass);
        this.addLabelClass(tempLabelClass, true);
        this.focusLastLabelClass();
        break;
      }
    }
  }
  internalLabelUpdatedHandler(event) {
    event.stopPropagation();
    // if event.detail is true, only update external
    if (this.labelingInfo && !event.detail) {
      if (this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.feature) {
        this.layer.labelingInfo = [...this.labelingInfo];
      }
      else {
        this.layer.featureReduction.labelingInfo = [
          ...this.labelingInfo
        ];
      }
    }
    this.labelUpdated.emit();
  }
  disableLabelPanelHandler(event) {
    var _a;
    event.stopPropagation();
    const panel = ((_a = this.calciteFlowProps) === null || _a === void 0 ? void 0 : _a.calciteFlowItem) ||
      this.hostElement.shadowRoot.getElementById("labelFlowItem_Id");
    panel.disabled = event.detail;
  }
  // Public Methods
  async done() {
    this.arcgisFilterDone.emit();
    this.closeLabelPopovers.emit();
  }
  async setFocus() {
    var _a;
    if (this.flowItemNode) {
      this.flowItemNode.setFocus();
    }
    else {
      (_a = this.labelSwitch) === null || _a === void 0 ? void 0 : _a.focus();
    }
  }
  // private methods and properties
  enableDisableLabel(labelBool) {
    // hide rest of the component.
    const labelDiv = this.hostElement.shadowRoot.getElementById("labelDiv_Id");
    labelDiv.style.display = labelBool ? "block" : "none";
    this.calciteFab.style.display = labelBool ? "block" : "none";
    this.closeLabelPopovers.emit();
  }
  getLabelEnabledProp() {
    switch (this.layerDisplayType) {
      case _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.feature: {
        return this.layer.labelsVisible;
      }
      case _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster: {
        return this.layer.featureReduction
          .labelsVisible;
      }
      default: {
        return this.layer.labelsVisible;
      }
    }
  }
  addLabelClass(labelClass, blockOpen = false) {
    this.labelComponents = [
      ...this.labelComponents,
      this.labelComponent((0,_guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_3__.g)(), labelClass, blockOpen)
    ];
  }
  async getLabelClass() {
    var _a, _b, _c, _d, _e, _f;
    const [LabelClass, colorUtils, clusterLabelCreator, binLabelCreator] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_2__.l)([
      "esri/layers/support/LabelClass",
      "esri/views/support/colorUtils",
      "esri/smartMapping/labels/clusters",
      "esri/smartMapping/labels/bins"
    ]);
    // feature or cluster
    if (this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.feature) {
      return new LabelClass(this.defaultLabelProps(this.defaultSymbolProps(await colorUtils.getBackgroundColor(this.mapView), await colorUtils.getBackgroundColorTheme(this.mapView))));
    }
    else if (((_a = this.layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning") {
      return (((_c = (_b = (await binLabelCreator.getLabelSchemes({
        layer: this.layer
      }))) === null || _b === void 0 ? void 0 : _b.primaryScheme) === null || _c === void 0 ? void 0 : _c.labelingInfo[0]) || null);
    }
    else {
      return (((_f = (_e = (await clusterLabelCreator.getLabelSchemes({
        layer: this.layer,
        renderer: (_d = this.layer) === null || _d === void 0 ? void 0 : _d.renderer,
        view: this.mapView
      }))) === null || _e === void 0 ? void 0 : _e.primaryScheme) === null || _f === void 0 ? void 0 : _f.labelingInfo[0]) || null);
    }
  }
  defaultLabelProps(symbolProps) {
    const defaultFieldName = this.defaultLabelField();
    return {
      // autocasts as new LabelClass()
      symbol: {
        type: "text",
        color: symbolProps.fontColor,
        haloColor: symbolProps.haloColor,
        haloSize: symbolProps.haloSize,
        font: {
          family: symbolProps.fontFamily,
          size: symbolProps.fontSize
        }
      },
      labelExpressionInfo: this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster
        ? {
          expression: `$feature["${defaultFieldName}"]`
        }
        : this.serviceType !== _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.s.mapImage
          ? {
            expression: defaultFieldName
              ? this.layer.fields.some((field) => {
                var _a;
                if (field.name === defaultFieldName) {
                  return ((_a = field === null || field === void 0 ? void 0 : field.domain) === null || _a === void 0 ? void 0 : _a.type) === "coded-value";
                }
              })
                ? `$feature["${defaultFieldName}"]\nDomainName($feature, "${defaultFieldName}")`
                : `$feature["${defaultFieldName}"]`
              : null
          }
          : null,
      labelExpression: this.serviceType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.s.mapImage ? `[${defaultFieldName}]` : null,
      labelPlacement: this.defaultPlacement(),
      maxScale: this.layer.maxScale || 0,
      minScale: this.layer.minScale || 0
    };
  }
  defaultLabelField() {
    let defaultField = null;
    if (this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster) {
      // we know we have at least one field
      defaultField = this.layer.featureReduction
        .fields[0].name;
    }
    else if ("displayField" in this.layer &&
      this.layer.displayField &&
      this.layer.fieldsIndex.get(this.layer.displayField)) {
      defaultField = this.layer.displayField;
    }
    else {
      this.layer.fields.find((field) => {
        if (field.type.toLowerCase().includes("string")) {
          return (defaultField = field.name);
        }
      });
    }
    return defaultField ? defaultField : this.layer.fields[0].name;
  }
  defaultSymbolProps(backgroundColor, backgroundColorTheme) {
    if (backgroundColorTheme === "light") {
      return {
        fontFamily: "Arial",
        fontSize: 13 * 0.75,
        fontColor: "#696969",
        haloColor: "#d3d3d3",
        haloSize: 1
      };
    }
    else if (backgroundColorTheme === "dark") {
      return {
        fontFamily: "Arial",
        fontSize: 13 * 0.75,
        fontColor: "#d3d3d3",
        haloColor: "#696969",
        haloSize: 1
      };
    }
    else {
      return {
        fontFamily: "Arial",
        fontSize: 13 * 0.75,
        fontColor: backgroundColor || "#696969",
        haloColor: "#d3d3d3",
        haloSize: 1 * 0.75
      };
    }
  }
  defaultPlacement() {
    var _a;
    if (this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster &&
      ((_a = this.layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning") {
      return "always-horizontal";
    }
    else if (this.layerGeometryType === "point" || this.layerGeometryType === "multipoint") {
      return "above-center";
    }
    else if (this.layerGeometryType === "polyline") {
      return "center-along";
    }
    else if (this.layerGeometryType === "polygon") {
      return "always-horizontal";
    }
    else {
      return null;
    }
  }
  focusLastLabelClass() {
    setTimeout(() => requestAnimationFrame(() => {
      const blocks = this.hostElement.shadowRoot.querySelectorAll("arcgis-label-content");
      if (blocks === null || blocks === void 0 ? void 0 : blocks.length) {
        blocks[blocks.length - 1].setFocus();
      }
    }), 200);
  }
  labelSwitchAndContent() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: CSS$1.enableLabel, alignment: "start", layout: "inline-space-between" }, this.strings.enableLabels, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { ref: (el) => (this.labelSwitch = el), scale: "s", class: CSS$1.labelSwitch, checked: this.getLabelEnabledProp(), onCalciteSwitchChange: (event) => {
        const checked = event.target.checked;
        switch (this.layerDisplayType) {
          case _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.feature: {
            this.layer.labelsVisible = checked;
            break;
          }
          case _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster: {
            this.layer.featureReduction.labelsVisible = checked;
            break;
          }
          default: {
            this.layer.labelsVisible = checked;
          }
        }
        this.enableDisableLabel(checked);
        this.internalLabelUpdated.emit(true);
      } })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { id: "labelDiv_Id" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { id: "SortableComponents_Id", class: CSS$1.componentDiv }, this.labelComponents))));
  }
  render() {
    const addLabelBtn = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-fab", { id: "addComponentBtn_Id", icon: "plus", slot: "fab", scale: "s", appearance: "outline-fill", kind: "neutral", label: this.strings.addLabel, text: this.strings.addLabel, "text-enabled": true }));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { style: this.calciteFlowProps ? {} : { display: "flex", flex: "1 1 auto", overflow: "hidden" } }, this.calciteFlowProps ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { dir: (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_6__.g)(this.hostElement) }, this.labelSwitchAndContent())) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { dir: (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_6__.g)(this.hostElement) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { id: "labelFlowItem_Id", heading: this.strings.labelFeatures, description: !this.hideLayerTitle ? this.layer.title : undefined, closable: this.dismissible, onCalciteFlowItemClose: (event) => {
        event.stopPropagation();
        this.closeLabelPopovers.emit();
        this.arcgisLabelDismissedChange.emit();
      }, ref: (node) => (this.flowItemNode = node) }, this.labelSwitchAndContent(), addLabelBtn)))));
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLabel.style = arcgisLabelCss;

const CSS = {
  labelContentButtonSection: "label-content-btn-section",
  labelContentButtonExp: "label-content-btn-exp",
  labelContentButton: "label-content-btn",
  labelContentButtonText: "label-content-btn-text",
  labelContentButtonIcon: "label-content-btn-icon",
  fieldExpressionDiv: "field-expression-div"
};

const arcgisLabelContentCss = ".label-content-btn-section{background-color:var(--arcgis-app-background);min-width:100%}.label-content-btn{background:var(--arcgis-app-background-clear);border:1px solid var(--arcgis-app-border);border-radius:var(--arcgis-app-border-radius);display:flex;align-items:center;justify-content:space-between;padding:var(--arcgis-app-cap-spacing-half) var(--arcgis-app-side-spacing-quarter);cursor:pointer;width:100%;text-align:unset;transition:background-color var(--arcgis-app-animation-time-fast) var(--arcgis-app-easing-function), border-color var(--arcgis-app-animation-time-fast) var(--arcgis-app-easing-function)}.label-content-btn:hover{background-color:var(--arcgis-app-background-hover);border-color:var(--arcgis-app-border-hover)}.label-content-btn-exp{width:calc(100% - 32px)}.label-content-btn-exp .label-content-btn{border:none;border-radius:0;border-right:1px solid var(--arcgis-app-border)}.label-content-btn-text{font-family:var(--arcgis-app-font-family);font-size:var(--arcgis-app-font-size-0);flex:0 1 auto;overflow:hidden;padding:0 var(--arcgis-app-side-spacing-eighth);text-overflow:ellipsis;white-space:nowrap}.label-content-btn-icon{flex:0 0 0%;padding:0 var(--arcgis-app-side-spacing-half)}.field-expression-div{align-items:center;display:flex;justify-content:space-between;width:100%;border:1px solid var(--arcgis-app-border);border-radius:var(--arcgis-app-border-radius)}.field-expression-div calcite-action{flex:0 0 auto}#slider_Id{min-width:100%}";

const ArcgisLabelContent = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.closeLabelPopovers = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeLabelPopovers", 7);
    this.internalLabelUpdated = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "internalLabelUpdated", 7);
    this.labelContentReRender = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "labelContentReRender", 7);
    this.disableLabelPanel = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "disableLabelPanel", 7);
    this.defaultScript = "";
    this.aggregationExpressionMapping = new Map();
    this.fieldPickListChanges = async (event) => {
      var _a, _b;
      event.stopPropagation();
      const selectedField = (_b = (_a = event.detail) === null || _a === void 0 ? void 0 : _a.selectedFields) === null || _b === void 0 ? void 0 : _b[0];
      if (selectedField) {
        if (this.serviceType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.s.mapImage) {
          this.labelClass.labelExpression = `[${selectedField}]`;
        }
        else {
          if (this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster) {
            if (this.aggregationExpressionMapping.has(selectedField)) {
              this.labelClass.labelExpressionInfo.expression =
                this.aggregationExpressionMapping.get(selectedField);
            }
            else {
              for (const [fieldName, expression] of this.aggregationExpressionMapping) {
                if (fieldName === selectedField) {
                  this.labelClass.labelExpressionInfo.expression = expression;
                }
              }
            }
          }
          else {
            this.labelClass.labelExpressionInfo = this.layer.fields.some((field) => {
              var _a;
              if (field.name === selectedField) {
                return ((_a = field === null || field === void 0 ? void 0 : field.domain) === null || _a === void 0 ? void 0 : _a.type) === "coded-value";
              }
            })
              ? {
                expression: `$feature["${selectedField}"]\nDomainName($feature, "${selectedField}")`
              }
              : {
                expression: `$feature["${selectedField}"]`
              };
          }
        }
        this.labelContentReRender.emit();
      }
      this.closeLabelPopovers.emit();
    };
    this.guid = undefined;
    this.blockOpen = false;
    this.labelClass = undefined;
    this.calciteFlowItem = undefined;
    this.reRender = undefined;
  }
  // lifecycle methods
  async componentWillLoad() {
    this.layer = _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.layer;
    this.mapView = _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.mapView;
    this.portal = _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.portal;
    this.config = _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.config;
    this.strings = _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.strings;
    this.currentLanguage = _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.currentLanguage;
    this.layerDisplayType = _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.layerDisplayType;
    this.serviceType = _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.serviceType;
    this.popupTemplate =
      this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.feature
        ? this.layer.popupTemplate
        : this.layer.featureReduction.popupTemplate;
    this.labelFields = await this.getFieldsForLabeling();
    this.defaultScript = `// ${this.strings.arcadeScriptLine1} \n// ${this.strings.arcadeScriptLine2}\n// $feature.name + " " + $feature.status\n`;
    if (!this.calciteFlowItem) {
      this.calciteFlowItem = this.hostElement.closest("#labelFlowItem_Id");
    }
    // setup mapping for cluster case. We dont want to use default values since there is no formatting.
    if (this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster) {
      [this.binLabelCreator, this.clusterLabelCreator] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_2__.l)([
        "esri/smartMapping/labels/bins",
        "esri/smartMapping/labels/clusters"
      ]);
      const getSchemesForField = async (fieldName) => {
        var _a, _b;
        let labelSchemes;
        if (((_a = this.layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning") {
          labelSchemes = await this.binLabelCreator.getLabelSchemes({
            layer: this.layer,
            field: fieldName
          });
        }
        else {
          labelSchemes = await this.clusterLabelCreator.getLabelSchemes({
            layer: this.layer,
            renderer: (_b = this.layer) === null || _b === void 0 ? void 0 : _b.renderer,
            view: this.mapView,
            field: fieldName
          });
        }
        const allSchemes = [labelSchemes === null || labelSchemes === void 0 ? void 0 : labelSchemes.primaryScheme, ...labelSchemes === null || labelSchemes === void 0 ? void 0 : labelSchemes.secondarySchemes];
        allSchemes.forEach((clusterScheme) => {
          var _a, _b, _c;
          this.aggregationExpressionMapping.set(clusterScheme === null || clusterScheme === void 0 ? void 0 : clusterScheme.fieldName, (_c = (_b = (_a = clusterScheme === null || clusterScheme === void 0 ? void 0 : clusterScheme.labelingInfo) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.labelExpressionInfo) === null || _c === void 0 ? void 0 : _c.expression);
        });
      };
      const calls = [];
      this.labelFields.forEach((field) => {
        calls.push(getSchemesForField(field.name));
      });
      await Promise.all(calls);
    }
  }
  componentDidLoad() {
    this.addScaleRangeSlider();
  }
  componentDidUpdate() {
    this.internalLabelUpdated.emit();
  }
  disconnectedCallback() {
    if (this.arcgisFieldPickList) {
      document.body.removeChild(this.arcgisFieldPickList);
    }
    if (this.labelStyle) {
      document.body.removeChild(this.labelStyle);
    }
    if (this.popoverRenameForm) {
      document.body.removeChild(this.popoverRenameForm);
    }
    if (this.labelFilter) {
      document.body.removeChild(this.labelFilter);
    }
  }
  async setFocus() {
    if (this.blockOpen) {
      this.blockOptions.scrollIntoView({ behavior: "smooth", block: "nearest", inline: "start" });
      this.blockOptions.setFocus();
    }
  }
  // Events
  calciteBlockToggleHandler() {
    this.closeLabelPopovers.emit();
  }
  labelContentReRenderHandler(event) {
    event.stopPropagation();
    this.reRender = this.reRender ? false : true;
  }
  closeLabelPopoversHandler() {
    if (this.arcgisFieldPickList) {
      document.body.removeChild(this.arcgisFieldPickList);
      this.arcgisFieldPickList = null;
      this.attributesBtn.focus();
    }
    if (this.labelStyle) {
      document.body.removeChild(this.labelStyle);
      this.labelStyle = null;
      this.styleBtn.focus();
    }
    if (this.popoverRenameForm) {
      document.body.removeChild(this.popoverRenameForm);
      this.popoverRenameForm = null;
      this.blockOptions.setFocus();
    }
    if (this.labelFilter) {
      document.body.removeChild(this.labelFilter);
      this.labelFilter = null;
      this.filterBtn.focus();
    }
    this.disableLabelPanel.emit(false);
  }
  notifySymbolChangesHandler(event) {
    if (this.guid === event.detail) {
      event.stopPropagation();
      this.labelContentReRender.emit();
    }
  }
  notifyFilterUpdatedHandler(event) {
    if (this.guid === event.detail) {
      event.stopPropagation();
      this.labelContentReRender.emit();
    }
  }
  renameComponentHandler(event) {
    if (this.guid === event.detail) {
      this.closeLabelPopovers.emit();
      event.stopPropagation();
      if (!this.popoverRenameForm) {
        this.popoverRenameForm = document.createElement("arcgis-popover-rename-form");
        this.popoverRenameForm.guid = this.guid;
        this.popoverRenameForm.refElement = this.hostElement;
        this.popoverRenameForm.popoverPanelWidth = this.hostElement.getBoundingClientRect().width;
        this.popoverRenameForm.intlRenameHeader = this.strings.popoverRenameHeader;
        this.popoverRenameForm.intlOk = this.strings.ok;
        this.popoverRenameForm.intlCancel = this.strings.cancel;
        this.popoverRenameForm.intlClose = this.strings.close;
        this.popoverRenameForm.inputValue =
          this.labelClass.name || this.getDisplayFieldName() || this.strings.label;
        document.body.appendChild(this.popoverRenameForm);
        this.disableLabelPanel.emit(true);
      }
    }
  }
  popoverRenameFormEventHandler(event) {
    if (this.guid === event.detail[0]) {
      event.stopPropagation();
      this.closeLabelPopovers.emit();
      if (event.detail[1]) {
        this.labelClass.name = event.detail[1];
        this.labelContentReRender.emit();
      }
    }
  }
  // private methods and properties
  // lookup popupinfo for alias
  async getFieldsForLabeling() {
    var _a;
    if (this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.feature) {
      const layerFields = await (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_5__.j)(this.layer);
      if ((_a = this.popupTemplate) === null || _a === void 0 ? void 0 : _a.fieldInfos) {
        let fieldsWithAlias = [];
        layerFields
          .filter((layerField) => [
          "string",
          "small-integer",
          "big-integer",
          "integer",
          "single",
          "double",
          "long",
          "date",
          "date-only",
          "time-only",
          "timestamp-offset",
          "oid",
          "guid",
          "global-id"
        ].indexOf(layerField.type) > -1)
          .forEach((layerField) => {
          fieldsWithAlias = [...fieldsWithAlias, layerField.clone()];
          this.popupTemplate.fieldInfos.find((popupField) => {
            if (popupField.fieldName === layerField.name) {
              fieldsWithAlias[fieldsWithAlias.length - 1].alias = popupField.label;
            }
          });
        });
        return fieldsWithAlias;
      }
      else {
        return layerFields;
      }
    }
    else {
      return (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_5__.k)(this.popupTemplate, false);
    }
  }
  // open popover
  async openAttributesList() {
    // close first since we can have multiple attributes open
    this.closeLabelPopovers.emit();
    this.calciteFlowItem.loading = true;
    // lazy load attribute selection component
    if (!this.arcgisFieldPickList) {
      this.arcgisFieldPickList = document.createElement("arcgis-field-pick-list");
      this.arcgisFieldPickList.popoverProps = {
        refElement: this.calciteFlowItem,
        offsetSkidding: 50
      };
      this.arcgisFieldPickList.fields = this.labelFields;
      this.arcgisFieldPickList.layer = this.layer;
      this.arcgisFieldPickList.mapView = this.mapView;
      this.arcgisFieldPickList.showFieldInfo =
        this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.feature;
      this.arcgisFieldPickList.selectedFields =
        [this.labelClass.getLabelExpressionSingleField()] || 0 ||
          0;
      this.arcgisFieldPickList.addEventListener("arcgisFieldPickListDismissed", this.fieldPickListChanges);
      document.body.appendChild(this.arcgisFieldPickList);
      this.disableLabelPanel.emit(true);
    }
    this.calciteFlowItem.loading = false;
  }
  // get fieldname from cluster expression
  getFieldNameFromAggregationExpression() {
    var _a, _b;
    if (this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster) {
      for (const [fieldName, expression] of this.aggregationExpressionMapping) {
        if (expression === ((_b = (_a = this.labelClass) === null || _a === void 0 ? void 0 : _a.labelExpressionInfo) === null || _b === void 0 ? void 0 : _b.expression)) {
          return fieldName;
        }
      }
    }
  }
  // open popover
  openLabelStyle() {
    // close first since we can have multiple attributes open
    this.closeLabelPopovers.emit();
    // lazy load attribute selection component
    if (!this.labelStyle) {
      this.labelStyle = document.createElement("arcgis-label-content-style");
      this.labelStyle.guid = this.guid;
      this.labelStyle.labelContentRefElement = this.calciteFlowItem;
      this.labelStyle.labelClass = this.labelClass;
      document.body.appendChild(this.labelStyle);
      this.disableLabelPanel.emit(true);
    }
  }
  async openArcadeEditor() {
    var _a, _b, _c;
    this.closeLabelPopovers.emit();
    if (!this.arcadeEditor) {
      this.calciteFlowItem.disabled = true;
      this.arcadeEditor = document.createElement("arcgis-modal-arcade");
      this.arcadeEditor.arcadeScript = ((_a = this.labelClass.labelExpressionInfo) === null || _a === void 0 ? void 0 : _a.expression) || "";
      this.arcadeEditor.arcadeProfile = this.getArcadeProfile();
      this.arcadeEditor.testData = await this.getArcadeTestData();
      this.arcadeEditor.addExistingExpressions = true;
      this.arcadeEditor.layer = this.layer;
      this.arcadeEditor.arcadeTitle =
        ((_b = this.labelClass.labelExpressionInfo) === null || _b === void 0 ? void 0 : _b.title) || this.strings.newExpression;
      this.arcadeEditor.arcadeTitleEditable = true;
      this.arcadeEditor.returnPredictOutputType = false;
      this.arcadeEditor.arcadeTitleEditingEnabled = !((_c = this.labelClass.labelExpressionInfo) === null || _c === void 0 ? void 0 : _c.title);
      document.body.appendChild(this.arcadeEditor);
      this.arcadeEditor.addEventListener("arcgisModalArcadeClose", (event) => this.arcadeSetup(event.detail));
    }
  }
  async arcadeSetup(arcadeObject) {
    var _a;
    if (arcadeObject) {
      if ((_a = this.labelClass.labelExpressionInfo) === null || _a === void 0 ? void 0 : _a.expression) {
        this.labelClass.labelExpressionInfo.expression = arcadeObject.script;
        this.labelClass.labelExpressionInfo.title = arcadeObject.title;
      }
      else {
        this.labelClass.labelExpressionInfo = {
          expression: arcadeObject.script,
          title: arcadeObject.title
        };
      }
      this.labelContentReRender.emit();
    }
    this.calciteFlowItem.disabled = false;
    document.body.removeChild(this.arcadeEditor);
    this.arcadeEditor = null;
    this.arcadeBtn.setFocus();
  }
  getArcadeProfile() {
    return {
      id: "labeling",
      definitions: {
        $feature: this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster
          ? { fields: (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_5__.k)(this.popupTemplate, false) }
          : this.layer
      }
    };
  }
  async getArcadeTestData() {
    try {
      if (this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster) {
        return {
          profileVariableInstances: {
            $feature: await (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_5__.l)(this.mapView, this.layer, this.popupTemplate)
          },
          spatialReference: this.mapView.spatialReference,
          timeZone: this.mapView.timeZone
        };
      }
      let url;
      if (this.layer.type === "subtype-sublayer") {
        url = this.layer.parent.url;
      }
      else {
        url = this.layer.url;
      }
      return {
        profileVariableInstances: {
          $feature: (await (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_5__.m)(this.layer, this.mapView)).features[0],
          $layer: this.layer,
          $map: this.mapView.map,
          $datastore: url
        },
        spatialReference: this.mapView.spatialReference,
        timeZone: this.mapView.timeZone
      };
    }
    catch (error) {
      console.log(error);
    }
  }
  getDisplayFieldName() {
    const labelFieldName = this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster
      ? this.getFieldNameFromAggregationExpression()
      : this.labelClass.getLabelExpressionSingleField();
    const tempField = this.labelFields.find((field) => {
      if (field.name === labelFieldName) {
        return field;
      }
    });
    return (tempField === null || tempField === void 0 ? void 0 : tempField.alias) || labelFieldName;
  }
  // rendor methods
  addScaleRangeSlider() {
    const { labelClass } = this;
    (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/widgets/ScaleRangeSlider"]).then(([ScaleRangeSlider]) => {
      var _a, _b;
      const sliderElement = this.hostElement.shadowRoot.getElementById("slider_Id");
      const scaleRangeSlider = new ScaleRangeSlider({
        view: this.mapView,
        region: ((_a = this.portal) === null || _a === void 0 ? void 0 : _a.region) || ((_b = this.portal) === null || _b === void 0 ? void 0 : _b.getRegion().toLowerCase()) || "wo",
        minScale: labelClass.minScale || 0,
        maxScale: labelClass.maxScale || 0
      }, sliderElement);
      sliderElement.insertAdjacentHTML("afterbegin", `<link rel="stylesheet" href="${this.config.jsapiUrl}/themes/light/main.css" />`);
      scaleRangeSlider.watch(["minScale", "maxScale"], (value, _oldValue, name) => {
        if (name === "minScale") {
          labelClass.minScale = value;
        }
        else if (name === "maxScale") {
          labelClass.maxScale = value;
        }
        this.closeLabelPopovers.emit();
        this.labelContentReRender.emit();
      });
    });
  }
  render() {
    var _a, _b, _c;
    const { blockOpen, guid, strings } = this;
    const allowExpressions = this.serviceType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.s.feature ||
      (this.serviceType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.s.mapImage &&
        ((_b = (_a = this.layer.layer.capabilities) === null || _a === void 0 ? void 0 : _a.exportMap) === null || _b === void 0 ? void 0 : _b.supportsArcadeExpressionForLabeling));
    const labelAttributeBlock = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.labelAttribute, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.fieldExpressionDiv }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: allowExpressions ? CSS.labelContentButtonExp : CSS.labelContentButtonSection }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { ref: (el) => (this.attributesBtn = el), class: CSS.labelContentButton, title: strings.field, onClick: (event) => {
        event.stopPropagation();
        this.openAttributesList();
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: CSS.labelContentButtonText }, this.getDisplayFieldName() ||
      ((_c = this.labelClass.labelExpressionInfo) === null || _c === void 0 ? void 0 : _c.title) ||
      strings.newExpression), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: CSS.labelContentButtonIcon }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "chevron-down" })))), allowExpressions && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.arcadeBtn = el), scale: "s", text: strings.expression, onClick: (event) => {
        event.stopPropagation();
        this.openArcadeEditor();
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "code" }))))));
    const labelFilterBlock = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.filter, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.labelContentButtonSection }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { ref: (el) => (this.filterBtn = el), class: CSS.labelContentButton, title: strings.editLabelFilter, onClick: (event) => {
        event.stopPropagation();
        this.closeLabelPopovers.emit();
        if (!this.labelFilter) {
          this.labelFilter = document.createElement("arcgis-label-content-filter");
          this.labelFilter.guid = this.guid;
          this.labelFilter.labelFilterRefElement = this.calciteFlowItem;
          this.labelFilter.labelClass = this.labelClass;
          document.body.appendChild(this.labelFilter);
          this.disableLabelPanel.emit(true);
        }
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: CSS.labelContentButtonText }, strings.editLabelFilter), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: CSS.labelContentButtonIcon }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "chevron-down" }))))));
    const labelStyleBlock = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.labelStyle, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.labelContentButtonSection }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { ref: (el) => (this.styleBtn = el), class: CSS.labelContentButton, title: strings.editLabelStyle, onClick: (event) => {
        event.stopPropagation();
        this.openLabelStyle();
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: CSS.labelContentButtonText }, strings.editLabelStyle), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: CSS.labelContentButtonIcon }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "chevron-down" }))))));
    const sliderBlock = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.visibleRange, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { id: "slider_Id" })));
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { dir: (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_6__.g)(this.hostElement), heading: this.labelClass.name || this.getDisplayFieldName() || this.strings.label, collapsible: true, open: blockOpen }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "control" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-calcite-block-options", { ref: (el) => (this.blockOptions = el), guid: guid, intlOptions: strings.options, intlDelete: strings.delete, intlDuplicate: strings.duplicate, intlRename: strings.rename, calciteBlockOptions: { hasDelete: true, hasDuplicate: true, hasRename: true } })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "icon" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "m", icon: "label" })), labelAttributeBlock, this.serviceType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.s.ogcFeature ||
      this.serviceType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.s.wfs ||
      this.serviceType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.s.subtype
      ? null
      : labelFilterBlock, labelStyleBlock, sliderBlock)));
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLabelContent.style = arcgisLabelContentCss;

const arcgisLabelContentStyleCss = ".offset-div{align-items:center;display:flex;justify-content:space-between;gap:16px}";

const ArcgisLabelContentStyle = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.closeLabelPopovers = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeLabelPopovers", 7);
    this.notifySymbolChanges = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "notifySymbolChanges", 7);
    this.minMaxOffset = {
      minOffsetX: -20,
      minOffsetY: -20,
      maxOffsetX: 20,
      maxOffsetY: 20
    };
    // open font popover
    this.openFontPopover = () => {
      var _a, _b;
      if (!this.arcgisFontPicker) {
        this.panelElement.disabled = true;
        this.arcgisFontPicker = document.createElement("arcgis-font-picker");
        this.arcgisFontPicker.fontMap = this.fontMap;
        this.arcgisFontPicker.font = (_b = (_a = this.labelClass) === null || _a === void 0 ? void 0 : _a.symbol) === null || _b === void 0 ? void 0 : _b.font;
        this.arcgisFontPicker.popoverProps = {
          refElement: this.panelElement
        };
        this.arcgisFontPicker.addEventListener("arcgisFontPickerDismissed", this.closeFontPopver);
        this.arcgisFontPicker.addEventListener("arcgisFontPickerChange", this.changeFont);
        document.body.appendChild(this.arcgisFontPicker);
      }
    };
    this.closeFontPopver = () => {
      if (this.arcgisFontPicker) {
        this.panelElement.disabled = false;
        document.body.removeChild(this.arcgisFontPicker);
        this.arcgisFontPicker = null;
        setTimeout(() => {
          // doesn't work without timeout
          this.panelElement.setFocus();
        }, 100);
      }
    };
    this.changeFont = (event) => {
      var _a, _b;
      const font = event === null || event === void 0 ? void 0 : event.detail;
      const labelClassFont = (_b = (_a = this.labelClass) === null || _a === void 0 ? void 0 : _a.symbol) === null || _b === void 0 ? void 0 : _b.font;
      if (font && labelClassFont) {
        labelClassFont.family = font.family;
        labelClassFont.weight = font.weight;
        labelClassFont.style = font.style;
      }
      this.reRender = !this.reRender;
      this.notifySymbolChanges.emit(this.guid);
    };
    this.guid = undefined;
    this.labelContentRefElement = undefined;
    this.labelClass = undefined;
    this.isOpen = false;
    this.reRender = false;
  }
  // lifecycle methods
  componentWillLoad() {
    this.layer = _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.layer;
    this.portal = _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.portal;
    this.strings = _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.strings;
    this.layerGeometryType = _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.layerGeometryType;
    this.serviceType = _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.serviceType;
    this.layerDisplayType = _labelStore_a0cf76c4_js__WEBPACK_IMPORTED_MODULE_7__.l.layerDisplayType;
    this.fontMap =
      this.serviceType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.s.mapImage ? _fontUtil_1aa3a32c_js__WEBPACK_IMPORTED_MODULE_8__.m : _fontUtil_1aa3a32c_js__WEBPACK_IMPORTED_MODULE_8__.f;
  }
  componentDidLoad() {
    this.isOpen = true;
    // need timeout because of re-render
    setTimeout(() => requestAnimationFrame(() => this.panelElement.setFocus()), 200);
  }
  // Public method
  async reposition() {
    var _a;
    (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.reposition();
  }
  // Events
  async calciteBlockSectionToggleHandler(event) {
    event.stopPropagation();
    const composedPath = event.composedPath();
    // halo
    if ((composedPath === null || composedPath === void 0 ? void 0 : composedPath[0].id) === "haloBlock_Id") {
      if (this.labelClass.symbol.haloColor) {
        this.tempHaloColor = this.labelClass.symbol.haloColor;
        this.labelClass.symbol.haloColor = null;
      }
      else {
        await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/Color"]).then(async ([Color]) => {
          var _a;
          this.labelClass.symbol.haloColor = this.tempHaloColor || new Color("white");
          this.labelClass.symbol.haloSize = this.labelClass.symbol.haloSize || 1 * 0.75;
          const haloColorPickerComponent = this.hostElement.shadowRoot.getElementById("haloColorPicker_Id");
          haloColorPickerComponent.color = ((_a = this.labelClass.symbol.haloColor) === null || _a === void 0 ? void 0 : _a.toHex()) || "#ffffff";
        });
      }
    }
    this.notifySymbolChanges.emit(this.guid);
    this.hostElement.shadowRoot.getElementById("managePopover_Id")["reposition"]();
  }
  // private methods and properties
  getPlacementArray(layerGeometryType) {
    var _a;
    if (this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster &&
      ((_a = this.layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning") {
      return [];
    }
    else if (layerGeometryType === "point" || layerGeometryType === "multipoint") {
      return _fontUtil_1aa3a32c_js__WEBPACK_IMPORTED_MODULE_8__.p;
    }
    else if (layerGeometryType === "polyline") {
      return _fontUtil_1aa3a32c_js__WEBPACK_IMPORTED_MODULE_8__.a;
    }
    else {
      return [];
    }
  }
  changeOffset(offset) {
    this.labelClass.symbol.xoffset = offset.x;
    this.offsetXElement.value = this.labelClass.symbol.xoffset;
    this.offsetXYSlider.x = offset.x;
    this.labelClass.symbol.yoffset = offset.y;
    this.offsetYElement.value = this.labelClass.symbol.yoffset;
    this.offsetXYSlider.y = -offset.y;
    this.notifySymbolChanges.emit(this.guid);
  }
  // rendor methods
  placementSelection() {
    var _a;
    if (!(this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster &&
      ((_a = this.layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning") &&
      (([
        _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.s.feature,
        _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.s.csv,
        _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.s.geojson,
        _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.s.ogcFeature
      ].indexOf(this.serviceType) > -1 &&
        (this.layerGeometryType === "point" || this.layerGeometryType === "multipoint")) ||
        (this.serviceType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.s.mapImage &&
          (this.layerGeometryType === "point" ||
            this.layerGeometryType === "multipoint" ||
            this.layerGeometryType === "polyline")))) {
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.placement, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: this.strings.placement, onCalciteSelectChange: (event) => {
          this.labelClass.labelPlacement = event.currentTarget.selectedOption.value;
          this.notifySymbolChanges.emit(this.guid);
        }, ref: (node) => (this.placementNode = node) }, this.getPlacementArray(this.layerGeometryType).map((placement) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: placement, selected: this.labelClass.labelPlacement === placement ? true : false }, this.strings[placement] || placement))))));
    }
    else {
      return null;
    }
  }
  render() {
    var _a, _b, _c, _d, _e, _f, _g;
    const isBinning = this.layerDisplayType === _commonEnums_f98a323c_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster &&
      ((_a = this.layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning";
    const fontFamilySelection = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.font, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { alignment: "icon-end-space-between", appearance: "outline-fill", kind: "neutral", iconEnd: "chevron-down", label: (0,_fontUtil_1aa3a32c_js__WEBPACK_IMPORTED_MODULE_8__.b)((_c = (_b = this.labelClass) === null || _b === void 0 ? void 0 : _b.symbol) === null || _c === void 0 ? void 0 : _c.font), width: "full", scale: "m", onClick: this.openFontPopover, ref: (node) => (this.fontNode = node) }, (0,_fontUtil_1aa3a32c_js__WEBPACK_IMPORTED_MODULE_8__.b)((_e = (_d = this.labelClass) === null || _d === void 0 ? void 0 : _d.symbol) === null || _e === void 0 ? void 0 : _e.font))));
    const fontSizeSelection = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.size, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "number", scale: "s", min: 5, max: 125, value: `${this.labelClass.symbol.font.size / 0.75 || 5}`, onCalciteInputInput: (event) => {
        this.waitOnUser(event, () => {
          const node = event.target;
          this.labelClass.symbol.font.size = Number(node.value) * 0.75;
          this.notifySymbolChanges.emit(this.guid);
        }, 5);
      } })));
    const offset = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "offset-div" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.offset, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-xy-slider", { ref: (el) => {
        this.offsetXYSlider = el;
      }, x: this.labelClass.symbol.xoffset || 0, y: -this.labelClass.symbol.yoffset || 0, minX: this.minMaxOffset.minOffsetX, minY: this.minMaxOffset.minOffsetY, maxX: this.minMaxOffset.maxOffsetX, maxY: this.minMaxOffset.maxOffsetY, step: 1, snappable: true, onArcgisXYSliderInput: (event) => {
        event.stopPropagation();
        const slider = event.currentTarget;
        this.changeOffset({
          x: slider.x || 0,
          y: -slider.y || 0
        });
      } })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: "s" }, this.strings.offsetX, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "number", scale: "s", placeholder: this.strings.offsetX, value: `${this.labelClass.symbol.xoffset || 0}`, min: this.minMaxOffset.minOffsetX, max: this.minMaxOffset.maxOffsetX, ref: (element) => {
        this.offsetXElement = element;
      }, onCalciteInputInput: (event) => {
        this.waitOnUser(event, () => {
          this.changeOffset({
            x: Number(this.offsetXElement.value) || 0,
            y: Number(this.offsetYElement.value) || 0
          });
        }, 0);
      } })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: "s" }, this.strings.offsetY, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "number", scale: "s", placeholder: this.strings.offsetY, value: `${this.labelClass.symbol.yoffset || 0}`, min: this.minMaxOffset.minOffsetY, max: this.minMaxOffset.maxOffsetY, ref: (element) => {
        this.offsetYElement = element;
      }, onCalciteInputInput: (event) => {
        this.waitOnUser(event, () => {
          this.changeOffset({
            x: Number(this.offsetXElement.value) || 0,
            y: Number(this.offsetYElement.value) || 0
          });
        }, 0);
      } })))));
    const allowOverrun = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { alignment: "start", layout: "inline-space-between" }, this.strings.allowOverrun, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: this.labelClass.allowOverrun, onCalciteSwitchChange: (event) => {
        this.labelClass.allowOverrun = event.target.checked;
        this.notifySymbolChanges.emit(this.guid);
      } })));
    const repeatLabel = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { alignment: "start", layout: "inline-space-between" }, this.strings.repeatLabel, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: this.labelClass.repeatLabel, onCalciteSwitchChange: (event) => {
        this.labelClass.repeatLabel = event.target.checked;
        this.reRender = !this.reRender;
        this.notifySymbolChanges.emit(this.guid);
      } })));
    const repeatLabelDistance = ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.labelRepeat, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { disabled: !this.labelClass.repeatLabel, type: "number", scale: "s", min: 0, value: `${this.labelClass.repeatLabelDistance || 0}`, onCalciteInputInput: (event) => {
        this.waitOnUser(event, () => {
          const node = event.target;
          this.labelClass.repeatLabelDistance = Number(node.value);
          this.notifySymbolChanges.emit(this.guid);
        }, 0);
      } })));
    const haloBlock = this.panelElement && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block-section", { id: "haloBlock_Id", text: this.strings.halo, toggleDisplay: "switch", open: this.labelClass.symbol.haloColor ? true : false }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.color, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-input", { id: "haloColorPicker_Id", color: ((_f = this.labelClass.symbol.haloColor) === null || _f === void 0 ? void 0 : _f.toHex()) || "#ffffff", popoverProps: {
        refElement: this.panelElement,
        placement: "leading-start",
        offsetDistance: -Math.round(this.panelElement.getBoundingClientRect().width),
        offsetSkidding: 50
      }, onArcgisColorInputChange: async (event) => {
        const currColor = event.target.color;
        await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/Color"]).then(([Color]) => {
          this.labelClass.symbol.haloColor = new Color(currColor);
          this.notifySymbolChanges.emit(this.guid);
        });
      }, onArcgisColorInputPopoverOpen: () => {
        // give it some time in case another arcgis-color-input has to close first
        setTimeout(() => {
          this.fontNode.disabled = true;
          this.placementNode.disabled = true;
        }, 200);
      }, onArcgisColorInputPopoverClose: () => {
        this.fontNode.disabled = false;
        this.placementNode.disabled = false;
      } })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.size, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "number", scale: "s", min: 1, max: 10, value: `${Math.round(this.labelClass.symbol.haloSize / 0.75 || 1)}`, onCalciteInputInput: (event) => {
        this.waitOnUser(event, () => {
          const node = event.target;
          this.labelClass.symbol.haloSize = Number(node.value) * 0.75;
          this.notifySymbolChanges.emit(this.guid);
        }, 1);
      } }))));
    const panelRect = this.labelContentRefElement.getBoundingClientRect();
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { dir: (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_6__.g)(this.hostElement), id: "managePopover_Id", placement: "leading-start", open: this.isOpen, pointerDisabled: true, referenceElement: this.labelContentRefElement, offsetDistance: -Math.round(this.labelContentRefElement.getBoundingClientRect().width), offsetSkidding: 50, label: "", style: {
        zIndex: "100"
      }, triggerDisabled: true, ref: (node) => (this.popoverNode = node) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { ref: (el) => (this.panelElement = el), closable: true, class: "panel", style: {
        width: `${panelRect.width}px`,
        maxHeight: `${panelRect.height * 0.8}px`
      }, onCalcitePanelClose: () => this.closeLabelPopovers.emit() }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header-content" }, this.strings.labelStyle), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { heading: "", collapsible: false, open: true }, fontFamilySelection, " ", fontSizeSelection, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.color, this.panelElement && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-input", { color: ((_g = this.labelClass.symbol.color) === null || _g === void 0 ? void 0 : _g.toHex()) || "#ffffff", popoverProps: {
        refElement: this.panelElement,
        placement: "leading-start",
        offsetDistance: -Math.round(this.panelElement.getBoundingClientRect().width),
        offsetSkidding: 50,
        maxHeight: `${panelRect.height * 0.8 - 52}px` // minus panelheader height
      }, onArcgisColorInputChange: async (event) => {
        const currColor = event.target.color;
        await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/Color"]).then(([Color]) => {
          this.labelClass.symbol.color = new Color(currColor);
          this.notifySymbolChanges.emit(this.guid);
        });
      }, onArcgisColorInputPopoverOpen: () => {
        // give it some time in case another arcgis-color-input has to close first
        setTimeout(() => {
          this.fontNode.disabled = true;
          this.placementNode.disabled = true;
        }, 200);
      }, onArcgisColorInputPopoverClose: () => {
        this.fontNode.disabled = false;
        this.placementNode.disabled = false;
      } }))), this.placementSelection(), isBinning || this.layerGeometryType !== "polyline" ? offset : null, !isBinning && this.layerGeometryType === "polyline" ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, allowOverrun, " ", repeatLabel, " ", repeatLabelDistance)) : null, haloBlock)))));
  }
  waitOnUser(event, doChange, defaultValue) {
    // for number fields we don't want to allow an empty value
    // or value outside the range
    // but the user might shortly use an empty input box
    // while typing a new value
    const node = event.target;
    if (this.typingHndl) {
      clearTimeout(this.typingHndl);
      this.typingHndl = undefined;
    }
    const val = node.value;
    console.log(">", val, "<");
    const parsedVal = parseFloat(val);
    if (!val) {
      // undefined or empty string
      // user might be in the middle of typing
      // give the user 2 seconds to fill in empty entry
      // otherwise use default value
      this.typingHndl = setTimeout(() => {
        this.typingHndl = undefined;
        node.value = `${defaultValue}`;
        doChange(event);
      }, 2000);
    }
    else if ((0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_5__.i)(node.min) &&
      (0,_commonFunctions_5262b094_js__WEBPACK_IMPORTED_MODULE_5__.i)(node.max) &&
      (node.min > parsedVal || node.max < parsedVal)) {
      // invalid value
      this.typingHndl = setTimeout(() => {
        this.typingHndl = undefined;
        // we waited a bit; no user change; set value to within range
        if (node.min > parsedVal) {
          node.value = `${node.min}`;
          doChange(event);
        }
        else if (node.max < parsedVal) {
          node.value = `${node.max}`;
          doChange(event);
        }
      }, 750);
    }
    else if (val[0] !== "-" || (parsedVal !== 0 && !isNaN(parsedVal))) {
      // not '-', '-0', '-0.', '-0.0', ...
      doChange(event);
    } // else don't update anything; it's still keeping last value
  }
  get hostElement() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLabelContentStyle.style = arcgisLabelContentStyleCss;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ guid)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
function generateId(counts) {
  return counts
    .map((count) => {
    let out = "";
    for (let i = 0; i < count; i++) {
      out += (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
    }
    return out;
  })
    .join("-");
}
const guid = () => generateId([2, 1, 1, 1, 3]);




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ createStore)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const appendToMap = (map, propName, value) => {
    const items = map.get(propName);
    if (!items) {
        map.set(propName, [value]);
    }
    else if (!items.includes(value)) {
        items.push(value);
    }
};
const debounce = (fn, ms) => {
    let timeoutId;
    return (...args) => {
        if (timeoutId) {
            clearTimeout(timeoutId);
        }
        timeoutId = setTimeout(() => {
            timeoutId = 0;
            fn(...args);
        }, ms);
    };
};

/**
 * Check if a possible element isConnected.
 * The property might not be there, so we check for it.
 *
 * We want it to return true if isConnected is not a property,
 * otherwise we would remove these elements and would not update.
 *
 * Better leak in Edge than to be useless.
 */
const isConnected = (maybeElement) => !('isConnected' in maybeElement) || maybeElement.isConnected;
const cleanupElements = debounce((map) => {
    for (let key of map.keys()) {
        map.set(key, map.get(key).filter(isConnected));
    }
}, 2000);
const stencilSubscription = () => {
    if (typeof _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.g !== 'function') {
        // If we are not in a stencil project, we do nothing.
        // This function is not really exported by @stencil/core.
        return {};
    }
    const elmsToUpdate = new Map();
    return {
        dispose: () => elmsToUpdate.clear(),
        get: (propName) => {
            const elm = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.g)();
            if (elm) {
                appendToMap(elmsToUpdate, propName, elm);
            }
        },
        set: (propName) => {
            const elements = elmsToUpdate.get(propName);
            if (elements) {
                elmsToUpdate.set(propName, elements.filter(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.f));
            }
            cleanupElements(elmsToUpdate);
        },
        reset: () => {
            elmsToUpdate.forEach((elms) => elms.forEach(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.f));
            cleanupElements(elmsToUpdate);
        },
    };
};

const unwrap = (val) => (typeof val === 'function' ? val() : val);
const createObservableMap = (defaultState, shouldUpdate = (a, b) => a !== b) => {
    const unwrappedState = unwrap(defaultState);
    let states = new Map(Object.entries(unwrappedState !== null && unwrappedState !== void 0 ? unwrappedState : {}));
    const handlers = {
        dispose: [],
        get: [],
        set: [],
        reset: [],
    };
    const reset = () => {
        var _a;
        // When resetting the state, the default state may be a function - unwrap it to invoke it.
        // otherwise, the state won't be properly reset
        states = new Map(Object.entries((_a = unwrap(defaultState)) !== null && _a !== void 0 ? _a : {}));
        handlers.reset.forEach((cb) => cb());
    };
    const dispose = () => {
        // Call first dispose as resetting the state would
        // cause less updates ;)
        handlers.dispose.forEach((cb) => cb());
        reset();
    };
    const get = (propName) => {
        handlers.get.forEach((cb) => cb(propName));
        return states.get(propName);
    };
    const set = (propName, value) => {
        const oldValue = states.get(propName);
        if (shouldUpdate(value, oldValue, propName)) {
            states.set(propName, value);
            handlers.set.forEach((cb) => cb(propName, value, oldValue));
        }
    };
    const state = (typeof Proxy === 'undefined'
        ? {}
        : new Proxy(unwrappedState, {
            get(_, propName) {
                return get(propName);
            },
            ownKeys(_) {
                return Array.from(states.keys());
            },
            getOwnPropertyDescriptor() {
                return {
                    enumerable: true,
                    configurable: true,
                };
            },
            has(_, propName) {
                return states.has(propName);
            },
            set(_, propName, value) {
                set(propName, value);
                return true;
            },
        }));
    const on = (eventName, callback) => {
        handlers[eventName].push(callback);
        return () => {
            removeFromArray(handlers[eventName], callback);
        };
    };
    const onChange = (propName, cb) => {
        const unSet = on('set', (key, newValue) => {
            if (key === propName) {
                cb(newValue);
            }
        });
        // We need to unwrap the defaultState because it might be a function.
        // Otherwise we might not be sending the right reset value.
        const unReset = on('reset', () => cb(unwrap(defaultState)[propName]));
        return () => {
            unSet();
            unReset();
        };
    };
    const use = (...subscriptions) => {
        const unsubs = subscriptions.reduce((unsubs, subscription) => {
            if (subscription.set) {
                unsubs.push(on('set', subscription.set));
            }
            if (subscription.get) {
                unsubs.push(on('get', subscription.get));
            }
            if (subscription.reset) {
                unsubs.push(on('reset', subscription.reset));
            }
            if (subscription.dispose) {
                unsubs.push(on('dispose', subscription.dispose));
            }
            return unsubs;
        }, []);
        return () => unsubs.forEach((unsub) => unsub());
    };
    const forceUpdate = (key) => {
        const oldValue = states.get(key);
        handlers.set.forEach((cb) => cb(key, oldValue, oldValue));
    };
    return {
        state,
        get,
        set,
        on,
        onChange,
        use,
        dispose,
        reset,
        forceUpdate,
    };
};
const removeFromArray = (array, item) => {
    const index = array.indexOf(item);
    if (index >= 0) {
        array[index] = array[array.length - 1];
        array.length--;
    }
};

const createStore = (defaultState, shouldUpdate) => {
    const map = createObservableMap(defaultState, shouldUpdate);
    map.use(stencilSubscription());
    return map;
};




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/labelStore-a0cf76c4.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/labelStore-a0cf76c4.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   l: () => (/* binding */ labelState)
/* harmony export */ });
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


const labelStore = (0,_index_81d548b7_js__WEBPACK_IMPORTED_MODULE_0__.c)({
  layer: null,
  mapView: null,
  portal: null,
  config: null,
  strings: null,
  currentLanguage: null,
  layerGeometryType: null,
  serviceType: null,
  layerDisplayType: null
});
const labelState = labelStore.state;




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
  var _a, _b, _c;
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    // "ru-RU" maps to "ru" use case
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
    }
    else {
      return "en";
    }
  }
}
function getComponentClosestLanguageIntl(element) {
  var _a, _b, _c;
  // it's OK if we don't have the 4 letter language file for it
  // 4 letter language code needed for formatting numbers
  const closestElement = (_a = (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
  // language set by the calling application or browser. defaults to english.
  const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
  if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
    return _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
  }
  else {
    if (_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
      // we support the 2 letter coded language
      // e.g. it-CH vs it
      return lang;
    }
    else {
      return "en";
    }
  }
}
function fetchLocaleStringsForComponent(componentName, locale) {
  return new Promise((resolve, reject) => {
    fetch((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
      if (result.ok)
        resolve(result.json());
      else
        reject();
    }, () => reject());
  });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
  const id = `${componentName}${locale}`;
  if (!stringCache[id]) {
    stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
  }
  return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
  const componentName = tagName || element.tagName.toLowerCase();
  const componentLanguage = getComponentClosestLanguage(element);
  const componentLanguageIntl = getComponentClosestLanguageIntl(element);
  let strings;
  try {
    strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
  }
  catch (e) {
    console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
    strings = await fetchLocaleStringsFromCache(componentName, "en");
  }
  return [strings, componentLanguage, componentLanguageIntl];
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTkyN2M3Zi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzZHO0FBQ3ZDO0FBQ1Q7QUFDZDtBQUM2QztBQUN3SDtBQUNwSjtBQUNMO0FBQytGO0FBQy9IO0FBQ0U7O0FBRTdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxzQ0FBc0MsOENBQThDLGFBQWEsK0dBQStHLGlEQUFpRCxvQkFBb0IsYUFBYSx3QkFBd0IsWUFBWSxnQkFBZ0IsY0FBYyxTQUFTLFlBQVksc0JBQXNCLGNBQWMseUNBQXlDLFVBQVU7O0FBRWhkO0FBQ0E7QUFDQSxJQUFJLHFEQUFnQjtBQUNwQix3QkFBd0IscURBQVc7QUFDbkMsc0NBQXNDLHFEQUFXO0FBQ2pELGdDQUFnQyxxREFBVztBQUMzQyw4QkFBOEIscURBQVc7QUFDekMsNEJBQTRCLHFEQUFXO0FBQ3ZDLHlCQUF5QixxREFBVztBQUNwQztBQUNBO0FBQ0E7QUFDQSxjQUFjLHFEQUFDLFVBQVUsaUNBQWlDLEVBQUUscURBQUMsMkJBQTJCO0FBQ3hGLDBFQUEwRTtBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLHVEQUFvQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELHNEQUF5QjtBQUMxRSxtQ0FBbUMsK0RBQW9CO0FBQ3ZELHVCQUF1QiwrREFBYztBQUNyQyxJQUFJLHNEQUFVO0FBQ2QsSUFBSSxzREFBVTtBQUNkLElBQUksc0RBQVU7QUFDZCxJQUFJLHNEQUFVO0FBQ2QsSUFBSSxzREFBVTtBQUNkLElBQUksc0RBQVU7QUFDZCxJQUFJLHNEQUFVO0FBQ2QsSUFBSSxzREFBVTtBQUNkLElBQUksc0RBQVU7QUFDZDtBQUNBLGdDQUFnQyx1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Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ25CM0I7QUFDQTtBQUNBO0FBQ0E7QUFDMkU7QUFDYjtBQUNOOztBQUV4RDtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsbURBQWlDO0FBQ2hFO0FBQ0E7QUFDQSxNQUFNLHdEQUFXO0FBQ2pCLFdBQVcsd0RBQVc7QUFDdEI7QUFDQTtBQUNBO0FBQ0EsUUFBUSx3REFBVztBQUNuQixhQUFhLHdEQUFXO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLG1EQUFpQztBQUNoRTtBQUNBO0FBQ0EsTUFBTSx3REFBVztBQUNqQixXQUFXLHdEQUFXO0FBQ3RCO0FBQ0E7QUFDQSxRQUFRLHdEQUFXO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLHFEQUFZLDhCQUE4QixjQUFjLFFBQVEsT0FBTztBQUNqRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGNBQWMsRUFBRSxPQUFPO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxlQUFlLEdBQUcsa0JBQWtCO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBOztBQUU0RSIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1sYWJlbF8zLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2d1aWQtNGY0MTc2YmEuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vaW5kZXgtODFkNTQ4YjcuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbGFiZWxTdG9yZS1hMGNmNzZjNC5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sb2NhbGUtMTNlMDBhNzUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIEggYXMgSG9zdCwgZCBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC05MmViYjM5Ni5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgfSBmcm9tICcuL2xvY2FsZS0xM2UwMGE3NS5qcyc7XG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1hYWYzMGJkNi5qcyc7XG5pbXBvcnQgeyBnIGFzIGd1aWQgfSBmcm9tICcuL2d1aWQtNGY0MTc2YmEuanMnO1xuaW1wb3J0IHsgbCBhcyBsYXllckRpc3BsYXlUeXBlRW51bSwgcyBhcyBzZXJ2aWNlVHlwZUVudW0gfSBmcm9tICcuL2NvbW1vbkVudW1zLWY5OGEzMjNjLmpzJztcbmltcG9ydCB7IGggYXMgZ2V0TGF5ZXJHZW9tZXRyeVR5cGUsIGMgYXMgZ2V0U2VydmljZVR5cGUsIGogYXMgZ2V0RmllbGRzRnJvbUxheWVyLCBrIGFzIGdldENsdXN0ZXJGaWVsZHMsIGwgYXMgZ2V0U2luZ2xlQ2x1c3RlckZlYXR1cmUsIG0gYXMgZ2V0U2luZ2xlRmVhdHVyZSwgaSBhcyBpc0RlZmluZWQgfSBmcm9tICcuL2NvbW1vbkZ1bmN0aW9ucy01MjYyYjA5NC5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEVsZW1lbnREaXIgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC0yMjI1OGM5MC5qcyc7XG5pbXBvcnQgeyBsIGFzIGxhYmVsU3RhdGUgfSBmcm9tICcuL2xhYmVsU3RvcmUtYTBjZjc2YzQuanMnO1xuaW1wb3J0IHsgbSBhcyBtYXBTZXJ2aWNlZm9udE1hcCwgZiBhcyBmZWF0dXJlU2VydmljZUZvbnRNYXAsIHAgYXMgcGxhY2VtZW50UG9pbnQsIGEgYXMgcGxhY2VtZW50TGluZSwgYiBhcyBmb250VG9Gb250TmFtZSB9IGZyb20gJy4vZm9udFV0aWwtMWFhM2EzMmMuanMnO1xuaW1wb3J0ICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtODFkNTQ4YjcuanMnO1xuXG5jb25zdCBDU1MkMSA9IHtcbiAgZW5hYmxlTGFiZWw6IFwiZW5hYmxlLWxhYmVsXCIsXG4gIGVuYWJsZUxhYmVsTGFiZWw6IFwiZW5hYmxlLWxhYmVsLWxhYmVsXCIsXG4gIGxhYmVsU3dpdGNoOiBcImxhYmVsLXN3aXRjaFwiLFxuICBjb21wb25lbnREaXY6IFwiY29tcG9uZW50LXVsXCJcbn07XG5cbmNvbnN0IGFyY2dpc0xhYmVsQ3NzID0gXCIuZW5hYmxlLWxhYmVse2JhY2tncm91bmQtY29sb3I6dmFyKC0tYXJjZ2lzLWFwcC1iYWNrZ3JvdW5kKTtkaXNwbGF5OmZsZXg7cGFkZGluZzp2YXIoLS1hcmNnaXMtYXBwLWNhcC1zcGFjaW5nKSB2YXIoLS1hcmNnaXMtYXBwLWNhcC1zcGFjaW5nLWhhbGYpIHZhcigtLWFyY2dpcy1hcHAtY2FwLXNwYWNpbmctcXVhcnRlcik7Ym9yZGVyLWJvdHRvbTpzb2xpZCAxcHggdmFyKC0tYXJjZ2lzLWFwcC1ib3JkZXIpfS5lbmFibGUtbGFiZWwtbGFiZWx7ZGlzcGxheTpmbGV4O2ZsZXgtZmxvdzpjb2x1bW4gbm93cmFwO2ZsZXg6MSAwIDAlO292ZXJmbG93OmhpZGRlbn0ubGFiZWwtc3dpdGNoe21hcmdpbjowO2ZsZXg6MCAwIDAlO2p1c3RpZnktc2VsZjpmbGV4LWVuZH0uY29tcG9uZW50LXVse21hcmdpbjowIDAgdmFyKC0tYXJjZ2lzLWFwcC1jYXAtc3BhY2luZyk7cGFkZGluZzowfVwiO1xuXG5jb25zdCBBcmNnaXNMYWJlbCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5sYWJlbFVwZGF0ZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImxhYmVsVXBkYXRlZFwiLCA3KTtcbiAgICB0aGlzLmFyY2dpc0xhYmVsRGlzbWlzc2VkQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNMYWJlbERpc21pc3NlZENoYW5nZVwiLCA3KTtcbiAgICB0aGlzLmludGVybmFsTGFiZWxVcGRhdGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJpbnRlcm5hbExhYmVsVXBkYXRlZFwiLCA3KTtcbiAgICB0aGlzLmNsb3NlTGFiZWxQb3BvdmVycyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiY2xvc2VMYWJlbFBvcG92ZXJzXCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzRmlsdGVyRG9uZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzRmlsdGVyRG9uZVwiLCA3KTtcbiAgICB0aGlzLmxhYmVsUmVSZW5kZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImxhYmVsUmVSZW5kZXJcIiwgNyk7XG4gICAgLy8gcmVuZG9yIG1ldGhvZHNcbiAgICB0aGlzLmxhYmVsQ29tcG9uZW50ID0gKHVuaXF1ZUd1aWQsIGxhYmVsQ2xhc3MsIGJsb2NrT3BlbikgPT4ge1xuICAgICAgdmFyIF9hO1xuICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsga2V5OiB1bmlxdWVHdWlkLCBpZDogdW5pcXVlR3VpZCB9LCBoKFwiYXJjZ2lzLWxhYmVsLWNvbnRlbnRcIiwgeyBndWlkOiB1bmlxdWVHdWlkLCBsYWJlbENsYXNzOiBsYWJlbENsYXNzLCBibG9ja09wZW46IGJsb2NrT3BlbiwgY2FsY2l0ZUZsb3dJdGVtOiAoKF9hID0gdGhpcy5jYWxjaXRlRmxvd1Byb3BzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2FsY2l0ZUZsb3dJdGVtKSB8fFxuICAgICAgICAgIHRoaXMuaG9zdEVsZW1lbnQuc2hhZG93Um9vdC5nZXRFbGVtZW50QnlJZChcImxhYmVsRmxvd0l0ZW1fSWRcIikgfSkpKTtcbiAgICB9O1xuICAgIHRoaXMubWFwVmlldyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxheWVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuY29uZmlnID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubGF5ZXJEaXNwbGF5VHlwZSA9IGxheWVyRGlzcGxheVR5cGVFbnVtLmZlYXR1cmU7XG4gICAgdGhpcy5kaXNtaXNzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuaGlkZUxheWVyVGl0bGUgPSBmYWxzZTtcbiAgICB0aGlzLmNhbGNpdGVGbG93UHJvcHMgPSBudWxsO1xuICAgIHRoaXMubGFiZWxDb21wb25lbnRzID0gW107XG4gICAgdGhpcy5yZVJlbmRlciA9IHVuZGVmaW5lZDtcbiAgfVxuICAvLyBsaWZlY3ljbGUgbWV0aG9kc1xuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICBbdGhpcy5zdHJpbmdzLCB0aGlzLmN1cnJlbnRMYW5ndWFnZV0gPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgIHRoaXMubGF5ZXJHZW9tZXRyeVR5cGUgPSBhd2FpdCBnZXRMYXllckdlb21ldHJ5VHlwZSh0aGlzLmxheWVyKTtcbiAgICB0aGlzLnNlcnZpY2VUeXBlID0gZ2V0U2VydmljZVR5cGUodGhpcy5sYXllcik7XG4gICAgbGFiZWxTdGF0ZS5sYXllciA9IHRoaXMubGF5ZXI7XG4gICAgbGFiZWxTdGF0ZS5tYXBWaWV3ID0gdGhpcy5tYXBWaWV3O1xuICAgIGxhYmVsU3RhdGUucG9ydGFsID0gdGhpcy5wb3J0YWw7XG4gICAgbGFiZWxTdGF0ZS5jb25maWcgPSB0aGlzLmNvbmZpZztcbiAgICBsYWJlbFN0YXRlLnN0cmluZ3MgPSB0aGlzLnN0cmluZ3M7XG4gICAgbGFiZWxTdGF0ZS5jdXJyZW50TGFuZ3VhZ2UgPSB0aGlzLmN1cnJlbnRMYW5ndWFnZTtcbiAgICBsYWJlbFN0YXRlLmxheWVyR2VvbWV0cnlUeXBlID0gdGhpcy5sYXllckdlb21ldHJ5VHlwZTtcbiAgICBsYWJlbFN0YXRlLnNlcnZpY2VUeXBlID0gdGhpcy5zZXJ2aWNlVHlwZTtcbiAgICBsYWJlbFN0YXRlLmxheWVyRGlzcGxheVR5cGUgPSB0aGlzLmxheWVyRGlzcGxheVR5cGU7XG4gICAgdGhpcy5sYWJlbGluZ0luZm8gPVxuICAgICAgdGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5mZWF0dXJlXG4gICAgICAgID8gdGhpcy5sYXllci5sYWJlbGluZ0luZm9cbiAgICAgICAgOiB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24ubGFiZWxpbmdJbmZvO1xuICAgIC8vIHRlbXBcbiAgICBpZiAodGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5mZWF0dXJlKSB7XG4gICAgICB0aGlzLmxheWVyLmxhYmVsc1Zpc2libGUgPSB0aGlzLmxheWVyLmxhYmVsc1Zpc2libGUgfHwgZmFsc2U7XG4gICAgfVxuICAgIGVsc2UgaWYgKHRoaXMubGF5ZXJEaXNwbGF5VHlwZSA9PT0gbGF5ZXJEaXNwbGF5VHlwZUVudW0uY2x1c3Rlcikge1xuICAgICAgdGhpcy5sYXllci5mZWF0dXJlUmVkdWN0aW9uLmxhYmVsc1Zpc2libGUgPVxuICAgICAgICB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24ubGFiZWxzVmlzaWJsZSB8fFxuICAgICAgICAgIGZhbHNlO1xuICAgIH1cbiAgICAvLyBhZGQgZm9yIGV4aXN0aW5nXG4gICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy5sYWJlbGluZ0luZm8pKSB7XG4gICAgICB0aGlzLmxhYmVsaW5nSW5mby5mb3JFYWNoKChsYWJlbENsYXNzKSA9PiB7XG4gICAgICAgIHRoaXMuYWRkTGFiZWxDbGFzcyhsYWJlbENsYXNzLCB0aGlzLmxhYmVsaW5nSW5mby5sZW5ndGggPT09IDEgPyB0cnVlIDogZmFsc2UpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgdmFyIF9hO1xuICAgIHRoaXMuc29ydGFibGVDb21wb25lbnRzID0gdGhpcy5ob3N0RWxlbWVudC5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKFwiU29ydGFibGVDb21wb25lbnRzX0lkXCIpO1xuICAgIHRoaXMuY2FsY2l0ZUZhYiA9XG4gICAgICAoKF9hID0gdGhpcy5jYWxjaXRlRmxvd1Byb3BzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2FsY2l0ZUZhYikgfHxcbiAgICAgICAgdGhpcy5ob3N0RWxlbWVudC5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKFwiYWRkQ29tcG9uZW50QnRuX0lkXCIpO1xuICAgIHRoaXMuZW5hYmxlRGlzYWJsZUxhYmVsKHRoaXMuZ2V0TGFiZWxFbmFibGVkUHJvcCgpKTtcbiAgICB0aGlzLmNhbGNpdGVGYWIub25jbGljayA9IGFzeW5jIChldmVudCkgPT4ge1xuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB0aGlzLmNsb3NlTGFiZWxQb3BvdmVycy5lbWl0KCk7XG4gICAgICBjb25zdCBsYWJlbENsYXNzID0gYXdhaXQgdGhpcy5nZXRMYWJlbENsYXNzKCk7XG4gICAgICBpZiAodGhpcy5sYWJlbGluZ0luZm8pIHtcbiAgICAgICAgdGhpcy5sYWJlbGluZ0luZm8ucHVzaChsYWJlbENsYXNzKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmxhYmVsaW5nSW5mbyA9IFtsYWJlbENsYXNzXTtcbiAgICAgIH1cbiAgICAgIHRoaXMuYWRkTGFiZWxDbGFzcyhsYWJlbENsYXNzLCB0cnVlKTtcbiAgICAgIHRoaXMuZm9jdXNMYXN0TGFiZWxDbGFzcygpO1xuICAgIH07XG4gICAgaWYgKHRoaXMuZmxvd0l0ZW1Ob2RlKSB7XG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5mbG93SXRlbU5vZGUuc2V0Rm9jdXMoKSk7XG4gICAgfVxuICB9XG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICB0aGlzLmludGVybmFsTGFiZWxVcGRhdGVkLmVtaXQoKTtcbiAgfVxuICAvLyBFdmVudHNcbiAgbWFpblBvcHVwUmVSZW5kZXJIYW5kbGVyKGV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5yZVJlbmRlciA9IHRoaXMucmVSZW5kZXIgPyBmYWxzZSA6IHRydWU7XG4gIH1cbiAgZGVsZXRlQ29tcG9uZW50SGFuZGxlcihldmVudCkge1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIHRoaXMuY2xvc2VMYWJlbFBvcG92ZXJzLmVtaXQoKTtcbiAgICAvLyBlYWNoIGRpdiBoYXMgaWQuIEZpbmQgaWQsIGFuZCBzcGxpY2UgYnkgaW5kZXhcbiAgICBjb25zdCBhbGxDb21wb25lbnRzID0gdGhpcy5zb3J0YWJsZUNvbXBvbmVudHMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJkaXZcIik7XG4gICAgZm9yIChsZXQgeCA9IDA7IHggPCBhbGxDb21wb25lbnRzLmxlbmd0aDsgeCsrKSB7XG4gICAgICBpZiAoYWxsQ29tcG9uZW50c1t4XS5pZCA9PT0gZXZlbnQuZGV0YWlsKSB7XG4gICAgICAgIHRoaXMubGFiZWxpbmdJbmZvLnNwbGljZSh4LCAxKTtcbiAgICAgICAgdGhpcy5sYWJlbENvbXBvbmVudHMuc3BsaWNlKHgsIDEpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5sYWJlbFJlUmVuZGVyLmVtaXQoKTtcbiAgICB0aGlzLmNhbGNpdGVGYWIuc2V0Rm9jdXMoKTtcbiAgfVxuICBkdXBsaWNhdGVDb21wb25lbnRIYW5kbGVyKGV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5jbG9zZUxhYmVsUG9wb3ZlcnMuZW1pdCgpO1xuICAgIC8vIGVhY2ggZGl2IGhhcyBpZC4gRmluZCBpZCwgYW5kIGNsb25lXG4gICAgY29uc3QgYWxsQ29tcG9uZW50cyA9IHRoaXMuc29ydGFibGVDb21wb25lbnRzLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiZGl2XCIpO1xuICAgIGZvciAobGV0IHggPSAwOyB4IDwgYWxsQ29tcG9uZW50cy5sZW5ndGg7IHgrKykge1xuICAgICAgaWYgKGFsbENvbXBvbmVudHNbeF0uaWQgPT09IGV2ZW50LmRldGFpbCkge1xuICAgICAgICBjb25zdCB0ZW1wTGFiZWxDbGFzcyA9IHRoaXMubGFiZWxpbmdJbmZvW3hdLmNsb25lKCk7XG4gICAgICAgIHRoaXMubGFiZWxpbmdJbmZvLnB1c2godGVtcExhYmVsQ2xhc3MpO1xuICAgICAgICB0aGlzLmFkZExhYmVsQ2xhc3ModGVtcExhYmVsQ2xhc3MsIHRydWUpO1xuICAgICAgICB0aGlzLmZvY3VzTGFzdExhYmVsQ2xhc3MoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGludGVybmFsTGFiZWxVcGRhdGVkSGFuZGxlcihldmVudCkge1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIC8vIGlmIGV2ZW50LmRldGFpbCBpcyB0cnVlLCBvbmx5IHVwZGF0ZSBleHRlcm5hbFxuICAgIGlmICh0aGlzLmxhYmVsaW5nSW5mbyAmJiAhZXZlbnQuZGV0YWlsKSB7XG4gICAgICBpZiAodGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5mZWF0dXJlKSB7XG4gICAgICAgIHRoaXMubGF5ZXIubGFiZWxpbmdJbmZvID0gWy4uLnRoaXMubGFiZWxpbmdJbmZvXTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24ubGFiZWxpbmdJbmZvID0gW1xuICAgICAgICAgIC4uLnRoaXMubGFiZWxpbmdJbmZvXG4gICAgICAgIF07XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMubGFiZWxVcGRhdGVkLmVtaXQoKTtcbiAgfVxuICBkaXNhYmxlTGFiZWxQYW5lbEhhbmRsZXIoZXZlbnQpIHtcbiAgICB2YXIgX2E7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgY29uc3QgcGFuZWwgPSAoKF9hID0gdGhpcy5jYWxjaXRlRmxvd1Byb3BzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2FsY2l0ZUZsb3dJdGVtKSB8fFxuICAgICAgdGhpcy5ob3N0RWxlbWVudC5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKFwibGFiZWxGbG93SXRlbV9JZFwiKTtcbiAgICBwYW5lbC5kaXNhYmxlZCA9IGV2ZW50LmRldGFpbDtcbiAgfVxuICAvLyBQdWJsaWMgTWV0aG9kc1xuICBhc3luYyBkb25lKCkge1xuICAgIHRoaXMuYXJjZ2lzRmlsdGVyRG9uZS5lbWl0KCk7XG4gICAgdGhpcy5jbG9zZUxhYmVsUG9wb3ZlcnMuZW1pdCgpO1xuICB9XG4gIGFzeW5jIHNldEZvY3VzKCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAodGhpcy5mbG93SXRlbU5vZGUpIHtcbiAgICAgIHRoaXMuZmxvd0l0ZW1Ob2RlLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgKF9hID0gdGhpcy5sYWJlbFN3aXRjaCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvY3VzKCk7XG4gICAgfVxuICB9XG4gIC8vIHByaXZhdGUgbWV0aG9kcyBhbmQgcHJvcGVydGllc1xuICBlbmFibGVEaXNhYmxlTGFiZWwobGFiZWxCb29sKSB7XG4gICAgLy8gaGlkZSByZXN0IG9mIHRoZSBjb21wb25lbnQuXG4gICAgY29uc3QgbGFiZWxEaXYgPSB0aGlzLmhvc3RFbGVtZW50LnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoXCJsYWJlbERpdl9JZFwiKTtcbiAgICBsYWJlbERpdi5zdHlsZS5kaXNwbGF5ID0gbGFiZWxCb29sID8gXCJibG9ja1wiIDogXCJub25lXCI7XG4gICAgdGhpcy5jYWxjaXRlRmFiLnN0eWxlLmRpc3BsYXkgPSBsYWJlbEJvb2wgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcbiAgICB0aGlzLmNsb3NlTGFiZWxQb3BvdmVycy5lbWl0KCk7XG4gIH1cbiAgZ2V0TGFiZWxFbmFibGVkUHJvcCgpIHtcbiAgICBzd2l0Y2ggKHRoaXMubGF5ZXJEaXNwbGF5VHlwZSkge1xuICAgICAgY2FzZSBsYXllckRpc3BsYXlUeXBlRW51bS5mZWF0dXJlOiB7XG4gICAgICAgIHJldHVybiB0aGlzLmxheWVyLmxhYmVsc1Zpc2libGU7XG4gICAgICB9XG4gICAgICBjYXNlIGxheWVyRGlzcGxheVR5cGVFbnVtLmNsdXN0ZXI6IHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGF5ZXIuZmVhdHVyZVJlZHVjdGlvblxuICAgICAgICAgIC5sYWJlbHNWaXNpYmxlO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICByZXR1cm4gdGhpcy5sYXllci5sYWJlbHNWaXNpYmxlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBhZGRMYWJlbENsYXNzKGxhYmVsQ2xhc3MsIGJsb2NrT3BlbiA9IGZhbHNlKSB7XG4gICAgdGhpcy5sYWJlbENvbXBvbmVudHMgPSBbXG4gICAgICAuLi50aGlzLmxhYmVsQ29tcG9uZW50cyxcbiAgICAgIHRoaXMubGFiZWxDb21wb25lbnQoZ3VpZCgpLCBsYWJlbENsYXNzLCBibG9ja09wZW4pXG4gICAgXTtcbiAgfVxuICBhc3luYyBnZXRMYWJlbENsYXNzKCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mO1xuICAgIGNvbnN0IFtMYWJlbENsYXNzLCBjb2xvclV0aWxzLCBjbHVzdGVyTGFiZWxDcmVhdG9yLCBiaW5MYWJlbENyZWF0b3JdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1xuICAgICAgXCJlc3JpL2xheWVycy9zdXBwb3J0L0xhYmVsQ2xhc3NcIixcbiAgICAgIFwiZXNyaS92aWV3cy9zdXBwb3J0L2NvbG9yVXRpbHNcIixcbiAgICAgIFwiZXNyaS9zbWFydE1hcHBpbmcvbGFiZWxzL2NsdXN0ZXJzXCIsXG4gICAgICBcImVzcmkvc21hcnRNYXBwaW5nL2xhYmVscy9iaW5zXCJcbiAgICBdKTtcbiAgICAvLyBmZWF0dXJlIG9yIGNsdXN0ZXJcbiAgICBpZiAodGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5mZWF0dXJlKSB7XG4gICAgICByZXR1cm4gbmV3IExhYmVsQ2xhc3ModGhpcy5kZWZhdWx0TGFiZWxQcm9wcyh0aGlzLmRlZmF1bHRTeW1ib2xQcm9wcyhhd2FpdCBjb2xvclV0aWxzLmdldEJhY2tncm91bmRDb2xvcih0aGlzLm1hcFZpZXcpLCBhd2FpdCBjb2xvclV0aWxzLmdldEJhY2tncm91bmRDb2xvclRoZW1lKHRoaXMubWFwVmlldykpKSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKCgoX2EgPSB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSA9PT0gXCJiaW5uaW5nXCIpIHtcbiAgICAgIHJldHVybiAoKChfYyA9IChfYiA9IChhd2FpdCBiaW5MYWJlbENyZWF0b3IuZ2V0TGFiZWxTY2hlbWVzKHtcbiAgICAgICAgbGF5ZXI6IHRoaXMubGF5ZXJcbiAgICAgIH0pKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnByaW1hcnlTY2hlbWUpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5sYWJlbGluZ0luZm9bMF0pIHx8IG51bGwpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiAoKChfZiA9IChfZSA9IChhd2FpdCBjbHVzdGVyTGFiZWxDcmVhdG9yLmdldExhYmVsU2NoZW1lcyh7XG4gICAgICAgIGxheWVyOiB0aGlzLmxheWVyLFxuICAgICAgICByZW5kZXJlcjogKF9kID0gdGhpcy5sYXllcikgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLnJlbmRlcmVyLFxuICAgICAgICB2aWV3OiB0aGlzLm1hcFZpZXdcbiAgICAgIH0pKSkgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLnByaW1hcnlTY2hlbWUpID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZi5sYWJlbGluZ0luZm9bMF0pIHx8IG51bGwpO1xuICAgIH1cbiAgfVxuICBkZWZhdWx0TGFiZWxQcm9wcyhzeW1ib2xQcm9wcykge1xuICAgIGNvbnN0IGRlZmF1bHRGaWVsZE5hbWUgPSB0aGlzLmRlZmF1bHRMYWJlbEZpZWxkKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC8vIGF1dG9jYXN0cyBhcyBuZXcgTGFiZWxDbGFzcygpXG4gICAgICBzeW1ib2w6IHtcbiAgICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgIGNvbG9yOiBzeW1ib2xQcm9wcy5mb250Q29sb3IsXG4gICAgICAgIGhhbG9Db2xvcjogc3ltYm9sUHJvcHMuaGFsb0NvbG9yLFxuICAgICAgICBoYWxvU2l6ZTogc3ltYm9sUHJvcHMuaGFsb1NpemUsXG4gICAgICAgIGZvbnQ6IHtcbiAgICAgICAgICBmYW1pbHk6IHN5bWJvbFByb3BzLmZvbnRGYW1pbHksXG4gICAgICAgICAgc2l6ZTogc3ltYm9sUHJvcHMuZm9udFNpemVcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGxhYmVsRXhwcmVzc2lvbkluZm86IHRoaXMubGF5ZXJEaXNwbGF5VHlwZSA9PT0gbGF5ZXJEaXNwbGF5VHlwZUVudW0uY2x1c3RlclxuICAgICAgICA/IHtcbiAgICAgICAgICBleHByZXNzaW9uOiBgJGZlYXR1cmVbXCIke2RlZmF1bHRGaWVsZE5hbWV9XCJdYFxuICAgICAgICB9XG4gICAgICAgIDogdGhpcy5zZXJ2aWNlVHlwZSAhPT0gc2VydmljZVR5cGVFbnVtLm1hcEltYWdlXG4gICAgICAgICAgPyB7XG4gICAgICAgICAgICBleHByZXNzaW9uOiBkZWZhdWx0RmllbGROYW1lXG4gICAgICAgICAgICAgID8gdGhpcy5sYXllci5maWVsZHMuc29tZSgoZmllbGQpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkLm5hbWUgPT09IGRlZmF1bHRGaWVsZE5hbWUpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiAoKF9hID0gZmllbGQgPT09IG51bGwgfHwgZmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkLmRvbWFpbikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnR5cGUpID09PSBcImNvZGVkLXZhbHVlXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgID8gYCRmZWF0dXJlW1wiJHtkZWZhdWx0RmllbGROYW1lfVwiXVxcbkRvbWFpbk5hbWUoJGZlYXR1cmUsIFwiJHtkZWZhdWx0RmllbGROYW1lfVwiKWBcbiAgICAgICAgICAgICAgICA6IGAkZmVhdHVyZVtcIiR7ZGVmYXVsdEZpZWxkTmFtZX1cIl1gXG4gICAgICAgICAgICAgIDogbnVsbFxuICAgICAgICAgIH1cbiAgICAgICAgICA6IG51bGwsXG4gICAgICBsYWJlbEV4cHJlc3Npb246IHRoaXMuc2VydmljZVR5cGUgPT09IHNlcnZpY2VUeXBlRW51bS5tYXBJbWFnZSA/IGBbJHtkZWZhdWx0RmllbGROYW1lfV1gIDogbnVsbCxcbiAgICAgIGxhYmVsUGxhY2VtZW50OiB0aGlzLmRlZmF1bHRQbGFjZW1lbnQoKSxcbiAgICAgIG1heFNjYWxlOiB0aGlzLmxheWVyLm1heFNjYWxlIHx8IDAsXG4gICAgICBtaW5TY2FsZTogdGhpcy5sYXllci5taW5TY2FsZSB8fCAwXG4gICAgfTtcbiAgfVxuICBkZWZhdWx0TGFiZWxGaWVsZCgpIHtcbiAgICBsZXQgZGVmYXVsdEZpZWxkID0gbnVsbDtcbiAgICBpZiAodGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5jbHVzdGVyKSB7XG4gICAgICAvLyB3ZSBrbm93IHdlIGhhdmUgYXQgbGVhc3Qgb25lIGZpZWxkXG4gICAgICBkZWZhdWx0RmllbGQgPSB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb25cbiAgICAgICAgLmZpZWxkc1swXS5uYW1lO1xuICAgIH1cbiAgICBlbHNlIGlmIChcImRpc3BsYXlGaWVsZFwiIGluIHRoaXMubGF5ZXIgJiZcbiAgICAgIHRoaXMubGF5ZXIuZGlzcGxheUZpZWxkICYmXG4gICAgICB0aGlzLmxheWVyLmZpZWxkc0luZGV4LmdldCh0aGlzLmxheWVyLmRpc3BsYXlGaWVsZCkpIHtcbiAgICAgIGRlZmF1bHRGaWVsZCA9IHRoaXMubGF5ZXIuZGlzcGxheUZpZWxkO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMubGF5ZXIuZmllbGRzLmZpbmQoKGZpZWxkKSA9PiB7XG4gICAgICAgIGlmIChmaWVsZC50eXBlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJzdHJpbmdcIikpIHtcbiAgICAgICAgICByZXR1cm4gKGRlZmF1bHRGaWVsZCA9IGZpZWxkLm5hbWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGRlZmF1bHRGaWVsZCA/IGRlZmF1bHRGaWVsZCA6IHRoaXMubGF5ZXIuZmllbGRzWzBdLm5hbWU7XG4gIH1cbiAgZGVmYXVsdFN5bWJvbFByb3BzKGJhY2tncm91bmRDb2xvciwgYmFja2dyb3VuZENvbG9yVGhlbWUpIHtcbiAgICBpZiAoYmFja2dyb3VuZENvbG9yVGhlbWUgPT09IFwibGlnaHRcIikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZm9udEZhbWlseTogXCJBcmlhbFwiLFxuICAgICAgICBmb250U2l6ZTogMTMgKiAwLjc1LFxuICAgICAgICBmb250Q29sb3I6IFwiIzY5Njk2OVwiLFxuICAgICAgICBoYWxvQ29sb3I6IFwiI2QzZDNkM1wiLFxuICAgICAgICBoYWxvU2l6ZTogMVxuICAgICAgfTtcbiAgICB9XG4gICAgZWxzZSBpZiAoYmFja2dyb3VuZENvbG9yVGhlbWUgPT09IFwiZGFya1wiKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBmb250RmFtaWx5OiBcIkFyaWFsXCIsXG4gICAgICAgIGZvbnRTaXplOiAxMyAqIDAuNzUsXG4gICAgICAgIGZvbnRDb2xvcjogXCIjZDNkM2QzXCIsXG4gICAgICAgIGhhbG9Db2xvcjogXCIjNjk2OTY5XCIsXG4gICAgICAgIGhhbG9TaXplOiAxXG4gICAgICB9O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGZvbnRGYW1pbHk6IFwiQXJpYWxcIixcbiAgICAgICAgZm9udFNpemU6IDEzICogMC43NSxcbiAgICAgICAgZm9udENvbG9yOiBiYWNrZ3JvdW5kQ29sb3IgfHwgXCIjNjk2OTY5XCIsXG4gICAgICAgIGhhbG9Db2xvcjogXCIjZDNkM2QzXCIsXG4gICAgICAgIGhhbG9TaXplOiAxICogMC43NVxuICAgICAgfTtcbiAgICB9XG4gIH1cbiAgZGVmYXVsdFBsYWNlbWVudCgpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKHRoaXMubGF5ZXJEaXNwbGF5VHlwZSA9PT0gbGF5ZXJEaXNwbGF5VHlwZUVudW0uY2x1c3RlciAmJlxuICAgICAgKChfYSA9IHRoaXMubGF5ZXIuZmVhdHVyZVJlZHVjdGlvbikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnR5cGUpID09PSBcImJpbm5pbmdcIikge1xuICAgICAgcmV0dXJuIFwiYWx3YXlzLWhvcml6b250YWxcIjtcbiAgICB9XG4gICAgZWxzZSBpZiAodGhpcy5sYXllckdlb21ldHJ5VHlwZSA9PT0gXCJwb2ludFwiIHx8IHRoaXMubGF5ZXJHZW9tZXRyeVR5cGUgPT09IFwibXVsdGlwb2ludFwiKSB7XG4gICAgICByZXR1cm4gXCJhYm92ZS1jZW50ZXJcIjtcbiAgICB9XG4gICAgZWxzZSBpZiAodGhpcy5sYXllckdlb21ldHJ5VHlwZSA9PT0gXCJwb2x5bGluZVwiKSB7XG4gICAgICByZXR1cm4gXCJjZW50ZXItYWxvbmdcIjtcbiAgICB9XG4gICAgZWxzZSBpZiAodGhpcy5sYXllckdlb21ldHJ5VHlwZSA9PT0gXCJwb2x5Z29uXCIpIHtcbiAgICAgIHJldHVybiBcImFsd2F5cy1ob3Jpem9udGFsXCI7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG4gIGZvY3VzTGFzdExhYmVsQ2xhc3MoKSB7XG4gICAgc2V0VGltZW91dCgoKSA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgY29uc3QgYmxvY2tzID0gdGhpcy5ob3N0RWxlbWVudC5zaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3JBbGwoXCJhcmNnaXMtbGFiZWwtY29udGVudFwiKTtcbiAgICAgIGlmIChibG9ja3MgPT09IG51bGwgfHwgYmxvY2tzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBibG9ja3MubGVuZ3RoKSB7XG4gICAgICAgIGJsb2Nrc1tibG9ja3MubGVuZ3RoIC0gMV0uc2V0Rm9jdXMoKTtcbiAgICAgIH1cbiAgICB9KSwgMjAwKTtcbiAgfVxuICBsYWJlbFN3aXRjaEFuZENvbnRlbnQoKSB7XG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIG51bGwsIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgY2xhc3M6IENTUyQxLmVuYWJsZUxhYmVsLCBhbGlnbm1lbnQ6IFwic3RhcnRcIiwgbGF5b3V0OiBcImlubGluZS1zcGFjZS1iZXR3ZWVuXCIgfSwgdGhpcy5zdHJpbmdzLmVuYWJsZUxhYmVscywgaChcImNhbGNpdGUtc3dpdGNoXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLmxhYmVsU3dpdGNoID0gZWwpLCBzY2FsZTogXCJzXCIsIGNsYXNzOiBDU1MkMS5sYWJlbFN3aXRjaCwgY2hlY2tlZDogdGhpcy5nZXRMYWJlbEVuYWJsZWRQcm9wKCksIG9uQ2FsY2l0ZVN3aXRjaENoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IGNoZWNrZWQgPSBldmVudC50YXJnZXQuY2hlY2tlZDtcbiAgICAgICAgc3dpdGNoICh0aGlzLmxheWVyRGlzcGxheVR5cGUpIHtcbiAgICAgICAgICBjYXNlIGxheWVyRGlzcGxheVR5cGVFbnVtLmZlYXR1cmU6IHtcbiAgICAgICAgICAgIHRoaXMubGF5ZXIubGFiZWxzVmlzaWJsZSA9IGNoZWNrZWQ7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSBsYXllckRpc3BsYXlUeXBlRW51bS5jbHVzdGVyOiB7XG4gICAgICAgICAgICB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24ubGFiZWxzVmlzaWJsZSA9IGNoZWNrZWQ7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgdGhpcy5sYXllci5sYWJlbHNWaXNpYmxlID0gY2hlY2tlZDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbmFibGVEaXNhYmxlTGFiZWwoY2hlY2tlZCk7XG4gICAgICAgIHRoaXMuaW50ZXJuYWxMYWJlbFVwZGF0ZWQuZW1pdCh0cnVlKTtcbiAgICAgIH0gfSkpLCBoKFwiZGl2XCIsIHsgaWQ6IFwibGFiZWxEaXZfSWRcIiB9LCBoKFwiZGl2XCIsIHsgaWQ6IFwiU29ydGFibGVDb21wb25lbnRzX0lkXCIsIGNsYXNzOiBDU1MkMS5jb21wb25lbnREaXYgfSwgdGhpcy5sYWJlbENvbXBvbmVudHMpKSkpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCBhZGRMYWJlbEJ0biA9IChoKFwiY2FsY2l0ZS1mYWJcIiwgeyBpZDogXCJhZGRDb21wb25lbnRCdG5fSWRcIiwgaWNvbjogXCJwbHVzXCIsIHNsb3Q6IFwiZmFiXCIsIHNjYWxlOiBcInNcIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwga2luZDogXCJuZXV0cmFsXCIsIGxhYmVsOiB0aGlzLnN0cmluZ3MuYWRkTGFiZWwsIHRleHQ6IHRoaXMuc3RyaW5ncy5hZGRMYWJlbCwgXCJ0ZXh0LWVuYWJsZWRcIjogdHJ1ZSB9KSk7XG4gICAgcmV0dXJuIChoKEhvc3QsIHsgc3R5bGU6IHRoaXMuY2FsY2l0ZUZsb3dQcm9wcyA/IHt9IDogeyBkaXNwbGF5OiBcImZsZXhcIiwgZmxleDogXCIxIDEgYXV0b1wiLCBvdmVyZmxvdzogXCJoaWRkZW5cIiB9IH0sIHRoaXMuY2FsY2l0ZUZsb3dQcm9wcyA/IChoKFwiZGl2XCIsIHsgZGlyOiBnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpIH0sIHRoaXMubGFiZWxTd2l0Y2hBbmRDb250ZW50KCkpKSA6IChoKFwiY2FsY2l0ZS1mbG93XCIsIHsgZGlyOiBnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpIH0sIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IGlkOiBcImxhYmVsRmxvd0l0ZW1fSWRcIiwgaGVhZGluZzogdGhpcy5zdHJpbmdzLmxhYmVsRmVhdHVyZXMsIGRlc2NyaXB0aW9uOiAhdGhpcy5oaWRlTGF5ZXJUaXRsZSA/IHRoaXMubGF5ZXIudGl0bGUgOiB1bmRlZmluZWQsIGNsb3NhYmxlOiB0aGlzLmRpc21pc3NpYmxlLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuY2xvc2VMYWJlbFBvcG92ZXJzLmVtaXQoKTtcbiAgICAgICAgdGhpcy5hcmNnaXNMYWJlbERpc21pc3NlZENoYW5nZS5lbWl0KCk7XG4gICAgICB9LCByZWY6IChub2RlKSA9PiAodGhpcy5mbG93SXRlbU5vZGUgPSBub2RlKSB9LCB0aGlzLmxhYmVsU3dpdGNoQW5kQ29udGVudCgpLCBhZGRMYWJlbEJ0bikpKSkpO1xuICB9XG4gIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNMYWJlbC5zdHlsZSA9IGFyY2dpc0xhYmVsQ3NzO1xuXG5jb25zdCBDU1MgPSB7XG4gIGxhYmVsQ29udGVudEJ1dHRvblNlY3Rpb246IFwibGFiZWwtY29udGVudC1idG4tc2VjdGlvblwiLFxuICBsYWJlbENvbnRlbnRCdXR0b25FeHA6IFwibGFiZWwtY29udGVudC1idG4tZXhwXCIsXG4gIGxhYmVsQ29udGVudEJ1dHRvbjogXCJsYWJlbC1jb250ZW50LWJ0blwiLFxuICBsYWJlbENvbnRlbnRCdXR0b25UZXh0OiBcImxhYmVsLWNvbnRlbnQtYnRuLXRleHRcIixcbiAgbGFiZWxDb250ZW50QnV0dG9uSWNvbjogXCJsYWJlbC1jb250ZW50LWJ0bi1pY29uXCIsXG4gIGZpZWxkRXhwcmVzc2lvbkRpdjogXCJmaWVsZC1leHByZXNzaW9uLWRpdlwiXG59O1xuXG5jb25zdCBhcmNnaXNMYWJlbENvbnRlbnRDc3MgPSBcIi5sYWJlbC1jb250ZW50LWJ0bi1zZWN0aW9ue2JhY2tncm91bmQtY29sb3I6dmFyKC0tYXJjZ2lzLWFwcC1iYWNrZ3JvdW5kKTttaW4td2lkdGg6MTAwJX0ubGFiZWwtY29udGVudC1idG57YmFja2dyb3VuZDp2YXIoLS1hcmNnaXMtYXBwLWJhY2tncm91bmQtY2xlYXIpO2JvcmRlcjoxcHggc29saWQgdmFyKC0tYXJjZ2lzLWFwcC1ib3JkZXIpO2JvcmRlci1yYWRpdXM6dmFyKC0tYXJjZ2lzLWFwcC1ib3JkZXItcmFkaXVzKTtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO3BhZGRpbmc6dmFyKC0tYXJjZ2lzLWFwcC1jYXAtc3BhY2luZy1oYWxmKSB2YXIoLS1hcmNnaXMtYXBwLXNpZGUtc3BhY2luZy1xdWFydGVyKTtjdXJzb3I6cG9pbnRlcjt3aWR0aDoxMDAlO3RleHQtYWxpZ246dW5zZXQ7dHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIHZhcigtLWFyY2dpcy1hcHAtYW5pbWF0aW9uLXRpbWUtZmFzdCkgdmFyKC0tYXJjZ2lzLWFwcC1lYXNpbmctZnVuY3Rpb24pLCBib3JkZXItY29sb3IgdmFyKC0tYXJjZ2lzLWFwcC1hbmltYXRpb24tdGltZS1mYXN0KSB2YXIoLS1hcmNnaXMtYXBwLWVhc2luZy1mdW5jdGlvbil9LmxhYmVsLWNvbnRlbnQtYnRuOmhvdmVye2JhY2tncm91bmQtY29sb3I6dmFyKC0tYXJjZ2lzLWFwcC1iYWNrZ3JvdW5kLWhvdmVyKTtib3JkZXItY29sb3I6dmFyKC0tYXJjZ2lzLWFwcC1ib3JkZXItaG92ZXIpfS5sYWJlbC1jb250ZW50LWJ0bi1leHB7d2lkdGg6Y2FsYygxMDAlIC0gMzJweCl9LmxhYmVsLWNvbnRlbnQtYnRuLWV4cCAubGFiZWwtY29udGVudC1idG57Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czowO2JvcmRlci1yaWdodDoxcHggc29saWQgdmFyKC0tYXJjZ2lzLWFwcC1ib3JkZXIpfS5sYWJlbC1jb250ZW50LWJ0bi10ZXh0e2ZvbnQtZmFtaWx5OnZhcigtLWFyY2dpcy1hcHAtZm9udC1mYW1pbHkpO2ZvbnQtc2l6ZTp2YXIoLS1hcmNnaXMtYXBwLWZvbnQtc2l6ZS0wKTtmbGV4OjAgMSBhdXRvO292ZXJmbG93OmhpZGRlbjtwYWRkaW5nOjAgdmFyKC0tYXJjZ2lzLWFwcC1zaWRlLXNwYWNpbmctZWlnaHRoKTt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzO3doaXRlLXNwYWNlOm5vd3JhcH0ubGFiZWwtY29udGVudC1idG4taWNvbntmbGV4OjAgMCAwJTtwYWRkaW5nOjAgdmFyKC0tYXJjZ2lzLWFwcC1zaWRlLXNwYWNpbmctaGFsZil9LmZpZWxkLWV4cHJlc3Npb24tZGl2e2FsaWduLWl0ZW1zOmNlbnRlcjtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47d2lkdGg6MTAwJTtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWFyY2dpcy1hcHAtYm9yZGVyKTtib3JkZXItcmFkaXVzOnZhcigtLWFyY2dpcy1hcHAtYm9yZGVyLXJhZGl1cyl9LmZpZWxkLWV4cHJlc3Npb24tZGl2IGNhbGNpdGUtYWN0aW9ue2ZsZXg6MCAwIGF1dG99I3NsaWRlcl9JZHttaW4td2lkdGg6MTAwJX1cIjtcblxuY29uc3QgQXJjZ2lzTGFiZWxDb250ZW50ID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmNsb3NlTGFiZWxQb3BvdmVycyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiY2xvc2VMYWJlbFBvcG92ZXJzXCIsIDcpO1xuICAgIHRoaXMuaW50ZXJuYWxMYWJlbFVwZGF0ZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImludGVybmFsTGFiZWxVcGRhdGVkXCIsIDcpO1xuICAgIHRoaXMubGFiZWxDb250ZW50UmVSZW5kZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImxhYmVsQ29udGVudFJlUmVuZGVyXCIsIDcpO1xuICAgIHRoaXMuZGlzYWJsZUxhYmVsUGFuZWwgPSBjcmVhdGVFdmVudCh0aGlzLCBcImRpc2FibGVMYWJlbFBhbmVsXCIsIDcpO1xuICAgIHRoaXMuZGVmYXVsdFNjcmlwdCA9IFwiXCI7XG4gICAgdGhpcy5hZ2dyZWdhdGlvbkV4cHJlc3Npb25NYXBwaW5nID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuZmllbGRQaWNrTGlzdENoYW5nZXMgPSBhc3luYyAoZXZlbnQpID0+IHtcbiAgICAgIHZhciBfYSwgX2I7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGNvbnN0IHNlbGVjdGVkRmllbGQgPSAoX2IgPSAoX2EgPSBldmVudC5kZXRhaWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZWxlY3RlZEZpZWxkcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iWzBdO1xuICAgICAgaWYgKHNlbGVjdGVkRmllbGQpIHtcbiAgICAgICAgaWYgKHRoaXMuc2VydmljZVR5cGUgPT09IHNlcnZpY2VUeXBlRW51bS5tYXBJbWFnZSkge1xuICAgICAgICAgIHRoaXMubGFiZWxDbGFzcy5sYWJlbEV4cHJlc3Npb24gPSBgWyR7c2VsZWN0ZWRGaWVsZH1dYDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBpZiAodGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5jbHVzdGVyKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5hZ2dyZWdhdGlvbkV4cHJlc3Npb25NYXBwaW5nLmhhcyhzZWxlY3RlZEZpZWxkKSkge1xuICAgICAgICAgICAgICB0aGlzLmxhYmVsQ2xhc3MubGFiZWxFeHByZXNzaW9uSW5mby5leHByZXNzaW9uID1cbiAgICAgICAgICAgICAgICB0aGlzLmFnZ3JlZ2F0aW9uRXhwcmVzc2lvbk1hcHBpbmcuZ2V0KHNlbGVjdGVkRmllbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIGZvciAoY29uc3QgW2ZpZWxkTmFtZSwgZXhwcmVzc2lvbl0gb2YgdGhpcy5hZ2dyZWdhdGlvbkV4cHJlc3Npb25NYXBwaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkTmFtZSA9PT0gc2VsZWN0ZWRGaWVsZCkge1xuICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbENsYXNzLmxhYmVsRXhwcmVzc2lvbkluZm8uZXhwcmVzc2lvbiA9IGV4cHJlc3Npb247XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5sYWJlbENsYXNzLmxhYmVsRXhwcmVzc2lvbkluZm8gPSB0aGlzLmxheWVyLmZpZWxkcy5zb21lKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgIGlmIChmaWVsZC5uYW1lID09PSBzZWxlY3RlZEZpZWxkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICgoX2EgPSBmaWVsZCA9PT0gbnVsbCB8fCBmaWVsZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmllbGQuZG9tYWluKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgPT09IFwiY29kZWQtdmFsdWVcIjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgZXhwcmVzc2lvbjogYCRmZWF0dXJlW1wiJHtzZWxlY3RlZEZpZWxkfVwiXVxcbkRvbWFpbk5hbWUoJGZlYXR1cmUsIFwiJHtzZWxlY3RlZEZpZWxkfVwiKWBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICBleHByZXNzaW9uOiBgJGZlYXR1cmVbXCIke3NlbGVjdGVkRmllbGR9XCJdYFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxhYmVsQ29udGVudFJlUmVuZGVyLmVtaXQoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2xvc2VMYWJlbFBvcG92ZXJzLmVtaXQoKTtcbiAgICB9O1xuICAgIHRoaXMuZ3VpZCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmJsb2NrT3BlbiA9IGZhbHNlO1xuICAgIHRoaXMubGFiZWxDbGFzcyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmNhbGNpdGVGbG93SXRlbSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnJlUmVuZGVyID0gdW5kZWZpbmVkO1xuICB9XG4gIC8vIGxpZmVjeWNsZSBtZXRob2RzXG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMubGF5ZXIgPSBsYWJlbFN0YXRlLmxheWVyO1xuICAgIHRoaXMubWFwVmlldyA9IGxhYmVsU3RhdGUubWFwVmlldztcbiAgICB0aGlzLnBvcnRhbCA9IGxhYmVsU3RhdGUucG9ydGFsO1xuICAgIHRoaXMuY29uZmlnID0gbGFiZWxTdGF0ZS5jb25maWc7XG4gICAgdGhpcy5zdHJpbmdzID0gbGFiZWxTdGF0ZS5zdHJpbmdzO1xuICAgIHRoaXMuY3VycmVudExhbmd1YWdlID0gbGFiZWxTdGF0ZS5jdXJyZW50TGFuZ3VhZ2U7XG4gICAgdGhpcy5sYXllckRpc3BsYXlUeXBlID0gbGFiZWxTdGF0ZS5sYXllckRpc3BsYXlUeXBlO1xuICAgIHRoaXMuc2VydmljZVR5cGUgPSBsYWJlbFN0YXRlLnNlcnZpY2VUeXBlO1xuICAgIHRoaXMucG9wdXBUZW1wbGF0ZSA9XG4gICAgICB0aGlzLmxheWVyRGlzcGxheVR5cGUgPT09IGxheWVyRGlzcGxheVR5cGVFbnVtLmZlYXR1cmVcbiAgICAgICAgPyB0aGlzLmxheWVyLnBvcHVwVGVtcGxhdGVcbiAgICAgICAgOiB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24ucG9wdXBUZW1wbGF0ZTtcbiAgICB0aGlzLmxhYmVsRmllbGRzID0gYXdhaXQgdGhpcy5nZXRGaWVsZHNGb3JMYWJlbGluZygpO1xuICAgIHRoaXMuZGVmYXVsdFNjcmlwdCA9IGAvLyAke3RoaXMuc3RyaW5ncy5hcmNhZGVTY3JpcHRMaW5lMX0gXFxuLy8gJHt0aGlzLnN0cmluZ3MuYXJjYWRlU2NyaXB0TGluZTJ9XFxuLy8gJGZlYXR1cmUubmFtZSArIFwiIFwiICsgJGZlYXR1cmUuc3RhdHVzXFxuYDtcbiAgICBpZiAoIXRoaXMuY2FsY2l0ZUZsb3dJdGVtKSB7XG4gICAgICB0aGlzLmNhbGNpdGVGbG93SXRlbSA9IHRoaXMuaG9zdEVsZW1lbnQuY2xvc2VzdChcIiNsYWJlbEZsb3dJdGVtX0lkXCIpO1xuICAgIH1cbiAgICAvLyBzZXR1cCBtYXBwaW5nIGZvciBjbHVzdGVyIGNhc2UuIFdlIGRvbnQgd2FudCB0byB1c2UgZGVmYXVsdCB2YWx1ZXMgc2luY2UgdGhlcmUgaXMgbm8gZm9ybWF0dGluZy5cbiAgICBpZiAodGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5jbHVzdGVyKSB7XG4gICAgICBbdGhpcy5iaW5MYWJlbENyZWF0b3IsIHRoaXMuY2x1c3RlckxhYmVsQ3JlYXRvcl0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXG4gICAgICAgIFwiZXNyaS9zbWFydE1hcHBpbmcvbGFiZWxzL2JpbnNcIixcbiAgICAgICAgXCJlc3JpL3NtYXJ0TWFwcGluZy9sYWJlbHMvY2x1c3RlcnNcIlxuICAgICAgXSk7XG4gICAgICBjb25zdCBnZXRTY2hlbWVzRm9yRmllbGQgPSBhc3luYyAoZmllbGROYW1lKSA9PiB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGxldCBsYWJlbFNjaGVtZXM7XG4gICAgICAgIGlmICgoKF9hID0gdGhpcy5sYXllci5mZWF0dXJlUmVkdWN0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgPT09IFwiYmlubmluZ1wiKSB7XG4gICAgICAgICAgbGFiZWxTY2hlbWVzID0gYXdhaXQgdGhpcy5iaW5MYWJlbENyZWF0b3IuZ2V0TGFiZWxTY2hlbWVzKHtcbiAgICAgICAgICAgIGxheWVyOiB0aGlzLmxheWVyLFxuICAgICAgICAgICAgZmllbGQ6IGZpZWxkTmFtZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGxhYmVsU2NoZW1lcyA9IGF3YWl0IHRoaXMuY2x1c3RlckxhYmVsQ3JlYXRvci5nZXRMYWJlbFNjaGVtZXMoe1xuICAgICAgICAgICAgbGF5ZXI6IHRoaXMubGF5ZXIsXG4gICAgICAgICAgICByZW5kZXJlcjogKF9iID0gdGhpcy5sYXllcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnJlbmRlcmVyLFxuICAgICAgICAgICAgdmlldzogdGhpcy5tYXBWaWV3LFxuICAgICAgICAgICAgZmllbGQ6IGZpZWxkTmFtZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFsbFNjaGVtZXMgPSBbbGFiZWxTY2hlbWVzID09PSBudWxsIHx8IGxhYmVsU2NoZW1lcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGFiZWxTY2hlbWVzLnByaW1hcnlTY2hlbWUsIC4uLmxhYmVsU2NoZW1lcyA9PT0gbnVsbCB8fCBsYWJlbFNjaGVtZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxhYmVsU2NoZW1lcy5zZWNvbmRhcnlTY2hlbWVzXTtcbiAgICAgICAgYWxsU2NoZW1lcy5mb3JFYWNoKChjbHVzdGVyU2NoZW1lKSA9PiB7XG4gICAgICAgICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgICAgICAgdGhpcy5hZ2dyZWdhdGlvbkV4cHJlc3Npb25NYXBwaW5nLnNldChjbHVzdGVyU2NoZW1lID09PSBudWxsIHx8IGNsdXN0ZXJTY2hlbWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsdXN0ZXJTY2hlbWUuZmllbGROYW1lLCAoX2MgPSAoX2IgPSAoX2EgPSBjbHVzdGVyU2NoZW1lID09PSBudWxsIHx8IGNsdXN0ZXJTY2hlbWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsdXN0ZXJTY2hlbWUubGFiZWxpbmdJbmZvKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF0pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5sYWJlbEV4cHJlc3Npb25JbmZvKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZXhwcmVzc2lvbik7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGNhbGxzID0gW107XG4gICAgICB0aGlzLmxhYmVsRmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICAgIGNhbGxzLnB1c2goZ2V0U2NoZW1lc0ZvckZpZWxkKGZpZWxkLm5hbWUpKTtcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoY2FsbHMpO1xuICAgIH1cbiAgfVxuICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgIHRoaXMuYWRkU2NhbGVSYW5nZVNsaWRlcigpO1xuICB9XG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICB0aGlzLmludGVybmFsTGFiZWxVcGRhdGVkLmVtaXQoKTtcbiAgfVxuICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICBpZiAodGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0KSB7XG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuYXJjZ2lzRmllbGRQaWNrTGlzdCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmxhYmVsU3R5bGUpIHtcbiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5sYWJlbFN0eWxlKTtcbiAgICB9XG4gICAgaWYgKHRoaXMucG9wb3ZlclJlbmFtZUZvcm0pIHtcbiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5wb3BvdmVyUmVuYW1lRm9ybSk7XG4gICAgfVxuICAgIGlmICh0aGlzLmxhYmVsRmlsdGVyKSB7XG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMubGFiZWxGaWx0ZXIpO1xuICAgIH1cbiAgfVxuICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICBpZiAodGhpcy5ibG9ja09wZW4pIHtcbiAgICAgIHRoaXMuYmxvY2tPcHRpb25zLnNjcm9sbEludG9WaWV3KHsgYmVoYXZpb3I6IFwic21vb3RoXCIsIGJsb2NrOiBcIm5lYXJlc3RcIiwgaW5saW5lOiBcInN0YXJ0XCIgfSk7XG4gICAgICB0aGlzLmJsb2NrT3B0aW9ucy5zZXRGb2N1cygpO1xuICAgIH1cbiAgfVxuICAvLyBFdmVudHNcbiAgY2FsY2l0ZUJsb2NrVG9nZ2xlSGFuZGxlcigpIHtcbiAgICB0aGlzLmNsb3NlTGFiZWxQb3BvdmVycy5lbWl0KCk7XG4gIH1cbiAgbGFiZWxDb250ZW50UmVSZW5kZXJIYW5kbGVyKGV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5yZVJlbmRlciA9IHRoaXMucmVSZW5kZXIgPyBmYWxzZSA6IHRydWU7XG4gIH1cbiAgY2xvc2VMYWJlbFBvcG92ZXJzSGFuZGxlcigpIHtcbiAgICBpZiAodGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0KSB7XG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuYXJjZ2lzRmllbGRQaWNrTGlzdCk7XG4gICAgICB0aGlzLmFyY2dpc0ZpZWxkUGlja0xpc3QgPSBudWxsO1xuICAgICAgdGhpcy5hdHRyaWJ1dGVzQnRuLmZvY3VzKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmxhYmVsU3R5bGUpIHtcbiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5sYWJlbFN0eWxlKTtcbiAgICAgIHRoaXMubGFiZWxTdHlsZSA9IG51bGw7XG4gICAgICB0aGlzLnN0eWxlQnRuLmZvY3VzKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnBvcG92ZXJSZW5hbWVGb3JtKSB7XG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMucG9wb3ZlclJlbmFtZUZvcm0pO1xuICAgICAgdGhpcy5wb3BvdmVyUmVuYW1lRm9ybSA9IG51bGw7XG4gICAgICB0aGlzLmJsb2NrT3B0aW9ucy5zZXRGb2N1cygpO1xuICAgIH1cbiAgICBpZiAodGhpcy5sYWJlbEZpbHRlcikge1xuICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmxhYmVsRmlsdGVyKTtcbiAgICAgIHRoaXMubGFiZWxGaWx0ZXIgPSBudWxsO1xuICAgICAgdGhpcy5maWx0ZXJCdG4uZm9jdXMoKTtcbiAgICB9XG4gICAgdGhpcy5kaXNhYmxlTGFiZWxQYW5lbC5lbWl0KGZhbHNlKTtcbiAgfVxuICBub3RpZnlTeW1ib2xDaGFuZ2VzSGFuZGxlcihldmVudCkge1xuICAgIGlmICh0aGlzLmd1aWQgPT09IGV2ZW50LmRldGFpbCkge1xuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB0aGlzLmxhYmVsQ29udGVudFJlUmVuZGVyLmVtaXQoKTtcbiAgICB9XG4gIH1cbiAgbm90aWZ5RmlsdGVyVXBkYXRlZEhhbmRsZXIoZXZlbnQpIHtcbiAgICBpZiAodGhpcy5ndWlkID09PSBldmVudC5kZXRhaWwpIHtcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgdGhpcy5sYWJlbENvbnRlbnRSZVJlbmRlci5lbWl0KCk7XG4gICAgfVxuICB9XG4gIHJlbmFtZUNvbXBvbmVudEhhbmRsZXIoZXZlbnQpIHtcbiAgICBpZiAodGhpcy5ndWlkID09PSBldmVudC5kZXRhaWwpIHtcbiAgICAgIHRoaXMuY2xvc2VMYWJlbFBvcG92ZXJzLmVtaXQoKTtcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgaWYgKCF0aGlzLnBvcG92ZXJSZW5hbWVGb3JtKSB7XG4gICAgICAgIHRoaXMucG9wb3ZlclJlbmFtZUZvcm0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXBvcG92ZXItcmVuYW1lLWZvcm1cIik7XG4gICAgICAgIHRoaXMucG9wb3ZlclJlbmFtZUZvcm0uZ3VpZCA9IHRoaXMuZ3VpZDtcbiAgICAgICAgdGhpcy5wb3BvdmVyUmVuYW1lRm9ybS5yZWZFbGVtZW50ID0gdGhpcy5ob3N0RWxlbWVudDtcbiAgICAgICAgdGhpcy5wb3BvdmVyUmVuYW1lRm9ybS5wb3BvdmVyUGFuZWxXaWR0aCA9IHRoaXMuaG9zdEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG4gICAgICAgIHRoaXMucG9wb3ZlclJlbmFtZUZvcm0uaW50bFJlbmFtZUhlYWRlciA9IHRoaXMuc3RyaW5ncy5wb3BvdmVyUmVuYW1lSGVhZGVyO1xuICAgICAgICB0aGlzLnBvcG92ZXJSZW5hbWVGb3JtLmludGxPayA9IHRoaXMuc3RyaW5ncy5vaztcbiAgICAgICAgdGhpcy5wb3BvdmVyUmVuYW1lRm9ybS5pbnRsQ2FuY2VsID0gdGhpcy5zdHJpbmdzLmNhbmNlbDtcbiAgICAgICAgdGhpcy5wb3BvdmVyUmVuYW1lRm9ybS5pbnRsQ2xvc2UgPSB0aGlzLnN0cmluZ3MuY2xvc2U7XG4gICAgICAgIHRoaXMucG9wb3ZlclJlbmFtZUZvcm0uaW5wdXRWYWx1ZSA9XG4gICAgICAgICAgdGhpcy5sYWJlbENsYXNzLm5hbWUgfHwgdGhpcy5nZXREaXNwbGF5RmllbGROYW1lKCkgfHwgdGhpcy5zdHJpbmdzLmxhYmVsO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMucG9wb3ZlclJlbmFtZUZvcm0pO1xuICAgICAgICB0aGlzLmRpc2FibGVMYWJlbFBhbmVsLmVtaXQodHJ1ZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHBvcG92ZXJSZW5hbWVGb3JtRXZlbnRIYW5kbGVyKGV2ZW50KSB7XG4gICAgaWYgKHRoaXMuZ3VpZCA9PT0gZXZlbnQuZGV0YWlsWzBdKSB7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIHRoaXMuY2xvc2VMYWJlbFBvcG92ZXJzLmVtaXQoKTtcbiAgICAgIGlmIChldmVudC5kZXRhaWxbMV0pIHtcbiAgICAgICAgdGhpcy5sYWJlbENsYXNzLm5hbWUgPSBldmVudC5kZXRhaWxbMV07XG4gICAgICAgIHRoaXMubGFiZWxDb250ZW50UmVSZW5kZXIuZW1pdCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvLyBwcml2YXRlIG1ldGhvZHMgYW5kIHByb3BlcnRpZXNcbiAgLy8gbG9va3VwIHBvcHVwaW5mbyBmb3IgYWxpYXNcbiAgYXN5bmMgZ2V0RmllbGRzRm9yTGFiZWxpbmcoKSB7XG4gICAgdmFyIF9hO1xuICAgIGlmICh0aGlzLmxheWVyRGlzcGxheVR5cGUgPT09IGxheWVyRGlzcGxheVR5cGVFbnVtLmZlYXR1cmUpIHtcbiAgICAgIGNvbnN0IGxheWVyRmllbGRzID0gYXdhaXQgZ2V0RmllbGRzRnJvbUxheWVyKHRoaXMubGF5ZXIpO1xuICAgICAgaWYgKChfYSA9IHRoaXMucG9wdXBUZW1wbGF0ZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpZWxkSW5mb3MpIHtcbiAgICAgICAgbGV0IGZpZWxkc1dpdGhBbGlhcyA9IFtdO1xuICAgICAgICBsYXllckZpZWxkc1xuICAgICAgICAgIC5maWx0ZXIoKGxheWVyRmllbGQpID0+IFtcbiAgICAgICAgICBcInN0cmluZ1wiLFxuICAgICAgICAgIFwic21hbGwtaW50ZWdlclwiLFxuICAgICAgICAgIFwiYmlnLWludGVnZXJcIixcbiAgICAgICAgICBcImludGVnZXJcIixcbiAgICAgICAgICBcInNpbmdsZVwiLFxuICAgICAgICAgIFwiZG91YmxlXCIsXG4gICAgICAgICAgXCJsb25nXCIsXG4gICAgICAgICAgXCJkYXRlXCIsXG4gICAgICAgICAgXCJkYXRlLW9ubHlcIixcbiAgICAgICAgICBcInRpbWUtb25seVwiLFxuICAgICAgICAgIFwidGltZXN0YW1wLW9mZnNldFwiLFxuICAgICAgICAgIFwib2lkXCIsXG4gICAgICAgICAgXCJndWlkXCIsXG4gICAgICAgICAgXCJnbG9iYWwtaWRcIlxuICAgICAgICBdLmluZGV4T2YobGF5ZXJGaWVsZC50eXBlKSA+IC0xKVxuICAgICAgICAgIC5mb3JFYWNoKChsYXllckZpZWxkKSA9PiB7XG4gICAgICAgICAgZmllbGRzV2l0aEFsaWFzID0gWy4uLmZpZWxkc1dpdGhBbGlhcywgbGF5ZXJGaWVsZC5jbG9uZSgpXTtcbiAgICAgICAgICB0aGlzLnBvcHVwVGVtcGxhdGUuZmllbGRJbmZvcy5maW5kKChwb3B1cEZpZWxkKSA9PiB7XG4gICAgICAgICAgICBpZiAocG9wdXBGaWVsZC5maWVsZE5hbWUgPT09IGxheWVyRmllbGQubmFtZSkge1xuICAgICAgICAgICAgICBmaWVsZHNXaXRoQWxpYXNbZmllbGRzV2l0aEFsaWFzLmxlbmd0aCAtIDFdLmFsaWFzID0gcG9wdXBGaWVsZC5sYWJlbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBmaWVsZHNXaXRoQWxpYXM7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGxheWVyRmllbGRzO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBnZXRDbHVzdGVyRmllbGRzKHRoaXMucG9wdXBUZW1wbGF0ZSwgZmFsc2UpO1xuICAgIH1cbiAgfVxuICAvLyBvcGVuIHBvcG92ZXJcbiAgYXN5bmMgb3BlbkF0dHJpYnV0ZXNMaXN0KCkge1xuICAgIC8vIGNsb3NlIGZpcnN0IHNpbmNlIHdlIGNhbiBoYXZlIG11bHRpcGxlIGF0dHJpYnV0ZXMgb3BlblxuICAgIHRoaXMuY2xvc2VMYWJlbFBvcG92ZXJzLmVtaXQoKTtcbiAgICB0aGlzLmNhbGNpdGVGbG93SXRlbS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAvLyBsYXp5IGxvYWQgYXR0cmlidXRlIHNlbGVjdGlvbiBjb21wb25lbnRcbiAgICBpZiAoIXRoaXMuYXJjZ2lzRmllbGRQaWNrTGlzdCkge1xuICAgICAgdGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1maWVsZC1waWNrLWxpc3RcIik7XG4gICAgICB0aGlzLmFyY2dpc0ZpZWxkUGlja0xpc3QucG9wb3ZlclByb3BzID0ge1xuICAgICAgICByZWZFbGVtZW50OiB0aGlzLmNhbGNpdGVGbG93SXRlbSxcbiAgICAgICAgb2Zmc2V0U2tpZGRpbmc6IDUwXG4gICAgICB9O1xuICAgICAgdGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0LmZpZWxkcyA9IHRoaXMubGFiZWxGaWVsZHM7XG4gICAgICB0aGlzLmFyY2dpc0ZpZWxkUGlja0xpc3QubGF5ZXIgPSB0aGlzLmxheWVyO1xuICAgICAgdGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0Lm1hcFZpZXcgPSB0aGlzLm1hcFZpZXc7XG4gICAgICB0aGlzLmFyY2dpc0ZpZWxkUGlja0xpc3Quc2hvd0ZpZWxkSW5mbyA9XG4gICAgICAgIHRoaXMubGF5ZXJEaXNwbGF5VHlwZSA9PT0gbGF5ZXJEaXNwbGF5VHlwZUVudW0uZmVhdHVyZTtcbiAgICAgIHRoaXMuYXJjZ2lzRmllbGRQaWNrTGlzdC5zZWxlY3RlZEZpZWxkcyA9XG4gICAgICAgIFt0aGlzLmxhYmVsQ2xhc3MuZ2V0TGFiZWxFeHByZXNzaW9uU2luZ2xlRmllbGQoKV0gfHwgW1xuICAgICAgICAgIHRoaXMuZ2V0RmllbGROYW1lRnJvbUFnZ3JlZ2F0aW9uRXhwcmVzc2lvbigpXG4gICAgICAgIF0gfHxcbiAgICAgICAgICBbXTtcbiAgICAgIHRoaXMuYXJjZ2lzRmllbGRQaWNrTGlzdC5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzRmllbGRQaWNrTGlzdERpc21pc3NlZFwiLCB0aGlzLmZpZWxkUGlja0xpc3RDaGFuZ2VzKTtcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0KTtcbiAgICAgIHRoaXMuZGlzYWJsZUxhYmVsUGFuZWwuZW1pdCh0cnVlKTtcbiAgICB9XG4gICAgdGhpcy5jYWxjaXRlRmxvd0l0ZW0ubG9hZGluZyA9IGZhbHNlO1xuICB9XG4gIC8vIGdldCBmaWVsZG5hbWUgZnJvbSBjbHVzdGVyIGV4cHJlc3Npb25cbiAgZ2V0RmllbGROYW1lRnJvbUFnZ3JlZ2F0aW9uRXhwcmVzc2lvbigpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGlmICh0aGlzLmxheWVyRGlzcGxheVR5cGUgPT09IGxheWVyRGlzcGxheVR5cGVFbnVtLmNsdXN0ZXIpIHtcbiAgICAgIGZvciAoY29uc3QgW2ZpZWxkTmFtZSwgZXhwcmVzc2lvbl0gb2YgdGhpcy5hZ2dyZWdhdGlvbkV4cHJlc3Npb25NYXBwaW5nKSB7XG4gICAgICAgIGlmIChleHByZXNzaW9uID09PSAoKF9iID0gKF9hID0gdGhpcy5sYWJlbENsYXNzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGFiZWxFeHByZXNzaW9uSW5mbykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmV4cHJlc3Npb24pKSB7XG4gICAgICAgICAgcmV0dXJuIGZpZWxkTmFtZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICAvLyBvcGVuIHBvcG92ZXJcbiAgb3BlbkxhYmVsU3R5bGUoKSB7XG4gICAgLy8gY2xvc2UgZmlyc3Qgc2luY2Ugd2UgY2FuIGhhdmUgbXVsdGlwbGUgYXR0cmlidXRlcyBvcGVuXG4gICAgdGhpcy5jbG9zZUxhYmVsUG9wb3ZlcnMuZW1pdCgpO1xuICAgIC8vIGxhenkgbG9hZCBhdHRyaWJ1dGUgc2VsZWN0aW9uIGNvbXBvbmVudFxuICAgIGlmICghdGhpcy5sYWJlbFN0eWxlKSB7XG4gICAgICB0aGlzLmxhYmVsU3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLWxhYmVsLWNvbnRlbnQtc3R5bGVcIik7XG4gICAgICB0aGlzLmxhYmVsU3R5bGUuZ3VpZCA9IHRoaXMuZ3VpZDtcbiAgICAgIHRoaXMubGFiZWxTdHlsZS5sYWJlbENvbnRlbnRSZWZFbGVtZW50ID0gdGhpcy5jYWxjaXRlRmxvd0l0ZW07XG4gICAgICB0aGlzLmxhYmVsU3R5bGUubGFiZWxDbGFzcyA9IHRoaXMubGFiZWxDbGFzcztcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5sYWJlbFN0eWxlKTtcbiAgICAgIHRoaXMuZGlzYWJsZUxhYmVsUGFuZWwuZW1pdCh0cnVlKTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgb3BlbkFyY2FkZUVkaXRvcigpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICB0aGlzLmNsb3NlTGFiZWxQb3BvdmVycy5lbWl0KCk7XG4gICAgaWYgKCF0aGlzLmFyY2FkZUVkaXRvcikge1xuICAgICAgdGhpcy5jYWxjaXRlRmxvd0l0ZW0uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgdGhpcy5hcmNhZGVFZGl0b3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLW1vZGFsLWFyY2FkZVwiKTtcbiAgICAgIHRoaXMuYXJjYWRlRWRpdG9yLmFyY2FkZVNjcmlwdCA9ICgoX2EgPSB0aGlzLmxhYmVsQ2xhc3MubGFiZWxFeHByZXNzaW9uSW5mbykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmV4cHJlc3Npb24pIHx8IFwiXCI7XG4gICAgICB0aGlzLmFyY2FkZUVkaXRvci5hcmNhZGVQcm9maWxlID0gdGhpcy5nZXRBcmNhZGVQcm9maWxlKCk7XG4gICAgICB0aGlzLmFyY2FkZUVkaXRvci50ZXN0RGF0YSA9IGF3YWl0IHRoaXMuZ2V0QXJjYWRlVGVzdERhdGEoKTtcbiAgICAgIHRoaXMuYXJjYWRlRWRpdG9yLmFkZEV4aXN0aW5nRXhwcmVzc2lvbnMgPSB0cnVlO1xuICAgICAgdGhpcy5hcmNhZGVFZGl0b3IubGF5ZXIgPSB0aGlzLmxheWVyO1xuICAgICAgdGhpcy5hcmNhZGVFZGl0b3IuYXJjYWRlVGl0bGUgPVxuICAgICAgICAoKF9iID0gdGhpcy5sYWJlbENsYXNzLmxhYmVsRXhwcmVzc2lvbkluZm8pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50aXRsZSkgfHwgdGhpcy5zdHJpbmdzLm5ld0V4cHJlc3Npb247XG4gICAgICB0aGlzLmFyY2FkZUVkaXRvci5hcmNhZGVUaXRsZUVkaXRhYmxlID0gdHJ1ZTtcbiAgICAgIHRoaXMuYXJjYWRlRWRpdG9yLnJldHVyblByZWRpY3RPdXRwdXRUeXBlID0gZmFsc2U7XG4gICAgICB0aGlzLmFyY2FkZUVkaXRvci5hcmNhZGVUaXRsZUVkaXRpbmdFbmFibGVkID0gISgoX2MgPSB0aGlzLmxhYmVsQ2xhc3MubGFiZWxFeHByZXNzaW9uSW5mbykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnRpdGxlKTtcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5hcmNhZGVFZGl0b3IpO1xuICAgICAgdGhpcy5hcmNhZGVFZGl0b3IuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc01vZGFsQXJjYWRlQ2xvc2VcIiwgKGV2ZW50KSA9PiB0aGlzLmFyY2FkZVNldHVwKGV2ZW50LmRldGFpbCkpO1xuICAgIH1cbiAgfVxuICBhc3luYyBhcmNhZGVTZXR1cChhcmNhZGVPYmplY3QpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKGFyY2FkZU9iamVjdCkge1xuICAgICAgaWYgKChfYSA9IHRoaXMubGFiZWxDbGFzcy5sYWJlbEV4cHJlc3Npb25JbmZvKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZXhwcmVzc2lvbikge1xuICAgICAgICB0aGlzLmxhYmVsQ2xhc3MubGFiZWxFeHByZXNzaW9uSW5mby5leHByZXNzaW9uID0gYXJjYWRlT2JqZWN0LnNjcmlwdDtcbiAgICAgICAgdGhpcy5sYWJlbENsYXNzLmxhYmVsRXhwcmVzc2lvbkluZm8udGl0bGUgPSBhcmNhZGVPYmplY3QudGl0bGU7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5sYWJlbENsYXNzLmxhYmVsRXhwcmVzc2lvbkluZm8gPSB7XG4gICAgICAgICAgZXhwcmVzc2lvbjogYXJjYWRlT2JqZWN0LnNjcmlwdCxcbiAgICAgICAgICB0aXRsZTogYXJjYWRlT2JqZWN0LnRpdGxlXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICB0aGlzLmxhYmVsQ29udGVudFJlUmVuZGVyLmVtaXQoKTtcbiAgICB9XG4gICAgdGhpcy5jYWxjaXRlRmxvd0l0ZW0uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuYXJjYWRlRWRpdG9yKTtcbiAgICB0aGlzLmFyY2FkZUVkaXRvciA9IG51bGw7XG4gICAgdGhpcy5hcmNhZGVCdG4uc2V0Rm9jdXMoKTtcbiAgfVxuICBnZXRBcmNhZGVQcm9maWxlKCkge1xuICAgIHJldHVybiB7XG4gICAgICBpZDogXCJsYWJlbGluZ1wiLFxuICAgICAgZGVmaW5pdGlvbnM6IHtcbiAgICAgICAgJGZlYXR1cmU6IHRoaXMubGF5ZXJEaXNwbGF5VHlwZSA9PT0gbGF5ZXJEaXNwbGF5VHlwZUVudW0uY2x1c3RlclxuICAgICAgICAgID8geyBmaWVsZHM6IGdldENsdXN0ZXJGaWVsZHModGhpcy5wb3B1cFRlbXBsYXRlLCBmYWxzZSkgfVxuICAgICAgICAgIDogdGhpcy5sYXllclxuICAgICAgfVxuICAgIH07XG4gIH1cbiAgYXN5bmMgZ2V0QXJjYWRlVGVzdERhdGEoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICh0aGlzLmxheWVyRGlzcGxheVR5cGUgPT09IGxheWVyRGlzcGxheVR5cGVFbnVtLmNsdXN0ZXIpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBwcm9maWxlVmFyaWFibGVJbnN0YW5jZXM6IHtcbiAgICAgICAgICAgICRmZWF0dXJlOiBhd2FpdCBnZXRTaW5nbGVDbHVzdGVyRmVhdHVyZSh0aGlzLm1hcFZpZXcsIHRoaXMubGF5ZXIsIHRoaXMucG9wdXBUZW1wbGF0ZSlcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNwYXRpYWxSZWZlcmVuY2U6IHRoaXMubWFwVmlldy5zcGF0aWFsUmVmZXJlbmNlLFxuICAgICAgICAgIHRpbWVab25lOiB0aGlzLm1hcFZpZXcudGltZVpvbmVcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGxldCB1cmw7XG4gICAgICBpZiAodGhpcy5sYXllci50eXBlID09PSBcInN1YnR5cGUtc3VibGF5ZXJcIikge1xuICAgICAgICB1cmwgPSB0aGlzLmxheWVyLnBhcmVudC51cmw7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdXJsID0gdGhpcy5sYXllci51cmw7XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwcm9maWxlVmFyaWFibGVJbnN0YW5jZXM6IHtcbiAgICAgICAgICAkZmVhdHVyZTogKGF3YWl0IGdldFNpbmdsZUZlYXR1cmUodGhpcy5sYXllciwgdGhpcy5tYXBWaWV3KSkuZmVhdHVyZXNbMF0sXG4gICAgICAgICAgJGxheWVyOiB0aGlzLmxheWVyLFxuICAgICAgICAgICRtYXA6IHRoaXMubWFwVmlldy5tYXAsXG4gICAgICAgICAgJGRhdGFzdG9yZTogdXJsXG4gICAgICAgIH0sXG4gICAgICAgIHNwYXRpYWxSZWZlcmVuY2U6IHRoaXMubWFwVmlldy5zcGF0aWFsUmVmZXJlbmNlLFxuICAgICAgICB0aW1lWm9uZTogdGhpcy5tYXBWaWV3LnRpbWVab25lXG4gICAgICB9O1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICB9XG4gIH1cbiAgZ2V0RGlzcGxheUZpZWxkTmFtZSgpIHtcbiAgICBjb25zdCBsYWJlbEZpZWxkTmFtZSA9IHRoaXMubGF5ZXJEaXNwbGF5VHlwZSA9PT0gbGF5ZXJEaXNwbGF5VHlwZUVudW0uY2x1c3RlclxuICAgICAgPyB0aGlzLmdldEZpZWxkTmFtZUZyb21BZ2dyZWdhdGlvbkV4cHJlc3Npb24oKVxuICAgICAgOiB0aGlzLmxhYmVsQ2xhc3MuZ2V0TGFiZWxFeHByZXNzaW9uU2luZ2xlRmllbGQoKTtcbiAgICBjb25zdCB0ZW1wRmllbGQgPSB0aGlzLmxhYmVsRmllbGRzLmZpbmQoKGZpZWxkKSA9PiB7XG4gICAgICBpZiAoZmllbGQubmFtZSA9PT0gbGFiZWxGaWVsZE5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGZpZWxkO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiAodGVtcEZpZWxkID09PSBudWxsIHx8IHRlbXBGaWVsZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVtcEZpZWxkLmFsaWFzKSB8fCBsYWJlbEZpZWxkTmFtZTtcbiAgfVxuICAvLyByZW5kb3IgbWV0aG9kc1xuICBhZGRTY2FsZVJhbmdlU2xpZGVyKCkge1xuICAgIGNvbnN0IHsgbGFiZWxDbGFzcyB9ID0gdGhpcztcbiAgICBsb2FkTW9kdWxlcyhbXCJlc3JpL3dpZGdldHMvU2NhbGVSYW5nZVNsaWRlclwiXSkudGhlbigoW1NjYWxlUmFuZ2VTbGlkZXJdKSA9PiB7XG4gICAgICB2YXIgX2EsIF9iO1xuICAgICAgY29uc3Qgc2xpZGVyRWxlbWVudCA9IHRoaXMuaG9zdEVsZW1lbnQuc2hhZG93Um9vdC5nZXRFbGVtZW50QnlJZChcInNsaWRlcl9JZFwiKTtcbiAgICAgIGNvbnN0IHNjYWxlUmFuZ2VTbGlkZXIgPSBuZXcgU2NhbGVSYW5nZVNsaWRlcih7XG4gICAgICAgIHZpZXc6IHRoaXMubWFwVmlldyxcbiAgICAgICAgcmVnaW9uOiAoKF9hID0gdGhpcy5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZWdpb24pIHx8ICgoX2IgPSB0aGlzLnBvcnRhbCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmdldFJlZ2lvbigpLnRvTG93ZXJDYXNlKCkpIHx8IFwid29cIixcbiAgICAgICAgbWluU2NhbGU6IGxhYmVsQ2xhc3MubWluU2NhbGUgfHwgMCxcbiAgICAgICAgbWF4U2NhbGU6IGxhYmVsQ2xhc3MubWF4U2NhbGUgfHwgMFxuICAgICAgfSwgc2xpZGVyRWxlbWVudCk7XG4gICAgICBzbGlkZXJFbGVtZW50Lmluc2VydEFkamFjZW50SFRNTChcImFmdGVyYmVnaW5cIiwgYDxsaW5rIHJlbD1cInN0eWxlc2hlZXRcIiBocmVmPVwiJHt0aGlzLmNvbmZpZy5qc2FwaVVybH0vdGhlbWVzL2xpZ2h0L21haW4uY3NzXCIgLz5gKTtcbiAgICAgIHNjYWxlUmFuZ2VTbGlkZXIud2F0Y2goW1wibWluU2NhbGVcIiwgXCJtYXhTY2FsZVwiXSwgKHZhbHVlLCBfb2xkVmFsdWUsIG5hbWUpID0+IHtcbiAgICAgICAgaWYgKG5hbWUgPT09IFwibWluU2NhbGVcIikge1xuICAgICAgICAgIGxhYmVsQ2xhc3MubWluU2NhbGUgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChuYW1lID09PSBcIm1heFNjYWxlXCIpIHtcbiAgICAgICAgICBsYWJlbENsYXNzLm1heFNjYWxlID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jbG9zZUxhYmVsUG9wb3ZlcnMuZW1pdCgpO1xuICAgICAgICB0aGlzLmxhYmVsQ29udGVudFJlUmVuZGVyLmVtaXQoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBjb25zdCB7IGJsb2NrT3BlbiwgZ3VpZCwgc3RyaW5ncyB9ID0gdGhpcztcbiAgICBjb25zdCBhbGxvd0V4cHJlc3Npb25zID0gdGhpcy5zZXJ2aWNlVHlwZSA9PT0gc2VydmljZVR5cGVFbnVtLmZlYXR1cmUgfHxcbiAgICAgICh0aGlzLnNlcnZpY2VUeXBlID09PSBzZXJ2aWNlVHlwZUVudW0ubWFwSW1hZ2UgJiZcbiAgICAgICAgKChfYiA9IChfYSA9IHRoaXMubGF5ZXIubGF5ZXIuY2FwYWJpbGl0aWVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZXhwb3J0TWFwKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc3VwcG9ydHNBcmNhZGVFeHByZXNzaW9uRm9yTGFiZWxpbmcpKTtcbiAgICBjb25zdCBsYWJlbEF0dHJpYnV0ZUJsb2NrID0gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MubGFiZWxBdHRyaWJ1dGUsIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLmZpZWxkRXhwcmVzc2lvbkRpdiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IGFsbG93RXhwcmVzc2lvbnMgPyBDU1MubGFiZWxDb250ZW50QnV0dG9uRXhwIDogQ1NTLmxhYmVsQ29udGVudEJ1dHRvblNlY3Rpb24gfSwgaChcImJ1dHRvblwiLCB7IHJlZjogKGVsKSA9PiAodGhpcy5hdHRyaWJ1dGVzQnRuID0gZWwpLCBjbGFzczogQ1NTLmxhYmVsQ29udGVudEJ1dHRvbiwgdGl0bGU6IHN0cmluZ3MuZmllbGQsIG9uQ2xpY2s6IChldmVudCkgPT4ge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5vcGVuQXR0cmlidXRlc0xpc3QoKTtcbiAgICAgIH0gfSwgaChcInNwYW5cIiwgeyBjbGFzczogQ1NTLmxhYmVsQ29udGVudEJ1dHRvblRleHQgfSwgdGhpcy5nZXREaXNwbGF5RmllbGROYW1lKCkgfHxcbiAgICAgICgoX2MgPSB0aGlzLmxhYmVsQ2xhc3MubGFiZWxFeHByZXNzaW9uSW5mbykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnRpdGxlKSB8fFxuICAgICAgc3RyaW5ncy5uZXdFeHByZXNzaW9uKSwgaChcInNwYW5cIiwgeyBjbGFzczogQ1NTLmxhYmVsQ29udGVudEJ1dHRvbkljb24gfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgaWNvbjogXCJjaGV2cm9uLWRvd25cIiB9KSkpKSwgYWxsb3dFeHByZXNzaW9ucyAmJiAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLmFyY2FkZUJ0biA9IGVsKSwgc2NhbGU6IFwic1wiLCB0ZXh0OiBzdHJpbmdzLmV4cHJlc3Npb24sIG9uQ2xpY2s6IChldmVudCkgPT4ge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5vcGVuQXJjYWRlRWRpdG9yKCk7XG4gICAgICB9IH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBzY2FsZTogXCJzXCIsIGljb246IFwiY29kZVwiIH0pKSkpKSk7XG4gICAgY29uc3QgbGFiZWxGaWx0ZXJCbG9jayA9IChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLmZpbHRlciwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MubGFiZWxDb250ZW50QnV0dG9uU2VjdGlvbiB9LCBoKFwiYnV0dG9uXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLmZpbHRlckJ0biA9IGVsKSwgY2xhc3M6IENTUy5sYWJlbENvbnRlbnRCdXR0b24sIHRpdGxlOiBzdHJpbmdzLmVkaXRMYWJlbEZpbHRlciwgb25DbGljazogKGV2ZW50KSA9PiB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLmNsb3NlTGFiZWxQb3BvdmVycy5lbWl0KCk7XG4gICAgICAgIGlmICghdGhpcy5sYWJlbEZpbHRlcikge1xuICAgICAgICAgIHRoaXMubGFiZWxGaWx0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLWxhYmVsLWNvbnRlbnQtZmlsdGVyXCIpO1xuICAgICAgICAgIHRoaXMubGFiZWxGaWx0ZXIuZ3VpZCA9IHRoaXMuZ3VpZDtcbiAgICAgICAgICB0aGlzLmxhYmVsRmlsdGVyLmxhYmVsRmlsdGVyUmVmRWxlbWVudCA9IHRoaXMuY2FsY2l0ZUZsb3dJdGVtO1xuICAgICAgICAgIHRoaXMubGFiZWxGaWx0ZXIubGFiZWxDbGFzcyA9IHRoaXMubGFiZWxDbGFzcztcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMubGFiZWxGaWx0ZXIpO1xuICAgICAgICAgIHRoaXMuZGlzYWJsZUxhYmVsUGFuZWwuZW1pdCh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgfSB9LCBoKFwic3BhblwiLCB7IGNsYXNzOiBDU1MubGFiZWxDb250ZW50QnV0dG9uVGV4dCB9LCBzdHJpbmdzLmVkaXRMYWJlbEZpbHRlciksIGgoXCJzcGFuXCIsIHsgY2xhc3M6IENTUy5sYWJlbENvbnRlbnRCdXR0b25JY29uIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBzY2FsZTogXCJzXCIsIGljb246IFwiY2hldnJvbi1kb3duXCIgfSkpKSkpKTtcbiAgICBjb25zdCBsYWJlbFN0eWxlQmxvY2sgPSAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5sYWJlbFN0eWxlLCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5sYWJlbENvbnRlbnRCdXR0b25TZWN0aW9uIH0sIGgoXCJidXR0b25cIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuc3R5bGVCdG4gPSBlbCksIGNsYXNzOiBDU1MubGFiZWxDb250ZW50QnV0dG9uLCB0aXRsZTogc3RyaW5ncy5lZGl0TGFiZWxTdHlsZSwgb25DbGljazogKGV2ZW50KSA9PiB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLm9wZW5MYWJlbFN0eWxlKCk7XG4gICAgICB9IH0sIGgoXCJzcGFuXCIsIHsgY2xhc3M6IENTUy5sYWJlbENvbnRlbnRCdXR0b25UZXh0IH0sIHN0cmluZ3MuZWRpdExhYmVsU3R5bGUpLCBoKFwic3BhblwiLCB7IGNsYXNzOiBDU1MubGFiZWxDb250ZW50QnV0dG9uSWNvbiB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBpY29uOiBcImNoZXZyb24tZG93blwiIH0pKSkpKSk7XG4gICAgY29uc3Qgc2xpZGVyQmxvY2sgPSAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy52aXNpYmxlUmFuZ2UsIGgoXCJkaXZcIiwgeyBpZDogXCJzbGlkZXJfSWRcIiB9KSkpO1xuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiY2FsY2l0ZS1ibG9ja1wiLCB7IGRpcjogZ2V0RWxlbWVudERpcih0aGlzLmhvc3RFbGVtZW50KSwgaGVhZGluZzogdGhpcy5sYWJlbENsYXNzLm5hbWUgfHwgdGhpcy5nZXREaXNwbGF5RmllbGROYW1lKCkgfHwgdGhpcy5zdHJpbmdzLmxhYmVsLCBjb2xsYXBzaWJsZTogdHJ1ZSwgb3BlbjogYmxvY2tPcGVuIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRyb2xcIiB9LCBoKFwiYXJjZ2lzLWNhbGNpdGUtYmxvY2stb3B0aW9uc1wiLCB7IHJlZjogKGVsKSA9PiAodGhpcy5ibG9ja09wdGlvbnMgPSBlbCksIGd1aWQ6IGd1aWQsIGludGxPcHRpb25zOiBzdHJpbmdzLm9wdGlvbnMsIGludGxEZWxldGU6IHN0cmluZ3MuZGVsZXRlLCBpbnRsRHVwbGljYXRlOiBzdHJpbmdzLmR1cGxpY2F0ZSwgaW50bFJlbmFtZTogc3RyaW5ncy5yZW5hbWUsIGNhbGNpdGVCbG9ja09wdGlvbnM6IHsgaGFzRGVsZXRlOiB0cnVlLCBoYXNEdXBsaWNhdGU6IHRydWUsIGhhc1JlbmFtZTogdHJ1ZSB9IH0pKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiaWNvblwiIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBzY2FsZTogXCJtXCIsIGljb246IFwibGFiZWxcIiB9KSksIGxhYmVsQXR0cmlidXRlQmxvY2ssIHRoaXMuc2VydmljZVR5cGUgPT09IHNlcnZpY2VUeXBlRW51bS5vZ2NGZWF0dXJlIHx8XG4gICAgICB0aGlzLnNlcnZpY2VUeXBlID09PSBzZXJ2aWNlVHlwZUVudW0ud2ZzIHx8XG4gICAgICB0aGlzLnNlcnZpY2VUeXBlID09PSBzZXJ2aWNlVHlwZUVudW0uc3VidHlwZVxuICAgICAgPyBudWxsXG4gICAgICA6IGxhYmVsRmlsdGVyQmxvY2ssIGxhYmVsU3R5bGVCbG9jaywgc2xpZGVyQmxvY2spKSk7XG4gIH1cbiAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0xhYmVsQ29udGVudC5zdHlsZSA9IGFyY2dpc0xhYmVsQ29udGVudENzcztcblxuY29uc3QgYXJjZ2lzTGFiZWxDb250ZW50U3R5bGVDc3MgPSBcIi5vZmZzZXQtZGl2e2FsaWduLWl0ZW1zOmNlbnRlcjtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47Z2FwOjE2cHh9XCI7XG5cbmNvbnN0IEFyY2dpc0xhYmVsQ29udGVudFN0eWxlID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmNsb3NlTGFiZWxQb3BvdmVycyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiY2xvc2VMYWJlbFBvcG92ZXJzXCIsIDcpO1xuICAgIHRoaXMubm90aWZ5U3ltYm9sQ2hhbmdlcyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibm90aWZ5U3ltYm9sQ2hhbmdlc1wiLCA3KTtcbiAgICB0aGlzLm1pbk1heE9mZnNldCA9IHtcbiAgICAgIG1pbk9mZnNldFg6IC0yMCxcbiAgICAgIG1pbk9mZnNldFk6IC0yMCxcbiAgICAgIG1heE9mZnNldFg6IDIwLFxuICAgICAgbWF4T2Zmc2V0WTogMjBcbiAgICB9O1xuICAgIC8vIG9wZW4gZm9udCBwb3BvdmVyXG4gICAgdGhpcy5vcGVuRm9udFBvcG92ZXIgPSAoKSA9PiB7XG4gICAgICB2YXIgX2EsIF9iO1xuICAgICAgaWYgKCF0aGlzLmFyY2dpc0ZvbnRQaWNrZXIpIHtcbiAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmFyY2dpc0ZvbnRQaWNrZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLWZvbnQtcGlja2VyXCIpO1xuICAgICAgICB0aGlzLmFyY2dpc0ZvbnRQaWNrZXIuZm9udE1hcCA9IHRoaXMuZm9udE1hcDtcbiAgICAgICAgdGhpcy5hcmNnaXNGb250UGlja2VyLmZvbnQgPSAoX2IgPSAoX2EgPSB0aGlzLmxhYmVsQ2xhc3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zeW1ib2wpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5mb250O1xuICAgICAgICB0aGlzLmFyY2dpc0ZvbnRQaWNrZXIucG9wb3ZlclByb3BzID0ge1xuICAgICAgICAgIHJlZkVsZW1lbnQ6IHRoaXMucGFuZWxFbGVtZW50XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYXJjZ2lzRm9udFBpY2tlci5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzRm9udFBpY2tlckRpc21pc3NlZFwiLCB0aGlzLmNsb3NlRm9udFBvcHZlcik7XG4gICAgICAgIHRoaXMuYXJjZ2lzRm9udFBpY2tlci5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzRm9udFBpY2tlckNoYW5nZVwiLCB0aGlzLmNoYW5nZUZvbnQpO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuYXJjZ2lzRm9udFBpY2tlcik7XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLmNsb3NlRm9udFBvcHZlciA9ICgpID0+IHtcbiAgICAgIGlmICh0aGlzLmFyY2dpc0ZvbnRQaWNrZXIpIHtcbiAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmFyY2dpc0ZvbnRQaWNrZXIpO1xuICAgICAgICB0aGlzLmFyY2dpc0ZvbnRQaWNrZXIgPSBudWxsO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAvLyBkb2Vzbid0IHdvcmsgd2l0aG91dCB0aW1lb3V0XG4gICAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuc2V0Rm9jdXMoKTtcbiAgICAgICAgfSwgMTAwKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuY2hhbmdlRm9udCA9IChldmVudCkgPT4ge1xuICAgICAgdmFyIF9hLCBfYjtcbiAgICAgIGNvbnN0IGZvbnQgPSBldmVudCA9PT0gbnVsbCB8fCBldmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXZlbnQuZGV0YWlsO1xuICAgICAgY29uc3QgbGFiZWxDbGFzc0ZvbnQgPSAoX2IgPSAoX2EgPSB0aGlzLmxhYmVsQ2xhc3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zeW1ib2wpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5mb250O1xuICAgICAgaWYgKGZvbnQgJiYgbGFiZWxDbGFzc0ZvbnQpIHtcbiAgICAgICAgbGFiZWxDbGFzc0ZvbnQuZmFtaWx5ID0gZm9udC5mYW1pbHk7XG4gICAgICAgIGxhYmVsQ2xhc3NGb250LndlaWdodCA9IGZvbnQud2VpZ2h0O1xuICAgICAgICBsYWJlbENsYXNzRm9udC5zdHlsZSA9IGZvbnQuc3R5bGU7XG4gICAgICB9XG4gICAgICB0aGlzLnJlUmVuZGVyID0gIXRoaXMucmVSZW5kZXI7XG4gICAgICB0aGlzLm5vdGlmeVN5bWJvbENoYW5nZXMuZW1pdCh0aGlzLmd1aWQpO1xuICAgIH07XG4gICAgdGhpcy5ndWlkID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubGFiZWxDb250ZW50UmVmRWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxhYmVsQ2xhc3MgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcbiAgICB0aGlzLnJlUmVuZGVyID0gZmFsc2U7XG4gIH1cbiAgLy8gbGlmZWN5Y2xlIG1ldGhvZHNcbiAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5sYXllciA9IGxhYmVsU3RhdGUubGF5ZXI7XG4gICAgdGhpcy5wb3J0YWwgPSBsYWJlbFN0YXRlLnBvcnRhbDtcbiAgICB0aGlzLnN0cmluZ3MgPSBsYWJlbFN0YXRlLnN0cmluZ3M7XG4gICAgdGhpcy5sYXllckdlb21ldHJ5VHlwZSA9IGxhYmVsU3RhdGUubGF5ZXJHZW9tZXRyeVR5cGU7XG4gICAgdGhpcy5zZXJ2aWNlVHlwZSA9IGxhYmVsU3RhdGUuc2VydmljZVR5cGU7XG4gICAgdGhpcy5sYXllckRpc3BsYXlUeXBlID0gbGFiZWxTdGF0ZS5sYXllckRpc3BsYXlUeXBlO1xuICAgIHRoaXMuZm9udE1hcCA9XG4gICAgICB0aGlzLnNlcnZpY2VUeXBlID09PSBzZXJ2aWNlVHlwZUVudW0ubWFwSW1hZ2UgPyBtYXBTZXJ2aWNlZm9udE1hcCA6IGZlYXR1cmVTZXJ2aWNlRm9udE1hcDtcbiAgfVxuICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgIHRoaXMuaXNPcGVuID0gdHJ1ZTtcbiAgICAvLyBuZWVkIHRpbWVvdXQgYmVjYXVzZSBvZiByZS1yZW5kZXJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLnBhbmVsRWxlbWVudC5zZXRGb2N1cygpKSwgMjAwKTtcbiAgfVxuICAvLyBQdWJsaWMgbWV0aG9kXG4gIGFzeW5jIHJlcG9zaXRpb24oKSB7XG4gICAgdmFyIF9hO1xuICAgIChfYSA9IHRoaXMucG9wb3Zlck5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZXBvc2l0aW9uKCk7XG4gIH1cbiAgLy8gRXZlbnRzXG4gIGFzeW5jIGNhbGNpdGVCbG9ja1NlY3Rpb25Ub2dnbGVIYW5kbGVyKGV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgY29uc3QgY29tcG9zZWRQYXRoID0gZXZlbnQuY29tcG9zZWRQYXRoKCk7XG4gICAgLy8gaGFsb1xuICAgIGlmICgoY29tcG9zZWRQYXRoID09PSBudWxsIHx8IGNvbXBvc2VkUGF0aCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29tcG9zZWRQYXRoWzBdLmlkKSA9PT0gXCJoYWxvQmxvY2tfSWRcIikge1xuICAgICAgaWYgKHRoaXMubGFiZWxDbGFzcy5zeW1ib2wuaGFsb0NvbG9yKSB7XG4gICAgICAgIHRoaXMudGVtcEhhbG9Db2xvciA9IHRoaXMubGFiZWxDbGFzcy5zeW1ib2wuaGFsb0NvbG9yO1xuICAgICAgICB0aGlzLmxhYmVsQ2xhc3Muc3ltYm9sLmhhbG9Db2xvciA9IG51bGw7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9Db2xvclwiXSkudGhlbihhc3luYyAoW0NvbG9yXSkgPT4ge1xuICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICB0aGlzLmxhYmVsQ2xhc3Muc3ltYm9sLmhhbG9Db2xvciA9IHRoaXMudGVtcEhhbG9Db2xvciB8fCBuZXcgQ29sb3IoXCJ3aGl0ZVwiKTtcbiAgICAgICAgICB0aGlzLmxhYmVsQ2xhc3Muc3ltYm9sLmhhbG9TaXplID0gdGhpcy5sYWJlbENsYXNzLnN5bWJvbC5oYWxvU2l6ZSB8fCAxICogMC43NTtcbiAgICAgICAgICBjb25zdCBoYWxvQ29sb3JQaWNrZXJDb21wb25lbnQgPSB0aGlzLmhvc3RFbGVtZW50LnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoXCJoYWxvQ29sb3JQaWNrZXJfSWRcIik7XG4gICAgICAgICAgaGFsb0NvbG9yUGlja2VyQ29tcG9uZW50LmNvbG9yID0gKChfYSA9IHRoaXMubGFiZWxDbGFzcy5zeW1ib2wuaGFsb0NvbG9yKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudG9IZXgoKSkgfHwgXCIjZmZmZmZmXCI7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLm5vdGlmeVN5bWJvbENoYW5nZXMuZW1pdCh0aGlzLmd1aWQpO1xuICAgIHRoaXMuaG9zdEVsZW1lbnQuc2hhZG93Um9vdC5nZXRFbGVtZW50QnlJZChcIm1hbmFnZVBvcG92ZXJfSWRcIilbXCJyZXBvc2l0aW9uXCJdKCk7XG4gIH1cbiAgLy8gcHJpdmF0ZSBtZXRob2RzIGFuZCBwcm9wZXJ0aWVzXG4gIGdldFBsYWNlbWVudEFycmF5KGxheWVyR2VvbWV0cnlUeXBlKSB7XG4gICAgdmFyIF9hO1xuICAgIGlmICh0aGlzLmxheWVyRGlzcGxheVR5cGUgPT09IGxheWVyRGlzcGxheVR5cGVFbnVtLmNsdXN0ZXIgJiZcbiAgICAgICgoX2EgPSB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSA9PT0gXCJiaW5uaW5nXCIpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgZWxzZSBpZiAobGF5ZXJHZW9tZXRyeVR5cGUgPT09IFwicG9pbnRcIiB8fCBsYXllckdlb21ldHJ5VHlwZSA9PT0gXCJtdWx0aXBvaW50XCIpIHtcbiAgICAgIHJldHVybiBwbGFjZW1lbnRQb2ludDtcbiAgICB9XG4gICAgZWxzZSBpZiAobGF5ZXJHZW9tZXRyeVR5cGUgPT09IFwicG9seWxpbmVcIikge1xuICAgICAgcmV0dXJuIHBsYWNlbWVudExpbmU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuICBjaGFuZ2VPZmZzZXQob2Zmc2V0KSB7XG4gICAgdGhpcy5sYWJlbENsYXNzLnN5bWJvbC54b2Zmc2V0ID0gb2Zmc2V0Lng7XG4gICAgdGhpcy5vZmZzZXRYRWxlbWVudC52YWx1ZSA9IHRoaXMubGFiZWxDbGFzcy5zeW1ib2wueG9mZnNldDtcbiAgICB0aGlzLm9mZnNldFhZU2xpZGVyLnggPSBvZmZzZXQueDtcbiAgICB0aGlzLmxhYmVsQ2xhc3Muc3ltYm9sLnlvZmZzZXQgPSBvZmZzZXQueTtcbiAgICB0aGlzLm9mZnNldFlFbGVtZW50LnZhbHVlID0gdGhpcy5sYWJlbENsYXNzLnN5bWJvbC55b2Zmc2V0O1xuICAgIHRoaXMub2Zmc2V0WFlTbGlkZXIueSA9IC1vZmZzZXQueTtcbiAgICB0aGlzLm5vdGlmeVN5bWJvbENoYW5nZXMuZW1pdCh0aGlzLmd1aWQpO1xuICB9XG4gIC8vIHJlbmRvciBtZXRob2RzXG4gIHBsYWNlbWVudFNlbGVjdGlvbigpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKCEodGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5jbHVzdGVyICYmXG4gICAgICAoKF9hID0gdGhpcy5sYXllci5mZWF0dXJlUmVkdWN0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgPT09IFwiYmlubmluZ1wiKSAmJlxuICAgICAgKChbXG4gICAgICAgIHNlcnZpY2VUeXBlRW51bS5mZWF0dXJlLFxuICAgICAgICBzZXJ2aWNlVHlwZUVudW0uY3N2LFxuICAgICAgICBzZXJ2aWNlVHlwZUVudW0uZ2VvanNvbixcbiAgICAgICAgc2VydmljZVR5cGVFbnVtLm9nY0ZlYXR1cmVcbiAgICAgIF0uaW5kZXhPZih0aGlzLnNlcnZpY2VUeXBlKSA+IC0xICYmXG4gICAgICAgICh0aGlzLmxheWVyR2VvbWV0cnlUeXBlID09PSBcInBvaW50XCIgfHwgdGhpcy5sYXllckdlb21ldHJ5VHlwZSA9PT0gXCJtdWx0aXBvaW50XCIpKSB8fFxuICAgICAgICAodGhpcy5zZXJ2aWNlVHlwZSA9PT0gc2VydmljZVR5cGVFbnVtLm1hcEltYWdlICYmXG4gICAgICAgICAgKHRoaXMubGF5ZXJHZW9tZXRyeVR5cGUgPT09IFwicG9pbnRcIiB8fFxuICAgICAgICAgICAgdGhpcy5sYXllckdlb21ldHJ5VHlwZSA9PT0gXCJtdWx0aXBvaW50XCIgfHxcbiAgICAgICAgICAgIHRoaXMubGF5ZXJHZW9tZXRyeVR5cGUgPT09IFwicG9seWxpbmVcIikpKSkge1xuICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCB0aGlzLnN0cmluZ3MucGxhY2VtZW50LCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBsYWJlbDogdGhpcy5zdHJpbmdzLnBsYWNlbWVudCwgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICB0aGlzLmxhYmVsQ2xhc3MubGFiZWxQbGFjZW1lbnQgPSBldmVudC5jdXJyZW50VGFyZ2V0LnNlbGVjdGVkT3B0aW9uLnZhbHVlO1xuICAgICAgICAgIHRoaXMubm90aWZ5U3ltYm9sQ2hhbmdlcy5lbWl0KHRoaXMuZ3VpZCk7XG4gICAgICAgIH0sIHJlZjogKG5vZGUpID0+ICh0aGlzLnBsYWNlbWVudE5vZGUgPSBub2RlKSB9LCB0aGlzLmdldFBsYWNlbWVudEFycmF5KHRoaXMubGF5ZXJHZW9tZXRyeVR5cGUpLm1hcCgocGxhY2VtZW50KSA9PiAoaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IHBsYWNlbWVudCwgc2VsZWN0ZWQ6IHRoaXMubGFiZWxDbGFzcy5sYWJlbFBsYWNlbWVudCA9PT0gcGxhY2VtZW50ID8gdHJ1ZSA6IGZhbHNlIH0sIHRoaXMuc3RyaW5nc1twbGFjZW1lbnRdIHx8IHBsYWNlbWVudCkpKSkpKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mLCBfZztcbiAgICBjb25zdCBpc0Jpbm5pbmcgPSB0aGlzLmxheWVyRGlzcGxheVR5cGUgPT09IGxheWVyRGlzcGxheVR5cGVFbnVtLmNsdXN0ZXIgJiZcbiAgICAgICgoX2EgPSB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSA9PT0gXCJiaW5uaW5nXCI7XG4gICAgY29uc3QgZm9udEZhbWlseVNlbGVjdGlvbiA9IChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCB0aGlzLnN0cmluZ3MuZm9udCwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYWxpZ25tZW50OiBcImljb24tZW5kLXNwYWNlLWJldHdlZW5cIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwga2luZDogXCJuZXV0cmFsXCIsIGljb25FbmQ6IFwiY2hldnJvbi1kb3duXCIsIGxhYmVsOiBmb250VG9Gb250TmFtZSgoX2MgPSAoX2IgPSB0aGlzLmxhYmVsQ2xhc3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zeW1ib2wpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5mb250KSwgd2lkdGg6IFwiZnVsbFwiLCBzY2FsZTogXCJtXCIsIG9uQ2xpY2s6IHRoaXMub3BlbkZvbnRQb3BvdmVyLCByZWY6IChub2RlKSA9PiAodGhpcy5mb250Tm9kZSA9IG5vZGUpIH0sIGZvbnRUb0ZvbnROYW1lKChfZSA9IChfZCA9IHRoaXMubGFiZWxDbGFzcykgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLnN5bWJvbCkgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLmZvbnQpKSkpO1xuICAgIGNvbnN0IGZvbnRTaXplU2VsZWN0aW9uID0gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5zaXplLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHR5cGU6IFwibnVtYmVyXCIsIHNjYWxlOiBcInNcIiwgbWluOiA1LCBtYXg6IDEyNSwgdmFsdWU6IGAke3RoaXMubGFiZWxDbGFzcy5zeW1ib2wuZm9udC5zaXplIC8gMC43NSB8fCA1fWAsIG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IChldmVudCkgPT4ge1xuICAgICAgICB0aGlzLndhaXRPblVzZXIoZXZlbnQsICgpID0+IHtcbiAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgIHRoaXMubGFiZWxDbGFzcy5zeW1ib2wuZm9udC5zaXplID0gTnVtYmVyKG5vZGUudmFsdWUpICogMC43NTtcbiAgICAgICAgICB0aGlzLm5vdGlmeVN5bWJvbENoYW5nZXMuZW1pdCh0aGlzLmd1aWQpO1xuICAgICAgICB9LCA1KTtcbiAgICAgIH0gfSkpKTtcbiAgICBjb25zdCBvZmZzZXQgPSAoaChcImRpdlwiLCB7IGNsYXNzOiBcIm9mZnNldC1kaXZcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCB0aGlzLnN0cmluZ3Mub2Zmc2V0LCBoKFwiYXJjZ2lzLXh5LXNsaWRlclwiLCB7IHJlZjogKGVsKSA9PiB7XG4gICAgICAgIHRoaXMub2Zmc2V0WFlTbGlkZXIgPSBlbDtcbiAgICAgIH0sIHg6IHRoaXMubGFiZWxDbGFzcy5zeW1ib2wueG9mZnNldCB8fCAwLCB5OiAtdGhpcy5sYWJlbENsYXNzLnN5bWJvbC55b2Zmc2V0IHx8IDAsIG1pblg6IHRoaXMubWluTWF4T2Zmc2V0Lm1pbk9mZnNldFgsIG1pblk6IHRoaXMubWluTWF4T2Zmc2V0Lm1pbk9mZnNldFksIG1heFg6IHRoaXMubWluTWF4T2Zmc2V0Lm1heE9mZnNldFgsIG1heFk6IHRoaXMubWluTWF4T2Zmc2V0Lm1heE9mZnNldFksIHN0ZXA6IDEsIHNuYXBwYWJsZTogdHJ1ZSwgb25BcmNnaXNYWVNsaWRlcklucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGNvbnN0IHNsaWRlciA9IGV2ZW50LmN1cnJlbnRUYXJnZXQ7XG4gICAgICAgIHRoaXMuY2hhbmdlT2Zmc2V0KHtcbiAgICAgICAgICB4OiBzbGlkZXIueCB8fCAwLFxuICAgICAgICAgIHk6IC1zbGlkZXIueSB8fCAwXG4gICAgICAgIH0pO1xuICAgICAgfSB9KSksIGgoXCJkaXZcIiwgbnVsbCwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBzY2FsZTogXCJzXCIgfSwgdGhpcy5zdHJpbmdzLm9mZnNldFgsIGgoXCJjYWxjaXRlLWlucHV0XCIsIHsgdHlwZTogXCJudW1iZXJcIiwgc2NhbGU6IFwic1wiLCBwbGFjZWhvbGRlcjogdGhpcy5zdHJpbmdzLm9mZnNldFgsIHZhbHVlOiBgJHt0aGlzLmxhYmVsQ2xhc3Muc3ltYm9sLnhvZmZzZXQgfHwgMH1gLCBtaW46IHRoaXMubWluTWF4T2Zmc2V0Lm1pbk9mZnNldFgsIG1heDogdGhpcy5taW5NYXhPZmZzZXQubWF4T2Zmc2V0WCwgcmVmOiAoZWxlbWVudCkgPT4ge1xuICAgICAgICB0aGlzLm9mZnNldFhFbGVtZW50ID0gZWxlbWVudDtcbiAgICAgIH0sIG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IChldmVudCkgPT4ge1xuICAgICAgICB0aGlzLndhaXRPblVzZXIoZXZlbnQsICgpID0+IHtcbiAgICAgICAgICB0aGlzLmNoYW5nZU9mZnNldCh7XG4gICAgICAgICAgICB4OiBOdW1iZXIodGhpcy5vZmZzZXRYRWxlbWVudC52YWx1ZSkgfHwgMCxcbiAgICAgICAgICAgIHk6IE51bWJlcih0aGlzLm9mZnNldFlFbGVtZW50LnZhbHVlKSB8fCAwXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sIDApO1xuICAgICAgfSB9KSksIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgc2NhbGU6IFwic1wiIH0sIHRoaXMuc3RyaW5ncy5vZmZzZXRZLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHR5cGU6IFwibnVtYmVyXCIsIHNjYWxlOiBcInNcIiwgcGxhY2Vob2xkZXI6IHRoaXMuc3RyaW5ncy5vZmZzZXRZLCB2YWx1ZTogYCR7dGhpcy5sYWJlbENsYXNzLnN5bWJvbC55b2Zmc2V0IHx8IDB9YCwgbWluOiB0aGlzLm1pbk1heE9mZnNldC5taW5PZmZzZXRZLCBtYXg6IHRoaXMubWluTWF4T2Zmc2V0Lm1heE9mZnNldFksIHJlZjogKGVsZW1lbnQpID0+IHtcbiAgICAgICAgdGhpcy5vZmZzZXRZRWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICB9LCBvbkNhbGNpdGVJbnB1dElucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgdGhpcy53YWl0T25Vc2VyKGV2ZW50LCAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5jaGFuZ2VPZmZzZXQoe1xuICAgICAgICAgICAgeDogTnVtYmVyKHRoaXMub2Zmc2V0WEVsZW1lbnQudmFsdWUpIHx8IDAsXG4gICAgICAgICAgICB5OiBOdW1iZXIodGhpcy5vZmZzZXRZRWxlbWVudC52YWx1ZSkgfHwgMFxuICAgICAgICAgIH0pO1xuICAgICAgICB9LCAwKTtcbiAgICAgIH0gfSkpKSkpO1xuICAgIGNvbnN0IGFsbG93T3ZlcnJ1biA9IChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGFsaWdubWVudDogXCJzdGFydFwiLCBsYXlvdXQ6IFwiaW5saW5lLXNwYWNlLWJldHdlZW5cIiB9LCB0aGlzLnN0cmluZ3MuYWxsb3dPdmVycnVuLCBoKFwiY2FsY2l0ZS1zd2l0Y2hcIiwgeyBzY2FsZTogXCJzXCIsIGNoZWNrZWQ6IHRoaXMubGFiZWxDbGFzcy5hbGxvd092ZXJydW4sIG9uQ2FsY2l0ZVN3aXRjaENoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgIHRoaXMubGFiZWxDbGFzcy5hbGxvd092ZXJydW4gPSBldmVudC50YXJnZXQuY2hlY2tlZDtcbiAgICAgICAgdGhpcy5ub3RpZnlTeW1ib2xDaGFuZ2VzLmVtaXQodGhpcy5ndWlkKTtcbiAgICAgIH0gfSkpKTtcbiAgICBjb25zdCByZXBlYXRMYWJlbCA9IChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGFsaWdubWVudDogXCJzdGFydFwiLCBsYXlvdXQ6IFwiaW5saW5lLXNwYWNlLWJldHdlZW5cIiB9LCB0aGlzLnN0cmluZ3MucmVwZWF0TGFiZWwsIGgoXCJjYWxjaXRlLXN3aXRjaFwiLCB7IHNjYWxlOiBcInNcIiwgY2hlY2tlZDogdGhpcy5sYWJlbENsYXNzLnJlcGVhdExhYmVsLCBvbkNhbGNpdGVTd2l0Y2hDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICB0aGlzLmxhYmVsQ2xhc3MucmVwZWF0TGFiZWwgPSBldmVudC50YXJnZXQuY2hlY2tlZDtcbiAgICAgICAgdGhpcy5yZVJlbmRlciA9ICF0aGlzLnJlUmVuZGVyO1xuICAgICAgICB0aGlzLm5vdGlmeVN5bWJvbENoYW5nZXMuZW1pdCh0aGlzLmd1aWQpO1xuICAgICAgfSB9KSkpO1xuICAgIGNvbnN0IHJlcGVhdExhYmVsRGlzdGFuY2UgPSAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgdGhpcy5zdHJpbmdzLmxhYmVsUmVwZWF0LCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IGRpc2FibGVkOiAhdGhpcy5sYWJlbENsYXNzLnJlcGVhdExhYmVsLCB0eXBlOiBcIm51bWJlclwiLCBzY2FsZTogXCJzXCIsIG1pbjogMCwgdmFsdWU6IGAke3RoaXMubGFiZWxDbGFzcy5yZXBlYXRMYWJlbERpc3RhbmNlIHx8IDB9YCwgb25DYWxjaXRlSW5wdXRJbnB1dDogKGV2ZW50KSA9PiB7XG4gICAgICAgIHRoaXMud2FpdE9uVXNlcihldmVudCwgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgdGhpcy5sYWJlbENsYXNzLnJlcGVhdExhYmVsRGlzdGFuY2UgPSBOdW1iZXIobm9kZS52YWx1ZSk7XG4gICAgICAgICAgdGhpcy5ub3RpZnlTeW1ib2xDaGFuZ2VzLmVtaXQodGhpcy5ndWlkKTtcbiAgICAgICAgfSwgMCk7XG4gICAgICB9IH0pKSk7XG4gICAgY29uc3QgaGFsb0Jsb2NrID0gdGhpcy5wYW5lbEVsZW1lbnQgJiYgKGgoXCJjYWxjaXRlLWJsb2NrLXNlY3Rpb25cIiwgeyBpZDogXCJoYWxvQmxvY2tfSWRcIiwgdGV4dDogdGhpcy5zdHJpbmdzLmhhbG8sIHRvZ2dsZURpc3BsYXk6IFwic3dpdGNoXCIsIG9wZW46IHRoaXMubGFiZWxDbGFzcy5zeW1ib2wuaGFsb0NvbG9yID8gdHJ1ZSA6IGZhbHNlIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5jb2xvciwgaChcImFyY2dpcy1jb2xvci1pbnB1dFwiLCB7IGlkOiBcImhhbG9Db2xvclBpY2tlcl9JZFwiLCBjb2xvcjogKChfZiA9IHRoaXMubGFiZWxDbGFzcy5zeW1ib2wuaGFsb0NvbG9yKSA9PT0gbnVsbCB8fCBfZiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2YudG9IZXgoKSkgfHwgXCIjZmZmZmZmXCIsIHBvcG92ZXJQcm9wczoge1xuICAgICAgICByZWZFbGVtZW50OiB0aGlzLnBhbmVsRWxlbWVudCxcbiAgICAgICAgcGxhY2VtZW50OiBcImxlYWRpbmctc3RhcnRcIixcbiAgICAgICAgb2Zmc2V0RGlzdGFuY2U6IC1NYXRoLnJvdW5kKHRoaXMucGFuZWxFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoKSxcbiAgICAgICAgb2Zmc2V0U2tpZGRpbmc6IDUwXG4gICAgICB9LCBvbkFyY2dpc0NvbG9ySW5wdXRDaGFuZ2U6IGFzeW5jIChldmVudCkgPT4ge1xuICAgICAgICBjb25zdCBjdXJyQ29sb3IgPSBldmVudC50YXJnZXQuY29sb3I7XG4gICAgICAgIGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvQ29sb3JcIl0pLnRoZW4oKFtDb2xvcl0pID0+IHtcbiAgICAgICAgICB0aGlzLmxhYmVsQ2xhc3Muc3ltYm9sLmhhbG9Db2xvciA9IG5ldyBDb2xvcihjdXJyQ29sb3IpO1xuICAgICAgICAgIHRoaXMubm90aWZ5U3ltYm9sQ2hhbmdlcy5lbWl0KHRoaXMuZ3VpZCk7XG4gICAgICAgIH0pO1xuICAgICAgfSwgb25BcmNnaXNDb2xvcklucHV0UG9wb3Zlck9wZW46ICgpID0+IHtcbiAgICAgICAgLy8gZ2l2ZSBpdCBzb21lIHRpbWUgaW4gY2FzZSBhbm90aGVyIGFyY2dpcy1jb2xvci1pbnB1dCBoYXMgdG8gY2xvc2UgZmlyc3RcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5mb250Tm9kZS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgdGhpcy5wbGFjZW1lbnROb2RlLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgfSwgMjAwKTtcbiAgICAgIH0sIG9uQXJjZ2lzQ29sb3JJbnB1dFBvcG92ZXJDbG9zZTogKCkgPT4ge1xuICAgICAgICB0aGlzLmZvbnROb2RlLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMucGxhY2VtZW50Tm9kZS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgfSB9KSksIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5zaXplLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHR5cGU6IFwibnVtYmVyXCIsIHNjYWxlOiBcInNcIiwgbWluOiAxLCBtYXg6IDEwLCB2YWx1ZTogYCR7TWF0aC5yb3VuZCh0aGlzLmxhYmVsQ2xhc3Muc3ltYm9sLmhhbG9TaXplIC8gMC43NSB8fCAxKX1gLCBvbkNhbGNpdGVJbnB1dElucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgdGhpcy53YWl0T25Vc2VyKGV2ZW50LCAoKSA9PiB7XG4gICAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICB0aGlzLmxhYmVsQ2xhc3Muc3ltYm9sLmhhbG9TaXplID0gTnVtYmVyKG5vZGUudmFsdWUpICogMC43NTtcbiAgICAgICAgICB0aGlzLm5vdGlmeVN5bWJvbENoYW5nZXMuZW1pdCh0aGlzLmd1aWQpO1xuICAgICAgICB9LCAxKTtcbiAgICAgIH0gfSkpKSk7XG4gICAgY29uc3QgcGFuZWxSZWN0ID0gdGhpcy5sYWJlbENvbnRlbnRSZWZFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiBcImpzLWFwcC1mbHlvdXRcIiB9LCBoKFwiY2FsY2l0ZS1wb3BvdmVyXCIsIHsgZGlyOiBnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpLCBpZDogXCJtYW5hZ2VQb3BvdmVyX0lkXCIsIHBsYWNlbWVudDogXCJsZWFkaW5nLXN0YXJ0XCIsIG9wZW46IHRoaXMuaXNPcGVuLCBwb2ludGVyRGlzYWJsZWQ6IHRydWUsIHJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMubGFiZWxDb250ZW50UmVmRWxlbWVudCwgb2Zmc2V0RGlzdGFuY2U6IC1NYXRoLnJvdW5kKHRoaXMubGFiZWxDb250ZW50UmVmRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCksIG9mZnNldFNraWRkaW5nOiA1MCwgbGFiZWw6IFwiXCIsIHN0eWxlOiB7XG4gICAgICAgIHpJbmRleDogXCIxMDBcIlxuICAgICAgfSwgdHJpZ2dlckRpc2FibGVkOiB0cnVlLCByZWY6IChub2RlKSA9PiAodGhpcy5wb3BvdmVyTm9kZSA9IG5vZGUpIH0sIGgoXCJjYWxjaXRlLXBhbmVsXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLnBhbmVsRWxlbWVudCA9IGVsKSwgY2xvc2FibGU6IHRydWUsIGNsYXNzOiBcInBhbmVsXCIsIHN0eWxlOiB7XG4gICAgICAgIHdpZHRoOiBgJHtwYW5lbFJlY3Qud2lkdGh9cHhgLFxuICAgICAgICBtYXhIZWlnaHQ6IGAke3BhbmVsUmVjdC5oZWlnaHQgKiAwLjh9cHhgXG4gICAgICB9LCBvbkNhbGNpdGVQYW5lbENsb3NlOiAoKSA9PiB0aGlzLmNsb3NlTGFiZWxQb3BvdmVycy5lbWl0KCkgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiaGVhZGVyLWNvbnRlbnRcIiB9LCB0aGlzLnN0cmluZ3MubGFiZWxTdHlsZSksIGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgaGVhZGluZzogXCJcIiwgY29sbGFwc2libGU6IGZhbHNlLCBvcGVuOiB0cnVlIH0sIGZvbnRGYW1pbHlTZWxlY3Rpb24sIFwiIFwiLCBmb250U2l6ZVNlbGVjdGlvbiwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgdGhpcy5zdHJpbmdzLmNvbG9yLCB0aGlzLnBhbmVsRWxlbWVudCAmJiAoaChcImFyY2dpcy1jb2xvci1pbnB1dFwiLCB7IGNvbG9yOiAoKF9nID0gdGhpcy5sYWJlbENsYXNzLnN5bWJvbC5jb2xvcikgPT09IG51bGwgfHwgX2cgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9nLnRvSGV4KCkpIHx8IFwiI2ZmZmZmZlwiLCBwb3BvdmVyUHJvcHM6IHtcbiAgICAgICAgcmVmRWxlbWVudDogdGhpcy5wYW5lbEVsZW1lbnQsXG4gICAgICAgIHBsYWNlbWVudDogXCJsZWFkaW5nLXN0YXJ0XCIsXG4gICAgICAgIG9mZnNldERpc3RhbmNlOiAtTWF0aC5yb3VuZCh0aGlzLnBhbmVsRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCksXG4gICAgICAgIG9mZnNldFNraWRkaW5nOiA1MCxcbiAgICAgICAgbWF4SGVpZ2h0OiBgJHtwYW5lbFJlY3QuaGVpZ2h0ICogMC44IC0gNTJ9cHhgIC8vIG1pbnVzIHBhbmVsaGVhZGVyIGhlaWdodFxuICAgICAgfSwgb25BcmNnaXNDb2xvcklucHV0Q2hhbmdlOiBhc3luYyAoZXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgY3VyckNvbG9yID0gZXZlbnQudGFyZ2V0LmNvbG9yO1xuICAgICAgICBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL0NvbG9yXCJdKS50aGVuKChbQ29sb3JdKSA9PiB7XG4gICAgICAgICAgdGhpcy5sYWJlbENsYXNzLnN5bWJvbC5jb2xvciA9IG5ldyBDb2xvcihjdXJyQ29sb3IpO1xuICAgICAgICAgIHRoaXMubm90aWZ5U3ltYm9sQ2hhbmdlcy5lbWl0KHRoaXMuZ3VpZCk7XG4gICAgICAgIH0pO1xuICAgICAgfSwgb25BcmNnaXNDb2xvcklucHV0UG9wb3Zlck9wZW46ICgpID0+IHtcbiAgICAgICAgLy8gZ2l2ZSBpdCBzb21lIHRpbWUgaW4gY2FzZSBhbm90aGVyIGFyY2dpcy1jb2xvci1pbnB1dCBoYXMgdG8gY2xvc2UgZmlyc3RcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5mb250Tm9kZS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgdGhpcy5wbGFjZW1lbnROb2RlLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgfSwgMjAwKTtcbiAgICAgIH0sIG9uQXJjZ2lzQ29sb3JJbnB1dFBvcG92ZXJDbG9zZTogKCkgPT4ge1xuICAgICAgICB0aGlzLmZvbnROb2RlLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMucGxhY2VtZW50Tm9kZS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgfSB9KSkpLCB0aGlzLnBsYWNlbWVudFNlbGVjdGlvbigpLCBpc0Jpbm5pbmcgfHwgdGhpcy5sYXllckdlb21ldHJ5VHlwZSAhPT0gXCJwb2x5bGluZVwiID8gb2Zmc2V0IDogbnVsbCwgIWlzQmlubmluZyAmJiB0aGlzLmxheWVyR2VvbWV0cnlUeXBlID09PSBcInBvbHlsaW5lXCIgPyAoaChcImRpdlwiLCBudWxsLCBhbGxvd092ZXJydW4sIFwiIFwiLCByZXBlYXRMYWJlbCwgXCIgXCIsIHJlcGVhdExhYmVsRGlzdGFuY2UpKSA6IG51bGwsIGhhbG9CbG9jaykpKSkpO1xuICB9XG4gIHdhaXRPblVzZXIoZXZlbnQsIGRvQ2hhbmdlLCBkZWZhdWx0VmFsdWUpIHtcbiAgICAvLyBmb3IgbnVtYmVyIGZpZWxkcyB3ZSBkb24ndCB3YW50IHRvIGFsbG93IGFuIGVtcHR5IHZhbHVlXG4gICAgLy8gb3IgdmFsdWUgb3V0c2lkZSB0aGUgcmFuZ2VcbiAgICAvLyBidXQgdGhlIHVzZXIgbWlnaHQgc2hvcnRseSB1c2UgYW4gZW1wdHkgaW5wdXQgYm94XG4gICAgLy8gd2hpbGUgdHlwaW5nIGEgbmV3IHZhbHVlXG4gICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICBpZiAodGhpcy50eXBpbmdIbmRsKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy50eXBpbmdIbmRsKTtcbiAgICAgIHRoaXMudHlwaW5nSG5kbCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgY29uc3QgdmFsID0gbm9kZS52YWx1ZTtcbiAgICBjb25zb2xlLmxvZyhcIj5cIiwgdmFsLCBcIjxcIik7XG4gICAgY29uc3QgcGFyc2VkVmFsID0gcGFyc2VGbG9hdCh2YWwpO1xuICAgIGlmICghdmFsKSB7XG4gICAgICAvLyB1bmRlZmluZWQgb3IgZW1wdHkgc3RyaW5nXG4gICAgICAvLyB1c2VyIG1pZ2h0IGJlIGluIHRoZSBtaWRkbGUgb2YgdHlwaW5nXG4gICAgICAvLyBnaXZlIHRoZSB1c2VyIDIgc2Vjb25kcyB0byBmaWxsIGluIGVtcHR5IGVudHJ5XG4gICAgICAvLyBvdGhlcndpc2UgdXNlIGRlZmF1bHQgdmFsdWVcbiAgICAgIHRoaXMudHlwaW5nSG5kbCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLnR5cGluZ0huZGwgPSB1bmRlZmluZWQ7XG4gICAgICAgIG5vZGUudmFsdWUgPSBgJHtkZWZhdWx0VmFsdWV9YDtcbiAgICAgICAgZG9DaGFuZ2UoZXZlbnQpO1xuICAgICAgfSwgMjAwMCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGlzRGVmaW5lZChub2RlLm1pbikgJiZcbiAgICAgIGlzRGVmaW5lZChub2RlLm1heCkgJiZcbiAgICAgIChub2RlLm1pbiA+IHBhcnNlZFZhbCB8fCBub2RlLm1heCA8IHBhcnNlZFZhbCkpIHtcbiAgICAgIC8vIGludmFsaWQgdmFsdWVcbiAgICAgIHRoaXMudHlwaW5nSG5kbCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLnR5cGluZ0huZGwgPSB1bmRlZmluZWQ7XG4gICAgICAgIC8vIHdlIHdhaXRlZCBhIGJpdDsgbm8gdXNlciBjaGFuZ2U7IHNldCB2YWx1ZSB0byB3aXRoaW4gcmFuZ2VcbiAgICAgICAgaWYgKG5vZGUubWluID4gcGFyc2VkVmFsKSB7XG4gICAgICAgICAgbm9kZS52YWx1ZSA9IGAke25vZGUubWlufWA7XG4gICAgICAgICAgZG9DaGFuZ2UoZXZlbnQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG5vZGUubWF4IDwgcGFyc2VkVmFsKSB7XG4gICAgICAgICAgbm9kZS52YWx1ZSA9IGAke25vZGUubWF4fWA7XG4gICAgICAgICAgZG9DaGFuZ2UoZXZlbnQpO1xuICAgICAgICB9XG4gICAgICB9LCA3NTApO1xuICAgIH1cbiAgICBlbHNlIGlmICh2YWxbMF0gIT09IFwiLVwiIHx8IChwYXJzZWRWYWwgIT09IDAgJiYgIWlzTmFOKHBhcnNlZFZhbCkpKSB7XG4gICAgICAvLyBub3QgJy0nLCAnLTAnLCAnLTAuJywgJy0wLjAnLCAuLi5cbiAgICAgIGRvQ2hhbmdlKGV2ZW50KTtcbiAgICB9IC8vIGVsc2UgZG9uJ3QgdXBkYXRlIGFueXRoaW5nOyBpdCdzIHN0aWxsIGtlZXBpbmcgbGFzdCB2YWx1ZVxuICB9XG4gIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNMYWJlbENvbnRlbnRTdHlsZS5zdHlsZSA9IGFyY2dpc0xhYmVsQ29udGVudFN0eWxlQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNMYWJlbCBhcyBhcmNnaXNfbGFiZWwsIEFyY2dpc0xhYmVsQ29udGVudCBhcyBhcmNnaXNfbGFiZWxfY29udGVudCwgQXJjZ2lzTGFiZWxDb250ZW50U3R5bGUgYXMgYXJjZ2lzX2xhYmVsX2NvbnRlbnRfc3R5bGUgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuZnVuY3Rpb24gZ2VuZXJhdGVJZChjb3VudHMpIHtcbiAgcmV0dXJuIGNvdW50c1xuICAgIC5tYXAoKGNvdW50KSA9PiB7XG4gICAgbGV0IG91dCA9IFwiXCI7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICBvdXQgKz0gKCgoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMCkgfCAwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpO1xuICAgIH1cbiAgICByZXR1cm4gb3V0O1xuICB9KVxuICAgIC5qb2luKFwiLVwiKTtcbn1cbmNvbnN0IGd1aWQgPSAoKSA9PiBnZW5lcmF0ZUlkKFsyLCAxLCAxLCAxLCAzXSk7XG5cbmV4cG9ydCB7IGd1aWQgYXMgZyB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBnIGFzIGdldFJlbmRlcmluZ1JlZiwgZiBhcyBmb3JjZVVwZGF0ZSB9IGZyb20gJy4vaW5kZXgtOTJlYmIzOTYuanMnO1xuXG5jb25zdCBhcHBlbmRUb01hcCA9IChtYXAsIHByb3BOYW1lLCB2YWx1ZSkgPT4ge1xuICAgIGNvbnN0IGl0ZW1zID0gbWFwLmdldChwcm9wTmFtZSk7XG4gICAgaWYgKCFpdGVtcykge1xuICAgICAgICBtYXAuc2V0KHByb3BOYW1lLCBbdmFsdWVdKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoIWl0ZW1zLmluY2x1ZGVzKHZhbHVlKSkge1xuICAgICAgICBpdGVtcy5wdXNoKHZhbHVlKTtcbiAgICB9XG59O1xuY29uc3QgZGVib3VuY2UgPSAoZm4sIG1zKSA9PiB7XG4gICAgbGV0IHRpbWVvdXRJZDtcbiAgICByZXR1cm4gKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgaWYgKHRpbWVvdXRJZCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG4gICAgICAgIH1cbiAgICAgICAgdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aW1lb3V0SWQgPSAwO1xuICAgICAgICAgICAgZm4oLi4uYXJncyk7XG4gICAgICAgIH0sIG1zKTtcbiAgICB9O1xufTtcblxuLyoqXG4gKiBDaGVjayBpZiBhIHBvc3NpYmxlIGVsZW1lbnQgaXNDb25uZWN0ZWQuXG4gKiBUaGUgcHJvcGVydHkgbWlnaHQgbm90IGJlIHRoZXJlLCBzbyB3ZSBjaGVjayBmb3IgaXQuXG4gKlxuICogV2Ugd2FudCBpdCB0byByZXR1cm4gdHJ1ZSBpZiBpc0Nvbm5lY3RlZCBpcyBub3QgYSBwcm9wZXJ0eSxcbiAqIG90aGVyd2lzZSB3ZSB3b3VsZCByZW1vdmUgdGhlc2UgZWxlbWVudHMgYW5kIHdvdWxkIG5vdCB1cGRhdGUuXG4gKlxuICogQmV0dGVyIGxlYWsgaW4gRWRnZSB0aGFuIHRvIGJlIHVzZWxlc3MuXG4gKi9cbmNvbnN0IGlzQ29ubmVjdGVkID0gKG1heWJlRWxlbWVudCkgPT4gISgnaXNDb25uZWN0ZWQnIGluIG1heWJlRWxlbWVudCkgfHwgbWF5YmVFbGVtZW50LmlzQ29ubmVjdGVkO1xuY29uc3QgY2xlYW51cEVsZW1lbnRzID0gZGVib3VuY2UoKG1hcCkgPT4ge1xuICAgIGZvciAobGV0IGtleSBvZiBtYXAua2V5cygpKSB7XG4gICAgICAgIG1hcC5zZXQoa2V5LCBtYXAuZ2V0KGtleSkuZmlsdGVyKGlzQ29ubmVjdGVkKSk7XG4gICAgfVxufSwgMjAwMCk7XG5jb25zdCBzdGVuY2lsU3Vic2NyaXB0aW9uID0gKCkgPT4ge1xuICAgIGlmICh0eXBlb2YgZ2V0UmVuZGVyaW5nUmVmICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIC8vIElmIHdlIGFyZSBub3QgaW4gYSBzdGVuY2lsIHByb2plY3QsIHdlIGRvIG5vdGhpbmcuXG4gICAgICAgIC8vIFRoaXMgZnVuY3Rpb24gaXMgbm90IHJlYWxseSBleHBvcnRlZCBieSBAc3RlbmNpbC9jb3JlLlxuICAgICAgICByZXR1cm4ge307XG4gICAgfVxuICAgIGNvbnN0IGVsbXNUb1VwZGF0ZSA9IG5ldyBNYXAoKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBkaXNwb3NlOiAoKSA9PiBlbG1zVG9VcGRhdGUuY2xlYXIoKSxcbiAgICAgICAgZ2V0OiAocHJvcE5hbWUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVsbSA9IGdldFJlbmRlcmluZ1JlZigpO1xuICAgICAgICAgICAgaWYgKGVsbSkge1xuICAgICAgICAgICAgICAgIGFwcGVuZFRvTWFwKGVsbXNUb1VwZGF0ZSwgcHJvcE5hbWUsIGVsbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogKHByb3BOYW1lKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50cyA9IGVsbXNUb1VwZGF0ZS5nZXQocHJvcE5hbWUpO1xuICAgICAgICAgICAgaWYgKGVsZW1lbnRzKSB7XG4gICAgICAgICAgICAgICAgZWxtc1RvVXBkYXRlLnNldChwcm9wTmFtZSwgZWxlbWVudHMuZmlsdGVyKGZvcmNlVXBkYXRlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGVhbnVwRWxlbWVudHMoZWxtc1RvVXBkYXRlKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVzZXQ6ICgpID0+IHtcbiAgICAgICAgICAgIGVsbXNUb1VwZGF0ZS5mb3JFYWNoKChlbG1zKSA9PiBlbG1zLmZvckVhY2goZm9yY2VVcGRhdGUpKTtcbiAgICAgICAgICAgIGNsZWFudXBFbGVtZW50cyhlbG1zVG9VcGRhdGUpO1xuICAgICAgICB9LFxuICAgIH07XG59O1xuXG5jb25zdCB1bndyYXAgPSAodmFsKSA9PiAodHlwZW9mIHZhbCA9PT0gJ2Z1bmN0aW9uJyA/IHZhbCgpIDogdmFsKTtcbmNvbnN0IGNyZWF0ZU9ic2VydmFibGVNYXAgPSAoZGVmYXVsdFN0YXRlLCBzaG91bGRVcGRhdGUgPSAoYSwgYikgPT4gYSAhPT0gYikgPT4ge1xuICAgIGNvbnN0IHVud3JhcHBlZFN0YXRlID0gdW53cmFwKGRlZmF1bHRTdGF0ZSk7XG4gICAgbGV0IHN0YXRlcyA9IG5ldyBNYXAoT2JqZWN0LmVudHJpZXModW53cmFwcGVkU3RhdGUgIT09IG51bGwgJiYgdW53cmFwcGVkU3RhdGUgIT09IHZvaWQgMCA/IHVud3JhcHBlZFN0YXRlIDoge30pKTtcbiAgICBjb25zdCBoYW5kbGVycyA9IHtcbiAgICAgICAgZGlzcG9zZTogW10sXG4gICAgICAgIGdldDogW10sXG4gICAgICAgIHNldDogW10sXG4gICAgICAgIHJlc2V0OiBbXSxcbiAgICB9O1xuICAgIGNvbnN0IHJlc2V0ID0gKCkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIC8vIFdoZW4gcmVzZXR0aW5nIHRoZSBzdGF0ZSwgdGhlIGRlZmF1bHQgc3RhdGUgbWF5IGJlIGEgZnVuY3Rpb24gLSB1bndyYXAgaXQgdG8gaW52b2tlIGl0LlxuICAgICAgICAvLyBvdGhlcndpc2UsIHRoZSBzdGF0ZSB3b24ndCBiZSBwcm9wZXJseSByZXNldFxuICAgICAgICBzdGF0ZXMgPSBuZXcgTWFwKE9iamVjdC5lbnRyaWVzKChfYSA9IHVud3JhcChkZWZhdWx0U3RhdGUpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiB7fSkpO1xuICAgICAgICBoYW5kbGVycy5yZXNldC5mb3JFYWNoKChjYikgPT4gY2IoKSk7XG4gICAgfTtcbiAgICBjb25zdCBkaXNwb3NlID0gKCkgPT4ge1xuICAgICAgICAvLyBDYWxsIGZpcnN0IGRpc3Bvc2UgYXMgcmVzZXR0aW5nIHRoZSBzdGF0ZSB3b3VsZFxuICAgICAgICAvLyBjYXVzZSBsZXNzIHVwZGF0ZXMgOylcbiAgICAgICAgaGFuZGxlcnMuZGlzcG9zZS5mb3JFYWNoKChjYikgPT4gY2IoKSk7XG4gICAgICAgIHJlc2V0KCk7XG4gICAgfTtcbiAgICBjb25zdCBnZXQgPSAocHJvcE5hbWUpID0+IHtcbiAgICAgICAgaGFuZGxlcnMuZ2V0LmZvckVhY2goKGNiKSA9PiBjYihwcm9wTmFtZSkpO1xuICAgICAgICByZXR1cm4gc3RhdGVzLmdldChwcm9wTmFtZSk7XG4gICAgfTtcbiAgICBjb25zdCBzZXQgPSAocHJvcE5hbWUsIHZhbHVlKSA9PiB7XG4gICAgICAgIGNvbnN0IG9sZFZhbHVlID0gc3RhdGVzLmdldChwcm9wTmFtZSk7XG4gICAgICAgIGlmIChzaG91bGRVcGRhdGUodmFsdWUsIG9sZFZhbHVlLCBwcm9wTmFtZSkpIHtcbiAgICAgICAgICAgIHN0YXRlcy5zZXQocHJvcE5hbWUsIHZhbHVlKTtcbiAgICAgICAgICAgIGhhbmRsZXJzLnNldC5mb3JFYWNoKChjYikgPT4gY2IocHJvcE5hbWUsIHZhbHVlLCBvbGRWYWx1ZSkpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBzdGF0ZSA9ICh0eXBlb2YgUHJveHkgPT09ICd1bmRlZmluZWQnXG4gICAgICAgID8ge31cbiAgICAgICAgOiBuZXcgUHJveHkodW53cmFwcGVkU3RhdGUsIHtcbiAgICAgICAgICAgIGdldChfLCBwcm9wTmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBnZXQocHJvcE5hbWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG93bktleXMoXykge1xuICAgICAgICAgICAgICAgIHJldHVybiBBcnJheS5mcm9tKHN0YXRlcy5rZXlzKCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldE93blByb3BlcnR5RGVzY3JpcHRvcigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoYXMoXywgcHJvcE5hbWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGVzLmhhcyhwcm9wTmFtZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0KF8sIHByb3BOYW1lLCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHNldChwcm9wTmFtZSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSkpO1xuICAgIGNvbnN0IG9uID0gKGV2ZW50TmFtZSwgY2FsbGJhY2spID0+IHtcbiAgICAgICAgaGFuZGxlcnNbZXZlbnROYW1lXS5wdXNoKGNhbGxiYWNrKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIHJlbW92ZUZyb21BcnJheShoYW5kbGVyc1tldmVudE5hbWVdLCBjYWxsYmFjayk7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBjb25zdCBvbkNoYW5nZSA9IChwcm9wTmFtZSwgY2IpID0+IHtcbiAgICAgICAgY29uc3QgdW5TZXQgPSBvbignc2V0JywgKGtleSwgbmV3VmFsdWUpID0+IHtcbiAgICAgICAgICAgIGlmIChrZXkgPT09IHByb3BOYW1lKSB7XG4gICAgICAgICAgICAgICAgY2IobmV3VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gV2UgbmVlZCB0byB1bndyYXAgdGhlIGRlZmF1bHRTdGF0ZSBiZWNhdXNlIGl0IG1pZ2h0IGJlIGEgZnVuY3Rpb24uXG4gICAgICAgIC8vIE90aGVyd2lzZSB3ZSBtaWdodCBub3QgYmUgc2VuZGluZyB0aGUgcmlnaHQgcmVzZXQgdmFsdWUuXG4gICAgICAgIGNvbnN0IHVuUmVzZXQgPSBvbigncmVzZXQnLCAoKSA9PiBjYih1bndyYXAoZGVmYXVsdFN0YXRlKVtwcm9wTmFtZV0pKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIHVuU2V0KCk7XG4gICAgICAgICAgICB1blJlc2V0KCk7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBjb25zdCB1c2UgPSAoLi4uc3Vic2NyaXB0aW9ucykgPT4ge1xuICAgICAgICBjb25zdCB1bnN1YnMgPSBzdWJzY3JpcHRpb25zLnJlZHVjZSgodW5zdWJzLCBzdWJzY3JpcHRpb24pID0+IHtcbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24uc2V0KSB7XG4gICAgICAgICAgICAgICAgdW5zdWJzLnB1c2gob24oJ3NldCcsIHN1YnNjcmlwdGlvbi5zZXQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24uZ2V0KSB7XG4gICAgICAgICAgICAgICAgdW5zdWJzLnB1c2gob24oJ2dldCcsIHN1YnNjcmlwdGlvbi5nZXQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24ucmVzZXQpIHtcbiAgICAgICAgICAgICAgICB1bnN1YnMucHVzaChvbigncmVzZXQnLCBzdWJzY3JpcHRpb24ucmVzZXQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24uZGlzcG9zZSkge1xuICAgICAgICAgICAgICAgIHVuc3Vicy5wdXNoKG9uKCdkaXNwb3NlJywgc3Vic2NyaXB0aW9uLmRpc3Bvc2UpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1bnN1YnM7XG4gICAgICAgIH0sIFtdKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHVuc3Vicy5mb3JFYWNoKCh1bnN1YikgPT4gdW5zdWIoKSk7XG4gICAgfTtcbiAgICBjb25zdCBmb3JjZVVwZGF0ZSA9IChrZXkpID0+IHtcbiAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSBzdGF0ZXMuZ2V0KGtleSk7XG4gICAgICAgIGhhbmRsZXJzLnNldC5mb3JFYWNoKChjYikgPT4gY2Ioa2V5LCBvbGRWYWx1ZSwgb2xkVmFsdWUpKTtcbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICAgIHN0YXRlLFxuICAgICAgICBnZXQsXG4gICAgICAgIHNldCxcbiAgICAgICAgb24sXG4gICAgICAgIG9uQ2hhbmdlLFxuICAgICAgICB1c2UsXG4gICAgICAgIGRpc3Bvc2UsXG4gICAgICAgIHJlc2V0LFxuICAgICAgICBmb3JjZVVwZGF0ZSxcbiAgICB9O1xufTtcbmNvbnN0IHJlbW92ZUZyb21BcnJheSA9IChhcnJheSwgaXRlbSkgPT4ge1xuICAgIGNvbnN0IGluZGV4ID0gYXJyYXkuaW5kZXhPZihpdGVtKTtcbiAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgICBhcnJheVtpbmRleF0gPSBhcnJheVthcnJheS5sZW5ndGggLSAxXTtcbiAgICAgICAgYXJyYXkubGVuZ3RoLS07XG4gICAgfVxufTtcblxuY29uc3QgY3JlYXRlU3RvcmUgPSAoZGVmYXVsdFN0YXRlLCBzaG91bGRVcGRhdGUpID0+IHtcbiAgICBjb25zdCBtYXAgPSBjcmVhdGVPYnNlcnZhYmxlTWFwKGRlZmF1bHRTdGF0ZSwgc2hvdWxkVXBkYXRlKTtcbiAgICBtYXAudXNlKHN0ZW5jaWxTdWJzY3JpcHRpb24oKSk7XG4gICAgcmV0dXJuIG1hcDtcbn07XG5cbmV4cG9ydCB7IGNyZWF0ZVN0b3JlIGFzIGMgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVTdG9yZSB9IGZyb20gJy4vaW5kZXgtODFkNTQ4YjcuanMnO1xuXG5jb25zdCBsYWJlbFN0b3JlID0gY3JlYXRlU3RvcmUoe1xuICBsYXllcjogbnVsbCxcbiAgbWFwVmlldzogbnVsbCxcbiAgcG9ydGFsOiBudWxsLFxuICBjb25maWc6IG51bGwsXG4gIHN0cmluZ3M6IG51bGwsXG4gIGN1cnJlbnRMYW5ndWFnZTogbnVsbCxcbiAgbGF5ZXJHZW9tZXRyeVR5cGU6IG51bGwsXG4gIHNlcnZpY2VUeXBlOiBudWxsLFxuICBsYXllckRpc3BsYXlUeXBlOiBudWxsXG59KTtcbmNvbnN0IGxhYmVsU3RhdGUgPSBsYWJlbFN0b3JlLnN0YXRlO1xuXG5leHBvcnQgeyBsYWJlbFN0YXRlIGFzIGwgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgeyBsIGFzIGxhbmd1YWdlTWFwIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtMjIyNThjOTAuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRBc3NldFBhdGggfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcblxuLy8gaHR0cHM6Ly9tZWRpdW0uY29tL3N0ZW5jaWwtdHJpY2tzL2ltcGxlbWVudGluZy1pbnRlcm5hdGlvbmFsaXNhdGlvbi1pMThuLXdpdGgtc3RlbmNpbC01ZTY1NTk1NTQxMTdcbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KSB7XG4gIHZhciBfYSwgX2IsIF9jO1xuICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICB9XG4gIGVsc2Uge1xuICAgIC8vIFwicnUtUlVcIiBtYXBzIHRvIFwicnVcIiB1c2UgY2FzZVxuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZy5zbGljZSgwLCAyKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCkge1xuICB2YXIgX2EsIF9iLCBfYztcbiAgLy8gaXQncyBPSyBpZiB3ZSBkb24ndCBoYXZlIHRoZSA0IGxldHRlciBsYW5ndWFnZSBmaWxlIGZvciBpdFxuICAvLyA0IGxldHRlciBsYW5ndWFnZSBjb2RlIG5lZWRlZCBmb3IgZm9ybWF0dGluZyBudW1iZXJzXG4gIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgLy8gd2Ugc3VwcG9ydCB0aGUgMiBsZXR0ZXIgY29kZWQgbGFuZ3VhZ2VcbiAgICAgIC8vIGUuZy4gaXQtQ0ggdnMgaXRcbiAgICAgIHJldHVybiBsYW5nO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBcImVuXCI7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgZmV0Y2goZ2V0QXNzZXRQYXRoKGAuLi9hcmNnaXMtYXBwLWFzc2V0cy9pMThuLyR7Y29tcG9uZW50TmFtZX0uaTE4bi4ke2xvY2FsZX0uanNvbmApKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgIGlmIChyZXN1bHQub2spXG4gICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XG4gICAgICBlbHNlXG4gICAgICAgIHJlamVjdCgpO1xuICAgIH0sICgpID0+IHJlamVjdCgpKTtcbiAgfSk7XG59XG5jb25zdCBzdHJpbmdDYWNoZSA9IHt9O1xuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICBjb25zdCBpZCA9IGAke2NvbXBvbmVudE5hbWV9JHtsb2NhbGV9YDtcbiAgaWYgKCFzdHJpbmdDYWNoZVtpZF0pIHtcbiAgICBzdHJpbmdDYWNoZVtpZF0gPSBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKTtcbiAgfVxuICByZXR1cm4gc3RyaW5nQ2FjaGVbaWRdO1xufVxuLyoqXG4gKiBHZXQgc3RyaW5ncyBhbmQgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGlzIG1ldGhvZCByZXR1cm5zIDIgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGUgZmlyc3Qgb25lIHJldHVybnMgYSBjb2RlIHRoYXQncyBhbHNvIHN1cHBvcnRlZCBhcyBhIGxhbmd1YWdlIGZpbGUuXG4gKiBUaGUgc2Vjb25kIG9uZSByZXR1cm5zIGEgY29kZSB3aGVyZSB0aGVyZSBpcyBzdXBwb3J0IGZvciB0aGUgZmlyc3QgMiBsZXR0ZXJzIG9mIHRoZSBjb2RlIGFzIHBhcnQgb2YgYSBsYW5ndWFnZSBmaWxlLFxuICogYnV0IHdpbGwgcmV0dXJuIHRoZSBvcmlnaW5hbCA0IGxldHRlciBjb2RlIGZyb20gdGhlIHBhZ2UuXG4gKiBFLmcuIEZvciBcIml0LWNoXCIgaXQgd2lsbCByZXR1cm4gXCJpdFwiIGFzIHRoZSBmaXJzdCBsYW5ndWFnZSBjb2RlIGFuZCBcIml0LWNoXCIgYXMgdGhlIHNlY29uZC5cbiAqIFRoZSBzZWNvbmQgb25lIGlzIHJlcXVpcmVkIGZvciBlc3JpLmludGwuc2V0TG9jYWxlKCkgdG8gZ2V0IHRoZSBjb3JyZWN0IGZvcm1hdHRpbmcuXG4gKlxuICogSWYgYSB0YWdOYW1lIGlzIHByb3ZpZGVkIGl0IHdpbGwgb3ZlcndpdGUgdGhlIGVsZW1lbnQncyB0YWdOYW1lXG4gKlxuICogIEByZXR1cm4gWyBzdHJpbmdzLCBmaXJzdCBsYW5ndWFnZSBjb2RlLCBzZWNvbmQgbGFuZ3VhZ2UgY29kZV1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyhlbGVtZW50LCB0YWdOYW1lKSB7XG4gIGNvbnN0IGNvbXBvbmVudE5hbWUgPSB0YWdOYW1lIHx8IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCBjb21wb25lbnRMYW5ndWFnZSA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KTtcbiAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2VJbnRsID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KTtcbiAgbGV0IHN0cmluZ3M7XG4gIHRyeSB7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBjb21wb25lbnRMYW5ndWFnZSk7XG4gIH1cbiAgY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLndhcm4oYG5vIGxvY2FsZSBmb3IgJHtjb21wb25lbnROYW1lfSAoJHtjb21wb25lbnRMYW5ndWFnZX0pIGxvYWRpbmcgZGVmYXVsdCBsb2NhbGUgZW4uYCk7XG4gICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBcImVuXCIpO1xuICB9XG4gIHJldHVybiBbc3RyaW5ncywgY29tcG9uZW50TGFuZ3VhZ2UsIGNvbXBvbmVudExhbmd1YWdlSW50bF07XG59XG5cbmV4cG9ydCB7IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZSBhcyBhLCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIGFzIGcgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==