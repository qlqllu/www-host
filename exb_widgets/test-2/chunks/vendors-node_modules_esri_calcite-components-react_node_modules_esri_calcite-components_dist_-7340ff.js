"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-node_modules_esri_calcite-components-react_node_modules_esri_calcite-components_dist_-7340ff"],{

/***/ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/calcite-tree.js":
/*!***************************************************************************************************************************!*\
  !*** ./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/calcite-tree.js ***!
  \***************************************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   CalciteTree: () => (/* binding */ CalciteTree),
/* harmony export */   defineCustomElement: () => (/* binding */ defineCustomElement)
/* harmony export */ });
/* harmony import */ var _stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @stencil/core/internal/client/index.js */ "./node_modules/@esri/calcite-components-react/node_modules/@stencil/core/internal/client/index.js");
/* harmony import */ var _dom_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom.js */ "./node_modules/@esri/calcite-components-react/node_modules/@esri/calcite-components/dist/components/dom.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.11.0
 */



function isTreeItem(element) {
  return element?.tagName === "CALCITE-TREE-ITEM";
}
function getTraversableItems(root) {
  return Array.from(root.querySelectorAll("calcite-tree-item:not([disabled])")).filter((item) => {
    let currentItem = item;
    while (currentItem !== root && currentItem !== undefined) {
      const parent = currentItem.parentElement;
      const traversable = !isTreeItem(parent) || !parent.hasChildren || parent.expanded;
      if (!traversable) {
        return false;
      }
      currentItem = currentItem.parentElement;
    }
    return true;
  });
}

const treeCss = ":host{display:block}:host(:focus){outline:2px solid transparent;outline-offset:2px}:host([hidden]){display:none}[hidden]{display:none}";

const Tree = /*@__PURE__*/ (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_1__.proxyCustomElement)(class extends _stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_1__.HTMLElement {
  constructor() {
    super();
    this.__registerHost();
    this.__attachShadow();
    this.calciteTreeSelect = (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_1__.createEvent)(this, "calciteTreeSelect", 6);
    this.keyDownHandler = (event) => {
      if (this.child) {
        return;
      }
      const root = this.el;
      const target = event.target;
      const supportedKeys = ["ArrowRight", "ArrowDown", "ArrowLeft", "ArrowUp", "Home", "End", "Tab"];
      if (!(isTreeItem(target) && this.el.contains(target)) || !supportedKeys.includes(event.key)) {
        return;
      }
      const traversableItems = getTraversableItems(root);
      if (event.key === "Tab") {
        // root tabindex will be restored when blurred/focused
        traversableItems.forEach((item) => (item.tabIndex = -1));
        return;
      }
      if (event.key === "ArrowDown") {
        const currentItemIndex = traversableItems.indexOf(target);
        const nextItem = traversableItems[currentItemIndex + 1];
        nextItem?.focus();
        event.preventDefault();
        return;
      }
      if (event.key === "ArrowUp") {
        const currentItemIndex = traversableItems.indexOf(target);
        const previousItem = traversableItems[currentItemIndex - 1];
        previousItem?.focus();
        event.preventDefault();
        return;
      }
      if (event.key === "ArrowLeft") {
        if (target.hasChildren && target.expanded) {
          target.expanded = false;
          event.preventDefault();
          return;
        }
        const rootToItemPath = traversableItems.slice(0, traversableItems.indexOf(target)).reverse();
        const parentItem = rootToItemPath.find((item) => item.depth === target.depth - 1);
        parentItem?.focus();
        event.preventDefault();
        return;
      }
      if (event.key === "ArrowRight") {
        if (!target.disabled && target.hasChildren) {
          if (!target.expanded) {
            target.expanded = true;
            event.preventDefault();
          }
          else {
            const currentItemIndex = traversableItems.indexOf(target);
            const nextItem = traversableItems[currentItemIndex + 1];
            nextItem?.focus();
            event.preventDefault();
          }
        }
        return;
      }
      if (event.key === "Home") {
        const firstNode = traversableItems.shift();
        if (firstNode) {
          firstNode.focus();
          event.preventDefault();
        }
        return;
      }
      if (event.key === "End") {
        const lastNode = traversableItems.pop();
        if (lastNode) {
          lastNode.focus();
          event.preventDefault();
        }
        return;
      }
    };
    this.lines = false;
    this.child = undefined;
    this.scale = "m";
    this.selectionMode = "single";
    this.selectedItems = [];
  }
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  componentWillRender() {
    const parent = this.el.parentElement?.closest("calcite-tree");
    this.lines = parent ? parent.lines : this.lines;
    this.scale = parent ? parent.scale : this.scale;
    this.selectionMode = parent ? parent.selectionMode : this.selectionMode;
    this.child = !!parent;
  }
  render() {
    return ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_1__.h)(_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_1__.Host, { "aria-multiselectable": this.child
        ? undefined
        : (this.selectionMode === "multiple" || this.selectionMode === "multichildren").toString(), onKeyDown: this.keyDownHandler, role: !this.child ? "tree" : undefined, tabIndex: this.getRootTabIndex() }, (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_1__.h)("slot", null)));
  }
  //--------------------------------------------------------------------------
  //
  //  Event Listeners
  //
  //--------------------------------------------------------------------------
  onFocus() {
    if (!this.child) {
      const focusTarget = this.el.querySelector("calcite-tree-item[selected]:not([disabled])") || this.el.querySelector("calcite-tree-item:not([disabled])");
      (0,_dom_js__WEBPACK_IMPORTED_MODULE_0__.k)(focusTarget);
    }
  }
  onFocusIn(event) {
    const focusedFromRootOrOutsideTree = event.relatedTarget === this.el || !this.el.contains(event.relatedTarget);
    if (focusedFromRootOrOutsideTree) {
      // gives user the ability to tab into external elements (modifying tabindex property will not work in firefox)
      this.el.removeAttribute("tabindex");
    }
  }
  onFocusOut(event) {
    const willFocusOutsideTree = !this.el.contains(event.relatedTarget);
    if (willFocusOutsideTree) {
      this.el.tabIndex = this.getRootTabIndex();
    }
  }
  onInternalTreeItemSelect(event) {
    if (this.child) {
      return;
    }
    const target = event.target;
    const childItems = (0,_dom_js__WEBPACK_IMPORTED_MODULE_0__.o)(target.querySelectorAll("calcite-tree-item"));
    event.preventDefault();
    event.stopPropagation();
    if (this.selectionMode === "ancestors") {
      this.updateAncestorTree(event);
      return;
    }
    const isNoneSelectionMode = this.selectionMode === "none";
    const shouldSelect = this.selectionMode !== null &&
      (!target.hasChildren ||
        (target.hasChildren &&
          (this.selectionMode === "children" || this.selectionMode === "multichildren")));
    const shouldDeselectAllChildren = this.selectionMode === "multichildren" && target.hasChildren;
    const shouldModifyToCurrentSelection = !isNoneSelectionMode &&
      event.detail.modifyCurrentSelection &&
      (this.selectionMode === "multiple" || this.selectionMode === "multichildren");
    const shouldClearCurrentSelection = !shouldModifyToCurrentSelection &&
      (((this.selectionMode === "single" || this.selectionMode === "multiple") &&
        childItems.length <= 0) ||
        this.selectionMode === "children" ||
        this.selectionMode === "multichildren");
    const shouldUpdateExpand = ["multiple", "none", "single", "single-persist"].includes(this.selectionMode) &&
      target.hasChildren;
    const targetItems = [];
    if (shouldSelect) {
      targetItems.push(target);
    }
    if (shouldClearCurrentSelection) {
      const selectedItems = (0,_dom_js__WEBPACK_IMPORTED_MODULE_0__.o)(this.el.querySelectorAll("calcite-tree-item[selected]"));
      selectedItems.forEach((treeItem) => {
        if (!targetItems.includes(treeItem)) {
          treeItem.selected = false;
        }
      });
    }
    if (shouldUpdateExpand &&
      ["multiple", "none", "single", "single-persist"].includes(this.selectionMode)) {
      target.expanded = !target.expanded;
    }
    if (shouldDeselectAllChildren) {
      childItems.forEach((item) => {
        item.selected = false;
        if (item.hasChildren) {
          item.expanded = false;
        }
      });
    }
    if (shouldModifyToCurrentSelection) {
      window.getSelection().removeAllRanges();
    }
    if (shouldModifyToCurrentSelection && target.selected) {
      targetItems.forEach((treeItem) => {
        if (!treeItem.disabled) {
          treeItem.selected = false;
        }
      });
    }
    else if (!isNoneSelectionMode) {
      targetItems.forEach((treeItem) => {
        if (!treeItem.disabled) {
          treeItem.selected = true;
        }
      });
    }
    this.selectedItems = isNoneSelectionMode
      ? []
      : (0,_dom_js__WEBPACK_IMPORTED_MODULE_0__.o)(this.el.querySelectorAll("calcite-tree-item")).filter((i) => i.selected);
    this.calciteTreeSelect.emit();
    event.stopPropagation();
  }
  updateAncestorTree(event) {
    const item = event.target;
    const updateItem = event.detail.updateItem;
    if (item.disabled || (item.indeterminate && !updateItem)) {
      return;
    }
    const ancestors = [];
    let parent = item.parentElement.closest("calcite-tree-item");
    while (parent) {
      ancestors.push(parent);
      parent = parent.parentElement.closest("calcite-tree-item");
    }
    const childItems = Array.from(item.querySelectorAll("calcite-tree-item:not([disabled])"));
    const childItemsWithNoChildren = childItems.filter((child) => !child.hasChildren);
    const childItemsWithChildren = childItems.filter((child) => child.hasChildren);
    let futureSelected;
    if (updateItem) {
      futureSelected = item.hasChildren ? !(item.selected || item.indeterminate) : !item.selected;
    }
    else {
      futureSelected = item.selected;
    }
    childItemsWithNoChildren.forEach((el) => {
      el.selected = futureSelected;
      el.indeterminate = false;
    });
    function updateItemState(childItems, item) {
      const selected = childItems.filter((child) => child.selected);
      const unselected = childItems.filter((child) => !child.selected);
      item.selected = selected.length === childItems.length;
      item.indeterminate = selected.length > 0 && unselected.length > 0;
    }
    childItemsWithChildren.reverse().forEach((el) => {
      const directChildItems = Array.from(el.querySelectorAll(":scope > calcite-tree > calcite-tree-item"));
      updateItemState(directChildItems, el);
    });
    if (updateItem) {
      if (item.hasChildren) {
        updateItemState(childItems, item);
      }
      else {
        item.selected = futureSelected;
        item.indeterminate = false;
      }
    }
    ancestors.forEach((ancestor) => {
      const descendants = (0,_dom_js__WEBPACK_IMPORTED_MODULE_0__.o)(ancestor.querySelectorAll("calcite-tree-item"));
      const activeDescendants = descendants.filter((el) => el.selected);
      if (activeDescendants.length === 0) {
        ancestor.selected = false;
        ancestor.indeterminate = false;
        return;
      }
      const indeterminate = activeDescendants.length < descendants.length;
      ancestor.indeterminate = indeterminate;
      ancestor.selected = !indeterminate;
    });
    this.selectedItems = (0,_dom_js__WEBPACK_IMPORTED_MODULE_0__.o)(this.el.querySelectorAll("calcite-tree-item")).filter((i) => i.selected);
    if (updateItem) {
      this.calciteTreeSelect.emit();
    }
  }
  // --------------------------------------------------------------------------
  //
  //  Private Methods
  //
  //--------------------------------------------------------------------------
  getRootTabIndex() {
    return !this.child ? 0 : -1;
  }
  get el() { return this; }
  static get style() { return treeCss; }
}, [1, "calcite-tree", {
    "lines": [1540],
    "child": [1540],
    "scale": [1537],
    "selectionMode": [1537, "selection-mode"],
    "selectedItems": [1040]
  }, [[0, "focus", "onFocus"], [0, "focusin", "onFocusIn"], [0, "focusout", "onFocusOut"], [0, "calciteInternalTreeItemSelect", "onInternalTreeItemSelect"]]]);
function defineCustomElement$1() {
  if (typeof customElements === "undefined") {
    return;
  }
  const components = ["calcite-tree"];
  components.forEach(tagName => { switch (tagName) {
    case "calcite-tree":
      if (!customElements.get(tagName)) {
        customElements.define(tagName, Tree);
      }
      break;
  } });
}
defineCustomElement$1();

const CalciteTree = Tree;
const defineCustomElement = defineCustomElement$1;




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvdmVuZG9ycy1ub2RlX21vZHVsZXNfZXNyaV9jYWxjaXRlLWNvbXBvbmVudHMtcmVhY3Rfbm9kZV9tb2R1bGVzX2VzcmlfY2FsY2l0ZS1jb21wb25lbnRzX2Rpc3RfLTczNDBmZi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUMrRztBQUM1Qzs7QUFFbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBLHVCQUF1QixjQUFjLGNBQWMsOEJBQThCLG1CQUFtQixnQkFBZ0IsYUFBYSxTQUFTLGFBQWE7O0FBRXZKLDJCQUEyQiwwRkFBa0IsZUFBZSwrRUFBVztBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixtRkFBVztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHlFQUFDLENBQUMsd0VBQUksSUFBSTtBQUN0QjtBQUNBLDhNQUE4TSxFQUFFLHlFQUFDO0FBQ2pOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sMENBQVk7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QiwwQ0FBZTtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsMENBQWU7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLFFBQVEsMENBQWU7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLDBDQUFlO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCx5QkFBeUIsMENBQWU7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLHVCQUF1QjtBQUN2QixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBOztBQUU0QyIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9ub2RlX21vZHVsZXMvQGVzcmkvY2FsY2l0ZS1jb21wb25lbnRzLXJlYWN0L25vZGVfbW9kdWxlcy9AZXNyaS9jYWxjaXRlLWNvbXBvbmVudHMvZGlzdC9jb21wb25lbnRzL2NhbGNpdGUtdHJlZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL0VzcmkvY2FsY2l0ZS1kZXNpZ24tc3lzdGVtL2Jsb2IvbWFpbi9MSUNFTlNFLm1kIGZvciBkZXRhaWxzLlxuICogdjEuMTEuMFxuICovXG5pbXBvcnQgeyBwcm94eUN1c3RvbUVsZW1lbnQsIEhUTUxFbGVtZW50LCBjcmVhdGVFdmVudCwgaCwgSG9zdCB9IGZyb20gJ0BzdGVuY2lsL2NvcmUvaW50ZXJuYWwvY2xpZW50L2luZGV4LmpzJztcbmltcG9ydCB7IGsgYXMgZm9jdXNFbGVtZW50LCBvIGFzIG5vZGVMaXN0VG9BcnJheSB9IGZyb20gJy4vZG9tLmpzJztcblxuZnVuY3Rpb24gaXNUcmVlSXRlbShlbGVtZW50KSB7XG4gIHJldHVybiBlbGVtZW50Py50YWdOYW1lID09PSBcIkNBTENJVEUtVFJFRS1JVEVNXCI7XG59XG5mdW5jdGlvbiBnZXRUcmF2ZXJzYWJsZUl0ZW1zKHJvb3QpIHtcbiAgcmV0dXJuIEFycmF5LmZyb20ocm9vdC5xdWVyeVNlbGVjdG9yQWxsKFwiY2FsY2l0ZS10cmVlLWl0ZW06bm90KFtkaXNhYmxlZF0pXCIpKS5maWx0ZXIoKGl0ZW0pID0+IHtcbiAgICBsZXQgY3VycmVudEl0ZW0gPSBpdGVtO1xuICAgIHdoaWxlIChjdXJyZW50SXRlbSAhPT0gcm9vdCAmJiBjdXJyZW50SXRlbSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb25zdCBwYXJlbnQgPSBjdXJyZW50SXRlbS5wYXJlbnRFbGVtZW50O1xuICAgICAgY29uc3QgdHJhdmVyc2FibGUgPSAhaXNUcmVlSXRlbShwYXJlbnQpIHx8ICFwYXJlbnQuaGFzQ2hpbGRyZW4gfHwgcGFyZW50LmV4cGFuZGVkO1xuICAgICAgaWYgKCF0cmF2ZXJzYWJsZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBjdXJyZW50SXRlbSA9IGN1cnJlbnRJdGVtLnBhcmVudEVsZW1lbnQ7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9KTtcbn1cblxuY29uc3QgdHJlZUNzcyA9IFwiOmhvc3R7ZGlzcGxheTpibG9ja306aG9zdCg6Zm9jdXMpe291dGxpbmU6MnB4IHNvbGlkIHRyYW5zcGFyZW50O291dGxpbmUtb2Zmc2V0OjJweH06aG9zdChbaGlkZGVuXSl7ZGlzcGxheTpub25lfVtoaWRkZW5de2Rpc3BsYXk6bm9uZX1cIjtcblxuY29uc3QgVHJlZSA9IC8qQF9fUFVSRV9fKi8gcHJveHlDdXN0b21FbGVtZW50KGNsYXNzIGV4dGVuZHMgSFRNTEVsZW1lbnQge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX19yZWdpc3Rlckhvc3QoKTtcbiAgICB0aGlzLl9fYXR0YWNoU2hhZG93KCk7XG4gICAgdGhpcy5jYWxjaXRlVHJlZVNlbGVjdCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiY2FsY2l0ZVRyZWVTZWxlY3RcIiwgNik7XG4gICAgdGhpcy5rZXlEb3duSGFuZGxlciA9IChldmVudCkgPT4ge1xuICAgICAgaWYgKHRoaXMuY2hpbGQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3Qgcm9vdCA9IHRoaXMuZWw7XG4gICAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICBjb25zdCBzdXBwb3J0ZWRLZXlzID0gW1wiQXJyb3dSaWdodFwiLCBcIkFycm93RG93blwiLCBcIkFycm93TGVmdFwiLCBcIkFycm93VXBcIiwgXCJIb21lXCIsIFwiRW5kXCIsIFwiVGFiXCJdO1xuICAgICAgaWYgKCEoaXNUcmVlSXRlbSh0YXJnZXQpICYmIHRoaXMuZWwuY29udGFpbnModGFyZ2V0KSkgfHwgIXN1cHBvcnRlZEtleXMuaW5jbHVkZXMoZXZlbnQua2V5KSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCB0cmF2ZXJzYWJsZUl0ZW1zID0gZ2V0VHJhdmVyc2FibGVJdGVtcyhyb290KTtcbiAgICAgIGlmIChldmVudC5rZXkgPT09IFwiVGFiXCIpIHtcbiAgICAgICAgLy8gcm9vdCB0YWJpbmRleCB3aWxsIGJlIHJlc3RvcmVkIHdoZW4gYmx1cnJlZC9mb2N1c2VkXG4gICAgICAgIHRyYXZlcnNhYmxlSXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4gKGl0ZW0udGFiSW5kZXggPSAtMSkpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoZXZlbnQua2V5ID09PSBcIkFycm93RG93blwiKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRJdGVtSW5kZXggPSB0cmF2ZXJzYWJsZUl0ZW1zLmluZGV4T2YodGFyZ2V0KTtcbiAgICAgICAgY29uc3QgbmV4dEl0ZW0gPSB0cmF2ZXJzYWJsZUl0ZW1zW2N1cnJlbnRJdGVtSW5kZXggKyAxXTtcbiAgICAgICAgbmV4dEl0ZW0/LmZvY3VzKCk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChldmVudC5rZXkgPT09IFwiQXJyb3dVcFwiKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRJdGVtSW5kZXggPSB0cmF2ZXJzYWJsZUl0ZW1zLmluZGV4T2YodGFyZ2V0KTtcbiAgICAgICAgY29uc3QgcHJldmlvdXNJdGVtID0gdHJhdmVyc2FibGVJdGVtc1tjdXJyZW50SXRlbUluZGV4IC0gMV07XG4gICAgICAgIHByZXZpb3VzSXRlbT8uZm9jdXMoKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCJBcnJvd0xlZnRcIikge1xuICAgICAgICBpZiAodGFyZ2V0Lmhhc0NoaWxkcmVuICYmIHRhcmdldC5leHBhbmRlZCkge1xuICAgICAgICAgIHRhcmdldC5leHBhbmRlZCA9IGZhbHNlO1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJvb3RUb0l0ZW1QYXRoID0gdHJhdmVyc2FibGVJdGVtcy5zbGljZSgwLCB0cmF2ZXJzYWJsZUl0ZW1zLmluZGV4T2YodGFyZ2V0KSkucmV2ZXJzZSgpO1xuICAgICAgICBjb25zdCBwYXJlbnRJdGVtID0gcm9vdFRvSXRlbVBhdGguZmluZCgoaXRlbSkgPT4gaXRlbS5kZXB0aCA9PT0gdGFyZ2V0LmRlcHRoIC0gMSk7XG4gICAgICAgIHBhcmVudEl0ZW0/LmZvY3VzKCk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChldmVudC5rZXkgPT09IFwiQXJyb3dSaWdodFwiKSB7XG4gICAgICAgIGlmICghdGFyZ2V0LmRpc2FibGVkICYmIHRhcmdldC5oYXNDaGlsZHJlbikge1xuICAgICAgICAgIGlmICghdGFyZ2V0LmV4cGFuZGVkKSB7XG4gICAgICAgICAgICB0YXJnZXQuZXhwYW5kZWQgPSB0cnVlO1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50SXRlbUluZGV4ID0gdHJhdmVyc2FibGVJdGVtcy5pbmRleE9mKHRhcmdldCk7XG4gICAgICAgICAgICBjb25zdCBuZXh0SXRlbSA9IHRyYXZlcnNhYmxlSXRlbXNbY3VycmVudEl0ZW1JbmRleCArIDFdO1xuICAgICAgICAgICAgbmV4dEl0ZW0/LmZvY3VzKCk7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoZXZlbnQua2V5ID09PSBcIkhvbWVcIikge1xuICAgICAgICBjb25zdCBmaXJzdE5vZGUgPSB0cmF2ZXJzYWJsZUl0ZW1zLnNoaWZ0KCk7XG4gICAgICAgIGlmIChmaXJzdE5vZGUpIHtcbiAgICAgICAgICBmaXJzdE5vZGUuZm9jdXMoKTtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChldmVudC5rZXkgPT09IFwiRW5kXCIpIHtcbiAgICAgICAgY29uc3QgbGFzdE5vZGUgPSB0cmF2ZXJzYWJsZUl0ZW1zLnBvcCgpO1xuICAgICAgICBpZiAobGFzdE5vZGUpIHtcbiAgICAgICAgICBsYXN0Tm9kZS5mb2N1cygpO1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5saW5lcyA9IGZhbHNlO1xuICAgIHRoaXMuY2hpbGQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zY2FsZSA9IFwibVwiO1xuICAgIHRoaXMuc2VsZWN0aW9uTW9kZSA9IFwic2luZ2xlXCI7XG4gICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gW107XG4gIH1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgTGlmZWN5Y2xlXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgY29tcG9uZW50V2lsbFJlbmRlcigpIHtcbiAgICBjb25zdCBwYXJlbnQgPSB0aGlzLmVsLnBhcmVudEVsZW1lbnQ/LmNsb3Nlc3QoXCJjYWxjaXRlLXRyZWVcIik7XG4gICAgdGhpcy5saW5lcyA9IHBhcmVudCA/IHBhcmVudC5saW5lcyA6IHRoaXMubGluZXM7XG4gICAgdGhpcy5zY2FsZSA9IHBhcmVudCA/IHBhcmVudC5zY2FsZSA6IHRoaXMuc2NhbGU7XG4gICAgdGhpcy5zZWxlY3Rpb25Nb2RlID0gcGFyZW50ID8gcGFyZW50LnNlbGVjdGlvbk1vZGUgOiB0aGlzLnNlbGVjdGlvbk1vZGU7XG4gICAgdGhpcy5jaGlsZCA9ICEhcGFyZW50O1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gKGgoSG9zdCwgeyBcImFyaWEtbXVsdGlzZWxlY3RhYmxlXCI6IHRoaXMuY2hpbGRcbiAgICAgICAgPyB1bmRlZmluZWRcbiAgICAgICAgOiAodGhpcy5zZWxlY3Rpb25Nb2RlID09PSBcIm11bHRpcGxlXCIgfHwgdGhpcy5zZWxlY3Rpb25Nb2RlID09PSBcIm11bHRpY2hpbGRyZW5cIikudG9TdHJpbmcoKSwgb25LZXlEb3duOiB0aGlzLmtleURvd25IYW5kbGVyLCByb2xlOiAhdGhpcy5jaGlsZCA/IFwidHJlZVwiIDogdW5kZWZpbmVkLCB0YWJJbmRleDogdGhpcy5nZXRSb290VGFiSW5kZXgoKSB9LCBoKFwic2xvdFwiLCBudWxsKSkpO1xuICB9XG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIEV2ZW50IExpc3RlbmVyc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIG9uRm9jdXMoKSB7XG4gICAgaWYgKCF0aGlzLmNoaWxkKSB7XG4gICAgICBjb25zdCBmb2N1c1RhcmdldCA9IHRoaXMuZWwucXVlcnlTZWxlY3RvcihcImNhbGNpdGUtdHJlZS1pdGVtW3NlbGVjdGVkXTpub3QoW2Rpc2FibGVkXSlcIikgfHwgdGhpcy5lbC5xdWVyeVNlbGVjdG9yKFwiY2FsY2l0ZS10cmVlLWl0ZW06bm90KFtkaXNhYmxlZF0pXCIpO1xuICAgICAgZm9jdXNFbGVtZW50KGZvY3VzVGFyZ2V0KTtcbiAgICB9XG4gIH1cbiAgb25Gb2N1c0luKGV2ZW50KSB7XG4gICAgY29uc3QgZm9jdXNlZEZyb21Sb290T3JPdXRzaWRlVHJlZSA9IGV2ZW50LnJlbGF0ZWRUYXJnZXQgPT09IHRoaXMuZWwgfHwgIXRoaXMuZWwuY29udGFpbnMoZXZlbnQucmVsYXRlZFRhcmdldCk7XG4gICAgaWYgKGZvY3VzZWRGcm9tUm9vdE9yT3V0c2lkZVRyZWUpIHtcbiAgICAgIC8vIGdpdmVzIHVzZXIgdGhlIGFiaWxpdHkgdG8gdGFiIGludG8gZXh0ZXJuYWwgZWxlbWVudHMgKG1vZGlmeWluZyB0YWJpbmRleCBwcm9wZXJ0eSB3aWxsIG5vdCB3b3JrIGluIGZpcmVmb3gpXG4gICAgICB0aGlzLmVsLnJlbW92ZUF0dHJpYnV0ZShcInRhYmluZGV4XCIpO1xuICAgIH1cbiAgfVxuICBvbkZvY3VzT3V0KGV2ZW50KSB7XG4gICAgY29uc3Qgd2lsbEZvY3VzT3V0c2lkZVRyZWUgPSAhdGhpcy5lbC5jb250YWlucyhldmVudC5yZWxhdGVkVGFyZ2V0KTtcbiAgICBpZiAod2lsbEZvY3VzT3V0c2lkZVRyZWUpIHtcbiAgICAgIHRoaXMuZWwudGFiSW5kZXggPSB0aGlzLmdldFJvb3RUYWJJbmRleCgpO1xuICAgIH1cbiAgfVxuICBvbkludGVybmFsVHJlZUl0ZW1TZWxlY3QoZXZlbnQpIHtcbiAgICBpZiAodGhpcy5jaGlsZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgY29uc3QgY2hpbGRJdGVtcyA9IG5vZGVMaXN0VG9BcnJheSh0YXJnZXQucXVlcnlTZWxlY3RvckFsbChcImNhbGNpdGUtdHJlZS1pdGVtXCIpKTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGlmICh0aGlzLnNlbGVjdGlvbk1vZGUgPT09IFwiYW5jZXN0b3JzXCIpIHtcbiAgICAgIHRoaXMudXBkYXRlQW5jZXN0b3JUcmVlKGV2ZW50KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgaXNOb25lU2VsZWN0aW9uTW9kZSA9IHRoaXMuc2VsZWN0aW9uTW9kZSA9PT0gXCJub25lXCI7XG4gICAgY29uc3Qgc2hvdWxkU2VsZWN0ID0gdGhpcy5zZWxlY3Rpb25Nb2RlICE9PSBudWxsICYmXG4gICAgICAoIXRhcmdldC5oYXNDaGlsZHJlbiB8fFxuICAgICAgICAodGFyZ2V0Lmhhc0NoaWxkcmVuICYmXG4gICAgICAgICAgKHRoaXMuc2VsZWN0aW9uTW9kZSA9PT0gXCJjaGlsZHJlblwiIHx8IHRoaXMuc2VsZWN0aW9uTW9kZSA9PT0gXCJtdWx0aWNoaWxkcmVuXCIpKSk7XG4gICAgY29uc3Qgc2hvdWxkRGVzZWxlY3RBbGxDaGlsZHJlbiA9IHRoaXMuc2VsZWN0aW9uTW9kZSA9PT0gXCJtdWx0aWNoaWxkcmVuXCIgJiYgdGFyZ2V0Lmhhc0NoaWxkcmVuO1xuICAgIGNvbnN0IHNob3VsZE1vZGlmeVRvQ3VycmVudFNlbGVjdGlvbiA9ICFpc05vbmVTZWxlY3Rpb25Nb2RlICYmXG4gICAgICBldmVudC5kZXRhaWwubW9kaWZ5Q3VycmVudFNlbGVjdGlvbiAmJlxuICAgICAgKHRoaXMuc2VsZWN0aW9uTW9kZSA9PT0gXCJtdWx0aXBsZVwiIHx8IHRoaXMuc2VsZWN0aW9uTW9kZSA9PT0gXCJtdWx0aWNoaWxkcmVuXCIpO1xuICAgIGNvbnN0IHNob3VsZENsZWFyQ3VycmVudFNlbGVjdGlvbiA9ICFzaG91bGRNb2RpZnlUb0N1cnJlbnRTZWxlY3Rpb24gJiZcbiAgICAgICgoKHRoaXMuc2VsZWN0aW9uTW9kZSA9PT0gXCJzaW5nbGVcIiB8fCB0aGlzLnNlbGVjdGlvbk1vZGUgPT09IFwibXVsdGlwbGVcIikgJiZcbiAgICAgICAgY2hpbGRJdGVtcy5sZW5ndGggPD0gMCkgfHxcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25Nb2RlID09PSBcImNoaWxkcmVuXCIgfHxcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25Nb2RlID09PSBcIm11bHRpY2hpbGRyZW5cIik7XG4gICAgY29uc3Qgc2hvdWxkVXBkYXRlRXhwYW5kID0gW1wibXVsdGlwbGVcIiwgXCJub25lXCIsIFwic2luZ2xlXCIsIFwic2luZ2xlLXBlcnNpc3RcIl0uaW5jbHVkZXModGhpcy5zZWxlY3Rpb25Nb2RlKSAmJlxuICAgICAgdGFyZ2V0Lmhhc0NoaWxkcmVuO1xuICAgIGNvbnN0IHRhcmdldEl0ZW1zID0gW107XG4gICAgaWYgKHNob3VsZFNlbGVjdCkge1xuICAgICAgdGFyZ2V0SXRlbXMucHVzaCh0YXJnZXQpO1xuICAgIH1cbiAgICBpZiAoc2hvdWxkQ2xlYXJDdXJyZW50U2VsZWN0aW9uKSB7XG4gICAgICBjb25zdCBzZWxlY3RlZEl0ZW1zID0gbm9kZUxpc3RUb0FycmF5KHRoaXMuZWwucXVlcnlTZWxlY3RvckFsbChcImNhbGNpdGUtdHJlZS1pdGVtW3NlbGVjdGVkXVwiKSk7XG4gICAgICBzZWxlY3RlZEl0ZW1zLmZvckVhY2goKHRyZWVJdGVtKSA9PiB7XG4gICAgICAgIGlmICghdGFyZ2V0SXRlbXMuaW5jbHVkZXModHJlZUl0ZW0pKSB7XG4gICAgICAgICAgdHJlZUl0ZW0uc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChzaG91bGRVcGRhdGVFeHBhbmQgJiZcbiAgICAgIFtcIm11bHRpcGxlXCIsIFwibm9uZVwiLCBcInNpbmdsZVwiLCBcInNpbmdsZS1wZXJzaXN0XCJdLmluY2x1ZGVzKHRoaXMuc2VsZWN0aW9uTW9kZSkpIHtcbiAgICAgIHRhcmdldC5leHBhbmRlZCA9ICF0YXJnZXQuZXhwYW5kZWQ7XG4gICAgfVxuICAgIGlmIChzaG91bGREZXNlbGVjdEFsbENoaWxkcmVuKSB7XG4gICAgICBjaGlsZEl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgaXRlbS5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICBpZiAoaXRlbS5oYXNDaGlsZHJlbikge1xuICAgICAgICAgIGl0ZW0uZXhwYW5kZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChzaG91bGRNb2RpZnlUb0N1cnJlbnRTZWxlY3Rpb24pIHtcbiAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICB9XG4gICAgaWYgKHNob3VsZE1vZGlmeVRvQ3VycmVudFNlbGVjdGlvbiAmJiB0YXJnZXQuc2VsZWN0ZWQpIHtcbiAgICAgIHRhcmdldEl0ZW1zLmZvckVhY2goKHRyZWVJdGVtKSA9PiB7XG4gICAgICAgIGlmICghdHJlZUl0ZW0uZGlzYWJsZWQpIHtcbiAgICAgICAgICB0cmVlSXRlbS5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSBpZiAoIWlzTm9uZVNlbGVjdGlvbk1vZGUpIHtcbiAgICAgIHRhcmdldEl0ZW1zLmZvckVhY2goKHRyZWVJdGVtKSA9PiB7XG4gICAgICAgIGlmICghdHJlZUl0ZW0uZGlzYWJsZWQpIHtcbiAgICAgICAgICB0cmVlSXRlbS5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSBpc05vbmVTZWxlY3Rpb25Nb2RlXG4gICAgICA/IFtdXG4gICAgICA6IG5vZGVMaXN0VG9BcnJheSh0aGlzLmVsLnF1ZXJ5U2VsZWN0b3JBbGwoXCJjYWxjaXRlLXRyZWUtaXRlbVwiKSkuZmlsdGVyKChpKSA9PiBpLnNlbGVjdGVkKTtcbiAgICB0aGlzLmNhbGNpdGVUcmVlU2VsZWN0LmVtaXQoKTtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfVxuICB1cGRhdGVBbmNlc3RvclRyZWUoZXZlbnQpIHtcbiAgICBjb25zdCBpdGVtID0gZXZlbnQudGFyZ2V0O1xuICAgIGNvbnN0IHVwZGF0ZUl0ZW0gPSBldmVudC5kZXRhaWwudXBkYXRlSXRlbTtcbiAgICBpZiAoaXRlbS5kaXNhYmxlZCB8fCAoaXRlbS5pbmRldGVybWluYXRlICYmICF1cGRhdGVJdGVtKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBhbmNlc3RvcnMgPSBbXTtcbiAgICBsZXQgcGFyZW50ID0gaXRlbS5wYXJlbnRFbGVtZW50LmNsb3Nlc3QoXCJjYWxjaXRlLXRyZWUtaXRlbVwiKTtcbiAgICB3aGlsZSAocGFyZW50KSB7XG4gICAgICBhbmNlc3RvcnMucHVzaChwYXJlbnQpO1xuICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudEVsZW1lbnQuY2xvc2VzdChcImNhbGNpdGUtdHJlZS1pdGVtXCIpO1xuICAgIH1cbiAgICBjb25zdCBjaGlsZEl0ZW1zID0gQXJyYXkuZnJvbShpdGVtLnF1ZXJ5U2VsZWN0b3JBbGwoXCJjYWxjaXRlLXRyZWUtaXRlbTpub3QoW2Rpc2FibGVkXSlcIikpO1xuICAgIGNvbnN0IGNoaWxkSXRlbXNXaXRoTm9DaGlsZHJlbiA9IGNoaWxkSXRlbXMuZmlsdGVyKChjaGlsZCkgPT4gIWNoaWxkLmhhc0NoaWxkcmVuKTtcbiAgICBjb25zdCBjaGlsZEl0ZW1zV2l0aENoaWxkcmVuID0gY2hpbGRJdGVtcy5maWx0ZXIoKGNoaWxkKSA9PiBjaGlsZC5oYXNDaGlsZHJlbik7XG4gICAgbGV0IGZ1dHVyZVNlbGVjdGVkO1xuICAgIGlmICh1cGRhdGVJdGVtKSB7XG4gICAgICBmdXR1cmVTZWxlY3RlZCA9IGl0ZW0uaGFzQ2hpbGRyZW4gPyAhKGl0ZW0uc2VsZWN0ZWQgfHwgaXRlbS5pbmRldGVybWluYXRlKSA6ICFpdGVtLnNlbGVjdGVkO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGZ1dHVyZVNlbGVjdGVkID0gaXRlbS5zZWxlY3RlZDtcbiAgICB9XG4gICAgY2hpbGRJdGVtc1dpdGhOb0NoaWxkcmVuLmZvckVhY2goKGVsKSA9PiB7XG4gICAgICBlbC5zZWxlY3RlZCA9IGZ1dHVyZVNlbGVjdGVkO1xuICAgICAgZWwuaW5kZXRlcm1pbmF0ZSA9IGZhbHNlO1xuICAgIH0pO1xuICAgIGZ1bmN0aW9uIHVwZGF0ZUl0ZW1TdGF0ZShjaGlsZEl0ZW1zLCBpdGVtKSB7XG4gICAgICBjb25zdCBzZWxlY3RlZCA9IGNoaWxkSXRlbXMuZmlsdGVyKChjaGlsZCkgPT4gY2hpbGQuc2VsZWN0ZWQpO1xuICAgICAgY29uc3QgdW5zZWxlY3RlZCA9IGNoaWxkSXRlbXMuZmlsdGVyKChjaGlsZCkgPT4gIWNoaWxkLnNlbGVjdGVkKTtcbiAgICAgIGl0ZW0uc2VsZWN0ZWQgPSBzZWxlY3RlZC5sZW5ndGggPT09IGNoaWxkSXRlbXMubGVuZ3RoO1xuICAgICAgaXRlbS5pbmRldGVybWluYXRlID0gc2VsZWN0ZWQubGVuZ3RoID4gMCAmJiB1bnNlbGVjdGVkLmxlbmd0aCA+IDA7XG4gICAgfVxuICAgIGNoaWxkSXRlbXNXaXRoQ2hpbGRyZW4ucmV2ZXJzZSgpLmZvckVhY2goKGVsKSA9PiB7XG4gICAgICBjb25zdCBkaXJlY3RDaGlsZEl0ZW1zID0gQXJyYXkuZnJvbShlbC5xdWVyeVNlbGVjdG9yQWxsKFwiOnNjb3BlID4gY2FsY2l0ZS10cmVlID4gY2FsY2l0ZS10cmVlLWl0ZW1cIikpO1xuICAgICAgdXBkYXRlSXRlbVN0YXRlKGRpcmVjdENoaWxkSXRlbXMsIGVsKTtcbiAgICB9KTtcbiAgICBpZiAodXBkYXRlSXRlbSkge1xuICAgICAgaWYgKGl0ZW0uaGFzQ2hpbGRyZW4pIHtcbiAgICAgICAgdXBkYXRlSXRlbVN0YXRlKGNoaWxkSXRlbXMsIGl0ZW0pO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGl0ZW0uc2VsZWN0ZWQgPSBmdXR1cmVTZWxlY3RlZDtcbiAgICAgICAgaXRlbS5pbmRldGVybWluYXRlID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIGFuY2VzdG9ycy5mb3JFYWNoKChhbmNlc3RvcikgPT4ge1xuICAgICAgY29uc3QgZGVzY2VuZGFudHMgPSBub2RlTGlzdFRvQXJyYXkoYW5jZXN0b3IucXVlcnlTZWxlY3RvckFsbChcImNhbGNpdGUtdHJlZS1pdGVtXCIpKTtcbiAgICAgIGNvbnN0IGFjdGl2ZURlc2NlbmRhbnRzID0gZGVzY2VuZGFudHMuZmlsdGVyKChlbCkgPT4gZWwuc2VsZWN0ZWQpO1xuICAgICAgaWYgKGFjdGl2ZURlc2NlbmRhbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBhbmNlc3Rvci5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICBhbmNlc3Rvci5pbmRldGVybWluYXRlID0gZmFsc2U7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGluZGV0ZXJtaW5hdGUgPSBhY3RpdmVEZXNjZW5kYW50cy5sZW5ndGggPCBkZXNjZW5kYW50cy5sZW5ndGg7XG4gICAgICBhbmNlc3Rvci5pbmRldGVybWluYXRlID0gaW5kZXRlcm1pbmF0ZTtcbiAgICAgIGFuY2VzdG9yLnNlbGVjdGVkID0gIWluZGV0ZXJtaW5hdGU7XG4gICAgfSk7XG4gICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gbm9kZUxpc3RUb0FycmF5KHRoaXMuZWwucXVlcnlTZWxlY3RvckFsbChcImNhbGNpdGUtdHJlZS1pdGVtXCIpKS5maWx0ZXIoKGkpID0+IGkuc2VsZWN0ZWQpO1xuICAgIGlmICh1cGRhdGVJdGVtKSB7XG4gICAgICB0aGlzLmNhbGNpdGVUcmVlU2VsZWN0LmVtaXQoKTtcbiAgICB9XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgLy8gIFByaXZhdGUgTWV0aG9kc1xuICAvL1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGdldFJvb3RUYWJJbmRleCgpIHtcbiAgICByZXR1cm4gIXRoaXMuY2hpbGQgPyAwIDogLTE7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gdGhpczsgfVxuICBzdGF0aWMgZ2V0IHN0eWxlKCkgeyByZXR1cm4gdHJlZUNzczsgfVxufSwgWzEsIFwiY2FsY2l0ZS10cmVlXCIsIHtcbiAgICBcImxpbmVzXCI6IFsxNTQwXSxcbiAgICBcImNoaWxkXCI6IFsxNTQwXSxcbiAgICBcInNjYWxlXCI6IFsxNTM3XSxcbiAgICBcInNlbGVjdGlvbk1vZGVcIjogWzE1MzcsIFwic2VsZWN0aW9uLW1vZGVcIl0sXG4gICAgXCJzZWxlY3RlZEl0ZW1zXCI6IFsxMDQwXVxuICB9LCBbWzAsIFwiZm9jdXNcIiwgXCJvbkZvY3VzXCJdLCBbMCwgXCJmb2N1c2luXCIsIFwib25Gb2N1c0luXCJdLCBbMCwgXCJmb2N1c291dFwiLCBcIm9uRm9jdXNPdXRcIl0sIFswLCBcImNhbGNpdGVJbnRlcm5hbFRyZWVJdGVtU2VsZWN0XCIsIFwib25JbnRlcm5hbFRyZWVJdGVtU2VsZWN0XCJdXV0pO1xuZnVuY3Rpb24gZGVmaW5lQ3VzdG9tRWxlbWVudCQxKCkge1xuICBpZiAodHlwZW9mIGN1c3RvbUVsZW1lbnRzID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IGNvbXBvbmVudHMgPSBbXCJjYWxjaXRlLXRyZWVcIl07XG4gIGNvbXBvbmVudHMuZm9yRWFjaCh0YWdOYW1lID0+IHsgc3dpdGNoICh0YWdOYW1lKSB7XG4gICAgY2FzZSBcImNhbGNpdGUtdHJlZVwiOlxuICAgICAgaWYgKCFjdXN0b21FbGVtZW50cy5nZXQodGFnTmFtZSkpIHtcbiAgICAgICAgY3VzdG9tRWxlbWVudHMuZGVmaW5lKHRhZ05hbWUsIFRyZWUpO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gIH0gfSk7XG59XG5kZWZpbmVDdXN0b21FbGVtZW50JDEoKTtcblxuY29uc3QgQ2FsY2l0ZVRyZWUgPSBUcmVlO1xuY29uc3QgZGVmaW5lQ3VzdG9tRWxlbWVudCA9IGRlZmluZUN1c3RvbUVsZW1lbnQkMTtcblxuZXhwb3J0IHsgQ2FsY2l0ZVRyZWUsIGRlZmluZUN1c3RvbUVsZW1lbnQgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==