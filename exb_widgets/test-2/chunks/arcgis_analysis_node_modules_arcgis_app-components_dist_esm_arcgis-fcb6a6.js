"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-fcb6a6"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-item-browser_31.entry.js":
/*!*************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-item-browser_31.entry.js ***!
  \*************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_item_browser: () => (/* binding */ ArcgisItemBrowser),
/* harmony export */   arcgis_item_browser_actions: () => (/* binding */ ArcgisItemBrowserActions),
/* harmony export */   arcgis_item_browser_bucket_select: () => (/* binding */ ArcgisItemBrowserBucketSelect),
/* harmony export */   arcgis_item_browser_card: () => (/* binding */ ArcgisItemBrowserCard$1),
/* harmony export */   arcgis_item_browser_card_sublayer_select: () => (/* binding */ ArcgisItemBrowserCard),
/* harmony export */   arcgis_item_browser_card_thumbnail: () => (/* binding */ ArcgisItemBrowserCardThumbnail),
/* harmony export */   arcgis_item_browser_content: () => (/* binding */ ArcgisItemBrowserContent),
/* harmony export */   arcgis_item_browser_filter_categories: () => (/* binding */ ArcgisItemBrowserFilterCategory),
/* harmony export */   arcgis_item_browser_filter_collaborations: () => (/* binding */ ArcgisItemBrowserFilterCollaborations),
/* harmony export */   arcgis_item_browser_filter_content_status: () => (/* binding */ ArcgisItemBrowserFilterContentStatus),
/* harmony export */   arcgis_item_browser_filter_date: () => (/* binding */ ArcgisItemBrowserFilterDate),
/* harmony export */   arcgis_item_browser_filter_extent: () => (/* binding */ ArcgisItemBrowserFilterExtent),
/* harmony export */   arcgis_item_browser_filter_folder: () => (/* binding */ ArcgisItemBrowserFilterFolder),
/* harmony export */   arcgis_item_browser_filter_group: () => (/* binding */ ArcgisItemBrowserFilterGroup),
/* harmony export */   arcgis_item_browser_filter_industry: () => (/* binding */ ArcgisItemBrowserFilterIndustry),
/* harmony export */   arcgis_item_browser_filter_item_type: () => (/* binding */ ArcgisItemBrowserFilterItemType),
/* harmony export */   arcgis_item_browser_filter_location: () => (/* binding */ ArcgisItemBrowserFilterLocation),
/* harmony export */   arcgis_item_browser_filter_region: () => (/* binding */ ArcgisItemBrowserFilterRegion),
/* harmony export */   arcgis_item_browser_filter_sharing: () => (/* binding */ ArcgisItemBrowserFilterSharing),
/* harmony export */   arcgis_item_browser_filter_tags: () => (/* binding */ ArcgisItemBrowserFilterTags),
/* harmony export */   arcgis_item_browser_filters: () => (/* binding */ ArcgisItemBrowserFilters),
/* harmony export */   arcgis_item_browser_pagination: () => (/* binding */ ArcgisItemBrowserPagination),
/* harmony export */   arcgis_item_browser_preview: () => (/* binding */ ArcgisItemBrowserPreview$1),
/* harmony export */   arcgis_item_browser_preview_copy: () => (/* binding */ ArcgisItemBrowserPreview),
/* harmony export */   arcgis_item_browser_preview_field_details: () => (/* binding */ ArcgisItemBrowserPreviewFieldDetails),
/* harmony export */   arcgis_item_browser_search: () => (/* binding */ ArcgisItemBrowserSearch),
/* harmony export */   arcgis_item_browser_sort: () => (/* binding */ ArcgisItemBrowserSort$1),
/* harmony export */   arcgis_item_browser_table: () => (/* binding */ ArcgisItemBrowserTable$1),
/* harmony export */   arcgis_item_browser_table_row: () => (/* binding */ ArcgisItemBrowserTable),
/* harmony export */   arcgis_item_browser_top_bar: () => (/* binding */ ArcgisItemBrowserTopBar),
/* harmony export */   arcgis_item_browser_view: () => (/* binding */ ArcgisItemBrowserSort)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./locale-13e00a75.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-13e00a75.js");
/* harmony import */ var _query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./query-4f7b7e4d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-4f7b7e4d.js");
/* harmony import */ var _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./resize-55d3c55c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/resize-55d3c55c.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./store-ff04ba0a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-ff04ba0a.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _api_f7934cd7_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./api-f7934cd7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-f7934cd7.js");
/* harmony import */ var _privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./privileges-35590eb4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-35590eb4.js");
/* harmony import */ var _languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./languageUtil-22258c90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-22258c90.js");
/* harmony import */ var _services_ce8cb0ef_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./services-ce8cb0ef.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/services-ce8cb0ef.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _thumbnail_0b7adfcd_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./thumbnail-0b7adfcd.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-0b7adfcd.js");
/* harmony import */ var _categories_eeb03e5a_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./categories-eeb03e5a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-eeb03e5a.js");
/* harmony import */ var _user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./user-e3dedc4a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js");
/* harmony import */ var _items_69346131_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./items-69346131.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/items-69346131.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./geocode-7eb7c0df.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-7eb7c0df.js");
/* harmony import */ var _file_f36193e9_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./file-f36193e9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-f36193e9.js");
/* harmony import */ var _badges_c3f03cc3_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./badges-c3f03cc3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/badges-c3f03cc3.js");
/* harmony import */ var _user_ba12ebd6_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./user-ba12ebd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-ba12ebd6.js");
/* harmony import */ var _utils_69e56978_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./utils-69e56978.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-69e56978.js");
/* harmony import */ var _type_to_icon_5b71edbc_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./type-to-icon-5b71edbc.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/type-to-icon-5b71edbc.js");
/* harmony import */ var _utils_b22dfe9c_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./utils-b22dfe9c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-b22dfe9c.js");
/* harmony import */ var _server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./server-item-f12153e6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js");
/* harmony import */ var _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./item-properties-e6412a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./functional-9f648bee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-9f648bee.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/* harmony import */ var _item_d9d70416_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./item-d9d70416.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-d9d70416.js");
/* harmony import */ var _url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./url-f3b82cc7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-f3b82cc7.js");
/* harmony import */ var _storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./storage-d7f5822e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js");
/* harmony import */ var _ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./ags-68d4ae20.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-68d4ae20.js");
/* harmony import */ var _guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./guid-4f4176ba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */







































/**
 * Check if items are being stored with sublayers
 */
function isSublayer(selectedItem) {
  const entry = selectedItem;
  return !!(entry.item && entry.sublayer);
}
/**
 * Given a selected item entry and an item + sublayer,
 * determine if they represent the same entity
 */
function isSameItem({ item, sublayer, selectedItem }) {
  var _a, _b;
  if (isSublayer(selectedItem) && sublayer) {
    return (item === null || item === void 0 ? void 0 : item.id) === ((_a = selectedItem.item) === null || _a === void 0 ? void 0 : _a.id) && sublayer.id === ((_b = selectedItem.sublayer) === null || _b === void 0 ? void 0 : _b.id);
  }
  else {
    return (item === null || item === void 0 ? void 0 : item.id) === selectedItem.id;
  }
}
/**
 * Check if an item is present in a set of selected items
 */
function isSelected({ item, sublayer, selectedItems }) {
  return selectedItems.some((selectedItem) => isSameItem({ item, sublayer, selectedItem }));
}
/**
 * Filter out an item from a set of selected items
 */
function deselectItem({ item, sublayer, selectedItems }) {
  return selectedItems.filter((selectedItem) => !isSameItem({ item, sublayer, selectedItem }));
}
/**
 * Add an element to the selectedItems array
 */
function selectItem({ item, sublayer, selectedItems }) {
  // assume that if there is a sublayer we should be storing in that form
  const entry = sublayer ? { item, sublayer } : item;
  if (!isSelected({ item, sublayer, selectedItems })) {
    return [...selectedItems, entry];
  }
  return [...selectedItems];
}
/**
 * Find all selected sublayers for a given item
 */
function findSelectedSublayers({ item, selectedItems }) {
  return selectedItems.filter((selectedItem) => { var _a; return ((_a = selectedItem.item) === null || _a === void 0 ? void 0 : _a.id) === (item === null || item === void 0 ? void 0 : item.id); });
}

function getSearchSublayerIcon(geo) {
  const lookup = {
    point: "point",
    polyline: "line",
    polygon: "polygon",
    nonspatial: "table",
    multipoint: "layer-points"
  };
  return lookup[geo] || "table";
}
const geometryTypeLookup = {
  esriGeometryPoint: "point",
  esriGeometryPolyline: "polyline",
  esriGeometryPolygon: "polygon",
  esriGeometryMultipoint: "multipoint",
  none: "nonspatial",
  table: "nonspatial"
};
/* Convert a real feature layer to the search result index's form **/
function getSearchResultSublayer(sublayer) {
  const { description, geometryType, fieldAliases, title, id } = sublayer;
  return {
    description,
    fieldAliases: Array.isArray(fieldAliases) ? fieldAliases.join(",") : fieldAliases,
    geometryType: geometryTypeLookup[geometryType] || "nonspatial",
    id,
    title
  };
}

const arcgisItemBrowserCss = ":host{position:relative;background-color:var(--calcite-ui-background);display:flex;flex-direction:column;width:100%;height:100%;overflow-y:auto;overflow-x:hidden;min-height:100%;--item-browser-max-width:100%;--item-browser-pane-width:18.75rem;--item-browser-pane-z-index:11;--item-browser-top-bar-background:var(--calcite-ui-foreground-1)}:host([height=auto]){display:flex;flex-direction:column;height:auto}arcgis-browser{--arcgis-browser-max-width:var(--item-browser-max-width);--arcgis-browser-pane-width:var(--item-browser-pane-width);--arcgis-browser-pane-z-index:var(--item-browser-pane-z-index);--arcgis-browser-top-bar-background:var(--item-browser-top-bar-background)}.content--padded-bottom{padding-bottom:1.5rem}@media screen and (max-width: 640px){:host{--item-browser-pane-width:100%}}";

const ArcgisItemBrowser = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserUpdate = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserUpdate", 7);
    this.arcgisItemBrowserLoading = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserLoading", 7);
    this.arcgisItemBrowserSelect = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserSelect", 7);
    this.arcgisItemBrowserPreview = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserPreview", 7);
    this.arcgisItemBrowserSublayerPreview = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserSublayerPreview", 7);
    this.arcgisItemBrowserInternalUIAction = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserInternalUIAction", 7);
    this.liveRegionUpdate = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "liveRegionUpdate", 7);
    this.allowFetch = false;
    this.currentResults = [];
    this.updateFiltersEmpty = () => {
      var _a;
      this.store.state.filtersEmpty = !((_a = this.el) === null || _a === void 0 ? void 0 : _a.querySelector(`[slot="filters"]`));
    };
    this.updateTopbarEmpty = () => {
      var _a;
      this.store.state.topbarEmpty = !((_a = this.el) === null || _a === void 0 ? void 0 : _a.querySelector(`[slot="top-bar"]`));
    };
    this.updateSortEmpty = () => {
      var _a;
      this.store.state.sortEmpty = !((_a = this.el) === null || _a === void 0 ? void 0 : _a.querySelector(`[slot="sort"]`));
    };
    this.filterMutationObserver = new MutationObserver(this.updateFiltersEmpty);
    this.topbarMutationObserver = new MutationObserver(this.updateTopbarEmpty);
    this.sortMutationObserver = new MutationObserver(this.updateSortEmpty);
    this.fetchItems = (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_2__.d)(async () => {
      var _a, _b;
      this.loading = true;
      this.arcgisItemBrowserLoading.emit();
      this.currentResults = [];
      this.store.state.preview = null;
      if (!this.portal || !this.allowFetch) {
        return;
      }
      let query = this.getQuery();
      if (this.preflight) {
        query = await this.preflight(query);
      }
      const response = await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_2__.m)(this.queryItems(query), 500);
      this.arcgisItemBrowserUpdate.emit(Object.assign(Object.assign(Object.assign({}, response), { selectedItems: this.selectedItems, filters: Object.assign({}, this.store.state.filters), searchTerm: this.searchTerm }), this.sort));
      this.currentResponse = response;
      this.currentResults = response.results;
      // add all tags from the items to the tags picker.
      this.store.state.knownTags = (0,_query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_4__.g)(response, this.store.state.knownTags, (_b = (_a = this.store.state.filters) === null || _a === void 0 ? void 0 : _a.tags) === null || _b === void 0 ? void 0 : _b.tags);
      this.store.state.highlights = (0,_query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_4__.a)(response, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.config);
      await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_2__.t)(100);
      this.loading = false;
    }, 150);
    this.resize = () => {
      var _a, _b;
      const width = this.el.clientWidth || ((_a = this.el.parentElement) === null || _a === void 0 ? void 0 : _a.clientWidth) || 0;
      const height = this.el.clientHeight || ((_b = this.el.parentElement) === null || _b === void 0 ? void 0 : _b.clientHeight) || 0;
      this.formFactor = width > _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_5__.b.sm ? "large" : "small";
      const oldFormFactor = this.store.state.width > _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_5__.b.sm ? "large" : "small";
      /** when going from large to small or small to large, collapse or expand filters, accordingly */
      if (oldFormFactor === "large" && this.formFactor === "small") {
        /** use panel layout if enabled on smaller item browsers */
        this.store.state.panel = this.usePanelLayout;
        this.store.state.filtersExpanded = false;
      }
      if (oldFormFactor === "small" && this.formFactor === "large") {
        /** panel layout won't work on larger item browsers */
        this.store.state.panel = false;
        this.store.state.filtersExpanded = true;
      }
      this.store.state.width = width;
      this.store.state.height = height;
    };
    this.renderSelectedItem = (selectedItem) => {
      const usingSublayers = isSublayer(selectedItem);
      const item = usingSublayers ? selectedItem.item : selectedItem;
      const sublayer = usingSublayers ? selectedItem.sublayer : null;
      const description = usingSublayers ? sublayer.title : null;
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-selected-item", { heading: item.title, description: description, onArcgisSelectedItemRemove: () => {
          this.selectedItems = deselectItem({ item, sublayer, selectedItems: this.selectedItems });
          this.arcgisItemBrowserSelect.emit(this.selectedItems);
        } }, usingSublayers ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { slot: "content-start", icon: getSearchSublayerIcon(selectedItem.sublayer.geometryType), scale: "s" })) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-type", { slot: "content-start", item: item, portal: this.portal, scale: "s", showText: false }))));
    };
    this.api = undefined;
    this.portal = undefined;
    this.user = undefined;
    this.subscriptionInfo = undefined;
    this.userLicensedItems = undefined;
    this.config = undefined;
    this.groupId = undefined;
    this.selection = "none";
    this.selectedItems = [];
    this.allowedGeometries = [..._query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_4__.d];
    this.allowedSubscriptionContentTypes = undefined;
    this.view = "list";
    this.bucket = undefined;
    this.num = 20;
    this.q = "";
    this.filter = "";
    this.height = "full";
    this.preflight = undefined;
    this.fetch = undefined;
    this.showFieldStatistics = false;
    this.store = (0,_index_81d548b7_js__WEBPACK_IMPORTED_MODULE_6__.c)({ filters: {} });
    this.hidePreviewFooters = false;
    this.hideContentTop = false;
    this.contentPaddedBottom = false;
    this.usePanelLayout = false;
    this.baseUrls = {};
    this.searchTerm = "";
    this.sort = undefined;
    this.page = { num: this.num, start: 1, nextStart: -1 };
    this.loading = true;
    this.formFactor = undefined;
    this.previewItem = undefined;
    this.currentResponse = undefined;
  }
  /** Manually trigger a fetch of new results */
  async refresh() {
    this.fetchItems();
  }
  async componentWillLoad() {
    const { el, groupId, view, bucket, allowedGeometries, selectedItems, showFieldStatistics } = this;
    const locale = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_3__.g)(el);
    this.i18n = locale[0];
    if (bucket) {
      this.store.state.bucket = bucket;
    }
    this.store.state.groupId = groupId;
    this.store.state.i18n = locale[0];
    this.store.state.lang = locale[1];
    this.store.state.view = view;
    this.store.state.selection = this.selection;
    this.store.state.selectedItems = selectedItems;
    this.store.state.allowedGeometries = allowedGeometries;
    this.store.state.showFieldStatistics = showFieldStatistics;
    this.store.state.interaction = "keyboard";
    this.initializeConfig();
    this.store.state.width = 420;
    this.store.state.panel = true;
    this.store.state.filtersExpanded = false;
    this.formFactor = "small";
    this.filterMutationObserver.observe(el, { childList: true });
    this.topbarMutationObserver.observe(el, { childList: true });
    this.sortMutationObserver.observe(el, { childList: true });
    this.updateFiltersEmpty();
    this.updateTopbarEmpty();
    this.updateSortEmpty();
    this.resize();
    this.resizeHandler = () => requestAnimationFrame(this.resize);
    window.addEventListener("resize", this.resizeHandler);
    if (this.usePanelLayout || (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_7__.c)(this.el, "calcite-shell-panel")) {
      this.store.state.panel = true;
      this.store.state.filtersExpanded = false;
    }
  }
  disconnectedCallback() {
    var _a;
    (_a = this.store.state.resizeObserver) === null || _a === void 0 ? void 0 : _a.unobserve(this.el);
    this.filterMutationObserver.disconnect();
    this.topbarMutationObserver.disconnect();
    this.sortMutationObserver.disconnect();
    this.filterClearHandler(false);
    window.removeEventListener("resize", this.resizeHandler);
  }
  updateUser(newUser) {
    var _a;
    (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user = newUser);
  }
  updateUserLicensedItems(licensedItems) {
    var _a;
    (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.userLicensedItems) !== null && _a !== void 0 ? _a : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.userLicensedItems = licensedItems);
  }
  updateSubscriptionInfo(subscriptionInfo) {
    var _a;
    (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.subscriptionInfo) !== null && _a !== void 0 ? _a : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.subscriptionInfo = subscriptionInfo);
  }
  updatePortal(newPortal) {
    var _a;
    (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal) !== null && _a !== void 0 ? _a : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal = newPortal);
  }
  updateAPI(newValue) {
    var _a;
    (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.api) !== null && _a !== void 0 ? _a : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.api = newValue);
  }
  updateConfig(newConfig) {
    var _a;
    (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.config) !== null && _a !== void 0 ? _a : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.config = newConfig);
  }
  updateSelection(newValue) {
    this.store.state.selection = newValue;
  }
  updateGroupID(id) {
    this.store.state.groupId = id;
  }
  updateSublayerSelectionGeometryTypes(types) {
    this.store.state.allowedGeometries = types;
  }
  updateSelectedItems(items) {
    this.store.state.selectedItems = items;
  }
  updateFieldStatistics(value) {
    this.store.state.showFieldStatistics = value;
  }
  updateView(view) {
    this.store.state.view = view;
  }
  updateBucket(bucket) {
    this.store.state.bucket = bucket;
    this.fetchItems();
  }
  updateQ() {
    this.fetchItems();
  }
  async componentDidLoad() {
    this.resize();
    this.initializeConfig();
    // initially, fetch is locked
    // wait for all components to emit events impacting state prior to initial fetch
    await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_2__.t)(400);
    this.allowFetch = true;
    if (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal) {
      this.fetchItems();
    }
    else {
      (0,_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.o)("portal", () => {
        this.initializeConfig();
        this.fetchItems();
      });
    }
  }
  filterHandler(e) {
    const filters = Object.assign(Object.assign({}, this.store.state.filters), { [e.detail.id]: e.detail });
    // remove filter from set
    if (!e.detail.value) {
      delete filters[e.detail.id];
    }
    this.store.state.filters = filters;
    this.resetPagination();
    this.fetchItems();
  }
  genericFilterHandler(e) {
    this.filterHandler(e);
  }
  filterClearHandler(doFetchItems = true) {
    this.store.state.filters = {};
    this.resetPagination();
    doFetchItems && this.fetchItems();
  }
  genericFilterClearHandler() {
    this.filterClearHandler();
  }
  searchHandler(e) {
    const newTerm = e.detail;
    this.searchTerm = newTerm;
    this.resetPagination();
    if (newTerm) {
      this.fetchItems();
    }
    else {
      this.fetchItems.invoke();
    }
  }
  bucketHandler(e) {
    this.store.state.bucket = e.detail;
    this.bucket = e.detail;
    this.resetPagination();
    this.fetchItems();
  }
  sortHandler(e) {
    this.sort = e.detail;
    this.store.state.sort = e.detail;
    this.fetchItems();
  }
  viewHandler(e) {
    this.view = e.detail;
    this.store.state.view = e.detail;
  }
  async pageHandler(e) {
    var _a;
    this.page = e.detail;
    if (this.allowFetch) {
      await this.fetchItems();
      await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_2__.t)(400);
      (_a = this.el.shadowRoot.querySelector(".scrolling")) === null || _a === void 0 ? void 0 : _a.scrollTo({ behavior: "smooth", top: 0 });
    }
  }
  selectHandler(e) {
    const selectedItems = this.selectedItems;
    const { selected, item, sublayer } = e.detail;
    switch (this.selection) {
      case "single":
      case "single-sublayer":
        // by passing an empty array for selected items we ensure only the current item is selected
        this.selectedItems = selectItem({ item, sublayer, selectedItems: [] });
        break;
      case "multiple":
      case "multiple-sublayer":
        this.selectedItems = selected
          ? selectItem({ item, sublayer, selectedItems })
          : deselectItem({ item, sublayer, selectedItems });
        break;
    }
    this.arcgisItemBrowserSelect.emit(this.selectedItems);
  }
  async togglePreview({ detail }) {
    this.store.state.filtersExpanded = false;
    if (!detail || this.store.state.preview === detail.id) {
      this.store.state.preview = null;
      this.previewItem = null;
      this.arcgisItemBrowserPreview.emit();
      this.arcgisItemBrowserSublayerPreview.emit();
      this.restoreFocus();
    }
    else {
      this.restoreFocusElement = document.activeElement;
      this.store.state.preview = detail.id;
      this.previewItem = Object.assign({}, detail);
      this.arcgisItemBrowserPreview.emit(Object.assign({}, detail));
    }
    this.arcgisItemBrowserInternalUIAction.emit({
      action: this.previewItem ? "open panel" : "close panel",
      category: "card action"
    });
  }
  tileSelectHandler(e) {
    const { item } = e.detail;
    this.arcgisItemBrowserSelect.emit([item]);
  }
  columnUpdateHandler(e) {
    this.store.state.columns = e.detail;
  }
  handleMove() {
    this.store.state.interaction = "mouse";
  }
  handleTouch() {
    this.store.state.interaction = "touch";
  }
  handleKey() {
    this.store.state.interaction = "keyboard";
  }
  async initializeConfig() {
    var _a, _b, _c, _d;
    (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.api) !== null && _a !== void 0 ? _a : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.api = this.api);
    (_b = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _b !== void 0 ? _b : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user = this.user);
    (_c = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal) !== null && _c !== void 0 ? _c : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal = this.portal);
    (_d = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.config) !== null && _d !== void 0 ? _d : (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.config = this.config);
  }
  resetPagination() {
    this.page.start = 1;
    this.page.total = 0;
  }
  getQuery() {
    return Object.assign(Object.assign({ filters: this.store.state.filters, searchTerm: this.searchTerm, baseQuery: this.q, baseFilter: this.filter, bucket: this.bucket, allowedGeometries: this.allowedGeometries }, this.sort), this.page);
  }
  async queryItems(query) {
    var _a, _b;
    let response;
    if (this.fetch) {
      response = await this.fetch(query);
    }
    else {
      const { portal, user, store, groupId, config } = this;
      response = await (0,_query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_4__.q)({ portal, query, user, store, groupId, config });
    }
    if (await (0,_query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_4__.i)(this.portal, (_a = this.store) === null || _a === void 0 ? void 0 : _a.state.bucket)) {
      (_b = response === null || response === void 0 ? void 0 : response.results) === null || _b === void 0 ? void 0 : _b.forEach(({ id }) => {
        this.baseUrls[id] = "arcgis.com";
      });
    }
    return response;
  }
  restoreFocus() {
    if (this.restoreFocusElement) {
      const el = this.restoreFocusElement;
      if (el.restoreFocus) {
        el.restoreFocus();
      }
      else if (el.setFocus) {
        el.setFocus();
      }
      else if (el.focus) {
        el.focus();
      }
    }
  }
  renderSelected() {
    var _a, _b, _c, _d, _e;
    const wholePageSelected = (_a = this.currentResults) === null || _a === void 0 ? void 0 : _a.every((item) => isSelected({ item, selectedItems: this.selectedItems }));
    const totalSelectedItems = (_b = this.selectedItems) === null || _b === void 0 ? void 0 : _b.length;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-selected", { slot: "selection", loading: this.loading, total: (_c = this.currentResults) === null || _c === void 0 ? void 0 : _c.length, totalSelected: (_d = this.store.state.selectedItems) === null || _d === void 0 ? void 0 : _d.length, heading: this.selection === "multiple-sublayer"
        ? this.i18n.itemBrowser.selectedLayers
        : this.i18n.itemBrowser.selectedItems, emptyText: this.selection === "multiple-sublayer"
        ? this.i18n.itemBrowser.noSelectedLayers
        : this.i18n.itemBrowser.noSelectedItems, checked: !this.loading && wholePageSelected, indeterminate: !wholePageSelected && !!totalSelectedItems, hideCheckbox: this.selection === "multiple-sublayer", onArcgisSelectedDeselectAll: () => {
        this.selectedItems = [];
        this.arcgisItemBrowserSelect.emit(this.selectedItems);
      }, onArcgisSelectedSelectPage: () => {
        var _a;
        let selectedItems = [...this.selectedItems];
        (_a = this.currentResults) === null || _a === void 0 ? void 0 : _a.forEach((item) => {
          selectedItems = selectItem({ item, selectedItems });
        });
        this.selectedItems = selectedItems;
        this.arcgisItemBrowserSelect.emit(this.selectedItems);
      } }, (_e = this.store.state.selectedItems) === null || _e === void 0 ? void 0 : _e.map(this.renderSelectedItem)));
  }
  renderSlot(name, defaultContent) {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: name }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: name }, defaultContent)));
  }
  render() {
    const { previewItem, loading, hideContentTop, i18n, selectedItems, selection, currentResponse, store, api, renderSlot, searchTerm, formFactor, view, height } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser", { preview: !!previewItem, loading: loading, hideContentTop: hideContentTop, selected: selectedItems, alwaysShowSelection: selection === null || selection === void 0 ? void 0 : selection.includes("multiple"), alwaysShowContent: view === "table", response: currentResponse, store: store, api: api, formFactor: formFactor, searchTerm: searchTerm, height: height }, renderSlot("top-bar"), renderSlot("view"), renderSlot("sort"), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-preview", { slot: "preview", item: this.previewItem, portal: this.portal, user: this.user, key: this.store.state.preview, onArcgisItemBrowserPreviewClose: () => {
        this.store.state.preview = null;
        this.arcgisItemBrowserPreview.emit();
        this.arcgisItemBrowserSublayerPreview.emit();
        this.restoreFocus();
      }, onArcgisInternalItemBrowserSublayer: (e) => {
        e.stopPropagation();
        this.arcgisItemBrowserSublayerPreview.emit(e.detail);
      }, hidePreviewFooters: this.hidePreviewFooters }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "summary-top" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "preview-summary-top" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "footer" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "preview-footer" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "sublayer-footer" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "sublayer-preview-footer" }))), this.renderSelected(), renderSlot("actions"), renderSlot("content-start"), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", class: { "content--padded-bottom": this.contentPaddedBottom } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content" })), renderSlot("content-end"), renderSlot("pagination"), renderSlot("filters"), renderSlot("scroll-end"), renderSlot("no-results", i18n.content.noResults), renderSlot("no-content", i18n.content.noContent))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "user": ["updateUser"],
    "userLicensedItems": ["updateUserLicensedItems"],
    "subscriptionInfo": ["updateSubscriptionInfo"],
    "portal": ["updatePortal"],
    "api": ["updateAPI"],
    "config": ["updateConfig"],
    "selection": ["updateSelection"],
    "groupId": ["updateGroupID"],
    "allowedGeometries": ["updateSublayerSelectionGeometryTypes"],
    "selectedItems": ["updateSelectedItems"],
    "showFieldStatistics": ["updateFieldStatistics"],
    "view": ["updateView"],
    "bucket": ["updateBucket"],
    "q": ["updateQ"],
    "filter": ["updateQ"]
  }; }
};
ArcgisItemBrowser.style = arcgisItemBrowserCss;

function getItemBrowserStore(el) {
  return (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_8__.g)(el, "arcgis-item-browser");
}
const onItemBrowserViewChange = (store, callback) => {
  store.onChange("view", (newView) => {
    callback(newView);
  });
};
const onItemBrowserBucketChange = (store, callback) => {
  store.onChange("bucket", (newBucket) => {
    callback(newBucket);
  });
};
const onItemBrowserPreviewChange = (store, callback) => {
  store.onChange("preview", (preview) => {
    callback(preview);
  });
};
const onItemBrowserSortChange = (store, callback) => {
  store.onChange("sort", (sort) => {
    callback(sort);
  });
};

const ArcgisItemBrowserActions = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.actions = [];
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-actions", { actions: this.actions, selection: this.store.state.selectedItems })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

function canViewAGO(settings, portal, user) {
  var _a, _b, _c, _d, _e;
  if (portal.isPortal) {
    return (_b = (_a = settings === null || settings === void 0 ? void 0 : settings.portalConfigProperties) === null || _a === void 0 ? void 0 : _a.searchArcGISOnlineEnabled) !== null && _b !== void 0 ? _b : true;
  }
  if (!user || (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_9__.e)(user)) {
    return true;
  }
  return (_e = (_d = (_c = portal.sourceJSON) === null || _c === void 0 ? void 0 : _c.canSearchPublic) !== null && _d !== void 0 ? _d : portal.canSearchPublic) !== null && _e !== void 0 ? _e : true;
}
async function getValidOptions(portal, user, options) {
  var _a, _b;
  if (!portal) {
    return [];
  }
  const settings = await (0,_api_f7934cd7_js__WEBPACK_IMPORTED_MODULE_10__.j)(portal);
  const provisionedListings = (_a = ((options === null || options === void 0 ? void 0 : options.includes("subscription content")) && await (0,_query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_4__.b)(user, portal))) !== null && _a !== void 0 ? _a : [];
  const properties = settings === null || settings === void 0 ? void 0 : settings.portalConfigProperties;
  const canViewLivingAtlas = (_b = properties === null || properties === void 0 ? void 0 : properties.portalLivingAtlasConfigEnabled) !== null && _b !== void 0 ? _b : true;
  return options.filter((option) => {
    // for public portals, allow anonymous users to see the portal's public content
    if (!user && option === "org") {
      return (portal === null || portal === void 0 ? void 0 : portal.access) === "public";
    }
    // anonymous should not see my content or org content
    if (!user && ["my", "favorites", "group", "org"].includes(option)) {
      return false;
    }
    // users without create/receive item privs can't have my content (#4398)
    if (user && !((0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_11__.l)(user) || (0,_privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_11__.n)(user)) && option === "my") {
      return false;
    }
    // public users should not see org option
    if (user && (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_9__.n)(user) && option === "org") {
      return false;
    }
    if (option === "subscription content" && (!user || !(provisionedListings === null || provisionedListings === void 0 ? void 0 : provisionedListings.length))) {
      return false;
    }
    // portals can configure wether users should see LA or AGO #3817
    if ((!canViewLivingAtlas && (option === "living atlas" || option === "living atlas analysis")) ||
      (!canViewAGO(settings, portal, user) && option === "all")) {
      return false;
    }
    return true;
  });
}

const arcgisItemBrowserBucketSelectCss = ":host{display:block}.large{-webkit-border-end:1px solid var(--calcite-ui-border-3);border-inline-end:1px solid var(--calcite-ui-border-3)}.button{padding:0.5rem;--calcite-font-weight-normal:500}";

const ArcgisItemBrowserBucketSelect = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserBucketSelect = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserBucketSelect", 7);
    this.selectOption = (option) => {
      this.bucket = option;
      // assume if the user clicked it, it's valid
      this.validBucket = option;
      this.arcgisItemBrowserBucketSelect.emit(option);
    };
    this.optionLabel = (option) => {
      var _a;
      if (option === "org" && !_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user) {
        return (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal) === null || _a === void 0 ? void 0 : _a.name;
      }
      return this.i18n[option];
    };
    this.options = [
      "my",
      "favorites",
      "group",
      "org",
      "living atlas",
      "all"
    ];
    this.bucket = "my";
    this.validBucket = undefined;
    this.validOptions = undefined;
  }
  updateOptions(newOptions) {
    this.updateValidOptions(newOptions);
  }
  async updateValidOptions(options, forceEmit) {
    const oldBucket = this.validBucket;
    const { user, portal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
    this.validOptions = await getValidOptions(portal, user, options);
    this.validBucket = this.validOptions.includes(this.bucket) ? this.bucket : this.validOptions[0];
    // if we had to change the bucket, emit an event
    if (oldBucket !== this.validBucket || forceEmit) {
      this.arcgisItemBrowserBucketSelect.emit(this.validBucket);
    }
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.bucketSelect;
    await this.updateValidOptions(this.options, true);
    (0,_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.o)("user", () => {
      this.updateValidOptions(this.options);
    });
    (0,_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.o)("portal", () => {
      this.updateValidOptions(this.options);
    });
  }
  render() {
    const { validOptions, validBucket, selectOption, optionLabel } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
        large: this.store.state.width >= _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_5__.b.sm
      } }, (validOptions === null || validOptions === void 0 ? void 0 : validOptions.length) > 0 && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown", { placement: "bottom-start", scale: "m", width: "m", type: "click" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: "button", kind: "neutral", appearance: "transparent", "icon-end": "chevron-down", slot: "trigger" }, optionLabel(validBucket)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { selectionMode: "single" }, validOptions.map((option) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { selected: validBucket === option, onClick: () => {
        selectOption(option);
      }, onKeyDown: (e) => {
        if (e.key === "Enter" || e.key === " ") {
          selectOption(option);
        }
      } }, optionLabel(option))))))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "options": ["updateOptions"]
  }; }
};
ArcgisItemBrowserBucketSelect.style = arcgisItemBrowserBucketSelectCss;

const arcgisItemBrowserCardCss = ":host{display:block;min-width:0}.item-browser-card{box-shadow:none;transition-duration:150ms;color:var(--calcite-ui-text-1);background-color:var(--calcite-ui-foreground-1);position:relative;opacity:0;height:100%;display:flex;flex-direction:column;outline-color:transparent;box-sizing:border-box;background-color:var(--calcite-ui-foreground-1);transition-property:background-color, outline, outline-offset, opacity;border:1px solid var(--calcite-ui-border-3)}.item-browser-card:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:-2px;z-index:10}.item-browser-card--loaded{opacity:1}.item-browser-card--selected{border-color:var(--calcite-ui-brand)}.item-browser-card--hoverable{cursor:pointer}.item-browser-card__top{padding:1rem}.item-browser-card__hover-text{opacity:0;font-weight:500;font-size:1rem;text-align:center;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;position:absolute;top:0;right:0;bottom:0;left:0;display:flex;justify-content:center;align-items:center;background-color:rgba(21, 21, 21, 0.7);color:white}.item-browser-card__upper{flex:1 1 0%;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;background-color:var(--calcite-ui-foreground-1)}.item-browser-card__upper:hover{background-color:var(--calcite-ui-background)}.item-browser-card__upper:hover .item-browser-card__hover-text,.item-browser-card:focus .item-browser-card__hover-text{opacity:1}.item-browser-card__upper--link{text-decoration:none;color:var(--calcite-ui-text-1);outline-color:transparent}.item-browser-card__upper--link:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:2px;z-index:10}.item-browser-card__title__span{transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;position:relative;display:inline;border-style:none;background-color:transparent;padding:0;background-image:linear-gradient(transparent, transparent);background-position-x:0%, 100%;background-position-y:min(1.25em, 100%);background-repeat:no-repeat, no-repeat;background-size:100% 1px, 100% 1px}.item-browser-card--previewed .item-browser-card__title__span{background-image:linear-gradient(var(--calcite-ui-text-3), var(--calcite-ui-text-3))}.item-browser-card__content{display:flex;flex:1 1 0%;flex-direction:column;min-width:0}.item-browser-card__details{display:flex;flex-direction:row;margin-top:0.25rem}.item-browser-card__detail{font-size:0.875rem;color:var(--calcite-ui-text-2)}.item-browser-card__calendar-icon{color:var(--calcite-ui-text-3);-webkit-margin-end:0.5rem;margin-inline-end:0.5rem}.item-browser-card__footer{background-color:var(--calcite-ui-foreground-1);padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.5rem;display:flex;align-items:center;margin-top:auto;border-top:1px solid var(--calcite-ui-border-3)}.item-browser-card__footer__start{flex:1 1 0%;display:flex;flex-direction:row;align-items:center;min-width:0;overflow:hidden;-webkit-margin-end:0.75rem;margin-inline-end:0.75rem}.item-browser-card__footer__start--owner{-webkit-margin-start:-0.25rem;margin-inline-start:-0.25rem}.item-browser-card__footer__start--selectable{-webkit-margin-start:1.5rem;margin-inline-start:1.5rem}.item-browser-card__profile-wrap{max-width:100%;padding:0.25rem;box-sizing:border-box}.item-browser-card__summary{font-size:0.875rem;color:var(--calcite-ui-text-2);margin:0;padding:0}.item-browser-card__divider{display:flex;align-items:center;flex:0 0 auto}.item-browser-card__divider:not([empty]):before{content:\"\";height:1.25rem;width:1px;background-color:var(--calcite-ui-border-1);margin-inline:0.75rem}.item-browser-card__divider:first-child:before{display:none}.item-browser-card-flex{display:flex}.item-browser-card-flex-1{flex:1 1 0%;min-width:0}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.item-browser-card__input{-webkit-margin-end:1rem;margin-inline-end:1rem;margin-top:0.125rem}.item-browser-card__title{font-size:1.125rem;margin-top:0;margin-bottom:0;padding-top:0;padding-bottom:0;word-wrap:break-word;overflow-wrap:break-word;font-weight:500;line-height:1.375}.item-browser-card__title--grid{font-size:1rem}.item-browser-card__title--padded{margin-bottom:0.5rem}.item-browser-card__snippet{font-size:0.875rem;margin:0;margin-bottom:0.75rem;padding:0;flex:1 1 0%}.item-browser-card__badges--stacked{margin-top:0.5rem}.item-browser-card__thumbnail{width:8rem;padding:0;margin:0;box-sizing:content-box;-webkit-padding-start:2rem;padding-inline-start:2rem;flex:0 0 auto}.item-browser-card__thumbnail--grid{width:100%;padding:0;margin:0;position:relative;border-bottom:1px solid var(--calcite-ui-foreground-2)}.item-browser-card__owner{min-width:0}.item-browser-card--panel{margin-bottom:0;cursor:pointer;display:block;width:100%}.item-browser-card--xs .item-browser-card__top,.item-browser-card--xxs .item-browser-card__top{padding:0.75rem}.item-browser-card--xs .item-browser-card__title--padded,.item-browser-card--xxs .item-browser-card__title--padded{margin-bottom:0.25rem}.item-browser-card--xs .item-browser-card__footer,.item-browser-card--xxs .item-browser-card__footer{padding-top:0.25rem;padding-bottom:0.25rem;padding-left:0.75rem;padding-right:0.75rem}.item-browser-card--xs .item-browser-card__detail,.item-browser-card--xxs .item-browser-card__detail{font-size:0.75rem}.item-browser-card--xs .item-browser-card__title,.item-browser-card--xxs .item-browser-card__title{font-size:0.875rem}.item-browser-card--xxs .item-browser-card__title{font-size:0.75rem}.item-browser-card--xxs .item-browser-card__thumbnail{width:55px;-webkit-padding-start:0.75rem;padding-inline-start:0.75rem}.item-browser-card--xxs .item-browser-card__footer__start{-webkit-margin-end:0.5rem;margin-inline-end:0.5rem}.item-browser-card--xs .item-browser-card__thumbnail{width:5rem;-webkit-padding-start:0.5rem;padding-inline-start:0.5rem}";

const ArcgisItemBrowserCard$1 = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserInternalUIAction = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserInternalUIAction", 7);
    this.arcgisItemBrowserCardSelect = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserCardSelect", 7);
    this.arcgisItemBrowserCardPreview = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserCardPreview", 7);
    var _a;
    this.handleResizeEvent = (e) => {
      e.stopPropagation();
      this.resize(e.detail.width);
    };
    this.handleCardClick = () => {
      var _a;
      // when using the cards as a link, don't do any special handling
      if (this.link) {
        return;
      }
      const preview = this.preview === "top";
      const selection = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state.selection;
      const { item } = this;
      if (preview) {
        this.arcgisItemBrowserCardPreview.emit(item);
        return;
      }
      if (selection === "single") {
        this.arcgisItemBrowserCardSelect.emit({ item, selected: true });
      }
      else if (selection === "multiple") {
        this.arcgisItemBrowserCardSelect.emit({
          item,
          selected: !isSelected({ item, selectedItems: this.store.state.selectedItems })
        });
      }
    };
    this.item = undefined;
    this.portal = undefined;
    this.user = undefined;
    this.api = 4;
    this.baseUrl = (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.config) === null || _a === void 0 ? void 0 : _a.baseUrl;
    this.link = undefined;
    this.newTab = undefined;
    this.selected = undefined;
    this.selection = undefined;
    this.name = undefined;
    this.preview = undefined;
    this.showOwner = true;
    this.showDateUpdated = true;
    this.showItemType = true;
    this.showSummary = false;
    this.showBadges = true;
    this.showThumbnail = true;
    this.actions = [];
    this.hover = undefined;
    this.formFactor = undefined;
    this.updatedText = "";
    this.shortUpdatedText = "";
    this.loaded = undefined;
    this.noSpaceForDate = true;
  }
  /* Calling this setFocus causes calcite to focus here when the user popup is closed... */
  async restoreFocus() {
    if (this.link && this.linkEl) {
      this.linkEl.focus();
      return;
    }
    if (this.preview === "top" && this.sectionEl) {
      this.sectionEl.focus();
      return;
    }
  }
  async componentWillLoad() {
    var _a, _b, _c, _d, _e;
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.card;
    (_a = this.formFactor) !== null && _a !== void 0 ? _a : (this.formFactor = ((_b = this.store) === null || _b === void 0 ? void 0 : _b.state.panel) ? "xs" : "lg");
    (0,_resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_5__.s)(this.store).observe(this.el);
    this.el.addEventListener("arcgisBrowserResize", this.handleResizeEvent);
    const formattedDate = (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_12__.a)(this.item.modified);
    this.updatedText = this.i18n.lastUpdated.replace("${date}", formattedDate);
    this.shortUpdatedText = formattedDate;
    this.portal = (_c = this.portal) !== null && _c !== void 0 ? _c : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal;
    this.user = (_d = this.user) !== null && _d !== void 0 ? _d : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
    this.api = (_e = this.api) !== null && _e !== void 0 ? _e : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.api;
  }
  async componentDidLoad() {
    await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_2__.t)(100);
    this.loaded = true;
  }
  disconnectedCallback() {
    var _a, _b, _c, _d;
    (_c = (_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.resizeObserver) === null || _c === void 0 ? void 0 : _c.unobserve(this.el);
    (_d = this.el) === null || _d === void 0 ? void 0 : _d.removeEventListener("arcgisBrowserResize", this.handleResizeEvent);
  }
  resize(width) {
    switch (true) {
      case width > _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_5__.b.md:
        this.formFactor = "lg";
        break;
      case width > _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_5__.b.sm:
        this.formFactor = "md";
        break;
      case width > _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_5__.b.xs:
        this.formFactor = "sm";
        break;
      case width > _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_5__.b.xxs:
        this.formFactor = "xs";
        break;
      default:
        this.formFactor = "xxs";
        break;
    }
  }
  render() {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
    const { item, user, portal, formFactor, api, i18n, loaded, showDateUpdated, showItemType, showOwner, showBadges, showSummary, showThumbnail, link, newTab } = this;
    const isOnlineInPortal = (portal === null || portal === void 0 ? void 0 : portal.isPortal) && this.store.state.bucket === "all";
    const baseUrl = isOnlineInPortal ? "https://www.arcgis.com/home/" : (_a = this.baseUrl) !== null && _a !== void 0 ? _a : (_b = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.config) === null || _b === void 0 ? void 0 : _b.baseUrl;
    const current = ((_c = this.store) === null || _c === void 0 ? void 0 : _c.state.preview) === this.item.id;
    const grid = ((_d = this.store) === null || _d === void 0 ? void 0 : _d.state.view) === "grid";
    const topPreview = this.preview === "top";
    const topPreviewAttributes = {
      tabIndex: 0,
      role: "button",
      "aria-haspopup": "dialog",
      "aria-labelledby": "open-details",
      onKeyPress: (e) => {
        if (e.key === "Enter" || e.key == " ") {
          e.preventDefault();
          this.handleCardClick();
        }
      }
    };
    const selection = (_e = this.store) === null || _e === void 0 ? void 0 : _e.state.selection;
    const itemSelection = ["single", "multiple"].includes(selection);
    const selected = itemSelection &&
      isSelected({ item: this.item, selectedItems: (_f = this.store) === null || _f === void 0 ? void 0 : _f.state.selectedItems });
    const CardTag = this.link ? "a" : "div";
    const linkAttributes = Object.assign({ href: link }, (newTab ? { target: "_blank", rel: "noopener noreferrer" } : {}));
    const extraSmall = ["xxs", "xs"].includes(formFactor);
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", Object.assign({ class: {
        "item-browser-card": true,
        "item-browser-card--hoverable": true,
        [`item-browser-card--${formFactor}`]: true,
        "item-browser-card--panel": (_g = this.store) === null || _g === void 0 ? void 0 : _g.state.panel,
        "item-browser-card--loaded": loaded,
        "item-browser-card--previewed": ((_h = this.store) === null || _h === void 0 ? void 0 : _h.state.preview) === item.id,
        "item-browser-card--selected": selected
      }, onMouseOver: () => (this.hover = true), onMouseOut: () => (this.hover = false) }, (link ? {} : { onClick: this.handleCardClick }), (topPreview && !link ? topPreviewAttributes : {}), { ref: (el) => (this.sectionEl = el) }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content-top" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(CardTag, Object.assign({ class: { "item-browser-card__upper": true, "item-browser-card__upper--link": !!link } }, (link ? linkAttributes : {}), { ref: (el) => (this.linkEl = el) }), grid && showThumbnail && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("figure", { class: "item-browser-card__thumbnail--grid" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-card-thumbnail", { item: item, user: user, portal: portal }), topPreview && !link && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card__hover-text", id: "open-details" }, ((_k = (_j = this.store) === null || _j === void 0 ? void 0 : _j.state) === null || _k === void 0 ? void 0 : _k.preview) === item.id ? i18n.closeDetails : i18n.openDetails)))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card-flex item-browser-card__top" }, selection === "single" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button", { class: "item-browser-card__input", checked: selected, value: item.title, name: this.name, onClick: (e) => {
        e.stopPropagation();
      }, onCalciteRadioButtonChange: () => {
        this.arcgisItemBrowserCardSelect.emit({ item, selected: true });
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "screen-readers-only" }, i18n.select.replace("${title}", item.title)))), selection === "multiple" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { class: "item-browser-card__input", checked: selected, onClick: (e) => {
        e.stopPropagation();
      }, onCalciteCheckboxChange: () => {
        this.arcgisItemBrowserCardSelect.emit({ item, selected: !selected });
      }, value: item.id }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "screen-readers-only" }, item.title))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card-flex-1" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card-flex" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card__content" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { class: {
        "item-browser-card__title": true,
        "item-browser-card__title--padded": showItemType || (showSummary && !!item.snippet),
        "item-browser-card__title--grid": grid
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "item-browser-card__title__span" }, item.title)), showSummary && item.snippet && !extraSmall && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "item-browser-card__summary" }, item.snippet.length > 250
      ? `${item.snippet.substring(0, 250)}`
      : item.snippet)), extraSmall && showItemType && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-type", { scale: extraSmall ? "s" : "m", item: item, portal: portal })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card__details" }, !extraSmall && showItemType && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-type", { class: "item-browser-card__divider", scale: extraSmall ? "s" : "m", item: item, portal: portal })), showDateUpdated && formFactor !== "xxs" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: {
        "item-browser-card__detail": true,
        "item-browser-card__divider": true
      } }, ["xxs", "xs", "sm"].includes(formFactor) || grid
      ? this.shortUpdatedText
      : this.updatedText)), showBadges && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-badges", { item: item, user: user, portal: portal, width: formFactor === "lg" && !grid ? "full" : "narrow", showTooltips: true, class: {
        "item-browser-card__badges": true,
        "item-browser-card__divider": true
      }, scale: "s" })))), !grid && showThumbnail && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("figure", { class: "item-browser-card__thumbnail" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-card-thumbnail", { item: item, user: user, portal: portal })))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content-end" })))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card__footer", onClick: (e) => {
        e.stopPropagation();
      }, onKeyPress: (e) => {
        if (e.key === "Enter" || e.key == " ") {
          e.stopPropagation();
        }
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
        "item-browser-card__footer__start": true,
        "item-browser-card__footer__start--owner": showOwner,
        "item-browser-card__footer__start--selectable": itemSelection
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "actions-start" }), showOwner && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card__profile-wrap", onClick: (e) => {
        e.preventDefault();
        e.stopPropagation();
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-user-popup", { underline: true, item: item, api: api, portal: portal, baseUrl: baseUrl, checkOnline: portal.isPortal && this.store.state.bucket === "all", class: "item-browser-card__owner", scale: ["md", "lg"].includes(formFactor) ? "m" : "s", onArcgisUserPopupInternalUIAction: (e) => {
        e.stopPropagation();
        this.arcgisItemBrowserInternalUIAction.emit(e.detail);
      } })))), this.preview === "action" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { scale: "s", appearance: current ? "solid" : "outline", kind: "neutral", onClick: (e) => {
        e.preventDefault();
        e.stopPropagation();
        this.arcgisItemBrowserCardPreview.emit(this.item);
      } }, current ? i18n.hidePreview : i18n.preview)), (selection === null || selection === void 0 ? void 0 : selection.includes("sublayer")) && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-card-sublayer-select", { item: item, user: user, portal: portal, selection: selection === "multiple-sublayer" ? "multiple" : "single", showErrors: true })), this.actions.length > 0 && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown", { placement: "bottom-end", scale: "m", overlayPositioning: "fixed" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { scale: "s", slot: "trigger", alignment: "center", appearance: "solid", text: i18n.moreOptions, textEnabled: false, icon: "ellipsis" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { selectionMode: "none" }, this.actions.map(({ text, newTab, link, action }) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", Object.assign({ onClick: (e) => {
        if (action) {
          e.preventDefault();
          action();
        }
      } }, (!action && link
      ? Object.assign(Object.assign({}, (newTab ? { target: "_blank", rel: "noopener noreferrer" } : {})), { href: link }) : {})), text)))))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "actions-end" })))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserCard$1.style = arcgisItemBrowserCardCss;

const arcgisItemBrowserCardSublayerSelectCss = ".title{max-width:32rem;word-wrap:break-word;word-break:break-word}.dropdown-item-disabled{pointer-events:none;opacity:var(--calcite-ui-opacity-disabled)}.dropdown{display:block}";

const ArcgisItemBrowserCard = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserCardSelect = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserCardSelect", 7);
    this.renderSublayer = (sublayer) => {
      var _a, _b;
      const { item, store } = this;
      const disabled = !((_b = (_a = store === null || store === void 0 ? void 0 : store.state) === null || _a === void 0 ? void 0 : _a.allowedGeometries) === null || _b === void 0 ? void 0 : _b.includes(sublayer.geometryType));
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", Object.assign({ iconStart: getSearchSublayerIcon(sublayer.geometryType), selected: isSelected({
          item,
          sublayer,
          selectedItems: store.state.selectedItems
        }) }, (disabled
        ? { ariaDisabled: true, tabIndex: -1, className: "dropdown-item-disabled" }
        : {}), { ref: (el) => {
          if (disabled) {
            el.tabIndex = -1;
          }
        }, onCalciteDropdownItemSelect: (e) => {
          const selected = e.currentTarget.selected;
          const { item } = this;
          this.arcgisItemBrowserCardSelect.emit({
            item,
            sublayer,
            // single select should remain selected on click, multi select should toggle
            selected: this.selection === "single" || !selected
          });
        } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "title" }, sublayer.title)));
    };
    this.isAllowedGeometry = (geometry) => { var _a, _b, _c; return (_c = (_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.allowedGeometries) === null || _c === void 0 ? void 0 : _c.includes(geometry); };
    this.sortSublayers = (a, b) => {
      const validA = this.isAllowedGeometry(a.geometryType);
      const validB = this.isAllowedGeometry(b.geometryType);
      if (validA === validB) {
        return b.id - a.id;
      }
      return validA ? -1 : 1;
    };
    this.renderSelectText = (selectedSublayers) => {
      var _a, _b;
      const multiple = this.selection === "multiple";
      if (this.item && !this.item.sublayers) {
        if (isSelected({ item: this.item, selectedItems: (_a = this.store) === null || _a === void 0 ? void 0 : _a.state.selectedItems })) {
          return this.i18n.selectedSingle;
        }
        return this.i18n.select;
      }
      if ((selectedSublayers === null || selectedSublayers === void 0 ? void 0 : selectedSublayers.length) === 0) {
        return multiple ? this.i18n.selectLayers : this.i18n.select;
      }
      if (multiple) {
        return this.i18n.selectedLayers.replace("${num}", `${selectedSublayers.length}`);
      }
      const selected = selectedSublayers[0];
      // @ts-ignore
      return this.i18n.selectedName.replace("${name}", (_b = selected.sublayer) === null || _b === void 0 ? void 0 : _b.title);
    };
    this.item = undefined;
    this.user = undefined;
    this.portal = undefined;
    this.width = "auto";
    this.appearance = "outline";
    this.selection = undefined;
    this.showErrors = false;
    this.sublayers = undefined;
    this.loading = false;
    this.fetched = false;
    this.alertActive = false;
  }
  async componentWillLoad() {
    var _a, _b, _c;
    this.store = getItemBrowserStore(this.el);
    this.i18n = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state.i18n.cardSublayerSelect;
    this.sublayers = (_b = this.item) === null || _b === void 0 ? void 0 : _b.sublayers;
    if (!this.item) {
      return;
    }
    if ((_c = this.item) === null || _c === void 0 ? void 0 : _c.sublayers) {
      this.sublayers = this.item.sublayers;
    }
    else {
      const response = (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_14__.j)("serviceInfo", this.item.id);
      if (response === null || response === void 0 ? void 0 : response.result) {
        this.processResponse(response);
      }
    }
  }
  processResponse(response) {
    if (response === null || response === void 0 ? void 0 : response.result) {
      const layers = response.result.map(getSearchResultSublayer).sort(this.sortSublayers);
      this.sublayers = layers;
      this.item.sublayers = layers;
      this.fetched = true;
    }
    else if (response.error) {
      this.alertActive = true;
    }
  }
  async attemptLoad() {
    var _a;
    this.loading = true;
    this.alertActive = false;
    // for items without sublayers in the search index,
    // try fetching the service info
    const response = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_14__.f)(() => (0,_services_ce8cb0ef_js__WEBPACK_IMPORTED_MODULE_13__.f)({
      item: this.item,
      portal: this.portal,
      layers: null,
      isSecure: false
    }), "serviceInfo", this.item.id);
    // make real sublayers look like search sublayers
    this.processResponse(response);
    await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_2__.t)(100);
    if (this.dropdown) {
      this.dropdown.open = true;
    }
    this.loading = false;
    return !!((_a = this.sublayers) === null || _a === void 0 ? void 0 : _a.length);
  }
  render() {
    var _a, _b;
    const { store, width, appearance, loading, i18n, alertActive } = this;
    const item = this.item;
    if (!store || !item) {
      return null;
    }
    const scale = width === "auto" ? "s" : "m";
    const selectedItems = store === null || store === void 0 ? void 0 : store.state.selectedItems;
    const selectedSublayers = findSelectedSublayers({ item, selectedItems });
    const isItemSelected = isSelected({ item, selectedItems });
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, ((_a = item === null || item === void 0 ? void 0 : item.sublayers) === null || _a === void 0 ? void 0 : _a.length) ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown", { class: "dropdown", width: "l", placement: appearance === "solid" ? "top" : "bottom-end", scale: "s", closeOnSelectDisabled: true, overlayPositioning: "fixed", ref: (el) => (this.dropdown = el) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { loading: loading, disabled: loading, slot: "trigger", scale: scale, appearance: (selectedSublayers === null || selectedSublayers === void 0 ? void 0 : selectedSublayers.length) || appearance === "solid" ? "solid" : "outline", kind: "neutral", iconEnd: "chevron-down", width: width }, this.renderSelectText(selectedSublayers)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { selectionMode: this.selection }, (_b = this.sublayers) === null || _b === void 0 ? void 0 : _b.sort(this.sortSublayers).map(this.renderSublayer)))) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { loading: loading, disabled: loading || alertActive, class: "dropdown", slot: "trigger", scale: scale, appearance: (selectedSublayers === null || selectedSublayers === void 0 ? void 0 : selectedSublayers.length) ? "solid" : "outline", kind: "neutral", width: width, onClick: async () => {
        if (this.item &&
          !this.sublayers &&
          this.item.type !== "Image Service" &&
          !this.fetched) {
          const foundLayers = await this.attemptLoad();
          if (foundLayers || this.alertActive) {
            return;
          }
        }
        this.arcgisItemBrowserCardSelect.emit({
          item,
          selected: !isItemSelected
        });
      } }, this.renderSelectText(selectedSublayers))), this.showErrors && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-alert", { label: i18n.errorTitle, icon: true, kind: "danger", onCalciteAlertClose: () => {
        this.alertActive = false;
      }, open: !!alertActive, tabIndex: !alertActive ? -1 : null }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, i18n.errorTitle), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message", class: "alert__message" }, i18n.errorBody), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { slot: "link", onClick: async () => {
        (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_14__.c)("serviceInfo", this.item.id);
        await this.attemptLoad();
      } }, i18n.retry)))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserCard.style = arcgisItemBrowserCardSublayerSelectCss;

const arcgisItemBrowserCardThumbnailCss = ":host{display:block;position:relative}.outer{width:100%;position:relative;padding-top:66.66%}.inner{position:absolute;top:0;right:0;bottom:0;left:0;background-color:var(--calcite-ui-background)}.inner--loading{animation-duration:1s;animation-fill-mode:forwards;animation-iteration-count:infinite;animation-name:thumbnail-shimmer;animation-timing-function:linear;background-image:linear-gradient(to right, var(--calcite-ui-background) 0%, var(--calcite-ui-foreground-2), var(--calcite-ui-background) 40%, var(--calcite-ui-background) 100%);background-repeat:no-repeat;background-size:800px 100%}.thumbnail{width:100%;height:100%;-o-object-fit:cover;object-fit:cover;opacity:1;transition-property:opacity;transition:opacity 300ms linear}.thumbnail--loading{opacity:0}@keyframes thumbnail-shimmer{0%{background-position:-468px 0}100%{background-position:468px 0}}";

const ArcgisItemBrowserCardThumbnail = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.item = undefined;
    this.user = undefined;
    this.portal = undefined;
    this.loading = true;
    this.useDefault = undefined;
    this.thumbnailUrl = undefined;
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.setThumbnailUrl();
  }
  handleItemChange() {
    this.setThumbnailUrl();
  }
  async setThumbnailUrl() {
    var _a, _b;
    const { item, portal } = this;
    if (this.useDefault) {
      this.thumbnailUrl = (0,_thumbnail_0b7adfcd_js__WEBPACK_IMPORTED_MODULE_15__.a)(this.item);
      return;
    }
    this.thumbnailUrl = await (0,_thumbnail_0b7adfcd_js__WEBPACK_IMPORTED_MODULE_15__.b)(portal, item, (_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket);
  }
  render() {
    const { loading, useDefault, thumbnailUrl } = this;
    if (!thumbnailUrl) {
      return;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "outer" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: { inner: true, "inner--loading": loading } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("img", { class: {
        thumbnail: true,
        "thumbnail--loading": loading
      }, alt: "", src: thumbnailUrl,
      // @ts-ignore
      crossorigin: "anonymous", onLoad: (e) => {
        const image = e.currentTarget;
        if (!useDefault && (0,_thumbnail_0b7adfcd_js__WEBPACK_IMPORTED_MODULE_15__.i)(image)) {
          this.useDefault = true;
        }
        this.loading = false;
      }, onError: () => {
        this.useDefault = true;
        this.loading = false;
        this.setThumbnailUrl();
      } }), loading && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "placeholder" })))));
  }
  static get assetsDirs() { return ["assets"]; }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "item": ["handleItemChange"]
  }; }
};
ArcgisItemBrowserCardThumbnail.style = arcgisItemBrowserCardThumbnailCss;

const arcgisItemBrowserContentCss = ":host{--arcgis-item-browser-content-spacing:0.5rem}.grid slot,.list slot{display:grid;grid-gap:var(--arcgis-item-browser-content-spacing)}.columns-1 slot{grid-template-columns:repeat(1, 1fr)}.columns-2 slot{grid-template-columns:repeat(2, 1fr)}.columns-3 slot{grid-template-columns:repeat(3, 1fr)}.columns-4 slot{grid-template-columns:repeat(4, 1fr)}.no-space slot{grid-gap:0.25rem;gap:0.25rem}";

const ArcgisItemBrowserContent = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
  }
  getColumnCount(width) {
    if (this.store.state.view !== "grid") {
      return 1;
    }
    const filter = this.store.state.filtersEmpty ? 1 : 0;
    switch (true) {
      case width < _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_5__.b.xs:
        return 1;
      case width < _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_5__.b.sm:
        return 2;
      case width < _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_5__.b.md:
        return 1 + filter;
      case width < _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_5__.b.xl:
        return 2 + filter;
      default:
        return 3 + filter;
    }
  }
  render() {
    const view = this.store.state.view;
    const columnCount = this.getColumnCount(this.store.state.width);
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
        [view]: true,
        [`columns-${columnCount}`]: true,
        "no-space": this.store.state.width < _resize_55d3c55c_js__WEBPACK_IMPORTED_MODULE_5__.b.xs && this.store.state.panel
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", null))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserContent.style = arcgisItemBrowserContentCss;

const ArcgisItemBrowserFilterCategory = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
    this.category = undefined;
    this.expanded = undefined;
    this.groupId = undefined;
    this.loading = undefined;
    this.schema = [];
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.filterCategories;
    if (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal) {
      this.fetchCategories(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    }
    else {
      (0,_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.o)("portal", (portal) => {
        this.fetchCategories(portal);
      });
    }
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_8__.a)("categories", this.store, () => (this.category = null));
  }
  async refetchCategories() {
    if (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal) {
      this.fetchCategories(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    }
  }
  async fetchCategories(portal) {
    var _a, _b, _c, _d;
    const isLivingAtlas = ((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket) === "living atlas";
    const groupId = this.groupId || this.store.state.groupId;
    const response = isLivingAtlas
      ? await (0,_categories_eeb03e5a_js__WEBPACK_IMPORTED_MODULE_16__.a)(portal)
      : groupId
        ? await (0,_categories_eeb03e5a_js__WEBPACK_IMPORTED_MODULE_16__.b)(groupId, portal)
        : await (0,_categories_eeb03e5a_js__WEBPACK_IMPORTED_MODULE_16__.f)(portal);
    this.schema = (_d = (_c = response === null || response === void 0 ? void 0 : response.categorySchema) === null || _c === void 0 ? void 0 : _c[0]) === null || _d === void 0 ? void 0 : _d.categories;
    this.loading = false;
  }
  async componentDidLoad() {
    if (this.category) {
      this.emitFilterEvent();
    }
    this.store.onChange("bucket", () => this.refetchCategories());
    this.store.onChange("groupId", () => {
      this.refetchCategories();
    });
  }
  emitFilterEvent() {
    const { category, i18n } = this;
    const value = category ? JSON.stringify([category]) : "";
    const categoryLabel = category === "_none_" ? i18n.uncategorized : category === null || category === void 0 ? void 0 : category.replace("/Categories/", "");
    const label = i18n.category.replace("${category}", categoryLabel);
    this.arcgisItemBrowserFilter.emit({
      id: "categories",
      param: "categories",
      value,
      label,
      category
    });
  }
  renderNestedCategories(schema, previousValue) {
    return schema.map((category) => {
      var _a;
      // Keep breadcrumbs of categories' ancestry
      const value = previousValue
        ? `${previousValue}/${category.title}`
        : `/Categories/${category.title}`;
      const hasChildren = !!((_a = category.categories) === null || _a === void 0 ? void 0 : _a.length);
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-value": value, "data-children": hasChildren, selected: this.category === value }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, category.title), hasChildren && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { slot: "children", selectionMode: "children" }, this.renderNestedCategories(category.categories, value)))));
    });
  }
  render() {
    const { loading, schema } = this;
    if (loading || !(schema === null || schema === void 0 ? void 0 : schema.length)) {
      return null;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.categories, expanded: this.expanded, active: !!this.category, onArcgisBrowserFilterRemove: () => {
        this.category = null;
        this.emitFilterEvent();
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "children", scale: "m", onCalciteTreeSelect: (event) => {
        var _a, _b;
        const node = event.target;
        const dataset = (_b = (_a = node === null || node === void 0 ? void 0 : node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset;
        const category = (dataset === null || dataset === void 0 ? void 0 : dataset.value) || "";
        if (this.category === category) {
          this.category = null;
        }
        else {
          this.category = category;
        }
        this.emitFilterEvent();
      } }, !!(this.groupId || this.store.state.groupId) && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-value": "_none_", selected: this.category === "_none_" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, this.i18n.uncategorized))), this.renderNestedCategories(schema))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

async function fetchCollaborations(portal) {
  const restBaseUrl = (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_14__.k)(portal);
  const { collaborations } = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_14__.r)(`${restBaseUrl}portals/self/collaborationsSummary`, {
    includeParticipantInfo: true
  });
  return collaborations;
}
// gets the collaborated items and returns just the unique item ids for that collaboration as an array
async function fetchCollaboratedItems(collaborationId, participantId, portal) {
  const restBaseUrl = (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_14__.k)(portal);
  const { collaboratedItems } = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_14__.r)(`${restBaseUrl}portals/self/collaboratedItems`, Object.assign({ collaborationId }, (participantId ? { participantId } : {})));
  if (collaboratedItems === null || collaboratedItems === void 0 ? void 0 : collaboratedItems.length) {
    return collaboratedItems.map((entry) => Object.keys(entry)[0]);
  }
  return [];
}
// Looks up items used in a collaboration, returns an array of item ids
async function fetchCollaborationContent(collaborationId, participantId, portal) {
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_14__.f)(() => fetchCollaboratedItems(collaborationId, participantId, portal), "collaborationContent", `${collaborationId}/${participantId}`);
}

const ArcgisItemBrowserFilterCollaborations = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
    this.loadCollaborations = async () => {
      const { portal, user, config, subscriptionInfo } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c !== null && _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c !== void 0 ? _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c : {};
      if (!this.collaborations &&
        portal &&
        user &&
        !(0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_9__.n)(user) &&
        (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_9__.w)(config, user, portal, subscriptionInfo)) {
        this.collaborations = await fetchCollaborations(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
      }
    };
    this.collaboration = undefined;
    this.participant = undefined;
    this.collaborationName = undefined;
    this.expanded = undefined;
    this.collaborations = undefined;
  }
  componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.filterCollaborations;
  }
  async componentDidLoad() {
    if (this.collaboration) {
      this.emitEvent();
    }
    this.loadCollaborations();
    (0,_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.o)("portal", this.loadCollaborations);
    (0,_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.o)("user", this.loadCollaborations);
    (0,_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.o)("subscriptionInfo", this.loadCollaborations);
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_8__.a)("collaborations", this.store, () => (this.collaboration = null));
  }
  async getEventDetail() {
    const { collaboration, participant, collaborationName, i18n } = this;
    if (!collaboration) {
      return {
        id: "collaborations",
        param: "q",
        value: "",
        label: "",
        collaboration: {
          id: "",
          name: ""
        }
      };
    }
    const items = await fetchCollaborationContent(collaboration, participant, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    const participantSuffix = participant ? `__${participant}` : "";
    return {
      id: "collaborations",
      param: "q",
      value: items ? `id:(${items.join(" OR ")})` : "",
      label: collaborationName ? i18n.label.replace("${name}", this.collaborationName) : "",
      collaboration: {
        id: collaboration,
        name: collaborationName
      },
      additionalParams: {
        origin: `${collaboration}${participantSuffix}`
      }
    };
  }
  async emitEvent() {
    const detail = await this.getEventDetail();
    this.arcgisItemBrowserFilter.emit(detail);
  }
  renderParticipant(participant, collaborationId) {
    var _a;
    const [id, name] = Object.entries(participant)[0];
    const participantId = `${collaborationId}/${id}`;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-id": participantId, "data-name": name, selected: (_a = this.collaboration) === null || _a === void 0 ? void 0 : _a.includes(participantId) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, name)));
  }
  render() {
    const { config, user, portal, subscriptionInfo } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const { collaborations } = this;
    if (!user ||
      !(0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_9__.w)(config, user, portal, subscriptionInfo) ||
      !(collaborations === null || collaborations === void 0 ? void 0 : collaborations.length)) {
      return null;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.title, expanded: this.expanded, active: !!this.collaboration, onArcgisBrowserFilterRemove: () => {
        this.collaboration = null;
        this.emitEvent();
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "children", scale: "m", onCalciteTreeSelect: (event) => {
        var _a, _b;
        const node = event.target;
        const item = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0];
        const [collaborationId, participantId] = (_b = item === null || item === void 0 ? void 0 : item.dataset.id.split("/")) !== null && _b !== void 0 ? _b : [];
        const collaborationName = item === null || item === void 0 ? void 0 : item.dataset.name;
        if (!collaborationName) {
          return;
        }
        if (this.collaboration === collaborationId &&
          (!participantId || participantId === this.participant)) {
          this.collaboration = null;
          this.collaborationName = null;
          this.participant = null;
        }
        else {
          this.collaboration = collaborationId;
          this.collaborationName = collaborationName;
          this.participant = participantId;
        }
        this.emitEvent();
      } }, collaborations.map(({ collaborationId, collaborationName, participants }) => {
      var _a;
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-id": collaborationId, "data-name": collaborationName, selected: (_a = this.collaboration) === null || _a === void 0 ? void 0 : _a.includes(collaborationId) }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, collaborationName), (participants === null || participants === void 0 ? void 0 : participants.length) && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { slot: "children" }, (participants || []).map((participant) => this.renderParticipant(participant, collaborationId))))));
    }))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserFilterContentStatus = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
    this.contentStatus = undefined;
    this.expanded = undefined;
  }
  componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.filterContentStatus;
  }
  componentDidLoad() {
    if (this.contentStatus) {
      this.arcgisItemBrowserFilter.emit(this.getEventDetail());
    }
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_8__.a)("contentStatus", this.store, () => (this.contentStatus = null));
  }
  getEventDetail() {
    var _a;
    const { contentStatus, i18n } = this;
    const { user, portal } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const orgId = portal && !portal.isPortal ? ` orgid:${portal.id}` : "";
    const orgMember = user && !(0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_9__.n)(user);
    const orgAuthoritativeQuery = `((contentstatus:org_authoritative${orgId}) OR contentstatus:public_authoritative)`;
    const values = {
      authoritative: orgMember ? orgAuthoritativeQuery : "contentstatus:public_authoritative",
      deprecated: "contentstatus:deprecated"
    };
    return {
      id: "contentStatus",
      param: "filter",
      value: (_a = values[contentStatus]) !== null && _a !== void 0 ? _a : "",
      label: contentStatus ? i18n.label.replace("${contentStatus}", i18n[contentStatus]) : "",
      contentStatus
    };
  }
  render() {
    const statuses = ["authoritative", "deprecated"];
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.title, expanded: this.expanded, active: !!this.contentStatus, onArcgisBrowserFilterRemove: () => {
        this.contentStatus = null;
        this.arcgisItemBrowserFilter.emit(this.getEventDetail());
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "single", scale: "m", onCalciteTreeSelect: (event) => {
        var _a;
        const node = event.target;
        const item = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0];
        const contentStatus = item === null || item === void 0 ? void 0 : item.dataset.contentStatus;
        if (this.contentStatus === contentStatus) {
          this.contentStatus = null;
        }
        else {
          this.contentStatus = contentStatus;
        }
        this.arcgisItemBrowserFilter.emit(this.getEventDetail());
      } }, statuses.map((status) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-content-status": status, selected: status === this.contentStatus }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, this.i18n[status])))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserFilterDate = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
    this.property = "modified";
    this.range = undefined;
    this.start = undefined;
    this.end = undefined;
    this.expanded = undefined;
  }
  componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
  }
  getEventDetail(detail) {
    return Object.assign({ param: "q" }, detail);
  }
  render() {
    const { property, range, start, end, store, expanded } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter-date", { serverProperty: property === "modified" ? property : "uploaded", property: this.property, store: store, start: start, end: end, range: range, expanded: expanded, onArcgisBrowserFilter: (e) => {
        this.arcgisItemBrowserFilter.emit(this.getEventDetail(e.detail));
      } }));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const arcgisItemBrowserFilterExtentCss = ".filter-extent{margin-bottom:0.5rem;width:100%;display:flex}.filter-extent__label{flex:1 1 0%}.filter-extent__switch{padding-left:0.25rem;padding-right:0.25rem}.filter-extent--padded{box-sizing:border-box;padding-left:1rem;padding-right:1rem;padding-top:0;padding-bottom:0.5rem}";

const ArcgisItemBrowserFilterExtent = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
    this.extent = undefined;
    this.checked = undefined;
  }
  emitCheckedChange() {
    this.arcgisItemBrowserFilter.emit(this.getEventDetail());
  }
  emitExtentChange() {
    if (this.checked) {
      this.arcgisItemBrowserFilter.emit(this.getEventDetail());
    }
  }
  componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.filterExtent;
  }
  componentDidLoad() {
    if (this.extent && this.checked) {
      this.arcgisItemBrowserFilter.emit(this.getEventDetail());
    }
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_8__.a)("extent", this.store, () => (this.checked = false));
  }
  getEventDetail() {
    const { extent, checked, i18n } = this;
    return {
      id: "extent",
      param: "bbox",
      value: checked && extent ? extent : "",
      label: extent && checked ? i18n.label : "",
      extent
    };
  }
  render() {
    var _a, _b;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: { "filter-extent": true, "filter-extent--padded": (_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.panel } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "filter-extent__label" }, this.i18n.title), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { class: "filter-extent__switch", checked: this.checked, onCalciteSwitchChange: (e) => {
        this.checked = e.target.checked;
      } })))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "checked": ["emitCheckedChange"],
    "extent": ["emitExtentChange"]
  }; }
};
ArcgisItemBrowserFilterExtent.style = arcgisItemBrowserFilterExtentCss;

const arcgisItemBrowserFilterFolderCss = ".hide.sc-arcgis-item-browser-filter-folder{display:none}.folders.sc-arcgis-item-browser-filter-folder{max-height:16.5rem;min-height:4rem;margin-bottom:1.5rem;margin-top:0;overflow:auto;list-style-type:none;padding:0;position:relative;--calcite-list-item-spacing-indent:0.5rem;--calcite-list-item-spacing-indent-multiplier:1;--calcite-ui-foreground-1:var(--calcite-ui-background)}.folder.sc-arcgis-item-browser-filter-folder{width:calc(100% - 1.65rem);margin-left:0.825rem}";

const ArcgisItemBrowserFilterFolder = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
    this.folder = "all";
    this.allowEdits = undefined;
    this.expanded = undefined;
    this.folders = [];
  }
  componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.filterFolder;
    if (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user) {
      this.fetchUserFolders(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
    }
    else {
      (0,_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.o)("user", (user) => this.fetchUserFolders(user));
    }
  }
  componentDidLoad() {
    if (this.folder && this.folder !== "all") {
      this.arcgisItemBrowserFilter.emit(this.getEventDetail());
    }
    if (this.expanded && this.accordionItem) {
      this.accordionItem.expanded = true;
    }
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_8__.a)("folder", this.store, () => (this.folder = "all"));
  }
  getEventDetail() {
    var _a;
    const { folder } = this;
    const folderName = folder === _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user.username ? "root" : folder;
    const selectedFolder = (_a = this.folders) === null || _a === void 0 ? void 0 : _a.find((f) => f.id === folder);
    const folderTitle = (selectedFolder === null || selectedFolder === void 0 ? void 0 : selectedFolder.title) || "";
    const value = folder !== "all" ? `ownerfolder:${folderName}` : "";
    return {
      id: "folder",
      param: "q",
      value,
      label: this.i18n.label.replace("${folder}", folderTitle),
      folder
    };
  }
  async fetchUserFolders(user) {
    const folders = await (0,_user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_17__.g)(user);
    this.folders = [
      { id: "all", created: new Date(), title: this.i18n.all, username: "" },
      ...folders
    ];
  }
  getFolderIcon(id) {
    var _a;
    switch (id) {
      case "all":
        return "folders";
      case (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user) === null || _a === void 0 ? void 0 : _a.username:
        return "home";
      default:
        return "folder";
    }
  }
  render() {
    const { user } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const bucket = this.store.state.bucket;
    const { i18n, folders } = this;
    const hide = !user || !folders || (bucket && bucket !== "my");
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: i18n.folders, expanded: this.expanded, noPadding: true, class: { hide } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { filterEnabled: true, selectionAppearance: "border", selectionMode: "single", loading: !folders, class: "folders", ref: (el) => {
        var _a;
        const filter = (_a = el === null || el === void 0 ? void 0 : el.shadowRoot) === null || _a === void 0 ? void 0 : _a.querySelector("calcite-filter");
        if (filter) {
          filter.style.marginTop = "-2px";
          // for some reason, inside shadow dom _and_ a popover, in safari the sticky positioning used by calcite stops working.
          filter.style.position = "absolute";
          filter.style.top = "0";
        }
      } }, folders.map(({ title, id }) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { class: "folder", label: title, value: id, key: id, onCalciteListItemSelect: () => {
        this.folder = id;
        this.arcgisItemBrowserFilter.emit(this.getEventDetail());
      }, selected: this.folder === id }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: this.getFolderIcon(id), slot: "content-start", scale: "s" }))))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserFilterFolder.style = arcgisItemBrowserFilterFolderCss;

const arcgisItemBrowserFilterGroupCss = ".hide.sc-arcgis-item-browser-filter-group{display:none}.groups.sc-arcgis-item-browser-filter-group{max-height:16.5rem;margin-bottom:1.5rem;margin-top:0;overflow:auto;list-style-type:none;padding:0;position:relative;--calcite-list-item-spacing-indent:0.5rem;--calcite-list-item-spacing-indent-multiplier:1;--calcite-ui-foreground-1:var(--calcite-ui-background)}.group.sc-arcgis-item-browser-filter-group{width:calc(100% - 1.65rem);margin-left:0.825rem}.group-thumbnail.sc-arcgis-item-browser-filter-group{margin-left:0.5rem;margin-right:0.5rem}";

const ArcgisItemBrowserFilterGroup = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
    this.group = "all";
    this.allowEdits = undefined;
    this.expanded = undefined;
    this.groups = [];
  }
  componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.filterGroup;
    if (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user && _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal) {
      this.fetchUserGroups();
    }
    else {
      (0,_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.o)("user", () => this.fetchUserGroups());
      (0,_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.o)("portal", () => this.fetchUserGroups());
    }
  }
  componentDidLoad() {
    if (this.expanded && this.accordionItem) {
      this.accordionItem.expanded = true;
    }
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_8__.a)("group", this.store, () => (this.group = "all"));
  }
  getEventDetail() {
    var _a, _b;
    const { group } = this;
    const selectedGroup = (_a = this.groups) === null || _a === void 0 ? void 0 : _a.find((f) => f.id === group);
    const groupTitle = (selectedGroup === null || selectedGroup === void 0 ? void 0 : selectedGroup.title) || "";
    const value = group !== "all"
      ? `group:${group}`
      : `group:(${(_b = this.groups) === null || _b === void 0 ? void 0 : _b.map(({ id }) => id).join(" OR ")})`;
    return {
      id: "group",
      param: "q",
      value,
      label: this.i18n.label.replace("${group}", groupTitle),
      group
    };
  }
  async fetchUserGroups() {
    var _a, _b;
    if (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user && _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal) {
      const groups = await (0,_user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_17__.a)();
      this.groups = [{ id: "all", title: this.i18n.all }, ...groups];
      if (((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket) === "group") {
        this.arcgisItemBrowserFilter.emit(this.getEventDetail());
      }
    }
  }
  render() {
    const { user } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const bucket = this.store.state.bucket;
    const { i18n, groups } = this;
    const hide = !user || !groups || (bucket && bucket !== "group");
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: i18n.groups, expanded: this.expanded, noPadding: true, class: { hide } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { filterEnabled: true, selectionAppearance: "border", selectionMode: "single", loading: !groups, class: "groups", ref: (el) => {
        var _a;
        const filter = (_a = el === null || el === void 0 ? void 0 : el.shadowRoot) === null || _a === void 0 ? void 0 : _a.querySelector("calcite-filter");
        if (filter) {
          filter.style.marginTop = "-2px";
        }
      } }, groups === null || groups === void 0 ? void 0 : groups.map((group) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { class: "group", label: group.title, value: group.id, key: group.id, onCalciteListItemSelect: () => {
        this.group = group.id;
        this.store.state.groupId = group.id;
        this.arcgisItemBrowserFilter.emit(this.getEventDetail());
      }, selected: this.group === group.id }, group.id === "all" ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "users", slot: "content-start", scale: "s" })) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-thumbnail", { slot: "content-start", class: "group-thumbnail", group: group, portal: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal, tooltip: false, scale: "s" })))))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserFilterGroup.style = arcgisItemBrowserFilterGroupCss;

const templateIndustries = [
  "Agriculture",
  "Electric Utilities",
  "Environment",
  "Forestry",
  "Gas Utilities",
  "General",
  "Natural Resources",
  "Petroleum",
  "Public Safety",
  "Telecommunications",
  "Transportation",
  "Water Utilities"
];

const ArcgisItemBrowserFilterIndustry = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
    this.industry = undefined;
    this.expanded = undefined;
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.filterIndustry;
  }
  async componentDidLoad() {
    if (this.industry) {
      this.arcgisItemBrowserFilter.emit(this.getEventDetail());
    }
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_8__.a)("industry", this.store, () => (this.industry = null));
  }
  getEventDetail() {
    const { industry } = this;
    const value = industry ? `typekeywords: "${industry}"` : "";
    const label = this.i18n.Industry.replace("${industry}", this.i18n[industry]);
    return { id: "industry", param: "filter", value, label, industry };
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.title, expanded: this.expanded, active: !!this.industry, onArcgisBrowserFilterRemove: () => {
        this.industry = null;
        this.arcgisItemBrowserFilter.emit(this.getEventDetail());
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "single", scale: "s", onCalciteTreeSelect: (event) => {
        var _a, _b;
        const node = event.target;
        const industry = ((_b = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset.industry) || "";
        if (this.industry === industry) {
          this.industry = null;
        }
        else {
          this.industry = industry;
        }
        this.arcgisItemBrowserFilter.emit(this.getEventDetail());
      } }, templateIndustries.map((industry) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-industry": industry, selected: industry === this.industry }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, this.i18n[industry])))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserFilterItemType = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
    this.renderItemType = ([key, option]) => {
      const { itemType, allowedItemTypes } = this;
      const disallowedType = !(allowedItemTypes === null || allowedItemTypes === void 0 ? void 0 : allowedItemTypes.includes(key));
      const childrenAllowed = allowedItemTypes &&
        disallowedType &&
        option.children &&
        Object.keys(option.children).some((child) => allowedItemTypes.includes(child));
      if ((disallowedType && !childrenAllowed) ||
        (option.show && !option.show(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.userLicensedItems))) {
        return null;
      }
      if (disallowedType && childrenAllowed) {
        return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.F, null, Object.entries(option.children).map(this.renderItemType));
      }
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-item-type": key, "data-children": !!option.children, selected: key === itemType }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, _items_69346131_js__WEBPACK_IMPORTED_MODULE_18__.a[key]), option.children && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { slot: "children", selectionMode: "children" }, Object.entries(option.children).map(this.renderItemType)))));
    };
    this.itemType = undefined;
    this.allowedItemTypes = _items_69346131_js__WEBPACK_IMPORTED_MODULE_18__.d;
    this.expanded = undefined;
  }
  componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.filterItemType;
  }
  componentDidLoad() {
    var _a;
    if (this.itemType) {
      this.arcgisItemBrowserFilter.emit(this.getEventDetail());
      let activeItem = (_a = this.el) === null || _a === void 0 ? void 0 : _a.querySelector(`calcite-tree-item[data-item-type="${this.itemType}"]`);
      // expand parents on load if initial value was provided
      while (activeItem) {
        activeItem.expanded = true;
        activeItem = activeItem.parentElement.closest("calcite-tree-item");
        if (!(activeItem === null || activeItem === void 0 ? void 0 : activeItem.closest("arcgis-item-browser-filter-item-type"))) {
          activeItem = null;
        }
      }
    }
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_8__.a)("itemType", this.store, () => (this.itemType = null));
  }
  getEventDetail() {
    const { itemType } = this;
    const option = (0,_items_69346131_js__WEBPACK_IMPORTED_MODULE_18__.g)(itemType);
    const value = (option === null || option === void 0 ? void 0 : option.q) ? `(${option.q})` : "";
    const label = option ? this.i18n.itemType.replace("${itemType}", _items_69346131_js__WEBPACK_IMPORTED_MODULE_18__.a[itemType]) : "";
    return { id: "itemType", param: "q", value, label, itemType };
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.title, expanded: this.expanded, active: !!this.itemType, onArcgisBrowserFilterRemove: () => {
        this.itemType = null;
        this.arcgisItemBrowserFilter.emit(this.getEventDetail());
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "children", scale: "m", onCalciteTreeSelect: (event) => {
        var _a, _b;
        const node = event.target;
        const dataset = (_b = (_a = node === null || node === void 0 ? void 0 : node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset;
        const itemType = (dataset === null || dataset === void 0 ? void 0 : dataset.itemType) || "";
        if (this.itemType === itemType) {
          this.itemType = null;
        }
        else {
          this.itemType = itemType;
        }
        this.arcgisItemBrowserFilter.emit(this.getEventDetail());
      } }, Object.entries(_items_69346131_js__WEBPACK_IMPORTED_MODULE_18__.i).map(this.renderItemType))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

function geocoderSupportsSuggestions(geocoder) {
  return !!((geocoder.singleLineFieldName || (0,_geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_20__.i)(geocoder.url) || geocoder.enableSuggestions) &&
    geocoder.placefinding);
}
function getSearchGeocodingServices(portal, config, i18n) {
  var _a;
  const helperServices = portal.helperServices || {};
  let geocoders = [...(helperServices.geocode || [])];
  const geocodeAutoComplete = (_a = config.geocodeAutoComplete) !== null && _a !== void 0 ? _a : false;
  return geocoders
    .filter(geocoderSupportsSuggestions)
    .map((geocoder) => {
    // determine if we need to enable suggestions
    const enableSuggestions = geocoder.suggest === true && geocodeAutoComplete ? true : false;
    const isEsri = (0,_geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_20__.i)(geocoder.url);
    return Object.assign(Object.assign({}, geocoder), { name: isEsri ? "ArcGIS World Geocoding Service" : geocoder.name, enableSuggestions, categories: isEsri ? ["Populated Place", "Coordinate System"] : null, placefinding: isEsri ? true : geocoder.placefinding, outFields: isEsri ? ["Match_addr", "Addr_type", "StAddr", "City"] : null, placeholder: geocoder.placeholder || i18n.findLocationText, singleLineFieldName: geocoder.singleLineFieldName || "SingleLine", highlightSymbol: null, localSearchOptions: {
        minScale: 300000,
        distance: 50000
      } });
  });
}
function createExtentSearchOptions(portal, config, i18n, value) {
  var _a;
  const suggestionsEnabled = (_a = config === null || config === void 0 ? void 0 : config.geocodeAutoComplete) !== null && _a !== void 0 ? _a : false;
  const searchLayers = []; // type === "extent"
  const geocoders = getSearchGeocodingServices(portal, config, i18n);
  const options = {
    suggestionsEnabled,
    minSuggestCharacters: 3,
    maxResults: 5,
    searchTerm: value || null,
    activeSourceIndex: "all",
    sources: searchLayers.concat(geocoders),
    popupEnabled: false
  };
  // remove activeSourceIndex if there is only a single geocoder
  if (options.sources.length === 1) {
    delete options.activeSourceIndex;
  }
  return options;
}

const arcgisItemBrowserFilterLocationCss = ".location-filter__container{display:flex;width:100%;box-sizing:border-box}.location-filter__input{flex:1 1 0%;--calcite-ui-border-input:var(--calcite-ui-border-3)}.location-filter__button{-webkit-margin-start:-1px;margin-inline-start:-1px}.location-filter__suggestions{overflow-y:auto;box-sizing:border-box;height:8rem;border-top:1px solid var(--calcite-ui-border-1);border-bottom:1px solid var(--calcite-ui-border-1);width:calc(var(--item-browser-pane-width) - 2.5rem)}.location-filter__no-results{margin-top:3rem;padding-top:0.5rem;padding-bottom:0;margin-bottom:0;text-align:center;color:var(--calcite-ui-text-3)}";

const ArcgisItemBrowserFilterLocation = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
    this.arcgisItemBrowserSort = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserSort", 7);
    this.suggest = (term) => {
      this.loadingSuggestions = true;
      if ((term === null || term === void 0 ? void 0 : term.length) > 2) {
        this.searchViewModel.suggest(term);
      }
      else {
        this.loadingSuggestions = false;
        this.suggestions = [];
      }
    };
    this.debouncedSuggest = (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_2__.d)(this.suggest.bind(this), 1000);
    this.updateSuggest = (term) => {
      if ((term === null || term === void 0 ? void 0 : term.length) > 2) {
        this.loadingSuggestions = true;
      }
      this.debouncedSuggest(term);
    };
    this.location = undefined;
    this.extent = undefined;
    this.expanded = undefined;
    this.loading = undefined;
    this.searching = undefined;
    this.suggestions = [];
    this.loadingSuggestions = undefined;
    this.searchTerm = undefined;
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.filterLocation;
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_8__.a)("location", this.store, () => {
      var _a;
      this.location = null;
      this.extent = null;
      (_a = this.searchViewModel) === null || _a === void 0 ? void 0 : _a.clear();
      this.searchTerm = "";
    });
  }
  async componentDidLoad() {
    if (this.location && this.extent) {
      this.searchTerm = this.location;
      this.emitFilterEvent();
    }
    if (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal) {
      this.setupSearch();
    }
    else {
      (0,_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.o)("portal", () => {
        this.setupSearch();
      });
    }
  }
  async setupSearch() {
    const options = createExtentSearchOptions(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal, _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.config, this.i18n, this.location);
    const [SearchViewModel] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_19__.l)(["esri/widgets/Search/SearchViewModel"]);
    this.searchViewModel = new SearchViewModel(Object.assign(Object.assign({}, options), { allPlaceholder: this.i18n.findLocationText, showInfoWindowOnSelect: false }));
    this.searchViewModel.on("suggest-start", () => {
      this.loadingSuggestions = true;
    });
    this.searchViewModel.on("suggest-complete", async (e) => {
      this.suggestions = [...e.results];
      this.loadingSuggestions = false;
    });
    this.searchViewModel.on("search-start", () => {
      this.loadingSuggestions = false;
      this.searching = true;
      this.suggestPopover.open = false;
    });
    this.searchViewModel.on("search-complete", () => {
      this.searching = false;
    });
    this.searchViewModel.on("select-result", this.handleLocationChange.bind(this));
    this.searchViewModel.on("search-clear", () => {
      if (this.extent && this.location) {
        this.location = null;
        this.extent = null;
        this.emitFilterEvent();
      }
    });
  }
  handleLocationChange(event) {
    this.location = event.result.name;
    const ext = event.result.extent;
    this.extent = `${ext.xmin},${ext.ymin},${ext.xmax},${ext.ymax}`;
    this.emitFilterEvent();
  }
  emitFilterEvent() {
    const { location, extent } = this;
    const label = this.i18n.label.replace("${location}", location);
    this.arcgisItemBrowserFilter.emit({
      id: "location",
      param: "bbox",
      value: extent !== null && extent !== void 0 ? extent : "",
      label,
      location,
      extent
    });
    // when filtering by location, only relevance sort order is allowed
    if (extent) {
      this.arcgisItemBrowserSort.emit({ sortField: "relevance", sortOrder: "desc" });
    }
  }
  handleSuggestSelect(suggestion) {
    var _a;
    this.searchViewModel.search(suggestion);
    this.searchTerm = suggestion.text;
    (_a = this.input) === null || _a === void 0 ? void 0 : _a.setFocus();
  }
  hasResults() {
    var _a;
    return (_a = this.suggestions) === null || _a === void 0 ? void 0 : _a.some((service) => { var _a; return (_a = service === null || service === void 0 ? void 0 : service.results) === null || _a === void 0 ? void 0 : _a.length; });
  }
  renderSuggestions(service) {
    var _a;
    return (_a = service === null || service === void 0 ? void 0 : service.results) === null || _a === void 0 ? void 0 : _a.map((suggestion) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { class: "location-filter__suggestion", key: suggestion.key, label: suggestion.text, onClick: () => this.handleSuggestSelect(suggestion), onKeyPress: (e) => {
        if (e.key === "Enter") {
          this.handleSuggestSelect(suggestion);
        }
      } })));
  }
  render() {
    var _a, _b;
    if ((_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.api) === 3) {
      return null;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.location, expanded: this.expanded, active: !!this.location, onArcgisBrowserFilterRemove: () => {
        this.location = null;
        this.extent = null;
        this.emitFilterEvent();
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "location-filter__container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { loading: this.searching || this.loadingSuggestions, type: "text", value: this.searchTerm, placeholder: this.i18n.findLocationText, scale: "m", class: "location-filter__input", ref: (el) => (this.input = el), clearable: true, onKeyPress: (e) => {
        const value = e.target.value;
        if (e.key === "Enter" && e.target === e.currentTarget) {
          this.searchTerm = value;
          this.searchViewModel.suggest(value);
          return;
        }
      }, onKeyDown: (e) => {
        var _a, _b;
        if (e.key === "ArrowDown" && !this.loadingSuggestions && ((_a = this.suggestions) === null || _a === void 0 ? void 0 : _a.length)) {
          e.preventDefault();
          e.stopPropagation();
          (_b = this.el.querySelector("calcite-list-item")) === null || _b === void 0 ? void 0 : _b.setFocus();
        }
      }, onCalciteInputInput: (e) => {
        const value = e.target.value;
        this.searchTerm = value;
        this.updateSuggest(value);
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: "location-filter__button", label: "search", slot: "action", kind: "neutral", appearance: "outline-fill", iconStart: "search", scale: "m", ref: (el) => (this.searchButton = el), onClick: () => {
        this.suggest(this.searchTerm);
      }, onKeyPress: (e) => {
        if (e.key === "Enter" || e.key === " ") {
          this.suggest(this.searchTerm);
        }
      }, disabled: !this.searchTerm })), !this.loadingSuggestions && ((_a = this.searchTerm) === null || _a === void 0 ? void 0 : _a.length) > 2 && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { label: this.i18n.suggestions, referenceElement: this.searchButton, ref: (el) => (this.suggestPopover = el), autoClose: true, pointerDisabled: true, offsetDistance: 0, overlayPositioning: "fixed", open: true, placement: "bottom-end", flipPlacements: ["top-end"] }, this.hasResults() ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { key: this.searchTerm, class: "location-filter__suggestions" }, (_b = this.suggestions) === null || _b === void 0 ? void 0 : _b.map((service) => this.renderSuggestions(service)))) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "location-filter__suggestions" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "location-filter__no-results" }, this.i18n.noResults.replace("${searchTerm}", this.searchTerm)))))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserFilterLocation.style = arcgisItemBrowserFilterLocationCss;

async function fetchRegions(portal) {
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_14__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_14__.g)(portal)}portals/regions`);
}

const ArcgisItemBrowserFilterRegion = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
    this.regions = [];
    this.region = undefined;
    this.expanded = undefined;
    this.loading = undefined;
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.filterRegion;
    if (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal) {
      this.fetchRegions(_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    }
    else {
      (0,_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.o)("portal", (portal) => this.fetchRegions(portal));
    }
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_8__.a)("region", this.store, () => (this.region = null));
  }
  async fetchRegions(portal) {
    this.regions = await fetchRegions(portal);
    this.loading = false;
  }
  async componentDidLoad() {
    if (this.region) {
      this.emitFilterEvent();
    }
  }
  emitFilterEvent() {
    var _a;
    const { region, i18n } = this;
    const categoryValue = region ? `/region/${region.toLowerCase()}` : "";
    const value = region ? JSON.stringify([categoryValue]) : "";
    const activeRegion = (_a = this.regions) === null || _a === void 0 ? void 0 : _a.find((r) => r.region === region);
    const label = i18n.region.replace("${region}", (activeRegion === null || activeRegion === void 0 ? void 0 : activeRegion.localizedName) || (activeRegion === null || activeRegion === void 0 ? void 0 : activeRegion.name) || "");
    this.arcgisItemBrowserFilter.emit({
      id: "region",
      param: "categories",
      categoryValue,
      value,
      label,
      region
    });
  }
  render() {
    var _a;
    const { loading, regions, store } = this;
    if (loading || !(regions === null || regions === void 0 ? void 0 : regions.length) || ((_a = store.state) === null || _a === void 0 ? void 0 : _a.bucket) !== "living atlas") {
      return null;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.regions, expanded: this.expanded, active: !!this.region, onArcgisBrowserFilterRemove: () => {
        this.region = null;
        this.emitFilterEvent();
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "children", scale: "m", onCalciteTreeSelect: (event) => {
        var _a, _b;
        const node = event.target;
        const dataset = (_b = (_a = node === null || node === void 0 ? void 0 : node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset;
        const region = (dataset === null || dataset === void 0 ? void 0 : dataset.value) || "";
        if (this.region === region) {
          this.region = null;
        }
        else {
          this.region = region;
        }
        this.emitFilterEvent();
      } }, regions.map(({ name, region, localizedName }) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-value": region, selected: this.region === region }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, localizedName || name)))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserFilterSharing = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
    this.sharingLevels = [["owner", ["private", "shared"]], "org", "public"];
    this.renderLevel = (sharingLevel) => {
      const [level, children] = Array.isArray(sharingLevel) ? sharingLevel : [sharingLevel];
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-sharing": level, selected: (children === null || children === void 0 ? void 0 : children.includes(this.sharing)) || level === this.sharing }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, this.i18n[level]), children && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { slot: "children", selectionMode: "children" }, children.map(this.renderLevel)))));
    };
    this.sharing = undefined;
    this.expanded = undefined;
  }
  componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.filterSharing;
  }
  componentDidLoad() {
    if (this.sharing) {
      this.arcgisItemBrowserFilter.emit(this.getEventDetail());
    }
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_8__.a)("sharing", this.store, () => (this.sharing = null));
  }
  getEventDetail() {
    const { sharing, i18n } = this;
    const value = sharing === "owner" ? `(access:private OR access:shared)` : `(access: ${sharing})`;
    return {
      id: "sharing",
      param: "q",
      value: sharing ? value : "",
      label: sharing ? i18n.label.replace("${sharing}", i18n[sharing]) : "",
      sharing
    };
  }
  render() {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.title, expanded: this.expanded, active: !!this.sharing, onArcgisBrowserFilterRemove: () => {
        this.sharing = null;
        this.arcgisItemBrowserFilter.emit(this.getEventDetail());
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "children", scale: "m", onCalciteTreeSelect: (event) => {
        var _a;
        const node = event.target;
        const item = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0];
        const sharing = item === null || item === void 0 ? void 0 : item.dataset.sharing;
        if (this.sharing === sharing) {
          this.sharing = null;
        }
        else {
          this.sharing = sharing;
        }
        this.arcgisItemBrowserFilter.emit(this.getEventDetail());
      } }, this.sharingLevels.map((level) => this.renderLevel(level)))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserFilterTags = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserFilter = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
    this.deselectAllTags = () => {
      this.el
        .querySelectorAll("calcite-combobox-item[selected]")
        .forEach((item) => {
        item.selected = false;
      });
    };
    this.tags = undefined;
    this.expanded = undefined;
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.filterTags;
  }
  async componentDidLoad() {
    if (this.tags) {
      this.arcgisItemBrowserFilter.emit(this.getEventDetail());
    }
    (0,_store_ff04ba0a_js__WEBPACK_IMPORTED_MODULE_8__.a)("tags", this.store, () => {
      this.tags = null;
      this.deselectAllTags();
    });
  }
  getEventDetail() {
    const { tags } = this;
    const value = (tags === null || tags === void 0 ? void 0 : tags.length) ? `tags:(${tags.map((tag) => `"${tag}"`).join(" OR ")})` : "";
    const label = (tags === null || tags === void 0 ? void 0 : tags.length) ? this.i18n.label.replace("${tags}", tags.join(", ")) : "";
    return { id: "tags", param: "filter", value, tags, label };
  }
  componentDidRender() {
    const items = this.el.querySelectorAll("calcite-combobox-item");
    const values = [];
    items.forEach((item) => {
      // remove duplicate items which were added by calcite combobox
      if (values.includes(item.value)) {
        item.parentElement.removeChild(item);
      }
      else {
        values.push(item.value);
      }
    });
  }
  render() {
    var _a;
    const { i18n } = this;
    const knownTags = this.store.state.knownTags || [];
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: i18n.title, expanded: this.expanded, active: !!((_a = this.tags) === null || _a === void 0 ? void 0 : _a.length), onArcgisBrowserFilterRemove: () => {
        this.tags = [];
        this.deselectAllTags();
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox", { label: i18n.title, overlayPositioning: "fixed", placeholder: i18n.selectTags, scale: "s", maxItems: 5, allowCustomValues: true, onCalciteComboboxChange: (e) => {
        var _a;
        this.tags = (_a = e.target.selectedItems) === null || _a === void 0 ? void 0 : _a.map((item) => item.value);
        this.arcgisItemBrowserFilter.emit(this.getEventDetail());
      }, style: { marginBottom: "1rem" }, ref: (el) => {
        var _a;
        const div = el.shadowRoot.querySelector("div");
        if (div && ((_a = this.store.state) === null || _a === void 0 ? void 0 : _a.panel)) {
          div.insertAdjacentHTML("beforeend", `<style>
              .floating-ui-container--active {
                visibility: visible !important;
                pointer-events: auto !important;
                position: absolute !important;
              }
              </style>`);
        }
      } }, knownTags.map((tag) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { key: tag, value: tag, textLabel: tag.length > 36 ? `${tag.slice(0, 36)}...` : tag }))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserFilters = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
  }
  render() {
    var _a, _b;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filters", { store: this.store, style: ((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket) === "subscription content" ? { display: "none" } : {} }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "top" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "top" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", null), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "bottom" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "bottom" }))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserPagination = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserPage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserPage", 7);
    this.total = undefined;
    this.start = undefined;
    this.num = 60;
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    const { start, total, num } = this;
    this.arcgisItemBrowserPage.emit({ start, total, num });
  }
  render() {
    const { start, total, num, store } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-pagination", { start: start, total: total, num: num, store: store, onArcgisBrowserPage: (e) => this.arcgisItemBrowserPage.emit(e.detail) }));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const arcgisItemBrowserPreviewCss = ":host{background-color:var(--calcite-ui-background);flex:1 1 0%;display:flex;flex-direction:column;height:100%;width:100%}.preview__header{-webkit-margin-start:0.75rem;margin-inline-start:0.75rem}.preview__title{font-size:1rem;font-weight:500;color:var(--calcite-ui-text-1);padding:0;margin:0;word-wrap:break-word;overflow-wrap:break-word;line-height:1.375}.title{font-weight:500;color:var(--calcite-ui-text-1);font-size:1.125rem;margin-top:0.75rem;margin-bottom:0.75rem;padding:0;word-wrap:break-word;word-break:break-word}.badges{display:block;margin-bottom:1rem}.badges[empty]{display:none}calcite-accordion-item{--calcite-accordion-item-padding:1rem 1rem;--calcite-accordion-item-background:var(--calcite-ui-foreground-1);width:100%;box-sizing:border-box;border-bottom:1px solid var(--calcite-ui-border-2)}.section{padding-left:1rem;padding-right:1rem;padding-top:1rem;padding-bottom:1rem;background-color:var(--calcite-ui-background);margin:0rem -1rem calc(-1rem - 1px) -1rem;line-height:1.35}.section--tight{padding-top:0;padding-bottom:0;padding-left:0;padding-right:0}.details-title{font-weight:500;font-size:0.75rem;color:var(--calcite-ui-text-3);padding-bottom:0.25rem;padding-top:0;margin-top:1rem;margin-bottom:0;--calcite-label-margin-bottom:0}.details-title:first-of-type{margin-top:0}.details-title--label{padding-bottom:0}.details-text{font-weight:400;font-size:0.875rem;color:var(--calcite-ui-text-1);padding:0;margin:0;word-wrap:break-word;overflow-wrap:break-word}.details-text a{color:var(--calcite-ui-text-link)}.details-text--empty{color:var(--calcite-ui-text-3);font-weight:400;font-size:0.875rem}.description{word-wrap:break-word;overflow-wrap:break-word;line-height:1.35}.description *{max-width:100%;font-size:0.875rem !important}.favorite{padding-top:1.5rem;display:block}.copy-input{--calcite-ui-background:var(--calcite-ui-foreground-1)}.sublayer-item{--tw-shadow:none}.sublayer__tabs{background-color:var(--calcite-ui-background);flex:1 1 auto}.sublayer__tabs--white{background-color:var(--calcite-ui-foreground-1)}.sublayer-item__content{max-width:10.875rem;min-width:0;flex-direction:column;display:flex}.sublayer-item__title{padding-top:0.5rem;padding-bottom:0.5rem;color:var(--calcite-ui-text-2);font-size:0.875rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-decoration:underline}.sublayer-item__title--matched{padding-top:0;padding-bottom:0}.sublayer-item__description{font-size:0.75rem;color:var(--calcite-ui-text-3)}.sublayer__header{display:flex;padding-left:1rem;padding-right:1rem;padding-top:1rem;padding-bottom:0.5rem;background-color:var(--calcite-ui-foreground-1);font-weight:500;color:var(--calcite-ui-text-1)}.sublayer__header__title{word-wrap:break-word;overflow-wrap:break-word;min-width:0}.sublayer__header__icon{-webkit-margin-end:1rem;margin-inline-end:1rem}.sublayer__tab-nav{background-color:var(--calcite-ui-foreground-1);padding-left:1rem;padding-right:1rem}.sublayer__content{height:100%;background-color:var(--calcite-ui-foreground-1);margin-top:-0.5rem}.sublayer__content--overview{background-color:var(--calcite-ui-background);padding-top:2rem;padding-bottom:2rem;padding-left:1.25rem;padding-right:1.25rem;box-sizing:border-box}.footer-actions{width:100%;display:grid;grid-template-columns:repeat(1, minmax(0, 1fr));grid-gap:0.5rem;gap:0.5rem}.error-container{height:100%;display:flex;padding:1rem}";

const ArcgisItemBrowserPreview$1 = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserPreviewClose = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserPreviewClose", 7);
    this.arcgisInternalItemBrowserSublayer = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisInternalItemBrowserSublayer", 7);
    this.arcgisItemBrowserInternalUIAction = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserInternalUIAction", 7);
    this.sortSublayers = (a, b) => {
      const matchedA = this.layerMatches(a);
      const matchedB = this.layerMatches(b);
      if (matchedA === matchedB) {
        return b.id - a.id;
      }
      return matchedA ? -1 : 1;
    };
    this.layerMatches = (layer) => {
      var _a, _b, _c, _d, _e;
      return (_e = (_d = (_c = (_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.highlights) === null || _c === void 0 ? void 0 : _c[this.item.id]) === null || _d === void 0 ? void 0 : _d.sublayers) === null || _e === void 0 ? void 0 : _e.includes(layer.id);
    };
    this.renderField = (field) => {
      if (field.name === "OBJECTID") {
        return;
      }
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-preview-field-details", { field: field, item: this.item, sublayer: this.sublayer, api: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.api, showFieldStatistics: this.store.state.showFieldStatistics }));
    };
    this.handleLayerClick = (layer) => {
      this.sublayer = layer;
      this.fetchSublayer();
      this.arcgisItemBrowserInternalUIAction.emit({
        action: "click",
        category: "panel action",
        details: "sublayer"
      });
      this.arcgisInternalItemBrowserSublayer.emit(Object.assign({}, layer));
    };
    this.renderLayer = (layer) => {
      const matches = this.layerMatches(layer);
      const { icon } = (0,_utils_69e56978_js__WEBPACK_IMPORTED_MODULE_24__.g)({ geometry: layer.geometryType, type: layer.type });
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { onClick: () => this.handleLayerClick(layer), onKeyDown: (event) => {
          if (event.key === " " || event.key === "Enter") {
            event.preventDefault();
            this.handleLayerClick(layer);
          }
        }, class: "sublayer-item" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: icon, flipRtl: true, scale: "s", slot: "content-start" }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { slot: "content", class: "sublayer-item__content" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: { "sublayer-item__title": true, "sublayer-item__title--matched": matches } }, layer.title || layer.name), matches && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "sublayer-item__description" }, this.i18n.matched)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", slot: "content-end", icon: "chevron-right", flipRtl: true, style: { display: "flex", justifyContent: "flex-end" } })));
    };
    this.item = undefined;
    this.portal = undefined;
    this.user = undefined;
    this.hidePreviewFooters = false;
    this.fullItem = undefined;
    this.formattedViews = undefined;
    this.loadingLayers = true;
    this.layerError = undefined;
    this.layers = [];
    this.sublayer = undefined;
    this.fullSublayer = undefined;
    this.showLayers = undefined;
    this.userInfo = undefined;
    this.tab = "fields";
    this.itemError = undefined;
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.preview;
    this.layerTypes = this.store.state.i18n.layerTypes;
    this.lang = await (0,_locale_13e00a75_js__WEBPACK_IMPORTED_MODULE_3__.a)(this.el);
    this.init();
  }
  updatePreview() {
    this.init();
  }
  async fetchItem() {
    this.itemError = null;
    return (0,_query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_4__.f)(this.item, this.portal, this.user, this.store);
  }
  async init() {
    var _a, _b, _c, _d, _e, _f;
    if (!this.item) {
      return;
    }
    const { item, portal, lang } = this;
    this.fullItem = null;
    this.shouldExpandOverview = true;
    this.loadingLayers = true;
    const response = await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_2__.m)(this.fetchItem(), 600);
    if (response.error) {
      this.itemError =
        response.error.code === "disabledSubscription"
          ? this.i18n.itemError.subscription
          : this.i18n.itemError.unhandled;
      return;
    }
    this.fullItem = response.result;
    this.formattedViews = await (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_12__.f)(item.numViews || 0, {
      api: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.api,
      places: 0,
      type: "decimal"
    });
    this.userInfo = await (0,_user_ba12ebd6_js__WEBPACK_IMPORTED_MODULE_23__.a)(item, portal, lang);
    (_a = this.flowItem) === null || _a === void 0 ? void 0 : _a.setFocus();
    const typeToShowLayers = [
      "Feature Service",
      "Layer Template",
      "Feature Collection"
    ];
    this.showLayers =
      typeToShowLayers.includes(item.type) && !((_b = item.typeKeywords) === null || _b === void 0 ? void 0 : _b.includes("Route Layer"));
    if (this.showLayers) {
      // layer templates store their layers/schema in item data
      if (item.type === "Layer Template" &&
        ((_c = item.typeKeywords) === null || _c === void 0 ? void 0 : _c.map((keyword) => keyword.toLowerCase()).includes("service template"))) {
        const data = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_14__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_14__.g)(this.portal)}content/items/${this.item.id}/data`);
        this.layers = [...((_d = data.layers) !== null && _d !== void 0 ? _d : []), ...((_e = data.tables) !== null && _e !== void 0 ? _e : [])];
      }
      else {
        const response = await (0,_services_ce8cb0ef_js__WEBPACK_IMPORTED_MODULE_13__.f)({
          item: this.fullItem,
          portal: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal,
          layers: null,
          isSecure: false
        });
        if (response.result) {
          this.layers = (_f = response.result) === null || _f === void 0 ? void 0 : _f.sort(this.sortSublayers);
        }
        else if (response.error) {
          this.layerError = this.i18n.layerError;
          if (response.error.code === "serviceNotExist") {
            this.layerError.message = this.i18n.noServiceMessage;
          }
        }
      }
    }
    this.loadingLayers = false;
  }
  handleAccordionItemClick(element, details) {
    this.arcgisItemBrowserInternalUIAction.emit({
      action: element.expanded ? "expand" : "collapse",
      category: "panel action",
      details
    });
  }
  async fetchSublayer() {
    const layerResponse = await (0,_services_ce8cb0ef_js__WEBPACK_IMPORTED_MODULE_13__.a)(this.portal, this.sublayer.id, this.item.url);
    this.fullSublayer = layerResponse === null || layerResponse === void 0 ? void 0 : layerResponse.result;
  }
  closePreview() {
    this.sublayer = null;
    this.fullItem = null;
    this.arcgisItemBrowserInternalUIAction.emit({
      action: "close panel",
      category: "panel action"
    });
    this.arcgisItemBrowserPreviewClose.emit();
  }
  renderHeader() {
    var _a;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header-content", class: "preview__header" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { class: "preview__title" }, (_a = this.item) === null || _a === void 0 ? void 0 : _a.title), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-type", { item: this.item, portal: this.portal, scale: "m" })));
  }
  renderLayers() {
    var _a;
    return this.loadingLayers ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: this.i18n.loading, scale: "s" })) : this.layerError ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { icon: true, open: true, scale: "s", width: "full", kind: "warning" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, this.layerError.title), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, this.layerError.message)))) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section section--tight" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { "selection-mode": "none", loading: this.loadingLayers, ref: (list) => {
        var _a;
        const table = (_a = list === null || list === void 0 ? void 0 : list.shadowRoot) === null || _a === void 0 ? void 0 : _a.querySelector("table");
        if (table) {
          table.style.borderSpacing = "0";
        }
      } }, (_a = this.layers) === null || _a === void 0 ? void 0 : _a.map(this.renderLayer))));
  }
  isAccordionItem(element) {
    return element.tagName === "CALCITE-ACCORDION-ITEM";
  }
  handleSublayerSectionChange(section) {
    this.tab = section;
    this.arcgisItemBrowserInternalUIAction.emit({
      action: "click",
      category: "panel action",
      details: `sublayer ${section}`
    });
  }
  renderSublayerPreview() {
    var _a, _b, _c, _d;
    const { sublayer, item, i18n, fullSublayer } = this;
    const { geometryType, title, name, description } = sublayer;
    const { type, isGeometry } = (0,_utils_69e56978_js__WEBPACK_IMPORTED_MODULE_24__.g)({
      geometry: geometryType,
      type: sublayer.type
    });
    const layerType = this.layerTypes[type];
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { closable: true, onCalciteFlowItemBack: (e) => {
        e.stopPropagation();
        this.arcgisInternalItemBrowserSublayer.emit();
        this.sublayer = null;
      }, onCalciteFlowItemClose: (e) => {
        e.stopPropagation();
        this.closePreview();
      } }, this.renderHeader(), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "sublayer__header" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-sublayer-type", { name: name || title, geometry: sublayer.geometryType, type: sublayer.type, showType: false, scale: "s" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tabs", { position: "top", scale: "m", layout: "center", class: { sublayer__tabs: true, "sublayer__tabs--white": this.tab === "fields" } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tab-nav", { slot: "title-group", class: "sublayer__tab-nav" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tab-title", { onClick: () => this.handleSublayerSectionChange("fields") }, i18n.fields), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tab-title", { onClick: () => this.handleSublayerSectionChange("overview") }, i18n.overview)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tab", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "sublayer__content" }, sublayer.fields ? (sublayer.fields.map(this.renderField)) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text details-text--empty" }, i18n.noFields)))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tab", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "sublayer__content sublayer__content--overview" }, this.renderDetail(isGeometry ? i18n.geometryTypeTitle : i18n.layerTypeTitle, layerType), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, i18n.description), description ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "details-text description", innerHTML: (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_7__.s)((0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_7__.d)(description)) })) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text details-text--empty" }, i18n.noDescription)), !((_a = this.portal) === null || _a === void 0 ? void 0 : _a.isPortal) &&
      this.renderDetail(i18n.dataUpdated, (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_12__.a)((_b = fullSublayer === null || fullSublayer === void 0 ? void 0 : fullSublayer.editingInfo) === null || _b === void 0 ? void 0 : _b.dataLastEditDate)), !((_c = this.portal) === null || _c === void 0 ? void 0 : _c.isPortal) &&
      this.renderDetail(i18n.schemaUpdated, (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_12__.a)((_d = fullSublayer === null || fullSublayer === void 0 ? void 0 : fullSublayer.editingInfo) === null || _d === void 0 ? void 0 : _d.schemaLastEditDate)), item.url && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-preview-copy", { text: `${item.url}/${sublayer.id}`, heading: i18n.URL }))))), !this.hidePreviewFooters && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "footer", class: "footer-actions" }, this.renderSublayerSelect(), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "sublayer-footer" })))));
  }
  renderDetail(title, text, emptyText, html) {
    const textNode = !emptyText || text ? (html ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text", innerHTML: (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_7__.s)(text) })) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text" }, text))) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text details-text--empty" }, emptyText));
    return [(0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, title), textNode];
  }
  renderSublayerSelect() {
    var _a, _b, _c;
    if ((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state.selection) === null || _b === void 0 ? void 0 : _b.includes("sublayer")) {
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-card-sublayer-select", { item: this.item, user: this.user, portal: this.portal, selection: ((_c = this.store) === null || _c === void 0 ? void 0 : _c.state.selection) === "multiple-sublayer" ? "multiple" : "single", appearance: "solid", width: "full" }));
    }
    return null;
  }
  render() {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j;
    const { item, fullItem, i18n, user, sublayer, userInfo, portal, itemError } = this;
    const owner = (_a = item === null || item === void 0 ? void 0 : item.owner) !== null && _a !== void 0 ? _a : "";
    const managedBy = (fullItem === null || fullItem === void 0 ? void 0 : fullItem.contentStatus) === "public_authoritative"
      ? this.i18n.itemManagedBy.replace("${username}", owner)
      : owner;
    const layersHeader = ((_b = this.layers) === null || _b === void 0 ? void 0 : _b.length)
      ? i18n.layersCount.replace("${count}", `${((_c = this.layers) === null || _c === void 0 ? void 0 : _c.length) || 0}`)
      : i18n.layers;
    const matchedSublayers = (_f = (_e = (_d = this.store) === null || _d === void 0 ? void 0 : _d.state.highlights) === null || _e === void 0 ? void 0 : _e[item === null || item === void 0 ? void 0 : item.id]) === null || _f === void 0 ? void 0 : _f.sublayers;
    const layersDescription = (matchedSublayers === null || matchedSublayers === void 0 ? void 0 : matchedSublayers.length) && !this.loadingLayers
      ? i18n.matchedNumber.replace("${num}", `${matchedSublayers.length}`)
      : null;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { closable: true, loading: !fullItem && !itemError, onCalciteFlowItemClose: (e) => {
        e.stopPropagation();
        this.closePreview();
      }, ref: (el) => (this.flowItem = el) }, this.renderHeader(), !!itemError && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "error-container" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { kind: "danger", open: true, scale: "s" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, this.i18n.itemError.title), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, itemError)))), fullItem && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "content" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion", { "icon-position": "start", appearance: "transparent", key: item.id, class: "accordion", onClick: async (e) => {
        const target = e.target;
        if (this.isAccordionItem(target)) {
          await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_2__.t)(300);
          if (target.expanded) {
            target.scrollIntoView({ behavior: "smooth", block: "start" });
          }
        }
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.thumbnail, ref: (el) => {
        this.thumbnailElement = el;
      }, onClick: (e) => this.isAccordionItem(e.target) &&
        this.handleAccordionItemClick(this.thumbnailElement, "thumbnail") }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section section--tight" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-card-thumbnail", { item: item, user: user, portal: portal }))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.overview, ref: (el) => {
        this.overviewElement = el;
        if (this.shouldExpandOverview) {
          el.expanded = true;
          this.shouldExpandOverview = false;
        }
      }, onClick: (e) => this.isAccordionItem(e.target) &&
        this.handleAccordionItemClick(this.overviewElement, "overview") }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "summary-top" }), this.renderDetail(i18n.summary, fullItem.snippet, i18n.noSummary), !!((_g = (0,_badges_c3f03cc3_js__WEBPACK_IMPORTED_MODULE_22__.g)(item, portal, user)) === null || _g === void 0 ? void 0 : _g.length) && [
      (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, i18n.itemStatus),
      (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-badges", { class: "badges", item: item, portal: portal, user: user, scale: "s", width: "full" })
    ], (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, i18n.owner), ((_h = this.store) === null || _h === void 0 ? void 0 : _h.state.panel) ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-user-avatar", { user: userInfo, scale: "s", portal: portal, showName: true, description: managedBy })) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-user-popup", { baseUrl: _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.config.baseUrl, portal: portal, item: fullItem })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, i18n.shared), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-share-summary", { item: fullItem, scale: "s" }), this.renderDetail(i18n.updated, (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_12__.a)(fullItem.modified)), !!user && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-favorite", { class: "favorite", user: user, portal: portal, item: fullItem, width: "full" })))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.description, key: "description", ref: (el) => {
        this.descriptionElement = el;
      }, onClick: (e) => this.isAccordionItem(e.target) &&
        this.handleAccordionItemClick(this.descriptionElement, "description") }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, fullItem.description ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "description", innerHTML: (0,_dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_7__.s)(fullItem.description) })) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text details-text--empty" }, i18n.noDescription)))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.details, ref: (el) => {
        this.detailsElement = el;
      }, onClick: (e) => this.isAccordionItem(e.target) &&
        this.handleAccordionItemClick(this.detailsElement, "details") }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, this.renderDetail(i18n.created, (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_12__.a)(fullItem.created)), this.renderDetail(i18n.viewCount, this.formattedViews), item.type === "Dashboard" &&
      this.renderDetail(i18n.dashboardViews, ((_j = item.typeKeywords) === null || _j === void 0 ? void 0 : _j.includes("Mobile"))
        ? i18n.dashboardMobile
        : i18n.dashboardDesktop), !!fullItem.size &&
      this.renderDetail(i18n.fileSize, (0,_file_f36193e9_js__WEBPACK_IMPORTED_MODULE_21__.f)(fullItem.size)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-preview-copy", { text: fullItem.id, heading: i18n.ID }), fullItem.url && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-preview-copy", { text: fullItem.url, heading: i18n.URL })), this.renderDetail(i18n.credits, fullItem.accessInformation, i18n.noCredits), this.renderDetail(i18n.termsOfUse, fullItem.licenseInfo, i18n.noTermsOfUse, true))), this.showLayers && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: layersHeader, description: layersDescription, ref: (el) => {
        this.layersElement = el;
      }, onClick: async (e) => {
        if (this.isAccordionItem(e.target)) {
          this.handleAccordionItemClick(this.layersElement, "layers");
        }
      } }, this.renderLayers()))))), !this.hidePreviewFooters && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "footer", class: "footer-actions" }, this.renderSublayerSelect(), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "footer" })))), !!sublayer && this.renderSublayerPreview())));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "item": ["updatePreview"]
  }; }
};
ArcgisItemBrowserPreview$1.style = arcgisItemBrowserPreviewCss;

const arcgisItemBrowserPreviewCopyCss = ".heading{font-weight:500;font-size:0.75rem;color:var(--calcite-ui-text-3);padding-bottom:0.25rem;padding-top:0;margin-top:1rem;margin-bottom:0;--calcite-label-margin-bottom:0}.label{padding-bottom:0}.input{--calcite-ui-background:var(--calcite-ui-foreground-1)}.action{position:relative}.tooltip{position:absolute;opacity:0;transition-property:background-color, border-color, color, fill, stroke, opacity, box-shadow, transform;transition-duration:150ms;padding-top:0.5rem;padding-bottom:0.5rem;padding-left:0.75rem;padding-right:0.75rem;border-radius:var(--calcite-border-radius);font-size:0.75rem;color:var(--calcite-ui-text-1);font-weight:500;background-color:var(--calcite-ui-foreground-1);box-shadow:0 4px 8px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -1px rgba(0, 0, 0, 0.04);white-space:nowrap;transform:translateY(-8px);top:calc(100% + 4px);inset-inline-end:0;width:auto;border:1px solid var(--calcite-ui-border-3);line-height:1.375}.button:hover+.tooltip,.button:focus+.tooltip{opacity:1;transform:translateY(0)}";

const ArcgisItemBrowserPreview = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserInternalUIAction = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserInternalUIAction", 7);
    this.heading = undefined;
    this.text = undefined;
    this.copied = false;
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.copy;
  }
  async handleCopy(text) {
    navigator.clipboard.writeText(text);
    this.copied = true;
    const isSublayer = this.el.parentElement.classList.contains("sublayer__content");
    this.arcgisItemBrowserInternalUIAction.emit({
      action: "copy",
      category: "panel action",
      details: isSublayer ? "layers" : "details"
    });
    await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_2__.t)(10000);
    this.copied = false;
  }
  render() {
    const { heading, text, i18n } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "label", scale: "s" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "heading" }, heading), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { value: text, readOnly: true, alignment: "start", type: "text", label: heading, scale: "s", class: "input" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "action", class: "action" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: "button", slot: "action", iconStart: "copy-to-clipboard", id: "copy-button", kind: "neutral", scale: "s", onClick: () => this.handleCopy(text), onMouseOut: async () => {
        await (0,_functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_2__.t)(200);
        this.copied = false;
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "tooltip" }, this.copied ? i18n === null || i18n === void 0 ? void 0 : i18n.copied : i18n === null || i18n === void 0 ? void 0 : i18n.copy))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserPreview.style = arcgisItemBrowserPreviewCopyCss;

const ArcgisItemBrowserPreviewFieldDetails = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.field = undefined;
    this.item = undefined;
    this.sublayer = undefined;
    this.showFieldStatistics = undefined;
    this.api = 4;
    this.layer = undefined;
  }
  async getFieldData() {
    if (!this.layer) {
      const [FeatureLayer] = await (0,_loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_19__.l)(["esri/layers/FeatureLayer"]);
      const layer = new FeatureLayer({
        // Notice that the url doesn't end with /2
        url: this.item.url,
        layerId: this.sublayer.id
      });
      await layer.load();
      this.layer = layer;
    }
  }
  render() {
    const { field, showFieldStatistics, api } = this;
    if (!field) {
      return null;
    }
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { heading: field.alias || field.name, description: field.name, headingLevel: 5, collapsible: showFieldStatistics && api === 4 && this.item.type === "Feature Service", onCalciteBlockToggle: () => {
        this.getFieldData();
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { slot: "icon", icon: _type_to_icon_5b71edbc_js__WEBPACK_IMPORTED_MODULE_25__.f[field.type] || "string", scale: "s", class: "layer-icon" }), !!this.layer && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-field-info", { layer: this.layer, fieldName: field.name }))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserSearch = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserSearch = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserSearch", 7);
    this.arcgisItemBrowserSearchInput = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserSearchInput", 7);
    this.term = undefined;
    this.placeholder = undefined;
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
  }
  render() {
    var _a, _b;
    const { term, placeholder } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, ((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket) !== "subscription content" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-search", { term: term, placeholder: placeholder, onArcgisBrowserSearch: (e) => this.arcgisItemBrowserSearch.emit(e.detail), onArcgisBrowserSearchInput: (e) => this.arcgisItemBrowserSearchInput.emit(e.detail) }))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const defaultSortOrders = {
  my: {
    sortField: "modified",
    sortOrder: "desc"
  },
  favorites: {
    sortField: "modified",
    sortOrder: "desc"
  },
  group: {
    sortField: "modified",
    sortOrder: "desc"
  },
  org: {
    sortField: "modified",
    sortOrder: "desc"
  },
  "subscription content": {
    sortField: "relevance",
    sortOrder: "asc"
  },
  "living atlas": {
    sortField: "relevance",
    sortOrder: "asc"
  },
  "living atlas analysis": {
    sortField: "relevance",
    sortOrder: "asc"
  },
  all: {
    sortField: "relevance",
    sortOrder: "asc"
  }
};

const ArcgisItemBrowserSort$1 = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserSort = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserSort", 7);
    this.options = ["title", "relevance", "modified"];
    this.field = undefined;
    this.order = undefined;
    this.activeField = undefined;
    this.activeOrder = undefined;
    this.userSetSort = undefined;
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    const { field, options } = this;
    if (!field) {
      const bucketSort = this.store.state.bucket && defaultSortOrders[this.store.state.bucket];
      this.activeField = bucketSort ? bucketSort.sortField : (options === null || options === void 0 ? void 0 : options[0]) || "relevance";
      this.activeOrder = (0,_utils_b22dfe9c_js__WEBPACK_IMPORTED_MODULE_26__.a)(this.activeField);
    }
    else {
      this.userSetSort = true;
      this.activeField = field;
      this.activeOrder = this.order || (0,_utils_b22dfe9c_js__WEBPACK_IMPORTED_MODULE_26__.a)(field);
    }
    onItemBrowserBucketChange(this.store, (bucket) => {
      const defaultSort = defaultSortOrders[bucket];
      if (defaultSort) {
        this.updateSortField(defaultSort.sortField);
      }
    });
    onItemBrowserSortChange(this.store, (sort) => {
      this.activeField = sort.sortField;
      this.activeOrder = sort.sortOrder;
    });
  }
  componentDidLoad() {
    this.arcgisItemBrowserSort.emit({
      sortField: this.field || this.activeField,
      sortOrder: this.order || (this.field ? (0,_utils_b22dfe9c_js__WEBPACK_IMPORTED_MODULE_26__.a)(this.field) : this.activeOrder)
    });
  }
  updateSortField(field) {
    this.activeField = field;
    this.activeOrder = (0,_utils_b22dfe9c_js__WEBPACK_IMPORTED_MODULE_26__.a)(field);
    this.arcgisItemBrowserSort.emit({
      sortField: this.activeField,
      sortOrder: this.activeOrder
    });
  }
  updateSortOrder(order) {
    this.activeOrder = order;
    this.arcgisItemBrowserSort.emit({
      sortField: this.activeField,
      sortOrder: this.activeOrder
    });
  }
  render() {
    var _a, _b;
    const { activeField, activeOrder, field, order, options } = this;
    const selectedField = activeField || (options.includes(field) ? field : options[0]);
    const selectedOrder = activeOrder || order;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, ((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket) !== "subscription content" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-sort", { store: this.store, field: selectedField, order: selectedOrder, options: options, onArcgisBrowserSortFieldChange: (e) => this.updateSortField(e.detail), onArcgisBrowserSortOrderChange: (e) => this.updateSortOrder(e.detail) }))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const COLUMNS = {
  title: {
    width: "minmax(0, 7fr)"
  },
  type: {
    width: "minmax(0, 5fr)",
    hidden: true
  },
  modified: {
    width: "7.5rem"
  },
  badges: {
    width: "6.5rem",
    hidden: true
  },
  owner: {
    width: "minmax(0, 3fr)"
  },
  sharing: {
    width: "6rem",
    hidden: true
  },
  size: {
    width: "minmax(0, 2fr)"
  },
  deleted: {
    width: "minmax(0, 2fr)"
  },
  details: {
    width: "8rem",
    hidden: true
  },
  favorite: {
    width: "3.5rem",
    hidden: true
  },
  actions: {
    width: "3.5rem",
    hidden: true
  }
};

const arcgisItemBrowserTableCss = ".table{background-color:var(--calcite-ui-foreground-1)}.header{display:grid;grid-template-columns:var(--item-browser-table-columns)}.button__text--sorted{font-weight:500}.column-header{border-bottom:1px solid var(--calcite-ui-border-2);margin-bottom:1px}.column-header--sorted{border-bottom-color:var(--calcite-ui-brand)}.screen-reader-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}";

const ArcgisItemBrowserTable$1 = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserColumnUpdate = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserColumnUpdate", 7);
    this.arcgisItemBrowserSort = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserSort", 7);
    this.rows = [];
    this.columns = [
      "title",
      "type",
      "modified",
      "badges",
      "owner",
      "sharing",
      "details",
      "actions"
    ];
    this.activeFocus = [0, 0];
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.table;
    onItemBrowserPreviewChange(this.store, (preview) => {
      // when the preview is closed, restore focus to the grid
      if (!preview && this.store.state.activeFocus) {
        const [row, column] = this.store.state.activeFocus;
        this.updateRows();
        const rowElement = this.rows[row];
        rowElement === null || rowElement === void 0 ? void 0 : rowElement.focusColumn(column);
      }
    });
  }
  async componentDidLoad() {
    this.arcgisItemBrowserColumnUpdate.emit(this.columns);
  }
  updateColumns(columns) {
    this.arcgisItemBrowserColumnUpdate.emit(columns);
  }
  async attemptMove([row, column], direction) {
    const rowElement = this.rows[row];
    if (await rowElement.canFocusColumn(column)) {
      this.store.state.activeFocus = [row, column];
      requestAnimationFrame(() => rowElement.focusColumn(column));
    }
    else {
      switch (direction) {
        case "right":
          return this.moveRight([row, column]);
        case "left":
          return this.moveLeft([row, column]);
        case "up":
          return this.moveUp([row, column]);
        case "down":
          return this.moveDown([row, column]);
      }
    }
  }
  updateRows() {
    this.rows = this.rowSlot.assignedElements();
  }
  getLastColumnIndex() {
    const isMultiSelect = this.store.state.selection === "multiple";
    return this.columns.length - (isMultiSelect ? 0 : 1);
  }
  getLastRowIndex() {
    return this.rows.length - 1;
  }
  async moveRight([row, currentColumn]) {
    const desiredColumn = currentColumn >= this.getLastColumnIndex() ? 0 : currentColumn + 1;
    this.attemptMove([row, desiredColumn], "right");
  }
  async moveLeft([row, currentColumn]) {
    const desiredColumn = currentColumn < 1 ? this.getLastColumnIndex() : currentColumn - 1;
    this.attemptMove([row, desiredColumn], "left");
  }
  async moveUp([currentRow, column]) {
    const desiredRow = currentRow < 1 ? this.getLastRowIndex() : currentRow - 1;
    this.attemptMove([desiredRow, column], "up");
  }
  async moveDown([currentRow, column]) {
    const desiredRow = currentRow + 1 > this.getLastRowIndex() ? 0 : currentRow + 1;
    this.attemptMove([desiredRow, column], "down");
  }
  handleKeyboard(e) {
    const { key } = e;
    const current = this.store.state.activeFocus || [0, 0];
    this.updateRows();
    switch (key) {
      case "ArrowDown":
        e.preventDefault();
        return this.moveDown(current);
      case "ArrowUp":
        e.preventDefault();
        return this.moveUp(current);
      case "ArrowLeft":
        e.preventDefault();
        return this.moveLeft(current);
      case "ArrowRight":
        e.preventDefault();
        return this.moveRight(current);
    }
  }
  renderColumn(id) {
    const label = this.i18n.headers[id];
    const { hidden } = COLUMNS[id];
    const { sortField, sortOrder } = this.store.state.sort || {};
    const isSorted = sortField === id;
    return hidden ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { role: "columnheader", class: "column-header" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "screen-reader-only" }, label))) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: { "column-header": true, "column-header--sorted": isSorted } }, !!(id === "title" && this.store.state.selection === "multiple") && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { role: "columnheader", class: "screen-reader-only" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, this.i18n.selection))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { role: "columnheader", "aria-sort": sortOrder === "asc" ? "ascending" : "descending" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { width: "full", alignment: "icon-end-space-between", tabindex: "-1", scale: "m", appearance: "transparent", kind: isSorted ? "brand" : "neutral", "icon-end": isSorted && sortOrder === "asc" ? "caret-up" : "caret-down", onClick: () => {
        // if we are already sorting on this field, flip it
        if (isSorted) {
          this.arcgisItemBrowserSort.emit({
            sortField,
            sortOrder: sortOrder === "asc" ? "desc" : "asc"
          });
        }
        else {
          this.arcgisItemBrowserSort.emit({
            sortField: id,
            sortOrder: (0,_utils_b22dfe9c_js__WEBPACK_IMPORTED_MODULE_26__.a)(id)
          });
        }
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: { button__text: true, "button__text--sorted": isSorted } }, label)))));
  }
  render() {
    const isMultiSelect = this.store.state.selection === "multiple";
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { style: {
        "--item-browser-table-columns": `${this.columns.map((id) => COLUMNS[id].width).join(" ")}`
      } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", Object.assign({ class: "table", "aria-label": "Table with selection", role: "grid", "aria-readonly": "true" }, (isMultiSelect ? { "aria-multiselectable": "true" } : {}), { onKeyDown: (e) => this.handleKeyboard(e) }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { role: "rowgroup" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { role: "row", class: "header" }, this.columns.map((id) => this.renderColumn(id)))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { ref: (el) => (this.rowSlot = el) })))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "columns": ["updateColumns"]
  }; }
};
ArcgisItemBrowserTable$1.style = arcgisItemBrowserTableCss;

const arcgisItemBrowserTableRowCss = ":host{display:block;--item-browser-table-row-active-background:#bbd5fa26}.row{display:grid;background-color:var(--calcite-ui-foreground-1);grid-template-columns:var(--item-browser-table-columns);border:1px solid var(--calcite-ui-foreground-1);border-top:1px solid var(--calcite-ui-border-2);margin-top:-1px}.row--first{border-top-color:var(--calcite-ui-foreground-1)}.row--selected{position:relative;border-color:var(--calcite-ui-brand);background-color:var(--item-browser-table-row-active-background)}.row--selected-last{border-top-color:var(--item-browser-table-row-active-background)}.cell{padding-left:0.75rem;padding-right:0.75rem;padding-top:0.5rem;padding-bottom:0.5rem;font-size:0.875rem;color:var(--calcite-ui-text-1);display:flex;align-items:center;justify-content:flex-start;outline-color:transparent;line-height:1.35}.cell:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:-2px}.cell--narrow{-webkit-padding-start:0.5rem;padding-inline-start:0.5rem}.cell--overflow{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-wrap:break-word;overflow-wrap:break-word}.checkbox-wrap{display:flex}.checkbox__title{flex:1 1 0%}.user-popup{width:100%}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.button{border:1px solid var(--calcite-ui-foreground-3);font-family:inherit;background-color:var(--calcite-ui-foreground-1);transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;padding-left:0.75rem;padding-right:0.75rem;padding-top:0.5rem;padding-bottom:0.5rem;outline-color:transparent;height:2rem;box-sizing:border-box;cursor:pointer;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:flex;align-items:center;color:var(--calcite-ui-text-1);text-decoration:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:100%}.button:hover{box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3)}.button:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:2px}.button--transparent{border:1px solid transparent;background:transparent;padding-left:0.5rem;padding-right:0.5rem}.button--transparent:hover{background-color:var(--calcite-ui-foreground-2);box-shadow:none}";

const ArcgisItemBrowserTable = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserColumnUpdate = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserColumnUpdate", 7);
    this.arcgisItemBrowserCardSelect = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserCardSelect", 7);
    this.arcgisItemBrowserCardPreview = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserCardPreview", 7);
    var _a;
    this.columnRefs = {};
    this.item = undefined;
    this.portal = undefined;
    this.index = undefined;
    this.user = undefined;
    this.api = 4;
    this.baseUrl = (_a = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.config) === null || _a === void 0 ? void 0 : _a.baseUrl;
    this.link = undefined;
    this.newTab = undefined;
    this.name = undefined;
    this.preview = undefined;
    this.showItemType = true;
    this.showBadges = true;
    this.showSharing = true;
    this.actions = [];
    this.hasMouse = undefined;
    this.mouseOverColumn = undefined;
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.tableRow;
  }
  async canFocusColumn(index) {
    var _a;
    const columns = this.store.state.columns || [];
    const adjustedIndex = this.getColumnNumber(index);
    const id = columns[adjustedIndex];
    // only allow tabbing to the badges if there are badges displayed
    if (id === "badges") {
      return !this.badges.empty;
    }
    return !!((_a = this.columnRefs[id]) === null || _a === void 0 ? void 0 : _a.method) || adjustedIndex < 0;
  }
  async focusColumn(column) {
    var _a;
    let adjustedColumn = column;
    // selectable tables have the checkbox and title in a single column
    // offset the column number to allow movement as if they were separate columns
    if (this.store.state.selection === "multiple") {
      if (column === 0) {
        (_a = this.checkbox) === null || _a === void 0 ? void 0 : _a.setFocus();
        return;
      }
      adjustedColumn = column - 1;
    }
    const { el, method } = this.columnRefs[this.store.state.columns[adjustedColumn]] || {};
    el[method]();
  }
  getColumnNumber(column) {
    if (this.store.state.selection === "multiple") {
      return column - 1;
    }
    return column;
  }
  isSimpleColumn(id) {
    return !["owner", "details", "favorite", "actions"].includes(id);
  }
  onClick(cb) {
    return {
      onClick: () => {
        cb();
      },
      onKeyDown: (e) => {
        if (e.key === "Enter" || e.key === " ") {
          cb();
        }
      }
    };
  }
  renderTitle(selected) {
    var _a, _b, _c, _d;
    const { item } = this;
    const activeColumn = (_b = (_a = this.store.state.activeFocus) === null || _a === void 0 ? void 0 : _a[1]) !== null && _b !== void 0 ? _b : 0;
    const rowHasFocus = ((_d = (_c = this.store.state.activeFocus) === null || _c === void 0 ? void 0 : _c[0]) !== null && _d !== void 0 ? _d : 0) === this.index;
    const columnHasFocus = activeColumn < 2;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "checkbox-wrap", onMouseOver: () => {
        this.mouseOverColumn = 0;
      }, key: "title" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { role: "gridcell", class: "cell" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", Object.assign({}, ((rowHasFocus && columnHasFocus) || (this.hasMouse && this.mouseOverColumn === 0)
      ? {}
      : { inert: true }), { class: "checkbox", checked: selected, ref: (el) => {
        this.checkbox = el;
      }, onClick: (e) => {
        e.stopPropagation();
        this.store.state.activeFocus = [this.index, 0];
      }, onCalciteCheckboxChange: () => {
        this.arcgisItemBrowserCardSelect.emit({ item, selected: !selected });
      }, value: item.id }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "screen-readers-only" }, item.title))), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", Object.assign({ onMouseOver: () => {
        this.mouseOverColumn = 0;
      }, role: "gridcell", class: "cell cell--narrow checkbox__title", id: `row-${item.id}`, tabindex: activeColumn === 1 && rowHasFocus ? 0 : -1 }, this.onClick(() => {
      if (this.preview === "title") {
        this.arcgisItemBrowserCardPreview.emit(item);
      }
      this.store.state.activeFocus = [this.index, 1];
    }), { ref: (el) => {
        this.columnRefs.title = { el, method: "focus" };
      } }), this.item.title)));
  }
  renderColumn(id, columnIndex, selected) {
    var _a, _b, _c, _d;
    const { item, api, portal, baseUrl, user } = this;
    const activeColumn = (_b = (_a = this.store.state.activeFocus) === null || _a === void 0 ? void 0 : _a[1]) !== null && _b !== void 0 ? _b : 0;
    const isSimpleColumn = this.isSimpleColumn(id);
    const rowHasFocus = ((_d = (_c = this.store.state.activeFocus) === null || _c === void 0 ? void 0 : _c[0]) !== null && _d !== void 0 ? _d : 0) === this.index;
    const columnHasFocus = columnIndex === this.getColumnNumber(activeColumn);
    if (id === "title" && this.store.state.selection === "multiple") {
      return this.renderTitle(selected);
    }
    const tab = { tabIndex: columnHasFocus && rowHasFocus ? 0 : -1 };
    const truncate = ["owner"].includes(id);
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", Object.assign({ key: id }, (isSimpleColumn ? tab : {}), { role: "gridcell", class: { cell: true, "cell--overflow": truncate }, ref: (el) => {
        if (isSimpleColumn) {
          this.columnRefs[id] = { el, method: "focus" };
        }
      },
      // on click, set the active focus coordinates to that cell
      onClick: () => {
        setTimeout(() => {
          const column = this.store.state.selection === "multiple" ? columnIndex + 1 : columnIndex;
          if (!columnHasFocus || !rowHasFocus) {
            this.store.state.activeFocus = [this.index, column];
          }
        }, 100);
      }, onMouseOver: () => {
        this.mouseOverColumn = columnIndex;
      } }), id === "title" && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, this.item.title), id === "type" && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-type", { item: item, portal: this.portal, scale: "m" }), id === "modified" && (0,_languageUtil_22258c90_js__WEBPACK_IMPORTED_MODULE_12__.a)(item.modified), id === "badges" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-badges", { ref: (el) => (this.badges = el), showTooltips: true, item: item, width: "narrow", scale: "s", tabIndex: -1 })), id === "sharing" && (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-share-summary", { showText: false, item: item, scale: "s" }), id === "owner" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-user-popup", { item: item, underline: true, api: api, portal: portal, baseUrl: baseUrl, scale: "m", class: "user-popup", showAvatar: false, ref: (el) => {
        this.columnRefs.owner = { el, method: "setFocus" };
      }, tabIndex: -1 })), id === "details" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", Object.assign({}, tab, { href: `${this.baseUrl}/item.html?id=${item.id}`, target: "_blank", class: "button", ref: (el) => {
        this.columnRefs.details = { el, method: "focus" };
      } }), this.i18n.details)), id === "favorite" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-favorite", { item: item, portal: portal, user: user || (_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user), iconOnly: true, ref: (el) => {
        this.columnRefs.favorite = { el, method: "setFocus" };
      }, tabIndex: -1 })), id === "actions" && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, this.actions.length > 0 && ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown", { placement: "bottom-end", scale: "m", overlayPositioning: "fixed" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", Object.assign({}, tab, { class: "button button--transparent", "aria-label": this.i18n.moreOptions, slot: "trigger", ref: (el) => {
        this.columnRefs.actions = { el, method: "focus" };
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "ellipsis", scale: "s" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { selectionMode: "none", onKeyDown: (e) => {
        e.stopPropagation();
      } }, this.actions.map(({ text, newTab, link, action }) => ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", Object.assign({ onClick: (e) => {
        if (action) {
          e.preventDefault();
          action();
        }
      }, key: text }, (!action && link
      ? Object.assign(Object.assign({}, (newTab ? { target: "_blank", rel: "noopener noreferrer" } : {})), { href: link }) : {})), text))))))))));
  }
  render() {
    var _a, _b;
    const columns = this.store.state.columns || [];
    const { item } = this;
    const selection = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state.selection;
    const itemSelection = ["single", "multiple"].includes(selection);
    const selected = itemSelection && isSelected({ item, selectedItems: (_b = this.store) === null || _b === void 0 ? void 0 : _b.state.selectedItems });
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, Object.assign({}, (selected ? { "data-selected": true } : {}), { onMouseOver: () => {
        this.hasMouse = true;
      }, onMouseOut: () => {
        this.hasMouse = false;
      } }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", Object.assign({ class: {
        row: true,
        "row--selected": selected,
        "row--first": this.index === 0
      }, role: "row" }, (selected ? { ariaSelected: true } : {}), { "aria-labelledby": `row-${item.id}` }), columns.map((id, i) => this.renderColumn(id, i, selected)))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserTable.style = arcgisItemBrowserTableRowCss;

const ArcgisItemBrowserTopBar = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
  }
  render() {
    var _a, _b;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-top-bar", { store: this.store, filtersDisabled: ((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket) === "subscription content" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-start" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content-start" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "bucket" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "bucket" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "search" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "search" })), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-end" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content-end" })))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserSort = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.arcgisItemBrowserView = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserView", 7);
    this.options = ["grid", "list"];
    this.view = undefined;
  }
  async componentWillLoad() {
    this.store = getItemBrowserStore(this.el);
    this.i18n = this.store.state.i18n.view;
    const { view } = this;
    if (!view) {
      this.view = this.store.state.view || "list";
    }
    onItemBrowserViewChange(this.store, (newView) => {
      this.view = newView;
    });
  }
  syncStore(newView) {
    this.store.state.view = newView;
  }
  componentDidLoad() {
    this.arcgisItemBrowserView.emit(this.view);
  }
  renderOption(option) {
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { key: option, selected: option === this.view, onCalciteDropdownItemSelect: () => this.arcgisItemBrowserView.emit(option), iconStart: option }, this.i18n[option]));
  }
  render() {
    const { options, view, i18n } = this;
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown", { placement: "bottom-end", scale: "m", overlayPositioning: "fixed", width: "s" }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: "button", slot: "trigger", scale: "m", appearance: "outline-fill", kind: "neutral", iconStart: view, iconFlipRtl: "start", "aria-label": `${i18n.view}: ${i18n[view]}` }, i18n[view]), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { selectionMode: "single" }, options.map((option) => this.renderOption(option))))));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
  static get watchers() { return {
    "view": ["syncStore"]
  }; }
};




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/badges-c3f03cc3.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/badges-c3f03cc3.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getTooltip),
/* harmony export */   g: () => (/* binding */ getBadges)
/* harmony export */ });
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/* harmony import */ var _user_ba12ebd6_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./user-ba12ebd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-ba12ebd6.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




const retiredUrlParts = [
  "3DInsetMap",
  "3DScene",
  "3DViz",
  "AttachmentViewer",
  "CapacityAnalysis",
  "Compare/storytelling_compare",
  "Compare/storytelling_tabbed",
  "Compare/storytelling_sidepanel",
  "Compare/Multiviewer",
  "Compare/Search",
  "Compare/Configure",
  "Compare/SideBySideViewer_Configure",
  "Compare3d",
  "CompareAnalysis",
  "CompareMaps",
  "Directions",
  "Edit",
  "Editor",
  "Elevations",
  "ElevationsProfile",
  "Embed",
  "Filter",
  "FilterGallery",
  "GeoList",
  "GeoTour",
  "HeaderFooter",
  "Identify",
  "ImageInterpretation",
  "ImageryViewer",
  "ImpactSummary",
  "InformationLookup",
  "InteractiveFilter",
  "InteractiveLegend",
  "LayerShowcase",
  "Legend",
  "LiveMaps",
  "LocalPerspective",
  "MapAndAppGallery",
  "MapCarousel",
  "MapTools",
  "Media",
  "MinimalGallery",
  "Minimalist",
  "Nearby",
  "OnePane",
  "Panels",
  "PanelsLegend",
  "Profile",
  "PublicGallery",
  "PublicInformation",
  "ServiceLookup",
  "SimpleMapViewer",
  "SimpleViewer",
  "SocialMedia",
  "Solutions/s2.html?app=apps2/FindEditFilter",
  "Solutions/s2.html?app=apps2/Finder",
  "StorytellingTextLegend",
  "StoryMapBasic",
  "Styler",
  "SummaryViewer",
  "Time",
  "TimeAware",
  "TwoPane",
  "Viewer",
  "ZoneLookup"
];

function isRetiredItemType(type) {
  return _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_1__.r.includes(type);
}
function isRetiredStoryMap(item) {
  var _a, _b;
  return ((_a = item.portal) === null || _a === void 0 ? void 0 : _a.isPortal) && item.type === "Web Mapping Application" && ((_b = item.typeKeywords) === null || _b === void 0 ? void 0 : _b.includes("Story Map"));
}
function isCityEngineWebScene(item) {
  return item.type === "CityEngine Web Scene";
}
function isRetiredApp(item) {
  var _a;
  const isRetiredUrl = retiredUrlParts.some((urlPart) => {
    var _a;
    const containsHtml = urlPart.includes(".html");
    const fullRetiredPath = `/apps/${urlPart}${!containsHtml ? "/" : ""}`;
    return (_a = item.url) === null || _a === void 0 ? void 0 : _a.includes(fullRetiredPath);
  });
  return ((_a = item.portal) === null || _a === void 0 ? void 0 : _a.isPortal) && item.type === "Web Mapping Application" && item.url && isRetiredUrl;
}
function isOrgAuthoritative(item) {
  return item.contentStatus === "org_authoritative";
}
function isPublicAuthoritative(item) {
  return item.contentStatus === "public_authoritative";
}
function getBadges(item, portal, user) {
  var _a, _b, _c;
  const badges = [];
  const groupDesignations = item.groupDesignations && item.groupDesignations.split(", ");
  if (isOrgAuthoritative(item) || isPublicAuthoritative(item)) {
    badges.push("Authoritative");
  }
  if (item.contentStatus === "deprecated") {
    badges.push("Deprecated");
  }
  if (item.type === "Solution" && ((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("ArcGIS Solution"))) {
    badges.push("Solution");
  }
  if (((_b = item.typeKeywords) === null || _b === void 0 ? void 0 : _b.includes("Public Data Collection")) && user) {
    badges.push("Public Data Collection");
  }
  if (isRetiredItemType(item.type) || isRetiredStoryMap(item) || isRetiredApp(item)) {
    badges.push("Retired");
  }
  if (groupDesignations === null || groupDesignations === void 0 ? void 0 : groupDesignations.includes("livingatlas")) {
    badges.push("Living Atlas");
  }
  if (groupDesignations && groupDesignations.includes("opendata")) {
    badges.push("Open Data");
  }
  if ((0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_0__.b)(item)) {
    badges.push("Premium");
  }
  if ((0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_0__.a)(item)) {
    badges.push("Subscriber");
  }
  if (item.origin) {
    badges.push("Collaboration");
  }
  if (item.listed && !(portal === null || portal === void 0 ? void 0 : portal.isPortal)) {
    badges.push("Marketplace");
  }
  if (((_c = item.typeKeywords) === null || _c === void 0 ? void 0 : _c.includes("Registered App")) &&
    item.type !== "API Key" &&
    (!(portal === null || portal === void 0 ? void 0 : portal.isPortal) || item.owner !== "esri_apps")) {
    badges.push("Registered");
  }
  return badges;
}
async function getTooltip(badgeType, item, user, i18n, locale) {
  var _a, _b;
  const publicUser = !user || (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_0__.n)(user);
  switch (badgeType) {
    case "Authoritative":
      if (item.contentStatus === "public_authoritative") {
        const verified = await (0,_user_ba12ebd6_js__WEBPACK_IMPORTED_MODULE_2__.b)(item, locale);
        const name = ((_a = item.portal) === null || _a === void 0 ? void 0 : _a.isPortal) ? (_b = item.portal) === null || _b === void 0 ? void 0 : _b.name : verified === null || verified === void 0 ? void 0 : verified.name;
        return i18n.Authoritative.tooltip.public.replace("${name}", name);
      }
      else {
        return i18n.Authoritative.tooltip.org;
      }
    case "Retired":
      const retired = i18n.Retired.tooltip;
      if (isRetiredStoryMap(item)) {
        return retired.storyMap;
      }
      else if (isCityEngineWebScene(item)) {
        return retired.cityEngine;
      }
      else if (isRetiredApp(item)) {
        return retired.app;
      }
      else {
        return retired.general;
      }
    case "Subscriber":
      return publicUser ? i18n.Subscriber.tooltip.public : i18n.Subscriber.tooltip.org;
    case "Premium":
      return publicUser ? i18n.Premium.tooltip.public : i18n.Premium.tooltip.org;
    case "Registered":
      return i18n.Registered.tooltip;
    default:
      return i18n[badgeType].tooltip;
  }
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-eeb03e5a.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-eeb03e5a.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ fetchLivingAtlasCategories),
/* harmony export */   b: () => (/* binding */ fetchGroupCategories),
/* harmony export */   f: () => (/* binding */ fetchCategories)
/* harmony export */ });
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




async function fetchCategories(portal, user) {
  portal !== null && portal !== void 0 ? portal : (portal = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
  user !== null && user !== void 0 ? user : (user = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
  if (!(portal === null || portal === void 0 ? void 0 : portal.id) || (user && (0,_privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_2__.n)(user))) {
    return null;
  }
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}portals/${portal.id}/categorySchema`), "categorySchema", portal.id);
}
async function fetchGroupCategories(groupId, portal) {
  portal !== null && portal !== void 0 ? portal : (portal = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
  if (!groupId || !portal) {
    return null;
  }
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}community/groups/${groupId}/categorySchema`), "categorySchema", groupId);
}
async function fetchLivingAtlasSchema(portal) {
  var _a;
  const base = (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal);
  const self = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}portals/self`);
  const groupSearch = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}community/groups?q=${self.contentCategorySetsGroupQuery}`);
  const categoryGroup = (_a = groupSearch === null || groupSearch === void 0 ? void 0 : groupSearch.results) === null || _a === void 0 ? void 0 : _a[0];
  const schemaItemSearch = await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/groups/${categoryGroup.id}/search`, {
    q: "typekeywords: LivingAtlas"
  });
  const schemaItem = schemaItemSearch.results[0];
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/items/${schemaItem.id}/data`);
}
async function fetchLivingAtlasCategories(portal) {
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => fetchLivingAtlasSchema(portal), "categorySchema", "living-atlas");
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-f36193e9.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-f36193e9.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ sanitizeFileName),
/* harmony export */   f: () => (/* binding */ formatFileSize),
/* harmony export */   g: () => (/* binding */ getItemInfoByType),
/* harmony export */   s: () => (/* binding */ sanitizeFileInput),
/* harmony export */   v: () => (/* binding */ validateOverwriteFileName)
/* harmony export */ });
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/* harmony import */ var _guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./guid-4f4176ba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */



function sanitizeFileName(name, addGUID) {
  //TODO: add new param to spec file.
  const expression = /(?:\.([^.]+))?$/;
  const invalidTitleCharacters = /\.|-/g;
  let fileName = name.replace(/^.*(\\|\/|:)/, "");
  let extension = (fileName && expression.exec(fileName)[1] ? expression.exec(fileName)[1].toLowerCase() : "");
  let title = "";
  if (fileName.indexOf(".rft.") > -1) {
    const [name, suffix] = fileName.split(".rft.");
    extension = `rft.${suffix}`;
    title = name;
  }
  if (fileName && !title) {
    title = fileName.lastIndexOf(".") === -1 ? fileName : fileName.substring(0, fileName.lastIndexOf("."));
  }
  // Replace any invalid characters with an underscore
  title = title.replace(invalidTitleCharacters, "_");
  // Allow file upload of existing item's file name // currently used in append
  if (addGUID) {
    title = makeUniqueFileName(title);
    fileName = `${title}.${extension}`;
  }
  return { title, fileName, extension };
}
// Helper method that takes in a file & returns the cleaned up file name as is and in title form, and the detected file extension
function sanitizeFileInput(file, addGUID) {
  return sanitizeFileName(file.name, !!addGUID);
}
function makeUniqueFileName(name) {
  return `${name}_${(0,_guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_1__.g)()}`;
}
function validateOverwriteFileName(uploadedFileName, sourceFileName) {
  let fileName = uploadedFileName;
  const position = uploadedFileName.lastIndexOf("\\");
  if (position > -1) {
    fileName = fileName.substring(position + 1, fileName.length);
  }
  return fileName.replace(/\ /g, "_") === sourceFileName.replace(/\ /g, "_");
}
function getItemInfoByType(type) {
  if (_item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_0__.a[type]) {
    return _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_0__.a[type];
  }
  else {
    return _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_0__.a[Object.keys(_item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_0__.a).find((fileType) => _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_0__.a[fileType].type === type)];
  }
}
function formatFileSize(size) {
  if (!size) {
    return "0 B";
  }
  const i = Math.floor(Math.log(size) / Math.log(1024));
  const adjustedSize = Math.round(size / Math.pow(1024, i));
  const unit = ["B", "KB", "MB", "GB", "TB"][i];
  return `${adjustedSize} ${unit}`;
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ guid)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
function generateId(counts) {
  return counts
    .map((count) => {
    let out = "";
    for (let i = 0; i < count; i++) {
      out += (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
    }
    return out;
  })
    .join("-");
}
const guid = () => generateId([2, 1, 1, 1, 3]);




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/services-ce8cb0ef.js":
/*!**************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/services-ce8cb0ef.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ fetchLayer),
/* harmony export */   f: () => (/* binding */ fetchFeatureServiceInfo),
/* harmony export */   s: () => (/* binding */ setMatched)
/* harmony export */ });
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./url-f3b82cc7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-f3b82cc7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




function parseSublayer(sublayer, layers, isTable) {
  var _a, _b;
  return {
    description: sublayer.description,
    fieldAliases: (_a = sublayer.fields) === null || _a === void 0 ? void 0 : _a.map((field) => field.alias),
    fields: sublayer.fields,
    geometryType: isTable ? "table" : sublayer.geometryType,
    id: sublayer.id,
    title: sublayer.name,
    type: sublayer.type,
    matched: (_b = layers === null || layers === void 0 ? void 0 : layers.find((layer) => layer.id === sublayer.id)) === null || _b === void 0 ? void 0 : _b.matched
  };
}
function serverRequest(url, isSecure) {
  const { config } = _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c;
  const hosted = (0,_url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_2__.a)(url);
  const requestOptions = Object.assign(Object.assign({ useProxy: false, timeout: config.isMultiTenant === false ? 60000 : 5000, addSSL: hosted }, (isSecure ? {} : { addTokenManually: false })), { usePost: true, disableIdentityLookup: true });
  return (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, {}, requestOptions, "post");
}
function getErrorCode(error) {
  var _a, _b;
  return (error === null || error === void 0 ? void 0 : error.code) || ((_b = (_a = error === null || error === void 0 ? void 0 : error.details) === null || _a === void 0 ? void 0 : _a.raw) === null || _b === void 0 ? void 0 : _b.code);
}
function serviceDoesNotExist(error) {
  const code = getErrorCode(error);
  return [404, 500].includes(code) || (error === null || error === void 0 ? void 0 : error.message) === "Invalid URL";
}
function shouldRetryWithToken(isSecure, error) {
  const code = getErrorCode(error);
  return !isSecure && ((code === 499 && (error === null || error === void 0 ? void 0 : error.message) === "Token Required") || code === 403) && !!_config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
}
async function fetchLayer(portal, id, url, isSecure) {
  const errorResult = { error: { code: "unhandledError" } };
  try {
    try {
      const result = await serverRequest(`${url}/${id}`, isSecure);
      return { result };
    }
    catch (error) {
      if (shouldRetryWithToken(isSecure, error)) {
        return fetchLayer(portal, id, url, true);
      }
      if (serviceDoesNotExist(error)) {
        errorResult.error.code = "serviceNotExist";
      }
      return errorResult;
    }
  }
  catch (error) {
    return errorResult;
  }
}
function filterLayers(layers, matchedLayers, data, isTable) {
  var _a, _b;
  const hasTables = data === null || data === void 0 ? void 0 : data.tables;
  const hasDefinedDataLayers = ((_a = data === null || data === void 0 ? void 0 : data.layers) === null || _a === void 0 ? void 0 : _a.length) > 0 || hasTables;
  const ids = [...((data === null || data === void 0 ? void 0 : data.layers) || []).map((layer) => layer.id), ...(_b = ((data === null || data === void 0 ? void 0 : data.tables) || [])) === null || _b === void 0 ? void 0 : _b.map((table) => table.id)];
  // if data has defined layers, only use layers in data, not the whole service (WebGIS/arcgis-portal-app#39768)
  // if data has defined layers, but no defined tables, allow all tables through (WebGIS/arcgis-portal-app#40067)
  const sublayers = (layers || [])
    .filter(({ id, type }) => !hasDefinedDataLayers || (type === "Table" && !hasTables) || ids.includes(id))
    .map((layer) => parseSublayer(layer, matchedLayers, isTable));
  return sublayers;
}
async function fetchLayers({ serviceInfo, item, layers, isSecure, data }) {
  var _a, _b;
  const { url } = item;
  if (!((_a = serviceInfo.layers) === null || _a === void 0 ? void 0 : _a.length) && !((_b = serviceInfo.tables) === null || _b === void 0 ? void 0 : _b.length) && (serviceInfo === null || serviceInfo === void 0 ? void 0 : serviceInfo.fields)) {
    return { result: [parseSublayer(serviceInfo, layers)] };
  }
  try {
    const { layers: sublayers, tables } = await serverRequest(`${url}/layers`, isSecure);
    return {
      result: [...filterLayers(sublayers, layers, data), ...filterLayers(tables, layers, data, true)].sort((a, b) => a.id - b.id)
    };
  }
  catch (error) {
    return { error: { code: "unhandledError" } };
  }
}
function setMatched(sublayers, matchedLayers) {
  return sublayers.map((sublayer) => {
    var _a;
    return Object.assign(Object.assign({}, sublayer), { matched: (_a = matchedLayers === null || matchedLayers === void 0 ? void 0 : matchedLayers.find((layer) => layer.id === sublayer.id)) === null || _a === void 0 ? void 0 : _a.matched });
  });
}
async function fetchFeatureServiceInfo({ item, portal, layers, isSecure, data, retry }) {
  var _a;
  const errorResult = { error: { code: "unhandledError" } };
  try {
    if (!data && !retry) {
      try {
        const token = (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.h)(portal);
        const tokenParam = token ? `&token=${token}` : "";
        const url = `${(0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}content/items/${item.id}/data?f=json${tokenParam}`;
        // Use fetch instead of request to stop redirects (WebGIS/arcgis-portal-app#40164)
        const response = await fetch(url);
        const text = await response.text();
        if (text) {
          data = JSON.parse(text);
        }
        if (data === null || data === void 0 ? void 0 : data.error) {
          // Treat this expired account as if the service doesn't exist (WebGIS/arcgis-portal-app#40163)
          if (data.error.code === 403 && ((_a = data.error) === null || _a === void 0 ? void 0 : _a.messageCode) === "SB_0006") {
            errorResult.error.code = "serviceNotExist";
            return errorResult;
          }
        }
      }
      catch (error) {
        // if we can't get item data, just move on
        data = null;
      }
    }
    if (item.type === "Feature Collection") {
      if (data === null || data === void 0 ? void 0 : data.layers) {
        return {
          result: data.layers.map(({ layerDefinition }, id) => {
            var _a;
            return ({
              description: "",
              fields: layerDefinition.fields,
              fieldAliases: (_a = layerDefinition.fields) === null || _a === void 0 ? void 0 : _a.map((field) => field.alias),
              geometryType: layerDefinition.geometryType,
              type: layerDefinition.type,
              id,
              matched: false,
              title: layerDefinition.name
            });
          })
        };
      }
    }
    try {
      const { url } = item;
      const serviceInfo = await serverRequest(url, isSecure);
      return fetchLayers({
        serviceInfo,
        item,
        layers,
        isSecure,
        data
      });
    }
    catch (error) {
      if (shouldRetryWithToken(isSecure, error)) {
        return fetchFeatureServiceInfo({ item, portal, layers, data, isSecure: true });
      }
      if (serviceDoesNotExist(error)) {
        errorResult.error.code = "serviceNotExist";
      }
      return errorResult;
    }
  }
  catch (error) {
    return errorResult;
  }
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-0b7adfcd.js":
/*!***************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-0b7adfcd.js ***!
  \***************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getDefaultThumbnail),
/* harmony export */   b: () => (/* binding */ getAdjustedThumbnail),
/* harmony export */   g: () => (/* binding */ getItemThumbnail),
/* harmony export */   i: () => (/* binding */ isBlankImage)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./query-4f7b7e4d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-4f7b7e4d.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




function getItemThumbnail(portal, item, restBase, noToken) {
  restBase !== null && restBase !== void 0 ? restBase : (restBase = (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.g)(portal));
  const token = (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_1__.h)(portal);
  const tokenParam = token && !noToken ? `token=${token}` : "";
  const itemUrl = `${restBase}content/items/${item.id}`;
  if (item.thumbnail) {
    return `${itemUrl}/info/${item.thumbnail}?w=400${token ? "&" : ""}${tokenParam}`;
  }
  else if (item.type === "Image" && !noToken) {
    return `${itemUrl}/data?${tokenParam}`;
  }
  return getDefaultThumbnail(item);
}
/** This is just like getItemThumbnail but it will use an arcgis.com base in certain portal conditions */
async function getAdjustedThumbnail(portal, item, bucket) {
  if (await (0,_query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_2__.i)(portal, bucket)) {
    return getItemThumbnail(portal, item, "https://www.arcgis.com/sharing/rest/", true);
  }
  return getItemThumbnail(portal, item);
}
function getDefaultThumbnail(item) {
  var _a;
  const fileName = ((_a = item.type) === null || _a === void 0 ? void 0 : _a.toLowerCase()) !== "notebook" ? "default_thumb.png" : "notebook-thumb.png";
  return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.a)(`./assets/arcgis-item-browser-card-thumbnail/${fileName}`);
}
/**
 * Checks if the given image is blank.
 * Drawing the image on canvas, get the image data,
 * generate a hash and compare this against a known blank hash.
 */
function isBlankImage(image) {
  if (!image) {
    return true;
  }
  const canvas = document.createElement("canvas");
  const context = canvas.getContext("2d");
  canvas.height = image.naturalHeight;
  canvas.width = image.naturalWidth;
  context.fillStyle = "#ffffff";
  context.fillRect(0, 0, image.naturalWidth, image.naturalHeight);
  const blank = canvas.toDataURL("image/jpeg");
  context.drawImage(image, 0, 0);
  return blank === canvas.toDataURL("image/jpeg");
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/type-to-icon-5b71edbc.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/type-to-icon-5b71edbc.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ featureLayerIconInfo),
/* harmony export */   e: () => (/* binding */ esriGeometryIcons),
/* harmony export */   f: () => (/* binding */ fieldTypeIcons)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
const featureLayerIconInfo = {
  point: "point",
  line: "line",
  polygon: "polygon",
  multipatch: "cube",
  table: "table",
  multipoint: "layer-points"
};
const esriGeometryIcons = {
  esriGeometryPoint: "point",
  esriGeometryPolyline: "line",
  esriGeometryPolygon: "polygon",
  esriGeometryMultiPatch: "cube",
  esriGeometryMultipoint: "point",
  none: "table"
};
const fieldTypeIcons = {
  esriFieldTypeOID: "key",
  esriFieldTypeBoolean: "boolean",
  esriFieldTypeString: "string",
  esriFieldTypeSingle: "number",
  esriFieldTypeDouble: "number",
  esriFieldTypeInteger: "integer",
  esriFieldTypeSmallInteger: "integer",
  esriFieldTypeGlobalID: "key",
  esriFieldTypeDate: "date-time",
  esriFieldTypeBigInteger: "integer",
  esriFieldTypeDateOnly: "calendar",
  esriFieldTypeTimeOnly: "clock",
  esriFieldTypeTimestampOffset: "time-zone"
};




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-69e56978.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-69e56978.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getSublayerTypeInfo)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
/** Get the correct geometry icon based on layer/table type and geometry type
 * will handles types used by the jsapi, the esri types used on the server,
 * and the types returned by the Search API
 */
function getSublayerTypeInfo({ geometry, type }) {
  switch (type) {
    case "Catalog Layer":
      return {
        icon: "catalog-dataset",
        type: "catalog",
        isGeometry: false
      };
    case "Parcel Layer":
      return {
        icon: "parcel-layer",
        type: "parcel",
        isGeometry: false
      };
    case "Oriented Imagery Layer":
      return {
        icon: "oriented-imagery-layer",
        type: "oriented imagery",
        isGeometry: false
      };
    case "Table":
      return {
        icon: "table",
        type: "table",
        isGeometry: true
      };
  }
  switch (geometry) {
    case "point":
    case "esriGeometryPoint":
      return {
        type: "point",
        icon: "point",
        isGeometry: true
      };
    case "esriGeometryMultipoint":
    case "multipoint":
      return {
        type: "multipoint",
        icon: "layer-points",
        isGeometry: true
      };
    case "line":
    case "polyline":
    case "esriGeometryPolyline":
      return {
        type: "line",
        icon: "line",
        isGeometry: true
      };
    case "polygon":
    case "esriGeometryPolygon":
      return {
        type: "polygon",
        icon: "polygon",
        isGeometry: true
      };
    case "multipatch":
    case "esriGeometryMultiPatch":
      return {
        type: "multipatch",
        icon: "cube",
        isGeometry: true
      };
    default:
      return {
        type: "table",
        icon: "table",
        isGeometry: true
      };
  }
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWZjYjZhNi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUM0SDtBQUMvQztBQUNTO0FBQ2tCO0FBQzhGO0FBQ3BIO0FBQzNCO0FBQ2dFO0FBQ3ZDO0FBQzRCO0FBQ2pEO0FBQzBCO0FBQ0w7QUFDTztBQUM0RDtBQUNsQztBQUNXO0FBQzFDO0FBQzRDO0FBQ2pFO0FBQ0k7QUFDUjtBQUNIO0FBQ007QUFDRztBQUNFO0FBQ0Y7QUFDNUI7QUFDSTtBQUNQO0FBQ047QUFDUTtBQUNBO0FBQ047QUFDRDtBQUNJO0FBQ0o7QUFDQzs7QUFFNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQiw4QkFBOEI7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQiwrQkFBK0I7QUFDckQsMkRBQTJELDhCQUE4QjtBQUN6RjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QiwrQkFBK0I7QUFDdkQsOERBQThELDhCQUE4QjtBQUM1RjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQiwrQkFBK0I7QUFDckQ7QUFDQSw2QkFBNkIsaUJBQWlCO0FBQzlDLG9CQUFvQiwrQkFBK0I7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMscUJBQXFCO0FBQ3RELGtEQUFrRCxRQUFRLHlJQUF5STtBQUNuTTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVvQyIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1pdGVtLWJyb3dzZXJfMzEuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYmFkZ2VzLWMzZjAzY2MzLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2NhdGVnb3JpZXMtZWViMDNlNWEuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vZmlsZS1mMzYxOTNlOS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9ndWlkLTRmNDE3NmJhLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3NlcnZpY2VzLWNlOGNiMGVmLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3RodW1ibmFpbC0wYjdhZGZjZC5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS90eXBlLXRvLWljb24tNWI3MWVkYmMuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vdXRpbHMtNjllNTY5NzguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIEggYXMgSG9zdCwgZCBhcyBnZXRFbGVtZW50LCBGIGFzIEZyYWdtZW50IH0gZnJvbSAnLi9pbmRleC05MmViYjM5Ni5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbmZpZ1N0YXRlLCBvIGFzIG9uQ29uZmlnQ2hhbmdlIH0gZnJvbSAnLi9jb25maWctZWI1ZjdkYzIuanMnO1xuaW1wb3J0IHsgZCBhcyBkZWJvdW5jZSwgdCBhcyB0aW1lb3V0LCBtIGFzIG1pbkRlbGF5IH0gZnJvbSAnLi9mdW5jdGlvbmFsLWM4MmY1YWI5LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncywgYSBhcyBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UgfSBmcm9tICcuL2xvY2FsZS0xM2UwMGE3NS5qcyc7XG5pbXBvcnQgeyBkIGFzIGRlZmF1bHRHZW9tZXRyaWVzLCBxIGFzIHF1ZXJ5SXRlbXMsIGkgYXMgaXNQb3J0YWxWaWV3aW5nQXJjR0lTT25saW5lLCBnIGFzIGdldFRhZ3MsIGEgYXMgZ2V0SGlnaGxpZ2h0cywgYiBhcyBnZXRQcm92aXNpb25lZExpc3RpbmdzLCBmIGFzIGZldGNoUHJldmlld0l0ZW0gfSBmcm9tICcuL3F1ZXJ5LTRmN2I3ZTRkLmpzJztcbmltcG9ydCB7IGIgYXMgYnJlYWtwb2ludHMsIHMgYXMgc2V0dXBSZXNpemVPYnNlcnZlciB9IGZyb20gJy4vcmVzaXplLTU1ZDNjNTVjLmpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlU3RvcmUgfSBmcm9tICcuL2luZGV4LTgxZDU0OGI3LmpzJztcbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5LCBzIGFzIHNhbml0aXplSFRNTCwgZCBhcyBkZWNvZGVIVE1MRW50aXRpZXMgfSBmcm9tICcuL2RvbS0xM2Y1YjAwYy5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldFN0b3JlLCBhIGFzIG9uQnJvd3NlckZpbHRlclJlbW92ZSB9IGZyb20gJy4vc3RvcmUtZmYwNGJhMGEuanMnO1xuaW1wb3J0IHsgbiBhcyBpc1B1YmxpY1VzZXIsIGUgYXMgaXNPcmdBZG1pbiwgdyBhcyBjYW5NYW5hZ2VDb2xsYWJvcmF0aW9ucyB9IGZyb20gJy4vcHJpdmlsZWdlcy1jY2Q1ZjM3ZC5qcyc7XG5pbXBvcnQgeyBqIGFzIGdldFBvcnRhbFNldHRpbmdzIH0gZnJvbSAnLi9hcGktZjc5MzRjZDcuanMnO1xuaW1wb3J0IHsgbCBhcyBjYW5DcmVhdGVJdGVtcywgbiBhcyBjYW5SZWNlaXZlSXRlbXMgfSBmcm9tICcuL3ByaXZpbGVnZXMtMzU1OTBlYjQuanMnO1xuaW1wb3J0IHsgYSBhcyBmb3JtYXREYXRlLCBmIGFzIGZvcm1hdE51bWJlciB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLTIyMjU4YzkwLmpzJztcbmltcG9ydCB7IGYgYXMgZmV0Y2hGZWF0dXJlU2VydmljZUluZm8sIGEgYXMgZmV0Y2hMYXllciB9IGZyb20gJy4vc2VydmljZXMtY2U4Y2IwZWYuanMnO1xuaW1wb3J0IHsgZiBhcyBmcm9tQ2FjaGUsIGMgYXMgY2xlYXJDYWNoZSwgaiBhcyBpbkNhY2hlLCBrIGFzIGdldFBvcnRhbFJlc3RCYXNlVXJsLCByIGFzIHJlcXVlc3QsIGcgYXMgZ2V0UmVzdEJhc2VVcmwgfSBmcm9tICcuL3BvcnRhbC03OWNhYWVmZi5qcyc7XG5pbXBvcnQgeyBhIGFzIGdldERlZmF1bHRUaHVtYm5haWwsIGIgYXMgZ2V0QWRqdXN0ZWRUaHVtYm5haWwsIGkgYXMgaXNCbGFua0ltYWdlIH0gZnJvbSAnLi90aHVtYm5haWwtMGI3YWRmY2QuanMnO1xuaW1wb3J0IHsgYSBhcyBmZXRjaExpdmluZ0F0bGFzQ2F0ZWdvcmllcywgYiBhcyBmZXRjaEdyb3VwQ2F0ZWdvcmllcywgZiBhcyBmZXRjaENhdGVnb3JpZXMgfSBmcm9tICcuL2NhdGVnb3JpZXMtZWViMDNlNWEuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRGb2xkZXJzLCBhIGFzIGdldFNpZ25lZEluVXNlcnNHcm91cHMgfSBmcm9tICcuL3VzZXItZTNkZWRjNGEuanMnO1xuaW1wb3J0IHsgYSBhcyBpdGVtVHlwZU5hbWVzLCBkIGFzIGRlZmF1bHRJdGVtVHlwZXMsIGcgYXMgZ2V0SXRlbVR5cGVPcHRpb24sIGkgYXMgaXRlbVR5cGVPcHRpb25zIH0gZnJvbSAnLi9pdGVtcy02OTM0NjEzMS5qcyc7XG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1hYWYzMGJkNi5qcyc7XG5pbXBvcnQgeyBpIGFzIGlzRXNyaVdvcmxkR2VvY29kZXIgfSBmcm9tICcuL2dlb2NvZGUtN2ViN2MwZGYuanMnO1xuaW1wb3J0IHsgZiBhcyBmb3JtYXRGaWxlU2l6ZSB9IGZyb20gJy4vZmlsZS1mMzYxOTNlOS5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEJhZGdlcyB9IGZyb20gJy4vYmFkZ2VzLWMzZjAzY2MzLmpzJztcbmltcG9ydCB7IGEgYXMgZmV0Y2hJdGVtVXNlckluZm8gfSBmcm9tICcuL3VzZXItYmExMmViZDYuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRTdWJsYXllclR5cGVJbmZvIH0gZnJvbSAnLi91dGlscy02OWU1Njk3OC5qcyc7XG5pbXBvcnQgeyBmIGFzIGZpZWxkVHlwZUljb25zIH0gZnJvbSAnLi90eXBlLXRvLWljb24tNWI3MWVkYmMuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXREZWZhdWx0U29ydE9yZGVyIH0gZnJvbSAnLi91dGlscy1iMjJkZmU5Yy5qcyc7XG5pbXBvcnQgJy4vc2VydmVyLWl0ZW0tZjEyMTUzZTYuanMnO1xuaW1wb3J0ICcuL2l0ZW0tcHJvcGVydGllcy1lNjQxMmE5YS5qcyc7XG5pbXBvcnQgJy4vYWRkLWl0ZW0tOTdkNTc3YTkuanMnO1xuaW1wb3J0ICcuL3VpLWVjZjg2YmJhLmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTlmNjQ4YmVlLmpzJztcbmltcG9ydCAnLi9pdGVtLXR5cGVzLWI0ZmU4NmFkLmpzJztcbmltcG9ydCAnLi9pdGVtLWQ5ZDcwNDE2LmpzJztcbmltcG9ydCAnLi91cmwtZjNiODJjYzcuanMnO1xuaW1wb3J0ICcuL3N0b3JhZ2UtZDdmNTgyMmUuanMnO1xuaW1wb3J0ICcuL2Fncy02OGQ0YWUyMC5qcyc7XG5pbXBvcnQgJy4vZ3VpZC00ZjQxNzZiYS5qcyc7XG5cbi8qKlxuICogQ2hlY2sgaWYgaXRlbXMgYXJlIGJlaW5nIHN0b3JlZCB3aXRoIHN1YmxheWVyc1xuICovXG5mdW5jdGlvbiBpc1N1YmxheWVyKHNlbGVjdGVkSXRlbSkge1xuICBjb25zdCBlbnRyeSA9IHNlbGVjdGVkSXRlbTtcbiAgcmV0dXJuICEhKGVudHJ5Lml0ZW0gJiYgZW50cnkuc3VibGF5ZXIpO1xufVxuLyoqXG4gKiBHaXZlbiBhIHNlbGVjdGVkIGl0ZW0gZW50cnkgYW5kIGFuIGl0ZW0gKyBzdWJsYXllcixcbiAqIGRldGVybWluZSBpZiB0aGV5IHJlcHJlc2VudCB0aGUgc2FtZSBlbnRpdHlcbiAqL1xuZnVuY3Rpb24gaXNTYW1lSXRlbSh7IGl0ZW0sIHN1YmxheWVyLCBzZWxlY3RlZEl0ZW0gfSkge1xuICB2YXIgX2EsIF9iO1xuICBpZiAoaXNTdWJsYXllcihzZWxlY3RlZEl0ZW0pICYmIHN1YmxheWVyKSB7XG4gICAgcmV0dXJuIChpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0uaWQpID09PSAoKF9hID0gc2VsZWN0ZWRJdGVtLml0ZW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pZCkgJiYgc3VibGF5ZXIuaWQgPT09ICgoX2IgPSBzZWxlY3RlZEl0ZW0uc3VibGF5ZXIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5pZCk7XG4gIH1cbiAgZWxzZSB7XG4gICAgcmV0dXJuIChpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0uaWQpID09PSBzZWxlY3RlZEl0ZW0uaWQ7XG4gIH1cbn1cbi8qKlxuICogQ2hlY2sgaWYgYW4gaXRlbSBpcyBwcmVzZW50IGluIGEgc2V0IG9mIHNlbGVjdGVkIGl0ZW1zXG4gKi9cbmZ1bmN0aW9uIGlzU2VsZWN0ZWQoeyBpdGVtLCBzdWJsYXllciwgc2VsZWN0ZWRJdGVtcyB9KSB7XG4gIHJldHVybiBzZWxlY3RlZEl0ZW1zLnNvbWUoKHNlbGVjdGVkSXRlbSkgPT4gaXNTYW1lSXRlbSh7IGl0ZW0sIHN1YmxheWVyLCBzZWxlY3RlZEl0ZW0gfSkpO1xufVxuLyoqXG4gKiBGaWx0ZXIgb3V0IGFuIGl0ZW0gZnJvbSBhIHNldCBvZiBzZWxlY3RlZCBpdGVtc1xuICovXG5mdW5jdGlvbiBkZXNlbGVjdEl0ZW0oeyBpdGVtLCBzdWJsYXllciwgc2VsZWN0ZWRJdGVtcyB9KSB7XG4gIHJldHVybiBzZWxlY3RlZEl0ZW1zLmZpbHRlcigoc2VsZWN0ZWRJdGVtKSA9PiAhaXNTYW1lSXRlbSh7IGl0ZW0sIHN1YmxheWVyLCBzZWxlY3RlZEl0ZW0gfSkpO1xufVxuLyoqXG4gKiBBZGQgYW4gZWxlbWVudCB0byB0aGUgc2VsZWN0ZWRJdGVtcyBhcnJheVxuICovXG5mdW5jdGlvbiBzZWxlY3RJdGVtKHsgaXRlbSwgc3VibGF5ZXIsIHNlbGVjdGVkSXRlbXMgfSkge1xuICAvLyBhc3N1bWUgdGhhdCBpZiB0aGVyZSBpcyBhIHN1YmxheWVyIHdlIHNob3VsZCBiZSBzdG9yaW5nIGluIHRoYXQgZm9ybVxuICBjb25zdCBlbnRyeSA9IHN1YmxheWVyID8geyBpdGVtLCBzdWJsYXllciB9IDogaXRlbTtcbiAgaWYgKCFpc1NlbGVjdGVkKHsgaXRlbSwgc3VibGF5ZXIsIHNlbGVjdGVkSXRlbXMgfSkpIHtcbiAgICByZXR1cm4gWy4uLnNlbGVjdGVkSXRlbXMsIGVudHJ5XTtcbiAgfVxuICByZXR1cm4gWy4uLnNlbGVjdGVkSXRlbXNdO1xufVxuLyoqXG4gKiBGaW5kIGFsbCBzZWxlY3RlZCBzdWJsYXllcnMgZm9yIGEgZ2l2ZW4gaXRlbVxuICovXG5mdW5jdGlvbiBmaW5kU2VsZWN0ZWRTdWJsYXllcnMoeyBpdGVtLCBzZWxlY3RlZEl0ZW1zIH0pIHtcbiAgcmV0dXJuIHNlbGVjdGVkSXRlbXMuZmlsdGVyKChzZWxlY3RlZEl0ZW0pID0+IHsgdmFyIF9hOyByZXR1cm4gKChfYSA9IHNlbGVjdGVkSXRlbS5pdGVtKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaWQpID09PSAoaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLmlkKTsgfSk7XG59XG5cbmZ1bmN0aW9uIGdldFNlYXJjaFN1YmxheWVySWNvbihnZW8pIHtcbiAgY29uc3QgbG9va3VwID0ge1xuICAgIHBvaW50OiBcInBvaW50XCIsXG4gICAgcG9seWxpbmU6IFwibGluZVwiLFxuICAgIHBvbHlnb246IFwicG9seWdvblwiLFxuICAgIG5vbnNwYXRpYWw6IFwidGFibGVcIixcbiAgICBtdWx0aXBvaW50OiBcImxheWVyLXBvaW50c1wiXG4gIH07XG4gIHJldHVybiBsb29rdXBbZ2VvXSB8fCBcInRhYmxlXCI7XG59XG5jb25zdCBnZW9tZXRyeVR5cGVMb29rdXAgPSB7XG4gIGVzcmlHZW9tZXRyeVBvaW50OiBcInBvaW50XCIsXG4gIGVzcmlHZW9tZXRyeVBvbHlsaW5lOiBcInBvbHlsaW5lXCIsXG4gIGVzcmlHZW9tZXRyeVBvbHlnb246IFwicG9seWdvblwiLFxuICBlc3JpR2VvbWV0cnlNdWx0aXBvaW50OiBcIm11bHRpcG9pbnRcIixcbiAgbm9uZTogXCJub25zcGF0aWFsXCIsXG4gIHRhYmxlOiBcIm5vbnNwYXRpYWxcIlxufTtcbi8qIENvbnZlcnQgYSByZWFsIGZlYXR1cmUgbGF5ZXIgdG8gdGhlIHNlYXJjaCByZXN1bHQgaW5kZXgncyBmb3JtICoqL1xuZnVuY3Rpb24gZ2V0U2VhcmNoUmVzdWx0U3VibGF5ZXIoc3VibGF5ZXIpIHtcbiAgY29uc3QgeyBkZXNjcmlwdGlvbiwgZ2VvbWV0cnlUeXBlLCBmaWVsZEFsaWFzZXMsIHRpdGxlLCBpZCB9ID0gc3VibGF5ZXI7XG4gIHJldHVybiB7XG4gICAgZGVzY3JpcHRpb24sXG4gICAgZmllbGRBbGlhc2VzOiBBcnJheS5pc0FycmF5KGZpZWxkQWxpYXNlcykgPyBmaWVsZEFsaWFzZXMuam9pbihcIixcIikgOiBmaWVsZEFsaWFzZXMsXG4gICAgZ2VvbWV0cnlUeXBlOiBnZW9tZXRyeVR5cGVMb29rdXBbZ2VvbWV0cnlUeXBlXSB8fCBcIm5vbnNwYXRpYWxcIixcbiAgICBpZCxcbiAgICB0aXRsZVxuICB9O1xufVxuXG5jb25zdCBhcmNnaXNJdGVtQnJvd3NlckNzcyA9IFwiOmhvc3R7cG9zaXRpb246cmVsYXRpdmU7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWJhY2tncm91bmQpO2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTtvdmVyZmxvdy15OmF1dG87b3ZlcmZsb3cteDpoaWRkZW47bWluLWhlaWdodDoxMDAlOy0taXRlbS1icm93c2VyLW1heC13aWR0aDoxMDAlOy0taXRlbS1icm93c2VyLXBhbmUtd2lkdGg6MTguNzVyZW07LS1pdGVtLWJyb3dzZXItcGFuZS16LWluZGV4OjExOy0taXRlbS1icm93c2VyLXRvcC1iYXItYmFja2dyb3VuZDp2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMSl9Omhvc3QoW2hlaWdodD1hdXRvXSl7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjtoZWlnaHQ6YXV0b31hcmNnaXMtYnJvd3NlcnstLWFyY2dpcy1icm93c2VyLW1heC13aWR0aDp2YXIoLS1pdGVtLWJyb3dzZXItbWF4LXdpZHRoKTstLWFyY2dpcy1icm93c2VyLXBhbmUtd2lkdGg6dmFyKC0taXRlbS1icm93c2VyLXBhbmUtd2lkdGgpOy0tYXJjZ2lzLWJyb3dzZXItcGFuZS16LWluZGV4OnZhcigtLWl0ZW0tYnJvd3Nlci1wYW5lLXotaW5kZXgpOy0tYXJjZ2lzLWJyb3dzZXItdG9wLWJhci1iYWNrZ3JvdW5kOnZhcigtLWl0ZW0tYnJvd3Nlci10b3AtYmFyLWJhY2tncm91bmQpfS5jb250ZW50LS1wYWRkZWQtYm90dG9te3BhZGRpbmctYm90dG9tOjEuNXJlbX1AbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA2NDBweCl7Omhvc3R7LS1pdGVtLWJyb3dzZXItcGFuZS13aWR0aDoxMDAlfX1cIjtcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXIgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJVcGRhdGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyVXBkYXRlXCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJMb2FkaW5nID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckxvYWRpbmdcIiwgNyk7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclNlbGVjdCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJTZWxlY3RcIiwgNyk7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclByZXZpZXcgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyUHJldmlld1wiLCA3KTtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU3VibGF5ZXJQcmV2aWV3ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlclN1YmxheWVyUHJldmlld1wiLCA3KTtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VySW50ZXJuYWxVSUFjdGlvbiA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uXCIsIDcpO1xuICAgIHRoaXMubGl2ZVJlZ2lvblVwZGF0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibGl2ZVJlZ2lvblVwZGF0ZVwiLCA3KTtcbiAgICB0aGlzLmFsbG93RmV0Y2ggPSBmYWxzZTtcbiAgICB0aGlzLmN1cnJlbnRSZXN1bHRzID0gW107XG4gICAgdGhpcy51cGRhdGVGaWx0ZXJzRW1wdHkgPSAoKSA9PiB7XG4gICAgICB2YXIgX2E7XG4gICAgICB0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnNFbXB0eSA9ICEoKF9hID0gdGhpcy5lbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5U2VsZWN0b3IoYFtzbG90PVwiZmlsdGVyc1wiXWApKTtcbiAgICB9O1xuICAgIHRoaXMudXBkYXRlVG9wYmFyRW1wdHkgPSAoKSA9PiB7XG4gICAgICB2YXIgX2E7XG4gICAgICB0aGlzLnN0b3JlLnN0YXRlLnRvcGJhckVtcHR5ID0gISgoX2EgPSB0aGlzLmVsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucXVlcnlTZWxlY3RvcihgW3Nsb3Q9XCJ0b3AtYmFyXCJdYCkpO1xuICAgIH07XG4gICAgdGhpcy51cGRhdGVTb3J0RW1wdHkgPSAoKSA9PiB7XG4gICAgICB2YXIgX2E7XG4gICAgICB0aGlzLnN0b3JlLnN0YXRlLnNvcnRFbXB0eSA9ICEoKF9hID0gdGhpcy5lbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5U2VsZWN0b3IoYFtzbG90PVwic29ydFwiXWApKTtcbiAgICB9O1xuICAgIHRoaXMuZmlsdGVyTXV0YXRpb25PYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKHRoaXMudXBkYXRlRmlsdGVyc0VtcHR5KTtcbiAgICB0aGlzLnRvcGJhck11dGF0aW9uT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcih0aGlzLnVwZGF0ZVRvcGJhckVtcHR5KTtcbiAgICB0aGlzLnNvcnRNdXRhdGlvbk9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIodGhpcy51cGRhdGVTb3J0RW1wdHkpO1xuICAgIHRoaXMuZmV0Y2hJdGVtcyA9IGRlYm91bmNlKGFzeW5jICgpID0+IHtcbiAgICAgIHZhciBfYSwgX2I7XG4gICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckxvYWRpbmcuZW1pdCgpO1xuICAgICAgdGhpcy5jdXJyZW50UmVzdWx0cyA9IFtdO1xuICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5wcmV2aWV3ID0gbnVsbDtcbiAgICAgIGlmICghdGhpcy5wb3J0YWwgfHwgIXRoaXMuYWxsb3dGZXRjaCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsZXQgcXVlcnkgPSB0aGlzLmdldFF1ZXJ5KCk7XG4gICAgICBpZiAodGhpcy5wcmVmbGlnaHQpIHtcbiAgICAgICAgcXVlcnkgPSBhd2FpdCB0aGlzLnByZWZsaWdodChxdWVyeSk7XG4gICAgICB9XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IG1pbkRlbGF5KHRoaXMucXVlcnlJdGVtcyhxdWVyeSksIDUwMCk7XG4gICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyVXBkYXRlLmVtaXQoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHJlc3BvbnNlKSwgeyBzZWxlY3RlZEl0ZW1zOiB0aGlzLnNlbGVjdGVkSXRlbXMsIGZpbHRlcnM6IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVycyksIHNlYXJjaFRlcm06IHRoaXMuc2VhcmNoVGVybSB9KSwgdGhpcy5zb3J0KSk7XG4gICAgICB0aGlzLmN1cnJlbnRSZXNwb25zZSA9IHJlc3BvbnNlO1xuICAgICAgdGhpcy5jdXJyZW50UmVzdWx0cyA9IHJlc3BvbnNlLnJlc3VsdHM7XG4gICAgICAvLyBhZGQgYWxsIHRhZ3MgZnJvbSB0aGUgaXRlbXMgdG8gdGhlIHRhZ3MgcGlja2VyLlxuICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5rbm93blRhZ3MgPSBnZXRUYWdzKHJlc3BvbnNlLCB0aGlzLnN0b3JlLnN0YXRlLmtub3duVGFncywgKF9iID0gKF9hID0gdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGFncykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnRhZ3MpO1xuICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5oaWdobGlnaHRzID0gZ2V0SGlnaGxpZ2h0cyhyZXNwb25zZSwgY29uZmlnU3RhdGUuY29uZmlnKTtcbiAgICAgIGF3YWl0IHRpbWVvdXQoMTAwKTtcbiAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgIH0sIDE1MCk7XG4gICAgdGhpcy5yZXNpemUgPSAoKSA9PiB7XG4gICAgICB2YXIgX2EsIF9iO1xuICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLmVsLmNsaWVudFdpZHRoIHx8ICgoX2EgPSB0aGlzLmVsLnBhcmVudEVsZW1lbnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jbGllbnRXaWR0aCkgfHwgMDtcbiAgICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuZWwuY2xpZW50SGVpZ2h0IHx8ICgoX2IgPSB0aGlzLmVsLnBhcmVudEVsZW1lbnQpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jbGllbnRIZWlnaHQpIHx8IDA7XG4gICAgICB0aGlzLmZvcm1GYWN0b3IgPSB3aWR0aCA+IGJyZWFrcG9pbnRzLnNtID8gXCJsYXJnZVwiIDogXCJzbWFsbFwiO1xuICAgICAgY29uc3Qgb2xkRm9ybUZhY3RvciA9IHRoaXMuc3RvcmUuc3RhdGUud2lkdGggPiBicmVha3BvaW50cy5zbSA/IFwibGFyZ2VcIiA6IFwic21hbGxcIjtcbiAgICAgIC8qKiB3aGVuIGdvaW5nIGZyb20gbGFyZ2UgdG8gc21hbGwgb3Igc21hbGwgdG8gbGFyZ2UsIGNvbGxhcHNlIG9yIGV4cGFuZCBmaWx0ZXJzLCBhY2NvcmRpbmdseSAqL1xuICAgICAgaWYgKG9sZEZvcm1GYWN0b3IgPT09IFwibGFyZ2VcIiAmJiB0aGlzLmZvcm1GYWN0b3IgPT09IFwic21hbGxcIikge1xuICAgICAgICAvKiogdXNlIHBhbmVsIGxheW91dCBpZiBlbmFibGVkIG9uIHNtYWxsZXIgaXRlbSBicm93c2VycyAqL1xuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnBhbmVsID0gdGhpcy51c2VQYW5lbExheW91dDtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzRXhwYW5kZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmIChvbGRGb3JtRmFjdG9yID09PSBcInNtYWxsXCIgJiYgdGhpcy5mb3JtRmFjdG9yID09PSBcImxhcmdlXCIpIHtcbiAgICAgICAgLyoqIHBhbmVsIGxheW91dCB3b24ndCB3b3JrIG9uIGxhcmdlciBpdGVtIGJyb3dzZXJzICovXG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUucGFuZWwgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzRXhwYW5kZWQgPSB0cnVlO1xuICAgICAgfVxuICAgICAgdGhpcy5zdG9yZS5zdGF0ZS53aWR0aCA9IHdpZHRoO1xuICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgfTtcbiAgICB0aGlzLnJlbmRlclNlbGVjdGVkSXRlbSA9IChzZWxlY3RlZEl0ZW0pID0+IHtcbiAgICAgIGNvbnN0IHVzaW5nU3VibGF5ZXJzID0gaXNTdWJsYXllcihzZWxlY3RlZEl0ZW0pO1xuICAgICAgY29uc3QgaXRlbSA9IHVzaW5nU3VibGF5ZXJzID8gc2VsZWN0ZWRJdGVtLml0ZW0gOiBzZWxlY3RlZEl0ZW07XG4gICAgICBjb25zdCBzdWJsYXllciA9IHVzaW5nU3VibGF5ZXJzID8gc2VsZWN0ZWRJdGVtLnN1YmxheWVyIDogbnVsbDtcbiAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gdXNpbmdTdWJsYXllcnMgPyBzdWJsYXllci50aXRsZSA6IG51bGw7XG4gICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc2VsZWN0ZWQtaXRlbVwiLCB7IGhlYWRpbmc6IGl0ZW0udGl0bGUsIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiwgb25BcmNnaXNTZWxlY3RlZEl0ZW1SZW1vdmU6ICgpID0+IHtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSBkZXNlbGVjdEl0ZW0oeyBpdGVtLCBzdWJsYXllciwgc2VsZWN0ZWRJdGVtczogdGhpcy5zZWxlY3RlZEl0ZW1zIH0pO1xuICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJTZWxlY3QuZW1pdCh0aGlzLnNlbGVjdGVkSXRlbXMpO1xuICAgICAgICB9IH0sIHVzaW5nU3VibGF5ZXJzID8gKGgoXCJjYWxjaXRlLWljb25cIiwgeyBzbG90OiBcImNvbnRlbnQtc3RhcnRcIiwgaWNvbjogZ2V0U2VhcmNoU3VibGF5ZXJJY29uKHNlbGVjdGVkSXRlbS5zdWJsYXllci5nZW9tZXRyeVR5cGUpLCBzY2FsZTogXCJzXCIgfSkpIDogKGgoXCJhcmNnaXMtaXRlbS10eXBlXCIsIHsgc2xvdDogXCJjb250ZW50LXN0YXJ0XCIsIGl0ZW06IGl0ZW0sIHBvcnRhbDogdGhpcy5wb3J0YWwsIHNjYWxlOiBcInNcIiwgc2hvd1RleHQ6IGZhbHNlIH0pKSkpO1xuICAgIH07XG4gICAgdGhpcy5hcGkgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy51c2VyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uSW5mbyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnVzZXJMaWNlbnNlZEl0ZW1zID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuY29uZmlnID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZ3JvdXBJZCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNlbGVjdGlvbiA9IFwibm9uZVwiO1xuICAgIHRoaXMuc2VsZWN0ZWRJdGVtcyA9IFtdO1xuICAgIHRoaXMuYWxsb3dlZEdlb21ldHJpZXMgPSBbLi4uZGVmYXVsdEdlb21ldHJpZXNdO1xuICAgIHRoaXMuYWxsb3dlZFN1YnNjcmlwdGlvbkNvbnRlbnRUeXBlcyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnZpZXcgPSBcImxpc3RcIjtcbiAgICB0aGlzLmJ1Y2tldCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm51bSA9IDIwO1xuICAgIHRoaXMucSA9IFwiXCI7XG4gICAgdGhpcy5maWx0ZXIgPSBcIlwiO1xuICAgIHRoaXMuaGVpZ2h0ID0gXCJmdWxsXCI7XG4gICAgdGhpcy5wcmVmbGlnaHQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5mZXRjaCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNob3dGaWVsZFN0YXRpc3RpY3MgPSBmYWxzZTtcbiAgICB0aGlzLnN0b3JlID0gY3JlYXRlU3RvcmUoeyBmaWx0ZXJzOiB7fSB9KTtcbiAgICB0aGlzLmhpZGVQcmV2aWV3Rm9vdGVycyA9IGZhbHNlO1xuICAgIHRoaXMuaGlkZUNvbnRlbnRUb3AgPSBmYWxzZTtcbiAgICB0aGlzLmNvbnRlbnRQYWRkZWRCb3R0b20gPSBmYWxzZTtcbiAgICB0aGlzLnVzZVBhbmVsTGF5b3V0ID0gZmFsc2U7XG4gICAgdGhpcy5iYXNlVXJscyA9IHt9O1xuICAgIHRoaXMuc2VhcmNoVGVybSA9IFwiXCI7XG4gICAgdGhpcy5zb3J0ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucGFnZSA9IHsgbnVtOiB0aGlzLm51bSwgc3RhcnQ6IDEsIG5leHRTdGFydDogLTEgfTtcbiAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgIHRoaXMuZm9ybUZhY3RvciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnByZXZpZXdJdGVtID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuY3VycmVudFJlc3BvbnNlID0gdW5kZWZpbmVkO1xuICB9XG4gIC8qKiBNYW51YWxseSB0cmlnZ2VyIGEgZmV0Y2ggb2YgbmV3IHJlc3VsdHMgKi9cbiAgYXN5bmMgcmVmcmVzaCgpIHtcbiAgICB0aGlzLmZldGNoSXRlbXMoKTtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICBjb25zdCB7IGVsLCBncm91cElkLCB2aWV3LCBidWNrZXQsIGFsbG93ZWRHZW9tZXRyaWVzLCBzZWxlY3RlZEl0ZW1zLCBzaG93RmllbGRTdGF0aXN0aWNzIH0gPSB0aGlzO1xuICAgIGNvbnN0IGxvY2FsZSA9IGF3YWl0IGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MoZWwpO1xuICAgIHRoaXMuaTE4biA9IGxvY2FsZVswXTtcbiAgICBpZiAoYnVja2V0KSB7XG4gICAgICB0aGlzLnN0b3JlLnN0YXRlLmJ1Y2tldCA9IGJ1Y2tldDtcbiAgICB9XG4gICAgdGhpcy5zdG9yZS5zdGF0ZS5ncm91cElkID0gZ3JvdXBJZDtcbiAgICB0aGlzLnN0b3JlLnN0YXRlLmkxOG4gPSBsb2NhbGVbMF07XG4gICAgdGhpcy5zdG9yZS5zdGF0ZS5sYW5nID0gbG9jYWxlWzFdO1xuICAgIHRoaXMuc3RvcmUuc3RhdGUudmlldyA9IHZpZXc7XG4gICAgdGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3Rpb24gPSB0aGlzLnNlbGVjdGlvbjtcbiAgICB0aGlzLnN0b3JlLnN0YXRlLnNlbGVjdGVkSXRlbXMgPSBzZWxlY3RlZEl0ZW1zO1xuICAgIHRoaXMuc3RvcmUuc3RhdGUuYWxsb3dlZEdlb21ldHJpZXMgPSBhbGxvd2VkR2VvbWV0cmllcztcbiAgICB0aGlzLnN0b3JlLnN0YXRlLnNob3dGaWVsZFN0YXRpc3RpY3MgPSBzaG93RmllbGRTdGF0aXN0aWNzO1xuICAgIHRoaXMuc3RvcmUuc3RhdGUuaW50ZXJhY3Rpb24gPSBcImtleWJvYXJkXCI7XG4gICAgdGhpcy5pbml0aWFsaXplQ29uZmlnKCk7XG4gICAgdGhpcy5zdG9yZS5zdGF0ZS53aWR0aCA9IDQyMDtcbiAgICB0aGlzLnN0b3JlLnN0YXRlLnBhbmVsID0gdHJ1ZTtcbiAgICB0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnNFeHBhbmRlZCA9IGZhbHNlO1xuICAgIHRoaXMuZm9ybUZhY3RvciA9IFwic21hbGxcIjtcbiAgICB0aGlzLmZpbHRlck11dGF0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShlbCwgeyBjaGlsZExpc3Q6IHRydWUgfSk7XG4gICAgdGhpcy50b3BiYXJNdXRhdGlvbk9ic2VydmVyLm9ic2VydmUoZWwsIHsgY2hpbGRMaXN0OiB0cnVlIH0pO1xuICAgIHRoaXMuc29ydE11dGF0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShlbCwgeyBjaGlsZExpc3Q6IHRydWUgfSk7XG4gICAgdGhpcy51cGRhdGVGaWx0ZXJzRW1wdHkoKTtcbiAgICB0aGlzLnVwZGF0ZVRvcGJhckVtcHR5KCk7XG4gICAgdGhpcy51cGRhdGVTb3J0RW1wdHkoKTtcbiAgICB0aGlzLnJlc2l6ZSgpO1xuICAgIHRoaXMucmVzaXplSGFuZGxlciA9ICgpID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnJlc2l6ZSk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgdGhpcy5yZXNpemVIYW5kbGVyKTtcbiAgICBpZiAodGhpcy51c2VQYW5lbExheW91dCB8fCBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkodGhpcy5lbCwgXCJjYWxjaXRlLXNoZWxsLXBhbmVsXCIpKSB7XG4gICAgICB0aGlzLnN0b3JlLnN0YXRlLnBhbmVsID0gdHJ1ZTtcbiAgICAgIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVyc0V4cGFuZGVkID0gZmFsc2U7XG4gICAgfVxuICB9XG4gIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgIHZhciBfYTtcbiAgICAoX2EgPSB0aGlzLnN0b3JlLnN0YXRlLnJlc2l6ZU9ic2VydmVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudW5vYnNlcnZlKHRoaXMuZWwpO1xuICAgIHRoaXMuZmlsdGVyTXV0YXRpb25PYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgdGhpcy50b3BiYXJNdXRhdGlvbk9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICB0aGlzLnNvcnRNdXRhdGlvbk9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICB0aGlzLmZpbHRlckNsZWFySGFuZGxlcihmYWxzZSk7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgdGhpcy5yZXNpemVIYW5kbGVyKTtcbiAgfVxuICB1cGRhdGVVc2VyKG5ld1VzZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgKF9hID0gY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLnVzZXIgPSBuZXdVc2VyKTtcbiAgfVxuICB1cGRhdGVVc2VyTGljZW5zZWRJdGVtcyhsaWNlbnNlZEl0ZW1zKSB7XG4gICAgdmFyIF9hO1xuICAgIChfYSA9IGNvbmZpZ1N0YXRlLnVzZXJMaWNlbnNlZEl0ZW1zKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoY29uZmlnU3RhdGUudXNlckxpY2Vuc2VkSXRlbXMgPSBsaWNlbnNlZEl0ZW1zKTtcbiAgfVxuICB1cGRhdGVTdWJzY3JpcHRpb25JbmZvKHN1YnNjcmlwdGlvbkluZm8pIHtcbiAgICB2YXIgX2E7XG4gICAgKF9hID0gY29uZmlnU3RhdGUuc3Vic2NyaXB0aW9uSW5mbykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLnN1YnNjcmlwdGlvbkluZm8gPSBzdWJzY3JpcHRpb25JbmZvKTtcbiAgfVxuICB1cGRhdGVQb3J0YWwobmV3UG9ydGFsKSB7XG4gICAgdmFyIF9hO1xuICAgIChfYSA9IGNvbmZpZ1N0YXRlLnBvcnRhbCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLnBvcnRhbCA9IG5ld1BvcnRhbCk7XG4gIH1cbiAgdXBkYXRlQVBJKG5ld1ZhbHVlKSB7XG4gICAgdmFyIF9hO1xuICAgIChfYSA9IGNvbmZpZ1N0YXRlLmFwaSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLmFwaSA9IG5ld1ZhbHVlKTtcbiAgfVxuICB1cGRhdGVDb25maWcobmV3Q29uZmlnKSB7XG4gICAgdmFyIF9hO1xuICAgIChfYSA9IGNvbmZpZ1N0YXRlLmNvbmZpZykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLmNvbmZpZyA9IG5ld0NvbmZpZyk7XG4gIH1cbiAgdXBkYXRlU2VsZWN0aW9uKG5ld1ZhbHVlKSB7XG4gICAgdGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3Rpb24gPSBuZXdWYWx1ZTtcbiAgfVxuICB1cGRhdGVHcm91cElEKGlkKSB7XG4gICAgdGhpcy5zdG9yZS5zdGF0ZS5ncm91cElkID0gaWQ7XG4gIH1cbiAgdXBkYXRlU3VibGF5ZXJTZWxlY3Rpb25HZW9tZXRyeVR5cGVzKHR5cGVzKSB7XG4gICAgdGhpcy5zdG9yZS5zdGF0ZS5hbGxvd2VkR2VvbWV0cmllcyA9IHR5cGVzO1xuICB9XG4gIHVwZGF0ZVNlbGVjdGVkSXRlbXMoaXRlbXMpIHtcbiAgICB0aGlzLnN0b3JlLnN0YXRlLnNlbGVjdGVkSXRlbXMgPSBpdGVtcztcbiAgfVxuICB1cGRhdGVGaWVsZFN0YXRpc3RpY3ModmFsdWUpIHtcbiAgICB0aGlzLnN0b3JlLnN0YXRlLnNob3dGaWVsZFN0YXRpc3RpY3MgPSB2YWx1ZTtcbiAgfVxuICB1cGRhdGVWaWV3KHZpZXcpIHtcbiAgICB0aGlzLnN0b3JlLnN0YXRlLnZpZXcgPSB2aWV3O1xuICB9XG4gIHVwZGF0ZUJ1Y2tldChidWNrZXQpIHtcbiAgICB0aGlzLnN0b3JlLnN0YXRlLmJ1Y2tldCA9IGJ1Y2tldDtcbiAgICB0aGlzLmZldGNoSXRlbXMoKTtcbiAgfVxuICB1cGRhdGVRKCkge1xuICAgIHRoaXMuZmV0Y2hJdGVtcygpO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgdGhpcy5yZXNpemUoKTtcbiAgICB0aGlzLmluaXRpYWxpemVDb25maWcoKTtcbiAgICAvLyBpbml0aWFsbHksIGZldGNoIGlzIGxvY2tlZFxuICAgIC8vIHdhaXQgZm9yIGFsbCBjb21wb25lbnRzIHRvIGVtaXQgZXZlbnRzIGltcGFjdGluZyBzdGF0ZSBwcmlvciB0byBpbml0aWFsIGZldGNoXG4gICAgYXdhaXQgdGltZW91dCg0MDApO1xuICAgIHRoaXMuYWxsb3dGZXRjaCA9IHRydWU7XG4gICAgaWYgKGNvbmZpZ1N0YXRlLnBvcnRhbCkge1xuICAgICAgdGhpcy5mZXRjaEl0ZW1zKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgb25Db25maWdDaGFuZ2UoXCJwb3J0YWxcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLmluaXRpYWxpemVDb25maWcoKTtcbiAgICAgICAgdGhpcy5mZXRjaEl0ZW1zKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgZmlsdGVySGFuZGxlcihlKSB7XG4gICAgY29uc3QgZmlsdGVycyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzKSwgeyBbZS5kZXRhaWwuaWRdOiBlLmRldGFpbCB9KTtcbiAgICAvLyByZW1vdmUgZmlsdGVyIGZyb20gc2V0XG4gICAgaWYgKCFlLmRldGFpbC52YWx1ZSkge1xuICAgICAgZGVsZXRlIGZpbHRlcnNbZS5kZXRhaWwuaWRdO1xuICAgIH1cbiAgICB0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnMgPSBmaWx0ZXJzO1xuICAgIHRoaXMucmVzZXRQYWdpbmF0aW9uKCk7XG4gICAgdGhpcy5mZXRjaEl0ZW1zKCk7XG4gIH1cbiAgZ2VuZXJpY0ZpbHRlckhhbmRsZXIoZSkge1xuICAgIHRoaXMuZmlsdGVySGFuZGxlcihlKTtcbiAgfVxuICBmaWx0ZXJDbGVhckhhbmRsZXIoZG9GZXRjaEl0ZW1zID0gdHJ1ZSkge1xuICAgIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVycyA9IHt9O1xuICAgIHRoaXMucmVzZXRQYWdpbmF0aW9uKCk7XG4gICAgZG9GZXRjaEl0ZW1zICYmIHRoaXMuZmV0Y2hJdGVtcygpO1xuICB9XG4gIGdlbmVyaWNGaWx0ZXJDbGVhckhhbmRsZXIoKSB7XG4gICAgdGhpcy5maWx0ZXJDbGVhckhhbmRsZXIoKTtcbiAgfVxuICBzZWFyY2hIYW5kbGVyKGUpIHtcbiAgICBjb25zdCBuZXdUZXJtID0gZS5kZXRhaWw7XG4gICAgdGhpcy5zZWFyY2hUZXJtID0gbmV3VGVybTtcbiAgICB0aGlzLnJlc2V0UGFnaW5hdGlvbigpO1xuICAgIGlmIChuZXdUZXJtKSB7XG4gICAgICB0aGlzLmZldGNoSXRlbXMoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmZldGNoSXRlbXMuaW52b2tlKCk7XG4gICAgfVxuICB9XG4gIGJ1Y2tldEhhbmRsZXIoZSkge1xuICAgIHRoaXMuc3RvcmUuc3RhdGUuYnVja2V0ID0gZS5kZXRhaWw7XG4gICAgdGhpcy5idWNrZXQgPSBlLmRldGFpbDtcbiAgICB0aGlzLnJlc2V0UGFnaW5hdGlvbigpO1xuICAgIHRoaXMuZmV0Y2hJdGVtcygpO1xuICB9XG4gIHNvcnRIYW5kbGVyKGUpIHtcbiAgICB0aGlzLnNvcnQgPSBlLmRldGFpbDtcbiAgICB0aGlzLnN0b3JlLnN0YXRlLnNvcnQgPSBlLmRldGFpbDtcbiAgICB0aGlzLmZldGNoSXRlbXMoKTtcbiAgfVxuICB2aWV3SGFuZGxlcihlKSB7XG4gICAgdGhpcy52aWV3ID0gZS5kZXRhaWw7XG4gICAgdGhpcy5zdG9yZS5zdGF0ZS52aWV3ID0gZS5kZXRhaWw7XG4gIH1cbiAgYXN5bmMgcGFnZUhhbmRsZXIoZSkge1xuICAgIHZhciBfYTtcbiAgICB0aGlzLnBhZ2UgPSBlLmRldGFpbDtcbiAgICBpZiAodGhpcy5hbGxvd0ZldGNoKSB7XG4gICAgICBhd2FpdCB0aGlzLmZldGNoSXRlbXMoKTtcbiAgICAgIGF3YWl0IHRpbWVvdXQoNDAwKTtcbiAgICAgIChfYSA9IHRoaXMuZWwuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKFwiLnNjcm9sbGluZ1wiKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNjcm9sbFRvKHsgYmVoYXZpb3I6IFwic21vb3RoXCIsIHRvcDogMCB9KTtcbiAgICB9XG4gIH1cbiAgc2VsZWN0SGFuZGxlcihlKSB7XG4gICAgY29uc3Qgc2VsZWN0ZWRJdGVtcyA9IHRoaXMuc2VsZWN0ZWRJdGVtcztcbiAgICBjb25zdCB7IHNlbGVjdGVkLCBpdGVtLCBzdWJsYXllciB9ID0gZS5kZXRhaWw7XG4gICAgc3dpdGNoICh0aGlzLnNlbGVjdGlvbikge1xuICAgICAgY2FzZSBcInNpbmdsZVwiOlxuICAgICAgY2FzZSBcInNpbmdsZS1zdWJsYXllclwiOlxuICAgICAgICAvLyBieSBwYXNzaW5nIGFuIGVtcHR5IGFycmF5IGZvciBzZWxlY3RlZCBpdGVtcyB3ZSBlbnN1cmUgb25seSB0aGUgY3VycmVudCBpdGVtIGlzIHNlbGVjdGVkXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcyA9IHNlbGVjdEl0ZW0oeyBpdGVtLCBzdWJsYXllciwgc2VsZWN0ZWRJdGVtczogW10gfSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIm11bHRpcGxlXCI6XG4gICAgICBjYXNlIFwibXVsdGlwbGUtc3VibGF5ZXJcIjpcbiAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gc2VsZWN0ZWRcbiAgICAgICAgICA/IHNlbGVjdEl0ZW0oeyBpdGVtLCBzdWJsYXllciwgc2VsZWN0ZWRJdGVtcyB9KVxuICAgICAgICAgIDogZGVzZWxlY3RJdGVtKHsgaXRlbSwgc3VibGF5ZXIsIHNlbGVjdGVkSXRlbXMgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU2VsZWN0LmVtaXQodGhpcy5zZWxlY3RlZEl0ZW1zKTtcbiAgfVxuICBhc3luYyB0b2dnbGVQcmV2aWV3KHsgZGV0YWlsIH0pIHtcbiAgICB0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnNFeHBhbmRlZCA9IGZhbHNlO1xuICAgIGlmICghZGV0YWlsIHx8IHRoaXMuc3RvcmUuc3RhdGUucHJldmlldyA9PT0gZGV0YWlsLmlkKSB7XG4gICAgICB0aGlzLnN0b3JlLnN0YXRlLnByZXZpZXcgPSBudWxsO1xuICAgICAgdGhpcy5wcmV2aWV3SXRlbSA9IG51bGw7XG4gICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyUHJldmlldy5lbWl0KCk7XG4gICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU3VibGF5ZXJQcmV2aWV3LmVtaXQoKTtcbiAgICAgIHRoaXMucmVzdG9yZUZvY3VzKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5yZXN0b3JlRm9jdXNFbGVtZW50ID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcbiAgICAgIHRoaXMuc3RvcmUuc3RhdGUucHJldmlldyA9IGRldGFpbC5pZDtcbiAgICAgIHRoaXMucHJldmlld0l0ZW0gPSBPYmplY3QuYXNzaWduKHt9LCBkZXRhaWwpO1xuICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclByZXZpZXcuZW1pdChPYmplY3QuYXNzaWduKHt9LCBkZXRhaWwpKTtcbiAgICB9XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckludGVybmFsVUlBY3Rpb24uZW1pdCh7XG4gICAgICBhY3Rpb246IHRoaXMucHJldmlld0l0ZW0gPyBcIm9wZW4gcGFuZWxcIiA6IFwiY2xvc2UgcGFuZWxcIixcbiAgICAgIGNhdGVnb3J5OiBcImNhcmQgYWN0aW9uXCJcbiAgICB9KTtcbiAgfVxuICB0aWxlU2VsZWN0SGFuZGxlcihlKSB7XG4gICAgY29uc3QgeyBpdGVtIH0gPSBlLmRldGFpbDtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU2VsZWN0LmVtaXQoW2l0ZW1dKTtcbiAgfVxuICBjb2x1bW5VcGRhdGVIYW5kbGVyKGUpIHtcbiAgICB0aGlzLnN0b3JlLnN0YXRlLmNvbHVtbnMgPSBlLmRldGFpbDtcbiAgfVxuICBoYW5kbGVNb3ZlKCkge1xuICAgIHRoaXMuc3RvcmUuc3RhdGUuaW50ZXJhY3Rpb24gPSBcIm1vdXNlXCI7XG4gIH1cbiAgaGFuZGxlVG91Y2goKSB7XG4gICAgdGhpcy5zdG9yZS5zdGF0ZS5pbnRlcmFjdGlvbiA9IFwidG91Y2hcIjtcbiAgfVxuICBoYW5kbGVLZXkoKSB7XG4gICAgdGhpcy5zdG9yZS5zdGF0ZS5pbnRlcmFjdGlvbiA9IFwia2V5Ym9hcmRcIjtcbiAgfVxuICBhc3luYyBpbml0aWFsaXplQ29uZmlnKCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICAoX2EgPSBjb25maWdTdGF0ZS5hcGkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChjb25maWdTdGF0ZS5hcGkgPSB0aGlzLmFwaSk7XG4gICAgKF9iID0gY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogKGNvbmZpZ1N0YXRlLnVzZXIgPSB0aGlzLnVzZXIpO1xuICAgIChfYyA9IGNvbmZpZ1N0YXRlLnBvcnRhbCkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogKGNvbmZpZ1N0YXRlLnBvcnRhbCA9IHRoaXMucG9ydGFsKTtcbiAgICAoX2QgPSBjb25maWdTdGF0ZS5jb25maWcpICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IChjb25maWdTdGF0ZS5jb25maWcgPSB0aGlzLmNvbmZpZyk7XG4gIH1cbiAgcmVzZXRQYWdpbmF0aW9uKCkge1xuICAgIHRoaXMucGFnZS5zdGFydCA9IDE7XG4gICAgdGhpcy5wYWdlLnRvdGFsID0gMDtcbiAgfVxuICBnZXRRdWVyeSgpIHtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHsgZmlsdGVyczogdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzLCBzZWFyY2hUZXJtOiB0aGlzLnNlYXJjaFRlcm0sIGJhc2VRdWVyeTogdGhpcy5xLCBiYXNlRmlsdGVyOiB0aGlzLmZpbHRlciwgYnVja2V0OiB0aGlzLmJ1Y2tldCwgYWxsb3dlZEdlb21ldHJpZXM6IHRoaXMuYWxsb3dlZEdlb21ldHJpZXMgfSwgdGhpcy5zb3J0KSwgdGhpcy5wYWdlKTtcbiAgfVxuICBhc3luYyBxdWVyeUl0ZW1zKHF1ZXJ5KSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBsZXQgcmVzcG9uc2U7XG4gICAgaWYgKHRoaXMuZmV0Y2gpIHtcbiAgICAgIHJlc3BvbnNlID0gYXdhaXQgdGhpcy5mZXRjaChxdWVyeSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgY29uc3QgeyBwb3J0YWwsIHVzZXIsIHN0b3JlLCBncm91cElkLCBjb25maWcgfSA9IHRoaXM7XG4gICAgICByZXNwb25zZSA9IGF3YWl0IHF1ZXJ5SXRlbXMoeyBwb3J0YWwsIHF1ZXJ5LCB1c2VyLCBzdG9yZSwgZ3JvdXBJZCwgY29uZmlnIH0pO1xuICAgIH1cbiAgICBpZiAoYXdhaXQgaXNQb3J0YWxWaWV3aW5nQXJjR0lTT25saW5lKHRoaXMucG9ydGFsLCAoX2EgPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhdGUuYnVja2V0KSkge1xuICAgICAgKF9iID0gcmVzcG9uc2UgPT09IG51bGwgfHwgcmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3BvbnNlLnJlc3VsdHMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5mb3JFYWNoKCh7IGlkIH0pID0+IHtcbiAgICAgICAgdGhpcy5iYXNlVXJsc1tpZF0gPSBcImFyY2dpcy5jb21cIjtcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cbiAgcmVzdG9yZUZvY3VzKCkge1xuICAgIGlmICh0aGlzLnJlc3RvcmVGb2N1c0VsZW1lbnQpIHtcbiAgICAgIGNvbnN0IGVsID0gdGhpcy5yZXN0b3JlRm9jdXNFbGVtZW50O1xuICAgICAgaWYgKGVsLnJlc3RvcmVGb2N1cykge1xuICAgICAgICBlbC5yZXN0b3JlRm9jdXMoKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGVsLnNldEZvY3VzKSB7XG4gICAgICAgIGVsLnNldEZvY3VzKCk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChlbC5mb2N1cykge1xuICAgICAgICBlbC5mb2N1cygpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZW5kZXJTZWxlY3RlZCgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgIGNvbnN0IHdob2xlUGFnZVNlbGVjdGVkID0gKF9hID0gdGhpcy5jdXJyZW50UmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmV2ZXJ5KChpdGVtKSA9PiBpc1NlbGVjdGVkKHsgaXRlbSwgc2VsZWN0ZWRJdGVtczogdGhpcy5zZWxlY3RlZEl0ZW1zIH0pKTtcbiAgICBjb25zdCB0b3RhbFNlbGVjdGVkSXRlbXMgPSAoX2IgPSB0aGlzLnNlbGVjdGVkSXRlbXMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5sZW5ndGg7XG4gICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNlbGVjdGVkXCIsIHsgc2xvdDogXCJzZWxlY3Rpb25cIiwgbG9hZGluZzogdGhpcy5sb2FkaW5nLCB0b3RhbDogKF9jID0gdGhpcy5jdXJyZW50UmVzdWx0cykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmxlbmd0aCwgdG90YWxTZWxlY3RlZDogKF9kID0gdGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3RlZEl0ZW1zKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QubGVuZ3RoLCBoZWFkaW5nOiB0aGlzLnNlbGVjdGlvbiA9PT0gXCJtdWx0aXBsZS1zdWJsYXllclwiXG4gICAgICAgID8gdGhpcy5pMThuLml0ZW1Ccm93c2VyLnNlbGVjdGVkTGF5ZXJzXG4gICAgICAgIDogdGhpcy5pMThuLml0ZW1Ccm93c2VyLnNlbGVjdGVkSXRlbXMsIGVtcHR5VGV4dDogdGhpcy5zZWxlY3Rpb24gPT09IFwibXVsdGlwbGUtc3VibGF5ZXJcIlxuICAgICAgICA/IHRoaXMuaTE4bi5pdGVtQnJvd3Nlci5ub1NlbGVjdGVkTGF5ZXJzXG4gICAgICAgIDogdGhpcy5pMThuLml0ZW1Ccm93c2VyLm5vU2VsZWN0ZWRJdGVtcywgY2hlY2tlZDogIXRoaXMubG9hZGluZyAmJiB3aG9sZVBhZ2VTZWxlY3RlZCwgaW5kZXRlcm1pbmF0ZTogIXdob2xlUGFnZVNlbGVjdGVkICYmICEhdG90YWxTZWxlY3RlZEl0ZW1zLCBoaWRlQ2hlY2tib3g6IHRoaXMuc2VsZWN0aW9uID09PSBcIm11bHRpcGxlLXN1YmxheWVyXCIsIG9uQXJjZ2lzU2VsZWN0ZWREZXNlbGVjdEFsbDogKCkgPT4ge1xuICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclNlbGVjdC5lbWl0KHRoaXMuc2VsZWN0ZWRJdGVtcyk7XG4gICAgICB9LCBvbkFyY2dpc1NlbGVjdGVkU2VsZWN0UGFnZTogKCkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGxldCBzZWxlY3RlZEl0ZW1zID0gWy4uLnRoaXMuc2VsZWN0ZWRJdGVtc107XG4gICAgICAgIChfYSA9IHRoaXMuY3VycmVudFJlc3VsdHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgc2VsZWN0ZWRJdGVtcyA9IHNlbGVjdEl0ZW0oeyBpdGVtLCBzZWxlY3RlZEl0ZW1zIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gc2VsZWN0ZWRJdGVtcztcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclNlbGVjdC5lbWl0KHRoaXMuc2VsZWN0ZWRJdGVtcyk7XG4gICAgICB9IH0sIChfZSA9IHRoaXMuc3RvcmUuc3RhdGUuc2VsZWN0ZWRJdGVtcykgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLm1hcCh0aGlzLnJlbmRlclNlbGVjdGVkSXRlbSkpKTtcbiAgfVxuICByZW5kZXJTbG90KG5hbWUsIGRlZmF1bHRDb250ZW50KSB7XG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgc2xvdDogbmFtZSB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IG5hbWUgfSwgZGVmYXVsdENvbnRlbnQpKSk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgcHJldmlld0l0ZW0sIGxvYWRpbmcsIGhpZGVDb250ZW50VG9wLCBpMThuLCBzZWxlY3RlZEl0ZW1zLCBzZWxlY3Rpb24sIGN1cnJlbnRSZXNwb25zZSwgc3RvcmUsIGFwaSwgcmVuZGVyU2xvdCwgc2VhcmNoVGVybSwgZm9ybUZhY3RvciwgdmlldywgaGVpZ2h0IH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiYXJjZ2lzLWJyb3dzZXJcIiwgeyBwcmV2aWV3OiAhIXByZXZpZXdJdGVtLCBsb2FkaW5nOiBsb2FkaW5nLCBoaWRlQ29udGVudFRvcDogaGlkZUNvbnRlbnRUb3AsIHNlbGVjdGVkOiBzZWxlY3RlZEl0ZW1zLCBhbHdheXNTaG93U2VsZWN0aW9uOiBzZWxlY3Rpb24gPT09IG51bGwgfHwgc2VsZWN0aW9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3Rpb24uaW5jbHVkZXMoXCJtdWx0aXBsZVwiKSwgYWx3YXlzU2hvd0NvbnRlbnQ6IHZpZXcgPT09IFwidGFibGVcIiwgcmVzcG9uc2U6IGN1cnJlbnRSZXNwb25zZSwgc3RvcmU6IHN0b3JlLCBhcGk6IGFwaSwgZm9ybUZhY3RvcjogZm9ybUZhY3Rvciwgc2VhcmNoVGVybTogc2VhcmNoVGVybSwgaGVpZ2h0OiBoZWlnaHQgfSwgcmVuZGVyU2xvdChcInRvcC1iYXJcIiksIHJlbmRlclNsb3QoXCJ2aWV3XCIpLCByZW5kZXJTbG90KFwic29ydFwiKSwgaChcImFyY2dpcy1pdGVtLWJyb3dzZXItcHJldmlld1wiLCB7IHNsb3Q6IFwicHJldmlld1wiLCBpdGVtOiB0aGlzLnByZXZpZXdJdGVtLCBwb3J0YWw6IHRoaXMucG9ydGFsLCB1c2VyOiB0aGlzLnVzZXIsIGtleTogdGhpcy5zdG9yZS5zdGF0ZS5wcmV2aWV3LCBvbkFyY2dpc0l0ZW1Ccm93c2VyUHJldmlld0Nsb3NlOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUucHJldmlldyA9IG51bGw7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJQcmV2aWV3LmVtaXQoKTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclN1YmxheWVyUHJldmlldy5lbWl0KCk7XG4gICAgICAgIHRoaXMucmVzdG9yZUZvY3VzKCk7XG4gICAgICB9LCBvbkFyY2dpc0ludGVybmFsSXRlbUJyb3dzZXJTdWJsYXllcjogKGUpID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclN1YmxheWVyUHJldmlldy5lbWl0KGUuZGV0YWlsKTtcbiAgICAgIH0sIGhpZGVQcmV2aWV3Rm9vdGVyczogdGhpcy5oaWRlUHJldmlld0Zvb3RlcnMgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwic3VtbWFyeS10b3BcIiB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwicHJldmlldy1zdW1tYXJ5LXRvcFwiIH0pKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIgfSwgaChcInNsb3RcIiwgeyBuYW1lOiBcInByZXZpZXctZm9vdGVyXCIgfSkpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJzdWJsYXllci1mb290ZXJcIiB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwic3VibGF5ZXItcHJldmlldy1mb290ZXJcIiB9KSkpLCB0aGlzLnJlbmRlclNlbGVjdGVkKCksIHJlbmRlclNsb3QoXCJhY3Rpb25zXCIpLCByZW5kZXJTbG90KFwiY29udGVudC1zdGFydFwiKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiY29udGVudFwiLCBjbGFzczogeyBcImNvbnRlbnQtLXBhZGRlZC1ib3R0b21cIjogdGhpcy5jb250ZW50UGFkZGVkQm90dG9tIH0gfSwgaChcInNsb3RcIiwgeyBuYW1lOiBcImNvbnRlbnRcIiB9KSksIHJlbmRlclNsb3QoXCJjb250ZW50LWVuZFwiKSwgcmVuZGVyU2xvdChcInBhZ2luYXRpb25cIiksIHJlbmRlclNsb3QoXCJmaWx0ZXJzXCIpLCByZW5kZXJTbG90KFwic2Nyb2xsLWVuZFwiKSwgcmVuZGVyU2xvdChcIm5vLXJlc3VsdHNcIiwgaTE4bi5jb250ZW50Lm5vUmVzdWx0cyksIHJlbmRlclNsb3QoXCJuby1jb250ZW50XCIsIGkxOG4uY29udGVudC5ub0NvbnRlbnQpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICBcInVzZXJcIjogW1widXBkYXRlVXNlclwiXSxcbiAgICBcInVzZXJMaWNlbnNlZEl0ZW1zXCI6IFtcInVwZGF0ZVVzZXJMaWNlbnNlZEl0ZW1zXCJdLFxuICAgIFwic3Vic2NyaXB0aW9uSW5mb1wiOiBbXCJ1cGRhdGVTdWJzY3JpcHRpb25JbmZvXCJdLFxuICAgIFwicG9ydGFsXCI6IFtcInVwZGF0ZVBvcnRhbFwiXSxcbiAgICBcImFwaVwiOiBbXCJ1cGRhdGVBUElcIl0sXG4gICAgXCJjb25maWdcIjogW1widXBkYXRlQ29uZmlnXCJdLFxuICAgIFwic2VsZWN0aW9uXCI6IFtcInVwZGF0ZVNlbGVjdGlvblwiXSxcbiAgICBcImdyb3VwSWRcIjogW1widXBkYXRlR3JvdXBJRFwiXSxcbiAgICBcImFsbG93ZWRHZW9tZXRyaWVzXCI6IFtcInVwZGF0ZVN1YmxheWVyU2VsZWN0aW9uR2VvbWV0cnlUeXBlc1wiXSxcbiAgICBcInNlbGVjdGVkSXRlbXNcIjogW1widXBkYXRlU2VsZWN0ZWRJdGVtc1wiXSxcbiAgICBcInNob3dGaWVsZFN0YXRpc3RpY3NcIjogW1widXBkYXRlRmllbGRTdGF0aXN0aWNzXCJdLFxuICAgIFwidmlld1wiOiBbXCJ1cGRhdGVWaWV3XCJdLFxuICAgIFwiYnVja2V0XCI6IFtcInVwZGF0ZUJ1Y2tldFwiXSxcbiAgICBcInFcIjogW1widXBkYXRlUVwiXSxcbiAgICBcImZpbHRlclwiOiBbXCJ1cGRhdGVRXCJdXG4gIH07IH1cbn07XG5BcmNnaXNJdGVtQnJvd3Nlci5zdHlsZSA9IGFyY2dpc0l0ZW1Ccm93c2VyQ3NzO1xuXG5mdW5jdGlvbiBnZXRJdGVtQnJvd3NlclN0b3JlKGVsKSB7XG4gIHJldHVybiBnZXRTdG9yZShlbCwgXCJhcmNnaXMtaXRlbS1icm93c2VyXCIpO1xufVxuY29uc3Qgb25JdGVtQnJvd3NlclZpZXdDaGFuZ2UgPSAoc3RvcmUsIGNhbGxiYWNrKSA9PiB7XG4gIHN0b3JlLm9uQ2hhbmdlKFwidmlld1wiLCAobmV3VmlldykgPT4ge1xuICAgIGNhbGxiYWNrKG5ld1ZpZXcpO1xuICB9KTtcbn07XG5jb25zdCBvbkl0ZW1Ccm93c2VyQnVja2V0Q2hhbmdlID0gKHN0b3JlLCBjYWxsYmFjaykgPT4ge1xuICBzdG9yZS5vbkNoYW5nZShcImJ1Y2tldFwiLCAobmV3QnVja2V0KSA9PiB7XG4gICAgY2FsbGJhY2sobmV3QnVja2V0KTtcbiAgfSk7XG59O1xuY29uc3Qgb25JdGVtQnJvd3NlclByZXZpZXdDaGFuZ2UgPSAoc3RvcmUsIGNhbGxiYWNrKSA9PiB7XG4gIHN0b3JlLm9uQ2hhbmdlKFwicHJldmlld1wiLCAocHJldmlldykgPT4ge1xuICAgIGNhbGxiYWNrKHByZXZpZXcpO1xuICB9KTtcbn07XG5jb25zdCBvbkl0ZW1Ccm93c2VyU29ydENoYW5nZSA9IChzdG9yZSwgY2FsbGJhY2spID0+IHtcbiAgc3RvcmUub25DaGFuZ2UoXCJzb3J0XCIsIChzb3J0KSA9PiB7XG4gICAgY2FsbGJhY2soc29ydCk7XG4gIH0pO1xufTtcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJBY3Rpb25zID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFjdGlvbnMgPSBbXTtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJhcmNnaXMtYnJvd3Nlci1hY3Rpb25zXCIsIHsgYWN0aW9uczogdGhpcy5hY3Rpb25zLCBzZWxlY3Rpb246IHRoaXMuc3RvcmUuc3RhdGUuc2VsZWN0ZWRJdGVtcyB9KSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmZ1bmN0aW9uIGNhblZpZXdBR08oc2V0dGluZ3MsIHBvcnRhbCwgdXNlcikge1xuICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICBpZiAocG9ydGFsLmlzUG9ydGFsKSB7XG4gICAgcmV0dXJuIChfYiA9IChfYSA9IHNldHRpbmdzID09PSBudWxsIHx8IHNldHRpbmdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXR0aW5ncy5wb3J0YWxDb25maWdQcm9wZXJ0aWVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2VhcmNoQXJjR0lTT25saW5lRW5hYmxlZCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogdHJ1ZTtcbiAgfVxuICBpZiAoIXVzZXIgfHwgaXNPcmdBZG1pbih1c2VyKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiAoX2UgPSAoX2QgPSAoX2MgPSBwb3J0YWwuc291cmNlSlNPTikgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmNhblNlYXJjaFB1YmxpYykgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogcG9ydGFsLmNhblNlYXJjaFB1YmxpYykgIT09IG51bGwgJiYgX2UgIT09IHZvaWQgMCA/IF9lIDogdHJ1ZTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldFZhbGlkT3B0aW9ucyhwb3J0YWwsIHVzZXIsIG9wdGlvbnMpIHtcbiAgdmFyIF9hLCBfYjtcbiAgaWYgKCFwb3J0YWwpIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgY29uc3Qgc2V0dGluZ3MgPSBhd2FpdCBnZXRQb3J0YWxTZXR0aW5ncyhwb3J0YWwpO1xuICBjb25zdCBwcm92aXNpb25lZExpc3RpbmdzID0gKF9hID0gKChvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMuaW5jbHVkZXMoXCJzdWJzY3JpcHRpb24gY29udGVudFwiKSkgJiYgYXdhaXQgZ2V0UHJvdmlzaW9uZWRMaXN0aW5ncyh1c2VyLCBwb3J0YWwpKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogW107XG4gIGNvbnN0IHByb3BlcnRpZXMgPSBzZXR0aW5ncyA9PT0gbnVsbCB8fCBzZXR0aW5ncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2V0dGluZ3MucG9ydGFsQ29uZmlnUHJvcGVydGllcztcbiAgY29uc3QgY2FuVmlld0xpdmluZ0F0bGFzID0gKF9iID0gcHJvcGVydGllcyA9PT0gbnVsbCB8fCBwcm9wZXJ0aWVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwcm9wZXJ0aWVzLnBvcnRhbExpdmluZ0F0bGFzQ29uZmlnRW5hYmxlZCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogdHJ1ZTtcbiAgcmV0dXJuIG9wdGlvbnMuZmlsdGVyKChvcHRpb24pID0+IHtcbiAgICAvLyBmb3IgcHVibGljIHBvcnRhbHMsIGFsbG93IGFub255bW91cyB1c2VycyB0byBzZWUgdGhlIHBvcnRhbCdzIHB1YmxpYyBjb250ZW50XG4gICAgaWYgKCF1c2VyICYmIG9wdGlvbiA9PT0gXCJvcmdcIikge1xuICAgICAgcmV0dXJuIChwb3J0YWwgPT09IG51bGwgfHwgcG9ydGFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3J0YWwuYWNjZXNzKSA9PT0gXCJwdWJsaWNcIjtcbiAgICB9XG4gICAgLy8gYW5vbnltb3VzIHNob3VsZCBub3Qgc2VlIG15IGNvbnRlbnQgb3Igb3JnIGNvbnRlbnRcbiAgICBpZiAoIXVzZXIgJiYgW1wibXlcIiwgXCJmYXZvcml0ZXNcIiwgXCJncm91cFwiLCBcIm9yZ1wiXS5pbmNsdWRlcyhvcHRpb24pKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8vIHVzZXJzIHdpdGhvdXQgY3JlYXRlL3JlY2VpdmUgaXRlbSBwcml2cyBjYW4ndCBoYXZlIG15IGNvbnRlbnQgKCM0Mzk4KVxuICAgIGlmICh1c2VyICYmICEoY2FuQ3JlYXRlSXRlbXModXNlcikgfHwgY2FuUmVjZWl2ZUl0ZW1zKHVzZXIpKSAmJiBvcHRpb24gPT09IFwibXlcIikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBwdWJsaWMgdXNlcnMgc2hvdWxkIG5vdCBzZWUgb3JnIG9wdGlvblxuICAgIGlmICh1c2VyICYmIGlzUHVibGljVXNlcih1c2VyKSAmJiBvcHRpb24gPT09IFwib3JnXCIpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbiA9PT0gXCJzdWJzY3JpcHRpb24gY29udGVudFwiICYmICghdXNlciB8fCAhKHByb3Zpc2lvbmVkTGlzdGluZ3MgPT09IG51bGwgfHwgcHJvdmlzaW9uZWRMaXN0aW5ncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHJvdmlzaW9uZWRMaXN0aW5ncy5sZW5ndGgpKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBwb3J0YWxzIGNhbiBjb25maWd1cmUgd2V0aGVyIHVzZXJzIHNob3VsZCBzZWUgTEEgb3IgQUdPICMzODE3XG4gICAgaWYgKCghY2FuVmlld0xpdmluZ0F0bGFzICYmIChvcHRpb24gPT09IFwibGl2aW5nIGF0bGFzXCIgfHwgb3B0aW9uID09PSBcImxpdmluZyBhdGxhcyBhbmFseXNpc1wiKSkgfHxcbiAgICAgICghY2FuVmlld0FHTyhzZXR0aW5ncywgcG9ydGFsLCB1c2VyKSAmJiBvcHRpb24gPT09IFwiYWxsXCIpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9KTtcbn1cblxuY29uc3QgYXJjZ2lzSXRlbUJyb3dzZXJCdWNrZXRTZWxlY3RDc3MgPSBcIjpob3N0e2Rpc3BsYXk6YmxvY2t9Lmxhcmdley13ZWJraXQtYm9yZGVyLWVuZDoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1ib3JkZXItMyk7Ym9yZGVyLWlubGluZS1lbmQ6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktYm9yZGVyLTMpfS5idXR0b257cGFkZGluZzowLjVyZW07LS1jYWxjaXRlLWZvbnQtd2VpZ2h0LW5vcm1hbDo1MDB9XCI7XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyQnVja2V0U2VsZWN0ID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQnVja2V0U2VsZWN0ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckJ1Y2tldFNlbGVjdFwiLCA3KTtcbiAgICB0aGlzLnNlbGVjdE9wdGlvbiA9IChvcHRpb24pID0+IHtcbiAgICAgIHRoaXMuYnVja2V0ID0gb3B0aW9uO1xuICAgICAgLy8gYXNzdW1lIGlmIHRoZSB1c2VyIGNsaWNrZWQgaXQsIGl0J3MgdmFsaWRcbiAgICAgIHRoaXMudmFsaWRCdWNrZXQgPSBvcHRpb247XG4gICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQnVja2V0U2VsZWN0LmVtaXQob3B0aW9uKTtcbiAgICB9O1xuICAgIHRoaXMub3B0aW9uTGFiZWwgPSAob3B0aW9uKSA9PiB7XG4gICAgICB2YXIgX2E7XG4gICAgICBpZiAob3B0aW9uID09PSBcIm9yZ1wiICYmICFjb25maWdTdGF0ZS51c2VyKSB7XG4gICAgICAgIHJldHVybiAoX2EgPSBjb25maWdTdGF0ZS5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5uYW1lO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuaTE4bltvcHRpb25dO1xuICAgIH07XG4gICAgdGhpcy5vcHRpb25zID0gW1xuICAgICAgXCJteVwiLFxuICAgICAgXCJmYXZvcml0ZXNcIixcbiAgICAgIFwiZ3JvdXBcIixcbiAgICAgIFwib3JnXCIsXG4gICAgICBcImxpdmluZyBhdGxhc1wiLFxuICAgICAgXCJhbGxcIlxuICAgIF07XG4gICAgdGhpcy5idWNrZXQgPSBcIm15XCI7XG4gICAgdGhpcy52YWxpZEJ1Y2tldCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnZhbGlkT3B0aW9ucyA9IHVuZGVmaW5lZDtcbiAgfVxuICB1cGRhdGVPcHRpb25zKG5ld09wdGlvbnMpIHtcbiAgICB0aGlzLnVwZGF0ZVZhbGlkT3B0aW9ucyhuZXdPcHRpb25zKTtcbiAgfVxuICBhc3luYyB1cGRhdGVWYWxpZE9wdGlvbnMob3B0aW9ucywgZm9yY2VFbWl0KSB7XG4gICAgY29uc3Qgb2xkQnVja2V0ID0gdGhpcy52YWxpZEJ1Y2tldDtcbiAgICBjb25zdCB7IHVzZXIsIHBvcnRhbCB9ID0gY29uZmlnU3RhdGU7XG4gICAgdGhpcy52YWxpZE9wdGlvbnMgPSBhd2FpdCBnZXRWYWxpZE9wdGlvbnMocG9ydGFsLCB1c2VyLCBvcHRpb25zKTtcbiAgICB0aGlzLnZhbGlkQnVja2V0ID0gdGhpcy52YWxpZE9wdGlvbnMuaW5jbHVkZXModGhpcy5idWNrZXQpID8gdGhpcy5idWNrZXQgOiB0aGlzLnZhbGlkT3B0aW9uc1swXTtcbiAgICAvLyBpZiB3ZSBoYWQgdG8gY2hhbmdlIHRoZSBidWNrZXQsIGVtaXQgYW4gZXZlbnRcbiAgICBpZiAob2xkQnVja2V0ICE9PSB0aGlzLnZhbGlkQnVja2V0IHx8IGZvcmNlRW1pdCkge1xuICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckJ1Y2tldFNlbGVjdC5lbWl0KHRoaXMudmFsaWRCdWNrZXQpO1xuICAgIH1cbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4uYnVja2V0U2VsZWN0O1xuICAgIGF3YWl0IHRoaXMudXBkYXRlVmFsaWRPcHRpb25zKHRoaXMub3B0aW9ucywgdHJ1ZSk7XG4gICAgb25Db25maWdDaGFuZ2UoXCJ1c2VyXCIsICgpID0+IHtcbiAgICAgIHRoaXMudXBkYXRlVmFsaWRPcHRpb25zKHRoaXMub3B0aW9ucyk7XG4gICAgfSk7XG4gICAgb25Db25maWdDaGFuZ2UoXCJwb3J0YWxcIiwgKCkgPT4ge1xuICAgICAgdGhpcy51cGRhdGVWYWxpZE9wdGlvbnModGhpcy5vcHRpb25zKTtcbiAgICB9KTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyB2YWxpZE9wdGlvbnMsIHZhbGlkQnVja2V0LCBzZWxlY3RPcHRpb24sIG9wdGlvbkxhYmVsIH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiZGl2XCIsIHsgY2xhc3M6IHtcbiAgICAgICAgbGFyZ2U6IHRoaXMuc3RvcmUuc3RhdGUud2lkdGggPj0gYnJlYWtwb2ludHMuc21cbiAgICAgIH0gfSwgKHZhbGlkT3B0aW9ucyA9PT0gbnVsbCB8fCB2YWxpZE9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHZhbGlkT3B0aW9ucy5sZW5ndGgpID4gMCAmJiAoaChcImNhbGNpdGUtZHJvcGRvd25cIiwgeyBwbGFjZW1lbnQ6IFwiYm90dG9tLXN0YXJ0XCIsIHNjYWxlOiBcIm1cIiwgd2lkdGg6IFwibVwiLCB0eXBlOiBcImNsaWNrXCIgfSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgY2xhc3M6IFwiYnV0dG9uXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIFwiaWNvbi1lbmRcIjogXCJjaGV2cm9uLWRvd25cIiwgc2xvdDogXCJ0cmlnZ2VyXCIgfSwgb3B0aW9uTGFiZWwodmFsaWRCdWNrZXQpKSwgaChcImNhbGNpdGUtZHJvcGRvd24tZ3JvdXBcIiwgeyBzZWxlY3Rpb25Nb2RlOiBcInNpbmdsZVwiIH0sIHZhbGlkT3B0aW9ucy5tYXAoKG9wdGlvbikgPT4gKGgoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIiwgeyBzZWxlY3RlZDogdmFsaWRCdWNrZXQgPT09IG9wdGlvbiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICBzZWxlY3RPcHRpb24ob3B0aW9uKTtcbiAgICAgIH0sIG9uS2V5RG93bjogKGUpID0+IHtcbiAgICAgICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIgfHwgZS5rZXkgPT09IFwiIFwiKSB7XG4gICAgICAgICAgc2VsZWN0T3B0aW9uKG9wdGlvbik7XG4gICAgICAgIH1cbiAgICAgIH0gfSwgb3B0aW9uTGFiZWwob3B0aW9uKSkpKSkpKSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgXCJvcHRpb25zXCI6IFtcInVwZGF0ZU9wdGlvbnNcIl1cbiAgfTsgfVxufTtcbkFyY2dpc0l0ZW1Ccm93c2VyQnVja2V0U2VsZWN0LnN0eWxlID0gYXJjZ2lzSXRlbUJyb3dzZXJCdWNrZXRTZWxlY3RDc3M7XG5cbmNvbnN0IGFyY2dpc0l0ZW1Ccm93c2VyQ2FyZENzcyA9IFwiOmhvc3R7ZGlzcGxheTpibG9jazttaW4td2lkdGg6MH0uaXRlbS1icm93c2VyLWNhcmR7Ym94LXNoYWRvdzpub25lO3RyYW5zaXRpb24tZHVyYXRpb246MTUwbXM7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEpO3Bvc2l0aW9uOnJlbGF0aXZlO29wYWNpdHk6MDtoZWlnaHQ6MTAwJTtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO291dGxpbmUtY29sb3I6dHJhbnNwYXJlbnQ7Ym94LXNpemluZzpib3JkZXItYm94O2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEpO3RyYW5zaXRpb24tcHJvcGVydHk6YmFja2dyb3VuZC1jb2xvciwgb3V0bGluZSwgb3V0bGluZS1vZmZzZXQsIG9wYWNpdHk7Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLXVpLWJvcmRlci0zKX0uaXRlbS1icm93c2VyLWNhcmQ6Zm9jdXN7b3V0bGluZToycHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1icmFuZCk7b3V0bGluZS1vZmZzZXQ6LTJweDt6LWluZGV4OjEwfS5pdGVtLWJyb3dzZXItY2FyZC0tbG9hZGVke29wYWNpdHk6MX0uaXRlbS1icm93c2VyLWNhcmQtLXNlbGVjdGVke2JvcmRlci1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWJyYW5kKX0uaXRlbS1icm93c2VyLWNhcmQtLWhvdmVyYWJsZXtjdXJzb3I6cG9pbnRlcn0uaXRlbS1icm93c2VyLWNhcmRfX3RvcHtwYWRkaW5nOjFyZW19Lml0ZW0tYnJvd3Nlci1jYXJkX19ob3Zlci10ZXh0e29wYWNpdHk6MDtmb250LXdlaWdodDo1MDA7Zm9udC1zaXplOjFyZW07dGV4dC1hbGlnbjpjZW50ZXI7dHJhbnNpdGlvbjphbGwgdmFyKC0tY2FsY2l0ZS1hbmltYXRpb24tdGltaW5nKSBlYXNlLWluLW91dCAwcywgb3V0bGluZSAwcywgb3V0bGluZS1vZmZzZXQgMHM7cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7cmlnaHQ6MDtib3R0b206MDtsZWZ0OjA7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO2JhY2tncm91bmQtY29sb3I6cmdiYSgyMSwgMjEsIDIxLCAwLjcpO2NvbG9yOndoaXRlfS5pdGVtLWJyb3dzZXItY2FyZF9fdXBwZXJ7ZmxleDoxIDEgMCU7dHJhbnNpdGlvbjphbGwgdmFyKC0tY2FsY2l0ZS1hbmltYXRpb24tdGltaW5nKSBlYXNlLWluLW91dCAwcywgb3V0bGluZSAwcywgb3V0bGluZS1vZmZzZXQgMHM7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMSl9Lml0ZW0tYnJvd3Nlci1jYXJkX191cHBlcjpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktYmFja2dyb3VuZCl9Lml0ZW0tYnJvd3Nlci1jYXJkX191cHBlcjpob3ZlciAuaXRlbS1icm93c2VyLWNhcmRfX2hvdmVyLXRleHQsLml0ZW0tYnJvd3Nlci1jYXJkOmZvY3VzIC5pdGVtLWJyb3dzZXItY2FyZF9faG92ZXItdGV4dHtvcGFjaXR5OjF9Lml0ZW0tYnJvd3Nlci1jYXJkX191cHBlci0tbGlua3t0ZXh0LWRlY29yYXRpb246bm9uZTtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMSk7b3V0bGluZS1jb2xvcjp0cmFuc3BhcmVudH0uaXRlbS1icm93c2VyLWNhcmRfX3VwcGVyLS1saW5rOmZvY3Vze291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktYnJhbmQpO291dGxpbmUtb2Zmc2V0OjJweDt6LWluZGV4OjEwfS5pdGVtLWJyb3dzZXItY2FyZF9fdGl0bGVfX3NwYW57dHJhbnNpdGlvbjphbGwgdmFyKC0tY2FsY2l0ZS1hbmltYXRpb24tdGltaW5nKSBlYXNlLWluLW91dCAwcywgb3V0bGluZSAwcywgb3V0bGluZS1vZmZzZXQgMHM7cG9zaXRpb246cmVsYXRpdmU7ZGlzcGxheTppbmxpbmU7Ym9yZGVyLXN0eWxlOm5vbmU7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDtwYWRkaW5nOjA7YmFja2dyb3VuZC1pbWFnZTpsaW5lYXItZ3JhZGllbnQodHJhbnNwYXJlbnQsIHRyYW5zcGFyZW50KTtiYWNrZ3JvdW5kLXBvc2l0aW9uLXg6MCUsIDEwMCU7YmFja2dyb3VuZC1wb3NpdGlvbi15Om1pbigxLjI1ZW0sIDEwMCUpO2JhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdCwgbm8tcmVwZWF0O2JhY2tncm91bmQtc2l6ZToxMDAlIDFweCwgMTAwJSAxcHh9Lml0ZW0tYnJvd3Nlci1jYXJkLS1wcmV2aWV3ZWQgLml0ZW0tYnJvd3Nlci1jYXJkX190aXRsZV9fc3BhbntiYWNrZ3JvdW5kLWltYWdlOmxpbmVhci1ncmFkaWVudCh2YXIoLS1jYWxjaXRlLXVpLXRleHQtMyksIHZhcigtLWNhbGNpdGUtdWktdGV4dC0zKSl9Lml0ZW0tYnJvd3Nlci1jYXJkX19jb250ZW50e2Rpc3BsYXk6ZmxleDtmbGV4OjEgMSAwJTtmbGV4LWRpcmVjdGlvbjpjb2x1bW47bWluLXdpZHRoOjB9Lml0ZW0tYnJvd3Nlci1jYXJkX19kZXRhaWxze2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpyb3c7bWFyZ2luLXRvcDowLjI1cmVtfS5pdGVtLWJyb3dzZXItY2FyZF9fZGV0YWlse2ZvbnQtc2l6ZTowLjg3NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMil9Lml0ZW0tYnJvd3Nlci1jYXJkX19jYWxlbmRhci1pY29ue2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0zKTstd2Via2l0LW1hcmdpbi1lbmQ6MC41cmVtO21hcmdpbi1pbmxpbmUtZW5kOjAuNXJlbX0uaXRlbS1icm93c2VyLWNhcmRfX2Zvb3RlcntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0xKTtwYWRkaW5nLWxlZnQ6MXJlbTtwYWRkaW5nLXJpZ2h0OjFyZW07cGFkZGluZy10b3A6MC41cmVtO3BhZGRpbmctYm90dG9tOjAuNXJlbTtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO21hcmdpbi10b3A6YXV0bztib3JkZXItdG9wOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLXVpLWJvcmRlci0zKX0uaXRlbS1icm93c2VyLWNhcmRfX2Zvb3Rlcl9fc3RhcnR7ZmxleDoxIDEgMCU7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOnJvdzthbGlnbi1pdGVtczpjZW50ZXI7bWluLXdpZHRoOjA7b3ZlcmZsb3c6aGlkZGVuOy13ZWJraXQtbWFyZ2luLWVuZDowLjc1cmVtO21hcmdpbi1pbmxpbmUtZW5kOjAuNzVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkX19mb290ZXJfX3N0YXJ0LS1vd25lcnstd2Via2l0LW1hcmdpbi1zdGFydDotMC4yNXJlbTttYXJnaW4taW5saW5lLXN0YXJ0Oi0wLjI1cmVtfS5pdGVtLWJyb3dzZXItY2FyZF9fZm9vdGVyX19zdGFydC0tc2VsZWN0YWJsZXstd2Via2l0LW1hcmdpbi1zdGFydDoxLjVyZW07bWFyZ2luLWlubGluZS1zdGFydDoxLjVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkX19wcm9maWxlLXdyYXB7bWF4LXdpZHRoOjEwMCU7cGFkZGluZzowLjI1cmVtO2JveC1zaXppbmc6Ym9yZGVyLWJveH0uaXRlbS1icm93c2VyLWNhcmRfX3N1bW1hcnl7Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0yKTttYXJnaW46MDtwYWRkaW5nOjB9Lml0ZW0tYnJvd3Nlci1jYXJkX19kaXZpZGVye2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7ZmxleDowIDAgYXV0b30uaXRlbS1icm93c2VyLWNhcmRfX2RpdmlkZXI6bm90KFtlbXB0eV0pOmJlZm9yZXtjb250ZW50OlxcXCJcXFwiO2hlaWdodDoxLjI1cmVtO3dpZHRoOjFweDtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktYm9yZGVyLTEpO21hcmdpbi1pbmxpbmU6MC43NXJlbX0uaXRlbS1icm93c2VyLWNhcmRfX2RpdmlkZXI6Zmlyc3QtY2hpbGQ6YmVmb3Jle2Rpc3BsYXk6bm9uZX0uaXRlbS1icm93c2VyLWNhcmQtZmxleHtkaXNwbGF5OmZsZXh9Lml0ZW0tYnJvd3Nlci1jYXJkLWZsZXgtMXtmbGV4OjEgMSAwJTttaW4td2lkdGg6MH0uc2NyZWVuLXJlYWRlcnMtb25seXtwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDoxcHg7aGVpZ2h0OjFweDtwYWRkaW5nOjA7bWFyZ2luOi0xcHg7b3ZlcmZsb3c6aGlkZGVuO2NsaXA6cmVjdCgwLCAwLCAwLCAwKTt3aGl0ZS1zcGFjZTpub3dyYXA7Ym9yZGVyLXdpZHRoOjB9Lml0ZW0tYnJvd3Nlci1jYXJkX19pbnB1dHstd2Via2l0LW1hcmdpbi1lbmQ6MXJlbTttYXJnaW4taW5saW5lLWVuZDoxcmVtO21hcmdpbi10b3A6MC4xMjVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkX190aXRsZXtmb250LXNpemU6MS4xMjVyZW07bWFyZ2luLXRvcDowO21hcmdpbi1ib3R0b206MDtwYWRkaW5nLXRvcDowO3BhZGRpbmctYm90dG9tOjA7d29yZC13cmFwOmJyZWFrLXdvcmQ7b3ZlcmZsb3ctd3JhcDpicmVhay13b3JkO2ZvbnQtd2VpZ2h0OjUwMDtsaW5lLWhlaWdodDoxLjM3NX0uaXRlbS1icm93c2VyLWNhcmRfX3RpdGxlLS1ncmlke2ZvbnQtc2l6ZToxcmVtfS5pdGVtLWJyb3dzZXItY2FyZF9fdGl0bGUtLXBhZGRlZHttYXJnaW4tYm90dG9tOjAuNXJlbX0uaXRlbS1icm93c2VyLWNhcmRfX3NuaXBwZXR7Zm9udC1zaXplOjAuODc1cmVtO21hcmdpbjowO21hcmdpbi1ib3R0b206MC43NXJlbTtwYWRkaW5nOjA7ZmxleDoxIDEgMCV9Lml0ZW0tYnJvd3Nlci1jYXJkX19iYWRnZXMtLXN0YWNrZWR7bWFyZ2luLXRvcDowLjVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkX190aHVtYm5haWx7d2lkdGg6OHJlbTtwYWRkaW5nOjA7bWFyZ2luOjA7Ym94LXNpemluZzpjb250ZW50LWJveDstd2Via2l0LXBhZGRpbmctc3RhcnQ6MnJlbTtwYWRkaW5nLWlubGluZS1zdGFydDoycmVtO2ZsZXg6MCAwIGF1dG99Lml0ZW0tYnJvd3Nlci1jYXJkX190aHVtYm5haWwtLWdyaWR7d2lkdGg6MTAwJTtwYWRkaW5nOjA7bWFyZ2luOjA7cG9zaXRpb246cmVsYXRpdmU7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTIpfS5pdGVtLWJyb3dzZXItY2FyZF9fb3duZXJ7bWluLXdpZHRoOjB9Lml0ZW0tYnJvd3Nlci1jYXJkLS1wYW5lbHttYXJnaW4tYm90dG9tOjA7Y3Vyc29yOnBvaW50ZXI7ZGlzcGxheTpibG9jazt3aWR0aDoxMDAlfS5pdGVtLWJyb3dzZXItY2FyZC0teHMgLml0ZW0tYnJvd3Nlci1jYXJkX190b3AsLml0ZW0tYnJvd3Nlci1jYXJkLS14eHMgLml0ZW0tYnJvd3Nlci1jYXJkX190b3B7cGFkZGluZzowLjc1cmVtfS5pdGVtLWJyb3dzZXItY2FyZC0teHMgLml0ZW0tYnJvd3Nlci1jYXJkX190aXRsZS0tcGFkZGVkLC5pdGVtLWJyb3dzZXItY2FyZC0teHhzIC5pdGVtLWJyb3dzZXItY2FyZF9fdGl0bGUtLXBhZGRlZHttYXJnaW4tYm90dG9tOjAuMjVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkLS14cyAuaXRlbS1icm93c2VyLWNhcmRfX2Zvb3RlciwuaXRlbS1icm93c2VyLWNhcmQtLXh4cyAuaXRlbS1icm93c2VyLWNhcmRfX2Zvb3RlcntwYWRkaW5nLXRvcDowLjI1cmVtO3BhZGRpbmctYm90dG9tOjAuMjVyZW07cGFkZGluZy1sZWZ0OjAuNzVyZW07cGFkZGluZy1yaWdodDowLjc1cmVtfS5pdGVtLWJyb3dzZXItY2FyZC0teHMgLml0ZW0tYnJvd3Nlci1jYXJkX19kZXRhaWwsLml0ZW0tYnJvd3Nlci1jYXJkLS14eHMgLml0ZW0tYnJvd3Nlci1jYXJkX19kZXRhaWx7Zm9udC1zaXplOjAuNzVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkLS14cyAuaXRlbS1icm93c2VyLWNhcmRfX3RpdGxlLC5pdGVtLWJyb3dzZXItY2FyZC0teHhzIC5pdGVtLWJyb3dzZXItY2FyZF9fdGl0bGV7Zm9udC1zaXplOjAuODc1cmVtfS5pdGVtLWJyb3dzZXItY2FyZC0teHhzIC5pdGVtLWJyb3dzZXItY2FyZF9fdGl0bGV7Zm9udC1zaXplOjAuNzVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkLS14eHMgLml0ZW0tYnJvd3Nlci1jYXJkX190aHVtYm5haWx7d2lkdGg6NTVweDstd2Via2l0LXBhZGRpbmctc3RhcnQ6MC43NXJlbTtwYWRkaW5nLWlubGluZS1zdGFydDowLjc1cmVtfS5pdGVtLWJyb3dzZXItY2FyZC0teHhzIC5pdGVtLWJyb3dzZXItY2FyZF9fZm9vdGVyX19zdGFydHstd2Via2l0LW1hcmdpbi1lbmQ6MC41cmVtO21hcmdpbi1pbmxpbmUtZW5kOjAuNXJlbX0uaXRlbS1icm93c2VyLWNhcmQtLXhzIC5pdGVtLWJyb3dzZXItY2FyZF9fdGh1bWJuYWlse3dpZHRoOjVyZW07LXdlYmtpdC1wYWRkaW5nLXN0YXJ0OjAuNXJlbTtwYWRkaW5nLWlubGluZS1zdGFydDowLjVyZW19XCI7XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyQ2FyZCQxID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VySW50ZXJuYWxVSUFjdGlvbiA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uXCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJDYXJkU2VsZWN0ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckNhcmRTZWxlY3RcIiwgNyk7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckNhcmRQcmV2aWV3ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckNhcmRQcmV2aWV3XCIsIDcpO1xuICAgIHZhciBfYTtcbiAgICB0aGlzLmhhbmRsZVJlc2l6ZUV2ZW50ID0gKGUpID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB0aGlzLnJlc2l6ZShlLmRldGFpbC53aWR0aCk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZUNhcmRDbGljayA9ICgpID0+IHtcbiAgICAgIHZhciBfYTtcbiAgICAgIC8vIHdoZW4gdXNpbmcgdGhlIGNhcmRzIGFzIGEgbGluaywgZG9uJ3QgZG8gYW55IHNwZWNpYWwgaGFuZGxpbmdcbiAgICAgIGlmICh0aGlzLmxpbmspIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgcHJldmlldyA9IHRoaXMucHJldmlldyA9PT0gXCJ0b3BcIjtcbiAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IChfYSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZS5zZWxlY3Rpb247XG4gICAgICBjb25zdCB7IGl0ZW0gfSA9IHRoaXM7XG4gICAgICBpZiAocHJldmlldykge1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFByZXZpZXcuZW1pdChpdGVtKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHNlbGVjdGlvbiA9PT0gXCJzaW5nbGVcIikge1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFNlbGVjdC5lbWl0KHsgaXRlbSwgc2VsZWN0ZWQ6IHRydWUgfSk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChzZWxlY3Rpb24gPT09IFwibXVsdGlwbGVcIikge1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFNlbGVjdC5lbWl0KHtcbiAgICAgICAgICBpdGVtLFxuICAgICAgICAgIHNlbGVjdGVkOiAhaXNTZWxlY3RlZCh7IGl0ZW0sIHNlbGVjdGVkSXRlbXM6IHRoaXMuc3RvcmUuc3RhdGUuc2VsZWN0ZWRJdGVtcyB9KVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuaXRlbSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5hcGkgPSA0O1xuICAgIHRoaXMuYmFzZVVybCA9IChfYSA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS5jb25maWcpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5iYXNlVXJsO1xuICAgIHRoaXMubGluayA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm5ld1RhYiA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNlbGVjdGVkID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2VsZWN0aW9uID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubmFtZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnByZXZpZXcgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zaG93T3duZXIgPSB0cnVlO1xuICAgIHRoaXMuc2hvd0RhdGVVcGRhdGVkID0gdHJ1ZTtcbiAgICB0aGlzLnNob3dJdGVtVHlwZSA9IHRydWU7XG4gICAgdGhpcy5zaG93U3VtbWFyeSA9IGZhbHNlO1xuICAgIHRoaXMuc2hvd0JhZGdlcyA9IHRydWU7XG4gICAgdGhpcy5zaG93VGh1bWJuYWlsID0gdHJ1ZTtcbiAgICB0aGlzLmFjdGlvbnMgPSBbXTtcbiAgICB0aGlzLmhvdmVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZm9ybUZhY3RvciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnVwZGF0ZWRUZXh0ID0gXCJcIjtcbiAgICB0aGlzLnNob3J0VXBkYXRlZFRleHQgPSBcIlwiO1xuICAgIHRoaXMubG9hZGVkID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubm9TcGFjZUZvckRhdGUgPSB0cnVlO1xuICB9XG4gIC8qIENhbGxpbmcgdGhpcyBzZXRGb2N1cyBjYXVzZXMgY2FsY2l0ZSB0byBmb2N1cyBoZXJlIHdoZW4gdGhlIHVzZXIgcG9wdXAgaXMgY2xvc2VkLi4uICovXG4gIGFzeW5jIHJlc3RvcmVGb2N1cygpIHtcbiAgICBpZiAodGhpcy5saW5rICYmIHRoaXMubGlua0VsKSB7XG4gICAgICB0aGlzLmxpbmtFbC5mb2N1cygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy5wcmV2aWV3ID09PSBcInRvcFwiICYmIHRoaXMuc2VjdGlvbkVsKSB7XG4gICAgICB0aGlzLnNlY3Rpb25FbC5mb2N1cygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5jYXJkO1xuICAgIChfYSA9IHRoaXMuZm9ybUZhY3RvcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKHRoaXMuZm9ybUZhY3RvciA9ICgoX2IgPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc3RhdGUucGFuZWwpID8gXCJ4c1wiIDogXCJsZ1wiKTtcbiAgICBzZXR1cFJlc2l6ZU9ic2VydmVyKHRoaXMuc3RvcmUpLm9ic2VydmUodGhpcy5lbCk7XG4gICAgdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzQnJvd3NlclJlc2l6ZVwiLCB0aGlzLmhhbmRsZVJlc2l6ZUV2ZW50KTtcbiAgICBjb25zdCBmb3JtYXR0ZWREYXRlID0gZm9ybWF0RGF0ZSh0aGlzLml0ZW0ubW9kaWZpZWQpO1xuICAgIHRoaXMudXBkYXRlZFRleHQgPSB0aGlzLmkxOG4ubGFzdFVwZGF0ZWQucmVwbGFjZShcIiR7ZGF0ZX1cIiwgZm9ybWF0dGVkRGF0ZSk7XG4gICAgdGhpcy5zaG9ydFVwZGF0ZWRUZXh0ID0gZm9ybWF0dGVkRGF0ZTtcbiAgICB0aGlzLnBvcnRhbCA9IChfYyA9IHRoaXMucG9ydGFsKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiBjb25maWdTdGF0ZS5wb3J0YWw7XG4gICAgdGhpcy51c2VyID0gKF9kID0gdGhpcy51c2VyKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiBjb25maWdTdGF0ZS51c2VyO1xuICAgIHRoaXMuYXBpID0gKF9lID0gdGhpcy5hcGkpICE9PSBudWxsICYmIF9lICE9PSB2b2lkIDAgPyBfZSA6IGNvbmZpZ1N0YXRlLmFwaTtcbiAgfVxuICBhc3luYyBjb21wb25lbnREaWRMb2FkKCkge1xuICAgIGF3YWl0IHRpbWVvdXQoMTAwKTtcbiAgICB0aGlzLmxvYWRlZCA9IHRydWU7XG4gIH1cbiAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgIChfYyA9IChfYiA9IChfYSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnJlc2l6ZU9ic2VydmVyKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MudW5vYnNlcnZlKHRoaXMuZWwpO1xuICAgIChfZCA9IHRoaXMuZWwpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5yZW1vdmVFdmVudExpc3RlbmVyKFwiYXJjZ2lzQnJvd3NlclJlc2l6ZVwiLCB0aGlzLmhhbmRsZVJlc2l6ZUV2ZW50KTtcbiAgfVxuICByZXNpemUod2lkdGgpIHtcbiAgICBzd2l0Y2ggKHRydWUpIHtcbiAgICAgIGNhc2Ugd2lkdGggPiBicmVha3BvaW50cy5tZDpcbiAgICAgICAgdGhpcy5mb3JtRmFjdG9yID0gXCJsZ1wiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2Ugd2lkdGggPiBicmVha3BvaW50cy5zbTpcbiAgICAgICAgdGhpcy5mb3JtRmFjdG9yID0gXCJtZFwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2Ugd2lkdGggPiBicmVha3BvaW50cy54czpcbiAgICAgICAgdGhpcy5mb3JtRmFjdG9yID0gXCJzbVwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2Ugd2lkdGggPiBicmVha3BvaW50cy54eHM6XG4gICAgICAgIHRoaXMuZm9ybUZhY3RvciA9IFwieHNcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aGlzLmZvcm1GYWN0b3IgPSBcInh4c1wiO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mLCBfZywgX2gsIF9qLCBfaztcbiAgICBjb25zdCB7IGl0ZW0sIHVzZXIsIHBvcnRhbCwgZm9ybUZhY3RvciwgYXBpLCBpMThuLCBsb2FkZWQsIHNob3dEYXRlVXBkYXRlZCwgc2hvd0l0ZW1UeXBlLCBzaG93T3duZXIsIHNob3dCYWRnZXMsIHNob3dTdW1tYXJ5LCBzaG93VGh1bWJuYWlsLCBsaW5rLCBuZXdUYWIgfSA9IHRoaXM7XG4gICAgY29uc3QgaXNPbmxpbmVJblBvcnRhbCA9IChwb3J0YWwgPT09IG51bGwgfHwgcG9ydGFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3J0YWwuaXNQb3J0YWwpICYmIHRoaXMuc3RvcmUuc3RhdGUuYnVja2V0ID09PSBcImFsbFwiO1xuICAgIGNvbnN0IGJhc2VVcmwgPSBpc09ubGluZUluUG9ydGFsID8gXCJodHRwczovL3d3dy5hcmNnaXMuY29tL2hvbWUvXCIgOiAoX2EgPSB0aGlzLmJhc2VVcmwpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYiA9IGNvbmZpZ1N0YXRlLmNvbmZpZykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmJhc2VVcmw7XG4gICAgY29uc3QgY3VycmVudCA9ICgoX2MgPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Muc3RhdGUucHJldmlldykgPT09IHRoaXMuaXRlbS5pZDtcbiAgICBjb25zdCBncmlkID0gKChfZCA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5zdGF0ZS52aWV3KSA9PT0gXCJncmlkXCI7XG4gICAgY29uc3QgdG9wUHJldmlldyA9IHRoaXMucHJldmlldyA9PT0gXCJ0b3BcIjtcbiAgICBjb25zdCB0b3BQcmV2aWV3QXR0cmlidXRlcyA9IHtcbiAgICAgIHRhYkluZGV4OiAwLFxuICAgICAgcm9sZTogXCJidXR0b25cIixcbiAgICAgIFwiYXJpYS1oYXNwb3B1cFwiOiBcImRpYWxvZ1wiLFxuICAgICAgXCJhcmlhLWxhYmVsbGVkYnlcIjogXCJvcGVuLWRldGFpbHNcIixcbiAgICAgIG9uS2V5UHJlc3M6IChlKSA9PiB7XG4gICAgICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiIHx8IGUua2V5ID09IFwiIFwiKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIHRoaXMuaGFuZGxlQ2FyZENsaWNrKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IHNlbGVjdGlvbiA9IChfZSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5zdGF0ZS5zZWxlY3Rpb247XG4gICAgY29uc3QgaXRlbVNlbGVjdGlvbiA9IFtcInNpbmdsZVwiLCBcIm11bHRpcGxlXCJdLmluY2x1ZGVzKHNlbGVjdGlvbik7XG4gICAgY29uc3Qgc2VsZWN0ZWQgPSBpdGVtU2VsZWN0aW9uICYmXG4gICAgICBpc1NlbGVjdGVkKHsgaXRlbTogdGhpcy5pdGVtLCBzZWxlY3RlZEl0ZW1zOiAoX2YgPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfZiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Yuc3RhdGUuc2VsZWN0ZWRJdGVtcyB9KTtcbiAgICBjb25zdCBDYXJkVGFnID0gdGhpcy5saW5rID8gXCJhXCIgOiBcImRpdlwiO1xuICAgIGNvbnN0IGxpbmtBdHRyaWJ1dGVzID0gT2JqZWN0LmFzc2lnbih7IGhyZWY6IGxpbmsgfSwgKG5ld1RhYiA/IHsgdGFyZ2V0OiBcIl9ibGFua1wiLCByZWw6IFwibm9vcGVuZXIgbm9yZWZlcnJlclwiIH0gOiB7fSkpO1xuICAgIGNvbnN0IGV4dHJhU21hbGwgPSBbXCJ4eHNcIiwgXCJ4c1wiXS5pbmNsdWRlcyhmb3JtRmFjdG9yKTtcbiAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcInNlY3Rpb25cIiwgT2JqZWN0LmFzc2lnbih7IGNsYXNzOiB7XG4gICAgICAgIFwiaXRlbS1icm93c2VyLWNhcmRcIjogdHJ1ZSxcbiAgICAgICAgXCJpdGVtLWJyb3dzZXItY2FyZC0taG92ZXJhYmxlXCI6IHRydWUsXG4gICAgICAgIFtgaXRlbS1icm93c2VyLWNhcmQtLSR7Zm9ybUZhY3Rvcn1gXTogdHJ1ZSxcbiAgICAgICAgXCJpdGVtLWJyb3dzZXItY2FyZC0tcGFuZWxcIjogKF9nID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2cgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9nLnN0YXRlLnBhbmVsLFxuICAgICAgICBcIml0ZW0tYnJvd3Nlci1jYXJkLS1sb2FkZWRcIjogbG9hZGVkLFxuICAgICAgICBcIml0ZW0tYnJvd3Nlci1jYXJkLS1wcmV2aWV3ZWRcIjogKChfaCA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9oID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfaC5zdGF0ZS5wcmV2aWV3KSA9PT0gaXRlbS5pZCxcbiAgICAgICAgXCJpdGVtLWJyb3dzZXItY2FyZC0tc2VsZWN0ZWRcIjogc2VsZWN0ZWRcbiAgICAgIH0sIG9uTW91c2VPdmVyOiAoKSA9PiAodGhpcy5ob3ZlciA9IHRydWUpLCBvbk1vdXNlT3V0OiAoKSA9PiAodGhpcy5ob3ZlciA9IGZhbHNlKSB9LCAobGluayA/IHt9IDogeyBvbkNsaWNrOiB0aGlzLmhhbmRsZUNhcmRDbGljayB9KSwgKHRvcFByZXZpZXcgJiYgIWxpbmsgPyB0b3BQcmV2aWV3QXR0cmlidXRlcyA6IHt9KSwgeyByZWY6IChlbCkgPT4gKHRoaXMuc2VjdGlvbkVsID0gZWwpIH0pLCBoKFwic2xvdFwiLCB7IG5hbWU6IFwiY29udGVudC10b3BcIiB9KSwgaChDYXJkVGFnLCBPYmplY3QuYXNzaWduKHsgY2xhc3M6IHsgXCJpdGVtLWJyb3dzZXItY2FyZF9fdXBwZXJcIjogdHJ1ZSwgXCJpdGVtLWJyb3dzZXItY2FyZF9fdXBwZXItLWxpbmtcIjogISFsaW5rIH0gfSwgKGxpbmsgPyBsaW5rQXR0cmlidXRlcyA6IHt9KSwgeyByZWY6IChlbCkgPT4gKHRoaXMubGlua0VsID0gZWwpIH0pLCBncmlkICYmIHNob3dUaHVtYm5haWwgJiYgKGgoXCJmaWd1cmVcIiwgeyBjbGFzczogXCJpdGVtLWJyb3dzZXItY2FyZF9fdGh1bWJuYWlsLS1ncmlkXCIgfSwgaChcImFyY2dpcy1pdGVtLWJyb3dzZXItY2FyZC10aHVtYm5haWxcIiwgeyBpdGVtOiBpdGVtLCB1c2VyOiB1c2VyLCBwb3J0YWw6IHBvcnRhbCB9KSwgdG9wUHJldmlldyAmJiAhbGluayAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBcIml0ZW0tYnJvd3Nlci1jYXJkX19ob3Zlci10ZXh0XCIsIGlkOiBcIm9wZW4tZGV0YWlsc1wiIH0sICgoX2sgPSAoX2ogPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfaiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2ouc3RhdGUpID09PSBudWxsIHx8IF9rID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfay5wcmV2aWV3KSA9PT0gaXRlbS5pZCA/IGkxOG4uY2xvc2VEZXRhaWxzIDogaTE4bi5vcGVuRGV0YWlscykpKSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJpdGVtLWJyb3dzZXItY2FyZC1mbGV4IGl0ZW0tYnJvd3Nlci1jYXJkX190b3BcIiB9LCBzZWxlY3Rpb24gPT09IFwic2luZ2xlXCIgJiYgKGgoXCJjYWxjaXRlLXJhZGlvLWJ1dHRvblwiLCB7IGNsYXNzOiBcIml0ZW0tYnJvd3Nlci1jYXJkX19pbnB1dFwiLCBjaGVja2VkOiBzZWxlY3RlZCwgdmFsdWU6IGl0ZW0udGl0bGUsIG5hbWU6IHRoaXMubmFtZSwgb25DbGljazogKGUpID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIH0sIG9uQ2FsY2l0ZVJhZGlvQnV0dG9uQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJDYXJkU2VsZWN0LmVtaXQoeyBpdGVtLCBzZWxlY3RlZDogdHJ1ZSB9KTtcbiAgICAgIH0gfSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJzY3JlZW4tcmVhZGVycy1vbmx5XCIgfSwgaTE4bi5zZWxlY3QucmVwbGFjZShcIiR7dGl0bGV9XCIsIGl0ZW0udGl0bGUpKSkpLCBzZWxlY3Rpb24gPT09IFwibXVsdGlwbGVcIiAmJiAoaChcImNhbGNpdGUtY2hlY2tib3hcIiwgeyBjbGFzczogXCJpdGVtLWJyb3dzZXItY2FyZF9faW5wdXRcIiwgY2hlY2tlZDogc2VsZWN0ZWQsIG9uQ2xpY2s6IChlKSA9PiB7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB9LCBvbkNhbGNpdGVDaGVja2JveENoYW5nZTogKCkgPT4ge1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFNlbGVjdC5lbWl0KHsgaXRlbSwgc2VsZWN0ZWQ6ICFzZWxlY3RlZCB9KTtcbiAgICAgIH0sIHZhbHVlOiBpdGVtLmlkIH0sIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwic2NyZWVuLXJlYWRlcnMtb25seVwiIH0sIGl0ZW0udGl0bGUpKSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJpdGVtLWJyb3dzZXItY2FyZC1mbGV4LTFcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaXRlbS1icm93c2VyLWNhcmQtZmxleFwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJpdGVtLWJyb3dzZXItY2FyZF9fY29udGVudFwiIH0sIGgoXCJoM1wiLCB7IGNsYXNzOiB7XG4gICAgICAgIFwiaXRlbS1icm93c2VyLWNhcmRfX3RpdGxlXCI6IHRydWUsXG4gICAgICAgIFwiaXRlbS1icm93c2VyLWNhcmRfX3RpdGxlLS1wYWRkZWRcIjogc2hvd0l0ZW1UeXBlIHx8IChzaG93U3VtbWFyeSAmJiAhIWl0ZW0uc25pcHBldCksXG4gICAgICAgIFwiaXRlbS1icm93c2VyLWNhcmRfX3RpdGxlLS1ncmlkXCI6IGdyaWRcbiAgICAgIH0gfSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJpdGVtLWJyb3dzZXItY2FyZF9fdGl0bGVfX3NwYW5cIiB9LCBpdGVtLnRpdGxlKSksIHNob3dTdW1tYXJ5ICYmIGl0ZW0uc25pcHBldCAmJiAhZXh0cmFTbWFsbCAmJiAoaChcInBcIiwgeyBjbGFzczogXCJpdGVtLWJyb3dzZXItY2FyZF9fc3VtbWFyeVwiIH0sIGl0ZW0uc25pcHBldC5sZW5ndGggPiAyNTBcbiAgICAgID8gYCR7aXRlbS5zbmlwcGV0LnN1YnN0cmluZygwLCAyNTApfeKApmBcbiAgICAgIDogaXRlbS5zbmlwcGV0KSksIGV4dHJhU21hbGwgJiYgc2hvd0l0ZW1UeXBlICYmIChoKFwiYXJjZ2lzLWl0ZW0tdHlwZVwiLCB7IHNjYWxlOiBleHRyYVNtYWxsID8gXCJzXCIgOiBcIm1cIiwgaXRlbTogaXRlbSwgcG9ydGFsOiBwb3J0YWwgfSkpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaXRlbS1icm93c2VyLWNhcmRfX2RldGFpbHNcIiB9LCAhZXh0cmFTbWFsbCAmJiBzaG93SXRlbVR5cGUgJiYgKGgoXCJhcmNnaXMtaXRlbS10eXBlXCIsIHsgY2xhc3M6IFwiaXRlbS1icm93c2VyLWNhcmRfX2RpdmlkZXJcIiwgc2NhbGU6IGV4dHJhU21hbGwgPyBcInNcIiA6IFwibVwiLCBpdGVtOiBpdGVtLCBwb3J0YWw6IHBvcnRhbCB9KSksIHNob3dEYXRlVXBkYXRlZCAmJiBmb3JtRmFjdG9yICE9PSBcInh4c1wiICYmIChoKFwic3BhblwiLCB7IGNsYXNzOiB7XG4gICAgICAgIFwiaXRlbS1icm93c2VyLWNhcmRfX2RldGFpbFwiOiB0cnVlLFxuICAgICAgICBcIml0ZW0tYnJvd3Nlci1jYXJkX19kaXZpZGVyXCI6IHRydWVcbiAgICAgIH0gfSwgW1wieHhzXCIsIFwieHNcIiwgXCJzbVwiXS5pbmNsdWRlcyhmb3JtRmFjdG9yKSB8fCBncmlkXG4gICAgICA/IHRoaXMuc2hvcnRVcGRhdGVkVGV4dFxuICAgICAgOiB0aGlzLnVwZGF0ZWRUZXh0KSksIHNob3dCYWRnZXMgJiYgKGgoXCJhcmNnaXMtaXRlbS1iYWRnZXNcIiwgeyBpdGVtOiBpdGVtLCB1c2VyOiB1c2VyLCBwb3J0YWw6IHBvcnRhbCwgd2lkdGg6IGZvcm1GYWN0b3IgPT09IFwibGdcIiAmJiAhZ3JpZCA/IFwiZnVsbFwiIDogXCJuYXJyb3dcIiwgc2hvd1Rvb2x0aXBzOiB0cnVlLCBjbGFzczoge1xuICAgICAgICBcIml0ZW0tYnJvd3Nlci1jYXJkX19iYWRnZXNcIjogdHJ1ZSxcbiAgICAgICAgXCJpdGVtLWJyb3dzZXItY2FyZF9fZGl2aWRlclwiOiB0cnVlXG4gICAgICB9LCBzY2FsZTogXCJzXCIgfSkpKSksICFncmlkICYmIHNob3dUaHVtYm5haWwgJiYgKGgoXCJmaWd1cmVcIiwgeyBjbGFzczogXCJpdGVtLWJyb3dzZXItY2FyZF9fdGh1bWJuYWlsXCIgfSwgaChcImFyY2dpcy1pdGVtLWJyb3dzZXItY2FyZC10aHVtYm5haWxcIiwgeyBpdGVtOiBpdGVtLCB1c2VyOiB1c2VyLCBwb3J0YWw6IHBvcnRhbCB9KSkpKSwgaChcInNsb3RcIiwgeyBuYW1lOiBcImNvbnRlbnQtZW5kXCIgfSkpKSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJpdGVtLWJyb3dzZXItY2FyZF9fZm9vdGVyXCIsIG9uQ2xpY2s6IChlKSA9PiB7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB9LCBvbktleVByZXNzOiAoZSkgPT4ge1xuICAgICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIiB8fCBlLmtleSA9PSBcIiBcIikge1xuICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgIH0gfSwgaChcImRpdlwiLCB7IGNsYXNzOiB7XG4gICAgICAgIFwiaXRlbS1icm93c2VyLWNhcmRfX2Zvb3Rlcl9fc3RhcnRcIjogdHJ1ZSxcbiAgICAgICAgXCJpdGVtLWJyb3dzZXItY2FyZF9fZm9vdGVyX19zdGFydC0tb3duZXJcIjogc2hvd093bmVyLFxuICAgICAgICBcIml0ZW0tYnJvd3Nlci1jYXJkX19mb290ZXJfX3N0YXJ0LS1zZWxlY3RhYmxlXCI6IGl0ZW1TZWxlY3Rpb25cbiAgICAgIH0gfSwgaChcInNsb3RcIiwgeyBuYW1lOiBcImFjdGlvbnMtc3RhcnRcIiB9KSwgc2hvd093bmVyICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaXRlbS1icm93c2VyLWNhcmRfX3Byb2ZpbGUtd3JhcFwiLCBvbkNsaWNrOiAoZSkgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB9IH0sIGgoXCJhcmNnaXMtdXNlci1wb3B1cFwiLCB7IHVuZGVybGluZTogdHJ1ZSwgaXRlbTogaXRlbSwgYXBpOiBhcGksIHBvcnRhbDogcG9ydGFsLCBiYXNlVXJsOiBiYXNlVXJsLCBjaGVja09ubGluZTogcG9ydGFsLmlzUG9ydGFsICYmIHRoaXMuc3RvcmUuc3RhdGUuYnVja2V0ID09PSBcImFsbFwiLCBjbGFzczogXCJpdGVtLWJyb3dzZXItY2FyZF9fb3duZXJcIiwgc2NhbGU6IFtcIm1kXCIsIFwibGdcIl0uaW5jbHVkZXMoZm9ybUZhY3RvcikgPyBcIm1cIiA6IFwic1wiLCBvbkFyY2dpc1VzZXJQb3B1cEludGVybmFsVUlBY3Rpb246IChlKSA9PiB7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uLmVtaXQoZS5kZXRhaWwpO1xuICAgICAgfSB9KSkpKSwgdGhpcy5wcmV2aWV3ID09PSBcImFjdGlvblwiICYmIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzY2FsZTogXCJzXCIsIGFwcGVhcmFuY2U6IGN1cnJlbnQgPyBcInNvbGlkXCIgOiBcIm91dGxpbmVcIiwga2luZDogXCJuZXV0cmFsXCIsIG9uQ2xpY2s6IChlKSA9PiB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckNhcmRQcmV2aWV3LmVtaXQodGhpcy5pdGVtKTtcbiAgICAgIH0gfSwgY3VycmVudCA/IGkxOG4uaGlkZVByZXZpZXcgOiBpMThuLnByZXZpZXcpKSwgKHNlbGVjdGlvbiA9PT0gbnVsbCB8fCBzZWxlY3Rpb24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdGlvbi5pbmNsdWRlcyhcInN1YmxheWVyXCIpKSAmJiAoaChcImFyY2dpcy1pdGVtLWJyb3dzZXItY2FyZC1zdWJsYXllci1zZWxlY3RcIiwgeyBpdGVtOiBpdGVtLCB1c2VyOiB1c2VyLCBwb3J0YWw6IHBvcnRhbCwgc2VsZWN0aW9uOiBzZWxlY3Rpb24gPT09IFwibXVsdGlwbGUtc3VibGF5ZXJcIiA/IFwibXVsdGlwbGVcIiA6IFwic2luZ2xlXCIsIHNob3dFcnJvcnM6IHRydWUgfSkpLCB0aGlzLmFjdGlvbnMubGVuZ3RoID4gMCAmJiAoaChcImNhbGNpdGUtZHJvcGRvd25cIiwgeyBwbGFjZW1lbnQ6IFwiYm90dG9tLWVuZFwiLCBzY2FsZTogXCJtXCIsIG92ZXJsYXlQb3NpdGlvbmluZzogXCJmaXhlZFwiIH0sIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHNjYWxlOiBcInNcIiwgc2xvdDogXCJ0cmlnZ2VyXCIsIGFsaWdubWVudDogXCJjZW50ZXJcIiwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCB0ZXh0OiBpMThuLm1vcmVPcHRpb25zLCB0ZXh0RW5hYmxlZDogZmFsc2UsIGljb246IFwiZWxsaXBzaXNcIiB9KSwgaChcImNhbGNpdGUtZHJvcGRvd24tZ3JvdXBcIiwgeyBzZWxlY3Rpb25Nb2RlOiBcIm5vbmVcIiB9LCB0aGlzLmFjdGlvbnMubWFwKCh7IHRleHQsIG5ld1RhYiwgbGluaywgYWN0aW9uIH0pID0+IChoKFwiY2FsY2l0ZS1kcm9wZG93bi1pdGVtXCIsIE9iamVjdC5hc3NpZ24oeyBvbkNsaWNrOiAoZSkgPT4ge1xuICAgICAgICBpZiAoYWN0aW9uKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGFjdGlvbigpO1xuICAgICAgICB9XG4gICAgICB9IH0sICghYWN0aW9uICYmIGxpbmtcbiAgICAgID8gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCAobmV3VGFiID8geyB0YXJnZXQ6IFwiX2JsYW5rXCIsIHJlbDogXCJub29wZW5lciBub3JlZmVycmVyXCIgfSA6IHt9KSksIHsgaHJlZjogbGluayB9KSA6IHt9KSksIHRleHQpKSkpKSksIGgoXCJzbG90XCIsIHsgbmFtZTogXCJhY3Rpb25zLWVuZFwiIH0pKSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzSXRlbUJyb3dzZXJDYXJkJDEuc3R5bGUgPSBhcmNnaXNJdGVtQnJvd3NlckNhcmRDc3M7XG5cbmNvbnN0IGFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFN1YmxheWVyU2VsZWN0Q3NzID0gXCIudGl0bGV7bWF4LXdpZHRoOjMycmVtO3dvcmQtd3JhcDpicmVhay13b3JkO3dvcmQtYnJlYWs6YnJlYWstd29yZH0uZHJvcGRvd24taXRlbS1kaXNhYmxlZHtwb2ludGVyLWV2ZW50czpub25lO29wYWNpdHk6dmFyKC0tY2FsY2l0ZS11aS1vcGFjaXR5LWRpc2FibGVkKX0uZHJvcGRvd257ZGlzcGxheTpibG9ja31cIjtcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJDYXJkID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFNlbGVjdCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJDYXJkU2VsZWN0XCIsIDcpO1xuICAgIHRoaXMucmVuZGVyU3VibGF5ZXIgPSAoc3VibGF5ZXIpID0+IHtcbiAgICAgIHZhciBfYSwgX2I7XG4gICAgICBjb25zdCB7IGl0ZW0sIHN0b3JlIH0gPSB0aGlzO1xuICAgICAgY29uc3QgZGlzYWJsZWQgPSAhKChfYiA9IChfYSA9IHN0b3JlID09PSBudWxsIHx8IHN0b3JlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzdG9yZS5zdGF0ZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmFsbG93ZWRHZW9tZXRyaWVzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuaW5jbHVkZXMoc3VibGF5ZXIuZ2VvbWV0cnlUeXBlKSk7XG4gICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIiwgT2JqZWN0LmFzc2lnbih7IGljb25TdGFydDogZ2V0U2VhcmNoU3VibGF5ZXJJY29uKHN1YmxheWVyLmdlb21ldHJ5VHlwZSksIHNlbGVjdGVkOiBpc1NlbGVjdGVkKHtcbiAgICAgICAgICBpdGVtLFxuICAgICAgICAgIHN1YmxheWVyLFxuICAgICAgICAgIHNlbGVjdGVkSXRlbXM6IHN0b3JlLnN0YXRlLnNlbGVjdGVkSXRlbXNcbiAgICAgICAgfSkgfSwgKGRpc2FibGVkXG4gICAgICAgID8geyBhcmlhRGlzYWJsZWQ6IHRydWUsIHRhYkluZGV4OiAtMSwgY2xhc3NOYW1lOiBcImRyb3Bkb3duLWl0ZW0tZGlzYWJsZWRcIiB9XG4gICAgICAgIDoge30pLCB7IHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgaWYgKGRpc2FibGVkKSB7XG4gICAgICAgICAgICBlbC50YWJJbmRleCA9IC0xO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgb25DYWxjaXRlRHJvcGRvd25JdGVtU2VsZWN0OiAoZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gZS5jdXJyZW50VGFyZ2V0LnNlbGVjdGVkO1xuICAgICAgICAgIGNvbnN0IHsgaXRlbSB9ID0gdGhpcztcbiAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFNlbGVjdC5lbWl0KHtcbiAgICAgICAgICAgIGl0ZW0sXG4gICAgICAgICAgICBzdWJsYXllcixcbiAgICAgICAgICAgIC8vIHNpbmdsZSBzZWxlY3Qgc2hvdWxkIHJlbWFpbiBzZWxlY3RlZCBvbiBjbGljaywgbXVsdGkgc2VsZWN0IHNob3VsZCB0b2dnbGVcbiAgICAgICAgICAgIHNlbGVjdGVkOiB0aGlzLnNlbGVjdGlvbiA9PT0gXCJzaW5nbGVcIiB8fCAhc2VsZWN0ZWRcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSB9KSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJ0aXRsZVwiIH0sIHN1YmxheWVyLnRpdGxlKSkpO1xuICAgIH07XG4gICAgdGhpcy5pc0FsbG93ZWRHZW9tZXRyeSA9IChnZW9tZXRyeSkgPT4geyB2YXIgX2EsIF9iLCBfYzsgcmV0dXJuIChfYyA9IChfYiA9IChfYSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmFsbG93ZWRHZW9tZXRyaWVzKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuaW5jbHVkZXMoZ2VvbWV0cnkpOyB9O1xuICAgIHRoaXMuc29ydFN1YmxheWVycyA9IChhLCBiKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZEEgPSB0aGlzLmlzQWxsb3dlZEdlb21ldHJ5KGEuZ2VvbWV0cnlUeXBlKTtcbiAgICAgIGNvbnN0IHZhbGlkQiA9IHRoaXMuaXNBbGxvd2VkR2VvbWV0cnkoYi5nZW9tZXRyeVR5cGUpO1xuICAgICAgaWYgKHZhbGlkQSA9PT0gdmFsaWRCKSB7XG4gICAgICAgIHJldHVybiBiLmlkIC0gYS5pZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2YWxpZEEgPyAtMSA6IDE7XG4gICAgfTtcbiAgICB0aGlzLnJlbmRlclNlbGVjdFRleHQgPSAoc2VsZWN0ZWRTdWJsYXllcnMpID0+IHtcbiAgICAgIHZhciBfYSwgX2I7XG4gICAgICBjb25zdCBtdWx0aXBsZSA9IHRoaXMuc2VsZWN0aW9uID09PSBcIm11bHRpcGxlXCI7XG4gICAgICBpZiAodGhpcy5pdGVtICYmICF0aGlzLml0ZW0uc3VibGF5ZXJzKSB7XG4gICAgICAgIGlmIChpc1NlbGVjdGVkKHsgaXRlbTogdGhpcy5pdGVtLCBzZWxlY3RlZEl0ZW1zOiAoX2EgPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhdGUuc2VsZWN0ZWRJdGVtcyB9KSkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmkxOG4uc2VsZWN0ZWRTaW5nbGU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuaTE4bi5zZWxlY3Q7XG4gICAgICB9XG4gICAgICBpZiAoKHNlbGVjdGVkU3VibGF5ZXJzID09PSBudWxsIHx8IHNlbGVjdGVkU3VibGF5ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZFN1YmxheWVycy5sZW5ndGgpID09PSAwKSB7XG4gICAgICAgIHJldHVybiBtdWx0aXBsZSA/IHRoaXMuaTE4bi5zZWxlY3RMYXllcnMgOiB0aGlzLmkxOG4uc2VsZWN0O1xuICAgICAgfVxuICAgICAgaWYgKG11bHRpcGxlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmkxOG4uc2VsZWN0ZWRMYXllcnMucmVwbGFjZShcIiR7bnVtfVwiLCBgJHtzZWxlY3RlZFN1YmxheWVycy5sZW5ndGh9YCk7XG4gICAgICB9XG4gICAgICBjb25zdCBzZWxlY3RlZCA9IHNlbGVjdGVkU3VibGF5ZXJzWzBdO1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgcmV0dXJuIHRoaXMuaTE4bi5zZWxlY3RlZE5hbWUucmVwbGFjZShcIiR7bmFtZX1cIiwgKF9iID0gc2VsZWN0ZWQuc3VibGF5ZXIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50aXRsZSk7XG4gICAgfTtcbiAgICB0aGlzLml0ZW0gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy51c2VyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMud2lkdGggPSBcImF1dG9cIjtcbiAgICB0aGlzLmFwcGVhcmFuY2UgPSBcIm91dGxpbmVcIjtcbiAgICB0aGlzLnNlbGVjdGlvbiA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNob3dFcnJvcnMgPSBmYWxzZTtcbiAgICB0aGlzLnN1YmxheWVycyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmZldGNoZWQgPSBmYWxzZTtcbiAgICB0aGlzLmFsZXJ0QWN0aXZlID0gZmFsc2U7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlLmkxOG4uY2FyZFN1YmxheWVyU2VsZWN0O1xuICAgIHRoaXMuc3VibGF5ZXJzID0gKF9iID0gdGhpcy5pdGVtKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc3VibGF5ZXJzO1xuICAgIGlmICghdGhpcy5pdGVtKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICgoX2MgPSB0aGlzLml0ZW0pID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5zdWJsYXllcnMpIHtcbiAgICAgIHRoaXMuc3VibGF5ZXJzID0gdGhpcy5pdGVtLnN1YmxheWVycztcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGluQ2FjaGUoXCJzZXJ2aWNlSW5mb1wiLCB0aGlzLml0ZW0uaWQpO1xuICAgICAgaWYgKHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5yZXN1bHQpIHtcbiAgICAgICAgdGhpcy5wcm9jZXNzUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBwcm9jZXNzUmVzcG9uc2UocmVzcG9uc2UpIHtcbiAgICBpZiAocmVzcG9uc2UgPT09IG51bGwgfHwgcmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3BvbnNlLnJlc3VsdCkge1xuICAgICAgY29uc3QgbGF5ZXJzID0gcmVzcG9uc2UucmVzdWx0Lm1hcChnZXRTZWFyY2hSZXN1bHRTdWJsYXllcikuc29ydCh0aGlzLnNvcnRTdWJsYXllcnMpO1xuICAgICAgdGhpcy5zdWJsYXllcnMgPSBsYXllcnM7XG4gICAgICB0aGlzLml0ZW0uc3VibGF5ZXJzID0gbGF5ZXJzO1xuICAgICAgdGhpcy5mZXRjaGVkID0gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSBpZiAocmVzcG9uc2UuZXJyb3IpIHtcbiAgICAgIHRoaXMuYWxlcnRBY3RpdmUgPSB0cnVlO1xuICAgIH1cbiAgfVxuICBhc3luYyBhdHRlbXB0TG9hZCgpIHtcbiAgICB2YXIgX2E7XG4gICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICB0aGlzLmFsZXJ0QWN0aXZlID0gZmFsc2U7XG4gICAgLy8gZm9yIGl0ZW1zIHdpdGhvdXQgc3VibGF5ZXJzIGluIHRoZSBzZWFyY2ggaW5kZXgsXG4gICAgLy8gdHJ5IGZldGNoaW5nIHRoZSBzZXJ2aWNlIGluZm9cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZyb21DYWNoZSgoKSA9PiBmZXRjaEZlYXR1cmVTZXJ2aWNlSW5mbyh7XG4gICAgICBpdGVtOiB0aGlzLml0ZW0sXG4gICAgICBwb3J0YWw6IHRoaXMucG9ydGFsLFxuICAgICAgbGF5ZXJzOiBudWxsLFxuICAgICAgaXNTZWN1cmU6IGZhbHNlXG4gICAgfSksIFwic2VydmljZUluZm9cIiwgdGhpcy5pdGVtLmlkKTtcbiAgICAvLyBtYWtlIHJlYWwgc3VibGF5ZXJzIGxvb2sgbGlrZSBzZWFyY2ggc3VibGF5ZXJzXG4gICAgdGhpcy5wcm9jZXNzUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgIGF3YWl0IHRpbWVvdXQoMTAwKTtcbiAgICBpZiAodGhpcy5kcm9wZG93bikge1xuICAgICAgdGhpcy5kcm9wZG93bi5vcGVuID0gdHJ1ZTtcbiAgICB9XG4gICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgcmV0dXJuICEhKChfYSA9IHRoaXMuc3VibGF5ZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCB7IHN0b3JlLCB3aWR0aCwgYXBwZWFyYW5jZSwgbG9hZGluZywgaTE4biwgYWxlcnRBY3RpdmUgfSA9IHRoaXM7XG4gICAgY29uc3QgaXRlbSA9IHRoaXMuaXRlbTtcbiAgICBpZiAoIXN0b3JlIHx8ICFpdGVtKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3Qgc2NhbGUgPSB3aWR0aCA9PT0gXCJhdXRvXCIgPyBcInNcIiA6IFwibVwiO1xuICAgIGNvbnN0IHNlbGVjdGVkSXRlbXMgPSBzdG9yZSA9PT0gbnVsbCB8fCBzdG9yZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3RvcmUuc3RhdGUuc2VsZWN0ZWRJdGVtcztcbiAgICBjb25zdCBzZWxlY3RlZFN1YmxheWVycyA9IGZpbmRTZWxlY3RlZFN1YmxheWVycyh7IGl0ZW0sIHNlbGVjdGVkSXRlbXMgfSk7XG4gICAgY29uc3QgaXNJdGVtU2VsZWN0ZWQgPSBpc1NlbGVjdGVkKHsgaXRlbSwgc2VsZWN0ZWRJdGVtcyB9KTtcbiAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgKChfYSA9IGl0ZW0gPT09IG51bGwgfHwgaXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaXRlbS5zdWJsYXllcnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpID8gKGgoXCJjYWxjaXRlLWRyb3Bkb3duXCIsIHsgY2xhc3M6IFwiZHJvcGRvd25cIiwgd2lkdGg6IFwibFwiLCBwbGFjZW1lbnQ6IGFwcGVhcmFuY2UgPT09IFwic29saWRcIiA/IFwidG9wXCIgOiBcImJvdHRvbS1lbmRcIiwgc2NhbGU6IFwic1wiLCBjbG9zZU9uU2VsZWN0RGlzYWJsZWQ6IHRydWUsIG92ZXJsYXlQb3NpdGlvbmluZzogXCJmaXhlZFwiLCByZWY6IChlbCkgPT4gKHRoaXMuZHJvcGRvd24gPSBlbCkgfSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgbG9hZGluZzogbG9hZGluZywgZGlzYWJsZWQ6IGxvYWRpbmcsIHNsb3Q6IFwidHJpZ2dlclwiLCBzY2FsZTogc2NhbGUsIGFwcGVhcmFuY2U6IChzZWxlY3RlZFN1YmxheWVycyA9PT0gbnVsbCB8fCBzZWxlY3RlZFN1YmxheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0ZWRTdWJsYXllcnMubGVuZ3RoKSB8fCBhcHBlYXJhbmNlID09PSBcInNvbGlkXCIgPyBcInNvbGlkXCIgOiBcIm91dGxpbmVcIiwga2luZDogXCJuZXV0cmFsXCIsIGljb25FbmQ6IFwiY2hldnJvbi1kb3duXCIsIHdpZHRoOiB3aWR0aCB9LCB0aGlzLnJlbmRlclNlbGVjdFRleHQoc2VsZWN0ZWRTdWJsYXllcnMpKSwgaChcImNhbGNpdGUtZHJvcGRvd24tZ3JvdXBcIiwgeyBzZWxlY3Rpb25Nb2RlOiB0aGlzLnNlbGVjdGlvbiB9LCAoX2IgPSB0aGlzLnN1YmxheWVycykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnNvcnQodGhpcy5zb3J0U3VibGF5ZXJzKS5tYXAodGhpcy5yZW5kZXJTdWJsYXllcikpKSkgOiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgbG9hZGluZzogbG9hZGluZywgZGlzYWJsZWQ6IGxvYWRpbmcgfHwgYWxlcnRBY3RpdmUsIGNsYXNzOiBcImRyb3Bkb3duXCIsIHNsb3Q6IFwidHJpZ2dlclwiLCBzY2FsZTogc2NhbGUsIGFwcGVhcmFuY2U6IChzZWxlY3RlZFN1YmxheWVycyA9PT0gbnVsbCB8fCBzZWxlY3RlZFN1YmxheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0ZWRTdWJsYXllcnMubGVuZ3RoKSA/IFwic29saWRcIiA6IFwib3V0bGluZVwiLCBraW5kOiBcIm5ldXRyYWxcIiwgd2lkdGg6IHdpZHRoLCBvbkNsaWNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLml0ZW0gJiZcbiAgICAgICAgICAhdGhpcy5zdWJsYXllcnMgJiZcbiAgICAgICAgICB0aGlzLml0ZW0udHlwZSAhPT0gXCJJbWFnZSBTZXJ2aWNlXCIgJiZcbiAgICAgICAgICAhdGhpcy5mZXRjaGVkKSB7XG4gICAgICAgICAgY29uc3QgZm91bmRMYXllcnMgPSBhd2FpdCB0aGlzLmF0dGVtcHRMb2FkKCk7XG4gICAgICAgICAgaWYgKGZvdW5kTGF5ZXJzIHx8IHRoaXMuYWxlcnRBY3RpdmUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckNhcmRTZWxlY3QuZW1pdCh7XG4gICAgICAgICAgaXRlbSxcbiAgICAgICAgICBzZWxlY3RlZDogIWlzSXRlbVNlbGVjdGVkXG4gICAgICAgIH0pO1xuICAgICAgfSB9LCB0aGlzLnJlbmRlclNlbGVjdFRleHQoc2VsZWN0ZWRTdWJsYXllcnMpKSksIHRoaXMuc2hvd0Vycm9ycyAmJiAoaChcImNhbGNpdGUtYWxlcnRcIiwgeyBsYWJlbDogaTE4bi5lcnJvclRpdGxlLCBpY29uOiB0cnVlLCBraW5kOiBcImRhbmdlclwiLCBvbkNhbGNpdGVBbGVydENsb3NlOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuYWxlcnRBY3RpdmUgPSBmYWxzZTtcbiAgICAgIH0sIG9wZW46ICEhYWxlcnRBY3RpdmUsIHRhYkluZGV4OiAhYWxlcnRBY3RpdmUgPyAtMSA6IG51bGwgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwidGl0bGVcIiB9LCBpMThuLmVycm9yVGl0bGUpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJtZXNzYWdlXCIsIGNsYXNzOiBcImFsZXJ0X19tZXNzYWdlXCIgfSwgaTE4bi5lcnJvckJvZHkpLCBoKFwiY2FsY2l0ZS1saW5rXCIsIHsgc2xvdDogXCJsaW5rXCIsIG9uQ2xpY2s6IGFzeW5jICgpID0+IHtcbiAgICAgICAgY2xlYXJDYWNoZShcInNlcnZpY2VJbmZvXCIsIHRoaXMuaXRlbS5pZCk7XG4gICAgICAgIGF3YWl0IHRoaXMuYXR0ZW1wdExvYWQoKTtcbiAgICAgIH0gfSwgaTE4bi5yZXRyeSkpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNJdGVtQnJvd3NlckNhcmQuc3R5bGUgPSBhcmNnaXNJdGVtQnJvd3NlckNhcmRTdWJsYXllclNlbGVjdENzcztcblxuY29uc3QgYXJjZ2lzSXRlbUJyb3dzZXJDYXJkVGh1bWJuYWlsQ3NzID0gXCI6aG9zdHtkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOnJlbGF0aXZlfS5vdXRlcnt3aWR0aDoxMDAlO3Bvc2l0aW9uOnJlbGF0aXZlO3BhZGRpbmctdG9wOjY2LjY2JX0uaW5uZXJ7cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7cmlnaHQ6MDtib3R0b206MDtsZWZ0OjA7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWJhY2tncm91bmQpfS5pbm5lci0tbG9hZGluZ3thbmltYXRpb24tZHVyYXRpb246MXM7YW5pbWF0aW9uLWZpbGwtbW9kZTpmb3J3YXJkczthbmltYXRpb24taXRlcmF0aW9uLWNvdW50OmluZmluaXRlO2FuaW1hdGlvbi1uYW1lOnRodW1ibmFpbC1zaGltbWVyO2FuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246bGluZWFyO2JhY2tncm91bmQtaW1hZ2U6bGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCB2YXIoLS1jYWxjaXRlLXVpLWJhY2tncm91bmQpIDAlLCB2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMiksIHZhcigtLWNhbGNpdGUtdWktYmFja2dyb3VuZCkgNDAlLCB2YXIoLS1jYWxjaXRlLXVpLWJhY2tncm91bmQpIDEwMCUpO2JhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdDtiYWNrZ3JvdW5kLXNpemU6ODAwcHggMTAwJX0udGh1bWJuYWlse3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7LW8tb2JqZWN0LWZpdDpjb3ZlcjtvYmplY3QtZml0OmNvdmVyO29wYWNpdHk6MTt0cmFuc2l0aW9uLXByb3BlcnR5Om9wYWNpdHk7dHJhbnNpdGlvbjpvcGFjaXR5IDMwMG1zIGxpbmVhcn0udGh1bWJuYWlsLS1sb2FkaW5ne29wYWNpdHk6MH1Aa2V5ZnJhbWVzIHRodW1ibmFpbC1zaGltbWVyezAle2JhY2tncm91bmQtcG9zaXRpb246LTQ2OHB4IDB9MTAwJXtiYWNrZ3JvdW5kLXBvc2l0aW9uOjQ2OHB4IDB9fVwiO1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckNhcmRUaHVtYm5haWwgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuaXRlbSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICB0aGlzLnVzZURlZmF1bHQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy50aHVtYm5haWxVcmwgPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgdGhpcy5zZXRUaHVtYm5haWxVcmwoKTtcbiAgfVxuICBoYW5kbGVJdGVtQ2hhbmdlKCkge1xuICAgIHRoaXMuc2V0VGh1bWJuYWlsVXJsKCk7XG4gIH1cbiAgYXN5bmMgc2V0VGh1bWJuYWlsVXJsKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgY29uc3QgeyBpdGVtLCBwb3J0YWwgfSA9IHRoaXM7XG4gICAgaWYgKHRoaXMudXNlRGVmYXVsdCkge1xuICAgICAgdGhpcy50aHVtYm5haWxVcmwgPSBnZXREZWZhdWx0VGh1bWJuYWlsKHRoaXMuaXRlbSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMudGh1bWJuYWlsVXJsID0gYXdhaXQgZ2V0QWRqdXN0ZWRUaHVtYm5haWwocG9ydGFsLCBpdGVtLCAoX2IgPSAoX2EgPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhdGUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5idWNrZXQpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGxvYWRpbmcsIHVzZURlZmF1bHQsIHRodW1ibmFpbFVybCB9ID0gdGhpcztcbiAgICBpZiAoIXRodW1ibmFpbFVybCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImRpdlwiLCB7IGNsYXNzOiBcIm91dGVyXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiB7IGlubmVyOiB0cnVlLCBcImlubmVyLS1sb2FkaW5nXCI6IGxvYWRpbmcgfSB9LCBoKFwiaW1nXCIsIHsgY2xhc3M6IHtcbiAgICAgICAgdGh1bWJuYWlsOiB0cnVlLFxuICAgICAgICBcInRodW1ibmFpbC0tbG9hZGluZ1wiOiBsb2FkaW5nXG4gICAgICB9LCBhbHQ6IFwiXCIsIHNyYzogdGh1bWJuYWlsVXJsLFxuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgY3Jvc3NvcmlnaW46IFwiYW5vbnltb3VzXCIsIG9uTG9hZDogKGUpID0+IHtcbiAgICAgICAgY29uc3QgaW1hZ2UgPSBlLmN1cnJlbnRUYXJnZXQ7XG4gICAgICAgIGlmICghdXNlRGVmYXVsdCAmJiBpc0JsYW5rSW1hZ2UoaW1hZ2UpKSB7XG4gICAgICAgICAgdGhpcy51c2VEZWZhdWx0ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgIH0sIG9uRXJyb3I6ICgpID0+IHtcbiAgICAgICAgdGhpcy51c2VEZWZhdWx0ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2V0VGh1bWJuYWlsVXJsKCk7XG4gICAgICB9IH0pLCBsb2FkaW5nICYmIGgoXCJkaXZcIiwgeyBjbGFzczogXCJwbGFjZWhvbGRlclwiIH0pKSkpKTtcbiAgfVxuICBzdGF0aWMgZ2V0IGFzc2V0c0RpcnMoKSB7IHJldHVybiBbXCJhc3NldHNcIl07IH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgIFwiaXRlbVwiOiBbXCJoYW5kbGVJdGVtQ2hhbmdlXCJdXG4gIH07IH1cbn07XG5BcmNnaXNJdGVtQnJvd3NlckNhcmRUaHVtYm5haWwuc3R5bGUgPSBhcmNnaXNJdGVtQnJvd3NlckNhcmRUaHVtYm5haWxDc3M7XG5cbmNvbnN0IGFyY2dpc0l0ZW1Ccm93c2VyQ29udGVudENzcyA9IFwiOmhvc3R7LS1hcmNnaXMtaXRlbS1icm93c2VyLWNvbnRlbnQtc3BhY2luZzowLjVyZW19LmdyaWQgc2xvdCwubGlzdCBzbG90e2Rpc3BsYXk6Z3JpZDtncmlkLWdhcDp2YXIoLS1hcmNnaXMtaXRlbS1icm93c2VyLWNvbnRlbnQtc3BhY2luZyl9LmNvbHVtbnMtMSBzbG90e2dyaWQtdGVtcGxhdGUtY29sdW1uczpyZXBlYXQoMSwgMWZyKX0uY29sdW1ucy0yIHNsb3R7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOnJlcGVhdCgyLCAxZnIpfS5jb2x1bW5zLTMgc2xvdHtncmlkLXRlbXBsYXRlLWNvbHVtbnM6cmVwZWF0KDMsIDFmcil9LmNvbHVtbnMtNCBzbG90e2dyaWQtdGVtcGxhdGUtY29sdW1uczpyZXBlYXQoNCwgMWZyKX0ubm8tc3BhY2Ugc2xvdHtncmlkLWdhcDowLjI1cmVtO2dhcDowLjI1cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckNvbnRlbnQgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICB9XG4gIGdldENvbHVtbkNvdW50KHdpZHRoKSB7XG4gICAgaWYgKHRoaXMuc3RvcmUuc3RhdGUudmlldyAhPT0gXCJncmlkXCIpIHtcbiAgICAgIHJldHVybiAxO1xuICAgIH1cbiAgICBjb25zdCBmaWx0ZXIgPSB0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnNFbXB0eSA/IDEgOiAwO1xuICAgIHN3aXRjaCAodHJ1ZSkge1xuICAgICAgY2FzZSB3aWR0aCA8IGJyZWFrcG9pbnRzLnhzOlxuICAgICAgICByZXR1cm4gMTtcbiAgICAgIGNhc2Ugd2lkdGggPCBicmVha3BvaW50cy5zbTpcbiAgICAgICAgcmV0dXJuIDI7XG4gICAgICBjYXNlIHdpZHRoIDwgYnJlYWtwb2ludHMubWQ6XG4gICAgICAgIHJldHVybiAxICsgZmlsdGVyO1xuICAgICAgY2FzZSB3aWR0aCA8IGJyZWFrcG9pbnRzLnhsOlxuICAgICAgICByZXR1cm4gMiArIGZpbHRlcjtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiAzICsgZmlsdGVyO1xuICAgIH1cbiAgfVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgdmlldyA9IHRoaXMuc3RvcmUuc3RhdGUudmlldztcbiAgICBjb25zdCBjb2x1bW5Db3VudCA9IHRoaXMuZ2V0Q29sdW1uQ291bnQodGhpcy5zdG9yZS5zdGF0ZS53aWR0aCk7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczoge1xuICAgICAgICBbdmlld106IHRydWUsXG4gICAgICAgIFtgY29sdW1ucy0ke2NvbHVtbkNvdW50fWBdOiB0cnVlLFxuICAgICAgICBcIm5vLXNwYWNlXCI6IHRoaXMuc3RvcmUuc3RhdGUud2lkdGggPCBicmVha3BvaW50cy54cyAmJiB0aGlzLnN0b3JlLnN0YXRlLnBhbmVsXG4gICAgICB9IH0sIGgoXCJzbG90XCIsIG51bGwpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNJdGVtQnJvd3NlckNvbnRlbnQuc3R5bGUgPSBhcmNnaXNJdGVtQnJvd3NlckNvbnRlbnRDc3M7XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyQ2F0ZWdvcnkgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyXCIsIDcpO1xuICAgIHRoaXMuY2F0ZWdvcnkgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5leHBhbmRlZCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmdyb3VwSWQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sb2FkaW5nID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2NoZW1hID0gW107XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlckNhdGVnb3JpZXM7XG4gICAgaWYgKGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS5wb3J0YWwpIHtcbiAgICAgIHRoaXMuZmV0Y2hDYXRlZ29yaWVzKGNvbmZpZ1N0YXRlLnBvcnRhbCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgb25Db25maWdDaGFuZ2UoXCJwb3J0YWxcIiwgKHBvcnRhbCkgPT4ge1xuICAgICAgICB0aGlzLmZldGNoQ2F0ZWdvcmllcyhwb3J0YWwpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIG9uQnJvd3NlckZpbHRlclJlbW92ZShcImNhdGVnb3JpZXNcIiwgdGhpcy5zdG9yZSwgKCkgPT4gKHRoaXMuY2F0ZWdvcnkgPSBudWxsKSk7XG4gIH1cbiAgYXN5bmMgcmVmZXRjaENhdGVnb3JpZXMoKSB7XG4gICAgaWYgKGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS5wb3J0YWwpIHtcbiAgICAgIHRoaXMuZmV0Y2hDYXRlZ29yaWVzKGNvbmZpZ1N0YXRlLnBvcnRhbCk7XG4gICAgfVxuICB9XG4gIGFzeW5jIGZldGNoQ2F0ZWdvcmllcyhwb3J0YWwpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgY29uc3QgaXNMaXZpbmdBdGxhcyA9ICgoX2IgPSAoX2EgPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhdGUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5idWNrZXQpID09PSBcImxpdmluZyBhdGxhc1wiO1xuICAgIGNvbnN0IGdyb3VwSWQgPSB0aGlzLmdyb3VwSWQgfHwgdGhpcy5zdG9yZS5zdGF0ZS5ncm91cElkO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gaXNMaXZpbmdBdGxhc1xuICAgICAgPyBhd2FpdCBmZXRjaExpdmluZ0F0bGFzQ2F0ZWdvcmllcyhwb3J0YWwpXG4gICAgICA6IGdyb3VwSWRcbiAgICAgICAgPyBhd2FpdCBmZXRjaEdyb3VwQ2F0ZWdvcmllcyhncm91cElkLCBwb3J0YWwpXG4gICAgICAgIDogYXdhaXQgZmV0Y2hDYXRlZ29yaWVzKHBvcnRhbCk7XG4gICAgdGhpcy5zY2hlbWEgPSAoX2QgPSAoX2MgPSByZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2UuY2F0ZWdvcnlTY2hlbWEpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfY1swXSkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmNhdGVnb3JpZXM7XG4gICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICBpZiAodGhpcy5jYXRlZ29yeSkge1xuICAgICAgdGhpcy5lbWl0RmlsdGVyRXZlbnQoKTtcbiAgICB9XG4gICAgdGhpcy5zdG9yZS5vbkNoYW5nZShcImJ1Y2tldFwiLCAoKSA9PiB0aGlzLnJlZmV0Y2hDYXRlZ29yaWVzKCkpO1xuICAgIHRoaXMuc3RvcmUub25DaGFuZ2UoXCJncm91cElkXCIsICgpID0+IHtcbiAgICAgIHRoaXMucmVmZXRjaENhdGVnb3JpZXMoKTtcbiAgICB9KTtcbiAgfVxuICBlbWl0RmlsdGVyRXZlbnQoKSB7XG4gICAgY29uc3QgeyBjYXRlZ29yeSwgaTE4biB9ID0gdGhpcztcbiAgICBjb25zdCB2YWx1ZSA9IGNhdGVnb3J5ID8gSlNPTi5zdHJpbmdpZnkoW2NhdGVnb3J5XSkgOiBcIlwiO1xuICAgIGNvbnN0IGNhdGVnb3J5TGFiZWwgPSBjYXRlZ29yeSA9PT0gXCJfbm9uZV9cIiA/IGkxOG4udW5jYXRlZ29yaXplZCA6IGNhdGVnb3J5ID09PSBudWxsIHx8IGNhdGVnb3J5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjYXRlZ29yeS5yZXBsYWNlKFwiL0NhdGVnb3JpZXMvXCIsIFwiXCIpO1xuICAgIGNvbnN0IGxhYmVsID0gaTE4bi5jYXRlZ29yeS5yZXBsYWNlKFwiJHtjYXRlZ29yeX1cIiwgY2F0ZWdvcnlMYWJlbCk7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHtcbiAgICAgIGlkOiBcImNhdGVnb3JpZXNcIixcbiAgICAgIHBhcmFtOiBcImNhdGVnb3JpZXNcIixcbiAgICAgIHZhbHVlLFxuICAgICAgbGFiZWwsXG4gICAgICBjYXRlZ29yeVxuICAgIH0pO1xuICB9XG4gIHJlbmRlck5lc3RlZENhdGVnb3JpZXMoc2NoZW1hLCBwcmV2aW91c1ZhbHVlKSB7XG4gICAgcmV0dXJuIHNjaGVtYS5tYXAoKGNhdGVnb3J5KSA9PiB7XG4gICAgICB2YXIgX2E7XG4gICAgICAvLyBLZWVwIGJyZWFkY3J1bWJzIG9mIGNhdGVnb3JpZXMnIGFuY2VzdHJ5XG4gICAgICBjb25zdCB2YWx1ZSA9IHByZXZpb3VzVmFsdWVcbiAgICAgICAgPyBgJHtwcmV2aW91c1ZhbHVlfS8ke2NhdGVnb3J5LnRpdGxlfWBcbiAgICAgICAgOiBgL0NhdGVnb3JpZXMvJHtjYXRlZ29yeS50aXRsZX1gO1xuICAgICAgY29uc3QgaGFzQ2hpbGRyZW4gPSAhISgoX2EgPSBjYXRlZ29yeS5jYXRlZ29yaWVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKTtcbiAgICAgIHJldHVybiAoaChcImNhbGNpdGUtdHJlZS1pdGVtXCIsIHsgXCJkYXRhLXZhbHVlXCI6IHZhbHVlLCBcImRhdGEtY2hpbGRyZW5cIjogaGFzQ2hpbGRyZW4sIHNlbGVjdGVkOiB0aGlzLmNhdGVnb3J5ID09PSB2YWx1ZSB9LCBoKFwiYVwiLCBudWxsLCBjYXRlZ29yeS50aXRsZSksIGhhc0NoaWxkcmVuICYmIChoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2xvdDogXCJjaGlsZHJlblwiLCBzZWxlY3Rpb25Nb2RlOiBcImNoaWxkcmVuXCIgfSwgdGhpcy5yZW5kZXJOZXN0ZWRDYXRlZ29yaWVzKGNhdGVnb3J5LmNhdGVnb3JpZXMsIHZhbHVlKSkpKSk7XG4gICAgfSk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgbG9hZGluZywgc2NoZW1hIH0gPSB0aGlzO1xuICAgIGlmIChsb2FkaW5nIHx8ICEoc2NoZW1hID09PSBudWxsIHx8IHNjaGVtYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2NoZW1hLmxlbmd0aCkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gKGgoXCJhcmNnaXMtYnJvd3Nlci1maWx0ZXJcIiwgeyBoZWFkaW5nOiB0aGlzLmkxOG4uY2F0ZWdvcmllcywgZXhwYW5kZWQ6IHRoaXMuZXhwYW5kZWQsIGFjdGl2ZTogISF0aGlzLmNhdGVnb3J5LCBvbkFyY2dpc0Jyb3dzZXJGaWx0ZXJSZW1vdmU6ICgpID0+IHtcbiAgICAgICAgdGhpcy5jYXRlZ29yeSA9IG51bGw7XG4gICAgICAgIHRoaXMuZW1pdEZpbHRlckV2ZW50KCk7XG4gICAgICB9IH0sIGgoXCJjYWxjaXRlLXRyZWVcIiwgeyBzZWxlY3Rpb25Nb2RlOiBcImNoaWxkcmVuXCIsIHNjYWxlOiBcIm1cIiwgb25DYWxjaXRlVHJlZVNlbGVjdDogKGV2ZW50KSA9PiB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIGNvbnN0IGRhdGFzZXQgPSAoX2IgPSAoX2EgPSBub2RlID09PSBudWxsIHx8IG5vZGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5vZGUuc2VsZWN0ZWRJdGVtcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZGF0YXNldDtcbiAgICAgICAgY29uc3QgY2F0ZWdvcnkgPSAoZGF0YXNldCA9PT0gbnVsbCB8fCBkYXRhc2V0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhc2V0LnZhbHVlKSB8fCBcIlwiO1xuICAgICAgICBpZiAodGhpcy5jYXRlZ29yeSA9PT0gY2F0ZWdvcnkpIHtcbiAgICAgICAgICB0aGlzLmNhdGVnb3J5ID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB0aGlzLmNhdGVnb3J5ID0gY2F0ZWdvcnk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbWl0RmlsdGVyRXZlbnQoKTtcbiAgICAgIH0gfSwgISEodGhpcy5ncm91cElkIHx8IHRoaXMuc3RvcmUuc3RhdGUuZ3JvdXBJZCkgJiYgKGgoXCJjYWxjaXRlLXRyZWUtaXRlbVwiLCB7IFwiZGF0YS12YWx1ZVwiOiBcIl9ub25lX1wiLCBzZWxlY3RlZDogdGhpcy5jYXRlZ29yeSA9PT0gXCJfbm9uZV9cIiB9LCBoKFwiYVwiLCBudWxsLCB0aGlzLmkxOG4udW5jYXRlZ29yaXplZCkpKSwgdGhpcy5yZW5kZXJOZXN0ZWRDYXRlZ29yaWVzKHNjaGVtYSkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hDb2xsYWJvcmF0aW9ucyhwb3J0YWwpIHtcbiAgY29uc3QgcmVzdEJhc2VVcmwgPSBnZXRQb3J0YWxSZXN0QmFzZVVybChwb3J0YWwpO1xuICBjb25zdCB7IGNvbGxhYm9yYXRpb25zIH0gPSBhd2FpdCByZXF1ZXN0KGAke3Jlc3RCYXNlVXJsfXBvcnRhbHMvc2VsZi9jb2xsYWJvcmF0aW9uc1N1bW1hcnlgLCB7XG4gICAgaW5jbHVkZVBhcnRpY2lwYW50SW5mbzogdHJ1ZVxuICB9KTtcbiAgcmV0dXJuIGNvbGxhYm9yYXRpb25zO1xufVxuLy8gZ2V0cyB0aGUgY29sbGFib3JhdGVkIGl0ZW1zIGFuZCByZXR1cm5zIGp1c3QgdGhlIHVuaXF1ZSBpdGVtIGlkcyBmb3IgdGhhdCBjb2xsYWJvcmF0aW9uIGFzIGFuIGFycmF5XG5hc3luYyBmdW5jdGlvbiBmZXRjaENvbGxhYm9yYXRlZEl0ZW1zKGNvbGxhYm9yYXRpb25JZCwgcGFydGljaXBhbnRJZCwgcG9ydGFsKSB7XG4gIGNvbnN0IHJlc3RCYXNlVXJsID0gZ2V0UG9ydGFsUmVzdEJhc2VVcmwocG9ydGFsKTtcbiAgY29uc3QgeyBjb2xsYWJvcmF0ZWRJdGVtcyB9ID0gYXdhaXQgcmVxdWVzdChgJHtyZXN0QmFzZVVybH1wb3J0YWxzL3NlbGYvY29sbGFib3JhdGVkSXRlbXNgLCBPYmplY3QuYXNzaWduKHsgY29sbGFib3JhdGlvbklkIH0sIChwYXJ0aWNpcGFudElkID8geyBwYXJ0aWNpcGFudElkIH0gOiB7fSkpKTtcbiAgaWYgKGNvbGxhYm9yYXRlZEl0ZW1zID09PSBudWxsIHx8IGNvbGxhYm9yYXRlZEl0ZW1zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb2xsYWJvcmF0ZWRJdGVtcy5sZW5ndGgpIHtcbiAgICByZXR1cm4gY29sbGFib3JhdGVkSXRlbXMubWFwKChlbnRyeSkgPT4gT2JqZWN0LmtleXMoZW50cnkpWzBdKTtcbiAgfVxuICByZXR1cm4gW107XG59XG4vLyBMb29rcyB1cCBpdGVtcyB1c2VkIGluIGEgY29sbGFib3JhdGlvbiwgcmV0dXJucyBhbiBhcnJheSBvZiBpdGVtIGlkc1xuYXN5bmMgZnVuY3Rpb24gZmV0Y2hDb2xsYWJvcmF0aW9uQ29udGVudChjb2xsYWJvcmF0aW9uSWQsIHBhcnRpY2lwYW50SWQsIHBvcnRhbCkge1xuICByZXR1cm4gZnJvbUNhY2hlKCgpID0+IGZldGNoQ29sbGFib3JhdGVkSXRlbXMoY29sbGFib3JhdGlvbklkLCBwYXJ0aWNpcGFudElkLCBwb3J0YWwpLCBcImNvbGxhYm9yYXRpb25Db250ZW50XCIsIGAke2NvbGxhYm9yYXRpb25JZH0vJHtwYXJ0aWNpcGFudElkfWApO1xufVxuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckNvbGxhYm9yYXRpb25zID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckZpbHRlclwiLCA3KTtcbiAgICB0aGlzLmxvYWRDb2xsYWJvcmF0aW9ucyA9IGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHsgcG9ydGFsLCB1c2VyLCBjb25maWcsIHN1YnNjcmlwdGlvbkluZm8gfSA9IGNvbmZpZ1N0YXRlICE9PSBudWxsICYmIGNvbmZpZ1N0YXRlICE9PSB2b2lkIDAgPyBjb25maWdTdGF0ZSA6IHt9O1xuICAgICAgaWYgKCF0aGlzLmNvbGxhYm9yYXRpb25zICYmXG4gICAgICAgIHBvcnRhbCAmJlxuICAgICAgICB1c2VyICYmXG4gICAgICAgICFpc1B1YmxpY1VzZXIodXNlcikgJiZcbiAgICAgICAgY2FuTWFuYWdlQ29sbGFib3JhdGlvbnMoY29uZmlnLCB1c2VyLCBwb3J0YWwsIHN1YnNjcmlwdGlvbkluZm8pKSB7XG4gICAgICAgIHRoaXMuY29sbGFib3JhdGlvbnMgPSBhd2FpdCBmZXRjaENvbGxhYm9yYXRpb25zKGNvbmZpZ1N0YXRlLnBvcnRhbCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLmNvbGxhYm9yYXRpb24gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wYXJ0aWNpcGFudCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmNvbGxhYm9yYXRpb25OYW1lID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZXhwYW5kZWQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jb2xsYWJvcmF0aW9ucyA9IHVuZGVmaW5lZDtcbiAgfVxuICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4uZmlsdGVyQ29sbGFib3JhdGlvbnM7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICBpZiAodGhpcy5jb2xsYWJvcmF0aW9uKSB7XG4gICAgICB0aGlzLmVtaXRFdmVudCgpO1xuICAgIH1cbiAgICB0aGlzLmxvYWRDb2xsYWJvcmF0aW9ucygpO1xuICAgIG9uQ29uZmlnQ2hhbmdlKFwicG9ydGFsXCIsIHRoaXMubG9hZENvbGxhYm9yYXRpb25zKTtcbiAgICBvbkNvbmZpZ0NoYW5nZShcInVzZXJcIiwgdGhpcy5sb2FkQ29sbGFib3JhdGlvbnMpO1xuICAgIG9uQ29uZmlnQ2hhbmdlKFwic3Vic2NyaXB0aW9uSW5mb1wiLCB0aGlzLmxvYWRDb2xsYWJvcmF0aW9ucyk7XG4gICAgb25Ccm93c2VyRmlsdGVyUmVtb3ZlKFwiY29sbGFib3JhdGlvbnNcIiwgdGhpcy5zdG9yZSwgKCkgPT4gKHRoaXMuY29sbGFib3JhdGlvbiA9IG51bGwpKTtcbiAgfVxuICBhc3luYyBnZXRFdmVudERldGFpbCgpIHtcbiAgICBjb25zdCB7IGNvbGxhYm9yYXRpb24sIHBhcnRpY2lwYW50LCBjb2xsYWJvcmF0aW9uTmFtZSwgaTE4biB9ID0gdGhpcztcbiAgICBpZiAoIWNvbGxhYm9yYXRpb24pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBcImNvbGxhYm9yYXRpb25zXCIsXG4gICAgICAgIHBhcmFtOiBcInFcIixcbiAgICAgICAgdmFsdWU6IFwiXCIsXG4gICAgICAgIGxhYmVsOiBcIlwiLFxuICAgICAgICBjb2xsYWJvcmF0aW9uOiB7XG4gICAgICAgICAgaWQ6IFwiXCIsXG4gICAgICAgICAgbmFtZTogXCJcIlxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgICBjb25zdCBpdGVtcyA9IGF3YWl0IGZldGNoQ29sbGFib3JhdGlvbkNvbnRlbnQoY29sbGFib3JhdGlvbiwgcGFydGljaXBhbnQsIGNvbmZpZ1N0YXRlLnBvcnRhbCk7XG4gICAgY29uc3QgcGFydGljaXBhbnRTdWZmaXggPSBwYXJ0aWNpcGFudCA/IGBfXyR7cGFydGljaXBhbnR9YCA6IFwiXCI7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBcImNvbGxhYm9yYXRpb25zXCIsXG4gICAgICBwYXJhbTogXCJxXCIsXG4gICAgICB2YWx1ZTogaXRlbXMgPyBgaWQ6KCR7aXRlbXMuam9pbihcIiBPUiBcIil9KWAgOiBcIlwiLFxuICAgICAgbGFiZWw6IGNvbGxhYm9yYXRpb25OYW1lID8gaTE4bi5sYWJlbC5yZXBsYWNlKFwiJHtuYW1lfVwiLCB0aGlzLmNvbGxhYm9yYXRpb25OYW1lKSA6IFwiXCIsXG4gICAgICBjb2xsYWJvcmF0aW9uOiB7XG4gICAgICAgIGlkOiBjb2xsYWJvcmF0aW9uLFxuICAgICAgICBuYW1lOiBjb2xsYWJvcmF0aW9uTmFtZVxuICAgICAgfSxcbiAgICAgIGFkZGl0aW9uYWxQYXJhbXM6IHtcbiAgICAgICAgb3JpZ2luOiBgJHtjb2xsYWJvcmF0aW9ufSR7cGFydGljaXBhbnRTdWZmaXh9YFxuICAgICAgfVxuICAgIH07XG4gIH1cbiAgYXN5bmMgZW1pdEV2ZW50KCkge1xuICAgIGNvbnN0IGRldGFpbCA9IGF3YWl0IHRoaXMuZ2V0RXZlbnREZXRhaWwoKTtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQoZGV0YWlsKTtcbiAgfVxuICByZW5kZXJQYXJ0aWNpcGFudChwYXJ0aWNpcGFudCwgY29sbGFib3JhdGlvbklkKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IFtpZCwgbmFtZV0gPSBPYmplY3QuZW50cmllcyhwYXJ0aWNpcGFudClbMF07XG4gICAgY29uc3QgcGFydGljaXBhbnRJZCA9IGAke2NvbGxhYm9yYXRpb25JZH0vJHtpZH1gO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtdHJlZS1pdGVtXCIsIHsgXCJkYXRhLWlkXCI6IHBhcnRpY2lwYW50SWQsIFwiZGF0YS1uYW1lXCI6IG5hbWUsIHNlbGVjdGVkOiAoX2EgPSB0aGlzLmNvbGxhYm9yYXRpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhwYXJ0aWNpcGFudElkKSB9LCBoKFwiYVwiLCBudWxsLCBuYW1lKSkpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGNvbmZpZywgdXNlciwgcG9ydGFsLCBzdWJzY3JpcHRpb25JbmZvIH0gPSBjb25maWdTdGF0ZTtcbiAgICBjb25zdCB7IGNvbGxhYm9yYXRpb25zIH0gPSB0aGlzO1xuICAgIGlmICghdXNlciB8fFxuICAgICAgIWNhbk1hbmFnZUNvbGxhYm9yYXRpb25zKGNvbmZpZywgdXNlciwgcG9ydGFsLCBzdWJzY3JpcHRpb25JbmZvKSB8fFxuICAgICAgIShjb2xsYWJvcmF0aW9ucyA9PT0gbnVsbCB8fCBjb2xsYWJvcmF0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29sbGFib3JhdGlvbnMubGVuZ3RoKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiAoaChcImFyY2dpcy1icm93c2VyLWZpbHRlclwiLCB7IGhlYWRpbmc6IHRoaXMuaTE4bi50aXRsZSwgZXhwYW5kZWQ6IHRoaXMuZXhwYW5kZWQsIGFjdGl2ZTogISF0aGlzLmNvbGxhYm9yYXRpb24sIG9uQXJjZ2lzQnJvd3NlckZpbHRlclJlbW92ZTogKCkgPT4ge1xuICAgICAgICB0aGlzLmNvbGxhYm9yYXRpb24gPSBudWxsO1xuICAgICAgICB0aGlzLmVtaXRFdmVudCgpO1xuICAgICAgfSB9LCBoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2VsZWN0aW9uTW9kZTogXCJjaGlsZHJlblwiLCBzY2FsZTogXCJtXCIsIG9uQ2FsY2l0ZVRyZWVTZWxlY3Q6IChldmVudCkgPT4ge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICBjb25zdCBpdGVtID0gKF9hID0gbm9kZS5zZWxlY3RlZEl0ZW1zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF07XG4gICAgICAgIGNvbnN0IFtjb2xsYWJvcmF0aW9uSWQsIHBhcnRpY2lwYW50SWRdID0gKF9iID0gaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLmRhdGFzZXQuaWQuc3BsaXQoXCIvXCIpKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBbXTtcbiAgICAgICAgY29uc3QgY29sbGFib3JhdGlvbk5hbWUgPSBpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0uZGF0YXNldC5uYW1lO1xuICAgICAgICBpZiAoIWNvbGxhYm9yYXRpb25OYW1lKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbGxhYm9yYXRpb24gPT09IGNvbGxhYm9yYXRpb25JZCAmJlxuICAgICAgICAgICghcGFydGljaXBhbnRJZCB8fCBwYXJ0aWNpcGFudElkID09PSB0aGlzLnBhcnRpY2lwYW50KSkge1xuICAgICAgICAgIHRoaXMuY29sbGFib3JhdGlvbiA9IG51bGw7XG4gICAgICAgICAgdGhpcy5jb2xsYWJvcmF0aW9uTmFtZSA9IG51bGw7XG4gICAgICAgICAgdGhpcy5wYXJ0aWNpcGFudCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy5jb2xsYWJvcmF0aW9uID0gY29sbGFib3JhdGlvbklkO1xuICAgICAgICAgIHRoaXMuY29sbGFib3JhdGlvbk5hbWUgPSBjb2xsYWJvcmF0aW9uTmFtZTtcbiAgICAgICAgICB0aGlzLnBhcnRpY2lwYW50ID0gcGFydGljaXBhbnRJZDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVtaXRFdmVudCgpO1xuICAgICAgfSB9LCBjb2xsYWJvcmF0aW9ucy5tYXAoKHsgY29sbGFib3JhdGlvbklkLCBjb2xsYWJvcmF0aW9uTmFtZSwgcGFydGljaXBhbnRzIH0pID0+IHtcbiAgICAgIHZhciBfYTtcbiAgICAgIHJldHVybiAoaChcImNhbGNpdGUtdHJlZS1pdGVtXCIsIHsgXCJkYXRhLWlkXCI6IGNvbGxhYm9yYXRpb25JZCwgXCJkYXRhLW5hbWVcIjogY29sbGFib3JhdGlvbk5hbWUsIHNlbGVjdGVkOiAoX2EgPSB0aGlzLmNvbGxhYm9yYXRpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhjb2xsYWJvcmF0aW9uSWQpIH0sIGgoXCJhXCIsIG51bGwsIGNvbGxhYm9yYXRpb25OYW1lKSwgKHBhcnRpY2lwYW50cyA9PT0gbnVsbCB8fCBwYXJ0aWNpcGFudHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBhcnRpY2lwYW50cy5sZW5ndGgpICYmIChoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2xvdDogXCJjaGlsZHJlblwiIH0sIChwYXJ0aWNpcGFudHMgfHwgW10pLm1hcCgocGFydGljaXBhbnQpID0+IHRoaXMucmVuZGVyUGFydGljaXBhbnQocGFydGljaXBhbnQsIGNvbGxhYm9yYXRpb25JZCkpKSkpKTtcbiAgICB9KSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckNvbnRlbnRTdGF0dXMgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyXCIsIDcpO1xuICAgIHRoaXMuY29udGVudFN0YXR1cyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmV4cGFuZGVkID0gdW5kZWZpbmVkO1xuICB9XG4gIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5maWx0ZXJDb250ZW50U3RhdHVzO1xuICB9XG4gIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgaWYgKHRoaXMuY29udGVudFN0YXR1cykge1xuICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgfVxuICAgIG9uQnJvd3NlckZpbHRlclJlbW92ZShcImNvbnRlbnRTdGF0dXNcIiwgdGhpcy5zdG9yZSwgKCkgPT4gKHRoaXMuY29udGVudFN0YXR1cyA9IG51bGwpKTtcbiAgfVxuICBnZXRFdmVudERldGFpbCgpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyBjb250ZW50U3RhdHVzLCBpMThuIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgdXNlciwgcG9ydGFsIH0gPSBjb25maWdTdGF0ZTtcbiAgICBjb25zdCBvcmdJZCA9IHBvcnRhbCAmJiAhcG9ydGFsLmlzUG9ydGFsID8gYCBvcmdpZDoke3BvcnRhbC5pZH1gIDogXCJcIjtcbiAgICBjb25zdCBvcmdNZW1iZXIgPSB1c2VyICYmICFpc1B1YmxpY1VzZXIodXNlcik7XG4gICAgY29uc3Qgb3JnQXV0aG9yaXRhdGl2ZVF1ZXJ5ID0gYCgoY29udGVudHN0YXR1czpvcmdfYXV0aG9yaXRhdGl2ZSR7b3JnSWR9KSBPUiBjb250ZW50c3RhdHVzOnB1YmxpY19hdXRob3JpdGF0aXZlKWA7XG4gICAgY29uc3QgdmFsdWVzID0ge1xuICAgICAgYXV0aG9yaXRhdGl2ZTogb3JnTWVtYmVyID8gb3JnQXV0aG9yaXRhdGl2ZVF1ZXJ5IDogXCJjb250ZW50c3RhdHVzOnB1YmxpY19hdXRob3JpdGF0aXZlXCIsXG4gICAgICBkZXByZWNhdGVkOiBcImNvbnRlbnRzdGF0dXM6ZGVwcmVjYXRlZFwiXG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IFwiY29udGVudFN0YXR1c1wiLFxuICAgICAgcGFyYW06IFwiZmlsdGVyXCIsXG4gICAgICB2YWx1ZTogKF9hID0gdmFsdWVzW2NvbnRlbnRTdGF0dXNdKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIlwiLFxuICAgICAgbGFiZWw6IGNvbnRlbnRTdGF0dXMgPyBpMThuLmxhYmVsLnJlcGxhY2UoXCIke2NvbnRlbnRTdGF0dXN9XCIsIGkxOG5bY29udGVudFN0YXR1c10pIDogXCJcIixcbiAgICAgIGNvbnRlbnRTdGF0dXNcbiAgICB9O1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCBzdGF0dXNlcyA9IFtcImF1dGhvcml0YXRpdmVcIiwgXCJkZXByZWNhdGVkXCJdO1xuICAgIHJldHVybiAoaChcImFyY2dpcy1icm93c2VyLWZpbHRlclwiLCB7IGhlYWRpbmc6IHRoaXMuaTE4bi50aXRsZSwgZXhwYW5kZWQ6IHRoaXMuZXhwYW5kZWQsIGFjdGl2ZTogISF0aGlzLmNvbnRlbnRTdGF0dXMsIG9uQXJjZ2lzQnJvd3NlckZpbHRlclJlbW92ZTogKCkgPT4ge1xuICAgICAgICB0aGlzLmNvbnRlbnRTdGF0dXMgPSBudWxsO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgIH0gfSwgaChcImNhbGNpdGUtdHJlZVwiLCB7IHNlbGVjdGlvbk1vZGU6IFwic2luZ2xlXCIsIHNjYWxlOiBcIm1cIiwgb25DYWxjaXRlVHJlZVNlbGVjdDogKGV2ZW50KSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgY29uc3QgaXRlbSA9IChfYSA9IG5vZGUuc2VsZWN0ZWRJdGVtcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdO1xuICAgICAgICBjb25zdCBjb250ZW50U3RhdHVzID0gaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLmRhdGFzZXQuY29udGVudFN0YXR1cztcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFN0YXR1cyA9PT0gY29udGVudFN0YXR1cykge1xuICAgICAgICAgIHRoaXMuY29udGVudFN0YXR1cyA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy5jb250ZW50U3RhdHVzID0gY29udGVudFN0YXR1cztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgIH0gfSwgc3RhdHVzZXMubWFwKChzdGF0dXMpID0+IChoKFwiY2FsY2l0ZS10cmVlLWl0ZW1cIiwgeyBcImRhdGEtY29udGVudC1zdGF0dXNcIjogc3RhdHVzLCBzZWxlY3RlZDogc3RhdHVzID09PSB0aGlzLmNvbnRlbnRTdGF0dXMgfSwgaChcImFcIiwgbnVsbCwgdGhpcy5pMThuW3N0YXR1c10pKSkpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyRGF0ZSA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJcIiwgNyk7XG4gICAgdGhpcy5wcm9wZXJ0eSA9IFwibW9kaWZpZWRcIjtcbiAgICB0aGlzLnJhbmdlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc3RhcnQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5lbmQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5leHBhbmRlZCA9IHVuZGVmaW5lZDtcbiAgfVxuICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgfVxuICBnZXRFdmVudERldGFpbChkZXRhaWwpIHtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7IHBhcmFtOiBcInFcIiB9LCBkZXRhaWwpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IHByb3BlcnR5LCByYW5nZSwgc3RhcnQsIGVuZCwgc3RvcmUsIGV4cGFuZGVkIH0gPSB0aGlzO1xuICAgIHJldHVybiAoaChcImFyY2dpcy1icm93c2VyLWZpbHRlci1kYXRlXCIsIHsgc2VydmVyUHJvcGVydHk6IHByb3BlcnR5ID09PSBcIm1vZGlmaWVkXCIgPyBwcm9wZXJ0eSA6IFwidXBsb2FkZWRcIiwgcHJvcGVydHk6IHRoaXMucHJvcGVydHksIHN0b3JlOiBzdG9yZSwgc3RhcnQ6IHN0YXJ0LCBlbmQ6IGVuZCwgcmFuZ2U6IHJhbmdlLCBleHBhbmRlZDogZXhwYW5kZWQsIG9uQXJjZ2lzQnJvd3NlckZpbHRlcjogKGUpID0+IHtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoZS5kZXRhaWwpKTtcbiAgICAgIH0gfSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IGFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyRXh0ZW50Q3NzID0gXCIuZmlsdGVyLWV4dGVudHttYXJnaW4tYm90dG9tOjAuNXJlbTt3aWR0aDoxMDAlO2Rpc3BsYXk6ZmxleH0uZmlsdGVyLWV4dGVudF9fbGFiZWx7ZmxleDoxIDEgMCV9LmZpbHRlci1leHRlbnRfX3N3aXRjaHtwYWRkaW5nLWxlZnQ6MC4yNXJlbTtwYWRkaW5nLXJpZ2h0OjAuMjVyZW19LmZpbHRlci1leHRlbnQtLXBhZGRlZHtib3gtc2l6aW5nOmJvcmRlci1ib3g7cGFkZGluZy1sZWZ0OjFyZW07cGFkZGluZy1yaWdodDoxcmVtO3BhZGRpbmctdG9wOjA7cGFkZGluZy1ib3R0b206MC41cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckV4dGVudCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJcIiwgNyk7XG4gICAgdGhpcy5leHRlbnQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jaGVja2VkID0gdW5kZWZpbmVkO1xuICB9XG4gIGVtaXRDaGVja2VkQ2hhbmdlKCkge1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICB9XG4gIGVtaXRFeHRlbnRDaGFuZ2UoKSB7XG4gICAgaWYgKHRoaXMuY2hlY2tlZCkge1xuICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgfVxuICB9XG4gIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5maWx0ZXJFeHRlbnQ7XG4gIH1cbiAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICBpZiAodGhpcy5leHRlbnQgJiYgdGhpcy5jaGVja2VkKSB7XG4gICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICB9XG4gICAgb25Ccm93c2VyRmlsdGVyUmVtb3ZlKFwiZXh0ZW50XCIsIHRoaXMuc3RvcmUsICgpID0+ICh0aGlzLmNoZWNrZWQgPSBmYWxzZSkpO1xuICB9XG4gIGdldEV2ZW50RGV0YWlsKCkge1xuICAgIGNvbnN0IHsgZXh0ZW50LCBjaGVja2VkLCBpMThuIH0gPSB0aGlzO1xuICAgIHJldHVybiB7XG4gICAgICBpZDogXCJleHRlbnRcIixcbiAgICAgIHBhcmFtOiBcImJib3hcIixcbiAgICAgIHZhbHVlOiBjaGVja2VkICYmIGV4dGVudCA/IGV4dGVudCA6IFwiXCIsXG4gICAgICBsYWJlbDogZXh0ZW50ICYmIGNoZWNrZWQgPyBpMThuLmxhYmVsIDogXCJcIixcbiAgICAgIGV4dGVudFxuICAgIH07XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogeyBcImZpbHRlci1leHRlbnRcIjogdHJ1ZSwgXCJmaWx0ZXItZXh0ZW50LS1wYWRkZWRcIjogKF9iID0gKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IucGFuZWwgfSB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGxheW91dDogXCJpbmxpbmVcIiB9LCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImZpbHRlci1leHRlbnRfX2xhYmVsXCIgfSwgdGhpcy5pMThuLnRpdGxlKSwgaChcImNhbGNpdGUtc3dpdGNoXCIsIHsgY2xhc3M6IFwiZmlsdGVyLWV4dGVudF9fc3dpdGNoXCIsIGNoZWNrZWQ6IHRoaXMuY2hlY2tlZCwgb25DYWxjaXRlU3dpdGNoQ2hhbmdlOiAoZSkgPT4ge1xuICAgICAgICB0aGlzLmNoZWNrZWQgPSBlLnRhcmdldC5jaGVja2VkO1xuICAgICAgfSB9KSkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgIFwiY2hlY2tlZFwiOiBbXCJlbWl0Q2hlY2tlZENoYW5nZVwiXSxcbiAgICBcImV4dGVudFwiOiBbXCJlbWl0RXh0ZW50Q2hhbmdlXCJdXG4gIH07IH1cbn07XG5BcmNnaXNJdGVtQnJvd3NlckZpbHRlckV4dGVudC5zdHlsZSA9IGFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyRXh0ZW50Q3NzO1xuXG5jb25zdCBhcmNnaXNJdGVtQnJvd3NlckZpbHRlckZvbGRlckNzcyA9IFwiLmhpZGUuc2MtYXJjZ2lzLWl0ZW0tYnJvd3Nlci1maWx0ZXItZm9sZGVye2Rpc3BsYXk6bm9uZX0uZm9sZGVycy5zYy1hcmNnaXMtaXRlbS1icm93c2VyLWZpbHRlci1mb2xkZXJ7bWF4LWhlaWdodDoxNi41cmVtO21pbi1oZWlnaHQ6NHJlbTttYXJnaW4tYm90dG9tOjEuNXJlbTttYXJnaW4tdG9wOjA7b3ZlcmZsb3c6YXV0bztsaXN0LXN0eWxlLXR5cGU6bm9uZTtwYWRkaW5nOjA7cG9zaXRpb246cmVsYXRpdmU7LS1jYWxjaXRlLWxpc3QtaXRlbS1zcGFjaW5nLWluZGVudDowLjVyZW07LS1jYWxjaXRlLWxpc3QtaXRlbS1zcGFjaW5nLWluZGVudC1tdWx0aXBsaWVyOjE7LS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMTp2YXIoLS1jYWxjaXRlLXVpLWJhY2tncm91bmQpfS5mb2xkZXIuc2MtYXJjZ2lzLWl0ZW0tYnJvd3Nlci1maWx0ZXItZm9sZGVye3dpZHRoOmNhbGMoMTAwJSAtIDEuNjVyZW0pO21hcmdpbi1sZWZ0OjAuODI1cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckZvbGRlciA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJcIiwgNyk7XG4gICAgdGhpcy5mb2xkZXIgPSBcImFsbFwiO1xuICAgIHRoaXMuYWxsb3dFZGl0cyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmV4cGFuZGVkID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZm9sZGVycyA9IFtdO1xuICB9XG4gIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5maWx0ZXJGb2xkZXI7XG4gICAgaWYgKGNvbmZpZ1N0YXRlLnVzZXIpIHtcbiAgICAgIHRoaXMuZmV0Y2hVc2VyRm9sZGVycyhjb25maWdTdGF0ZS51c2VyKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBvbkNvbmZpZ0NoYW5nZShcInVzZXJcIiwgKHVzZXIpID0+IHRoaXMuZmV0Y2hVc2VyRm9sZGVycyh1c2VyKSk7XG4gICAgfVxuICB9XG4gIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgaWYgKHRoaXMuZm9sZGVyICYmIHRoaXMuZm9sZGVyICE9PSBcImFsbFwiKSB7XG4gICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuZXhwYW5kZWQgJiYgdGhpcy5hY2NvcmRpb25JdGVtKSB7XG4gICAgICB0aGlzLmFjY29yZGlvbkl0ZW0uZXhwYW5kZWQgPSB0cnVlO1xuICAgIH1cbiAgICBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUoXCJmb2xkZXJcIiwgdGhpcy5zdG9yZSwgKCkgPT4gKHRoaXMuZm9sZGVyID0gXCJhbGxcIikpO1xuICB9XG4gIGdldEV2ZW50RGV0YWlsKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB7IGZvbGRlciB9ID0gdGhpcztcbiAgICBjb25zdCBmb2xkZXJOYW1lID0gZm9sZGVyID09PSBjb25maWdTdGF0ZS51c2VyLnVzZXJuYW1lID8gXCJyb290XCIgOiBmb2xkZXI7XG4gICAgY29uc3Qgc2VsZWN0ZWRGb2xkZXIgPSAoX2EgPSB0aGlzLmZvbGRlcnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5maW5kKChmKSA9PiBmLmlkID09PSBmb2xkZXIpO1xuICAgIGNvbnN0IGZvbGRlclRpdGxlID0gKHNlbGVjdGVkRm9sZGVyID09PSBudWxsIHx8IHNlbGVjdGVkRm9sZGVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZEZvbGRlci50aXRsZSkgfHwgXCJcIjtcbiAgICBjb25zdCB2YWx1ZSA9IGZvbGRlciAhPT0gXCJhbGxcIiA/IGBvd25lcmZvbGRlcjoke2ZvbGRlck5hbWV9YCA6IFwiXCI7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBcImZvbGRlclwiLFxuICAgICAgcGFyYW06IFwicVwiLFxuICAgICAgdmFsdWUsXG4gICAgICBsYWJlbDogdGhpcy5pMThuLmxhYmVsLnJlcGxhY2UoXCIke2ZvbGRlcn1cIiwgZm9sZGVyVGl0bGUpLFxuICAgICAgZm9sZGVyXG4gICAgfTtcbiAgfVxuICBhc3luYyBmZXRjaFVzZXJGb2xkZXJzKHVzZXIpIHtcbiAgICBjb25zdCBmb2xkZXJzID0gYXdhaXQgZ2V0Rm9sZGVycyh1c2VyKTtcbiAgICB0aGlzLmZvbGRlcnMgPSBbXG4gICAgICB7IGlkOiBcImFsbFwiLCBjcmVhdGVkOiBuZXcgRGF0ZSgpLCB0aXRsZTogdGhpcy5pMThuLmFsbCwgdXNlcm5hbWU6IFwiXCIgfSxcbiAgICAgIC4uLmZvbGRlcnNcbiAgICBdO1xuICB9XG4gIGdldEZvbGRlckljb24oaWQpIHtcbiAgICB2YXIgX2E7XG4gICAgc3dpdGNoIChpZCkge1xuICAgICAgY2FzZSBcImFsbFwiOlxuICAgICAgICByZXR1cm4gXCJmb2xkZXJzXCI7XG4gICAgICBjYXNlIChfYSA9IGNvbmZpZ1N0YXRlLnVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51c2VybmFtZTpcbiAgICAgICAgcmV0dXJuIFwiaG9tZVwiO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIFwiZm9sZGVyXCI7XG4gICAgfVxuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IHVzZXIgfSA9IGNvbmZpZ1N0YXRlO1xuICAgIGNvbnN0IGJ1Y2tldCA9IHRoaXMuc3RvcmUuc3RhdGUuYnVja2V0O1xuICAgIGNvbnN0IHsgaTE4biwgZm9sZGVycyB9ID0gdGhpcztcbiAgICBjb25zdCBoaWRlID0gIXVzZXIgfHwgIWZvbGRlcnMgfHwgKGJ1Y2tldCAmJiBidWNrZXQgIT09IFwibXlcIik7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJhcmNnaXMtYnJvd3Nlci1maWx0ZXJcIiwgeyBoZWFkaW5nOiBpMThuLmZvbGRlcnMsIGV4cGFuZGVkOiB0aGlzLmV4cGFuZGVkLCBub1BhZGRpbmc6IHRydWUsIGNsYXNzOiB7IGhpZGUgfSB9LCBoKFwiY2FsY2l0ZS1saXN0XCIsIHsgZmlsdGVyRW5hYmxlZDogdHJ1ZSwgc2VsZWN0aW9uQXBwZWFyYW5jZTogXCJib3JkZXJcIiwgc2VsZWN0aW9uTW9kZTogXCJzaW5nbGVcIiwgbG9hZGluZzogIWZvbGRlcnMsIGNsYXNzOiBcImZvbGRlcnNcIiwgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCBmaWx0ZXIgPSAoX2EgPSBlbCA9PT0gbnVsbCB8fCBlbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZWwuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5U2VsZWN0b3IoXCJjYWxjaXRlLWZpbHRlclwiKTtcbiAgICAgICAgaWYgKGZpbHRlcikge1xuICAgICAgICAgIGZpbHRlci5zdHlsZS5tYXJnaW5Ub3AgPSBcIi0ycHhcIjtcbiAgICAgICAgICAvLyBmb3Igc29tZSByZWFzb24sIGluc2lkZSBzaGFkb3cgZG9tIF9hbmRfIGEgcG9wb3ZlciwgaW4gc2FmYXJpIHRoZSBzdGlja3kgcG9zaXRpb25pbmcgdXNlZCBieSBjYWxjaXRlIHN0b3BzIHdvcmtpbmcuXG4gICAgICAgICAgZmlsdGVyLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgICAgICAgIGZpbHRlci5zdHlsZS50b3AgPSBcIjBcIjtcbiAgICAgICAgfVxuICAgICAgfSB9LCBmb2xkZXJzLm1hcCgoeyB0aXRsZSwgaWQgfSkgPT4gKGgoXCJjYWxjaXRlLWxpc3QtaXRlbVwiLCB7IGNsYXNzOiBcImZvbGRlclwiLCBsYWJlbDogdGl0bGUsIHZhbHVlOiBpZCwga2V5OiBpZCwgb25DYWxjaXRlTGlzdEl0ZW1TZWxlY3Q6ICgpID0+IHtcbiAgICAgICAgdGhpcy5mb2xkZXIgPSBpZDtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgICB9LCBzZWxlY3RlZDogdGhpcy5mb2xkZXIgPT09IGlkIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBpY29uOiB0aGlzLmdldEZvbGRlckljb24oaWQpLCBzbG90OiBcImNvbnRlbnQtc3RhcnRcIiwgc2NhbGU6IFwic1wiIH0pKSkpKSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJGb2xkZXIuc3R5bGUgPSBhcmNnaXNJdGVtQnJvd3NlckZpbHRlckZvbGRlckNzcztcblxuY29uc3QgYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJHcm91cENzcyA9IFwiLmhpZGUuc2MtYXJjZ2lzLWl0ZW0tYnJvd3Nlci1maWx0ZXItZ3JvdXB7ZGlzcGxheTpub25lfS5ncm91cHMuc2MtYXJjZ2lzLWl0ZW0tYnJvd3Nlci1maWx0ZXItZ3JvdXB7bWF4LWhlaWdodDoxNi41cmVtO21hcmdpbi1ib3R0b206MS41cmVtO21hcmdpbi10b3A6MDtvdmVyZmxvdzphdXRvO2xpc3Qtc3R5bGUtdHlwZTpub25lO3BhZGRpbmc6MDtwb3NpdGlvbjpyZWxhdGl2ZTstLWNhbGNpdGUtbGlzdC1pdGVtLXNwYWNpbmctaW5kZW50OjAuNXJlbTstLWNhbGNpdGUtbGlzdC1pdGVtLXNwYWNpbmctaW5kZW50LW11bHRpcGxpZXI6MTstLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0xOnZhcigtLWNhbGNpdGUtdWktYmFja2dyb3VuZCl9Lmdyb3VwLnNjLWFyY2dpcy1pdGVtLWJyb3dzZXItZmlsdGVyLWdyb3Vwe3dpZHRoOmNhbGMoMTAwJSAtIDEuNjVyZW0pO21hcmdpbi1sZWZ0OjAuODI1cmVtfS5ncm91cC10aHVtYm5haWwuc2MtYXJjZ2lzLWl0ZW0tYnJvd3Nlci1maWx0ZXItZ3JvdXB7bWFyZ2luLWxlZnQ6MC41cmVtO21hcmdpbi1yaWdodDowLjVyZW19XCI7XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyR3JvdXAgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyXCIsIDcpO1xuICAgIHRoaXMuZ3JvdXAgPSBcImFsbFwiO1xuICAgIHRoaXMuYWxsb3dFZGl0cyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmV4cGFuZGVkID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZ3JvdXBzID0gW107XG4gIH1cbiAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlckdyb3VwO1xuICAgIGlmIChjb25maWdTdGF0ZS51c2VyICYmIGNvbmZpZ1N0YXRlLnBvcnRhbCkge1xuICAgICAgdGhpcy5mZXRjaFVzZXJHcm91cHMoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBvbkNvbmZpZ0NoYW5nZShcInVzZXJcIiwgKCkgPT4gdGhpcy5mZXRjaFVzZXJHcm91cHMoKSk7XG4gICAgICBvbkNvbmZpZ0NoYW5nZShcInBvcnRhbFwiLCAoKSA9PiB0aGlzLmZldGNoVXNlckdyb3VwcygpKTtcbiAgICB9XG4gIH1cbiAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICBpZiAodGhpcy5leHBhbmRlZCAmJiB0aGlzLmFjY29yZGlvbkl0ZW0pIHtcbiAgICAgIHRoaXMuYWNjb3JkaW9uSXRlbS5leHBhbmRlZCA9IHRydWU7XG4gICAgfVxuICAgIG9uQnJvd3NlckZpbHRlclJlbW92ZShcImdyb3VwXCIsIHRoaXMuc3RvcmUsICgpID0+ICh0aGlzLmdyb3VwID0gXCJhbGxcIikpO1xuICB9XG4gIGdldEV2ZW50RGV0YWlsKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgY29uc3QgeyBncm91cCB9ID0gdGhpcztcbiAgICBjb25zdCBzZWxlY3RlZEdyb3VwID0gKF9hID0gdGhpcy5ncm91cHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5maW5kKChmKSA9PiBmLmlkID09PSBncm91cCk7XG4gICAgY29uc3QgZ3JvdXBUaXRsZSA9IChzZWxlY3RlZEdyb3VwID09PSBudWxsIHx8IHNlbGVjdGVkR3JvdXAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdGVkR3JvdXAudGl0bGUpIHx8IFwiXCI7XG4gICAgY29uc3QgdmFsdWUgPSBncm91cCAhPT0gXCJhbGxcIlxuICAgICAgPyBgZ3JvdXA6JHtncm91cH1gXG4gICAgICA6IGBncm91cDooJHsoX2IgPSB0aGlzLmdyb3VwcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm1hcCgoeyBpZCB9KSA9PiBpZCkuam9pbihcIiBPUiBcIil9KWA7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBcImdyb3VwXCIsXG4gICAgICBwYXJhbTogXCJxXCIsXG4gICAgICB2YWx1ZSxcbiAgICAgIGxhYmVsOiB0aGlzLmkxOG4ubGFiZWwucmVwbGFjZShcIiR7Z3JvdXB9XCIsIGdyb3VwVGl0bGUpLFxuICAgICAgZ3JvdXBcbiAgICB9O1xuICB9XG4gIGFzeW5jIGZldGNoVXNlckdyb3VwcygpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGlmIChjb25maWdTdGF0ZS51c2VyICYmIGNvbmZpZ1N0YXRlLnBvcnRhbCkge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgZ2V0U2lnbmVkSW5Vc2Vyc0dyb3VwcygpO1xuICAgICAgdGhpcy5ncm91cHMgPSBbeyBpZDogXCJhbGxcIiwgdGl0bGU6IHRoaXMuaTE4bi5hbGwgfSwgLi4uZ3JvdXBzXTtcbiAgICAgIGlmICgoKF9iID0gKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuYnVja2V0KSA9PT0gXCJncm91cFwiKSB7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyB1c2VyIH0gPSBjb25maWdTdGF0ZTtcbiAgICBjb25zdCBidWNrZXQgPSB0aGlzLnN0b3JlLnN0YXRlLmJ1Y2tldDtcbiAgICBjb25zdCB7IGkxOG4sIGdyb3VwcyB9ID0gdGhpcztcbiAgICBjb25zdCBoaWRlID0gIXVzZXIgfHwgIWdyb3VwcyB8fCAoYnVja2V0ICYmIGJ1Y2tldCAhPT0gXCJncm91cFwiKTtcbiAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImFyY2dpcy1icm93c2VyLWZpbHRlclwiLCB7IGhlYWRpbmc6IGkxOG4uZ3JvdXBzLCBleHBhbmRlZDogdGhpcy5leHBhbmRlZCwgbm9QYWRkaW5nOiB0cnVlLCBjbGFzczogeyBoaWRlIH0gfSwgaChcImNhbGNpdGUtbGlzdFwiLCB7IGZpbHRlckVuYWJsZWQ6IHRydWUsIHNlbGVjdGlvbkFwcGVhcmFuY2U6IFwiYm9yZGVyXCIsIHNlbGVjdGlvbk1vZGU6IFwic2luZ2xlXCIsIGxvYWRpbmc6ICFncm91cHMsIGNsYXNzOiBcImdyb3Vwc1wiLCByZWY6IChlbCkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IGZpbHRlciA9IChfYSA9IGVsID09PSBudWxsIHx8IGVsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlbC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucXVlcnlTZWxlY3RvcihcImNhbGNpdGUtZmlsdGVyXCIpO1xuICAgICAgICBpZiAoZmlsdGVyKSB7XG4gICAgICAgICAgZmlsdGVyLnN0eWxlLm1hcmdpblRvcCA9IFwiLTJweFwiO1xuICAgICAgICB9XG4gICAgICB9IH0sIGdyb3VwcyA9PT0gbnVsbCB8fCBncm91cHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGdyb3Vwcy5tYXAoKGdyb3VwKSA9PiAoaChcImNhbGNpdGUtbGlzdC1pdGVtXCIsIHsgY2xhc3M6IFwiZ3JvdXBcIiwgbGFiZWw6IGdyb3VwLnRpdGxlLCB2YWx1ZTogZ3JvdXAuaWQsIGtleTogZ3JvdXAuaWQsIG9uQ2FsY2l0ZUxpc3RJdGVtU2VsZWN0OiAoKSA9PiB7XG4gICAgICAgIHRoaXMuZ3JvdXAgPSBncm91cC5pZDtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5ncm91cElkID0gZ3JvdXAuaWQ7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgICAgfSwgc2VsZWN0ZWQ6IHRoaXMuZ3JvdXAgPT09IGdyb3VwLmlkIH0sIGdyb3VwLmlkID09PSBcImFsbFwiID8gKGgoXCJjYWxjaXRlLWljb25cIiwgeyBpY29uOiBcInVzZXJzXCIsIHNsb3Q6IFwiY29udGVudC1zdGFydFwiLCBzY2FsZTogXCJzXCIgfSkpIDogKGgoXCJhcmNnaXMtZ3JvdXAtdGh1bWJuYWlsXCIsIHsgc2xvdDogXCJjb250ZW50LXN0YXJ0XCIsIGNsYXNzOiBcImdyb3VwLXRodW1ibmFpbFwiLCBncm91cDogZ3JvdXAsIHBvcnRhbDogY29uZmlnU3RhdGUucG9ydGFsLCB0b29sdGlwOiBmYWxzZSwgc2NhbGU6IFwic1wiIH0pKSkpKSkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyR3JvdXAuc3R5bGUgPSBhcmNnaXNJdGVtQnJvd3NlckZpbHRlckdyb3VwQ3NzO1xuXG5jb25zdCB0ZW1wbGF0ZUluZHVzdHJpZXMgPSBbXG4gIFwiQWdyaWN1bHR1cmVcIixcbiAgXCJFbGVjdHJpYyBVdGlsaXRpZXNcIixcbiAgXCJFbnZpcm9ubWVudFwiLFxuICBcIkZvcmVzdHJ5XCIsXG4gIFwiR2FzIFV0aWxpdGllc1wiLFxuICBcIkdlbmVyYWxcIixcbiAgXCJOYXR1cmFsIFJlc291cmNlc1wiLFxuICBcIlBldHJvbGV1bVwiLFxuICBcIlB1YmxpYyBTYWZldHlcIixcbiAgXCJUZWxlY29tbXVuaWNhdGlvbnNcIixcbiAgXCJUcmFuc3BvcnRhdGlvblwiLFxuICBcIldhdGVyIFV0aWxpdGllc1wiXG5dO1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckluZHVzdHJ5ID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckZpbHRlclwiLCA3KTtcbiAgICB0aGlzLmluZHVzdHJ5ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZXhwYW5kZWQgPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlckluZHVzdHJ5O1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgaWYgKHRoaXMuaW5kdXN0cnkpIHtcbiAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgIH1cbiAgICBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUoXCJpbmR1c3RyeVwiLCB0aGlzLnN0b3JlLCAoKSA9PiAodGhpcy5pbmR1c3RyeSA9IG51bGwpKTtcbiAgfVxuICBnZXRFdmVudERldGFpbCgpIHtcbiAgICBjb25zdCB7IGluZHVzdHJ5IH0gPSB0aGlzO1xuICAgIGNvbnN0IHZhbHVlID0gaW5kdXN0cnkgPyBgdHlwZWtleXdvcmRzOiBcIiR7aW5kdXN0cnl9XCJgIDogXCJcIjtcbiAgICBjb25zdCBsYWJlbCA9IHRoaXMuaTE4bi5JbmR1c3RyeS5yZXBsYWNlKFwiJHtpbmR1c3RyeX1cIiwgdGhpcy5pMThuW2luZHVzdHJ5XSk7XG4gICAgcmV0dXJuIHsgaWQ6IFwiaW5kdXN0cnlcIiwgcGFyYW06IFwiZmlsdGVyXCIsIHZhbHVlLCBsYWJlbCwgaW5kdXN0cnkgfTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChoKFwiYXJjZ2lzLWJyb3dzZXItZmlsdGVyXCIsIHsgaGVhZGluZzogdGhpcy5pMThuLnRpdGxlLCBleHBhbmRlZDogdGhpcy5leHBhbmRlZCwgYWN0aXZlOiAhIXRoaXMuaW5kdXN0cnksIG9uQXJjZ2lzQnJvd3NlckZpbHRlclJlbW92ZTogKCkgPT4ge1xuICAgICAgICB0aGlzLmluZHVzdHJ5ID0gbnVsbDtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgICB9IH0sIGgoXCJjYWxjaXRlLXRyZWVcIiwgeyBzZWxlY3Rpb25Nb2RlOiBcInNpbmdsZVwiLCBzY2FsZTogXCJzXCIsIG9uQ2FsY2l0ZVRyZWVTZWxlY3Q6IChldmVudCkgPT4ge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICBjb25zdCBpbmR1c3RyeSA9ICgoX2IgPSAoX2EgPSBub2RlLnNlbGVjdGVkSXRlbXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmRhdGFzZXQuaW5kdXN0cnkpIHx8IFwiXCI7XG4gICAgICAgIGlmICh0aGlzLmluZHVzdHJ5ID09PSBpbmR1c3RyeSkge1xuICAgICAgICAgIHRoaXMuaW5kdXN0cnkgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHRoaXMuaW5kdXN0cnkgPSBpbmR1c3RyeTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgIH0gfSwgdGVtcGxhdGVJbmR1c3RyaWVzLm1hcCgoaW5kdXN0cnkpID0+IChoKFwiY2FsY2l0ZS10cmVlLWl0ZW1cIiwgeyBcImRhdGEtaW5kdXN0cnlcIjogaW5kdXN0cnksIHNlbGVjdGVkOiBpbmR1c3RyeSA9PT0gdGhpcy5pbmR1c3RyeSB9LCBoKFwiYVwiLCBudWxsLCB0aGlzLmkxOG5baW5kdXN0cnldKSkpKSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckl0ZW1UeXBlID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckZpbHRlclwiLCA3KTtcbiAgICB0aGlzLnJlbmRlckl0ZW1UeXBlID0gKFtrZXksIG9wdGlvbl0pID0+IHtcbiAgICAgIGNvbnN0IHsgaXRlbVR5cGUsIGFsbG93ZWRJdGVtVHlwZXMgfSA9IHRoaXM7XG4gICAgICBjb25zdCBkaXNhbGxvd2VkVHlwZSA9ICEoYWxsb3dlZEl0ZW1UeXBlcyA9PT0gbnVsbCB8fCBhbGxvd2VkSXRlbVR5cGVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhbGxvd2VkSXRlbVR5cGVzLmluY2x1ZGVzKGtleSkpO1xuICAgICAgY29uc3QgY2hpbGRyZW5BbGxvd2VkID0gYWxsb3dlZEl0ZW1UeXBlcyAmJlxuICAgICAgICBkaXNhbGxvd2VkVHlwZSAmJlxuICAgICAgICBvcHRpb24uY2hpbGRyZW4gJiZcbiAgICAgICAgT2JqZWN0LmtleXMob3B0aW9uLmNoaWxkcmVuKS5zb21lKChjaGlsZCkgPT4gYWxsb3dlZEl0ZW1UeXBlcy5pbmNsdWRlcyhjaGlsZCkpO1xuICAgICAgaWYgKChkaXNhbGxvd2VkVHlwZSAmJiAhY2hpbGRyZW5BbGxvd2VkKSB8fFxuICAgICAgICAob3B0aW9uLnNob3cgJiYgIW9wdGlvbi5zaG93KGNvbmZpZ1N0YXRlLnBvcnRhbCwgY29uZmlnU3RhdGUudXNlckxpY2Vuc2VkSXRlbXMpKSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGlmIChkaXNhbGxvd2VkVHlwZSAmJiBjaGlsZHJlbkFsbG93ZWQpIHtcbiAgICAgICAgcmV0dXJuIGgoRnJhZ21lbnQsIG51bGwsIE9iamVjdC5lbnRyaWVzKG9wdGlvbi5jaGlsZHJlbikubWFwKHRoaXMucmVuZGVySXRlbVR5cGUpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAoaChcImNhbGNpdGUtdHJlZS1pdGVtXCIsIHsgXCJkYXRhLWl0ZW0tdHlwZVwiOiBrZXksIFwiZGF0YS1jaGlsZHJlblwiOiAhIW9wdGlvbi5jaGlsZHJlbiwgc2VsZWN0ZWQ6IGtleSA9PT0gaXRlbVR5cGUgfSwgaChcImFcIiwgbnVsbCwgaXRlbVR5cGVOYW1lc1trZXldKSwgb3B0aW9uLmNoaWxkcmVuICYmIChoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2xvdDogXCJjaGlsZHJlblwiLCBzZWxlY3Rpb25Nb2RlOiBcImNoaWxkcmVuXCIgfSwgT2JqZWN0LmVudHJpZXMob3B0aW9uLmNoaWxkcmVuKS5tYXAodGhpcy5yZW5kZXJJdGVtVHlwZSkpKSkpO1xuICAgIH07XG4gICAgdGhpcy5pdGVtVHlwZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmFsbG93ZWRJdGVtVHlwZXMgPSBkZWZhdWx0SXRlbVR5cGVzO1xuICAgIHRoaXMuZXhwYW5kZWQgPSB1bmRlZmluZWQ7XG4gIH1cbiAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlckl0ZW1UeXBlO1xuICB9XG4gIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgdmFyIF9hO1xuICAgIGlmICh0aGlzLml0ZW1UeXBlKSB7XG4gICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgIGxldCBhY3RpdmVJdGVtID0gKF9hID0gdGhpcy5lbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5U2VsZWN0b3IoYGNhbGNpdGUtdHJlZS1pdGVtW2RhdGEtaXRlbS10eXBlPVwiJHt0aGlzLml0ZW1UeXBlfVwiXWApO1xuICAgICAgLy8gZXhwYW5kIHBhcmVudHMgb24gbG9hZCBpZiBpbml0aWFsIHZhbHVlIHdhcyBwcm92aWRlZFxuICAgICAgd2hpbGUgKGFjdGl2ZUl0ZW0pIHtcbiAgICAgICAgYWN0aXZlSXRlbS5leHBhbmRlZCA9IHRydWU7XG4gICAgICAgIGFjdGl2ZUl0ZW0gPSBhY3RpdmVJdGVtLnBhcmVudEVsZW1lbnQuY2xvc2VzdChcImNhbGNpdGUtdHJlZS1pdGVtXCIpO1xuICAgICAgICBpZiAoIShhY3RpdmVJdGVtID09PSBudWxsIHx8IGFjdGl2ZUl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFjdGl2ZUl0ZW0uY2xvc2VzdChcImFyY2dpcy1pdGVtLWJyb3dzZXItZmlsdGVyLWl0ZW0tdHlwZVwiKSkpIHtcbiAgICAgICAgICBhY3RpdmVJdGVtID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUoXCJpdGVtVHlwZVwiLCB0aGlzLnN0b3JlLCAoKSA9PiAodGhpcy5pdGVtVHlwZSA9IG51bGwpKTtcbiAgfVxuICBnZXRFdmVudERldGFpbCgpIHtcbiAgICBjb25zdCB7IGl0ZW1UeXBlIH0gPSB0aGlzO1xuICAgIGNvbnN0IG9wdGlvbiA9IGdldEl0ZW1UeXBlT3B0aW9uKGl0ZW1UeXBlKTtcbiAgICBjb25zdCB2YWx1ZSA9IChvcHRpb24gPT09IG51bGwgfHwgb3B0aW9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb24ucSkgPyBgKCR7b3B0aW9uLnF9KWAgOiBcIlwiO1xuICAgIGNvbnN0IGxhYmVsID0gb3B0aW9uID8gdGhpcy5pMThuLml0ZW1UeXBlLnJlcGxhY2UoXCIke2l0ZW1UeXBlfVwiLCBpdGVtVHlwZU5hbWVzW2l0ZW1UeXBlXSkgOiBcIlwiO1xuICAgIHJldHVybiB7IGlkOiBcIml0ZW1UeXBlXCIsIHBhcmFtOiBcInFcIiwgdmFsdWUsIGxhYmVsLCBpdGVtVHlwZSB9O1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gKGgoXCJhcmNnaXMtYnJvd3Nlci1maWx0ZXJcIiwgeyBoZWFkaW5nOiB0aGlzLmkxOG4udGl0bGUsIGV4cGFuZGVkOiB0aGlzLmV4cGFuZGVkLCBhY3RpdmU6ICEhdGhpcy5pdGVtVHlwZSwgb25BcmNnaXNCcm93c2VyRmlsdGVyUmVtb3ZlOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuaXRlbVR5cGUgPSBudWxsO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgIH0gfSwgaChcImNhbGNpdGUtdHJlZVwiLCB7IHNlbGVjdGlvbk1vZGU6IFwiY2hpbGRyZW5cIiwgc2NhbGU6IFwibVwiLCBvbkNhbGNpdGVUcmVlU2VsZWN0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgY29uc3QgZGF0YXNldCA9IChfYiA9IChfYSA9IG5vZGUgPT09IG51bGwgfHwgbm9kZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbm9kZS5zZWxlY3RlZEl0ZW1zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF0pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5kYXRhc2V0O1xuICAgICAgICBjb25zdCBpdGVtVHlwZSA9IChkYXRhc2V0ID09PSBudWxsIHx8IGRhdGFzZXQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGFzZXQuaXRlbVR5cGUpIHx8IFwiXCI7XG4gICAgICAgIGlmICh0aGlzLml0ZW1UeXBlID09PSBpdGVtVHlwZSkge1xuICAgICAgICAgIHRoaXMuaXRlbVR5cGUgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHRoaXMuaXRlbVR5cGUgPSBpdGVtVHlwZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgIH0gfSwgT2JqZWN0LmVudHJpZXMoaXRlbVR5cGVPcHRpb25zKS5tYXAodGhpcy5yZW5kZXJJdGVtVHlwZSkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcblxuZnVuY3Rpb24gZ2VvY29kZXJTdXBwb3J0c1N1Z2dlc3Rpb25zKGdlb2NvZGVyKSB7XG4gIHJldHVybiAhISgoZ2VvY29kZXIuc2luZ2xlTGluZUZpZWxkTmFtZSB8fCBpc0VzcmlXb3JsZEdlb2NvZGVyKGdlb2NvZGVyLnVybCkgfHwgZ2VvY29kZXIuZW5hYmxlU3VnZ2VzdGlvbnMpICYmXG4gICAgZ2VvY29kZXIucGxhY2VmaW5kaW5nKTtcbn1cbmZ1bmN0aW9uIGdldFNlYXJjaEdlb2NvZGluZ1NlcnZpY2VzKHBvcnRhbCwgY29uZmlnLCBpMThuKSB7XG4gIHZhciBfYTtcbiAgY29uc3QgaGVscGVyU2VydmljZXMgPSBwb3J0YWwuaGVscGVyU2VydmljZXMgfHwge307XG4gIGxldCBnZW9jb2RlcnMgPSBbLi4uKGhlbHBlclNlcnZpY2VzLmdlb2NvZGUgfHwgW10pXTtcbiAgY29uc3QgZ2VvY29kZUF1dG9Db21wbGV0ZSA9IChfYSA9IGNvbmZpZy5nZW9jb2RlQXV0b0NvbXBsZXRlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBmYWxzZTtcbiAgcmV0dXJuIGdlb2NvZGVyc1xuICAgIC5maWx0ZXIoZ2VvY29kZXJTdXBwb3J0c1N1Z2dlc3Rpb25zKVxuICAgIC5tYXAoKGdlb2NvZGVyKSA9PiB7XG4gICAgLy8gZGV0ZXJtaW5lIGlmIHdlIG5lZWQgdG8gZW5hYmxlIHN1Z2dlc3Rpb25zXG4gICAgY29uc3QgZW5hYmxlU3VnZ2VzdGlvbnMgPSBnZW9jb2Rlci5zdWdnZXN0ID09PSB0cnVlICYmIGdlb2NvZGVBdXRvQ29tcGxldGUgPyB0cnVlIDogZmFsc2U7XG4gICAgY29uc3QgaXNFc3JpID0gaXNFc3JpV29ybGRHZW9jb2RlcihnZW9jb2Rlci51cmwpO1xuICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGdlb2NvZGVyKSwgeyBuYW1lOiBpc0VzcmkgPyBcIkFyY0dJUyBXb3JsZCBHZW9jb2RpbmcgU2VydmljZVwiIDogZ2VvY29kZXIubmFtZSwgZW5hYmxlU3VnZ2VzdGlvbnMsIGNhdGVnb3JpZXM6IGlzRXNyaSA/IFtcIlBvcHVsYXRlZCBQbGFjZVwiLCBcIkNvb3JkaW5hdGUgU3lzdGVtXCJdIDogbnVsbCwgcGxhY2VmaW5kaW5nOiBpc0VzcmkgPyB0cnVlIDogZ2VvY29kZXIucGxhY2VmaW5kaW5nLCBvdXRGaWVsZHM6IGlzRXNyaSA/IFtcIk1hdGNoX2FkZHJcIiwgXCJBZGRyX3R5cGVcIiwgXCJTdEFkZHJcIiwgXCJDaXR5XCJdIDogbnVsbCwgcGxhY2Vob2xkZXI6IGdlb2NvZGVyLnBsYWNlaG9sZGVyIHx8IGkxOG4uZmluZExvY2F0aW9uVGV4dCwgc2luZ2xlTGluZUZpZWxkTmFtZTogZ2VvY29kZXIuc2luZ2xlTGluZUZpZWxkTmFtZSB8fCBcIlNpbmdsZUxpbmVcIiwgaGlnaGxpZ2h0U3ltYm9sOiBudWxsLCBsb2NhbFNlYXJjaE9wdGlvbnM6IHtcbiAgICAgICAgbWluU2NhbGU6IDMwMDAwMCxcbiAgICAgICAgZGlzdGFuY2U6IDUwMDAwXG4gICAgICB9IH0pO1xuICB9KTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUV4dGVudFNlYXJjaE9wdGlvbnMocG9ydGFsLCBjb25maWcsIGkxOG4sIHZhbHVlKSB7XG4gIHZhciBfYTtcbiAgY29uc3Qgc3VnZ2VzdGlvbnNFbmFibGVkID0gKF9hID0gY29uZmlnID09PSBudWxsIHx8IGNvbmZpZyA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnLmdlb2NvZGVBdXRvQ29tcGxldGUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGZhbHNlO1xuICBjb25zdCBzZWFyY2hMYXllcnMgPSBbXTsgLy8gdHlwZSA9PT0gXCJleHRlbnRcIlxuICBjb25zdCBnZW9jb2RlcnMgPSBnZXRTZWFyY2hHZW9jb2RpbmdTZXJ2aWNlcyhwb3J0YWwsIGNvbmZpZywgaTE4bik7XG4gIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgc3VnZ2VzdGlvbnNFbmFibGVkLFxuICAgIG1pblN1Z2dlc3RDaGFyYWN0ZXJzOiAzLFxuICAgIG1heFJlc3VsdHM6IDUsXG4gICAgc2VhcmNoVGVybTogdmFsdWUgfHwgbnVsbCxcbiAgICBhY3RpdmVTb3VyY2VJbmRleDogXCJhbGxcIixcbiAgICBzb3VyY2VzOiBzZWFyY2hMYXllcnMuY29uY2F0KGdlb2NvZGVycyksXG4gICAgcG9wdXBFbmFibGVkOiBmYWxzZVxuICB9O1xuICAvLyByZW1vdmUgYWN0aXZlU291cmNlSW5kZXggaWYgdGhlcmUgaXMgb25seSBhIHNpbmdsZSBnZW9jb2RlclxuICBpZiAob3B0aW9ucy5zb3VyY2VzLmxlbmd0aCA9PT0gMSkge1xuICAgIGRlbGV0ZSBvcHRpb25zLmFjdGl2ZVNvdXJjZUluZGV4O1xuICB9XG4gIHJldHVybiBvcHRpb25zO1xufVxuXG5jb25zdCBhcmNnaXNJdGVtQnJvd3NlckZpbHRlckxvY2F0aW9uQ3NzID0gXCIubG9jYXRpb24tZmlsdGVyX19jb250YWluZXJ7ZGlzcGxheTpmbGV4O3dpZHRoOjEwMCU7Ym94LXNpemluZzpib3JkZXItYm94fS5sb2NhdGlvbi1maWx0ZXJfX2lucHV0e2ZsZXg6MSAxIDAlOy0tY2FsY2l0ZS11aS1ib3JkZXItaW5wdXQ6dmFyKC0tY2FsY2l0ZS11aS1ib3JkZXItMyl9LmxvY2F0aW9uLWZpbHRlcl9fYnV0dG9uey13ZWJraXQtbWFyZ2luLXN0YXJ0Oi0xcHg7bWFyZ2luLWlubGluZS1zdGFydDotMXB4fS5sb2NhdGlvbi1maWx0ZXJfX3N1Z2dlc3Rpb25ze292ZXJmbG93LXk6YXV0bztib3gtc2l6aW5nOmJvcmRlci1ib3g7aGVpZ2h0OjhyZW07Ym9yZGVyLXRvcDoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1ib3JkZXItMSk7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1ib3JkZXItMSk7d2lkdGg6Y2FsYyh2YXIoLS1pdGVtLWJyb3dzZXItcGFuZS13aWR0aCkgLSAyLjVyZW0pfS5sb2NhdGlvbi1maWx0ZXJfX25vLXJlc3VsdHN7bWFyZ2luLXRvcDozcmVtO3BhZGRpbmctdG9wOjAuNXJlbTtwYWRkaW5nLWJvdHRvbTowO21hcmdpbi1ib3R0b206MDt0ZXh0LWFsaWduOmNlbnRlcjtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMyl9XCI7XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyTG9jYXRpb24gPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyXCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJTb3J0ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlclNvcnRcIiwgNyk7XG4gICAgdGhpcy5zdWdnZXN0ID0gKHRlcm0pID0+IHtcbiAgICAgIHRoaXMubG9hZGluZ1N1Z2dlc3Rpb25zID0gdHJ1ZTtcbiAgICAgIGlmICgodGVybSA9PT0gbnVsbCB8fCB0ZXJtID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZXJtLmxlbmd0aCkgPiAyKSB7XG4gICAgICAgIHRoaXMuc2VhcmNoVmlld01vZGVsLnN1Z2dlc3QodGVybSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5sb2FkaW5nU3VnZ2VzdGlvbnMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdWdnZXN0aW9ucyA9IFtdO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5kZWJvdW5jZWRTdWdnZXN0ID0gZGVib3VuY2UodGhpcy5zdWdnZXN0LmJpbmQodGhpcyksIDEwMDApO1xuICAgIHRoaXMudXBkYXRlU3VnZ2VzdCA9ICh0ZXJtKSA9PiB7XG4gICAgICBpZiAoKHRlcm0gPT09IG51bGwgfHwgdGVybSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVybS5sZW5ndGgpID4gMikge1xuICAgICAgICB0aGlzLmxvYWRpbmdTdWdnZXN0aW9ucyA9IHRydWU7XG4gICAgICB9XG4gICAgICB0aGlzLmRlYm91bmNlZFN1Z2dlc3QodGVybSk7XG4gICAgfTtcbiAgICB0aGlzLmxvY2F0aW9uID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZXh0ZW50ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZXhwYW5kZWQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5sb2FkaW5nID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2VhcmNoaW5nID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc3VnZ2VzdGlvbnMgPSBbXTtcbiAgICB0aGlzLmxvYWRpbmdTdWdnZXN0aW9ucyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNlYXJjaFRlcm0gPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlckxvY2F0aW9uO1xuICAgIG9uQnJvd3NlckZpbHRlclJlbW92ZShcImxvY2F0aW9uXCIsIHRoaXMuc3RvcmUsICgpID0+IHtcbiAgICAgIHZhciBfYTtcbiAgICAgIHRoaXMubG9jYXRpb24gPSBudWxsO1xuICAgICAgdGhpcy5leHRlbnQgPSBudWxsO1xuICAgICAgKF9hID0gdGhpcy5zZWFyY2hWaWV3TW9kZWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jbGVhcigpO1xuICAgICAgdGhpcy5zZWFyY2hUZXJtID0gXCJcIjtcbiAgICB9KTtcbiAgfVxuICBhc3luYyBjb21wb25lbnREaWRMb2FkKCkge1xuICAgIGlmICh0aGlzLmxvY2F0aW9uICYmIHRoaXMuZXh0ZW50KSB7XG4gICAgICB0aGlzLnNlYXJjaFRlcm0gPSB0aGlzLmxvY2F0aW9uO1xuICAgICAgdGhpcy5lbWl0RmlsdGVyRXZlbnQoKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS5wb3J0YWwpIHtcbiAgICAgIHRoaXMuc2V0dXBTZWFyY2goKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBvbkNvbmZpZ0NoYW5nZShcInBvcnRhbFwiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0dXBTZWFyY2goKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICBhc3luYyBzZXR1cFNlYXJjaCgpIHtcbiAgICBjb25zdCBvcHRpb25zID0gY3JlYXRlRXh0ZW50U2VhcmNoT3B0aW9ucyhjb25maWdTdGF0ZS5wb3J0YWwsIGNvbmZpZ1N0YXRlLmNvbmZpZywgdGhpcy5pMThuLCB0aGlzLmxvY2F0aW9uKTtcbiAgICBjb25zdCBbU2VhcmNoVmlld01vZGVsXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvd2lkZ2V0cy9TZWFyY2gvU2VhcmNoVmlld01vZGVsXCJdKTtcbiAgICB0aGlzLnNlYXJjaFZpZXdNb2RlbCA9IG5ldyBTZWFyY2hWaWV3TW9kZWwoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zKSwgeyBhbGxQbGFjZWhvbGRlcjogdGhpcy5pMThuLmZpbmRMb2NhdGlvblRleHQsIHNob3dJbmZvV2luZG93T25TZWxlY3Q6IGZhbHNlIH0pKTtcbiAgICB0aGlzLnNlYXJjaFZpZXdNb2RlbC5vbihcInN1Z2dlc3Qtc3RhcnRcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5sb2FkaW5nU3VnZ2VzdGlvbnMgPSB0cnVlO1xuICAgIH0pO1xuICAgIHRoaXMuc2VhcmNoVmlld01vZGVsLm9uKFwic3VnZ2VzdC1jb21wbGV0ZVwiLCBhc3luYyAoZSkgPT4ge1xuICAgICAgdGhpcy5zdWdnZXN0aW9ucyA9IFsuLi5lLnJlc3VsdHNdO1xuICAgICAgdGhpcy5sb2FkaW5nU3VnZ2VzdGlvbnMgPSBmYWxzZTtcbiAgICB9KTtcbiAgICB0aGlzLnNlYXJjaFZpZXdNb2RlbC5vbihcInNlYXJjaC1zdGFydFwiLCAoKSA9PiB7XG4gICAgICB0aGlzLmxvYWRpbmdTdWdnZXN0aW9ucyA9IGZhbHNlO1xuICAgICAgdGhpcy5zZWFyY2hpbmcgPSB0cnVlO1xuICAgICAgdGhpcy5zdWdnZXN0UG9wb3Zlci5vcGVuID0gZmFsc2U7XG4gICAgfSk7XG4gICAgdGhpcy5zZWFyY2hWaWV3TW9kZWwub24oXCJzZWFyY2gtY29tcGxldGVcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5zZWFyY2hpbmcgPSBmYWxzZTtcbiAgICB9KTtcbiAgICB0aGlzLnNlYXJjaFZpZXdNb2RlbC5vbihcInNlbGVjdC1yZXN1bHRcIiwgdGhpcy5oYW5kbGVMb2NhdGlvbkNoYW5nZS5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLnNlYXJjaFZpZXdNb2RlbC5vbihcInNlYXJjaC1jbGVhclwiLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5leHRlbnQgJiYgdGhpcy5sb2NhdGlvbikge1xuICAgICAgICB0aGlzLmxvY2F0aW9uID0gbnVsbDtcbiAgICAgICAgdGhpcy5leHRlbnQgPSBudWxsO1xuICAgICAgICB0aGlzLmVtaXRGaWx0ZXJFdmVudCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGhhbmRsZUxvY2F0aW9uQ2hhbmdlKGV2ZW50KSB7XG4gICAgdGhpcy5sb2NhdGlvbiA9IGV2ZW50LnJlc3VsdC5uYW1lO1xuICAgIGNvbnN0IGV4dCA9IGV2ZW50LnJlc3VsdC5leHRlbnQ7XG4gICAgdGhpcy5leHRlbnQgPSBgJHtleHQueG1pbn0sJHtleHQueW1pbn0sJHtleHQueG1heH0sJHtleHQueW1heH1gO1xuICAgIHRoaXMuZW1pdEZpbHRlckV2ZW50KCk7XG4gIH1cbiAgZW1pdEZpbHRlckV2ZW50KCkge1xuICAgIGNvbnN0IHsgbG9jYXRpb24sIGV4dGVudCB9ID0gdGhpcztcbiAgICBjb25zdCBsYWJlbCA9IHRoaXMuaTE4bi5sYWJlbC5yZXBsYWNlKFwiJHtsb2NhdGlvbn1cIiwgbG9jYXRpb24pO1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIuZW1pdCh7XG4gICAgICBpZDogXCJsb2NhdGlvblwiLFxuICAgICAgcGFyYW06IFwiYmJveFwiLFxuICAgICAgdmFsdWU6IGV4dGVudCAhPT0gbnVsbCAmJiBleHRlbnQgIT09IHZvaWQgMCA/IGV4dGVudCA6IFwiXCIsXG4gICAgICBsYWJlbCxcbiAgICAgIGxvY2F0aW9uLFxuICAgICAgZXh0ZW50XG4gICAgfSk7XG4gICAgLy8gd2hlbiBmaWx0ZXJpbmcgYnkgbG9jYXRpb24sIG9ubHkgcmVsZXZhbmNlIHNvcnQgb3JkZXIgaXMgYWxsb3dlZFxuICAgIGlmIChleHRlbnQpIHtcbiAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJTb3J0LmVtaXQoeyBzb3J0RmllbGQ6IFwicmVsZXZhbmNlXCIsIHNvcnRPcmRlcjogXCJkZXNjXCIgfSk7XG4gICAgfVxuICB9XG4gIGhhbmRsZVN1Z2dlc3RTZWxlY3Qoc3VnZ2VzdGlvbikge1xuICAgIHZhciBfYTtcbiAgICB0aGlzLnNlYXJjaFZpZXdNb2RlbC5zZWFyY2goc3VnZ2VzdGlvbik7XG4gICAgdGhpcy5zZWFyY2hUZXJtID0gc3VnZ2VzdGlvbi50ZXh0O1xuICAgIChfYSA9IHRoaXMuaW5wdXQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICB9XG4gIGhhc1Jlc3VsdHMoKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAoX2EgPSB0aGlzLnN1Z2dlc3Rpb25zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc29tZSgoc2VydmljZSkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSBzZXJ2aWNlID09PSBudWxsIHx8IHNlcnZpY2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlcnZpY2UucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aDsgfSk7XG4gIH1cbiAgcmVuZGVyU3VnZ2VzdGlvbnMoc2VydmljZSkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gKF9hID0gc2VydmljZSA9PT0gbnVsbCB8fCBzZXJ2aWNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXJ2aWNlLnJlc3VsdHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tYXAoKHN1Z2dlc3Rpb24pID0+IChoKFwiY2FsY2l0ZS1saXN0LWl0ZW1cIiwgeyBjbGFzczogXCJsb2NhdGlvbi1maWx0ZXJfX3N1Z2dlc3Rpb25cIiwga2V5OiBzdWdnZXN0aW9uLmtleSwgbGFiZWw6IHN1Z2dlc3Rpb24udGV4dCwgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVTdWdnZXN0U2VsZWN0KHN1Z2dlc3Rpb24pLCBvbktleVByZXNzOiAoZSkgPT4ge1xuICAgICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICAgIHRoaXMuaGFuZGxlU3VnZ2VzdFNlbGVjdChzdWdnZXN0aW9uKTtcbiAgICAgICAgfVxuICAgICAgfSB9KSkpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGlmICgoY29uZmlnU3RhdGUgPT09IG51bGwgfHwgY29uZmlnU3RhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbmZpZ1N0YXRlLmFwaSkgPT09IDMpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gKGgoXCJhcmNnaXMtYnJvd3Nlci1maWx0ZXJcIiwgeyBoZWFkaW5nOiB0aGlzLmkxOG4ubG9jYXRpb24sIGV4cGFuZGVkOiB0aGlzLmV4cGFuZGVkLCBhY3RpdmU6ICEhdGhpcy5sb2NhdGlvbiwgb25BcmNnaXNCcm93c2VyRmlsdGVyUmVtb3ZlOiAoKSA9PiB7XG4gICAgICAgIHRoaXMubG9jYXRpb24gPSBudWxsO1xuICAgICAgICB0aGlzLmV4dGVudCA9IG51bGw7XG4gICAgICAgIHRoaXMuZW1pdEZpbHRlckV2ZW50KCk7XG4gICAgICB9IH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJsb2NhdGlvbi1maWx0ZXJfX2NvbnRhaW5lclwiIH0sIGgoXCJjYWxjaXRlLWlucHV0XCIsIHsgbG9hZGluZzogdGhpcy5zZWFyY2hpbmcgfHwgdGhpcy5sb2FkaW5nU3VnZ2VzdGlvbnMsIHR5cGU6IFwidGV4dFwiLCB2YWx1ZTogdGhpcy5zZWFyY2hUZXJtLCBwbGFjZWhvbGRlcjogdGhpcy5pMThuLmZpbmRMb2NhdGlvblRleHQsIHNjYWxlOiBcIm1cIiwgY2xhc3M6IFwibG9jYXRpb24tZmlsdGVyX19pbnB1dFwiLCByZWY6IChlbCkgPT4gKHRoaXMuaW5wdXQgPSBlbCksIGNsZWFyYWJsZTogdHJ1ZSwgb25LZXlQcmVzczogKGUpID0+IHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBlLnRhcmdldC52YWx1ZTtcbiAgICAgICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIgJiYgZS50YXJnZXQgPT09IGUuY3VycmVudFRhcmdldCkge1xuICAgICAgICAgIHRoaXMuc2VhcmNoVGVybSA9IHZhbHVlO1xuICAgICAgICAgIHRoaXMuc2VhcmNoVmlld01vZGVsLnN1Z2dlc3QodmFsdWUpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfSwgb25LZXlEb3duOiAoZSkgPT4ge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBpZiAoZS5rZXkgPT09IFwiQXJyb3dEb3duXCIgJiYgIXRoaXMubG9hZGluZ1N1Z2dlc3Rpb25zICYmICgoX2EgPSB0aGlzLnN1Z2dlc3Rpb25zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSkge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgIChfYiA9IHRoaXMuZWwucXVlcnlTZWxlY3RvcihcImNhbGNpdGUtbGlzdC1pdGVtXCIpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc2V0Rm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgfSwgb25DYWxjaXRlSW5wdXRJbnB1dDogKGUpID0+IHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBlLnRhcmdldC52YWx1ZTtcbiAgICAgICAgdGhpcy5zZWFyY2hUZXJtID0gdmFsdWU7XG4gICAgICAgIHRoaXMudXBkYXRlU3VnZ2VzdCh2YWx1ZSk7XG4gICAgICB9IH0sIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGNsYXNzOiBcImxvY2F0aW9uLWZpbHRlcl9fYnV0dG9uXCIsIGxhYmVsOiBcInNlYXJjaFwiLCBzbG90OiBcImFjdGlvblwiLCBraW5kOiBcIm5ldXRyYWxcIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgaWNvblN0YXJ0OiBcInNlYXJjaFwiLCBzY2FsZTogXCJtXCIsIHJlZjogKGVsKSA9PiAodGhpcy5zZWFyY2hCdXR0b24gPSBlbCksIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgdGhpcy5zdWdnZXN0KHRoaXMuc2VhcmNoVGVybSk7XG4gICAgICB9LCBvbktleVByZXNzOiAoZSkgPT4ge1xuICAgICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIiB8fCBlLmtleSA9PT0gXCIgXCIpIHtcbiAgICAgICAgICB0aGlzLnN1Z2dlc3QodGhpcy5zZWFyY2hUZXJtKTtcbiAgICAgICAgfVxuICAgICAgfSwgZGlzYWJsZWQ6ICF0aGlzLnNlYXJjaFRlcm0gfSkpLCAhdGhpcy5sb2FkaW5nU3VnZ2VzdGlvbnMgJiYgKChfYSA9IHRoaXMuc2VhcmNoVGVybSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgPiAyICYmIChoKFwiY2FsY2l0ZS1wb3BvdmVyXCIsIHsgbGFiZWw6IHRoaXMuaTE4bi5zdWdnZXN0aW9ucywgcmVmZXJlbmNlRWxlbWVudDogdGhpcy5zZWFyY2hCdXR0b24sIHJlZjogKGVsKSA9PiAodGhpcy5zdWdnZXN0UG9wb3ZlciA9IGVsKSwgYXV0b0Nsb3NlOiB0cnVlLCBwb2ludGVyRGlzYWJsZWQ6IHRydWUsIG9mZnNldERpc3RhbmNlOiAwLCBvdmVybGF5UG9zaXRpb25pbmc6IFwiZml4ZWRcIiwgb3BlbjogdHJ1ZSwgcGxhY2VtZW50OiBcImJvdHRvbS1lbmRcIiwgZmxpcFBsYWNlbWVudHM6IFtcInRvcC1lbmRcIl0gfSwgdGhpcy5oYXNSZXN1bHRzKCkgPyAoaChcImNhbGNpdGUtbGlzdFwiLCB7IGtleTogdGhpcy5zZWFyY2hUZXJtLCBjbGFzczogXCJsb2NhdGlvbi1maWx0ZXJfX3N1Z2dlc3Rpb25zXCIgfSwgKF9iID0gdGhpcy5zdWdnZXN0aW9ucykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm1hcCgoc2VydmljZSkgPT4gdGhpcy5yZW5kZXJTdWdnZXN0aW9ucyhzZXJ2aWNlKSkpKSA6IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwibG9jYXRpb24tZmlsdGVyX19zdWdnZXN0aW9uc1wiIH0sIGgoXCJwXCIsIHsgY2xhc3M6IFwibG9jYXRpb24tZmlsdGVyX19uby1yZXN1bHRzXCIgfSwgdGhpcy5pMThuLm5vUmVzdWx0cy5yZXBsYWNlKFwiJHtzZWFyY2hUZXJtfVwiLCB0aGlzLnNlYXJjaFRlcm0pKSkpKSkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyTG9jYXRpb24uc3R5bGUgPSBhcmNnaXNJdGVtQnJvd3NlckZpbHRlckxvY2F0aW9uQ3NzO1xuXG5hc3luYyBmdW5jdGlvbiBmZXRjaFJlZ2lvbnMocG9ydGFsKSB7XG4gIHJldHVybiByZXF1ZXN0KGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9cG9ydGFscy9yZWdpb25zYCk7XG59XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyUmVnaW9uID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckZpbHRlclwiLCA3KTtcbiAgICB0aGlzLnJlZ2lvbnMgPSBbXTtcbiAgICB0aGlzLnJlZ2lvbiA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmV4cGFuZGVkID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubG9hZGluZyA9IHVuZGVmaW5lZDtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4uZmlsdGVyUmVnaW9uO1xuICAgIGlmIChjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUucG9ydGFsKSB7XG4gICAgICB0aGlzLmZldGNoUmVnaW9ucyhjb25maWdTdGF0ZS5wb3J0YWwpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIG9uQ29uZmlnQ2hhbmdlKFwicG9ydGFsXCIsIChwb3J0YWwpID0+IHRoaXMuZmV0Y2hSZWdpb25zKHBvcnRhbCkpO1xuICAgIH1cbiAgICBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUoXCJyZWdpb25cIiwgdGhpcy5zdG9yZSwgKCkgPT4gKHRoaXMucmVnaW9uID0gbnVsbCkpO1xuICB9XG4gIGFzeW5jIGZldGNoUmVnaW9ucyhwb3J0YWwpIHtcbiAgICB0aGlzLnJlZ2lvbnMgPSBhd2FpdCBmZXRjaFJlZ2lvbnMocG9ydGFsKTtcbiAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgfVxuICBhc3luYyBjb21wb25lbnREaWRMb2FkKCkge1xuICAgIGlmICh0aGlzLnJlZ2lvbikge1xuICAgICAgdGhpcy5lbWl0RmlsdGVyRXZlbnQoKTtcbiAgICB9XG4gIH1cbiAgZW1pdEZpbHRlckV2ZW50KCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB7IHJlZ2lvbiwgaTE4biB9ID0gdGhpcztcbiAgICBjb25zdCBjYXRlZ29yeVZhbHVlID0gcmVnaW9uID8gYC9yZWdpb24vJHtyZWdpb24udG9Mb3dlckNhc2UoKX1gIDogXCJcIjtcbiAgICBjb25zdCB2YWx1ZSA9IHJlZ2lvbiA/IEpTT04uc3RyaW5naWZ5KFtjYXRlZ29yeVZhbHVlXSkgOiBcIlwiO1xuICAgIGNvbnN0IGFjdGl2ZVJlZ2lvbiA9IChfYSA9IHRoaXMucmVnaW9ucykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbmQoKHIpID0+IHIucmVnaW9uID09PSByZWdpb24pO1xuICAgIGNvbnN0IGxhYmVsID0gaTE4bi5yZWdpb24ucmVwbGFjZShcIiR7cmVnaW9ufVwiLCAoYWN0aXZlUmVnaW9uID09PSBudWxsIHx8IGFjdGl2ZVJlZ2lvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogYWN0aXZlUmVnaW9uLmxvY2FsaXplZE5hbWUpIHx8IChhY3RpdmVSZWdpb24gPT09IG51bGwgfHwgYWN0aXZlUmVnaW9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhY3RpdmVSZWdpb24ubmFtZSkgfHwgXCJcIik7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHtcbiAgICAgIGlkOiBcInJlZ2lvblwiLFxuICAgICAgcGFyYW06IFwiY2F0ZWdvcmllc1wiLFxuICAgICAgY2F0ZWdvcnlWYWx1ZSxcbiAgICAgIHZhbHVlLFxuICAgICAgbGFiZWwsXG4gICAgICByZWdpb25cbiAgICB9KTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgbG9hZGluZywgcmVnaW9ucywgc3RvcmUgfSA9IHRoaXM7XG4gICAgaWYgKGxvYWRpbmcgfHwgIShyZWdpb25zID09PSBudWxsIHx8IHJlZ2lvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlZ2lvbnMubGVuZ3RoKSB8fCAoKF9hID0gc3RvcmUuc3RhdGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5idWNrZXQpICE9PSBcImxpdmluZyBhdGxhc1wiKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIChoKFwiYXJjZ2lzLWJyb3dzZXItZmlsdGVyXCIsIHsgaGVhZGluZzogdGhpcy5pMThuLnJlZ2lvbnMsIGV4cGFuZGVkOiB0aGlzLmV4cGFuZGVkLCBhY3RpdmU6ICEhdGhpcy5yZWdpb24sIG9uQXJjZ2lzQnJvd3NlckZpbHRlclJlbW92ZTogKCkgPT4ge1xuICAgICAgICB0aGlzLnJlZ2lvbiA9IG51bGw7XG4gICAgICAgIHRoaXMuZW1pdEZpbHRlckV2ZW50KCk7XG4gICAgICB9IH0sIGgoXCJjYWxjaXRlLXRyZWVcIiwgeyBzZWxlY3Rpb25Nb2RlOiBcImNoaWxkcmVuXCIsIHNjYWxlOiBcIm1cIiwgb25DYWxjaXRlVHJlZVNlbGVjdDogKGV2ZW50KSA9PiB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIGNvbnN0IGRhdGFzZXQgPSAoX2IgPSAoX2EgPSBub2RlID09PSBudWxsIHx8IG5vZGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5vZGUuc2VsZWN0ZWRJdGVtcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZGF0YXNldDtcbiAgICAgICAgY29uc3QgcmVnaW9uID0gKGRhdGFzZXQgPT09IG51bGwgfHwgZGF0YXNldCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YXNldC52YWx1ZSkgfHwgXCJcIjtcbiAgICAgICAgaWYgKHRoaXMucmVnaW9uID09PSByZWdpb24pIHtcbiAgICAgICAgICB0aGlzLnJlZ2lvbiA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy5yZWdpb24gPSByZWdpb247XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbWl0RmlsdGVyRXZlbnQoKTtcbiAgICAgIH0gfSwgcmVnaW9ucy5tYXAoKHsgbmFtZSwgcmVnaW9uLCBsb2NhbGl6ZWROYW1lIH0pID0+IChoKFwiY2FsY2l0ZS10cmVlLWl0ZW1cIiwgeyBcImRhdGEtdmFsdWVcIjogcmVnaW9uLCBzZWxlY3RlZDogdGhpcy5yZWdpb24gPT09IHJlZ2lvbiB9LCBoKFwiYVwiLCBudWxsLCBsb2NhbGl6ZWROYW1lIHx8IG5hbWUpKSkpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyU2hhcmluZyA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJcIiwgNyk7XG4gICAgdGhpcy5zaGFyaW5nTGV2ZWxzID0gW1tcIm93bmVyXCIsIFtcInByaXZhdGVcIiwgXCJzaGFyZWRcIl1dLCBcIm9yZ1wiLCBcInB1YmxpY1wiXTtcbiAgICB0aGlzLnJlbmRlckxldmVsID0gKHNoYXJpbmdMZXZlbCkgPT4ge1xuICAgICAgY29uc3QgW2xldmVsLCBjaGlsZHJlbl0gPSBBcnJheS5pc0FycmF5KHNoYXJpbmdMZXZlbCkgPyBzaGFyaW5nTGV2ZWwgOiBbc2hhcmluZ0xldmVsXTtcbiAgICAgIHJldHVybiAoaChcImNhbGNpdGUtdHJlZS1pdGVtXCIsIHsgXCJkYXRhLXNoYXJpbmdcIjogbGV2ZWwsIHNlbGVjdGVkOiAoY2hpbGRyZW4gPT09IG51bGwgfHwgY2hpbGRyZW4gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNoaWxkcmVuLmluY2x1ZGVzKHRoaXMuc2hhcmluZykpIHx8IGxldmVsID09PSB0aGlzLnNoYXJpbmcgfSwgaChcImFcIiwgbnVsbCwgdGhpcy5pMThuW2xldmVsXSksIGNoaWxkcmVuICYmIChoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2xvdDogXCJjaGlsZHJlblwiLCBzZWxlY3Rpb25Nb2RlOiBcImNoaWxkcmVuXCIgfSwgY2hpbGRyZW4ubWFwKHRoaXMucmVuZGVyTGV2ZWwpKSkpKTtcbiAgICB9O1xuICAgIHRoaXMuc2hhcmluZyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmV4cGFuZGVkID0gdW5kZWZpbmVkO1xuICB9XG4gIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5maWx0ZXJTaGFyaW5nO1xuICB9XG4gIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgaWYgKHRoaXMuc2hhcmluZykge1xuICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgfVxuICAgIG9uQnJvd3NlckZpbHRlclJlbW92ZShcInNoYXJpbmdcIiwgdGhpcy5zdG9yZSwgKCkgPT4gKHRoaXMuc2hhcmluZyA9IG51bGwpKTtcbiAgfVxuICBnZXRFdmVudERldGFpbCgpIHtcbiAgICBjb25zdCB7IHNoYXJpbmcsIGkxOG4gfSA9IHRoaXM7XG4gICAgY29uc3QgdmFsdWUgPSBzaGFyaW5nID09PSBcIm93bmVyXCIgPyBgKGFjY2Vzczpwcml2YXRlIE9SIGFjY2VzczpzaGFyZWQpYCA6IGAoYWNjZXNzOiAke3NoYXJpbmd9KWA7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBcInNoYXJpbmdcIixcbiAgICAgIHBhcmFtOiBcInFcIixcbiAgICAgIHZhbHVlOiBzaGFyaW5nID8gdmFsdWUgOiBcIlwiLFxuICAgICAgbGFiZWw6IHNoYXJpbmcgPyBpMThuLmxhYmVsLnJlcGxhY2UoXCIke3NoYXJpbmd9XCIsIGkxOG5bc2hhcmluZ10pIDogXCJcIixcbiAgICAgIHNoYXJpbmdcbiAgICB9O1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gKGgoXCJhcmNnaXMtYnJvd3Nlci1maWx0ZXJcIiwgeyBoZWFkaW5nOiB0aGlzLmkxOG4udGl0bGUsIGV4cGFuZGVkOiB0aGlzLmV4cGFuZGVkLCBhY3RpdmU6ICEhdGhpcy5zaGFyaW5nLCBvbkFyY2dpc0Jyb3dzZXJGaWx0ZXJSZW1vdmU6ICgpID0+IHtcbiAgICAgICAgdGhpcy5zaGFyaW5nID0gbnVsbDtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgICB9IH0sIGgoXCJjYWxjaXRlLXRyZWVcIiwgeyBzZWxlY3Rpb25Nb2RlOiBcImNoaWxkcmVuXCIsIHNjYWxlOiBcIm1cIiwgb25DYWxjaXRlVHJlZVNlbGVjdDogKGV2ZW50KSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgY29uc3QgaXRlbSA9IChfYSA9IG5vZGUuc2VsZWN0ZWRJdGVtcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdO1xuICAgICAgICBjb25zdCBzaGFyaW5nID0gaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLmRhdGFzZXQuc2hhcmluZztcbiAgICAgICAgaWYgKHRoaXMuc2hhcmluZyA9PT0gc2hhcmluZykge1xuICAgICAgICAgIHRoaXMuc2hhcmluZyA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy5zaGFyaW5nID0gc2hhcmluZztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgIH0gfSwgdGhpcy5zaGFyaW5nTGV2ZWxzLm1hcCgobGV2ZWwpID0+IHRoaXMucmVuZGVyTGV2ZWwobGV2ZWwpKSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlclRhZ3MgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyXCIsIDcpO1xuICAgIHRoaXMuZGVzZWxlY3RBbGxUYWdzID0gKCkgPT4ge1xuICAgICAgdGhpcy5lbFxuICAgICAgICAucXVlcnlTZWxlY3RvckFsbChcImNhbGNpdGUtY29tYm9ib3gtaXRlbVtzZWxlY3RlZF1cIilcbiAgICAgICAgLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgaXRlbS5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB0aGlzLnRhZ3MgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5leHBhbmRlZCA9IHVuZGVmaW5lZDtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4uZmlsdGVyVGFncztcbiAgfVxuICBhc3luYyBjb21wb25lbnREaWRMb2FkKCkge1xuICAgIGlmICh0aGlzLnRhZ3MpIHtcbiAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgIH1cbiAgICBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUoXCJ0YWdzXCIsIHRoaXMuc3RvcmUsICgpID0+IHtcbiAgICAgIHRoaXMudGFncyA9IG51bGw7XG4gICAgICB0aGlzLmRlc2VsZWN0QWxsVGFncygpO1xuICAgIH0pO1xuICB9XG4gIGdldEV2ZW50RGV0YWlsKCkge1xuICAgIGNvbnN0IHsgdGFncyB9ID0gdGhpcztcbiAgICBjb25zdCB2YWx1ZSA9ICh0YWdzID09PSBudWxsIHx8IHRhZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRhZ3MubGVuZ3RoKSA/IGB0YWdzOigke3RhZ3MubWFwKCh0YWcpID0+IGBcIiR7dGFnfVwiYCkuam9pbihcIiBPUiBcIil9KWAgOiBcIlwiO1xuICAgIGNvbnN0IGxhYmVsID0gKHRhZ3MgPT09IG51bGwgfHwgdGFncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGFncy5sZW5ndGgpID8gdGhpcy5pMThuLmxhYmVsLnJlcGxhY2UoXCIke3RhZ3N9XCIsIHRhZ3Muam9pbihcIiwgXCIpKSA6IFwiXCI7XG4gICAgcmV0dXJuIHsgaWQ6IFwidGFnc1wiLCBwYXJhbTogXCJmaWx0ZXJcIiwgdmFsdWUsIHRhZ3MsIGxhYmVsIH07XG4gIH1cbiAgY29tcG9uZW50RGlkUmVuZGVyKCkge1xuICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yQWxsKFwiY2FsY2l0ZS1jb21ib2JveC1pdGVtXCIpO1xuICAgIGNvbnN0IHZhbHVlcyA9IFtdO1xuICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIC8vIHJlbW92ZSBkdXBsaWNhdGUgaXRlbXMgd2hpY2ggd2VyZSBhZGRlZCBieSBjYWxjaXRlIGNvbWJvYm94XG4gICAgICBpZiAodmFsdWVzLmluY2x1ZGVzKGl0ZW0udmFsdWUpKSB7XG4gICAgICAgIGl0ZW0ucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZChpdGVtKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB2YWx1ZXMucHVzaChpdGVtLnZhbHVlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgaTE4biB9ID0gdGhpcztcbiAgICBjb25zdCBrbm93blRhZ3MgPSB0aGlzLnN0b3JlLnN0YXRlLmtub3duVGFncyB8fCBbXTtcbiAgICByZXR1cm4gKGgoXCJhcmNnaXMtYnJvd3Nlci1maWx0ZXJcIiwgeyBoZWFkaW5nOiBpMThuLnRpdGxlLCBleHBhbmRlZDogdGhpcy5leHBhbmRlZCwgYWN0aXZlOiAhISgoX2EgPSB0aGlzLnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpLCBvbkFyY2dpc0Jyb3dzZXJGaWx0ZXJSZW1vdmU6ICgpID0+IHtcbiAgICAgICAgdGhpcy50YWdzID0gW107XG4gICAgICAgIHRoaXMuZGVzZWxlY3RBbGxUYWdzKCk7XG4gICAgICB9IH0sIGgoXCJjYWxjaXRlLWNvbWJvYm94XCIsIHsgbGFiZWw6IGkxOG4udGl0bGUsIG92ZXJsYXlQb3NpdGlvbmluZzogXCJmaXhlZFwiLCBwbGFjZWhvbGRlcjogaTE4bi5zZWxlY3RUYWdzLCBzY2FsZTogXCJzXCIsIG1heEl0ZW1zOiA1LCBhbGxvd0N1c3RvbVZhbHVlczogdHJ1ZSwgb25DYWxjaXRlQ29tYm9ib3hDaGFuZ2U6IChlKSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdGhpcy50YWdzID0gKF9hID0gZS50YXJnZXQuc2VsZWN0ZWRJdGVtcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1hcCgoaXRlbSkgPT4gaXRlbS52YWx1ZSk7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgICAgfSwgc3R5bGU6IHsgbWFyZ2luQm90dG9tOiBcIjFyZW1cIiB9LCByZWY6IChlbCkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IGRpdiA9IGVsLnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihcImRpdlwiKTtcbiAgICAgICAgaWYgKGRpdiAmJiAoKF9hID0gdGhpcy5zdG9yZS5zdGF0ZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnBhbmVsKSkge1xuICAgICAgICAgIGRpdi5pbnNlcnRBZGphY2VudEhUTUwoXCJiZWZvcmVlbmRcIiwgYDxzdHlsZT5cbiAgICAgICAgICAgICAgLmZsb2F0aW5nLXVpLWNvbnRhaW5lci0tYWN0aXZlIHtcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiB2aXNpYmxlICFpbXBvcnRhbnQ7XG4gICAgICAgICAgICAgICAgcG9pbnRlci1ldmVudHM6IGF1dG8gIWltcG9ydGFudDtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGUgIWltcG9ydGFudDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICA8L3N0eWxlPmApO1xuICAgICAgICB9XG4gICAgICB9IH0sIGtub3duVGFncy5tYXAoKHRhZykgPT4gKGgoXCJjYWxjaXRlLWNvbWJvYm94LWl0ZW1cIiwgeyBrZXk6IHRhZywgdmFsdWU6IHRhZywgdGV4dExhYmVsOiB0YWcubGVuZ3RoID4gMzYgPyBgJHt0YWcuc2xpY2UoMCwgMzYpfS4uLmAgOiB0YWcgfSkpKSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlcnMgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIHJldHVybiAoaChcImFyY2dpcy1icm93c2VyLWZpbHRlcnNcIiwgeyBzdG9yZTogdGhpcy5zdG9yZSwgc3R5bGU6ICgoX2IgPSAoX2EgPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhdGUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5idWNrZXQpID09PSBcInN1YnNjcmlwdGlvbiBjb250ZW50XCIgPyB7IGRpc3BsYXk6IFwibm9uZVwiIH0gOiB7fSB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJ0b3BcIiB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwidG9wXCIgfSkpLCBoKFwic2xvdFwiLCBudWxsKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiYm90dG9tXCIgfSwgaChcInNsb3RcIiwgeyBuYW1lOiBcImJvdHRvbVwiIH0pKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyUGFnaW5hdGlvbiA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyUGFnZVwiLCA3KTtcbiAgICB0aGlzLnRvdGFsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc3RhcnQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5udW0gPSA2MDtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICBjb25zdCB7IHN0YXJ0LCB0b3RhbCwgbnVtIH0gPSB0aGlzO1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJQYWdlLmVtaXQoeyBzdGFydCwgdG90YWwsIG51bSB9KTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBzdGFydCwgdG90YWwsIG51bSwgc3RvcmUgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKFwiYXJjZ2lzLWJyb3dzZXItcGFnaW5hdGlvblwiLCB7IHN0YXJ0OiBzdGFydCwgdG90YWw6IHRvdGFsLCBudW06IG51bSwgc3RvcmU6IHN0b3JlLCBvbkFyY2dpc0Jyb3dzZXJQYWdlOiAoZSkgPT4gdGhpcy5hcmNnaXNJdGVtQnJvd3NlclBhZ2UuZW1pdChlLmRldGFpbCkgfSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IGFyY2dpc0l0ZW1Ccm93c2VyUHJldmlld0NzcyA9IFwiOmhvc3R7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWJhY2tncm91bmQpO2ZsZXg6MSAxIDAlO2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47aGVpZ2h0OjEwMCU7d2lkdGg6MTAwJX0ucHJldmlld19faGVhZGVyey13ZWJraXQtbWFyZ2luLXN0YXJ0OjAuNzVyZW07bWFyZ2luLWlubGluZS1zdGFydDowLjc1cmVtfS5wcmV2aWV3X190aXRsZXtmb250LXNpemU6MXJlbTtmb250LXdlaWdodDo1MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpO3BhZGRpbmc6MDttYXJnaW46MDt3b3JkLXdyYXA6YnJlYWstd29yZDtvdmVyZmxvdy13cmFwOmJyZWFrLXdvcmQ7bGluZS1oZWlnaHQ6MS4zNzV9LnRpdGxle2ZvbnQtd2VpZ2h0OjUwMDtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMSk7Zm9udC1zaXplOjEuMTI1cmVtO21hcmdpbi10b3A6MC43NXJlbTttYXJnaW4tYm90dG9tOjAuNzVyZW07cGFkZGluZzowO3dvcmQtd3JhcDpicmVhay13b3JkO3dvcmQtYnJlYWs6YnJlYWstd29yZH0uYmFkZ2Vze2Rpc3BsYXk6YmxvY2s7bWFyZ2luLWJvdHRvbToxcmVtfS5iYWRnZXNbZW1wdHlde2Rpc3BsYXk6bm9uZX1jYWxjaXRlLWFjY29yZGlvbi1pdGVtey0tY2FsY2l0ZS1hY2NvcmRpb24taXRlbS1wYWRkaW5nOjFyZW0gMXJlbTstLWNhbGNpdGUtYWNjb3JkaW9uLWl0ZW0tYmFja2dyb3VuZDp2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMSk7d2lkdGg6MTAwJTtib3gtc2l6aW5nOmJvcmRlci1ib3g7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1ib3JkZXItMil9LnNlY3Rpb257cGFkZGluZy1sZWZ0OjFyZW07cGFkZGluZy1yaWdodDoxcmVtO3BhZGRpbmctdG9wOjFyZW07cGFkZGluZy1ib3R0b206MXJlbTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktYmFja2dyb3VuZCk7bWFyZ2luOjByZW0gLTFyZW0gY2FsYygtMXJlbSAtIDFweCkgLTFyZW07bGluZS1oZWlnaHQ6MS4zNX0uc2VjdGlvbi0tdGlnaHR7cGFkZGluZy10b3A6MDtwYWRkaW5nLWJvdHRvbTowO3BhZGRpbmctbGVmdDowO3BhZGRpbmctcmlnaHQ6MH0uZGV0YWlscy10aXRsZXtmb250LXdlaWdodDo1MDA7Zm9udC1zaXplOjAuNzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTMpO3BhZGRpbmctYm90dG9tOjAuMjVyZW07cGFkZGluZy10b3A6MDttYXJnaW4tdG9wOjFyZW07bWFyZ2luLWJvdHRvbTowOy0tY2FsY2l0ZS1sYWJlbC1tYXJnaW4tYm90dG9tOjB9LmRldGFpbHMtdGl0bGU6Zmlyc3Qtb2YtdHlwZXttYXJnaW4tdG9wOjB9LmRldGFpbHMtdGl0bGUtLWxhYmVse3BhZGRpbmctYm90dG9tOjB9LmRldGFpbHMtdGV4dHtmb250LXdlaWdodDo0MDA7Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0xKTtwYWRkaW5nOjA7bWFyZ2luOjA7d29yZC13cmFwOmJyZWFrLXdvcmQ7b3ZlcmZsb3ctd3JhcDpicmVhay13b3JkfS5kZXRhaWxzLXRleHQgYXtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtbGluayl9LmRldGFpbHMtdGV4dC0tZW1wdHl7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTMpO2ZvbnQtd2VpZ2h0OjQwMDtmb250LXNpemU6MC44NzVyZW19LmRlc2NyaXB0aW9ue3dvcmQtd3JhcDpicmVhay13b3JkO292ZXJmbG93LXdyYXA6YnJlYWstd29yZDtsaW5lLWhlaWdodDoxLjM1fS5kZXNjcmlwdGlvbiAqe21heC13aWR0aDoxMDAlO2ZvbnQtc2l6ZTowLjg3NXJlbSAhaW1wb3J0YW50fS5mYXZvcml0ZXtwYWRkaW5nLXRvcDoxLjVyZW07ZGlzcGxheTpibG9ja30uY29weS1pbnB1dHstLWNhbGNpdGUtdWktYmFja2dyb3VuZDp2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMSl9LnN1YmxheWVyLWl0ZW17LS10dy1zaGFkb3c6bm9uZX0uc3VibGF5ZXJfX3RhYnN7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWJhY2tncm91bmQpO2ZsZXg6MSAxIGF1dG99LnN1YmxheWVyX190YWJzLS13aGl0ZXtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0xKX0uc3VibGF5ZXItaXRlbV9fY29udGVudHttYXgtd2lkdGg6MTAuODc1cmVtO21pbi13aWR0aDowO2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjtkaXNwbGF5OmZsZXh9LnN1YmxheWVyLWl0ZW1fX3RpdGxle3BhZGRpbmctdG9wOjAuNXJlbTtwYWRkaW5nLWJvdHRvbTowLjVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTIpO2ZvbnQtc2l6ZTowLjg3NXJlbTtvdmVyZmxvdzpoaWRkZW47dGV4dC1vdmVyZmxvdzplbGxpcHNpczt3aGl0ZS1zcGFjZTpub3dyYXA7dGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZX0uc3VibGF5ZXItaXRlbV9fdGl0bGUtLW1hdGNoZWR7cGFkZGluZy10b3A6MDtwYWRkaW5nLWJvdHRvbTowfS5zdWJsYXllci1pdGVtX19kZXNjcmlwdGlvbntmb250LXNpemU6MC43NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMyl9LnN1YmxheWVyX19oZWFkZXJ7ZGlzcGxheTpmbGV4O3BhZGRpbmctbGVmdDoxcmVtO3BhZGRpbmctcmlnaHQ6MXJlbTtwYWRkaW5nLXRvcDoxcmVtO3BhZGRpbmctYm90dG9tOjAuNXJlbTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0xKTtmb250LXdlaWdodDo1MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpfS5zdWJsYXllcl9faGVhZGVyX190aXRsZXt3b3JkLXdyYXA6YnJlYWstd29yZDtvdmVyZmxvdy13cmFwOmJyZWFrLXdvcmQ7bWluLXdpZHRoOjB9LnN1YmxheWVyX19oZWFkZXJfX2ljb257LXdlYmtpdC1tYXJnaW4tZW5kOjFyZW07bWFyZ2luLWlubGluZS1lbmQ6MXJlbX0uc3VibGF5ZXJfX3RhYi1uYXZ7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMSk7cGFkZGluZy1sZWZ0OjFyZW07cGFkZGluZy1yaWdodDoxcmVtfS5zdWJsYXllcl9fY29udGVudHtoZWlnaHQ6MTAwJTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0xKTttYXJnaW4tdG9wOi0wLjVyZW19LnN1YmxheWVyX19jb250ZW50LS1vdmVydmlld3tiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktYmFja2dyb3VuZCk7cGFkZGluZy10b3A6MnJlbTtwYWRkaW5nLWJvdHRvbToycmVtO3BhZGRpbmctbGVmdDoxLjI1cmVtO3BhZGRpbmctcmlnaHQ6MS4yNXJlbTtib3gtc2l6aW5nOmJvcmRlci1ib3h9LmZvb3Rlci1hY3Rpb25ze3dpZHRoOjEwMCU7ZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczpyZXBlYXQoMSwgbWlubWF4KDAsIDFmcikpO2dyaWQtZ2FwOjAuNXJlbTtnYXA6MC41cmVtfS5lcnJvci1jb250YWluZXJ7aGVpZ2h0OjEwMCU7ZGlzcGxheTpmbGV4O3BhZGRpbmc6MXJlbX1cIjtcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJQcmV2aWV3JDEgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJQcmV2aWV3Q2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyUHJldmlld0Nsb3NlXCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzSW50ZXJuYWxJdGVtQnJvd3NlclN1YmxheWVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJbnRlcm5hbEl0ZW1Ccm93c2VyU3VibGF5ZXJcIiwgNyk7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckludGVybmFsVUlBY3Rpb24gPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VySW50ZXJuYWxVSUFjdGlvblwiLCA3KTtcbiAgICB0aGlzLnNvcnRTdWJsYXllcnMgPSAoYSwgYikgPT4ge1xuICAgICAgY29uc3QgbWF0Y2hlZEEgPSB0aGlzLmxheWVyTWF0Y2hlcyhhKTtcbiAgICAgIGNvbnN0IG1hdGNoZWRCID0gdGhpcy5sYXllck1hdGNoZXMoYik7XG4gICAgICBpZiAobWF0Y2hlZEEgPT09IG1hdGNoZWRCKSB7XG4gICAgICAgIHJldHVybiBiLmlkIC0gYS5pZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtYXRjaGVkQSA/IC0xIDogMTtcbiAgICB9O1xuICAgIHRoaXMubGF5ZXJNYXRjaGVzID0gKGxheWVyKSA9PiB7XG4gICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgICAgcmV0dXJuIChfZSA9IChfZCA9IChfYyA9IChfYiA9IChfYSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmhpZ2hsaWdodHMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfY1t0aGlzLml0ZW0uaWRdKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Quc3VibGF5ZXJzKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UuaW5jbHVkZXMobGF5ZXIuaWQpO1xuICAgIH07XG4gICAgdGhpcy5yZW5kZXJGaWVsZCA9IChmaWVsZCkgPT4ge1xuICAgICAgaWYgKGZpZWxkLm5hbWUgPT09IFwiT0JKRUNUSURcIikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICByZXR1cm4gKGgoXCJhcmNnaXMtaXRlbS1icm93c2VyLXByZXZpZXctZmllbGQtZGV0YWlsc1wiLCB7IGZpZWxkOiBmaWVsZCwgaXRlbTogdGhpcy5pdGVtLCBzdWJsYXllcjogdGhpcy5zdWJsYXllciwgYXBpOiBjb25maWdTdGF0ZS5hcGksIHNob3dGaWVsZFN0YXRpc3RpY3M6IHRoaXMuc3RvcmUuc3RhdGUuc2hvd0ZpZWxkU3RhdGlzdGljcyB9KSk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZUxheWVyQ2xpY2sgPSAobGF5ZXIpID0+IHtcbiAgICAgIHRoaXMuc3VibGF5ZXIgPSBsYXllcjtcbiAgICAgIHRoaXMuZmV0Y2hTdWJsYXllcigpO1xuICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckludGVybmFsVUlBY3Rpb24uZW1pdCh7XG4gICAgICAgIGFjdGlvbjogXCJjbGlja1wiLFxuICAgICAgICBjYXRlZ29yeTogXCJwYW5lbCBhY3Rpb25cIixcbiAgICAgICAgZGV0YWlsczogXCJzdWJsYXllclwiXG4gICAgICB9KTtcbiAgICAgIHRoaXMuYXJjZ2lzSW50ZXJuYWxJdGVtQnJvd3NlclN1YmxheWVyLmVtaXQoT2JqZWN0LmFzc2lnbih7fSwgbGF5ZXIpKTtcbiAgICB9O1xuICAgIHRoaXMucmVuZGVyTGF5ZXIgPSAobGF5ZXIpID0+IHtcbiAgICAgIGNvbnN0IG1hdGNoZXMgPSB0aGlzLmxheWVyTWF0Y2hlcyhsYXllcik7XG4gICAgICBjb25zdCB7IGljb24gfSA9IGdldFN1YmxheWVyVHlwZUluZm8oeyBnZW9tZXRyeTogbGF5ZXIuZ2VvbWV0cnlUeXBlLCB0eXBlOiBsYXllci50eXBlIH0pO1xuICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1saXN0LWl0ZW1cIiwgeyBvbkNsaWNrOiAoKSA9PiB0aGlzLmhhbmRsZUxheWVyQ2xpY2sobGF5ZXIpLCBvbktleURvd246IChldmVudCkgPT4ge1xuICAgICAgICAgIGlmIChldmVudC5rZXkgPT09IFwiIFwiIHx8IGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVMYXllckNsaWNrKGxheWVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIGNsYXNzOiBcInN1YmxheWVyLWl0ZW1cIiB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgaWNvbjogaWNvbiwgZmxpcFJ0bDogdHJ1ZSwgc2NhbGU6IFwic1wiLCBzbG90OiBcImNvbnRlbnQtc3RhcnRcIiB9KSwgaChcInNwYW5cIiwgeyBzbG90OiBcImNvbnRlbnRcIiwgY2xhc3M6IFwic3VibGF5ZXItaXRlbV9fY29udGVudFwiIH0sIGgoXCJzcGFuXCIsIHsgY2xhc3M6IHsgXCJzdWJsYXllci1pdGVtX190aXRsZVwiOiB0cnVlLCBcInN1YmxheWVyLWl0ZW1fX3RpdGxlLS1tYXRjaGVkXCI6IG1hdGNoZXMgfSB9LCBsYXllci50aXRsZSB8fCBsYXllci5uYW1lKSwgbWF0Y2hlcyAmJiBoKFwic3BhblwiLCB7IGNsYXNzOiBcInN1YmxheWVyLWl0ZW1fX2Rlc2NyaXB0aW9uXCIgfSwgdGhpcy5pMThuLm1hdGNoZWQpKSwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgc2xvdDogXCJjb250ZW50LWVuZFwiLCBpY29uOiBcImNoZXZyb24tcmlnaHRcIiwgZmxpcFJ0bDogdHJ1ZSwgc3R5bGU6IHsgZGlzcGxheTogXCJmbGV4XCIsIGp1c3RpZnlDb250ZW50OiBcImZsZXgtZW5kXCIgfSB9KSkpO1xuICAgIH07XG4gICAgdGhpcy5pdGVtID0gdW5kZWZpbmVkO1xuICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudXNlciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmhpZGVQcmV2aWV3Rm9vdGVycyA9IGZhbHNlO1xuICAgIHRoaXMuZnVsbEl0ZW0gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5mb3JtYXR0ZWRWaWV3cyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxvYWRpbmdMYXllcnMgPSB0cnVlO1xuICAgIHRoaXMubGF5ZXJFcnJvciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxheWVycyA9IFtdO1xuICAgIHRoaXMuc3VibGF5ZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5mdWxsU3VibGF5ZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zaG93TGF5ZXJzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudXNlckluZm8gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy50YWIgPSBcImZpZWxkc1wiO1xuICAgIHRoaXMuaXRlbUVycm9yID0gdW5kZWZpbmVkO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5wcmV2aWV3O1xuICAgIHRoaXMubGF5ZXJUeXBlcyA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5sYXllclR5cGVzO1xuICAgIHRoaXMubGFuZyA9IGF3YWl0IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZSh0aGlzLmVsKTtcbiAgICB0aGlzLmluaXQoKTtcbiAgfVxuICB1cGRhdGVQcmV2aWV3KCkge1xuICAgIHRoaXMuaW5pdCgpO1xuICB9XG4gIGFzeW5jIGZldGNoSXRlbSgpIHtcbiAgICB0aGlzLml0ZW1FcnJvciA9IG51bGw7XG4gICAgcmV0dXJuIGZldGNoUHJldmlld0l0ZW0odGhpcy5pdGVtLCB0aGlzLnBvcnRhbCwgdGhpcy51c2VyLCB0aGlzLnN0b3JlKTtcbiAgfVxuICBhc3luYyBpbml0KCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mO1xuICAgIGlmICghdGhpcy5pdGVtKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHsgaXRlbSwgcG9ydGFsLCBsYW5nIH0gPSB0aGlzO1xuICAgIHRoaXMuZnVsbEl0ZW0gPSBudWxsO1xuICAgIHRoaXMuc2hvdWxkRXhwYW5kT3ZlcnZpZXcgPSB0cnVlO1xuICAgIHRoaXMubG9hZGluZ0xheWVycyA9IHRydWU7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBtaW5EZWxheSh0aGlzLmZldGNoSXRlbSgpLCA2MDApO1xuICAgIGlmIChyZXNwb25zZS5lcnJvcikge1xuICAgICAgdGhpcy5pdGVtRXJyb3IgPVxuICAgICAgICByZXNwb25zZS5lcnJvci5jb2RlID09PSBcImRpc2FibGVkU3Vic2NyaXB0aW9uXCJcbiAgICAgICAgICA/IHRoaXMuaTE4bi5pdGVtRXJyb3Iuc3Vic2NyaXB0aW9uXG4gICAgICAgICAgOiB0aGlzLmkxOG4uaXRlbUVycm9yLnVuaGFuZGxlZDtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5mdWxsSXRlbSA9IHJlc3BvbnNlLnJlc3VsdDtcbiAgICB0aGlzLmZvcm1hdHRlZFZpZXdzID0gYXdhaXQgZm9ybWF0TnVtYmVyKGl0ZW0ubnVtVmlld3MgfHwgMCwge1xuICAgICAgYXBpOiBjb25maWdTdGF0ZS5hcGksXG4gICAgICBwbGFjZXM6IDAsXG4gICAgICB0eXBlOiBcImRlY2ltYWxcIlxuICAgIH0pO1xuICAgIHRoaXMudXNlckluZm8gPSBhd2FpdCBmZXRjaEl0ZW1Vc2VySW5mbyhpdGVtLCBwb3J0YWwsIGxhbmcpO1xuICAgIChfYSA9IHRoaXMuZmxvd0l0ZW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgIGNvbnN0IHR5cGVUb1Nob3dMYXllcnMgPSBbXG4gICAgICBcIkZlYXR1cmUgU2VydmljZVwiLFxuICAgICAgXCJMYXllciBUZW1wbGF0ZVwiLFxuICAgICAgXCJGZWF0dXJlIENvbGxlY3Rpb25cIlxuICAgIF07XG4gICAgdGhpcy5zaG93TGF5ZXJzID1cbiAgICAgIHR5cGVUb1Nob3dMYXllcnMuaW5jbHVkZXMoaXRlbS50eXBlKSAmJiAhKChfYiA9IGl0ZW0udHlwZUtleXdvcmRzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuaW5jbHVkZXMoXCJSb3V0ZSBMYXllclwiKSk7XG4gICAgaWYgKHRoaXMuc2hvd0xheWVycykge1xuICAgICAgLy8gbGF5ZXIgdGVtcGxhdGVzIHN0b3JlIHRoZWlyIGxheWVycy9zY2hlbWEgaW4gaXRlbSBkYXRhXG4gICAgICBpZiAoaXRlbS50eXBlID09PSBcIkxheWVyIFRlbXBsYXRlXCIgJiZcbiAgICAgICAgKChfYyA9IGl0ZW0udHlwZUtleXdvcmRzKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MubWFwKChrZXl3b3JkKSA9PiBrZXl3b3JkLnRvTG93ZXJDYXNlKCkpLmluY2x1ZGVzKFwic2VydmljZSB0ZW1wbGF0ZVwiKSkpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcXVlc3QoYCR7Z2V0UmVzdEJhc2VVcmwodGhpcy5wb3J0YWwpfWNvbnRlbnQvaXRlbXMvJHt0aGlzLml0ZW0uaWR9L2RhdGFgKTtcbiAgICAgICAgdGhpcy5sYXllcnMgPSBbLi4uKChfZCA9IGRhdGEubGF5ZXJzKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiBbXSksIC4uLigoX2UgPSBkYXRhLnRhYmxlcykgIT09IG51bGwgJiYgX2UgIT09IHZvaWQgMCA/IF9lIDogW10pXTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoRmVhdHVyZVNlcnZpY2VJbmZvKHtcbiAgICAgICAgICBpdGVtOiB0aGlzLmZ1bGxJdGVtLFxuICAgICAgICAgIHBvcnRhbDogY29uZmlnU3RhdGUucG9ydGFsLFxuICAgICAgICAgIGxheWVyczogbnVsbCxcbiAgICAgICAgICBpc1NlY3VyZTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChyZXNwb25zZS5yZXN1bHQpIHtcbiAgICAgICAgICB0aGlzLmxheWVycyA9IChfZiA9IHJlc3BvbnNlLnJlc3VsdCkgPT09IG51bGwgfHwgX2YgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9mLnNvcnQodGhpcy5zb3J0U3VibGF5ZXJzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5lcnJvcikge1xuICAgICAgICAgIHRoaXMubGF5ZXJFcnJvciA9IHRoaXMuaTE4bi5sYXllckVycm9yO1xuICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvci5jb2RlID09PSBcInNlcnZpY2VOb3RFeGlzdFwiKSB7XG4gICAgICAgICAgICB0aGlzLmxheWVyRXJyb3IubWVzc2FnZSA9IHRoaXMuaTE4bi5ub1NlcnZpY2VNZXNzYWdlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmxvYWRpbmdMYXllcnMgPSBmYWxzZTtcbiAgfVxuICBoYW5kbGVBY2NvcmRpb25JdGVtQ2xpY2soZWxlbWVudCwgZGV0YWlscykge1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uLmVtaXQoe1xuICAgICAgYWN0aW9uOiBlbGVtZW50LmV4cGFuZGVkID8gXCJleHBhbmRcIiA6IFwiY29sbGFwc2VcIixcbiAgICAgIGNhdGVnb3J5OiBcInBhbmVsIGFjdGlvblwiLFxuICAgICAgZGV0YWlsc1xuICAgIH0pO1xuICB9XG4gIGFzeW5jIGZldGNoU3VibGF5ZXIoKSB7XG4gICAgY29uc3QgbGF5ZXJSZXNwb25zZSA9IGF3YWl0IGZldGNoTGF5ZXIodGhpcy5wb3J0YWwsIHRoaXMuc3VibGF5ZXIuaWQsIHRoaXMuaXRlbS51cmwpO1xuICAgIHRoaXMuZnVsbFN1YmxheWVyID0gbGF5ZXJSZXNwb25zZSA9PT0gbnVsbCB8fCBsYXllclJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllclJlc3BvbnNlLnJlc3VsdDtcbiAgfVxuICBjbG9zZVByZXZpZXcoKSB7XG4gICAgdGhpcy5zdWJsYXllciA9IG51bGw7XG4gICAgdGhpcy5mdWxsSXRlbSA9IG51bGw7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckludGVybmFsVUlBY3Rpb24uZW1pdCh7XG4gICAgICBhY3Rpb246IFwiY2xvc2UgcGFuZWxcIixcbiAgICAgIGNhdGVnb3J5OiBcInBhbmVsIGFjdGlvblwiXG4gICAgfSk7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclByZXZpZXdDbG9zZS5lbWl0KCk7XG4gIH1cbiAgcmVuZGVySGVhZGVyKCkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBzbG90OiBcImhlYWRlci1jb250ZW50XCIsIGNsYXNzOiBcInByZXZpZXdfX2hlYWRlclwiIH0sIGgoXCJoM1wiLCB7IGNsYXNzOiBcInByZXZpZXdfX3RpdGxlXCIgfSwgKF9hID0gdGhpcy5pdGVtKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGl0bGUpLCBoKFwiYXJjZ2lzLWl0ZW0tdHlwZVwiLCB7IGl0ZW06IHRoaXMuaXRlbSwgcG9ydGFsOiB0aGlzLnBvcnRhbCwgc2NhbGU6IFwibVwiIH0pKSk7XG4gIH1cbiAgcmVuZGVyTGF5ZXJzKCkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gdGhpcy5sb2FkaW5nTGF5ZXJzID8gKGgoXCJjYWxjaXRlLWxvYWRlclwiLCB7IGxhYmVsOiB0aGlzLmkxOG4ubG9hZGluZywgc2NhbGU6IFwic1wiIH0pKSA6IHRoaXMubGF5ZXJFcnJvciA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2VjdGlvblwiIH0sIGgoXCJjYWxjaXRlLW5vdGljZVwiLCB7IGljb246IHRydWUsIG9wZW46IHRydWUsIHNjYWxlOiBcInNcIiwgd2lkdGg6IFwiZnVsbFwiLCBraW5kOiBcIndhcm5pbmdcIiB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJ0aXRsZVwiIH0sIHRoaXMubGF5ZXJFcnJvci50aXRsZSksIGgoXCJkaXZcIiwgeyBzbG90OiBcIm1lc3NhZ2VcIiB9LCB0aGlzLmxheWVyRXJyb3IubWVzc2FnZSkpKSkgOiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNlY3Rpb24gc2VjdGlvbi0tdGlnaHRcIiB9LCBoKFwiY2FsY2l0ZS1saXN0XCIsIHsgXCJzZWxlY3Rpb24tbW9kZVwiOiBcIm5vbmVcIiwgbG9hZGluZzogdGhpcy5sb2FkaW5nTGF5ZXJzLCByZWY6IChsaXN0KSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgdGFibGUgPSAoX2EgPSBsaXN0ID09PSBudWxsIHx8IGxpc3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxpc3Quc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5U2VsZWN0b3IoXCJ0YWJsZVwiKTtcbiAgICAgICAgaWYgKHRhYmxlKSB7XG4gICAgICAgICAgdGFibGUuc3R5bGUuYm9yZGVyU3BhY2luZyA9IFwiMFwiO1xuICAgICAgICB9XG4gICAgICB9IH0sIChfYSA9IHRoaXMubGF5ZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWFwKHRoaXMucmVuZGVyTGF5ZXIpKSkpO1xuICB9XG4gIGlzQWNjb3JkaW9uSXRlbShlbGVtZW50KSB7XG4gICAgcmV0dXJuIGVsZW1lbnQudGFnTmFtZSA9PT0gXCJDQUxDSVRFLUFDQ09SRElPTi1JVEVNXCI7XG4gIH1cbiAgaGFuZGxlU3VibGF5ZXJTZWN0aW9uQ2hhbmdlKHNlY3Rpb24pIHtcbiAgICB0aGlzLnRhYiA9IHNlY3Rpb247XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckludGVybmFsVUlBY3Rpb24uZW1pdCh7XG4gICAgICBhY3Rpb246IFwiY2xpY2tcIixcbiAgICAgIGNhdGVnb3J5OiBcInBhbmVsIGFjdGlvblwiLFxuICAgICAgZGV0YWlsczogYHN1YmxheWVyICR7c2VjdGlvbn1gXG4gICAgfSk7XG4gIH1cbiAgcmVuZGVyU3VibGF5ZXJQcmV2aWV3KCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICBjb25zdCB7IHN1YmxheWVyLCBpdGVtLCBpMThuLCBmdWxsU3VibGF5ZXIgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBnZW9tZXRyeVR5cGUsIHRpdGxlLCBuYW1lLCBkZXNjcmlwdGlvbiB9ID0gc3VibGF5ZXI7XG4gICAgY29uc3QgeyB0eXBlLCBpc0dlb21ldHJ5IH0gPSBnZXRTdWJsYXllclR5cGVJbmZvKHtcbiAgICAgIGdlb21ldHJ5OiBnZW9tZXRyeVR5cGUsXG4gICAgICB0eXBlOiBzdWJsYXllci50eXBlXG4gICAgfSk7XG4gICAgY29uc3QgbGF5ZXJUeXBlID0gdGhpcy5sYXllclR5cGVzW3R5cGVdO1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtZmxvdy1pdGVtXCIsIHsgY2xvc2FibGU6IHRydWUsIG9uQ2FsY2l0ZUZsb3dJdGVtQmFjazogKGUpID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5hcmNnaXNJbnRlcm5hbEl0ZW1Ccm93c2VyU3VibGF5ZXIuZW1pdCgpO1xuICAgICAgICB0aGlzLnN1YmxheWVyID0gbnVsbDtcbiAgICAgIH0sIG9uQ2FsY2l0ZUZsb3dJdGVtQ2xvc2U6IChlKSA9PiB7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuY2xvc2VQcmV2aWV3KCk7XG4gICAgICB9IH0sIHRoaXMucmVuZGVySGVhZGVyKCksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzdWJsYXllcl9faGVhZGVyXCIgfSwgaChcImFyY2dpcy1zdWJsYXllci10eXBlXCIsIHsgbmFtZTogbmFtZSB8fCB0aXRsZSwgZ2VvbWV0cnk6IHN1YmxheWVyLmdlb21ldHJ5VHlwZSwgdHlwZTogc3VibGF5ZXIudHlwZSwgc2hvd1R5cGU6IGZhbHNlLCBzY2FsZTogXCJzXCIgfSkpLCBoKFwiY2FsY2l0ZS10YWJzXCIsIHsgcG9zaXRpb246IFwidG9wXCIsIHNjYWxlOiBcIm1cIiwgbGF5b3V0OiBcImNlbnRlclwiLCBjbGFzczogeyBzdWJsYXllcl9fdGFiczogdHJ1ZSwgXCJzdWJsYXllcl9fdGFicy0td2hpdGVcIjogdGhpcy50YWIgPT09IFwiZmllbGRzXCIgfSB9LCBoKFwiY2FsY2l0ZS10YWItbmF2XCIsIHsgc2xvdDogXCJ0aXRsZS1ncm91cFwiLCBjbGFzczogXCJzdWJsYXllcl9fdGFiLW5hdlwiIH0sIGgoXCJjYWxjaXRlLXRhYi10aXRsZVwiLCB7IG9uQ2xpY2s6ICgpID0+IHRoaXMuaGFuZGxlU3VibGF5ZXJTZWN0aW9uQ2hhbmdlKFwiZmllbGRzXCIpIH0sIGkxOG4uZmllbGRzKSwgaChcImNhbGNpdGUtdGFiLXRpdGxlXCIsIHsgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVTdWJsYXllclNlY3Rpb25DaGFuZ2UoXCJvdmVydmlld1wiKSB9LCBpMThuLm92ZXJ2aWV3KSksIGgoXCJjYWxjaXRlLXRhYlwiLCBudWxsLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic3VibGF5ZXJfX2NvbnRlbnRcIiB9LCBzdWJsYXllci5maWVsZHMgPyAoc3VibGF5ZXIuZmllbGRzLm1hcCh0aGlzLnJlbmRlckZpZWxkKSkgOiAoaChcInBcIiwgeyBjbGFzczogXCJkZXRhaWxzLXRleHQgZGV0YWlscy10ZXh0LS1lbXB0eVwiIH0sIGkxOG4ubm9GaWVsZHMpKSkpLCBoKFwiY2FsY2l0ZS10YWJcIiwgbnVsbCwgaChcImRpdlwiLCB7IGNsYXNzOiBcInN1YmxheWVyX19jb250ZW50IHN1YmxheWVyX19jb250ZW50LS1vdmVydmlld1wiIH0sIHRoaXMucmVuZGVyRGV0YWlsKGlzR2VvbWV0cnkgPyBpMThuLmdlb21ldHJ5VHlwZVRpdGxlIDogaTE4bi5sYXllclR5cGVUaXRsZSwgbGF5ZXJUeXBlKSwgaChcImg0XCIsIHsgY2xhc3M6IFwiZGV0YWlscy10aXRsZVwiIH0sIGkxOG4uZGVzY3JpcHRpb24pLCBkZXNjcmlwdGlvbiA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZGV0YWlscy10ZXh0IGRlc2NyaXB0aW9uXCIsIGlubmVySFRNTDogc2FuaXRpemVIVE1MKGRlY29kZUhUTUxFbnRpdGllcyhkZXNjcmlwdGlvbikpIH0pKSA6IChoKFwicFwiLCB7IGNsYXNzOiBcImRldGFpbHMtdGV4dCBkZXRhaWxzLXRleHQtLWVtcHR5XCIgfSwgaTE4bi5ub0Rlc2NyaXB0aW9uKSksICEoKF9hID0gdGhpcy5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1BvcnRhbCkgJiZcbiAgICAgIHRoaXMucmVuZGVyRGV0YWlsKGkxOG4uZGF0YVVwZGF0ZWQsIGZvcm1hdERhdGUoKF9iID0gZnVsbFN1YmxheWVyID09PSBudWxsIHx8IGZ1bGxTdWJsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZnVsbFN1YmxheWVyLmVkaXRpbmdJbmZvKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZGF0YUxhc3RFZGl0RGF0ZSkpLCAhKChfYyA9IHRoaXMucG9ydGFsKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuaXNQb3J0YWwpICYmXG4gICAgICB0aGlzLnJlbmRlckRldGFpbChpMThuLnNjaGVtYVVwZGF0ZWQsIGZvcm1hdERhdGUoKF9kID0gZnVsbFN1YmxheWVyID09PSBudWxsIHx8IGZ1bGxTdWJsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZnVsbFN1YmxheWVyLmVkaXRpbmdJbmZvKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Quc2NoZW1hTGFzdEVkaXREYXRlKSksIGl0ZW0udXJsICYmIChoKFwiYXJjZ2lzLWl0ZW0tYnJvd3Nlci1wcmV2aWV3LWNvcHlcIiwgeyB0ZXh0OiBgJHtpdGVtLnVybH0vJHtzdWJsYXllci5pZH1gLCBoZWFkaW5nOiBpMThuLlVSTCB9KSkpKSksICF0aGlzLmhpZGVQcmV2aWV3Rm9vdGVycyAmJiAoaChcImRpdlwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGNsYXNzOiBcImZvb3Rlci1hY3Rpb25zXCIgfSwgdGhpcy5yZW5kZXJTdWJsYXllclNlbGVjdCgpLCBoKFwic2xvdFwiLCB7IG5hbWU6IFwic3VibGF5ZXItZm9vdGVyXCIgfSkpKSkpO1xuICB9XG4gIHJlbmRlckRldGFpbCh0aXRsZSwgdGV4dCwgZW1wdHlUZXh0LCBodG1sKSB7XG4gICAgY29uc3QgdGV4dE5vZGUgPSAhZW1wdHlUZXh0IHx8IHRleHQgPyAoaHRtbCA/IChoKFwicFwiLCB7IGNsYXNzOiBcImRldGFpbHMtdGV4dFwiLCBpbm5lckhUTUw6IHNhbml0aXplSFRNTCh0ZXh0KSB9KSkgOiAoaChcInBcIiwgeyBjbGFzczogXCJkZXRhaWxzLXRleHRcIiB9LCB0ZXh0KSkpIDogKGgoXCJwXCIsIHsgY2xhc3M6IFwiZGV0YWlscy10ZXh0IGRldGFpbHMtdGV4dC0tZW1wdHlcIiB9LCBlbXB0eVRleHQpKTtcbiAgICByZXR1cm4gW2goXCJoNFwiLCB7IGNsYXNzOiBcImRldGFpbHMtdGl0bGVcIiB9LCB0aXRsZSksIHRleHROb2RlXTtcbiAgfVxuICByZW5kZXJTdWJsYXllclNlbGVjdCgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBpZiAoKF9iID0gKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlLnNlbGVjdGlvbikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmluY2x1ZGVzKFwic3VibGF5ZXJcIikpIHtcbiAgICAgIHJldHVybiAoaChcImFyY2dpcy1pdGVtLWJyb3dzZXItY2FyZC1zdWJsYXllci1zZWxlY3RcIiwgeyBpdGVtOiB0aGlzLml0ZW0sIHVzZXI6IHRoaXMudXNlciwgcG9ydGFsOiB0aGlzLnBvcnRhbCwgc2VsZWN0aW9uOiAoKF9jID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnN0YXRlLnNlbGVjdGlvbikgPT09IFwibXVsdGlwbGUtc3VibGF5ZXJcIiA/IFwibXVsdGlwbGVcIiA6IFwic2luZ2xlXCIsIGFwcGVhcmFuY2U6IFwic29saWRcIiwgd2lkdGg6IFwiZnVsbFwiIH0pKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mLCBfZywgX2gsIF9qO1xuICAgIGNvbnN0IHsgaXRlbSwgZnVsbEl0ZW0sIGkxOG4sIHVzZXIsIHN1YmxheWVyLCB1c2VySW5mbywgcG9ydGFsLCBpdGVtRXJyb3IgfSA9IHRoaXM7XG4gICAgY29uc3Qgb3duZXIgPSAoX2EgPSBpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0ub3duZXIpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiXCI7XG4gICAgY29uc3QgbWFuYWdlZEJ5ID0gKGZ1bGxJdGVtID09PSBudWxsIHx8IGZ1bGxJdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmdWxsSXRlbS5jb250ZW50U3RhdHVzKSA9PT0gXCJwdWJsaWNfYXV0aG9yaXRhdGl2ZVwiXG4gICAgICA/IHRoaXMuaTE4bi5pdGVtTWFuYWdlZEJ5LnJlcGxhY2UoXCIke3VzZXJuYW1lfVwiLCBvd25lcilcbiAgICAgIDogb3duZXI7XG4gICAgY29uc3QgbGF5ZXJzSGVhZGVyID0gKChfYiA9IHRoaXMubGF5ZXJzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoKVxuICAgICAgPyBpMThuLmxheWVyc0NvdW50LnJlcGxhY2UoXCIke2NvdW50fVwiLCBgJHsoKF9jID0gdGhpcy5sYXllcnMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5sZW5ndGgpIHx8IDB9YClcbiAgICAgIDogaTE4bi5sYXllcnM7XG4gICAgY29uc3QgbWF0Y2hlZFN1YmxheWVycyA9IChfZiA9IChfZSA9IChfZCA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5zdGF0ZS5oaWdobGlnaHRzKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2VbaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLmlkXSkgPT09IG51bGwgfHwgX2YgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9mLnN1YmxheWVycztcbiAgICBjb25zdCBsYXllcnNEZXNjcmlwdGlvbiA9IChtYXRjaGVkU3VibGF5ZXJzID09PSBudWxsIHx8IG1hdGNoZWRTdWJsYXllcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hdGNoZWRTdWJsYXllcnMubGVuZ3RoKSAmJiAhdGhpcy5sb2FkaW5nTGF5ZXJzXG4gICAgICA/IGkxOG4ubWF0Y2hlZE51bWJlci5yZXBsYWNlKFwiJHtudW19XCIsIGAke21hdGNoZWRTdWJsYXllcnMubGVuZ3RofWApXG4gICAgICA6IG51bGw7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJjYWxjaXRlLWZsb3dcIiwgbnVsbCwgaChcImNhbGNpdGUtZmxvdy1pdGVtXCIsIHsgY2xvc2FibGU6IHRydWUsIGxvYWRpbmc6ICFmdWxsSXRlbSAmJiAhaXRlbUVycm9yLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiAoZSkgPT4ge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLmNsb3NlUHJldmlldygpO1xuICAgICAgfSwgcmVmOiAoZWwpID0+ICh0aGlzLmZsb3dJdGVtID0gZWwpIH0sIHRoaXMucmVuZGVySGVhZGVyKCksICEhaXRlbUVycm9yICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZXJyb3ItY29udGFpbmVyXCIgfSwgaChcImNhbGNpdGUtbm90aWNlXCIsIHsga2luZDogXCJkYW5nZXJcIiwgb3BlbjogdHJ1ZSwgc2NhbGU6IFwic1wiIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcInRpdGxlXCIgfSwgdGhpcy5pMThuLml0ZW1FcnJvci50aXRsZSksIGgoXCJkaXZcIiwgeyBzbG90OiBcIm1lc3NhZ2VcIiB9LCBpdGVtRXJyb3IpKSkpLCBmdWxsSXRlbSAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbnRlbnRcIiB9LCBoKFwiY2FsY2l0ZS1hY2NvcmRpb25cIiwgeyBcImljb24tcG9zaXRpb25cIjogXCJzdGFydFwiLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIGtleTogaXRlbS5pZCwgY2xhc3M6IFwiYWNjb3JkaW9uXCIsIG9uQ2xpY2s6IGFzeW5jIChlKSA9PiB7XG4gICAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xuICAgICAgICBpZiAodGhpcy5pc0FjY29yZGlvbkl0ZW0odGFyZ2V0KSkge1xuICAgICAgICAgIGF3YWl0IHRpbWVvdXQoMzAwKTtcbiAgICAgICAgICBpZiAodGFyZ2V0LmV4cGFuZGVkKSB7XG4gICAgICAgICAgICB0YXJnZXQuc2Nyb2xsSW50b1ZpZXcoeyBiZWhhdmlvcjogXCJzbW9vdGhcIiwgYmxvY2s6IFwic3RhcnRcIiB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gfSwgaChcImNhbGNpdGUtYWNjb3JkaW9uLWl0ZW1cIiwgeyBoZWFkaW5nOiBpMThuLnRodW1ibmFpbCwgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgdGhpcy50aHVtYm5haWxFbGVtZW50ID0gZWw7XG4gICAgICB9LCBvbkNsaWNrOiAoZSkgPT4gdGhpcy5pc0FjY29yZGlvbkl0ZW0oZS50YXJnZXQpICYmXG4gICAgICAgIHRoaXMuaGFuZGxlQWNjb3JkaW9uSXRlbUNsaWNrKHRoaXMudGh1bWJuYWlsRWxlbWVudCwgXCJ0aHVtYm5haWxcIikgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNlY3Rpb24gc2VjdGlvbi0tdGlnaHRcIiB9LCBoKFwiYXJjZ2lzLWl0ZW0tYnJvd3Nlci1jYXJkLXRodW1ibmFpbFwiLCB7IGl0ZW06IGl0ZW0sIHVzZXI6IHVzZXIsIHBvcnRhbDogcG9ydGFsIH0pKSksIGgoXCJjYWxjaXRlLWFjY29yZGlvbi1pdGVtXCIsIHsgaGVhZGluZzogaTE4bi5vdmVydmlldywgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgdGhpcy5vdmVydmlld0VsZW1lbnQgPSBlbDtcbiAgICAgICAgaWYgKHRoaXMuc2hvdWxkRXhwYW5kT3ZlcnZpZXcpIHtcbiAgICAgICAgICBlbC5leHBhbmRlZCA9IHRydWU7XG4gICAgICAgICAgdGhpcy5zaG91bGRFeHBhbmRPdmVydmlldyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9LCBvbkNsaWNrOiAoZSkgPT4gdGhpcy5pc0FjY29yZGlvbkl0ZW0oZS50YXJnZXQpICYmXG4gICAgICAgIHRoaXMuaGFuZGxlQWNjb3JkaW9uSXRlbUNsaWNrKHRoaXMub3ZlcnZpZXdFbGVtZW50LCBcIm92ZXJ2aWV3XCIpIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzZWN0aW9uXCIgfSwgaChcInNsb3RcIiwgeyBuYW1lOiBcInN1bW1hcnktdG9wXCIgfSksIHRoaXMucmVuZGVyRGV0YWlsKGkxOG4uc3VtbWFyeSwgZnVsbEl0ZW0uc25pcHBldCwgaTE4bi5ub1N1bW1hcnkpLCAhISgoX2cgPSBnZXRCYWRnZXMoaXRlbSwgcG9ydGFsLCB1c2VyKSkgPT09IG51bGwgfHwgX2cgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9nLmxlbmd0aCkgJiYgW1xuICAgICAgaChcImg0XCIsIHsgY2xhc3M6IFwiZGV0YWlscy10aXRsZVwiIH0sIGkxOG4uaXRlbVN0YXR1cyksXG4gICAgICBoKFwiYXJjZ2lzLWl0ZW0tYmFkZ2VzXCIsIHsgY2xhc3M6IFwiYmFkZ2VzXCIsIGl0ZW06IGl0ZW0sIHBvcnRhbDogcG9ydGFsLCB1c2VyOiB1c2VyLCBzY2FsZTogXCJzXCIsIHdpZHRoOiBcImZ1bGxcIiB9KVxuICAgIF0sIGgoXCJoNFwiLCB7IGNsYXNzOiBcImRldGFpbHMtdGl0bGVcIiB9LCBpMThuLm93bmVyKSwgKChfaCA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9oID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfaC5zdGF0ZS5wYW5lbCkgPyAoaChcImFyY2dpcy11c2VyLWF2YXRhclwiLCB7IHVzZXI6IHVzZXJJbmZvLCBzY2FsZTogXCJzXCIsIHBvcnRhbDogcG9ydGFsLCBzaG93TmFtZTogdHJ1ZSwgZGVzY3JpcHRpb246IG1hbmFnZWRCeSB9KSkgOiAoaChcImFyY2dpcy11c2VyLXBvcHVwXCIsIHsgYmFzZVVybDogY29uZmlnU3RhdGUuY29uZmlnLmJhc2VVcmwsIHBvcnRhbDogcG9ydGFsLCBpdGVtOiBmdWxsSXRlbSB9KSksIGgoXCJoNFwiLCB7IGNsYXNzOiBcImRldGFpbHMtdGl0bGVcIiB9LCBpMThuLnNoYXJlZCksIGgoXCJhcmNnaXMtaXRlbS1zaGFyZS1zdW1tYXJ5XCIsIHsgaXRlbTogZnVsbEl0ZW0sIHNjYWxlOiBcInNcIiB9KSwgdGhpcy5yZW5kZXJEZXRhaWwoaTE4bi51cGRhdGVkLCBmb3JtYXREYXRlKGZ1bGxJdGVtLm1vZGlmaWVkKSksICEhdXNlciAmJiAoaChcImFyY2dpcy1pdGVtLWZhdm9yaXRlXCIsIHsgY2xhc3M6IFwiZmF2b3JpdGVcIiwgdXNlcjogdXNlciwgcG9ydGFsOiBwb3J0YWwsIGl0ZW06IGZ1bGxJdGVtLCB3aWR0aDogXCJmdWxsXCIgfSkpKSksIGgoXCJjYWxjaXRlLWFjY29yZGlvbi1pdGVtXCIsIHsgaGVhZGluZzogaTE4bi5kZXNjcmlwdGlvbiwga2V5OiBcImRlc2NyaXB0aW9uXCIsIHJlZjogKGVsKSA9PiB7XG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb25FbGVtZW50ID0gZWw7XG4gICAgICB9LCBvbkNsaWNrOiAoZSkgPT4gdGhpcy5pc0FjY29yZGlvbkl0ZW0oZS50YXJnZXQpICYmXG4gICAgICAgIHRoaXMuaGFuZGxlQWNjb3JkaW9uSXRlbUNsaWNrKHRoaXMuZGVzY3JpcHRpb25FbGVtZW50LCBcImRlc2NyaXB0aW9uXCIpIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzZWN0aW9uXCIgfSwgZnVsbEl0ZW0uZGVzY3JpcHRpb24gPyAoaChcImRpdlwiLCB7IGNsYXNzOiBcImRlc2NyaXB0aW9uXCIsIGlubmVySFRNTDogc2FuaXRpemVIVE1MKGZ1bGxJdGVtLmRlc2NyaXB0aW9uKSB9KSkgOiAoaChcInBcIiwgeyBjbGFzczogXCJkZXRhaWxzLXRleHQgZGV0YWlscy10ZXh0LS1lbXB0eVwiIH0sIGkxOG4ubm9EZXNjcmlwdGlvbikpKSksIGgoXCJjYWxjaXRlLWFjY29yZGlvbi1pdGVtXCIsIHsgaGVhZGluZzogaTE4bi5kZXRhaWxzLCByZWY6IChlbCkgPT4ge1xuICAgICAgICB0aGlzLmRldGFpbHNFbGVtZW50ID0gZWw7XG4gICAgICB9LCBvbkNsaWNrOiAoZSkgPT4gdGhpcy5pc0FjY29yZGlvbkl0ZW0oZS50YXJnZXQpICYmXG4gICAgICAgIHRoaXMuaGFuZGxlQWNjb3JkaW9uSXRlbUNsaWNrKHRoaXMuZGV0YWlsc0VsZW1lbnQsIFwiZGV0YWlsc1wiKSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2VjdGlvblwiIH0sIHRoaXMucmVuZGVyRGV0YWlsKGkxOG4uY3JlYXRlZCwgZm9ybWF0RGF0ZShmdWxsSXRlbS5jcmVhdGVkKSksIHRoaXMucmVuZGVyRGV0YWlsKGkxOG4udmlld0NvdW50LCB0aGlzLmZvcm1hdHRlZFZpZXdzKSwgaXRlbS50eXBlID09PSBcIkRhc2hib2FyZFwiICYmXG4gICAgICB0aGlzLnJlbmRlckRldGFpbChpMThuLmRhc2hib2FyZFZpZXdzLCAoKF9qID0gaXRlbS50eXBlS2V5d29yZHMpID09PSBudWxsIHx8IF9qID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfai5pbmNsdWRlcyhcIk1vYmlsZVwiKSlcbiAgICAgICAgPyBpMThuLmRhc2hib2FyZE1vYmlsZVxuICAgICAgICA6IGkxOG4uZGFzaGJvYXJkRGVza3RvcCksICEhZnVsbEl0ZW0uc2l6ZSAmJlxuICAgICAgdGhpcy5yZW5kZXJEZXRhaWwoaTE4bi5maWxlU2l6ZSwgZm9ybWF0RmlsZVNpemUoZnVsbEl0ZW0uc2l6ZSkpLCBoKFwiYXJjZ2lzLWl0ZW0tYnJvd3Nlci1wcmV2aWV3LWNvcHlcIiwgeyB0ZXh0OiBmdWxsSXRlbS5pZCwgaGVhZGluZzogaTE4bi5JRCB9KSwgZnVsbEl0ZW0udXJsICYmIChoKFwiYXJjZ2lzLWl0ZW0tYnJvd3Nlci1wcmV2aWV3LWNvcHlcIiwgeyB0ZXh0OiBmdWxsSXRlbS51cmwsIGhlYWRpbmc6IGkxOG4uVVJMIH0pKSwgdGhpcy5yZW5kZXJEZXRhaWwoaTE4bi5jcmVkaXRzLCBmdWxsSXRlbS5hY2Nlc3NJbmZvcm1hdGlvbiwgaTE4bi5ub0NyZWRpdHMpLCB0aGlzLnJlbmRlckRldGFpbChpMThuLnRlcm1zT2ZVc2UsIGZ1bGxJdGVtLmxpY2Vuc2VJbmZvLCBpMThuLm5vVGVybXNPZlVzZSwgdHJ1ZSkpKSwgdGhpcy5zaG93TGF5ZXJzICYmIChoKFwiY2FsY2l0ZS1hY2NvcmRpb24taXRlbVwiLCB7IGhlYWRpbmc6IGxheWVyc0hlYWRlciwgZGVzY3JpcHRpb246IGxheWVyc0Rlc2NyaXB0aW9uLCByZWY6IChlbCkgPT4ge1xuICAgICAgICB0aGlzLmxheWVyc0VsZW1lbnQgPSBlbDtcbiAgICAgIH0sIG9uQ2xpY2s6IGFzeW5jIChlKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmlzQWNjb3JkaW9uSXRlbShlLnRhcmdldCkpIHtcbiAgICAgICAgICB0aGlzLmhhbmRsZUFjY29yZGlvbkl0ZW1DbGljayh0aGlzLmxheWVyc0VsZW1lbnQsIFwibGF5ZXJzXCIpO1xuICAgICAgICB9XG4gICAgICB9IH0sIHRoaXMucmVuZGVyTGF5ZXJzKCkpKSkpKSwgIXRoaXMuaGlkZVByZXZpZXdGb290ZXJzICYmIChoKFwiZGl2XCIsIHsgc2xvdDogXCJmb290ZXJcIiwgY2xhc3M6IFwiZm9vdGVyLWFjdGlvbnNcIiB9LCB0aGlzLnJlbmRlclN1YmxheWVyU2VsZWN0KCksIGgoXCJzbG90XCIsIHsgbmFtZTogXCJmb290ZXJcIiB9KSkpKSwgISFzdWJsYXllciAmJiB0aGlzLnJlbmRlclN1YmxheWVyUHJldmlldygpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICBcIml0ZW1cIjogW1widXBkYXRlUHJldmlld1wiXVxuICB9OyB9XG59O1xuQXJjZ2lzSXRlbUJyb3dzZXJQcmV2aWV3JDEuc3R5bGUgPSBhcmNnaXNJdGVtQnJvd3NlclByZXZpZXdDc3M7XG5cbmNvbnN0IGFyY2dpc0l0ZW1Ccm93c2VyUHJldmlld0NvcHlDc3MgPSBcIi5oZWFkaW5ne2ZvbnQtd2VpZ2h0OjUwMDtmb250LXNpemU6MC43NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMyk7cGFkZGluZy1ib3R0b206MC4yNXJlbTtwYWRkaW5nLXRvcDowO21hcmdpbi10b3A6MXJlbTttYXJnaW4tYm90dG9tOjA7LS1jYWxjaXRlLWxhYmVsLW1hcmdpbi1ib3R0b206MH0ubGFiZWx7cGFkZGluZy1ib3R0b206MH0uaW5wdXR7LS1jYWxjaXRlLXVpLWJhY2tncm91bmQ6dmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEpfS5hY3Rpb257cG9zaXRpb246cmVsYXRpdmV9LnRvb2x0aXB7cG9zaXRpb246YWJzb2x1dGU7b3BhY2l0eTowO3RyYW5zaXRpb24tcHJvcGVydHk6YmFja2dyb3VuZC1jb2xvciwgYm9yZGVyLWNvbG9yLCBjb2xvciwgZmlsbCwgc3Ryb2tlLCBvcGFjaXR5LCBib3gtc2hhZG93LCB0cmFuc2Zvcm07dHJhbnNpdGlvbi1kdXJhdGlvbjoxNTBtcztwYWRkaW5nLXRvcDowLjVyZW07cGFkZGluZy1ib3R0b206MC41cmVtO3BhZGRpbmctbGVmdDowLjc1cmVtO3BhZGRpbmctcmlnaHQ6MC43NXJlbTtib3JkZXItcmFkaXVzOnZhcigtLWNhbGNpdGUtYm9yZGVyLXJhZGl1cyk7Zm9udC1zaXplOjAuNzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpO2ZvbnQtd2VpZ2h0OjUwMDtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0xKTtib3gtc2hhZG93OjAgNHB4IDhweCAtMXB4IHJnYmEoMCwgMCwgMCwgMC4wOCksIDAgMnB4IDRweCAtMXB4IHJnYmEoMCwgMCwgMCwgMC4wNCk7d2hpdGUtc3BhY2U6bm93cmFwO3RyYW5zZm9ybTp0cmFuc2xhdGVZKC04cHgpO3RvcDpjYWxjKDEwMCUgKyA0cHgpO2luc2V0LWlubGluZS1lbmQ6MDt3aWR0aDphdXRvO2JvcmRlcjoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1ib3JkZXItMyk7bGluZS1oZWlnaHQ6MS4zNzV9LmJ1dHRvbjpob3ZlcisudG9vbHRpcCwuYnV0dG9uOmZvY3VzKy50b29sdGlwe29wYWNpdHk6MTt0cmFuc2Zvcm06dHJhbnNsYXRlWSgwKX1cIjtcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJQcmV2aWV3ID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VySW50ZXJuYWxVSUFjdGlvbiA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uXCIsIDcpO1xuICAgIHRoaXMuaGVhZGluZyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnRleHQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jb3BpZWQgPSBmYWxzZTtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4uY29weTtcbiAgfVxuICBhc3luYyBoYW5kbGVDb3B5KHRleHQpIHtcbiAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dCh0ZXh0KTtcbiAgICB0aGlzLmNvcGllZCA9IHRydWU7XG4gICAgY29uc3QgaXNTdWJsYXllciA9IHRoaXMuZWwucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJzdWJsYXllcl9fY29udGVudFwiKTtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VySW50ZXJuYWxVSUFjdGlvbi5lbWl0KHtcbiAgICAgIGFjdGlvbjogXCJjb3B5XCIsXG4gICAgICBjYXRlZ29yeTogXCJwYW5lbCBhY3Rpb25cIixcbiAgICAgIGRldGFpbHM6IGlzU3VibGF5ZXIgPyBcImxheWVyc1wiIDogXCJkZXRhaWxzXCJcbiAgICB9KTtcbiAgICBhd2FpdCB0aW1lb3V0KDEwMDAwKTtcbiAgICB0aGlzLmNvcGllZCA9IGZhbHNlO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGhlYWRpbmcsIHRleHQsIGkxOG4gfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgY2xhc3M6IFwibGFiZWxcIiwgc2NhbGU6IFwic1wiIH0sIGgoXCJoNFwiLCB7IGNsYXNzOiBcImhlYWRpbmdcIiB9LCBoZWFkaW5nKSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyB2YWx1ZTogdGV4dCwgcmVhZE9ubHk6IHRydWUsIGFsaWdubWVudDogXCJzdGFydFwiLCB0eXBlOiBcInRleHRcIiwgbGFiZWw6IGhlYWRpbmcsIHNjYWxlOiBcInNcIiwgY2xhc3M6IFwiaW5wdXRcIiB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJhY3Rpb25cIiwgY2xhc3M6IFwiYWN0aW9uXCIgfSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgY2xhc3M6IFwiYnV0dG9uXCIsIHNsb3Q6IFwiYWN0aW9uXCIsIGljb25TdGFydDogXCJjb3B5LXRvLWNsaXBib2FyZFwiLCBpZDogXCJjb3B5LWJ1dHRvblwiLCBraW5kOiBcIm5ldXRyYWxcIiwgc2NhbGU6IFwic1wiLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmhhbmRsZUNvcHkodGV4dCksIG9uTW91c2VPdXQ6IGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgdGltZW91dCgyMDApO1xuICAgICAgICB0aGlzLmNvcGllZCA9IGZhbHNlO1xuICAgICAgfSB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInRvb2x0aXBcIiB9LCB0aGlzLmNvcGllZCA/IGkxOG4gPT09IG51bGwgfHwgaTE4biA9PT0gdm9pZCAwID8gdm9pZCAwIDogaTE4bi5jb3BpZWQgOiBpMThuID09PSBudWxsIHx8IGkxOG4gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGkxOG4uY29weSkpKSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzSXRlbUJyb3dzZXJQcmV2aWV3LnN0eWxlID0gYXJjZ2lzSXRlbUJyb3dzZXJQcmV2aWV3Q29weUNzcztcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJQcmV2aWV3RmllbGREZXRhaWxzID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLmZpZWxkID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaXRlbSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnN1YmxheWVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2hvd0ZpZWxkU3RhdGlzdGljcyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmFwaSA9IDQ7XG4gICAgdGhpcy5sYXllciA9IHVuZGVmaW5lZDtcbiAgfVxuICBhc3luYyBnZXRGaWVsZERhdGEoKSB7XG4gICAgaWYgKCF0aGlzLmxheWVyKSB7XG4gICAgICBjb25zdCBbRmVhdHVyZUxheWVyXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvbGF5ZXJzL0ZlYXR1cmVMYXllclwiXSk7XG4gICAgICBjb25zdCBsYXllciA9IG5ldyBGZWF0dXJlTGF5ZXIoe1xuICAgICAgICAvLyBOb3RpY2UgdGhhdCB0aGUgdXJsIGRvZXNuJ3QgZW5kIHdpdGggLzJcbiAgICAgICAgdXJsOiB0aGlzLml0ZW0udXJsLFxuICAgICAgICBsYXllcklkOiB0aGlzLnN1YmxheWVyLmlkXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IGxheWVyLmxvYWQoKTtcbiAgICAgIHRoaXMubGF5ZXIgPSBsYXllcjtcbiAgICB9XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgZmllbGQsIHNob3dGaWVsZFN0YXRpc3RpY3MsIGFwaSB9ID0gdGhpcztcbiAgICBpZiAoIWZpZWxkKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgaGVhZGluZzogZmllbGQuYWxpYXMgfHwgZmllbGQubmFtZSwgZGVzY3JpcHRpb246IGZpZWxkLm5hbWUsIGhlYWRpbmdMZXZlbDogNSwgY29sbGFwc2libGU6IHNob3dGaWVsZFN0YXRpc3RpY3MgJiYgYXBpID09PSA0ICYmIHRoaXMuaXRlbS50eXBlID09PSBcIkZlYXR1cmUgU2VydmljZVwiLCBvbkNhbGNpdGVCbG9ja1RvZ2dsZTogKCkgPT4ge1xuICAgICAgICB0aGlzLmdldEZpZWxkRGF0YSgpO1xuICAgICAgfSB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2xvdDogXCJpY29uXCIsIGljb246IGZpZWxkVHlwZUljb25zW2ZpZWxkLnR5cGVdIHx8IFwic3RyaW5nXCIsIHNjYWxlOiBcInNcIiwgY2xhc3M6IFwibGF5ZXItaWNvblwiIH0pLCAhIXRoaXMubGF5ZXIgJiYgaChcImFyY2dpcy1maWVsZC1pbmZvXCIsIHsgbGF5ZXI6IHRoaXMubGF5ZXIsIGZpZWxkTmFtZTogZmllbGQubmFtZSB9KSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlclNlYXJjaCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclNlYXJjaCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJTZWFyY2hcIiwgNyk7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclNlYXJjaElucHV0ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlclNlYXJjaElucHV0XCIsIDcpO1xuICAgIHRoaXMudGVybSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnBsYWNlaG9sZGVyID0gdW5kZWZpbmVkO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IHsgdGVybSwgcGxhY2Vob2xkZXIgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsICgoX2IgPSAoX2EgPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhdGUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5idWNrZXQpICE9PSBcInN1YnNjcmlwdGlvbiBjb250ZW50XCIgJiYgKGgoXCJhcmNnaXMtYnJvd3Nlci1zZWFyY2hcIiwgeyB0ZXJtOiB0ZXJtLCBwbGFjZWhvbGRlcjogcGxhY2Vob2xkZXIsIG9uQXJjZ2lzQnJvd3NlclNlYXJjaDogKGUpID0+IHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJTZWFyY2guZW1pdChlLmRldGFpbCksIG9uQXJjZ2lzQnJvd3NlclNlYXJjaElucHV0OiAoZSkgPT4gdGhpcy5hcmNnaXNJdGVtQnJvd3NlclNlYXJjaElucHV0LmVtaXQoZS5kZXRhaWwpIH0pKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IGRlZmF1bHRTb3J0T3JkZXJzID0ge1xuICBteToge1xuICAgIHNvcnRGaWVsZDogXCJtb2RpZmllZFwiLFxuICAgIHNvcnRPcmRlcjogXCJkZXNjXCJcbiAgfSxcbiAgZmF2b3JpdGVzOiB7XG4gICAgc29ydEZpZWxkOiBcIm1vZGlmaWVkXCIsXG4gICAgc29ydE9yZGVyOiBcImRlc2NcIlxuICB9LFxuICBncm91cDoge1xuICAgIHNvcnRGaWVsZDogXCJtb2RpZmllZFwiLFxuICAgIHNvcnRPcmRlcjogXCJkZXNjXCJcbiAgfSxcbiAgb3JnOiB7XG4gICAgc29ydEZpZWxkOiBcIm1vZGlmaWVkXCIsXG4gICAgc29ydE9yZGVyOiBcImRlc2NcIlxuICB9LFxuICBcInN1YnNjcmlwdGlvbiBjb250ZW50XCI6IHtcbiAgICBzb3J0RmllbGQ6IFwicmVsZXZhbmNlXCIsXG4gICAgc29ydE9yZGVyOiBcImFzY1wiXG4gIH0sXG4gIFwibGl2aW5nIGF0bGFzXCI6IHtcbiAgICBzb3J0RmllbGQ6IFwicmVsZXZhbmNlXCIsXG4gICAgc29ydE9yZGVyOiBcImFzY1wiXG4gIH0sXG4gIFwibGl2aW5nIGF0bGFzIGFuYWx5c2lzXCI6IHtcbiAgICBzb3J0RmllbGQ6IFwicmVsZXZhbmNlXCIsXG4gICAgc29ydE9yZGVyOiBcImFzY1wiXG4gIH0sXG4gIGFsbDoge1xuICAgIHNvcnRGaWVsZDogXCJyZWxldmFuY2VcIixcbiAgICBzb3J0T3JkZXI6IFwiYXNjXCJcbiAgfVxufTtcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJTb3J0JDEgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJTb3J0ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlclNvcnRcIiwgNyk7XG4gICAgdGhpcy5vcHRpb25zID0gW1widGl0bGVcIiwgXCJyZWxldmFuY2VcIiwgXCJtb2RpZmllZFwiXTtcbiAgICB0aGlzLmZpZWxkID0gdW5kZWZpbmVkO1xuICAgIHRoaXMub3JkZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5hY3RpdmVGaWVsZCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmFjdGl2ZU9yZGVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudXNlclNldFNvcnQgPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgY29uc3QgeyBmaWVsZCwgb3B0aW9ucyB9ID0gdGhpcztcbiAgICBpZiAoIWZpZWxkKSB7XG4gICAgICBjb25zdCBidWNrZXRTb3J0ID0gdGhpcy5zdG9yZS5zdGF0ZS5idWNrZXQgJiYgZGVmYXVsdFNvcnRPcmRlcnNbdGhpcy5zdG9yZS5zdGF0ZS5idWNrZXRdO1xuICAgICAgdGhpcy5hY3RpdmVGaWVsZCA9IGJ1Y2tldFNvcnQgPyBidWNrZXRTb3J0LnNvcnRGaWVsZCA6IChvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnNbMF0pIHx8IFwicmVsZXZhbmNlXCI7XG4gICAgICB0aGlzLmFjdGl2ZU9yZGVyID0gZ2V0RGVmYXVsdFNvcnRPcmRlcih0aGlzLmFjdGl2ZUZpZWxkKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLnVzZXJTZXRTb3J0ID0gdHJ1ZTtcbiAgICAgIHRoaXMuYWN0aXZlRmllbGQgPSBmaWVsZDtcbiAgICAgIHRoaXMuYWN0aXZlT3JkZXIgPSB0aGlzLm9yZGVyIHx8IGdldERlZmF1bHRTb3J0T3JkZXIoZmllbGQpO1xuICAgIH1cbiAgICBvbkl0ZW1Ccm93c2VyQnVja2V0Q2hhbmdlKHRoaXMuc3RvcmUsIChidWNrZXQpID0+IHtcbiAgICAgIGNvbnN0IGRlZmF1bHRTb3J0ID0gZGVmYXVsdFNvcnRPcmRlcnNbYnVja2V0XTtcbiAgICAgIGlmIChkZWZhdWx0U29ydCkge1xuICAgICAgICB0aGlzLnVwZGF0ZVNvcnRGaWVsZChkZWZhdWx0U29ydC5zb3J0RmllbGQpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIG9uSXRlbUJyb3dzZXJTb3J0Q2hhbmdlKHRoaXMuc3RvcmUsIChzb3J0KSA9PiB7XG4gICAgICB0aGlzLmFjdGl2ZUZpZWxkID0gc29ydC5zb3J0RmllbGQ7XG4gICAgICB0aGlzLmFjdGl2ZU9yZGVyID0gc29ydC5zb3J0T3JkZXI7XG4gICAgfSk7XG4gIH1cbiAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU29ydC5lbWl0KHtcbiAgICAgIHNvcnRGaWVsZDogdGhpcy5maWVsZCB8fCB0aGlzLmFjdGl2ZUZpZWxkLFxuICAgICAgc29ydE9yZGVyOiB0aGlzLm9yZGVyIHx8ICh0aGlzLmZpZWxkID8gZ2V0RGVmYXVsdFNvcnRPcmRlcih0aGlzLmZpZWxkKSA6IHRoaXMuYWN0aXZlT3JkZXIpXG4gICAgfSk7XG4gIH1cbiAgdXBkYXRlU29ydEZpZWxkKGZpZWxkKSB7XG4gICAgdGhpcy5hY3RpdmVGaWVsZCA9IGZpZWxkO1xuICAgIHRoaXMuYWN0aXZlT3JkZXIgPSBnZXREZWZhdWx0U29ydE9yZGVyKGZpZWxkKTtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU29ydC5lbWl0KHtcbiAgICAgIHNvcnRGaWVsZDogdGhpcy5hY3RpdmVGaWVsZCxcbiAgICAgIHNvcnRPcmRlcjogdGhpcy5hY3RpdmVPcmRlclxuICAgIH0pO1xuICB9XG4gIHVwZGF0ZVNvcnRPcmRlcihvcmRlcikge1xuICAgIHRoaXMuYWN0aXZlT3JkZXIgPSBvcmRlcjtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU29ydC5lbWl0KHtcbiAgICAgIHNvcnRGaWVsZDogdGhpcy5hY3RpdmVGaWVsZCxcbiAgICAgIHNvcnRPcmRlcjogdGhpcy5hY3RpdmVPcmRlclxuICAgIH0pO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IHsgYWN0aXZlRmllbGQsIGFjdGl2ZU9yZGVyLCBmaWVsZCwgb3JkZXIsIG9wdGlvbnMgfSA9IHRoaXM7XG4gICAgY29uc3Qgc2VsZWN0ZWRGaWVsZCA9IGFjdGl2ZUZpZWxkIHx8IChvcHRpb25zLmluY2x1ZGVzKGZpZWxkKSA/IGZpZWxkIDogb3B0aW9uc1swXSk7XG4gICAgY29uc3Qgc2VsZWN0ZWRPcmRlciA9IGFjdGl2ZU9yZGVyIHx8IG9yZGVyO1xuICAgIHJldHVybiAoaChIb3N0LCBudWxsLCAoKF9iID0gKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuYnVja2V0KSAhPT0gXCJzdWJzY3JpcHRpb24gY29udGVudFwiICYmIChoKFwiYXJjZ2lzLWJyb3dzZXItc29ydFwiLCB7IHN0b3JlOiB0aGlzLnN0b3JlLCBmaWVsZDogc2VsZWN0ZWRGaWVsZCwgb3JkZXI6IHNlbGVjdGVkT3JkZXIsIG9wdGlvbnM6IG9wdGlvbnMsIG9uQXJjZ2lzQnJvd3NlclNvcnRGaWVsZENoYW5nZTogKGUpID0+IHRoaXMudXBkYXRlU29ydEZpZWxkKGUuZGV0YWlsKSwgb25BcmNnaXNCcm93c2VyU29ydE9yZGVyQ2hhbmdlOiAoZSkgPT4gdGhpcy51cGRhdGVTb3J0T3JkZXIoZS5kZXRhaWwpIH0pKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IENPTFVNTlMgPSB7XG4gIHRpdGxlOiB7XG4gICAgd2lkdGg6IFwibWlubWF4KDAsIDdmcilcIlxuICB9LFxuICB0eXBlOiB7XG4gICAgd2lkdGg6IFwibWlubWF4KDAsIDVmcilcIixcbiAgICBoaWRkZW46IHRydWVcbiAgfSxcbiAgbW9kaWZpZWQ6IHtcbiAgICB3aWR0aDogXCI3LjVyZW1cIlxuICB9LFxuICBiYWRnZXM6IHtcbiAgICB3aWR0aDogXCI2LjVyZW1cIixcbiAgICBoaWRkZW46IHRydWVcbiAgfSxcbiAgb3duZXI6IHtcbiAgICB3aWR0aDogXCJtaW5tYXgoMCwgM2ZyKVwiXG4gIH0sXG4gIHNoYXJpbmc6IHtcbiAgICB3aWR0aDogXCI2cmVtXCIsXG4gICAgaGlkZGVuOiB0cnVlXG4gIH0sXG4gIHNpemU6IHtcbiAgICB3aWR0aDogXCJtaW5tYXgoMCwgMmZyKVwiXG4gIH0sXG4gIGRlbGV0ZWQ6IHtcbiAgICB3aWR0aDogXCJtaW5tYXgoMCwgMmZyKVwiXG4gIH0sXG4gIGRldGFpbHM6IHtcbiAgICB3aWR0aDogXCI4cmVtXCIsXG4gICAgaGlkZGVuOiB0cnVlXG4gIH0sXG4gIGZhdm9yaXRlOiB7XG4gICAgd2lkdGg6IFwiMy41cmVtXCIsXG4gICAgaGlkZGVuOiB0cnVlXG4gIH0sXG4gIGFjdGlvbnM6IHtcbiAgICB3aWR0aDogXCIzLjVyZW1cIixcbiAgICBoaWRkZW46IHRydWVcbiAgfVxufTtcblxuY29uc3QgYXJjZ2lzSXRlbUJyb3dzZXJUYWJsZUNzcyA9IFwiLnRhYmxle2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEpfS5oZWFkZXJ7ZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczp2YXIoLS1pdGVtLWJyb3dzZXItdGFibGUtY29sdW1ucyl9LmJ1dHRvbl9fdGV4dC0tc29ydGVke2ZvbnQtd2VpZ2h0OjUwMH0uY29sdW1uLWhlYWRlcntib3JkZXItYm90dG9tOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLXVpLWJvcmRlci0yKTttYXJnaW4tYm90dG9tOjFweH0uY29sdW1uLWhlYWRlci0tc29ydGVke2JvcmRlci1ib3R0b20tY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1icmFuZCl9LnNjcmVlbi1yZWFkZXItb25seXtwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDoxcHg7aGVpZ2h0OjFweDtwYWRkaW5nOjA7bWFyZ2luOi0xcHg7b3ZlcmZsb3c6aGlkZGVuO2NsaXA6cmVjdCgwLCAwLCAwLCAwKTt3aGl0ZS1zcGFjZTpub3dyYXA7Ym9yZGVyLXdpZHRoOjB9XCI7XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyVGFibGUkMSA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckNvbHVtblVwZGF0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJDb2x1bW5VcGRhdGVcIiwgNyk7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclNvcnQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyU29ydFwiLCA3KTtcbiAgICB0aGlzLnJvd3MgPSBbXTtcbiAgICB0aGlzLmNvbHVtbnMgPSBbXG4gICAgICBcInRpdGxlXCIsXG4gICAgICBcInR5cGVcIixcbiAgICAgIFwibW9kaWZpZWRcIixcbiAgICAgIFwiYmFkZ2VzXCIsXG4gICAgICBcIm93bmVyXCIsXG4gICAgICBcInNoYXJpbmdcIixcbiAgICAgIFwiZGV0YWlsc1wiLFxuICAgICAgXCJhY3Rpb25zXCJcbiAgICBdO1xuICAgIHRoaXMuYWN0aXZlRm9jdXMgPSBbMCwgMF07XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLnRhYmxlO1xuICAgIG9uSXRlbUJyb3dzZXJQcmV2aWV3Q2hhbmdlKHRoaXMuc3RvcmUsIChwcmV2aWV3KSA9PiB7XG4gICAgICAvLyB3aGVuIHRoZSBwcmV2aWV3IGlzIGNsb3NlZCwgcmVzdG9yZSBmb2N1cyB0byB0aGUgZ3JpZFxuICAgICAgaWYgKCFwcmV2aWV3ICYmIHRoaXMuc3RvcmUuc3RhdGUuYWN0aXZlRm9jdXMpIHtcbiAgICAgICAgY29uc3QgW3JvdywgY29sdW1uXSA9IHRoaXMuc3RvcmUuc3RhdGUuYWN0aXZlRm9jdXM7XG4gICAgICAgIHRoaXMudXBkYXRlUm93cygpO1xuICAgICAgICBjb25zdCByb3dFbGVtZW50ID0gdGhpcy5yb3dzW3Jvd107XG4gICAgICAgIHJvd0VsZW1lbnQgPT09IG51bGwgfHwgcm93RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcm93RWxlbWVudC5mb2N1c0NvbHVtbihjb2x1bW4pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckNvbHVtblVwZGF0ZS5lbWl0KHRoaXMuY29sdW1ucyk7XG4gIH1cbiAgdXBkYXRlQ29sdW1ucyhjb2x1bW5zKSB7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckNvbHVtblVwZGF0ZS5lbWl0KGNvbHVtbnMpO1xuICB9XG4gIGFzeW5jIGF0dGVtcHRNb3ZlKFtyb3csIGNvbHVtbl0sIGRpcmVjdGlvbikge1xuICAgIGNvbnN0IHJvd0VsZW1lbnQgPSB0aGlzLnJvd3Nbcm93XTtcbiAgICBpZiAoYXdhaXQgcm93RWxlbWVudC5jYW5Gb2N1c0NvbHVtbihjb2x1bW4pKSB7XG4gICAgICB0aGlzLnN0b3JlLnN0YXRlLmFjdGl2ZUZvY3VzID0gW3JvdywgY29sdW1uXTtcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiByb3dFbGVtZW50LmZvY3VzQ29sdW1uKGNvbHVtbikpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XG4gICAgICAgIGNhc2UgXCJyaWdodFwiOlxuICAgICAgICAgIHJldHVybiB0aGlzLm1vdmVSaWdodChbcm93LCBjb2x1bW5dKTtcbiAgICAgICAgY2FzZSBcImxlZnRcIjpcbiAgICAgICAgICByZXR1cm4gdGhpcy5tb3ZlTGVmdChbcm93LCBjb2x1bW5dKTtcbiAgICAgICAgY2FzZSBcInVwXCI6XG4gICAgICAgICAgcmV0dXJuIHRoaXMubW92ZVVwKFtyb3csIGNvbHVtbl0pO1xuICAgICAgICBjYXNlIFwiZG93blwiOlxuICAgICAgICAgIHJldHVybiB0aGlzLm1vdmVEb3duKFtyb3csIGNvbHVtbl0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICB1cGRhdGVSb3dzKCkge1xuICAgIHRoaXMucm93cyA9IHRoaXMucm93U2xvdC5hc3NpZ25lZEVsZW1lbnRzKCk7XG4gIH1cbiAgZ2V0TGFzdENvbHVtbkluZGV4KCkge1xuICAgIGNvbnN0IGlzTXVsdGlTZWxlY3QgPSB0aGlzLnN0b3JlLnN0YXRlLnNlbGVjdGlvbiA9PT0gXCJtdWx0aXBsZVwiO1xuICAgIHJldHVybiB0aGlzLmNvbHVtbnMubGVuZ3RoIC0gKGlzTXVsdGlTZWxlY3QgPyAwIDogMSk7XG4gIH1cbiAgZ2V0TGFzdFJvd0luZGV4KCkge1xuICAgIHJldHVybiB0aGlzLnJvd3MubGVuZ3RoIC0gMTtcbiAgfVxuICBhc3luYyBtb3ZlUmlnaHQoW3JvdywgY3VycmVudENvbHVtbl0pIHtcbiAgICBjb25zdCBkZXNpcmVkQ29sdW1uID0gY3VycmVudENvbHVtbiA+PSB0aGlzLmdldExhc3RDb2x1bW5JbmRleCgpID8gMCA6IGN1cnJlbnRDb2x1bW4gKyAxO1xuICAgIHRoaXMuYXR0ZW1wdE1vdmUoW3JvdywgZGVzaXJlZENvbHVtbl0sIFwicmlnaHRcIik7XG4gIH1cbiAgYXN5bmMgbW92ZUxlZnQoW3JvdywgY3VycmVudENvbHVtbl0pIHtcbiAgICBjb25zdCBkZXNpcmVkQ29sdW1uID0gY3VycmVudENvbHVtbiA8IDEgPyB0aGlzLmdldExhc3RDb2x1bW5JbmRleCgpIDogY3VycmVudENvbHVtbiAtIDE7XG4gICAgdGhpcy5hdHRlbXB0TW92ZShbcm93LCBkZXNpcmVkQ29sdW1uXSwgXCJsZWZ0XCIpO1xuICB9XG4gIGFzeW5jIG1vdmVVcChbY3VycmVudFJvdywgY29sdW1uXSkge1xuICAgIGNvbnN0IGRlc2lyZWRSb3cgPSBjdXJyZW50Um93IDwgMSA/IHRoaXMuZ2V0TGFzdFJvd0luZGV4KCkgOiBjdXJyZW50Um93IC0gMTtcbiAgICB0aGlzLmF0dGVtcHRNb3ZlKFtkZXNpcmVkUm93LCBjb2x1bW5dLCBcInVwXCIpO1xuICB9XG4gIGFzeW5jIG1vdmVEb3duKFtjdXJyZW50Um93LCBjb2x1bW5dKSB7XG4gICAgY29uc3QgZGVzaXJlZFJvdyA9IGN1cnJlbnRSb3cgKyAxID4gdGhpcy5nZXRMYXN0Um93SW5kZXgoKSA/IDAgOiBjdXJyZW50Um93ICsgMTtcbiAgICB0aGlzLmF0dGVtcHRNb3ZlKFtkZXNpcmVkUm93LCBjb2x1bW5dLCBcImRvd25cIik7XG4gIH1cbiAgaGFuZGxlS2V5Ym9hcmQoZSkge1xuICAgIGNvbnN0IHsga2V5IH0gPSBlO1xuICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLnN0b3JlLnN0YXRlLmFjdGl2ZUZvY3VzIHx8IFswLCAwXTtcbiAgICB0aGlzLnVwZGF0ZVJvd3MoKTtcbiAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgY2FzZSBcIkFycm93RG93blwiOlxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybiB0aGlzLm1vdmVEb3duKGN1cnJlbnQpO1xuICAgICAgY2FzZSBcIkFycm93VXBcIjpcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm4gdGhpcy5tb3ZlVXAoY3VycmVudCk7XG4gICAgICBjYXNlIFwiQXJyb3dMZWZ0XCI6XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMubW92ZUxlZnQoY3VycmVudCk7XG4gICAgICBjYXNlIFwiQXJyb3dSaWdodFwiOlxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybiB0aGlzLm1vdmVSaWdodChjdXJyZW50KTtcbiAgICB9XG4gIH1cbiAgcmVuZGVyQ29sdW1uKGlkKSB7XG4gICAgY29uc3QgbGFiZWwgPSB0aGlzLmkxOG4uaGVhZGVyc1tpZF07XG4gICAgY29uc3QgeyBoaWRkZW4gfSA9IENPTFVNTlNbaWRdO1xuICAgIGNvbnN0IHsgc29ydEZpZWxkLCBzb3J0T3JkZXIgfSA9IHRoaXMuc3RvcmUuc3RhdGUuc29ydCB8fCB7fTtcbiAgICBjb25zdCBpc1NvcnRlZCA9IHNvcnRGaWVsZCA9PT0gaWQ7XG4gICAgcmV0dXJuIGhpZGRlbiA/IChoKFwiZGl2XCIsIHsgcm9sZTogXCJjb2x1bW5oZWFkZXJcIiwgY2xhc3M6IFwiY29sdW1uLWhlYWRlclwiIH0sIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwic2NyZWVuLXJlYWRlci1vbmx5XCIgfSwgbGFiZWwpKSkgOiAoaChcImRpdlwiLCB7IGNsYXNzOiB7IFwiY29sdW1uLWhlYWRlclwiOiB0cnVlLCBcImNvbHVtbi1oZWFkZXItLXNvcnRlZFwiOiBpc1NvcnRlZCB9IH0sICEhKGlkID09PSBcInRpdGxlXCIgJiYgdGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3Rpb24gPT09IFwibXVsdGlwbGVcIikgJiYgKGgoXCJkaXZcIiwgeyByb2xlOiBcImNvbHVtbmhlYWRlclwiLCBjbGFzczogXCJzY3JlZW4tcmVhZGVyLW9ubHlcIiB9LCBoKFwic3BhblwiLCBudWxsLCB0aGlzLmkxOG4uc2VsZWN0aW9uKSkpLCBoKFwiZGl2XCIsIHsgcm9sZTogXCJjb2x1bW5oZWFkZXJcIiwgXCJhcmlhLXNvcnRcIjogc29ydE9yZGVyID09PSBcImFzY1wiID8gXCJhc2NlbmRpbmdcIiA6IFwiZGVzY2VuZGluZ1wiIH0sIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHdpZHRoOiBcImZ1bGxcIiwgYWxpZ25tZW50OiBcImljb24tZW5kLXNwYWNlLWJldHdlZW5cIiwgdGFiaW5kZXg6IFwiLTFcIiwgc2NhbGU6IFwibVwiLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIGtpbmQ6IGlzU29ydGVkID8gXCJicmFuZFwiIDogXCJuZXV0cmFsXCIsIFwiaWNvbi1lbmRcIjogaXNTb3J0ZWQgJiYgc29ydE9yZGVyID09PSBcImFzY1wiID8gXCJjYXJldC11cFwiIDogXCJjYXJldC1kb3duXCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgLy8gaWYgd2UgYXJlIGFscmVhZHkgc29ydGluZyBvbiB0aGlzIGZpZWxkLCBmbGlwIGl0XG4gICAgICAgIGlmIChpc1NvcnRlZCkge1xuICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJTb3J0LmVtaXQoe1xuICAgICAgICAgICAgc29ydEZpZWxkLFxuICAgICAgICAgICAgc29ydE9yZGVyOiBzb3J0T3JkZXIgPT09IFwiYXNjXCIgPyBcImRlc2NcIiA6IFwiYXNjXCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU29ydC5lbWl0KHtcbiAgICAgICAgICAgIHNvcnRGaWVsZDogaWQsXG4gICAgICAgICAgICBzb3J0T3JkZXI6IGdldERlZmF1bHRTb3J0T3JkZXIoaWQpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gfSwgaChcInNwYW5cIiwgeyBjbGFzczogeyBidXR0b25fX3RleHQ6IHRydWUsIFwiYnV0dG9uX190ZXh0LS1zb3J0ZWRcIjogaXNTb3J0ZWQgfSB9LCBsYWJlbCkpKSkpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCBpc011bHRpU2VsZWN0ID0gdGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3Rpb24gPT09IFwibXVsdGlwbGVcIjtcbiAgICByZXR1cm4gKGgoSG9zdCwgeyBzdHlsZToge1xuICAgICAgICBcIi0taXRlbS1icm93c2VyLXRhYmxlLWNvbHVtbnNcIjogYCR7dGhpcy5jb2x1bW5zLm1hcCgoaWQpID0+IENPTFVNTlNbaWRdLndpZHRoKS5qb2luKFwiIFwiKX1gXG4gICAgICB9IH0sIGgoXCJkaXZcIiwgT2JqZWN0LmFzc2lnbih7IGNsYXNzOiBcInRhYmxlXCIsIFwiYXJpYS1sYWJlbFwiOiBcIlRhYmxlIHdpdGggc2VsZWN0aW9uXCIsIHJvbGU6IFwiZ3JpZFwiLCBcImFyaWEtcmVhZG9ubHlcIjogXCJ0cnVlXCIgfSwgKGlzTXVsdGlTZWxlY3QgPyB7IFwiYXJpYS1tdWx0aXNlbGVjdGFibGVcIjogXCJ0cnVlXCIgfSA6IHt9KSwgeyBvbktleURvd246IChlKSA9PiB0aGlzLmhhbmRsZUtleWJvYXJkKGUpIH0pLCBoKFwiZGl2XCIsIHsgcm9sZTogXCJyb3dncm91cFwiIH0sIGgoXCJkaXZcIiwgeyByb2xlOiBcInJvd1wiLCBjbGFzczogXCJoZWFkZXJcIiB9LCB0aGlzLmNvbHVtbnMubWFwKChpZCkgPT4gdGhpcy5yZW5kZXJDb2x1bW4oaWQpKSkpLCBoKFwiZGl2XCIsIG51bGwsIGgoXCJzbG90XCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLnJvd1Nsb3QgPSBlbCkgfSkpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICBcImNvbHVtbnNcIjogW1widXBkYXRlQ29sdW1uc1wiXVxuICB9OyB9XG59O1xuQXJjZ2lzSXRlbUJyb3dzZXJUYWJsZSQxLnN0eWxlID0gYXJjZ2lzSXRlbUJyb3dzZXJUYWJsZUNzcztcblxuY29uc3QgYXJjZ2lzSXRlbUJyb3dzZXJUYWJsZVJvd0NzcyA9IFwiOmhvc3R7ZGlzcGxheTpibG9jazstLWl0ZW0tYnJvd3Nlci10YWJsZS1yb3ctYWN0aXZlLWJhY2tncm91bmQ6I2JiZDVmYTI2fS5yb3d7ZGlzcGxheTpncmlkO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEpO2dyaWQtdGVtcGxhdGUtY29sdW1uczp2YXIoLS1pdGVtLWJyb3dzZXItdGFibGUtY29sdW1ucyk7Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMSk7Ym9yZGVyLXRvcDoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1ib3JkZXItMik7bWFyZ2luLXRvcDotMXB4fS5yb3ctLWZpcnN0e2JvcmRlci10b3AtY29sb3I6dmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEpfS5yb3ctLXNlbGVjdGVke3Bvc2l0aW9uOnJlbGF0aXZlO2JvcmRlci1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWJyYW5kKTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWl0ZW0tYnJvd3Nlci10YWJsZS1yb3ctYWN0aXZlLWJhY2tncm91bmQpfS5yb3ctLXNlbGVjdGVkLWxhc3R7Ym9yZGVyLXRvcC1jb2xvcjp2YXIoLS1pdGVtLWJyb3dzZXItdGFibGUtcm93LWFjdGl2ZS1iYWNrZ3JvdW5kKX0uY2VsbHtwYWRkaW5nLWxlZnQ6MC43NXJlbTtwYWRkaW5nLXJpZ2h0OjAuNzVyZW07cGFkZGluZy10b3A6MC41cmVtO3BhZGRpbmctYm90dG9tOjAuNXJlbTtmb250LXNpemU6MC44NzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmZsZXgtc3RhcnQ7b3V0bGluZS1jb2xvcjp0cmFuc3BhcmVudDtsaW5lLWhlaWdodDoxLjM1fS5jZWxsOmZvY3Vze291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktYnJhbmQpO291dGxpbmUtb2Zmc2V0Oi0ycHh9LmNlbGwtLW5hcnJvd3std2Via2l0LXBhZGRpbmctc3RhcnQ6MC41cmVtO3BhZGRpbmctaW5saW5lLXN0YXJ0OjAuNXJlbX0uY2VsbC0tb3ZlcmZsb3d7b3ZlcmZsb3c6aGlkZGVuO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXM7d2hpdGUtc3BhY2U6bm93cmFwO3dvcmQtd3JhcDpicmVhay13b3JkO292ZXJmbG93LXdyYXA6YnJlYWstd29yZH0uY2hlY2tib3gtd3JhcHtkaXNwbGF5OmZsZXh9LmNoZWNrYm94X190aXRsZXtmbGV4OjEgMSAwJX0udXNlci1wb3B1cHt3aWR0aDoxMDAlfS5zY3JlZW4tcmVhZGVycy1vbmx5e3Bvc2l0aW9uOmFic29sdXRlO3dpZHRoOjFweDtoZWlnaHQ6MXB4O3BhZGRpbmc6MDttYXJnaW46LTFweDtvdmVyZmxvdzpoaWRkZW47Y2xpcDpyZWN0KDAsIDAsIDAsIDApO3doaXRlLXNwYWNlOm5vd3JhcDtib3JkZXItd2lkdGg6MH0uYnV0dG9ue2JvcmRlcjoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTMpO2ZvbnQtZmFtaWx5OmluaGVyaXQ7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMSk7dHJhbnNpdGlvbjphbGwgdmFyKC0tY2FsY2l0ZS1hbmltYXRpb24tdGltaW5nKSBlYXNlLWluLW91dCAwcywgb3V0bGluZSAwcywgb3V0bGluZS1vZmZzZXQgMHM7cGFkZGluZy1sZWZ0OjAuNzVyZW07cGFkZGluZy1yaWdodDowLjc1cmVtO3BhZGRpbmctdG9wOjAuNXJlbTtwYWRkaW5nLWJvdHRvbTowLjVyZW07b3V0bGluZS1jb2xvcjp0cmFuc3BhcmVudDtoZWlnaHQ6MnJlbTtib3gtc2l6aW5nOmJvcmRlci1ib3g7Y3Vyc29yOnBvaW50ZXI7LXdlYmtpdC1hcHBlYXJhbmNlOm5vbmU7LW1vei1hcHBlYXJhbmNlOm5vbmU7YXBwZWFyYW5jZTpub25lO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Y29sb3I6dmFyKC0tY2FsY2l0ZS11aS10ZXh0LTEpO3RleHQtZGVjb3JhdGlvbjpub25lO292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzO3doaXRlLXNwYWNlOm5vd3JhcDttYXgtd2lkdGg6MTAwJX0uYnV0dG9uOmhvdmVye2JveC1zaGFkb3c6aW5zZXQgMCAwIDAgMXB4IHZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0zKX0uYnV0dG9uOmZvY3Vze291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktYnJhbmQpO291dGxpbmUtb2Zmc2V0OjJweH0uYnV0dG9uLS10cmFuc3BhcmVudHtib3JkZXI6MXB4IHNvbGlkIHRyYW5zcGFyZW50O2JhY2tncm91bmQ6dHJhbnNwYXJlbnQ7cGFkZGluZy1sZWZ0OjAuNXJlbTtwYWRkaW5nLXJpZ2h0OjAuNXJlbX0uYnV0dG9uLS10cmFuc3BhcmVudDpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0yKTtib3gtc2hhZG93Om5vbmV9XCI7XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyVGFibGUgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJDb2x1bW5VcGRhdGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyQ29sdW1uVXBkYXRlXCIsIDcpO1xuICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJDYXJkU2VsZWN0ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckNhcmRTZWxlY3RcIiwgNyk7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckNhcmRQcmV2aWV3ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckNhcmRQcmV2aWV3XCIsIDcpO1xuICAgIHZhciBfYTtcbiAgICB0aGlzLmNvbHVtblJlZnMgPSB7fTtcbiAgICB0aGlzLml0ZW0gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5pbmRleCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5hcGkgPSA0O1xuICAgIHRoaXMuYmFzZVVybCA9IChfYSA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS5jb25maWcpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5iYXNlVXJsO1xuICAgIHRoaXMubGluayA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm5ld1RhYiA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm5hbWUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wcmV2aWV3ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc2hvd0l0ZW1UeXBlID0gdHJ1ZTtcbiAgICB0aGlzLnNob3dCYWRnZXMgPSB0cnVlO1xuICAgIHRoaXMuc2hvd1NoYXJpbmcgPSB0cnVlO1xuICAgIHRoaXMuYWN0aW9ucyA9IFtdO1xuICAgIHRoaXMuaGFzTW91c2UgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5tb3VzZU92ZXJDb2x1bW4gPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLnRhYmxlUm93O1xuICB9XG4gIGFzeW5jIGNhbkZvY3VzQ29sdW1uKGluZGV4KSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLnN0b3JlLnN0YXRlLmNvbHVtbnMgfHwgW107XG4gICAgY29uc3QgYWRqdXN0ZWRJbmRleCA9IHRoaXMuZ2V0Q29sdW1uTnVtYmVyKGluZGV4KTtcbiAgICBjb25zdCBpZCA9IGNvbHVtbnNbYWRqdXN0ZWRJbmRleF07XG4gICAgLy8gb25seSBhbGxvdyB0YWJiaW5nIHRvIHRoZSBiYWRnZXMgaWYgdGhlcmUgYXJlIGJhZGdlcyBkaXNwbGF5ZWRcbiAgICBpZiAoaWQgPT09IFwiYmFkZ2VzXCIpIHtcbiAgICAgIHJldHVybiAhdGhpcy5iYWRnZXMuZW1wdHk7XG4gICAgfVxuICAgIHJldHVybiAhISgoX2EgPSB0aGlzLmNvbHVtblJlZnNbaWRdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWV0aG9kKSB8fCBhZGp1c3RlZEluZGV4IDwgMDtcbiAgfVxuICBhc3luYyBmb2N1c0NvbHVtbihjb2x1bW4pIHtcbiAgICB2YXIgX2E7XG4gICAgbGV0IGFkanVzdGVkQ29sdW1uID0gY29sdW1uO1xuICAgIC8vIHNlbGVjdGFibGUgdGFibGVzIGhhdmUgdGhlIGNoZWNrYm94IGFuZCB0aXRsZSBpbiBhIHNpbmdsZSBjb2x1bW5cbiAgICAvLyBvZmZzZXQgdGhlIGNvbHVtbiBudW1iZXIgdG8gYWxsb3cgbW92ZW1lbnQgYXMgaWYgdGhleSB3ZXJlIHNlcGFyYXRlIGNvbHVtbnNcbiAgICBpZiAodGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3Rpb24gPT09IFwibXVsdGlwbGVcIikge1xuICAgICAgaWYgKGNvbHVtbiA9PT0gMCkge1xuICAgICAgICAoX2EgPSB0aGlzLmNoZWNrYm94KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgYWRqdXN0ZWRDb2x1bW4gPSBjb2x1bW4gLSAxO1xuICAgIH1cbiAgICBjb25zdCB7IGVsLCBtZXRob2QgfSA9IHRoaXMuY29sdW1uUmVmc1t0aGlzLnN0b3JlLnN0YXRlLmNvbHVtbnNbYWRqdXN0ZWRDb2x1bW5dXSB8fCB7fTtcbiAgICBlbFttZXRob2RdKCk7XG4gIH1cbiAgZ2V0Q29sdW1uTnVtYmVyKGNvbHVtbikge1xuICAgIGlmICh0aGlzLnN0b3JlLnN0YXRlLnNlbGVjdGlvbiA9PT0gXCJtdWx0aXBsZVwiKSB7XG4gICAgICByZXR1cm4gY29sdW1uIC0gMTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbHVtbjtcbiAgfVxuICBpc1NpbXBsZUNvbHVtbihpZCkge1xuICAgIHJldHVybiAhW1wib3duZXJcIiwgXCJkZXRhaWxzXCIsIFwiZmF2b3JpdGVcIiwgXCJhY3Rpb25zXCJdLmluY2x1ZGVzKGlkKTtcbiAgfVxuICBvbkNsaWNrKGNiKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgY2IoKTtcbiAgICAgIH0sXG4gICAgICBvbktleURvd246IChlKSA9PiB7XG4gICAgICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiIHx8IGUua2V5ID09PSBcIiBcIikge1xuICAgICAgICAgIGNiKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIHJlbmRlclRpdGxlKHNlbGVjdGVkKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgIGNvbnN0IHsgaXRlbSB9ID0gdGhpcztcbiAgICBjb25zdCBhY3RpdmVDb2x1bW4gPSAoX2IgPSAoX2EgPSB0aGlzLnN0b3JlLnN0YXRlLmFjdGl2ZUZvY3VzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMV0pICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IDA7XG4gICAgY29uc3Qgcm93SGFzRm9jdXMgPSAoKF9kID0gKF9jID0gdGhpcy5zdG9yZS5zdGF0ZS5hY3RpdmVGb2N1cykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jWzBdKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiAwKSA9PT0gdGhpcy5pbmRleDtcbiAgICBjb25zdCBjb2x1bW5IYXNGb2N1cyA9IGFjdGl2ZUNvbHVtbiA8IDI7XG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY2hlY2tib3gtd3JhcFwiLCBvbk1vdXNlT3ZlcjogKCkgPT4ge1xuICAgICAgICB0aGlzLm1vdXNlT3ZlckNvbHVtbiA9IDA7XG4gICAgICB9LCBrZXk6IFwidGl0bGVcIiB9LCBoKFwiZGl2XCIsIHsgcm9sZTogXCJncmlkY2VsbFwiLCBjbGFzczogXCJjZWxsXCIgfSwgaChcImNhbGNpdGUtY2hlY2tib3hcIiwgT2JqZWN0LmFzc2lnbih7fSwgKChyb3dIYXNGb2N1cyAmJiBjb2x1bW5IYXNGb2N1cykgfHwgKHRoaXMuaGFzTW91c2UgJiYgdGhpcy5tb3VzZU92ZXJDb2x1bW4gPT09IDApXG4gICAgICA/IHt9XG4gICAgICA6IHsgaW5lcnQ6IHRydWUgfSksIHsgY2xhc3M6IFwiY2hlY2tib3hcIiwgY2hlY2tlZDogc2VsZWN0ZWQsIHJlZjogKGVsKSA9PiB7XG4gICAgICAgIHRoaXMuY2hlY2tib3ggPSBlbDtcbiAgICAgIH0sIG9uQ2xpY2s6IChlKSA9PiB7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuYWN0aXZlRm9jdXMgPSBbdGhpcy5pbmRleCwgMF07XG4gICAgICB9LCBvbkNhbGNpdGVDaGVja2JveENoYW5nZTogKCkgPT4ge1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFNlbGVjdC5lbWl0KHsgaXRlbSwgc2VsZWN0ZWQ6ICFzZWxlY3RlZCB9KTtcbiAgICAgIH0sIHZhbHVlOiBpdGVtLmlkIH0pLCBoKFwic3BhblwiLCB7IGNsYXNzOiBcInNjcmVlbi1yZWFkZXJzLW9ubHlcIiB9LCBpdGVtLnRpdGxlKSkpLCBoKFwiZGl2XCIsIE9iamVjdC5hc3NpZ24oeyBvbk1vdXNlT3ZlcjogKCkgPT4ge1xuICAgICAgICB0aGlzLm1vdXNlT3ZlckNvbHVtbiA9IDA7XG4gICAgICB9LCByb2xlOiBcImdyaWRjZWxsXCIsIGNsYXNzOiBcImNlbGwgY2VsbC0tbmFycm93IGNoZWNrYm94X190aXRsZVwiLCBpZDogYHJvdy0ke2l0ZW0uaWR9YCwgdGFiaW5kZXg6IGFjdGl2ZUNvbHVtbiA9PT0gMSAmJiByb3dIYXNGb2N1cyA/IDAgOiAtMSB9LCB0aGlzLm9uQ2xpY2soKCkgPT4ge1xuICAgICAgaWYgKHRoaXMucHJldmlldyA9PT0gXCJ0aXRsZVwiKSB7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJDYXJkUHJldmlldy5lbWl0KGl0ZW0pO1xuICAgICAgfVxuICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5hY3RpdmVGb2N1cyA9IFt0aGlzLmluZGV4LCAxXTtcbiAgICB9KSwgeyByZWY6IChlbCkgPT4ge1xuICAgICAgICB0aGlzLmNvbHVtblJlZnMudGl0bGUgPSB7IGVsLCBtZXRob2Q6IFwiZm9jdXNcIiB9O1xuICAgICAgfSB9KSwgdGhpcy5pdGVtLnRpdGxlKSkpO1xuICB9XG4gIHJlbmRlckNvbHVtbihpZCwgY29sdW1uSW5kZXgsIHNlbGVjdGVkKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgIGNvbnN0IHsgaXRlbSwgYXBpLCBwb3J0YWwsIGJhc2VVcmwsIHVzZXIgfSA9IHRoaXM7XG4gICAgY29uc3QgYWN0aXZlQ29sdW1uID0gKF9iID0gKF9hID0gdGhpcy5zdG9yZS5zdGF0ZS5hY3RpdmVGb2N1cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzFdKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAwO1xuICAgIGNvbnN0IGlzU2ltcGxlQ29sdW1uID0gdGhpcy5pc1NpbXBsZUNvbHVtbihpZCk7XG4gICAgY29uc3Qgcm93SGFzRm9jdXMgPSAoKF9kID0gKF9jID0gdGhpcy5zdG9yZS5zdGF0ZS5hY3RpdmVGb2N1cykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jWzBdKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiAwKSA9PT0gdGhpcy5pbmRleDtcbiAgICBjb25zdCBjb2x1bW5IYXNGb2N1cyA9IGNvbHVtbkluZGV4ID09PSB0aGlzLmdldENvbHVtbk51bWJlcihhY3RpdmVDb2x1bW4pO1xuICAgIGlmIChpZCA9PT0gXCJ0aXRsZVwiICYmIHRoaXMuc3RvcmUuc3RhdGUuc2VsZWN0aW9uID09PSBcIm11bHRpcGxlXCIpIHtcbiAgICAgIHJldHVybiB0aGlzLnJlbmRlclRpdGxlKHNlbGVjdGVkKTtcbiAgICB9XG4gICAgY29uc3QgdGFiID0geyB0YWJJbmRleDogY29sdW1uSGFzRm9jdXMgJiYgcm93SGFzRm9jdXMgPyAwIDogLTEgfTtcbiAgICBjb25zdCB0cnVuY2F0ZSA9IFtcIm93bmVyXCJdLmluY2x1ZGVzKGlkKTtcbiAgICByZXR1cm4gKGgoXCJkaXZcIiwgT2JqZWN0LmFzc2lnbih7IGtleTogaWQgfSwgKGlzU2ltcGxlQ29sdW1uID8gdGFiIDoge30pLCB7IHJvbGU6IFwiZ3JpZGNlbGxcIiwgY2xhc3M6IHsgY2VsbDogdHJ1ZSwgXCJjZWxsLS1vdmVyZmxvd1wiOiB0cnVuY2F0ZSB9LCByZWY6IChlbCkgPT4ge1xuICAgICAgICBpZiAoaXNTaW1wbGVDb2x1bW4pIHtcbiAgICAgICAgICB0aGlzLmNvbHVtblJlZnNbaWRdID0geyBlbCwgbWV0aG9kOiBcImZvY3VzXCIgfTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8vIG9uIGNsaWNrLCBzZXQgdGhlIGFjdGl2ZSBmb2N1cyBjb29yZGluYXRlcyB0byB0aGF0IGNlbGxcbiAgICAgIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgY29uc3QgY29sdW1uID0gdGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3Rpb24gPT09IFwibXVsdGlwbGVcIiA/IGNvbHVtbkluZGV4ICsgMSA6IGNvbHVtbkluZGV4O1xuICAgICAgICAgIGlmICghY29sdW1uSGFzRm9jdXMgfHwgIXJvd0hhc0ZvY3VzKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLmFjdGl2ZUZvY3VzID0gW3RoaXMuaW5kZXgsIGNvbHVtbl07XG4gICAgICAgICAgfVxuICAgICAgICB9LCAxMDApO1xuICAgICAgfSwgb25Nb3VzZU92ZXI6ICgpID0+IHtcbiAgICAgICAgdGhpcy5tb3VzZU92ZXJDb2x1bW4gPSBjb2x1bW5JbmRleDtcbiAgICAgIH0gfSksIGlkID09PSBcInRpdGxlXCIgJiYgaChcInNwYW5cIiwgbnVsbCwgdGhpcy5pdGVtLnRpdGxlKSwgaWQgPT09IFwidHlwZVwiICYmIGgoXCJhcmNnaXMtaXRlbS10eXBlXCIsIHsgaXRlbTogaXRlbSwgcG9ydGFsOiB0aGlzLnBvcnRhbCwgc2NhbGU6IFwibVwiIH0pLCBpZCA9PT0gXCJtb2RpZmllZFwiICYmIGZvcm1hdERhdGUoaXRlbS5tb2RpZmllZCksIGlkID09PSBcImJhZGdlc1wiICYmIChoKFwiYXJjZ2lzLWl0ZW0tYmFkZ2VzXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLmJhZGdlcyA9IGVsKSwgc2hvd1Rvb2x0aXBzOiB0cnVlLCBpdGVtOiBpdGVtLCB3aWR0aDogXCJuYXJyb3dcIiwgc2NhbGU6IFwic1wiLCB0YWJJbmRleDogLTEgfSkpLCBpZCA9PT0gXCJzaGFyaW5nXCIgJiYgaChcImFyY2dpcy1pdGVtLXNoYXJlLXN1bW1hcnlcIiwgeyBzaG93VGV4dDogZmFsc2UsIGl0ZW06IGl0ZW0sIHNjYWxlOiBcInNcIiB9KSwgaWQgPT09IFwib3duZXJcIiAmJiAoaChcImFyY2dpcy11c2VyLXBvcHVwXCIsIHsgaXRlbTogaXRlbSwgdW5kZXJsaW5lOiB0cnVlLCBhcGk6IGFwaSwgcG9ydGFsOiBwb3J0YWwsIGJhc2VVcmw6IGJhc2VVcmwsIHNjYWxlOiBcIm1cIiwgY2xhc3M6IFwidXNlci1wb3B1cFwiLCBzaG93QXZhdGFyOiBmYWxzZSwgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgdGhpcy5jb2x1bW5SZWZzLm93bmVyID0geyBlbCwgbWV0aG9kOiBcInNldEZvY3VzXCIgfTtcbiAgICAgIH0sIHRhYkluZGV4OiAtMSB9KSksIGlkID09PSBcImRldGFpbHNcIiAmJiAoaChcImFcIiwgT2JqZWN0LmFzc2lnbih7fSwgdGFiLCB7IGhyZWY6IGAke3RoaXMuYmFzZVVybH0vaXRlbS5odG1sP2lkPSR7aXRlbS5pZH1gLCB0YXJnZXQ6IFwiX2JsYW5rXCIsIGNsYXNzOiBcImJ1dHRvblwiLCByZWY6IChlbCkgPT4ge1xuICAgICAgICB0aGlzLmNvbHVtblJlZnMuZGV0YWlscyA9IHsgZWwsIG1ldGhvZDogXCJmb2N1c1wiIH07XG4gICAgICB9IH0pLCB0aGlzLmkxOG4uZGV0YWlscykpLCBpZCA9PT0gXCJmYXZvcml0ZVwiICYmIChoKFwiYXJjZ2lzLWl0ZW0tZmF2b3JpdGVcIiwgeyBpdGVtOiBpdGVtLCBwb3J0YWw6IHBvcnRhbCwgdXNlcjogdXNlciB8fCAoY29uZmlnU3RhdGUgPT09IG51bGwgfHwgY29uZmlnU3RhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbmZpZ1N0YXRlLnVzZXIpLCBpY29uT25seTogdHJ1ZSwgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgdGhpcy5jb2x1bW5SZWZzLmZhdm9yaXRlID0geyBlbCwgbWV0aG9kOiBcInNldEZvY3VzXCIgfTtcbiAgICAgIH0sIHRhYkluZGV4OiAtMSB9KSksIGlkID09PSBcImFjdGlvbnNcIiAmJiAoaChcInNwYW5cIiwgbnVsbCwgdGhpcy5hY3Rpb25zLmxlbmd0aCA+IDAgJiYgKGgoXCJjYWxjaXRlLWRyb3Bkb3duXCIsIHsgcGxhY2VtZW50OiBcImJvdHRvbS1lbmRcIiwgc2NhbGU6IFwibVwiLCBvdmVybGF5UG9zaXRpb25pbmc6IFwiZml4ZWRcIiB9LCBoKFwiYnV0dG9uXCIsIE9iamVjdC5hc3NpZ24oe30sIHRhYiwgeyBjbGFzczogXCJidXR0b24gYnV0dG9uLS10cmFuc3BhcmVudFwiLCBcImFyaWEtbGFiZWxcIjogdGhpcy5pMThuLm1vcmVPcHRpb25zLCBzbG90OiBcInRyaWdnZXJcIiwgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgdGhpcy5jb2x1bW5SZWZzLmFjdGlvbnMgPSB7IGVsLCBtZXRob2Q6IFwiZm9jdXNcIiB9O1xuICAgICAgfSB9KSwgaChcImNhbGNpdGUtaWNvblwiLCB7IGljb246IFwiZWxsaXBzaXNcIiwgc2NhbGU6IFwic1wiIH0pKSwgaChcImNhbGNpdGUtZHJvcGRvd24tZ3JvdXBcIiwgeyBzZWxlY3Rpb25Nb2RlOiBcIm5vbmVcIiwgb25LZXlEb3duOiAoZSkgPT4ge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgfSB9LCB0aGlzLmFjdGlvbnMubWFwKCh7IHRleHQsIG5ld1RhYiwgbGluaywgYWN0aW9uIH0pID0+IChoKFwiY2FsY2l0ZS1kcm9wZG93bi1pdGVtXCIsIE9iamVjdC5hc3NpZ24oeyBvbkNsaWNrOiAoZSkgPT4ge1xuICAgICAgICBpZiAoYWN0aW9uKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGFjdGlvbigpO1xuICAgICAgICB9XG4gICAgICB9LCBrZXk6IHRleHQgfSwgKCFhY3Rpb24gJiYgbGlua1xuICAgICAgPyBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIChuZXdUYWIgPyB7IHRhcmdldDogXCJfYmxhbmtcIiwgcmVsOiBcIm5vb3BlbmVyIG5vcmVmZXJyZXJcIiB9IDoge30pKSwgeyBocmVmOiBsaW5rIH0pIDoge30pKSwgdGV4dCkpKSkpKSkpKSk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgY29uc3QgY29sdW1ucyA9IHRoaXMuc3RvcmUuc3RhdGUuY29sdW1ucyB8fCBbXTtcbiAgICBjb25zdCB7IGl0ZW0gfSA9IHRoaXM7XG4gICAgY29uc3Qgc2VsZWN0aW9uID0gKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlLnNlbGVjdGlvbjtcbiAgICBjb25zdCBpdGVtU2VsZWN0aW9uID0gW1wic2luZ2xlXCIsIFwibXVsdGlwbGVcIl0uaW5jbHVkZXMoc2VsZWN0aW9uKTtcbiAgICBjb25zdCBzZWxlY3RlZCA9IGl0ZW1TZWxlY3Rpb24gJiYgaXNTZWxlY3RlZCh7IGl0ZW0sIHNlbGVjdGVkSXRlbXM6IChfYiA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zdGF0ZS5zZWxlY3RlZEl0ZW1zIH0pO1xuICAgIHJldHVybiAoaChIb3N0LCBPYmplY3QuYXNzaWduKHt9LCAoc2VsZWN0ZWQgPyB7IFwiZGF0YS1zZWxlY3RlZFwiOiB0cnVlIH0gOiB7fSksIHsgb25Nb3VzZU92ZXI6ICgpID0+IHtcbiAgICAgICAgdGhpcy5oYXNNb3VzZSA9IHRydWU7XG4gICAgICB9LCBvbk1vdXNlT3V0OiAoKSA9PiB7XG4gICAgICAgIHRoaXMuaGFzTW91c2UgPSBmYWxzZTtcbiAgICAgIH0gfSksIGgoXCJkaXZcIiwgT2JqZWN0LmFzc2lnbih7IGNsYXNzOiB7XG4gICAgICAgIHJvdzogdHJ1ZSxcbiAgICAgICAgXCJyb3ctLXNlbGVjdGVkXCI6IHNlbGVjdGVkLFxuICAgICAgICBcInJvdy0tZmlyc3RcIjogdGhpcy5pbmRleCA9PT0gMFxuICAgICAgfSwgcm9sZTogXCJyb3dcIiB9LCAoc2VsZWN0ZWQgPyB7IGFyaWFTZWxlY3RlZDogdHJ1ZSB9IDoge30pLCB7IFwiYXJpYS1sYWJlbGxlZGJ5XCI6IGByb3ctJHtpdGVtLmlkfWAgfSksIGNvbHVtbnMubWFwKChpZCwgaSkgPT4gdGhpcy5yZW5kZXJDb2x1bW4oaWQsIGksIHNlbGVjdGVkKSkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0l0ZW1Ccm93c2VyVGFibGUuc3R5bGUgPSBhcmNnaXNJdGVtQnJvd3NlclRhYmxlUm93Q3NzO1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlclRvcEJhciA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJhcmNnaXMtYnJvd3Nlci10b3AtYmFyXCIsIHsgc3RvcmU6IHRoaXMuc3RvcmUsIGZpbHRlcnNEaXNhYmxlZDogKChfYiA9IChfYSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmJ1Y2tldCkgPT09IFwic3Vic2NyaXB0aW9uIGNvbnRlbnRcIiB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJjb250ZW50LXN0YXJ0XCIgfSwgaChcInNsb3RcIiwgeyBuYW1lOiBcImNvbnRlbnQtc3RhcnRcIiB9KSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImJ1Y2tldFwiIH0sIGgoXCJzbG90XCIsIHsgbmFtZTogXCJidWNrZXRcIiB9KSksIGgoXCJkaXZcIiwgeyBzbG90OiBcInNlYXJjaFwiIH0sIGgoXCJzbG90XCIsIHsgbmFtZTogXCJzZWFyY2hcIiB9KSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRlbnQtZW5kXCIgfSwgaChcInNsb3RcIiwgeyBuYW1lOiBcImNvbnRlbnQtZW5kXCIgfSkpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyU29ydCA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclZpZXcgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyVmlld1wiLCA3KTtcbiAgICB0aGlzLm9wdGlvbnMgPSBbXCJncmlkXCIsIFwibGlzdFwiXTtcbiAgICB0aGlzLnZpZXcgPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLnZpZXc7XG4gICAgY29uc3QgeyB2aWV3IH0gPSB0aGlzO1xuICAgIGlmICghdmlldykge1xuICAgICAgdGhpcy52aWV3ID0gdGhpcy5zdG9yZS5zdGF0ZS52aWV3IHx8IFwibGlzdFwiO1xuICAgIH1cbiAgICBvbkl0ZW1Ccm93c2VyVmlld0NoYW5nZSh0aGlzLnN0b3JlLCAobmV3VmlldykgPT4ge1xuICAgICAgdGhpcy52aWV3ID0gbmV3VmlldztcbiAgICB9KTtcbiAgfVxuICBzeW5jU3RvcmUobmV3Vmlldykge1xuICAgIHRoaXMuc3RvcmUuc3RhdGUudmlldyA9IG5ld1ZpZXc7XG4gIH1cbiAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyVmlldy5lbWl0KHRoaXMudmlldyk7XG4gIH1cbiAgcmVuZGVyT3B0aW9uKG9wdGlvbikge1xuICAgIHJldHVybiAoaChcImNhbGNpdGUtZHJvcGRvd24taXRlbVwiLCB7IGtleTogb3B0aW9uLCBzZWxlY3RlZDogb3B0aW9uID09PSB0aGlzLnZpZXcsIG9uQ2FsY2l0ZURyb3Bkb3duSXRlbVNlbGVjdDogKCkgPT4gdGhpcy5hcmNnaXNJdGVtQnJvd3NlclZpZXcuZW1pdChvcHRpb24pLCBpY29uU3RhcnQ6IG9wdGlvbiB9LCB0aGlzLmkxOG5bb3B0aW9uXSkpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IG9wdGlvbnMsIHZpZXcsIGkxOG4gfSA9IHRoaXM7XG4gICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJjYWxjaXRlLWRyb3Bkb3duXCIsIHsgcGxhY2VtZW50OiBcImJvdHRvbS1lbmRcIiwgc2NhbGU6IFwibVwiLCBvdmVybGF5UG9zaXRpb25pbmc6IFwiZml4ZWRcIiwgd2lkdGg6IFwic1wiIH0sIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGNsYXNzOiBcImJ1dHRvblwiLCBzbG90OiBcInRyaWdnZXJcIiwgc2NhbGU6IFwibVwiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgaWNvblN0YXJ0OiB2aWV3LCBpY29uRmxpcFJ0bDogXCJzdGFydFwiLCBcImFyaWEtbGFiZWxcIjogYCR7aTE4bi52aWV3fTogJHtpMThuW3ZpZXddfWAgfSwgaTE4blt2aWV3XSksIGgoXCJjYWxjaXRlLWRyb3Bkb3duLWdyb3VwXCIsIHsgc2VsZWN0aW9uTW9kZTogXCJzaW5nbGVcIiB9LCBvcHRpb25zLm1hcCgob3B0aW9uKSA9PiB0aGlzLnJlbmRlck9wdGlvbihvcHRpb24pKSkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgIFwidmlld1wiOiBbXCJzeW5jU3RvcmVcIl1cbiAgfTsgfVxufTtcblxuZXhwb3J0IHsgQXJjZ2lzSXRlbUJyb3dzZXIgYXMgYXJjZ2lzX2l0ZW1fYnJvd3NlciwgQXJjZ2lzSXRlbUJyb3dzZXJBY3Rpb25zIGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfYWN0aW9ucywgQXJjZ2lzSXRlbUJyb3dzZXJCdWNrZXRTZWxlY3QgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9idWNrZXRfc2VsZWN0LCBBcmNnaXNJdGVtQnJvd3NlckNhcmQkMSBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2NhcmQsIEFyY2dpc0l0ZW1Ccm93c2VyQ2FyZCBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2NhcmRfc3VibGF5ZXJfc2VsZWN0LCBBcmNnaXNJdGVtQnJvd3NlckNhcmRUaHVtYm5haWwgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9jYXJkX3RodW1ibmFpbCwgQXJjZ2lzSXRlbUJyb3dzZXJDb250ZW50IGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfY29udGVudCwgQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJDYXRlZ29yeSBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2ZpbHRlcl9jYXRlZ29yaWVzLCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckNvbGxhYm9yYXRpb25zIGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfZmlsdGVyX2NvbGxhYm9yYXRpb25zLCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckNvbnRlbnRTdGF0dXMgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9maWx0ZXJfY29udGVudF9zdGF0dXMsIEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyRGF0ZSBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2ZpbHRlcl9kYXRlLCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckV4dGVudCBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2ZpbHRlcl9leHRlbnQsIEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyRm9sZGVyIGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfZmlsdGVyX2ZvbGRlciwgQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJHcm91cCBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2ZpbHRlcl9ncm91cCwgQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJJbmR1c3RyeSBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2ZpbHRlcl9pbmR1c3RyeSwgQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJJdGVtVHlwZSBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2ZpbHRlcl9pdGVtX3R5cGUsIEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyTG9jYXRpb24gYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9maWx0ZXJfbG9jYXRpb24sIEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyUmVnaW9uIGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfZmlsdGVyX3JlZ2lvbiwgQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJTaGFyaW5nIGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfZmlsdGVyX3NoYXJpbmcsIEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyVGFncyBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2ZpbHRlcl90YWdzLCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlcnMgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9maWx0ZXJzLCBBcmNnaXNJdGVtQnJvd3NlclBhZ2luYXRpb24gYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9wYWdpbmF0aW9uLCBBcmNnaXNJdGVtQnJvd3NlclByZXZpZXckMSBhcyBhcmNnaXNfaXRlbV9icm93c2VyX3ByZXZpZXcsIEFyY2dpc0l0ZW1Ccm93c2VyUHJldmlldyBhcyBhcmNnaXNfaXRlbV9icm93c2VyX3ByZXZpZXdfY29weSwgQXJjZ2lzSXRlbUJyb3dzZXJQcmV2aWV3RmllbGREZXRhaWxzIGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfcHJldmlld19maWVsZF9kZXRhaWxzLCBBcmNnaXNJdGVtQnJvd3NlclNlYXJjaCBhcyBhcmNnaXNfaXRlbV9icm93c2VyX3NlYXJjaCwgQXJjZ2lzSXRlbUJyb3dzZXJTb3J0JDEgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9zb3J0LCBBcmNnaXNJdGVtQnJvd3NlclRhYmxlJDEgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl90YWJsZSwgQXJjZ2lzSXRlbUJyb3dzZXJUYWJsZSBhcyBhcmNnaXNfaXRlbV9icm93c2VyX3RhYmxlX3JvdywgQXJjZ2lzSXRlbUJyb3dzZXJUb3BCYXIgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl90b3BfYmFyLCBBcmNnaXNJdGVtQnJvd3NlclNvcnQgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl92aWV3IH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGIgYXMgaXNQcmVtaXVtLCBhIGFzIGlzU3Vic2NyaWJlciwgbiBhcyBpc1B1YmxpY1VzZXIgfSBmcm9tICcuL3ByaXZpbGVnZXMtY2NkNWYzN2QuanMnO1xuaW1wb3J0IHsgciBhcyByZXRpcmVkSXRlbVR5cGVzIH0gZnJvbSAnLi9pdGVtLXR5cGVzLWI0ZmU4NmFkLmpzJztcbmltcG9ydCB7IGIgYXMgZmV0Y2hWZXJpZmllZCB9IGZyb20gJy4vdXNlci1iYTEyZWJkNi5qcyc7XG5cbmNvbnN0IHJldGlyZWRVcmxQYXJ0cyA9IFtcbiAgXCIzREluc2V0TWFwXCIsXG4gIFwiM0RTY2VuZVwiLFxuICBcIjNEVml6XCIsXG4gIFwiQXR0YWNobWVudFZpZXdlclwiLFxuICBcIkNhcGFjaXR5QW5hbHlzaXNcIixcbiAgXCJDb21wYXJlL3N0b3J5dGVsbGluZ19jb21wYXJlXCIsXG4gIFwiQ29tcGFyZS9zdG9yeXRlbGxpbmdfdGFiYmVkXCIsXG4gIFwiQ29tcGFyZS9zdG9yeXRlbGxpbmdfc2lkZXBhbmVsXCIsXG4gIFwiQ29tcGFyZS9NdWx0aXZpZXdlclwiLFxuICBcIkNvbXBhcmUvU2VhcmNoXCIsXG4gIFwiQ29tcGFyZS9Db25maWd1cmVcIixcbiAgXCJDb21wYXJlL1NpZGVCeVNpZGVWaWV3ZXJfQ29uZmlndXJlXCIsXG4gIFwiQ29tcGFyZTNkXCIsXG4gIFwiQ29tcGFyZUFuYWx5c2lzXCIsXG4gIFwiQ29tcGFyZU1hcHNcIixcbiAgXCJEaXJlY3Rpb25zXCIsXG4gIFwiRWRpdFwiLFxuICBcIkVkaXRvclwiLFxuICBcIkVsZXZhdGlvbnNcIixcbiAgXCJFbGV2YXRpb25zUHJvZmlsZVwiLFxuICBcIkVtYmVkXCIsXG4gIFwiRmlsdGVyXCIsXG4gIFwiRmlsdGVyR2FsbGVyeVwiLFxuICBcIkdlb0xpc3RcIixcbiAgXCJHZW9Ub3VyXCIsXG4gIFwiSGVhZGVyRm9vdGVyXCIsXG4gIFwiSWRlbnRpZnlcIixcbiAgXCJJbWFnZUludGVycHJldGF0aW9uXCIsXG4gIFwiSW1hZ2VyeVZpZXdlclwiLFxuICBcIkltcGFjdFN1bW1hcnlcIixcbiAgXCJJbmZvcm1hdGlvbkxvb2t1cFwiLFxuICBcIkludGVyYWN0aXZlRmlsdGVyXCIsXG4gIFwiSW50ZXJhY3RpdmVMZWdlbmRcIixcbiAgXCJMYXllclNob3djYXNlXCIsXG4gIFwiTGVnZW5kXCIsXG4gIFwiTGl2ZU1hcHNcIixcbiAgXCJMb2NhbFBlcnNwZWN0aXZlXCIsXG4gIFwiTWFwQW5kQXBwR2FsbGVyeVwiLFxuICBcIk1hcENhcm91c2VsXCIsXG4gIFwiTWFwVG9vbHNcIixcbiAgXCJNZWRpYVwiLFxuICBcIk1pbmltYWxHYWxsZXJ5XCIsXG4gIFwiTWluaW1hbGlzdFwiLFxuICBcIk5lYXJieVwiLFxuICBcIk9uZVBhbmVcIixcbiAgXCJQYW5lbHNcIixcbiAgXCJQYW5lbHNMZWdlbmRcIixcbiAgXCJQcm9maWxlXCIsXG4gIFwiUHVibGljR2FsbGVyeVwiLFxuICBcIlB1YmxpY0luZm9ybWF0aW9uXCIsXG4gIFwiU2VydmljZUxvb2t1cFwiLFxuICBcIlNpbXBsZU1hcFZpZXdlclwiLFxuICBcIlNpbXBsZVZpZXdlclwiLFxuICBcIlNvY2lhbE1lZGlhXCIsXG4gIFwiU29sdXRpb25zL3MyLmh0bWw/YXBwPWFwcHMyL0ZpbmRFZGl0RmlsdGVyXCIsXG4gIFwiU29sdXRpb25zL3MyLmh0bWw/YXBwPWFwcHMyL0ZpbmRlclwiLFxuICBcIlN0b3J5dGVsbGluZ1RleHRMZWdlbmRcIixcbiAgXCJTdG9yeU1hcEJhc2ljXCIsXG4gIFwiU3R5bGVyXCIsXG4gIFwiU3VtbWFyeVZpZXdlclwiLFxuICBcIlRpbWVcIixcbiAgXCJUaW1lQXdhcmVcIixcbiAgXCJUd29QYW5lXCIsXG4gIFwiVmlld2VyXCIsXG4gIFwiWm9uZUxvb2t1cFwiXG5dO1xuXG5mdW5jdGlvbiBpc1JldGlyZWRJdGVtVHlwZSh0eXBlKSB7XG4gIHJldHVybiByZXRpcmVkSXRlbVR5cGVzLmluY2x1ZGVzKHR5cGUpO1xufVxuZnVuY3Rpb24gaXNSZXRpcmVkU3RvcnlNYXAoaXRlbSkge1xuICB2YXIgX2EsIF9iO1xuICByZXR1cm4gKChfYSA9IGl0ZW0ucG9ydGFsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaXNQb3J0YWwpICYmIGl0ZW0udHlwZSA9PT0gXCJXZWIgTWFwcGluZyBBcHBsaWNhdGlvblwiICYmICgoX2IgPSBpdGVtLnR5cGVLZXl3b3JkcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmluY2x1ZGVzKFwiU3RvcnkgTWFwXCIpKTtcbn1cbmZ1bmN0aW9uIGlzQ2l0eUVuZ2luZVdlYlNjZW5lKGl0ZW0pIHtcbiAgcmV0dXJuIGl0ZW0udHlwZSA9PT0gXCJDaXR5RW5naW5lIFdlYiBTY2VuZVwiO1xufVxuZnVuY3Rpb24gaXNSZXRpcmVkQXBwKGl0ZW0pIHtcbiAgdmFyIF9hO1xuICBjb25zdCBpc1JldGlyZWRVcmwgPSByZXRpcmVkVXJsUGFydHMuc29tZSgodXJsUGFydCkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBjb250YWluc0h0bWwgPSB1cmxQYXJ0LmluY2x1ZGVzKFwiLmh0bWxcIik7XG4gICAgY29uc3QgZnVsbFJldGlyZWRQYXRoID0gYC9hcHBzLyR7dXJsUGFydH0keyFjb250YWluc0h0bWwgPyBcIi9cIiA6IFwiXCJ9YDtcbiAgICByZXR1cm4gKF9hID0gaXRlbS51cmwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhmdWxsUmV0aXJlZFBhdGgpO1xuICB9KTtcbiAgcmV0dXJuICgoX2EgPSBpdGVtLnBvcnRhbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzUG9ydGFsKSAmJiBpdGVtLnR5cGUgPT09IFwiV2ViIE1hcHBpbmcgQXBwbGljYXRpb25cIiAmJiBpdGVtLnVybCAmJiBpc1JldGlyZWRVcmw7XG59XG5mdW5jdGlvbiBpc09yZ0F1dGhvcml0YXRpdmUoaXRlbSkge1xuICByZXR1cm4gaXRlbS5jb250ZW50U3RhdHVzID09PSBcIm9yZ19hdXRob3JpdGF0aXZlXCI7XG59XG5mdW5jdGlvbiBpc1B1YmxpY0F1dGhvcml0YXRpdmUoaXRlbSkge1xuICByZXR1cm4gaXRlbS5jb250ZW50U3RhdHVzID09PSBcInB1YmxpY19hdXRob3JpdGF0aXZlXCI7XG59XG5mdW5jdGlvbiBnZXRCYWRnZXMoaXRlbSwgcG9ydGFsLCB1c2VyKSB7XG4gIHZhciBfYSwgX2IsIF9jO1xuICBjb25zdCBiYWRnZXMgPSBbXTtcbiAgY29uc3QgZ3JvdXBEZXNpZ25hdGlvbnMgPSBpdGVtLmdyb3VwRGVzaWduYXRpb25zICYmIGl0ZW0uZ3JvdXBEZXNpZ25hdGlvbnMuc3BsaXQoXCIsIFwiKTtcbiAgaWYgKGlzT3JnQXV0aG9yaXRhdGl2ZShpdGVtKSB8fCBpc1B1YmxpY0F1dGhvcml0YXRpdmUoaXRlbSkpIHtcbiAgICBiYWRnZXMucHVzaChcIkF1dGhvcml0YXRpdmVcIik7XG4gIH1cbiAgaWYgKGl0ZW0uY29udGVudFN0YXR1cyA9PT0gXCJkZXByZWNhdGVkXCIpIHtcbiAgICBiYWRnZXMucHVzaChcIkRlcHJlY2F0ZWRcIik7XG4gIH1cbiAgaWYgKGl0ZW0udHlwZSA9PT0gXCJTb2x1dGlvblwiICYmICgoX2EgPSBpdGVtLnR5cGVLZXl3b3JkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluY2x1ZGVzKFwiQXJjR0lTIFNvbHV0aW9uXCIpKSkge1xuICAgIGJhZGdlcy5wdXNoKFwiU29sdXRpb25cIik7XG4gIH1cbiAgaWYgKCgoX2IgPSBpdGVtLnR5cGVLZXl3b3JkcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmluY2x1ZGVzKFwiUHVibGljIERhdGEgQ29sbGVjdGlvblwiKSkgJiYgdXNlcikge1xuICAgIGJhZGdlcy5wdXNoKFwiUHVibGljIERhdGEgQ29sbGVjdGlvblwiKTtcbiAgfVxuICBpZiAoaXNSZXRpcmVkSXRlbVR5cGUoaXRlbS50eXBlKSB8fCBpc1JldGlyZWRTdG9yeU1hcChpdGVtKSB8fCBpc1JldGlyZWRBcHAoaXRlbSkpIHtcbiAgICBiYWRnZXMucHVzaChcIlJldGlyZWRcIik7XG4gIH1cbiAgaWYgKGdyb3VwRGVzaWduYXRpb25zID09PSBudWxsIHx8IGdyb3VwRGVzaWduYXRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBncm91cERlc2lnbmF0aW9ucy5pbmNsdWRlcyhcImxpdmluZ2F0bGFzXCIpKSB7XG4gICAgYmFkZ2VzLnB1c2goXCJMaXZpbmcgQXRsYXNcIik7XG4gIH1cbiAgaWYgKGdyb3VwRGVzaWduYXRpb25zICYmIGdyb3VwRGVzaWduYXRpb25zLmluY2x1ZGVzKFwib3BlbmRhdGFcIikpIHtcbiAgICBiYWRnZXMucHVzaChcIk9wZW4gRGF0YVwiKTtcbiAgfVxuICBpZiAoaXNQcmVtaXVtKGl0ZW0pKSB7XG4gICAgYmFkZ2VzLnB1c2goXCJQcmVtaXVtXCIpO1xuICB9XG4gIGlmIChpc1N1YnNjcmliZXIoaXRlbSkpIHtcbiAgICBiYWRnZXMucHVzaChcIlN1YnNjcmliZXJcIik7XG4gIH1cbiAgaWYgKGl0ZW0ub3JpZ2luKSB7XG4gICAgYmFkZ2VzLnB1c2goXCJDb2xsYWJvcmF0aW9uXCIpO1xuICB9XG4gIGlmIChpdGVtLmxpc3RlZCAmJiAhKHBvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC5pc1BvcnRhbCkpIHtcbiAgICBiYWRnZXMucHVzaChcIk1hcmtldHBsYWNlXCIpO1xuICB9XG4gIGlmICgoKF9jID0gaXRlbS50eXBlS2V5d29yZHMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5pbmNsdWRlcyhcIlJlZ2lzdGVyZWQgQXBwXCIpKSAmJlxuICAgIGl0ZW0udHlwZSAhPT0gXCJBUEkgS2V5XCIgJiZcbiAgICAoIShwb3J0YWwgPT09IG51bGwgfHwgcG9ydGFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3J0YWwuaXNQb3J0YWwpIHx8IGl0ZW0ub3duZXIgIT09IFwiZXNyaV9hcHBzXCIpKSB7XG4gICAgYmFkZ2VzLnB1c2goXCJSZWdpc3RlcmVkXCIpO1xuICB9XG4gIHJldHVybiBiYWRnZXM7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRUb29sdGlwKGJhZGdlVHlwZSwgaXRlbSwgdXNlciwgaTE4biwgbG9jYWxlKSB7XG4gIHZhciBfYSwgX2I7XG4gIGNvbnN0IHB1YmxpY1VzZXIgPSAhdXNlciB8fCBpc1B1YmxpY1VzZXIodXNlcik7XG4gIHN3aXRjaCAoYmFkZ2VUeXBlKSB7XG4gICAgY2FzZSBcIkF1dGhvcml0YXRpdmVcIjpcbiAgICAgIGlmIChpdGVtLmNvbnRlbnRTdGF0dXMgPT09IFwicHVibGljX2F1dGhvcml0YXRpdmVcIikge1xuICAgICAgICBjb25zdCB2ZXJpZmllZCA9IGF3YWl0IGZldGNoVmVyaWZpZWQoaXRlbSwgbG9jYWxlKTtcbiAgICAgICAgY29uc3QgbmFtZSA9ICgoX2EgPSBpdGVtLnBvcnRhbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzUG9ydGFsKSA/IChfYiA9IGl0ZW0ucG9ydGFsKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubmFtZSA6IHZlcmlmaWVkID09PSBudWxsIHx8IHZlcmlmaWVkID09PSB2b2lkIDAgPyB2b2lkIDAgOiB2ZXJpZmllZC5uYW1lO1xuICAgICAgICByZXR1cm4gaTE4bi5BdXRob3JpdGF0aXZlLnRvb2x0aXAucHVibGljLnJlcGxhY2UoXCIke25hbWV9XCIsIG5hbWUpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBpMThuLkF1dGhvcml0YXRpdmUudG9vbHRpcC5vcmc7XG4gICAgICB9XG4gICAgY2FzZSBcIlJldGlyZWRcIjpcbiAgICAgIGNvbnN0IHJldGlyZWQgPSBpMThuLlJldGlyZWQudG9vbHRpcDtcbiAgICAgIGlmIChpc1JldGlyZWRTdG9yeU1hcChpdGVtKSkge1xuICAgICAgICByZXR1cm4gcmV0aXJlZC5zdG9yeU1hcDtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGlzQ2l0eUVuZ2luZVdlYlNjZW5lKGl0ZW0pKSB7XG4gICAgICAgIHJldHVybiByZXRpcmVkLmNpdHlFbmdpbmU7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChpc1JldGlyZWRBcHAoaXRlbSkpIHtcbiAgICAgICAgcmV0dXJuIHJldGlyZWQuYXBwO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHJldHVybiByZXRpcmVkLmdlbmVyYWw7XG4gICAgICB9XG4gICAgY2FzZSBcIlN1YnNjcmliZXJcIjpcbiAgICAgIHJldHVybiBwdWJsaWNVc2VyID8gaTE4bi5TdWJzY3JpYmVyLnRvb2x0aXAucHVibGljIDogaTE4bi5TdWJzY3JpYmVyLnRvb2x0aXAub3JnO1xuICAgIGNhc2UgXCJQcmVtaXVtXCI6XG4gICAgICByZXR1cm4gcHVibGljVXNlciA/IGkxOG4uUHJlbWl1bS50b29sdGlwLnB1YmxpYyA6IGkxOG4uUHJlbWl1bS50b29sdGlwLm9yZztcbiAgICBjYXNlIFwiUmVnaXN0ZXJlZFwiOlxuICAgICAgcmV0dXJuIGkxOG4uUmVnaXN0ZXJlZC50b29sdGlwO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gaTE4bltiYWRnZVR5cGVdLnRvb2x0aXA7XG4gIH1cbn1cblxuZXhwb3J0IHsgZ2V0VG9vbHRpcCBhcyBhLCBnZXRCYWRnZXMgYXMgZyB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjMuMC45OVxuICovXG5pbXBvcnQgeyBmIGFzIGZyb21DYWNoZSwgciBhcyByZXF1ZXN0LCBnIGFzIGdldFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9wb3J0YWwtNzljYWFlZmYuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLWViNWY3ZGMyLmpzJztcbmltcG9ydCB7IG4gYXMgaXNQdWJsaWNVc2VyIH0gZnJvbSAnLi9wcml2aWxlZ2VzLWNjZDVmMzdkLmpzJztcblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hDYXRlZ29yaWVzKHBvcnRhbCwgdXNlcikge1xuICBwb3J0YWwgIT09IG51bGwgJiYgcG9ydGFsICE9PSB2b2lkIDAgPyBwb3J0YWwgOiAocG9ydGFsID0gY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgdXNlciAhPT0gbnVsbCAmJiB1c2VyICE9PSB2b2lkIDAgPyB1c2VyIDogKHVzZXIgPSBjb25maWdTdGF0ZS51c2VyKTtcbiAgaWYgKCEocG9ydGFsID09PSBudWxsIHx8IHBvcnRhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9ydGFsLmlkKSB8fCAodXNlciAmJiBpc1B1YmxpY1VzZXIodXNlcikpKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgcmV0dXJuIGZyb21DYWNoZSgoKSA9PiByZXF1ZXN0KGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9cG9ydGFscy8ke3BvcnRhbC5pZH0vY2F0ZWdvcnlTY2hlbWFgKSwgXCJjYXRlZ29yeVNjaGVtYVwiLCBwb3J0YWwuaWQpO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hHcm91cENhdGVnb3JpZXMoZ3JvdXBJZCwgcG9ydGFsKSB7XG4gIHBvcnRhbCAhPT0gbnVsbCAmJiBwb3J0YWwgIT09IHZvaWQgMCA/IHBvcnRhbCA6IChwb3J0YWwgPSBjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgaWYgKCFncm91cElkIHx8ICFwb3J0YWwpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICByZXR1cm4gZnJvbUNhY2hlKCgpID0+IHJlcXVlc3QoYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX1jb21tdW5pdHkvZ3JvdXBzLyR7Z3JvdXBJZH0vY2F0ZWdvcnlTY2hlbWFgKSwgXCJjYXRlZ29yeVNjaGVtYVwiLCBncm91cElkKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoTGl2aW5nQXRsYXNTY2hlbWEocG9ydGFsKSB7XG4gIHZhciBfYTtcbiAgY29uc3QgYmFzZSA9IGdldFJlc3RCYXNlVXJsKHBvcnRhbCk7XG4gIGNvbnN0IHNlbGYgPSBhd2FpdCByZXF1ZXN0KGAke2Jhc2V9cG9ydGFscy9zZWxmYCk7XG4gIGNvbnN0IGdyb3VwU2VhcmNoID0gYXdhaXQgcmVxdWVzdChgJHtiYXNlfWNvbW11bml0eS9ncm91cHM/cT0ke3NlbGYuY29udGVudENhdGVnb3J5U2V0c0dyb3VwUXVlcnl9YCk7XG4gIGNvbnN0IGNhdGVnb3J5R3JvdXAgPSAoX2EgPSBncm91cFNlYXJjaCA9PT0gbnVsbCB8fCBncm91cFNlYXJjaCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3JvdXBTZWFyY2gucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdO1xuICBjb25zdCBzY2hlbWFJdGVtU2VhcmNoID0gYXdhaXQgcmVxdWVzdChgJHtiYXNlfWNvbnRlbnQvZ3JvdXBzLyR7Y2F0ZWdvcnlHcm91cC5pZH0vc2VhcmNoYCwge1xuICAgIHE6IFwidHlwZWtleXdvcmRzOiBMaXZpbmdBdGxhc1wiXG4gIH0pO1xuICBjb25zdCBzY2hlbWFJdGVtID0gc2NoZW1hSXRlbVNlYXJjaC5yZXN1bHRzWzBdO1xuICByZXR1cm4gcmVxdWVzdChgJHtiYXNlfWNvbnRlbnQvaXRlbXMvJHtzY2hlbWFJdGVtLmlkfS9kYXRhYCk7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaExpdmluZ0F0bGFzQ2F0ZWdvcmllcyhwb3J0YWwpIHtcbiAgcmV0dXJuIGZyb21DYWNoZSgoKSA9PiBmZXRjaExpdmluZ0F0bGFzU2NoZW1hKHBvcnRhbCksIFwiY2F0ZWdvcnlTY2hlbWFcIiwgXCJsaXZpbmctYXRsYXNcIik7XG59XG5cbmV4cG9ydCB7IGZldGNoTGl2aW5nQXRsYXNDYXRlZ29yaWVzIGFzIGEsIGZldGNoR3JvdXBDYXRlZ29yaWVzIGFzIGIsIGZldGNoQ2F0ZWdvcmllcyBhcyBmIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGEgYXMgYWRkQ3JlYXRlSXRlbVR5cGVzIH0gZnJvbSAnLi9pdGVtLXR5cGVzLWI0ZmU4NmFkLmpzJztcbmltcG9ydCB7IGcgYXMgZ3VpZCB9IGZyb20gJy4vZ3VpZC00ZjQxNzZiYS5qcyc7XG5cbmZ1bmN0aW9uIHNhbml0aXplRmlsZU5hbWUobmFtZSwgYWRkR1VJRCkge1xuICAvL1RPRE86IGFkZCBuZXcgcGFyYW0gdG8gc3BlYyBmaWxlLlxuICBjb25zdCBleHByZXNzaW9uID0gLyg/OlxcLihbXi5dKykpPyQvO1xuICBjb25zdCBpbnZhbGlkVGl0bGVDaGFyYWN0ZXJzID0gL1xcLnwtL2c7XG4gIGxldCBmaWxlTmFtZSA9IG5hbWUucmVwbGFjZSgvXi4qKFxcXFx8XFwvfDopLywgXCJcIik7XG4gIGxldCBleHRlbnNpb24gPSAoZmlsZU5hbWUgJiYgZXhwcmVzc2lvbi5leGVjKGZpbGVOYW1lKVsxXSA/IGV4cHJlc3Npb24uZXhlYyhmaWxlTmFtZSlbMV0udG9Mb3dlckNhc2UoKSA6IFwiXCIpO1xuICBsZXQgdGl0bGUgPSBcIlwiO1xuICBpZiAoZmlsZU5hbWUuaW5kZXhPZihcIi5yZnQuXCIpID4gLTEpIHtcbiAgICBjb25zdCBbbmFtZSwgc3VmZml4XSA9IGZpbGVOYW1lLnNwbGl0KFwiLnJmdC5cIik7XG4gICAgZXh0ZW5zaW9uID0gYHJmdC4ke3N1ZmZpeH1gO1xuICAgIHRpdGxlID0gbmFtZTtcbiAgfVxuICBpZiAoZmlsZU5hbWUgJiYgIXRpdGxlKSB7XG4gICAgdGl0bGUgPSBmaWxlTmFtZS5sYXN0SW5kZXhPZihcIi5cIikgPT09IC0xID8gZmlsZU5hbWUgOiBmaWxlTmFtZS5zdWJzdHJpbmcoMCwgZmlsZU5hbWUubGFzdEluZGV4T2YoXCIuXCIpKTtcbiAgfVxuICAvLyBSZXBsYWNlIGFueSBpbnZhbGlkIGNoYXJhY3RlcnMgd2l0aCBhbiB1bmRlcnNjb3JlXG4gIHRpdGxlID0gdGl0bGUucmVwbGFjZShpbnZhbGlkVGl0bGVDaGFyYWN0ZXJzLCBcIl9cIik7XG4gIC8vIEFsbG93IGZpbGUgdXBsb2FkIG9mIGV4aXN0aW5nIGl0ZW0ncyBmaWxlIG5hbWUgLy8gY3VycmVudGx5IHVzZWQgaW4gYXBwZW5kXG4gIGlmIChhZGRHVUlEKSB7XG4gICAgdGl0bGUgPSBtYWtlVW5pcXVlRmlsZU5hbWUodGl0bGUpO1xuICAgIGZpbGVOYW1lID0gYCR7dGl0bGV9LiR7ZXh0ZW5zaW9ufWA7XG4gIH1cbiAgcmV0dXJuIHsgdGl0bGUsIGZpbGVOYW1lLCBleHRlbnNpb24gfTtcbn1cbi8vIEhlbHBlciBtZXRob2QgdGhhdCB0YWtlcyBpbiBhIGZpbGUgJiByZXR1cm5zIHRoZSBjbGVhbmVkIHVwIGZpbGUgbmFtZSBhcyBpcyBhbmQgaW4gdGl0bGUgZm9ybSwgYW5kIHRoZSBkZXRlY3RlZCBmaWxlIGV4dGVuc2lvblxuZnVuY3Rpb24gc2FuaXRpemVGaWxlSW5wdXQoZmlsZSwgYWRkR1VJRCkge1xuICByZXR1cm4gc2FuaXRpemVGaWxlTmFtZShmaWxlLm5hbWUsICEhYWRkR1VJRCk7XG59XG5mdW5jdGlvbiBtYWtlVW5pcXVlRmlsZU5hbWUobmFtZSkge1xuICByZXR1cm4gYCR7bmFtZX1fJHtndWlkKCl9YDtcbn1cbmZ1bmN0aW9uIHZhbGlkYXRlT3ZlcndyaXRlRmlsZU5hbWUodXBsb2FkZWRGaWxlTmFtZSwgc291cmNlRmlsZU5hbWUpIHtcbiAgbGV0IGZpbGVOYW1lID0gdXBsb2FkZWRGaWxlTmFtZTtcbiAgY29uc3QgcG9zaXRpb24gPSB1cGxvYWRlZEZpbGVOYW1lLmxhc3RJbmRleE9mKFwiXFxcXFwiKTtcbiAgaWYgKHBvc2l0aW9uID4gLTEpIHtcbiAgICBmaWxlTmFtZSA9IGZpbGVOYW1lLnN1YnN0cmluZyhwb3NpdGlvbiArIDEsIGZpbGVOYW1lLmxlbmd0aCk7XG4gIH1cbiAgcmV0dXJuIGZpbGVOYW1lLnJlcGxhY2UoL1xcIC9nLCBcIl9cIikgPT09IHNvdXJjZUZpbGVOYW1lLnJlcGxhY2UoL1xcIC9nLCBcIl9cIik7XG59XG5mdW5jdGlvbiBnZXRJdGVtSW5mb0J5VHlwZSh0eXBlKSB7XG4gIGlmIChhZGRDcmVhdGVJdGVtVHlwZXNbdHlwZV0pIHtcbiAgICByZXR1cm4gYWRkQ3JlYXRlSXRlbVR5cGVzW3R5cGVdO1xuICB9XG4gIGVsc2Uge1xuICAgIHJldHVybiBhZGRDcmVhdGVJdGVtVHlwZXNbT2JqZWN0LmtleXMoYWRkQ3JlYXRlSXRlbVR5cGVzKS5maW5kKChmaWxlVHlwZSkgPT4gYWRkQ3JlYXRlSXRlbVR5cGVzW2ZpbGVUeXBlXS50eXBlID09PSB0eXBlKV07XG4gIH1cbn1cbmZ1bmN0aW9uIGZvcm1hdEZpbGVTaXplKHNpemUpIHtcbiAgaWYgKCFzaXplKSB7XG4gICAgcmV0dXJuIFwiMCBCXCI7XG4gIH1cbiAgY29uc3QgaSA9IE1hdGguZmxvb3IoTWF0aC5sb2coc2l6ZSkgLyBNYXRoLmxvZygxMDI0KSk7XG4gIGNvbnN0IGFkanVzdGVkU2l6ZSA9IE1hdGgucm91bmQoc2l6ZSAvIE1hdGgucG93KDEwMjQsIGkpKTtcbiAgY29uc3QgdW5pdCA9IFtcIkJcIiwgXCJLQlwiLCBcIk1CXCIsIFwiR0JcIiwgXCJUQlwiXVtpXTtcbiAgcmV0dXJuIGAke2FkanVzdGVkU2l6ZX0gJHt1bml0fWA7XG59XG5cbmV4cG9ydCB7IHNhbml0aXplRmlsZU5hbWUgYXMgYSwgZm9ybWF0RmlsZVNpemUgYXMgZiwgZ2V0SXRlbUluZm9CeVR5cGUgYXMgZywgc2FuaXRpemVGaWxlSW5wdXQgYXMgcywgdmFsaWRhdGVPdmVyd3JpdGVGaWxlTmFtZSBhcyB2IH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlSWQoY291bnRzKSB7XG4gIHJldHVybiBjb3VudHNcbiAgICAubWFwKChjb3VudCkgPT4ge1xuICAgIGxldCBvdXQgPSBcIlwiO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgb3V0ICs9ICgoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApIHwgMCkudG9TdHJpbmcoMTYpLnN1YnN0cmluZygxKTtcbiAgICB9XG4gICAgcmV0dXJuIG91dDtcbiAgfSlcbiAgICAuam9pbihcIi1cIik7XG59XG5jb25zdCBndWlkID0gKCkgPT4gZ2VuZXJhdGVJZChbMiwgMSwgMSwgMSwgM10pO1xuXG5leHBvcnQgeyBndWlkIGFzIGcgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgciBhcyByZXF1ZXN0LCBoIGFzIGdldFRva2VuLCBnIGFzIGdldFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9wb3J0YWwtNzljYWFlZmYuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLWViNWY3ZGMyLmpzJztcbmltcG9ydCB7IGEgYXMgaXNIb3N0ZWRTZXJ2aWNlIH0gZnJvbSAnLi91cmwtZjNiODJjYzcuanMnO1xuXG5mdW5jdGlvbiBwYXJzZVN1YmxheWVyKHN1YmxheWVyLCBsYXllcnMsIGlzVGFibGUpIHtcbiAgdmFyIF9hLCBfYjtcbiAgcmV0dXJuIHtcbiAgICBkZXNjcmlwdGlvbjogc3VibGF5ZXIuZGVzY3JpcHRpb24sXG4gICAgZmllbGRBbGlhc2VzOiAoX2EgPSBzdWJsYXllci5maWVsZHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tYXAoKGZpZWxkKSA9PiBmaWVsZC5hbGlhcyksXG4gICAgZmllbGRzOiBzdWJsYXllci5maWVsZHMsXG4gICAgZ2VvbWV0cnlUeXBlOiBpc1RhYmxlID8gXCJ0YWJsZVwiIDogc3VibGF5ZXIuZ2VvbWV0cnlUeXBlLFxuICAgIGlkOiBzdWJsYXllci5pZCxcbiAgICB0aXRsZTogc3VibGF5ZXIubmFtZSxcbiAgICB0eXBlOiBzdWJsYXllci50eXBlLFxuICAgIG1hdGNoZWQ6IChfYiA9IGxheWVycyA9PT0gbnVsbCB8fCBsYXllcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxheWVycy5maW5kKChsYXllcikgPT4gbGF5ZXIuaWQgPT09IHN1YmxheWVyLmlkKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm1hdGNoZWRcbiAgfTtcbn1cbmZ1bmN0aW9uIHNlcnZlclJlcXVlc3QodXJsLCBpc1NlY3VyZSkge1xuICBjb25zdCB7IGNvbmZpZyB9ID0gY29uZmlnU3RhdGU7XG4gIGNvbnN0IGhvc3RlZCA9IGlzSG9zdGVkU2VydmljZSh1cmwpO1xuICBjb25zdCByZXF1ZXN0T3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7IHVzZVByb3h5OiBmYWxzZSwgdGltZW91dDogY29uZmlnLmlzTXVsdGlUZW5hbnQgPT09IGZhbHNlID8gNjAwMDAgOiA1MDAwLCBhZGRTU0w6IGhvc3RlZCB9LCAoaXNTZWN1cmUgPyB7fSA6IHsgYWRkVG9rZW5NYW51YWxseTogZmFsc2UgfSkpLCB7IHVzZVBvc3Q6IHRydWUsIGRpc2FibGVJZGVudGl0eUxvb2t1cDogdHJ1ZSB9KTtcbiAgcmV0dXJuIHJlcXVlc3QodXJsLCB7fSwgcmVxdWVzdE9wdGlvbnMsIFwicG9zdFwiKTtcbn1cbmZ1bmN0aW9uIGdldEVycm9yQ29kZShlcnJvcikge1xuICB2YXIgX2EsIF9iO1xuICByZXR1cm4gKGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5jb2RlKSB8fCAoKF9iID0gKF9hID0gZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmRldGFpbHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yYXcpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jb2RlKTtcbn1cbmZ1bmN0aW9uIHNlcnZpY2VEb2VzTm90RXhpc3QoZXJyb3IpIHtcbiAgY29uc3QgY29kZSA9IGdldEVycm9yQ29kZShlcnJvcik7XG4gIHJldHVybiBbNDA0LCA1MDBdLmluY2x1ZGVzKGNvZGUpIHx8IChlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IubWVzc2FnZSkgPT09IFwiSW52YWxpZCBVUkxcIjtcbn1cbmZ1bmN0aW9uIHNob3VsZFJldHJ5V2l0aFRva2VuKGlzU2VjdXJlLCBlcnJvcikge1xuICBjb25zdCBjb2RlID0gZ2V0RXJyb3JDb2RlKGVycm9yKTtcbiAgcmV0dXJuICFpc1NlY3VyZSAmJiAoKGNvZGUgPT09IDQ5OSAmJiAoZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLm1lc3NhZ2UpID09PSBcIlRva2VuIFJlcXVpcmVkXCIpIHx8IGNvZGUgPT09IDQwMykgJiYgISFjb25maWdTdGF0ZS51c2VyO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hMYXllcihwb3J0YWwsIGlkLCB1cmwsIGlzU2VjdXJlKSB7XG4gIGNvbnN0IGVycm9yUmVzdWx0ID0geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICB0cnkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2ZXJSZXF1ZXN0KGAke3VybH0vJHtpZH1gLCBpc1NlY3VyZSk7XG4gICAgICByZXR1cm4geyByZXN1bHQgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoc2hvdWxkUmV0cnlXaXRoVG9rZW4oaXNTZWN1cmUsIGVycm9yKSkge1xuICAgICAgICByZXR1cm4gZmV0Y2hMYXllcihwb3J0YWwsIGlkLCB1cmwsIHRydWUpO1xuICAgICAgfVxuICAgICAgaWYgKHNlcnZpY2VEb2VzTm90RXhpc3QoZXJyb3IpKSB7XG4gICAgICAgIGVycm9yUmVzdWx0LmVycm9yLmNvZGUgPSBcInNlcnZpY2VOb3RFeGlzdFwiO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGVycm9yUmVzdWx0O1xuICAgIH1cbiAgfVxuICBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gZXJyb3JSZXN1bHQ7XG4gIH1cbn1cbmZ1bmN0aW9uIGZpbHRlckxheWVycyhsYXllcnMsIG1hdGNoZWRMYXllcnMsIGRhdGEsIGlzVGFibGUpIHtcbiAgdmFyIF9hLCBfYjtcbiAgY29uc3QgaGFzVGFibGVzID0gZGF0YSA9PT0gbnVsbCB8fCBkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhLnRhYmxlcztcbiAgY29uc3QgaGFzRGVmaW5lZERhdGFMYXllcnMgPSAoKF9hID0gZGF0YSA9PT0gbnVsbCB8fCBkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhLmxheWVycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgPiAwIHx8IGhhc1RhYmxlcztcbiAgY29uc3QgaWRzID0gWy4uLigoZGF0YSA9PT0gbnVsbCB8fCBkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhLmxheWVycykgfHwgW10pLm1hcCgobGF5ZXIpID0+IGxheWVyLmlkKSwgLi4uKF9iID0gKChkYXRhID09PSBudWxsIHx8IGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGEudGFibGVzKSB8fCBbXSkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5tYXAoKHRhYmxlKSA9PiB0YWJsZS5pZCldO1xuICAvLyBpZiBkYXRhIGhhcyBkZWZpbmVkIGxheWVycywgb25seSB1c2UgbGF5ZXJzIGluIGRhdGEsIG5vdCB0aGUgd2hvbGUgc2VydmljZSAoV2ViR0lTL2FyY2dpcy1wb3J0YWwtYXBwIzM5NzY4KVxuICAvLyBpZiBkYXRhIGhhcyBkZWZpbmVkIGxheWVycywgYnV0IG5vIGRlZmluZWQgdGFibGVzLCBhbGxvdyBhbGwgdGFibGVzIHRocm91Z2ggKFdlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcCM0MDA2NylcbiAgY29uc3Qgc3VibGF5ZXJzID0gKGxheWVycyB8fCBbXSlcbiAgICAuZmlsdGVyKCh7IGlkLCB0eXBlIH0pID0+ICFoYXNEZWZpbmVkRGF0YUxheWVycyB8fCAodHlwZSA9PT0gXCJUYWJsZVwiICYmICFoYXNUYWJsZXMpIHx8IGlkcy5pbmNsdWRlcyhpZCkpXG4gICAgLm1hcCgobGF5ZXIpID0+IHBhcnNlU3VibGF5ZXIobGF5ZXIsIG1hdGNoZWRMYXllcnMsIGlzVGFibGUpKTtcbiAgcmV0dXJuIHN1YmxheWVycztcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoTGF5ZXJzKHsgc2VydmljZUluZm8sIGl0ZW0sIGxheWVycywgaXNTZWN1cmUsIGRhdGEgfSkge1xuICB2YXIgX2EsIF9iO1xuICBjb25zdCB7IHVybCB9ID0gaXRlbTtcbiAgaWYgKCEoKF9hID0gc2VydmljZUluZm8ubGF5ZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSAmJiAhKChfYiA9IHNlcnZpY2VJbmZvLnRhYmxlcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmxlbmd0aCkgJiYgKHNlcnZpY2VJbmZvID09PSBudWxsIHx8IHNlcnZpY2VJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXJ2aWNlSW5mby5maWVsZHMpKSB7XG4gICAgcmV0dXJuIHsgcmVzdWx0OiBbcGFyc2VTdWJsYXllcihzZXJ2aWNlSW5mbywgbGF5ZXJzKV0gfTtcbiAgfVxuICB0cnkge1xuICAgIGNvbnN0IHsgbGF5ZXJzOiBzdWJsYXllcnMsIHRhYmxlcyB9ID0gYXdhaXQgc2VydmVyUmVxdWVzdChgJHt1cmx9L2xheWVyc2AsIGlzU2VjdXJlKTtcbiAgICByZXR1cm4ge1xuICAgICAgcmVzdWx0OiBbLi4uZmlsdGVyTGF5ZXJzKHN1YmxheWVycywgbGF5ZXJzLCBkYXRhKSwgLi4uZmlsdGVyTGF5ZXJzKHRhYmxlcywgbGF5ZXJzLCBkYXRhLCB0cnVlKV0uc29ydCgoYSwgYikgPT4gYS5pZCAtIGIuaWQpXG4gICAgfTtcbiAgfVxuICBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICB9XG59XG5mdW5jdGlvbiBzZXRNYXRjaGVkKHN1YmxheWVycywgbWF0Y2hlZExheWVycykge1xuICByZXR1cm4gc3VibGF5ZXJzLm1hcCgoc3VibGF5ZXIpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgc3VibGF5ZXIpLCB7IG1hdGNoZWQ6IChfYSA9IG1hdGNoZWRMYXllcnMgPT09IG51bGwgfHwgbWF0Y2hlZExheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWF0Y2hlZExheWVycy5maW5kKChsYXllcikgPT4gbGF5ZXIuaWQgPT09IHN1YmxheWVyLmlkKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1hdGNoZWQgfSk7XG4gIH0pO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hGZWF0dXJlU2VydmljZUluZm8oeyBpdGVtLCBwb3J0YWwsIGxheWVycywgaXNTZWN1cmUsIGRhdGEsIHJldHJ5IH0pIHtcbiAgdmFyIF9hO1xuICBjb25zdCBlcnJvclJlc3VsdCA9IHsgZXJyb3I6IHsgY29kZTogXCJ1bmhhbmRsZWRFcnJvclwiIH0gfTtcbiAgdHJ5IHtcbiAgICBpZiAoIWRhdGEgJiYgIXJldHJ5KSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB0b2tlbiA9IGdldFRva2VuKHBvcnRhbCk7XG4gICAgICAgIGNvbnN0IHRva2VuUGFyYW0gPSB0b2tlbiA/IGAmdG9rZW49JHt0b2tlbn1gIDogXCJcIjtcbiAgICAgICAgY29uc3QgdXJsID0gYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX1jb250ZW50L2l0ZW1zLyR7aXRlbS5pZH0vZGF0YT9mPWpzb24ke3Rva2VuUGFyYW19YDtcbiAgICAgICAgLy8gVXNlIGZldGNoIGluc3RlYWQgb2YgcmVxdWVzdCB0byBzdG9wIHJlZGlyZWN0cyAoV2ViR0lTL2FyY2dpcy1wb3J0YWwtYXBwIzQwMTY0KVxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCk7XG4gICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4gICAgICAgIGlmICh0ZXh0KSB7XG4gICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UodGV4dCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEgPT09IG51bGwgfHwgZGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YS5lcnJvcikge1xuICAgICAgICAgIC8vIFRyZWF0IHRoaXMgZXhwaXJlZCBhY2NvdW50IGFzIGlmIHRoZSBzZXJ2aWNlIGRvZXNuJ3QgZXhpc3QgKFdlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcCM0MDE2MylcbiAgICAgICAgICBpZiAoZGF0YS5lcnJvci5jb2RlID09PSA0MDMgJiYgKChfYSA9IGRhdGEuZXJyb3IpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tZXNzYWdlQ29kZSkgPT09IFwiU0JfMDAwNlwiKSB7XG4gICAgICAgICAgICBlcnJvclJlc3VsdC5lcnJvci5jb2RlID0gXCJzZXJ2aWNlTm90RXhpc3RcIjtcbiAgICAgICAgICAgIHJldHVybiBlcnJvclJlc3VsdDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBpZiB3ZSBjYW4ndCBnZXQgaXRlbSBkYXRhLCBqdXN0IG1vdmUgb25cbiAgICAgICAgZGF0YSA9IG51bGw7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChpdGVtLnR5cGUgPT09IFwiRmVhdHVyZSBDb2xsZWN0aW9uXCIpIHtcbiAgICAgIGlmIChkYXRhID09PSBudWxsIHx8IGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGEubGF5ZXJzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcmVzdWx0OiBkYXRhLmxheWVycy5tYXAoKHsgbGF5ZXJEZWZpbml0aW9uIH0sIGlkKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICByZXR1cm4gKHtcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiXCIsXG4gICAgICAgICAgICAgIGZpZWxkczogbGF5ZXJEZWZpbml0aW9uLmZpZWxkcyxcbiAgICAgICAgICAgICAgZmllbGRBbGlhc2VzOiAoX2EgPSBsYXllckRlZmluaXRpb24uZmllbGRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWFwKChmaWVsZCkgPT4gZmllbGQuYWxpYXMpLFxuICAgICAgICAgICAgICBnZW9tZXRyeVR5cGU6IGxheWVyRGVmaW5pdGlvbi5nZW9tZXRyeVR5cGUsXG4gICAgICAgICAgICAgIHR5cGU6IGxheWVyRGVmaW5pdGlvbi50eXBlLFxuICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgICAgbWF0Y2hlZDogZmFsc2UsXG4gICAgICAgICAgICAgIHRpdGxlOiBsYXllckRlZmluaXRpb24ubmFtZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSlcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgdXJsIH0gPSBpdGVtO1xuICAgICAgY29uc3Qgc2VydmljZUluZm8gPSBhd2FpdCBzZXJ2ZXJSZXF1ZXN0KHVybCwgaXNTZWN1cmUpO1xuICAgICAgcmV0dXJuIGZldGNoTGF5ZXJzKHtcbiAgICAgICAgc2VydmljZUluZm8sXG4gICAgICAgIGl0ZW0sXG4gICAgICAgIGxheWVycyxcbiAgICAgICAgaXNTZWN1cmUsXG4gICAgICAgIGRhdGFcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChzaG91bGRSZXRyeVdpdGhUb2tlbihpc1NlY3VyZSwgZXJyb3IpKSB7XG4gICAgICAgIHJldHVybiBmZXRjaEZlYXR1cmVTZXJ2aWNlSW5mbyh7IGl0ZW0sIHBvcnRhbCwgbGF5ZXJzLCBkYXRhLCBpc1NlY3VyZTogdHJ1ZSB9KTtcbiAgICAgIH1cbiAgICAgIGlmIChzZXJ2aWNlRG9lc05vdEV4aXN0KGVycm9yKSkge1xuICAgICAgICBlcnJvclJlc3VsdC5lcnJvci5jb2RlID0gXCJzZXJ2aWNlTm90RXhpc3RcIjtcbiAgICAgIH1cbiAgICAgIHJldHVybiBlcnJvclJlc3VsdDtcbiAgICB9XG4gIH1cbiAgY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIGVycm9yUmVzdWx0O1xuICB9XG59XG5cbmV4cG9ydCB7IGZldGNoTGF5ZXIgYXMgYSwgZmV0Y2hGZWF0dXJlU2VydmljZUluZm8gYXMgZiwgc2V0TWF0Y2hlZCBhcyBzIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IGEgYXMgZ2V0QXNzZXRQYXRoIH0gZnJvbSAnLi9pbmRleC05MmViYjM5Ni5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldFJlc3RCYXNlVXJsLCBoIGFzIGdldFRva2VuIH0gZnJvbSAnLi9wb3J0YWwtNzljYWFlZmYuanMnO1xuaW1wb3J0IHsgaSBhcyBpc1BvcnRhbFZpZXdpbmdBcmNHSVNPbmxpbmUgfSBmcm9tICcuL3F1ZXJ5LTRmN2I3ZTRkLmpzJztcblxuZnVuY3Rpb24gZ2V0SXRlbVRodW1ibmFpbChwb3J0YWwsIGl0ZW0sIHJlc3RCYXNlLCBub1Rva2VuKSB7XG4gIHJlc3RCYXNlICE9PSBudWxsICYmIHJlc3RCYXNlICE9PSB2b2lkIDAgPyByZXN0QmFzZSA6IChyZXN0QmFzZSA9IGdldFJlc3RCYXNlVXJsKHBvcnRhbCkpO1xuICBjb25zdCB0b2tlbiA9IGdldFRva2VuKHBvcnRhbCk7XG4gIGNvbnN0IHRva2VuUGFyYW0gPSB0b2tlbiAmJiAhbm9Ub2tlbiA/IGB0b2tlbj0ke3Rva2VufWAgOiBcIlwiO1xuICBjb25zdCBpdGVtVXJsID0gYCR7cmVzdEJhc2V9Y29udGVudC9pdGVtcy8ke2l0ZW0uaWR9YDtcbiAgaWYgKGl0ZW0udGh1bWJuYWlsKSB7XG4gICAgcmV0dXJuIGAke2l0ZW1Vcmx9L2luZm8vJHtpdGVtLnRodW1ibmFpbH0/dz00MDAke3Rva2VuID8gXCImXCIgOiBcIlwifSR7dG9rZW5QYXJhbX1gO1xuICB9XG4gIGVsc2UgaWYgKGl0ZW0udHlwZSA9PT0gXCJJbWFnZVwiICYmICFub1Rva2VuKSB7XG4gICAgcmV0dXJuIGAke2l0ZW1Vcmx9L2RhdGE/JHt0b2tlblBhcmFtfWA7XG4gIH1cbiAgcmV0dXJuIGdldERlZmF1bHRUaHVtYm5haWwoaXRlbSk7XG59XG4vKiogVGhpcyBpcyBqdXN0IGxpa2UgZ2V0SXRlbVRodW1ibmFpbCBidXQgaXQgd2lsbCB1c2UgYW4gYXJjZ2lzLmNvbSBiYXNlIGluIGNlcnRhaW4gcG9ydGFsIGNvbmRpdGlvbnMgKi9cbmFzeW5jIGZ1bmN0aW9uIGdldEFkanVzdGVkVGh1bWJuYWlsKHBvcnRhbCwgaXRlbSwgYnVja2V0KSB7XG4gIGlmIChhd2FpdCBpc1BvcnRhbFZpZXdpbmdBcmNHSVNPbmxpbmUocG9ydGFsLCBidWNrZXQpKSB7XG4gICAgcmV0dXJuIGdldEl0ZW1UaHVtYm5haWwocG9ydGFsLCBpdGVtLCBcImh0dHBzOi8vd3d3LmFyY2dpcy5jb20vc2hhcmluZy9yZXN0L1wiLCB0cnVlKTtcbiAgfVxuICByZXR1cm4gZ2V0SXRlbVRodW1ibmFpbChwb3J0YWwsIGl0ZW0pO1xufVxuZnVuY3Rpb24gZ2V0RGVmYXVsdFRodW1ibmFpbChpdGVtKSB7XG4gIHZhciBfYTtcbiAgY29uc3QgZmlsZU5hbWUgPSAoKF9hID0gaXRlbS50eXBlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudG9Mb3dlckNhc2UoKSkgIT09IFwibm90ZWJvb2tcIiA/IFwiZGVmYXVsdF90aHVtYi5wbmdcIiA6IFwibm90ZWJvb2stdGh1bWIucG5nXCI7XG4gIHJldHVybiBnZXRBc3NldFBhdGgoYC4vYXNzZXRzL2FyY2dpcy1pdGVtLWJyb3dzZXItY2FyZC10aHVtYm5haWwvJHtmaWxlTmFtZX1gKTtcbn1cbi8qKlxuICogQ2hlY2tzIGlmIHRoZSBnaXZlbiBpbWFnZSBpcyBibGFuay5cbiAqIERyYXdpbmcgdGhlIGltYWdlIG9uIGNhbnZhcywgZ2V0IHRoZSBpbWFnZSBkYXRhLFxuICogZ2VuZXJhdGUgYSBoYXNoIGFuZCBjb21wYXJlIHRoaXMgYWdhaW5zdCBhIGtub3duIGJsYW5rIGhhc2guXG4gKi9cbmZ1bmN0aW9uIGlzQmxhbmtJbWFnZShpbWFnZSkge1xuICBpZiAoIWltYWdlKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gIGNhbnZhcy5oZWlnaHQgPSBpbWFnZS5uYXR1cmFsSGVpZ2h0O1xuICBjYW52YXMud2lkdGggPSBpbWFnZS5uYXR1cmFsV2lkdGg7XG4gIGNvbnRleHQuZmlsbFN0eWxlID0gXCIjZmZmZmZmXCI7XG4gIGNvbnRleHQuZmlsbFJlY3QoMCwgMCwgaW1hZ2UubmF0dXJhbFdpZHRoLCBpbWFnZS5uYXR1cmFsSGVpZ2h0KTtcbiAgY29uc3QgYmxhbmsgPSBjYW52YXMudG9EYXRhVVJMKFwiaW1hZ2UvanBlZ1wiKTtcbiAgY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDApO1xuICByZXR1cm4gYmxhbmsgPT09IGNhbnZhcy50b0RhdGFVUkwoXCJpbWFnZS9qcGVnXCIpO1xufVxuXG5leHBvcnQgeyBnZXREZWZhdWx0VGh1bWJuYWlsIGFzIGEsIGdldEFkanVzdGVkVGh1bWJuYWlsIGFzIGIsIGdldEl0ZW1UaHVtYm5haWwgYXMgZywgaXNCbGFua0ltYWdlIGFzIGkgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuY29uc3QgZmVhdHVyZUxheWVySWNvbkluZm8gPSB7XG4gIHBvaW50OiBcInBvaW50XCIsXG4gIGxpbmU6IFwibGluZVwiLFxuICBwb2x5Z29uOiBcInBvbHlnb25cIixcbiAgbXVsdGlwYXRjaDogXCJjdWJlXCIsXG4gIHRhYmxlOiBcInRhYmxlXCIsXG4gIG11bHRpcG9pbnQ6IFwibGF5ZXItcG9pbnRzXCJcbn07XG5jb25zdCBlc3JpR2VvbWV0cnlJY29ucyA9IHtcbiAgZXNyaUdlb21ldHJ5UG9pbnQ6IFwicG9pbnRcIixcbiAgZXNyaUdlb21ldHJ5UG9seWxpbmU6IFwibGluZVwiLFxuICBlc3JpR2VvbWV0cnlQb2x5Z29uOiBcInBvbHlnb25cIixcbiAgZXNyaUdlb21ldHJ5TXVsdGlQYXRjaDogXCJjdWJlXCIsXG4gIGVzcmlHZW9tZXRyeU11bHRpcG9pbnQ6IFwicG9pbnRcIixcbiAgbm9uZTogXCJ0YWJsZVwiXG59O1xuY29uc3QgZmllbGRUeXBlSWNvbnMgPSB7XG4gIGVzcmlGaWVsZFR5cGVPSUQ6IFwia2V5XCIsXG4gIGVzcmlGaWVsZFR5cGVCb29sZWFuOiBcImJvb2xlYW5cIixcbiAgZXNyaUZpZWxkVHlwZVN0cmluZzogXCJzdHJpbmdcIixcbiAgZXNyaUZpZWxkVHlwZVNpbmdsZTogXCJudW1iZXJcIixcbiAgZXNyaUZpZWxkVHlwZURvdWJsZTogXCJudW1iZXJcIixcbiAgZXNyaUZpZWxkVHlwZUludGVnZXI6IFwiaW50ZWdlclwiLFxuICBlc3JpRmllbGRUeXBlU21hbGxJbnRlZ2VyOiBcImludGVnZXJcIixcbiAgZXNyaUZpZWxkVHlwZUdsb2JhbElEOiBcImtleVwiLFxuICBlc3JpRmllbGRUeXBlRGF0ZTogXCJkYXRlLXRpbWVcIixcbiAgZXNyaUZpZWxkVHlwZUJpZ0ludGVnZXI6IFwiaW50ZWdlclwiLFxuICBlc3JpRmllbGRUeXBlRGF0ZU9ubHk6IFwiY2FsZW5kYXJcIixcbiAgZXNyaUZpZWxkVHlwZVRpbWVPbmx5OiBcImNsb2NrXCIsXG4gIGVzcmlGaWVsZFR5cGVUaW1lc3RhbXBPZmZzZXQ6IFwidGltZS16b25lXCJcbn07XG5cbmV4cG9ydCB7IGZlYXR1cmVMYXllckljb25JbmZvIGFzIGEsIGVzcmlHZW9tZXRyeUljb25zIGFzIGUsIGZpZWxkVHlwZUljb25zIGFzIGYgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuLyoqIEdldCB0aGUgY29ycmVjdCBnZW9tZXRyeSBpY29uIGJhc2VkIG9uIGxheWVyL3RhYmxlIHR5cGUgYW5kIGdlb21ldHJ5IHR5cGVcbiAqIHdpbGwgaGFuZGxlcyB0eXBlcyB1c2VkIGJ5IHRoZSBqc2FwaSwgdGhlIGVzcmkgdHlwZXMgdXNlZCBvbiB0aGUgc2VydmVyLFxuICogYW5kIHRoZSB0eXBlcyByZXR1cm5lZCBieSB0aGUgU2VhcmNoIEFQSVxuICovXG5mdW5jdGlvbiBnZXRTdWJsYXllclR5cGVJbmZvKHsgZ2VvbWV0cnksIHR5cGUgfSkge1xuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlIFwiQ2F0YWxvZyBMYXllclwiOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWNvbjogXCJjYXRhbG9nLWRhdGFzZXRcIixcbiAgICAgICAgdHlwZTogXCJjYXRhbG9nXCIsXG4gICAgICAgIGlzR2VvbWV0cnk6IGZhbHNlXG4gICAgICB9O1xuICAgIGNhc2UgXCJQYXJjZWwgTGF5ZXJcIjpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGljb246IFwicGFyY2VsLWxheWVyXCIsXG4gICAgICAgIHR5cGU6IFwicGFyY2VsXCIsXG4gICAgICAgIGlzR2VvbWV0cnk6IGZhbHNlXG4gICAgICB9O1xuICAgIGNhc2UgXCJPcmllbnRlZCBJbWFnZXJ5IExheWVyXCI6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpY29uOiBcIm9yaWVudGVkLWltYWdlcnktbGF5ZXJcIixcbiAgICAgICAgdHlwZTogXCJvcmllbnRlZCBpbWFnZXJ5XCIsXG4gICAgICAgIGlzR2VvbWV0cnk6IGZhbHNlXG4gICAgICB9O1xuICAgIGNhc2UgXCJUYWJsZVwiOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWNvbjogXCJ0YWJsZVwiLFxuICAgICAgICB0eXBlOiBcInRhYmxlXCIsXG4gICAgICAgIGlzR2VvbWV0cnk6IHRydWVcbiAgICAgIH07XG4gIH1cbiAgc3dpdGNoIChnZW9tZXRyeSkge1xuICAgIGNhc2UgXCJwb2ludFwiOlxuICAgIGNhc2UgXCJlc3JpR2VvbWV0cnlQb2ludFwiOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogXCJwb2ludFwiLFxuICAgICAgICBpY29uOiBcInBvaW50XCIsXG4gICAgICAgIGlzR2VvbWV0cnk6IHRydWVcbiAgICAgIH07XG4gICAgY2FzZSBcImVzcmlHZW9tZXRyeU11bHRpcG9pbnRcIjpcbiAgICBjYXNlIFwibXVsdGlwb2ludFwiOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogXCJtdWx0aXBvaW50XCIsXG4gICAgICAgIGljb246IFwibGF5ZXItcG9pbnRzXCIsXG4gICAgICAgIGlzR2VvbWV0cnk6IHRydWVcbiAgICAgIH07XG4gICAgY2FzZSBcImxpbmVcIjpcbiAgICBjYXNlIFwicG9seWxpbmVcIjpcbiAgICBjYXNlIFwiZXNyaUdlb21ldHJ5UG9seWxpbmVcIjpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwibGluZVwiLFxuICAgICAgICBpY29uOiBcImxpbmVcIixcbiAgICAgICAgaXNHZW9tZXRyeTogdHJ1ZVxuICAgICAgfTtcbiAgICBjYXNlIFwicG9seWdvblwiOlxuICAgIGNhc2UgXCJlc3JpR2VvbWV0cnlQb2x5Z29uXCI6XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBcInBvbHlnb25cIixcbiAgICAgICAgaWNvbjogXCJwb2x5Z29uXCIsXG4gICAgICAgIGlzR2VvbWV0cnk6IHRydWVcbiAgICAgIH07XG4gICAgY2FzZSBcIm11bHRpcGF0Y2hcIjpcbiAgICBjYXNlIFwiZXNyaUdlb21ldHJ5TXVsdGlQYXRjaFwiOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogXCJtdWx0aXBhdGNoXCIsXG4gICAgICAgIGljb246IFwiY3ViZVwiLFxuICAgICAgICBpc0dlb21ldHJ5OiB0cnVlXG4gICAgICB9O1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBcInRhYmxlXCIsXG4gICAgICAgIGljb246IFwidGFibGVcIixcbiAgICAgICAgaXNHZW9tZXRyeTogdHJ1ZVxuICAgICAgfTtcbiAgfVxufVxuXG5leHBvcnQgeyBnZXRTdWJsYXllclR5cGVJbmZvIGFzIGcgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==