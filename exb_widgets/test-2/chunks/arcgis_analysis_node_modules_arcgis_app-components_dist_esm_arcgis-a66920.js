"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-a66920"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-352083fd.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-352083fd.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ append)
/* harmony export */ });
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _append_63c5ce83_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./append-63c5ce83.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-63c5ce83.js");
/* harmony import */ var _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./feature-layer-38cdae87.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-38cdae87.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */




async function append(addItemProps) {
  var _a;
  const appendParameters = (0,_append_63c5ce83_js__WEBPACK_IMPORTED_MODULE_1__.g)(addItemProps);
  const serviceUrl = (_a = addItemProps.existingItem) === null || _a === void 0 ? void 0 : _a.url;
  const appendUrl = `${serviceUrl}/${addItemProps.sourceDataLayer.id}/append`;
  try {
    const appendResponse = (await (0,_portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_0__.r)(appendUrl, appendParameters, {}, "post"));
    const { status, recordCount } = await (0,_feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_2__.w)(addItemProps.id, {}, appendResponse === null || appendResponse === void 0 ? void 0 : appendResponse.statusUrl);
    return { result: { status, recordCount } };
  }
  catch ({ error }) {
    console.error(error);
    return { error: { code: "unhandledError", message: JSON.stringify(error) } };
  }
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-58a7e7ab.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-58a7e7ab.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (/* binding */ AppendOverwriteCloudPublishTypes),
/* harmony export */   N: () => (/* binding */ NONE_VALUE),
/* harmony export */   a: () => (/* binding */ appendFileTypes),
/* harmony export */   b: () => (/* binding */ AppendOverwritePublishTypes),
/* harmony export */   c: () => (/* binding */ appendExtensionsForEnterprise),
/* harmony export */   d: () => (/* binding */ appendExtensions),
/* harmony export */   u: () => (/* binding */ uidFields)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */
const uidFields = ["esriFieldTypeOID", "esriFieldTypeGlobalID"];
const NONE_VALUE = "<None>";
const AppendOverwritePublishTypes = {
  "file geodatabase": "filegeodatabase",
  shapefile: "shapefile",
  geojson: "geojson",
  csv: "CSV",
  "microsoft excel": "excel",
  geopackage: "geoPackage"
};
const appendFileTypes = {
  Shapefile: "shapefile",
  "File Geodatabase": "fileGeodatabase",
  CSV: "csv",
  "Microsoft Excel": "excel",
  GeoJson: "geojson",
  GeoPackage: "geoPackage"
};
const AppendOverwriteCloudPublishTypes = {
  csv: "CSV",
  excel: "Microsoft Excel",
  shapefile: "Shapefile",
  fgdb: "File Geodatabase",
  geojson: "GeoJson",
  googlesheets: "Microsoft Excel"
};
const appendExtensions = ["zip", "csv", "xls", "xlsx", "geojson", "gpkg", "json"];
const appendExtensionsForEnterprise = ["zip", "csv", "xls", "xlsx"];




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-63c5ce83.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-63c5ce83.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ canMatchField),
/* harmony export */   g: () => (/* binding */ getAppendParameters)
/* harmony export */ });
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./append-58a7e7ab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-58a7e7ab.js");
/* harmony import */ var _geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./geocode-7eb7c0df.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-7eb7c0df.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */





var __rest = ( false) || function (s, e) {
  var t = {};
  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
    t[p] = s[p];
  if (s != null && typeof Object.getOwnPropertySymbols === "function")
    for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
      if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
        t[p[i]] = s[p[i]];
    }
  return t;
};
function canMatchField(field, matchField) {
  var _a;
  const fieldType = (field === null || field === void 0 ? void 0 : field.type) || null;
  const matchFieldType = (matchField === null || matchField === void 0 ? void 0 : matchField.type) || null;
  const matchFields = {
    esriFieldTypeSmallInteger: ["esriFieldTypeSmallInteger"],
    esriFieldTypeInteger: ["esriFieldTypeInteger", "esriFieldTypeSmallInteger"],
    esriFieldTypeSingle: ["esriFieldTypeSingle", "esriFieldTypeDouble"],
    esriFieldTypeDouble: [
      "esriFieldTypeDouble",
      "esriFieldTypeSingle",
      "esriFieldTypeInteger",
      "esriFieldTypeSmallInteger"
    ],
    esriFieldTypeDate: ["esriFieldTypeDate"],
    esriFieldTypeString: [
      "esriFieldTypeString",
      "esriFieldTypeSmallInteger",
      "esriFieldTypeInteger",
      "esriFieldTypeSingle",
      "esriFieldTypeDouble",
      "esriFieldTypeDate",
      "esriFieldTypeGUID"
    ],
    esriFieldTypeGUID: ["esriFieldTypeGUID", "esriFieldTypeString"],
    esriFieldTypeOID: ["esriFieldTypeOID", "esriFieldTypeSmallInteger", "esriFieldTypeInteger"],
    esriFieldTypeGlobalID: ["esriFieldTypeGlobalID", "esriFieldTypeGUID", "esriFieldTypeString"],
    esriFieldTypeDateOnly: ["esriFieldTypeDateOnly"],
    esriFieldTypeTimeOnly: ["esriFieldTypeTimeOnly"],
    esriFieldTypeTimestampOffset: ["esriFieldTypeTimestampOffset"],
    esriFieldTypeBigInteger: ["esriFieldTypeBigInteger"]
  };
  return matchFieldType && (matchFieldType === fieldType || ((_a = matchFields[fieldType]) === null || _a === void 0 ? void 0 : _a.indexOf(matchFieldType)) > -1);
}
function getAppendParameters(addItemProps) {
  var _a;
  const { timezone, analyzeResults, type, fieldMappings, dataLayer, id, uidPair, addAppendSelectOption, sourceDataLayer } = addItemProps;
  let finalAppendParameters, appendSourceInfo;
  const { publishParameters } = analyzeResults, rest = __rest(analyzeResults, ["publishParameters"]);
  const upsert = addAppendSelectOption === "upsert" || addAppendSelectOption === "update";
  const finalFieldMappings = formatFieldMappings(fieldMappings);
  const appendFields = createAppendFields(finalFieldMappings);
  const timezoneInfo = {
    dateFieldsTimeReference: {
      timeZone: timezone || "UTC",
      respectsDaylightSaving: true
    }
  };
  const defaultAppendParams = {
    sourceTableName: dataLayer.name,
    fieldMappings: (finalFieldMappings === null || finalFieldMappings === void 0 ? void 0 : finalFieldMappings.length) ? JSON.stringify(finalFieldMappings) : null,
    upsert,
    skipInserts: addAppendSelectOption === "update",
    skipUpdates: false,
    useGlobalIds: upsert && (uidPair === null || uidPair === void 0 ? void 0 : uidPair.type) === "esriFieldTypeGlobalID",
    updateGeometry: upsert ? _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_0__.a.addAppendSelectUpdateTypeOption === "attributeAndGeometry" : true,
    appendFields: appendFields.length ? JSON.stringify(appendFields) : null,
    appendItemId: id,
    appendUploadFormat: _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_3__.a[_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_0__.a.type].appendUploadFormat,
    rollbackOnFailure: true
  };
  const publishInfo = __rest(publishParameters, ["layers"]);
  if (type === "CSV") {
    publishParameters.layerInfo.dateFieldsTimeReference = timezoneInfo.dateFieldsTimeReference;
    appendSourceInfo = Object.assign(Object.assign(Object.assign({}, timezoneInfo), publishParameters), rest);
  }
  else if (type === "Microsoft Excel") {
    const layerInfo = (0,_geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_2__.a)({}, true);
    const formattedLayerInfo = getLayerToAppend(layerInfo, publishInfo); //Updated info needs to be added to the layers [] rather than the root for excel
    formattedLayerInfo.dateFieldsTimeReference = timezoneInfo.dateFieldsTimeReference;
    publishInfo.name = dataLayer.name;
    appendSourceInfo = Object.assign(Object.assign(Object.assign(Object.assign({}, timezoneInfo), { layers: [formattedLayerInfo] }), publishInfo), rest);
  }
  else {
    appendSourceInfo = Object.assign(Object.assign(Object.assign({}, timezoneInfo), publishParameters), rest);
  }
  finalAppendParameters = Object.assign(Object.assign({}, defaultAppendParams), { appendSourceInfo: JSON.stringify(appendSourceInfo) });
  if (addAppendSelectOption === "add") {
    finalAppendParameters.upsertMatchingField = sourceDataLayer.objectIdField || ((_a = sourceDataLayer.uniqueField) === null || _a === void 0 ? void 0 : _a.name);
  }
  else {
    if (upsert && (uidPair === null || uidPair === void 0 ? void 0 : uidPair.isUniqueIndex)) {
      finalAppendParameters.upsertMatchingField = uidPair === null || uidPair === void 0 ? void 0 : uidPair.name;
    }
  }
  return finalAppendParameters;
}
function getLayerToAppend(layerInfo, updatedInfo) {
  const formattedLayer = Object.assign({}, layerInfo);
  formattedLayer.locationType = updatedInfo.locationType;
  if (formattedLayer.locationType === "address") {
    formattedLayer.addressFields = updatedInfo.addressFields;
    formattedLayer.sourceCountry = updatedInfo.sourceCountry;
  }
  else if (formattedLayer.locationType === "coordinates") {
    formattedLayer.coordinateFieldType = updatedInfo.coordinateFieldType;
    if (formattedLayer.coordinateFieldType === "LatitudeAndLongitude") {
      formattedLayer.latitudeFieldName = updatedInfo.latitudeFieldName;
      formattedLayer.longitudeFieldName = updatedInfo.longitudeFieldName;
    }
    else {
      formattedLayer.coordinateFieldName = updatedInfo.coordinateFieldName;
    }
  }
  return formattedLayer;
}
function formatFieldMappings(fieldMappings) {
  const fields = fieldMappings.filter((fieldMapping) => {
    return fieldMapping.source !== _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_1__.N;
  });
  const finalFieldMappings = fields.map(({ source, name }) => {
    return { source, name };
  });
  return finalFieldMappings;
}
function createAppendFields(fieldMappings) {
  const appendFields = fieldMappings.map((mapping) => {
    return mapping.name;
  });
  return appendFields;
}




/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-match-fields.entry.js":
/*!********************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-match-fields.entry.js ***!
  \********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_append_match_fields: () => (/* binding */ ArcgisNewItemPagesAppendMatchFields)
/* harmony export */ });
/* harmony import */ var _index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-92ebb396.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-92ebb396.js");
/* harmony import */ var _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add-item-97d577a9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-97d577a9.js");
/* harmony import */ var _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./append-58a7e7ab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-58a7e7ab.js");
/* harmony import */ var _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ui-ecf86bba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-ecf86bba.js");
/* harmony import */ var _append_63c5ce83_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./append-63c5ce83.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-63c5ce83.js");
/* harmony import */ var _server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./server-item-f12153e6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-f12153e6.js");
/* harmony import */ var _append_352083fd_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./append-352083fd.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-352083fd.js");
/* harmony import */ var _index_81d548b7_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./index-81d548b7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-81d548b7.js");
/* harmony import */ var _geocode_7eb7c0df_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./geocode-7eb7c0df.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-7eb7c0df.js");
/* harmony import */ var _functional_c82f5ab9_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./functional-c82f5ab9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-c82f5ab9.js");
/* harmony import */ var _privileges_ccd5f37d_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./privileges-ccd5f37d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-ccd5f37d.js");
/* harmony import */ var _privileges_35590eb4_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./privileges-35590eb4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-35590eb4.js");
/* harmony import */ var _config_eb5f7dc2_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./config-eb5f7dc2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-eb5f7dc2.js");
/* harmony import */ var _portal_79caaeff_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./portal-79caaeff.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-79caaeff.js");
/* harmony import */ var _loadModules_aaf30bd6_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./loadModules-aaf30bd6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-aaf30bd6.js");
/* harmony import */ var _item_types_b4fe86ad_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./item-types-b4fe86ad.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-b4fe86ad.js");
/* harmony import */ var _item_properties_e6412a9a_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./item-properties-e6412a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-e6412a9a.js");
/* harmony import */ var _functional_9f648bee_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./functional-9f648bee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-9f648bee.js");
/* harmony import */ var _feature_layer_38cdae87_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./feature-layer-38cdae87.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-38cdae87.js");
/* harmony import */ var _feature_layer_d33ea114_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./feature-layer-d33ea114.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-d33ea114.js");
/* harmony import */ var _guid_4f4176ba_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./guid-4f4176ba.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-4f4176ba.js");
/* harmony import */ var _thumbnail_0b7adfcd_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./thumbnail-0b7adfcd.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-0b7adfcd.js");
/* harmony import */ var _query_4f7b7e4d_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./query-4f7b7e4d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-4f7b7e4d.js");
/* harmony import */ var _user_e3dedc4a_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./user-e3dedc4a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-e3dedc4a.js");
/* harmony import */ var _api_f7934cd7_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./api-f7934cd7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-f7934cd7.js");
/* harmony import */ var _item_d9d70416_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./item-d9d70416.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-d9d70416.js");
/* harmony import */ var _dom_13f5b00c_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./dom-13f5b00c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-13f5b00c.js");
/* harmony import */ var _feature_layer_69305a85_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./feature-layer-69305a85.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-69305a85.js");
/* harmony import */ var _ags_68d4ae20_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./ags-68d4ae20.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-68d4ae20.js");
/* harmony import */ var _url_f3b82cc7_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./url-f3b82cc7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-f3b82cc7.js");
/* harmony import */ var _storage_d7f5822e_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./storage-d7f5822e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-d7f5822e.js");
/* harmony import */ var _file_f36193e9_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./file-f36193e9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-f36193e9.js");
/* harmony import */ var _store_3210b604_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./store-3210b604.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-3210b604.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v3.0.99
 */


































const arcgisNewItemPagesAppendMatchFieldsCss = ".fields-container{display:flex;flex-direction:column;height:100%;overflow-y:auto;overflow-x:hidden}.field-table{margin-bottom:1.5rem;overflow:auto;display:flex;flex-direction:column}.search-container{display:flex;width:100%}.field-search{width:50%;margin-right:0.5rem}.field-select{width:50%}.field-name-column{width:50%;margin-right:0.5rem}.match-field-name-column{width:50%}.fields-scroll-container{display:flex;flex-direction:column;margin-bottom:0.75rem;padding-bottom:0.75rem;border-bottom:0.125rem solid var(--calcite-ui-foreground-3)}.header-row{display:flex;align-content:flex-start;justify-content:center;font-weight:500;font-size:0.875rem;color:var(--calcite-ui-text-1);grid-gap:0.25rem;gap:0.25rem;padding:0.25rem}.header-cell{display:flex;width:100%;font-size:1rem}.hide{display:none}.not-visible{visibility:hidden;height:0}.cell{box-sizing:border-box;width:33.333333%;width:100%}.cell label{margin-top:0.75rem}.row{display:flex;justify-content:space-between;align-items:center;grid-gap:0.25rem;gap:0.25rem;padding:0.25rem;margin-bottom:0.75rem;font-weight:500;font-size:1rem;color:var(--calcite-ui-text-1);border-bottom:0.125rem solid var(--calcite-ui-foreground-3)}.deselected{opacity:var(--calcite-ui-opacity-disabled)}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.label{--calcite-label-margin-bottom:0}.append-timezone{border-top:0.063rem solid var(--calcite-ui-foreground-3)}.from-to-fields{display:flex;flex-direction:row}.description{font-size:0.875rem;font-weight:300;margin-bottom:1rem}.header{font-weight:500;font-size:1rem;color:var(--calcite-ui-text-1);margin-bottom:0.5rem}.no-fields{margin-bottom:1.5rem}.popover-icon{color:var(--calcite-ui-text-3);cursor:pointer;margin-top:0.125rem;-webkit-margin-start:0.75rem;margin-inline-start:0.75rem}.popover-content{font-size:0.75rem;font-weight:400;margin:0}.header-popover{margin-top:-0.313rem}";

const ArcgisNewItemPagesAppendMatchFields = class {
  constructor(hostRef) {
    (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.newItemUpdatePage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
    this.newItemPrevPage = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemPrevPage", 7);
    this.workflowComplete = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
    this.newItemToggleNavigationEnabled = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
    this.newItemDisableCloseButtons = (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemDisableCloseButtons", 7);
    this.validatedFields = [];
    this.fields = undefined;
    this.i18n = undefined;
    this.fieldMatches = [];
    this.error = undefined;
    this.loading = false;
    this.loaderType = "indeterminate";
    this.loaderMessage = undefined;
  }
  handleNext() {
    const matchingCompletionError = this.validateMatchings();
    if (matchingCompletionError) {
      this.error = matchingCompletionError;
      return;
    }
    _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.fieldMappings = this.fieldMatches;
    if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.addAppendSelectOption === "add") {
      this.handleAppend();
      return;
    }
    this.newItemUpdatePage.emit("appendSelectUpdate");
  }
  validateMatchings() {
    //return an error
    const noMatches = this.fieldMatches.every((field) => {
      return field.source === _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_2__.N;
    });
    if (!noMatches) {
      const nonNullableFieldsLength = this.fieldMatches.filter((field) => !field.disabled && !field.nullable && field.source === _append_58a7e7ab_js__WEBPACK_IMPORTED_MODULE_2__.N).length;
      if (nonNullableFieldsLength <= 0) {
        return null;
      }
      return {
        title: this.i18n.errors.nonNullableErrorTitle,
        description: this.i18n.errors.nonNullableErrorDescription
      };
    }
    return { title: this.errorLabel, description: this.i18n.errors.noMatchedFields };
  }
  disableModalButtons(disable) {
    this.newItemToggleNavigationEnabled.emit(!disable);
    this.newItemDisableCloseButtons.emit(disable);
  }
  async handleAppend() {
    var _a, _b;
    const { sourceDataLayer, existingItem, timezone, analyzeResults, type, fieldMappings, dataLayer, id, uidPair, addAppendSelectOption } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a;
    this.disableModalButtons(true);
    this.loading = true;
    this.loaderMessage = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.append.appendLoadingMessages.appendCloseNotice;
    const response = await (0,_append_352083fd_js__WEBPACK_IMPORTED_MODULE_6__.a)({
      sourceDataLayer,
      existingItem,
      timezone,
      analyzeResults,
      type,
      fieldMappings,
      dataLayer,
      id,
      uidPair,
      addAppendSelectOption
    });
    if (((_b = (_a = response === null || response === void 0 ? void 0 : response.result) === null || _a === void 0 ? void 0 : _a.status) === null || _b === void 0 ? void 0 : _b.toLowerCase()) === "completed") {
      await (0,_server_item_f12153e6_js__WEBPACK_IMPORTED_MODULE_5__.d)(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.id, { permanentDelete: true });
      const emitPayload = Object.assign({
        // `publishResponse` doesn't for some flows so use this id instead
        appendType: _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.addAppendSelectOption
      }, response);
      this.workflowComplete.emit(emitPayload);
      return;
    }
    else {
      this.disableModalButtons(false);
      this.loading = false;
      this.error = {
        title: _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.error,
        description: _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.append.appendErrorMessages.appendError
      };
    }
  }
  async handlePrev(event) {
    var _a;
    if (this.loading) {
      return;
    }
    if (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.addAppendSelectOption === "add" &&
      !(((_a = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.analyzeResults.publishParameters.layers) === null || _a === void 0 ? void 0 : _a.length) > 1)) {
      event.preventDefault();
      this.newItemPrevPage.emit();
    }
  }
  handleFieldChange(event) {
    const newFieldMapping = Object.assign({}, event.detail);
    this.validateFieldMappings(this.validatedFields, newFieldMapping);
  }
  sortFields() {
    this.fieldMatches = this.fieldMatches.sort(function (a, b) {
      const nameA = a.name.toLowerCase();
      const nameB = b.name.toLowerCase();
      if (nameA < nameB) {
        return -1;
      }
      else if (nameA > nameB) {
        return 1;
      }
      return 0;
    });
  }
  validateFieldMappings(currentFieldMappings, newFieldMapping) {
    newFieldMapping.initialMatch = newFieldMapping.source;
    if (newFieldMapping.source !== this.noneString) {
      const duplicate = currentFieldMappings.filter((mapping) => {
        return mapping.source === newFieldMapping.source;
      });
      if ((duplicate === null || duplicate === void 0 ? void 0 : duplicate.length) > 0) {
        const duplicateIndex = duplicate[0].idx;
        currentFieldMappings[duplicateIndex].initialMatch = this.noneString;
        currentFieldMappings[duplicateIndex].source = this.noneString;
      }
    }
    currentFieldMappings[newFieldMapping.idx] = newFieldMapping;
    this.validatedFields = currentFieldMappings;
    this.fieldMatches = [...this.validatedFields];
    this.sortFields();
  }
  setNextText() {
    _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.nextText =
      _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.addAppendSelectOption === "add" ? "addAndComplete" : "next";
  }
  componentWillLoad() {
    const { addAppendSelectOption, uidPair, sourceDataLayer, backupLayerFields } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a;
    this.i18n = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.appendMatchFields;
    this.errorLabel = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.error;
    this.noneString = _ui_ecf86bba_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.appendKeyValuePair.noneField;
    const dataLayerFields = backupLayerFields;
    const serviceLayerFields = sourceDataLayer.type === "csv" ? [sourceDataLayer.layerInfo] : sourceDataLayer.fields;
    this.setNextText();
    this.selectedKeyPair = uidPair;
    const updateExistingFeatures = addAppendSelectOption === "upsert" || addAppendSelectOption === "update";
    const serviceUIDFields = addAppendSelectOption === "add"
      ? null
      : _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.serviceUIDFields.map((field) => {
        return field.name;
      });
    let fieldsListIndex = addAppendSelectOption === "add" ? 0 : 1;
    serviceLayerFields.forEach((layerInfo) => {
      if ((layerInfo === null || layerInfo === void 0 ? void 0 : layerInfo.type) !== "esriFieldTypeOID" &&
        (layerInfo === null || layerInfo === void 0 ? void 0 : layerInfo.type) !== "esriFieldTypeGlobalID" &&
        layerInfo.editable &&
        (!updateExistingFeatures || !serviceUIDFields.includes(layerInfo.name))) {
        //match fields that are not uid
        this.fieldMatches.push(this.createFieldMapping(layerInfo, dataLayerFields, fieldsListIndex));
        this.validatedFields.push(this.createFieldMapping(layerInfo, dataLayerFields, fieldsListIndex));
        fieldsListIndex++;
      }
    });
    if (addAppendSelectOption !== "add") {
      this.fieldMatches.unshift(this.selectedKeyPair);
      this.validatedFields.unshift(this.selectedKeyPair);
    }
    this.sortFields();
  }
  createFieldMapping(serviceLayerField, dataLayerFields, serviceLayerIndex) {
    const addressFields = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.dataLayer.addressFields
      ? Object.values(_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.dataLayer.addressFields)
      : null;
    let matched = this.noneString;
    const possibleMatches = [
      {
        source: this.noneString,
        name: serviceLayerField.name,
        type: "None",
        idx: serviceLayerIndex
      }
    ];
    dataLayerFields.forEach((fieldInfo) => {
      if ((0,_append_63c5ce83_js__WEBPACK_IMPORTED_MODULE_4__.c)(serviceLayerField, fieldInfo) &&
        (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.addAppendSelectOption === "add"
          ? true
          : fieldInfo.name !== this.selectedKeyPair.source)) {
        possibleMatches.push({
          source: fieldInfo.name,
          name: serviceLayerField.name,
          type: serviceLayerField.type,
          idx: serviceLayerIndex
        });
        if (serviceLayerField.name.toLowerCase() === fieldInfo.name.toLowerCase() &&
          (serviceLayerField.type === fieldInfo.type ||
            !!(addressFields === null || addressFields === void 0 ? void 0 : addressFields.find((field) => field === fieldInfo.displayName || field === fieldInfo.name))) &&
          (_add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a.addAppendSelectOption === "add"
            ? true
            : fieldInfo.name !== this.selectedKeyPair.source)) {
          matched = fieldInfo.name;
        }
      }
    });
    return {
      source: matched,
      name: serviceLayerField.name,
      nullable: serviceLayerField.nullable,
      type: serviceLayerField.type,
      idx: serviceLayerIndex,
      initialMatch: matched,
      possibleMatches
    };
  }
  render() {
    const { i18n, error } = this;
    const { originalFileName, existingItem } = _add_item_97d577a9_js__WEBPACK_IMPORTED_MODULE_1__.a;
    const rowHeaderInfo = {
      originalField: {
        header: i18n.originalField.header,
        moreInfo: i18n.originalField.moreInfo.replace("${featureLayerName}", existingItem.title)
      },
      uploadedField: {
        header: i18n.uploadedField.header,
        moreInfo: i18n.uploadedField.moreInfo.replace("${uploadedFileName}", originalFileName)
      }
    };
    const description = i18n.description
      .replace("${uploadedFileName}", originalFileName)
      .replace("${featureLayerName}", existingItem.title);
    return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: { "overflow-hidden": this.loading } }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: this.loaderType, active: this.loading, text: this.loaderMessage }), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "header" }, " ", i18n.header, " "), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "description" }, description), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "row", role: "row" }, Object.keys(rowHeaderInfo).map((rowHeader) => {
      const { header, moreInfo } = rowHeaderInfo[rowHeader];
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "header-cell", role: "columnheader", "aria-sort": "none" }, header, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-information", { class: "header-popover", label: moreInfo, placement: "top-start", paddedContent: true }, (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "popover-content" }, moreInfo))));
    })), this.fieldMatches.length > 0 ? ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "fields-scroll-container" }, this.fieldMatches.map((mapping) => {
      return ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-append-match-field", { key: mapping.source, onFieldChange: this.handleFieldChange.bind(this), field: mapping }));
    }))) : ((0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { class: "no-fields", icon: true, status: "valid" }, this.i18n.errors.noFields)), (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: error === null || error === void 0 ? void 0 : error.title, description: error === null || error === void 0 ? void 0 : error.description, link: { href: error === null || error === void 0 ? void 0 : error.link, title: error === null || error === void 0 ? void 0 : error.linkText }, active: !!error, onAlertDismiss: () => (this.error = null) })));
  }
  get el() { return (0,_index_92ebb396_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesAppendMatchFields.style = arcgisNewItemPagesAppendMatchFieldsCss;




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWE2NjkyMC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDb0Q7QUFDWTtBQUNDOztBQUVqRTtBQUNBO0FBQ0EsMkJBQTJCLHNEQUFtQjtBQUM5QztBQUNBLHVCQUF1QixXQUFXLEdBQUcsZ0NBQWdDO0FBQ3JFO0FBQ0Esa0NBQWtDLHNEQUFPLGdDQUFnQztBQUN6RSxZQUFZLHNCQUFzQixRQUFRLDZEQUFhLG9CQUFvQjtBQUMzRSxhQUFhLFVBQVU7QUFDdkI7QUFDQSxXQUFXLE9BQU87QUFDbEI7QUFDQSxhQUFhLFNBQVM7QUFDdEI7QUFDQTs7QUFFdUI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3hCdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFcU07Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDakNyTTtBQUNBO0FBQ0E7QUFDQTtBQUMyRDtBQUNKO0FBQ1c7QUFDQzs7QUFFbkUsY0FBYyxNQUE2QjtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RCxjQUFjO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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Qyx5Q0FBeUMsdUZBQXVGO0FBQy9JLEtBQUssT0FBTyxxREFBQyw0QkFBNEIsaURBQWlELCtCQUErQixxREFBQyw0QkFBNEIsMEpBQTBKLHFJQUFxSSw4REFBOEQ7QUFDbmY7QUFDQSxhQUFhLE9BQU8scURBQVU7QUFDOUI7QUFDQTs7QUFFNEYiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcHBlbmQtMzUyMDgzZmQuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXBwZW5kLTU4YTdlN2FiLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FwcGVuZC02M2M1Y2U4My5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtbmV3LWl0ZW0tcGFnZXMtYXBwZW5kLW1hdGNoLWZpZWxkcy5lbnRyeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVxdWVzdCB9IGZyb20gJy4vcG9ydGFsLTc5Y2FhZWZmLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0QXBwZW5kUGFyYW1ldGVycyB9IGZyb20gJy4vYXBwZW5kLTYzYzVjZTgzLmpzJztcbmltcG9ydCB7IHcgYXMgZ2V0SXRlbVN0YXR1cyB9IGZyb20gJy4vZmVhdHVyZS1sYXllci0zOGNkYWU4Ny5qcyc7XG5cbmFzeW5jIGZ1bmN0aW9uIGFwcGVuZChhZGRJdGVtUHJvcHMpIHtcbiAgdmFyIF9hO1xuICBjb25zdCBhcHBlbmRQYXJhbWV0ZXJzID0gZ2V0QXBwZW5kUGFyYW1ldGVycyhhZGRJdGVtUHJvcHMpO1xuICBjb25zdCBzZXJ2aWNlVXJsID0gKF9hID0gYWRkSXRlbVByb3BzLmV4aXN0aW5nSXRlbSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnVybDtcbiAgY29uc3QgYXBwZW5kVXJsID0gYCR7c2VydmljZVVybH0vJHthZGRJdGVtUHJvcHMuc291cmNlRGF0YUxheWVyLmlkfS9hcHBlbmRgO1xuICB0cnkge1xuICAgIGNvbnN0IGFwcGVuZFJlc3BvbnNlID0gKGF3YWl0IHJlcXVlc3QoYXBwZW5kVXJsLCBhcHBlbmRQYXJhbWV0ZXJzLCB7fSwgXCJwb3N0XCIpKTtcbiAgICBjb25zdCB7IHN0YXR1cywgcmVjb3JkQ291bnQgfSA9IGF3YWl0IGdldEl0ZW1TdGF0dXMoYWRkSXRlbVByb3BzLmlkLCB7fSwgYXBwZW5kUmVzcG9uc2UgPT09IG51bGwgfHwgYXBwZW5kUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFwcGVuZFJlc3BvbnNlLnN0YXR1c1VybCk7XG4gICAgcmV0dXJuIHsgcmVzdWx0OiB7IHN0YXR1cywgcmVjb3JkQ291bnQgfSB9O1xuICB9XG4gIGNhdGNoICh7IGVycm9yIH0pIHtcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIsIG1lc3NhZ2U6IEpTT04uc3RyaW5naWZ5KGVycm9yKSB9IH07XG4gIH1cbn1cblxuZXhwb3J0IHsgYXBwZW5kIGFzIGEgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuY29uc3QgdWlkRmllbGRzID0gW1wiZXNyaUZpZWxkVHlwZU9JRFwiLCBcImVzcmlGaWVsZFR5cGVHbG9iYWxJRFwiXTtcbmNvbnN0IE5PTkVfVkFMVUUgPSBcIjxOb25lPlwiO1xuY29uc3QgQXBwZW5kT3ZlcndyaXRlUHVibGlzaFR5cGVzID0ge1xuICBcImZpbGUgZ2VvZGF0YWJhc2VcIjogXCJmaWxlZ2VvZGF0YWJhc2VcIixcbiAgc2hhcGVmaWxlOiBcInNoYXBlZmlsZVwiLFxuICBnZW9qc29uOiBcImdlb2pzb25cIixcbiAgY3N2OiBcIkNTVlwiLFxuICBcIm1pY3Jvc29mdCBleGNlbFwiOiBcImV4Y2VsXCIsXG4gIGdlb3BhY2thZ2U6IFwiZ2VvUGFja2FnZVwiXG59O1xuY29uc3QgYXBwZW5kRmlsZVR5cGVzID0ge1xuICBTaGFwZWZpbGU6IFwic2hhcGVmaWxlXCIsXG4gIFwiRmlsZSBHZW9kYXRhYmFzZVwiOiBcImZpbGVHZW9kYXRhYmFzZVwiLFxuICBDU1Y6IFwiY3N2XCIsXG4gIFwiTWljcm9zb2Z0IEV4Y2VsXCI6IFwiZXhjZWxcIixcbiAgR2VvSnNvbjogXCJnZW9qc29uXCIsXG4gIEdlb1BhY2thZ2U6IFwiZ2VvUGFja2FnZVwiXG59O1xuY29uc3QgQXBwZW5kT3ZlcndyaXRlQ2xvdWRQdWJsaXNoVHlwZXMgPSB7XG4gIGNzdjogXCJDU1ZcIixcbiAgZXhjZWw6IFwiTWljcm9zb2Z0IEV4Y2VsXCIsXG4gIHNoYXBlZmlsZTogXCJTaGFwZWZpbGVcIixcbiAgZmdkYjogXCJGaWxlIEdlb2RhdGFiYXNlXCIsXG4gIGdlb2pzb246IFwiR2VvSnNvblwiLFxuICBnb29nbGVzaGVldHM6IFwiTWljcm9zb2Z0IEV4Y2VsXCJcbn07XG5jb25zdCBhcHBlbmRFeHRlbnNpb25zID0gW1wiemlwXCIsIFwiY3N2XCIsIFwieGxzXCIsIFwieGxzeFwiLCBcImdlb2pzb25cIiwgXCJncGtnXCIsIFwianNvblwiXTtcbmNvbnN0IGFwcGVuZEV4dGVuc2lvbnNGb3JFbnRlcnByaXNlID0gW1wiemlwXCIsIFwiY3N2XCIsIFwieGxzXCIsIFwieGxzeFwiXTtcblxuZXhwb3J0IHsgQXBwZW5kT3ZlcndyaXRlQ2xvdWRQdWJsaXNoVHlwZXMgYXMgQSwgTk9ORV9WQUxVRSBhcyBOLCBhcHBlbmRGaWxlVHlwZXMgYXMgYSwgQXBwZW5kT3ZlcndyaXRlUHVibGlzaFR5cGVzIGFzIGIsIGFwcGVuZEV4dGVuc2lvbnNGb3JFbnRlcnByaXNlIGFzIGMsIGFwcGVuZEV4dGVuc2lvbnMgYXMgZCwgdWlkRmllbGRzIGFzIHUgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHYzLjAuOTlcbiAqL1xuaW1wb3J0IHsgYSBhcyBhZGRJdGVtU3RhdGUgfSBmcm9tICcuL2FkZC1pdGVtLTk3ZDU3N2E5LmpzJztcbmltcG9ydCB7IE4gYXMgTk9ORV9WQUxVRSB9IGZyb20gJy4vYXBwZW5kLTU4YTdlN2FiLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0QW5hbHl6ZWRMYXllckluZm8gfSBmcm9tICcuL2dlb2NvZGUtN2ViN2MwZGYuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRDcmVhdGVJdGVtVHlwZXMgfSBmcm9tICcuL2l0ZW0tdHlwZXMtYjRmZTg2YWQuanMnO1xuXG52YXIgX19yZXN0ID0gKHVuZGVmaW5lZCAmJiB1bmRlZmluZWQuX19yZXN0KSB8fCBmdW5jdGlvbiAocywgZSkge1xuICB2YXIgdCA9IHt9O1xuICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkgJiYgZS5pbmRleE9mKHApIDwgMClcbiAgICB0W3BdID0gc1twXTtcbiAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gXCJmdW5jdGlvblwiKVxuICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChlLmluZGV4T2YocFtpXSkgPCAwICYmIE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzLCBwW2ldKSlcbiAgICAgICAgdFtwW2ldXSA9IHNbcFtpXV07XG4gICAgfVxuICByZXR1cm4gdDtcbn07XG5mdW5jdGlvbiBjYW5NYXRjaEZpZWxkKGZpZWxkLCBtYXRjaEZpZWxkKSB7XG4gIHZhciBfYTtcbiAgY29uc3QgZmllbGRUeXBlID0gKGZpZWxkID09PSBudWxsIHx8IGZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZC50eXBlKSB8fCBudWxsO1xuICBjb25zdCBtYXRjaEZpZWxkVHlwZSA9IChtYXRjaEZpZWxkID09PSBudWxsIHx8IG1hdGNoRmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hdGNoRmllbGQudHlwZSkgfHwgbnVsbDtcbiAgY29uc3QgbWF0Y2hGaWVsZHMgPSB7XG4gICAgZXNyaUZpZWxkVHlwZVNtYWxsSW50ZWdlcjogW1wiZXNyaUZpZWxkVHlwZVNtYWxsSW50ZWdlclwiXSxcbiAgICBlc3JpRmllbGRUeXBlSW50ZWdlcjogW1wiZXNyaUZpZWxkVHlwZUludGVnZXJcIiwgXCJlc3JpRmllbGRUeXBlU21hbGxJbnRlZ2VyXCJdLFxuICAgIGVzcmlGaWVsZFR5cGVTaW5nbGU6IFtcImVzcmlGaWVsZFR5cGVTaW5nbGVcIiwgXCJlc3JpRmllbGRUeXBlRG91YmxlXCJdLFxuICAgIGVzcmlGaWVsZFR5cGVEb3VibGU6IFtcbiAgICAgIFwiZXNyaUZpZWxkVHlwZURvdWJsZVwiLFxuICAgICAgXCJlc3JpRmllbGRUeXBlU2luZ2xlXCIsXG4gICAgICBcImVzcmlGaWVsZFR5cGVJbnRlZ2VyXCIsXG4gICAgICBcImVzcmlGaWVsZFR5cGVTbWFsbEludGVnZXJcIlxuICAgIF0sXG4gICAgZXNyaUZpZWxkVHlwZURhdGU6IFtcImVzcmlGaWVsZFR5cGVEYXRlXCJdLFxuICAgIGVzcmlGaWVsZFR5cGVTdHJpbmc6IFtcbiAgICAgIFwiZXNyaUZpZWxkVHlwZVN0cmluZ1wiLFxuICAgICAgXCJlc3JpRmllbGRUeXBlU21hbGxJbnRlZ2VyXCIsXG4gICAgICBcImVzcmlGaWVsZFR5cGVJbnRlZ2VyXCIsXG4gICAgICBcImVzcmlGaWVsZFR5cGVTaW5nbGVcIixcbiAgICAgIFwiZXNyaUZpZWxkVHlwZURvdWJsZVwiLFxuICAgICAgXCJlc3JpRmllbGRUeXBlRGF0ZVwiLFxuICAgICAgXCJlc3JpRmllbGRUeXBlR1VJRFwiXG4gICAgXSxcbiAgICBlc3JpRmllbGRUeXBlR1VJRDogW1wiZXNyaUZpZWxkVHlwZUdVSURcIiwgXCJlc3JpRmllbGRUeXBlU3RyaW5nXCJdLFxuICAgIGVzcmlGaWVsZFR5cGVPSUQ6IFtcImVzcmlGaWVsZFR5cGVPSURcIiwgXCJlc3JpRmllbGRUeXBlU21hbGxJbnRlZ2VyXCIsIFwiZXNyaUZpZWxkVHlwZUludGVnZXJcIl0sXG4gICAgZXNyaUZpZWxkVHlwZUdsb2JhbElEOiBbXCJlc3JpRmllbGRUeXBlR2xvYmFsSURcIiwgXCJlc3JpRmllbGRUeXBlR1VJRFwiLCBcImVzcmlGaWVsZFR5cGVTdHJpbmdcIl0sXG4gICAgZXNyaUZpZWxkVHlwZURhdGVPbmx5OiBbXCJlc3JpRmllbGRUeXBlRGF0ZU9ubHlcIl0sXG4gICAgZXNyaUZpZWxkVHlwZVRpbWVPbmx5OiBbXCJlc3JpRmllbGRUeXBlVGltZU9ubHlcIl0sXG4gICAgZXNyaUZpZWxkVHlwZVRpbWVzdGFtcE9mZnNldDogW1wiZXNyaUZpZWxkVHlwZVRpbWVzdGFtcE9mZnNldFwiXSxcbiAgICBlc3JpRmllbGRUeXBlQmlnSW50ZWdlcjogW1wiZXNyaUZpZWxkVHlwZUJpZ0ludGVnZXJcIl1cbiAgfTtcbiAgcmV0dXJuIG1hdGNoRmllbGRUeXBlICYmIChtYXRjaEZpZWxkVHlwZSA9PT0gZmllbGRUeXBlIHx8ICgoX2EgPSBtYXRjaEZpZWxkc1tmaWVsZFR5cGVdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5kZXhPZihtYXRjaEZpZWxkVHlwZSkpID4gLTEpO1xufVxuZnVuY3Rpb24gZ2V0QXBwZW5kUGFyYW1ldGVycyhhZGRJdGVtUHJvcHMpIHtcbiAgdmFyIF9hO1xuICBjb25zdCB7IHRpbWV6b25lLCBhbmFseXplUmVzdWx0cywgdHlwZSwgZmllbGRNYXBwaW5ncywgZGF0YUxheWVyLCBpZCwgdWlkUGFpciwgYWRkQXBwZW5kU2VsZWN0T3B0aW9uLCBzb3VyY2VEYXRhTGF5ZXIgfSA9IGFkZEl0ZW1Qcm9wcztcbiAgbGV0IGZpbmFsQXBwZW5kUGFyYW1ldGVycywgYXBwZW5kU291cmNlSW5mbztcbiAgY29uc3QgeyBwdWJsaXNoUGFyYW1ldGVycyB9ID0gYW5hbHl6ZVJlc3VsdHMsIHJlc3QgPSBfX3Jlc3QoYW5hbHl6ZVJlc3VsdHMsIFtcInB1Ymxpc2hQYXJhbWV0ZXJzXCJdKTtcbiAgY29uc3QgdXBzZXJ0ID0gYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcInVwc2VydFwiIHx8IGFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJ1cGRhdGVcIjtcbiAgY29uc3QgZmluYWxGaWVsZE1hcHBpbmdzID0gZm9ybWF0RmllbGRNYXBwaW5ncyhmaWVsZE1hcHBpbmdzKTtcbiAgY29uc3QgYXBwZW5kRmllbGRzID0gY3JlYXRlQXBwZW5kRmllbGRzKGZpbmFsRmllbGRNYXBwaW5ncyk7XG4gIGNvbnN0IHRpbWV6b25lSW5mbyA9IHtcbiAgICBkYXRlRmllbGRzVGltZVJlZmVyZW5jZToge1xuICAgICAgdGltZVpvbmU6IHRpbWV6b25lIHx8IFwiVVRDXCIsXG4gICAgICByZXNwZWN0c0RheWxpZ2h0U2F2aW5nOiB0cnVlXG4gICAgfVxuICB9O1xuICBjb25zdCBkZWZhdWx0QXBwZW5kUGFyYW1zID0ge1xuICAgIHNvdXJjZVRhYmxlTmFtZTogZGF0YUxheWVyLm5hbWUsXG4gICAgZmllbGRNYXBwaW5nczogKGZpbmFsRmllbGRNYXBwaW5ncyA9PT0gbnVsbCB8fCBmaW5hbEZpZWxkTWFwcGluZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpbmFsRmllbGRNYXBwaW5ncy5sZW5ndGgpID8gSlNPTi5zdHJpbmdpZnkoZmluYWxGaWVsZE1hcHBpbmdzKSA6IG51bGwsXG4gICAgdXBzZXJ0LFxuICAgIHNraXBJbnNlcnRzOiBhZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwidXBkYXRlXCIsXG4gICAgc2tpcFVwZGF0ZXM6IGZhbHNlLFxuICAgIHVzZUdsb2JhbElkczogdXBzZXJ0ICYmICh1aWRQYWlyID09PSBudWxsIHx8IHVpZFBhaXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVpZFBhaXIudHlwZSkgPT09IFwiZXNyaUZpZWxkVHlwZUdsb2JhbElEXCIsXG4gICAgdXBkYXRlR2VvbWV0cnk6IHVwc2VydCA/IGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RVcGRhdGVUeXBlT3B0aW9uID09PSBcImF0dHJpYnV0ZUFuZEdlb21ldHJ5XCIgOiB0cnVlLFxuICAgIGFwcGVuZEZpZWxkczogYXBwZW5kRmllbGRzLmxlbmd0aCA/IEpTT04uc3RyaW5naWZ5KGFwcGVuZEZpZWxkcykgOiBudWxsLFxuICAgIGFwcGVuZEl0ZW1JZDogaWQsXG4gICAgYXBwZW5kVXBsb2FkRm9ybWF0OiBhZGRDcmVhdGVJdGVtVHlwZXNbYWRkSXRlbVN0YXRlLnR5cGVdLmFwcGVuZFVwbG9hZEZvcm1hdCxcbiAgICByb2xsYmFja09uRmFpbHVyZTogdHJ1ZVxuICB9O1xuICBjb25zdCBwdWJsaXNoSW5mbyA9IF9fcmVzdChwdWJsaXNoUGFyYW1ldGVycywgW1wibGF5ZXJzXCJdKTtcbiAgaWYgKHR5cGUgPT09IFwiQ1NWXCIpIHtcbiAgICBwdWJsaXNoUGFyYW1ldGVycy5sYXllckluZm8uZGF0ZUZpZWxkc1RpbWVSZWZlcmVuY2UgPSB0aW1lem9uZUluZm8uZGF0ZUZpZWxkc1RpbWVSZWZlcmVuY2U7XG4gICAgYXBwZW5kU291cmNlSW5mbyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aW1lem9uZUluZm8pLCBwdWJsaXNoUGFyYW1ldGVycyksIHJlc3QpO1xuICB9XG4gIGVsc2UgaWYgKHR5cGUgPT09IFwiTWljcm9zb2Z0IEV4Y2VsXCIpIHtcbiAgICBjb25zdCBsYXllckluZm8gPSBnZXRBbmFseXplZExheWVySW5mbyh7fSwgdHJ1ZSk7XG4gICAgY29uc3QgZm9ybWF0dGVkTGF5ZXJJbmZvID0gZ2V0TGF5ZXJUb0FwcGVuZChsYXllckluZm8sIHB1Ymxpc2hJbmZvKTsgLy9VcGRhdGVkIGluZm8gbmVlZHMgdG8gYmUgYWRkZWQgdG8gdGhlIGxheWVycyBbXSByYXRoZXIgdGhhbiB0aGUgcm9vdCBmb3IgZXhjZWxcbiAgICBmb3JtYXR0ZWRMYXllckluZm8uZGF0ZUZpZWxkc1RpbWVSZWZlcmVuY2UgPSB0aW1lem9uZUluZm8uZGF0ZUZpZWxkc1RpbWVSZWZlcmVuY2U7XG4gICAgcHVibGlzaEluZm8ubmFtZSA9IGRhdGFMYXllci5uYW1lO1xuICAgIGFwcGVuZFNvdXJjZUluZm8gPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aW1lem9uZUluZm8pLCB7IGxheWVyczogW2Zvcm1hdHRlZExheWVySW5mb10gfSksIHB1Ymxpc2hJbmZvKSwgcmVzdCk7XG4gIH1cbiAgZWxzZSB7XG4gICAgYXBwZW5kU291cmNlSW5mbyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aW1lem9uZUluZm8pLCBwdWJsaXNoUGFyYW1ldGVycyksIHJlc3QpO1xuICB9XG4gIGZpbmFsQXBwZW5kUGFyYW1ldGVycyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdEFwcGVuZFBhcmFtcyksIHsgYXBwZW5kU291cmNlSW5mbzogSlNPTi5zdHJpbmdpZnkoYXBwZW5kU291cmNlSW5mbykgfSk7XG4gIGlmIChhZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwiYWRkXCIpIHtcbiAgICBmaW5hbEFwcGVuZFBhcmFtZXRlcnMudXBzZXJ0TWF0Y2hpbmdGaWVsZCA9IHNvdXJjZURhdGFMYXllci5vYmplY3RJZEZpZWxkIHx8ICgoX2EgPSBzb3VyY2VEYXRhTGF5ZXIudW5pcXVlRmllbGQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5uYW1lKTtcbiAgfVxuICBlbHNlIHtcbiAgICBpZiAodXBzZXJ0ICYmICh1aWRQYWlyID09PSBudWxsIHx8IHVpZFBhaXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVpZFBhaXIuaXNVbmlxdWVJbmRleCkpIHtcbiAgICAgIGZpbmFsQXBwZW5kUGFyYW1ldGVycy51cHNlcnRNYXRjaGluZ0ZpZWxkID0gdWlkUGFpciA9PT0gbnVsbCB8fCB1aWRQYWlyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1aWRQYWlyLm5hbWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBmaW5hbEFwcGVuZFBhcmFtZXRlcnM7XG59XG5mdW5jdGlvbiBnZXRMYXllclRvQXBwZW5kKGxheWVySW5mbywgdXBkYXRlZEluZm8pIHtcbiAgY29uc3QgZm9ybWF0dGVkTGF5ZXIgPSBPYmplY3QuYXNzaWduKHt9LCBsYXllckluZm8pO1xuICBmb3JtYXR0ZWRMYXllci5sb2NhdGlvblR5cGUgPSB1cGRhdGVkSW5mby5sb2NhdGlvblR5cGU7XG4gIGlmIChmb3JtYXR0ZWRMYXllci5sb2NhdGlvblR5cGUgPT09IFwiYWRkcmVzc1wiKSB7XG4gICAgZm9ybWF0dGVkTGF5ZXIuYWRkcmVzc0ZpZWxkcyA9IHVwZGF0ZWRJbmZvLmFkZHJlc3NGaWVsZHM7XG4gICAgZm9ybWF0dGVkTGF5ZXIuc291cmNlQ291bnRyeSA9IHVwZGF0ZWRJbmZvLnNvdXJjZUNvdW50cnk7XG4gIH1cbiAgZWxzZSBpZiAoZm9ybWF0dGVkTGF5ZXIubG9jYXRpb25UeXBlID09PSBcImNvb3JkaW5hdGVzXCIpIHtcbiAgICBmb3JtYXR0ZWRMYXllci5jb29yZGluYXRlRmllbGRUeXBlID0gdXBkYXRlZEluZm8uY29vcmRpbmF0ZUZpZWxkVHlwZTtcbiAgICBpZiAoZm9ybWF0dGVkTGF5ZXIuY29vcmRpbmF0ZUZpZWxkVHlwZSA9PT0gXCJMYXRpdHVkZUFuZExvbmdpdHVkZVwiKSB7XG4gICAgICBmb3JtYXR0ZWRMYXllci5sYXRpdHVkZUZpZWxkTmFtZSA9IHVwZGF0ZWRJbmZvLmxhdGl0dWRlRmllbGROYW1lO1xuICAgICAgZm9ybWF0dGVkTGF5ZXIubG9uZ2l0dWRlRmllbGROYW1lID0gdXBkYXRlZEluZm8ubG9uZ2l0dWRlRmllbGROYW1lO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGZvcm1hdHRlZExheWVyLmNvb3JkaW5hdGVGaWVsZE5hbWUgPSB1cGRhdGVkSW5mby5jb29yZGluYXRlRmllbGROYW1lO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZm9ybWF0dGVkTGF5ZXI7XG59XG5mdW5jdGlvbiBmb3JtYXRGaWVsZE1hcHBpbmdzKGZpZWxkTWFwcGluZ3MpIHtcbiAgY29uc3QgZmllbGRzID0gZmllbGRNYXBwaW5ncy5maWx0ZXIoKGZpZWxkTWFwcGluZykgPT4ge1xuICAgIHJldHVybiBmaWVsZE1hcHBpbmcuc291cmNlICE9PSBOT05FX1ZBTFVFO1xuICB9KTtcbiAgY29uc3QgZmluYWxGaWVsZE1hcHBpbmdzID0gZmllbGRzLm1hcCgoeyBzb3VyY2UsIG5hbWUgfSkgPT4ge1xuICAgIHJldHVybiB7IHNvdXJjZSwgbmFtZSB9O1xuICB9KTtcbiAgcmV0dXJuIGZpbmFsRmllbGRNYXBwaW5ncztcbn1cbmZ1bmN0aW9uIGNyZWF0ZUFwcGVuZEZpZWxkcyhmaWVsZE1hcHBpbmdzKSB7XG4gIGNvbnN0IGFwcGVuZEZpZWxkcyA9IGZpZWxkTWFwcGluZ3MubWFwKChtYXBwaW5nKSA9PiB7XG4gICAgcmV0dXJuIG1hcHBpbmcubmFtZTtcbiAgfSk7XG4gIHJldHVybiBhcHBlbmRGaWVsZHM7XG59XG5cbmV4cG9ydCB7IGNhbk1hdGNoRmllbGQgYXMgYywgZ2V0QXBwZW5kUGFyYW1ldGVycyBhcyBnIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2My4wLjk5XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LTkyZWJiMzk2LmpzJztcbmltcG9ydCB7IGEgYXMgYWRkSXRlbVN0YXRlIH0gZnJvbSAnLi9hZGQtaXRlbS05N2Q1NzdhOS5qcyc7XG5pbXBvcnQgeyBOIGFzIE5PTkVfVkFMVUUgfSBmcm9tICcuL2FwcGVuZC01OGE3ZTdhYi5qcyc7XG5pbXBvcnQgeyB1IGFzIHVpU3RvcmVTdGF0ZSB9IGZyb20gJy4vdWktZWNmODZiYmEuanMnO1xuaW1wb3J0IHsgYyBhcyBjYW5NYXRjaEZpZWxkIH0gZnJvbSAnLi9hcHBlbmQtNjNjNWNlODMuanMnO1xuaW1wb3J0IHsgZCBhcyBkZWxldGVJdGVtIH0gZnJvbSAnLi9zZXJ2ZXItaXRlbS1mMTIxNTNlNi5qcyc7XG5pbXBvcnQgeyBhIGFzIGFwcGVuZCB9IGZyb20gJy4vYXBwZW5kLTM1MjA4M2ZkLmpzJztcbmltcG9ydCAnLi9pbmRleC04MWQ1NDhiNy5qcyc7XG5pbXBvcnQgJy4vZ2VvY29kZS03ZWI3YzBkZi5qcyc7XG5pbXBvcnQgJy4vZnVuY3Rpb25hbC1jODJmNWFiOS5qcyc7XG5pbXBvcnQgJy4vcHJpdmlsZWdlcy1jY2Q1ZjM3ZC5qcyc7XG5pbXBvcnQgJy4vcHJpdmlsZWdlcy0zNTU5MGViNC5qcyc7XG5pbXBvcnQgJy4vY29uZmlnLWViNWY3ZGMyLmpzJztcbmltcG9ydCAnLi9wb3J0YWwtNzljYWFlZmYuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWFhZjMwYmQ2LmpzJztcbmltcG9ydCAnLi9pdGVtLXR5cGVzLWI0ZmU4NmFkLmpzJztcbmltcG9ydCAnLi9pdGVtLXByb3BlcnRpZXMtZTY0MTJhOWEuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtOWY2NDhiZWUuanMnO1xuaW1wb3J0ICcuL2ZlYXR1cmUtbGF5ZXItMzhjZGFlODcuanMnO1xuaW1wb3J0ICcuL2ZlYXR1cmUtbGF5ZXItZDMzZWExMTQuanMnO1xuaW1wb3J0ICcuL2d1aWQtNGY0MTc2YmEuanMnO1xuaW1wb3J0ICcuL3RodW1ibmFpbC0wYjdhZGZjZC5qcyc7XG5pbXBvcnQgJy4vcXVlcnktNGY3YjdlNGQuanMnO1xuaW1wb3J0ICcuL3VzZXItZTNkZWRjNGEuanMnO1xuaW1wb3J0ICcuL2FwaS1mNzkzNGNkNy5qcyc7XG5pbXBvcnQgJy4vaXRlbS1kOWQ3MDQxNi5qcyc7XG5pbXBvcnQgJy4vZG9tLTEzZjViMDBjLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTY5MzA1YTg1LmpzJztcbmltcG9ydCAnLi9hZ3MtNjhkNGFlMjAuanMnO1xuaW1wb3J0ICcuL3VybC1mM2I4MmNjNy5qcyc7XG5pbXBvcnQgJy4vc3RvcmFnZS1kN2Y1ODIyZS5qcyc7XG5pbXBvcnQgJy4vZmlsZS1mMzYxOTNlOS5qcyc7XG5pbXBvcnQgJy4vc3RvcmUtMzIxMGI2MDQuanMnO1xuXG5jb25zdCBhcmNnaXNOZXdJdGVtUGFnZXNBcHBlbmRNYXRjaEZpZWxkc0NzcyA9IFwiLmZpZWxkcy1jb250YWluZXJ7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjtoZWlnaHQ6MTAwJTtvdmVyZmxvdy15OmF1dG87b3ZlcmZsb3cteDpoaWRkZW59LmZpZWxkLXRhYmxle21hcmdpbi1ib3R0b206MS41cmVtO292ZXJmbG93OmF1dG87ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbn0uc2VhcmNoLWNvbnRhaW5lcntkaXNwbGF5OmZsZXg7d2lkdGg6MTAwJX0uZmllbGQtc2VhcmNoe3dpZHRoOjUwJTttYXJnaW4tcmlnaHQ6MC41cmVtfS5maWVsZC1zZWxlY3R7d2lkdGg6NTAlfS5maWVsZC1uYW1lLWNvbHVtbnt3aWR0aDo1MCU7bWFyZ2luLXJpZ2h0OjAuNXJlbX0ubWF0Y2gtZmllbGQtbmFtZS1jb2x1bW57d2lkdGg6NTAlfS5maWVsZHMtc2Nyb2xsLWNvbnRhaW5lcntkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO21hcmdpbi1ib3R0b206MC43NXJlbTtwYWRkaW5nLWJvdHRvbTowLjc1cmVtO2JvcmRlci1ib3R0b206MC4xMjVyZW0gc29saWQgdmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTMpfS5oZWFkZXItcm93e2Rpc3BsYXk6ZmxleDthbGlnbi1jb250ZW50OmZsZXgtc3RhcnQ7anVzdGlmeS1jb250ZW50OmNlbnRlcjtmb250LXdlaWdodDo1MDA7Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0xKTtncmlkLWdhcDowLjI1cmVtO2dhcDowLjI1cmVtO3BhZGRpbmc6MC4yNXJlbX0uaGVhZGVyLWNlbGx7ZGlzcGxheTpmbGV4O3dpZHRoOjEwMCU7Zm9udC1zaXplOjFyZW19LmhpZGV7ZGlzcGxheTpub25lfS5ub3QtdmlzaWJsZXt2aXNpYmlsaXR5OmhpZGRlbjtoZWlnaHQ6MH0uY2VsbHtib3gtc2l6aW5nOmJvcmRlci1ib3g7d2lkdGg6MzMuMzMzMzMzJTt3aWR0aDoxMDAlfS5jZWxsIGxhYmVse21hcmdpbi10b3A6MC43NXJlbX0ucm93e2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpjZW50ZXI7Z3JpZC1nYXA6MC4yNXJlbTtnYXA6MC4yNXJlbTtwYWRkaW5nOjAuMjVyZW07bWFyZ2luLWJvdHRvbTowLjc1cmVtO2ZvbnQtd2VpZ2h0OjUwMDtmb250LXNpemU6MXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMSk7Ym9yZGVyLWJvdHRvbTowLjEyNXJlbSBzb2xpZCB2YXIoLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMyl9LmRlc2VsZWN0ZWR7b3BhY2l0eTp2YXIoLS1jYWxjaXRlLXVpLW9wYWNpdHktZGlzYWJsZWQpfS5zY3JlZW4tcmVhZGVycy1vbmx5e3Bvc2l0aW9uOmFic29sdXRlO3dpZHRoOjFweDtoZWlnaHQ6MXB4O3BhZGRpbmc6MDttYXJnaW46LTFweDtvdmVyZmxvdzpoaWRkZW47Y2xpcDpyZWN0KDAsIDAsIDAsIDApO3doaXRlLXNwYWNlOm5vd3JhcDtib3JkZXItd2lkdGg6MH0ubGFiZWx7LS1jYWxjaXRlLWxhYmVsLW1hcmdpbi1ib3R0b206MH0uYXBwZW5kLXRpbWV6b25le2JvcmRlci10b3A6MC4wNjNyZW0gc29saWQgdmFyKC0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTMpfS5mcm9tLXRvLWZpZWxkc3tkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246cm93fS5kZXNjcmlwdGlvbntmb250LXNpemU6MC44NzVyZW07Zm9udC13ZWlnaHQ6MzAwO21hcmdpbi1ib3R0b206MXJlbX0uaGVhZGVye2ZvbnQtd2VpZ2h0OjUwMDtmb250LXNpemU6MXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLXVpLXRleHQtMSk7bWFyZ2luLWJvdHRvbTowLjVyZW19Lm5vLWZpZWxkc3ttYXJnaW4tYm90dG9tOjEuNXJlbX0ucG9wb3Zlci1pY29ue2NvbG9yOnZhcigtLWNhbGNpdGUtdWktdGV4dC0zKTtjdXJzb3I6cG9pbnRlcjttYXJnaW4tdG9wOjAuMTI1cmVtOy13ZWJraXQtbWFyZ2luLXN0YXJ0OjAuNzVyZW07bWFyZ2luLWlubGluZS1zdGFydDowLjc1cmVtfS5wb3BvdmVyLWNvbnRlbnR7Zm9udC1zaXplOjAuNzVyZW07Zm9udC13ZWlnaHQ6NDAwO21hcmdpbjowfS5oZWFkZXItcG9wb3ZlcnttYXJnaW4tdG9wOi0wLjMxM3JlbX1cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kTWF0Y2hGaWVsZHMgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1VcGRhdGVQYWdlXCIsIDcpO1xuICAgIHRoaXMubmV3SXRlbVByZXZQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtUHJldlBhZ2VcIiwgNyk7XG4gICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJ3b3JrZmxvd0NvbXBsZXRlXCIsIDcpO1xuICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWRcIiwgNyk7XG4gICAgdGhpcy5uZXdJdGVtRGlzYWJsZUNsb3NlQnV0dG9ucyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbURpc2FibGVDbG9zZUJ1dHRvbnNcIiwgNyk7XG4gICAgdGhpcy52YWxpZGF0ZWRGaWVsZHMgPSBbXTtcbiAgICB0aGlzLmZpZWxkcyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmkxOG4gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5maWVsZE1hdGNoZXMgPSBbXTtcbiAgICB0aGlzLmVycm9yID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgIHRoaXMubG9hZGVyVHlwZSA9IFwiaW5kZXRlcm1pbmF0ZVwiO1xuICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IHVuZGVmaW5lZDtcbiAgfVxuICBoYW5kbGVOZXh0KCkge1xuICAgIGNvbnN0IG1hdGNoaW5nQ29tcGxldGlvbkVycm9yID0gdGhpcy52YWxpZGF0ZU1hdGNoaW5ncygpO1xuICAgIGlmIChtYXRjaGluZ0NvbXBsZXRpb25FcnJvcikge1xuICAgICAgdGhpcy5lcnJvciA9IG1hdGNoaW5nQ29tcGxldGlvbkVycm9yO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBhZGRJdGVtU3RhdGUuZmllbGRNYXBwaW5ncyA9IHRoaXMuZmllbGRNYXRjaGVzO1xuICAgIGlmIChhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcImFkZFwiKSB7XG4gICAgICB0aGlzLmhhbmRsZUFwcGVuZCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJhcHBlbmRTZWxlY3RVcGRhdGVcIik7XG4gIH1cbiAgdmFsaWRhdGVNYXRjaGluZ3MoKSB7XG4gICAgLy9yZXR1cm4gYW4gZXJyb3JcbiAgICBjb25zdCBub01hdGNoZXMgPSB0aGlzLmZpZWxkTWF0Y2hlcy5ldmVyeSgoZmllbGQpID0+IHtcbiAgICAgIHJldHVybiBmaWVsZC5zb3VyY2UgPT09IE5PTkVfVkFMVUU7XG4gICAgfSk7XG4gICAgaWYgKCFub01hdGNoZXMpIHtcbiAgICAgIGNvbnN0IG5vbk51bGxhYmxlRmllbGRzTGVuZ3RoID0gdGhpcy5maWVsZE1hdGNoZXMuZmlsdGVyKChmaWVsZCkgPT4gIWZpZWxkLmRpc2FibGVkICYmICFmaWVsZC5udWxsYWJsZSAmJiBmaWVsZC5zb3VyY2UgPT09IE5PTkVfVkFMVUUpLmxlbmd0aDtcbiAgICAgIGlmIChub25OdWxsYWJsZUZpZWxkc0xlbmd0aCA8PSAwKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGl0bGU6IHRoaXMuaTE4bi5lcnJvcnMubm9uTnVsbGFibGVFcnJvclRpdGxlLFxuICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5pMThuLmVycm9ycy5ub25OdWxsYWJsZUVycm9yRGVzY3JpcHRpb25cbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB7IHRpdGxlOiB0aGlzLmVycm9yTGFiZWwsIGRlc2NyaXB0aW9uOiB0aGlzLmkxOG4uZXJyb3JzLm5vTWF0Y2hlZEZpZWxkcyB9O1xuICB9XG4gIGRpc2FibGVNb2RhbEJ1dHRvbnMoZGlzYWJsZSkge1xuICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkLmVtaXQoIWRpc2FibGUpO1xuICAgIHRoaXMubmV3SXRlbURpc2FibGVDbG9zZUJ1dHRvbnMuZW1pdChkaXNhYmxlKTtcbiAgfVxuICBhc3luYyBoYW5kbGVBcHBlbmQoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCB7IHNvdXJjZURhdGFMYXllciwgZXhpc3RpbmdJdGVtLCB0aW1lem9uZSwgYW5hbHl6ZVJlc3VsdHMsIHR5cGUsIGZpZWxkTWFwcGluZ3MsIGRhdGFMYXllciwgaWQsIHVpZFBhaXIsIGFkZEFwcGVuZFNlbGVjdE9wdGlvbiB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIHRoaXMuZGlzYWJsZU1vZGFsQnV0dG9ucyh0cnVlKTtcbiAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZC5hcHBlbmRMb2FkaW5nTWVzc2FnZXMuYXBwZW5kQ2xvc2VOb3RpY2U7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhcHBlbmQoe1xuICAgICAgc291cmNlRGF0YUxheWVyLFxuICAgICAgZXhpc3RpbmdJdGVtLFxuICAgICAgdGltZXpvbmUsXG4gICAgICBhbmFseXplUmVzdWx0cyxcbiAgICAgIHR5cGUsXG4gICAgICBmaWVsZE1hcHBpbmdzLFxuICAgICAgZGF0YUxheWVyLFxuICAgICAgaWQsXG4gICAgICB1aWRQYWlyLFxuICAgICAgYWRkQXBwZW5kU2VsZWN0T3B0aW9uXG4gICAgfSk7XG4gICAgaWYgKCgoX2IgPSAoX2EgPSByZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2UucmVzdWx0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhdHVzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudG9Mb3dlckNhc2UoKSkgPT09IFwiY29tcGxldGVkXCIpIHtcbiAgICAgIGF3YWl0IGRlbGV0ZUl0ZW0oYWRkSXRlbVN0YXRlLmlkLCB7IHBlcm1hbmVudERlbGV0ZTogdHJ1ZSB9KTtcbiAgICAgIGNvbnN0IGVtaXRQYXlsb2FkID0gT2JqZWN0LmFzc2lnbih7XG4gICAgICAgIC8vIGBwdWJsaXNoUmVzcG9uc2VgIGRvZXNuJ3QgZm9yIHNvbWUgZmxvd3Mgc28gdXNlIHRoaXMgaWQgaW5zdGVhZFxuICAgICAgICBhcHBlbmRUeXBlOiBhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0T3B0aW9uXG4gICAgICB9LCByZXNwb25zZSk7XG4gICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUuZW1pdChlbWl0UGF5bG9hZCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5kaXNhYmxlTW9kYWxCdXR0b25zKGZhbHNlKTtcbiAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgdGhpcy5lcnJvciA9IHtcbiAgICAgICAgdGl0bGU6IHVpU3RvcmVTdGF0ZS5pMThuLmVycm9yLFxuICAgICAgICBkZXNjcmlwdGlvbjogdWlTdG9yZVN0YXRlLmkxOG4uYXBwZW5kLmFwcGVuZEVycm9yTWVzc2FnZXMuYXBwZW5kRXJyb3JcbiAgICAgIH07XG4gICAgfVxuICB9XG4gIGFzeW5jIGhhbmRsZVByZXYoZXZlbnQpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKHRoaXMubG9hZGluZykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJhZGRcIiAmJlxuICAgICAgISgoKF9hID0gYWRkSXRlbVN0YXRlLmFuYWx5emVSZXN1bHRzLnB1Ymxpc2hQYXJhbWV0ZXJzLmxheWVycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgPiAxKSkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMubmV3SXRlbVByZXZQYWdlLmVtaXQoKTtcbiAgICB9XG4gIH1cbiAgaGFuZGxlRmllbGRDaGFuZ2UoZXZlbnQpIHtcbiAgICBjb25zdCBuZXdGaWVsZE1hcHBpbmcgPSBPYmplY3QuYXNzaWduKHt9LCBldmVudC5kZXRhaWwpO1xuICAgIHRoaXMudmFsaWRhdGVGaWVsZE1hcHBpbmdzKHRoaXMudmFsaWRhdGVkRmllbGRzLCBuZXdGaWVsZE1hcHBpbmcpO1xuICB9XG4gIHNvcnRGaWVsZHMoKSB7XG4gICAgdGhpcy5maWVsZE1hdGNoZXMgPSB0aGlzLmZpZWxkTWF0Y2hlcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICBjb25zdCBuYW1lQSA9IGEubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgY29uc3QgbmFtZUIgPSBiLm5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgIGlmIChuYW1lQSA8IG5hbWVCKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKG5hbWVBID4gbmFtZUIpIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgICB9XG4gICAgICByZXR1cm4gMDtcbiAgICB9KTtcbiAgfVxuICB2YWxpZGF0ZUZpZWxkTWFwcGluZ3MoY3VycmVudEZpZWxkTWFwcGluZ3MsIG5ld0ZpZWxkTWFwcGluZykge1xuICAgIG5ld0ZpZWxkTWFwcGluZy5pbml0aWFsTWF0Y2ggPSBuZXdGaWVsZE1hcHBpbmcuc291cmNlO1xuICAgIGlmIChuZXdGaWVsZE1hcHBpbmcuc291cmNlICE9PSB0aGlzLm5vbmVTdHJpbmcpIHtcbiAgICAgIGNvbnN0IGR1cGxpY2F0ZSA9IGN1cnJlbnRGaWVsZE1hcHBpbmdzLmZpbHRlcigobWFwcGluZykgPT4ge1xuICAgICAgICByZXR1cm4gbWFwcGluZy5zb3VyY2UgPT09IG5ld0ZpZWxkTWFwcGluZy5zb3VyY2U7XG4gICAgICB9KTtcbiAgICAgIGlmICgoZHVwbGljYXRlID09PSBudWxsIHx8IGR1cGxpY2F0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZHVwbGljYXRlLmxlbmd0aCkgPiAwKSB7XG4gICAgICAgIGNvbnN0IGR1cGxpY2F0ZUluZGV4ID0gZHVwbGljYXRlWzBdLmlkeDtcbiAgICAgICAgY3VycmVudEZpZWxkTWFwcGluZ3NbZHVwbGljYXRlSW5kZXhdLmluaXRpYWxNYXRjaCA9IHRoaXMubm9uZVN0cmluZztcbiAgICAgICAgY3VycmVudEZpZWxkTWFwcGluZ3NbZHVwbGljYXRlSW5kZXhdLnNvdXJjZSA9IHRoaXMubm9uZVN0cmluZztcbiAgICAgIH1cbiAgICB9XG4gICAgY3VycmVudEZpZWxkTWFwcGluZ3NbbmV3RmllbGRNYXBwaW5nLmlkeF0gPSBuZXdGaWVsZE1hcHBpbmc7XG4gICAgdGhpcy52YWxpZGF0ZWRGaWVsZHMgPSBjdXJyZW50RmllbGRNYXBwaW5ncztcbiAgICB0aGlzLmZpZWxkTWF0Y2hlcyA9IFsuLi50aGlzLnZhbGlkYXRlZEZpZWxkc107XG4gICAgdGhpcy5zb3J0RmllbGRzKCk7XG4gIH1cbiAgc2V0TmV4dFRleHQoKSB7XG4gICAgdWlTdG9yZVN0YXRlLm5leHRUZXh0ID1cbiAgICAgIGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwiYWRkXCIgPyBcImFkZEFuZENvbXBsZXRlXCIgOiBcIm5leHRcIjtcbiAgfVxuICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICBjb25zdCB7IGFkZEFwcGVuZFNlbGVjdE9wdGlvbiwgdWlkUGFpciwgc291cmNlRGF0YUxheWVyLCBiYWNrdXBMYXllckZpZWxkcyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIHRoaXMuaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZE1hdGNoRmllbGRzO1xuICAgIHRoaXMuZXJyb3JMYWJlbCA9IHVpU3RvcmVTdGF0ZS5pMThuLmVycm9yO1xuICAgIHRoaXMubm9uZVN0cmluZyA9IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZEtleVZhbHVlUGFpci5ub25lRmllbGQ7XG4gICAgY29uc3QgZGF0YUxheWVyRmllbGRzID0gYmFja3VwTGF5ZXJGaWVsZHM7XG4gICAgY29uc3Qgc2VydmljZUxheWVyRmllbGRzID0gc291cmNlRGF0YUxheWVyLnR5cGUgPT09IFwiY3N2XCIgPyBbc291cmNlRGF0YUxheWVyLmxheWVySW5mb10gOiBzb3VyY2VEYXRhTGF5ZXIuZmllbGRzO1xuICAgIHRoaXMuc2V0TmV4dFRleHQoKTtcbiAgICB0aGlzLnNlbGVjdGVkS2V5UGFpciA9IHVpZFBhaXI7XG4gICAgY29uc3QgdXBkYXRlRXhpc3RpbmdGZWF0dXJlcyA9IGFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJ1cHNlcnRcIiB8fCBhZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwidXBkYXRlXCI7XG4gICAgY29uc3Qgc2VydmljZVVJREZpZWxkcyA9IGFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJhZGRcIlxuICAgICAgPyBudWxsXG4gICAgICA6IGFkZEl0ZW1TdGF0ZS5zZXJ2aWNlVUlERmllbGRzLm1hcCgoZmllbGQpID0+IHtcbiAgICAgICAgcmV0dXJuIGZpZWxkLm5hbWU7XG4gICAgICB9KTtcbiAgICBsZXQgZmllbGRzTGlzdEluZGV4ID0gYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcImFkZFwiID8gMCA6IDE7XG4gICAgc2VydmljZUxheWVyRmllbGRzLmZvckVhY2goKGxheWVySW5mbykgPT4ge1xuICAgICAgaWYgKChsYXllckluZm8gPT09IG51bGwgfHwgbGF5ZXJJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllckluZm8udHlwZSkgIT09IFwiZXNyaUZpZWxkVHlwZU9JRFwiICYmXG4gICAgICAgIChsYXllckluZm8gPT09IG51bGwgfHwgbGF5ZXJJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllckluZm8udHlwZSkgIT09IFwiZXNyaUZpZWxkVHlwZUdsb2JhbElEXCIgJiZcbiAgICAgICAgbGF5ZXJJbmZvLmVkaXRhYmxlICYmXG4gICAgICAgICghdXBkYXRlRXhpc3RpbmdGZWF0dXJlcyB8fCAhc2VydmljZVVJREZpZWxkcy5pbmNsdWRlcyhsYXllckluZm8ubmFtZSkpKSB7XG4gICAgICAgIC8vbWF0Y2ggZmllbGRzIHRoYXQgYXJlIG5vdCB1aWRcbiAgICAgICAgdGhpcy5maWVsZE1hdGNoZXMucHVzaCh0aGlzLmNyZWF0ZUZpZWxkTWFwcGluZyhsYXllckluZm8sIGRhdGFMYXllckZpZWxkcywgZmllbGRzTGlzdEluZGV4KSk7XG4gICAgICAgIHRoaXMudmFsaWRhdGVkRmllbGRzLnB1c2godGhpcy5jcmVhdGVGaWVsZE1hcHBpbmcobGF5ZXJJbmZvLCBkYXRhTGF5ZXJGaWVsZHMsIGZpZWxkc0xpc3RJbmRleCkpO1xuICAgICAgICBmaWVsZHNMaXN0SW5kZXgrKztcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoYWRkQXBwZW5kU2VsZWN0T3B0aW9uICE9PSBcImFkZFwiKSB7XG4gICAgICB0aGlzLmZpZWxkTWF0Y2hlcy51bnNoaWZ0KHRoaXMuc2VsZWN0ZWRLZXlQYWlyKTtcbiAgICAgIHRoaXMudmFsaWRhdGVkRmllbGRzLnVuc2hpZnQodGhpcy5zZWxlY3RlZEtleVBhaXIpO1xuICAgIH1cbiAgICB0aGlzLnNvcnRGaWVsZHMoKTtcbiAgfVxuICBjcmVhdGVGaWVsZE1hcHBpbmcoc2VydmljZUxheWVyRmllbGQsIGRhdGFMYXllckZpZWxkcywgc2VydmljZUxheWVySW5kZXgpIHtcbiAgICBjb25zdCBhZGRyZXNzRmllbGRzID0gYWRkSXRlbVN0YXRlLmRhdGFMYXllci5hZGRyZXNzRmllbGRzXG4gICAgICA/IE9iamVjdC52YWx1ZXMoYWRkSXRlbVN0YXRlLmRhdGFMYXllci5hZGRyZXNzRmllbGRzKVxuICAgICAgOiBudWxsO1xuICAgIGxldCBtYXRjaGVkID0gdGhpcy5ub25lU3RyaW5nO1xuICAgIGNvbnN0IHBvc3NpYmxlTWF0Y2hlcyA9IFtcbiAgICAgIHtcbiAgICAgICAgc291cmNlOiB0aGlzLm5vbmVTdHJpbmcsXG4gICAgICAgIG5hbWU6IHNlcnZpY2VMYXllckZpZWxkLm5hbWUsXG4gICAgICAgIHR5cGU6IFwiTm9uZVwiLFxuICAgICAgICBpZHg6IHNlcnZpY2VMYXllckluZGV4XG4gICAgICB9XG4gICAgXTtcbiAgICBkYXRhTGF5ZXJGaWVsZHMuZm9yRWFjaCgoZmllbGRJbmZvKSA9PiB7XG4gICAgICBpZiAoY2FuTWF0Y2hGaWVsZChzZXJ2aWNlTGF5ZXJGaWVsZCwgZmllbGRJbmZvKSAmJlxuICAgICAgICAoYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJhZGRcIlxuICAgICAgICAgID8gdHJ1ZVxuICAgICAgICAgIDogZmllbGRJbmZvLm5hbWUgIT09IHRoaXMuc2VsZWN0ZWRLZXlQYWlyLnNvdXJjZSkpIHtcbiAgICAgICAgcG9zc2libGVNYXRjaGVzLnB1c2goe1xuICAgICAgICAgIHNvdXJjZTogZmllbGRJbmZvLm5hbWUsXG4gICAgICAgICAgbmFtZTogc2VydmljZUxheWVyRmllbGQubmFtZSxcbiAgICAgICAgICB0eXBlOiBzZXJ2aWNlTGF5ZXJGaWVsZC50eXBlLFxuICAgICAgICAgIGlkeDogc2VydmljZUxheWVySW5kZXhcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChzZXJ2aWNlTGF5ZXJGaWVsZC5uYW1lLnRvTG93ZXJDYXNlKCkgPT09IGZpZWxkSW5mby5uYW1lLnRvTG93ZXJDYXNlKCkgJiZcbiAgICAgICAgICAoc2VydmljZUxheWVyRmllbGQudHlwZSA9PT0gZmllbGRJbmZvLnR5cGUgfHxcbiAgICAgICAgICAgICEhKGFkZHJlc3NGaWVsZHMgPT09IG51bGwgfHwgYWRkcmVzc0ZpZWxkcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYWRkcmVzc0ZpZWxkcy5maW5kKChmaWVsZCkgPT4gZmllbGQgPT09IGZpZWxkSW5mby5kaXNwbGF5TmFtZSB8fCBmaWVsZCA9PT0gZmllbGRJbmZvLm5hbWUpKSkgJiZcbiAgICAgICAgICAoYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJhZGRcIlxuICAgICAgICAgICAgPyB0cnVlXG4gICAgICAgICAgICA6IGZpZWxkSW5mby5uYW1lICE9PSB0aGlzLnNlbGVjdGVkS2V5UGFpci5zb3VyY2UpKSB7XG4gICAgICAgICAgbWF0Y2hlZCA9IGZpZWxkSW5mby5uYW1lO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNvdXJjZTogbWF0Y2hlZCxcbiAgICAgIG5hbWU6IHNlcnZpY2VMYXllckZpZWxkLm5hbWUsXG4gICAgICBudWxsYWJsZTogc2VydmljZUxheWVyRmllbGQubnVsbGFibGUsXG4gICAgICB0eXBlOiBzZXJ2aWNlTGF5ZXJGaWVsZC50eXBlLFxuICAgICAgaWR4OiBzZXJ2aWNlTGF5ZXJJbmRleCxcbiAgICAgIGluaXRpYWxNYXRjaDogbWF0Y2hlZCxcbiAgICAgIHBvc3NpYmxlTWF0Y2hlc1xuICAgIH07XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgaTE4biwgZXJyb3IgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBvcmlnaW5hbEZpbGVOYW1lLCBleGlzdGluZ0l0ZW0gfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBjb25zdCByb3dIZWFkZXJJbmZvID0ge1xuICAgICAgb3JpZ2luYWxGaWVsZDoge1xuICAgICAgICBoZWFkZXI6IGkxOG4ub3JpZ2luYWxGaWVsZC5oZWFkZXIsXG4gICAgICAgIG1vcmVJbmZvOiBpMThuLm9yaWdpbmFsRmllbGQubW9yZUluZm8ucmVwbGFjZShcIiR7ZmVhdHVyZUxheWVyTmFtZX1cIiwgZXhpc3RpbmdJdGVtLnRpdGxlKVxuICAgICAgfSxcbiAgICAgIHVwbG9hZGVkRmllbGQ6IHtcbiAgICAgICAgaGVhZGVyOiBpMThuLnVwbG9hZGVkRmllbGQuaGVhZGVyLFxuICAgICAgICBtb3JlSW5mbzogaTE4bi51cGxvYWRlZEZpZWxkLm1vcmVJbmZvLnJlcGxhY2UoXCIke3VwbG9hZGVkRmlsZU5hbWV9XCIsIG9yaWdpbmFsRmlsZU5hbWUpXG4gICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBkZXNjcmlwdGlvbiA9IGkxOG4uZGVzY3JpcHRpb25cbiAgICAgIC5yZXBsYWNlKFwiJHt1cGxvYWRlZEZpbGVOYW1lfVwiLCBvcmlnaW5hbEZpbGVOYW1lKVxuICAgICAgLnJlcGxhY2UoXCIke2ZlYXR1cmVMYXllck5hbWV9XCIsIGV4aXN0aW5nSXRlbS50aXRsZSk7XG4gICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IHsgXCJvdmVyZmxvdy1oaWRkZW5cIjogdGhpcy5sb2FkaW5nIH0gfSwgaChcImFyY2dpcy1uZXctaXRlbS1sb2FkZXJcIiwgeyB0eXBlOiB0aGlzLmxvYWRlclR5cGUsIGFjdGl2ZTogdGhpcy5sb2FkaW5nLCB0ZXh0OiB0aGlzLmxvYWRlck1lc3NhZ2UgfSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJoZWFkZXJcIiB9LCBcIiBcIiwgaTE4bi5oZWFkZXIsIFwiIFwiKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImRlc2NyaXB0aW9uXCIgfSwgZGVzY3JpcHRpb24pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwicm93XCIsIHJvbGU6IFwicm93XCIgfSwgT2JqZWN0LmtleXMocm93SGVhZGVySW5mbykubWFwKChyb3dIZWFkZXIpID0+IHtcbiAgICAgIGNvbnN0IHsgaGVhZGVyLCBtb3JlSW5mbyB9ID0gcm93SGVhZGVySW5mb1tyb3dIZWFkZXJdO1xuICAgICAgcmV0dXJuIChoKFwic3BhblwiLCB7IGNsYXNzOiBcImhlYWRlci1jZWxsXCIsIHJvbGU6IFwiY29sdW1uaGVhZGVyXCIsIFwiYXJpYS1zb3J0XCI6IFwibm9uZVwiIH0sIGhlYWRlciwgaChcImFyY2dpcy1pbmZvcm1hdGlvblwiLCB7IGNsYXNzOiBcImhlYWRlci1wb3BvdmVyXCIsIGxhYmVsOiBtb3JlSW5mbywgcGxhY2VtZW50OiBcInRvcC1zdGFydFwiLCBwYWRkZWRDb250ZW50OiB0cnVlIH0sIGgoXCJwXCIsIHsgY2xhc3M6IFwicG9wb3Zlci1jb250ZW50XCIgfSwgbW9yZUluZm8pKSkpO1xuICAgIH0pKSwgdGhpcy5maWVsZE1hdGNoZXMubGVuZ3RoID4gMCA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZmllbGRzLXNjcm9sbC1jb250YWluZXJcIiB9LCB0aGlzLmZpZWxkTWF0Y2hlcy5tYXAoKG1hcHBpbmcpID0+IHtcbiAgICAgIHJldHVybiAoaChcImFyY2dpcy1uZXctaXRlbS1hcHBlbmQtbWF0Y2gtZmllbGRcIiwgeyBrZXk6IG1hcHBpbmcuc291cmNlLCBvbkZpZWxkQ2hhbmdlOiB0aGlzLmhhbmRsZUZpZWxkQ2hhbmdlLmJpbmQodGhpcyksIGZpZWxkOiBtYXBwaW5nIH0pKTtcbiAgICB9KSkpIDogKGgoXCJjYWxjaXRlLWlucHV0LW1lc3NhZ2VcIiwgeyBjbGFzczogXCJuby1maWVsZHNcIiwgaWNvbjogdHJ1ZSwgc3RhdHVzOiBcInZhbGlkXCIgfSwgdGhpcy5pMThuLmVycm9ycy5ub0ZpZWxkcykpLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWFsZXJ0XCIsIHsgaGVhZGluZzogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLnRpdGxlLCBkZXNjcmlwdGlvbjogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmRlc2NyaXB0aW9uLCBsaW5rOiB7IGhyZWY6IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5saW5rLCB0aXRsZTogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmxpbmtUZXh0IH0sIGFjdGl2ZTogISFlcnJvciwgb25BbGVydERpc21pc3M6ICgpID0+ICh0aGlzLmVycm9yID0gbnVsbCkgfSkpKTtcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kTWF0Y2hGaWVsZHMuc3R5bGUgPSBhcmNnaXNOZXdJdGVtUGFnZXNBcHBlbmRNYXRjaEZpZWxkc0NzcztcblxuZXhwb3J0IHsgQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kTWF0Y2hGaWVsZHMgYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX2FwcGVuZF9tYXRjaF9maWVsZHMgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==